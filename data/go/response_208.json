[{"tags": ["parsing", "go", "server"], "comments": [{"owner": {"reputation": 10399, "user_id": 847818, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/01642b4d7b9a7e975176e9e0cf7f2ada?s=128&d=identicon&r=PG", "display_name": "Enrichman", "link": "https://stackoverflow.com/users/847818/enrichman"}, "edited": false, "score": 0, "creation_date": 1546470513, "post_id": 54013573, "comment_id": 94865821, "body": "It doesn&#39;t make sense to have an http handler like this. An handler is made to handle a request that should complete. Here which is the action?"}], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 10032371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b42b22d07b2d6d4dc49a00c7ec957c58?s=128&d=identicon&r=PG&f=1", "display_name": "user10032371", "link": "https://stackoverflow.com/users/10032371/user10032371"}, "edited": false, "score": 0, "creation_date": 1546466358, "post_id": 54013700, "comment_id": 94864492, "body": "Yes I&#39;ll fix that. If you run the code locally, without the http package, it works."}, {"owner": {"reputation": 61, "user_id": 10032371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b42b22d07b2d6d4dc49a00c7ec957c58?s=128&d=identicon&r=PG&f=1", "display_name": "user10032371", "link": "https://stackoverflow.com/users/10032371/user10032371"}, "edited": false, "score": 0, "creation_date": 1546466852, "post_id": 54013700, "comment_id": 94864667, "body": "Correction: build timed out after 10000 ms"}, {"owner": {"reputation": 61, "user_id": 10032371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b42b22d07b2d6d4dc49a00c7ec957c58?s=128&d=identicon&r=PG&f=1", "display_name": "user10032371", "link": "https://stackoverflow.com/users/10032371/user10032371"}, "edited": false, "score": 0, "creation_date": 1546467377, "post_id": 54013700, "comment_id": 94864852, "body": "I run a Diablo bot and thought it&#39;d be fun to parse the ItemsLog.txt file for only &lt;Kept&gt; items... and after I finished that I thought serving it as a web page would be the next step. About to read <a href=\"https://blog.cloudflare.com/the-complete-guide-to-golang-net-http-timeouts/\" rel=\"nofollow noreferrer\">blog.cloudflare.com/&hellip;</a> and see if I can get this working."}, {"owner": {"reputation": 61, "user_id": 10032371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b42b22d07b2d6d4dc49a00c7ec957c58?s=128&d=identicon&r=PG&f=1", "display_name": "user10032371", "link": "https://stackoverflow.com/users/10032371/user10032371"}, "edited": false, "score": 0, "creation_date": 1546469572, "post_id": 54013700, "comment_id": 94865552, "body": "Yes that was intentional. If it runs forever it can update live. I&#39;m changing the timeout. What the repercussions are I&#39;ll find out lol. Maybe I&#39;ll find a better way like AJAX or something."}], "tags": [], "owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "is_accepted": true, "score": 0, "last_activity_date": 1546470191, "last_edit_date": 1546470191, "creation_date": 1546466238, "answer_id": 54013700, "question_id": 54013573, "link": "https://stackoverflow.com/questions/54013573/response-quits-after-x/54013700#54013700", "title": "Response quits after X", "body": "<p>You are not helping yourself ignoring errors:</p>\n\n<pre><code>foo, _ := reader.NextWord() \n</code></pre>\n\n<p>This is very bad practice. Check the error and it will tell you what is going on.</p>\n\n<p><strong>Update:</strong></p>\n\n<p>You have infinite loop in your code.</p>\n\n<pre><code>for {\n        ...\n    }\n</code></pre>\n\n<p><code>for{}</code>  works until you call <code>continue</code> or <code>return</code> inside that loop. </p>\n\n<p><a href=\"https://tour.golang.org/flowcontrol/4\" rel=\"nofollow noreferrer\">https://tour.golang.org/flowcontrol/4</a> </p>\n\n<p>In your case, it cannot run forever because go-routine that runs it is terminated by timeout.</p>\n\n<p><strong>Update2:</strong> </p>\n\n<p>Infinite loop is not compatible with HTTP. With web service, you are getting request and should return response before go-routine is terminated by timeout. </p>\n\n<p>You have two options:</p>\n\n<ol>\n<li>send requests by timer every x seconds and return recent data to\ncaller in handler.</li>\n<li>implement technology that supports bidirectional communications\nbetween client and server -\n<a href=\"https://godoc.org/golang.org/x/net/websocket\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/net/websocket</a></li>\n</ol>\n\n<p>Both options unfortunately more complicated than console app :(   </p>\n"}], "owner": {"reputation": 61, "user_id": 10032371, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b42b22d07b2d6d4dc49a00c7ec957c58?s=128&d=identicon&r=PG&f=1", "display_name": "user10032371", "link": "https://stackoverflow.com/users/10032371/user10032371"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 54013700, "answer_count": 1, "score": 2, "last_activity_date": 1546470191, "creation_date": 1546465563, "last_edit_date": 1546466255, "question_id": 54013573, "link": "https://stackoverflow.com/questions/54013573/response-quits-after-x", "title": "Response quits after X", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n\n    \"github.com/steven-ferrer/gonsole\"\n)\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hi there!\\n\")\n    file, err := os.Open(\"ItemLog.txt\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    reader := gonsole.NewReader(file)\n    counter := 0\n    for {\n        foo, _ := reader.NextWord()\n        if foo == \"&lt;Kept&gt;\" {\n            counter++\n            fmt.Fprintf(w, \"%d\"+\": \", counter)\n            foo, _ = reader.NextWord()\n            for foo != \"|\" {\n                fmt.Fprintf(w, foo+\" \")\n                foo, _ = reader.NextWord()\n            }\n            if foo == \"|\" { // need to reader.NewLine instead but this will work for now.\n                fmt.Fprintf(w, \"\\n\")\n            }\n        }\n    }\n}\nfunc main() {\n    http.HandleFunc(\"/\", handler)\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p>My local CLI works but when I try to wrap it up in a server only so many lines are printed. It's like it times out or something. Help?</p>\n\n<p>I need more text so: I'm parsing a text file.</p>\n\n<p>Edit: here's a test file... <a href=\"https://pastebin.com/ZNbut51X\" rel=\"nofollow noreferrer\">https://pastebin.com/ZNbut51X</a></p>\n"}, {"tags": ["database", "firebase", "go", "google-cloud-firestore"], "comments": [{"owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "edited": false, "score": 0, "creation_date": 1546464745, "post_id": 54013105, "comment_id": 94863860, "body": "Your code looks correct, you should <code>log.Printf(&quot;%v - %v&quot;, values, overwriteValues)</code> and check the result"}], "answers": [{"comments": [{"owner": {"reputation": 1359, "user_id": 1815241, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4af5ac233bc59102243f2b2266e766b1?s=128&d=identicon&r=PG", "display_name": "mornindew", "link": "https://stackoverflow.com/users/1815241/mornindew"}, "edited": false, "score": 0, "creation_date": 1546468488, "post_id": 54013502, "comment_id": 94865253, "body": "Hmm, that would have made sense.   I set a breakpoint and doublechecked both my values and my overwriteValues had &quot;BirthYear&quot; in it.  Not sure why it is throwing that error"}, {"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "reply_to_user": {"reputation": 1359, "user_id": 1815241, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4af5ac233bc59102243f2b2266e766b1?s=128&d=identicon&r=PG", "display_name": "mornindew", "link": "https://stackoverflow.com/users/1815241/mornindew"}, "edited": false, "score": 0, "creation_date": 1546469224, "post_id": 54013502, "comment_id": 94865466, "body": "Do you have not default value of <code>BirthYear</code> in every item in <code>values</code>? Missing that will cause an error."}], "tags": [], "owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "is_accepted": false, "score": 0, "last_activity_date": 1546465178, "creation_date": 1546465178, "answer_id": 54013502, "question_id": 54013105, "link": "https://stackoverflow.com/questions/54013105/no-field-error-updating-values-in-firestore/54013502#54013502", "title": "No Field Error Updating Values in Firestore", "body": "<p><a href=\"https://godoc.org/cloud.google.com/go/firestore#Merge\" rel=\"nofollow noreferrer\">https://godoc.org/cloud.google.com/go/firestore#Merge</a></p>\n\n<blockquote>\n  <p>Merge returns a SetOption that causes only the given field paths to be\n  overwritten. Other fields on the existing document will be untouched.\n  <strong>It is an error if a provided field path does not refer to a value in the data passed to Set.</strong></p>\n</blockquote>\n\n<p>You are sending no <code>BirthYear</code> (default value) in <code>values</code>, but <code>BirthYear</code> is specified in <code>overwriteValues</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 155, "user_id": 8285681, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/844f0ff5bf01d2c5de791c88ac369085?s=128&d=identicon&r=PG&f=1", "display_name": "user8285681", "link": "https://stackoverflow.com/users/8285681/user8285681"}, "edited": false, "score": 0, "creation_date": 1604059277, "post_id": 63893387, "comment_id": 114238161, "body": "I have exactly the same problem: I&#39;m trying to update firestore using Set with Merge options, but if I provide more than two paths, I always get an error &quot;no field XXX for value YYY&quot;.  How to use Update() ?    I tried it but it does not seem trivial. I would have to use protoreflect in order to build a <code>firestore.Update</code> struct...but I don&#39;t want to experiment reflection right now... Maybe can you paste an example of how you used <code>Update()</code> - did you also use reflection?"}, {"owner": {"reputation": 155, "user_id": 8285681, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/844f0ff5bf01d2c5de791c88ac369085?s=128&d=identicon&r=PG&f=1", "display_name": "user8285681", "link": "https://stackoverflow.com/users/8285681/user8285681"}, "edited": false, "score": 0, "creation_date": 1604062866, "post_id": 63893387, "comment_id": 114239610, "body": "I raised a separate question <a href=\"https://stackoverflow.com/questions/64608798/updating-firestore-documents-in-golang-using-structs-or-protobuf-messages-as-d\">here</a>"}], "tags": [], "owner": {"reputation": 391, "user_id": 1327893, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04e3bcc30747ad5eae0fcb661865d80d?s=128&d=identicon&r=PG&f=1", "display_name": "mbaynton", "link": "https://stackoverflow.com/users/1327893/mbaynton"}, "is_accepted": false, "score": 0, "last_activity_date": 1600129175, "creation_date": 1600129175, "answer_id": 63893387, "question_id": 54013105, "link": "https://stackoverflow.com/questions/54013105/no-field-error-updating-values-in-firestore/63893387#63893387", "title": "No Field Error Updating Values in Firestore", "body": "<p>As of cloud.google.com/go/firestore v1.3.0, I don't think you can accomplish an update through <code>Set(..., valueStruct, firestore.Merge(sliceOfPaths))</code> when <code>valueStruct</code> is the complete struct you might read or write to Firestore.</p>\n<p>I receive an error string including the 'no field &quot;[SomeFieldName]&quot;' string the OP references, but there is more information in this error. If my <code>sliceOfPaths</code> refers to the names of two elements of my struct, say an int and a time.Time, I often receive an error such as 'no field &quot;[NameOfMyIntField] for value 2020-09-14T00:00:00Z&quot;' or vice-versa, with it trying to update my Firestore doc's time field with the integer.</p>\n<p>I just used <code>Update()</code> rather than <code>Set()</code>. It's a little clunkier because you have to pass <code>Update()</code> a specially crafted subset of your original struct (a slice of <code>firestore.Update</code>), but it works.</p>\n"}], "owner": {"reputation": 1359, "user_id": 1815241, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4af5ac233bc59102243f2b2266e766b1?s=128&d=identicon&r=PG", "display_name": "mornindew", "link": "https://stackoverflow.com/users/1815241/mornindew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 155, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1600129175, "creation_date": 1546462766, "question_id": 54013105, "link": "https://stackoverflow.com/questions/54013105/no-field-error-updating-values-in-firestore", "title": "No Field Error Updating Values in Firestore", "body": "<p>I am attempting to update a document in firestore using the golang library.  For some reason I am getting an error: \"no field \\\"BirthYear\\\" error and I am not sure why.  Birth year is definitely one of the values that I am attempting to update.</p>\n\n<p>I assume that I have configured my struct incorrectly but I cannot see how.   Here is my struct and my update code:</p>\n\n<p><strong>sharedstructs.Profile</strong></p>\n\n<pre><code>type Profile struct {\n    UID                string                `json:\"UID\" firestore:\"UID\"`\n    ContactEmail       string                `json:\"ContactEmail,omitempty\" firestore:\"ContactEmail\"`\n    BirthMonth         int64                 `json:\"BirthMonth,omitempty\" firestore:\"BirthMonth\"`\n    BirthYear          int64                 `json:\"BirthYear,omitempty\" firestore:\"BirthYear\"`\n    Gender             string                `json:\"Gender,omitempty\" firestore:\"Gender\"`\n    Unit               string                `json:\"Unit,omitempty\" firestore:\"Unit\"`\n    CurrentStatus      string                `json:\"CurrentStatus,omitempty\" firestore:\"CurrentStatus\"`\n    Country            string                `json:\"Country,omitempty\" firestore:\"Country\"`\n    ExperienceType     string                `json:\"ExperienceType,omitempty\" firestore:\"ExperienceType\"`\n    DateJoined         time.Time             `json:\"DateJoined,omitempty\" firestore:\"DateJoined\"`\n    Abilities          []Ability             `json:\"Abilities,omitempty\" firestore:\"Abilities\"`\n    Goals              []Goal                `json:\"Goals,omitempty\" firestore:\"Goals\"`\n    Roles              []Role                `json:\"Roles,omitempty\" firestore:\"Roles\"`\n    TermsAndConditions []TermsAndConditions  `json:\"TermsAndConditions,omitempty\" firestore:\"TermsAndConditions\"`\n    TimeZone           string                `json:\"TimeZone,omitempty\" firestore:\"TimeZone\"`\n    BaselineTests      []BaselineTestResults `json:\"BaselineTests,omitempty\" firestore:\"BaselineTests\"`\n    UpdatedDate        time.Time             `json:\"UpdatedDate,omitempty\" firestore:\"UpdatedDate\"`\n    FirstName          *string               `json:\"FirstName,omitempty\" firestore:\"FirstName\"`\n    LastName           string                `json:\"LastName,omitempty\" firestore:\"LastName\"`\n    DisplayName        string                `json:\"DisplayName,omitempty\" firestore:\"DisplayName\"`\n}\n</code></pre>\n\n<p><strong>Update Function</strong></p>\n\n<pre><code>func updateProfileWithSpecficValues(documentName string, values sharedstructs.Profile, overwriteValues []string) error {\n    ctx := context.Background()\n    app := firestorehelper.GetFirestoreApp()\n\n    client, err := app.Firestore(ctx)\n    if err != nil {\n        return err\n    }\n    defer client.Close()\n\n    //Set the updated date\n    values.UpdatedDate = time.Now()\n    wr, error := client.Doc(collectionName+\"/\"+documentName).Set(ctx, values, firestore.Merge(overwriteValues))\n    if error != nil {\n        return error\n    }\n    fmt.Println(wr.UpdateTime)\n    //Assume success\n    return nil\n}\n</code></pre>\n"}, {"tags": ["go", "signals"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1546462412, "post_id": 54013010, "comment_id": 94862923, "body": "The child process isn&#39;t your program, it&#39;s the <code>go</code> command. Don&#39;t use <code>go run</code>."}, {"owner": {"reputation": 9005, "user_id": 675637, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/8X97W.jpg?s=128&g=1", "display_name": "poy", "link": "https://stackoverflow.com/users/675637/poy"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1546470458, "post_id": 54013010, "comment_id": 94865807, "body": "@JimB I tried using <code>go run child.go</code> from the terminal and then sent it a signal and it worked. Does <code>exec.Command</code> somehow work differently?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1546471319, "post_id": 54013010, "comment_id": 94866049, "body": "For one thing, <code>exec.Command</code> isn&#39;t a shell. It does work the same from the shell however, so how did you test it?"}], "answers": [{"tags": [], "owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "is_accepted": true, "score": 2, "last_activity_date": 1546465948, "creation_date": 1546465948, "answer_id": 54013647, "question_id": 54013010, "link": "https://stackoverflow.com/questions/54013010/how-do-i-send-a-signal-to-a-child-process/54013647#54013647", "title": "How do I send a signal to a child process?", "body": "<p>As mentioned by @JimB in the comments section, the <code>go run</code> is your problem.</p>\n\n<p><code>go run child.go</code> will compile <code>child</code> and execute it as it's own process. If you run a <code>ps</code> after <code>go run child.go</code>, you will see two processes running.</p>\n\n<p>The process you are watching and signalling is the <code>go</code> executable, not the <code>child</code>. </p>\n\n<p>Replace the <code>exec.Command(\"go\", \"run\", \"child.go\")</code> with the compiled binary <code>exec.Command(\"child\")</code>and it should work.</p>\n"}], "owner": {"reputation": 1039, "user_id": 4386643, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1407b4e2426e7d10d76859de4a9c2a5?s=128&d=identicon&r=PG&f=1", "display_name": "MakotoE", "link": "https://stackoverflow.com/users/4386643/makotoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1063, "favorite_count": 0, "accepted_answer_id": 54013647, "answer_count": 1, "score": 0, "last_activity_date": 1546465948, "creation_date": 1546462250, "question_id": 54013010, "link": "https://stackoverflow.com/questions/54013010/how-do-i-send-a-signal-to-a-child-process", "title": "How do I send a signal to a child process?", "body": "<p>I'm having trouble sending a signal from a parent process and receiving it in the child process.</p>\n\n<p>This is the code for the child process. It exits when it receives SIGINT.</p>\n\n<pre><code>// child.go\nfunc main() {\n    stop := make(chan os.Signal, 1)\n    signal.Notify(stop, os.Interrupt)\n    fmt.Println(\"started\")\n\n    &lt;-stop\n    fmt.Println(\"stopped\")\n}\n</code></pre>\n\n<p>This is the parent process. It starts <code>child.go</code>, sends SIGINT, then waits for it to exit.</p>\n\n<pre><code>// main.go\nfunc main() {\n    // Start child process\n    cmd := exec.Command(\"go\", \"run\", \"child.go\")\n    cmd.Stdout = os.Stdout\n    cmd.Stderr = os.Stderr\n    err := cmd.Start()\n    if err != nil {\n        _, _ = fmt.Fprintf(os.Stderr, \"Start: \" + err.Error())\n        return\n    }\n\n    // Wait, then send signal\n    time.Sleep(time.Millisecond * 500)\n    err = cmd.Process.Signal(os.Interrupt)\n    if err != nil {\n        _, _ = fmt.Fprintf(os.Stderr, \"Signal: \" + err.Error())\n        return\n    }\n\n    // Wait for child process to finish\n    err = cmd.Wait()\n    if err != nil {\n        _, _ = fmt.Fprintf(os.Stderr, \"Wait: \" + err.Error())\n    }\n    return\n}\n</code></pre>\n\n<p>This code should print <code>started\\nstopped</code> to show that it worked as expected, but it only prints <code>started</code> and hangs at <code>cmd.Wait()</code>, meaning the child process did not receive the signal.</p>\n\n<p>When I run <code>go run child.go</code> it works fine, so I don't think the problem is with that file. I understand that <code>func (*Process) Signal</code> doesn't work on Windows; I am using Linux.</p>\n\n<p>How can I fix the code so that the child process gets the signal sent by the parent process?</p>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1546462485, "post_id": 54012738, "comment_id": 94862952, "body": "Dereferencing an uninitialized, ie <code>nil</code>, pointer will always result in <code>reflect.Invalid</code>. See here (<a href=\"https://play.golang.com/p/8UgDtqK_8ra\" rel=\"nofollow noreferrer\">play.golang.com/p/8UgDtqK_8ra</a>). To avoid this you have to initialize the field&#39;s value which you can do with <code>reflect.New</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546462692, "post_id": 54012738, "comment_id": 94863037, "body": "... here&#39;s an example: <a href=\"https://play.golang.com/p/q71J0qTQECP\" rel=\"nofollow noreferrer\">play.golang.com/p/q71J0qTQECP</a>"}, {"owner": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546462798, "post_id": 54012738, "comment_id": 94863082, "body": "Would reflectively creating a zero value instance of it first before dereferencing solve this?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546463006, "post_id": 54012738, "comment_id": 94863170, "body": "Does the code in the second comment not already answer your question?"}, {"owner": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1546463515, "post_id": 54012738, "comment_id": 94863375, "body": "It does, thanks. Comments didn&#39;t refresh when I replied."}], "answers": [{"tags": [], "owner": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "is_accepted": true, "score": 7, "last_activity_date": 1546463814, "creation_date": 1546463814, "answer_id": 54013300, "question_id": 54012738, "link": "https://stackoverflow.com/questions/54012738/dereference-struct-pointer-and-access-fields-with-reflection/54013300#54013300", "title": "Dereference struct pointer and access fields with reflection", "body": "<p>As <a href=\"https://stackoverflow.com/users/965900/mkopriva\">mkopriva</a> mentioned, dereferencing a nil pointer will always return <code>reflect.Invalid</code>. The solution is to create a new instance first.</p>\n\n<pre><code>if fieldVal.Kind() == reflect.Ptr {\n    fieldVal.Set(reflect.New(fieldVal.Type().Elem()))\n    fieldValDeref = fieldVal.Elem()\n} else {\n    fieldValDeref = fieldVal\n}\n</code></pre>\n"}], "owner": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2057, "favorite_count": 0, "accepted_answer_id": 54013300, "answer_count": 1, "score": 3, "last_activity_date": 1546463814, "creation_date": 1546460901, "question_id": 54012738, "link": "https://stackoverflow.com/questions/54012738/dereference-struct-pointer-and-access-fields-with-reflection", "title": "Dereference struct pointer and access fields with reflection", "body": "<p>I'm writing a recursive function that iterates through every primitive field in a struct.</p>\n\n<p>I need to be able to support fields that are structs, pointers to structs, fields, and pointers to fields.</p>\n\n<p>I've tried doing something like this, where for each field, I first do a check if it's a pointer. If it is, I switch on the type of that instead of just the field itself.</p>\n\n<pre><code>//Get reflect values and types\nvalOf := reflect.ValueOf(dest).Elem()\ntypeOf := valOf.Type()\n\n//Iterate through each field\nfor i := 0; i &lt; valOf.NumField(); i++ {\n\n    var fieldValDeref reflect.Value\n\n    //Get reflect value and type of single field\n    fieldVal := valOf.Field(i)\n    fieldTyp := typeOf.Field(i)\n\n    //Check if field is a pointer. If so, dereference and switch on dereferenced type\n    if fieldVal.Kind() == reflect.Ptr {\n        fieldValDeref = fieldVal.Elem()\n    } else {\n        fieldValDeref = fieldVal\n    }\n\n\n    switch fieldValDeref.Kind() {\n    case reflect.Array, reflect.Chan, reflect.Interface, reflect.Func, reflect.Map, reflect.UnsafePointer:\n        return errors.New(\"invalid destination field: \" + fieldTyp.Name)\n\n    case reflect.Struct:\n        //Recursive call\n        break\n    default:\n        //Perform Action on Field\n..................................\n</code></pre>\n\n<p>The issue I'm getting with this, is that the type of any pointer, struct or not, after calling <code>.Elem()</code> is <code>reflect.Invalid</code>.</p>\n\n<p>How can I first dereference a field (if it is a pointer) and then perform actions accordingly, whether the field is a struct or a primitive?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "batch-processing", "azure-eventhub", "azure-sdk"], "comments": [{"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1546461687, "post_id": 54012567, "comment_id": 94862624, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/51520830/golang-concurrency-processing-batches-of-items\">Golang concurrency, processing batches of items</a>"}, {"owner": {"reputation": 337, "user_id": 2099074, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1491488287/picture?type=large", "display_name": "Martin Kosicky", "link": "https://stackoverflow.com/users/2099074/martin-kosicky"}, "reply_to_user": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1546492346, "post_id": 54012567, "comment_id": 94869979, "body": "This question is about azure eventhubs batch processing, not some random batchprocessing"}, {"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1546528998, "post_id": 54012567, "comment_id": 94886638, "body": "Link I gave you should help to batch data. I am not sure what API Azure has to run these batches. It was not clear from your question what part of the process is not clear for you. Your question may not get enough attention because it is too broad."}], "answers": [{"tags": [], "owner": {"reputation": 337, "user_id": 2099074, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1491488287/picture?type=large", "display_name": "Martin Kosicky", "link": "https://stackoverflow.com/users/2099074/martin-kosicky"}, "is_accepted": false, "score": 0, "last_activity_date": 1546795188, "creation_date": 1546795188, "answer_id": 54064045, "question_id": 54012567, "link": "https://stackoverflow.com/questions/54012567/batch-processing-of-events-from-ms-azure-eventhub-in-golang/54064045#54064045", "title": "Batch processing of events from ms azure eventhub in golang", "body": "<p>I guess the question is invalid. Since I am free to store checkpoints whenerver I want (not only after batch process, but after multiple batches processed). I am free to use this one-by-one api and forward the events to some custom batch processor. All the events contain an offset so I can store a checkpoint whenever I want in the custom batch processor.</p>\n\n<p>PS: The linked azure examples mention batch processing, but it's actually batch writing not batch reading.</p>\n"}], "owner": {"reputation": 337, "user_id": 2099074, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1491488287/picture?type=large", "display_name": "Martin Kosicky", "link": "https://stackoverflow.com/users/2099074/martin-kosicky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 468, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1546795188, "creation_date": 1546459983, "last_edit_date": 1546501741, "question_id": 54012567, "link": "https://stackoverflow.com/questions/54012567/batch-processing-of-events-from-ms-azure-eventhub-in-golang", "title": "Batch processing of events from ms azure eventhub in golang", "body": "<p>I read some docs about how to process events in golang from AZURE eventhub but that's all one by one and I couldn't find batch processing of events anywhere. That seems kinda useless for ETL operations. Does anyone know how to batch process events with the golang library?  </p>\n\n<p>Because currently I looked at the <a href=\"https://github.com/Azure/azure-event-hubs-go/blob/master/_examples/helloworld/consumer/main.go\" rel=\"nofollow noreferrer\">https://github.com/Azure/azure-event-hubs-go/blob/master/_examples/helloworld/consumer/main.go</a> but the handler is a function that accepts a single event as parameter. More effective would be if there was some handler that can accept batch of events. Because if I would want to do some database transactions based on the events I would have to make one transaction per event. I also cannot just send it to some other goroutine because If i make a transaction in database based on processed events I have to make sure that a checkpoint is set after the batch. Just like when working with AWS kinesis in AWS lambda.</p>\n"}, {"tags": ["firebase", "go", "google-cloud-firestore"], "answers": [{"comments": [{"owner": {"reputation": 1359, "user_id": 1815241, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4af5ac233bc59102243f2b2266e766b1?s=128&d=identicon&r=PG", "display_name": "mornindew", "link": "https://stackoverflow.com/users/1815241/mornindew"}, "edited": false, "score": 0, "creation_date": 1546464718, "post_id": 54012721, "comment_id": 94863848, "body": "Thank you.   Even though you are saying to use the &quot;update&quot; Go API you appear to be using the &quot;Set&quot; call.  I assume that wasn&#39;t a mistake?   Just to make sure that I understand your suggestion.... Instead of marshalling over from my API struct to my firebase struct I should marshal over from my API Struct over to a map[string]interface{} but make sure that I don&#39;t marshal over any of the nil values that were passed into the API.    Am I thinking straight?"}, {"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "reply_to_user": {"reputation": 1359, "user_id": 1815241, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4af5ac233bc59102243f2b2266e766b1?s=128&d=identicon&r=PG", "display_name": "mornindew", "link": "https://stackoverflow.com/users/1815241/mornindew"}, "edited": false, "score": 0, "creation_date": 1546465286, "post_id": 54012721, "comment_id": 94864054, "body": "You are right. Document comment confused me - <code>use the update() method:</code>"}], "tags": [], "owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "is_accepted": true, "score": 0, "last_activity_date": 1546465580, "last_edit_date": 1546465580, "creation_date": 1546460833, "answer_id": 54012721, "question_id": 54012064, "link": "https://stackoverflow.com/questions/54012064/best-practices-for-ignoring-nil-values-in-firestore/54012721#54012721", "title": "Best Practices For Ignoring Nil Values in Firestore", "body": "<p>You have two options:</p>\n\n<ol>\n<li>Use <code>map[string]interface{}</code></li>\n<li><p>Use custom structure with <code>firestore</code> attribute -<code>firestore:\"FieldName,omitempty\"</code>. </p>\n\n<p>_, err := client.Collection(\"cities\").Doc(\"DC\").Set(ctx, map[string]interface{}{\n        \"capital\": true,\n}, firestore.MergeAll)\nif err != nil {\n        // Handle any errors in an appropriate way, such as returning them.\n        log.Printf(\"An error has occurred: %s\", err)\n}</p></li>\n</ol>\n\n<p>Do not confuse <code>json</code> <code>omitempty</code> with <code>firestore</code>.</p>\n\n<p>You also must to provide field name as this syntax will use <code>omitempty</code> as name.</p>\n\n<pre><code>firestore:\"omitempty\" - not correct\n</code></pre>\n\n<p><a href=\"https://firebase.google.com/docs/firestore/manage-data/add-data\" rel=\"nofollow noreferrer\">https://firebase.google.com/docs/firestore/manage-data/add-data</a></p>\n\n<p><a href=\"https://github.com/GoogleCloudPlatform/golang-samples/blob/2a9e87a2bf86f4a651634d21e34762ca308fdf05/firestore/firestore_snippets/save.go#L118-L124\" rel=\"nofollow noreferrer\">code</a></p>\n"}], "owner": {"reputation": 1359, "user_id": 1815241, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4af5ac233bc59102243f2b2266e766b1?s=128&d=identicon&r=PG", "display_name": "mornindew", "link": "https://stackoverflow.com/users/1815241/mornindew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1094, "favorite_count": 0, "accepted_answer_id": 54012721, "answer_count": 1, "score": 0, "last_activity_date": 1546495344, "creation_date": 1546457080, "last_edit_date": 1546495344, "question_id": 54012064, "link": "https://stackoverflow.com/questions/54012064/best-practices-for-ignoring-nil-values-in-firestore", "title": "Best Practices For Ignoring Nil Values in Firestore", "body": "<p>I am building custom webservices using Golang (Go-Swagger for API Definition) and Firestore as my document store.   Everything is working fine except it gets \"awkward\" on Updates to the database.   I have a solution but I am not convinced it is the most elegant one.  Has anyone else run into this, and how did they solve it....</p>\n\n<p><strong>Problem Statement</strong>: Nil values are overwriting existing values in firebase when I write to the database </p>\n\n<p><strong>Proposed Solution</strong> - MY API has json:\"omitempty\" on optional parameters and nil values will be passed in (as opposed to getting the default golang values).  I am planning on taking the Struct passed into the API and one attr at a time populating it into my Struct that firestore is using.  I have performance concerns but don't want to couple my API Struct with my DB Struct.  I am also going to set the firestore:\"omitempty\"` string literal on my firestore struct much like the API Struct.   I hope this will tell firestore to not write any values that are nil.</p>\n\n<p>Is this the best way?   Are their other alternatives?   The default values of golang seems to have pluses and minuses.  </p>\n\n<p>UPDATE: </p>\n\n<p>I ended up in a similar place as my proposed solution but also followed the suggestion that Dimitry suggested.  I created an []firestore.Update object to contain only the values that I want to update.  When I called firestore it will only update those values.</p>\n\n<p>Here is the function that I am using to call firestore.</p>\n\n<pre><code>func updateProfileUsingUpdateMethod(documentName string, values []firestore.Update) error {\n    ctx := context.Background()\n    app := firestorehelper.GetFirestoreApp()\n\n    client, err := app.Firestore(ctx)\n    if err != nil {\n        return err\n    }\n    defer client.Close()\n\n    //Set the updated date\n\n    wr, error := client.Doc(collectionName+\"/\"+documentName).Update(ctx, values)\n    if error != nil {\n        return error\n    }\n    fmt.Println(wr.UpdateTime)\n    //Assume success\n    return nil\n} \n</code></pre>\n\n<p>I also create a firestore.Update object and will append that to my []firestore.Update slice.</p>\n\n<pre><code>firestore.Update{Path: \"PATH_TO_ATTR\", Value: VALUE_TO_PASS_IN}\n</code></pre>\n"}, {"tags": ["user-interface", "go"], "comments": [{"owner": {"reputation": 109, "user_id": 1864498, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlN0y.jpg?s=128&g=1", "display_name": "pernpas", "link": "https://stackoverflow.com/users/1864498/pernpas"}, "reply_to_user": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "edited": false, "score": 0, "creation_date": 1546458567, "post_id": 54012028, "comment_id": 94861411, "body": "Should I delete the question?"}, {"owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "edited": false, "score": 1, "creation_date": 1546462715, "post_id": 54012028, "comment_id": 94863049, "body": "rephrased the question, feel free to accept the answer if it actually was what you were looking for."}], "answers": [{"tags": [], "owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "is_accepted": true, "score": 1, "last_activity_date": 1546462741, "last_edit_date": 1546462741, "creation_date": 1546457929, "answer_id": 54012196, "question_id": 54012028, "link": "https://stackoverflow.com/questions/54012028/filechooser-component-in-walk-gui-toolkit-for-go/54012196#54012196", "title": "Filechooser component in Walk GUI Toolkit for GO", "body": "<p>Given the SDK documentation, the commondialogs.go of the walk toolkit supplies a FileDialog:\n<a href=\"https://github.com/lxn/walk/blob/master/commondialogs.go\" rel=\"nofollow noreferrer\">https://github.com/lxn/walk/blob/master/commondialogs.go</a></p>\n\n<p>(search for \"FileDialog\" to find the struct)</p>\n"}], "owner": {"reputation": 109, "user_id": 1864498, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlN0y.jpg?s=128&g=1", "display_name": "pernpas", "link": "https://stackoverflow.com/users/1864498/pernpas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 425, "favorite_count": 1, "accepted_answer_id": 54012196, "answer_count": 1, "score": -1, "last_activity_date": 1546463306, "creation_date": 1546456904, "last_edit_date": 1546463306, "question_id": 54012028, "link": "https://stackoverflow.com/questions/54012028/filechooser-component-in-walk-gui-toolkit-for-go", "title": "Filechooser component in Walk GUI Toolkit for GO", "body": "<p>There should be a FileChooser component in the <a href=\"https://github.com/lxn/walk\" rel=\"nofollow noreferrer\">walk GUI Toolkit</a>, but I am unable to find it. Can someone point me to the right class?</p>\n"}, {"tags": ["database", "go", "go-gorm", "preloading"], "answers": [{"tags": [], "owner": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "is_accepted": true, "score": 2, "last_activity_date": 1546469683, "creation_date": 1546469683, "answer_id": 54014241, "question_id": 54011708, "link": "https://stackoverflow.com/questions/54011708/how-to-preload-with-gorm/54014241#54014241", "title": "How to preload with Gorm", "body": "<p>Unfortunately that's just the way GORM handles preloading.</p>\n\n<p><a href=\"https://github.com/go-pg/pg\" rel=\"nofollow noreferrer\">go-pg</a> has slightly better queries, but doesn't have the same functionality as GORM. It still will do multiple queries in some cases.</p>\n\n<p>I would honestly recommend just using <a href=\"http://doc.gorm.io/advanced.html#sql-builder\" rel=\"nofollow noreferrer\">query building</a> with raw SQL, especially if you know what your models will look like at compile time. I ended up going with this approach in my project, despite the fact that I didn't know that my models were going to look like. </p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 12008993, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBNF8PEsCSV8s1znNpAQYIFvTny0T-w3pHrENjuZg=k-s128", "display_name": "yulin_zou", "link": "https://stackoverflow.com/users/12008993/yulin-zou"}, "is_accepted": false, "score": 0, "last_activity_date": 1606226504, "creation_date": 1606226504, "answer_id": 64988087, "question_id": 54011708, "link": "https://stackoverflow.com/questions/54011708/how-to-preload-with-gorm/64988087#64988087", "title": "How to preload with Gorm", "body": "<p>Can try the <a href=\"https://gorm.io/docs/query.html#Joins\" rel=\"nofollow noreferrer\">Joins()</a>, which can perform JOIN syntax in SQL</p>\n"}], "owner": {"reputation": 53, "user_id": 5098891, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80b1a1fdaf871a7bd91fed089606accd?s=128&d=identicon&r=PG&f=1", "display_name": "gambol", "link": "https://stackoverflow.com/users/5098891/gambol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3434, "favorite_count": 0, "accepted_answer_id": 54014241, "answer_count": 2, "score": 1, "last_activity_date": 1606226504, "creation_date": 1546455358, "last_edit_date": 1548631394, "question_id": 54011708, "link": "https://stackoverflow.com/questions/54011708/how-to-preload-with-gorm", "title": "How to preload with Gorm", "body": "<p>I am hitting a road block with preloading and associations</p>\n\n<pre><code>type Entity struct {\n  ID           uint `gorm:\"primary_key\"`\n  Username     string\n  Repositories []*Repository `gorm:\"many2many:entity_repositories\"`\n}\n\ntype Repository struct {\n  ID       uint `gorm:\"primary_key\"`\n  Name     string\n  Entities []*Entity `gorm:\"many2many:entity_repositories\"`\n} \n</code></pre>\n\n<p>With small users numbers the preloading is fine using the below</p>\n\n<pre><code> db.Preload(\"Repositories\").Find(&amp;list)\n</code></pre>\n\n<p>Also tried</p>\n\n<pre><code> db.Model(&amp;User{}).Related(&amp;Repository{}, \"Repositories\").Find(&amp;list)\n</code></pre>\n\n<p>The preload seems to a <code>select * entities</code> and then a inner join using a <code>SELECT * FROM \"repositories\" INNER JOIN \"entity_repositories\" ON \"entity_repositories\".\"repository_id\" = \"repositories\".\"id\" WHERE (\"entity_repositories\".\"entity_id\" IN ('1','2','3','4','5','6','7','8','9','10'))</code></p>\n\n<p>As the number of user's increases this is no longer maintainable as it hits a sqlite limit (dev). I've tried numerous permutations! .. Realistically i guess i just want it to do something like </p>\n\n<pre><code>SELECT entities.*, repositories.*  \nFROM entities \nJOIN entity_repositories ON entity_repositories.entity_id = entities.id\nJOIN repositories ON repositories.id = entity_repositories.repository_id\nORDER BY entities.id\n</code></pre>\n\n<p>And fill in the model for me .. </p>\n\n<p>Am I doing something obviously wrong or? </p>\n"}, {"tags": ["go", "virtual", "composition"], "comments": [{"owner": {"reputation": 13016, "user_id": 8751754, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7k6Li.png?s=128&g=1", "display_name": "Ron", "link": "https://stackoverflow.com/users/8751754/ron"}, "edited": false, "score": 7, "creation_date": 1546453816, "post_id": 54011364, "comment_id": 94859471, "body": "Drawing parallels between C++ and any other language can prove to be counter-productive."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 13016, "user_id": 8751754, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7k6Li.png?s=128&g=1", "display_name": "Ron", "link": "https://stackoverflow.com/users/8751754/ron"}, "edited": false, "score": 0, "creation_date": 1546472638, "post_id": 54011364, "comment_id": 94866366, "body": "first derivative to @Ron\u2019s comment: Applying patterns found in other programming languages to Go can prove counter-productive."}, {"owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "edited": false, "score": 0, "creation_date": 1546503102, "post_id": 54011364, "comment_id": 94873183, "body": "I&#39;m voting to close this question as off-topic because it shouldbe moved to Codereview"}, {"owner": {"reputation": 1166, "user_id": 110838, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/ea54fcf635f1e888e4bcd73e68ac2b69?s=128&d=identicon&r=PG", "display_name": "meissnersd", "link": "https://stackoverflow.com/users/110838/meissnersd"}, "edited": false, "score": 0, "creation_date": 1546543484, "post_id": 54011364, "comment_id": 94893478, "body": "Down vote because I asked for feedback on a design choice? I think I clearly stated I was looking to learn?  I stated up front the languages would solve the problem in different ways."}], "answers": [{"tags": [], "owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "is_accepted": false, "score": 0, "last_activity_date": 1546455622, "last_edit_date": 1546455622, "creation_date": 1546455183, "answer_id": 54011669, "question_id": 54011364, "link": "https://stackoverflow.com/questions/54011364/abstract-base-class-design-in-go-vs-c/54011669#54011669", "title": "Abstract base class design in Go vs C++", "body": "<p>Beeing new to go myself, this answer is not backed by years of go experience :-)</p>\n\n<p>I don't know, if the way you tackle this is the correct approach. \ngo allows interfaces to be implemented without explicit declaration. If you have elves, and you need them to do <code>ItemCRUD</code> methods, just implement them. </p>\n\n<p>The method set will then match the interface and you can use the elf as a <code>ItemCRUD</code> where required.</p>\n\n<p>To supply any elf object with a default <code>ItemCRUD</code> Implementation, you should implement an adapter for the <code>ItemCRUD</code> and compose the adapter with your abstract elf. The abstract methods could have a default implementation as <code>log.Fatal(\"not implemented\")</code></p>\n\n<p>The concrete elves shadow the adapter's methods, this answers your question: It is not required to insert the object during creation.</p>\n\n<p>Yet, since go has no generics, it may not be the right approach to have an <code>ItemCRUD</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "is_accepted": false, "score": 0, "last_activity_date": 1546455795, "creation_date": 1546455795, "answer_id": 54011806, "question_id": 54011364, "link": "https://stackoverflow.com/questions/54011364/abstract-base-class-design-in-go-vs-c/54011806#54011806", "title": "Abstract base class design in Go vs C++", "body": "<p>Im not entirely clear what the plan is with the above code and without understanding that its hard to suggest specific solutions, what is clear is you are very much coming to the party with an established OOP mindset (I did too) which is rarely helpful in finding the best solution in golang.</p>\n\n<p>In Golang I wouldnt usually embed an interface in an implementation, interfaces are satisfied implicitly in Golang which allows for a nice separation of expectation and implementation which should generally be respected. \nA reciever method should expect an interface, the implementation passed at runtime should just satisfy the signature of that interface implicitly.</p>\n\n<p>So perhaps my doWork method needs to be able to createItems then it would be the doWork method that would accept any implementation of ItemCRUD which it could call to create an item. But this is me guessing at what you really want to do here, I suspect if you just separate implementation from interface you will probably answer your own question.</p>\n"}], "owner": {"reputation": 1166, "user_id": 110838, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/ea54fcf635f1e888e4bcd73e68ac2b69?s=128&d=identicon&r=PG", "display_name": "meissnersd", "link": "https://stackoverflow.com/users/110838/meissnersd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 160, "favorite_count": 0, "answer_count": 2, "score": -4, "last_activity_date": 1546457886, "creation_date": 1546453709, "last_edit_date": 1546457886, "question_id": 54011364, "link": "https://stackoverflow.com/questions/54011364/abstract-base-class-design-in-go-vs-c", "title": "Abstract base class design in Go vs C++", "body": "<p>I am still learning the Go way of doing things, coming from a C++ background. I am looking for feedback contrasting OOP inheritance to interface composition.</p>\n\n<p>I have a design situation in a Go program where, if I was implementing in C++, I would solve with an abstract base class. </p>\n\n<p>Suppose I need a base class, which has many implementors. The base class has shared methods that do work on abstract data items.  Different Worker implementations provide CRUD operations on different item types, but workers all use the shared methods of the base class for general work. </p>\n\n<p>In C++ I might do it this way</p>\n\n<pre><code>class IItem\n{\n    // virtual methods\n};\n\nclass IWorker\n{\npublic:\n    // one of many virtual functions that deal with IItem CRUD\n    virtual IItem* createItem() = 0; \n\n    // concrete method that works on interfaces\n    void doWork()\n    {\n        IItem* item = createItem();\n        // do stuff with an IItem*\n    }\n\n};\n\n\nclass Toy : public IItem\n{\n\n};\n\n// one of many kinds of workers\nclass ElfWorker : public IWorker\n{\npublic:\n\n    ElfWorker()\n    {\n        // constructor implicitly calls IWorker()\n    }\n\n    IItem* createItem() override\n    {\n        return new Toy;\n    }\n};\n</code></pre>\n\n<p>In Go you don't have abstract virtual methods such as IWorker::createItem().  Concrete classes need to supply the base with an interface or function that do the right thing.  </p>\n\n<p>So I think it is the case that the Go code the ew.ItemCRUD interface has to be explicitly set with a pointer to an ElfWorker. </p>\n\n<p>The elf knows how to createItem(), which in his case happens to be Toy object. Other workers would implement their own ItemCRUD for their data objects. </p>\n\n<pre><code>type Item interface {                         \n    // various methods                                                                                \n}\ntype ItemCRUD interface {                                                                             \n    create() Item                                                                                     \n    // other CRUD                                                                                     \n}                                                                                                     \n\ntype Worker struct {\n    ItemCRUD  // embedded interface                                                                                        \n}                                                                                                     \nfunc (w *Worker) doWork() {\n    item := w.create()                                                                                \n    // do stuff with item                                                                          \n}\n\ntype Toy struct {\n}\n\ntype ElfWorker struct {                                                                               \n    Worker // embedded                                                                                \n    // ..\n}       \n\nfunc NewElfWorker() *ElfWorker {                                                                      \n    ew := &amp;ElfWorker{}                                                                                \n    ew.ItemCRUD = ew // &lt;-- #### set Worker ItemCRUD  explicitly ####                                                  \n    return ew                                                                                         \n}                                                                                                     \n\nfunc (ew *ElfWorker) createItem() Item {\n    return &amp;Toy{}                                                                                     \n}\n// more ElfWorker Item CRUD\nfunc bigFunction(w *Worker) {                                                                     \n    // ...                                                                                            \n    w.doWork()  \n   // ..                                                                                       \n}   \n</code></pre>\n\n<p>So the part that I am wrestling a bit with is explicit setting.  Seems like the \"Go way\" of composition does require this <strong>explicit</strong> step if I want the base Worker class to provide shared methods on Items.</p>\n\n<p>Thoughts? </p>\n"}, {"tags": ["go", "visual-studio-code"], "comments": [{"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 1, "creation_date": 1546452642, "post_id": 54011088, "comment_id": 94859012, "body": "where did you &quot;update your GOPATH&quot;? its probable that the file you updated it in (.eg maybe ~/.bashrc) has not been reloaded by your terminal session, if it is in ~/.bashrc for example that would usually get loaded the next time you launch a terminal, you could force the execution by typing <code>. ~&#47;.bashrc</code> in terminal, you can also type echo $GOPATH in terminal to verify what value it is using"}, {"owner": {"reputation": 1933, "user_id": 4424698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh5.googleusercontent.com/-Rpp-wUKIk-o/AAAAAAAAAAI/AAAAAAAABCc/2my33oV6DDs/photo.jpg?sz=128", "display_name": "Hrvoje T", "link": "https://stackoverflow.com/users/4424698/hrvoje-t"}, "reply_to_user": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1546452783, "post_id": 54011088, "comment_id": 94859069, "body": "I changed it with command in bash<code>export GOPATH=&#47;media&#47;mygocode</code>. When I type <code>go env</code> I can see it is updated."}, {"owner": {"reputation": 1933, "user_id": 4424698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh5.googleusercontent.com/-Rpp-wUKIk-o/AAAAAAAAAAI/AAAAAAAABCc/2my33oV6DDs/photo.jpg?sz=128", "display_name": "Hrvoje T", "link": "https://stackoverflow.com/users/4424698/hrvoje-t"}, "reply_to_user": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1546452958, "post_id": 54011088, "comment_id": 94859142, "body": "However, now I reopened my terminal and it showed again old GOPATH. So I updated it only temporarily? How to make this change persistent?"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 1, "creation_date": 1546453083, "post_id": 54011088, "comment_id": 94859190, "body": "yes, if you just run the command in terminal it will be temporary - just the life of that session - I would suggest add it to the bottom of ~/.bashrc, then you can exec the file with <code>. ~&#47;.bashrc</code> for immediate change - it will then get run every time you launch a terminal"}, {"owner": {"reputation": 1933, "user_id": 4424698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh5.googleusercontent.com/-Rpp-wUKIk-o/AAAAAAAAAAI/AAAAAAAABCc/2my33oV6DDs/photo.jpg?sz=128", "display_name": "Hrvoje T", "link": "https://stackoverflow.com/users/4424698/hrvoje-t"}, "reply_to_user": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1546455613, "post_id": 54011088, "comment_id": 94860166, "body": "I put <code>export GOPATH=&#47;path&#47;to&#47;my&#47;custom&#47;workspace</code> in my <code>.bashrc</code>. Restarted for loading in session and started VS Code. Voila, it works now. Thanks!"}], "owner": {"reputation": 1933, "user_id": 4424698, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh5.googleusercontent.com/-Rpp-wUKIk-o/AAAAAAAAAAI/AAAAAAAABCc/2my33oV6DDs/photo.jpg?sz=128", "display_name": "Hrvoje T", "link": "https://stackoverflow.com/users/4424698/hrvoje-t"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1152, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1546452302, "creation_date": 1546452302, "question_id": 54011088, "link": "https://stackoverflow.com/questions/54011088/how-to-update-vs-code-gopath-when-running-my-code-in-vs-code-terminal", "title": "How to update VS Code GOPATH when running my code in VS Code terminal?", "body": "<p>In Ubuntu, I have changed my GOPATH variable via bash terminal. In VS Code it is now showing updated path with <code>Go: current GOPATH</code> command. </p>\n\n<p>However, when I run <code>go run *.go</code> I get an error that it can not find my package from my old GOPATH. I tried disabled Go extension, but the error is the same. I even set my new GOPATH in settings.json in VS Code. </p>\n"}, {"tags": ["go", "serialization", "struct"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1546452890, "post_id": 54010535, "comment_id": 94859113, "body": "A hint: <a href=\"https://play.golang.org/p/69CuGYKkAfC\" rel=\"nofollow noreferrer\">play.golang.org/p/69CuGYKkAfC</a> You do NOT need to buffer each encoders result in RAM..."}], "answers": [{"tags": [], "owner": {"reputation": 762, "user_id": 3052074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/619c2a3b094423dd741dc8eb161836f0?s=128&d=identicon&r=PG", "display_name": "Andrey Dyatlov", "link": "https://stackoverflow.com/users/3052074/andrey-dyatlov"}, "is_accepted": false, "score": 1, "last_activity_date": 1546451189, "creation_date": 1546451189, "answer_id": 54010867, "question_id": 54010535, "link": "https://stackoverflow.com/questions/54010535/how-to-serialize-a-nested-struct-with-gob-encoding-in-golang/54010867#54010867", "title": "How to serialize a nested struct with GOB encoding in GoLang?", "body": "<p>Please, make the fields of the <code>Hello</code> and <code>Bye</code> structures public. Please see <a href=\"https://golang.org/pkg/encoding/gob/#hdr-Types_and_Values\" rel=\"nofollow noreferrer\">the documentation for the <code>gob</code> package</a>:</p>\n\n<blockquote>\n  <p>Structs encode and decode only exported fields.</p>\n</blockquote>\n"}], "owner": {"reputation": 19, "user_id": 10033867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b7ec983b115e7f5ac9824c4ff4789ca?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/10033867/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1136, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1546451189, "creation_date": 1546449464, "question_id": 54010535, "link": "https://stackoverflow.com/questions/54010535/how-to-serialize-a-nested-struct-with-gob-encoding-in-golang", "title": "How to serialize a nested struct with GOB encoding in GoLang?", "body": "<p>I have a couple of example nested structs and need to serialize them. I am using the <code>encoding/gob</code> library, which should convert the struct data to bytes and the <code>encoding/base64</code> library to convert the bytes to a readable base64 format. However, when I run my example code I get a <code>serialization error</code> error. I don't understand why this happens and how to fix the problem.</p>\n\n<p>I followed this example: <a href=\"https://stackoverflow.com/questions/28020070/golang-serialize-and-deserialize-back\">Golang serialize and deserialize back</a></p>\n\n<p>Here is the code:</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"bytes\"\n    \"encoding/base64\"\n    \"encoding/gob\"\n    \"errors\"\n    \"fmt\"\n)\n\ntype Hello struct {\n    greeting string\n}\n\ntype Bye struct {\n    helloSaid Hello\n    byesaid Hello\n}\n\n\nfunc (b1 Bye) Serialize() (string, error) {\n    b := bytes.Buffer{}\n    e := gob.NewEncoder(&amp;b)\n    err := e.Encode(b1)\n    if err != nil {\n        return string(b.Bytes()[:]), errors.New(\"serialization failed\")\n    }\n    return base64.StdEncoding.EncodeToString(b.Bytes()), nil\n}\n\nfunc DeserializeBye(str string) (Bye, error) {\n    m := Bye{}\n    by, err := base64.StdEncoding.DecodeString(str)\n    if err != nil {\n        return m, errors.New(\"deserialization failed\")\n    }\n    b := bytes.Buffer{}\n    b.Write(by)\n    d := gob.NewDecoder(&amp;b)\n    err = d.Decode(&amp;m)\n    if err != nil {\n        return m, errors.New(\"deserialization failed\")\n    }\n    return m, nil\n}\n\nfunc main() {\n    h := Hello{greeting: \"hello\"}\n    b := Bye{helloSaid: h, byesaid: h}\n    serialized, err := b.Serialize()\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(serialized)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1546447633, "post_id": 54009997, "comment_id": 94856875, "body": "This is far from a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. What exactly is the goal here?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1546447810, "post_id": 54009997, "comment_id": 94856984, "body": "If your goal is just to generate the json you don&#39;t need all the struct definitions, just use simple maps and slices."}, {"owner": {"reputation": 81, "user_id": 7938282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bee0e58b5ae35f9c27531c6053a6805?s=128&d=identicon&r=PG&f=1", "display_name": "Chakrapani Velugubantla", "link": "https://stackoverflow.com/users/7938282/chakrapani-velugubantla"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1546448694, "post_id": 54009997, "comment_id": 94857399, "body": "my goal is to normalize data and trying to do a key value pair combo for each field ..i have tried maps and slices..but haven&#39;t had much success generating key value pair..trying to do it Object oriented way,,not sure if its the write path considering go is not so object oriented and static typed language"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1546449102, "post_id": 54009997, "comment_id": 94857578, "body": "It&#39;s still not clear what the actual problem is. Your values are all strings, and maps and slices can cover all possible json structures. Is the problem with the nested `if&#39; statements? You don&#39;t need &quot;OOP&quot; to walk a tree and assign string values."}, {"owner": {"reputation": 81, "user_id": 7938282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bee0e58b5ae35f9c27531c6053a6805?s=128&d=identicon&r=PG&f=1", "display_name": "Chakrapani Velugubantla", "link": "https://stackoverflow.com/users/7938282/chakrapani-velugubantla"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1546451667, "post_id": 54009997, "comment_id": 94858607, "body": "yep..its with If statements..wondering since its a recursive..if there is a better way to do it"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1546452301, "post_id": 54009997, "comment_id": 94858880, "body": "Normally one handles recursion with a recursive function."}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 7938282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bee0e58b5ae35f9c27531c6053a6805?s=128&d=identicon&r=PG&f=1", "display_name": "Chakrapani Velugubantla", "link": "https://stackoverflow.com/users/7938282/chakrapani-velugubantla"}, "edited": false, "score": 0, "creation_date": 1546469007, "post_id": 54011267, "comment_id": 94865408, "body": "this definitely helps..long story short..we r having data modelling issues..and need some normalisation done to present the data in key value pairs for presentation layer"}], "tags": [], "owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "is_accepted": true, "score": 0, "last_activity_date": 1546453228, "creation_date": 1546453228, "answer_id": 54011267, "question_id": 54009997, "link": "https://stackoverflow.com/questions/54009997/dynamic-data-struct-nested-json-with-dependency-conditionals-in-go/54011267#54011267", "title": "dynamic data struct (nested json ) with dependency conditionals in go", "body": "<p>I don't know exactly what you are trying to achive, I ran your application, and you are building a tree from the flat structure. Why and what your original plan was is not clear. </p>\n\n<p>Yet, your application's ever growing <code>if</code> tree is always doing the same with the last appended RootElem and can be written as follows. As you can see, your if structure is now independent from <code>NumField()</code></p>\n\n<pre><code>    var appendHere *RootElem\n\n    for i := 0; i &lt; reflect.ValueOf(elment).NumField(); i++ {\n\n        [ ... stuff deleted ... ]\n\n        if finalElem.RDisplay == \"\" {\n            finalElem = newData\n            appendHere = &amp;finalElem\n        } else {\n            appendHere.RData = append(appendHere.RData, newData)\n            appendHere = &amp;(appendHere.RData[0])\n        }\n\n    }\n\n    fmt.Println(\"final element\", finalElem)\n}\n</code></pre>\n\n<p>Would have written this as comment, but the answer is too large for comments.</p>\n"}], "owner": {"reputation": 81, "user_id": 7938282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bee0e58b5ae35f9c27531c6053a6805?s=128&d=identicon&r=PG&f=1", "display_name": "Chakrapani Velugubantla", "link": "https://stackoverflow.com/users/7938282/chakrapani-velugubantla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "closed_date": 1546506636, "accepted_answer_id": 54011267, "answer_count": 1, "score": -2, "last_activity_date": 1546453228, "creation_date": 1546447235, "last_edit_date": 1546449665, "question_id": 54009997, "link": "https://stackoverflow.com/questions/54009997/dynamic-data-struct-nested-json-with-dependency-conditionals-in-go", "closed_reason": "Not suitable for this site", "title": "dynamic data struct (nested json ) with dependency conditionals in go", "body": "<p>I'm trying to create dynamically nested json in go. i understand that go is static type and there are various ways to create dynamic objects(interfaces) and wondering if there is a way to tackle my dependency mapping in nested json </p>\n\n<p>sample json</p>\n\n<pre><code> [\n{\n  \"display\" : \"Environment\" ,\n  \"field\" : \"test_env\" ,\n  \"value\" : {\n  \"display\" : \"staging\",\n  \"value\" : \"s\"\n},\n   \"type\" : \"drop-down\" ,\n   \"data\" : [\n    {\n      \"display\" : \"version\" ,\n      \"field\" : \"test_version\" ,\n      \"value\" : {\n       \"display\" : \"1.1.9\" ,\n        \"value\" : \"1.1.9\"\n      },\n      \"type\" : \"drop-down\" ,\n      \"data\" : [\n        {\n          \"display\" : \"DataCenter\" ,\n          \"field\" : \"test_dc\" ,\n          \"value\" : {\n           \"display\" : \"washington\",\n           \"value\" : \"wa\"\n         },\n          \"type\" : \"drop-down\" ,\n         \"data\" : [{\n         \"display\" : \"Secondary\" ,\n         \"field\" : \"test_secondary_dc\" ,\n         \"value\" : {\n             \"display\" : \"miami\" ,\n             \"value\" : \"mi\"\n           },\n            \"type\" : \"drop-down\" ,\n            \"data\" : [{\n              \"display\" : \"Size\" ,\n              \"field\" : \"test_size\" ,\n              \"value\" : {\n                \"display\" : \"small\" ,\n                \"value\" : \"s\"\n                  }\n              }]\n            }]\n        }\n      ]\n     }\n   ]\n },\n {\n  \"display\" : \"Environment\" ,\n  \"field\" : \"test_env\" ,\n  \"value\" : {\n    \"display\" : \"production\",\n    \"value\" : \"p\"\n  },\n  \"type\" : \"drop-down\" ,\n  \"data\" : [\n    {\n      \"display\" : \"version\" ,\n      \"field\" : \"test_version\" ,\n      \"value\" : {\n        \"display\" : \"1.1.9\" ,\n        \"value\" : \"1.1.9\"\n       },\n      \"type\" : \"drop-down\" ,\n      \"data\" : [\n         {\n          \"display\" : \"DataCenter\" ,\n          \"field\" : \"test_dc\" ,\n          \"value\" : {\n            \"display\" : \"miami\",\n            \"value\" : \"mi\"\n          },\n          \"type\" : \"drop-down\" ,\n          \"data\" : [{\n            \"display\" : \"Secondary\" ,\n            \"field\" : \"test_secondary_dc\" ,\n            \"value\" : {\n              \"display\" : \"washington\" ,\n              \"value\" : \"wa\"\n            },\n            \"type\" : \"drop-down\" ,\n            \"data\" : [{\n              \"display\" : \"Size\" ,\n              \"field\" : \"test_size\" ,\n              \"value\" : {\n                \"display\" : \"medium\" ,\n                \"value\" : \"m\"\n             }\n              }]\n            }]\n        }\n      ]\n    }\n  ]\n}\n]\n</code></pre>\n\n<p>sample code :</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n     \"reflect\"\n )\n\n\n    // struct definition ///\n\n   type  RootElem struct {\n        RDisplay string `json:\"display\"`\n        RField string `json:\"field\"`\n        RType string `json:\"type\"`\n        RData RSlice `json:\"data\"`\n        RValue RValue `json:\"value\"`\n        }\n\ntype RValue struct {\n    Display string `json:\"display\"`\n    Evalue string `json:\"value\"`\n    }\n\ntype Vars struct {\n    Env      string `json:\"environment\"`\n    Version  string `json:\"version\"`\n    Zone     string `json:\"zone\"`\n    PDcenter string `json:\"primary_dc\"`\n    SDcenter string `json:\"secondary_dc,omitempty\"`\n    Size     string `json:\"size\"`\n  }\n\ntype RSlice []RootElem\n\nfunc valueFactory(etype, evalue string) string {\n  switch (etype) {\n    case \"ENVIRONMENT\":\n      return environmentValue(evalue);\n    case \"VERSION\":\n      return versionValue(evalue);\n    case \"ZONE\":\n      return zoneValue(evalue);\n    case \"PRIMARYDC\":\n      return primaryValue(evalue);\n    case \"SECONDARYDC\":\n      return secondaryValue(evalue);\n    case \"SIZE\":\n      return sizeValue(evalue);\n    default:\n      return(\"Specifying a type we don't have.\");\n   }\n  }\n\nfunc sizeValue(sz string) string {\n   switch (sz) {\n     case \"Small\":\n      return \"s\"\n     case \"Medium\":\n      return \"m\"\n     case \"Large\" :\n       return \"l\"\n     default:\n       return \"This is not a size environment value\"\n    }\n}\n\n\nfunc environmentValue(env string) string {\n  switch (env) {\n    case \"Production\":\n      return \"p\"\n    case \"staging\":\n      return \"s\"\n    default:\n      return \"This is not a valid environment value\"\n  }\n}\n\nfunc versionValue(ver string) string {\n  switch (ver) {\n     case \"1.1.9\":\n       return \"1.1.9\"\n     default:\n      return \"This is not a valid version value\"\n  }\n }\n\n func zoneValue(zone string) string {\n  switch (zone) {\n    case \"BLACK\":\n     return \"Black\"\n    case \"GREEN\" :\n      return \"Green\"\n   default:\n     return \"This is not a valid zone value\"\n  }\n}\n\n  func primaryValue(pdc string) string {\n  switch (pdc) {\n     case \"washington \":\n       return \"wa\"\n    case \"Miami\" :\n       return \"mi\"\n\n     default:\n       return \"This is not a valid primary data center value\"\n  }\n }\n\n func secondaryValue(sdc string) string {\n  switch (sdc) {\n   case \"washington\":\n     return \"wa\"\n    case \"Miami\" :\n      return \"mi\"\n    default:\n      return \"This is not a valid secondary data center value\"\n }\n}\n\n\nfunc dataGeneric(display, field, etype string) (relm RootElem) {\n relm.RDisplay =  display\n     relm.RField = field\n     relm.RValue.Display =  \"\"\n relm.RValue.Evalue =  \"\"\n     relm.RType = etype\n     return  relm\n }\n\n func dataEnvironment() RootElem {\n   display := \"Environment\"\n   field := \"test_env\"\n   etype := \"dropdown\"\n   return dataGeneric(display, field, etype)\n}\n\nfunc dataVersion() RootElem {\n  display := \"Version\"\n  field := \"test_version\"\n  etype := \"dropdown\"\n  return dataGeneric(display, field, etype)\n }\n\nfunc dataZone() RootElem {\n  display := \"Zone\"\n  field := \"test_zone\"\n  etype := \"dropdown\"\n  return dataGeneric(display, field, etype)\n}\n\nfunc dataPrimary() RootElem {\n display := \"Primary Data Center\"\n field := \"test_dc\"\n etype := \"dropdown\"\n return dataGeneric(display, field, etype)\n}\n\nfunc dataSecondary() RootElem {\n  display := \"Secondary Data Center\"\n  field := \"test_secondary_dc\"\n  etype := \"dropdown\"\n  return dataGeneric(display, field, etype)\n}\n\nfunc dataSize() RootElem {\n  display := \"size\"\n  field := \"test_size\"\n  etype := \"dropdown\"\n   return dataGeneric(display, field, etype)\n}\n\n\nfunc dataFactory(etype string) RootElem {\n\n var rem RootElem\n  switch (etype) {\n     case \"ENVIRONMENT\":\n      return dataEnvironment()\n    case \"VERSION\":\n      return dataVersion()\n    case \"ZONE\":\n      return dataZone()\n    case \"PRIMARYDC\":\n      return dataPrimary()\n    case \"SECONDARYDC\":\n      return dataSecondary()\n    case \"SIZE\":\n      return dataSize()\n  }\n   return rem\n}\n\n\n\n\nfunc main() {\n\n // sample element ///\nvar elment = Vars{\n    Env: \"Production\" ,\n    Version: \"1.1.9\" ,\n    Zone: \"GREEN\" ,\n    PDcenter: \"Washington\" ,\n    SDcenter: \"Miami\" ,\n    Size: \"Small\" ,\n    }\n\n\nvar Dict = []string{\"ENVIRONMENT\" , \"VERSION\" , \"ZONE\" , \"PRIMARYDC\" , \"SECONDARYDC\" , \"SIZE\" }\n\n\nvar newData, finalElem RootElem\nfor i := 0 ; i &lt; reflect.ValueOf(elment).NumField() ; i++ {\n    currentElement := reflect.ValueOf(elment).Field(i).Interface()\n    currentElemType := Dict[i]\n\n    newData = dataFactory(currentElemType)\n    newData.RValue.Display = currentElement.(string)\n    newData.RValue.Evalue = valueFactory(currentElemType, currentElement.(string))\n\n    if finalElem.RDisplay == \"\" {\n        finalElem = newData\n    } else {\n            if len(finalElem.RData) == 0 {\n         finalElem.RData = append(finalElem.RData, newData)\n            } else {\n                if len(finalElem.RData[0].RData) == 0 {\n                 finalElem.RData[0].RData = append( finalElem.RData[0].RData , newData)\n                } else {\n                    if len(finalElem.RData[0].RData[0].RData) == 0 {\n                    finalElem.RData[0].RData[0].RData = append (finalElem.RData[0].RData[0].RData , newData)\n                    } else {\n                        if len(finalElem.RData[0].RData[0].RData[0].RData) == 0 {\n                        finalElem.RData[0].RData[0].RData[0].RData = append(finalElem.RData[0].RData[0].RData[0].RData, newData )\n                        } else {\n                            finalElem.RData[0].RData[0].RData[0].RData[0].RData = append(finalElem.RData[0].RData[0].RData[0].RData[0].RData, newData)\n                            }\n                        }\n                    }\n                }\n        }\n}\n\n fmt.Println(\"final element\" , finalElem)\n\n}\n</code></pre>\n\n<p>wondering if there is a way to write a recursive function for creating dynamic nested json in go?</p>\n\n<p>thanks</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546443943, "post_id": 54009188, "comment_id": 94855021, "body": "Collect your flag args into a slice, e.g. <code>params := []interface{}{target, method}</code> or use <code>[]string</code> if they&#39;re all <code>string</code>s, and then call <code>foo(params...)</code>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1546443983, "post_id": 54009188, "comment_id": 94855046, "body": "I don&#39;t understand what you&#39;re trying to combine. Variadic functions are pretty straight forward: They work as the last argument to a function, and must be of the same type."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546444106, "post_id": 54009188, "comment_id": 94855113, "body": "Combine them in what way? What are you actually trying to do here? Without any idea what you&#39;re trying to achieve the answer is basically &quot;yes, by using them both to do whatever it is you&#39;re trying to do&quot;."}, {"owner": {"reputation": 87, "user_id": 10765021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ced873201945cfa92e484c00e0459f4?s=128&d=identicon&r=PG&f=1", "display_name": "toti toto", "link": "https://stackoverflow.com/users/10765021/toti-toto"}, "edited": false, "score": 0, "creation_date": 1546444212, "post_id": 54009188, "comment_id": 94855161, "body": "As in - I want to take the flag arguments and pass only the ones provided by the user to a different function."}, {"owner": {"reputation": 87, "user_id": 10765021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ced873201945cfa92e484c00e0459f4?s=128&d=identicon&r=PG&f=1", "display_name": "toti toto", "link": "https://stackoverflow.com/users/10765021/toti-toto"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546444327, "post_id": 54009188, "comment_id": 94855214, "body": "@mkopriva - in your example, what if the user isn&#39;t providing , lets say, the target parameter? the default will be sent instead"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1546444606, "post_id": 54009188, "comment_id": 94855374, "body": "If your goal is optional positional arguments, a better approach is to accept a struct as your function&#39;s argument, and allow unset fields."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546444615, "post_id": 54009188, "comment_id": 94855379, "body": "then use the default value, or don&#39;t use anything, it&#39;s up to you, say you don&#39;t want to pass in target if it&#39;s empty in such a case you can conditionally append or not append the desired arg. This way, however, <code>foo</code> won&#39;t know whether the single arg that&#39;s passed in is target or method and if that&#39;s an issue for you you need to rethink your desing. E.g. passing in a single struct whose fields are all the possible args."}, {"owner": {"reputation": 87, "user_id": 10765021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ced873201945cfa92e484c00e0459f4?s=128&d=identicon&r=PG&f=1", "display_name": "toti toto", "link": "https://stackoverflow.com/users/10765021/toti-toto"}, "edited": false, "score": 0, "creation_date": 1546445233, "post_id": 54009188, "comment_id": 94855739, "body": "What would unset fields change if default flag parameters will be sent anyway?"}, {"owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "edited": false, "score": 0, "creation_date": 1546447022, "post_id": 54009188, "comment_id": 94856576, "body": "The question is formulated understandable and after the rules. Even if the author does obviously not understand what variadic arguments are for, he provides proper sample code. I don&#39;t think the downvotes are justified."}], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 10765021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ced873201945cfa92e484c00e0459f4?s=128&d=identicon&r=PG&f=1", "display_name": "toti toto", "link": "https://stackoverflow.com/users/10765021/toti-toto"}, "edited": false, "score": 0, "creation_date": 1546501897, "post_id": 54010360, "comment_id": 94872771, "body": "Thanks man, this helps me alot. edit for future viewers: you have a missing closing bracelet for theRealStuff func, and parseCommandline with a small l in your main."}, {"owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "reply_to_user": {"reputation": 87, "user_id": 10765021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ced873201945cfa92e484c00e0459f4?s=128&d=identicon&r=PG&f=1", "display_name": "toti toto", "link": "https://stackoverflow.com/users/10765021/toti-toto"}, "edited": false, "score": 0, "creation_date": 1546516874, "post_id": 54010360, "comment_id": 94879681, "body": "No problem. I have corrected the code in the sample."}], "tags": [], "owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "is_accepted": true, "score": 1, "last_activity_date": 1546502032, "last_edit_date": 1546502032, "creation_date": 1546448730, "answer_id": 54010360, "question_id": 54009188, "link": "https://stackoverflow.com/questions/54009188/is-it-possible-to-combine-variadic-args-with-flag-package-usage/54010360#54010360", "title": "Is it possible to combine variadic args with flag package usage?", "body": "<p>Your question shows a misunderstanding, what variadic arguments are for. </p>\n\n<p>As you realized, variadics are used, when the amount of arguments to a function varies. You try to use this concept to hand over parsed commandline arguments of a variable amount. This is a bad idea in many ways. The obvious here is, that you are coupling your commandline arguments with the distribution of the flags and arguments in your code. Another is, that the variadic arguments loose the positional information. How do you expect to identify which 4 of the 5 arguments you have received?</p>\n\n<p>You should define a struct to hold the flags for your code and write a commandline parser, that fills or creates this struct from defaults and given commandline options. \nThis struct is then used to provide the flags and options throughout your application. </p>\n\n<p>In practice, this could look like this:</p>\n\n<pre><code>type options struct {\n    target string\n    method string\n}\n\n\nfunc main() {\n    config := parseCommandLine()\n    theRealStuffHappensHere(config)\n}\n\nfunc theRealStuffHappensHere(config options) {\n    if config.method == \"GET\" {\n    // ...\n    }\n}\n\nfunc parseCommandLine() options {\n    var config options\n    flag.StringVar(&amp;(config.target), \"target\", \"http://google.com/robotstxt\", \"Target address\")\n    flag.StringVar(&amp;(config.method), \"method\", \"GET\", \"Method\")\n    flag.Parse()\n\n    return config\n}\n</code></pre>\n\n<p>The variadic arguments are heavily used in the <code>fmt</code> package, where the amount of required arguments depends on the amount of placeholders in the format string. Your usecase does not match.</p>\n"}], "owner": {"reputation": 87, "user_id": 10765021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ced873201945cfa92e484c00e0459f4?s=128&d=identicon&r=PG&f=1", "display_name": "toti toto", "link": "https://stackoverflow.com/users/10765021/toti-toto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "closed_date": 1546499798, "accepted_answer_id": 54010360, "answer_count": 1, "score": 0, "last_activity_date": 1546502032, "creation_date": 1546443818, "last_edit_date": 1546443891, "question_id": 54009188, "link": "https://stackoverflow.com/questions/54009188/is-it-possible-to-combine-variadic-args-with-flag-package-usage", "closed_reason": "Needs details or clarity", "title": "Is it possible to combine variadic args with flag package usage?", "body": "<p>I want my function to take optional arguments in an efficent way.</p>\n\n<p>Reading similar posts led me to variadic args and I'm trying to implement it alongside the flag package (simply looking for any alternative to the users being able to run available command line flags of their choice..\nThis is my flag package usage:</p>\n\n<pre><code>func main() {\n    var target string\n    var method string\n    flag.StringVar(&amp;target, \"target\", \"http://google.com/robots.txt\", \"Target address\")\n    flag.StringVar(&amp;method, \"method\", \"GET\", \"Method\")\n    flag.Parse()\n\n    requests.MakeRequest(target, method)\n}\n</code></pre>\n\n<p>This is an example of variadic args function:</p>\n\n<pre><code>func foo(params ...int) {\n    fmt.Println(len(params))\n}\n\nfunc main() {\n    foo()\n    foo(1)\n    foo(1, 2, 3)\n}\n</code></pre>\n\n<p>Can I combine the two?\nIf this is not possible - how can I pass main program's user given arguments to a variadic function then?</p>\n"}, {"tags": ["go", "github-api"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546441032, "post_id": 54008483, "comment_id": 94853511, "body": "Are you certain your <code>github.IssuesURL</code> value is pointing to the right endpoint? From the example code we can&#39;t tell if it has the correct value."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1546441192, "post_id": 54008483, "comment_id": 94853611, "body": "Before sending the request try using <a href=\"https://golang.org/pkg/net/http/httputil/#DumpRequestOut\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/httputil/#DumpRequestOut</a> to confirm that everything is as it should be. (don&#39;t forget to pass in true as the second argument to see the body as well)"}, {"owner": {"reputation": 25, "user_id": 3982629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ef055dfafc7cda3960a905be54f723b?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Pogson", "link": "https://stackoverflow.com/users/3982629/richard-pogson"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546441253, "post_id": 54008483, "comment_id": 94853649, "body": "const IssuesURL = &quot;<a href=\"https://api.github.com/repos/:owner/:repo/issues\" rel=\"nofollow noreferrer\">api.github.com/repos/:owner/:repo/issues</a>&quot;  substituting owner and repo appropriately."}, {"owner": {"reputation": 25, "user_id": 3982629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ef055dfafc7cda3960a905be54f723b?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Pogson", "link": "https://stackoverflow.com/users/3982629/richard-pogson"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546441567, "post_id": 54008483, "comment_id": 94853827, "body": "POST /search/issues HTTP/1.1 Host: api.github.com Authorization: token MYTOKEN Content-Type: application/json  {&quot;title&quot;:&quot;Hello World&quot;,&quot;body&quot;:&quot;dsddsd \\n&quot;}"}, {"owner": {"reputation": 25, "user_id": 3982629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ef055dfafc7cda3960a905be54f723b?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Pogson", "link": "https://stackoverflow.com/users/3982629/richard-pogson"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1546441608, "post_id": 54008483, "comment_id": 94853850, "body": "Looks like the endpoint is wrong thank you for the hint about DumpRequest"}, {"owner": {"reputation": 25, "user_id": 3982629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ef055dfafc7cda3960a905be54f723b?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Pogson", "link": "https://stackoverflow.com/users/3982629/richard-pogson"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546441646, "post_id": 54008483, "comment_id": 94853871, "body": "No idea how that is happening there is literally only one url in the entire app but I will track it down."}, {"owner": {"reputation": 25, "user_id": 3982629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ef055dfafc7cda3960a905be54f723b?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Pogson", "link": "https://stackoverflow.com/users/3982629/richard-pogson"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546441960, "post_id": 54008483, "comment_id": 94854014, "body": "@mkopriva Do you want to post an answer with the DumpRequest hint so I can mark it as the answer.  Hints to me in real life.  Don&#39;t create projects called github and leave them compiled in the src directory.   The URL was being pulled from that go package not the existing one"}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 3982629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ef055dfafc7cda3960a905be54f723b?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Pogson", "link": "https://stackoverflow.com/users/3982629/richard-pogson"}, "edited": false, "score": 1, "creation_date": 1546442549, "post_id": 54008823, "comment_id": 94854300, "body": "Using the DumpRequestOut method above was able to determine the URL being called was incorrect.  The code uses github.IssuesURL, which is in fact a separate package previously written and left in my src directory.  Removing the github. solves the issue.  Many thanks."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1546442295, "creation_date": 1546442295, "answer_id": 54008823, "question_id": 54008483, "link": "https://stackoverflow.com/questions/54008483/unexpected-error-response-from-github-api-422-when-attempting-to-create-issue/54008823#54008823", "title": "Unexpected error response from GitHub API 422 when attempting to create issue", "body": "<p>The response is a strong indicator that the request is being sent to the wrong endpoint.</p>\n\n<p>You can use <code>net/http/httputil</code>'s <a href=\"https://golang.org/pkg/net/http/httputil/#DumpRequestOut\" rel=\"nofollow noreferrer\">DumpRequestOut</a> to inspect the requests you are about to send and to ensure that they are what you expect them to be.</p>\n"}], "owner": {"reputation": 25, "user_id": 3982629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ef055dfafc7cda3960a905be54f723b?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Pogson", "link": "https://stackoverflow.com/users/3982629/richard-pogson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2723, "favorite_count": 0, "accepted_answer_id": 54008823, "answer_count": 1, "score": 2, "last_activity_date": 1546442295, "creation_date": 1546440915, "question_id": 54008483, "link": "https://stackoverflow.com/questions/54008483/unexpected-error-response-from-github-api-422-when-attempting-to-create-issue", "title": "Unexpected error response from GitHub API 422 when attempting to create issue", "body": "<p>When posting an issue to GitHub API V3 I am getting an unexpected response. Namely 422 Unprocessable Entity. However the detail of the error is for the Search endpoint rather that the POST create endpoint.\n{\"message\":\"Validation Failed\",\"errors\":[{\"resource\":\"Search\",\"field\":\"q\",\"code\":\"missing\"}],\"documentation_url\":\"<a href=\"https://developer.github.com/v3/search\" rel=\"nofollow noreferrer\">https://developer.github.com/v3/search</a>\"}</p>\n\n<p>My instinct is that I have messed up the json but it is pretty simple and I can't see the issue.\nI have tried various solutions posted here and elsewhere but not found what I am doing wrong. This is a coding exercise rather than anything intended for production but driving me mildly insane. </p>\n\n<ul>\n<li>Tested in Debug what the Request body is just before being posted.\n{\"title\":\"Hello World\",\"body\":\"dfsdfsdf\\n\"}</li>\n<li>Tried removing the body as it is optional, same issue.</li>\n<li>Tested in Debug that request is of type POST</li>\n<li>Tested in Debug that authorization header is correct.</li>\n<li>Removed authorization key and received 401 as expected.</li>\n</ul>\n\n<p>The posting function:</p>\n\n<pre><code>func CreateIssue (issue *NewIssue) (*IssueDetailsResult, error){\nissueJson, err := json.Marshal(issue)\nif err != nil {\n    log.Fatal(err)\n    os.Exit(1)\n}\nreq, err := http.NewRequest(\"POST\", github.IssuesURL, bytes.NewBuffer(issueJson))\nreq.Header.Set(\"Authorization\", \"token \"+os.Getenv(\"UPGITUSER\"))\nreq.Header.Set( \"Content-Type\", \"application/json\")\nclient := &amp;http.Client{}\nresp, err := client.Do(req)\nif err != nil {\n    log.Fatal(err)\n    os.Exit(1)\n}\nif resp.StatusCode != http.StatusCreated {\n    bodyBytes, _ := ioutil.ReadAll(resp.Body)\n    body := string(bodyBytes)\n    resp.Body.Close()\n    return nil, fmt.Errorf(\"create issue failed:%s\", resp.Status + \"\\ntext: \" + body)\n}\nvar result IssueDetailsResult\nif err := json.NewDecoder(resp.Body).Decode(&amp;result); err != nil {\n    resp.Body.Close()\n    return nil, err\n}\nresp.Body.Close()\nreturn &amp;result, nil\n</code></pre>\n\n<p>}</p>\n\n<p>Would expect 201 from GitHubAPI.</p>\n"}, {"tags": ["go", "testcontainers"], "answers": [{"tags": [], "owner": {"reputation": 762, "user_id": 3052074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/619c2a3b094423dd741dc8eb161836f0?s=128&d=identicon&r=PG", "display_name": "Andrey Dyatlov", "link": "https://stackoverflow.com/users/3052074/andrey-dyatlov"}, "is_accepted": true, "score": 0, "last_activity_date": 1546443263, "last_edit_date": 1546443263, "creation_date": 1546442836, "answer_id": 54008959, "question_id": 54007888, "link": "https://stackoverflow.com/questions/54007888/go-get-problem-when-using-testcontainer-go/54008959#54008959", "title": "Go get problem when using testcontainer-go", "body": "<p>I reproduced the problem as well, but I did manage to build and run the test with the following steps:</p>\n\n<ol>\n<li>Create a <code>my_package</code> directory outside of the <code>$GOPATH</code> tree.</li>\n<li><p>Create a <code>mypackage_test.go</code> file with the following content:</p>\n\n<pre><code>package main\n\nimport (\n    \"testing\"\n\n    testcontainer \"github.com/testcontainers/testcontainer-go\"\n)\n\nfunc testNginxLatestReturn(t *testing.T) {\n    req := testcontainer.ContainerRequest{\n        Image:        \"nginx\",\n        ExposedPorts: []string{\"80/tcp\"},\n    }\n    t.Log(req)\n}\n</code></pre></li>\n<li><p><code>go mod init mypackage</code></p></li>\n<li><code>go test</code></li>\n</ol>\n"}], "owner": {"reputation": 8621, "user_id": 5247292, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/fQKn3.png?s=128&g=1", "display_name": "guenhter", "link": "https://stackoverflow.com/users/5247292/guenhter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 307, "favorite_count": 0, "accepted_answer_id": 54008959, "answer_count": 1, "score": 0, "last_activity_date": 1546504900, "creation_date": 1546438447, "last_edit_date": 1546504900, "question_id": 54007888, "link": "https://stackoverflow.com/questions/54007888/go-get-problem-when-using-testcontainer-go", "title": "Go get problem when using testcontainer-go", "body": "<p>I was trying out the sample of the page <a href=\"https://github.com/testcontainers/testcontainer-go\" rel=\"nofollow noreferrer\">https://github.com/testcontainers/testcontainer-go</a></p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"net/http\"\n    \"testing\"\n\n    testcontainer \"github.com/testcontainers/testcontainer-go\"\n)\n\nfunc TestNginxLatestReturn(t *testing.T) {\n    ctx := context.Background()\n    req := testcontainer.ContainerRequest{\n        Image:        \"nginx\",\n        ExposedPorts: []string{\"80/tcp\"},\n    }\n...\n}\n</code></pre>\n\n<p>but when I put the code in the file <code>main.go</code> under <code>&lt;home&gt;/go/src/my-sample</code> and call <code>go get</code>, I just get this error:</p>\n\n<p>#</p>\n\n<pre><code> github.com/testcontainers/testcontainer-go\n../github.com/testcontainers/testcontainer-go/docker.go:116:32: cannot use inspect.NetworkSettings.NetworkSettingsBase.Ports (type \"github.com/docker/docker/vendor/github.com/docker/go-connections/nat\".PortMap) as type \"github.com/docker/go-connections/nat\".PortMap in return argument\n../github.com/testcontainers/testcontainer-go/docker.go:197:25: multiple-value uuid.NewV4() in single-value context\n../github.com/testcontainers/testcontainer-go/docker.go:219:3: cannot use exposedPortSet (type map[\"github.com/docker/go-connections/nat\".Port]struct {}) as type \"github.com/docker/docker/vendor/github.com/docker/go-connections/nat\".PortSet in field value\n../github.com/testcontainers/testcontainer-go/docker.go:261:3: cannot use exposedPortMap (type map[\"github.com/docker/go-connections/nat\".Port][]\"github.com/docker/go-connections/nat\".PortBinding) as type \"github.com/docker/docker/vendor/github.com/docker/go-connections/nat\".PortMap in field value\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3395, "user_id": 10409167, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blZR5.jpg?s=128&g=1", "display_name": "Arcteezy", "link": "https://stackoverflow.com/users/10409167/arcteezy"}, "edited": false, "score": 1, "creation_date": 1546437440, "post_id": 54007605, "comment_id": 94851815, "body": "Missed a double quote in your original code too?"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 10854905, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VZMY0wotnsE/AAAAAAAAAAI/AAAAAAAAACg/ZVXXbEDHvxc/photo.jpg?sz=128", "display_name": "Nivas", "link": "https://stackoverflow.com/users/10854905/nivas"}, "edited": false, "score": 0, "creation_date": 1546438201, "post_id": 54007660, "comment_id": 94852180, "body": "Sorry, I made the error while typing in Question body Its good in my text editor"}, {"owner": {"reputation": 4095, "user_id": 3957200, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/25mzd.jpg?s=128&g=1", "display_name": "Cinder Biscuits", "link": "https://stackoverflow.com/users/3957200/cinder-biscuits"}, "reply_to_user": {"reputation": 1, "user_id": 10854905, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VZMY0wotnsE/AAAAAAAAAAI/AAAAAAAAACg/ZVXXbEDHvxc/photo.jpg?sz=128", "display_name": "Nivas", "link": "https://stackoverflow.com/users/10854905/nivas"}, "edited": false, "score": 0, "creation_date": 1546466456, "post_id": 54007660, "comment_id": 94864524, "body": "@Nivas Please edit your question if you made an error in it to reflect the correct code."}], "tags": [], "owner": {"reputation": 1443, "user_id": 10825793, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-RxdudnRQ6cE/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZmLE-tQOfT0g5zw8mRrTShwSWWHg/mo/photo.jpg?sz=128", "display_name": "Laurens Deprost", "link": "https://stackoverflow.com/users/10825793/laurens-deprost"}, "is_accepted": false, "score": 0, "last_activity_date": 1546437581, "creation_date": 1546437581, "answer_id": 54007660, "question_id": 54007605, "link": "https://stackoverflow.com/questions/54007605/clearing-buffer-in-go/54007660#54007660", "title": "Clearing Buffer in Go", "body": "<p>I think you made a typo:  </p>\n\n<pre><code>fmt.Println(\"Enter B: ) \n\nfmt.Println(\"Enter B: \")\n</code></pre>\n\n<p>Notice the difference?</p>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 10854905, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VZMY0wotnsE/AAAAAAAAAAI/AAAAAAAAACg/ZVXXbEDHvxc/photo.jpg?sz=128", "display_name": "Nivas", "link": "https://stackoverflow.com/users/10854905/nivas"}, "edited": false, "score": 0, "creation_date": 1546438338, "post_id": 54007709, "comment_id": 94852243, "body": "Thanks for your help, i will note that suggestion for String"}], "tags": [], "owner": {"reputation": 3395, "user_id": 10409167, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blZR5.jpg?s=128&g=1", "display_name": "Arcteezy", "link": "https://stackoverflow.com/users/10409167/arcteezy"}, "is_accepted": false, "score": 0, "last_activity_date": 1546441665, "last_edit_date": 1546441665, "creation_date": 1546437747, "answer_id": 54007709, "question_id": 54007605, "link": "https://stackoverflow.com/questions/54007605/clearing-buffer-in-go/54007709#54007709", "title": "Clearing Buffer in Go", "body": "<p>Use scan instead of scanf since you are trying to take int,</p>\n\n<pre><code>    var a, b int    \n    fmt.Println(\"Enter A: \")\n    fmt.Scan(&amp;a)\n    fmt.Println(\"Enter B: \")\n    fmt.Scan(&amp;b)\n</code></pre>\n\n<p>If you want a string input,</p>\n\n<pre><code>    reader := bufio.NewReader(os.Stdin)\n    var a,b string\n    fmt.Println(\"Enter A: \")\n    a, _ := reader.ReadString(\"\\n\")\n    fmt.Println(\"Enter B: \")\n    b, _ := reader.ReadString(\"\\n\")\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10854905, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VZMY0wotnsE/AAAAAAAAAAI/AAAAAAAAACg/ZVXXbEDHvxc/photo.jpg?sz=128", "display_name": "Nivas", "link": "https://stackoverflow.com/users/10854905/nivas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 107, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1546441665, "creation_date": 1546437355, "question_id": 54007605, "link": "https://stackoverflow.com/questions/54007605/clearing-buffer-in-go", "title": "Clearing Buffer in Go", "body": "<p>I'm new to Golang and while I'm trying to get consecutive input, The first scanf() gets the input and the remaining scanf() are omitted</p>\n\n<p>Eg:</p>\n\n<pre><code> fmt.Println(\"Enter A: \")\n  fmt.Scanf(\"%d\",a)\n  fmt.Println(\"Enter B: )\n  fmt.Scanf(\"%d\",b)\n</code></pre>\n\n<p>In this, the first Scanf works while the second one doesn't get any input</p>\n"}, {"tags": ["go", "liteide"], "comments": [{"owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "edited": false, "score": 1, "creation_date": 1546432579, "post_id": 54006504, "comment_id": 94849447, "body": "did you restart the server after changes?"}, {"owner": {"reputation": 129, "user_id": 8049659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d80e2c967ad7a3887ec441485056cf8?s=128&d=identicon&r=PG&f=1", "display_name": "user8049659", "link": "https://stackoverflow.com/users/8049659/user8049659"}, "reply_to_user": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "edited": false, "score": 0, "creation_date": 1546432630, "post_id": 54006504, "comment_id": 94849477, "body": "I restarted a program, but how to restart a server? And I run it from IDE."}, {"owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "edited": false, "score": 0, "creation_date": 1546432753, "post_id": 54006504, "comment_id": 94849542, "body": "which one IDE are you  using ?"}, {"owner": {"reputation": 129, "user_id": 8049659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d80e2c967ad7a3887ec441485056cf8?s=128&d=identicon&r=PG&f=1", "display_name": "user8049659", "link": "https://stackoverflow.com/users/8049659/user8049659"}, "reply_to_user": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "edited": false, "score": 0, "creation_date": 1546432861, "post_id": 54006504, "comment_id": 94849603, "body": "@saddam I&#39;m using LiteIDE and I run the file via Alt+F6"}, {"owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "edited": false, "score": 0, "creation_date": 1546433055, "post_id": 54006504, "comment_id": 94849701, "body": "@r\u0251\u02d0d\u0292\u0251 updated an answer, follow that."}, {"owner": {"reputation": 129, "user_id": 8049659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d80e2c967ad7a3887ec441485056cf8?s=128&d=identicon&r=PG&f=1", "display_name": "user8049659", "link": "https://stackoverflow.com/users/8049659/user8049659"}, "reply_to_user": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "edited": false, "score": 0, "creation_date": 1546434082, "post_id": 54006504, "comment_id": 94850215, "body": "@saddam seems it doesn&#39;t work"}, {"owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "edited": false, "score": 0, "creation_date": 1546434086, "post_id": 54006504, "comment_id": 94850218, "body": "The answer of @dan-esparza is likely to be correct, you can check this question to see how to debug if the browser used cache or not in chrome: <a href=\"https://stackoverflow.com/questions/13140318/check-whether-network-response-is-coming-from-server-or-chrome-cache\" title=\"check whether network response is coming from server or chrome cache\">stackoverflow.com/questions/13140318/&hellip;</a>"}, {"owner": {"reputation": 129, "user_id": 8049659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d80e2c967ad7a3887ec441485056cf8?s=128&d=identicon&r=PG&f=1", "display_name": "user8049659", "link": "https://stackoverflow.com/users/8049659/user8049659"}, "reply_to_user": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "edited": false, "score": 0, "creation_date": 1546434844, "post_id": 54006504, "comment_id": 94850555, "body": "@thst disabling a browser cache does not solve the issue, but I was able to run it with different port adress, but againe if I want to change the output even with the new port adress the response does not change."}, {"owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "edited": false, "score": 0, "creation_date": 1546435308, "post_id": 54006504, "comment_id": 94850762, "body": "@user8049659 there would be a refresh icon on IDE which will restart the server, try it."}, {"owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "edited": false, "score": 0, "creation_date": 1546436207, "post_id": 54006504, "comment_id": 94851224, "body": "@user8049659 I tried your code and it works for me in goland. Add a line <code>log.Print(&quot;received call&quot;)</code> in your <code>sroot</code> func. This will tell you if there is a cache issue or something other."}, {"owner": {"reputation": 129, "user_id": 8049659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d80e2c967ad7a3887ec441485056cf8?s=128&d=identicon&r=PG&f=1", "display_name": "user8049659", "link": "https://stackoverflow.com/users/8049659/user8049659"}, "reply_to_user": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "edited": false, "score": 0, "creation_date": 1546436647, "post_id": 54006504, "comment_id": 94851433, "body": "@thst Added it before fmt.Fprintf... restarted, then changed response and again restarted - nothing changed"}, {"owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "edited": false, "score": 0, "creation_date": 1546436742, "post_id": 54006504, "comment_id": 94851477, "body": "You should see the log message for each request. like this <code>2019&#47;01&#47;02 14:39:05 received call</code>"}], "answers": [{"comments": [{"owner": {"reputation": 129, "user_id": 8049659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d80e2c967ad7a3887ec441485056cf8?s=128&d=identicon&r=PG&f=1", "display_name": "user8049659", "link": "https://stackoverflow.com/users/8049659/user8049659"}, "edited": false, "score": 0, "creation_date": 1546433850, "post_id": 54006589, "comment_id": 94850105, "body": "Installed it, created folder in <code>src</code> named <code>webserver</code> and there is a main file, so then I call it <code>gin run webserver.go</code> it shows me <code>[gin] Listening on port 3000  [gin] Building...  [gin] \u2190[97;32;1mBuild finished\u2190[0m</code> but the browser output is the same as was before even after reloading the browser tab."}], "tags": [], "owner": {"reputation": 4179, "user_id": 1293013, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/9oztA.jpg?s=128&g=1", "display_name": "r\u0251\u02d0d\u0292\u0251", "link": "https://stackoverflow.com/users/1293013/r%c9%91%cb%90d%ca%92%c9%91"}, "is_accepted": false, "score": 0, "last_activity_date": 1546432885, "creation_date": 1546432885, "answer_id": 54006589, "question_id": 54006504, "link": "https://stackoverflow.com/questions/54006504/browser-shows-previous-response/54006589#54006589", "title": "Browser shows previous response", "body": "<p>You can use <code>gin</code> to reload your webserver. </p>\n\n<p>Installation: <code>go get github.com/codegangsta/gin</code></p>\n\n<p>Usage: <code>gin run filename.go</code></p>\n\n<p>Reference: <a href=\"https://github.com/codegangsta/gin\" rel=\"nofollow noreferrer\">https://github.com/codegangsta/gin</a></p>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546441864, "post_id": 54006590, "comment_id": 94853967, "body": "ETag doesn&#39;t work like that. The browser doesn&#39;t know if the ETag has changed until it makes another request, which will include If-None-Match if the ETag is known. The <i>server</i> then gets to decide if it returns 304 Not Modified or new content. Also cacheability is controlled by Cache-Control and Expires."}], "tags": [], "owner": {"reputation": 26894, "user_id": 19020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/VpVEj.jpg?s=128&g=1", "display_name": "Dan Esparza", "link": "https://stackoverflow.com/users/19020/dan-esparza"}, "is_accepted": false, "score": 2, "last_activity_date": 1546432885, "creation_date": 1546432885, "answer_id": 54006590, "question_id": 54006504, "link": "https://stackoverflow.com/questions/54006504/browser-shows-previous-response/54006590#54006590", "title": "Browser shows previous response", "body": "<p>By default the browser makes a <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/GET\" rel=\"nofollow noreferrer\"><code>GET</code></a> request when navigating to the page.  The browser is also going to make some decisions about the 'cachability' of the page:  Has the url changed?  Has the querystring changed?  Has the <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/ETag\" rel=\"nofollow noreferrer\">ETAG</a> changed?  If none of these are true, the browser is most likely serving a cached version of the page.  </p>\n"}], "owner": {"reputation": 129, "user_id": 8049659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d80e2c967ad7a3887ec441485056cf8?s=128&d=identicon&r=PG&f=1", "display_name": "user8049659", "link": "https://stackoverflow.com/users/8049659/user8049659"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1546437759, "creation_date": 1546432502, "last_edit_date": 1546437759, "question_id": 54006504, "link": "https://stackoverflow.com/questions/54006504/browser-shows-previous-response", "title": "Browser shows previous response", "body": "<p>I run the code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/\", sroot)\n    http.ListenAndServe(\":8080\", nil)\n}\n\nfunc sroot(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Welcome\")\n}\n</code></pre>\n\n<p>and browser showed a response as expected: <code>Welcome</code>\nthen, after some time I try to change the output but have found that the output does not change! so, when I change the output  <code>fmt.Fprintf(w, \"Welcome 123\")</code> but browser still ouptuts <code>Welcome</code>.</p>\n\n<p>So what's the magic happens here?</p>\n"}, {"tags": ["go", "bdd", "gherkin"], "answers": [{"tags": [], "owner": {"reputation": 364, "user_id": 6173660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/abb2361f859a0ed3e7915135a5379426?s=128&d=identicon&r=PG&f=1", "display_name": "iam thadiyan", "link": "https://stackoverflow.com/users/6173660/iam-thadiyan"}, "is_accepted": true, "score": 0, "last_activity_date": 1546970020, "creation_date": 1546970020, "answer_id": 54097176, "question_id": 54005860, "link": "https://stackoverflow.com/questions/54005860/stop-godog-from-parsing-scenario-outline-example-data-table-rows/54097176#54097176", "title": "Stop godog from parsing Scenario Outline example data table rows", "body": "<p>The solution to the problem is to use double quotes around  as given below.</p>\n\n<pre><code>Scenario Outline: outline1\nGiven url\nAnd query parameters \"&lt;query_params&gt;\"\nWhen method\nThen status is\nExamples:\n| method | endpoint   | query_params | status |\n| GET    | /endpoint1 | ?a=1&amp;b=1     | 200    |\n| GET    | /endpoint1 | ?a=1&amp;b=1&amp;c=3 | 200    |\n</code></pre>\n\n<p>Then the following will be generated:</p>\n\n<pre><code>s.Step(`^query parameters \"([^\"]*)\"$`, queryParameters)\n</code></pre>\n"}], "owner": {"reputation": 364, "user_id": 6173660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/abb2361f859a0ed3e7915135a5379426?s=128&d=identicon&r=PG&f=1", "display_name": "iam thadiyan", "link": "https://stackoverflow.com/users/6173660/iam-thadiyan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 260, "favorite_count": 0, "accepted_answer_id": 54097176, "answer_count": 1, "score": 0, "last_activity_date": 1546970020, "creation_date": 1546429920, "question_id": 54005860, "link": "https://stackoverflow.com/questions/54005860/stop-godog-from-parsing-scenario-outline-example-data-table-rows", "title": "Stop godog from parsing Scenario Outline example data table rows", "body": "<p>I am not sure it this is intended to be so, but I am confused by the behavior.</p>\n\n<p>When I have the following Scenario Outline:</p>\n\n<pre><code>Scenario Outline: outline1\nGiven url\nAnd query parameters &lt;query_params&gt;\nWhen method\nThen status is\nExamples:\n| method | endpoint   | query_params | status |\n| GET    | /endpoint1 | ?a=1&amp;b=1     | 200    |\n| GET    | /endpoint1 | ?a=1&amp;b=1&amp;c=3 | 200    |\n</code></pre>\n\n<p>I see the following snippet generated.</p>\n\n<pre><code>func FeatureContext(s *godog.Suite) {\ns.Step(^method GET$, methodGET)\ns.Step(^query parameters \\?a=(\\d+)&amp;b=(\\d+)$, queryParametersAB)\ns.Step(^query parameters \\?a=(\\d+)&amp;b=(\\d+)&amp;c=(\\d+)$, queryParametersABC)\n}\n</code></pre>\n\n<p>As you can see 2 lines of \"query parameters\" produces 2 different functions. Why is godog parsing this text? This is a little different from cucumber gherkin parsing.</p>\n\n<p>One side effect of this is that if I have 100 lines in the data table, I am forced to implement all of them.</p>\n\n<p>Is there a way I can ask godog to not do this parsing?</p>\n"}, {"tags": ["arrays", "node.js", "go", "hyperledger-fabric", "hyperledger"], "comments": [{"owner": {"reputation": 407, "user_id": 6181613, "user_type": "registered", "accept_rate": 33, "profile_image": "https://lh4.googleusercontent.com/-oTM3iaccYM4/AAAAAAAAAAI/AAAAAAAAAGM/BoCaGAuqwl4/photo.jpg?sz=128", "display_name": "Alberto Carmona", "link": "https://stackoverflow.com/users/6181613/alberto-carmona"}, "edited": false, "score": 0, "creation_date": 1548872252, "post_id": 54005348, "comment_id": 95703043, "body": "Same error here, did you find a solution?"}], "answers": [{"tags": [], "owner": {"reputation": 967, "user_id": 4248573, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/itHpD.jpg?s=128&g=1", "display_name": "Alexey Muravyov", "link": "https://stackoverflow.com/users/4248573/alexey-muravyov"}, "is_accepted": false, "score": 0, "last_activity_date": 1595704914, "creation_date": 1595704914, "answer_id": 63092583, "question_id": 54005348, "link": "https://stackoverflow.com/questions/54005348/hyperlegder-fabric-node-error-2-unknown-stream-removed-unhandled-error-for-req/63092583#63092583", "title": "Hyperlegder fabric node Error: 2 UNKNOWN: Stream removed Unhandled error for request GET /api/fabric/1_0/channels:", "body": "<p>I had same error message when client tried create insecure connection but server use ssl</p>\n<p>If you use node.js try to replace</p>\n<pre><code>grpc.credentials.createInsecure()\n</code></pre>\n<p>on</p>\n<pre><code>grpc.credentials.createSsl()\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 10857466, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-t3e-FtDifOU/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcbCVwNWCzbuboRgBRN_I68YamO-Xg/mo/photo.jpg?sz=128", "display_name": "Manish Gaur", "link": "https://stackoverflow.com/users/10857466/manish-gaur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1007, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1595704914, "creation_date": 1546427823, "last_edit_date": 1547022002, "question_id": 54005348, "link": "https://stackoverflow.com/questions/54005348/hyperlegder-fabric-node-error-2-unknown-stream-removed-unhandled-error-for-req", "title": "Hyperlegder fabric node Error: 2 UNKNOWN: Stream removed Unhandled error for request GET /api/fabric/1_0/channels:", "body": "<p>This is the issue while running the fabric-sdk-rest code:</p>\n\n<pre><code>\"Peer {\n  _options: \n   { 'grpc.ssl_target_name_override': 'peer0',\n     'grpc.default_authority': 'peer0',\n     'grpc.max_receive_message_length': -1,\n     'grpc.max_send_message_length': -1 },\n      clientCert: undefined,\n      _url: 'grpc://0.0.0.0:7051',\n      _endpoint: Endpoint { addr: '0.0.0.0:7051', creds: \n      ChannelCredentials {} },\n     _name: '0.0.0.0:7051',\n      _request_timeout: 45000,\n     _grpc_wait_for_ready_timeout: 3000,\n    _endorserClient: \n   ServiceClient {\n     '$interceptors': [],\n     '$interceptor_providers': [],\n     '$channel': Channel {} },\n  _discoveryClient: \n   ServiceClient {\n     '$interceptors': [],\n     '$interceptor_providers': [],\n     '$channel': Channel {} } \n}\n</code></pre>\n\n<p>Error Log:</p>\n\n<blockquote>\n  <p>[fabricconnector.js]: Failed to queryChannels: Error: 2 UNKNOWN: Stream removed\n      Unhandled error for request GET /api/fabric/1_0/channels: Error: 2 UNKNOWN: Stream removed<br>\n          at Object.exports.createStatusError (/home/rev-mg/HyperledgerTest/fabric-sdk-rest/packages/loopback-connector-fabric/node_modules/grpc/src/common.js:87:15)<br>\n          at Object.onReceiveStatus (/home/rev-mg/HyperledgerTest/fabric-sdk-rest/packages/loopback-connector-fabric/node_modules/grpc/src/client_interceptors.js:1188:28)<br>\n          at InterceptingListener._callNext (/home/rev-mg/HyperledgerTest/fabric-sdk-rest/packages/loopback-connector-fabric/node_modules/grpc/src/client_interceptors.js:564:42)<br>\n          at InterceptingListener.onReceiveStatus (/home/rev-mg/HyperledgerTest/fabric-sdk-rest/packages/loopback-connector-fabric/node_modules/grpc/src/client_interceptors.js:614:8)<br>\n          at callback (/home/rev-mg/HyperledgerTest/fabric-sdk-rest/packages/loopback-connector-fabric/node_modules/grpc/src/client_interceptors.js:841:24)\"</p>\n</blockquote>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 10318773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b41a302ce70cc0427afc87c483acce83?s=128&d=identicon&r=PG&f=1", "display_name": "tatoe", "link": "https://stackoverflow.com/users/10318773/tatoe"}, "edited": false, "score": 0, "creation_date": 1546431376, "post_id": 54005665, "comment_id": 94848870, "body": "Thank you, this returns &lt;nil&gt; . any idea why?"}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 33, "user_id": 10318773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b41a302ce70cc0427afc87c483acce83?s=128&d=identicon&r=PG&f=1", "display_name": "tatoe", "link": "https://stackoverflow.com/users/10318773/tatoe"}, "edited": false, "score": 0, "creation_date": 1546431446, "post_id": 54005665, "comment_id": 94848900, "body": "@tatoe: Does not return <code>&lt;nil&gt;</code> for me.  Maybe something is wrong with your request. I recommend that you check the errors which I&#39;ve explicitly ignored to focus on the main idea. Note that the code expects a real  HTTP request which is not just some lines with <code>key: value</code>."}, {"owner": {"reputation": 33, "user_id": 10318773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b41a302ce70cc0427afc87c483acce83?s=128&d=identicon&r=PG&f=1", "display_name": "tatoe", "link": "https://stackoverflow.com/users/10318773/tatoe"}, "edited": false, "score": 0, "creation_date": 1546435066, "post_id": 54005665, "comment_id": 94850653, "body": "My bad, following your advice I noticed I forgot the appended newline after the request (thus got to unexpected EOF). thank you, you have provided me with a -very- efficient solution, was a smart idea to ask this before trying to implement the craziness I was about to :)"}], "tags": [], "owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "is_accepted": false, "score": 3, "last_activity_date": 1546442035, "last_edit_date": 1546442035, "creation_date": 1546429125, "answer_id": 54005665, "question_id": 54004938, "link": "https://stackoverflow.com/questions/54004938/most-efficient-way-to-read-http-headers-from-a-file/54005665#54005665", "title": "Most efficient way to read HTTP headers from a file?", "body": "<p><a href=\"https://golang.org/pkg/net/http\" rel=\"nofollow noreferrer\">net/http</a> has a method <a href=\"https://golang.org/pkg/net/http/#ReadRequest\" rel=\"nofollow noreferrer\">ReadRequest</a> which can create a new <code>Request</code> object from a <code>bufio.Reader</code>. Assuming that your file contains a real HTTP request (instead of only the part of the request which consists of lines with <code>key: value</code>) all you need to do is create a new <code>bufio.Reader</code> from the file, i.e. like this (error handling omitted):</p>\n\n<pre><code>rdr,_ := os.Open(\"req.txt\")\nreq,_ := http.ReadRequest(bufio.NewReader(rdr))\nfmt.Printf(\"%+v\\n\", req)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 33, "user_id": 10318773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b41a302ce70cc0427afc87c483acce83?s=128&d=identicon&r=PG&f=1", "display_name": "tatoe", "link": "https://stackoverflow.com/users/10318773/tatoe"}, "edited": false, "score": 0, "creation_date": 1546615649, "post_id": 54008331, "comment_id": 94918660, "body": "What is webRequest referrig to in your example? I can&#39;t seem to send a standard http.NewRequest in your way."}, {"owner": {"reputation": 33, "user_id": 10318773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b41a302ce70cc0427afc87c483acce83?s=128&d=identicon&r=PG&f=1", "display_name": "tatoe", "link": "https://stackoverflow.com/users/10318773/tatoe"}, "edited": false, "score": 0, "creation_date": 1546615970, "post_id": 54008331, "comment_id": 94918863, "body": "error: cannot call non-function req.Header (type http.Header)"}, {"owner": {"reputation": 33, "user_id": 10318773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b41a302ce70cc0427afc87c483acce83?s=128&d=identicon&r=PG&f=1", "display_name": "tatoe", "link": "https://stackoverflow.com/users/10318773/tatoe"}, "edited": false, "score": 0, "creation_date": 1546616306, "post_id": 54008331, "comment_id": 94919064, "body": "nevermind, changed Header() to Header. worked. thanks!"}, {"owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "reply_to_user": {"reputation": 33, "user_id": 10318773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b41a302ce70cc0427afc87c483acce83?s=128&d=identicon&r=PG&f=1", "display_name": "tatoe", "link": "https://stackoverflow.com/users/10318773/tatoe"}, "edited": false, "score": 0, "creation_date": 1546616961, "post_id": 54008331, "comment_id": 94919470, "body": "@tatoe webRequest is the response writer you receive in the requesthandler func. Sorry, improved the naming."}, {"owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "reply_to_user": {"reputation": 33, "user_id": 10318773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b41a302ce70cc0427afc87c483acce83?s=128&d=identicon&r=PG&f=1", "display_name": "tatoe", "link": "https://stackoverflow.com/users/10318773/tatoe"}, "edited": false, "score": 0, "creation_date": 1546617083, "post_id": 54008331, "comment_id": 94919531, "body": "@tatoe it is common to upvote helpful answers (hint)"}], "tags": [], "owner": {"reputation": 4225, "user_id": 2198470, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/96cad411a2ee0df41dd85434bbfd268f?s=128&d=identicon&r=PG", "display_name": "thst", "link": "https://stackoverflow.com/users/2198470/thst"}, "is_accepted": true, "score": 1, "last_activity_date": 1546616905, "last_edit_date": 1546616905, "creation_date": 1546440261, "answer_id": 54008331, "question_id": 54004938, "link": "https://stackoverflow.com/questions/54004938/most-efficient-way-to-read-http-headers-from-a-file/54008331#54008331", "title": "Most efficient way to read HTTP headers from a file?", "body": "<p>If you only want some headers defined, another option is to define the headers in a Json file and apply the following code (file reading not included):</p>\n\n<pre><code>var jsonMap map[string]string\nerr = json.Unmarshal(jsonBytesFromFile, &amp;jsonMap)\nif err != nil {\n    log.Fatal(\"unable to parse json: \", err)\n}\n\nfor k, v := range jsonMap {\n    log.Printf(\"setting Header : %s : %s\", k, v)\n    responseWriter.Header().Add(k, v) // you may prefer Set()\n}\n</code></pre>\n\n<p>The json looks like this:</p>\n\n<pre><code>{ \n    \"Content-type\": \"text/plain\",\n    \"Cache-Control\": \"only-if-cached\"\n}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 10318773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b41a302ce70cc0427afc87c483acce83?s=128&d=identicon&r=PG&f=1", "display_name": "tatoe", "link": "https://stackoverflow.com/users/10318773/tatoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 0, "accepted_answer_id": 54008331, "answer_count": 2, "score": 1, "last_activity_date": 1546616905, "creation_date": 1546425990, "last_edit_date": 1546438244, "question_id": 54004938, "link": "https://stackoverflow.com/questions/54004938/most-efficient-way-to-read-http-headers-from-a-file", "title": "Most efficient way to read HTTP headers from a file?", "body": "<p>I'm looking for an efficient way to read HTTP headers from a textfile to be later sent with an HTTP request. Consider the following code (which currently contains basic net/http request functionality):</p>\n\n<pre><code>func MakeRequest(target string, method string) {\nclient := &amp;http.Client{}\nreq, _ := http.NewRequest(method, target, nil)\n\n//Headers manually..\nreq.Header.Add(\"If-None-Match\", `some value`)\n\nresponse, _ := client.Do(req)\nbody, _ := ioutil.ReadAll(response.Body)\nfmt.Println(string(body))\n}\n</code></pre>\n\n<p>I started by using ioutil.ReadFile like this:</p>\n\n<pre><code>func main() {\ndata, _ := ioutil.ReadFile(\"/opt/tests/req.txt\")\nfmt.Print(string(data))\n}\n</code></pre>\n\n<p>But taking this text, splitting it by some indicator (lets say \":\") and then placing the information in req.Header.Add(\"var1\", \"var2\") per-header seems like an over-kill.</p>\n\n<p><strong>Question:</strong> Any better way to send HTTP requests with headers from a text file in go?</p>\n"}, {"tags": ["mysql", "go"], "answers": [{"tags": [], "owner": {"reputation": 1767, "user_id": 1073170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c13e7782e36e3cf978a02ee761c7e70e?s=128&d=identicon&r=PG", "display_name": "Jory Geerts", "link": "https://stackoverflow.com/users/1073170/jory-geerts"}, "is_accepted": true, "score": 2, "last_activity_date": 1546428526, "creation_date": 1546428526, "answer_id": 54005524, "question_id": 54004494, "link": "https://stackoverflow.com/questions/54004494/limit-max-prepared-statement-count/54005524#54005524", "title": "Limit max prepared statement count", "body": "<p>You need to close the statement inside <code>upsertProjectSkuCosts()</code> (or re-use it - see the end of this post).</p>\n\n<p>When you call <code>db.Prepare()</code>, a connection is taken from the internal connection pool (or a new connection is created, if there aren't any free connections). The statement is then prepared on that connection (if that connection isn't free when <code>stmt.Exec()</code> is called, the statement is then <em>also</em> prepared on another connection).\nSo this creates a statement inside your database for that connection. This statement will not magically disappear - having multiple prepared statements in a connection is perfectly valid. Golang <em>could</em> see that <code>stmt</code> goes out of scope, see it requires some sort of cleanup and then do that cleanup, but Golang doesn't (just like it doesn't close files for you and things like that). So you'll need to do that yourself using <code>stmt.Close()</code>. When you call <code>stmt.Close()</code>, the driver will send a command to the database server, telling it the statement is no longer needed.</p>\n\n<p>The easiest way to do this is by adding <code>defer stmt.Close()</code> after the <code>err</code> check following <code>db.Prepare()</code>.</p>\n\n<p>What you can also do, is prepare the statement once and make that available for <code>upsertProjectSkuCosts</code> (either by passing the <code>stmt</code> into <code>upsertProjectSkuCosts</code> or by making <code>upsertProjectSkuCosts</code> a func of a struct, so the struct can have a property for the <code>stmt</code>). If you do this, you should <strong>not</strong> call <code>stmt.Close()</code> - because you aren't creating new statements anymore, you are re-using an existing statement.</p>\n\n<p>Also see <a href=\"https://stackoverflow.com/questions/27287894/should-we-also-close-dbs-prepare-in-golang\">Should we also close DB&#39;s .Prepare() in Golang?</a> and <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/ISh22XXze-s\" rel=\"nofollow noreferrer\">https://groups.google.com/forum/#!topic/golang-nuts/ISh22XXze-s</a></p>\n"}], "owner": {"reputation": 9607, "user_id": 3924219, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ae3162deaeb55113f7f3e61c35bb0571?s=128&d=identicon&r=PG&f=1", "display_name": "kentor", "link": "https://stackoverflow.com/users/3924219/kentor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1138, "favorite_count": 0, "accepted_answer_id": 54005524, "answer_count": 1, "score": 1, "last_activity_date": 1546428526, "creation_date": 1546424077, "question_id": 54004494, "link": "https://stackoverflow.com/questions/54004494/limit-max-prepared-statement-count", "title": "Limit max prepared statement count", "body": "<p><strong>The problem</strong></p>\n\n<p>I wrote an application which synchronizes data from BigQuery into a MySQL database. I try to insert roughly 10-20k rows in batches (up to 10 items each batch) every 3 hours. For some reason I receive the following error when it tries to upsert these rows into MySQL:</p>\n\n<p>Can't create more than max_prepared_stmt_count statements:</p>\n\n<blockquote>\n  <p>Error 1461: Can't create more than max_prepared_stmt_count statements\n  (current value: 2000)</p>\n</blockquote>\n\n<p><strong>My \"relevant code\"</strong></p>\n\n<pre><code>// ProcessProjectSkuCost receives the given sku cost entries and sends them in batches to upsertProjectSkuCosts()\nfunc ProcessProjectSkuCost(done &lt;-chan bigquery.SkuCost) {\n    var skuCosts []bigquery.SkuCost\n    var rowsAffected int64\n    for skuCostRow := range done {\n        skuCosts = append(skuCosts, skuCostRow)\n\n        if len(skuCosts) == 10 {\n            rowsAffected += upsertProjectSkuCosts(skuCosts)\n            skuCosts = []bigquery.SkuCost{}\n        }\n    }\n    if len(skuCosts) &gt; 0 {\n        rowsAffected += upsertProjectSkuCosts(skuCosts)\n    }\n    log.Infof(\"Completed upserting project sku costs. Affected rows: '%d'\", rowsAffected)\n}\n\n// upsertProjectSkuCosts inserts or updates ProjectSkuCosts into SQL in batches\nfunc upsertProjectSkuCosts(skuCosts []bigquery.SkuCost) int64 {\n    // properties are table fields\n    tableFields := []string{\"project_name\", \"sku_id\", \"sku_description\", \"usage_start_time\", \"usage_end_time\",\n        \"cost\", \"currency\", \"usage_amount\", \"usage_unit\", \"usage_amount_in_pricing_units\", \"usage_pricing_unit\",\n        \"invoice_month\"}\n    tableFieldString := fmt.Sprintf(\"(%s)\", strings.Join(tableFields, \",\"))\n\n    // placeholderstring for all to be inserted values\n    placeholderString := createPlaceholderString(tableFields)\n    valuePlaceholderString := \"\"\n    values := []interface{}{}\n    for _, row := range skuCosts {\n        valuePlaceholderString += fmt.Sprintf(\"(%s),\", placeholderString)\n        values = append(values, row.ProjectName, row.SkuID, row.SkuDescription, row.UsageStartTime,\n            row.UsageEndTime, row.Cost, row.Currency, row.UsageAmount, row.UsageUnit,\n            row.UsageAmountInPricingUnits, row.UsagePricingUnit, row.InvoiceMonth)\n    }\n    valuePlaceholderString = strings.TrimSuffix(valuePlaceholderString, \",\")\n\n    // put together SQL string\n    sqlString := fmt.Sprintf(`INSERT INTO\n        project_sku_cost %s VALUES %s ON DUPLICATE KEY UPDATE invoice_month=invoice_month`, tableFieldString, valuePlaceholderString)\n    sqlString = strings.TrimSpace(sqlString)\n\n    stmt, err := db.Prepare(sqlString)\n    if err != nil {\n        log.Warn(\"Error while preparing SQL statement to upsert project sku costs. \", err)\n        return 0\n    }\n\n    // execute query\n    res, err := stmt.Exec(values...)\n    if err != nil {\n        log.Warn(\"Error while executing statement to upsert project sku costs. \", err)\n        return 0\n    }\n\n    rowsAffected, err := res.RowsAffected()\n    if err != nil {\n        log.Warn(\"Error while trying to access affected rows \", err)\n        return 0\n    }\n\n    return rowsAffected\n}\n\n// createPlaceholderString creates a string which will be used for prepare statement (output looks like \"(?,?,?)\")\nfunc createPlaceholderString(tableFields []string) string {\n    placeHolderString := \"\"\n    for range tableFields {\n        placeHolderString += \"?,\"\n    }\n    placeHolderString = strings.TrimSuffix(placeHolderString, \",\")\n\n    return placeHolderString\n}\n</code></pre>\n\n<p><strong>My question:</strong></p>\n\n<p>Why do I hit the <code>max_prepared_stmt_count</code> when I immediately execute the prepared statement (see function <code>upsertProjectSkuCosts</code>)?</p>\n\n<p>I could only imagine it's some sort of concurrency which creates tons of prepared statements in the meantime between preparing and executing all these statements. On the other hand I don't understand why there would be so much concurrency as the channel in the <code>ProcessProjectSkuCost</code> is a buffered channel with a size of 20.</p>\n"}, {"tags": ["list", "go", "struct"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546420651, "post_id": 54003473, "comment_id": 94844244, "body": "The error message is pretty clear: You&#39;re trying to assign a pointer to a concrete value."}, {"owner": {"reputation": 414, "user_id": 6331353, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd7f6cc42c46c3a65c58ff594d962597?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/6331353/sam"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546420759, "post_id": 54003473, "comment_id": 94844276, "body": "@Flimzy The error message doesn&#39;t mention a pointer or a concrete value, so it wasn&#39;t clear to me. I understand now that the * means pointer, but it&#39;s been a few years since I&#39;ve worked with pointers."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1546420869, "post_id": 54003473, "comment_id": 94844320, "body": "Well, it does mention those.  <code>*list.List</code> means pointer, <code>list.List</code> means concrete value.  If these concepts are new to you, you should start with <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">A Tour of Go</a>."}, {"owner": {"reputation": 414, "user_id": 6331353, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd7f6cc42c46c3a65c58ff594d962597?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/6331353/sam"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546420988, "post_id": 54003473, "comment_id": 94844369, "body": "@Flimzy They are not new, I am just rusty using them, I&#39;ve already done that tour."}], "answers": [{"comments": [{"owner": {"reputation": 414, "user_id": 6331353, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd7f6cc42c46c3a65c58ff594d962597?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/6331353/sam"}, "edited": false, "score": 0, "creation_date": 1546420557, "post_id": 54003676, "comment_id": 94844199, "body": "Thanks, will using pointers to lists cause any problems? My original intention was to just use a list and not use a pointer. Is there a way to pass a new list to the struct instead of passing a pointer?"}, {"owner": {"reputation": 414, "user_id": 6331353, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd7f6cc42c46c3a65c58ff594d962597?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/6331353/sam"}, "edited": false, "score": 0, "creation_date": 1546425693, "post_id": 54003676, "comment_id": 94846377, "body": "So now your dereferencing the list.New() when you create it, so that you pass the actual list into the struct, is that correct?"}, {"owner": {"reputation": 414, "user_id": 6331353, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd7f6cc42c46c3a65c58ff594d962597?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/6331353/sam"}, "edited": false, "score": 0, "creation_date": 1546426225, "post_id": 54003676, "comment_id": 94846614, "body": "You have to remove the &#39;*&#39; from the struct if you add it in the function call.  I&#39;m not sure which one I should be using. The struct is going to be a chatroom, that holds a list of messages and a list of users. I&#39;m adding these chatrooms to a global list in my program. Would I want the struct to have pointers to lists, or concrete lists."}, {"owner": {"reputation": 201, "user_id": 10814080, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-IHSUhxzo9Fs/AAAAAAAAAAI/AAAAAAAAAA8/RCIP5dhhB4A/photo.jpg?sz=128", "display_name": "Bob Fred", "link": "https://stackoverflow.com/users/10814080/bob-fred"}, "reply_to_user": {"reputation": 414, "user_id": 6331353, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd7f6cc42c46c3a65c58ff594d962597?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/6331353/sam"}, "edited": false, "score": 0, "creation_date": 1546429056, "post_id": 54003676, "comment_id": 94847949, "body": "@Jacob see <a href=\"https://stackoverflow.com/questions/24452323/go-performance-whats-the-difference-between-pointer-and-value-in-struct\">pointers vs values</a>"}], "tags": [], "owner": {"reputation": 201, "user_id": 10814080, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-IHSUhxzo9Fs/AAAAAAAAAAI/AAAAAAAAAA8/RCIP5dhhB4A/photo.jpg?sz=128", "display_name": "Bob Fred", "link": "https://stackoverflow.com/users/10814080/bob-fred"}, "is_accepted": true, "score": 3, "last_activity_date": 1546420834, "last_edit_date": 1546420834, "creation_date": 1546420095, "answer_id": 54003676, "question_id": 54003473, "link": "https://stackoverflow.com/questions/54003473/creating-a-struct-that-contains-list-types-in-go/54003676#54003676", "title": "Creating a struct that contains list types in go", "body": "<p>list.New() returns a pointer <code>*List</code>, while myStruct announce its fields as <code>List</code>.</p>\n\n<blockquote>\n  <p>func New() *List</p>\n</blockquote>\n\n<p>messages and users should be *list.List</p>\n\n<pre><code>type myStruct struct {\n    name string\n    messages *list.List\n    users *list.List\n    lastUsed time.Time\n}\n</code></pre>\n\n<p>Another approach according to your need, u can just initialize the struct as below:</p>\n\n<pre><code>var myVar = myStruct{\"hello\", *list.New(), *list.New(), time.Now()}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 414, "user_id": 6331353, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd7f6cc42c46c3a65c58ff594d962597?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/6331353/sam"}, "edited": false, "score": 0, "creation_date": 1546420567, "post_id": 54003724, "comment_id": 94844206, "body": "Thanks, will using pointers to lists cause any problems? My original intention was to just use a list and not use a pointer. Is there a way to pass a new list to the struct instead of passing a pointer?"}], "tags": [], "owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "is_accepted": false, "score": 2, "last_activity_date": 1546420306, "creation_date": 1546420306, "answer_id": 54003724, "question_id": 54003473, "link": "https://stackoverflow.com/questions/54003473/creating-a-struct-that-contains-list-types-in-go/54003724#54003724", "title": "Creating a struct that contains list types in go", "body": "<p>You are creating wrong struct because go, according to <code>list</code> package <code>New()</code> method returns pointer type of list and you created <code>list</code> in struct without pointer.</p>\n\n<pre><code>func New() *List\n</code></pre>\n\n<p>So, according to doc you need to created your struct like below:</p>\n\n<pre><code>type myStruct struct {\n    name string\n    messages *list.List\n    users *list.List\n    lastUsed time.Time\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/FcD-u32mnUn\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n"}], "owner": {"reputation": 414, "user_id": 6331353, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd7f6cc42c46c3a65c58ff594d962597?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/6331353/sam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 477, "favorite_count": 0, "accepted_answer_id": 54003676, "answer_count": 2, "score": -2, "last_activity_date": 1546420834, "creation_date": 1546419027, "question_id": 54003473, "link": "https://stackoverflow.com/questions/54003473/creating-a-struct-that-contains-list-types-in-go", "title": "Creating a struct that contains list types in go", "body": "<p>I have created a struct, this struct has contains two list types within it. When I try to instantiate my struct I receive the error </p>\n\n<p><code>cannot use list.New() (type *list.List) as type list.List in field value</code></p>\n\n<p>I am using the golang playground</p>\n\n<p><strong>The struct</strong></p>\n\n<pre><code>type myStruct struct {\n    name string\n    messages list.List\n    users list.List\n    lastUsed time.Time\n}\n</code></pre>\n\n<p><strong>Instantiating the struct</strong></p>\n\n<pre><code>var myVar = myStruct{\"hello\", list.New(), list.New(), time.Now()}\n</code></pre>\n"}, {"tags": ["javascript", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546420576, "post_id": 54003343, "comment_id": 94844208, "body": "There&#39;s no way for us to debug your program if you don&#39;t share your code with us."}], "answers": [{"tags": [], "owner": {"reputation": 441, "user_id": 2854629, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a08eb34a6c50bf58af084d9b28f79ae2?s=128&d=identicon&r=PG&f=1", "display_name": "Ethan", "link": "https://stackoverflow.com/users/2854629/ethan"}, "is_accepted": true, "score": 0, "last_activity_date": 1546421413, "last_edit_date": 1546421413, "creation_date": 1546418490, "answer_id": 54003389, "question_id": 54003343, "link": "https://stackoverflow.com/questions/54003343/front-end-get-wrong-data-from-back-end/54003389#54003389", "title": "Front-end get wrong data from back-end", "body": "<p>it's impossible, there must be something wrong in your code. \ntwo options in my opinion.</p>\n\n<ol>\n<li><p>make sure your Go Back-end sends right data.</p></li>\n<li><p>capture data using software <code>wireshark</code>.</p></li>\n</ol>\n"}], "owner": {"reputation": 29, "user_id": 6223176, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-c3VOcP7i0nI/AAAAAAAAAAI/AAAAAAAAABI/Tnh64IEECEw/photo.jpg?sz=128", "display_name": "Feni X", "link": "https://stackoverflow.com/users/6223176/feni-x"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 54003389, "answer_count": 1, "score": -6, "last_activity_date": 1546569694, "creation_date": 1546418171, "last_edit_date": 1546569694, "question_id": 54003343, "link": "https://stackoverflow.com/questions/54003343/front-end-get-wrong-data-from-back-end", "title": "Front-end get wrong data from back-end", "body": "<p>For example:</p>\n\n<p>Go back-end sends:</p>\n\n<pre><code>map{\"1\": 0, \"2\": 1}\n</code></pre>\n\n<p>JavaScript front-end uses <a href=\"https://www.npmjs.com/package/fetch\" rel=\"nofollow noreferrer\">fetch</a> to get data from back-end: </p>\n\n<pre><code>{\"2\": 1, \"1\": 0, \"3\": 1}\n</code></pre>\n\n<p>Is it possible that front-end got data which has one (or two) more element  accidentally?</p>\n"}, {"tags": ["go", "interface", "comparison"], "answers": [{"comments": [{"owner": {"reputation": 309, "user_id": 8591671, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ae21750ead1b346f8240ee5d5458fd1a?s=128&d=identicon&r=PG&f=1", "display_name": "John Snow", "link": "https://stackoverflow.com/users/8591671/john-snow"}, "edited": false, "score": 0, "creation_date": 1546418607, "post_id": 54003329, "comment_id": 94843441, "body": "Thank you for the answer! I have edited my question to clarify the point, could you please have a look?"}, {"owner": {"reputation": 309, "user_id": 8591671, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ae21750ead1b346f8240ee5d5458fd1a?s=128&d=identicon&r=PG&f=1", "display_name": "John Snow", "link": "https://stackoverflow.com/users/8591671/john-snow"}, "edited": false, "score": 0, "creation_date": 1546421546, "post_id": 54003329, "comment_id": 94844614, "body": "But if the dynamic type of both <code>reader</code> and <code>error</code> is the same (<code>nil</code>) why they are not comparable?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 309, "user_id": 8591671, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ae21750ead1b346f8240ee5d5458fd1a?s=128&d=identicon&r=PG&f=1", "display_name": "John Snow", "link": "https://stackoverflow.com/users/8591671/john-snow"}, "edited": false, "score": 1, "creation_date": 1546421649, "post_id": 54003329, "comment_id": 94844667, "body": "@AyZu Because none of them is assignable to the other (they have different static type: <code>error</code> and <code>io.Reader</code>). And the spec requires one-way assignability."}, {"owner": {"reputation": 309, "user_id": 8591671, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ae21750ead1b346f8240ee5d5458fd1a?s=128&d=identicon&r=PG&f=1", "display_name": "John Snow", "link": "https://stackoverflow.com/users/8591671/john-snow"}, "edited": false, "score": 0, "creation_date": 1546503335, "post_id": 54003329, "comment_id": 94873274, "body": "OK, thank you! I was confused with static type and dynamic type. They have the same dynamic type <code>nil</code> and therefore <code>reflect.TypeOf()</code> outputs the same result, but they have different static types and therefore they are not comparable."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1546429943, "last_edit_date": 1546429943, "creation_date": 1546418093, "answer_id": 54003329, "question_id": 54003271, "link": "https://stackoverflow.com/questions/54003271/comparison-between-empty-interfaces-in-golang/54003329#54003329", "title": "Comparison between empty interfaces in Golang", "body": "<p>It's true that interface values are comparable, but you can only compare values that are assignable to each other (more precisely, one is assignable to the other). Quoting from <a href=\"https://golang.org/ref/spec#Comparison_operators\" rel=\"nofollow noreferrer\">Spec: Comparison operators:</a></p>\n\n<blockquote>\n  <p>In any comparison, the first operand must be <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">assignable</a> to the type of the second operand, or vice versa.</p>\n</blockquote>\n\n<p>You can't assign an <code>error</code> value to an <code>io.Reader</code>, and you can't assign an <code>io.Reader</code> value to an <code>error</code> either, so you can't compare them.</p>\n\n<p>They may or may not store the same dynamic value, if you want to compare those, first covert both to <code>interface{}</code>, so you can compare them, e.g.:</p>\n\n<pre><code>fmt.Println(interface{}(err) == interface{}(reader))\n</code></pre>\n\n<p>This will output (try it on the <a href=\"https://play.golang.org/p/xTIyifnoFyP\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>true\n</code></pre>\n\n<p>Note: actually it would be enough to convert only one of them to <code>interface{}</code>, because that way the the other value will become comparable to the type of the one you converted to <code>interface{}</code> (any value is convertible to <code>interface{}</code>), so it would also be enough to do:</p>\n\n<pre><code>fmt.Println(interface{}(err) == reader)\n</code></pre>\n\n<p>Testing the comparison with non-<code>nil</code> interface values:</p>\n\n<pre><code>type x int\n\nfunc (x) Error() string            { return \"\" }\nfunc (x) Read([]byte) (int, error) { return 0, nil }\n\nerr = x(0)\nreader = x(0)\nfmt.Println(interface{}(err) == interface{}(reader))\n\nreader = x(1)\nfmt.Println(interface{}(err) == interface{}(reader))\n</code></pre>\n\n<p>Now output will be (try it on the <a href=\"https://play.golang.org/p/cyWydXN9oA0\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>true\nfalse\n</code></pre>\n\n<p>Also don't forget that a <code>nil</code> interface value does not equal to a non-<code>nil</code> interface value holding a <code>nil</code> dynamic value. For details, see <a href=\"https://stackoverflow.com/questions/29138591/hiding-nil-values-understanding-why-golang-fails-here/29138676#29138676\">Hiding nil values, understanding why golang fails here</a></p>\n\n<p><strong>Edit:</strong></p>\n\n<p>The <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\"><code>fmt</code></a> package prints the value inside the interface, not the interface value. Quoting from package doc of <code>fmt</code>:</p>\n\n<blockquote>\n  <p>Regardless of the verb, if an operand is an interface value, the internal concrete value is used, not the interface itself.</p>\n</blockquote>\n\n<p>Same goes with <a href=\"https://golang.org/pkg/reflect/#TypeOf\" rel=\"nofollow noreferrer\"><code>reflect.TypeOf()</code></a>: it returns the dynamic type, but if you pass a <code>nil</code> interface value to it, it returns <code>nil</code> so the <code>fmt</code> package will print <code>nil</code>. Quoting its doc:</p>\n\n<blockquote>\n  <p>TypeOf returns the reflection Type that represents the dynamic type of i. If i is a nil interface value, TypeOf returns nil.</p>\n</blockquote>\n"}], "owner": {"reputation": 309, "user_id": 8591671, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ae21750ead1b346f8240ee5d5458fd1a?s=128&d=identicon&r=PG&f=1", "display_name": "John Snow", "link": "https://stackoverflow.com/users/8591671/john-snow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 797, "favorite_count": 0, "accepted_answer_id": 54003329, "answer_count": 1, "score": 0, "last_activity_date": 1546429943, "creation_date": 1546417705, "last_edit_date": 1546418656, "question_id": 54003271, "link": "https://stackoverflow.com/questions/54003271/comparison-between-empty-interfaces-in-golang", "title": "Comparison between empty interfaces in Golang", "body": "<p>According to the <a href=\"https://golang.org/ref/spec#Comparison_operators\" rel=\"nofollow noreferrer\">specification:</a> </p>\n\n<blockquote>\n  <p>Interface values are comparable. Two interface values are equal if\n  they have identical dynamic types and equal dynamic values or if both\n  have value nil.</p>\n</blockquote>\n\n<pre><code>var err error \nvar reader io.Reader                           \n</code></pre>\n\n<p>As far as understand, <code>err</code> and <code>reader</code> have different dynamic types (<code>error</code> and <code>io.Reader</code>) and therefore are not comparable. </p>\n\n<pre><code>fmt.Println(err == reader) \n</code></pre>\n\n<p>will cause a compile error:</p>\n\n<blockquote>\n  <p>invalid operation: err == reader (mismatched types error and io.Reader)</p>\n</blockquote>\n\n<p>If it is true, why <code>Println</code> command outputs the same results for both variables? Why both are <code>nil</code>?</p>\n\n<pre><code>fmt.Printf(\"reader: %T\", reader) // nil\nfmt.Printf(\"error: %T\", err) // nil\n</code></pre>\n\n<p><strong>EDIT</strong> <code>reflect.TypeOf(err)</code>or <code>reflect.TypeOf(reader)</code> will also output <code>nil</code>. I do not understand why the output is the same if the types are different.</p>\n"}, {"tags": ["go", "visual-studio-code"], "comments": [{"owner": {"reputation": 1399, "user_id": 4527057, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a5947a7625a180577e321ead1c56769?s=128&d=identicon&r=PG&f=1", "display_name": "lloyd", "link": "https://stackoverflow.com/users/4527057/lloyd"}, "edited": false, "score": 0, "creation_date": 1546415769, "post_id": 54002878, "comment_id": 94842504, "body": "<a href=\"https://stackoverflow.com/help/mcve\">mvce</a>?"}, {"owner": {"reputation": 31, "user_id": 10856609, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TvVSx.jpg?s=128&g=1", "display_name": "YueYue", "link": "https://stackoverflow.com/users/10856609/yueyue"}, "reply_to_user": {"reputation": 1399, "user_id": 4527057, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a5947a7625a180577e321ead1c56769?s=128&d=identicon&r=PG&f=1", "display_name": "lloyd", "link": "https://stackoverflow.com/users/4527057/lloyd"}, "edited": false, "score": 0, "creation_date": 1546416941, "post_id": 54002878, "comment_id": 94842870, "body": "package main  func test() { \tvar a int \ta = 10 \tprint(a) }  func main() { \ttest() }"}, {"owner": {"reputation": 149, "user_id": 1057530, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfbda55550a02c4d8e4e4515e8572c74?s=128&d=identicon&r=PG", "display_name": "Edward", "link": "https://stackoverflow.com/users/1057530/edward"}, "edited": false, "score": 0, "creation_date": 1548242945, "post_id": 54002878, "comment_id": 95470760, "body": "I&#39;m having this same issue on a large project, and I created a simple main that calls a single function and it reproduces there as well. Windows 7, windows 10, vscode latest, latest go 1.11.4, or go 1.11.1."}], "owner": {"reputation": 31, "user_id": 10856609, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TvVSx.jpg?s=128&g=1", "display_name": "YueYue", "link": "https://stackoverflow.com/users/10856609/yueyue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 484, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1546416772, "creation_date": 1546415216, "last_edit_date": 1546416772, "question_id": 54002878, "link": "https://stackoverflow.com/questions/54002878/vscode-debugging-go-call-stack-only-show-one-function", "title": "VSCode debugging Go, call stack only show one function", "body": "<p>I use vscode to debug Go program. \nBut the call stack only show current break point function, no backtrace info.\nI use dlv command or goland, the backtrace info is right. \nWhere is the config error?</p>\n\n<ul>\n<li>vscode only one function:<br>\n<img src=\"https://i.stack.imgur.com/KVHzT.png\" alt=\"\"> </li>\n</ul>\n\n<p>my workspace and configure</p>\n\n<ul>\n<li>vscode go:<br>\n<img src=\"https://i.stack.imgur.com/sFCd0.png\" alt=\"\"> </li>\n<li>launch.json:<br>\n<img src=\"https://i.stack.imgur.com/9SEul.png\" alt=\"\"> </li>\n<li>user settings:<br>\n<img src=\"https://i.stack.imgur.com/N5NjQ.png\" alt=\"\"></li>\n</ul>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1546412629, "post_id": 54001970, "comment_id": 94841605, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/38091816/packages-type-cannot-be-used-as-the-vendored-packages-type\">package&#39;s type cannot be used as the vendored package&#39;s type</a>"}, {"owner": {"reputation": 28098, "user_id": 86072, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/dd41ab60469c4ee32c957c97fc101b9d?s=128&d=identicon&r=PG", "display_name": "LeGEC", "link": "https://stackoverflow.com/users/86072/legec"}, "edited": false, "score": 0, "creation_date": 1546420868, "post_id": 54001970, "comment_id": 94844319, "body": "Have you tried : add <code>go.uber.org&#47;zap</code> in the vendored dependencies of your own project, and build from your project ?"}, {"owner": {"reputation": 1351, "user_id": 1515997, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/f3146da7d1509745536c8b7cb1a3d7d9?s=128&d=identicon&r=PG", "display_name": "ozn", "link": "https://stackoverflow.com/users/1515997/ozn"}, "reply_to_user": {"reputation": 28098, "user_id": 86072, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/dd41ab60469c4ee32c957c97fc101b9d?s=128&d=identicon&r=PG", "display_name": "LeGEC", "link": "https://stackoverflow.com/users/86072/legec"}, "edited": false, "score": 0, "creation_date": 1591314187, "post_id": 54001970, "comment_id": 110017106, "body": "@LeGEC, it gives a type mismatch."}], "answers": [{"comments": [{"owner": {"reputation": 1351, "user_id": 1515997, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/f3146da7d1509745536c8b7cb1a3d7d9?s=128&d=identicon&r=PG", "display_name": "ozn", "link": "https://stackoverflow.com/users/1515997/ozn"}, "edited": false, "score": 0, "creation_date": 1591313545, "post_id": 54006946, "comment_id": 110016967, "body": "I dont think this works.  Anyone can confirm?  Even if it did, its not a very sustainable way of using this."}], "tags": [], "owner": {"reputation": 762, "user_id": 3052074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/619c2a3b094423dd741dc8eb161836f0?s=128&d=identicon&r=PG", "display_name": "Andrey Dyatlov", "link": "https://stackoverflow.com/users/3052074/andrey-dyatlov"}, "is_accepted": false, "score": 2, "last_activity_date": 1546440625, "last_edit_date": 1546440625, "creation_date": 1546434476, "answer_id": 54006946, "question_id": 54001970, "link": "https://stackoverflow.com/questions/54001970/how-to-import-imported-packages-vendor-package/54006946#54006946", "title": "How to import imported package&#39;s vendor package", "body": "<p>It seems like the package <code>github.com/coreos/etcd/wal</code> is not meant to be used outside of the etcd project. If you really need to use it, please, follow the steps below.</p>\n\n<ol>\n<li><p>Place the following code in the <code>$GOPATH/src/yourpackage/main.go</code> file.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"go.etcd.io/etcd/wal\"\n    \"go.uber.org/zap\"\n)\n\nfunc main() {\n    metadata := []byte{}\n    w, err := wal.Create(zap.NewExample(), \"/tmp/hello\", metadata)\n    fmt.Println(w, err)\n}\n</code></pre></li>\n<li><p><code>mkdir $GOPATH/src/yourpackage/vendor</code></p></li>\n<li><code>cp -r $GOPATH/src/go.etcd.io $GOPATH/src/yourpackage/vendor/</code></li>\n<li><code>mv $GOPATH/src/yourpackage/vendor/go.etcd.io/etcd/vendor/go.uber.org $GOPATH/src/yourpackage/vendor/</code></li>\n<li><code>go build yourpackage</code></li>\n</ol>\n"}], "owner": {"reputation": 427, "user_id": 4368629, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh3.googleusercontent.com/-8FeEoD1vkOg/AAAAAAAAAAI/AAAAAAAAAA8/MJ9Ee_7BKG8/photo.jpg?sz=128", "display_name": "lxjhk", "link": "https://stackoverflow.com/users/4368629/lxjhk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 465, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1546440625, "creation_date": 1546409427, "question_id": 54001970, "link": "https://stackoverflow.com/questions/54001970/how-to-import-imported-packages-vendor-package", "title": "How to import imported package&#39;s vendor package", "body": "<p>I am using etcd's wal package (<a href=\"https://godoc.org/github.com/coreos/etcd/wal\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/coreos/etcd/wal</a>) to do write-ahead logging. wal has <code>go.uber.org/zap</code> in its vendor packages. In wal's create function <code>func Create(lg *zap.Logger, dirpath string, metadata []byte) (*WAL, error)</code>, I need to pass in <code>zap.Logger</code>. </p>\n\n<p>I have tried to import <code>go.uber.org/zap</code> but go compiler complains \"type mismatch\" when I pass in <code>zap.Logger</code>. </p>\n\n<pre><code>package main \n\nimport (\n\"github.com/coreos/etcd/wal\"\n)\n\nfunc check(e error) {\n    if e != nil {\n        panic(e)\n    }\n}\n\nfunc main() {\n\n    metadata := []byte{}\n    w, err := wal.Create(zap.NewExample(), \"/tmp/hello\", metadata)\n\n    // err := w.Save(s, ents)\n\n\n}\n</code></pre>\n\n<p>How should I use <code>zap.Logger</code> in my project?</p>\n"}, {"tags": ["go", "amazon-sqs", "goroutine"], "comments": [{"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1546407791, "post_id": 54001544, "comment_id": 94840202, "body": "Shared code looks good. Make sure you do not exit from loop (continue) or panic without logging that event. Share more code if that is still not resolved."}, {"owner": {"reputation": 762, "user_id": 3052074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/619c2a3b094423dd741dc8eb161836f0?s=128&d=identicon&r=PG", "display_name": "Andrey Dyatlov", "link": "https://stackoverflow.com/users/3052074/andrey-dyatlov"}, "edited": false, "score": 0, "creation_date": 1546408941, "post_id": 54001544, "comment_id": 94840486, "body": "What do you mean by saying that the goroutine is irresponsive? Does it mean that when messages appear in the queue, the worker doesn&#39;t handle them anymore?"}, {"owner": {"reputation": 1246, "user_id": 4516106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37134b731235c61f94701c9e5d6882cf?s=128&d=identicon&r=PG", "display_name": "khue bui", "link": "https://stackoverflow.com/users/4516106/khue-bui"}, "reply_to_user": {"reputation": 762, "user_id": 3052074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/619c2a3b094423dd741dc8eb161836f0?s=128&d=identicon&r=PG", "display_name": "Andrey Dyatlov", "link": "https://stackoverflow.com/users/3052074/andrey-dyatlov"}, "edited": false, "score": 0, "creation_date": 1546410658, "post_id": 54001544, "comment_id": 94840957, "body": "Yes. @AndreyDyatlov"}, {"owner": {"reputation": 762, "user_id": 3052074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/619c2a3b094423dd741dc8eb161836f0?s=128&d=identicon&r=PG", "display_name": "Andrey Dyatlov", "link": "https://stackoverflow.com/users/3052074/andrey-dyatlov"}, "edited": false, "score": 2, "creation_date": 1546411328, "post_id": 54001544, "comment_id": 94841196, "body": "From the example, it&#39;s hard to understand, which part of it is just a sketch or simplification, and which is essential. For example, if the program would compile it exits immediately after printing the greeting as the <code>main()</code> function doesn&#39;t wait till the goroutine is complete. Another suspicious thing is that you are starting the worker in the <code>init()</code> function. Could you please try to come up with a minimum viable example to reproduce the problem."}, {"owner": {"reputation": 1246, "user_id": 4516106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37134b731235c61f94701c9e5d6882cf?s=128&d=identicon&r=PG", "display_name": "khue bui", "link": "https://stackoverflow.com/users/4516106/khue-bui"}, "edited": false, "score": 0, "creation_date": 1546412435, "post_id": 54001544, "comment_id": 94841547, "body": "Actually, the worker seem to be freezed after a while, It mean that the goroutine already complete the initialization. I updated example here <a href=\"https://play.golang.org/p/wEVHmajqlCF\" rel=\"nofollow noreferrer\">play.golang.org/p/wEVHmajqlCF</a>. Note that I didn&#39;t get any logs"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1546412773, "post_id": 54001544, "comment_id": 94841648, "body": "All questions must be complete without following links. Please put the relevant portion of code directly into the question."}, {"owner": {"reputation": 1246, "user_id": 4516106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37134b731235c61f94701c9e5d6882cf?s=128&d=identicon&r=PG", "display_name": "khue bui", "link": "https://stackoverflow.com/users/4516106/khue-bui"}, "edited": false, "score": 0, "creation_date": 1546413081, "post_id": 54001544, "comment_id": 94841764, "body": "Got it, I updated relevant code in question above."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546442400, "post_id": 54001544, "comment_id": 94854229, "body": "Not sure what the problem is but I can guarantee you it&#39;s nothing to do with GC."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1546446312, "post_id": 54001544, "comment_id": 94856232, "body": "What is the are the workers actually <i>doing</i> when you say it they are unresponsive? If there are goroutines, then you can see their stacks. If they&#39;re blocked then you can see where in their stack traces. If they&#39;re executing code, you can see that in a profile."}, {"owner": {"reputation": 1246, "user_id": 4516106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37134b731235c61f94701c9e5d6882cf?s=128&d=identicon&r=PG", "display_name": "khue bui", "link": "https://stackoverflow.com/users/4516106/khue-bui"}, "edited": false, "score": 0, "creation_date": 1546487636, "post_id": 54001544, "comment_id": 94869024, "body": "Sadly, I didn&#39;t track stack traces or profile, the problem is hard to reproduce. I am keeping invest into it."}], "answers": [{"comments": [{"owner": {"reputation": 1246, "user_id": 4516106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37134b731235c61f94701c9e5d6882cf?s=128&d=identicon&r=PG", "display_name": "khue bui", "link": "https://stackoverflow.com/users/4516106/khue-bui"}, "edited": false, "score": 0, "creation_date": 1546419045, "post_id": 54003128, "comment_id": 94843619, "body": "In fact, I have a simple server that handle some APIs, so that <i>userWorker</i> will not exit immediately. Sorry for the lack of clarification."}], "tags": [], "owner": {"reputation": 762, "user_id": 3052074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/619c2a3b094423dd741dc8eb161836f0?s=128&d=identicon&r=PG", "display_name": "Andrey Dyatlov", "link": "https://stackoverflow.com/users/3052074/andrey-dyatlov"}, "is_accepted": false, "score": 0, "last_activity_date": 1546417262, "last_edit_date": 1546417262, "creation_date": 1546416750, "answer_id": 54003128, "question_id": 54001544, "link": "https://stackoverflow.com/questions/54001544/goroutines-dont-reply-after-a-while/54003128#54003128", "title": "Goroutines don&#39;t reply after a while", "body": "<p>This program will exit immediately after the <code>fmt.Println(\"Hello, playground\")</code> command is complete. You can use the <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">wait group</a> or a channel to keep the goroutine running.</p>\n\n<pre><code>func main() {\n    go userWorker()\n    c := make(chan struct{})\n    &lt;-c\n}\n\nfunc userWorker() {\n...\n}\n</code></pre>\n"}], "owner": {"reputation": 1246, "user_id": 4516106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37134b731235c61f94701c9e5d6882cf?s=128&d=identicon&r=PG", "display_name": "khue bui", "link": "https://stackoverflow.com/users/4516106/khue-bui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 123, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1546418908, "creation_date": 1546406265, "last_edit_date": 1546418908, "question_id": 54001544, "link": "https://stackoverflow.com/questions/54001544/goroutines-dont-reply-after-a-while", "title": "Goroutines don&#39;t reply after a while", "body": "<p>I initialize a <em>goroutine</em> as a worker, to continuously receive messages from <em>aws sqs</em>.</p>\n\n<p>The worker works like a charm until there are no message receive from <em>sqs queue</em>. The worker seem to lost (unresponsive). </p>\n\n<p>Is the problem relative to GC? Anyone encounter this problem?</p>\n\n<p>Here is simple code <a href=\"https://play.golang.org/p/CuyvUy7b_Sf\" rel=\"nofollow noreferrer\">https://play.golang.org/p/CuyvUy7b_Sf</a> .</p>\n\n<p><strong>Updated</strong>:</p>\n\n<pre><code>func main() {\n    // Init router\n    // Handling some APIs\n    // ...\n}\n\nfunc userWorker() {\n    sqsClient := getSqsClient()\n    for {\n        result, err := sqsClient.ReceiveMessage(&amp;sqs.ReceiveMessageInput{\n            QueueUrl:            aws.String(queueURL),,\n            MaxNumberOfMessages: aws.Int64(1),\n            MessageAttributeNames: aws.StringSlice([]string{\n                \"All\",\n            }),\n            WaitTimeSeconds: aws.Int64(1), // wait for seconds\n        })\n        if err != nil {\n            log.Printf(\"Unable to receive message from sqs queue  %v.\", err)\n            continue\n        }\n\n        if len(result.Messages) &gt; 0 {\n            if result.Messages[0].MessageAttributes[\"payload\"] != nil {\n                // extract payload\n                messagePayload := result.Messages[0].MessageAttributes[\"payload\"].BinaryValue\n                var payload schema.UsersWorkerPayload\n                err = msgpack.Unmarshal(messagePayload, &amp;payload)\n                if err != nil {\n                    log.Printf(\"Error when msgpack decodes payload %v\", err)\n                    continue\n                }\n\n                // get devices tokens from userIDs\n                tokenIDs, err := db.GetTokenIdByUsers(payload.UserIds)\n                if err != nil {\n                    log.Printf(\"userWorker error GetTokenIdByUsers %v\", err)\n                    continue\n                }\n                if len(tokenIDs) == 0 {\n                    log.Println(\"Could not get token ID.\")\n                    continue\n                }\n\n                results, err := fcm.PushToTokenIDs(tokenIDs, payload.Payload)\n                if err != nil {\n                    log.Printf(\"userWorker PushToTokenIDs error %v\", err)\n                    continue\n                } else {\n                    // delete message if everything is ok\n                    err = mrsqs.DeleteMessage(config.UserQueueName, result.Messages[0].ReceiptHandle)\n                    if err != nil {\n                        log.Printf(\"Error when delete sqs message %v\", err)\n                    }\n                }\n            }\n        }\n    }\n}\n\nfunc init() {\n    go userWorker()\n}\n</code></pre>\n"}, {"tags": ["function", "go", "methods", "reflection", "types"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 10855821, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FglpkY1YDEg/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ8KCB8Uz0yM06guJPIlfKsqGJfIg/mo/photo.jpg?sz=128", "display_name": "mrj Js", "link": "https://stackoverflow.com/users/10855821/mrj-js"}, "edited": false, "score": 0, "creation_date": 1546428118, "post_id": 54000301, "comment_id": 94847461, "body": "I changed the receive, but panic . <a href=\"https://play.golang.org/p/gvA55CClCQ7\" rel=\"nofollow noreferrer\">https://play.golang.org/p/gvA55CClCQ7</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 23, "user_id": 10855821, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FglpkY1YDEg/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ8KCB8Uz0yM06guJPIlfKsqGJfIg/mo/photo.jpg?sz=128", "display_name": "mrj Js", "link": "https://stackoverflow.com/users/10855821/mrj-js"}, "edited": false, "score": 0, "creation_date": 1546433026, "post_id": 54000301, "comment_id": 94849679, "body": "@mrjJs Because you used a pointer receiver, so the method is not in the method set of the non-pointer type. It works if you remove the <code>reflect.Indirect()</code> call: <a href=\"https://play.golang.org/p/8mDHN0gRs16\" rel=\"nofollow noreferrer\">play.golang.org/p/8mDHN0gRs16</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1546394197, "last_edit_date": 1546394197, "creation_date": 1546392912, "answer_id": 54000301, "question_id": 54000263, "link": "https://stackoverflow.com/questions/54000263/how-to-assert-a-func-to-a-type-by-reflect/54000301#54000301", "title": "How to assert a func to a type by reflect?", "body": "<p>The method <code>TestService.Foo</code> is of type <code>func(a int) error</code>, which is not the same as type <code>Handle</code> (<code>Handle</code> has the same underlying type, but it is a new, distinct type).</p>\n\n<p>You have to check for this exact type:</p>\n\n<pre><code>case func(a int) error:\n    fmt.Println(\" okokok \")\n</code></pre>\n\n<p>With this change, output will be:</p>\n\n<pre><code>=== RUN   TestHandle\n okokok \n--- PASS: TestHandle (0.00s)\nPASS\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/E3TvJ5Dtl48\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>Note that you can do the same with a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a>, e.g.:</p>\n\n<pre><code>if _, ok := reflect.Indirect(val).Method(0).Interface().(func(a int) error); ok {\n    fmt.Println(\" okokok \")\n}\n</code></pre>\n\n<p>Try this one on the <a href=\"https://play.golang.org/p/lxJHAbj_L40\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>Also note that if you do want to use the <code>Handle</code> type definition, you could check if the function value is <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">assignable</a> to a variable of <code>Handle</code> type. Using reflection, this check essentially means if the type of the method is assignable to the type of <code>Handle</code>.</p>\n\n<p>This is how it would look like:</p>\n\n<pre><code>th := reflect.TypeOf(Handle(nil))\nif reflect.Indirect(val).Method(0).Type().AssignableTo(th) {\n    fmt.Println(\" okokok \")\n}\n</code></pre>\n\n<p>Try this one on the <a href=\"https://play.golang.org/p/si9hlokjxJe\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<h2>Obtaining the function value</h2>\n\n<p>Solutions above only check if the given method is of the given function type. If you also need the function value (so you can call it), this is how you can do it:</p>\n\n<p>When using type switch (<a href=\"https://play.golang.org/p/CE4Ah9hZkcS\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>switch hf := reflect.Indirect(val).Method(0).Interface().(type) {\ncase func(a int) error:\n    fmt.Println(\" okokok \", hf(0))\ndefault:\n    fmt.Println(reflect.Indirect(val).Method(0).Type())\n}\n</code></pre>\n\n<p>When using type assertion (<a href=\"https://play.golang.org/p/glrsIa4I4IA\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>if hf, ok := reflect.Indirect(val).Method(0).Interface().(func(a int) error); ok {\n    fmt.Println(\" okokok \", hf(0))\n}\n</code></pre>\n\n<p>Using <a href=\"https://golang.org/pkg/reflect/#Value.Convert\" rel=\"nofollow noreferrer\"><code>Value.Convert()</code></a> (<a href=\"https://play.golang.org/p/7PPrmYcKzKN\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>m := reflect.Indirect(val).Method(0)\nth := reflect.TypeOf(Handle(nil))\nif m.Type().AssignableTo(th) {\n    var hf Handle = m.Convert(th).Interface().(Handle)\n    fmt.Println(\" okokok \", hf(0))\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 10855821, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-FglpkY1YDEg/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ8KCB8Uz0yM06guJPIlfKsqGJfIg/mo/photo.jpg?sz=128", "display_name": "mrj Js", "link": "https://stackoverflow.com/users/10855821/mrj-js"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 339, "favorite_count": 1, "accepted_answer_id": 54000301, "answer_count": 1, "score": 2, "last_activity_date": 1546394197, "creation_date": 1546392498, "last_edit_date": 1546393647, "question_id": 54000263, "link": "https://stackoverflow.com/questions/54000263/how-to-assert-a-func-to-a-type-by-reflect", "title": "How to assert a func to a type by reflect?", "body": "<p>I am writing an RPC service in Go. I don't know how to convert a struct method to a <code>Handler</code> func.</p>\n\n<p>What I tried:</p>\n\n<pre><code>type TestService struct{}\n\nfunc (TestService) Foo(a int) error {\n    return nil\n}\n\ntype Handle func(a int) error\n\nfunc TestHandle(t *testing.T) {\n    ts := new(TestService)\n    val := reflect.ValueOf(ts)\n    // typ := reflect.TypeOf(ts)\n\n    // fmt.Println(val.Method(0).Interface())\n    // fmt.Println(val.Method(0).Type().ConvertibleTo(reflect.TypeOf(new(Handle))))\n\n    switch reflect.Indirect(val).Method(0).Interface().(type) {\n    case Handle:\n        fmt.Println(\" okokok \" )\n    default:\n        fmt.Println(reflect.Indirect(val).Method(0).Type())\n    }\n}\n</code></pre>\n\n<p>But it fails. How should I do it?</p>\n"}, {"tags": ["go", "templates", "go-gin"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1546374187, "post_id": 53998644, "comment_id": 94834359, "body": "<code>$.errMessage</code>. From the docs: <i>&quot; When execution begins, $ is set to the data argument passed to Execute, that is, to the starting value of dot. &quot;</i>"}], "answers": [{"tags": [], "owner": {"reputation": 315, "user_id": 5342427, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2d3f939f739ee4adca858ded1682dbb3?s=128&d=identicon&r=PG&f=1", "display_name": "rbo13", "link": "https://stackoverflow.com/users/5342427/rbo13"}, "is_accepted": true, "score": 3, "last_activity_date": 1546388914, "creation_date": 1546388914, "answer_id": 54000025, "question_id": 53998644, "link": "https://stackoverflow.com/questions/53998644/how-to-show-variable-in-golang-template-inside-range/54000025#54000025", "title": "How to show variable in Golang template inside range", "body": "<p>Can you show what is the error message? I deduce that your <code>.errMessage</code> is out of scope inside your <code>{{ range .files }}</code> syntax. </p>\n\n<p>So to fix this problem, you will just declare your <code>.errMessage</code> on top of your <code>{{ range .files }}</code> syntax. </p>\n\n<p>Though its not necessary to declare it on top, the main key here is that you should assign your <code>.errMessage</code> to another variable inside of your template.</p>\n\n<p>It would look something like this ( based on your example ):</p>\n\n<pre><code>...\n{{ $errMessage := .errMessage }}\n\n{{ range .files }}\n&lt;tr&gt;\n  &lt;td&gt;{{.}}&lt;/td&gt;\n  &lt;td&gt;&lt;a href=\"/download?filename={{.}}\" style=\"color:blue;\"&gt;Download&lt;/a&gt;&lt;/td&gt;\n  &lt;td&gt;&lt;a href=\"/delete?filename={{.}}\" style=\"color:red;\"&gt;Delete&lt;/a&gt;&lt;/td&gt;\n  &lt;td&gt;&lt;button id=\"{{.}}\"&gt;\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c&lt;/button&gt;&lt;/td&gt;\n  {{ if $errMessage }} &lt;td style=\"color:red;\"&gt;Processing...&lt;/td&gt;\n  {{ else }} &lt;td&gt;Done&lt;/td&gt; {{ end }}\n&lt;/tr&gt;\n{{ end }}\n...\n</code></pre>\n\n<p>Hope that helps! Cheers!</p>\n"}], "owner": {"reputation": 245, "user_id": 5175272, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/221471e0c5f933f312d99f5470ecb3da?s=128&d=identicon&r=PG&f=1", "display_name": "Rattrap", "link": "https://stackoverflow.com/users/5175272/rattrap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 54000025, "answer_count": 1, "score": 0, "last_activity_date": 1597439041, "creation_date": 1546373928, "last_edit_date": 1597439041, "question_id": 53998644, "link": "https://stackoverflow.com/questions/53998644/how-to-show-variable-in-golang-template-inside-range", "title": "How to show variable in Golang template inside range", "body": "<p>I have some code on the server:</p>\n<pre><code>c.HTML(http.StatusOK, &quot;videos.html&quot;, gin.H{\n    &quot;files&quot;: files, //slice\n    &quot;errMessage&quot;: errMessage,\n})\n</code></pre>\n<p>And I have some code on the client:</p>\n<pre><code>{{ range .files }}\n&lt;tr&gt;\n  &lt;td&gt;{{.}}&lt;/td&gt;\n  &lt;td&gt;&lt;a href=&quot;/download?filename={{.}}&quot; style=&quot;color:blue;&quot;&gt;Download&lt;/a&gt;&lt;/td&gt;\n  &lt;td&gt;&lt;a href=&quot;/delete?filename={{.}}&quot; style=&quot;color:red;&quot;&gt;Delete&lt;/a&gt;&lt;/td&gt;\n  &lt;td&gt;&lt;button id=&quot;{{.}}&quot;&gt;\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c&lt;/button&gt;&lt;/td&gt;\n  {{ if .errMessage }} &lt;td style=&quot;color:red;&quot;&gt;Processing...&lt;/td&gt;\n  {{ else }} &lt;td&gt;Done&lt;/td&gt; {{ end }}\n&lt;/tr&gt;\n{{ end }}\n</code></pre>\n<p>How to deal with .errMessage?</p>\n"}, {"tags": ["go", "scope", "overriding"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 5, "creation_date": 1546363555, "post_id": 53997412, "comment_id": 94832123, "body": "<i>&quot;How can I display the global variable &#39;a&#39; inside the main function&quot;</i>. By not creating a local variable with the same name."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1546437670, "post_id": 53997412, "comment_id": 94851922, "body": "1.) I didn&#39;t say it isn&#39;t possible in C/C++. 2.) Your question was about Go and so was my comment."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 10854905, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VZMY0wotnsE/AAAAAAAAAAI/AAAAAAAAACg/ZVXXbEDHvxc/photo.jpg?sz=128", "display_name": "Nivas", "link": "https://stackoverflow.com/users/10854905/nivas"}, "edited": false, "score": 0, "creation_date": 1546364705, "post_id": 53997514, "comment_id": 94832380, "body": "I&#39;m actually from C++ where we use it quite a few times while learning and it can be shadowed easily using &quot;:&quot; operator. So I was just thinking is it possible in Go.   Thanks for your help."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "reply_to_user": {"reputation": 1, "user_id": 10854905, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VZMY0wotnsE/AAAAAAAAAAI/AAAAAAAAACg/ZVXXbEDHvxc/photo.jpg?sz=128", "display_name": "Nivas", "link": "https://stackoverflow.com/users/10854905/nivas"}, "edited": false, "score": 2, "creation_date": 1546371712, "post_id": 53997514, "comment_id": 94833866, "body": "@Nivas That a language allows you to do something, doesn&#39;t mean it&#39;s a good idea! I&#39;ve lost count of the number of bugs tracked down to a shadowed variable. At least in Go, <code>go vet -shadow</code> can help catch some of these before they cause serious problems."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 4, "last_activity_date": 1546363919, "creation_date": 1546363919, "answer_id": 53997514, "question_id": 53997412, "link": "https://stackoverflow.com/questions/53997412/overriding-scope-in-go/53997514#53997514", "title": "Overriding Scope in Go", "body": "<p>What you're doing is called \"variable shadowing\".  If you want to access the global variable, the only option is simply to <em>not shadow it</em>!</p>\n\n<pre><code>var a int = 10\n\nfunc main() {\n    var localA int = 20\n    fmt.Println(a) // 10\n    fmt.Println(localA) // 20\n}\n</code></pre>\n\n<p>Of course, you could preserve the global value in a different local variable before shadowing. I can't imagine when this would actually be <em>useful</em>:</p>\n\n<pre><code>var a int = 10\n\nfunc main() {\n    globalA := a\n    var a int = 20\n    fmt.Println(a) // 20\n    fmt.Println(globalA) // 10\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10854905, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VZMY0wotnsE/AAAAAAAAAAI/AAAAAAAAACg/ZVXXbEDHvxc/photo.jpg?sz=128", "display_name": "Nivas", "link": "https://stackoverflow.com/users/10854905/nivas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "closed_date": 1546390565, "accepted_answer_id": 53997514, "answer_count": 1, "score": 0, "last_activity_date": 1546363919, "creation_date": 1546362997, "question_id": 53997412, "link": "https://stackoverflow.com/questions/53997412/overriding-scope-in-go", "closed_reason": "Duplicate", "title": "Overriding Scope in Go", "body": "<p>I'm actually new to go and I'm unable to find how to override scope of the variable in Go</p>\n\n<p>consider this...</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nvar x = 10\nvar a int = 10\n\nfunc main() {\n    var a int = 20\n    fmt.Println(a)\n}\n</code></pre>\n\n<p>When I run it the output is 20 which means it actually prints the local scope variable</p>\n\n<p>How can I display the global variable 'a' inside the main function</p>\n"}, {"tags": ["json", "dictionary", "go", "interface", "nested"], "comments": [{"owner": {"reputation": 762, "user_id": 3052074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/619c2a3b094423dd741dc8eb161836f0?s=128&d=identicon&r=PG", "display_name": "Andrey Dyatlov", "link": "https://stackoverflow.com/users/3052074/andrey-dyatlov"}, "edited": false, "score": 0, "creation_date": 1546407945, "post_id": 53997328, "comment_id": 94840248, "body": "As @a-h said, the structure of the JSON is not very bad, and it&#39;s possible to compose a correspondent Go struct. If it wouldn&#39;t be the case and you can rely only on field names and types, then I would recommend parsing such JSON <a href=\"https://golang.org/pkg/encoding/json/#Decoder.Token\" rel=\"nofollow noreferrer\">token by token</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3800, "user_id": 1037465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b68d0fdfc74f6a893936d043d2f545b?s=128&d=identicon&r=PG", "display_name": "a-h", "link": "https://stackoverflow.com/users/1037465/a-h"}, "is_accepted": false, "score": 4, "last_activity_date": 1546369286, "creation_date": 1546369286, "answer_id": 53998134, "question_id": 53997328, "link": "https://stackoverflow.com/questions/53997328/how-to-parse-a-nest-json-file-with-unknown-structure-golang/53998134#53998134", "title": "How to parse a nest json file with unknown structure Golang", "body": "<p>Once you have data as a <code>map[string]interface{}</code>, you can use type assertions to get to the lower levels of data.</p>\n\n<p>There's a good explanation here of how to do this at <a href=\"https://blog.golang.org/json-and-go\" rel=\"nofollow noreferrer\">https://blog.golang.org/json-and-go</a></p>\n\n<p>Here's an example to get you most of the way:</p>\n\n<p><a href=\"https://play.golang.org/p/P8cGP1mTDmD\" rel=\"nofollow noreferrer\">https://play.golang.org/p/P8cGP1mTDmD</a></p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\nfunc main() {\n    jsonData := `{\n    \"string\": \"string_value\",\n    \"number\": 123.45,\n    \"js_array\": [\"a\", \"b\", \"c\"],\n    \"integer\": 678,\n    \"subtype\": {\n        \"number_array\": [1, 2, 3]\n      }\n    }`\n\n    m := map[string]interface{}{}\n    err := json.Unmarshal([]byte(jsonData), &amp;m)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    for key, value := range m {\n        switch v := value.(type) {\n        case int:\n            fmt.Printf(\"Key: %s, Integer: %d\\n\", key, v)\n        case float64:\n            fmt.Printf(\"Key: %s, Float: %v\\n\", key, v)\n        case string:\n            fmt.Printf(\"Key: %s, String: %s\\n\", key, v)\n        case map[string]interface{}:\n            fmt.Printf(\"Key: %s, Subtype: %+v\\n\", key, v)\n        case []interface{}:\n            //TODO: Read through each item in the interface and work out what type it is.\n            fmt.Printf(\"Key: %s, []interface: %v\\n\", key, v)\n        default:\n            fmt.Printf(\"Key: %s, unhandled type: %+v\\n\", key, v)\n        }\n    }\n}\n</code></pre>\n\n<p>Alternatively <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">https://mholt.github.io/json-to-go/</a> does a decent job of turning examples of JSON data into Go structs that can be used for marshalling.</p>\n\n<p>Putting the example in, I get something that isn't too bad.</p>\n\n<pre><code>type AutoGenerated struct {\n    Data []struct {\n        Acronym     interface{}   `json:\"acronym\"`\n        Badges      []interface{} `json:\"badges\"`\n        CreatedAt   string        `json:\"created_at\"`\n        Deleted     interface{}   `json:\"deleted\"`\n        Description string        `json:\"description\"`\n        Extras      struct {\n        } `json:\"extras\"`\n        Frequency     string      `json:\"frequency\"`\n        FrequencyDate interface{} `json:\"frequency_date\"`\n        ID            string      `json:\"id\"`\n        LastModified  string      `json:\"last_modified\"`\n        LastUpdate    string      `json:\"last_update\"`\n        License       string      `json:\"license\"`\n        Metrics       struct {\n            Discussions    int `json:\"discussions\"`\n            Followers      int `json:\"followers\"`\n            Issues         int `json:\"issues\"`\n            NbHits         int `json:\"nb_hits\"`\n            NbUniqVisitors int `json:\"nb_uniq_visitors\"`\n            NbVisits       int `json:\"nb_visits\"`\n            Reuses         int `json:\"reuses\"`\n            Views          int `json:\"views\"`\n        } `json:\"metrics\"`\n        Organization struct {\n            Acronym       string `json:\"acronym\"`\n            Class         string `json:\"class\"`\n            ID            string `json:\"id\"`\n            Logo          string `json:\"logo\"`\n            LogoThumbnail string `json:\"logo_thumbnail\"`\n            Name          string `json:\"name\"`\n            Page          string `json:\"page\"`\n            Slug          string `json:\"slug\"`\n            URI           string `json:\"uri\"`\n        } `json:\"organization\"`\n        Owner     interface{} `json:\"owner\"`\n        Page      string      `json:\"page\"`\n        Private   bool        `json:\"private\"`\n        Resources []struct {\n            Checksum struct {\n                Type  string `json:\"type\"`\n                Value string `json:\"value\"`\n            } `json:\"checksum\"`\n            CreatedAt   string      `json:\"created_at\"`\n            Description interface{} `json:\"description\"`\n            Extras      struct {\n            } `json:\"extras\"`\n            Filesize     int    `json:\"filesize\"`\n            Filetype     string `json:\"filetype\"`\n            Format       string `json:\"format\"`\n            ID           string `json:\"id\"`\n            LastModified string `json:\"last_modified\"`\n            Latest       string `json:\"latest\"`\n            Metrics      struct {\n                NbHits         int `json:\"nb_hits\"`\n                NbUniqVisitors int `json:\"nb_uniq_visitors\"`\n                NbVisits       int `json:\"nb_visits\"`\n                Views          int `json:\"views\"`\n            } `json:\"metrics\"`\n            Mime       string `json:\"mime\"`\n            PreviewURL string `json:\"preview_url\"`\n            Published  string `json:\"published\"`\n            Title      string `json:\"title\"`\n            Type       string `json:\"type\"`\n            URL        string `json:\"url\"`\n        } `json:\"resources\"`\n        Slug             string        `json:\"slug\"`\n        Spatial          interface{}   `json:\"spatial\"`\n        Tags             []interface{} `json:\"tags\"`\n        TemporalCoverage interface{}   `json:\"temporal_coverage\"`\n        Title            string        `json:\"title\"`\n        URI              string        `json:\"uri\"`\n    } `json:\"data\"`\n    Facets struct {\n        Format [][]interface{} `json:\"format\"`\n    } `json:\"facets\"`\n    NextPage     string      `json:\"next_page\"`\n    Page         int         `json:\"page\"`\n    PageSize     int         `json:\"page_size\"`\n    PreviousPage interface{} `json:\"previous_page\"`\n    Total        int         `json:\"total\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 111, "user_id": 10412696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/551b0ea14f1f7576f881992998108f3d?s=128&d=identicon&r=PG&f=1", "display_name": "Emanolo78", "link": "https://stackoverflow.com/users/10412696/emanolo78"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1220, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1546369286, "creation_date": 1546362253, "last_edit_date": 1546363218, "question_id": 53997328, "link": "https://stackoverflow.com/questions/53997328/how-to-parse-a-nest-json-file-with-unknown-structure-golang", "title": "How to parse a nest json file with unknown structure Golang", "body": "<p>I am trying to parse and get selected data from a deep nested json data in Go Lang. I'm having issues navigating through the structure and accessing the data. The data is too deep and complex to be parsed with a-priori known structures in Go.\nHere is the URL of the file:\n-<a href=\"https://www.data.gouv.fr/api/1/datasets/?format=csv&amp;page=0&amp;page_size=20\" rel=\"nofollow noreferrer\">https://www.data.gouv.fr/api/1/datasets/?format=csv&amp;page=0&amp;page_size=20</a></p>\n\n<p>I did some parsing with map interfaces and using a json string:</p>\n\n<pre><code>resultdata := map[string]interface {}\n\njson.Unmarshal([]byte(inputbytestring), &amp;resultdata) //Inputstring is the string containing the JSON data of the above URL\n</code></pre>\n\n<p>The problem:</p>\n\n<ul>\n<li>How can turn resultdata into a map (of strings), so I can use methods available for maps?</li>\n<li>The JSON data is nested and has several levels. How is it possible to access the lower level JSON fields? is it possible to unmarshal the data recursively?</li>\n</ul>\n"}, {"tags": ["api", "unit-testing", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1546360767, "post_id": 53997114, "comment_id": 94831507, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/31352239/how-to-test-the-main-package-functions-in-golang\">How to test the main package functions in golang?</a>"}, {"owner": {"reputation": 540, "user_id": 4266924, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/gdlAn.png?s=128&g=1", "display_name": "tomfl", "link": "https://stackoverflow.com/users/4266924/tomfl"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546361266, "post_id": 53997114, "comment_id": 94831628, "body": "I read this post before posting, but it didn&#39;t answer my question because in that post the person has his tests in the main package. The reason why I asked my question is because I don&#39;t want to have my tests in the main package. I&#39;d rather have them all in a <code>test</code> folder inside the same package."}, {"owner": {"reputation": 540, "user_id": 4266924, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/gdlAn.png?s=128&g=1", "display_name": "tomfl", "link": "https://stackoverflow.com/users/4266924/tomfl"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546361405, "post_id": 53997114, "comment_id": 94831672, "body": "@Flimzy I edited my post, if you&#39;re a moderator could you remove the &quot;duplicate&quot; header please ?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1546361770, "post_id": 53997114, "comment_id": 94831749, "body": "&quot;in a test folder inside the same package&quot; isn&#39;t possible in Go. Packages are folder-scoped."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1546361805, "post_id": 53997114, "comment_id": 94831758, "body": "You can\u2019t import \u201cmain\u201d, so you test it from within the \u201cmain\u201d package. There l\u2019s not point in fighting the go tools, just do it the same way as every other project."}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1546363435, "post_id": 53997114, "comment_id": 94832108, "body": "It may help if you can show your directory structure as a figure or simple text with appropriate indentations or use output of <code>tree</code> command (in Linux) to clarify it."}], "answers": [{"comments": [{"owner": {"reputation": 540, "user_id": 4266924, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/gdlAn.png?s=128&g=1", "display_name": "tomfl", "link": "https://stackoverflow.com/users/4266924/tomfl"}, "edited": false, "score": 0, "creation_date": 1546396521, "post_id": 54000234, "comment_id": 94838185, "body": "Thanks for the answer. But what if all my tests need to have access to the same function(s) ? For example, in my tests I often need to empty some tables so I have a function called &quot;clearTable(tableName)&quot;. Is there a proper way of sharing all those functions or should I just copy - paste the functions I want to share for each file ?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 540, "user_id": 4266924, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/gdlAn.png?s=128&g=1", "display_name": "tomfl", "link": "https://stackoverflow.com/users/4266924/tomfl"}, "edited": false, "score": 1, "creation_date": 1546401163, "post_id": 54000234, "comment_id": 94838917, "body": "@tomfl Functions have package scope.  Put the functions in any package file.  If the functions are only used in tests, out the functions in a _test.go file."}, {"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "reply_to_user": {"reputation": 540, "user_id": 4266924, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/gdlAn.png?s=128&g=1", "display_name": "tomfl", "link": "https://stackoverflow.com/users/4266924/tomfl"}, "edited": false, "score": 0, "creation_date": 1546403836, "post_id": 54000234, "comment_id": 94839339, "body": "@tomfl I typically move all shared testing routines into dedicated package called <code>mock</code>. In my case it is mocks for repositories and external services that reused in tests against different packages. You need is slightly different, but solution is the same. So, tests are still stored close to code in the same package as code, but utilities are stored in dedicated package."}], "tags": [], "owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "is_accepted": false, "score": 1, "last_activity_date": 1546394052, "last_edit_date": 1546394052, "creation_date": 1546392065, "answer_id": 54000234, "question_id": 53997114, "link": "https://stackoverflow.com/questions/53997114/how-to-test-the-main-package-in-golang-from-a-test-package/54000234#54000234", "title": "How to test the main package in Golang from a &quot;test&quot; package?", "body": "<p>What you want to do is not not possible in GO (assuming you want to test private functions).</p>\n\n<blockquote>\n  <p>because I don't want to have my tests in the main package. I'd rather\n  have them all in a test folder inside the same package.</p>\n</blockquote>\n\n<p>Your code belongs to different package if you move it into different folder.</p>\n\n<p>This is how GO defines packages <a href=\"https://golang.org/doc/code.html#Organization\" rel=\"nofollow noreferrer\">https://golang.org/doc/code.html#Organization</a>:</p>\n\n<blockquote>\n  <p>Each package consists of one or more Go source files in a <strong>single</strong>\n  directory.</p>\n</blockquote>\n\n<p>This is how your code structured:</p>\n\n<pre><code>main\n| -- main.go (package main)\n+ -- test\n     | -- main_test.go (package test)\n</code></pre>\n\n<p>It is idiomatic to keep tests in the same folder with code. It is normal if language or framework set some rules that developer has to follow. GO is pretty strict about that.</p>\n\n<p>This is how you can organize your code: </p>\n\n<pre><code>main\n| -- main.go (package main)\n| -- main_test.go (package main_test)\n| -- main_private_test.go (package main)\n</code></pre>\n\n<p>Often it makes sense to test code against its pubic interfaces. The best way to do that that, is to put tests into different package. GO convention is to keep tests in the same folder what leads to using the same package name. There is a workaround for that issue. You can add <code>_test</code> (package main_test) prefix to package name for your tests. </p>\n\n<p>If, that is not possible to test your code using public interfaces, you can add another file with tests and use <code>package main</code> in that file.  </p>\n"}], "owner": {"reputation": 540, "user_id": 4266924, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/gdlAn.png?s=128&g=1", "display_name": "tomfl", "link": "https://stackoverflow.com/users/4266924/tomfl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2513, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1546394052, "creation_date": 1546360430, "last_edit_date": 1546361362, "question_id": 53997114, "link": "https://stackoverflow.com/questions/53997114/how-to-test-the-main-package-in-golang-from-a-test-package", "title": "How to test the main package in Golang from a &quot;test&quot; package?", "body": "<p>I have a simple program written in Golang. It's an API. So inside the project folder, there's a folder named <code>cmd</code> containing my <code>main</code> package (used to initialise the app and defines the endpoints for the API). There's also a folder named after my program, containing multiple files from a package also named after my program. This package serves as the model to do all the necessary queries and contains all the types I have defined.</p>\n\n<p>I also created a folder called <code>test</code>. It contains all my test files under the package named <code>test</code>. The problem is that to run the tests, I have to access my main package ! Is there a way to do that in Golang ? I tried simply using <code>import \"cmd/main\"</code> but of course it doesn't work.</p>\n\n<p>I also had an idea. Perhaps I could move all my initialising functions (in the <code>cmd</code> folder) to the package named after my program. This way I could do a regular <code>import</code> in <code>test</code>. And I create, inside of <code>cmd</code>, a <code>main.go</code> in the <code>main</code> package that serves as the entry point for the compiler.</p>\n\n<p>I'm new to Go so I'm not really confident. Do you think it's the right way ?</p>\n\n<p>Thanks.</p>\n\n<p>EDIT : Apparently some people think this question is a duplicate, but it's not. Here's the explanation I gave in on of the comments :</p>\n\n<blockquote>\n  <p>I read this post before posting, but it didn't answer my question\n  because in that post the person has his tests in the main package. The\n  reason why I asked my question is because I don't want to have my\n  tests in the main package. I'd rather have them all in a test folder\n  inside the same package.</p>\n</blockquote>\n"}, {"tags": ["templates", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1546356760, "post_id": 53996619, "comment_id": 94830576, "body": "You&#39;re not passing anything to the content template. <code>{{ template &quot;content.html&quot; . }}</code> &lt;-- see the dot?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6682612"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1546356948, "post_id": 53996619, "comment_id": 94830621, "body": "Works like a charm. I guess I&#39;m not aloud to upvote you but thank you:)"}], "owner": {"user_type": "does_not_exist", "display_name": "user6682612"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 435, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1558968194, "creation_date": 1546356146, "last_edit_date": 1546356753, "question_id": 53996619, "link": "https://stackoverflow.com/questions/53996619/how-can-i-use-a-custom-function-in-a-nested-golang-template", "title": "How can I use a custom function in a nested golang template?", "body": "<p>I have a webpage consisting of one layout.html and one content.html. Both contain calls to a custom function for translating strings. </p>\n\n<p>When I call template.ParseFiles, the content is included into the layout and is served, but only strings in layout.html are translated while the strings from content.html disappear.</p>\n\n<p>This works fine when I use single html files, but I can't get it work with nested files.</p>\n\n<p>main.go</p>\n\n<pre><code>func executeMultiTmpl(w http.ResponseWriter, r *http.Request) {\n\n  funcMap := template.FuncMap{\n    \"index\": lookup,\n  }\n  tmpl, err := template.New(\"example.html\").Funcs(funcMap).ParseFiles(\n    \"dev/html/example/layout.html\",\n    \"dev/html/example/content.html\",\n  )\n   var tpl bytes.Buffer\n   err = tmpl.Execute(&amp;tpl ,Translation)\n   if err != nil {\n    panic(err)\n   }\n}\n</code></pre>\n\n<p>layout.html</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;Example Title - {{index . \"About\"}}&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n{{ template \"content.html\" }}\n\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>content.html</p>\n\n<pre><code>&lt;h2&gt;{{index . \"Some headline\"}}&lt;/h2&gt;\n</code></pre>\n\n<p>The file content.html is nested inside of layout.html. Afterwards the function <strong>lookup</strong> receives a map <strong>Translation</strong> and translates all strings in the layout.html file which are surrounded by {{index . }}. Unfortunately, the strings in the file content.html are not translated. </p>\n\n<p>I know the function <strong>lookup</strong> is called, but it receives an empty <strong>Translation</strong> map. </p>\n\n<p>When I remove the custom function and run it with the standard <strong>index</strong> function, I get a panic: executing \"content.html\" at : error calling index: index of untyped nil</p>\n"}, {"tags": ["android", "go", "websocket", "socket.io", "golang-migrate"], "answers": [{"comments": [{"owner": {"reputation": 293, "user_id": 4443895, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/snFAh.png?s=128&g=1", "display_name": "m-tech", "link": "https://stackoverflow.com/users/4443895/m-tech"}, "edited": false, "score": 1, "creation_date": 1546422546, "post_id": 54001367, "comment_id": 94845068, "body": "dear i do that . but i want to have android studio  example code."}, {"owner": {"reputation": 762, "user_id": 3052074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/619c2a3b094423dd741dc8eb161836f0?s=128&d=identicon&r=PG", "display_name": "Andrey Dyatlov", "link": "https://stackoverflow.com/users/3052074/andrey-dyatlov"}, "reply_to_user": {"reputation": 293, "user_id": 4443895, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/snFAh.png?s=128&g=1", "display_name": "m-tech", "link": "https://stackoverflow.com/users/4443895/m-tech"}, "edited": false, "score": 4, "creation_date": 1546428699, "post_id": 54001367, "comment_id": 94847748, "body": "@m-tech, googollee/go-socket.io implements the same protocol as the Node.js does, so there are no specific examples for it. So, the <a href=\"https://socket.io/blog/native-socket-io-and-android/\" rel=\"nofollow noreferrer\">standard android implementation</a> should work."}], "tags": [], "owner": {"reputation": 762, "user_id": 3052074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/619c2a3b094423dd741dc8eb161836f0?s=128&d=identicon&r=PG", "display_name": "Andrey Dyatlov", "link": "https://stackoverflow.com/users/3052074/andrey-dyatlov"}, "is_accepted": true, "score": 6, "last_activity_date": 1607747793, "last_edit_date": 1607747793, "creation_date": 1546404811, "answer_id": 54001367, "question_id": 53994679, "link": "https://stackoverflow.com/questions/53994679/how-can-connect-golang-and-android-with-socket-io/54001367#54001367", "title": "How can connect Golang and Android with socket.io ?", "body": "<p>I assume you would like to use a Go implementation of the Socket.IO server library instead of the standard Node.js one. If so, you can try <a href=\"https://github.com/googollee/go-socket.io\" rel=\"nofollow noreferrer\">googollee/go-socket.io project</a>. Here is an example from the project page:</p>\n<pre><code>package main\n\nimport (\n    &quot;log&quot;\n    &quot;net/http&quot;\n\n    &quot;github.com/googollee/go-socket.io&quot;\n)\n\nfunc main() {\n    server, err := socketio.NewServer(nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n    server.On(&quot;connection&quot;, func(so socketio.Socket) {\n        log.Println(&quot;on connection&quot;)\n        so.Join(&quot;chat&quot;)\n        so.On(&quot;chat message&quot;, func(msg string) {\n            log.Println(&quot;emit:&quot;, so.Emit(&quot;chat message&quot;, msg))\n            server.BroadcastTo(&quot;chat&quot;, &quot;chat message&quot;, msg)\n        })\n        so.On(&quot;disconnection&quot;, func() {\n            log.Println(&quot;on disconnect&quot;)\n        })\n    })\n    server.On(&quot;error&quot;, func(so socketio.Socket, err error) {\n        log.Println(&quot;error:&quot;, err)\n    })\n\n    http.Handle(&quot;/socket.io/&quot;, server)\n    http.Handle(&quot;/&quot;, http.FileServer(http.Dir(&quot;./asset&quot;)))\n    log.Println(&quot;Serving at localhost:5000...&quot;)\n    log.Fatal(http.ListenAndServe(&quot;:5000&quot;, nil))\n}\n</code></pre>\n"}], "owner": {"reputation": 293, "user_id": 4443895, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/snFAh.png?s=128&g=1", "display_name": "m-tech", "link": "https://stackoverflow.com/users/4443895/m-tech"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 954, "favorite_count": 1, "accepted_answer_id": 54001367, "answer_count": 1, "score": -2, "last_activity_date": 1607747793, "creation_date": 1546338080, "question_id": 53994679, "link": "https://stackoverflow.com/questions/53994679/how-can-connect-golang-and-android-with-socket-io", "title": "How can connect Golang and Android with socket.io ?", "body": "<p>I want to send data from Android to Golang with socket.io .\nI do that with Nodejs correctly But now , i want do with Go.\nI cant find simple example.how can i do that?</p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1546341696, "post_id": 53994299, "comment_id": 94827358, "body": "All questions must be complete, without the need to follow links. This means you must include a <a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete, Verifiable Example</a> of your code and CSV file <i>in the question</i>. Providing links to the larger versions is, of course, welcome, but the key is the question must be complete on its own, in case the links die in the future."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546442886, "post_id": 53994299, "comment_id": 94854481, "body": "This code is very strange. For each line, you create a goroutine, write a line to a channel, then the goroutines each call a function that uses that channel in some way that is not shown. This a) means that function call may or may not be using the line that was just inserted - you should probably just pass the line instead of using the channel; and b) means that if one of those functions reads a value from the channel, the other won&#39;t be able to because that would be twice as many receives as sends; and c) you run two goroutines which are both fully locked so you might as well just use one."}, {"owner": {"reputation": 1, "user_id": 10853889, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-8EpFwWcpeQo/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcYVgJMPeR4bfPyuocqZ0HDzlGxMlQ/mo/photo.jpg?sz=128", "display_name": "Brainstormer", "link": "https://stackoverflow.com/users/10853889/brainstormer"}, "edited": false, "score": 0, "creation_date": 1546447069, "post_id": 53994299, "comment_id": 94856601, "body": "Correct! The B option mentioned by  you is what I&#39;m doing. I did the same and used only one goroutine."}, {"owner": {"reputation": 1, "user_id": 10853889, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-8EpFwWcpeQo/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcYVgJMPeR4bfPyuocqZ0HDzlGxMlQ/mo/photo.jpg?sz=128", "display_name": "Brainstormer", "link": "https://stackoverflow.com/users/10853889/brainstormer"}, "edited": false, "score": 0, "creation_date": 1546447168, "post_id": 53994299, "comment_id": 94856656, "body": "But got a doubt, how we would achieve the correct result when we have two goroutines? I understand that if one goroutines reads from channel then other won&#39;t be able to read. Is there any way of doing it?"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 10853889, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-8EpFwWcpeQo/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcYVgJMPeR4bfPyuocqZ0HDzlGxMlQ/mo/photo.jpg?sz=128", "display_name": "Brainstormer", "link": "https://stackoverflow.com/users/10853889/brainstormer"}, "edited": false, "score": 0, "creation_date": 1546374005, "post_id": 53994678, "comment_id": 94834314, "body": "I have update the code as you have said in the below link <a href=\"https://play.golang.org/p/8Mhjco_7RyM\" rel=\"nofollow noreferrer\">play.golang.org/p/8Mhjco_7RyM</a>  But still it doesn&#39;t work out.  When I comment the 2nd goroutine, I get correct result of 1st Goroutine. But when I uncomment 2nd Goroutine, I get incorrect output of Goroutine 1 and 2 both."}, {"owner": {"reputation": 1, "user_id": 10853889, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-8EpFwWcpeQo/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcYVgJMPeR4bfPyuocqZ0HDzlGxMlQ/mo/photo.jpg?sz=128", "display_name": "Brainstormer", "link": "https://stackoverflow.com/users/10853889/brainstormer"}, "edited": false, "score": 0, "creation_date": 1546374366, "post_id": 53994678, "comment_id": 94834394, "body": "So I think it is 2nd Goroutine which is creating the mess."}, {"owner": {"reputation": 1, "user_id": 10853889, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-8EpFwWcpeQo/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcYVgJMPeR4bfPyuocqZ0HDzlGxMlQ/mo/photo.jpg?sz=128", "display_name": "Brainstormer", "link": "https://stackoverflow.com/users/10853889/brainstormer"}, "edited": false, "score": 0, "creation_date": 1546418736, "post_id": 53994678, "comment_id": 94843492, "body": "Do you find anything new?"}], "tags": [], "owner": {"reputation": 740, "user_id": 2471524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345a080a421b053d124139a0bce7d62e?s=128&d=identicon&r=PG", "display_name": "blobdon", "link": "https://stackoverflow.com/users/2471524/blobdon"}, "is_accepted": false, "score": 2, "last_activity_date": 1546338077, "creation_date": 1546338077, "answer_id": 53994678, "question_id": 53994299, "link": "https://stackoverflow.com/questions/53994299/multiple-goroutines-reading-from-a-channel-gives-wrong-data-count/53994678#53994678", "title": "Multiple goroutines reading from a channel gives wrong data count", "body": "<p>In both cases, your wg.Done() is being called immediately after you start the goroutine. This means that your WaitGroup is not waiting for the goroutine to finish. Remember that the calling process proceeds when you call a goroutine. Try putting the wg.Done() call <em>inside</em> the goroutine, when it's finished doing stuff.</p>\n\n<pre><code>go func(wg) {\n    // do stuff\n    wg.Done\n}\n</code></pre>\n\n<p>OR</p>\n\n<pre><code>go func(wg) {\n    defer wg.Done\n    // do stuff\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10853889, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-8EpFwWcpeQo/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcYVgJMPeR4bfPyuocqZ0HDzlGxMlQ/mo/photo.jpg?sz=128", "display_name": "Brainstormer", "link": "https://stackoverflow.com/users/10853889/brainstormer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 1, "answer_count": 1, "score": -5, "last_activity_date": 1546532493, "creation_date": 1546334416, "last_edit_date": 1546532493, "question_id": 53994299, "link": "https://stackoverflow.com/questions/53994299/multiple-goroutines-reading-from-a-channel-gives-wrong-data-count", "title": "Multiple goroutines reading from a channel gives wrong data count", "body": "<p>I'm working on a program where I read a csv file and do below operations:</p>\n\n<p>Full Code is available at:<a href=\"https://play.golang.org/p/8Mhjco_7RyM\" rel=\"nofollow noreferrer\">Here</a></p>\n\n<p>My CSV file is available at:\n<a href=\"https://github.com/westcottian/MyData/blob/master/CSV.csv\" rel=\"nofollow noreferrer\">CSV file</a></p>\n\n<p>The problem is sometimes I get the correct count for A and B and sometimes I get the wrong count.</p>\n\n<p>I think I'm doing something wrong in Goroutines and channels communication.</p>\n\n<p>When I comment the 2nd goroutine, I get correct result of 1st Goroutine. But when I uncomment 2nd Goroutine, I get incorrect output of Goroutine 1 and 2 both.</p>\n\n<p>Can anyone please explain what wrong I'm doing?</p>\n\n<p>Also when I do go run -race main.go, the result shows me a race condition.</p>\n\n<pre><code>func main() {\n    input, err := os.Open(\"CSV.csv\")\n    if err != nil {\n        fmt.Println(\"Error while opening CSV file.\")\n        return\n    }\n    defer input.Close()\n\n    formattedStartDateRange,err := time.Parse(time.RFC3339, startDateRange)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    formattedendDateRange,err := time.Parse(time.RFC3339, endDateRange)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    reader := csv.NewReader(input)\n    reader.FieldsPerRecord = -1\n    files := make(map[string]chan []string)\n\n    wg := &amp;sync.WaitGroup{}\n\n    var line []string\n    for line, err = reader.Read(); err == nil; line, err = reader.Read() {\n        ch, ok := files[line[0]]\n        if ok {\n            ch &lt;- line\n        } else {\n            ch = make(chan []string, 8)\n            ch &lt;- line\n            wg.Add(2) // Must wait for 2 calls to 'done' before moving on\n\n            go func() {\n                UserMapMutex.Lock()\n                if (findNumberOfBuilds(formattedStartDateRange, formattedendDateRange, ch, wg)) {\n                    totalBuildCount++\n                }\n                UserMapMutex.Unlock()\n                wg.Done()\n            }()\n\n            go func() {\n                UserMapMutex.Lock()\n                countUserBuildFrequency(ch, wg)\n                UserMapMutex.Unlock()\n                wg.Done()\n            }()\n\n\n            files[line[0]] = ch\n        }\n    }\n\n\n    if err.Error() != \"EOF\" {\n        fmt.Println(\"Error while reading CSV file.\")\n        return\n    }\n    for _, ch := range files {\n        close(ch)\n    }\n    wg.Wait()\n\n    fmt.Println(\"Total Build executed from 1st November to 30th November =\", totalBuildCount)\n    fmt.Println(\"Total Build\", userBuildFreq[\"5c00a8f685db9ec46dbc13d7\"])\n    fmt.Println(\"Done!\")\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 626, "user_id": 2454720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a13483fe013b55121def2b6bbd68462?s=128&d=identicon&r=PG", "display_name": "Ferdy Pruis", "link": "https://stackoverflow.com/users/2454720/ferdy-pruis"}, "edited": false, "score": 0, "creation_date": 1591282712, "post_id": 53993644, "comment_id": 110002761, "body": "You have the zero value confused with a byte-slice. The zero value for a slice is <code>nil</code>. For a <code>byte</code>, which is an alias for <code>uint8</code>, its <code>0</code>."}], "tags": [], "owner": {"reputation": 5900, "user_id": 931154, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/bTrZd.jpg?s=128&g=1", "display_name": "Gregory Nisbet", "link": "https://stackoverflow.com/users/931154/gregory-nisbet"}, "is_accepted": false, "score": 0, "last_activity_date": 1546326252, "creation_date": 1546326252, "answer_id": 53993644, "question_id": 53993586, "link": "https://stackoverflow.com/questions/53993586/is-there-a-nil-value-i-can-use-for-bytes-in-go/53993644#53993644", "title": "Is there a nil value I can use for bytes in Go?", "body": "<p>Every type in golang has a zero value. In the case of <code>byte</code> that is the null byte.</p>\n\n<p>It's entirely possible to just use the null byte as a magical zero payload at the root.</p>\n"}, {"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 12, "last_activity_date": 1546326283, "creation_date": 1546326283, "answer_id": 53993648, "question_id": 53993586, "link": "https://stackoverflow.com/questions/53993586/is-there-a-nil-value-i-can-use-for-bytes-in-go/53993648#53993648", "title": "Is there a nil value I can use for bytes in Go?", "body": "<p><code>byte</code> is a <a href=\"https://golang.org/ref/spec#Numeric_types\" rel=\"noreferrer\">numeric type</a>, actually an alias for <code>uint8</code>.</p>\n\n<p>That means it has default <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"noreferrer\">zero value</a> of 0. </p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1546365509, "last_edit_date": 1546365509, "creation_date": 1546350495, "answer_id": 53995978, "question_id": 53993586, "link": "https://stackoverflow.com/questions/53993586/is-there-a-nil-value-i-can-use-for-bytes-in-go/53995978#53995978", "title": "Is there a nil value I can use for bytes in Go?", "body": "<p>For idiomatic Go, write your function as:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype TreeNode struct {\n    payload  byte\n    parent   *TreeNode\n    children map[byte]*TreeNode\n}\n\nfunc createEmptyTree(fileName string) *TreeNode {\n    return &amp;TreeNode{\n        children: map[byte]*TreeNode{},\n    }\n}\n\nfunc main() {\n    tree := createEmptyTree(\"fiename\")\n    fmt.Println(tree)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/v6DJCnpN6Ys\" rel=\"nofollow noreferrer\">https://play.golang.org/p/v6DJCnpN6Ys</a></p>\n\n<p>Output:</p>\n\n<pre><code>&amp;{0 &lt;nil&gt; map[]}\n</code></pre>\n\n<p>The <code>payload</code> value for an empty tree is integer zero (<code>0</code>), the zero-value for the integer type <code>byte</code>. Zero is not a single lower-case letter value from the English alphabet. </p>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">The zero value</a></p>\n  \n  <p>When storage is allocated for a variable, either through a declaration\n  or a call of new, or when a new value is created, either through a\n  composite literal or a call of make, and no explicit initialization is\n  provided, the variable or value is given a default value. Each element\n  of such a variable or value is set to the zero value for its type:\n  false for booleans, 0 for numeric types, \"\" for strings, and nil for\n  pointers, functions, interfaces, slices, channels, and maps.</p>\n</blockquote>\n"}], "owner": {"reputation": 8918, "user_id": 1742777, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ff60602db4c570ec0e48b22eb13f6956?s=128&d=identicon&r=PG", "display_name": "Saqib Ali", "link": "https://stackoverflow.com/users/1742777/saqib-ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2621, "favorite_count": 2, "answer_count": 3, "score": 1, "last_activity_date": 1546597936, "creation_date": 1546325688, "question_id": 53993586, "link": "https://stackoverflow.com/questions/53993586/is-there-a-nil-value-i-can-use-for-bytes-in-go", "title": "Is there a nil value I can use for bytes in Go?", "body": "<p>I'm implementing a tree in Go. My TreeNode struct looks like this:</p>\n\n<pre><code>type TreeNode struct {\n    payload byte\n    parent *TreeNode\n    children map[byte]*TreeNode\n}\n</code></pre>\n\n<p>In my implementation, the root node of the tree is a special node that has no payload. Otherwise the payload is always a single lower-case letter from the English alphabet. So my tree initialization function looks like this:</p>\n\n<pre><code>func createEmptyTree(fileName string) *TreeNode{\n    return &amp;TreeNode{\n        nil,           // Line #180\n        nil,\n        false,\n        map[byte]*TreeNode{},\n    }\n}\n</code></pre>\n\n<p>When I compile it though, I get the following error: <code>./main.go:180:9: cannot use nil as type byte in field value</code></p>\n\n<p>So it seems I cannot use <code>nil</code> for a byte variable. Is there something else I could use in this situation? I could easily use <code>'0'</code> or other non alphabetic character. But it seems hacky. What should I do?</p>\n"}, {"tags": ["multithreading", "go", "caching", "concurrency", "thread-safety"], "answers": [{"comments": [{"owner": {"reputation": 29, "user_id": 5906556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff5dc7f01728759c7384761eea384208?s=128&d=identicon&r=PG&f=1", "display_name": "S.Hzj", "link": "https://stackoverflow.com/users/5906556/s-hzj"}, "edited": false, "score": 0, "creation_date": 1546361165, "post_id": 53993017, "comment_id": 94831602, "body": "Understand.So the strategy in book is definitely wrong racing? Am I right? If hold lock in this way, one iteration is not enough, must be background continuously task?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 29, "user_id": 5906556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff5dc7f01728759c7384761eea384208?s=128&d=identicon&r=PG&f=1", "display_name": "S.Hzj", "link": "https://stackoverflow.com/users/5906556/s-hzj"}, "edited": false, "score": 0, "creation_date": 1546366413, "post_id": 53993017, "comment_id": 94832752, "body": "@S.Hzj: The fundamental startegy for locking is to minimize the time the lock is held. Reading an entire map usually takes some (a long) time. A Go <code>map</code> is a dynamic structure that is continuosly changed as the map is modified."}, {"owner": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "reply_to_user": {"reputation": 29, "user_id": 5906556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff5dc7f01728759c7384761eea384208?s=128&d=identicon&r=PG&f=1", "display_name": "S.Hzj", "link": "https://stackoverflow.com/users/5906556/s-hzj"}, "edited": false, "score": 0, "creation_date": 1546414320, "post_id": 53993017, "comment_id": 94842110, "body": "@S.Hzj The go thing is to express your problem properly in your program; locks almost never do this.   If you need an iterator over your store which reflects the point-in-time state, then make just that, and use channels (thus messages) to express it.  If you can have a looser iterator, again express it with the normal constructs; only rely on locks when you are truly cornered."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "edited": false, "score": 0, "creation_date": 1546436260, "post_id": 53993017, "comment_id": 94851243, "body": "@mevets: &quot;only rely on locks when you are truly cornered.&quot; Experts disagree with you: <a href=\"http://www.gopl.io/\" rel=\"nofollow noreferrer\">The Go Programming Language</a>."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1546366533, "last_edit_date": 1546366533, "creation_date": 1546317063, "answer_id": 53993017, "question_id": 53992845, "link": "https://stackoverflow.com/questions/53992845/a-go-map-thread-safety-problem-while-reading-a-cache-diy-book/53993017#53993017", "title": "A Go map thread safety problem while reading a cache DIY book", "body": "<p>You have a data race. Your results are undefined.</p>\n\n<hr>\n\n<p>Simplifying your code so that it compiles and runs,</p>\n\n<pre><code>package main\n\nimport (\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    testMap := make(map[string]string)\n    mutex := sync.RWMutex{}\n    for i := 0; i &lt; 64; i++ {\n        mutex.Lock()\n        now := time.Now().String()\n        testMap[now] = now\n        mutex.Unlock()\n    }\n    go func() {\n        for {\n            mutex.Lock()\n            now := time.Now().String()\n            testMap[now] = now\n            time.Sleep(100 * time.Millisecond)\n            mutex.Unlock()\n        }\n    }()\n    for k, v := range testMap {\n        mutex.RLock()\n        _, _ = k, v\n        mutex.RUnlock()\n        time.Sleep(100 * time.Millisecond)\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run -race racer.go\n==================\nWARNING: DATA RACE\nRead at 0x00c00008c060 by main goroutine:\n  runtime.mapiternext()\n      /home/peter/go/src/runtime/map.go:844 +0x0\n  main.main()\n      /home/peter/gopath/src/racer.go:26 +0x217\n\nPrevious write at 0x00c00008c060 by goroutine 5:\n  runtime.mapassign_faststr()\n      /home/peter/go/src/runtime/map_faststr.go:202 +0x0\n  main.main.func1()\n      /home/peter/gopath/src/racer.go:21 +0x9b\n\nGoroutine 5 (running) created at:\n  main.main()\n      /home/peter/gopath/src/racer.go:17 +0x17b\n==================\n==================\nWARNING: DATA RACE\nRead at 0x00c0000a6638 by main goroutine:\n  main.main()\n      /home/peter/gopath/src/racer.go:26 +0x1d0\n\nPrevious write at 0x00c0000a6638 by goroutine 5:\n  main.main.func1()\n      /home/peter/gopath/src/racer.go:21 +0xb0\n\nGoroutine 5 (running) created at:\n  main.main()\n      /home/peter/gopath/src/racer.go:17 +0x17b\n==================\nfatal error: concurrent map iteration and map write\n\ngoroutine 1 [running]:\nruntime.throw(0x4b1eb7, 0x26)\n    /home/peter/go/src/runtime/panic.go:617 +0x72 fp=0xc000059e48 sp=0xc000059e18 pc=0x44d722\nruntime.mapiternext(0xc000059f28)\n    /home/peter/go/src/runtime/map.go:851 +0x55e fp=0xc000059ed0 sp=0xc000059e48 pc=0x434c2e\nmain.main()\n    /home/peter/gopath/src/racer.go:26 +0x218 fp=0xc000059f98 sp=0xc000059ed0 pc=0x48a1f8\nruntime.main()\n    /home/peter/go/src/runtime/proc.go:200 +0x20c fp=0xc000059fe0 sp=0xc000059f98 pc=0x44f06c\nruntime.goexit()\n    /home/peter/go/src/runtime/asm_amd64.s:1337 +0x1 fp=0xc000059fe8 sp=0xc000059fe0 pc=0x475751\n\ngoroutine 4 [sleep]:\nruntime.goparkunlock(...)\n    /home/peter/go/src/runtime/proc.go:307\ntime.Sleep(0x5f5e100)\n    /home/peter/go/src/runtime/time.go:105 +0x159\nmain.main.func1(0xc00001c280, 0xc00008c060)\n    /home/peter/gopath/src/racer.go:22 +0x3e\ncreated by main.main\n    /home/peter/gopath/src/racer.go:17 +0x17c\nexit status 2\n$ \n</code></pre>\n\n<hr>\n\n<p>You are not locking the map reads,</p>\n\n<pre><code>for k, v := range testMap {\n    mutex.RLock()\n    _, _ = k, v\n    mutex.RUnlock()\n    time.Sleep(100 * time.Millisecond)\n}\n</code></pre>\n\n<p><code>for k, v := range testMap { ... }</code> reads the map. <code>k, v</code> are local variables.</p>\n\n<p>You need to lock the map reads,</p>\n\n<pre><code>mutex.RLock()\nfor k, v := range testMap {\n    _, _ = k, v\n    time.Sleep(100 * time.Millisecond)\n}\nmutex.RUnlock()\n</code></pre>\n\n<hr>\n\n<p><a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">Go: Data Race Detector</a></p>\n\n<p><a href=\"https://blog.golang.org/race-detector\" rel=\"nofollow noreferrer\">The Go Blog: Introducing the Go Race Detector</a></p>\n\n<p><a href=\"https://www.youtube.com/watch?v=Tl7mi9QmLns\" rel=\"nofollow noreferrer\">GopherCon 2016: Keith Randall - Inside the Map Implementation</a></p>\n"}], "owner": {"reputation": 29, "user_id": 5906556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff5dc7f01728759c7384761eea384208?s=128&d=identicon&r=PG&f=1", "display_name": "S.Hzj", "link": "https://stackoverflow.com/users/5906556/s-hzj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1546366533, "creation_date": 1546313229, "last_edit_date": 1546341816, "question_id": 53992845, "link": "https://stackoverflow.com/questions/53992845/a-go-map-thread-safety-problem-while-reading-a-cache-diy-book", "title": "A Go map thread safety problem while reading a cache DIY book", "body": "<p>I am reading a book which teaches me how to write a simple cache like redis.</p>\n\n<p>With a goal to implement a distribute hash, the project must have key migrate, which needs an iterator. And I think there may be some problems.</p>\n\n<p>His book about iterating a map, but while the iteration, the hold of read lock not continuously. The reason is trying not to effect main cache process. I believe there must be a thread safety problem because the main cache thread is still writing to map. I wrote a demo, but not sure.</p>\n\n<pre><code>//book code\ntype inMemoryScanner struct {\n    pair\n    pair Chan *pair\n    closeCh chan struct{}\n}\n\nfunc (c *inMemoryCache) NewScanner() Scanner {\n    pairCh := make(chan *pair)\n    closeCh := make(chan struct{})\n    go func() {\n        defer close(pairCh)\n        c.mutex.RLock()\n        //the c.c is book's map\n        for k, v := range c.c {\n            c.mutex.RUnlock()\n            select {\n            case &lt;-closeCh:\n                return\n            case pairCh &lt;- &amp;pair{k, v}:\n            }\n            c.mutex.RLock()\n        }\n        c.mutex.RUnLock()\n     }\n     return &amp;inMemoryScanner{pair{}, pairCh, closeCh}\n}\n//my demo\nfunc main()  {\n    testMap := make(map[string]string)\n    mutex := sync.RWMutex{}\n    for i := 0; i &lt; 64; i ++ {\n        mutex.Lock()\n        testMap[uuid.New().String()] = uuid.New().String()\n        mutex.Unlock()\n        fmt.Println(\"Write\")\n    }\n    go func() {\n        for {\n            mutex.Lock()\n            testMap[uuid.New().String()] = uuid.New().String()\n            time.Sleep(100 * time.Millisecond)\n            mutex.Unlock()\n            fmt.Println(\"Write\")\n        }\n    } ()\n    for k, v := range testMap {\n        mutex.RLock()\n        fmt.Println(\"k\" + k + \"v\" + v)\n        mutex.RUnlock()\n        time.Sleep(100 * time.Millisecond)\n    }\n}\n</code></pre>\n\n<p>In my demo, the 'Write' and the map's result amount not equal! And I believe, In an reality project, the rebalance can't be once, there must be continuous background work, doesn't it? </p>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 1233, "user_id": 4983242, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KQbOP.jpg?s=128&g=1", "display_name": "Dharma Saputra", "link": "https://stackoverflow.com/users/4983242/dharma-saputra"}, "edited": false, "score": 0, "creation_date": 1546310754, "post_id": 53992683, "comment_id": 94823216, "body": "What do you mean with &quot;UserCtrlType is repeated many times with type gin.HandlerFunc&quot;? Do you want &quot;UserCtrl&quot; being a base struct and in api package will &quot;extend&quot; from it?"}, {"owner": {"reputation": 1391, "user_id": 8828489, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cea21c4b94376330efc9e542d5733749?s=128&d=identicon&r=PG", "display_name": "huynhsamha", "link": "https://stackoverflow.com/users/8828489/huynhsamha"}, "reply_to_user": {"reputation": 1233, "user_id": 4983242, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KQbOP.jpg?s=128&g=1", "display_name": "Dharma Saputra", "link": "https://stackoverflow.com/users/4983242/dharma-saputra"}, "edited": false, "score": 0, "creation_date": 1546311215, "post_id": 53992683, "comment_id": 94823258, "body": "@DharmaSaputra, no, I want to export <code>UserCtrl</code> with named methods, that mean can use <code>UserCtrl.findAll()</code> example. But <code>UserCtrlType</code> is repeating multiple times with <code>gin.HandlerFunc</code>. Is there any other way to reduce it or use other way for my purpose?"}, {"owner": {"reputation": 320, "user_id": 2803909, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LFlVf.jpg?s=128&g=1", "display_name": "Minh Tri Le", "link": "https://stackoverflow.com/users/2803909/minh-tri-le"}, "edited": false, "score": 0, "creation_date": 1546312115, "post_id": 53992683, "comment_id": 94823352, "body": "It doesn&#39;t take too much effort, I think you can repeat typing <b>gin.HandlerFunc</b>."}, {"owner": {"reputation": 1391, "user_id": 8828489, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cea21c4b94376330efc9e542d5733749?s=128&d=identicon&r=PG", "display_name": "huynhsamha", "link": "https://stackoverflow.com/users/8828489/huynhsamha"}, "edited": false, "score": 0, "creation_date": 1546315404, "post_id": 53992683, "comment_id": 94823610, "body": "I&#39;ve found the answer for my problem. Tnx"}], "answers": [{"tags": [], "owner": {"reputation": 1391, "user_id": 8828489, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cea21c4b94376330efc9e542d5733749?s=128&d=identicon&r=PG", "display_name": "huynhsamha", "link": "https://stackoverflow.com/users/8828489/huynhsamha"}, "is_accepted": false, "score": 1, "last_activity_date": 1546330565, "last_edit_date": 1546330565, "creation_date": 1546315646, "answer_id": 53992947, "question_id": 53992683, "link": "https://stackoverflow.com/questions/53992683/how-to-shorten-struct-declaration-with-same-type-attributes-in-golang/53992947#53992947", "title": "How to shorten struct declaration with same type attributes in Golang?", "body": "<p>I've found an answer for my problem. I think because of my limited knowledge about Golang, I didn't think of a simpler way for my problem before.</p>\n\n<p>This is my answer for my problem:</p>\n\n<pre><code>package controllers\n\nimport \"github.com/gin-gonic/gin\"\n\n// UserCtrl : Controller for User\ntype UserCtrl struct{}\n\n// FindAll :\nfunc (ctrl UserCtrl) FindAll(ctx *gin.Context) {\n\n}\n\n// FindOneByID :\nfunc (ctrl UserCtrl) FindOneByID(ctx *gin.Context) {\n\n}\n\n// FindOneByUsername :\nfunc (ctrl UserCtrl) FindOneByUsername(ctx *gin.Context) {\n\n}\n</code></pre>\n\n<p>And in package <code>api</code></p>\n\n<pre><code>package api\n\nimport (\n    Controllers \"github.com/huynhsamha/gin-go-app/controllers\"\n\n    \"github.com/gin-gonic/gin\"\n)\n\nvar userCtrl = Controllers.UserCtrl{}\n\nfunc setUpUserRoutes(router *gin.RouterGroup) {\n    router.GET(\"/\", userCtrl.FindAll)\n    router.GET(\"/n/:username\", userCtrl.FindOneByUsername)\n    router.GET(\"/d/:id\", userCtrl.FindOneByID)\n}\n</code></pre>\n\n<p>I will close this question. Thanks for your attentions.</p>\n"}, {"comments": [{"owner": {"reputation": 1391, "user_id": 8828489, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cea21c4b94376330efc9e542d5733749?s=128&d=identicon&r=PG", "display_name": "huynhsamha", "link": "https://stackoverflow.com/users/8828489/huynhsamha"}, "edited": false, "score": 0, "creation_date": 1546346962, "post_id": 53995474, "comment_id": 94828445, "body": "Tnx, your shortening in struct is correct way I&#39;m looking, but your first way, which export function in package <code>controllers</code> isn&#39;t my needs. I&#39;ve found my solution for my problem"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546443405, "post_id": 53995474, "comment_id": 94854731, "body": "Typically in Go you&#39;d write them as methods instead of <code>func</code> fields."}], "tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": true, "score": 0, "last_activity_date": 1546346164, "creation_date": 1546346164, "answer_id": 53995474, "question_id": 53992683, "link": "https://stackoverflow.com/questions/53992683/how-to-shorten-struct-declaration-with-same-type-attributes-in-golang/53995474#53995474", "title": "How to shorten struct declaration with same type attributes in Golang?", "body": "<p>Typically in Go you wouldn't create a structure just to wrap a bunch of function declarations like this; you'd just directly export the functions.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package controllers\nimport \"github.com/gin-gonic/gin\"\nfunc FindAll(ctx *gin.Context) { ... }\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>router.GET(\"/\", controllers.FindAll)\n</code></pre>\n\n<p>If you really want to have a struct that contains them as <em>variable</em> function references, there is syntax to not repeat the type:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type UserCtrlType struct {\n    FindAll, FindOneByID, FindOneByUsername gin.HandlerFunc\n}\n</code></pre>\n\n<p>In general in Go you will probably find this is the least of your repeated code (<code>if err != nil { return err }</code> appears a <em>lot</em>).  \"With typing\" isn't a special concept in Go; you can never refer to an object as a map if it isn't one (without going through the <code>reflect</code> package, which should be a special case).</p>\n"}], "owner": {"reputation": 1391, "user_id": 8828489, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cea21c4b94376330efc9e542d5733749?s=128&d=identicon&r=PG", "display_name": "huynhsamha", "link": "https://stackoverflow.com/users/8828489/huynhsamha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 237, "favorite_count": 0, "accepted_answer_id": 53995474, "answer_count": 2, "score": 0, "last_activity_date": 1597309017, "creation_date": 1546309499, "last_edit_date": 1597309017, "question_id": 53992683, "link": "https://stackoverflow.com/questions/53992683/how-to-shorten-struct-declaration-with-same-type-attributes-in-golang", "title": "How to shorten struct declaration with same type attributes in Golang?", "body": "<p>I have a question about export a module in a package with typing in Golang.</p>\n<p>Example, I'd like to export <code>UserCtrl</code> in package <code>controllers</code>, and package <code>api</code> can use <code>UserCtrl</code> when import package <code>controllers</code>.</p>\n<p>Also I want to export <code>UserCtrl</code> with <strong>typing</strong>, that means in <code>api</code>, I can <strong>call named methods</strong>, example <code>UserCtrl.findOne()</code>, or <code>UserCtrl.findAll()</code>, not use <code>map[string]interface{}</code>.</p>\n<p>So I've created new type <code>UserCtrlType</code> as struct in Golang</p>\n<pre><code>package controllers\n\nimport (\n    &quot;github.com/gin-gonic/gin&quot;\n)\n\n// UserCtrlType : Type controller for User\ntype UserCtrlType struct {\n    FindAll           gin.HandlerFunc\n    FindOneByID       gin.HandlerFunc\n    FindOneByUsername gin.HandlerFunc\n}\n\n// UserCtrl : Controller for User\nvar UserCtrl = UserCtrlType{\n    findAll,\n    findOneByID,\n    findOneByUsername,\n}\n\nfunc findAll(ctx *gin.Context) {\n\n}\n\nfunc findOneByID(ctx *gin.Context) {\n\n}\n\nfunc findOneByUsername(ctx *gin.Context) {\n\n}\n</code></pre>\n<p>And in package <code>api</code>, I import <code>controller</code> and use:</p>\n<pre><code>package api\n\nimport (\n    Controllers &quot;github.com/huynhsamha/gin-go-app/controllers&quot;\n\n    &quot;github.com/gin-gonic/gin&quot;\n)\n\nvar userCtrl = Controllers.UserCtrl\n\nfunc setUpUserRoutes(router *gin.RouterGroup) {\n    router.GET(&quot;/&quot;, userCtrl.FindAll)\n    router.GET(&quot;/n/:username&quot;, userCtrl.FindOneByUsername)\n    router.GET(&quot;/d/:id&quot;, userCtrl.FindOneByID)\n}\n</code></pre>\n<p>I'm working with <a href=\"https://github.com/gin-gonic/gin\" rel=\"nofollow noreferrer\">Gin</a>, therefore the struct <code>UserCtrlType</code> is repeated many times with type <code>gin.HandlerFunc</code>.</p>\n<p>Is there any other way to resolve my problem, which can export <code>UserCtrl</code> (typed) and reduce repeating type <code>gin.HandlerFunc</code> declarations.</p>\n<p>When I'm working on Node.JS, I found it is very simple to export modules. Can we simplify this issue in Golang?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 1, "last_activity_date": 1546309370, "creation_date": 1546309370, "answer_id": 53992673, "question_id": 53992594, "link": "https://stackoverflow.com/questions/53992594/reassigning-a-slice-parameter-acts-differently/53992673#53992673", "title": "Reassigning a slice parameter acts differently", "body": "<p>Because, as you said, the same underlying array is in use. When you do the append, <code>paths[:1]</code> is a slice of length 1 and capacity 3, and <code>paths[2:]</code> is a slice of length 1, so there is enough room in the underlying array of the first slice to append the new value without allocating a new array. <code>paths</code> in <code>main</code> is still a slice of length 3 since it was never modified, but since the underlying array was modified (specifically element 1), you see the value that you see.</p>\n\n<p>You may want to take a look at <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">https://blog.golang.org/go-slices-usage-and-internals</a> if you haven't already.</p>\n"}], "owner": {"reputation": 72581, "user_id": 44852, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/JbQbc.jpg?s=128&g=1", "display_name": "Tarik", "link": "https://stackoverflow.com/users/44852/tarik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32, "favorite_count": 0, "accepted_answer_id": 53992673, "answer_count": 1, "score": -1, "last_activity_date": 1546309370, "creation_date": 1546307824, "last_edit_date": 1592644375, "question_id": 53992594, "link": "https://stackoverflow.com/questions/53992594/reassigning-a-slice-parameter-acts-differently", "title": "Reassigning a slice parameter acts differently", "body": "<pre><code>package main\n\nimport &quot;fmt&quot;\n\nfunc main() {\n    paths := []string{&quot;hello&quot;, &quot;world&quot;, &quot;mars&quot;}\n    var result = delete(paths, 1)\n    fmt.Println(result)\n    fmt.Println(paths)\n}\n\nfunc delete(paths []string, index int) []string {\n    paths = append(paths[:index], paths[index+1:]...)\n    return paths\n}\n</code></pre>\n<p>The result of the code above is the following:</p>\n<blockquote>\n<p>[hello mars]</p>\n<p>[hello mars mars]</p>\n</blockquote>\n<p>As you see, the second <code>fmt.Println(paths)</code> obviously uses the modified slice but does not use the reassigned value. Why is that? I was expecting it to print <code>[hello mars]</code> like in the print before.</p>\n<p>I know that <code>paths</code> being passed is not the same slice as <code>paths</code> parameter in the <code>delete()</code> function expect for referencing the same underlying array. But I still don't understand how I changed the underlying array of the <code>paths</code> being passed to <code>delete</code> function as it prints <code>[hello mars mars]</code> instead of <code>[hello world mars]</code>.</p>\n"}, {"tags": ["html", "go"], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 0, "last_activity_date": 1546306791, "creation_date": 1546306791, "answer_id": 53992544, "question_id": 53992511, "link": "https://stackoverflow.com/questions/53992511/how-to-export-to-csv-directly-from-a-query-using-golang/53992544#53992544", "title": "How to export to CSV directly from a query using golang", "body": "<p>You would just do something like:</p>\n\n<pre><code>func(w http.ResponseWriter, r *http.Request)\n    var data = [][]string{{\"Line1\", \"Hello\"}, {\"Line2\", \"World\"}}\n    buffer := &amp;bytes.Buffer{} // creates IO Writer\n\n    writer := csv.NewWriter(buffer)\n\n    for _, value := range data {\n        err := writer.Write(value)\n        checkError(\"Cannot write to buffer\", err)\n    }\n\n    writer.Flush()\n\n    w.Header().Set(\"Content-Type\", \"text/csv\") // setting the content type header to text/csv\n    w.Header().Set(\"Content-Disposition\", \"attachment;filename=TheCSVFileName.csv\")\n    w.Write(buffer.Bytes())\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 7745759, "user_type": "registered", "profile_image": "https://graph.facebook.com/331383823925485/picture?type=large", "display_name": "Kano Doe", "link": "https://stackoverflow.com/users/7745759/kano-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 665, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1546306791, "creation_date": 1546306150, "question_id": 53992511, "link": "https://stackoverflow.com/questions/53992511/how-to-export-to-csv-directly-from-a-query-using-golang", "title": "How to export to CSV directly from a query using golang", "body": "<p>I have a java script that exports website html table contents to CSV from a Web Application.\nI would like to bypass that and when a button is pressed it runs a query and downloads it to CSV without first loading it to the html table.\nDoes anyone have anything like that?</p>\n\n<p>This is useful for printing out reports. Some big reports that i have since they have to load in the website first cause too much lag.</p>\n"}, {"tags": ["go", "bazel"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1546342105, "post_id": 53992306, "comment_id": 94827442, "body": "Well, clearly the program is trying to open a file that doesn&#39;t exist. Without seeing the code you&#39;re using, it&#39;s pretty impossible to debug beyond that, though."}, {"owner": {"reputation": 10540, "user_id": 521209, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lmaGX.jpg?s=128&g=1", "display_name": "Jin", "link": "https://stackoverflow.com/users/521209/jin"}, "edited": false, "score": 1, "creation_date": 1546381180, "post_id": 53992306, "comment_id": 94835757, "body": "Have you tried specifying the yaml file in the <code>data</code> attribute of the <code>bazel run</code> target?"}, {"owner": {"reputation": 679, "user_id": 1426764, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/PdGh6.jpg?s=128&g=1", "display_name": "Rijo Simon", "link": "https://stackoverflow.com/users/1426764/rijo-simon"}, "edited": false, "score": 0, "creation_date": 1546385578, "post_id": 53992306, "comment_id": 94836495, "body": "Thanks a lot Jin, add the test.yaml file a data dependency on the binary resolved this issue."}, {"owner": {"reputation": 679, "user_id": 1426764, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/PdGh6.jpg?s=128&g=1", "display_name": "Rijo Simon", "link": "https://stackoverflow.com/users/1426764/rijo-simon"}, "edited": false, "score": 0, "creation_date": 1546385668, "post_id": 53992306, "comment_id": 94836505, "body": "Jin if you would like to post your comment again as the answer that would be helpful for others. Thanks, Rijo"}, {"owner": {"reputation": 10540, "user_id": 521209, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lmaGX.jpg?s=128&g=1", "display_name": "Jin", "link": "https://stackoverflow.com/users/521209/jin"}, "edited": false, "score": 0, "creation_date": 1546471279, "post_id": 53992306, "comment_id": 94866041, "body": "Looks like Jay wrote a far more detailed answer :-)"}], "answers": [{"tags": [], "owner": {"reputation": 26173, "user_id": 1891, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c40d475927f7a86639ec54aa32517572?s=128&d=identicon&r=PG", "display_name": "Jay Conrod", "link": "https://stackoverflow.com/users/1891/jay-conrod"}, "is_accepted": true, "score": 3, "last_activity_date": 1546451640, "creation_date": 1546451640, "answer_id": 54010954, "question_id": 53992306, "link": "https://stackoverflow.com/questions/53992306/failing-to-open-a-file-which-should-be-in-the-base-path/54010954#54010954", "title": "Failing to open a file which should be in the base path", "body": "<p>Binaries started with <code>bazel run</code> are executed in an internal Bazel directory. They'll have access to \"runfiles\", which are files mentioned in the <code>data</code> attribute of the binary rule or its dependencies. For example, if you have a rule like the one below, you'll be able to read <code>foo.txt</code>, but not <code>bar.txt</code> or other files:</p>\n\n<pre><code>load(\"@io_bazel_rules_go//go:def.bzl\", \"go_binary\")\n\ngo_binary(\n    name = \"hello\",\n    srcs = [\"hello.go\"],\n    data = [\"foo.txt\"],\n)\n</code></pre>\n\n<p>Note that the working directory of the binary corresponds to the repository root directory, not the directory where the binary is defined. You can debug with <code>os.Getwd</code> and <code>filepath.Walk</code>.</p>\n\n<p>You mentioned you wanted to access a yaml file passed in on the command line though. Presumably, you want to be able to access any file the user passes in, not just files mentioned in the <code>data</code> attribute. For this case, take a look at the <code>BUILD_WORKING_DIRECTORY</code> environment variable (<code>bazel run</code> sets this). That gives the path to the directory where <code>bazel run</code> was invoked. Also, <code>BUILD_WORKSPACE_DIRECTORY</code> is the path to the workspace root directory.</p>\n"}], "owner": {"reputation": 679, "user_id": 1426764, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/PdGh6.jpg?s=128&g=1", "display_name": "Rijo Simon", "link": "https://stackoverflow.com/users/1426764/rijo-simon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 603, "favorite_count": 0, "accepted_answer_id": 54010954, "answer_count": 1, "score": -1, "last_activity_date": 1546451640, "creation_date": 1546302226, "last_edit_date": 1546342067, "question_id": 53992306, "link": "https://stackoverflow.com/questions/53992306/failing-to-open-a-file-which-should-be-in-the-base-path", "title": "Failing to open a file which should be in the base path", "body": "<p>I have a Go project (bazel-remote) that tries to read a yaml file passed in the command line, when built with bazel. This yaml file sits in the same location from where I run the <strong>bazel run</strong> command. </p>\n\n<p>But it fails to run because os.Open fails with <strong><em>no such file or directory</em></strong>. </p>\n\n<p>I printed the basePath using os.Getwd, because someone suggested that my basePath might be set wrong. But my basePath is set to a location in my /private/var/tmp/ where the bazel objects are created and stored:</p>\n\n<blockquote>\n  <p>/private/var/tmp/<em>bazel</em>/312feba8ddcde6737ae7dd7ef9bc2a5a/execroot/<strong>main</strong>/bazel-out/darwin-fastbuild/bin/darwin_amd64_static_pure_stripped/bazel-remote.runfiles/<strong>main</strong>'</p>\n</blockquote>\n\n<p>How do I set my basePath correctly? Why is my basePath set to where it is?</p>\n"}, {"tags": ["json", "go", "biginteger"], "comments": [{"owner": {"reputation": 1027, "user_id": 814422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad082805d1ce2e3766886195c720fca6?s=128&d=identicon&r=PG", "display_name": "kbolino", "link": "https://stackoverflow.com/users/814422/kbolino"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546295742, "post_id": 53991835, "comment_id": 94821440, "body": "@Flimzy The <a href=\"https://www.json.org/\" rel=\"nofollow noreferrer\">JSON spec</a> does not specify any maximum (or minimum) value for numbers. JavaScript may lose precision when handling integers larger than 2^54 due to treating all numbers as double precision floating point values but that is not true of all languages, and specifically isn&#39;t true of go. Indeed, using <code>int64</code> has the same implications vis-a-vis JavaScript compatibility but is still commonly used in go."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1546296035, "post_id": 53991835, "comment_id": 94821487, "body": "<a href=\"https://tools.ietf.org/html/rfc7159#section-6\" rel=\"nofollow noreferrer\">RFC 7159</a> warns against using numbers outside the range [-(2^53)+1, (2^53)-1] in JSON, so what you are attempting is not generally considered portable, and should generally be avoided."}, {"owner": {"reputation": 1027, "user_id": 814422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad082805d1ce2e3766886195c720fca6?s=128&d=identicon&r=PG", "display_name": "kbolino", "link": "https://stackoverflow.com/users/814422/kbolino"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546296452, "post_id": 53991835, "comment_id": 94821555, "body": "I added a note about the RFC to the question. I still think this is a valid use of JSON, which despite its first two letters is a general purpose serialization format. Using strings has its own problems, including both sides agreeing that they are numbers-as-strings and also JavaScript clients not coercing them to numbers."}, {"owner": {"reputation": 1027, "user_id": 814422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad082805d1ce2e3766886195c720fca6?s=128&d=identicon&r=PG", "display_name": "kbolino", "link": "https://stackoverflow.com/users/814422/kbolino"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546297036, "post_id": 53991835, "comment_id": 94821630, "body": "I also added a link to relevant discussion on <code>jq</code>&#39;s handling of large integers; passing one of these values through <code>jq</code> is not guaranteed to be a lossless transformation."}], "answers": [{"comments": [{"owner": {"reputation": 19482, "user_id": 1048862, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a0f604322f5a3e0b11aad4c3529f83b5?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/1048862/matt"}, "edited": false, "score": 0, "creation_date": 1585841730, "post_id": 53991836, "comment_id": 107911334, "body": "Thanks for the hints! Note that this solution encodes/decodes from number types because the output isn&#39;t wrapped in quotes, so precision may be lost. Would recommend wrapping in quotes or wrapping json.(Un)Marshal with string values."}, {"owner": {"reputation": 1027, "user_id": 814422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad082805d1ce2e3766886195c720fca6?s=128&d=identicon&r=PG", "display_name": "kbolino", "link": "https://stackoverflow.com/users/814422/kbolino"}, "reply_to_user": {"reputation": 19482, "user_id": 1048862, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a0f604322f5a3e0b11aad4c3529f83b5?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/1048862/matt"}, "edited": false, "score": 0, "creation_date": 1585849218, "post_id": 53991836, "comment_id": 107915642, "body": "Yeah, this solution is only really suitable if you are both reading and writing the JSON with the same code. If you pass the JSON around and cross language or tool boundaries, you&#39;re bound to lose precision (e.g. <code>jq</code> turns all numbers into double precision floating point). I think strings are the better way to go in general."}], "tags": [], "owner": {"reputation": 1027, "user_id": 814422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad082805d1ce2e3766886195c720fca6?s=128&d=identicon&r=PG", "display_name": "kbolino", "link": "https://stackoverflow.com/users/814422/kbolino"}, "is_accepted": false, "score": 3, "last_activity_date": 1546295318, "last_edit_date": 1546295318, "creation_date": 1546294908, "answer_id": 53991836, "question_id": 53991835, "link": "https://stackoverflow.com/questions/53991835/how-to-marshal-and-unmarshal-big-int-in-json/53991836#53991836", "title": "How to marshal and unmarshal big.Int in JSON?", "body": "<p>Create a custom type <code>BigInt</code> which implements <code>json.Marshaler</code> and <code>json.Unmarshaler</code> like the following:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"math/big\"\n)\n\ntype BigInt struct {\n    big.Int\n}\n\nfunc (b BigInt) MarshalJSON() ([]byte, error) {\n    return []byte(b.String()), nil\n}\n\nfunc (b *BigInt) UnmarshalJSON(p []byte) error {\n    if string(p) == \"null\" {\n        return nil\n    }\n    var z big.Int\n    _, ok := z.SetString(string(p), 10)\n    if !ok {\n        return fmt.Errorf(\"not a valid big integer: %s\", p)\n    }\n    b.Int = z\n    return nil\n}\n</code></pre>\n\n<p>Rationale:</p>\n\n<ul>\n<li>Implemented as a struct type embedding <code>big.Int</code> instead of as a subtype of <code>big.Int</code> so that the methods (Add, SetString, etc.) are kept</li>\n<li>MarshalJSON takes a value receiver so that marshaled values using <code>BigInt</code> don't have to use pointers</li>\n<li>UnmarshalJSON takes a pointer receiver because it modifies the receiver; however, types using BigInt still don't have to use pointers</li>\n<li>UnmarshalJSON works on a temporary value because the SetString method has undefined behavior on its receiver in the case of errors</li>\n</ul>\n\n<p>As with <code>big.Int</code> the zero value is useful and is equal to the number 0.</p>\n"}], "owner": {"reputation": 1027, "user_id": 814422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad082805d1ce2e3766886195c720fca6?s=128&d=identicon&r=PG", "display_name": "kbolino", "link": "https://stackoverflow.com/users/814422/kbolino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1463, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1546297766, "creation_date": 1546294908, "last_edit_date": 1546297766, "question_id": 53991835, "link": "https://stackoverflow.com/questions/53991835/how-to-marshal-and-unmarshal-big-int-in-json", "title": "How to marshal and unmarshal big.Int in JSON?", "body": "<p>The question <a href=\"https://stackoverflow.com/questions/48802728/how-to-marshal-json-with-bigints\">How to marshal JSON with bigints?</a> is about marshaling <code>big.Int</code> values into strings in JSON. This question asks, how does one marshal <em>and unmarshal</em> <code>big.Int</code> values natively <em>as numbers</em> in JSON?</p>\n\n<p>Passing around large values marshaled in this manner may be incompatible with other implementations of JSON, particularly JavaScript and <a href=\"https://github.com/stedolan/jq/issues/143\" rel=\"nofollow noreferrer\">jq</a>, as <a href=\"https://tools.ietf.org/html/rfc7159#section-6\" rel=\"nofollow noreferrer\">RFC 7159</a> notes:</p>\n\n<blockquote>\n  <p>Note that when such software is used, numbers that are integers and\n  are in the range <code>[-(2**53)+1, (2**53)-1]</code> are interoperable in the\n  sense that implementations will agree exactly on their numeric\n  values.</p>\n</blockquote>\n"}, {"tags": ["go", "random"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1546287357, "last_edit_date": 1546287357, "creation_date": 1546284701, "answer_id": 53990844, "question_id": 53990816, "link": "https://stackoverflow.com/questions/53990816/a-difference-between-seed-and-rand-seed/53990844#53990844", "title": "A difference between Seed and Rand.Seed", "body": "<p>There is a <a href=\"https://golang.org/pkg/math/rand/#Seed\" rel=\"nofollow noreferrer\"><code>rand.Seed()</code></a> <em>function</em>, and there is a <a href=\"https://golang.org/pkg/math/rand/#Rand.Seed\" rel=\"nofollow noreferrer\"><code>Rand.Seed()</code></a> <em>method</em>. Your quote originates from the documentation of the <code>Rand.Seed()</code> method.</p>\n\n<p>Global functions of the <a href=\"https://golang.org/pkg/math/rand/\" rel=\"nofollow noreferrer\"><code>math/rand</code></a> package operate on a global <a href=\"https://golang.org/pkg/math/rand/#Rand\" rel=\"nofollow noreferrer\"><code>rand.Rand</code></a> instance. If you check the source code of <code>rand.Seed()</code>:</p>\n\n<pre><code>func Seed(seed int64) { globalRand.Seed(seed) }\n</code></pre>\n\n<p>The global functions are safe for concurrent use, so all other packages can use it (in a shared manner). The global <code>rand.Rand</code> instance is provided for convenience, you can use it \"out-of-the box\" without any preparation (except the need to properly seed it) and without any synchronization.</p>\n\n<p>Instances of <code>rand.Rand</code> are not safe for concurrent use, each goroutine that needs a <code>rand.Rand</code> for deterministic random sequences should create one, and seed it appropriately. Or if a <code>rand.Rand</code> is to be shared between multiple goroutines, explicit synchronization is required.</p>\n\n<p>Pros of using the global <code>rand.Rand</code> (via the global functions) are: (1) ease of use (it's implicitly shared with everyone) and (2) no synchronization is needed.</p>\n\n<p>Pros of creating and using a custom <code>rand.Rand</code> instance: (1) it's faster (it's not synchronized implicitly) and (2) you are in control of who has access to it, so you can use it to repeat pseudo-random sequences (you can't do that with the global instance as \"anyone\" may use it concurrently with you).</p>\n\n<p><strong>Edit:</strong></p>\n\n<blockquote>\n  <p>We are using the same seed in two different threads, so is such using of <code>rand.Seed</code> considered to be a thread non-safe?</p>\n</blockquote>\n\n<p>You only call <code>rand.Seed</code> once, so actually it doesn't even matter if it's thread safe or not, it is not called concurrently. If <code>rand.Seed()</code> would be called from multiple goroutines concurrently, only then would it matter whether it's safe for concurrent use. And as stated earlier in my answer: <em>\"The global functions are safe for concurrent use...\"</em></p>\n\n<p>What you do call from multiple goroutines concurrently is <code>rand.Intn()</code>, but again, it's safe to do that.</p>\n"}], "owner": {"reputation": 129, "user_id": 8049659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d80e2c967ad7a3887ec441485056cf8?s=128&d=identicon&r=PG&f=1", "display_name": "user8049659", "link": "https://stackoverflow.com/users/8049659/user8049659"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 535, "favorite_count": 2, "accepted_answer_id": 53990844, "answer_count": 1, "score": 3, "last_activity_date": 1546287357, "creation_date": 1546284414, "last_edit_date": 1546286928, "question_id": 53990816, "link": "https://stackoverflow.com/questions/53990816/a-difference-between-seed-and-rand-seed", "title": "A difference between Seed and Rand.Seed", "body": "<p>The golang docs says that </p>\n\n<blockquote>\n  <p>Seed, unlike the Rand.Seed method, is safe for concurrent use.</p>\n</blockquote>\n\n<p>The <code>rand.Seed</code> is actually from <code>math/rand</code> package, but what is Seed? If <code>Seed</code> is another function then it's not present in <code>math/rand</code> so it's unclear from where that function comes from?</p>\n\n<p><em>update:</em>\nI'm exploring the demo program where in <code>main</code> we execute</p>\n\n<pre><code>rand.Seed(time.Now().UnixNano())\ngo process(...)\ngo process(...)    \n</code></pre>\n\n<p>where the <code>process</code> is determined like</p>\n\n<pre><code>func process(...) {\n    time.Sleep(time.Duration(rand.Intn(30)) * time.Second)\n    ...\n}\n</code></pre>\n\n<p>We are using the same seed in two different threads, so is such using of <code>rand.Seed</code> considered to be a thread non-safe?</p>\n"}, {"tags": ["mysql", "go", "go-gin", "sqlx"], "answers": [{"tags": [], "owner": {"reputation": 188041, "user_id": 10676716, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/arsQA.jpg?s=128&g=1", "display_name": "GMB", "link": "https://stackoverflow.com/users/10676716/gmb"}, "is_accepted": true, "score": 3, "last_activity_date": 1546284444, "creation_date": 1546284444, "answer_id": 53990818, "question_id": 53990799, "link": "https://stackoverflow.com/questions/53990799/how-to-get-id-of-last-inserted-row-from-sqlx/53990818#53990818", "title": "How to get id of last inserted row from sqlx?", "body": "<p>Looks like you just need :</p>\n\n<pre><code>resultPost.LastInsertId()\n</code></pre>\n\n<p>For more information, search for LastInsertId in <a href=\"https://golang.org/pkg/database/sql/#Result\" rel=\"nofollow noreferrer\">this documentation</a></p>\n"}, {"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 3, "creation_date": 1546284987, "post_id": 53990819, "comment_id": 94819446, "body": "Fixed. You would do yourself a big favor to learn to read the docs directly :)"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 532, "user_id": 2202617, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/00b452ec036612d45ff9190f61779147?s=128&d=identicon&r=PG&f=1", "display_name": "Bravo Delta", "link": "https://stackoverflow.com/users/2202617/bravo-delta"}, "edited": false, "score": 0, "creation_date": 1594625774, "post_id": 53990819, "comment_id": 111179337, "body": "@BravoDelta: Better to just edit the question with a correction, than to leave a comment, which will eventually be deleted. But thanks for the correction. And it&#39;s now updated."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 3, "last_activity_date": 1594625780, "last_edit_date": 1594625780, "creation_date": 1546284487, "answer_id": 53990819, "question_id": 53990799, "link": "https://stackoverflow.com/questions/53990799/how-to-get-id-of-last-inserted-row-from-sqlx/53990819#53990819", "title": "How to get id of last inserted row from sqlx?", "body": "<p>The return value from <code>Exec</code>, <a href=\"https://golang.org/pkg/database/sql/#Result\" rel=\"nofollow noreferrer\"><code>Result</code></a> is not meant to be accessed directly--it's an object with two methods to call, one of which is <code>LastInsertId()</code>.</p>\n<pre><code>lastId, err := resultPost.LastInsertId()\nif err != nil {\n    panic(err)\n}\nfmt.Println(&quot;LastInsertId: &quot;, lastId)\n</code></pre>\n"}], "owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1277, "favorite_count": 0, "accepted_answer_id": 53990818, "answer_count": 2, "score": 2, "last_activity_date": 1597431363, "creation_date": 1546284233, "last_edit_date": 1597431363, "question_id": 53990799, "link": "https://stackoverflow.com/questions/53990799/how-to-get-id-of-last-inserted-row-from-sqlx", "title": "How to get id of last inserted row from sqlx?", "body": "<p>I'd like to get back the id of the last post inserted into MySql database using <code>sqlx</code>:</p>\n\n<pre><code>resultPost, err := shared.Dbmap.Exec(\"INSERT INTO post (user_id, description, link) VALUES (?, ?, ?)\", userID, title, destPath)\nif err != nil {\n    log.Println(err)\n    c.JSON(\n        http.StatusInternalServerError,\n        gin.H{\"error\": \"internal server error\"})\n}\n\nfmt.Println(\"resultPost is:\", resultPost)\n</code></pre>\n\n<p>The problem is that the <code>resultPost</code> is printed as an object:</p>\n\n<pre><code>resultPost is: {0xc420242000 0xc4202403a0}\n</code></pre>\n\n<p>So I'm wondering what is the correct way to extract the id of the row just inserted?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3679, "user_id": 2487336, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6eae2a9fe7257a46c91f0515087e2940?s=128&d=identicon&r=PG", "display_name": "xgord", "link": "https://stackoverflow.com/users/2487336/xgord"}, "edited": false, "score": 0, "creation_date": 1546276762, "post_id": 53989829, "comment_id": 94817351, "body": "(thanks for correction about embedded field). Your solution&#39;s behavior is different from the behavior of the default unmarshal. your solution: <code>unmarshalled: &amp;{Obj:&lt;nil&gt; Y:0} --&gt; &lt;nil&gt;</code>; default: <code>unmarshalled: &amp;{Obj:0x416080 Y:3} --&gt; &amp;{X:5}</code>. But because it <i>is</i> <code>nil</code>, I can&#39;t just set its value to a new <code>Obj{}</code> in the custom <code>UnmarshalJSON</code>."}, {"owner": {"reputation": 3679, "user_id": 2487336, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6eae2a9fe7257a46c91f0515087e2940?s=128&d=identicon&r=PG", "display_name": "xgord", "link": "https://stackoverflow.com/users/2487336/xgord"}, "edited": false, "score": 0, "creation_date": 1546277384, "post_id": 53989829, "comment_id": 94817497, "body": "I also didn&#39;t think <code>UnmarshalJSON</code> funcs needed to do their own <code>nil</code> checks. Doesn&#39;t <code>json.Unmarshal</code> handle that for them? From the <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">docs</a> for <code>json.Unmarshal</code>: &quot;If v is nil or not a pointer, Unmarshal returns an InvalidUnmarshalError [...]&quot; and then &quot;To unmarshal JSON into a value implementing the Unmarshaler interface, Unmarshal calls that value&#39;s UnmarshalJSON method, including when the input is a JSON null&quot;"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 3679, "user_id": 2487336, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6eae2a9fe7257a46c91f0515087e2940?s=128&d=identicon&r=PG", "display_name": "xgord", "link": "https://stackoverflow.com/users/2487336/xgord"}, "edited": false, "score": 3, "creation_date": 1546279226, "post_id": 53989829, "comment_id": 94817944, "body": "@xgord The embedded field&#39;s (<code>*Obj</code>) methods get promoted and become part of the method set of the embedding type (<code>Container</code>). So json.Unmarshal checks whether Container is nil or not, later it checks if Container implements the json.Unmarshaler interface and that check returns true thanks to the embedded <code>*Obj</code> and its promoted methods, so json.Unmarshal calls UnmarshalJSON on the <code>(*Obj)(nil)</code> <i>through</i> the non-nil Container."}, {"owner": {"reputation": 3679, "user_id": 2487336, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6eae2a9fe7257a46c91f0515087e2940?s=128&d=identicon&r=PG", "display_name": "xgord", "link": "https://stackoverflow.com/users/2487336/xgord"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546279553, "post_id": 53989829, "comment_id": 94818037, "body": "@mkopriva ohhhh, that makes sense. and indeed, if I initialize the <code>Container</code> obj as <code>c := &amp;Container{Obj: &amp;Obj{}}</code>, then the panic doesn&#39;t happen. I guess my problem was more similar to the part of the question I linked than I thought... thanks!"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 3679, "user_id": 2487336, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6eae2a9fe7257a46c91f0515087e2940?s=128&d=identicon&r=PG", "display_name": "xgord", "link": "https://stackoverflow.com/users/2487336/xgord"}, "edited": false, "score": 2, "creation_date": 1546279687, "post_id": 53989829, "comment_id": 94818068, "body": "@xgord no problem, btw if you want to lazily initialize Obj you don&#39;t have to use a map inside Container&#39;s UnmarshalJSON, you could do something like: <a href=\"https://play.golang.com/p/80NH8ULZn7f\" rel=\"nofollow noreferrer\">play.golang.com/p/80NH8ULZn7f</a>"}, {"owner": {"reputation": 3679, "user_id": 2487336, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6eae2a9fe7257a46c91f0515087e2940?s=128&d=identicon&r=PG", "display_name": "xgord", "link": "https://stackoverflow.com/users/2487336/xgord"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546280069, "post_id": 53989829, "comment_id": 94818166, "body": "@mkopriva why doesn&#39;t that solution run into the same problem, where  <code>*Obj.UnmarshalJSON</code>  is promoted to become <code>temporary</code>&#39;s <code>UnmarshalJSON</code>? (I tested it out, so I know it works -- I&#39;m just confused why it&#39;s different than the original)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 3679, "user_id": 2487336, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6eae2a9fe7257a46c91f0515087e2940?s=128&d=identicon&r=PG", "display_name": "xgord", "link": "https://stackoverflow.com/users/2487336/xgord"}, "edited": false, "score": 1, "creation_date": 1546280213, "post_id": 53989829, "comment_id": 94818207, "body": "@xgord at the top i&#39;m checking whether Obj is nil or not and if yes then I initialize it, so json.Unmarshal is safe to call UnmarshalJSON on it."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 3679, "user_id": 2487336, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6eae2a9fe7257a46c91f0515087e2940?s=128&d=identicon&r=PG", "display_name": "xgord", "link": "https://stackoverflow.com/users/2487336/xgord"}, "edited": false, "score": 0, "creation_date": 1546280327, "post_id": 53989829, "comment_id": 94818236, "body": "@xgord <code>(*temporary)(c)</code> converts the <code>c</code> value&#39;s type from <code>*Container</code> to <code>*temporary</code> but its contents don&#39;t change, its Obj is still initialized thanks to the <code>c.Obj = new(Obj)</code> line."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1546280949, "post_id": 53989829, "comment_id": 94818399, "body": "@mkopriva, that hack with a throwaway type is neat; thanks!"}, {"owner": {"reputation": 3679, "user_id": 2487336, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6eae2a9fe7257a46c91f0515087e2940?s=128&d=identicon&r=PG", "display_name": "xgord", "link": "https://stackoverflow.com/users/2487336/xgord"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546283887, "post_id": 53989829, "comment_id": 94819154, "body": "@mkopriva yes very handy! thanks for additional explanations. worthy of an official answer if you want to compile it all into one."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1546276352, "creation_date": 1546276352, "answer_id": 53989829, "question_id": 53989758, "link": "https://stackoverflow.com/questions/53989758/unmarshal-embedded-field-pointer-panics-when-field-implements-unmarshaljson/53989829#53989829", "title": "Unmarshal embedded field pointer panics when field implements UnmarshalJSON", "body": "<p>Because the default behavior checks for <code>nil</code> and your custom unmarshaller does not. You need some logic in your <code>UnmarshalJSON</code> to check if <code>o</code> is <code>nil</code> and behave appropriately, instead of assuming <code>o</code> is not <code>nil</code> (by trying to access one of its fields), thereby triggering a panic.</p>\n\n<pre><code>func (o *Obj) UnmarshalJSON(b []byte) (err error) {\n    if o == nil {\n        return nil // maybe? What do you want to happen in this case?\n    }\n    m := make(map[string]int)\n    err = json.Unmarshal(b, &amp;m)\n    if err != nil {\n        return nil\n    }\n    o.X = m[\"x\"] // the line indicated by panic\n    return nil\n}\n</code></pre>\n\n<p>Also just for future reference, your <code>*Obj</code> field is not an \"anonymous field\", it is an <em>embedded</em> field: <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Struct_types</a></p>\n"}], "owner": {"reputation": 3679, "user_id": 2487336, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6eae2a9fe7257a46c91f0515087e2940?s=128&d=identicon&r=PG", "display_name": "xgord", "link": "https://stackoverflow.com/users/2487336/xgord"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1546276823, "creation_date": 1546275846, "last_edit_date": 1546276823, "question_id": 53989758, "link": "https://stackoverflow.com/questions/53989758/unmarshal-embedded-field-pointer-panics-when-field-implements-unmarshaljson", "title": "Unmarshal embedded field pointer panics when field implements UnmarshalJSON", "body": "<p>I have a <code>struct</code> that embeds an embedded pointer to another <code>struct</code>. When I use the default <code>json.Unmarshal</code> behavior, it works perfectly. But when I implement <code>UnmarshalJSON</code> for the <strong><em>embedded</em></strong> <code>struct</code>'s type but <em>not</em> the outer <code>struct</code>, then go panics with null pointer dereference.</p>\n\n<p>If I implement <code>UnmarshalJSON</code> for the outer <code>struct</code> type as well, then it works. However, the outer struct has many fields that I would rather not have to manually unmarshal.</p>\n\n<ol>\n<li>Why does implementing <code>UnmarshalJSON</code> on one and not the other cause a panic?</li>\n<li>Is there a way to get it work without implemented <code>UnmarshalJSON</code> for the outer type?</li>\n<li>If not, is there a simpler/less manual way to implement <code>UnmarshalJSON</code> for the outer type?</li>\n</ol>\n\n<p><strong><em>Note:</em></strong> <em>There is a question with a similar title, \"<a href=\"https://stackoverflow.com/questions/29667379/json-unmarshal-fails-when-embedded-type-has-unmarshaljson\">json.Unmarshal fails when embedded type has UnmarshalJSON\n</a>\", but the issue there is different from mine.</em></p>\n\n<p>tl;dr: The rest of this question is just a lengthy example of the above.</p>\n\n<h3>Base Example</h3>\n\n<p>(play.golang.org <a href=\"https://play.golang.org/p/yyFX-t8VMn9\" rel=\"nofollow noreferrer\">version</a> of example)</p>\n\n<p>The two structs, one with an embedded field pointer to the other:</p>\n\n<p><em>(Simplified for example -- this doesn't really need its own <code>UnmarshalJSON</code> but it demonstrates the problem.)</em></p>\n\n<pre><code>type Obj struct {\n    X int `json:\"x\"`\n}\n\ntype Container struct {\n    *Obj\n    Y int `json:\"y\"`\n}\n</code></pre>\n\n<p>Invoking unmarshal:</p>\n\n<pre><code>func main() {\n    b := []byte(`{\"x\": 5, \"y\": 3}`)\n    c := &amp;Container{}\n    err := json.Unmarshal(b, c)\n    if err != nil {\n        fmt.Printf(\"error ummarshalling json: %+v\\n\", err)\n        return\n    }\n    fmt.Printf(\"unmarshalled: %+v --&gt; %+v\\n\", c, c.Obj)\n}\n</code></pre>\n\n<p>Without implementing any <code>UnmarshalJSON</code> funcs, this works fine:</p>\n\n<pre><code>unmarshalled: &amp;{Obj:0x416080 Y:3} --&gt; &amp;{X:5}\n</code></pre>\n\n<h3>Panic</h3>\n\n<p>But, if I add <code>UnmarshalJSON</code> to the embedded <code>Obj</code> type only, then the program panics, as the <code>json.Unmarshal</code> call passes a <code>nil</code> pointer when it tries to unmarshal <code>*Obj</code>.</p>\n\n<pre><code>func (o *Obj) UnmarshalJSON(b []byte) (err error) {\n    m := make(map[string]int)\n    err = json.Unmarshal(b, &amp;m)\n    if err != nil {\n        return nil\n    }\n    o.X = m[\"x\"] // the line indicated by panic\n    return nil\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[...]\nmain.(*Obj).UnmarshalJSON(0x0, 0x416030, 0x10, 0x10, 0x0, 0x0)\n    /tmp/sandbox185809294/main.go:18 +0x130\n[...]\n</code></pre>\n\n<p><strong>Question:</strong> Why does it panic here but not with the default unmarshal behavior? I'd think that if a <code>nil</code> <code>*Obj</code> is being passed here, then the default behavior also passes around a <code>nil</code> pointer...</p>\n\n<h3>Fixing the panic</h3>\n\n<p>It no longer panics when I implement <code>UnmarshalJSON</code> for the outer <code>Container</code> type:</p>\n\n<pre><code>func (c *Container) UnmarshalJSON(b []byte) (err error) {\n    m := make(map[string]int)\n    err = json.Unmarshal(b, &amp;m)\n    if err != nil {\n        return err\n    }\n    c.Obj = &amp;Obj{X: m[\"x\"]}\n    c.Y = m[\"y\"]\n    return nil\n}\n</code></pre>\n\n<p>But unmarshalling <code>Container</code> manually this way gets tedious if both the real <code>Container</code> and real <code>Obj</code> have more fields than this, each with different types.</p>\n\n<p><strong>Question:</strong> Is there a simpler way to prevent this panic?</p>\n"}, {"tags": ["go", "unsafe-pointers"], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 10852381, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dde1fa697e2aa020835261c80af46e9a?s=128&d=identicon&r=PG&f=1", "display_name": "John Boldt", "link": "https://stackoverflow.com/users/10852381/john-boldt"}, "is_accepted": false, "score": 2, "last_activity_date": 1546288429, "creation_date": 1546288429, "answer_id": 53991222, "question_id": 53989406, "link": "https://stackoverflow.com/questions/53989406/win-registerrawinputdevices-always-returns-false/53991222#53991222", "title": "win.RegisterRawInputDevices Always Returns false", "body": "<p>After a couple of hours researching Go's structure alignment strategy and all kinds of other low level stuff, I finally realized that I had incorrect values for <code>RAWINPUTDEVICE.UsUsagePage</code>! Elements 2, 3, and 4 should have <code>UsUsagePage</code> set to <code>0x0D</code> instead of <code>0x00</code>! Oh well, at least I learned a lot about how Go aligns structure elements to word boundaries!</p>\n"}], "owner": {"reputation": 51, "user_id": 10852381, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dde1fa697e2aa020835261c80af46e9a?s=128&d=identicon&r=PG&f=1", "display_name": "John Boldt", "link": "https://stackoverflow.com/users/10852381/john-boldt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1546288429, "creation_date": 1546272942, "last_edit_date": 1546286630, "question_id": 53989406, "link": "https://stackoverflow.com/questions/53989406/win-registerrawinputdevices-always-returns-false", "title": "win.RegisterRawInputDevices Always Returns false", "body": "<p>I'm using the <a href=\"https://github.com/lxn/win\" rel=\"nofollow noreferrer\">https://github.com/lxn/win</a> package to access low level Windows calls in Go. I'm calling <code>win.RegisterRawInputDevices</code> to register devices for raw input data, but it always returns false. I've done this in C# with no problems. Below is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"syscall\"\n    \"unsafe\"\n    \"github.com/lxn/win\"\n)\n\nfunc WndProc(hWnd win.HWND, msg uint32, wParam, lParam uintptr) uintptr {\n    switch msg {\n    case win.WM_CREATE:\n        fmt.Println(\"Received WM_CREATE message\")\n        devices := getRawInputDevices(hWnd)\n        len := uint32(len(devices))\n        size := uint32(unsafe.Sizeof(devices[0]))\n        if !win.RegisterRawInputDevices(&amp;devices[0], len, size) {\n            panic(\"Unable to register devices\")\n        }\n\n    case win.WM_DESTROY:\n        fmt.Println(\"Posting quit message\")\n        win.PostQuitMessage(0)\n    default:\n        return win.DefWindowProc(hWnd, msg, wParam, lParam)\n    }\n\n    return 0\n}\n\nfunc getRawInputDevices(hWnd win.HWND) []win.RAWINPUTDEVICE {\n    devices := make([]win.RAWINPUTDEVICE, 5)\n    devices[0].UsUsagePage = 0x01\n    devices[0].UsUsage = 0x02\n    devices[0].DwFlags = win.RIDEV_INPUTSINK\n    devices[0].HwndTarget = hWnd\n    devices[1].UsUsagePage = 0x01\n    devices[1].UsUsage = 0x06\n    devices[1].DwFlags = win.RIDEV_INPUTSINK\n    devices[1].HwndTarget = hWnd\n    devices[2].UsUsagePage = 0x00\n    devices[2].UsUsage = 0x51\n    devices[2].DwFlags = win.RIDEV_INPUTSINK\n    devices[2].HwndTarget = hWnd\n    devices[3].UsUsagePage = 0x00\n    devices[3].UsUsage = 0x04\n    devices[3].DwFlags = win.RIDEV_INPUTSINK\n    devices[3].HwndTarget = hWnd\n    devices[4].UsUsagePage = 0x00\n    devices[4].UsUsage = 0x00\n    devices[4].DwFlags = win.RIDEV_INPUTSINK\n    devices[4].HwndTarget = hWnd\n    return devices\n}\n\nfunc WinMain() int {\n\n    hInstance := win.GetModuleHandle(syscall.StringToUTF16Ptr(\"\"))\n    lpszClassName := syscall.StringToUTF16Ptr(\"WNDclass\")\n    var wcex win.WNDCLASSEX\n    wcex.HInstance = hInstance\n    wcex.LpszClassName = lpszClassName\n    wcex.LpfnWndProc = syscall.NewCallback(WndProc)\n    wcex.CbSize = uint32(unsafe.Sizeof(wcex))\n    win.RegisterClassEx(&amp;wcex)\n    win.CreateWindowEx(\n        0, lpszClassName, syscall.StringToUTF16Ptr(\"Simple Go Window!\"),\n        win.WS_OVERLAPPEDWINDOW,\n        win.CW_USEDEFAULT, win.CW_USEDEFAULT, 400, 400, 0, 0, hInstance, nil)\n    var msg win.MSG\n    for {\n        if win.GetMessage(&amp;msg, 0, 0, 0) == 0 {\n            break\n        }\n        win.TranslateMessage(&amp;msg)\n        win.DispatchMessage(&amp;msg)\n    }\n    return int(msg.WParam)\n}\n\nfunc main() {\n    WinMain()\n    return\n}\n</code></pre>\n\n<p>I'm receiving the <code>WM_CREATE</code> message, but <code>win.RegisterRawInputDevices</code> is always returning false with a \"The parameter is incorrect.\" error. As I mentioned, I've done this in C# with no problems, so I'm familiar with the basic steps. I am new to Go, so I may be missing something. Any ideas?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546266265, "post_id": 53988457, "comment_id": 94814293, "body": "I don&#39;t understand your question. Is it simply &quot;How do I know the underlying type of the value returned by <code>.Value()</code>?&quot;  If so, the answer usually is: You put the value there, so you should know what you put there."}, {"owner": {"reputation": 907, "user_id": 10088259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/590a29bb9182f252bc6e7e5885f3423a?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Hors", "link": "https://stackoverflow.com/users/10088259/fred-hors"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546266439, "post_id": 53988457, "comment_id": 94814359, "body": "Dear @Flimzy I edited. I think now is more clear."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1546266463, "post_id": 53988457, "comment_id": 94814365, "body": "You must pass the correct key value, which is most of the time not a plain string but a pointer. <a href=\"https://github.com/go-chi/chi/blob/44932d207a10cd2f26b06095a61843c9807188ea/context.go#L12\" rel=\"nofollow noreferrer\">RouteContext</a>, <a href=\"https://github.com/golang/go/blob/9e277f7d554455e16ba3762541c53e9bfc1d8188/src/net/http/server.go#L237\" rel=\"nofollow noreferrer\">http-server</a>, <a href=\"https://github.com/golang/go/blob/9e277f7d554455e16ba3762541c53e9bfc1d8188/src/net/http/server.go#L243\" rel=\"nofollow noreferrer\">local-addr</a>. ie <code>ctx.Value(chi.RouteCtxKey)</code>"}, {"owner": {"reputation": 907, "user_id": 10088259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/590a29bb9182f252bc6e7e5885f3423a?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Hors", "link": "https://stackoverflow.com/users/10088259/fred-hors"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546266567, "post_id": 53988457, "comment_id": 94814401, "body": "@mkopriva and what about access to: <code>&amp;chi.contextKey{name:&quot;RouteContext&quot;}</code> value?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1546266823, "post_id": 53988457, "comment_id": 94814495, "body": "If you got <code>nil</code>, that means that key wasn&#39;t set. And your code doesn&#39;t set it, so that would seem to make sense."}, {"owner": {"reputation": 907, "user_id": 10088259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/590a29bb9182f252bc6e7e5885f3423a?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Hors", "link": "https://stackoverflow.com/users/10088259/fred-hors"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546268095, "post_id": 53988457, "comment_id": 94814869, "body": "@Flimzy but I can see it in debug, see pic: <a href=\"https://user-images.githubusercontent.com/41120635/50558958-7e2ce080-0cf2-11e9-9572-f255529bbfc2.png\" rel=\"nofollow noreferrer\">user-images.githubusercontent.com/41120635/&hellip;</a>. In this case I got <code>nil</code> for <code>&quot;user&quot;</code> value. Why?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1546268426, "post_id": 53988457, "comment_id": 94814985, "body": "@FredHors <code>&amp;chi.contextKey{name:&quot;RouteContext&quot;} != &quot;RouteContext&quot;</code>, have you already tried  <code>ctx.Value(chi.RouteCtxKey)</code> as I&#39;ve pointed out in the previous comment?"}, {"owner": {"reputation": 907, "user_id": 10088259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/590a29bb9182f252bc6e7e5885f3423a?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Hors", "link": "https://stackoverflow.com/users/10088259/fred-hors"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546268511, "post_id": 53988457, "comment_id": 94815002, "body": "@mkopriva I updated question which the real problem I had. Can you read and answer that so I can choose your answer?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1546268607, "post_id": 53988457, "comment_id": 94815027, "body": "@FredHors <a href=\"https://github.com/volatiletech/authboss/blob/db25c5e30be65b7a9003e28680d9b301f53f83ab/context.go#L13\" rel=\"nofollow noreferrer\">github.com/volatiletech/authboss/blob/&hellip;</a> pass that to ctx.Value. Simply passing <code>&quot;user&quot;</code> won&#39;t match because it&#39;s a different string <i>type</i>."}, {"owner": {"reputation": 907, "user_id": 10088259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/590a29bb9182f252bc6e7e5885f3423a?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Hors", "link": "https://stackoverflow.com/users/10088259/fred-hors"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546268942, "post_id": 53988457, "comment_id": 94815125, "body": "@mkopriva thanks a lot. It now works. Is there a way to understand immediately these types? Do you see this pic: <a href=\"https://i.stack.imgur.com/sZEvD.png\" rel=\"nofollow noreferrer\">i.stack.imgur.com/sZEvD.png</a> It is difficult from here to understand, right?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1546269773, "post_id": 53988457, "comment_id": 94815364, "body": "@FredHors I don&#39;t think there is anything in the std lib that would help you but I&#39;m fairly certain that if you look on github you&#39;ll find some &quot;object dumper&quot; code that you can use. Alternatively with the help of the <code>reflect</code> package you should be able to implement something yourself. That said, I don&#39;t think any of that is necessary for this specific problem because most, if not all, packages that use context to store values and expect the client code to retrieve those values will export the keys for the client or will export functions that the client can call to retrieve the values."}, {"owner": {"reputation": 907, "user_id": 10088259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/590a29bb9182f252bc6e7e5885f3423a?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Hors", "link": "https://stackoverflow.com/users/10088259/fred-hors"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546270007, "post_id": 53988457, "comment_id": 94815449, "body": "@mkopriva thanks a lot. \u2665"}], "owner": {"reputation": 907, "user_id": 10088259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/590a29bb9182f252bc6e7e5885f3423a?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Hors", "link": "https://stackoverflow.com/users/10088259/fred-hors"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 415, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1546342502, "creation_date": 1546265870, "last_edit_date": 1546342502, "question_id": 53988457, "link": "https://stackoverflow.com/questions/53988457/how-to-access-keys-in-context", "title": "How to access keys in Context", "body": "<p><strong>FIRST EXAMPLE</strong>:</p>\n\n<p>I'm using <code>chi</code> router (github.com/go-chi/chi) and this simple default code:</p>\n\n<pre><code>func main() {\n    router := chi.NewRouter()\n\n    router.Group(func(subrouter chi.Router) {\n\n        subrouter.Use(AddContext)\n\n        subrouter.Get(\"/\", func(w http.ResponseWriter, r *http.Request) {\n            ctx := r.Context()\n\n            routeContext := ctx.Value(\"RouteContext\")\n            test := ctx.Value(\"myContextTestKey\")\n\n            fmt.Printf(\"ctx: %+v\\n\", ctx)\n            fmt.Printf(\"routeContext: %+v\\n\", routeContext)\n            fmt.Printf(\"test: %+v\\n\", test)\n        })\n    })\n\n    srv := &amp;http.Server{\n        Addr:    \":\" + Port,\n        Handler: router,\n    }\n    err := srv.ListenAndServe()\n    CheckErr(err)\n}\n\nfunc AddContext(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        ctx := context.WithValue(r.Context(), \"myContextTestKey\", \"myContextTestValue\")\n        next.ServeHTTP(w, r.WithContext(ctx))\n    })\n}\n</code></pre>\n\n<p>This is my context if I <code>Printf</code> it:</p>\n\n<pre><code>ctx: context.Background\n\n.WithValue(&amp;http.contextKey{name:\"http-server\"}, &amp;http.Server{Addr:\":3000\", Handler:(*chi.Mux)(0xc0002f8840), TLSConfig:(*tls.Config)(0xc000430300), ReadTimeout:0, ReadHeaderTimeout:0, WriteTimeout:0, IdleTimeout:0, MaxHeaderBytes:0, TLSNextProto:map[string]func(*http.Server, *tls.Conn, http.Handler){\"h2\":(func(*http.Server, *tls.Conn, http.Handler))(0x78b450)}, ConnState:(func(net.Conn, http.ConnState))(nil), ErrorLog:(*log.Logger)(nil), disableKeepAlives:0, inShutdown:0, nextProtoOnce:sync.Once{m:sync.Mutex{state:0, sema:0x0}, done:0x1}, nextProtoErr:error(nil), mu:sync.Mutex{state:0, sema:0x0}, listeners:map[*net.Listener]struct {}{(*net.Listener)(0xc0001222b0):struct {}{}}, activeConn:map[*http.conn]struct {}{(*http.conn)(0xc000149680):struct {}{}, (*http.conn)(0xc000160460):struct {}{}}, doneChan:(chan struct {})(nil), onShutdown:[]func(){(func())(0x7972c0)}})\n\n.WithValue(&amp;http.contextKey{name:\"local-addr\"}, &amp;net.TCPAddr{IP:net.IP{0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x1}, Port:3000, Zone:\"\"}).WithCancel.WithCancel\n\n.WithValue(&amp;chi.contextKey{name:\"RouteContext\"}, &amp;chi.Context{Routes:(*chi.Mux)(0xc0002f8840), RoutePath:\"\", RouteMethod:\"GET\", RoutePatterns:[]string{\"/\"}, URLParams:chi.RouteParams{Keys:[]string(nil), Values:[]string(nil)}, routePattern:\"/\", routeParams:chi.RouteParams{Keys:[]string(nil), Values:[]string(nil)}, methodNotAllowed:false})\n\n.WithValue(\"myContextTestKey\", \"myContextTestValue\")\n</code></pre>\n\n<p><strong>SECOND EXAMPLE</strong>:</p>\n\n<p>Using github.com/volatiletech/authboss I'm trying to access context using this code:</p>\n\n<pre><code>router.Use(ab.LoadClientStateMiddleware)\n\nrouter.Group(func(subrouter chi.Router) {\n    subrouter.Use(authboss.Middleware2(ab, 1, 1))\n    subrouter.Get(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        if user := r.Context().Value(\"user\"); user != nil {\n            fmt.Println(user.(auth.User))\n        } else {\n            fmt.Println(\"Still nil\")\n        }\n    }\n}\n</code></pre>\n\n<p>and as you can see from this pic:</p>\n\n<p><a href=\"https://i.stack.imgur.com/sZEvD.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/sZEvD.png\" alt=\"debugging\"></a></p>\n\n<p>the key <code>user</code> is there.</p>\n\n<p><strong>QUESTIONS</strong>:</p>\n\n<p>1) <strong>Why I can't access it with <code>r.Context().Value(\"user\")? Why always</code>nil`?</strong></p>\n\n<p>2) Why I got <code>nil</code> for <code>routeContext</code> and got correctly <code>myContextTestValue</code> for <code>test</code> var?</p>\n\n<p>3) <strong>How to read other keys in my Context?</strong></p>\n\n<p><strong>Note</strong>: I don't have this problem just with <code>chi router</code>, I cannot understand how to access keys in context. I know I have to use in <code>.Value()</code> the same type of the key but how to know the type before?</p>\n"}, {"tags": ["oop", "go", "polymorphism"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1546264498, "post_id": 53988017, "comment_id": 94813739, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/37170513/calling-function-that-takes-parent-with-struct-embedding-parent-doesnt-work\">Calling function that takes parent with struct embedding parent doesn&#39;t work</a>"}, {"owner": {"reputation": 701, "user_id": 2342806, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6f6fc4a06026c58a43fb5f515d98e8c4?s=128&d=identicon&r=PG", "display_name": "Kostya Vasilyev", "link": "https://stackoverflow.com/users/2342806/kostya-vasilyev"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546264549, "post_id": 53988017, "comment_id": 94813758, "body": "Thank you @Flimzy for your comments.  What I&#39;m trying to do is, to recap:  Base protocol defined by interface.  Implementations are in a bunch of structs / functions on those structs.  And - here is the essence really - there are some &quot;boilerplate&quot; implementation pieces which are called through the interface and that should be able to do some work and call into methods of the enclosing (&quot;real subclass&quot;) object.  And no it&#39;s not quite like #37170513, there are no interfaces there."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1546264580, "post_id": 53988017, "comment_id": 94813766, "body": "&quot;it &quot;does not know&quot; that it&#39;s part of a larger object&quot; -- that&#39;s exactly right. Because it&#39;s embedded, not inherited."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1546264699, "post_id": 53988017, "comment_id": 94813795, "body": "I suggest rewriting your question (or asking a new one) to ask how to re-use common code across multiple implementations, rather than trying to shoe-horn OOP into Go (which is always ugly, and rarely works)."}, {"owner": {"reputation": 701, "user_id": 2342806, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6f6fc4a06026c58a43fb5f515d98e8c4?s=128&d=identicon&r=PG", "display_name": "Kostya Vasilyev", "link": "https://stackoverflow.com/users/2342806/kostya-vasilyev"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546264867, "post_id": 53988017, "comment_id": 94813843, "body": "If you have pointers on &quot;how to re-use common code across multiple implementations&quot; - in the context of a hierarchy of classes - I&#39;m all ears.  PS - &quot;hierarchy of classes&quot; doesn&#39;t exist in Go you will say of course, but what would you call Command_Login /  Command_GetData / Command_SetData all defining a common Command interface, if not a hierarchy of command classes?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1546264949, "post_id": 53988017, "comment_id": 94813870, "body": "&quot;Interface implementations&quot; is the proper term."}, {"owner": {"reputation": 701, "user_id": 2342806, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6f6fc4a06026c58a43fb5f515d98e8c4?s=128&d=identicon&r=PG", "display_name": "Kostya Vasilyev", "link": "https://stackoverflow.com/users/2342806/kostya-vasilyev"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546265136, "post_id": 53988017, "comment_id": 94813928, "body": "Interface implementations is the technique, hierarchy of command object classes is the meaning.  If you have pointers on &quot;how to re-use common code across multiple implementations&quot; - with &quot;fine grained callbacks&quot; possible - I&#39;m all ears.  If you do."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1546265433, "post_id": 53988017, "comment_id": 94814039, "body": "&quot;hierarchy of command object classes&quot; doesn&#39;t exist in Go. So there&#39;s no term for that concept in Go."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1546265629, "post_id": 53988017, "comment_id": 94814090, "body": "See answers <a href=\"https://stackoverflow.com/questions/30622605/can-embedded-struct-method-have-knowledge-of-parent-child/30629132?r=SearchResults#30629132\">one</a>; and <a href=\"https://stackoverflow.com/questions/48079775/type-composition-overriding-interface-types/48079955?r=SearchResults#48079955\">two</a>; and <a href=\"https://stackoverflow.com/questions/44526957/how-can-i-organise-this-go-code-that-redefines-methods-from-an-embedded-type-to/44527419?r=SearchResults#44527419\">three</a>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1546265806, "post_id": 53988017, "comment_id": 94814144, "body": "The problem is you&#39;re coming at your implementation need from an OO perspective in a non-OO language. You need to rethink your design from the ground up - i.e., from your requirements - rather than trying to find a way to do something in Go in some way equivalent to how you would do it in an OO language."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1546266012, "post_id": 53988017, "comment_id": 94814211, "body": "This is also similar to what you want to do: <a href=\"https://stackoverflow.com/questions/30261032/how-to-implement-an-abstract-class-in-go/30261572#30261572\">How to implement an abstract class in Go?</a>"}, {"owner": {"reputation": 701, "user_id": 2342806, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6f6fc4a06026c58a43fb5f515d98e8c4?s=128&d=identicon&r=PG", "display_name": "Kostya Vasilyev", "link": "https://stackoverflow.com/users/2342806/kostya-vasilyev"}, "edited": false, "score": 0, "creation_date": 1546266070, "post_id": 53988017, "comment_id": 94814230, "body": "Well the requirements are as I wrote - the interface defines a method whose implementation is often &quot;boilerplate&quot; and I&#39;d like to implement that common logic in one place and have it turn around and call finer-grained methods (defined on possibly many structs that also implement the interface).  This is a great example here but there is no good answer:  <a href=\"https://stackoverflow.com/a/1727737/2342806\">stackoverflow.com/a/1727737/2342806</a>"}, {"owner": {"reputation": 701, "user_id": 2342806, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6f6fc4a06026c58a43fb5f515d98e8c4?s=128&d=identicon&r=PG", "display_name": "Kostya Vasilyev", "link": "https://stackoverflow.com/users/2342806/kostya-vasilyev"}, "edited": false, "score": 0, "creation_date": 1546266317, "post_id": 53988017, "comment_id": 94814310, "body": "Or putting differently - implementation reuse, specifically &quot;abstract common code&quot; that has some common parts (fixed) and some varying parts (defined differently by various structs / interface implementations)."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1546266776, "post_id": 53988017, "comment_id": 94814474, "body": "Yet another related, possible solution: <a href=\"https://stackoverflow.com/questions/36710259/ensuring-embedded-structs-implement-interface-without-introducing-ambiguity/36711554#36711554\">Ensuring embedded structs implement interface without introducing ambiguity</a>"}], "answers": [{"comments": [{"owner": {"reputation": 701, "user_id": 2342806, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6f6fc4a06026c58a43fb5f515d98e8c4?s=128&d=identicon&r=PG", "display_name": "Kostya Vasilyev", "link": "https://stackoverflow.com/users/2342806/kostya-vasilyev"}, "edited": false, "score": 0, "creation_date": 1546266837, "post_id": 53988547, "comment_id": 94814497, "body": "Yes that&#39;s what I was thinking too:  <a href=\"https://play.golang.org/p/CVZQvMfLoum\" rel=\"nofollow noreferrer\">play.golang.org/p/CVZQvMfLoum</a>  Similar to your solution (onDataCalled = true should be set by onData callback however, not directly by Execute)."}, {"owner": {"reputation": 701, "user_id": 2342806, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6f6fc4a06026c58a43fb5f515d98e8c4?s=128&d=identicon&r=PG", "display_name": "Kostya Vasilyev", "link": "https://stackoverflow.com/users/2342806/kostya-vasilyev"}, "edited": false, "score": 0, "creation_date": 1546267775, "post_id": 53988547, "comment_id": 94814775, "body": "However, this leads to code duplication:  Command_Login # Execute / Command_GetData # Execute / Command_SetData # Execute / Command_xxx # Execute  and so on, each with - again - boilerplate implementation of  command.connection.execute(command)  just to be able to preserve the &quot;lowest&quot; command type."}], "tags": [], "owner": {"reputation": 740, "user_id": 2471524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345a080a421b053d124139a0bce7d62e?s=128&d=identicon&r=PG", "display_name": "blobdon", "link": "https://stackoverflow.com/users/2471524/blobdon"}, "is_accepted": true, "score": 0, "last_activity_date": 1546266538, "creation_date": 1546266538, "answer_id": 53988547, "question_id": 53988017, "link": "https://stackoverflow.com/questions/53988017/actual-type-lost-on-call/53988547#53988547", "title": "Actual type lost on call", "body": "<p>What about delegating implementation by implementing the Execute interface at the shallowest depth you need? </p>\n\n<pre><code>func (self *Command_Login) Execute() {\n    self.Command_Impl.Execute()\n    log.Printf(\"Command Login Execute: %s\", reflect.TypeOf(self))\n    self.onDataCalled = true\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/HvaKHZWIO5W\" rel=\"nofollow noreferrer\">https://play.golang.org/p/HvaKHZWIO5W</a></p>\n"}], "owner": {"reputation": 701, "user_id": 2342806, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6f6fc4a06026c58a43fb5f515d98e8c4?s=128&d=identicon&r=PG", "display_name": "Kostya Vasilyev", "link": "https://stackoverflow.com/users/2342806/kostya-vasilyev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 53988547, "answer_count": 1, "score": 0, "last_activity_date": 1546266538, "creation_date": 1546262695, "last_edit_date": 1546265361, "question_id": 53988017, "link": "https://stackoverflow.com/questions/53988017/actual-type-lost-on-call", "title": "Actual type lost on call", "body": "<p>Another question on polymorphism in Go, references: <a href=\"https://stackoverflow.com/questions/1727250\">Embedding instead of inheritance in Go</a>, <a href=\"https://medium.com/@adrianwit/abstract-class-reinvented-with-go-4a7326525034\" rel=\"nofollow noreferrer\">https://medium.com/@adrianwit/abstract-class-reinvented-with-go-4a7326525034</a></p>\n\n<p>Motivation: there is an interface (with some methods for dealing with \"the outside world\") and a bunch of implementation structs of that interface.</p>\n\n<p>There is a \"standard\" implementation of some of these methods, where common logic should be put in one place with delegation to (new) methods in the structs-implementing-the-interface (\"subclasses\" is not a word).</p>\n\n<p>I've read the medium link above and wrote some test code. Alas, it does not work the way I expect, the actual type of a struct is lost when the call on the interface is indirect.</p>\n\n<p>In C++ this is called \"based class slicing\" and happens when passing a polymorphic class by value. In my Go test code I'm careful to pass by reference, and then Go is not C++ (or Java).</p>\n\n<p>Code: <a href=\"https://play.golang.org/p/lxAmw8v_kiW\" rel=\"nofollow noreferrer\">https://play.golang.org/p/lxAmw8v_kiW</a></p>\n\n<p>Inline:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"reflect\"\n    \"strings\"\n)\n\n// Command - interface\n\ntype Command interface {\n    Execute()\n\n    getCommandString() string\n    onData(data string)\n}\n\n// Command - implementation\n\ntype Command_Impl struct {\n    commandString string\n    conn Connection\n}\n\nfunc newCommand_Impl(conn Connection, data string, args ...string) Command_Impl {\n    var buf strings.Builder\n    buf.WriteString(data)\n    for _, key := range args {\n        buf.WriteString(\" \")\n        buf.WriteString(key)\n    }\n\n    return Command_Impl {\n        conn: conn,\n        commandString: buf.String(),\n    }\n}\n\nfunc (self *Command_Impl) Execute() {\n    log.Printf(\"Command Impl Execute: %s\", reflect.TypeOf(self))\n    self.conn.execute(self)\n}\n\nfunc (self *Command_Impl) getCommandString() string {\n    return self.commandString\n}\n\nfunc (self *Command_Impl) onData(data string) {\n    log.Printf(\"Command Impl onData: %s\", data)\n}\n\n// Command - subclass\n\ntype Command_Login struct {\n    Command_Impl\n\n    onDataCalled bool\n}\n\nfunc newCommand_Login(conn Connection) *Command_Login {\n    return &amp;Command_Login{\n        Command_Impl: newCommand_Impl(conn, \"LOGIN\", \"user@foo.com\", \"pa$$w0rd\"),\n    }\n}\n\nfunc (self *Command_Login) onData(data string) {\n    log.Printf(\"Command Login onData: %s\", data)\n\n    self.onDataCalled = true\n}\n\n// Connection - interface\n\ntype Connection interface {\n    execute(command Command)\n}\n\n// Connection - impelementation\n\ntype Connection_Impl struct {\n}\n\nfunc newConnection_Impl() *Connection_Impl {\n    return &amp;Connection_Impl{}\n}\n\nfunc (self *Connection_Impl) execute(command Command) {\n    log.Printf(\"Connection execute: %s, %s\", command.getCommandString(), reflect.TypeOf(command))\n    command.onData(\"some data\")\n}\n\nfunc main() {\n    conn := newConnection_Impl()\n    command := newCommand_Login(conn)\n\n    // I expect command.Execute to preserve actual type of command all the way through\n    // command.conn.execute(self) and then the callback onData from connection to command\n    // to use the onData in Command_Login\n    //\n    // This does not happen however, the test fails\n    command.Execute()\n\n    // This does preserve actual type of command, but isn't how I'd like to connect\n    // commands and connections...\n    //\n    //conn.execute(command)\n\n    if command.onDataCalled {\n        log.Printf(\"*** GOOD: Command_Login onData ***was*** called\")\n    } else {\n        log.Printf(\"*** ERROR: Command_Login onData ***not*** called\")\n    }\n}\n</code></pre>\n\n<p>There is a Command interface which defines some methods.</p>\n\n<p>There is a Command_Impl struct where I'd like to implement some common code that would further delegate to finer-grained methods in more structs that implement the same interface (\"subclass is not a word\"), similar to:</p>\n\n<p><a href=\"https://stackoverflow.com/a/1727737/2342806\">https://stackoverflow.com/a/1727737/2342806</a></p>\n\n<p>The question:</p>\n\n<p>Calling <code>command.Execute()</code> which in turn calls <code>conn.execute(self)</code> ends up \"slicing\" the <code>Command_Login</code> object and inside <code>Connection.execute</code> it's turned into <code>Command_Impl</code>. As a result, <code>onData</code> interface method defined for <code>Command_Login</code> do not get called.</p>\n\n<p>If I call <code>conn.execute(command)</code> then the right <code>onData</code> does get called, but this is not how I'd like to connect my objects (e.g. <code>Command</code> already has a <code>Connection</code>, but basically what I wrote above about reusing implementation).</p>\n\n<p>In Go terms, I'm trying to come up with a way to delegate <em>implementation</em> by embedding, and have a way to for the delegate to <em>call back into the enclosing type</em> (which fine-tunes the delegate's logic).</p>\n\n<p>Alas, it seems to not be supported by Go (at least I can't find a way) - once you delegate to an embedded struct, your calls stay entirely there in the embedded struct, it \"does not know\" that it's part of a larger object which may be wanting to override some of the embedded struct's methods.</p>\n"}, {"tags": ["pointers", "go", "closures"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 2, "creation_date": 1546264238, "post_id": 53987867, "comment_id": 94813671, "body": "Note: <code>print</code> is a Go built-in function: <a href=\"https://golang.org/pkg/builtin/#print\" rel=\"nofollow noreferrer\">golang.org/pkg/builtin/#print</a> To avoid confusion, please don&#39;t name your function <code>print</code>, It overrides the built-in function.."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 5, "last_activity_date": 1546270339, "last_edit_date": 1546270339, "creation_date": 1546262525, "answer_id": 53987992, "question_id": 53987867, "link": "https://stackoverflow.com/questions/53987867/difference-between-go-printv-and-go-func-printv/53987992#53987992", "title": "Difference between `go print(v)` and `go func() { print(v) }()`?", "body": "<hr>\n\n<h3>wrong1(): <code>go func() { print(v) }()</code></h3>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/doc/faq\" rel=\"nofollow noreferrer\">Go: Frequently Asked Questions (FAQ)</a></p>\n  \n  <p><a href=\"https://golang.org/doc/faq#closures_and_goroutines\" rel=\"nofollow noreferrer\">What happens with closures running as goroutines?</a></p>\n  \n  <p>Some confusion may arise when using closures with concurrency.\n  Consider the following program:</p>\n\n<pre><code>func main() {\n    done := make(chan bool)\n\n    values := []string{\"a\", \"b\", \"c\"}\n    for _, v := range values {\n        go func() {\n            fmt.Println(v)\n            done &lt;- true\n        }()\n    }\n\n    // wait for all goroutines to complete before exiting\n    for _ = range values {\n        &lt;-done\n    }\n}\n</code></pre>\n  \n  <p>One might mistakenly expect to see a, b, c as the output. What you'll\n  probably see instead is c, c, c. This is because each iteration of the\n  loop uses the same instance of the variable v, so each closure shares\n  that single variable. When the closure runs, it prints the value of v\n  at the time fmt.Println is executed, but v may have been modified\n  since the goroutine was launched.</p>\n  \n  <p>To bind the current value of v to each closure as it is launched, one\n  must modify the inner loop to create a new variable each iteration.\n  One way is to pass the variable as an argument to the closure:</p>\n\n<pre><code>for _, v := range values {\n    go func(u string) {\n        fmt.Println(u)\n        done &lt;- true\n    }(v)\n}\n</code></pre>\n  \n  <p>In this example, the value of v is passed as an argument to the\n  anonymous function. That value is then accessible inside the function\n  as the variable u.</p>\n  \n  <p>Even easier is just to create a new variable, using a declaration\n  style that may seem odd but works fine in Go:</p>\n\n<pre><code>for _, v := range values {\n    v := v // create a new 'v'.\n    go func() {\n        fmt.Println(v)\n        done &lt;- true\n    }()\n}\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p>Your <code>wrong1</code> example,</p>\n\n<pre><code>for _, v := range data {\n    go func() {\n        print(v)\n    }()\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/0w86nvVMt1g\" rel=\"nofollow noreferrer\">https://play.golang.org/p/0w86nvVMt1g</a></p>\n\n<p>Output:</p>\n\n<pre><code>three\nthree\nthree\n</code></pre>\n\n<hr>\n\n<p>Your <code>wrong1</code> example, creating a new variable,</p>\n\n<pre><code>for _, v := range data {\n    v := v\n    go func() {\n        print(v)\n    }()\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/z5RCI0ZZU8Z\" rel=\"nofollow noreferrer\">https://play.golang.org/p/z5RCI0ZZU8Z</a></p>\n\n<p>Output:</p>\n\n<pre><code>one\ntwo\nthree\n</code></pre>\n\n<hr>\n\n<p>Your <code>wrong1</code> example, passing the variable as an argument,</p>\n\n<pre><code>for _, v := range data {\n    go func(v *field) {\n        print(v)\n    }(v)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/1JVI7XYSqvv\" rel=\"nofollow noreferrer\">https://play.golang.org/p/1JVI7XYSqvv</a></p>\n\n<p>Output:</p>\n\n<pre><code>one\ntwo\nthree\n</code></pre>\n\n<hr>\n\n<h3>fix1(): <code>go print(v)</code></h3>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Calls\" rel=\"nofollow noreferrer\">Calls</a></p>\n  \n  <p>Given an expression f of function type F,</p>\n\n<pre><code>f(a1, a2, \u2026 an)\n</code></pre>\n  \n  <p>calls f with arguments a1, a2, \u2026 an. Except for one special case,\n  arguments must be single-valued expressions assignable to the\n  parameter types of F and are evaluated before the function is called.</p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Go_statements\" rel=\"nofollow noreferrer\">Go statements</a></p>\n  \n  <p>The function value and parameters are evaluated as usual in the\n  calling goroutine.</p>\n</blockquote>\n\n<hr>\n\n<p>Your <code>fix1</code> example, evaluating the value of <code>v</code> before the function is called,</p>\n\n<pre><code>for _, v := range data {\n    go print(v)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/rN3UNaGi-ge\" rel=\"nofollow noreferrer\">https://play.golang.org/p/rN3UNaGi-ge</a></p>\n\n<p>Output:</p>\n\n<pre><code>one\ntwo\nthree\n</code></pre>\n"}], "owner": {"reputation": 309, "user_id": 8591671, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ae21750ead1b346f8240ee5d5458fd1a?s=128&d=identicon&r=PG&f=1", "display_name": "John Snow", "link": "https://stackoverflow.com/users/8591671/john-snow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 503, "favorite_count": 1, "accepted_answer_id": 53987992, "answer_count": 1, "score": 2, "last_activity_date": 1546270339, "creation_date": 1546261592, "question_id": 53987867, "link": "https://stackoverflow.com/questions/53987867/difference-between-go-printv-and-go-func-printv", "title": "Difference between `go print(v)` and `go func() { print(v) }()`?", "body": "<p>Here is the code:</p>\n\n<pre><code>type field struct {\n    name string\n}\n\nfunc print(p *field) {\n    fmt.Println(p.name)\n}\n\nfunc fix1() {\n    data := []*field{{name: \"one\"}, {name: \"two\"}, {name: \"three\"}}\n    for _, v := range data {\n        go print(v)\n    }\n    time.Sleep(time.Millisecond * 200)\n}\n\nfunc wrong1() {\n    data := []*field{{name: \"one\"}, {name: \"two\"}, {name: \"three\"}}\n    for _, v := range data {\n        go func() {\n            print(v)\n        }()\n    }\n    time.Sleep(time.Millisecond * 200)\n}\n\nfunc main() {\n    wrong1()\n}\n</code></pre>\n\n<p>As far as I understand, all goroutines in function <code>wrong1</code> share the same local variable <code>v</code>. At the moment of a goroutine execution, the value of <code>v</code> may be equal to any value in <code>data</code>, therefore the function prints random data three times.</p>\n\n<p>However, I am failing to understand why function <code>fix1</code> behaves differently (it prints each value in <code>data</code> exactly once).  </p>\n"}, {"tags": ["xml", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1546254504, "post_id": 53986280, "comment_id": 94810671, "body": "<a href=\"https://golang.org/pkg/encoding/xml/#Decoder.Token\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/xml/#Decoder.Token</a>"}], "answers": [{"comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1546258133, "post_id": 53987049, "comment_id": 94811794, "body": "Darn, you are fast ;)"}], "tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": false, "score": 2, "last_activity_date": 1546256428, "creation_date": 1546256428, "answer_id": 53987049, "question_id": 53986280, "link": "https://stackoverflow.com/questions/53986280/performance-problem-with-read-and-parse-large-xml-files/53987049#53987049", "title": "Performance problem with read and parse large XML files", "body": "<p>The <code>encoding/xml</code> package provides a medium-level <a href=\"https://godoc.org/encoding/xml#Decoder\" rel=\"nofollow noreferrer\"><code>xml.Decoder</code></a> type.  That lets you read through an XML input stream one <code>Token</code> at a time, not unlike the streaming Java SAX model of old.  When you find the thing you're looking for, you can jump back into <a href=\"https://godoc.org/encoding/xml#Decoder.Decode\" rel=\"nofollow noreferrer\"><code>decoder.Decode</code></a> to run the normal unmarshaling sequence to get individual objects out.  Just remember that the token stream might contain several things that are \"irrelevant\" (whitespace-only text nodes, processing instructions, comments) and you need to skip over them, while still looking for things that are \"important\" (non-whitespace text nodes, unexpected start/end elements).</p>\n\n<p>As a high-level example, if you're expecting a very large SOAP message with a list of records, you might do a \"streaming\" parse until you see the <code>&lt;soap:Body&gt;</code> start-element, check that its immediate child (<em>e.g.</em>, the next start-element) is the element you expect, and then call <code>decoder.Decode</code> on each of its child elements.  If you see the end of the operation element, you can unwind the element tree (you now expect to see <code>&lt;/soap:Body&gt;&lt;/soap:Envelope&gt;</code>).  Anything else is an error, that you need to catch and process.</p>\n\n<p>The skeleton of an application here might look like</p>\n\n<pre><code>type Foo struct {\n    Name string `xml:\"name\"`\n}\n\ndecoder := xml.NewDecoder(r)\nfor {\n    t, err := decoder.Token()\n    if err != nil {\n        panic(err)\n    }\n    switch x := t.(type) {\n    case xml.StartElement:\n        switch x.Name {\n        case xml.Name{Space: \"\", Local: \"foo\"}:\n            var foo Foo\n            err = decoder.DecodeElement(&amp;foo, &amp;x)\n            if err != nil {\n                panic(err)\n            }\n            fmt.Printf(\"%+v\\n\", foo)\n        default:\n            fmt.Printf(\"Unexpected SE {%s}%s\\n\", x.Name.Space, x.Name.Local)\n        }\n    case xml.EndElement:\n        switch x.Name {\n        default:\n            fmt.Printf(\"Unexpected EE {%s}%s\\n\", x.Name.Space, x.Name.Local)\n        }\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/_ZfG9oCESLJ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_ZfG9oCESLJ</a> has a complete working example (not of the SOAP case but something smaller).</p>\n\n<p>XML parsing in Go, like basically everything else, is a \"pull\" model: you tell the reader what to read and it gets the data from the <code>io.Reader</code> you give it.  If you manually create an <code>xml.Decoder</code> you can pull one token from a time from it, and that will presumably call <code>r.Read</code> in digestible chunks, but you can't push tiny increments of data into the parser as you propose.</p>\n\n<p>I can't specifically speak to the performance of <code>encoding/xml</code>, but a hybrid-streaming approach like this will at least get you better latency to the first output and keep less live data in memory at a time.</p>\n"}, {"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1546260705, "post_id": 53987338, "comment_id": 94812604, "body": "The handling of <code>io.EOF</code> in this model should be a bit more involved: if you hit it while not having had seen the end element of the root node, this is actually an error, not a legitimate &quot;end of input&quot;. Hence I&#39;d say an imaginary &quot;bullet-proof&quot; solution would be your and @david-maze&#39;s answers combined ;-)"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1546263040, "post_id": 53987338, "comment_id": 94813349, "body": "@kostix Feel free to edit accordingly. But the aim was more to create an understanding, less to provide scaffolding, let alone c&amp;p material. Give a man a fish..."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1546265611, "post_id": 53987338, "comment_id": 94814083, "body": "I&#39;m fine with my remark existing as a comment\u2014precisely to not over-complicate your answer."}], "tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": true, "score": 4, "last_activity_date": 1546258091, "creation_date": 1546258091, "answer_id": 53987338, "question_id": 53986280, "link": "https://stackoverflow.com/questions/53986280/performance-problem-with-read-and-parse-large-xml-files/53987338#53987338", "title": "Performance problem with read and parse large XML files", "body": "<p>You can do something even better: You can tokenize your xml files.</p>\n\n<p>Say you have an xml like this</p>\n\n<pre><code>&lt;inventory&gt;\n  &lt;item name=\"ACME Unobtainium\"&gt;\n    &lt;tag&gt;Foo&lt;/tag&gt;\n    &lt;count&gt;1&lt;/count&gt;\n  &lt;/item&gt;\n  &lt;item name=\"Dirt\"&gt;\n    &lt;tag&gt;Bar&lt;/tag&gt;\n    &lt;count&gt;0&lt;/count&gt;\n  &lt;/item&gt;\n&lt;/inventory&gt;\n</code></pre>\n\n<p>you can actually have the following data model</p>\n\n<pre><code>type Inventory struct {\n    Items []Item `xml:\"item\"`\n}\n\ntype Item struct {\n    Name  string   `xml:\"name,attr\"`\n    Tags  []string `xml:\"tag\"`\n    Count int      `xml:\"count\"`\n}\n</code></pre>\n\n<p>Now, all you have to do is to use <a href=\"https://golang.org/pkg/path/filepath/#Walk\" rel=\"nofollow noreferrer\">filepath.Walk</a> and do something like this for each file you want to process:</p>\n\n<pre><code>    decoder := xml.NewDecoder(file)\n\n    for {\n        // Read tokens from the XML document in a stream.\n        t, err := decoder.Token()\n\n        // If we are at the end of the file, we are done\n        if err == io.EOF {\n            log.Println(\"The end\")\n            break\n        } else if err != nil {\n            log.Fatalf(\"Error decoding token: %s\", err)\n        } else if t == nil {\n            break\n        }\n\n        // Here, we inspect the token\n        switch se := t.(type) {\n\n        // We have the start of an element.\n        // However, we have the complete token in t\n        case xml.StartElement:\n            switch se.Name.Local {\n\n            // Found an item, so we process it\n            case \"item\":\n                var item Item\n\n                // We decode the element into our data model...\n                if err = decoder.DecodeElement(&amp;item, &amp;se); err != nil {\n                    log.Fatalf(\"Error decoding item: %s\", err)\n                }\n\n                // And use it for whatever we want to\n                log.Printf(\"'%s' in stock: %d\", item.Name, item.Count)\n\n                if len(item.Tags) &gt; 0 {\n                    log.Println(\"Tags\")\n                    for _, tag := range item.Tags {\n                        log.Printf(\"\\t%s\", tag)\n                    }\n                }\n            }\n        }\n    }\n</code></pre>\n\n<p>Working example with dummy XML: <a href=\"https://play.golang.org/p/MiLej7ih9Jt\" rel=\"nofollow noreferrer\">https://play.golang.org/p/MiLej7ih9Jt</a></p>\n"}], "owner": {"reputation": 85, "user_id": 10632262, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d47867a483efc1660901b329db7b0809?s=128&d=identicon&r=PG&f=1", "display_name": "amir", "link": "https://stackoverflow.com/users/10632262/amir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1030, "favorite_count": 0, "accepted_answer_id": 53987338, "answer_count": 2, "score": 5, "last_activity_date": 1546258322, "creation_date": 1546251702, "last_edit_date": 1546258322, "question_id": 53986280, "link": "https://stackoverflow.com/questions/53986280/performance-problem-with-read-and-parse-large-xml-files", "title": "Performance problem with read and parse large XML files", "body": "<p>I have a directory which contains several large XML files (total size is about 10 GB). Is there any way to iterate through the directory containing the XML files and read 50 byte by 50 byte and parse the XML files with high performance?</p>\n\n<pre><code>func (mdc *Mdc) Loadxml(path string, wg sync.WaitGroup) {\n    defer wg.Done()\n    //var conf configuration\n    file, err := os.Open(path)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer file.Close()\n    scanner := bufio.NewScanner(file)\n    buf := make([]byte, 1024*1024)\n    scanner.Buffer(buf, 50)\n    for scanner.Scan() {\n        _, err := file.Read(buf)\n        if err != nil {\n            log.Fatal(err)\n        }\n    }\n\n    err = xml.Unmarshal(buf, &amp;mdc)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(mdc)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1948, "user_id": 8690313, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-hQ93tpA6Lmk/AAAAAAAAAAI/AAAAAAAAB2I/7F3CoNnnhts/photo.jpg?sz=128", "display_name": "Prajval M", "link": "https://stackoverflow.com/users/8690313/prajval-m"}, "edited": false, "score": 0, "creation_date": 1546245351, "post_id": 53985247, "comment_id": 94807700, "body": "I had issues with CORS and i implemented my own library. But it did not work. Chrome kept blocking mine. I used <a href=\"https://github.com/rs/cors\" rel=\"nofollow noreferrer\">github.com/rs/cors</a> and it it did the job for me. Also I was creating cookies from server side. Unless you have https or same origins server side cookies will not be accepted by chrome. However you can create cookie from the client."}, {"owner": {"reputation": 1948, "user_id": 8690313, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-hQ93tpA6Lmk/AAAAAAAAAAI/AAAAAAAAB2I/7F3CoNnnhts/photo.jpg?sz=128", "display_name": "Prajval M", "link": "https://stackoverflow.com/users/8690313/prajval-m"}, "edited": false, "score": 0, "creation_date": 1546245594, "post_id": 53985247, "comment_id": 94807761, "body": "my code for CORS <a href=\"https://github.com/26prajval98/GetMaid-Server/blob/master/src/GetMaid/handlers/middlewares/enableCORS.go\" rel=\"nofollow noreferrer\">github.com/26prajval98/GetMaid-Server/blob/master/src/GetMai&zwnj;&#8203;d/&hellip;</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546248567, "post_id": 53985247, "comment_id": 94808622, "body": "You seem to be using gorilla/mux, if that&#39;s the case I&#39;d recommend you use their <a href=\"http://www.gorillatoolkit.org/pkg/handlers#CORS\" rel=\"nofollow noreferrer\">CORS</a> middleware with the <a href=\"http://www.gorillatoolkit.org/pkg/handlers#AllowedOrigins\" rel=\"nofollow noreferrer\">AllowedOrigins option</a> passing in <code>&quot;*&quot;</code> and if that doesn&#39;t work, then passing in a list of the allowed origins, eg <code>&quot;http:&#47;&#47;ip:4200&quot;, &quot;http:&#47;&#47;ip:8080&quot;, ...</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546248679, "post_id": 53985247, "comment_id": 94808657, "body": "... and also take a look at this <a href=\"https://stackoverflow.com/questions/40985920/making-golang-gorilla-cors-handler-work\">SO question</a>, you may find the answers useful."}, {"owner": {"reputation": 49, "user_id": 5028759, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hfzefZ0JxAA/AAAAAAAAAAI/AAAAAAAAAQo/_NAfl_3ucKs/photo.jpg?sz=128", "display_name": "Aman Jain", "link": "https://stackoverflow.com/users/5028759/aman-jain"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546253787, "post_id": 53985247, "comment_id": 94810439, "body": "@mkopriva I have already tried that way but still not my problem is not resolved."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546266197, "post_id": 53985247, "comment_id": 94814272, "body": "You&#39;re passing a pointer to an interface <code>w *http.ResponseWriter</code> which is almost never the behavior you want, and is why your code is littered with <code>(*w).MethodCall</code> junk. Consider changing it to accept a parameter <code>w http.ResponseWriter</code> like every other function that takes a <code>ResponseWriter</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1733, "user_id": 10490857, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GA97O.jpg?s=128&g=1", "display_name": "Maxim", "link": "https://stackoverflow.com/users/10490857/maxim"}, "is_accepted": false, "score": 1, "last_activity_date": 1546369902, "creation_date": 1546369902, "answer_id": 53998213, "question_id": 53985247, "link": "https://stackoverflow.com/questions/53985247/how-to-solve-no-access-control-allow-origin-header-is-present-on-the-requeste/53998213#53998213", "title": "How to solve &quot;No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource&quot;", "body": "<p><a href=\"https://developer.mozilla.org/en-US/docs/Glossary/Preflight_request\" rel=\"nofollow noreferrer\">Preflight request</a> should return success and headers. Try to use like following</p>\n\n<pre><code>func setupResponse(w *http.ResponseWriter, req *http.Request) {\n    (*w).Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    (*w).Header().Set(\"Access-Control-Allow-Methods\", \"POST, GET, OPTIONS, PUT, DELETE\")\n    (*w).Header().Set(\"Access-Control-Allow-Headers\", \"Accept, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization\")\n}\n\nfunc indexHandler(w http.ResponseWriter, req *http.Request) {\n    setupResponse(&amp;w, req)\n    if (*req).Method == \"OPTIONS\" {\n        return\n    }\n\n    // process the request...\n}\n</code></pre>\n\n<p>Also you can use <a href=\"https://github.com/rs/cors\" rel=\"nofollow noreferrer\">https://github.com/rs/cors</a></p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n\n    \"github.com/rs/cors\"\n)\n\nfunc main() {\n    mux := http.NewServeMux()\n    mux.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        w.Header().Set(\"Content-Type\", \"application/json\")\n        w.Write([]byte(\"{\\\"hello\\\": \\\"world\\\"}\"))\n    })\n\n    // cors.Default() setup the middleware with default options being\n    // all origins accepted with simple methods (GET, POST). See\n    // documentation below for more options.\n    handler := cors.Default().Handler(mux)\n    http.ListenAndServe(\":8080\", handler)\n}\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 5028759, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hfzefZ0JxAA/AAAAAAAAAAI/AAAAAAAAAQo/_NAfl_3ucKs/photo.jpg?sz=128", "display_name": "Aman Jain", "link": "https://stackoverflow.com/users/5028759/aman-jain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 296, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1546369902, "creation_date": 1546245058, "last_edit_date": 1546245165, "question_id": 53985247, "link": "https://stackoverflow.com/questions/53985247/how-to-solve-no-access-control-allow-origin-header-is-present-on-the-requeste", "title": "How to solve &quot;No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource&quot;", "body": "<p>I'm implementing REST API's in Go and for that I want to allow cross origin requests to be served.</p>\n\n<p>What I am currently doing:</p>\n\n<p>Go server code:</p>\n\n<pre><code>//handleCrossO ... This function will handle CROS\nfunc handleCrossO(w *http.ResponseWriter) {\n(*w).Header().Set(\"Content-Type\", \"application/json\")\n(*w).Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n(*w).Header().Set(\"Access-Control-Allow-Methods\", \"POST, GET, \n     OPTIONS, PUT, DELETE\")\n(*w).Header().Set(\"Access-Control-Allow-Headers\", \"Accept, \n     Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, \n     Authorization, Auth\")\n}\n\n//Response ... This function will create response\nfunc Response(w http.ResponseWriter, message string, statusCode int) \n{\nhandleCrossO(&amp;w)\nw.WriteHeader(statusCode)\nw.Write([]byte(\"{\\\"message\\\":\\\"\" + message + \"\\\"}\"))\n}\n</code></pre>\n\n<p>I am getting the following error on browser console:</p>\n\n<blockquote>\n  <p>Access to XMLHttpRequest at '<a href=\"http://ip:8080/config\" rel=\"nofollow noreferrer\">http://ip:8080/config</a>' from origin '<a href=\"http://ip:4200\" rel=\"nofollow noreferrer\">http://ip:4200</a>' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource.</p>\n</blockquote>\n\n<p>I have also tried the following code to check OPTIONS method:</p>\n\n<pre><code>// CheckAuthorization function check if the User is autrhorized to make calls or not\n// if ssid is mising then give unauthorized error otherwise call next\nfunc CheckAuthorization(next http.HandlerFunc) http.HandlerFunc {\nreturn func(w http.ResponseWriter, r *http.Request) {\n    if r.Method == \"OPTIONS\" {\n        //handle preflight in here\n        response.Response(w, \"success\", 200)\n    }else {\n            store := session.SessionStore()\n        session, _ := store.Get(r, utils.SessionName)\n        ssid := r.Header.Get(\"Auth\")\n        if _, ok := session.Values[ssid]; ok {\n            next.ServeHTTP(w, r)\n        } else {\n        var getTokenRes = GetTokenRes{}\n        sendResponse(w, getTokenRes, 1, \"Invalid \n                     SSID\", 400)\n        }\n    }\n\n}\n}\n</code></pre>\n\n<p>But it is not working.</p>\n\n<p>I have also tried allow OPTIONS method:</p>\n\n<pre><code>router.HandleFunc(\"/network\", authmiddleware.CheckAuthorization(createConfiguration)).Methods(\"POST\", \"OPTIONS\")\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1546247206, "post_id": 53984853, "comment_id": 94808225, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/255414/why-doesnt-cd-work-in-a-shell-script\">Why doesn&#39;t &quot;cd&quot; work in a shell script?</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1546266149, "post_id": 53984853, "comment_id": 94814261, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/52435908/how-to-change-the-shells-current-working-directory-in-go\">How to change the shell&#39;s current working directory in Go?</a>"}, {"owner": {"reputation": 2512, "user_id": 1050389, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/9544928845a390ba53444700e96064b4?s=128&d=identicon&r=PG", "display_name": "aclowkay", "link": "https://stackoverflow.com/users/1050389/aclowkay"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1546414235, "post_id": 53984853, "comment_id": 94842092, "body": "@ThunderCat No, both have different implication. One is to &quot;touch txt&quot; in a particular working directory, the other is to change the caller&#39;s directory.."}], "answers": [{"comments": [{"owner": {"reputation": 2512, "user_id": 1050389, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/9544928845a390ba53444700e96064b4?s=128&d=identicon&r=PG", "display_name": "aclowkay", "link": "https://stackoverflow.com/users/1050389/aclowkay"}, "edited": false, "score": 0, "creation_date": 1546243142, "post_id": 53984896, "comment_id": 94807118, "body": "Thanks, I&#39;m actually trying to implement bookmarking program that cd into &#39;bookmark&#39; name which translates to a directory, any idea on how to workaround this ?"}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "reply_to_user": {"reputation": 2512, "user_id": 1050389, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/9544928845a390ba53444700e96064b4?s=128&d=identicon&r=PG", "display_name": "aclowkay", "link": "https://stackoverflow.com/users/1050389/aclowkay"}, "edited": false, "score": 0, "creation_date": 1546243219, "post_id": 53984896, "comment_id": 94807141, "body": "It is impossible, unless you invoke <i>directly</i> <code>os.Chdir</code> from your program (and that <i>won&#39;t</i> change the working directory of the parent shell, only of the process running your program and all its future child processes).  Again, you need to read <a href=\"http://www.makelinux.net/alp/\" rel=\"nofollow noreferrer\">ALP</a>. There cannot be any &quot;workaround&quot;."}, {"owner": {"reputation": 2512, "user_id": 1050389, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/9544928845a390ba53444700e96064b4?s=128&d=identicon&r=PG", "display_name": "aclowkay", "link": "https://stackoverflow.com/users/1050389/aclowkay"}, "edited": false, "score": 0, "creation_date": 1546246395, "post_id": 53984896, "comment_id": 94807965, "body": "Well, the workaround is create an alias that runs the go program which list the path.. <code>alias gcd=goprogram cd a</code>"}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "reply_to_user": {"reputation": 2512, "user_id": 1050389, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/9544928845a390ba53444700e96064b4?s=128&d=identicon&r=PG", "display_name": "aclowkay", "link": "https://stackoverflow.com/users/1050389/aclowkay"}, "edited": false, "score": 0, "creation_date": 1546246460, "post_id": 53984896, "comment_id": 94807980, "body": "That is not a workaround. You can&#39;t change the fact that every process has its own working directory, and that it is impossible to change the working directory of some other process (such as your parent shell)"}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 2, "creation_date": 1546260288, "post_id": 53984896, "comment_id": 94812466, "body": "can do via an alias that does <code>alias gcd=cd [backtick] goprog foo [backtick]</code> (not sure how to type a literal backtick in comments as that makes a code snippet.  but this will run <code>goprog</code> with <code>foo</code> as an argument, and then <code>cd</code> to whatever that outputs"}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1546274636, "post_id": 53984896, "comment_id": 94816824, "body": "You&#39;ll better use <code>$(goprog foo)</code> instead of backticks"}], "tags": [], "owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "is_accepted": true, "score": 5, "last_activity_date": 1546275568, "last_edit_date": 1546275568, "creation_date": 1546242310, "answer_id": 53984896, "question_id": 53984853, "link": "https://stackoverflow.com/questions/53984853/change-parent-shell-directory-from-go/53984896#53984896", "title": "Change parent shell directory from Go", "body": "<blockquote>\n  <p>How can I write a Go program that will behave as 'cd ' does?</p>\n</blockquote>\n\n<p><strong>This is <em>impossible</em></strong> on POSIX systems (even by using any other programming languages).</p>\n\n<p>Because each <a href=\"https://en.wikipedia.org/wiki/Process_(computing)\" rel=\"nofollow noreferrer\">process</a>, including the parent shell process, has its <em>own</em> current <a href=\"https://en.wikipedia.org/wiki/Working_directory\" rel=\"nofollow noreferrer\">working directory</a>. Hence <code>cd</code> has to be a <a href=\"https://en.wikipedia.org/wiki/Shell_builtin\" rel=\"nofollow noreferrer\">shell builtin</a> (invoking the <a href=\"http://man7.org/linux/man-pages/man2/chdir.2.html\" rel=\"nofollow noreferrer\">chdir(2)</a> system call done by the shell process itself), it cannot be done by some <a href=\"https://en.wikipedia.org/wiki/Executable\" rel=\"nofollow noreferrer\">executable</a>, because the shell forks a new process to run every command (using some executable, i.e. which is not a builtin).</p>\n\n<p>Read some good Unix or Linux programming book, such as the <a href=\"http://www.makelinux.net/alp/\" rel=\"nofollow noreferrer\">ALP</a>, for an explanation. And a good book on <a href=\"https://en.wikipedia.org/wiki/Operating_system\" rel=\"nofollow noreferrer\">Operating systems</a>, such as <a href=\"http://pages.cs.wisc.edu/~remzi/OSTEP/\" rel=\"nofollow noreferrer\"><em>Operating systems: three easy pieces</em></a> would explain you why is it so (and cannot reasonably be otherwise, in POSIX-like or Unix-like systems).</p>\n\n<p>Your code is <a href=\"https://en.wikipedia.org/wiki/Fork_(system_call)\" rel=\"nofollow noreferrer\">forking</a> (with <code>cmd.Run</code>) a new process, and <em>that</em> child process <em>only</em> is changing its working directory. See also <a href=\"http://man7.org/linux/man-pages/man2/fork.2.html\" rel=\"nofollow noreferrer\">fork(2)</a> &amp; <a href=\"http://man7.org/linux/man-pages/man2/execve.2.html\" rel=\"nofollow noreferrer\">execve(2)</a> &amp; <a href=\"http://man7.org/linux/man-pages/man7/path_resolution.7.html\" rel=\"nofollow noreferrer\">path_resolution(7)</a>.</p>\n\n<p>To invoke the  <a href=\"http://man7.org/linux/man-pages/man2/chdir.2.html\" rel=\"nofollow noreferrer\">chdir(2)</a> system call in your Go code, use <a href=\"https://golang.org/pkg/os/#Chdir\" rel=\"nofollow noreferrer\"><code>os.Chdir</code></a>. That would only affect your process (and all future child processes created by <a href=\"http://man7.org/linux/man-pages/man2/fork.2.html\" rel=\"nofollow noreferrer\">fork(2)</a>, which inherit the working directory of their parent process) and of course won't change the working directory of your parent process (which often is your shell). </p>\n\n<p>To get the current working directory (with the <a href=\"http://man7.org/linux/man-pages/man2/getcwd.2.html\" rel=\"nofollow noreferrer\">getcwd(2)</a> system call) of your current process, use <a href=\"https://golang.org/pkg/os/#Getwd\" rel=\"nofollow noreferrer\"><code>os.Getwd</code></a> in your Go code (and see <a href=\"https://stackoverflow.com/a/53913521/841108\">this</a>).</p>\n\n<p>On Linux, you could use <code>/proc/</code> (see <a href=\"http://man7.org/linux/man-pages/man5/proc.5.html\" rel=\"nofollow noreferrer\">proc(5)</a> for details) to query the working directory of other processes. For example, run <code>ls -l /proc/$$/cwd</code> in your shell. In Go code you'll use <a href=\"https://golang.org/pkg/os/#Readlink\" rel=\"nofollow noreferrer\">os.Readlink</a> on a path like <code>/proc/1234/cwd</code> etc. Of course you cannot change the working directory of some other process (the only working directory that you are allowed to change is the one of your own process, using <a href=\"http://man7.org/linux/man-pages/man2/chdir.2.html\" rel=\"nofollow noreferrer\">chdir(2)</a>)</p>\n\n<p>As commented by <a href=\"https://stackoverflow.com/users/121631/david-budworth\">David Budsworth</a>, you could adopt a weird <em>convention</em> that: 1. Your <code>prog</code> program writes a valid (and suitably quoted for the shell) directory path on the standard output, and nothing else. 2. You <em>always</em> use that <code>prog</code> program with a <a href=\"https://www.gnu.org/software/bash/manual/html_node/Command-Substitution.html\" rel=\"nofollow noreferrer\">command substitution</a>, something like <code>cd $(prog args...)</code> (which could become the body of a <a href=\"https://www.gnu.org/software/bash/manual/html_node/Shell-Functions.html\" rel=\"nofollow noreferrer\">shell function</a> or an <a href=\"https://www.gnu.org/software/bash/manual/html_node/Aliases.html\" rel=\"nofollow noreferrer\">alias</a>, etc...), then your shell (not your <code>prog</code>) would change directory as output by your program.</p>\n"}], "owner": {"reputation": 2512, "user_id": 1050389, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/9544928845a390ba53444700e96064b4?s=128&d=identicon&r=PG", "display_name": "aclowkay", "link": "https://stackoverflow.com/users/1050389/aclowkay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 441, "favorite_count": 0, "accepted_answer_id": 53984896, "answer_count": 1, "score": 0, "last_activity_date": 1546275568, "creation_date": 1546242004, "question_id": 53984853, "link": "https://stackoverflow.com/questions/53984853/change-parent-shell-directory-from-go", "title": "Change parent shell directory from Go", "body": "<p>How can I write a Go program that will behave as 'cd ' does?</p>\n\n<p>I tried running a Command, but it didn't work.</p>\n\n<pre><code>func main() {\n    cmd := exec.Command(\"cd\", \"/media/\")\n    err := cmd.Run()\n    log.Printf(\"Command finished with error: %v\", err)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1546266429, "post_id": 53984528, "comment_id": 94814355, "body": "You get correct output when you pass correct input. It&#39;s all covered in the documentation: <a href=\"https://golang.org/pkg/time/#example_Time_Format\" rel=\"nofollow noreferrer\">golang.org/pkg/time/#example_Time_Format</a>"}], "answers": [{"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1546266614, "post_id": 53986714, "comment_id": 94814421, "body": "If you really want to understand this fully, read the package <code>time</code> documentation: <a href=\"https://golang.org/pkg/time/\" rel=\"nofollow noreferrer\">golang.org/pkg/time</a>"}, {"owner": {"reputation": 4833, "user_id": 4934937, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EQFIL.jpg?s=128&g=1", "display_name": "maio290", "link": "https://stackoverflow.com/users/4934937/maio290"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1546266666, "post_id": 53986714, "comment_id": 94814433, "body": "The comments are the same as in the source ;)"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1546266752, "post_id": 53986714, "comment_id": 94814461, "body": "First, read the documentation. Then, if necessary, read the source. By design, unformatted documentation is included in the source."}, {"owner": {"reputation": 4833, "user_id": 4934937, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EQFIL.jpg?s=128&g=1", "display_name": "maio290", "link": "https://stackoverflow.com/users/4934937/maio290"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1546275259, "post_id": 53986714, "comment_id": 94816981, "body": "I&#39;m not going to discuss with you what kind of information someone has to prefer since that&#39;s down to a personal taste. However, I think the source code is always a more detailed documentation than any documentation can ever be. Since the reason for the behaviour can be found in it. But that&#39;s just my point of view and there is no wrong or correct here."}], "tags": [], "owner": {"reputation": 4833, "user_id": 4934937, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EQFIL.jpg?s=128&g=1", "display_name": "maio290", "link": "https://stackoverflow.com/users/4934937/maio290"}, "is_accepted": false, "score": 1, "last_activity_date": 1546255143, "last_edit_date": 1546255143, "creation_date": 1546254344, "answer_id": 53986714, "question_id": 53984528, "link": "https://stackoverflow.com/questions/53984528/output-of-time-formatter-is-incorrect/53986714#53986714", "title": "Output of time formatter is incorrect", "body": "<blockquote>\n  <p>Layouts must use the reference time Mon Jan 2 15:04:05 MST 2006 to\n  show the pattern with which to format/parse a given time/string.</p>\n</blockquote>\n\n<p>Source: <a href=\"https://gobyexample.com/time-formatting-parsing\" rel=\"nofollow noreferrer\">https://gobyexample.com/time-formatting-parsing</a></p>\n\n<p>If you really want to understand this fully, dig into the <a href=\"https://golang.org/src/time/format.go\" rel=\"nofollow noreferrer\">source</a>.</p>\n"}], "owner": {"reputation": 825, "user_id": 570200, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/c1f1eb2f77f0fc96d61e5d2252b179dc?s=128&d=identicon&r=PG", "display_name": "Abhinav", "link": "https://stackoverflow.com/users/570200/abhinav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1546255143, "creation_date": 1546239464, "last_edit_date": 1546254023, "question_id": 53984528, "link": "https://stackoverflow.com/questions/53984528/output-of-time-formatter-is-incorrect", "title": "Output of time formatter is incorrect", "body": "<p>I am trying to format time using time Format function as MMM dd yyyy, HH:mm:ss format but getting incorrect date as output. Below is the code for reference</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    var t time.Time\n    t = time.Now()\n    fmt.Println(t.Format(\"Jan 01 2006, 15:04:05\"))\n    //Output\n    //Dec 12 2018, 16:27:34\n}\n</code></pre>\n\n<p>But if I change the reference format as <code>Jan 02 2006, 15:04:05</code> I get a correct output. So I am not able to find what is the issue between two dates reference and what would be the correct reference date format which works in all use case.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1546244808, "post_id": 53983721, "comment_id": 94807559, "body": "It&#39;s refreshing to see a well-researched question about Go and JSON, that hasn&#39;t been asked a thousand times before! +1"}], "answers": [{"comments": [{"owner": {"reputation": 231, "user_id": 5474145, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LAh3XkmxefQ/AAAAAAAAAAI/AAAAAAAACIk/NxyUpfpNY-g/photo.jpg?sz=128", "display_name": "Aubrey Lavigne", "link": "https://stackoverflow.com/users/5474145/aubrey-lavigne"}, "edited": false, "score": 0, "creation_date": 1546271290, "post_id": 53983840, "comment_id": 94815821, "body": "Good catch!  I was thinking it was an issue with the &quot;encoding/json&quot; library, so I didn&#39;t even think to look at the struct tag definition. The actual API nests this 3-4 levels down, so I&#39;ll need to implement this to confirm everything works, but for now, I&#39;ll be marking this answer accepted."}], "tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": true, "score": 4, "last_activity_date": 1546234108, "last_edit_date": 1546234108, "creation_date": 1546233369, "answer_id": 53983840, "question_id": 53983721, "link": "https://stackoverflow.com/questions/53983721/for-encoding-json-how-can-i-gracefully-handle-an-api-json-call-that-contains-ap/53983840#53983840", "title": "For encoding/json, how can I gracefully handle an API JSON call that contains apostrophes in key names?", "body": "<p>According to the docs for <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\">json.Marshal</a>...</p>\n\n<blockquote>\n  <p>The key name will be used if it's a non-empty string consisting of only Unicode letters, digits, and ASCII punctuation except quotation marks, backslash, and comma.</p>\n</blockquote>\n\n<p>The relevant code appears to be <a href=\"https://github.com/golang/go/blob/480373c7560cd64e4b6c624d84e9d0de6d72c076/src/encoding/json/encode.go#L838\" rel=\"nofollow noreferrer\"><code>isValidTag</code></a>. According to the comment, \"quote chars are reserved\" for future use in the tag syntax.</p>\n\n<pre><code>func isValidTag(s string) bool {\n    if s == \"\" {\n        return false\n    }\n    for _, c := range s {\n        switch {\n        case strings.ContainsRune(\"!#$%&amp;()*+-./:&lt;=&gt;?@[]^_{|}~ \", c):\n            // Backslash and quote chars are reserved, but\n            // otherwise any punctuation chars are allowed\n            // in a tag name.\n        case !unicode.IsLetter(c) &amp;&amp; !unicode.IsDigit(c):\n            return false\n        }\n    }\n    return true\n}\n</code></pre>\n\n<p>You can work around this by using an interface instead of a struct.</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"encoding/json\"\n    \"log\"\n)\nfunc main() {\n    jsonStr := `{\n        \"valid_json\": \"I'm Valid\",\n        \"invalid'json\": \"I should be valid, but I'm not\"\n    }`\n\n    var res interface{}\n    err := json.Unmarshal([]byte(jsonStr), &amp;res)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    m := res.(map[string]interface{})\n    for k, v := range m {\n        switch vv := v.(type) {\n        case string:\n            fmt.Println(k, \"is string\", vv)\n        case float64:\n            fmt.Println(k, \"is float64\", vv)\n        case []interface{}:\n            fmt.Println(k, \"is an array:\")\n            for i, u := range vv {\n                fmt.Println(i, u)\n            }\n        default:\n            fmt.Println(k, \"is of a type I don't know how to handle\")\n        }\n    }\n}\n</code></pre>\n\n<p>See \"Decoding arbitrary data\" in <a href=\"https://blog.golang.org/json-and-go\" rel=\"nofollow noreferrer\">JSON and Go</a> for more.</p>\n"}], "owner": {"reputation": 231, "user_id": 5474145, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LAh3XkmxefQ/AAAAAAAAAAI/AAAAAAAACIk/NxyUpfpNY-g/photo.jpg?sz=128", "display_name": "Aubrey Lavigne", "link": "https://stackoverflow.com/users/5474145/aubrey-lavigne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 53983840, "answer_count": 1, "score": 2, "last_activity_date": 1546308047, "creation_date": 1546231948, "last_edit_date": 1546308047, "question_id": 53983721, "link": "https://stackoverflow.com/questions/53983721/for-encoding-json-how-can-i-gracefully-handle-an-api-json-call-that-contains-ap", "title": "For encoding/json, how can I gracefully handle an API JSON call that contains apostrophes in key names?", "body": "<p>I am writing a simple Go program to consume a simple API. \nSome values are not correctly unmarshaling into my struct, and I have traced the issue to the invalid key names in the returned JSON object.</p>\n\n<p>I can reproduce the issue with this code: </p>\n\n<pre><code>jsonStr := `{\n    \"valid_json\": \"I'm Valid\",\n    \"invalid'json\": \"I should be valid, but I'm not\"\n}`\n\ntype result struct {\n    Valid   string `json:\"valid_json\"`\n    Invalid string `json:\"invalid'json\"`\n}\n\nvar res result\nerr := json.Unmarshal([]byte(jsonStr), &amp;res)\nif err != nil {\n    log.Fatal(err)\n}\n\nfmt.Printf(\"Valid:   %s\\n\", res.Valid)\nfmt.Printf(\"Invalid: %s\\n\", res.Invalid)\n</code></pre>\n\n<p>The resulting output:</p>\n\n<pre><code>Valid:   I'm Valid\nInvalid: \n</code></pre>\n\n<p>My expected output:</p>\n\n<pre><code>Valid:   I'm Valid\nInvalid: I should be valid, but I'm not\n</code></pre>\n\n<p>I've tried options such as escaping the <code>'</code> in the struct tag, but this either results in an error or it is just ignored.  I've also looked into alternate methods but have come back empty-handed.</p>\n\n<p>How would this issue be properly handled on my end? Would it be better to strip the <code>'</code> before unmarshaling? Or is there some other way that I could accept the single quote?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 5831946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72cb1cd9b58d2a86d551dfe54ed80f64?s=128&d=identicon&r=PG&f=1", "display_name": "Madhu Sudhan Reddy", "link": "https://stackoverflow.com/users/5831946/madhu-sudhan-reddy"}, "edited": false, "score": 0, "creation_date": 1546272325, "post_id": 53988593, "comment_id": 94816124, "body": "If the number of blocking calls is increased there is a chance of the application crash due to lack of system resources right? how to avoid such situations."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 57, "user_id": 5831946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72cb1cd9b58d2a86d551dfe54ed80f64?s=128&d=identicon&r=PG&f=1", "display_name": "Madhu Sudhan Reddy", "link": "https://stackoverflow.com/users/5831946/madhu-sudhan-reddy"}, "edited": false, "score": 1, "creation_date": 1546272928, "post_id": 53988593, "comment_id": 94816318, "body": "If you use too much memory there is a chance the app will crash due to being unable to allocate requested memory. To avoid that, use less memory or run on a system with more memory."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1546266884, "creation_date": 1546266884, "answer_id": 53988593, "question_id": 53983656, "link": "https://stackoverflow.com/questions/53983656/why-is-threads-usage-getting-increased-with-network-io-in-golang/53988593#53988593", "title": "Why is threads usage getting increased with Network IO in golang?", "body": "<p>When a thread is blocked on a system IO call, Go may create a new thread to allow other goroutines to continue to run. This has a good explanation: <a href=\"https://povilasv.me/go-scheduler/\" rel=\"nofollow noreferrer\">https://povilasv.me/go-scheduler/</a>:</p>\n\n<blockquote>\n  <p>Interesting things happen when your goroutine makes a blocking syscall. Blocking syscall will be intercepted, if there are Gs to run, runtime will detach the thread from the P and create a new OS thread (if idle thread doesn\u2019t exist) to service that processor.</p>\n</blockquote>\n\n<p>So, instead of having a handful of threads and utilizing 0% of your CPU because all the threads are tied up waiting on a blocking syscall to return, instead it sets those threads aside and spins up new threads so non-blocked goroutines can do their work while it waits for the blocking syscall(s) to return.</p>\n"}], "owner": {"reputation": 57, "user_id": 5831946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72cb1cd9b58d2a86d551dfe54ed80f64?s=128&d=identicon&r=PG&f=1", "display_name": "Madhu Sudhan Reddy", "link": "https://stackoverflow.com/users/5831946/madhu-sudhan-reddy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 343, "favorite_count": 0, "accepted_answer_id": 53988593, "answer_count": 1, "score": 1, "last_activity_date": 1546266884, "creation_date": 1546231197, "question_id": 53983656, "link": "https://stackoverflow.com/questions/53983656/why-is-threads-usage-getting-increased-with-network-io-in-golang", "title": "Why is threads usage getting increased with Network IO in golang?", "body": "<p>I had created a test program to check my understanding of how Golang handles Network IO.\nThe below program creates 1000 goroutines and in each goroutine, it will make a Network IO request.</p>\n\n<p>When I tried to monitor the number of threads getting used, it goes up to 400 Threads.\nI had used the top command to monitor, My understanding is for network io Golang uses netpoll(i.e async io).</p>\n\n<p>Please correct me if my understanding is wrong.  </p>\n\n<p>OS: macos high sierra</p>\n\n<p>Go version: go1.11.2 darwin/amd64</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"log\"\n    \"net/http\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    timeout := time.Duration(5 * time.Second)\n    client := http.Client{\n        Timeout: timeout,\n    }\n    var wg sync.WaitGroup\n\n    start := time.Now()\n    for i := 0; i &lt; 1000; i++ {\n        wg.Add(1)\n        go callAPI(&amp;wg, client)\n    }\n    wg.Wait()\n    log.Println(time.Since(start))\n}\n\nfunc callAPI(wg *sync.WaitGroup, client http.Client) {\n    defer wg.Done()\n    url := `JSON-API-URL-OF-YOUR-CHOICE` // Please enter a valid json api url.\n    request, err := http.NewRequest(\"GET\", url, nil)\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    resp, err := client.Do(request)\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    var result map[string]interface{}\n    json.NewDecoder(resp.Body).Decode(&amp;result)\n    defer resp.Body.Close()\n\n    log.Println(result)\n}\n</code></pre>\n"}, {"tags": ["http", "go", "gorilla"], "comments": [{"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1546237215, "post_id": 53983638, "comment_id": 94805746, "body": "A minimal example works: <a href=\"https://play.golang.org/p/vHgCYZpaELw\" rel=\"nofollow noreferrer\">play.golang.org/p/vHgCYZpaELw</a> but how come it doesn&#39;t work from within the middleware?"}], "answers": [{"comments": [{"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1546252868, "post_id": 53984676, "comment_id": 94810111, "body": "Can&#39;t get it to work <a href=\"https://play.golang.org/p/KkEWiJfvYI6\" rel=\"nofollow noreferrer\">play.golang.org/p/KkEWiJfvYI6</a> ... also I ideally want to avoid context setup on every handler."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1546258239, "post_id": 53984676, "comment_id": 94811829, "body": "What do you mean &quot;avoid context setup on every handler&quot;?"}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1546312853, "post_id": 53984676, "comment_id": 94823416, "body": "I&#39;m assuming I need to do a <code>log, ok := r.Context().Value(loggerKey).(*log.Logger)</code> in every handler? Any ideas why <a href=\"https://play.golang.org/p/KkEWiJfvYI6\" rel=\"nofollow noreferrer\">play.golang.org/p/KkEWiJfvYI6</a> doesn&#39;t work for me?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1546338772, "post_id": 53984676, "comment_id": 94826869, "body": "You need to do that (or an equivalent function) in every logger, yes. But that isn&#39;t context setup. That&#39;s just getting the previously-setup logger from the context."}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1546412577, "post_id": 53984676, "comment_id": 94841588, "body": "Noticed <a href=\"https://dave.cheney.net/2017/01/26/context-is-for-cancelation\" rel=\"nofollow noreferrer\">dave.cheney.net/2017/01/26/context-is-for-cancelation</a> which has confused me further with context. Just thought I&#39;d mention it. Still puzzled what I am doing wrong here: <a href=\"https://play.golang.org/p/KkEWiJfvYI6\" rel=\"nofollow noreferrer\">play.golang.org/p/KkEWiJfvYI6</a>"}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1546483000, "post_id": 53984676, "comment_id": 94868280, "body": "I think I finally understand! <a href=\"http://play.golang.org/p/iPwgckXEscs\" rel=\"nofollow noreferrer\">play.golang.org/p/iPwgckXEscs</a> Thank you again"}, {"owner": {"reputation": 83, "user_id": 10128409, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf10286e6290cb6793262061b3da669b?s=128&d=identicon&r=PG&f=1", "display_name": "gaurav1999", "link": "https://stackoverflow.com/users/10128409/gaurav1999"}, "edited": false, "score": 0, "creation_date": 1595857566, "post_id": 53984676, "comment_id": 111611326, "body": "How to access the logger once the next.ServeHttp() is finished, cause the handler function might add additional fields once it finishes the processing, for example Errors etc could be added later on."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1546240603, "creation_date": 1546240603, "answer_id": 53984676, "question_id": 53983638, "link": "https://stackoverflow.com/questions/53983638/how-can-i-set-up-the-logging-context-from-middleware/53984676#53984676", "title": "How can I set up the logging context from middleware?", "body": "<p>You need your logger to be request-scoped. You're setting it globally for the entire handler, every time a new connection comes in, which means you're asking for data races, and generally undesirable behavior.</p>\n\n<p>For request-scoped context, the <a href=\"https://golang.org/pkg/context/#Context\" rel=\"nofollow noreferrer\"><code>context.Context</code></a> embedded in the request is perfect. You can access it through the <a href=\"https://golang.org/pkg/net/http/#Request.Context\" rel=\"nofollow noreferrer\"><code>Context()</code></a> and <a href=\"https://golang.org/pkg/net/http/#Request.WithContext\" rel=\"nofollow noreferrer\"><code>WithContext</code></a> methods.</p>\n\n<p>Example:</p>\n\n<pre><code>var loggerKey = \"Some unique key\"\n\nfunc (h handler) loggingMiddleware(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        ctx := r.Context()\n        ctx = context.WithValue(ctx, loggerKey, log.WithFields(log.Fields{\"test\": \"PASS\"}))\n        next.ServeHTTP(w, r.WithContext(ctx)\n    })\n}\n</code></pre>\n\n<p>Then to access your logger:</p>\n\n<pre><code>func doSomething(r *http.Request) error {\n    log, ok := r.Context().Value(loggerKey).(*log.Logger) // Or whatever type is appropriate\n    if !ok {\n        return errors.New(\"logger not set on context!\")\n    }\n    // Do stuff...\n}\n</code></pre>\n"}], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1309, "favorite_count": 0, "accepted_answer_id": 53984676, "answer_count": 1, "score": 1, "last_activity_date": 1546240603, "creation_date": 1546231078, "last_edit_date": 1546240319, "question_id": 53983638, "link": "https://stackoverflow.com/questions/53983638/how-can-i-set-up-the-logging-context-from-middleware", "title": "How can I set up the logging context from middleware?", "body": "<p>I want to populate the logging context by items in the request, for example: <code>r.Header.Get(\"X-Request-Id\")</code>. I assumed I could override the Log type in the handler from middleware. Though it doesn't seem to work and I am not sure why!</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"os\"\n\n    \"github.com/apex/log\"\n    \"github.com/gorilla/mux\"\n)\n\n// Assumption: handler is the shared state between the functions\ntype handler struct{ Log *log.Entry }\n\n// New creates a handler for this application to co-ordinate shared resources\nfunc New() (h handler) { return handler{Log: log.WithFields(log.Fields{\"test\": \"FAIL\"})} }\n\nfunc (h handler) index(w http.ResponseWriter, r *http.Request) {\n    h.Log.Info(\"Hello from the logger\")\n    fmt.Fprint(w, \"YO\")\n}\n\nfunc main() {\n    h := New()\n\n    app := mux.NewRouter()\n    app.HandleFunc(\"/\", h.index)\n    app.Use(h.loggingMiddleware)\n\n    if err := http.ListenAndServe(\":\"+os.Getenv(\"PORT\"), app); err != nil {\n        log.WithError(err).Fatal(\"error listening\")\n    }\n\n}\n\nfunc (h handler) loggingMiddleware(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        h.Log = log.WithFields(log.Fields{\"test\": \"PASS\"})\n        next.ServeHTTP(w, r)\n    })\n}\n</code></pre>\n\n<p>Can you see why <code>h.Log = log.WithFields(log.Fields{\"test\": \"PASS\"})</code> doesn't seem to have any effect on <code>h.Log.Info(\"Hello from the logger\")</code> which should be IIUC within the same request?</p>\n"}, {"tags": ["multithreading", "go"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 2, "last_activity_date": 1546267488, "creation_date": 1546267488, "answer_id": 53988669, "question_id": 53983445, "link": "https://stackoverflow.com/questions/53983445/multithreading-socket-connections-in-golang/53988669#53988669", "title": "Multithreading socket connections in Golang", "body": "<p>It is very important to understand a distinction here: this is <em>concurrency</em>, not multithreading, and these are <em>goroutines</em>, not threads. These concepts are not interchangeable. As to your core issue, there are some significant issues with your implementation:</p>\n\n<ul>\n<li>You're starting a goroutine <em>closing over</em> variables that are shared across loop iterations, crucially <code>conn</code>. Every time you accept a connection, you overwrite the <code>conn</code> which is shared by every goroutine. You should instead <em>pass</em> the <code>conn</code> to your goroutine so it has its own local copy, or create a new <code>conn</code> variable in each loop iteration instead of re-using one.</li>\n<li>You're starting a new listener in every loop iteration, which is going to fail because the old listener is still using that port. You don't need a new listener. Just keep calling <code>ln.Accept</code> on the existing listener to continue accepting new connections. Take a look at <em>the introduction of the documentation</em> for the <a href=\"https://golang.org/pkg/net/\" rel=\"nofollow noreferrer\"><code>net</code> package</a>, or check <em>any code that uses listeners in Go</em> for an example.</li>\n<li>You're creating <code>newClient</code> inside the goroutine, then trying to reference it outside the goroutine. This won't even compile, and it's unclear what you are trying to do with this channel in the first place.</li>\n</ul>\n\n<p>Take a look at some existing networking code - in the <code>net</code> or <code>net/http</code> libraries or some popular projects on GitHub - to see good examples of how to write a network application. Do some web searches for blog posts or tutorials or how-to's, there are tons out there. And definitely read the documentation for the packages you're using, it will help you a lot.</p>\n"}], "owner": {"reputation": 414, "user_id": 6331353, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd7f6cc42c46c3a65c58ff594d962597?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/6331353/sam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1428, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1546409049, "creation_date": 1546228573, "last_edit_date": 1546409049, "question_id": 53983445, "link": "https://stackoverflow.com/questions/53983445/multithreading-socket-connections-in-golang", "title": "Multithreading socket connections in Golang", "body": "<p><strong>Background</strong></p>\n\n<p>I'm creating a chatroom server using Golang. Every time a client connects to the server, I'm starting the Client function as a new thread, so that each client gets a thread that is listened to. I was able to create a simple client server connection based on <a href=\"https://systembash.com/a-simple-go-tcp-server-and-tcp-client/\" rel=\"nofollow noreferrer\">this tutorial</a>, but now I am trying to create connections for multiple clients so that they can send messages to chatrooms.</p>\n\n<p><strong>Code explanation</strong></p>\n\n<p>By following <a href=\"https://pragmacoders.com/multithreading-go-tutorial/\" rel=\"nofollow noreferrer\">this tutorial</a>, it looks like I can create a thread by using <code>go func()</code> and wait for a connection to be made by including a channel (<code>&lt;-newClient</code>). I pass a bool value into the channel before calling the user function, because the user function will run forever and I want to make other client connections. Each client connection will have the user function running for it.</p>\n\n<p><strong>Problem</strong></p>\n\n<p>I don't know how to pass the user connection variable to my other functions. I'm placing <code>conn net</code> in the arguments for my functions, but this is just a placeholder because I'm not sure the proper way to do it.</p>\n\n<p>Also, my <code>go func()</code> with the call to user() after the channel implementation is my best attempt at multithreading, but I'm not sure that I'm thinking about it right. </p>\n\n<hr>\n\n<p><strong>Server.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"net\"\n    \"fmt\"\n    \"bufio\"\n    \"strings\" \n    \"container/list\"\n    \"time\"\n)\n\ntype chatRoom struct {\n    name string\n    messages list.List\n    users list.List\n    lastUsed time.Time\n}\n\nvar chatRooms *list.List    //A list of chatrooms where each client can post messages, where messages can be seen by all clients in the chatroom\nvar conn net.Conn\n\nfunc user(conn net) {\n    for {\n        message, _ := bufio.NewReader(conn).ReadString('\\n')    // will listen for message to process ending in newline (\\n)\n        fmt.Print(\"Message Received:\", string(message))     // output message received\n        s := strings.Split(string(message), \":\")\n        if strings.Compare(s[0],\"create\") == 0{    //create a chat room\n            create(conn, s[1])\n        }else if strings.Compare(s[0],\"list\") == 0 {   //List the current chatrooms\n            msg = listRooms(conn)\n        }else if strings.Compare(s[0],\"join\") == 0 {   //Join the user to a chat room\n            join(conn, s[1])\n        }else if strings.Compare(s[0],\"leave\") == 0 {  //Remove the user from a chatroom\n            leave(conn, s[1])\n        }else if strings.Compare(s[0],\"message\") == 0{ //Send a message to a chatroom\n            message(conn, s[1], s[2])\n        }\n    }\n}\n\nfunc main() {\n\n    fmt.Println(\"Launching server...\")\n    this.userList = list.New()\n    this.chatRooms = list.New();\n\n    ln, _ := net.Listen(\"tcp\", \":8081\")             // listen on all interfaces\n    conn, _ := ln.Accept()                      // accept connection on port\n\n    for {                               // run loop forever (or until ctrl-c)\n        go func(){\n            newClient := make(chan bool)                        \n            ln, _ := net.Listen(\"tcp\", \":8081\")         // listen on all interfaces\n            conn, _ := ln.Accept()                  // accept connection on port\n            newClient &lt;- true\n            user(conn)\n        }\n        &lt;-newClient\n    }\n}\n</code></pre>\n"}, {"tags": ["postgresql", "go"], "answers": [{"tags": [], "owner": {"reputation": 4322, "user_id": 162414, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d7fd5d3b2926236f63384ba2ca7f1eb0?s=128&d=identicon&r=PG", "display_name": "Gabriel A. Zorrilla", "link": "https://stackoverflow.com/users/162414/gabriel-a-zorrilla"}, "is_accepted": true, "score": 23, "last_activity_date": 1546226725, "creation_date": 1546226725, "answer_id": 53983297, "question_id": 53983170, "link": "https://stackoverflow.com/questions/53983170/sql-converting-argument-1-type-unsupported-type-int-a-slice-of-in/53983297#53983297", "title": "sql: converting argument $1 type: unsupported type []int, a slice of in", "body": "<p>pq.Array was  the answer:</p>\n\n<pre><code>somevars := []int{1, 2, 3, 4}\nrows, err = db.Query(\"SELECT c1,c2 FROM table\"+tid+\" WHERE c1 = any($1);\", pq.Array(somevars))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4322, "user_id": 162414, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d7fd5d3b2926236f63384ba2ca7f1eb0?s=128&d=identicon&r=PG", "display_name": "Gabriel A. Zorrilla", "link": "https://stackoverflow.com/users/162414/gabriel-a-zorrilla"}, "edited": false, "score": 0, "creation_date": 1546266015, "post_id": 53984095, "comment_id": 94814213, "body": "This is cool! But i need to convert the int slice to a type interface and that&#39;s a few extra lines of code."}, {"owner": {"reputation": 16093, "user_id": 534298, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4ba32c06ed067564a6c6512de5217657?s=128&d=identicon&r=PG", "display_name": "nos", "link": "https://stackoverflow.com/users/534298/nos"}, "reply_to_user": {"reputation": 4322, "user_id": 162414, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d7fd5d3b2926236f63384ba2ca7f1eb0?s=128&d=identicon&r=PG", "display_name": "Gabriel A. Zorrilla", "link": "https://stackoverflow.com/users/162414/gabriel-a-zorrilla"}, "edited": false, "score": 1, "creation_date": 1546276141, "post_id": 53984095, "comment_id": 94817209, "body": "There is no need for type conversion. <code>int</code> type (and all types) satisfies <code>interface{}</code> type. See <a href=\"https://play.golang.com/p/GX722BPxgaI\" rel=\"nofollow noreferrer\">this example</a>."}, {"owner": {"reputation": 4322, "user_id": 162414, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d7fd5d3b2926236f63384ba2ca7f1eb0?s=128&d=identicon&r=PG", "display_name": "Gabriel A. Zorrilla", "link": "https://stackoverflow.com/users/162414/gabriel-a-zorrilla"}, "edited": false, "score": 0, "creation_date": 1546297320, "post_id": 53984095, "comment_id": 94821656, "body": "Oh, so must be a buy or something in the linter. Will check it out, thanks!"}, {"owner": {"reputation": 16093, "user_id": 534298, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4ba32c06ed067564a6c6512de5217657?s=128&d=identicon&r=PG", "display_name": "nos", "link": "https://stackoverflow.com/users/534298/nos"}, "reply_to_user": {"reputation": 4322, "user_id": 162414, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d7fd5d3b2926236f63384ba2ca7f1eb0?s=128&d=identicon&r=PG", "display_name": "Gabriel A. Zorrilla", "link": "https://stackoverflow.com/users/162414/gabriel-a-zorrilla"}, "edited": false, "score": 0, "creation_date": 1546312049, "post_id": 53984095, "comment_id": 94823343, "body": "I just tried and it indeed doesn&#39;t work. I will update the answer."}], "tags": [], "owner": {"reputation": 16093, "user_id": 534298, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4ba32c06ed067564a6c6512de5217657?s=128&d=identicon&r=PG", "display_name": "nos", "link": "https://stackoverflow.com/users/534298/nos"}, "is_accepted": false, "score": 13, "last_activity_date": 1554837262, "last_edit_date": 1554837262, "creation_date": 1546236027, "answer_id": 53984095, "question_id": 53983170, "link": "https://stackoverflow.com/questions/53983170/sql-converting-argument-1-type-unsupported-type-int-a-slice-of-in/53984095#53984095", "title": "sql: converting argument $1 type: unsupported type []int, a slice of in", "body": "<p>An alternative solution is</p>\n\n<pre><code>somevars := []interface{}{1, 2, 3, 4}\nrows, err = db.Query(\n    \"SELECT c1,c2 FROM table\"+tid+\" WHERE c1 IN($1,$2,$3,$4);\",\n    somevars...)\n</code></pre>\n\n<p>Here the <code>...</code> expands a slice to multiple arguments, similar to the python <code>*args</code>. It's documented <a href=\"https://golang.org/ref/spec#Passing_arguments_to_..._parameters\" rel=\"noreferrer\">in the language spec</a>.</p>\n\n<p>The <code>db.Query</code> API supports this so called variadic parameter. </p>\n\n<pre><code>func (db *DB) Query(query string, args ...interface{}) (*Rows, error)\n</code></pre>\n\n<p>Here <code>interface{}</code> is known as the empty interface, and it can hold values of any type. See the <a href=\"https://tour.golang.org/methods/14\" rel=\"noreferrer\">Go tour example here</a>. So one can use it like</p>\n\n<p><code>db.Query(stmt, var1, var2)</code></p>\n\n<p>where <code>var1</code> <code>var2</code> could be of different types.</p>\n\n<p>In your case, you can also pass the slice elements explicitly</p>\n\n<pre><code>db.Query(stmt,\n         somevars[0], somevars[1], somevars[2], somevars[3])\n</code></pre>\n\n<p>But it is rather verbose and requires extra work when the slice length changes.</p>\n\n<p>Note that if instead of the <code>interface</code> slice <code>somevars</code>, we use <code>intvars := []int {1, 2, 3, 4}</code> and expand <code>intvars</code> in <code>db.Query()</code>, the compiler will complain on <code>intvars...</code></p>\n\n<blockquote>\n  <p>cannot use []int literal (type []int) as type []interface {} in assignment</p>\n</blockquote>\n\n<p>Type conversion <code>intvars.([]interface{})</code> doesn't work either. This is documented in the <a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"noreferrer\">language spec FAQ</a>. And there is also a <a href=\"https://github.com/golang/go/wiki/InterfaceSlice\" rel=\"noreferrer\">dedicated wiki page for it</a></p>\n\n<blockquote>\n  <p>It is disallowed by the language specification because the two types do not have the same representation in memory.</p>\n</blockquote>\n\n<p>The intuitive picture of golang <code>interface</code> is an object with two fields, one field stores a type, and the other stores a pointer. </p>\n"}, {"tags": [], "owner": {"reputation": 103, "user_id": 5636271, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-p5ReDYI6JMM/AAAAAAAAAAI/AAAAAAAAAHw/KlKzwevceMo/photo.jpg?sz=128", "display_name": "Scott Jackson", "link": "https://stackoverflow.com/users/5636271/scott-jackson"}, "is_accepted": false, "score": 0, "last_activity_date": 1606323640, "creation_date": 1606323640, "answer_id": 65009416, "question_id": 53983170, "link": "https://stackoverflow.com/questions/53983170/sql-converting-argument-1-type-unsupported-type-int-a-slice-of-in/65009416#65009416", "title": "sql: converting argument $1 type: unsupported type []int, a slice of in", "body": "<p>A more generalizable solution is to use the <code>sqlx</code> library: <a href=\"https://jmoiron.github.io/sqlx/#inQueries\" rel=\"nofollow noreferrer\">https://jmoiron.github.io/sqlx/#inQueries</a></p>\n<pre class=\"lang-golang prettyprint-override\"><code>// assume db is an initialized database handle\nsomevars := []int{1,2,3,4}\nquery, args, err := sqlx.In(&quot;SELECT * FROM table WHERE id IN (?)&quot;, somevars)\nif err != nil {\n  return err\n}\nquery = db.Rebind(query)\nresult := db.Select(query, args...)\n</code></pre>\n<p>This solution will work with multiple database drivers and slices of unknown length.</p>\n"}], "owner": {"reputation": 4322, "user_id": 162414, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d7fd5d3b2926236f63384ba2ca7f1eb0?s=128&d=identicon&r=PG", "display_name": "Gabriel A. Zorrilla", "link": "https://stackoverflow.com/users/162414/gabriel-a-zorrilla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 20530, "favorite_count": 0, "accepted_answer_id": 53983297, "answer_count": 3, "score": 14, "last_activity_date": 1606323640, "creation_date": 1546225233, "last_edit_date": 1546240244, "question_id": 53983170, "link": "https://stackoverflow.com/questions/53983170/sql-converting-argument-1-type-unsupported-type-int-a-slice-of-in", "title": "sql: converting argument $1 type: unsupported type []int, a slice of in", "body": "<p>Have this:</p>\n\n<pre><code>somevars := []int{1, 2, 3, 4}\nrows, err = db.Query(\"SELECT c1,c2 FROM table\"+tid+\" WHERE c1 IN($1,$2,$3,$4);\", somevars)\n</code></pre>\n\n<p>Got this:</p>\n\n<p>sql: converting argument $1 type: unsupported type []int, a slice of int</p>\n\n<p>Any way to make a slice of arguments work with lib/pq?</p>\n"}, {"tags": ["json", "http", "dictionary", "go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 815, "user_id": 2355760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5f57e5208bf28e71f4bbe5ffe8908db?s=128&d=identicon&r=PG", "display_name": "SupaHam", "link": "https://stackoverflow.com/users/2355760/supaham"}, "edited": false, "score": 0, "creation_date": 1546218742, "post_id": 53982738, "comment_id": 94802926, "body": "Hey, thanks for your answer. I have tried this and it does not work. Worth noting my UUID field is defined ``` UUID uuid.UUID <code>json:&quot;uuid,-&quot;</code> ```"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 815, "user_id": 2355760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5f57e5208bf28e71f4bbe5ffe8908db?s=128&d=identicon&r=PG", "display_name": "SupaHam", "link": "https://stackoverflow.com/users/2355760/supaham"}, "edited": false, "score": 2, "creation_date": 1546218863, "post_id": 53982738, "comment_id": 94802942, "body": "@SupaHam You must use <code>json:&quot;-&quot;</code>, providing a name too will not work."}, {"owner": {"reputation": 815, "user_id": 2355760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5f57e5208bf28e71f4bbe5ffe8908db?s=128&d=identicon&r=PG", "display_name": "SupaHam", "link": "https://stackoverflow.com/users/2355760/supaham"}, "edited": false, "score": 0, "creation_date": 1546218982, "post_id": 53982738, "comment_id": 94802959, "body": "Really? Surely that&#39;s a design flaw?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 815, "user_id": 2355760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5f57e5208bf28e71f4bbe5ffe8908db?s=128&d=identicon&r=PG", "display_name": "SupaHam", "link": "https://stackoverflow.com/users/2355760/supaham"}, "edited": false, "score": 1, "creation_date": 1546219078, "post_id": 53982738, "comment_id": 94802970, "body": "@SupaHam Why? <code>-</code> is not an &quot;option&quot;, it&#39;s a special name value."}, {"owner": {"reputation": 815, "user_id": 2355760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5f57e5208bf28e71f4bbe5ffe8908db?s=128&d=identicon&r=PG", "display_name": "SupaHam", "link": "https://stackoverflow.com/users/2355760/supaham"}, "edited": false, "score": 0, "creation_date": 1546219250, "post_id": 53982738, "comment_id": 94802998, "body": "Oh of course. My bad. Well I will need it for marshalling actually. I&#39;ll have to temporarily store the old uuid. Although, it might be better finding a more feature-ful library instead."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 815, "user_id": 2355760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5f57e5208bf28e71f4bbe5ffe8908db?s=128&d=identicon&r=PG", "display_name": "SupaHam", "link": "https://stackoverflow.com/users/2355760/supaham"}, "edited": false, "score": 0, "creation_date": 1546219320, "post_id": 53982738, "comment_id": 94803013, "body": "@SupaHam All it takes is to wrap that few lines in a <code>decodeUser()</code> utility function, and you can reuse it..."}, {"owner": {"reputation": 815, "user_id": 2355760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5f57e5208bf28e71f4bbe5ffe8908db?s=128&d=identicon&r=PG", "display_name": "SupaHam", "link": "https://stackoverflow.com/users/2355760/supaham"}, "edited": false, "score": 0, "creation_date": 1546219449, "post_id": 53982738, "comment_id": 94803035, "body": "Correct. However, generally wanting to process JSON in other forms will only prove difficult. One can tell this library wasn&#39;t designed for this level of processing as everything only revolves around a <code>[]byte</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 815, "user_id": 2355760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5f57e5208bf28e71f4bbe5ffe8908db?s=128&d=identicon&r=PG", "display_name": "SupaHam", "link": "https://stackoverflow.com/users/2355760/supaham"}, "edited": false, "score": 1, "creation_date": 1546219642, "post_id": 53982738, "comment_id": 94803065, "body": "@SupaHam There is a 3rd party lib (see edited answer) for exactly what you asked for, but using that would be slower and unnecessary in the case you mentioned."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546267656, "post_id": 53982738, "comment_id": 94814746, "body": "&quot;as everything only revolves around a <code>[]byte</code>&quot; that&#39;s what JSON is. The only other thing you could call it is a <code>string</code>, but under the hood, a <code>string</code> is also a <code>[]byte</code>. So it&#39;s not clear how this is a shortcoming or flaw of <code>encoding&#47;json</code>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1546219578, "last_edit_date": 1546219578, "creation_date": 1546218684, "answer_id": 53982738, "question_id": 53982725, "link": "https://stackoverflow.com/questions/53982725/json-apply-mapping-of-a-map-to-object/53982738#53982738", "title": "JSON Apply mapping of a map to object", "body": "<p>You may mark the UUID field of your object (struct) with <code>json:\"-\"</code> so it will be excluded from the marshaling / unmarshaling process, e.g.:</p>\n\n<pre><code>type User struct {\n    Name string `json:\"name\"`\n    UUID string `json:\"-\"`\n}\n</code></pre>\n\n<p>If you do need to marshal / unmarshal the UUID field too at other places of your app, then the simplest solution would be to store the UUID field before unmarshaling, then restore it after the marshaling, e.g.:</p>\n\n<pre><code>u := getUser() // acquire your object\n\nuuid := u.UUID // save field\n\nerr := json.Unmarshal(data, &amp;u)\n// handle error\n\nu.UUID = uuid // restore field\n</code></pre>\n\n<p>Wrap it in a utility function, so you can reuse it:</p>\n\n<pre><code>func decodeUser(u *User, data []byte) error {\n    uuid := u.UUID // save field\n    if err := json.Unmarshal(data, &amp;u); err != nil {\n        return err\n    }\n    u.UUID = uuid // restore field\n    return nil\n}\n</code></pre>\n\n<p>Note that there are 3rd party libs for mapping maps to struts values (e.g. <a href=\"https://github.com/mitchellh/mapstructure\" rel=\"nofollow noreferrer\"><code>github.com/mitchellh/mapstructure</code></a>), but unmarshaling into a map first, then mapping that into a struct is significantly slower than to unmarshaling into the struct value and storing / restoring a single field.</p>\n"}], "owner": {"reputation": 815, "user_id": 2355760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5f57e5208bf28e71f4bbe5ffe8908db?s=128&d=identicon&r=PG", "display_name": "SupaHam", "link": "https://stackoverflow.com/users/2355760/supaham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 399, "favorite_count": 0, "accepted_answer_id": 53982738, "answer_count": 1, "score": 2, "last_activity_date": 1546283890, "creation_date": 1546218483, "last_edit_date": 1546283890, "question_id": 53982725, "link": "https://stackoverflow.com/questions/53982725/json-apply-mapping-of-a-map-to-object", "title": "JSON Apply mapping of a map to object", "body": "<p>I'm writing a REST endpoint for an Update operation on a model. The mapping is simply a forwarding of the request's body as <code>[]byte</code> to <code>json.Unmarshal</code>. However, I'm now trying to filter out the <code>uuid</code> property from being changed on said model. So instead of unmarshaling to the model I am now doing it to a <code>map[string]interface{}</code> and then running <code>delete(m, \"uuid\")</code>.</p>\n\n<p>At this point I have a map of the data, but how can I feed it into the <code>json</code> to map it as it usually would when calling <code>Unmarshal</code> or <code>Decode</code>? Is there a better option than marshaling for a <code>[]byte</code> result and then unmarshal onto the model?</p>\n"}, {"tags": ["for-loop", "go"], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 6, "last_activity_date": 1546204381, "creation_date": 1546204381, "answer_id": 53981478, "question_id": 53981419, "link": "https://stackoverflow.com/questions/53981419/for-loop-not-incrementing-if-i-multiply-the-increment-in-golang/53981478#53981478", "title": "For loop not incrementing if I multiply the increment in golang", "body": "<p>Your loop starts at <code>i := 0</code>, so you are just continuously doing <code>i := 0 * 2</code>, so you get an infinite loop (as you should), since <code>0 &lt; 10</code> and <code>i</code> never actually gets bigger. </p>\n"}], "owner": {"reputation": 3, "user_id": 10361148, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-fVE-ev6VJF4/AAAAAAAAAAI/AAAAAAAAHLs/wps2HuouQ48/photo.jpg?sz=128", "display_name": "pavan", "link": "https://stackoverflow.com/users/10361148/pavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1546204381, "creation_date": 1546203876, "question_id": 53981419, "link": "https://stackoverflow.com/questions/53981419/for-loop-not-incrementing-if-i-multiply-the-increment-in-golang", "title": "For loop not incrementing if I multiply the increment in golang", "body": "<p>I was assuming I can use any operator to increment the incrementing variable in for loop. Looks like it's not the case. Following code loops for ever.</p>\n\n<pre><code>import (\n    \"fmt\"\n)\n\nfunc main() {\n    for i:=0; i&lt;10; i=i*2{\n    fmt.Println(i)\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/RdaSj1WyQnG\" rel=\"nofollow noreferrer\">go playground</a></p>\n\n<p>Following code works fine.</p>\n\n<pre><code>import (\n    \"fmt\"\n)\n\nfunc main() {\n    for i:=0; i&lt;10; i=i+2{\n    fmt.Println(i)\n    }\n}\n</code></pre>\n"}, {"tags": ["html", "http", "go", "file-upload"], "answers": [{"tags": [], "owner": {"reputation": 2569, "user_id": 112601, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/ba186cd5a43276e683babe9c44e0e604?s=128&d=identicon&r=PG", "display_name": "aviv", "link": "https://stackoverflow.com/users/112601/aviv"}, "is_accepted": true, "score": 1, "last_activity_date": 1546201837, "creation_date": 1546201837, "answer_id": 53981192, "question_id": 53981191, "link": "https://stackoverflow.com/questions/53981191/parsemultipartform-always-fails-although-the-form-is-valid/53981192#53981192", "title": "ParseMultipartForm always fails although the form is valid", "body": "<p>As writing the question I have already found the problem. It is in the handle function. I read all the stream data before calling the upload function. Here is the revised code of the handler, and now everything works:</p>\n\n<pre><code>func uploadLogoHandler(w http.ResponseWriter, r *http.Request) {\n    writeToLog(\"uploadLogoHandler:\" + r.URL.Path, \"\")\n    upload(w, r)\n}\n</code></pre>\n\n<p>If I understand correctly so the error:  \"multipart: NextPart: EOF\" means that the form is empty - and it was empty because I emptied the buffer stream before.</p>\n\n<p>Hope it will help others.\nBest.</p>\n"}], "owner": {"reputation": 2569, "user_id": 112601, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/ba186cd5a43276e683babe9c44e0e604?s=128&d=identicon&r=PG", "display_name": "aviv", "link": "https://stackoverflow.com/users/112601/aviv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1340, "favorite_count": 0, "accepted_answer_id": 53981192, "answer_count": 1, "score": 0, "last_activity_date": 1546202039, "creation_date": 1546201837, "last_edit_date": 1546202039, "question_id": 53981191, "link": "https://stackoverflow.com/questions/53981191/parsemultipartform-always-fails-although-the-form-is-valid", "title": "ParseMultipartForm always fails although the form is valid", "body": "<p>I am trying to handle uploaded files in go http server. But calling <em>ParseMultipartForm</em> always fails with strange error: \"<em>multipart: NextPart: EOF</em>\" although the form is valid. Debugging it, I can see that I get the full encoded data, and size and parameters. Yet it fails parsing.</p>\n\n<p>Here is the html form:</p>\n\n<pre><code>&lt;html&gt;\n&lt;head&gt;\n     &lt;title&gt;Upload file&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;form enctype=\"multipart/form-data\" action=\"http://localhost:8080/uploadLogo/\" method=\"post\"&gt;\n    &lt;input type=\"file\" name=\"uploadfile\" /&gt;\n    &lt;input type=\"hidden\" name=\"token\" value=\"{{.}}\" /&gt;\n    &lt;input type=\"submit\" value=\"upload\" /&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>And here is the relevant upload function:</p>\n\n<pre><code>// upload logic\nfunc upload(w http.ResponseWriter, r *http.Request) {\n    fmt.Println(\"method:\", r.Method)\n    if r.Method == \"GET\" {\n        // crutime := time.Now().Unix()\n        // h := md5.New()\n        // io.WriteString(h, strconv.FormatInt(crutime, 10))\n        // token := fmt.Sprintf(\"%x\", h.Sum(nil))\n\n        // t, _ := template.ParseFiles(\"upload.gtpl\")\n        // t.Execute(w, token)\n    } else {\n        err := r.ParseMultipartForm(5 * 1024 * 1024 * 1024)\n        if err != nil {\n            fmt.Println(\"Error ParseMultipartForm: \", err) // here it fails !!! with: \"multipart: NextPart: EOF\"\n            return\n        }\n\n        file, handler, err := r.FormFile(\"uploadfile\")\n        if err != nil {\n            fmt.Println(\"Error parsing file\", err)\n            return\n        }\n        defer file.Close()\n        fmt.Fprintf(w, \"%v\", handler.Header)\n        fmt.Println(\"filename:\", handler.Filename)\n        f, err := os.OpenFile(logosDir + handler.Filename, os.O_WRONLY|os.O_CREATE, 0666)\n        if err != nil {\n            fmt.Println(err)\n            return\n        }\n        defer f.Close()\n        io.Copy(f, file)\n   }\n}\n</code></pre>\n\n<p>Couldn't understand why that happens.</p>\n\n<p>Here is how I start my server:</p>\n\n<pre><code>func uploadLogoHandler(w http.ResponseWriter, r *http.Request) {\n    //fmt.Fprintf(w, \"viewLogoHandler, Path: %s!\", r.URL.Path[1:])\n    bodyBytes, _ := ioutil.ReadAll(r.Body)\n    bodyString := string(bodyBytes)\n    writeToLog(\"uploadLogoHandler:\" + r.URL.Path, \"bodyString length:\" + strconv.Itoa(len(bodyString)))\n    upload(w, r)\n}\n\n///////////////////////////////////////////////////////////////////////////////////////\n// main\n\nfunc main() {\n    if(len(os.Args) &lt; 2) {\n        fmt.Println(\"Usage: receiver [port number]\")\n        os.Exit(1)\n    }\n\n    port := os.Args[1]\n\n    s := &amp;http.Server{\n        Addr:           \":\" + port,\n        ReadTimeout:    10 * time.Second,\n        WriteTimeout:   10 * time.Second,\n    }   \n    http.HandleFunc(\"/uploadLogo/\", uploadLogoHandler)\n    http.HandleFunc(\"/\", handler)\n    log.Fatal(s.ListenAndServe())\n}\n</code></pre>\n"}, {"tags": ["docker", "go", "dockerfile", "revel"], "comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1546196401, "post_id": 53980344, "comment_id": 94798233, "body": "What happens when you try to visit the URL?"}, {"owner": {"reputation": 138, "user_id": 5298625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21dd8908fa5dcc5b0b8b4d3d5306b9a2?s=128&d=identicon&r=PG&f=1", "display_name": "Tom Vaughan", "link": "https://stackoverflow.com/users/5298625/tom-vaughan"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1546201162, "post_id": 53980344, "comment_id": 94799462, "body": "When I go to localhost:9000 chrome shows: localhost didn\u2019t send any data. ERR_EMPTY_RESPONSE"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1546201742, "post_id": 53980344, "comment_id": 94799590, "body": "What&#39;s in the container logs, then?"}, {"owner": {"reputation": 138, "user_id": 5298625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21dd8908fa5dcc5b0b8b4d3d5306b9a2?s=128&d=identicon&r=PG&f=1", "display_name": "Tom Vaughan", "link": "https://stackoverflow.com/users/5298625/tom-vaughan"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1546231359, "post_id": 53980344, "comment_id": 94804687, "body": "it is the same as what is showing in the console, what was in the last part of my post above."}], "answers": [{"comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1546196374, "post_id": 53980378, "comment_id": 94798228, "body": "Where do you see port 8000? I can&#39;t find that in the question anywhere."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546199573, "post_id": 53980378, "comment_id": 94799083, "body": "I&#39;m pretty sure 8000 was a typo. The point being made is 0.0.0.0 instead of localhost, not the port."}, {"owner": {"reputation": 138, "user_id": 5298625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21dd8908fa5dcc5b0b8b4d3d5306b9a2?s=128&d=identicon&r=PG&f=1", "display_name": "Tom Vaughan", "link": "https://stackoverflow.com/users/5298625/tom-vaughan"}, "edited": false, "score": 0, "creation_date": 1546231399, "post_id": 53980378, "comment_id": 94804693, "body": "I am using windows docker CE so the network interface is bound to my local machine.  As i said before, I tested using a simple hello world go app and same dockerfile.  Everything worked fine using localhost:9000"}, {"owner": {"reputation": 138, "user_id": 5298625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21dd8908fa5dcc5b0b8b4d3d5306b9a2?s=128&d=identicon&r=PG&f=1", "display_name": "Tom Vaughan", "link": "https://stackoverflow.com/users/5298625/tom-vaughan"}, "edited": false, "score": 0, "creation_date": 1546277842, "post_id": 53980378, "comment_id": 94817612, "body": "I was able to get it to work by setting the http.addr to 0.0.0.0 in the Revel app.conf file."}], "tags": [], "owner": {"reputation": 279, "user_id": 4965457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e688c6ad1efdac07f307d0767a5d9ab?s=128&d=identicon&r=PG", "display_name": "alexandrevilain", "link": "https://stackoverflow.com/users/4965457/alexandrevilain"}, "is_accepted": true, "score": 4, "last_activity_date": 1546199518, "last_edit_date": 1546199518, "creation_date": 1546195227, "answer_id": 53980378, "question_id": 53980344, "link": "https://stackoverflow.com/questions/53980344/revel-and-docker-container/53980378#53980378", "title": "Revel and Docker container", "body": "<p>You're listening on <code>localhost:9000</code>, so 127.0.0.1 points to your container and not your local machine.</p>\n\n<p>You have two solutions to make it work:</p>\n\n<ul>\n<li>Listen on <code>0.0.0.0:9000</code></li>\n<li>Use --network=\"host\" in your docker run command: 127.0.0.1 in your docker container will point to your docker host.</li>\n</ul>\n"}], "owner": {"reputation": 138, "user_id": 5298625, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21dd8908fa5dcc5b0b8b4d3d5306b9a2?s=128&d=identicon&r=PG&f=1", "display_name": "Tom Vaughan", "link": "https://stackoverflow.com/users/5298625/tom-vaughan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 920, "favorite_count": 0, "accepted_answer_id": 53980378, "answer_count": 1, "score": 2, "last_activity_date": 1601294854, "creation_date": 1546194842, "question_id": 53980344, "link": "https://stackoverflow.com/questions/53980344/revel-and-docker-container", "title": "Revel and Docker container", "body": "<p>I am attempting to create a docker container that contains the revel skeleton app.  Everything seems to build OK and the container is created but when I go to localhost:9000 in my browser nothing comes up.<br>\nTo make sure my environment is working properly I created a simple hello world go app and created a docker container for it.  It worked OK using the same port 9000.  This makes me think that there is something not configured properly in my dockerfile.  </p>\n\n<p>Dockerfile:</p>\n\n<pre><code>#Compile stage\nFROM golang:1.11.4-alpine3.8 AS build-env\nENV CGO_ENABLED 0\nRUN apk add --no-cache git\nADD . /go/src/revelapp\n\n# Install revel framework\nRUN go get -u github.com/revel/revel\nRUN go get -u github.com/revel/cmd/revel\n#build revel app\nRUN revel build revelapp app dev\n\n# Final stage\nFROM alpine:3.8\nEXPOSE 9000\nWORKDIR /\nCOPY --from=build-env /go/app /\nENTRYPOINT /run.sh\n</code></pre>\n\n<p>Docker command used:</p>\n\n<pre><code>docker build -t revelapp . &amp;&amp; docker run -p 9000:9000 --name revelapp revelapp \n</code></pre>\n\n<p>After command is executed and container is created the console shows:</p>\n\n<pre><code>INFO  17:25:01    app     run.go:32: Running revel server                      \nINFO  17:25:01    app   plugin.go:9: Go to /@tests to run the tests.           \nRevel engine is listening on.. localhost:9000\n</code></pre>\n\n<p>When I go to localhost:9000 I would expect to see the text It Works!</p>\n"}, {"tags": ["mongodb", "go", "azure-cosmosdb", "mongo-go"], "comments": [{"owner": {"reputation": 51, "user_id": 10682766, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-z8vKBtcG5XY/AAAAAAAAAAI/AAAAAAAAAAs/Eiqag7vmyLU/photo.jpg?sz=128", "display_name": "faraonc", "link": "https://stackoverflow.com/users/10682766/faraonc"}, "edited": false, "score": 0, "creation_date": 1546185423, "post_id": 53979086, "comment_id": 94795538, "body": "It is very random when it happens. Sometimes it actually does the job. I do not see any race condition because I lock the document for writing.  This was working fine a month ago using <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/mongo\" rel=\"nofollow noreferrer\">godoc.org/github.com/mongodb/mongo-go-driver/mongo</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546185681, "post_id": 53979086, "comment_id": 94795590, "body": "Is there a replication delay happening on your db server?"}, {"owner": {"reputation": 51, "user_id": 10682766, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-z8vKBtcG5XY/AAAAAAAAAAI/AAAAAAAAAAs/Eiqag7vmyLU/photo.jpg?sz=128", "display_name": "faraonc", "link": "https://stackoverflow.com/users/10682766/faraonc"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546186325, "post_id": 53979086, "comment_id": 94795765, "body": "I just recently optimized my GRPC server. It runs all of my unit test from 5 minutes to less than a minute now.  I am reading something about burst writes from <a href=\"https://dzone.com/articles/mongodb-replication-lag-and\" rel=\"nofollow noreferrer\">dzone.com/articles/mongodb-replication-lag-and</a>"}, {"owner": {"reputation": 57591, "user_id": 1388319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/258babf29502a002296bc415851e2395?s=128&d=identicon&r=PG", "display_name": "Stennie", "link": "https://stackoverflow.com/users/1388319/stennie"}, "edited": false, "score": 0, "creation_date": 1546238745, "post_id": 53979086, "comment_id": 94806072, "body": "You mention testing on a local MongoDB server as well as Cosmos. Cosmos&#39; MongoDB API is a server implementation imitating the MongoDB API but the behaviour may differ. To clarify the scope of your question, can you confirm if you get the expected results on your local MongoDB server or if this problem is specific to Cosmos API? Also what version of the MongoDB Go Driver are you using?"}, {"owner": {"reputation": 51, "user_id": 10682766, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-z8vKBtcG5XY/AAAAAAAAAAI/AAAAAAAAAAs/Eiqag7vmyLU/photo.jpg?sz=128", "display_name": "faraonc", "link": "https://stackoverflow.com/users/10682766/faraonc"}, "reply_to_user": {"reputation": 57591, "user_id": 1388319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/258babf29502a002296bc415851e2395?s=128&d=identicon&r=PG", "display_name": "Stennie", "link": "https://stackoverflow.com/users/1388319/stennie"}, "edited": false, "score": 0, "creation_date": 1546239270, "post_id": 53979086, "comment_id": 94806208, "body": "@Stennie It happens for both CosmosDB and locally. I am currently using mongodb/mongo-go-driver@v0.0.17. I will try the 0.1.0 tonight."}, {"owner": {"reputation": 57591, "user_id": 1388319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/258babf29502a002296bc415851e2395?s=128&d=identicon&r=PG", "display_name": "Stennie", "link": "https://stackoverflow.com/users/1388319/stennie"}, "edited": false, "score": 0, "creation_date": 1546239634, "post_id": 53979086, "comment_id": 94806303, "body": "If the problem is reproducible with both server implementations, I would suggest editing your question to reflect a single environment you want to test against. The MongoDB Go Driver isn&#39;t tested with CosmosDB, so you are likely to get more help  getting your implementation working with a MongoDB server first. You should also edit your question to include the specific version of MongoDB server you are testing with."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1546344881, "post_id": 53979086, "comment_id": 94828011, "body": "Hm, could you please put together a <a href=\"https://stackoverflow.com/help/mcve\">minimal, complete and verifyable example (often referred to as MCVE)</a>? It is easier to find out what goes wrong with the bare minimum of code which produces the behavior you want to get rid of."}, {"owner": {"reputation": 51, "user_id": 10682766, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-z8vKBtcG5XY/AAAAAAAAAAI/AAAAAAAAAAs/Eiqag7vmyLU/photo.jpg?sz=128", "display_name": "faraonc", "link": "https://stackoverflow.com/users/10682766/faraonc"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1546396607, "post_id": 53979086, "comment_id": 94838193, "body": "@MarkusWMahlberg Hi, I am still in the process of upgrading to 0.1.0. We will find out soon."}, {"owner": {"reputation": 51, "user_id": 10682766, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-z8vKBtcG5XY/AAAAAAAAAAI/AAAAAAAAAAs/Eiqag7vmyLU/photo.jpg?sz=128", "display_name": "faraonc", "link": "https://stackoverflow.com/users/10682766/faraonc"}, "edited": false, "score": 0, "creation_date": 1546418880, "post_id": 53979086, "comment_id": 94843559, "body": "Unable to reproduce bug in MongoDB Server 3.4"}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 10682766, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-z8vKBtcG5XY/AAAAAAAAAAI/AAAAAAAAAAs/Eiqag7vmyLU/photo.jpg?sz=128", "display_name": "faraonc", "link": "https://stackoverflow.com/users/10682766/faraonc"}, "is_accepted": true, "score": 0, "last_activity_date": 1546418902, "creation_date": 1546418902, "answer_id": 54003449, "question_id": 53979086, "link": "https://stackoverflow.com/questions/53979086/data-inconsistency-with-mongodb-using-mongo-go-driver/54003449#54003449", "title": "Data Inconsistency with MongoDB using mongo-go-driver", "body": "<p>Unable to reproduce bug in MongoDB Server 3.4</p>\n"}], "owner": {"reputation": 51, "user_id": 10682766, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-z8vKBtcG5XY/AAAAAAAAAAI/AAAAAAAAAAs/Eiqag7vmyLU/photo.jpg?sz=128", "display_name": "faraonc", "link": "https://stackoverflow.com/users/10682766/faraonc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 434, "favorite_count": 0, "accepted_answer_id": 54003449, "answer_count": 1, "score": 0, "last_activity_date": 1546418902, "creation_date": 1546185230, "last_edit_date": 1546240007, "question_id": 53979086, "link": "https://stackoverflow.com/questions/53979086/data-inconsistency-with-mongodb-using-mongo-go-driver", "title": "Data Inconsistency with MongoDB using mongo-go-driver", "body": "<p>FindOneAndReplace may or may not replace the document in MongoDB.\nThe response indicates that the operation succeeded, but looking into MongoDB it was not updated at all.</p>\n\n<p>The MongoDB server version is MongoDB server version: 3.2.0 \nThis bug is reproducible in Ubuntu 16.04 and macOS Mojave.\nThe target host is Azure CosmosDB.</p>\n\n<p>The driver version is mongo-go-driver@v0.0.17</p>\n\n<pre><code>func (s *Service) DeleteFileMetadata(ctx context.Context, req *pb.DocumentRequest) (*pb.DocumentResponse, error) {\n    log.Println(\"[INFO] Requesting DeleteFileMetadata service\")\n\n    if ok := isStateAvailable(); !ok {\n        log.Printf(\"[ERROR] %s\\n\", errServiceUnavailable.Error())\n        return nil, status.Error(codes.Unavailable, errServiceUnavailable.Error())\n    }\n\n    if err := refreshMongoDBConnection(mongoDBWriter, &amp;conf.DocumentDB.Writer); err != nil {\n        log.Printf(\"[ERROR] %s\\n\", err.Error())\n        return nil, status.Error(codes.Internal, err.Error())\n    }\n\n    if req == nil {\n        log.Printf(\"[ERROR] %s\\n\", errNilRequest.Error())\n        return nil, status.Error(codes.InvalidArgument, errNilRequest.Error())\n    }\n\n    fileMetadataParameters := req.GetFileMetadataParameters()\n    if fileMetadataParameters == nil || fileMetadataParameters.GetDuid() == \"\" {\n\n        log.Printf(\"[ERROR] %s\\n\", errInvalidFileMetadataParameters.Error())\n        return nil, status.Error(codes.InvalidArgument, errInvalidFileMetadataParameters.Error())\n    }\n\n    if err := ValidateDUID(fileMetadataParameters.GetDuid()); err != nil {\n        log.Printf(\"[ERROR] %s\\n\", err.Error())\n        return nil, status.Error(codes.InvalidArgument, err.Error())\n    }\n\n    if err := ValidateUUID(fileMetadataParameters.GetUuid()); err != nil {\n        log.Printf(\"[ERROR] %s\\n\", err.Error())\n        return nil, status.Error(codes.InvalidArgument, err.Error())\n    }\n\n    if err := ValidateFUID(fileMetadataParameters.GetFuid()); err != nil {\n        log.Printf(\"[ERROR] %s\\n\", err.Error())\n        return nil, status.Error(codes.InvalidArgument, err.Error())\n    }\n\n    if fileMetadataParameters.Media &gt; pb.FileType_VIDEO {\n        return nil, status.Error(codes.InvalidArgument, errMediaType.Error())\n    }\n\n    log.Printf(\"[INFO] FileMetadataParameters: \\n%v\\n\\n\", pretty.Sprint(req.GetFileMetadataParameters()))\n\n    // Get the specific lock if it already exists, else make the lock\n    lock, _ := duidClientLocker.LoadOrStore(fileMetadataParameters.GetDuid(), &amp;sync.RWMutex{})\n    // Lock\n    lock.(*sync.RWMutex).Lock()\n    // Unlock before the function exits\n    defer lock.(*sync.RWMutex).Unlock()\n\n    collection := mongoDBWriter.Database(conf.DocumentDB.Name).Collection(conf.DocumentDB.Collection)\n\n    // Find all MongoDB documents for the specific uuid\n    filter := bson.NewDocument(\n        bson.EC.String(\"duid\", fileMetadataParameters.GetDuid()),\n        bson.EC.String(\"uuid\", fileMetadataParameters.GetUuid()),\n    )\n    bsonResult := collection.FindOne(context.Background(), filter)\n    if bsonResult == nil {\n        log.Printf(\"[ERROR] FindOne: %s\\n\", errNoDocumentFound.Error())\n        return nil, status.Error(codes.InvalidArgument, errNoDocumentFound.Error())\n    }\n    documentToUpdate := &amp;pb.Document{}\n    if err := bsonResult.Decode(documentToUpdate); err != nil {\n        log.Printf(\"[ERROR] Document not found, duid: %s - uuid: %s - err: %s\\n\",\n            fileMetadataParameters.GetDuid(), fileMetadataParameters.GetUuid(), err.Error())\n\n        return nil, status.Errorf(codes.InvalidArgument,\n            \"Document not found, duid: %s - uuid: %s\",\n            fileMetadataParameters.GetDuid(), fileMetadataParameters.GetUuid())\n    }\n\n    log.Printf(\"[INFO] Document to update: \\n%s\\n\\n\", pretty.Sprint(documentToUpdate))\n\n    switch fileMetadataParameters.Media {\n    case pb.FileType_FILE:\n        delete(documentToUpdate.GetFileUrlsMap(), fileMetadataParameters.GetFuid())\n    case pb.FileType_AUDIO:\n        delete(documentToUpdate.GetAudioUrlsMap(), fileMetadataParameters.GetFuid())\n    case pb.FileType_IMAGE:\n        delete(documentToUpdate.GetImageUrlsMap(), fileMetadataParameters.GetFuid())\n    case pb.FileType_VIDEO:\n        delete(documentToUpdate.GetVideoUrlsMap(), fileMetadataParameters.GetFuid())\n    default:\n        return nil, status.Error(codes.InvalidArgument, errMediaType.Error())\n    }\n    documentToUpdate.UpdateTimestamp = time.Now().UTC().Unix()\n\n    // option to return the the document after update\n    option := findopt.ReplaceOneBundle{}\n    result := collection.FindOneAndReplace(context.Background(), filter, documentToUpdate,\n        option.ReturnDocument(mongoopt.After))\n\n    // Extract the updated MongoDB document\n    if result == nil {\n        log.Printf(\"[ERROR] Extracting updated document, duid: %s - uuid: %s\\n\",\n            documentToUpdate.GetDuid(), documentToUpdate.GetUuid())\n\n        return nil, status.Errorf(codes.Internal,\n            \"Extracting updated document duid: %s - uuid: %s\",\n            documentToUpdate.GetDuid(), documentToUpdate.GetUuid())\n    }\n\n    document := &amp;pb.Document{}\n    if err := result.Decode(document); err != nil {\n        log.Printf(\"[ERROR] %s\\n\", err.Error())\n        return nil, status.Errorf(codes.Internal, err.Error())\n    }\n\n    log.Printf(\"[INFO] Updated document: \\n%s\\n\\n\", pretty.Sprint(document))\n    log.Printf(\"[INFO] Success deleting file metadata in document, duid: %s - uuid: %s - fuid: %s\\n\",\n        document.GetDuid(), document.GetUuid(), fileMetadataParameters.GetFuid())\n\n    return &amp;pb.DocumentResponse{\n        Status:  &amp;pb.DocumentResponse_Code{Code: uint32(codes.OK)},\n        Message: codes.OK.String(),\n        Data:    document,\n    }, nil\n}\n</code></pre>\n\n<p>I expect that response reflects the actual state of the data in the MongoDB server.</p>\n\n<p>Let us say I want to delete a filemetadata with fuid of <code>05ce38e7-a29a-485f-bf20-eef3501867f0</code></p>\n\n<p>I get this response indicating that it was deleted. The response was decoded from <code>result := collection.FindOneAndReplace(context.Background(), filter, documentToUpdate, option.ReturnDocument(mongoopt.After))</code></p>\n\n<pre><code> ImageUrlsMap:         {217706a5-2f88-4eb2-8a93-c1426c5ac944: \"https://hwscdevstorage.blob.core.windows.net/images/hulkgif.png\",\n                        4ff30392-8ec8-45a4-ba94-5e22c4a686df: \"https://hwscdevstorage.blob.core.windows.net/images/Rotating_earth_(large).gif\"},\n AudioUrlsMap:         {4ff30392-8ec8-45a4-ba94-5e22c4a686df: \"https://hwscdevstorage.blob.core.windows.net/audios/Milad Hosseini - Deli Asheghetam [128].mp3\",\n                        8fe5fea7-f683-4198-8c94-f27601a5e2d0: \"https://hwscdevstorage.blob.core.windows.net/audios/Seger_Conga_CaboMexico_Tag_Acousonde_20140313_112313_8000_3_BreedingMigrating.wav\"},\n VideoUrlsMap:         {4ff30392-8ec8-45a4-ba94-5e22c4a686de: \"https://hwscdevstorage.blob.core.windows.net/videos/videoplayback.wmv\",\n                        4ff30392-8ec8-45a4-ba94-5e22c4a686df: \"https://hwscdevstorage.blob.core.windows.net/videos/videoplayback.mp4\",\n                        e525ca9c-9813-4286-abda-8bd0eb6e94b4: \"https://hwscdevstorage.blob.core.windows.net/videos/pusheen.mp4\"},\n FileUrlsMap:          {13df1afa-4eee-470e-b9e2-60b2a7584994: \"https://hwscdevstorage.blob.core.windows.net/videos/videoplayback.wmv\",\n                        4ff30392-8ec8-45a4-ba94-5e22c4a686df: \"https://hwscdevstorage.blob.core.windows.net/videos/videoplayback.mp4\",\n                        b7a16e10-ac03-468f-9b6d-dcc684d1147f: \"https://hwscdevstorage.blob.core.windows.net/videos/pusheen.mp4\"},\n RecordTimestamp:      1514764800,\n CreateTimestamp:      1539831496,\n UpdateTimestamp:      1546183549,\n IsPublic:             true,\n XXX_NoUnkeyedLiteral: {},\n XXX_unrecognized:     [],\n XXX_sizecache:        0}\n\n2018/12/30 07:25:49 [INFO] Success deleting file metadata in document, duid: 1ChHfmKs8GX7D1XVf61lwVdisWf - uuid: 0XXXXSNJG0MQJHBF4QX1EFD6Y3 - fuid: 05ce38e7-a29a-485f-bf20-eef3501867f0\n</code></pre>\n\n<p>But if I go to Azure CosmosDB or in my local server, it is still there.\n<a href=\"https://i.stack.imgur.com/dfknK.png\" rel=\"nofollow noreferrer\">screenshot</a></p>\n"}, {"tags": ["ajax", "go", "post", "go-gin"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1546182997, "post_id": 53978746, "comment_id": 94794941, "body": "Your client is sending JSON, but your server is trying to decode a form. That obviously won&#39;t work."}, {"owner": {"reputation": 245, "user_id": 5175272, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/221471e0c5f933f312d99f5470ecb3da?s=128&d=identicon&r=PG&f=1", "display_name": "Rattrap", "link": "https://stackoverflow.com/users/5175272/rattrap"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546183078, "post_id": 53978746, "comment_id": 94794965, "body": "How can I get that value then?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1546183092, "post_id": 53978746, "comment_id": 94794966, "body": "Either send it as form-encoded, or decode it as JSON. The key is that encoding and decoding must match."}], "answers": [{"tags": [], "owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "is_accepted": true, "score": 1, "last_activity_date": 1546184743, "creation_date": 1546184743, "answer_id": 53979023, "question_id": 53978746, "link": "https://stackoverflow.com/questions/53978746/cant-get-post-parameter-in-golang-from-ajax-request/53979023#53979023", "title": "Can&#39;t get post parameter in Golang from ajax request", "body": "<p>This code decodes JSON object from request body:</p>\n\n<pre><code>// Request is structure to encode request body\ntype Request struct {\n    FileName string `json:\"filename\"`\n}\n\n// ServeHTTP is request handler\nfunc (h handler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    decoder := json.NewDecoder(r.Body)\n    var req Request\n    err := decoder.Decode(&amp;req)\n    if err != nil {\n        // handle error\n        return\n    }\n    // process request\n}\n</code></pre>\n"}], "owner": {"reputation": 245, "user_id": 5175272, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/221471e0c5f933f312d99f5470ecb3da?s=128&d=identicon&r=PG&f=1", "display_name": "Rattrap", "link": "https://stackoverflow.com/users/5175272/rattrap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 427, "favorite_count": 0, "accepted_answer_id": 53979023, "answer_count": 1, "score": 1, "last_activity_date": 1597438924, "creation_date": 1546182572, "last_edit_date": 1597438924, "question_id": 53978746, "link": "https://stackoverflow.com/questions/53978746/cant-get-post-parameter-in-golang-from-ajax-request", "title": "Can&#39;t get post parameter in Golang from ajax request", "body": "<p>On the client side I have code:</p>\n<pre><code>    let response = await fetch('/getInfo', {\n      credentials: 'same-origin',\n      method: 'POST',\n      body: JSON.stringify({filename: &quot;file.jpg&quot;})\n    });\n</code></pre>\n<p>Code on the server side:</p>\n<pre><code>    fmt.Println(c.PostForm(&quot;filename&quot;)) // empty\n</code></pre>\n<p>Why is it empty? How to get value of <code>c.PostForm(&quot;filename&quot;)</code>?</p>\n"}, {"tags": ["go", "error-handling", "pq"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1546163764, "post_id": 53976417, "comment_id": 94790909, "body": "Apart from being explicit about discarding the error there is no difference between <code>_ = cancel()</code> and <code>cancel()</code>."}], "answers": [{"comments": [{"owner": {"reputation": 740, "user_id": 2471524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345a080a421b053d124139a0bce7d62e?s=128&d=identicon&r=PG", "display_name": "blobdon", "link": "https://stackoverflow.com/users/2471524/blobdon"}, "edited": false, "score": 0, "creation_date": 1546168620, "post_id": 53976647, "comment_id": 94791823, "body": "Please, can you comment on your downvote so I can attempt to make this better, or learn from my errors?"}], "tags": [], "owner": {"reputation": 740, "user_id": 2471524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345a080a421b053d124139a0bce7d62e?s=128&d=identicon&r=PG", "display_name": "blobdon", "link": "https://stackoverflow.com/users/2471524/blobdon"}, "is_accepted": false, "score": 3, "last_activity_date": 1546170024, "last_edit_date": 1546170024, "creation_date": 1546163747, "answer_id": 53976647, "question_id": 53976417, "link": "https://stackoverflow.com/questions/53976417/assigning-the-returning-error-to-an-underscore/53976647#53976647", "title": "Assigning the returning error to an underscore", "body": "<p>The blank identifier \u201c_\u201d is a special anonymous identifier. When used in an assignment, like this case, it provides a way to <em>explicitly</em> ignore right-hand side values. So, the developer has decided to ignore/discard the error returned from this method call. </p>\n\n<p>A few reasons why they may have done this (based on a quick glance at the method call and context, my guess is 3 or 4): </p>\n\n<ol>\n<li>The method call is guaranteed to succeed in this context.</li>\n<li>The error is already handled sufficiently within the method call; no reason to handle it again.</li>\n<li>The error doesn\u2019t matter (eg the relevant process is going to end anyway and the outcome will be the same as if the method call has succeeded without error).</li>\n<li>The developer was in a hurry to get something working, ignored the error to save time, then failed to come back and handle the error.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 5, "last_activity_date": 1546174217, "last_edit_date": 1546174217, "creation_date": 1546168079, "answer_id": 53977117, "question_id": 53976417, "link": "https://stackoverflow.com/questions/53976417/assigning-the-returning-error-to-an-underscore/53977117#53977117", "title": "Assigning the returning error to an underscore", "body": "<p>Code must be correct. To be sure that code is correct, code must be readable.</p>\n\n<hr>\n\n<p>The First Rule of Go: Check for errors.</p>\n\n<hr>\n\n<pre><code>func (cn *conn) cancel() error\n</code></pre>\n\n<p>If I write</p>\n\n<pre><code>cn.cancel()\n</code></pre>\n\n<p>did I forget to check for errors or did I decide to discard the error value?</p>\n\n<p>However, if I write</p>\n\n<pre><code>_ = cn.cancel()\n</code></pre>\n\n<p>I did not forget to check for errors and I did decide to discard the error value.</p>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p>Blank identifier</p>\n  \n  <p>The blank identifier is represented by the underscore character _. It\n  serves as an anonymous placeholder instead of a regular (non-blank)\n  identifier and has special meaning in declarations, as an operand, and\n  in assignments. </p>\n  \n  <p>Assignments</p>\n  \n  <p>The blank identifier provides a way to ignore right-hand side values\n  in an assignment:</p>\n</blockquote>\n"}], "owner": {"reputation": 3629, "user_id": 1744107, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/91748b7203b0ef849403e8099da4528f?s=128&d=identicon&r=PG", "display_name": "Rambatino", "link": "https://stackoverflow.com/users/1744107/rambatino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 1, "accepted_answer_id": 53977117, "answer_count": 2, "score": 3, "last_activity_date": 1546174217, "creation_date": 1546161122, "question_id": 53976417, "link": "https://stackoverflow.com/questions/53976417/assigning-the-returning-error-to-an-underscore", "title": "Assigning the returning error to an underscore", "body": "<p>I've been reading some Golang code from github.com/lib/pq which provides drivers for interacting with a postgres database.</p>\n\n<p>Among the code I came across <a href=\"https://github.com/lib/pq/blob/master/conn_go18.go#L83\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>go func() {\n    select {\n    case &lt;-done:\n        _ = cn.cancel()\n        finished &lt;- struct{}{}\n    case &lt;-finished:\n    }\n}()\n</code></pre>\n\n<p>The cancel function <a href=\"https://github.com/lib/pq/blob/master/conn_go18.go#L98\" rel=\"nofollow noreferrer\">looks like</a>:</p>\n\n<pre><code>func (cn *conn) cancel() error\n</code></pre>\n\n<p>As far as I can tell, the underscore isn't being used as a static assertion about a type (and therefore the compiler doesn't evaluate any side effects as far as I can see (<a href=\"https://stackoverflow.com/questions/13194272/what-does-an-underscore-and-interface-name-after-keyword-var-mean\">as in this example</a>)) and it isn't a second parameter whereby the author may want to discard it.</p>\n\n<p>In summary: Why assign the result of the cancel function (the error) to an underscore?</p>\n"}, {"tags": ["docker", "go"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 4, "last_activity_date": 1546162053, "creation_date": 1546162053, "answer_id": 53976490, "question_id": 53976370, "link": "https://stackoverflow.com/questions/53976370/change-go-path-explicitly-on-docker-image/53976490#53976490", "title": "Change go path explicitly on docker image", "body": "<blockquote>\n  <p>my question is if via set env or something I can do some trick to overcome this issue ? </p>\n</blockquote>\n\n<p>Not \"set env\", but <a href=\"https://docs.docker.com/engine/reference/builder/#env\" rel=\"nofollow noreferrer\"><code>ENV</code></a>:</p>\n\n<pre><code>ENV GOPATH=/path/to/your/Go/project\n</code></pre>\n\n<p>That would ensure any Go command is using the right workspace.</p>\n"}], "owner": {"reputation": 351, "user_id": 10816571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45aa02b808aa538cdaa37ed33a8557e9?s=128&d=identicon&r=PG&f=1", "display_name": "Rayn D", "link": "https://stackoverflow.com/users/10816571/rayn-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2525, "favorite_count": 1, "accepted_answer_id": 53976490, "answer_count": 1, "score": 2, "last_activity_date": 1546162053, "creation_date": 1546160584, "question_id": 53976370, "link": "https://stackoverflow.com/questions/53976370/change-go-path-explicitly-on-docker-image", "title": "Change go path explicitly on docker image", "body": "<p>when I run <code>dep ensure</code> </p>\n\n<p>/home/jenkins/workspace/myproject-voter is not within a known <code>GOPATH/src</code></p>\n\n<p>we have go installed on this docker image , I know that the project is not cloned to <code>go/src</code> but my question is if via <code>set env</code> or something I can do some trick to overcome this issue ? </p>\n"}, {"tags": ["go", "substitution"], "comments": [{"owner": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "edited": false, "score": 0, "creation_date": 1546193454, "post_id": 53975343, "comment_id": 94797531, "body": "There&#39;s no way of interpolating variables to a Go string. However you can look at strings.Replacer"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1546214749, "post_id": 53975343, "comment_id": 94802291, "body": "Answers to the marked duplicate list your best options with the standard library."}], "owner": {"reputation": 1391, "user_id": 8828489, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cea21c4b94376330efc9e542d5733749?s=128&d=identicon&r=PG", "display_name": "huynhsamha", "link": "https://stackoverflow.com/users/8828489/huynhsamha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1242, "favorite_count": 0, "closed_date": 1546151950, "answer_count": 0, "score": 3, "last_activity_date": 1546220311, "creation_date": 1546145154, "last_edit_date": 1546220311, "question_id": 53975343, "link": "https://stackoverflow.com/questions/53975343/simplify-substituting-variables-in-string-with-golang", "closed_reason": "Duplicate", "title": "Simplify substituting variables in string with Golang", "body": "<p>I'm trying to learn about the <strong>Golang</strong> language</p>\n\n<p>Today I have a question about <strong>substituting variables in string</strong> with Golang</p>\n\n<p>I've searched how to resolve it in golang and found <strong>2 ways</strong> as this <a href=\"https://www.socketloop.com/tutorials/golang-interpolating-or-substituting-variables-in-string-examples\" rel=\"nofollow noreferrer\">blog</a>.</p>\n\n<h3>First way</h3>\n\n<p>The first way is using <strong><code>fmt.Sprintf</code></strong>, example (I've made one on <a href=\"https://play.golang.org/p/QvZhe45ROhP\" rel=\"nofollow noreferrer\">Go Playground here</a>):</p>\n\n<pre><code>msg := fmt.Sprintf(\"Hello %s, you have %d new messages\", \"Alice\", 15)\nfmt.Println(msg)\n</code></pre>\n\n<h3>Second way</h3>\n\n<p>And the second one is using <strong><code>text/template</code></strong> package, example (I've made one on <a href=\"https://play.golang.org/p/0vufNgqzNyy\" rel=\"nofollow noreferrer\">Go Playground here</a>):</p>\n\n<pre><code>msg := \"Hi {{.DisplayName}}, you have {{ .NumMessages }} new messages\"\n\ndata := map[string]interface{}{\n    \"DisplayName\": \"Bob\",\n    \"NumMessages\": 15,\n}\n\ntmpl, err := template.New(\"msg\").Parse(msg)\nbuf := &amp;bytes.Buffer{}\nif err = tmpl.Execute(buf, data); err != nil {\n    fmt.Println(err)\n}\ns := buf.String()\n\nfmt.Println(s)\n</code></pre>\n\n<p>I noticed that the first way is simple but it's <strong>not easy to read</strong>, and the second is <strong>very complicated</strong> (perhaps we need to create a utility function)</p>\n\n<p>I've worked with <strong>JavaScript</strong> and I found that it's very simple:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>displayName = \"Trudy\"\r\nnumMessages = 15\r\nmsg = `Hello ${displayName}, you have ${numMessages} new messages`\r\nconsole.log(msg)</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>Is there any way we can simplify this in Golang? Because I have just learned this language so I hope to have many ideas to improve my experience.</p>\n\n<p><strong>Edit to reopen question</strong></p>\n\n<p>My hope is whether there is a similar way in Golang such as JavaScript, it is also different with the above ways with the problems I mentioned (it shouldn't use placeholder for variable as first way, not easy to read, and it is also not complicated as second)</p>\n\n<p><strong>Edit to close this question</strong></p>\n\n<p>After a while of searching, I think Golang doesn't have a simple way to avoid this problem as JavaScript. Therefore I've closed this question without any other questions.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 2, "last_activity_date": 1546134019, "creation_date": 1546134019, "answer_id": 53974691, "question_id": 53974634, "link": "https://stackoverflow.com/questions/53974634/deadlock-with-multiples-goroutines-and-one-channel/53974691#53974691", "title": "Deadlock with multiples goroutines and one channel", "body": "<p>You are using <code>for i := range c</code> to iterate over a channel yet the code does not know when to stop. <code>range</code> over a channel waits until channel to be closed, or hang forever. That is why there is a deadlock. </p>\n\n<p>You should close your channel after all \"urls\" are issued over the channel. This can be acheived with helps of <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\"><code>sync.WaitGroup</code></a>. In <code>getNumbers</code>, before the loop, you can use a <code>WaitGroup</code> and set number of jobs to wait as <code>len(urls)</code>:</p>\n\n<pre><code>wg:=&amp;sync.WaitGroup{}\nwg.Add(len(urls))\n</code></pre>\n\n<p>And add a new goroutine before returning <code>ch</code>:</p>\n\n<pre><code>go func() {\n    wg.Wait()\n    close(ch)\n} ()\n</code></pre>\n\n<p>And then in <code>allNumbersOfURL</code>, add the <code>WaitGroup</code> as a new param, and set a job done after the loop.</p>\n\n<pre><code>func allNumbersOfURL(url urlNumbers, ch chan int,wg *sync.WaitGroup) {\n    for _, i := range url.numbers {\n        ch &lt;- i\n    }\n    wg.Done()\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/--7x7eXIzP9\" rel=\"nofollow noreferrer\">https://play.golang.org/p/--7x7eXIzP9</a></p>\n"}, {"tags": [], "owner": {"reputation": 201, "user_id": 10814080, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-IHSUhxzo9Fs/AAAAAAAAAAI/AAAAAAAAAA8/RCIP5dhhB4A/photo.jpg?sz=128", "display_name": "Bob Fred", "link": "https://stackoverflow.com/users/10814080/bob-fred"}, "is_accepted": false, "score": 2, "last_activity_date": 1546134820, "last_edit_date": 1546134820, "creation_date": 1546134141, "answer_id": 53974698, "question_id": 53974634, "link": "https://stackoverflow.com/questions/53974634/deadlock-with-multiples-goroutines-and-one-channel/53974698#53974698", "title": "Deadlock with multiples goroutines and one channel", "body": "<p>channel must be closed, u can use <code>sync.WaitGroup</code> to wait for tasks done. Here's an modification to function <code>getNumbers</code></p>\n\n<pre><code>func getNumbers(urls []urlNumbers) &lt;-chan int {\n    ch := make(chan int)\n\n    wg := &amp;sync.WaitGroup{}\n    for _, url := range urls {\n        wg.Add(1)\n        go func(url urlNumbers, ch chan&lt;- int) {\n            defer wg.Done()\n            allNumbersOfURL(url, ch)\n        }(url, ch)\n    }\n\n    go func(wg *sync.WaitGroup, ch chan int) {\n        wg.Wait()\n        close(ch)\n    }(wg, ch)\n\n    return ch\n}\n</code></pre>\n\n<p>Additionally, I advice u use channel direction in argument delivering.</p>\n\n<blockquote>\n  <p>The optional &lt;- operator specifies the channel direction, send or\n  receive. If no direction is given, the channel is bidirectional.</p>\n</blockquote>\n"}], "owner": {"reputation": 7736, "user_id": 2744242, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/71d3267f5993b6b79619213c789524b5?s=128&d=identicon&r=PG&f=1", "display_name": "rafaelcb21", "link": "https://stackoverflow.com/users/2744242/rafaelcb21"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 1, "accepted_answer_id": 53974691, "answer_count": 2, "score": 0, "last_activity_date": 1546170077, "creation_date": 1546133001, "last_edit_date": 1546170077, "question_id": 53974634, "link": "https://stackoverflow.com/questions/53974634/deadlock-with-multiples-goroutines-and-one-channel", "title": "Deadlock with multiples goroutines and one channel", "body": "<p>I have a deadlock problem that I can not solve.</p>\n\n<p>I own some urls, and every url in a goroutine will bring me enough data. This data I'm putting in a single channel. But if I close the channel the program does not work, if I leave the channel open deadlock appears.</p>\n\n<p>I do not know how to solve, someone would have a solution</p>\n\n<p>Below I put the problem in a simplified way</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype urlNumbers struct {\n    url string\n    numbers []int\n}\n\nfunc getNumbers(urls []urlNumbers) chan int {\n    ch := make(chan int)\n\n    for _, url := range urls {\n        go allNumbersOfURL(url, ch)\n    }\n\n    return ch\n}\n\nfunc allNumbersOfURL(url urlNumbers, ch chan int) {\n    for _, i := range url.numbers {\n        ch &lt;- i\n    }\n}\n\nfunc main() {\n    url1 := urlNumbers {url: \"1\", numbers: []int{1, 2, 3}}\n    url2 := urlNumbers {url: \"2\", numbers: []int{4, 5, 6}}\n    url3 := urlNumbers {url: \"3\", numbers: []int{7, 8, 9}}\n    url4 := urlNumbers {url: \"4\", numbers: []int{10, 11, 12}}\n\n    c := getNumbers([]urlNumbers{url1, url2, url3, url4})\n\n    for i := range c {\n        fmt.Println(i)\n    }\n\n    fmt.Println(\"END\")\n\n}\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>go run app.go\n10\n11\n12\n4\n7\n1\n2\n3\n5\n6\n8\n9\nfatal error: all goroutines are asleep - deadlock!\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 2, "creation_date": 1546129962, "post_id": 53974374, "comment_id": 94786558, "body": "<code>syscall.Dup2</code> is wrapping <a href=\"http://man7.org/linux/man-pages/man2/dup2.2.html\" rel=\"nofollow noreferrer\">dup2(2)</a> so you should expect it to fail when the first argument is -1. BTW, I don&#39;t understand what you want to do. What if your program does not run in a terminal (e.g. has been started by some <a href=\"http://man7.org/linux/man-pages/man5/crontab.5.html\" rel=\"nofollow noreferrer\">crontab(5)</a> job)?"}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 1, "creation_date": 1546130236, "post_id": 53974374, "comment_id": 94786591, "body": "Your real issue is not related to Go. It is a misunderstanding of Linux programming. You should consider reading some Linux programming book, such as <a href=\"http://www.makelinux.net/alp/\" rel=\"nofollow noreferrer\">ALP</a>"}, {"owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "reply_to_user": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1546131143, "post_id": 53974374, "comment_id": 94786731, "body": "I may potentially run this same code on a windows OS later into the future.  Curious if that has implications on what I asked and the answers I&#39;ll be receiving."}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1546131204, "post_id": 53974374, "comment_id": 94786748, "body": "Of course, Linux and Windows are <i>very different</i> <a href=\"https://en.wikipedia.org/wiki/Operating_system\" rel=\"nofollow noreferrer\">operating systems</a> so you should not expect them to share a common behavior."}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1546131873, "post_id": 53974374, "comment_id": 94786857, "body": "What make you believe that your program is always started in a terminal?"}, {"owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "reply_to_user": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1546133393, "post_id": 53974374, "comment_id": 94787058, "body": "Most of the time, the program won&#39;t be started from a terminal.  I have a json file with the property <code>debug</code> that is <code>false</code> by default, which causes the program to output everything to an external file.  Sometimes I might start the process from terminal, but may wish to toggle the debug mode between true and false, and have the program output stderr to terminal or a file without needing to rebuild and run the program.  That was the original intention, but if it&#39;s a bad idea, I&#39;ll use different approach."}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1546133585, "post_id": 53974374, "comment_id": 94787077, "body": "What is your program doing? How do you start it?"}], "answers": [{"comments": [{"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 1, "creation_date": 1546130371, "post_id": 53974423, "comment_id": 94786612, "body": "In that context (of using <a href=\"http://man7.org/linux/man-pages/man2/dup2.2.html\" rel=\"nofollow noreferrer\">dup2(2)</a>) the 0 is the file descriptor of standard input, i.e. <code>STDIN_FILENO</code>. See also <a href=\"http://man7.org/linux/man-pages/man3/stdin.3.html\" rel=\"nofollow noreferrer\">stdin(3)</a>"}, {"owner": {"reputation": 23130, "user_id": 8586227, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BRnwg.png?s=128&g=1", "display_name": "Davis Herring", "link": "https://stackoverflow.com/users/8586227/davis-herring"}, "edited": false, "score": 0, "creation_date": 1546130487, "post_id": 53974423, "comment_id": 94786632, "body": "In some cases, descriptors 0 and 2 start out equivalent, so it\u2019s serving as an accidental backup of the sort I said you needed."}], "tags": [], "owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "is_accepted": false, "score": 0, "last_activity_date": 1546131272, "last_edit_date": 1546131272, "creation_date": 1546130194, "answer_id": 53974423, "question_id": 53974374, "link": "https://stackoverflow.com/questions/53974374/redirect-stderr-panic-back-to-terminal-in-go/53974423#53974423", "title": "Redirect stderr panic back to terminal in go", "body": "<p>I don't know why, but <code>syscall.Dup2(0,int(os.Stderr.Fd()))</code> returns panic stderr back to terminal.</p>\n\n<p>My understanding of the linux operating system is weak.  So I don't understand the significance of <code>0</code> in this context and the linux documentation.  </p>\n\n<p>Also, I haven't attempted this approach on a windows machine, so not sure what will happen there.  I hope other people give better answers.</p>\n"}, {"tags": [], "owner": {"reputation": 23130, "user_id": 8586227, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BRnwg.png?s=128&g=1", "display_name": "Davis Herring", "link": "https://stackoverflow.com/users/8586227/davis-herring"}, "is_accepted": true, "score": 2, "last_activity_date": 1546130406, "creation_date": 1546130406, "answer_id": 53974441, "question_id": 53974374, "link": "https://stackoverflow.com/questions/53974374/redirect-stderr-panic-back-to-terminal-in-go/53974441#53974441", "title": "Redirect stderr panic back to terminal in go", "body": "<p>You have to save the original stderr somewhere before overwriting it with your first <code>Dup2</code>.  (In general, it\u2019s a bad idea to use the <code>dup2</code> feature of closing the target, since it can\u2019t report errors therefrom.)  Then you can <code>Dup2</code> <em>that</em> back to <code>int(os.Stderr.Fd())</code> (aka 2).</p>\n"}, {"tags": [], "owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "is_accepted": false, "score": 1, "last_activity_date": 1546134698, "last_edit_date": 1546134698, "creation_date": 1546130553, "answer_id": 53974452, "question_id": 53974374, "link": "https://stackoverflow.com/questions/53974374/redirect-stderr-panic-back-to-terminal-in-go/53974452#53974452", "title": "Redirect stderr panic back to terminal in go", "body": "<blockquote>\n  <p>Can anyone tell me how to redirect stderr back to bash terminal?</p>\n</blockquote>\n\n<p><strong>In general, that is impossible</strong>, because a Unix program can be started (or run) <em>without</em> any terminal. For example, it could be started by a <a href=\"http://man7.org/linux/man-pages/man5/crontab.5.html\" rel=\"nofollow noreferrer\">crontab(5)</a> job, or thru some <code>at</code> or <code>ssh</code> command, etc. Think also of your program being run with <a href=\"https://en.wikipedia.org/wiki/Redirection_(computing)\" rel=\"nofollow noreferrer\">redirections</a> or in a <a href=\"https://en.wikipedia.org/wiki/Pipeline_(Unix)\" rel=\"nofollow noreferrer\">pipeline</a>, or of your program being run in a server (e.g. inside a data center); then it is likely to not have any terminal.</p>\n\n<p>The common practice is for the user of your program to perhaps redirect <code>stderr</code> (and probably <em>not</em> to a terminal, but more likely to some file). Your user would use its <a href=\"https://en.wikipedia.org/wiki/Unix_shell\" rel=\"nofollow noreferrer\">shell</a> for that purpose (e.g. run <code>yourprogram 2&gt; /tmp/errorfile</code>; read the <a href=\"https://www.gnu.org/software/bash/manual/html_node/Redirections.html\" rel=\"nofollow noreferrer\">documentation of <code>bash</code> about redirections</a>)</p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Computer_terminal\" rel=\"nofollow noreferrer\">Terminals</a> are quite complex stuff. You could read the <a href=\"http://www.linusakesson.net/programming/tty/\" rel=\"nofollow noreferrer\">TTY demystified</a> page. See also <a href=\"http://man7.org/linux/man-pages/man7/pty.7.html\" rel=\"nofollow noreferrer\">pty(7)</a> and <a href=\"http://man7.org/linux/man-pages/man3/termios.3.html\" rel=\"nofollow noreferrer\">termios(3)</a>. The usual way to handle terminals (on Unix) is by using the <a href=\"https://www.gnu.org/software/ncurses/\" rel=\"nofollow noreferrer\">ncurses</a> library (which has been wrapped as <a href=\"https://github.com/rthornton128/goncurses\" rel=\"nofollow noreferrer\">goncurses</a> in Go).</p>\n\n<blockquote>\n  <p>Elsewhere in my program, I had called a syscall.Dup2(int(file.Fd()), int(os.Stderr.Fd())), which logs stderr to an external file. </p>\n</blockquote>\n\n<p>That is really a bad idea. Your user expects his/her <a href=\"https://en.wikipedia.org/wiki/Standard_streams#Standard_error_(stderr)\" rel=\"nofollow noreferrer\">stderr</a> to stay the same (and would have redirected the <code>stderr</code> in his/her shell if so needed). Conventionally, you should not mess that <a href=\"https://en.wikipedia.org/wiki/Standard_streams\" rel=\"nofollow noreferrer\">standard streams</a> in your program (and leave them to what they are).</p>\n\n<p>A <a href=\"https://en.wikipedia.org/wiki/File_descriptor\" rel=\"nofollow noreferrer\">file descriptor</a> is some small positive-or-zero index (into the file descriptor table of your <a href=\"https://en.wikipedia.org/wiki/Process_(computing)\" rel=\"nofollow noreferrer\">process</a>). System calls like <a href=\"http://man7.org/linux/man-pages/man2/dup2.2.html\" rel=\"nofollow noreferrer\">dup2(2)</a> are expecting valid file descriptors, and Go's <code>syscall.Dup2</code> is just wrapping that <a href=\"http://man7.org/linux/man-pages/man2/dup2.2.html\" rel=\"nofollow noreferrer\">dup2(2)</a>.</p>\n\n<p>On Linux, you can query the file descriptor table of some process of pid 1234 by looking into the <code>/proc/1234/fd/</code> directory. See <a href=\"http://man7.org/linux/man-pages/man5/proc.5.html\" rel=\"nofollow noreferrer\">proc(5)</a> for more.</p>\n\n<p>If you are absolutely certain that your program <em>is</em> running in a terminal, you might open <code>/dev/tty</code> to get it. See <a href=\"http://man7.org/linux/man-pages/man4/tty.4.html\" rel=\"nofollow noreferrer\">tty(4)</a> for more. However, I don't recommend doing that (because you'll better design your program to be runnable <em>outside</em> of any terminal).</p>\n\n<p>You may want to read some Linux programming book, such as <a href=\"http://www.makelinux.net/alp/\" rel=\"nofollow noreferrer\">ALP</a>.</p>\n\n<p>For logging purposes, Go provides its <a href=\"https://golang.org/pkg/log/\" rel=\"nofollow noreferrer\">log</a> package. See also <a href=\"http://man7.org/linux/man-pages/man3/syslog.3.html\" rel=\"nofollow noreferrer\">syslog(3)</a> and the <a href=\"https://golang.org/pkg/log/syslog/\" rel=\"nofollow noreferrer\"><code>log/syslog</code></a> package of Go.</p>\n\n<p>PS. I don't know Windows, but I believe it also can start programs without any terminal, e.g. as a <a href=\"https://en.wikipedia.org/wiki/Background_process\" rel=\"nofollow noreferrer\">background process</a>. So even on Windows I would try to avoid doing that (redirection of stderr to a terminal).</p>\n"}], "owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "accepted_answer_id": 53974441, "answer_count": 3, "score": -2, "last_activity_date": 1546134698, "creation_date": 1546129450, "question_id": 53974374, "link": "https://stackoverflow.com/questions/53974374/redirect-stderr-panic-back-to-terminal-in-go", "title": "Redirect stderr panic back to terminal in go", "body": "<p>I'm trying to redirect panic/standard error back to bash terminal with the following go code:</p>\n\n<pre><code>    if err := syscall.Dup2(-1,int(os.Stderr.Fd())); err != nil {\n      log.Fatalf(\"Failed to redirect stderr to bash: %v\",err)\n    }\n</code></pre>\n\n<p>But the err gives me a \"bad file descriptor\", probably because of the <code>-1</code> I used in the first argument.  I chose the value <code>-1</code> because I found that <code>int(file.(*os.File).Fd())</code> returned a <code>-1</code> when <code>file.Close()</code> has been called.</p>\n\n<p>As for what I'm trying to do. Elsewhere in my program, I had called a <code>syscall.Dup2(int(file.Fd()), int(os.Stderr.Fd()))</code>, which logs stderr to an external file.  But I want stderr to point to bash terminal on occasion.</p>\n\n<p><a href=\"https://golang.org/pkg/syscall/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/syscall/</a> Doesn't give a verbose explanation of syscall.Dup2.  I started poking around what file.Fd() returns and how it is used, but also didn't fully understand.</p>\n\n<p>Can anyone tell me how to redirect stderr back to bash terminal?</p>\n"}, {"tags": ["go", "serial-port", "3d-printing"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1546124590, "post_id": 53973951, "comment_id": 94785599, "body": "You should include the printer model or which controller(s) you&#39;re using in the question."}, {"owner": {"reputation": 129, "user_id": 2646996, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4a1436c327b2d45dd868d514a6662864?s=128&d=identicon&r=PG", "display_name": "gochuck", "link": "https://stackoverflow.com/users/2646996/gochuck"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1546125065, "post_id": 53973951, "comment_id": 94785693, "body": "Updated at the bottom.  I know the printer can be communicated with because I&#39;ve gotten it to work just fine with Cura and Octoprint."}, {"owner": {"reputation": 38430, "user_id": 429063, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fd38783123814dee889d28c991e56fb?s=128&d=identicon&r=PG", "display_name": "Chris Stratton", "link": "https://stackoverflow.com/users/429063/chris-stratton"}, "edited": false, "score": 0, "creation_date": 1546130577, "post_id": 53973951, "comment_id": 94786645, "body": "Many 3d printers are Arduino based.  On typical PC operating system configurations, opening the serial port will trigger a reset to a bootloader, which then takes a second or two to time out and run the main program (&quot;sketch&quot;).  Your code tries to talk immediately.  Try instead to put in several seconds delay before you try to talk."}, {"owner": {"reputation": 129, "user_id": 2646996, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4a1436c327b2d45dd868d514a6662864?s=128&d=identicon&r=PG", "display_name": "gochuck", "link": "https://stackoverflow.com/users/2646996/gochuck"}, "edited": false, "score": 0, "creation_date": 1546376795, "post_id": 53973951, "comment_id": 94834865, "body": "So, I think part of the problem is that I can&#39;t set the port to 250000 baud either.  I&#39;ve been searching for a way to set that baud in Go but I&#39;m coming up empty handed.  The syscall package for instance does not allow that particular baud rate."}], "answers": [{"tags": [], "owner": {"reputation": 129, "user_id": 2646996, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4a1436c327b2d45dd868d514a6662864?s=128&d=identicon&r=PG", "display_name": "gochuck", "link": "https://stackoverflow.com/users/2646996/gochuck"}, "is_accepted": false, "score": 0, "last_activity_date": 1546379613, "creation_date": 1546379613, "answer_id": 53999238, "question_id": 53973951, "link": "https://stackoverflow.com/questions/53973951/3d-printer-serial-communication/53999238#53999238", "title": "3D Printer Serial Communication", "body": "<p>In case anyone stumbles on having trouble connecting golang to 3D printers, I finally found a solution.  It turns out that the current implementation of syscalls in the go standard library does not support non-spec baud rates.  Most 3D printers operate at 250K baud and this rate is not supported therefore it will fail.  Using a package that implements the termios2 specification allows for unusual bit rates and fixes the problem.  Here is the current implementation that I'm using and is working well.</p>\n\n<p><a href=\"https://github.com/distributed/sers\" rel=\"nofollow noreferrer\">https://github.com/distributed/sers</a></p>\n"}], "owner": {"reputation": 129, "user_id": 2646996, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4a1436c327b2d45dd868d514a6662864?s=128&d=identicon&r=PG", "display_name": "gochuck", "link": "https://stackoverflow.com/users/2646996/gochuck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1287, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1546379613, "creation_date": 1546124132, "last_edit_date": 1546130003, "question_id": 53973951, "link": "https://stackoverflow.com/questions/53973951/3d-printer-serial-communication", "title": "3D Printer Serial Communication", "body": "<p>I'm working on building a tool that can communication with 3D printers in Golang.  The problem that I'm having is stumping me, it seems that I can initiate the connection to the printer.  The LCD screen changes, the code starts to run, but whenever I try to read from the port I never get anything back.  Specifically they're supposed to return an \"ok\" message so I know to continue the next message.  Additionally when I send the Gcode strings it never seems to understand them, as far as I can tell they're just dropped.  Here's the sample code that I'm using:</p>\n\n<pre><code>package printer\n\nimport (\n    \"errors\"\n    \"fmt\"\n    \"log\"\n    \"strings\"\n    \"time\"\n    \"io/ioutil\"\n    \"path/filepath\"\n\n    \"github.com/tarm/serial\"\n)\n\n//Printer is a connection to a reprap or similar printer\ntype Printer struct {\n    s *serial.Port\n}\n\n//Connect creates the printer struct and returns it after initing it\nfunc Connect(port string, speed int64) Printer {\n    devices, err := getSerialDevices()\n    if err != nil {\n        log.Println(err)\n    }\n    for _, value := range devices {\n      log.Println(\"Found device: \", value)\n    }\n    c := &amp;serial.Config{Name: devices[0], Baud: 115200, ReadTimeout: time.Second * 5}\n    s, err := serial.OpenPort(c)\n    if err != nil {\n        log.Println(\"Failed to open communication\")\n        log.Fatal(err)\n    }\n\n    p := Printer{}\n\n    p.s = s\n\n    p.readPump()\n    p.readPump()\n\n    return p\n}\n\nfunc (p *Printer) readPump() string {\n    output := \"\"\n    oldLength := -1\n    for {\n        buf := make([]byte, 128)\n        /*\n         This appears to be where part of the problem is,\n         I never get anything back from the printer.  Per the\n         tarm documentation since I'm in non-blocking mode\n         I don't capture the error because it's an EOF\n         */\n        n, _:= p.s.Read(buf)\n\n        /*if err != nil {\n            log.Println(\"Failed to readPump\")\n            log.Fatal(err)\n        }*/\n        output += fmt.Sprintf(\"%s\", buf[:n])\n        if len(output) == oldLength {\n            return output\n        }\n\n        oldLength = len(output)\n\n    }\n}\n\n//SendCommand sends a single GCODE command to the printer\nfunc (p *Printer) SendCommand(g string) error {\n    g = g + \"\\n\"\n    _, err := p.s.Write([]byte(g))\n    if err != nil {\n        log.Println(\"Failed to write: \", g)\n        log.Fatal(err)\n    }\n    if !strings.HasSuffix(p.readPump(), \"ok\\n\") {\n        log.Println(errors.New(\"command did not complete successfully\"))\n    }\n\n    return nil\n}\n\n//Retrieve the absolute path for serial devices\nfunc getSerialDevices() ([]string, error) {\n    log.Println(\"getting serial devices\")\n    devices, err := ioutil.ReadDir(\"/dev/serial/by-id\")\n    if err != nil {\n        log.Println(err)\n        return nil, err\n    }\n    deviceList := make([]string, len(devices))\n    for index, deviceLink := range devices {\n        //log.Println(\"Found device: \", deviceLink.Name())\n        abs, err := filepath.EvalSymlinks(\"/dev/serial/by-id/\" + deviceLink.Name())\n        //log.Print(\"Absolute Device: \")\n        //log.Println(abs)\n        deviceList[index] = abs\n        if err != nil {\n            log.Println(err)\n            return nil, err\n        }\n    }\n    return deviceList, nil\n}\n</code></pre>\n\n<p>Here's the code I'm using to call the printer:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"github.com/david-fry/go-3dprinter\"\n)\n\nfunc main() {\n    fmt.Println(\"Connecting to Printer...\")\n    p := printer.Connect(\"COM3\", 115200)\n\n    fmt.Println(\"Moving Extruder...\")\n    err := p.SendCommand(\"G28\")\n    err = p.SendCommand(\"G1 Z20\")\n    err = p.SendCommand(\"G1 Y100\")\n    err = p.SendCommand(\"G1 X100\")\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(\"Heating Extruder...\")\n    err = p.SendCommand(\"M109 S100\")\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(\"Cooling Extruder...\")\n    err = p.SendCommand(\"M109 S100\")\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n}\n</code></pre>\n\n<p>EDIT:  This is a Wanhao Duplicator 6.  I can get it to work with Cura and Octoprint so I'm pretty certain the serial communication works, I'm just missing something.</p>\n\n<p>EDIT2:  Even more puzzling is that if I hook up the Arduino IDE and set the serial baud rate to 250000 it spits out garbage to the console.  If I close that and open Cura, let it detect the printer, then close Cura and re-open the console it seems to work ok.</p>\n"}, {"tags": ["go", "visual-studio-code"], "comments": [{"owner": {"reputation": 10461, "user_id": 5173926, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/lcD7f.jpg?s=128&g=1", "display_name": "Vahid Amiri", "link": "https://stackoverflow.com/users/5173926/vahid-amiri"}, "edited": false, "score": 0, "creation_date": 1546144717, "post_id": 53973867, "comment_id": 94788246, "body": "That doesn&#39;t seem like a proper import statement"}], "answers": [{"tags": [], "owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "is_accepted": false, "score": 0, "last_activity_date": 1546147504, "last_edit_date": 1546147504, "creation_date": 1546144661, "answer_id": 53975318, "question_id": 53973867, "link": "https://stackoverflow.com/questions/53973867/golang-local-import-warning-in-visual-studio-code/53975318#53975318", "title": "Golang - local import warning in Visual Studio Code", "body": "<p>This is not a warning this is an error.Your code is not executable you are wrong maybe running a previously compiled version.</p>\n"}, {"comments": [{"owner": {"reputation": 10461, "user_id": 5173926, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/lcD7f.jpg?s=128&g=1", "display_name": "Vahid Amiri", "link": "https://stackoverflow.com/users/5173926/vahid-amiri"}, "edited": false, "score": 0, "creation_date": 1546155645, "post_id": 53975982, "comment_id": 94789545, "body": "Also what&#39;s with <code>ct</code> before the import path?"}, {"owner": {"reputation": 129, "user_id": 8049659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d80e2c967ad7a3887ec441485056cf8?s=128&d=identicon&r=PG&f=1", "display_name": "user8049659", "link": "https://stackoverflow.com/users/8049659/user8049659"}, "edited": false, "score": 0, "creation_date": 1546156439, "post_id": 53975982, "comment_id": 94789687, "body": "<code>ct</code> it&#39;s just an alias"}, {"owner": {"reputation": 129, "user_id": 8049659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d80e2c967ad7a3887ec441485056cf8?s=128&d=identicon&r=PG&f=1", "display_name": "user8049659", "link": "https://stackoverflow.com/users/8049659/user8049659"}, "edited": false, "score": 0, "creation_date": 1546156832, "post_id": 53975982, "comment_id": 94789733, "body": "Yes, I&#39;ve also found that relative imports aren\u2019t allowed in workspace (most commonly $GOPATH/src). But it still works, even with highlited error in the code :)"}], "tags": [], "owner": {"reputation": 10461, "user_id": 5173926, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/lcD7f.jpg?s=128&g=1", "display_name": "Vahid Amiri", "link": "https://stackoverflow.com/users/5173926/vahid-amiri"}, "is_accepted": true, "score": 3, "last_activity_date": 1546155557, "creation_date": 1546155557, "answer_id": 53975982, "question_id": 53973867, "link": "https://stackoverflow.com/questions/53973867/golang-local-import-warning-in-visual-studio-code/53975982#53975982", "title": "Golang - local import warning in Visual Studio Code", "body": "<p>Go doesn't have relative imports. You just can't have that.</p>\n\n<p>Your main application Go file must be at the topmost location in your project repository.</p>\n"}], "owner": {"reputation": 129, "user_id": 8049659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d80e2c967ad7a3887ec441485056cf8?s=128&d=identicon&r=PG&f=1", "display_name": "user8049659", "link": "https://stackoverflow.com/users/8049659/user8049659"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 53975982, "answer_count": 2, "score": 0, "last_activity_date": 1546155557, "creation_date": 1546123056, "last_edit_date": 1546124164, "question_id": 53973867, "link": "https://stackoverflow.com/questions/53973867/golang-local-import-warning-in-visual-studio-code", "title": "Golang - local import warning in Visual Studio Code", "body": "<p>Visual Studio Code warns about local import but the code is still executable.\nWhat is wrong?</p>\n\n<p><a href=\"https://i.stack.imgur.com/dAdxw.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/dAdxw.png\" alt=\"enter image description here\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/pHu33.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/pHu33.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["mongodb", "go", "aggregation-framework", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 862, "user_id": 4780378, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/952ea857b33c627ee944e6e34871d211?s=128&d=identicon&r=PG&f=1", "display_name": "DevAndroid", "link": "https://stackoverflow.com/users/4780378/devandroid"}, "edited": false, "score": 0, "creation_date": 1546123145, "post_id": 53973849, "comment_id": 94785352, "body": "Update in the mgo driver takes 2 parameters (selector and the update). I don&#39;t understand where is the second parameter on your example."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 862, "user_id": 4780378, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/952ea857b33c627ee944e6e34871d211?s=128&d=identicon&r=PG&f=1", "display_name": "DevAndroid", "link": "https://stackoverflow.com/users/4780378/devandroid"}, "edited": false, "score": 0, "creation_date": 1546123186, "post_id": 53973849, "comment_id": 94785356, "body": "@DevAndroid I pass 2 <code>bson.M{}</code> values to <code>Update()</code>. First is the selector, second is the update document."}, {"owner": {"reputation": 862, "user_id": 4780378, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/952ea857b33c627ee944e6e34871d211?s=128&d=identicon&r=PG&f=1", "display_name": "DevAndroid", "link": "https://stackoverflow.com/users/4780378/devandroid"}, "edited": false, "score": 0, "creation_date": 1546123744, "post_id": 53973849, "comment_id": 94785455, "body": "Thank youuu so muuuch.... Why was thinking too complicated ... thank you very much again"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1546123403, "last_edit_date": 1546123403, "creation_date": 1546122837, "answer_id": 53973849, "question_id": 53973755, "link": "https://stackoverflow.com/questions/53973755/increment-specific-value-on-nested-array-in-document-mongodb-mgo-driver/53973849#53973849", "title": "increment specific value on nested array in document mongodb mgo driver", "body": "<p>This is a simple <a href=\"https://godoc.org/github.com/globalsign/mgo#Collection.Update\" rel=\"nofollow noreferrer\"><code>Collection.Update()</code></a> operation, no need to use aggregation for this:</p>\n\n<pre><code>err := c.Update(bson.M{\n    \"pointer\":       knownPointer,\n    \"messages.uuid\": knownUUID,\n}, bson.M{\n    \"$inc\": bson.M{\n        \"messages.$.reportedTimes\": 1,\n    },\n})\n</code></pre>\n\n<p>Here's how to set the parameters to increment the <code>reportedTimes</code> of the first message of your document:</p>\n\n<pre><code>knownPointer := bson.ObjectIdHex(\"5c26844696b72e4b6c9ceee6\")\nknownUUID := \"f03f7977-0b4e-11e9-9f95-144fd7c03810\"\n</code></pre>\n"}], "owner": {"reputation": 862, "user_id": 4780378, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/952ea857b33c627ee944e6e34871d211?s=128&d=identicon&r=PG&f=1", "display_name": "DevAndroid", "link": "https://stackoverflow.com/users/4780378/devandroid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 252, "favorite_count": 0, "accepted_answer_id": 53973849, "answer_count": 1, "score": 1, "last_activity_date": 1546123403, "creation_date": 1546121808, "question_id": 53973755, "link": "https://stackoverflow.com/questions/53973755/increment-specific-value-on-nested-array-in-document-mongodb-mgo-driver", "title": "increment specific value on nested array in document mongodb mgo driver", "body": "<p>Here is my mongo collection in json :</p>\n\n<pre><code>\"messages\" : \n{\n\"_id\" : ObjectId(\"5c26844696b72e4b6c9ceee7\"),\n\"pointer\" : ObjectId(\"5c26844696b72e4b6c9ceee6\"),\n\"messages\" : [ \n   {\n       \"uuid\" : \"f03f7977-0b4e-11e9-9f95-144fd7c03810\",\n       \"content\" : \"Hello\",\n       \"reportedTimes\":0\n   }, \n   {\n       \"uuid\" : \"78bb831d-0b57-11e9-a286-144fd7c03810\",\n       \"content\" : \"Yes\",\n       \"reportedTimes\":0\n   }\n  ]\n}\n</code></pre>\n\n<p>I would like to update the \"reportedTimes\" value from a \"pointer\" and a \"uuid\".\nI tried many aggregations but without result like that one :</p>\n\n<pre><code>pipe := []bson.M{bson.M{\"$match\": bson.M{\"pointer\": knownPointer}}, {\"messages\": bson.M{\"$match\": bson.M{\"uuid\": knownUUID}}}, {\"$inc\": bson.M{\"messages.$.reportedTimes\": 1}}}\n</code></pre>\n\n<p>That one returns that I cannot use \"$inc\"</p>\n\n<p>or that one </p>\n\n<pre><code>pipe := []bson.M{{\"$match\": bson.M{\"pointer\": knownPointer}}, {\"$unwind\": \"$messages\"}, {\"$project\": bson.M{\"uuid\": \"$messages.uuid\", \"reportedTimes\": \"$messages.reportedTimes\"}}, {\"$match\": bson.M{\"uuid\": knownUuid}}} then inc.\n</code></pre>\n\n<p>I even don't find all my attempts queries...\nI'm completely stuck... I also tried with Update(selector, query) but still cannot find the working and efficient way to do it.\nA little help would be appreciated. Thanks all.</p>\n"}, {"tags": ["go", "zeromq"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546114945, "post_id": 53973010, "comment_id": 94783717, "body": "Not related to your question, but you shouldn&#39;t call your methods &quot;thread&quot;. Threads and goroutines <i>are not the same thing</i>. And even more important, <a href=\"https://stackoverflow.com/a/53389196/13860\">functions are no goroutines</a>.  So using a name like &quot;thread&quot; for a function encourages thinking about your code flow in the wrong way."}, {"owner": {"reputation": 313, "user_id": 1780284, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa9c14b84a773b6342eee932e79ee63d?s=128&d=identicon&r=PG", "display_name": "nkt", "link": "https://stackoverflow.com/users/1780284/nkt"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546115925, "post_id": 53973010, "comment_id": 94783980, "body": "Thank you for the feedback"}], "answers": [{"tags": [], "owner": {"reputation": 313, "user_id": 1780284, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa9c14b84a773b6342eee932e79ee63d?s=128&d=identicon&r=PG", "display_name": "nkt", "link": "https://stackoverflow.com/users/1780284/nkt"}, "is_accepted": true, "score": 0, "last_activity_date": 1546181176, "creation_date": 1546181176, "answer_id": 53978576, "question_id": 53973010, "link": "https://stackoverflow.com/questions/53973010/zmq-cant-receive-message-from-multiple-publishers/53978576#53978576", "title": "ZMQ can&#39;t receive message from multiple publishers", "body": "<p>I've figured out the solution. \nXPUB/XSUB should bind to the socket\nPUB and SUB workers should connect to socket</p>\n\n<p>Working code below</p>\n\n<pre><code>package playground\n\nimport (\n    zmq \"github.com/pebbe/zmq4\"\n\n    \"fmt\"\n    \"log\"\n    \"math/rand\"\n    \"testing\"\n    \"time\"\n)\n\nfunc subscriber_thread(id int) {\n    subscriber, err := zmq.NewSocket(zmq.SUB)\n    if err != nil {\n        panic(err)\n    }\n    err = subscriber.Connect(\"tcp://localhost:6001\")\n    if err != nil {\n        panic(err)\n    }\n    err = subscriber.SetSubscribe(\"\")\n    if err != nil {\n        panic(err)\n    }\n    defer subscriber.Close()\n\n    for {\n        msg, err := subscriber.RecvMessage(0)\n        if err != nil {\n            panic(err)\n        }\n        fmt.Println(\"subscriber id:\", id, \"received:\", msg)\n    }\n}\n\nfunc publisher_thread(n int) {\n    publisher, err := zmq.NewSocket(zmq.PUB)\n    if err != nil {\n        panic(err)\n    }\n    //err = publisher.Bind(\"tcp://*:6000\")\n    err = publisher.Connect(\"tcp://localhost:6000\")\n    if err != nil {\n        panic(err)\n    }\n\n    for {\n        s := fmt.Sprintf(\"%c-%05d\", n+'A', rand.Intn(100000))\n        _, err := publisher.SendMessage(s)\n        if err != nil {\n            panic(err)\n        }\n        fmt.Println(\"publisher sent:\", s)\n        time.Sleep(100 * time.Millisecond) //  Wait for 1/10th second\n    }\n}\n\n//  The listener receives all messages flowing through the proxy, on its\n//  pipe. In CZMQ, the pipe is a pair of ZMQ_PAIR sockets that connects\n//  attached child threads. In other languages your mileage may vary:\n\nfunc listener_thread() {\n    pipe, _ := zmq.NewSocket(zmq.PAIR)\n    pipe.Bind(\"inproc://pipe\")\n\n    //  Print everything that arrives on pipe\n    for {\n        msg, err := pipe.RecvMessage(0)\n        if err != nil {\n            break //  Interrupted\n        }\n        fmt.Printf(\"%q\\n\", msg)\n    }\n}\n\nfunc TestZmqEspresso(t *testing.T) {\n    log.SetFlags(log.LstdFlags | log.Lmicroseconds | log.Lshortfile)\n\n    go publisher_thread(0)\n    go publisher_thread(1)\n    go publisher_thread(2)\n\n    go subscriber_thread(1)\n    go subscriber_thread(2)\n\n    go listener_thread()\n\n    time.Sleep(100 * time.Millisecond)\n\n    subscriber, err := zmq.NewSocket(zmq.XSUB)\n    if err != nil {\n        panic(err)\n    }\n    //err = subscriber.Connect(\"tcp://localhost:6000\")\n    err = subscriber.Bind(\"tcp://*:6000\")\n    if err != nil {\n        panic(err)\n    }\n\n    publisher, err := zmq.NewSocket(zmq.XPUB)\n    if err != nil {\n        panic(err)\n    }\n    err = publisher.Bind(\"tcp://*:6001\")\n    if err != nil {\n        panic(err)\n    }\n\n    listener, _ := zmq.NewSocket(zmq.PAIR)\n    listener.Connect(\"inproc://pipe\")\n\n    err = zmq.Proxy(subscriber, publisher, listener)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(\"interrupted\")\n\n}\n</code></pre>\n"}], "owner": {"reputation": 313, "user_id": 1780284, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa9c14b84a773b6342eee932e79ee63d?s=128&d=identicon&r=PG", "display_name": "nkt", "link": "https://stackoverflow.com/users/1780284/nkt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 246, "favorite_count": 0, "accepted_answer_id": 53978576, "answer_count": 1, "score": 0, "last_activity_date": 1546181176, "creation_date": 1546114244, "last_edit_date": 1546114842, "question_id": 53973010, "link": "https://stackoverflow.com/questions/53973010/zmq-cant-receive-message-from-multiple-publishers", "title": "ZMQ can&#39;t receive message from multiple publishers", "body": "<p>I'm implementing the Espresso Pattern of ZMQ.</p>\n\n<p>I want to connect many subscribers &lt;> Proxy &lt;> many publishers</p>\n\n<p>However, the listener in the proxy only receives messages from one publisher. Hence, the subscribers only receive from that particular publisher. \nI can't figure out what's the problem with my code.</p>\n\n<pre><code>package playground\n\nimport (\n    zmq \"github.com/pebbe/zmq4\"\n\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n    \"testing\"\n)\n\nfunc subscriber_thread(id int) {\n    subscriber, _ := zmq.NewSocket(zmq.SUB)\n    subscriber.Connect(\"tcp://localhost:6001\")\n    subscriber.SetSubscribe(\"\")\n    defer subscriber.Close()\n\n    for {\n        msg, err := subscriber.RecvMessage(0)\n        if err != nil {\n            panic(err)\n        }\n        fmt.Println(\"subscriber id:\", id,\"received:\", msg)\n    }\n}\n\nfunc publisher_thread(n int) {\n    publisher, _ := zmq.NewSocket(zmq.PUB)\n    publisher.Bind(\"tcp://*:6000\")\n\n    for {\n        s := fmt.Sprintf(\"%c-%05d\", n +'A', rand.Intn(100000))\n        _, err := publisher.SendMessage(s)\n        if err != nil {\n            panic(err)\n        }\n        fmt.Println(\"publisher sent:\", s)\n        time.Sleep(100 * time.Millisecond) //  Wait for 1/10th second\n    }\n}\n\n//  The listener receives all messages flowing through the proxy, on its\n//  pipe. In CZMQ, the pipe is a pair of ZMQ_PAIR sockets that connects\n//  attached child threads. In other languages your mileage may vary:\n\nfunc listener_thread() {\n    pipe, _ := zmq.NewSocket(zmq.PAIR)\n    pipe.Bind(\"inproc://pipe\")\n\n    //  Print everything that arrives on pipe\n    for {\n        msg, err := pipe.RecvMessage(0)\n        if err != nil {\n            break //  Interrupted\n        }\n        fmt.Printf(\"%q\\n\", msg)\n    }\n}\n\nfunc TestZmqEspresso(t *testing.T) {\n    go publisher_thread(0)\n    go publisher_thread(1)\n    go publisher_thread(2)\n\n    go subscriber_thread(1)\n    go subscriber_thread(2)\n\n    go listener_thread()\n\n    time.Sleep(100 * time.Millisecond)\n\n    subscriber, _ := zmq.NewSocket(zmq.XSUB)\n    subscriber.Connect(\"tcp://localhost:6000\")\n\n    publisher, _ := zmq.NewSocket(zmq.XPUB)\n    publisher.Bind(\"tcp://*:6001\")\n\n    listener, _ := zmq.NewSocket(zmq.PAIR)\n    listener.Connect(\"inproc://pipe\")\n\n    zmq.Proxy(subscriber, publisher, listener)\n\n    fmt.Println(\"interrupted\")\n\n}\n</code></pre>\n"}, {"tags": ["pointers", "go", "append", "slice"], "answers": [{"comments": [{"owner": {"reputation": 111, "user_id": 10412696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/551b0ea14f1f7576f881992998108f3d?s=128&d=identicon&r=PG&f=1", "display_name": "Emanolo78", "link": "https://stackoverflow.com/users/10412696/emanolo78"}, "edited": false, "score": 0, "creation_date": 1546114901, "post_id": 53972453, "comment_id": 94783708, "body": "I made the change and it worked indeed. Thanks a lot for this."}], "tags": [], "owner": {"reputation": 551, "user_id": 10554768, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0874152f77551e2be38904d25e5822e?s=128&d=identicon&r=PG&f=1", "display_name": "robert", "link": "https://stackoverflow.com/users/10554768/robert"}, "is_accepted": false, "score": 1, "last_activity_date": 1546109945, "last_edit_date": 1546109945, "creation_date": 1546109549, "answer_id": 53972453, "question_id": 53972388, "link": "https://stackoverflow.com/questions/53972388/slice-content-erased-after-function-call/53972453#53972453", "title": "Slice content erased after function call", "body": "<p>The method needs to be \"on\" a pointer of your struct, like so:</p>\n\n<pre><code>func (self *mystruct) Foo () {}\n</code></pre>\n\n<p>Otherwise the mystruct object that you call the method on is local only to the function.</p>\n"}, {"tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": false, "score": 1, "last_activity_date": 1546113142, "creation_date": 1546113142, "answer_id": 53972890, "question_id": 53972388, "link": "https://stackoverflow.com/questions/53972388/slice-content-erased-after-function-call/53972890#53972890", "title": "Slice content erased after function call", "body": "<p>In go the receiver of a method (the part between <code>func</code> and the method name) can either be a value receiver as you have or a pointer receiver.  When you have a value receiver a copy of the object is passed to the method so any modifications made remain in that copy.  If you want to modify the object then you must have a pointer receiver as so:</p>\n\n<pre><code>func (self *mystruct) populateslice() {\n</code></pre>\n\n<p>For a wider discussion of which is best in general see here:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/27775376/value-receiver-vs-pointer-receiver-in-golang\">Value receiver vs. Pointer receiver in Golang?</a></p>\n"}], "owner": {"reputation": 111, "user_id": 10412696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/551b0ea14f1f7576f881992998108f3d?s=128&d=identicon&r=PG&f=1", "display_name": "Emanolo78", "link": "https://stackoverflow.com/users/10412696/emanolo78"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "closed_date": 1546117180, "answer_count": 2, "score": -4, "last_activity_date": 1546113142, "creation_date": 1546109118, "question_id": 53972388, "link": "https://stackoverflow.com/questions/53972388/slice-content-erased-after-function-call", "closed_reason": "Duplicate", "title": "Slice content erased after function call", "body": "<p>here is a golang behavior that I am trying to understand and change: I wrote a method to populate a structure with slices in Golang. It works within the method itself, but the slice content gets lost outside of the method. I want however to keep the content. It probably comes from the fact that the pointers inside the slice where deleted at the end of the populateslice method, but how should I write it to prevent this to happen, ie. keep the content in mystruct.myslice after the function call ?</p>\n\n<p>Here is how I wrote the code:</p>\n\n<pre><code>type BBDatacolumn struct {\n  Data []string\n}\n\ntype Mystruct struc {\n   myslice []BBDatacolumn\n}\n\n//Method to populate the slice of the structure mystruct:\nfunc (self mystruct) populateslice() {\n   for i:=0; i&lt;imax; i++ {\n     bufferdatacolumn := NewBBDatacolumn()\n     //Here, code to populate bufferdatacolumns\n\n     self.myslice = append(self.myslice, bufferdatacolumn)\n  }\n\n  self.myslice.display() //Here, works fine: myslice contains the data of the BBDatacolumn correctly\n}\n\n//Later in the code (outside of the populateslice func):\nmystructinstance.populateslice() //Populates slice OK at the end of the function\nmystructinstance.display() //Problem: mystructinstance.myslice is empty: Instanciation of Mystruct does not contain the data in myslice anymore as it did inside the populateslice method\n</code></pre>\n"}, {"tags": ["html", "go"], "answers": [{"tags": [], "owner": {"reputation": 740, "user_id": 2471524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345a080a421b053d124139a0bce7d62e?s=128&d=identicon&r=PG", "display_name": "blobdon", "link": "https://stackoverflow.com/users/2471524/blobdon"}, "is_accepted": false, "score": 0, "last_activity_date": 1546108125, "last_edit_date": 1546108125, "creation_date": 1546107767, "answer_id": 53972226, "question_id": 53971894, "link": "https://stackoverflow.com/questions/53971894/custom-template-functions-not-found-in-html-template/53972226#53972226", "title": "Custom template functions not found in html template", "body": "<p>Add the template functions <strong>before</strong> you parse the templates.</p>\n\n<p>From the <a href=\"https://golang.org/pkg/html/template/#Template.Funcs\" rel=\"nofollow noreferrer\">html/template docs for Funcs()</a>: </p>\n\n<blockquote>\n  <p>Funcs adds the elements of the argument map to the template's function map. It must be called before the template is parsed.</p>\n</blockquote>\n\n<pre><code>funcMap := template.FuncMap{\"test1\":myTest1}\nrt := template.Must(template.New(\"name\").Funcs(funcMap).ParseFiles(\n          fmt.Sprintf(\"%s/%s\", templatesPath, baseLayoutPath),\n          fmt.Sprintf(\"%s/%s\", templatesPath, tplName)))\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10847064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5f61ee8c706d77a036e8eb9e4fedc5e?s=128&d=identicon&r=PG&f=1", "display_name": "Immani", "link": "https://stackoverflow.com/users/10847064/immani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 38, "favorite_count": 0, "closed_date": 1546108593, "answer_count": 1, "score": 0, "last_activity_date": 1546110850, "creation_date": 1546105307, "last_edit_date": 1546110850, "question_id": 53971894, "link": "https://stackoverflow.com/questions/53971894/custom-template-functions-not-found-in-html-template", "closed_reason": "Duplicate", "title": "Custom template functions not found in html template", "body": "<p>I render templates this way:</p>\n\n<pre><code>  func renderTemplate(...........) {\n    rt := template.Must(template.ParseFiles(\n        fmt.Sprintf(\"%s/%s\", templatesPath, baseLayoutPath),\n        fmt.Sprintf(\"%s/%s\", templatesPath, tplName)))\n\n      err := rt.ExecuteTemplate(w, \"base\", nil)\n      //[................]\n  }\n</code></pre>\n\n<p>I want to register a custom function in it:</p>\n\n<pre><code>func myTest1(string s) string {\n  return \"hello: \" + s\n}\n\n\nfunc renderTemplate(...........) {\n  rt := template.Must(template.ParseFiles(\n              fmt.Sprintf(\"%s/%s\", templatesPath, baseLayoutPath),\n              fmt.Sprintf(\"%s/%s\", templatesPath, tplName))).Funcs(template.FuncMap{\"test1\": myTest1})\n</code></pre>\n\n<p>This doesn't work:  <strong>\"test1\" not defined\"</strong></p>\n\n<pre><code>  // html template:\n\n\n  {{range .items}}\n\n    {{.Field1 | test1}}\n</code></pre>\n\n<p>Why not and how to make it work?</p>\n"}, {"tags": ["go", "grpc", "go-cobra"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546098352, "post_id": 53970765, "comment_id": 94779440, "body": "1. Why would it be? Most apps do this. 2. This is a matter of opinion, but if I&#39;m not mistaken viper is meant for configuration management, and a connection pool is definitely not configuration. So it feels a bit like an abuse to me. But that doesn&#39;t mean you should create new connections in each <code>Run</code> function."}, {"owner": {"reputation": 16093, "user_id": 534298, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4ba32c06ed067564a6c6512de5217657?s=128&d=identicon&r=PG", "display_name": "nos", "link": "https://stackoverflow.com/users/534298/nos"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546101000, "post_id": 53970765, "comment_id": 94780159, "body": "Where is a good place to save the connection pool and client?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546101065, "post_id": 53970765, "comment_id": 94780178, "body": "It&#39;s hard to say without seeing your overall architecture, but this is the sort of thing that <a href=\"https://golang.org/pkg/context/\" rel=\"nofollow noreferrer\">context</a> can be used for."}], "owner": {"reputation": 16093, "user_id": 534298, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4ba32c06ed067564a6c6512de5217657?s=128&d=identicon&r=PG", "display_name": "nos", "link": "https://stackoverflow.com/users/534298/nos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 204, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1546096959, "creation_date": 1546096619, "last_edit_date": 1546096959, "question_id": 53970765, "link": "https://stackoverflow.com/questions/53970765/whats-the-proper-way-to-wrap-grpc-client-behind-cobra-command", "title": "What&#39;s the proper way to wrap grpc client behind cobra command?", "body": "<p>I am implementing a GRPC client using cobra. Different service calls are behind the sub-commands. </p>\n\n<p>To avoid code duplication, I keep a single connection and single client in the <code>viper</code> singleton. But I am not sure that's the proper way to do it.</p>\n\n<p>Right now, in <code>cmd/root.go::initConfig()</code>, I create the connection and client and save them.</p>\n\n<pre><code>conn, err := grpc.Dial(address, grpc.WithInsecure())\nif err != nil {\n    log.Fatalf(\"did not connect: %v\", err)\n}\nc := pb.NewCommandClient(conn)\n\nviper.SetDefault(\"Client\", c)\nviper.SetDefault(\"Connection\", conn)\n</code></pre>\n\n<p>The connection is closed in <code>rootCmd.PersistentPostRun()</code>, defined in the same <code>root.go</code> file.</p>\n\n<pre><code>PersistentPostRun: func(cmd *cobra.Command, args []string) {\n    conn := viper.Get(\"Connection\").(*grpc.ClientConn)\n    conn.Close()\n},\n</code></pre>\n\n<p>And the client is retrieved from <code>viper</code> and used in the sub-commands' <code>Run</code> files, for example, </p>\n\n<pre><code>c := viper.Get(\"Client\").(pb.CommandClient)\nc.DoSomething() // call the service functions on c\n</code></pre>\n\n<p>This implementation works but I am not sure it is good practice. Specifically</p>\n\n<ol>\n<li>Is it bad to create the connection in one function and close it in another function?</li>\n<li>Does it make sense to save the client in <code>viper</code> or is it better to create a new one in each sub-command's <code>Run</code> function?</li>\n</ol>\n\n<p>All source code is in <a href=\"https://github.com/nosarthur/telep\" rel=\"nofollow noreferrer\">this repo</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1546090439, "post_id": 53969784, "comment_id": 94777504, "body": "It depends on, what you want... What is the context of your validation? Maybe a framework like Gobuffalo could help you. Do you valdiate, before you write the data into a db? Or do you want to check a dump?"}, {"owner": {"reputation": 956, "user_id": 669493, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/ffb12e2cefed1affc0a049c51fbf85eb?s=128&d=identicon&r=PG", "display_name": "zoonman", "link": "https://stackoverflow.com/users/669493/zoonman"}, "edited": false, "score": 0, "creation_date": 1546106659, "post_id": 53969784, "comment_id": 94781682, "body": "Look for <code>govalidator</code> package."}, {"owner": {"reputation": 364, "user_id": 6173660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/abb2361f859a0ed3e7915135a5379426?s=128&d=identicon&r=PG&f=1", "display_name": "iam thadiyan", "link": "https://stackoverflow.com/users/6173660/iam-thadiyan"}, "reply_to_user": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1546161463, "post_id": 53969784, "comment_id": 94790492, "body": "@apxp I want to validate the data that I received before writing in to a db or send it to some other component. What do you suggest?"}], "answers": [{"comments": [{"owner": {"reputation": 497, "user_id": 4241970, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FyvOa.jpg?s=128&g=1", "display_name": "Rodolfo Leal", "link": "https://stackoverflow.com/users/4241970/rodolfo-leal"}, "edited": false, "score": 1, "creation_date": 1565450259, "post_id": 53970434, "comment_id": 101362749, "body": "Great tip, just curious about the performance trade-offs on using this kind of validation."}], "tags": [], "owner": {"reputation": 1733, "user_id": 10490857, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GA97O.jpg?s=128&g=1", "display_name": "Maxim", "link": "https://stackoverflow.com/users/10490857/maxim"}, "is_accepted": true, "score": 3, "last_activity_date": 1546093801, "creation_date": 1546093801, "answer_id": 53970434, "question_id": 53969784, "link": "https://stackoverflow.com/questions/53969784/how-to-validate-go-object-data-like-javascripts-joi/53970434#53970434", "title": "How to validate Go object data like Javascript&#39;s Joi?", "body": "<p>Try ozzo-validation <a href=\"https://github.com/go-ozzo/ozzo-validation\" rel=\"nofollow noreferrer\">https://github.com/go-ozzo/ozzo-validation</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n\n    \"github.com/go-ozzo/ozzo-validation\"\n    \"github.com/go-ozzo/ozzo-validation/is\"\n)\n\ntype Address struct {\n    Street string\n    City   string\n    State  string\n    Zip    string\n}\n\nfunc (a Address) Validate() error {\n    return validation.ValidateStruct(&amp;a,\n        // Street cannot be empty, and the length must between 5 and 50\n        validation.Field(&amp;a.Street, validation.Required, validation.Length(5, 50)),\n        // City cannot be empty, and the length must between 5 and 50\n        validation.Field(&amp;a.City, validation.Required, validation.Length(5, 50)),\n        // State cannot be empty, and must be a string consisting of two letters in upper case\n        validation.Field(&amp;a.State, validation.Required, validation.Match(regexp.MustCompile(\"^[A-Z]{2}$\"))),\n        // State cannot be empty, and must be a string consisting of five digits\n        validation.Field(&amp;a.Zip, validation.Required, validation.Match(regexp.MustCompile(\"^[0-9]{5}$\"))),\n    )\n}\n\nfunc main() {\n    a := Address{\n        Street: \"123\",\n        City:   \"Unknown\",\n        State:  \"Virginia\",\n        Zip:    \"12345\",\n    }\n\n    err := a.Validate()\n    fmt.Println(err)\n    // Output:\n    // Street: the length must be between 5 and 50; State: must be in a valid format.\n}\n</code></pre>\n"}], "owner": {"reputation": 364, "user_id": 6173660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/abb2361f859a0ed3e7915135a5379426?s=128&d=identicon&r=PG&f=1", "display_name": "iam thadiyan", "link": "https://stackoverflow.com/users/6173660/iam-thadiyan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 600, "favorite_count": 0, "closed_date": 1546095805, "accepted_answer_id": 53970434, "answer_count": 1, "score": 1, "last_activity_date": 1546093801, "creation_date": 1546088635, "question_id": 53969784, "link": "https://stackoverflow.com/questions/53969784/how-to-validate-go-object-data-like-javascripts-joi", "closed_reason": "Not suitable for this site", "title": "How to validate Go object data like Javascript&#39;s Joi?", "body": "<p>I use <a href=\"https://www.npmjs.com/package/joi\" rel=\"nofollow noreferrer\">Joi</a> to do object schema and data validation in JavaScript. In Golang, I know how to do schema validation, but how do I do data validation? </p>\n\n<p>Is there a Joi equivalient for Golang? I am aware of Godog, but it hasn't reached 1.0 yet.</p>\n"}, {"tags": ["go", "rabbitmq"], "comments": [{"owner": {"reputation": 83, "user_id": 10042455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/774a92b6dd16e47424611b8fa32d162d?s=128&d=identicon&r=PG&f=1", "display_name": "Carla", "link": "https://stackoverflow.com/users/10042455/carla"}, "edited": false, "score": 0, "creation_date": 1546086900, "post_id": 53969578, "comment_id": 94776631, "body": "By the way, I&#39;m not getting any errors"}], "answers": [{"comments": [{"owner": {"reputation": 6400, "user_id": 1466825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b420d86764ffe237a2fdc52e28b73f4?s=128&d=identicon&r=PG", "display_name": "Luke Bakken", "link": "https://stackoverflow.com/users/1466825/luke-bakken"}, "edited": false, "score": 0, "creation_date": 1546102380, "post_id": 53969603, "comment_id": 94780512, "body": "If RabbitMQ can&#39;t route a message (as in your case), the message is dropped. I highly recommend going through the RabbitMQ tutorials for Go: <a href=\"https://www.rabbitmq.com/tutorials/tutorial-one-go.html\" rel=\"nofollow noreferrer\">rabbitmq.com/tutorials/tutorial-one-go.html</a>"}], "tags": [], "owner": {"reputation": 10461, "user_id": 5173926, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/lcD7f.jpg?s=128&g=1", "display_name": "Vahid Amiri", "link": "https://stackoverflow.com/users/5173926/vahid-amiri"}, "is_accepted": true, "score": 3, "last_activity_date": 1546087037, "creation_date": 1546087037, "answer_id": 53969603, "question_id": 53969578, "link": "https://stackoverflow.com/questions/53969578/cant-send-messages-from-rabbitmq-with-go/53969603#53969603", "title": "Can&#39;t send messages from RabbitMQ with Go", "body": "<p>The provided code seems fine except that you are using the default exchange and providing a route name different than your queue name.</p>\n\n<p>Chances are you'll want to use the queue name as the routing name. Try to replace <code>hello</code> with <code>user_actions</code> in <code>ch.Publish</code> function.</p>\n"}], "owner": {"reputation": 83, "user_id": 10042455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/774a92b6dd16e47424611b8fa32d162d?s=128&d=identicon&r=PG&f=1", "display_name": "Carla", "link": "https://stackoverflow.com/users/10042455/carla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 53969603, "answer_count": 1, "score": 2, "last_activity_date": 1546087037, "creation_date": 1546086850, "question_id": 53969578, "link": "https://stackoverflow.com/questions/53969578/cant-send-messages-from-rabbitmq-with-go", "title": "Can&#39;t send messages from RabbitMQ with Go", "body": "<p>I just started reading about <code>RabbitMQ</code> and I'm trying to send large number of messages in a for loop. The problem is that it just doesn't work.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/streadway/amqp\"\n    \"strconv\"\n)\n\nfunc main() {\n    var connectionString = \"amqp://guest:guest@localhost:5672/\"\n    conn, _ := amqp.Dial(connectionString)\n    defer conn.Close()\n\n    ch, _ := conn.Channel()\n    defer ch.Close()\n\n    q, _ := ch.QueueDeclare(\n        \"user_actions\", // name\n        true,   // durable\n        false,   // delete when unused\n        false,   // exclusive\n        false,   // no-wait\n        nil,     // arguments\n    )\n\n    for i := 0; i &lt; 10000; i++ {\n        body := \"Hello from Go! \" + strconv.Itoa(i)\n        ch.Publish(\n            \"\",     // exchange\n            \"hello\", // routing key\n            false,  // mandatory\n            false,  // immediate\n            amqp.Publishing {\n                ContentType: \"text/plain\",\n                Body:        []byte(body),\n            })\n        fmt.Println(\"Sent: \"+body)\n    }\n\n}\n</code></pre>\n\n<p>I even tried reducing the number of iterations and even tried sending messages outside of the loop but it just doesn't work. What am I doing wrong?</p>\n"}, {"tags": ["google-app-engine", "go", "testing", "gopath"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1546084588, "post_id": 53969253, "comment_id": 94776136, "body": "Your GOPATH is simply wrong. It should probably be just &quot;/home/mohammad/go&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 3, "last_activity_date": 1546088777, "creation_date": 1546088777, "answer_id": 53969804, "question_id": 53969253, "link": "https://stackoverflow.com/questions/53969253/goapp-test-not-working-getting-error-gopath-must-be-absolute-while-it-is-absol/53969804#53969804", "title": "goapp test not working,getting error &quot;GOPATH must be absolute&quot; while it is absolute", "body": "<pre><code>GOPATH=\":/home/mohammad/go:/home/mohammad/go/src/gitlab.com/gc-auth\"\n</code></pre>\n\n<p>The GOPATH starts with an empty path (which is technically relative), followed by two absolute paths. The error message is correct.</p>\n"}], "owner": {"reputation": 11, "user_id": 7308287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/effa0974ea7e8e68b7cee751578f0671?s=128&d=identicon&r=PG&f=1", "display_name": "Mohi_k", "link": "https://stackoverflow.com/users/7308287/mohi-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 53969804, "answer_count": 1, "score": -1, "last_activity_date": 1547202462, "creation_date": 1546084344, "last_edit_date": 1547202462, "question_id": 53969253, "link": "https://stackoverflow.com/questions/53969253/goapp-test-not-working-getting-error-gopath-must-be-absolute-while-it-is-absol", "title": "goapp test not working,getting error &quot;GOPATH must be absolute&quot; while it is absolute", "body": "<p>I'm tying to write tests for my google cloud app. I read the documents and it seems the only way to run the test locally is the running the command <code>goapp test</code> in the test package directory. But when I run the command I get the error <code>go: GOPATH entry is relative; must be absolute path: \"\".</code></p>\n\n<p>I'm pretty sure my GOPATH is set absolutely. Here are the results when I run the command <code>go env | grep GOPATH</code>:</p>\n\n<p><code>GOPATH=\":/home/mohammad/go:/home/mohammad/go/src/gitlab.com/gc-auth\"</code></p>\n\n<p>Also getting the same output when I run <code>echo $GOPATH</code>.</p>\n\n<p>Any help is appreciated.</p>\n\n<p>PS: I have ubuntu 18.04 and my go version is 1.10.4</p>\n\n<p>results of <code>gcloud version</code>:</p>\n\n<p><code>Google Cloud SDK 228.0.0\napp-engine-go \napp-engine-python 1.9.80\nbq 2.0.39\ncloud-datastore-emulator 2.0.2\ncore 2018.12.07\ngsutil 4.34\n</code></p>\n"}, {"tags": ["go", "reflection", "protocol-buffers"], "answers": [{"comments": [{"owner": {"reputation": 301, "user_id": 5286435, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2c377241bb619c9254d07897baaa86a8?s=128&d=identicon&r=PG&f=1", "display_name": "Dnj Abc", "link": "https://stackoverflow.com/users/5286435/dnj-abc"}, "edited": false, "score": 0, "creation_date": 1588405616, "post_id": 53968967, "comment_id": 108886157, "body": "I looked at your example. In your model file message.pb.go, which I assume is the generated file. I see two &#39;init&#39; functions which register your type and register a file. The string the registerType call is the same as your messageType. That&#39;s not there in my generated code. Is there some option I need to pass to protoc when I build the .proto file?"}, {"owner": {"reputation": 1252, "user_id": 643123, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/733415901/picture?type=large", "display_name": "Rotem Tamir", "link": "https://stackoverflow.com/users/643123/rotem-tamir"}, "reply_to_user": {"reputation": 301, "user_id": 5286435, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2c377241bb619c9254d07897baaa86a8?s=128&d=identicon&r=PG&f=1", "display_name": "Dnj Abc", "link": "https://stackoverflow.com/users/5286435/dnj-abc"}, "edited": false, "score": 0, "creation_date": 1589299608, "post_id": 53968967, "comment_id": 109235943, "body": "@DnjAbc - nothing special, as you can see in <a href=\"https://github.com/rotemtam/pbreflect-example/blob/master/gen-proto.sh\" rel=\"nofollow noreferrer\">github.com/rotemtam/pbreflect-example/blob/master/gen-proto.&zwnj;&#8203;sh</a> there are no special flags. the go team did blog about a new proto API, so you might be hitting that: <a href=\"https://blog.golang.org/protobuf-apiv2\" rel=\"nofollow noreferrer\">blog.golang.org/protobuf-apiv2</a>"}], "tags": [], "owner": {"reputation": 1252, "user_id": 643123, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/733415901/picture?type=large", "display_name": "Rotem Tamir", "link": "https://stackoverflow.com/users/643123/rotem-tamir"}, "is_accepted": true, "score": 2, "last_activity_date": 1546081660, "creation_date": 1546081660, "answer_id": 53968967, "question_id": 53968966, "link": "https://stackoverflow.com/questions/53968966/how-to-parse-a-protobuf3-message-without-knowing-its-type-at-compile-time-with-g/53968967#53968967", "title": "how to parse a protobuf3 message without knowing its type at compile time with golang?", "body": "<p>golang proto libraries have a helper utility for this purpose:</p>\n\n<pre><code>// MessageType returns the message type (pointer to struct) for a named message.\n// The type is not guaranteed to implement proto.Message if the name refers to a\n// map entry.\nfunc MessageType(name string) reflect.Type {\n   // ....\n}\n</code></pre>\n\n<p>to use it you can use a method similar to this:</p>\n\n<pre><code>func getProto(messageType string, messageBytes []byte) proto.Message {\n    pbtype := proto.MessageType(messageType)\n    msg := reflect.New(pbtype.Elem()).Interface().(proto.Message)\n    proto.Unmarshal(messageBytes, msg)\n    return msg\n}\n</code></pre>\n\n<p>i have put a full example of this on github: \n<a href=\"https://github.com/rotemtam/pbreflect-example\" rel=\"nofollow noreferrer\">https://github.com/rotemtam/pbreflect-example</a></p>\n"}], "owner": {"reputation": 1252, "user_id": 643123, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/733415901/picture?type=large", "display_name": "Rotem Tamir", "link": "https://stackoverflow.com/users/643123/rotem-tamir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1102, "favorite_count": 0, "accepted_answer_id": 53968967, "answer_count": 1, "score": 1, "last_activity_date": 1546081660, "creation_date": 1546081660, "question_id": 53968966, "link": "https://stackoverflow.com/questions/53968966/how-to-parse-a-protobuf3-message-without-knowing-its-type-at-compile-time-with-g", "title": "how to parse a protobuf3 message without knowing its type at compile time with golang?", "body": "<p>here's a scenario:</p>\n\n<p>you're implementing in golang a generic component that can may be used with any type of proto message (binary serialization) and need to deserialize binary proto data without knowing its type at compile time.</p>\n\n<p>for instance, i encountered this issue while writing a generic kafka json archiver, the component would:</p>\n\n<ul>\n<li>receive a message type (string) from configuration and a name of a kafka topic </li>\n<li>would need to create the binary -> memory deserializer and the memory -> json serializer at runtime. </li>\n</ul>\n\n<p>how do you get a deserializer for your binary bytes just from the message name? </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 29, "user_id": 10245449, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adb155aa80e00db094f39e7232285924?s=128&d=identicon&r=PG&f=1", "display_name": "Andrei B", "link": "https://stackoverflow.com/users/10245449/andrei-b"}, "edited": false, "score": 0, "creation_date": 1546081712, "post_id": 53968953, "comment_id": 94775531, "body": "Yep, I am dumb. Thanks! :))"}, {"owner": {"reputation": 186, "user_id": 9380981, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3ZIP4.jpg?s=128&g=1", "display_name": "Flightdoc5242", "link": "https://stackoverflow.com/users/9380981/flightdoc5242"}, "reply_to_user": {"reputation": 29, "user_id": 10245449, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adb155aa80e00db094f39e7232285924?s=128&d=identicon&r=PG&f=1", "display_name": "Andrei B", "link": "https://stackoverflow.com/users/10245449/andrei-b"}, "edited": false, "score": 1, "creation_date": 1546081800, "post_id": 53968953, "comment_id": 94775556, "body": "@AndreiB  you\u2019re not dumb, your just new. I\u2019ve been programming for 17 years and still make mistakes and google-fu everyday. !   Hang in there"}, {"owner": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 0, "creation_date": 1546084882, "post_id": 53968953, "comment_id": 94776195, "body": "The day we programmers stop making programming mistakes is the day we stop programming :)"}, {"owner": {"reputation": 29, "user_id": 10245449, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adb155aa80e00db094f39e7232285924?s=128&d=identicon&r=PG&f=1", "display_name": "Andrei B", "link": "https://stackoverflow.com/users/10245449/andrei-b"}, "edited": false, "score": 0, "creation_date": 1546156009, "post_id": 53968953, "comment_id": 94789609, "body": "Wow...I didn&#39;t expect such kind words."}], "tags": [], "owner": {"reputation": 186, "user_id": 9380981, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3ZIP4.jpg?s=128&g=1", "display_name": "Flightdoc5242", "link": "https://stackoverflow.com/users/9380981/flightdoc5242"}, "is_accepted": false, "score": 5, "last_activity_date": 1546081509, "creation_date": 1546081509, "answer_id": 53968953, "question_id": 53968923, "link": "https://stackoverflow.com/questions/53968923/operator-in-go-lang/53968953#53968953", "title": "&lt; operator in Go lang", "body": "<p>Because <code>&lt;</code> is not the same as \u201cequal to\u201d.  Try changing your operators to <code>&lt;=</code>. This should fire only if your value is less than OR equal to 0</p>\n"}], "owner": {"reputation": 29, "user_id": 10245449, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adb155aa80e00db094f39e7232285924?s=128&d=identicon&r=PG&f=1", "display_name": "Andrei B", "link": "https://stackoverflow.com/users/10245449/andrei-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "closed_date": 1546178891, "answer_count": 1, "score": -5, "last_activity_date": 1546081677, "creation_date": 1546081255, "question_id": 53968923, "link": "https://stackoverflow.com/questions/53968923/operator-in-go-lang", "closed_reason": "Not suitable for this site", "title": "&lt; operator in Go lang", "body": "<p>Well I am a newby in Go lang, but this doesn't make sense to me:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n)\n\nvar rectLen, rectWidth float64 = 0, 0\n\nfunc init() {\n    fmt.Println(\"init is initialized\")\n    if rectLen &lt; 0 {\n        log.Fatal(\"rectLen smaller than 0\")\n    }\n    if rectWidth &lt; 0 {\n        log.Fatal(\"rectWidht smaller than 0\")\n    }\n}\n\nfunc main() {\n    fmt.Println(\"Main is initialized\")\n    fmt.Println(rectLen, rectWidth )\n}\n</code></pre>\n\n<p>This will print out:</p>\n\n<pre><code>init is initialized\nMain is initialized\n0 0\n</code></pre>\n\n<p>Why is 0 and 0 printed out when my init function is \"guarding\" that my rectLen, rectWidth variables should be strictly greater than 0?\nIf I change the values to something less than 0, it works fine, I get: </p>\n\n<pre><code>init is initialized\n2009/11/10 23:00:00 rectLen smaller than 0 \n</code></pre>\n\n<p>Thanks!</p>\n"}, {"tags": ["docker", "go", "docker-compose"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546080869, "post_id": 53968762, "comment_id": 94775360, "body": "And what is the contents of your <code>lenitivo-server&#47;services&#47;configuration&#47;api</code> directory?"}, {"owner": {"reputation": 481, "user_id": 2851925, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UNPm3.jpg?s=128&g=1", "display_name": "Celal Yildirim", "link": "https://stackoverflow.com/users/2851925/celal-yildirim"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546081165, "post_id": 53968762, "comment_id": 94775420, "body": "@Flimzy There is a only one file which is main.go"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546081243, "post_id": 53968762, "comment_id": 94775442, "body": "What happens if you issue the command <code>docker make .&#47;services&#47;configuration&#47;Dockerfile</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 481, "user_id": 2851925, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UNPm3.jpg?s=128&g=1", "display_name": "Celal Yildirim", "link": "https://stackoverflow.com/users/2851925/celal-yildirim"}, "edited": false, "score": 0, "creation_date": 1546106316, "post_id": 53969388, "comment_id": 94781585, "body": "I understand, when i changed with &quot;context: services/configuration&quot;, it worked ! You&#39; re also right. I runned &quot;cd $GOPATH/src/project-name/services/configuration docker build .&quot; Thanks for your helping."}], "tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": true, "score": 4, "last_activity_date": 1546085432, "creation_date": 1546085432, "answer_id": 53969388, "question_id": 53968762, "link": "https://stackoverflow.com/questions/53968762/no-go-files-in-error-when-i-use-go-with-docker-compose/53969388#53969388", "title": "&quot;No Go files in...&quot; error when i use go with docker compose", "body": "<p>In your Dockerfile, you say</p>\n\n<pre><code>ADD . /go/src/project-name/services/configuration\n</code></pre>\n\n<p>which expects the build context directory on the host to contain the source files.  But your <code>docker-compose.yml</code> file says</p>\n\n<pre><code>build:\n    context: .\n    dockerfile: services/configuration/Dockerfile    \n</code></pre>\n\n<p>where the context directory is the root of your source control tree, not the specific Go source directory you're trying to build.  If you change this to</p>\n\n<pre><code>build:\n    context: services/configuration\n    # Default value of \"dockerfile: Dockerfile\" will be right\n</code></pre>\n\n<p>it will likely work better.</p>\n\n<p>In plain Docker commands, your current <code>docker-compose.yml</code> file says the equivalent of</p>\n\n<pre><code>cd $GOPATH/src/project-name\ndocker build -f services/configuration/Dockerfile .\n</code></pre>\n\n<p>But you're probably actually running</p>\n\n<pre><code>cd $GOPATH/src/project-name/services/configuration\ndocker build .\n</code></pre>\n\n<p>and what directory is the current directory matters.</p>\n"}], "owner": {"reputation": 481, "user_id": 2851925, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UNPm3.jpg?s=128&g=1", "display_name": "Celal Yildirim", "link": "https://stackoverflow.com/users/2851925/celal-yildirim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4695, "favorite_count": 0, "accepted_answer_id": 53969388, "answer_count": 1, "score": 2, "last_activity_date": 1546105955, "creation_date": 1546079924, "last_edit_date": 1546105955, "question_id": 53968762, "link": "https://stackoverflow.com/questions/53968762/no-go-files-in-error-when-i-use-go-with-docker-compose", "title": "&quot;No Go files in...&quot; error when i use go with docker compose", "body": "<p>I installed Go on Ubuntu 16.04. This is my GOPATH=/home/{username}/work.</p>\n\n<p>I created a project into /home/{username}/work/src.</p>\n\n<p>This is my project folder hierarchy.</p>\n\n<pre><code>project-name\n   services\n       configuration\n           api\n               main.go\n           Dockerfile\n       bff\n           api\n               main.go\n           Dockerfile\n   docker-compose.yml\n   favicon.ico\n   README.md\n</code></pre>\n\n<p>I can build and run with my dockerfile but I can't build and up with docker-compose.</p>\n\n<p>I couldn't find any solution.</p>\n\n<p>Configuration service dockerfile:</p>\n\n<pre><code>FROM golang:1.11.1-alpine3.8 as builder\n\nRUN apk update &amp;&amp; apk add git &amp;&amp; go get gopkg.in/natefinch/lumberjack.v2\n\nRUN mkdir -p /go/src/project-name/services/configuration\nRUN CGO_ENABLED=0\nRUN GOOS=linux\nADD . /go/src/project-name/services/configuration\nENV GOPATH /go\nWORKDIR /go/src/project-name/services/configuration/api\nRUN go get\nRUN go build\n\nFROM alpine\nRUN apk update\nRUN apk add curl\n\nRUN mkdir -p /app\nCOPY --from=builder /go/src/project-name/services/configuration/api/ /app/\nRUN chmod +x /app/api\nWORKDIR /app\nEXPOSE 5001\nENTRYPOINT [\"/app/api\"]\n</code></pre>\n\n<p>It works with dockerfile.</p>\n\n<p>This is my docker-compose file:</p>\n\n<pre><code>version: '3.4'\n\nservices:\n   bff:\n      image: project-name/bff:${TAG:-latest}\n      build:\n           context: .\n           dockerfile: services/bff/Dockerfile\n      ports:\n          - \"5000:5000\"\n      container_name: bff \n      depends_on:\n         - configuration\n\n   configuration:\n       image: project-name/configuration:${TAG:-latest}\n       build:\n            context: .\n            dockerfile: services/configuration/Dockerfile    \n       ports:\n            - \"5001:5001\"\n       container_name: configuration\n</code></pre>\n\n<p>It didn't work.</p>\n\n<p>When the \u201crun go get\u201d command runs, it gives an error, the error is: </p>\n\n<pre><code> can't load package: package project-name/services/configuration/api: no Go files in /go/src/project-name/services/configuration/api\n ERROR: Service 'configuration' failed to build: The command '/bin/sh -c go get' returned a non-zero code: 1\n</code></pre>\n"}, {"tags": ["c", "go", "binding", "shared-libraries", "wrapper"], "answers": [{"tags": [], "owner": {"reputation": 718, "user_id": 2175501, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f8c6d46b0dc27772e58a8bbebe14db64?s=128&d=identicon&r=PG", "display_name": "Alexander Aleksandrovi\u010d Klimov", "link": "https://stackoverflow.com/users/2175501/alexander-aleksandrovi%c4%8d-klimov"}, "is_accepted": true, "score": 0, "last_activity_date": 1546105274, "creation_date": 1546105274, "answer_id": 53971889, "question_id": 53968562, "link": "https://stackoverflow.com/questions/53968562/golang-c-bindings-type-design/53971889#53971889", "title": "Golang C bindings type design", "body": "<p>The second example clearly shows a data structure not accessible from other packages.</p>\n\n<p>With the first one this would be impossible.</p>\n"}], "owner": {"reputation": 718, "user_id": 2175501, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f8c6d46b0dc27772e58a8bbebe14db64?s=128&d=identicon&r=PG", "display_name": "Alexander Aleksandrovi\u010d Klimov", "link": "https://stackoverflow.com/users/2175501/alexander-aleksandrovi%c4%8d-klimov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "closed_date": 1546404077, "accepted_answer_id": 53971889, "answer_count": 1, "score": -2, "last_activity_date": 1546105274, "creation_date": 1546078053, "question_id": 53968562, "link": "https://stackoverflow.com/questions/53968562/golang-c-bindings-type-design", "closed_reason": "Opinion-based", "title": "Golang C bindings type design", "body": "<pre><code>type Foobar C.struct_foobar\n</code></pre>\n\n<p>vs.</p>\n\n<pre><code>type Foobar struct {\n    foobar C.struct_foobar\n}\n</code></pre>\n\n<p>Which one has which (dis)advantages for writing Golang bindings for a C lib?</p>\n"}, {"tags": ["pointers", "go", "struct"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1546073561, "post_id": 53967792, "comment_id": 94773713, "body": "In the linked code your methods are returning concrete, ie non-pointer, struct values and also nowhere in the code are you returning <code>nil</code> or setting pointers to <code>nil</code>. So this <code>parent.child.method(child) -&gt; [parent becomes nil]</code> <i>cannot</i> happen in the provided code. Please try to better explain what you mean by <i>&quot;parent reference on the subsequent call gets lost&quot;</i>. Also note that if you have a method <code>M</code> that returns its receiver, calling <code>a.b.M(c)</code> will return <code>b</code> and <i>not</i> <code>a</code>. ie. <code>parent.Left.determineSide(child)</code> will return <code>Left</code> as the parent."}, {"owner": {"reputation": 852, "user_id": 1690719, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/vqwMX.png?s=128&g=1", "display_name": "lindsay", "link": "https://stackoverflow.com/users/1690719/lindsay"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546077018, "post_id": 53967792, "comment_id": 94774484, "body": "Hey thanks for responding @mkopriva. So the last part of your comment captures the intended behaviour. Think of the function as a walk through a connected series of items (i.e. a graph, linked list, etc.). As you may have already imagined, as we go through the connected items we want the each check to be performed on the node we are visiting. For example, if we have already checked A, we want to then move onto site B. If B has a connected C we want to then check that. In my code, when we move from A to B, for whatever reason B comes a nil and then we cannot check for C."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546078829, "post_id": 53967792, "comment_id": 94774889, "body": "As mentioned in the first comment, your code does not seem to be setting anything to nil therefore nothing can &quot;become nil&quot; by itself, it has to be nil from the get go. ie B doesn&#39;t become nil, it is nil from the beginning, whatever that B is. Please include the code that is actually printing out the output. Show how you&#39;re using the <code>node</code> package."}, {"owner": {"reputation": 852, "user_id": 1690719, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/vqwMX.png?s=128&g=1", "display_name": "lindsay", "link": "https://stackoverflow.com/users/1690719/lindsay"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546079401, "post_id": 53967792, "comment_id": 94775023, "body": "The issue is due to a type check error. The implementation of isNode is incorrectly implemented so when the type check unintentionally returns true, the subsequent call is accessing a nil memory address."}], "answers": [{"comments": [{"owner": {"reputation": 852, "user_id": 1690719, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/vqwMX.png?s=128&g=1", "display_name": "lindsay", "link": "https://stackoverflow.com/users/1690719/lindsay"}, "edited": false, "score": 0, "creation_date": 1546077217, "post_id": 53967983, "comment_id": 94774529, "body": "Hey @Bob Fred thanks for checking out some of the other code. This is good to know but I think you might have addressed a different problem. I&#39;ll try rephrase - i think i posed a bad question. What I&#39;m attempting to solve is why when walking through a connected series of linked structs that when moving from say A to B, B becomes nil."}, {"owner": {"reputation": 852, "user_id": 1690719, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/vqwMX.png?s=128&g=1", "display_name": "lindsay", "link": "https://stackoverflow.com/users/1690719/lindsay"}, "edited": false, "score": 0, "creation_date": 1546078286, "post_id": 53967983, "comment_id": 94774774, "body": "Just liked to follow on from that- thank you for fixing that up for me :)"}], "tags": [], "owner": {"reputation": 201, "user_id": 10814080, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-IHSUhxzo9Fs/AAAAAAAAAAI/AAAAAAAAAA8/RCIP5dhhB4A/photo.jpg?sz=128", "display_name": "Bob Fred", "link": "https://stackoverflow.com/users/10814080/bob-fred"}, "is_accepted": true, "score": 1, "last_activity_date": 1546079219, "last_edit_date": 1546079219, "creation_date": 1546072432, "answer_id": 53967983, "question_id": 53967792, "link": "https://stackoverflow.com/questions/53967792/golang-struct-pointer-reference-lost-when-calling-struct-property-method/53967983#53967983", "title": "Golang struct pointer reference lost when calling struct property method", "body": "<p>Okay\uff0c I know what u'r exactly asking finally.</p>\n\n<p><code>New()</code>  methods returns a value, not a pointer, which means u can't see later change in caller. What the caller got is only a value copy of the Node. So the parent what u print will always be <code>{Left:&lt;nil&gt; Right:&lt;nil&gt; Value:2}</code>.</p>\n\n<p>So the same with <code>addLeftNode()</code> and <code>addRightNode()</code>.</p>\n\n<p>Just use pointer, not value to achieve your goal.</p>\n\n<p>See <a href=\"https://golang.org/doc/effective_go.html#pointers_vs_values\" rel=\"nofollow noreferrer\">pointers_vs_values</a></p>\n\n<hr>\n\n<p>I think it's just the <code>Visit()</code> method where the problem is. </p>\n\n<ol>\n<li>It will never visit right child when u immediately return after visited left child.</li>\n<li>The left and right child are not mutually exclusive, so the second if-clause should not use <code>else if</code>, which would be <code>if</code>.</li>\n<li>The visiting order also has problem.</li>\n</ol>\n\n<p>Before:</p>\n\n<pre><code>// Visit will automatically walk through the Child Nodes of the accessed Parent Node.\nfunc (parent *Node) Visit() (Node, int) {\n    fmt.Println(\"Node value:\", parent.Value)\n    if parent.hasLeftNode() {\n        return parent.Left.Visit()\n    } else if parent.hasRightNode() {\n        return parent.Right.Visit()\n    }\n    return *parent, parent.Value\n}\n</code></pre>\n\n<p>Modified:</p>\n\n<pre><code>// Visit will automatically walk through the Child Nodes of the accessed Parent Node.\nfunc (parent *Node) Visit() (Node, int) {\n    if parent.hasLeftNode() {\n        parent.Left.Visit()\n    }\n    fmt.Println(\"Node value:\", parent.Value)\n    if parent.hasRightNode() {\n        parent.Right.Visit()\n    }\n    return *parent, parent.Value\n}\n</code></pre>\n\n<p>Additionally, as to me, <code>Visit()</code> shouldn't return any values. </p>\n"}, {"tags": [], "owner": {"reputation": 852, "user_id": 1690719, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/vqwMX.png?s=128&g=1", "display_name": "lindsay", "link": "https://stackoverflow.com/users/1690719/lindsay"}, "is_accepted": false, "score": 0, "last_activity_date": 1546080133, "creation_date": 1546080133, "answer_id": 53968790, "question_id": 53967792, "link": "https://stackoverflow.com/questions/53967792/golang-struct-pointer-reference-lost-when-calling-struct-property-method/53968790#53968790", "title": "Golang struct pointer reference lost when calling struct property method", "body": "<p>Problem originated from incorrect type checking. The function successfully handled the call, but the method I was using wasn't accurate in confirming whether a node was assigned. </p>\n\n<pre><code>// isNode checks whether the provided property is a Node.\nfunc (parent *Node) isNode(property interface{}, typeset interface{}) bool {\n\n   fmt.Println(reflect.TypeOf(property) == reflect.TypeOf(typeset))\n   // this always referred to the address for the base Node struct or similar falsy.\n   return reflect.TypeOf(property) == reflect.TypeOf(typeset)\n}\n\n// hasLeftSide tests whether the Parent Node has a Node assigned to its left side.\nfunc (parent *Node) hasLeftNode() bool {\n    return parent.Left != nil //parent.isNode(parent.Left, (*Node)(nil))\n}\n\n// hasRightSide tests whether the Parent Node has a Node assigned to its right side.\nfunc (parent *Node) hasRightNode() bool {\n    return parent.Right != nil // parent.isNode(parent.Right, (*Node)(nil))\n}\n</code></pre>\n"}], "owner": {"reputation": 852, "user_id": 1690719, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/vqwMX.png?s=128&g=1", "display_name": "lindsay", "link": "https://stackoverflow.com/users/1690719/lindsay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 498, "favorite_count": 0, "accepted_answer_id": 53967983, "answer_count": 2, "score": -2, "last_activity_date": 1546080133, "creation_date": 1546070591, "last_edit_date": 1546079159, "question_id": 53967792, "link": "https://stackoverflow.com/questions/53967792/golang-struct-pointer-reference-lost-when-calling-struct-property-method", "title": "Golang struct pointer reference lost when calling struct property method", "body": "<p>I'm attempting to use a <code>struct</code> to manage accessing nodes on a tree. Whenever I access the method of the parent's child node, the parent reference on the subsequent call gets lost (i.e. <code>parent.child.method(child) -&gt; [parent becomes nil]-&gt; parent(the previous child).child ... etc</code>).</p>\n\n<p>Here is the error snippet from my file.</p>\n\n<pre><code>type Node struct {\n    Left *Node\n    Right *Node\n    value int\n}\n\nfunc (parent *Node) determineSide(child *Node) (Node, Node) {\n\n    if child.Value &lt; parent.Value {\n        if parent.hasLeftNode() {\n            return parent.Left.determineSide(child)\n        }\n        return parent.addLeftNode(child)\n\n    } else if child.Value &gt; parent.Value {\n        if parent.hasRightNode() {\n           return parent.Right.determineSide(child)\n        }\n        return parent.addRightNode(child)\n    }\n    return *child, *parent\n }\n</code></pre>\n\n<p>I attempted to solve this by trying to find a way to inform the method that the new reference should be <code>parent.Left</code>. Things like using <code>*parent.Left</code> and <code>&amp;parent.Left</code> didn't seem to be correct.</p>\n\n<p>A solution may might be to move this code outside of the <code>struct</code> and have another function handle the outcome for a quick fix, but I'd like to understand why this isn't working out of the box. Thought process here is influenced by using <code>this.child.determineSide(child)</code>.</p>\n\n<p>Full code is <a href=\"https://github.com/gellel/binarygo/blob/master/node/node.go\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>Here is some output from the terminal that might give even further context. Looks like I'm having a check type issue leading to the problem.</p>\n\n<pre><code>parent &amp;{&lt;nil&gt; &lt;nil&gt; 2}\nparent.Left &lt;nil&gt;\nparent.LeftNode true\nchild &amp;{&lt;nil&gt; &lt;nil&gt; 1}\nparent &lt;nil&gt;\nchild &amp;{&lt;nil&gt; &lt;nil&gt; 1}\n</code></pre>\n"}, {"tags": ["docker", "go", "go-agent", "goa"], "answers": [{"tags": [], "owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "is_accepted": true, "score": 0, "last_activity_date": 1546083881, "creation_date": 1546083881, "answer_id": 53969205, "question_id": 53967441, "link": "https://stackoverflow.com/questions/53967441/how-to-configure-docker-containers-proxy/53969205#53969205", "title": "how to configure docker containers proxy?", "body": "<p>You need version 17.07 or more recent to automatically pass the proxy to containers you start using the config.json file. The 1.13 releases are long out of support.</p>\n\n<p>This is well documented from docker:\n<a href=\"https://docs.docker.com/network/proxy/\" rel=\"nofollow noreferrer\">https://docs.docker.com/network/proxy/</a></p>\n"}], "owner": {"reputation": 49, "user_id": 5710704, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-EijVc0CEHdU/AAAAAAAAAAI/AAAAAAAAABU/FD9MarF_wbM/photo.jpg?sz=128", "display_name": "shequeen Qin", "link": "https://stackoverflow.com/users/5710704/shequeen-qin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3163, "favorite_count": 0, "accepted_answer_id": 53969205, "answer_count": 1, "score": 0, "last_activity_date": 1546083881, "creation_date": 1546066905, "last_edit_date": 1546082878, "question_id": 53967441, "link": "https://stackoverflow.com/questions/53967441/how-to-configure-docker-containers-proxy", "title": "how to configure docker containers proxy?", "body": "<p>how to configure docker containers proxy ? </p>\n\n<p>First of all, </p>\n\n<p>I tried to use the way that setted '/etc/systemd/system/docker.service.d/http-proxy.conf' (<a href=\"https://docs.docker.com/config/daemon/systemd/#httphttps-proxy\" rel=\"nofollow noreferrer\">https://docs.docker.com/config/daemon/systemd/#httphttps-proxy</a>) and it really works for docker daemon, but it doesn't work for docker containers, it seems this way just take effect for some command like 'docker pull' </p>\n\n<p>Secondary,</p>\n\n<p>I have a lot of docker containers, I don't want to use 'docker run -e http_proxy=xxx... ' command every time when I start a container.</p>\n\n<p>So I guess if there is such a way automatically load the global configuration file when the container starts, I googled it and got it to set the file '~/.docker/config.json'(<a href=\"https://stackoverflow.com/questions/47827496/how-to-configure-docker-container-proxy).Unfortunately\">How to configure docker container proxy?</a>, this way still does not work for me.</p>\n\n<p>(\n  my host machine system is centos7, here is my docker -v:\n     Docker version 1.13.1, build 6e3bb8e/1.13.1\n)</p>\n\n<p>I feel that it may be related to my docker version or the docker started by the systemd service, so ~/.docker/config.json does not take effect.</p>\n\n<p>Finally , </p>\n\n<p>I just hope that modifying configuration files will allow all my containers to automatically configure environment variables when it start (that is auto set environment variables 'http_proxy=<a href=\"http://HostIP:8118\" rel=\"nofollow noreferrer\">http://HostIP:8118</a> https_proxy=<a href=\"http://HostIP:8118\" rel=\"nofollow noreferrer\">http://HostIP:8118</a>' when a container start, like Dockerfile param ENV) . I want to know if there is such a way? And if this way can be realised I can make the container use the host's proxy, after all, my host's agent is working properly.</p>\n\n<p>But I was wrong, I tried to run a container,then set http_proxy=<a href=\"http://HostIP:8118\" rel=\"nofollow noreferrer\">http://HostIP:8118</a> and https_proxy=<a href=\"http://HostIP:8118\" rel=\"nofollow noreferrer\">http://HostIP:8118</a>, but when I use the command 'wget facebook.com' and I got 'Connecting to HostIP:8118... failed: No route to host.', But, the host machine(centos7) can successfully execute the wget, And I can successfully ping the host in the container. I don't know why it might be related to firewalls and the 8118 port.</p>\n\n<p>It is Over,</p>\n\n<p>OMG.. I have no other way, can anyone help me?</p>\n\n<p>==============================</p>\n\n<p>ps:\nYou can see from the screenshot below, I actually want to install goa and goagen but report an error, maybe because of network reasons, I want to open the agent to try, so...only have the above problem.</p>\n\n<p>1.my go docker container\n<a href=\"https://i.stack.imgur.com/VzBvY.png\" rel=\"nofollow noreferrer\">enter image description here</a></p>\n\n<p><a href=\"https://i.stack.imgur.com/W7C6B.png\" rel=\"nofollow noreferrer\">go docker wget</a></p>\n\n<p>2.my host</p>\n\n<p><a href=\"https://i.stack.imgur.com/zmUE9.png\" rel=\"nofollow noreferrer\">my host wget</a></p>\n"}, {"tags": ["sorting", "go"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 5, "creation_date": 1546057396, "post_id": 53966596, "comment_id": 94771168, "body": "In your <code>Less</code> function you&#39;re using element <code>i</code> on both sides of the comparison."}], "answers": [{"tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": true, "score": 4, "last_activity_date": 1546065746, "last_edit_date": 1546065746, "creation_date": 1546064588, "answer_id": 53967232, "question_id": 53966596, "link": "https://stackoverflow.com/questions/53966596/whats-going-wrong-with-my-golang-stldib-sort/53967232#53967232", "title": "What&#39;s going wrong with my golang stldib sort?", "body": "<p>typo here</p>\n\n<pre><code>func (s ByError) Less(i, j int) bool {\n    return s[i].MethodRMSE &lt; s[i].MethodRMSE\n}\n</code></pre>\n\n<p>should be</p>\n\n<pre><code>func (s ByError) Less(i, j int) bool {\n    return s[i].MethodRMSE &lt; s[j].MethodRMSE\n}\n</code></pre>\n\n<p>Because it's a little hard to see, the first (wrong) version compares the item to itself (both indexes are <code>i</code>). The second properly uses both <code>i</code> and <code>j</code>.</p>\n"}], "owner": {"reputation": 197, "user_id": 7299284, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CW24NJaZ0QU/AAAAAAAAAAI/AAAAAAAAAAo/8EtvCR46EQ0/photo.jpg?sz=128", "display_name": "Jonathan Steele", "link": "https://stackoverflow.com/users/7299284/jonathan-steele"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "closed_date": 1546087412, "accepted_answer_id": 53967232, "answer_count": 1, "score": 0, "last_activity_date": 1546065746, "creation_date": 1546056202, "question_id": 53966596, "link": "https://stackoverflow.com/questions/53966596/whats-going-wrong-with-my-golang-stldib-sort", "closed_reason": "Not suitable for this site", "title": "What&#39;s going wrong with my golang stldib sort?", "body": "<p>I am trying to sort a (Golang) slice of structs by one of their fields.</p>\n\n<p>I have looked at a lot of examples and go-playgrounds and the documentation, and I feel like I get it, but I still can't get my code to work quite right. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sort\"\n)\n\ntype Method struct {\n    MethodNumber int       `json:\"methodNumber\"`\n    MethodRank   int       `json:\"rank\"`\n    MethodRMSE   float64   `json:\"error\"`\n    Forecast     []float64 `json:\"forecast\"`\n}\n\n// extra stuff for sorting.\ntype ByError []Method\n\nfunc (s ByError) Len() int {\n    return len(s)\n}\nfunc (s ByError) Swap(i, j int) {\n    s[i], s[j] = s[j], s[i]\n}\nfunc (s ByError) Less(i, j int) bool {\n    return s[i].MethodRMSE &lt; s[i].MethodRMSE\n}\n\nfunc main() {\n\n    xs := make([]Method, 0)\n    fmt.Println(len(xs))\n    xs = append(xs, Method{MethodNumber: 1, MethodRMSE: 10})\n    xs = append(xs, Method{MethodNumber: 2, MethodRMSE: 8})\n    xs = append(xs, Method{MethodNumber: 3, MethodRMSE: 6})\n    xs = append(xs, Method{MethodNumber: 4, MethodRMSE: 4})\n\n    fmt.Printf(\"%+v \\n\", xs)\n    sort.Sort(ByError(xs))\n    fmt.Printf(\"%+v \\n\", xs)\n    sort.Sort(sort.Reverse(ByError(xs)))\n    fmt.Printf(\"%+v \\n\", xs)\n\n\n}\n</code></pre>\n\n<p>My Non-Working Code : <a href=\"https://play.golang.org/p/h8SHVjTQSPM\" rel=\"nofollow noreferrer\">https://play.golang.org/p/h8SHVjTQSPM</a></p>\n\n<p>A Working Near-Duplicate : <a href=\"https://play.golang.org/p/vActL0VwK3L\" rel=\"nofollow noreferrer\">https://play.golang.org/p/vActL0VwK3L</a> (from another SO user)</p>\n\n<p>Mine should be sorting by RMSE, but it doesn't change the order at all. Right now, the result of  my go playground should be having it sort by RMSE ascending, then sort in reverse. </p>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 9542, "user_id": 8068625, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4spqa.png?s=128&g=1", "display_name": "Henry Woody", "link": "https://stackoverflow.com/users/8068625/henry-woody"}, "edited": false, "score": 3, "creation_date": 1546043242, "post_id": 53965657, "comment_id": 94769444, "body": "can you include the error message you get?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1546082213, "post_id": 53965657, "comment_id": 94775663, "body": "<i>&quot;Should the 3 lines not keep all CORS problems away?&quot;</i> No. When using <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin#Syntax\" rel=\"nofollow noreferrer\">Origin</a> are you also using credentials? If so <code>&quot;*&quot;</code> will fail. In this case you should, instead of <code>*</code>, pass in the origin. <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Request-Headers#Syntax\" rel=\"nofollow noreferrer\">Headers</a> does not allow <code>&quot;*&quot;</code>."}, {"owner": {"reputation": 451, "user_id": 4624605, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/CLvcA.jpg?s=128&g=1", "display_name": "Paul Oskar Mayer", "link": "https://stackoverflow.com/users/4624605/paul-oskar-mayer"}, "edited": false, "score": 0, "creation_date": 1546136782, "post_id": 53965657, "comment_id": 94787399, "body": "Thanks for the fast feedback. Screenshot or error attached."}, {"owner": {"reputation": 451, "user_id": 4624605, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/CLvcA.jpg?s=128&g=1", "display_name": "Paul Oskar Mayer", "link": "https://stackoverflow.com/users/4624605/paul-oskar-mayer"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1546136955, "post_id": 53965657, "comment_id": 94787423, "body": "@mkopriva, i tried it also with c.Writer.Header().Set(&quot;Access-Control-Allow-Headers&quot;, &quot;Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization, accept, origin, Cache-Control, X-Requested-With&quot;) Same result"}, {"owner": {"reputation": 427, "user_id": 7195907, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/1675159456108688/picture?type=large", "display_name": "Adam McGurk", "link": "https://stackoverflow.com/users/7195907/adam-mcgurk"}, "edited": false, "score": 0, "creation_date": 1546136981, "post_id": 53965657, "comment_id": 94787427, "body": "It doesnt look like there&#39;s anything being returned from the request. In fact, it looks like a non-200 HTTP status code. What is the status code being returned from your request?"}], "answers": [{"comments": [{"owner": {"reputation": 451, "user_id": 4624605, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/CLvcA.jpg?s=128&g=1", "display_name": "Paul Oskar Mayer", "link": "https://stackoverflow.com/users/4624605/paul-oskar-mayer"}, "edited": false, "score": 0, "creation_date": 1546182729, "post_id": 53976136, "comment_id": 94794870, "body": "I tried it with  cors &quot;github.com/rs/cors/wrapper/gin&quot;. Works fine. I dont understand why though."}], "tags": [], "owner": {"reputation": 1733, "user_id": 10490857, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GA97O.jpg?s=128&g=1", "display_name": "Maxim", "link": "https://stackoverflow.com/users/10490857/maxim"}, "is_accepted": true, "score": 1, "last_activity_date": 1546157740, "creation_date": 1546157740, "answer_id": 53976136, "question_id": 53965657, "link": "https://stackoverflow.com/questions/53965657/server-running-on-localhost8080-getting-cors-from-frontend-running-on-9090/53976136#53976136", "title": "server running on localhost:8080 getting CORS from frontend running on 9090", "body": "<p>When you catch OPTION as Preflight request\n your server should return success. I cannot find return in your provided code.</p>\n\n<p>Also you can try to use <a href=\"https://github.com/rs/cors\" rel=\"nofollow noreferrer\">https://github.com/rs/cors</a></p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n\n    \"github.com/gin-gonic/gin\"\n    cors \"github.com/rs/cors/wrapper/gin\"\n)\n\nfunc main() {\n    router := gin.Default()\n\n    router.Use(cors.Default())\n    router.GET(\"/\", func(context *gin.Context) {\n        context.JSON(http.StatusOK, gin.H{\"hello\": \"world\"})\n    })\n\n    router.Run(\":8080\")\n}\n</code></pre>\n"}], "owner": {"reputation": 451, "user_id": 4624605, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/CLvcA.jpg?s=128&g=1", "display_name": "Paul Oskar Mayer", "link": "https://stackoverflow.com/users/4624605/paul-oskar-mayer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1166, "favorite_count": 0, "accepted_answer_id": 53976136, "answer_count": 1, "score": 1, "last_activity_date": 1546157740, "creation_date": 1546042763, "last_edit_date": 1546136852, "question_id": 53965657, "link": "https://stackoverflow.com/questions/53965657/server-running-on-localhost8080-getting-cors-from-frontend-running-on-9090", "title": "server running on localhost:8080 getting CORS from frontend running on 9090", "body": "<p>I have a API-server (gin-gonic) running on localhost:8080.\nAll the typical CORS-Header are set for debugging:\nWhen I try to test the API with a simple Frontend (swagger-ui) i get a CORS-error. (swagger is running on localhost:9090)</p>\n\n<p>It works when everything is running on the same domain.</p>\n\n<pre><code>c.Writer.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\nc.Writer.Header().Set(\"Access-Control-Allow-Headers\", \"*\")\nc.Writer.Header().Set(\"Access-Control-Allow-Methods\", \"POST, OPTIONS, GET, PUT\")\n</code></pre>\n\n<p>why is this not working. Should the 3 lines not keep all CORS problems away?</p>\n\n<p>Im super curious for actual explanations rather than a plain solution. All resources regarding this (or a good one about CORS) are welcome.</p>\n\n<p>It works fine in Postman or CURL</p>\n\n<p>Errormessage in browser:\n<a href=\"https://i.stack.imgur.com/I5yrK.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/I5yrK.png\" alt=\"CORS Error Message\"></a></p>\n"}, {"tags": ["docker", "go", "alpine"], "answers": [{"tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 2, "last_activity_date": 1546036104, "creation_date": 1546036104, "answer_id": 53964964, "question_id": 53964313, "link": "https://stackoverflow.com/questions/53964313/error-compiling-go-from-source-in-an-alpine-docker-container-loadinternal-can/53964964#53964964", "title": "Error compiling Go from source in an Alpine Docker container: &quot;loadinternal: cannot find runtime/cgo&quot;", "body": "<p>Either go isn't correctly installed on the image or the GOROOT is wrong</p>\n\n<p>Put <code>go tool dist banner</code> and <code>go tool dist env</code> in your all.bash for clues</p>\n"}, {"comments": [{"owner": {"reputation": 172, "user_id": 7338886, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/shaF0.jpg?s=128&g=1", "display_name": "Hasibul Hasn", "link": "https://stackoverflow.com/users/7338886/hasibul-hasn"}, "edited": false, "score": 1, "creation_date": 1559481975, "post_id": 54910210, "comment_id": 99426918, "body": "Thanks, it worked for me. Code gave output, but getting this message (warning) on build time <code>loadinternal: cannot find runtime&#47;cgo</code>."}], "tags": [], "owner": {"reputation": 41, "user_id": 11126313, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/8f6b16f33d9c7118eb49b6cdcf2fb9ee?s=128&d=identicon&r=PG", "display_name": "Laurens", "link": "https://stackoverflow.com/users/11126313/laurens"}, "is_accepted": false, "score": 4, "last_activity_date": 1551707607, "last_edit_date": 1551707607, "creation_date": 1551285237, "answer_id": 54910210, "question_id": 53964313, "link": "https://stackoverflow.com/questions/53964313/error-compiling-go-from-source-in-an-alpine-docker-container-loadinternal-can/54910210#54910210", "title": "Error compiling Go from source in an Alpine Docker container: &quot;loadinternal: cannot find runtime/cgo&quot;", "body": "<p>I had the same error messages, although I was compiling a different project.</p>\n\n<p>It turns out that alpine needs to have the <code>musl-dev</code> package installed for this to work, so I think you need to make sure that is included in your Dockerfile, or manually install it by running <code>apk add --no-cache musl-dev</code>.</p>\n"}], "owner": {"reputation": 21, "user_id": 5399421, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0349262a922b24216b9285472a18dd6?s=128&d=identicon&r=PG&f=1", "display_name": "Ishrat", "link": "https://stackoverflow.com/users/5399421/ishrat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3269, "favorite_count": 2, "answer_count": 2, "score": 2, "last_activity_date": 1587059223, "creation_date": 1546031419, "question_id": 53964313, "link": "https://stackoverflow.com/questions/53964313/error-compiling-go-from-source-in-an-alpine-docker-container-loadinternal-can", "title": "Error compiling Go from source in an Alpine Docker container: &quot;loadinternal: cannot find runtime/cgo&quot;", "body": "<p>I'm trying to build an Alpine Docker image for the FIPS-enabled version of Go. To do this, I am trying to build Go from source using the <code>dev.boringcrypto</code> branch of the <code>golang/go</code> repository.</p>\n\n<p>Upon running <code>./all.bash</code>, I get the following errors:</p>\n\n<pre><code>Step 4/4 : RUN cd go/src &amp;&amp; ./all.bash\n ---&gt; Running in 00db552598f7\nBuilding Go cmd/dist using /usr/lib/go.\n# _/go/src/cmd/dist\nloadinternal: cannot find runtime/cgo\n/usr/lib/go/pkg/tool/linux_amd64/link: running gcc failed: exit status 1\n/usr/lib/gcc/x86_64-alpine-linux-musl/6.4.0/../../../../x86_64- \nalpine-linux-musl/bin/ld: cannot find Scrt1.o: No such file or directory\n/usr/lib/gcc/x86_64-alpine-linux-musl/6.4.0/../../../../x86_64- \nalpine-linux-musl/bin/ld: cannot find crti.o: No such file or directory\n/usr/lib/gcc/x86_64-alpine-linux-musl/6.4.0/../../../../x86_64-alpine-linux-musl/bin/ld: cannot find -lssp_nonshared\ncollect2: error: ld returned 1 exit status\n\nThe command '/bin/bash -c cd go/src &amp;&amp; ./all.bash' returned a non-zero code: 2\n</code></pre>\n\n<p>Which causes the installation tests to fail and kicks me out of the Docker image build.</p>\n\n<p>I have the <code>gcc</code> installed on the image, and tried setting the environment variable <code>CGO_ENABLED=0</code> as suggested in other questions, but neither of these things seem to alleviate the problem.</p>\n\n<p>I'm at my wits end with this problem. Has anybody else run into similar issues in the past? I don't understand why this is happening, as the build runs fine in an Ubuntu container.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["docker", "go", "authz"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 3, "creation_date": 1546030280, "post_id": 53963396, "comment_id": 94766020, "body": "It might help to include an example of what you are sending and how you are sending it exactly."}, {"owner": {"reputation": 372, "user_id": 1379258, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Q8ySF.jpg?s=128&g=1", "display_name": "martwetzels", "link": "https://stackoverflow.com/users/1379258/martwetzels"}, "edited": false, "score": 0, "creation_date": 1546030314, "post_id": 53963396, "comment_id": 94766033, "body": "Can you give some more information on the authorization interface? Perhaps, are you expecting the user value in a query parameter? like <a href=\"http://localhost/authorize?user=xxx\" rel=\"nofollow noreferrer\">localhost/authorize?user=xxx</a>"}, {"owner": {"reputation": 86, "user_id": 2826770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d894b5d6e140c85142c72a2e01311a4f?s=128&d=identicon&r=PG&f=1", "display_name": "kergeodeta", "link": "https://stackoverflow.com/users/2826770/kergeodeta"}, "edited": false, "score": 0, "creation_date": 1546073903, "post_id": 53963396, "comment_id": 94773785, "body": "I send the commands through the docker cli, eg.: <code>docker container ls</code>. Or the cli commands don&#39;t send any information from the logged in user?  I use the authorization.Request struct from the go-plugin-helpers package. The plugin run as a systemd service with a socket as described here: <a href=\"https://docs.docker.com/engine/extend/plugin_api/#what-plugins-are\" rel=\"nofollow noreferrer\">docs.docker.com/engine/extend/plugin_api/#what-plugins-are</a>"}], "owner": {"reputation": 86, "user_id": 2826770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d894b5d6e140c85142c72a2e01311a4f?s=128&d=identicon&r=PG&f=1", "display_name": "kergeodeta", "link": "https://stackoverflow.com/users/2826770/kergeodeta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1546025742, "creation_date": 1546025149, "last_edit_date": 1546025742, "question_id": 53963396, "link": "https://stackoverflow.com/questions/53963396/why-is-authorization-request-user-string-empty", "title": "Why is authorization.Request.User string empty?", "body": "<p>I am working on an authorization plugin in Go and I am stuck with it. When I send commands to the Docker Engine on localhost, I get the RequestURI and RequestBody well but not the User who sent the request. It's an empty string. </p>\n\n<pre><code>func (e AuthzEntity) AuthZReq(req authorization.Request) authorization.Response {\n    log.Println(\"RequestURI: \", req.RequestURI, \" RequestBody: \", string(req.RequestBody))\n\n    if \"USER\" == req.User {\n        log.Println(\"Authorized\")\n    } else {\n        log.Println(\"Unauthorized\")\n    }\n\n    return authorization.Response{true, \"\", \"\"}\n}\n</code></pre>\n\n<p>With the above code I expect the text \"Authorized\" in the logs, but I see \"Unauthorized\" and the Username is empty.</p>\n\n<p>Can someone help me?</p>\n"}, {"tags": ["csv", "go", "utf-8"], "answers": [{"comments": [{"owner": {"reputation": 111, "user_id": 10412696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/551b0ea14f1f7576f881992998108f3d?s=128&d=identicon&r=PG&f=1", "display_name": "Emanolo78", "link": "https://stackoverflow.com/users/10412696/emanolo78"}, "edited": false, "score": 0, "creation_date": 1546115109, "post_id": 53963212, "comment_id": 94783764, "body": "This is great. Is there a way to determine the type of encoding before reading the file ? What I want to do is the following: make a loop to read csv files which may have several types of encoding: utf-8, latin-1 or others. Is there a way to detec the type of the CSSV file upfront ?"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 6, "last_activity_date": 1546028694, "last_edit_date": 1546028694, "creation_date": 1546023959, "answer_id": 53963212, "question_id": 53963033, "link": "https://stackoverflow.com/questions/53963033/how-to-specify-encoding-format-while-reading-csv/53963212#53963212", "title": "How to specify encoding format while reading CSV?", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/encoding/csv/\" rel=\"noreferrer\">Package csv</a></p>\n\n<pre><code>import \"encoding/csv\"\n</code></pre>\n  \n  <p><a href=\"https://golang.org/pkg/encoding/csv/#NewReader\" rel=\"noreferrer\">func NewReader</a></p>\n\n<pre><code>func NewReader(r io.Reader) *Reader\n</code></pre>\n  \n  <p>NewReader returns a new Reader that reads from r.</p>\n</blockquote>\n\n<hr>\n\n<p>Provide an <code>io.Reader</code> to <code>csv.NewReader</code> that maps the CSV file character set to Unicode UTF-8.</p>\n\n<p>For example,</p>\n\n<pre><code>import (\n    \"encoding/csv\"\n\n    \"golang.org/x/text/encoding/charmap\"\n)\n\nfile, err := os.Open(filename)\nif err != nil {\n    return err\n}\ndefer file.Close()\nrdr := csv.NewReader(charmap.ISO8859_15.NewDecoder().Reader(file))\n</code></pre>\n"}], "owner": {"reputation": 111, "user_id": 10412696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/551b0ea14f1f7576f881992998108f3d?s=128&d=identicon&r=PG&f=1", "display_name": "Emanolo78", "link": "https://stackoverflow.com/users/10412696/emanolo78"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2085, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1546028694, "creation_date": 1546022829, "last_edit_date": 1546026043, "question_id": 53963033, "link": "https://stackoverflow.com/questions/53963033/how-to-specify-encoding-format-while-reading-csv", "title": "How to specify encoding format while reading CSV?", "body": "<p>I am writing a package to read CSV files in Go, and I need to open CSV files which may be coded in different formats (such as UTF8, Latin1 or others). Is there a way to specify the encoding format of the CSV file to read?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1546020029, "post_id": 53962357, "comment_id": 94762635, "body": "Given that you can light up a system like a Christmas tree just using Goroutines (depending on <code>GOMAXPROCS</code>), I fail to see how the added complexity of cross-process communication would be any better. But as the close votes note, this is primarily opinion based, which makes it off topic."}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546026194, "post_id": 53962685, "comment_id": 94764737, "body": "Probably the most important/common reason to use separate processes would be for privilege separation."}], "tags": [], "owner": {"reputation": 25733, "user_id": 559737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5de249db6565b87a2699e131974268a?s=128&d=identicon&r=PG", "display_name": "Brendan", "link": "https://stackoverflow.com/users/559737/brendan"}, "is_accepted": false, "score": 2, "last_activity_date": 1546020916, "creation_date": 1546020916, "answer_id": 53962685, "question_id": 53962357, "link": "https://stackoverflow.com/questions/53962357/is-there-any-scenario-when-we-would-resort-to-a-process-instead-of-a-goroutine/53962685#53962685", "title": "Is there any scenario when we would resort to a process instead of a goroutine?", "body": "<p>To get things started, here's three reasons. I'm sure there's more.</p>\n\n<p><strong>Reason #1</strong></p>\n\n<p>In a perfect world, CPUs would be busy doing the most important work they can (and not wasted doing the less important work while more important work waits).</p>\n\n<p>To do this, whatever controls what work a CPU does (the scheduler) has to know how important each piece of work is. This is normally done with (e.g.) thread priorities. When there are 2 or more processes that are isolated from each other, whatever controls what work a CPU does can't be part of either process. Otherwise you get a situation where one process is consuming CPU time doing unimportant work because it can't know that there's a different process that wants the CPU for more important work.</p>\n\n<p>This is why things like \"goroutines\" are broken (inferior to plain old threads). They simply can't do the right thing (unless there's never more than one process that wants CPU time).</p>\n\n<p>Processes (combined with \"process priorities\") can fix that problem (while adding multiple other problems).</p>\n\n<p><strong>Reason #2</strong></p>\n\n<p>In a perfect world, software would never crash. The reality is that sometimes processes do crash (and sometimes the reason has nothing to do with software - e.g. a hardware flaw). Specifically, when one process crashes often there's no sane way to tell how much damage was done within that process, so the entire process typically gets terminated. To deal with this problem people use some form of redundancy (multiple redundant processes).</p>\n\n<p><strong>Reason #3</strong></p>\n\n<p>In a perfect world, all CPUs and all memory would be equal. In reality things don't scale up like that, so you get things like ccNUMA where a CPU can access memory in the same NUMA domain quickly, but the same CPU can't access memory in a different NUMA domain as quickly. To cope with that, ideally (when allocating memory) you'd want to tell the OS \"this memory needs low latency more than bandwidth\" (and OS would allocate memory for the fastest/closest NUMA domain only) or you'd tell the OS \"this memory needs high bandwidth more than low latency\" (and the OS would allocate memory from all NUMA domains). Sadly every language I've ever seen has \"retro joke memory management\" (without any kind of \"bandwidth vs. latency vs. security\" hints); which means that the only control you get is the choice between \"one process spread across all NUMA domains vs. one process for each NUMA domain\".</p>\n"}], "owner": {"reputation": 1, "user_id": 10843962, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-BaQYcwoKqbc/AAAAAAAAAAI/AAAAAAAAAFA/whGGVPy2M44/photo.jpg?sz=128", "display_name": "sjaiswal", "link": "https://stackoverflow.com/users/10843962/sjaiswal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "closed_date": 1546026135, "answer_count": 1, "score": -2, "last_activity_date": 1546026097, "creation_date": 1546019033, "last_edit_date": 1546026097, "question_id": 53962357, "link": "https://stackoverflow.com/questions/53962357/is-there-any-scenario-when-we-would-resort-to-a-process-instead-of-a-goroutine", "closed_reason": "Opinion-based", "title": "Is there any scenario when we would resort to a process instead of a goroutine?", "body": "<p>I understand that goroutines are very light weight and we can spawn thousands of them but I want to know if there is some scenario when we should spawn a process instead of a goroutine (like hitting some kind of process boundaries in terms of resource or something else). Can spawning a new process in some scenario be beneficial in terms of resource utilization or some other dimension?</p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1546015756, "post_id": 53961677, "comment_id": 94761021, "body": "&quot;sometimes it can be only a unique object not a list&quot; - data that is not well-structured tends to be very difficult to work with in Go. Can you fix the data creation/insertion issue so that the data is consistent?"}, {"owner": {"reputation": 1733, "user_id": 10490857, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GA97O.jpg?s=128&g=1", "display_name": "Maxim", "link": "https://stackoverflow.com/users/10490857/maxim"}, "edited": false, "score": 0, "creation_date": 1546016163, "post_id": 53961677, "comment_id": 94761160, "body": "As one of the way it could be using this method for setting <a href=\"https://stackoverflow.com/questions/30891301/handling-custom-bson-marshaling-golang-mgo\" title=\"handling custom bson marshaling golang mgo\">stackoverflow.com/questions/30891301/&hellip;</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1546017919, "post_id": 53961677, "comment_id": 94761813, "body": "According to <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">mholt.github.io/json-to-go</a> , and indeed the <code>json</code> itself, <code>Journal.Details</code> needs to be a <code>[]struct</code>."}], "owner": {"reputation": 31, "user_id": 10618629, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-M49kMDo1dFI/AAAAAAAAAAI/AAAAAAAAAEw/WF-XWskNLMs/photo.jpg?sz=128", "display_name": "Tim", "link": "https://stackoverflow.com/users/10618629/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1546026265, "creation_date": 1546015446, "last_edit_date": 1546026265, "question_id": 53961677, "link": "https://stackoverflow.com/questions/53961677/getting-data-from-mongodb-inside-a-struct-quite-complex", "title": "Getting data from MongoDB inside a struct quite complex", "body": "<p>For a project I have to query a Mongo database with a RESTful API in Go.</p>\n\n<p>There is my problem, I get this structure from Mongo.</p>\n\n<pre><code>{\n    \"_id\" : \"ObjectID\",\n    \"id\" : 1234,\n    \"project\" : {\n        \"id\" : 1,\n        \"name\" : \"A project\"\n    },\n    \"tracker\" : {\n        \"id\" : 2,\n        \"name\" : \"A tracker\"\n    },\n    \"status\" : {\n        \"id\" : 3,\n        \"name\" : \"A status\"\n    },\n    \"priority\" : {\n        \"id\" : 4,\n        \"name\" : \"A priority\"\n    },\n    \"author\" : {\n        \"id\" : 5,\n        \"name\" : \"An author\"\n    },\n    \"assigned_to\" : {\n        \"id\" : 6,\n        \"name\" : \"Assigned to\"\n    },\n    \"category\" : {\n        \"id\" : 7,\n        \"name\" : \"A category\"\n    },\n    \"subject\" : \"A subject\",\n    \"description\" : \"A description\",\n    \"done_ratio\" : 0,\n    \"spent_hours\" : 0.0,\n    \"total_spent_hours\" : 0.0,\n    \"custom_fields\" : [ \n        {\n            \"id\" : 1,\n            \"name\" : \"\",\n            \"value\" : \"\"\n        }, \n        {\n            \"id\" : 2,\n            \"name\" : \"\",\n            \"multiple\" : true,\n            \"value\" : [ \n                \"\"\n            ]\n        }\n\n    ],\n    \"created_on\" : \"2018-12-21T15:22:57.000Z\",\n    \"updated_on\" : \"2018-12-26T10:58:35.000Z\",\n    \"journals\" : [ \n        {\n            \"id\" : 1,\n            \"user\" : {\n                \"id\" : 1,\n                \"name\" : \"\"\n            },\n            \"notes\" : \"\",\n            \"created_on\" : \"2018-12-21T15:32:51Z\",\n            \"details\" : [ \n                {\n                    \"property\" : \"\",\n                    \"name\" : \"\",\n                    \"new_value\" : \"\"\n                }\n            ]\n        }, \n        {\n            \"id\" : 2,\n            \"user\" : {\n                \"id\" : 1,\n                \"name\" : \"\"\n            },\n            \"notes\" : \"\",\n            \"created_on\" : \"2018-12-21T15:33:54Z\",\n            \"details\" : []\n        }\n    ]\n}\n</code></pre>\n\n<p>As you can see, there is two elements called custom_fields and journals which are list of object. But sometimes it can be only a unique object not a list.</p>\n\n<p>In my Go API, I created the following structure: </p>\n\n<pre><code>type Custom struct {\n    Id int      `json:\"id\" bson:\"id\"`\n    Name string `json:\"name\" bson:\"name\"`\n    Multiple bool `json:\"multiple\" bson:\"multiple\"`\n    Value []string `json:\"value\" bson:\"value\"`\n}\n\ntype Journal struct {\n    ID   int `json:\"id\" bson:\"id\"`\n    User struct {\n        ID   int    `json:\"id\" bson:\"id\"`\n        Name string `json:\"name\" bson:\"name\"`\n    } `json:\"user\" bson:\"user\"`\n    Note       string `json:\"notes\" bson:\"notes\"`\n    Created_on string `json:\"created_on\" bson:\"created_on\"`\n    Details    struct {\n        Property  string `json:\"property\" bson:\"property\"`\n        Name      string `json:\"name\" bson:\"name\"`\n        Old_Value string `json:\"old_value\" bson:\"old_value\"`\n        New_Value string `json:\"new_value\" bson:\"new_value\"`\n    } `json:\"details\" bson:\"details\"`\n}\n\ntype MainStruct struct {\n    ID      int `json:\"id\" bson:\"id\"`\n    Project struct {\n        ID   int    `json:\"id\" bson:\"id\"`\n        Name string `json:\"name\" bson:\"name\"`\n    } `json:\"project\" bson:\"project\"`\n    Tracker struct {\n        ID   int    `json:\"id\" bson:\"id\"`\n        Name string `json:\"name\" bson:\"name\"`\n    } `json:\"tracker\" bson:\"tracker\"`\n    Status struct {\n        ID   int    `json:\"id\" bson:\"id\"`\n        Name string `json:\"name\" bson:\"name\"`\n    } `json:\"status\" bson:\"status\"`\n    Priority struct {\n        ID   int    `json:\"id\" bson:\"id\"`\n        Name string `json:\"name\" bson:\"name\"`\n    } `json:\"priority\" bson:\"priority\"`\n    Author struct {\n        ID   int    `json:\"id\" bson:\"id\"`\n        Name string `json:\"name\" bson:\"name\"`\n    } `json:\"author\" bson:\"author\"`\n    Assigned_to struct {\n        ID   int    `json:\"id\" bson:\"id\"`\n        Name string `json:\"name\" bson:\"name\"`\n    } `json:\"assigned_to\" bson:\"assigned_to\"`\n    Subject      string    `json:\"subject\" bson:\"subject\"`\n    Description  string    `json:\"description\" bson:\"description\"`\n    Due_date     time.Time `json:\"due_date\" bson:\"due_date\"`\n    Done_ratio   int       `json:\"done_ratio\" bson:\"done_ratio\"`\n    CustomFields []Custom  `json:\"custom_fields\" bson:\"custom_fields\"`\n    Created_on   time.Time `json:\"created_on\" bson:\"created_on\"`\n    Updated_on   time.Time `json:\"updated_on\" bson:\"updated_on\"`\n    Journals     []Journal `json:\"journals\" bson:\"journals\"`\n}\n</code></pre>\n\n<p>But when I query MongoDb and get a document which as one custom_field or one journal, I get the following errors:</p>\n\n<pre><code>cannot decode string into a slice\n</code></pre>\n\n<p>I don't know  how to do to make the one element into a slice of 1.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 8, "last_activity_date": 1546015564, "creation_date": 1546015564, "answer_id": 53961710, "question_id": 53961617, "link": "https://stackoverflow.com/questions/53961617/call-has-possible-formatting-directive/53961710#53961710", "title": "Call has possible formatting directive", "body": "<p>The warning is telling you you have a formatting directive (<code>%d</code> in this case) in a call to <code>Println</code>. This is a warning because <code>Println</code> <em>does not support formatting directives</em>. These directives are supported by the formatted functions <code>Printf</code> and <code>Sprintf</code>. This is explained thoroughly in the <a href=\"https://golang.org/pkg/fmt\" rel=\"noreferrer\"><code>fmt</code> package documentation</a>.</p>\n\n<p>As you can plainly see when you run your code, the output is</p>\n\n<pre><code>Hello, playground %d 5\n</code></pre>\n\n<p>Because <code>Println</code> does what its docs say - it prints its arguments followed by a line break. Change that to <code>Printf</code>, which is likely what you intended, <a href=\"https://play.golang.org/p/6apmsKPiPkf\" rel=\"noreferrer\">and you get this instead</a>:</p>\n\n<pre><code>Hello, playground 5\n</code></pre>\n\n<p>Which is presumably what you intended.</p>\n"}, {"tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": true, "score": 98, "last_activity_date": 1546015617, "creation_date": 1546015617, "answer_id": 53961715, "question_id": 53961617, "link": "https://stackoverflow.com/questions/53961617/call-has-possible-formatting-directive/53961715#53961715", "title": "Call has possible formatting directive", "body": "<p><a href=\"https://golang.org/pkg/fmt/#Println\" rel=\"noreferrer\"><code>fmt.Println</code></a> doesn't do formatting things like <code>%d</code>. Instead, it uses the default format of its arguments, and adds spaces between them.</p>\n\n<pre><code>fmt.Println(\"Hello, playground\",i)  // Hello, playground 5\n</code></pre>\n\n<p>If you want printf style formatting, use <a href=\"https://golang.org/pkg/fmt/#Printf\" rel=\"noreferrer\"><code>fmt.Printf</code></a>.</p>\n\n<pre><code>fmt.Printf(\"Hello, playground %d\\n\",i)\n</code></pre>\n\n<p>And you don't need to be particular about the type. <code>%v</code> will generally figure it out.</p>\n\n<pre><code>fmt.Printf(\"Hello, playground %v\\n\",i)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2953, "user_id": 5133088, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d0efad94ced5dcd194c0a482cafd4f7b?s=128&d=identicon&r=PG&f=1", "display_name": "Jeroen Heier", "link": "https://stackoverflow.com/users/5133088/jeroen-heier"}, "edited": false, "score": 1, "creation_date": 1565432696, "post_id": 57441206, "comment_id": 101358984, "body": "Welcome to StackOverflow. Why duplicate the code? Try to explain more clearly why this is an answer to the question."}], "tags": [], "owner": {"reputation": 1, "user_id": 11910762, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lkzggdoxVG8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdLn5nTJIB3WRAMxiVoXx_tLvx_Ug/photo.jpg?sz=128", "display_name": "\u8f69\u8f95\u4e49", "link": "https://stackoverflow.com/users/11910762/%e8%bd%a9%e8%be%95%e4%b9%89"}, "is_accepted": false, "score": -1, "last_activity_date": 1565431815, "creation_date": 1565431815, "answer_id": 57441206, "question_id": 53961617, "link": "https://stackoverflow.com/questions/53961617/call-has-possible-formatting-directive/57441206#57441206", "title": "Call has possible formatting directive", "body": "<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>package main\r\nimport (\"fmt\")\r\nfunc main() {\r\n    i := 5\r\n    fmt.Println(\"Hello, playground %d\",i)\r\n}\r\n===================================================\r\npackage main\r\nimport (\"fmt\")\r\nfunc main() {\r\n    i := 5\r\n    fmt.Printf(\"Hello, playground %d\",i)\r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}], "owner": {"reputation": 715, "user_id": 10735007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/799002766b50cdbc9b6e8e55f1834069?s=128&d=identicon&r=PG&f=1", "display_name": "Yevgeniy Gendelman", "link": "https://stackoverflow.com/users/10735007/yevgeniy-gendelman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37364, "favorite_count": 2, "accepted_answer_id": 53961715, "answer_count": 3, "score": 58, "last_activity_date": 1565431815, "creation_date": 1546015153, "last_edit_date": 1546026298, "question_id": 53961617, "link": "https://stackoverflow.com/questions/53961617/call-has-possible-formatting-directive", "title": "Call has possible formatting directive", "body": "<p>When I run this code</p>\n\n<pre><code>package main\nimport (\"fmt\")\nfunc main() {\n    i := 5\n    fmt.Println(\"Hello, playground %d\",i)\n}\n</code></pre>\n\n<p>(<a href=\"https://play.golang.org/p/0Dhuhi8trQK\" rel=\"noreferrer\">playground link</a>)</p>\n\n<p>I get the following warning:\nprog.go:5: Println call has possible formatting directive %d\nGo vet exited.</p>\n\n<p>What is a proper way to do this?</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda"], "comments": [{"owner": {"reputation": 51, "user_id": 1854347, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c818c59c72a0f78b55d5a83544a92c29?s=128&d=identicon&r=PG", "display_name": "teejays", "link": "https://stackoverflow.com/users/1854347/teejays"}, "edited": false, "score": 0, "creation_date": 1547481222, "post_id": 53960985, "comment_id": 95198096, "body": "I&#39;ve been struggling with the same question. For now, it feels like Layers are kind of useless if your Lambda functions are in Golang."}], "answers": [{"tags": [], "owner": {"reputation": 835, "user_id": 4920854, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/nKogO.png?s=128&g=1", "display_name": "Jonny Rimek", "link": "https://stackoverflow.com/users/4920854/jonny-rimek"}, "is_accepted": false, "score": 5, "last_activity_date": 1546099447, "creation_date": 1546099447, "answer_id": 53971121, "question_id": 53960985, "link": "https://stackoverflow.com/questions/53960985/is-lambda-layers-compatible-with-go/53971121#53971121", "title": "Is lambda layers compatible with Go?", "body": "<p>Go dependencies are inside the compiled binary, thus you can't/don't need to use layers. The problem is solved at a language level. It doesn't have anything to do with the fact that it is compiled, C and C++ binaries still have dependencies.</p>\n"}, {"tags": [], "owner": {"reputation": 994, "user_id": 2803046, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GLUcg.png?s=128&g=1", "display_name": "begie", "link": "https://stackoverflow.com/users/2803046/begie"}, "is_accepted": false, "score": 3, "last_activity_date": 1575466041, "last_edit_date": 1575466041, "creation_date": 1575461304, "answer_id": 59175717, "question_id": 53960985, "link": "https://stackoverflow.com/questions/53960985/is-lambda-layers-compatible-with-go/59175717#59175717", "title": "Is lambda layers compatible with Go?", "body": "<p>Actually it is possible to provide a Go layer with a pre-compiled <a href=\"https://golang.org/pkg/plugin/\" rel=\"nofollow noreferrer\">plugin</a> however there are so many restrictions that it isn't really useful:</p>\n\n<ul>\n<li>Plugin and app have to be compiled using exactly the same compiler version (e.g. no compatibility between 1.13.3 and 1.13.4).</li>\n<li>If both plugin and app rely on the same dependency they have to use exactly the same version too. </li>\n<li>When plugin's API uses custom interfaces and/or structs they need to be defined in a shared Go package that has to be imported by both plugin and app.</li>\n<li>All dependencies common to both plugin and app have to be stored in the same folder structure!</li>\n</ul>\n\n<p>In case of AWS Lambda Layers the last two points mentioned above make Go layers pretty useless. Since app code needs to import a shared package anyway why not import the actual package that would reside in the Go layer?</p>\n\n<p>If I get this right the Go plugin system is meant to be used to provide pluggable implementations <strong>compiled and deployed together with the main application</strong>. It's not designed to be used by third parties to deliver custom application plugins.</p>\n\n<p>The bottom line is: you can use Go + AWS Lambda Layers if you <em>really</em> want to however in practice it is not worth the effort in my opinion.</p>\n"}], "owner": {"reputation": 73, "user_id": 590972, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e01e776601e9ab3ffd83c68b2297e6a5?s=128&d=identicon&r=PG", "display_name": "jaunty_s", "link": "https://stackoverflow.com/users/590972/jaunty-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1539, "favorite_count": 0, "answer_count": 2, "score": 6, "last_activity_date": 1615448759, "creation_date": 1546011931, "last_edit_date": 1615448759, "question_id": 53960985, "link": "https://stackoverflow.com/questions/53960985/is-lambda-layers-compatible-with-go", "title": "Is lambda layers compatible with Go?", "body": "<p>Is it possible to use a Golang lambda with the new lambda layers feature from AWS?</p>\n\n<p>I have been trying to find a solution to use layers with my Lambda function written in Go, but I have not been able to do so. I got it working with python lambda though. I feel like since the Go code is a compiled binary, it's not possible to use a layer import during runtime. If I have the code for the layer locally, the import gets compiled into the binary as well which defeats the purpose of using a layer. </p>\n\n<p>Does anyone know or have any examples around of Lambda Layers using Golang?</p>\n"}, {"tags": ["go", "aws-sam"], "comments": [{"owner": {"reputation": 550, "user_id": 3518621, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf3b0c525ec4ad5c29864f230486dea2?s=128&d=identicon&r=PG&f=1", "display_name": "cslrnr", "link": "https://stackoverflow.com/users/3518621/cslrnr"}, "edited": false, "score": 0, "creation_date": 1546013420, "post_id": 53959452, "comment_id": 94760038, "body": "go code to query DynamoDB from lambda serverless : is that what you want ?"}, {"owner": {"reputation": 835, "user_id": 4920854, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/nKogO.png?s=128&g=1", "display_name": "Jonny Rimek", "link": "https://stackoverflow.com/users/4920854/jonny-rimek"}, "reply_to_user": {"reputation": 550, "user_id": 3518621, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf3b0c525ec4ad5c29864f230486dea2?s=128&d=identicon&r=PG&f=1", "display_name": "cslrnr", "link": "https://stackoverflow.com/users/3518621/cslrnr"}, "edited": false, "score": 0, "creation_date": 1546096549, "post_id": 53959452, "comment_id": 94779014, "body": "no, I have working go code for that. This is what I am looking for: <a href=\"https://github.com/awslabs/serverless-application-model/blob/master/docs/safe_lambda_deployments.rst#pretraffic-posttraffic-hooks\" rel=\"nofollow noreferrer\">github.com/awslabs/serverless-application-model/blob/master/&zwnj;&#8203;&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 835, "user_id": 4920854, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/nKogO.png?s=128&g=1", "display_name": "Jonny Rimek", "link": "https://stackoverflow.com/users/4920854/jonny-rimek"}, "edited": false, "score": 0, "creation_date": 1563536601, "post_id": 57103232, "comment_id": 100742427, "body": "thanks, I guess if my tests fail I change the Status to something like failed and that will cancel the cancary deployment and trigger the rollback?"}, {"owner": {"reputation": 335, "user_id": 1435247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0f9448aa952f71c8338e8bb356dcd7f?s=128&d=identicon&r=PG", "display_name": "Ryan Harmuth", "link": "https://stackoverflow.com/users/1435247/ryan-harmuth"}, "reply_to_user": {"reputation": 835, "user_id": 4920854, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/nKogO.png?s=128&g=1", "display_name": "Jonny Rimek", "link": "https://stackoverflow.com/users/4920854/jonny-rimek"}, "edited": false, "score": 0, "creation_date": 1564079803, "post_id": 57103232, "comment_id": 100923043, "body": "That&#39;s correct. I tested by returning <code>Status: &quot;Failed&quot;</code> and it rolls back as expected."}, {"owner": {"reputation": 835, "user_id": 4920854, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/nKogO.png?s=128&g=1", "display_name": "Jonny Rimek", "link": "https://stackoverflow.com/users/4920854/jonny-rimek"}, "edited": false, "score": 0, "creation_date": 1564488891, "post_id": 57103232, "comment_id": 101040819, "body": "Thank you so much for your help. The last points that&#39;s not quite clear to me is: How do I actually call the lambda in a pre traffic hook? If it was a post traffic hook and the lambda was behind APIGateway I could simply call the API via http, but how do I test the lambda before it can receive traffic and how can I pass data into it?"}, {"owner": {"reputation": 335, "user_id": 1435247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0f9448aa952f71c8338e8bb356dcd7f?s=128&d=identicon&r=PG", "display_name": "Ryan Harmuth", "link": "https://stackoverflow.com/users/1435247/ryan-harmuth"}, "reply_to_user": {"reputation": 835, "user_id": 4920854, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/nKogO.png?s=128&g=1", "display_name": "Jonny Rimek", "link": "https://stackoverflow.com/users/4920854/jonny-rimek"}, "edited": false, "score": 0, "creation_date": 1565033912, "post_id": 57103232, "comment_id": 101216479, "body": "As a pre traffic hook it can only be invoked by Sam (there is no way to simulate the deployments locally AFAIK) - you just declare it in the SAM template and update your cloudformation stack via SAM deploy. SAM then will handle the invoking of the function and supply a deployment ID and the code needs to just call back into CodeDeploy (Note that the hooks only trigger on the second SAM deploy though).  You could call the function locally with <a href=\"https://docs.aws.amazon.com/cli/latest/reference/lambda/invoke.html\" rel=\"nofollow noreferrer\">lambda invoke</a> if you really want but I am not sure how useful that would be."}, {"owner": {"reputation": 335, "user_id": 1435247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0f9448aa952f71c8338e8bb356dcd7f?s=128&d=identicon&r=PG", "display_name": "Ryan Harmuth", "link": "https://stackoverflow.com/users/1435247/ryan-harmuth"}, "reply_to_user": {"reputation": 835, "user_id": 4920854, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/nKogO.png?s=128&g=1", "display_name": "Jonny Rimek", "link": "https://stackoverflow.com/users/4920854/jonny-rimek"}, "edited": false, "score": 0, "creation_date": 1565034432, "post_id": 57103232, "comment_id": 101216679, "body": "For running the actual tests locally you could just use a separate binary. So do something like put the test logic in its own package and include that in the above function for sam deploys and use another function/ binary for local. Alternatively you could modify the above to not do the SAM/ codedeploy parts when run locally."}], "tags": [], "owner": {"reputation": 335, "user_id": 1435247, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0f9448aa952f71c8338e8bb356dcd7f?s=128&d=identicon&r=PG", "display_name": "Ryan Harmuth", "link": "https://stackoverflow.com/users/1435247/ryan-harmuth"}, "is_accepted": true, "score": 1, "last_activity_date": 1565034476, "last_edit_date": 1565034476, "creation_date": 1563487850, "answer_id": 57103232, "question_id": 53959452, "link": "https://stackoverflow.com/questions/53959452/how-do-i-write-a-pre-post-traffic-hook-function-in-go/57103232#57103232", "title": "How do I write a pre/post traffic hook function in go?", "body": "<p>Something like this works:</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"encoding/json\"\n\n    \"github.com/aws/aws-lambda-go/lambda\"\n    \"github.com/aws/aws-sdk-go/aws/session\"\n    \"github.com/aws/aws-sdk-go/service/codedeploy\"\n)\n\ntype CodeDeployEvent struct {\n    DeploymentId                  string `json:\"deploymentId\"`\n    LifecycleEventHookExecutionId string `json:\"lifecycleEventHookExecutionId\"`\n}\n\nfunc HandleRequest(ctx context.Context, event CodeDeployEvent) (string, error) {\n\n    // add some tests here and change status flag as needed . . .\n\n    client := codedeploy.New(session.New())\n    params := &amp;codedeploy.PutLifecycleEventHookExecutionStatusInput{\n        DeploymentId:                  &amp;event.DeploymentId,\n        LifecycleEventHookExecutionId: &amp;event.LifecycleEventHookExecutionId,\n        Status:                        \"Succeeded\",\n    }\n\n    req, _ := client.PutLifecycleEventHookExecutionStatusRequest(params)\n\n    _ = req.Send()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 835, "user_id": 4920854, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/nKogO.png?s=128&g=1", "display_name": "Jonny Rimek", "link": "https://stackoverflow.com/users/4920854/jonny-rimek"}, "is_accepted": false, "score": 0, "last_activity_date": 1619188775, "creation_date": 1619188775, "answer_id": 67231970, "question_id": 53959452, "link": "https://stackoverflow.com/questions/53959452/how-do-i-write-a-pre-post-traffic-hook-function-in-go/67231970#67231970", "title": "How do I write a pre/post traffic hook function in go?", "body": "<p>I got around to implement this and want to share my complete solution.</p>\n<p>After figuring out how to use it, I decided against using it, because there are a couple of drawbacks.</p>\n<ul>\n<li>there is no way to expose a new version of the canary to a dedicated portion of the user base, that means sometimes they'll hit the new or the old version</li>\n<li>invoking functions that publish to sns will trigger all downstream actions, which might get the new or the old version of the downstream services, which would cause a lot of problems in case of breaking APIs</li>\n<li>IAM changes affect both version immediately, possibly breaking the old version.</li>\n</ul>\n<p>Instead, I deploy everything to a pre prod account, run my integration and e2e tests and if they succeed I'll deploy to prod</p>\n<p>the cdk code to create a canary deployment:</p>\n<pre class=\"lang-js prettyprint-override\"><code>const versionAlias = new lambda.Alias(this, 'Alias', {\n    aliasName: &quot;alias&quot;,\n    version: this.lambda.currentVersion,\n})\n\nconst preHook = new lambda.Function(this, 'LambdaPreHook', {\n    description: &quot;pre hook&quot;,\n    code: lambda.Code.fromAsset('dist/upload/convert-pre-hook'),\n    handler: 'main',\n    runtime: lambda.Runtime.GO_1_X,\n    memorySize: 128,\n    timeout: cdk.Duration.minutes(1),\n    environment: {\n        FUNCTION_NAME: this.lambda.currentVersion.functionName,\n    },\n    reservedConcurrentExecutions: 5,\n    logRetention: RetentionDays.ONE_WEEK,\n})\n// this.lambda.grantInvoke(preHook) // this doesn't work, I need to grant invoke to all functions :s\npreHook.addToRolePolicy(new iam.PolicyStatement({\n    actions: [\n        &quot;lambda:InvokeFunction&quot;,\n    ],\n    resources: [&quot;*&quot;],\n    effect: iam.Effect.ALLOW,\n}))\n\nconst application = new codedeploy.LambdaApplication(this, 'CodeDeployApplication')\nnew codedeploy.LambdaDeploymentGroup(this, 'CanaryDeployment', {\n    application: application,\n    alias: versionAlias,\n    deploymentConfig: codedeploy.LambdaDeploymentConfig.ALL_AT_ONCE,\n    preHook: preHook,\n    autoRollback: {\n        failedDeployment: true,\n        stoppedDeployment: true,\n        deploymentInAlarm: false,\n    },\n    ignorePollAlarmsFailure: false,\n    // alarms:\n    // autoRollback: codedeploy.A\n    // postHook:\n})\n</code></pre>\n<p>My go code of the pre hook function. <code>PutLifecycleEventHookExecutionStatus</code> tells code deploy if the pre hook succeeded or not. Unfortunately in case you fail the deployment message, the message you get in the cdk deploy output is utterly useless, so you need to check the pre/post hook logs.</p>\n<p>In order to actually run the integration test I simply invoke the lambda and check if an error occurred.</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;encoding/base64&quot;\n    &quot;fmt&quot;\n    &quot;log&quot;\n    &quot;os&quot;\n\n    &quot;github.com/aws/aws-lambda-go/lambda&quot;\n    &quot;github.com/aws/aws-sdk-go/aws&quot;\n    &quot;github.com/aws/aws-sdk-go/aws/session&quot;\n    &quot;github.com/aws/aws-sdk-go/service/codedeploy&quot;\n    lambdaService &quot;github.com/aws/aws-sdk-go/service/lambda&quot;\n)\n\nvar svc *codedeploy.CodeDeploy\nvar lambdaSvc *lambdaService.Lambda\n\ntype codeDeployEvent struct {\n    DeploymentId                  string `json:&quot;deploymentId&quot;`\n    LifecycleEventHookExecutionId string `json:&quot;lifecycleEventHookExecutionId&quot;`\n}\n\nfunc handler(e codeDeployEvent) error {\n    params := &amp;codedeploy.PutLifecycleEventHookExecutionStatusInput{\n        DeploymentId:                  &amp;e.DeploymentId,\n        LifecycleEventHookExecutionId: &amp;e.LifecycleEventHookExecutionId,\n    }\n    err := handle()\n    if err != nil {\n        log.Println(err)\n        params.Status = aws.String(codedeploy.LifecycleEventStatusFailed)\n    } else {\n        params.Status = aws.String(codedeploy.LifecycleEventStatusSucceeded)\n    }\n\n    _, err = svc.PutLifecycleEventHookExecutionStatus(params)\n    if err != nil {\n        return fmt.Errorf(&quot;failed putting the lifecycle event hook execution status. the status was %s&quot;, *params.Status)\n    }\n\n    return nil\n}\n\nfunc handle() error {\n    functionName := os.Getenv(&quot;FUNCTION_NAME&quot;)\n    if functionName == &quot;&quot; {\n        return fmt.Errorf(&quot;FUNCTION_NAME not set&quot;)\n    }\n    log.Printf(&quot;function name: %s&quot;, functionName)\n\n    // invoke lambda via sdk\n    input := &amp;lambdaService.InvokeInput{\n        FunctionName:   &amp;functionName,\n        Payload:        nil,\n        LogType:        aws.String(lambdaService.LogTypeTail),                   // returns the log in the response\n        InvocationType: aws.String(lambdaService.InvocationTypeRequestResponse), // synchronous - default\n    }\n    err := input.Validate()\n    if err != nil {\n        return fmt.Errorf(&quot;validating the input failed: %v&quot;, err)\n    }\n\n    resp, err := lambdaSvc.Invoke(input)\n    if err != nil {\n        return fmt.Errorf(&quot;failed to invoke lambda: %v&quot;, err)\n    }\n\n    decodeString, err := base64.StdEncoding.DecodeString(*resp.LogResult)\n    if err != nil {\n        return fmt.Errorf(&quot;failed to decode the log: %v&quot;, err)\n    }\n    log.Printf(&quot;log result: %s&quot;, decodeString)\n\n    if resp.FunctionError != nil {\n        return fmt.Errorf(&quot;lambda was invoked but returned error: %s&quot;, *resp.FunctionError)\n    }\n    return nil\n}\n\nfunc main() {\n    sess, err := session.NewSession()\n    if err != nil {\n        return\n    }\n    svc = codedeploy.New(sess)\n    lambdaSvc = lambdaService.New(sess)\n    lambda.Start(handler)\n}\n</code></pre>\n"}], "owner": {"reputation": 835, "user_id": 4920854, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/nKogO.png?s=128&g=1", "display_name": "Jonny Rimek", "link": "https://stackoverflow.com/users/4920854/jonny-rimek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 638, "favorite_count": 0, "accepted_answer_id": 57103232, "answer_count": 2, "score": 0, "last_activity_date": 1619188775, "creation_date": 1546004278, "last_edit_date": 1546096691, "question_id": 53959452, "link": "https://stackoverflow.com/questions/53959452/how-do-i-write-a-pre-post-traffic-hook-function-in-go", "title": "How do I write a pre/post traffic hook function in go?", "body": "<p>I started using AWS SAM and for now I only have some unit tests, but I want to try to run integration tests in a pre traffic hook function.</p>\n\n<p>Unfortunately there seems to be no code example for Golang, all I could find was for Javascript.</p>\n\n<p>From <a href=\"https://docs.aws.amazon.com/codedeploy/latest/userguide/reference-appspec-file-structure-hooks.html#appspec-hooks-lambda\" rel=\"nofollow noreferrer\">this</a> example I pieced together that I have to use the code deploy SDK and call <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/codedeploy/#CodeDeploy.PutLifecycleEventHookExecutionStatus\" rel=\"nofollow noreferrer\">PutLifecycleEventHookExecutionStatus</a>, but the specifics remain unclear. The <a href=\"https://github.com/awsdocs/aws-doc-sdk-examples/tree/master/go/example_code\" rel=\"nofollow noreferrer\">aws code example repo for go</a> has no examples for code deploy either.</p>\n\n<p>More Information about the topic that I am looking for is available here <a href=\"https://github.com/awslabs/serverless-application-model/blob/master/docs/safe_lambda_deployments.rst#pretraffic-posttraffic-hooks\" rel=\"nofollow noreferrer\">https://github.com/awslabs/serverless-application-model/blob/master/docs/safe_lambda_deployments.rst#pretraffic-posttraffic-hooks</a>.</p>\n\n<p>I want to start out by testing a lambda function that simply queries DynamoDB.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 4182018, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/xjRZl.jpg?s=128&g=1", "display_name": "lionheart", "link": "https://stackoverflow.com/users/4182018/lionheart"}, "edited": false, "score": 0, "creation_date": 1545993292, "post_id": 53956195, "comment_id": 94751918, "body": "Let me narrow it down .Basically lets say , my user model contains address_id field with value as bson.objectId. And the address lies in a different collection with same bson.objectId. Now how can i fetch the user object along with the complete address data in a single response ?? I hope it helps .."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 0, "last_activity_date": 1545988931, "creation_date": 1545988931, "answer_id": 53956195, "question_id": 53955748, "link": "https://stackoverflow.com/questions/53955748/mgo-example-for-populate-method/53956195#53956195", "title": "mgo example for populate method", "body": "<p>Your question is too broad, but in general if you want to fetch \"referenced\" object with a single query, you have to use MongoDB's <a href=\"https://docs.mongodb.com/manual/aggregation/\" rel=\"nofollow noreferrer\">Aggregation framework</a>, specifically the <a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/\" rel=\"nofollow noreferrer\">lookup</a> stage.</p>\n\n<p>The aggregation framework can be used from <code>mgo</code> with the <a href=\"https://godoc.org/github.com/globalsign/mgo#Collection.Pipe\" rel=\"nofollow noreferrer\"><code>Collection.Pipe()</code></a> method.</p>\n\n<p>For an example, see <a href=\"https://stackoverflow.com/questions/48163774/get-a-value-in-a-reference-of-a-lookup-with-mongodb-and-golang/48174216#48174216\">Get a value in a reference of a lookup with MongoDB and Golang</a>.</p>\n\n<p>Some more examples:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/50018938/how-to-get-the-count-value-using-lookup-in-mongodb-using-golang/50020168#50020168\">How to get the count value using $lookup in mongodb using golang?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/50944814/only-return-the-looked-up-document-with-mongo-and-golang/50945740#50945740\">Only return the looked up document with Mongo and Golang</a></p>\n"}, {"tags": [], "owner": {"reputation": 1374, "user_id": 10849350, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8t7Pj.png?s=128&g=1", "display_name": "simagix", "link": "https://stackoverflow.com/users/10849350/simagix"}, "is_accepted": false, "score": 0, "last_activity_date": 1546914410, "creation_date": 1546914410, "answer_id": 54084482, "question_id": 53955748, "link": "https://stackoverflow.com/questions/53955748/mgo-example-for-populate-method/54084482#54084482", "title": "mgo example for populate method", "body": "<p>MongoDB provides <code>$lookup</code> to perform left outer join.  Below is an example using mgo. </p>\n\n<pre><code>func TestLookup(t *testing.T) {\n    var err error\n    uri := \"mongodb://localhost/stackoverflow?replicaSet=replset\"\n    dialInfo, _ := mgo.ParseURL(uri)\n    session, _ := mgo.DialWithInfo(dialInfo)\n    c := session.DB(\"stackoverflow\").C(\"users\")\n\n    pipeline := `\n    [{\n        \"$lookup\": {\n            \"from\": \"addresses\",\n            \"localField\": \"address_id\",\n            \"foreignField\": \"_id\",\n            \"as\": \"address\"\n        }\n    }, {\n        \"$unwind\": {\n            \"path\": \"$address\"\n        }\n    }, {\n        \"$project\": {\n            \"_id\": 0,\n            \"name\": \"$name\",\n            \"address\": \"$address.address\"\n        }\n    }]\n     `\n    var v []map[string]interface{}\n    var results []bson.M\n    json.Unmarshal([]byte(pipeline), &amp;v)\n    if err = c.Pipe(v).All(&amp;results); err != nil {\n        t.Fatal(err)\n    }\n    for _, doc := range results {\n        t.Log(doc)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 4182018, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/xjRZl.jpg?s=128&g=1", "display_name": "lionheart", "link": "https://stackoverflow.com/users/4182018/lionheart"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 602, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1546914410, "creation_date": 1545986527, "last_edit_date": 1545986657, "question_id": 53955748, "link": "https://stackoverflow.com/questions/53955748/mgo-example-for-populate-method", "title": "mgo example for populate method", "body": "<p>I am new to GoLang &amp; MongoDB. I am trying to understand their relation using mgo. However , I am unable to find a suitable example on how to fetch referenced objects from mongo in Go using mgo. I have heard about populate method but no idea how mgo uses it. Can anyone throw light on the same?</p>\n"}, {"tags": ["go", "terraform"], "answers": [{"tags": [], "owner": {"reputation": 39151, "user_id": 2291321, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24a41cddd8faf69e3fbd0a778ba6fedf?s=128&d=identicon&r=PG&f=1", "display_name": "ydaetskcoR", "link": "https://stackoverflow.com/users/2291321/ydaetskcor"}, "is_accepted": false, "score": 0, "last_activity_date": 1546001485, "last_edit_date": 1546001485, "creation_date": 1546000969, "answer_id": 53958813, "question_id": 53955348, "link": "https://stackoverflow.com/questions/53955348/make-a-resource-schema-dependant-on-another-variable/53958813#53958813", "title": "Make a resource schema dependant on another variable", "body": "<p>Terraform providers don't really have a first class way to do stuff conditionally based on other parameters other than the <code>ConflictsWith</code> attribute.</p>\n\n<p>There is a hacky way to do some cross parameter stuff using <code>CustomizeDiff</code> but it's only really used in a couple of places where it's really needed.</p>\n\n<p>Normally the provider would simply validate the individual parameters and if the API that the provider is working against requires cross parameter validation then this is only seen at apply time when the API returns the error.</p>\n\n<p>For an example of using <code>CustomizeDiff</code> to throw a plan time error when doing cross parameter validation see <a href=\"https://github.com/terraform-providers/terraform-provider-aws/blob/master/aws/resource_aws_elasticache_cluster.go#L242-252\" rel=\"nofollow noreferrer\">the <code>aws_elasticache_cluster</code> resource</a>:</p>\n\n<pre><code>    CustomizeDiff: customdiff.Sequence(\n        func(diff *schema.ResourceDiff, v interface{}) error {\n            // Plan time validation for az_mode\n            // InvalidParameterCombination: Must specify at least two cache nodes in order to specify AZ Mode of 'cross-az'.\n            if v, ok := diff.GetOk(\"az_mode\"); !ok || v.(string) != elasticache.AZModeCrossAz {\n                return nil\n            }\n            if v, ok := diff.GetOk(\"num_cache_nodes\"); !ok || v.(int) != 1 {\n                return nil\n            }\n            return errors.New(`az_mode \"cross-az\" is not supported with num_cache_nodes = 1`)\n        },\n</code></pre>\n"}], "owner": {"reputation": 70, "user_id": 9428861, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Saiprasanna Sastry", "link": "https://stackoverflow.com/users/9428861/saiprasanna-sastry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 153, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1583872384, "creation_date": 1545983899, "last_edit_date": 1583872384, "question_id": 53955348, "link": "https://stackoverflow.com/questions/53955348/make-a-resource-schema-dependant-on-another-variable", "title": "Make a resource schema dependant on another variable", "body": "<p>I'm creating a plugin in Terraform and I want to add a field to the schema which can be called only when another field has been provided.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    \"host_name\": &amp;schema.Schema{\n        Type:        schema.TypeString,\n        Optional:    true,\n        DefaultFunc: schema.EnvDefaultFunc(\"host_name\", nil),\n        Description: \"Should give name in FQDN if being used for DNS puposes .\",\n    },\n    \"enableDns\": &amp;schema.Schema{\n       Type:        schema.TypeString,\n       Required:    true,\n       DefaultFunc: schema.EnvDefaultFunc(\"host_name\", nil),\n       Description: \"Should give name in FQDN if being used for DNS puposes .\",\n</code></pre>\n\n<p>Here I want to pass the <code>enableDns</code> string in the <code>.tf</code> file only when <code>host_name</code> is passed. If it is not given and I pass <code>enableDns</code> it should throw an error during plan.</p>\n"}, {"tags": ["xml", "go", "encoding"], "comments": [{"owner": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 0, "creation_date": 1545996317, "post_id": 53954457, "comment_id": 94753125, "body": "<a href=\"https://github.com/golang/go/issues/9519\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/9519</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1546006969, "post_id": 53954457, "comment_id": 94757419, "body": "Yeah it looks like there are a lot of issues with namespaces in <code>encoding&#47;xml</code> unfortunately (<a href=\"https://github.com/golang/go/issues/13400\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/13400</a>), most of which look set to be fixed in Go 1.12. In the meantime, <a href=\"https://github.com/alexrsagen/go-libxml\" rel=\"nofollow noreferrer\">github.com/alexrsagen/go-libxml</a> could potentially be a useable workaround depending on your situation."}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1546008111, "post_id": 53954457, "comment_id": 94757869, "body": "I&#39;m having trouble reproducing any round-tripping issues (<a href=\"https://play.golang.org/p/PsYJ28ZQlQQ\" rel=\"nofollow noreferrer\">play.golang.org/p/PsYJ28ZQlQQ</a>).  The XML namespaces are special; the difference in namespace prefixes shouldn&#39;t matter, and you shouldn&#39;t try to (un)marshal the <code>xmlns:xsi=&quot;...&quot;</code> namespace binding."}], "answers": [{"comments": [{"owner": {"reputation": 154, "user_id": 4476655, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-w1yQjZw-Hsk/AAAAAAAAAAI/AAAAAAAADGA/qpPQ9_ESvEU/photo.jpg?sz=128", "display_name": "Manik Taneja", "link": "https://stackoverflow.com/users/4476655/manik-taneja"}, "edited": false, "score": 0, "creation_date": 1546097730, "post_id": 53963473, "comment_id": 94779304, "body": "My apologies, my phone autocorrected the <i>now</i> to <i>not</i>. It works perfectly.  Thanks for taking the time to answer the question."}], "tags": [], "owner": {"reputation": 740, "user_id": 2471524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345a080a421b053d124139a0bce7d62e?s=128&d=identicon&r=PG", "display_name": "blobdon", "link": "https://stackoverflow.com/users/2471524/blobdon"}, "is_accepted": true, "score": 1, "last_activity_date": 1546027342, "last_edit_date": 1546027342, "creation_date": 1546025551, "answer_id": 53963473, "question_id": 53954457, "link": "https://stackoverflow.com/questions/53954457/issues-with-go-xml-encoding/53963473#53963473", "title": "Issues with Go XML encoding", "body": "<p>This struct Marshals to the XML you need, using just endcoding/xml.Marshal():</p>\n\n<pre><code>type Grantee struct {\n    Xmlns_xsi   string `xml:\"xmlns:xsi,attr,omitempty\"`  //set namespace prefix explicitly\n    Xsi_type    string `xml:\"xsi:type,attr,omitempty\"`   //set namespace:attr  explicitly\n    ID          string `xml:\",omitempty\"`\n    DisplayName string `xml:\",omitempty\"`\n}\n\ng := Grantee{\n    DisplayName: \"rahul.khan\",\n    ID:          \"xxxx-xx\",\n    Xsi_type:    \"CanonicalUser\",\n    Xmlns_xsi:   \"http://www.w3.org/2001/XMLSchema-instance\", // set namespace URI as the value of the field\n}\n\ngm, err := xml.MarshalIndent(g, \"\", \"  \")\nif err != nil {\n    fmt.Printf(\"error: %v\", err)\n    return\n}\n\nfmt.Printf(\"%+s\\n\", gm)\n\n//&lt;Grantee xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"CanonicalUser\"&gt;\n//  &lt;ID&gt;xxxx-xx&lt;/ID&gt;\n//  &lt;DisplayName&gt;rahul.khan&lt;/DisplayName&gt;\n//&lt;/Grantee&gt;\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/zrVlmktLyZu\" rel=\"nofollow noreferrer\">https://play.golang.org/p/zrVlmktLyZu</a></p>\n\n<p>Notice that the <code>xmlns:xsi</code> and <code>xsi:type</code> are just set as explicit attribute names, including the colons. As you found, if you leave a space between the namespace and attribute name, encoding/xml makes changes in an attempt to clean up the namespaces in the output (like using the final part of a namespace-URL as the namespace prefix: e.g. <code>XMLSchema-instance</code>).</p>\n\n<p>I recognize that this XML may not Unmarshal into your Go struct as you would like (as discussed in many golang issues, such as the one referenced by @Adrian in the comment to your question). But, if you're submitting to the S3 Rest API to change the ACL, it looks like this xml will be correct). The aws-go-sdk appears to use their <a href=\"https://github.com/aws/aws-sdk-go/blob/f26268b77ea9619d95b1d04b6f3e3c5a03b61110/private/protocol/xml/xmlutil/unmarshal.go#L19\" rel=\"nofollow noreferrer\">own function</a> to deserialise XML, so give it a try.</p>\n"}], "owner": {"reputation": 154, "user_id": 4476655, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-w1yQjZw-Hsk/AAAAAAAAAAI/AAAAAAAADGA/qpPQ9_ESvEU/photo.jpg?sz=128", "display_name": "Manik Taneja", "link": "https://stackoverflow.com/users/4476655/manik-taneja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 0, "accepted_answer_id": 53963473, "answer_count": 1, "score": 1, "last_activity_date": 1546027342, "creation_date": 1545977935, "question_id": 53954457, "link": "https://stackoverflow.com/questions/53954457/issues-with-go-xml-encoding", "title": "Issues with Go XML encoding", "body": "<p>I need to produce the following xml :</p>\n\n<pre><code>&lt;AccessControlList&gt;\n    &lt;Grant&gt;\n        &lt;Grantee\n            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"CanonicalUser\"&gt;\n            &lt;ID&gt;xxxx-xx&lt;/ID&gt;\n            &lt;DisplayName&gt;rahul.khan&lt;/DisplayName&gt;\n        &lt;/Grantee&gt;\n        &lt;Permission&gt;FULL_CONTROL&lt;/Permission&gt;\n    &lt;/Grant&gt;\n&lt;/AccessControlList&gt;\n</code></pre>\n\n<p>My struct is defined like this :</p>\n\n<pre><code>type Grantee struct {\nXmlns_xsi   string `xml:\"xmlns xsi,attr,omitempty\"`\nXsi_type    string `xml:\"http://www.w3.org/2001/XMLSchema-instance type,attr,omitempty\"`\nID          string `xml:\",omitempty\"`\nDisplayName string `xml:\",omitempty\"`\n</code></pre>\n\n<p>}</p>\n\n<p>However when i marshall this structure the resulting xml document that is produced looks like this :</p>\n\n<pre><code>&lt;AccessControlList&gt;\n    &lt;Grant&gt;\n        &lt;Grantee\n            xmlns:XMLSchema-instance=\"http://www.w3.org/2001/XMLSchema-instance\" XMLSchema-instance:type=\"CanonicalUser\"&gt;\n            &lt;ID&gt;xxxx-xx&lt;/ID&gt;\n            &lt;DisplayName&gt;rahul.khan&lt;/DisplayName&gt;\n        &lt;/Grantee&gt;\n        &lt;Permission&gt;FULL_CONTROL&lt;/Permission&gt;\n    &lt;/Grant&gt;\n&lt;/AccessControlList&gt;\n</code></pre>\n\n<p>As a result, when the doc is unmarshalled, the type field doesn't seem to be parsed by the aws-go-sdk. </p>\n\n<p>For e.g this is the unmarhsalled output that i need to get </p>\n\n<pre><code>Grantee: {\n    DisplayName: \"rahul.khan\",\n    ID: \"xxxx-xx\",\n    Type: \"CanonicalUser\"\n  },\n  Permission: \"FULL_CONTROL\"\n}\n</code></pre>\n\n<p>Instead what I get is this :</p>\n\n<pre><code>  Grantee: {\n    DisplayName: \"rahul.khan\",\n    ID: \"xxxx-xx\"\n  },\n  Permission: \"FULL_CONTROL\"\n}\n</code></pre>\n\n<p>The Type attribute seems to be missing from the unmarshalled output. The only difference that I see in the xml document produced by my code and from aws is this line </p>\n\n<p><code>xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"CanonicalUser\"\n</code>\nv/s</p>\n\n<p><code>xmlns:XMLSchema-instance=\"http://www.w3.org/2001/XMLSchema-instance\" XMLSchema-instance:type=\"CanonicalUser\"\n</code></p>\n\n<p>Appreciate if someone can help me understand how to fix this issue ?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "edited": false, "score": 0, "creation_date": 1545969856, "post_id": 53953530, "comment_id": 94745409, "body": "ah, ok that makes sense now.  Thanks I was getting frustrated for a bit!"}], "tags": [], "owner": {"reputation": 9542, "user_id": 8068625, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4spqa.png?s=128&g=1", "display_name": "Henry Woody", "link": "https://stackoverflow.com/users/8068625/henry-woody"}, "is_accepted": true, "score": 4, "last_activity_date": 1545969641, "creation_date": 1545969641, "answer_id": 53953530, "question_id": 53953499, "link": "https://stackoverflow.com/questions/53953499/confused-as-to-how-this-mapstringstruct-is-defined/53953530#53953530", "title": "Confused as to how this map[string]struct is defined", "body": "<p><code>testCases</code> is a map with keys of type string and values of type:</p>\n\n<pre><code>struct {\n    pod      *api.Pod\n    required []corev1.ResourceName\n    err      string\n}\n</code></pre>\n\n<p>The <code>pod</code> is a pointer to a value of type <code>api.Pod</code> (also a struct), <code>required</code> is a slice with elements of type <code>corev1.ResourceName</code>, and <code>err</code> is a string.</p>\n\n<p>So the <code>testCases</code> map will contain many strings that point to structs with the above structure.</p>\n"}, {"tags": [], "owner": {"reputation": 850, "user_id": 3894119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fbc11920a94562910843e3c6c39ddf31?s=128&d=identicon&r=PG&f=1", "display_name": "Andy Aldo", "link": "https://stackoverflow.com/users/3894119/andy-aldo"}, "is_accepted": false, "score": 4, "last_activity_date": 1545969866, "creation_date": 1545969866, "answer_id": 53953554, "question_id": 53953499, "link": "https://stackoverflow.com/questions/53953499/confused-as-to-how-this-mapstringstruct-is-defined/53953554#53953554", "title": "Confused as to how this map[string]struct is defined", "body": "<p>What comes after is sort of a \"anonymous\" struct.</p>\n\n<p>It will be the equivalent to :</p>\n\n<pre><code>testCases := map[string]StructName\n</code></pre>\n\n<p>If you had specified the struct like:</p>\n\n<pre><code>type StructName struct {\n    pod      *api.Pod\n    required []corev1.ResourceName\n    err      string\n}\n</code></pre>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 53953530, "answer_count": 2, "score": -4, "last_activity_date": 1545969866, "creation_date": 1545969332, "question_id": 53953499, "link": "https://stackoverflow.com/questions/53953499/confused-as-to-how-this-mapstringstruct-is-defined", "title": "Confused as to how this map[string]struct is defined", "body": "<p>I understand maps in go, but this code snippet confuses me:</p>\n\n<pre><code>testCases := map[string]struct {\n        pod      *api.Pod\n        required []corev1.ResourceName\n        err      string\n    }{\n        \"init container resource missing\": {\n            pod: &amp;api.Pod{\n                Spec: api.PodSpec{\n                    InitContainers: []api.Container{{\n                        Resources: api.ResourceRequirements{\n                            Requests: api.ResourceList{api.ResourceCPU: resource.MustParse(\"1m\")},\n                            Limits:   api.ResourceList{api.ResourceCPU: resource.MustParse(\"2m\")},\n                        },\n                    }},\n                },\n            },\n            required: []corev1.ResourceName{corev1.ResourceMemory},\n            err:      `must specify memory`,\n        },\n        \"container resource missing\": {\n            pod: &amp;api.Pod{\n                Spec: api.PodSpec{\n                    Containers: []api.Container{{\n                        Resources: api.ResourceRequirements{\n                            Requests: api.ResourceList{api.ResourceCPU: resource.MustParse(\"1m\")},\n                            Limits:   api.ResourceList{api.ResourceCPU: resource.MustParse(\"2m\")},\n                        },\n                    }},\n                },\n            },\n            required: []corev1.ResourceName{corev1.ResourceMemory},\n            err:      `must specify memory`,\n        },\n    }\n</code></pre>\n\n<p>I understand this:</p>\n\n<pre><code>testCases := map[string]struct\n</code></pre>\n\n<p>But what follows makes no sense to me.  How does the code go own to define an api.Pod, corev1.ResourceName etc.?\nThat is not a string to struct definition?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 39296, "user_id": 560299, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c38fe465734e8428048585e0acf6174f?s=128&d=identicon&r=PG", "display_name": "Ibu", "link": "https://stackoverflow.com/users/560299/ibu"}, "edited": false, "score": 0, "creation_date": 1545967707, "post_id": 53953333, "comment_id": 94745058, "body": "That&#39;s not the result I saw on go play."}], "answers": [{"tags": [], "owner": {"reputation": 9542, "user_id": 8068625, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4spqa.png?s=128&g=1", "display_name": "Henry Woody", "link": "https://stackoverflow.com/users/8068625/henry-woody"}, "is_accepted": true, "score": 1, "last_activity_date": 1545968385, "creation_date": 1545968385, "answer_id": 53953414, "question_id": 53953333, "link": "https://stackoverflow.com/questions/53953333/golang-slice-reference-confusion/53953414#53953414", "title": "Golang slice reference confusion", "body": "<p>This happens because the slice <code>val</code> contains pointers to its subslices, rather than the subslices themselves. In your code, you initially place a pointer to <code>values</code> in positions <code>val[0]</code>. Then you modify <code>values</code> and then set a pointer to <code>values</code> in <code>val[1]</code>. But both <code>val[0]</code> and <code>val[1]</code> point to the same underlying object (<code>values</code>), which has been modified.</p>\n\n<p>You can fix this by creating a new <code>values</code> slice on each iteration of the outer loop, this way each sub slice of <code>val</code> will be a different slice.</p>\n\n<p>For example:</p>\n\n<pre><code>func main() {\n    val := make([][]int, 2)\n    for i:=0; i&lt;2; i++ {\n        values := make([]int, 0, 100)\n        for j:=0; j&lt;2; j++ {\n            values = append(values, i+j)\n        }\n        val[i] = values\n        fmt.Println(values, val) //\n    }\n    fmt.Println(val)\n}\n</code></pre>\n\n<p>Output from <code>fmt.Println</code>:</p>\n\n<pre><code>[0 1] [[0 1] []]    // values, val\n[1 2] [[0 1] [1 2]] // values, val\n[[0 1] [1 2]]       // val\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 196, "user_id": 9782506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3049e48883dbbe112a3e33bec0acfee0?s=128&d=identicon&r=PG&f=1", "display_name": "yusher", "link": "https://stackoverflow.com/users/9782506/yusher"}, "is_accepted": false, "score": 0, "last_activity_date": 1545969043, "creation_date": 1545969043, "answer_id": 53953470, "question_id": 53953333, "link": "https://stackoverflow.com/questions/53953333/golang-slice-reference-confusion/53953470#53953470", "title": "Golang slice reference confusion", "body": "<p>You should initialize values in your for loop, <code>values = []int{}</code></p>\n\n<p>code like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    var (\n        valLength = 2\n    )\n    val := make([][]int, valLength)\n    for i := 0; i &lt; valLength; i++ {\n        values := []int{}\n        for j := 0; j &lt; 2; j++ {\n            values = append(values, i+j)\n        }\n        val[i] = values\n        fmt.Println(values, val) //\n    }\n    fmt.Println(val)\n}\n</code></pre>\n\n<p>And you only change variable <code>valLength</code> to get any length of slice you want.</p>\n"}, {"tags": [], "owner": {"reputation": 201, "user_id": 10814080, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-IHSUhxzo9Fs/AAAAAAAAAAI/AAAAAAAAAA8/RCIP5dhhB4A/photo.jpg?sz=128", "display_name": "Bob Fred", "link": "https://stackoverflow.com/users/10814080/bob-fred"}, "is_accepted": false, "score": 1, "last_activity_date": 1545969704, "creation_date": 1545969704, "answer_id": 53953534, "question_id": 53953333, "link": "https://stackoverflow.com/questions/53953333/golang-slice-reference-confusion/53953534#53953534", "title": "Golang slice reference confusion", "body": "<p>slice feature in go:</p>\n\n<blockquote>\n  <p>Slices hold references to an underlying array, and if you assign one\n  slice to another, both refer to the same array.</p>\n</blockquote>\n\n<p>The value of slice will be the last time you modify it. Thus, here's two approach to achieve the goal.</p>\n\n<p>use <strong>copy</strong></p>\n\n<pre><code>func main() {\n    values := make([]int, 0, 100)\n    val := make([][]int, 2)\n    for i := 0; i &lt; 2; i++ {\n        values = values[:0]\n        for j := 0; j &lt; 2; j++ {\n            values = append(values, i+j)\n        }\n        val[i] = make([]int, 2)\n        copy(val[i], values)\n        fmt.Println(values, val) //\n    }\n    fmt.Println(val)\n}\n</code></pre>\n\n<p>new values slice in first for-loop each time </p>\n\n<pre><code>val := make([][]int, 2)\nfor i := 0; i &lt; 2; i++ {\n    values := make([]int, 0, 2)\n    for j := 0; j &lt; 2; j++ {\n        values = append(values, i+j)\n    }\n    val[i] = values\n    fmt.Println(values, val) //\n}\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 6808805, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7HzGA.jpg?s=128&g=1", "display_name": "preyta", "link": "https://stackoverflow.com/users/6808805/preyta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 53953414, "answer_count": 3, "score": -1, "last_activity_date": 1545969704, "creation_date": 1545967492, "question_id": 53953333, "link": "https://stackoverflow.com/questions/53953333/golang-slice-reference-confusion", "title": "Golang slice reference confusion", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    values := make([]int, 0, 100)\n    val := make([][]int, 2)\n    for i:=0; i&lt;2; i++ {\n        values = values[:0]\n        for j:=0; j&lt;2; j++ {\n            values = append(values, i+j)\n        }\n        val[i] = values\n        fmt.Println(values, val) //\n    }\n    fmt.Println(val)\n}\n</code></pre>\n\n<hr>\n\n<p><a href=\"https://play.golang.org/p/5x60VfDXbFw\" rel=\"nofollow noreferrer\">https://play.golang.org/p/5x60VfDXbFw</a></p>\n\n<p>when appending slice\uff0cval is expected to be [[0, 1], [1, 2]], but got [[1,2], [1,2]]</p>\n"}]