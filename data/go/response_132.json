[{"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500500958, "post_id": 45201570, "comment_id": 77370446, "body": "There is no way to distinguish 0 from 0. What context are you using this type in where you don&#39;t know what is happening to it?"}, {"owner": {"reputation": 37, "user_id": 6801448, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dJPiLYHeJIw/AAAAAAAAAAI/AAAAAAAAABU/9FLh774uRqk/photo.jpg?sz=128", "display_name": "M.T.", "link": "https://stackoverflow.com/users/6801448/m-t"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500529165, "post_id": 45201570, "comment_id": 77378391, "body": "I have a server (backend). Users can input some data at a client (i.e. browser), for examle: timeoffset (required), gender (required, in code context - 0, 1, 2), and such things which are required and can have value is 0. This data is sended to the backend in JSON. I have to validate this data before it will be saved to a DB. After parse the data, all values which weren&#39;t filled in by users will have default values even if users didn&#39;t select anything. Also, some values can&#39;t be used without the zero value (-n ... , -1, 0, 1 ...., n)."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500555140, "post_id": 45201570, "comment_id": 77396606, "body": "Then you&#39;re asking how to different between the default value and an unset value when uaamrshaling JSON, in which case you want a pointer as Flimzy pointed out."}, {"owner": {"reputation": 37, "user_id": 6801448, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dJPiLYHeJIw/AAAAAAAAAAI/AAAAAAAAABU/9FLh774uRqk/photo.jpg?sz=128", "display_name": "M.T.", "link": "https://stackoverflow.com/users/6801448/m-t"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500570048, "post_id": 45201570, "comment_id": 77408192, "body": "But how work with case like this: <a href=\"https://play.golang.org/p/CD0s9gPZA6\" rel=\"nofollow noreferrer\">play.golang.org/p/CD0s9gPZA6</a> ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500571094, "post_id": 45201570, "comment_id": 77408825, "body": "You either use a helper function(<a href=\"https://play.golang.org/p/oQZqKC4PJe\" rel=\"nofollow noreferrer\">play.golang.org/p/oQZqKC4PJe</a>), or assign the value outside of the struct literal."}], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 6801448, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dJPiLYHeJIw/AAAAAAAAAAI/AAAAAAAAABU/9FLh774uRqk/photo.jpg?sz=128", "display_name": "M.T.", "link": "https://stackoverflow.com/users/6801448/m-t"}, "edited": false, "score": 0, "creation_date": 1500531336, "post_id": 45201659, "comment_id": 77379432, "body": "Thank you all!  I&#39;m writing here to inform you about my comment above which describes the context."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 37, "user_id": 6801448, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dJPiLYHeJIw/AAAAAAAAAAI/AAAAAAAAABU/9FLh774uRqk/photo.jpg?sz=128", "display_name": "M.T.", "link": "https://stackoverflow.com/users/6801448/m-t"}, "edited": false, "score": 0, "creation_date": 1500557565, "post_id": 45201659, "comment_id": 77398703, "body": "For your use case (unmarshaling JSON), pointers as described in my answer are usually a perfect solution."}, {"owner": {"reputation": 37, "user_id": 6801448, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dJPiLYHeJIw/AAAAAAAAAAI/AAAAAAAAABU/9FLh774uRqk/photo.jpg?sz=128", "display_name": "M.T.", "link": "https://stackoverflow.com/users/6801448/m-t"}, "edited": false, "score": 0, "creation_date": 1500566907, "post_id": 45201659, "comment_id": 77406237, "body": "Thanks, I&#39;ve created a playground (<a href=\"https://play.golang.org/p/A1TmFH3wDk\" rel=\"nofollow noreferrer\">play.golang.org/p/A1TmFH3wDk</a>) and it works as I want. :)"}, {"owner": {"reputation": 37, "user_id": 6801448, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dJPiLYHeJIw/AAAAAAAAAAI/AAAAAAAAABU/9FLh774uRqk/photo.jpg?sz=128", "display_name": "M.T.", "link": "https://stackoverflow.com/users/6801448/m-t"}, "edited": false, "score": 0, "creation_date": 1500567560, "post_id": 45201659, "comment_id": 77406690, "body": "I have one more question. How can I fill a struct of pointers in runtime? Please, see this example: <a href=\"https://play.golang.org/p/CD0s9gPZA6\" rel=\"nofollow noreferrer\">play.golang.org/p/CD0s9gPZA6</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 37, "user_id": 6801448, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dJPiLYHeJIw/AAAAAAAAAAI/AAAAAAAAABU/9FLh774uRqk/photo.jpg?sz=128", "display_name": "M.T.", "link": "https://stackoverflow.com/users/6801448/m-t"}, "edited": false, "score": 0, "creation_date": 1500571272, "post_id": 45201659, "comment_id": 77408919, "body": "@RayCarrey Two possible solutions added to your example: <a href=\"https://play.golang.org/p/zqJkvcewuy\" rel=\"nofollow noreferrer\">play.golang.org/p/zqJkvcewuy</a>"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 5, "last_activity_date": 1500501122, "creation_date": 1500501122, "answer_id": 45201659, "question_id": 45201570, "link": "https://stackoverflow.com/questions/45201570/how-to-distinguish-between-default-value-and-inputed-changed-in-golang/45201659#45201659", "title": "How to distinguish between default value and inputed/changed in Golang", "body": "<p>One common way to distinguish between the zero value and an unset value is with pointers:</p>\n\n<pre><code>type Test struct {\n    FieldInt    *int\n    FieldBool   *bool\n    FieldString *string\n}\n</code></pre>\n\n<p>This won't be an appropriate solution for every situation, though, but since you haven't told us your precise situation, I offer this simply as one possible solution.</p>\n"}, {"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1500501862, "creation_date": 1500501862, "answer_id": 45201822, "question_id": 45201570, "link": "https://stackoverflow.com/questions/45201570/how-to-distinguish-between-default-value-and-inputed-changed-in-golang/45201822#45201822", "title": "How to distinguish between default value and inputed/changed in Golang", "body": "<p>I would personally tend towards the solution Flimzy provided here for it's simplicity. But just to provide alternative options, you could add a flag for each property to indicate whether or not it's been updated.</p>\n\n<pre><code>type Test struct {\n    FieldInt int\n    FieldBool bool\n    FieldString string\n\n    intUpdated bool\n    boolUpdated bool\n    stringUpdate bool\n    // lets not export these though since it's for managing state\n    // internally and consumers of this object shouldn't modify these values\n}\n</code></pre>\n\n<p>To me this is rather a strange thing to see in Go code, however it would be very common place in JS UI apps (almost all modern apps have 'stores' which monitor the state of the UI and typically have flags to indicate whether a value in the UI has changed from what's in the store or not). For back end systems, you usually see even MORE overhead to go with this, for example it would be very common to have  fields to store the last time of update and the name of the user who updated it. In fact, that is probably the norm within the data stores for back end services.</p>\n"}], "owner": {"reputation": 37, "user_id": 6801448, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dJPiLYHeJIw/AAAAAAAAAAI/AAAAAAAAABU/9FLh774uRqk/photo.jpg?sz=128", "display_name": "M.T.", "link": "https://stackoverflow.com/users/6801448/m-t"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 377, "favorite_count": 0, "accepted_answer_id": 45201659, "answer_count": 2, "score": 0, "last_activity_date": 1500501862, "creation_date": 1500500699, "question_id": 45201570, "link": "https://stackoverflow.com/questions/45201570/how-to-distinguish-between-default-value-and-inputed-changed-in-golang", "title": "How to distinguish between default value and inputed/changed in Golang", "body": "<p>I have a struct:</p>\n\n<pre><code>package main\n\ntype Test struct {\n    FieldInt int\n    FieldBool bool\n    FieldString string\n}\n\nfunc main() {\n    test := Test{}\n    ...\n}\n</code></pre>\n\n<p>Default values of this struct is:</p>\n\n<ul>\n<li>FieldInt: 0</li>\n<li>FieldBool: false</li>\n<li>FieldString: \"\"</li>\n</ul>\n\n<p>For example, a user can change <code>FieldInt</code>. It can be a positive, negative number and 0.</p>\n\n<p>And I want to check, that the user changed it (but he/she can set 0):</p>\n\n<pre><code>if(test.FieldInt was changed) {\n    // do something\n}\n</code></pre>\n\n<p>But if the user inputted 0 then I can't distinguish between default value and inputted/changed one.</p>\n\n<p><strong>How to distinguish between default value and inputted/changed one?</strong></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 1, "creation_date": 1500496695, "post_id": 45200429, "comment_id": 77368321, "body": "Are you looking for this <a href=\"https://golang.org/ref/spec#Order_of_evaluation\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Order_of_evaluation</a>?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1500496797, "post_id": 45200429, "comment_id": 77368381, "body": "@jeevatkm if one can explain the order of <code>*a[0]</code> evaluation with it - yes. But could one? I don&#39;t see how."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1500497299, "post_id": 45200690, "comment_id": 77368674, "body": "The relevant grammar here is for the <a href=\"https://golang.org/ref/spec#UnaryExpr\" rel=\"nofollow noreferrer\">Unary Expression</a> -- unary operators apply to the expression to their right, not to the first identifier."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1500497370, "post_id": 45200690, "comment_id": 77368704, "body": "<a href=\"https://play.golang.org/p/HDw5eP6BMC\" rel=\"nofollow noreferrer\">play.golang.org/p/HDw5eP6BMC</a> - how is it a &quot;shorthand&quot; if they evaluate differently?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1500497496, "post_id": 45200690, "comment_id": 77368754, "body": "As the spec says, it works for arrays: <a href=\"https://play.golang.org/p/y898H_klZq\" rel=\"nofollow noreferrer\">play.golang.org/p/y898H_klZq</a> though it&#39;s strange that it does not work for pointers to slices."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1500497581, "post_id": 45200690, "comment_id": 77368794, "body": "Sorry, but I still cannot understand how <code>Order of Evaluation</code> declares that in <code>*a[0]</code> the index expression is done first."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1500497702, "post_id": 45200690, "comment_id": 77368856, "body": "&quot;Unary operators have the highest precedence&quot;. --- if they do, why it&#39;s not evaluated first? With slices <code>*a[0]</code> is evaluated as <code>*(a[0])</code>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1500497759, "post_id": 45200690, "comment_id": 77368882, "body": "@zerkms you got a spec ref that explains it more accurately?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1500497791, "post_id": 45200690, "comment_id": 77368903, "body": "@Adrian that&#39;s why I asked my question: I don&#39;t see anything in the spec that explains it. So either I cannot search or the spec misses it. At the moment your answer quotes &quot;Unary operators have the highest precedence&quot; while the observed behaviour is actually the opposite (and I&#39;m not even sure how the &quot;precedence&quot; can be applied at all, when one is an operator <code>*</code>, and the other <code>[]</code> is not)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1500498023, "post_id": 45200690, "comment_id": 77369027, "body": "OK, that&#39;s the best I can come up with. The spec is really not clear on this and provides bits and pieces in a lot of different sections."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1500498065, "post_id": 45200690, "comment_id": 77369048, "body": "@Adrian yep, the latest quote with the implication makes me happy enough, thanks :-)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1500498123, "post_id": 45200690, "comment_id": 77369074, "body": "We should post to the go mailing list and complain ;)"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1500498172, "post_id": 45200690, "comment_id": 77369094, "body": "Well, not complain, but address it so that the language designers could improve it, if they see it as a problem :-) If you do please update your answer with a link so that I could subscribe."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1500499528, "post_id": 45200690, "comment_id": 77369757, "body": "Reason for the deviation between slices and arrays can be found in this answer: <a href=\"https://stackoverflow.com/questions/38013922/slicing-a-slice-pointer-passed-as-argument/38014097#38014097\">Slicing a slice pointer passed as argument</a>."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1500556725, "last_edit_date": 1592644375, "creation_date": 1500497127, "answer_id": 45200690, "question_id": 45200429, "link": "https://stackoverflow.com/questions/45200429/precedence-of-index-expression-and-pointer-dereference-expression/45200690#45200690", "title": "Precedence of index expression and pointer dereference expression", "body": "<p>The definitive section is <a href=\"https://golang.org/ref/spec#Primary_expressions\" rel=\"nofollow noreferrer\">Primary Expressions</a>:</p>\n<blockquote>\n<p>Primary expressions are the operands for unary and binary expressions.</p>\n</blockquote>\n<p>It goes on to define primary expressions, but basically, this includes slice expressions, meaning that the slice expression <code>a[0]</code> is the operand for the unary operator <code>*</code>. A special case was made for pointers to arrays (see below).</p>\n<p>According to <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">Address Operators</a>:</p>\n<blockquote>\n<p>For an operand x of type T, the address operation &amp;x generates a pointer of type *T to x. The operand must be addressable, that is, either a variable, pointer indirection, or slice indexing operation; or a field selector of an addressable struct operand; or an array indexing operation of an addressable array. As an exception to the addressability requirement, x may also be a (possibly parenthesized) composite literal. If the evaluation of x would cause a run-time panic, then the evaluation of &amp;x does too.</p>\n<p>For an operand x of pointer type *T, the pointer indirection *x denotes the variable of type T pointed to by x. If x is nil, an attempt to evaluate *x will cause a run-time panic.</p>\n</blockquote>\n<p>This <em>implies</em>, but does not explicitly state, that a slice indexing expression or field selector expression to the right of the pointer indirection operator is evaluated as a whole before the indirection is evaluated.</p>\n<p>Also, pointer indirection (<code>*x</code>) <em>is</em> an operator, specifically, an <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">Address Operator</a>. The slice index reference is <em>not</em> an operator but rather an <a href=\"https://golang.org/ref/spec#Index_expressions\" rel=\"nofollow noreferrer\">Index <em>Expression</em></a>.</p>\n<p>Also note that:</p>\n<blockquote>\n<p>For a of pointer to array type:</p>\n<p><code>a[x]</code> is shorthand for <code>(*a)[x]</code></p>\n</blockquote>\n<p>Though the same cannot be said of pointers to slice types.</p>\n"}], "owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 704, "favorite_count": 0, "accepted_answer_id": 45200690, "answer_count": 1, "score": 4, "last_activity_date": 1500556725, "creation_date": 1500496168, "last_edit_date": 1500506368, "question_id": 45200429, "link": "https://stackoverflow.com/questions/45200429/precedence-of-index-expression-and-pointer-dereference-expression", "title": "Precedence of index expression and pointer dereference expression", "body": "<p>Given a simple expression like</p>\n\n<pre><code>*a[0]\n</code></pre>\n\n<p>where <code>a</code> is declared as <code>*[]string</code> (a pointer to a slice of strings).</p>\n\n<p>Where does the standard exactly explain the order in which the language constructs are evaluated?</p>\n\n<p>I've found that none of them is actually an operator, and the only couple of mentions of the <code>precedence</code> keyword mentioned in the spec:</p>\n\n<ol>\n<li><a href=\"https://golang.org/ref/spec#Notation\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Notation</a></li>\n<li><a href=\"https://golang.org/ref/spec#Operators\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Operators</a></li>\n</ol>\n\n<p>So, what part of the spec would explain the order of evaluation of the provided expression?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 3, "creation_date": 1500495036, "post_id": 45200078, "comment_id": 77367406, "body": "What is the reason to have a pointer to a slice? PS: <code>(*x.Bar)[0]</code>"}, {"owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1500495073, "post_id": 45200078, "comment_id": 77367421, "body": "I have abstracted some more complex protobuf stuff :)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1500499150, "post_id": 45200078, "comment_id": 77369560, "body": "Related / possible duplicate of: <a href=\"https://stackoverflow.com/questions/38013922/slicing-a-slice-pointer-passed-as-argument/38014097#38014097\">Slicing a slice pointer passed as argument</a>."}], "answers": [{"tags": [], "owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "is_accepted": true, "score": 7, "last_activity_date": 1500495090, "creation_date": 1500495090, "answer_id": 45200160, "question_id": 45200078, "link": "https://stackoverflow.com/questions/45200078/accessing-slice-by-index-when-slice-is-pointer/45200160#45200160", "title": "Accessing slice by index when slice is pointer", "body": "<p>It would be</p>\n\n<pre><code>(*x.Bar)[0]\n</code></pre>\n\n<p>You use parentheses to change the precedence of operators: <code>[]</code> has a higher precedence than <code>*</code>.</p>\n"}], "owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 470, "favorite_count": 0, "accepted_answer_id": 45200160, "answer_count": 1, "score": 1, "last_activity_date": 1500495090, "creation_date": 1500494793, "question_id": 45200078, "link": "https://stackoverflow.com/questions/45200078/accessing-slice-by-index-when-slice-is-pointer", "title": "Accessing slice by index when slice is pointer", "body": "<p>Is there a short hand for accessing <code>x.Bar[0]</code> in the following case? </p>\n\n<p>The direct attempt results in <code>(type *[]string does not support indexing)</code> for obvious reasons</p>\n\n<pre><code>type A struct {\n    B *[]string\n}\n\n\nx := &amp;Foo{Bar: &amp;[]string{\"1\", \"2\"}}\n</code></pre>\n"}, {"tags": ["templates", "go", "yaml", "kubernetes", "kubernetes-helm"], "answers": [{"tags": [], "owner": {"reputation": 305, "user_id": 8131948, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sX40L.png?s=128&g=1", "display_name": "Tobias Meyer", "link": "https://stackoverflow.com/users/8131948/tobias-meyer"}, "is_accepted": false, "score": 11, "last_activity_date": 1500492078, "creation_date": 1500492078, "answer_id": 45199322, "question_id": 45198856, "link": "https://stackoverflow.com/questions/45198856/golang-template-helm-iterating-over-a-list-of-maps/45199322#45199322", "title": "Golang template (helm) iterating over a list of maps", "body": "<p>Inside the loop the value of the <code>.</code> is set to the current element and you have to use <code>$.Chart.Name</code> to access your data.</p>\n\n<p>I asked a similar question and I think the answer <a href=\"https://stackoverflow.com/a/44734585/8131948\">https://stackoverflow.com/a/44734585/8131948</a> will answer your question too.</p>\n"}, {"comments": [{"owner": {"reputation": 1109, "user_id": 3151014, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VyyUn.png?s=128&g=1", "display_name": "t7tran", "link": "https://stackoverflow.com/users/3151014/t7tran"}, "edited": false, "score": 5, "creation_date": 1560208217, "post_id": 45199445, "comment_id": 99652058, "body": "Isn&#39;t <code>$.</code> for accessing global scope? E.g. <code>$.Chart.Name</code> or <code>$.Values.image.tag</code>. See <a href=\"https://github.com/helm/helm/blob/master/docs/chart_template_guide/variables.md\" rel=\"nofollow noreferrer\">Helm Docs</a>."}, {"owner": {"reputation": 160, "user_id": 4137542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gqCfw.png?s=128&g=1", "display_name": "ted-k42", "link": "https://stackoverflow.com/users/4137542/ted-k42"}, "edited": false, "score": 0, "creation_date": 1583364169, "post_id": 45199445, "comment_id": 107095485, "body": "I downvoted as the top answer is correct and saves you writing more code than required :)"}], "tags": [], "owner": {"reputation": 371, "user_id": 90958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4ccced593c59e41348469ea4a4a813a?s=128&d=identicon&r=PG", "display_name": "Victor Trac", "link": "https://stackoverflow.com/users/90958/victor-trac"}, "is_accepted": false, "score": 3, "last_activity_date": 1613786485, "last_edit_date": 1613786485, "creation_date": 1500492540, "answer_id": 45199445, "question_id": 45198856, "link": "https://stackoverflow.com/questions/45198856/golang-template-helm-iterating-over-a-list-of-maps/45199445#45199445", "title": "Golang template (helm) iterating over a list of maps", "body": "<p>I ended up saving the global context and then updating all of my references like this:</p>\n<pre class=\"lang-yaml prettyprint-override\"><code>{{ $global := . }}\n{{ range $i, $job := .Values.jobs -}}\napiVersion: batch/v1\nkind: Job\nmetadata:\n    name: {{ template &quot;name&quot; $global }}-{{ $job.name }}\n    labels:\n    chart: &quot;{{ $global.Chart.Name }}-{{ $global.Chart.Version | replace &quot;+&quot; &quot;_&quot; }}&quot;\nspec:\n    activeDeadlineSeconds: {{ $job.activeDeadlineSeconds }}\n    template:\n    metadata:\n        labels:\n        app: {{ template &quot;name&quot; $global }}-{{ $job.name }}\n    spec:\n        containers:\n        - name: {{ $global.Chart.Name }}\n        image: &quot;{{ $global.Values.image.repository }}:{{ $global.Values.image.tag }}&quot;\n        imagePullPolicy: {{ $global.Values.image.pullPolicy }}\n        command: {{ $job.command }}\n        env:\n{{ toYaml $global.Values.service.env | indent 10 }}\n        ports:\n        - containerPort: {{ $global.Values.service.internalPort }}\n{{- end }}\n</code></pre>\n"}], "owner": {"reputation": 371, "user_id": 90958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4ccced593c59e41348469ea4a4a813a?s=128&d=identicon&r=PG", "display_name": "Victor Trac", "link": "https://stackoverflow.com/users/90958/victor-trac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 20646, "favorite_count": 4, "answer_count": 2, "score": 6, "last_activity_date": 1613786485, "creation_date": 1500490453, "last_edit_date": 1552936032, "question_id": 45198856, "link": "https://stackoverflow.com/questions/45198856/golang-template-helm-iterating-over-a-list-of-maps", "title": "Golang template (helm) iterating over a list of maps", "body": "<p>I'm using helm to generate kubernetes yamls. </p>\n\n<p>My values.yaml looks like this:</p>\n\n<pre><code>...\njobs:\n  - nme: job1\n    command: [sh, -c, \"/app/deployment/start.sh job1\"]\n    activeDeadlineSeconds: 600\n  - name: job2\n    command: [sh, -c, \"/app/deployment/start.sh job2\"]\n    activeDeadlineSeconds: 600\n...\n</code></pre>\n\n<p><code>templates/jobs.yaml</code></p>\n\n<pre><code>{{ range $i, $job := .Values.jobs -}}\napiVersion: batch/v1\nkind: Job\nmetadata:\n  name: {{ template \"name\" . }}-{{ $job.name }}\n  labels:\n    chart: \"{{ .Chart.Name }}-{{ .Chart.Version | replace \"+\" \"_\" }}\"\nspec:\n  activeDeadlineSeconds: {{ $job.activeDeadlineSeconds }}\n  template:\n    metadata:\n      labels:\n        app: {{ template \"name\" . }}-{{ $job.name }}\n    spec:\n      containers:\n      - name: {{ .Chart.Name }}\n        image: \"{{ .Values.image.repository }}:{{ .Values.image.tag }}\"\n        imagePullPolicy: {{ .Values.image.pullPolicy }}\n        command: {{ $job.command }}\n        env:\n{{ toYaml .Values.service.env | indent 10 }}\n        ports:\n        - containerPort: {{ .Values.service.internalPort }}\n{{- end }}\n</code></pre>\n\n<p>Helm is failing with this error:</p>\n\n<pre><code>Error: UPGRADE FAILED: render error in \"app1/templates/jobs.yaml\": template: app1/templates/_helpers.tpl:6:18: executing \"name\" at &lt;.Chart.Name&gt;: can't evaluate field Name in type interface {}\n</code></pre>\n\n<p>When I look at _helpers.tpl:</p>\n\n<pre><code>{{- define \"name\" -}}\n{{- default .Chart.Name .Values.nameOverride | trunc 63 | trimSuffix \"-\" -}}\n{{- end -}}\n</code></pre>\n\n<p>If I remove the range loop and references to $job in my <code>jobs.yaml</code>, the _helpers.tpl <code>name</code> template works fine. When I add in the loop, it fails. </p>\n\n<p>It seems like within the loop, all dot <code>.</code> pipeline, which contains the scope for <code>.Chart</code> and <code>.Values</code>, is reassigned to something else.</p>\n\n<p>What am I doing wrong?  </p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1500488107, "post_id": 45198015, "comment_id": 77363388, "body": "The errors you&#39;re ignoring might produce some valuable info for troubleshooting."}, {"owner": {"reputation": 177, "user_id": 3599638, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fc73c07f8ec953bd108ea0ffc514c164?s=128&d=identicon&r=PG&f=1", "display_name": "m.awad", "link": "https://stackoverflow.com/users/3599638/m-awad"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1500491824, "post_id": 45198015, "comment_id": 77365593, "body": "The errors are nil i already checked and as i already mentioned the values were inserted successfully in the database @Adrian"}, {"owner": {"reputation": 3287, "user_id": 2898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/ancqg.jpg?s=128&g=1", "display_name": "Krzysztof Kowalczyk", "link": "https://stackoverflow.com/users/2898/krzysztof-kowalczyk"}, "edited": false, "score": 1, "creation_date": 1500508223, "post_id": 45198015, "comment_id": 77372693, "body": "Try Exec instead of Query, as it&#39;s insert of a single row. You can also try using LastInsertId() from it&#39;s result. Query is meant for SELECT. See <a href=\"http://go-database-sql.org/modifying.html\" rel=\"nofollow noreferrer\">go-database-sql.org/modifying.html</a>"}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1500508239, "post_id": 45198015, "comment_id": 77372696, "body": "This may be something related to the driver you&#39;re using. How many rows are you getting back? What happens if you try a QueryRow with the batch insert and Scan a single int?"}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "reply_to_user": {"reputation": 3287, "user_id": 2898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/ancqg.jpg?s=128&g=1", "display_name": "Krzysztof Kowalczyk", "link": "https://stackoverflow.com/users/2898/krzysztof-kowalczyk"}, "edited": false, "score": 0, "creation_date": 1500508297, "post_id": 45198015, "comment_id": 77372714, "body": "@KrzysztofKowalczyk The OP&#39;s question is regarding getting the IDs from multiple inserted values. <code>VALUES(1),(2),(3)</code>"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 2, "creation_date": 1500519524, "post_id": 45198015, "comment_id": 77375311, "body": "The minimum example in question works for me, i.e. I got 3 IDs. Are you sure there is no other code lines that may causing the error/unexpected result (empty ID) ?"}], "owner": {"reputation": 177, "user_id": 3599638, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fc73c07f8ec953bd108ea0ffc514c164?s=128&d=identicon&r=PG&f=1", "display_name": "m.awad", "link": "https://stackoverflow.com/users/3599638/m-awad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1254, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1500487693, "creation_date": 1500487693, "question_id": 45198015, "link": "https://stackoverflow.com/questions/45198015/go-batch-insert-returning-id-not-working", "title": "Go batch insert Returning ID not working", "body": "<p>I want to batch insert some rows and get their ids with golang, this is my attempt in doing so</p>\n\n<pre><code>import (\n    \"database/sql\"\n    \"fmt\"\n    _ \"github.com/bmizerany/pq\"\n    \"log\"\n)\nfunc main() {\nconn := fmt.Sprintf(\"host=%s user=%s password=%s dbname=%s sslmode=require\", host, user, password, dbname)\nd, err := sql.Open(\"postgres\", conn)\nrows, err := d.Query(\"INSERT INTO MYTABLE(MYCOLUMN) VALUES(1),(2),(3) RETURNING ID\")\ndefer rows.Close()\nvar ids []int\nfor rows.Next() {\n    var id int\n    scan_err := rows.Scan(&amp;id)\n    fmt.Println(scan_err)\n    if scan_err != nil {\n        log.Fatal(scan_err)\n    }\n    ids = append(ids, id)\n    fmt.Printf(\"id %d\\n\", id)\n}\n}\n</code></pre>\n\n<p>my problem is <code>ids</code> is always empty even if the values are inserted correctly in the database.</p>\n\n<p>what's interesting is that the following works</p>\n\n<pre><code>var id int\ndb.QueryRow(\"INSERT INTO MYTABLE(MYCOLUMN) VALUES(1) RETURNING ID\").Scan(&amp;id)\n</code></pre>\n\n<p>How do solve this?</p>\n"}, {"tags": ["session", "go", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 1236359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12f8b663ef9122ee0a7f4fac6ae706c6?s=128&d=identicon&r=PG", "display_name": "droneprime", "link": "https://stackoverflow.com/users/1236359/droneprime"}, "edited": false, "score": 2, "creation_date": 1500489442, "post_id": 45197671, "comment_id": 77364192, "body": "Interesting. Digging in to redistore, I saw <a href=\"https://github.com/boj/redistore/blob/v1.2/redistore.go#L242\" rel=\"nofollow noreferrer\">this</a> in the code and decided to print some stuff there. <code>ok == true</code> <b>and</b> <code>err == &quot;gob: name not registered for interface: &quot;gitlab.com&#47;droneprime&#47;spectre.host&#47;server&#47;internal&#47;handlers&zwnj;&#8203;.User&quot;&quot;</code>  That seems like a strange error to get at this point in the code? It seems like that should be in my code?"}, {"owner": {"reputation": 55, "user_id": 1236359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12f8b663ef9122ee0a7f4fac6ae706c6?s=128&d=identicon&r=PG", "display_name": "droneprime", "link": "https://stackoverflow.com/users/1236359/droneprime"}, "edited": false, "score": 3, "creation_date": 1500489790, "post_id": 45197671, "comment_id": 77364400, "body": "I solved my issue. Not only do you have to register with <code>encoding&#47;gob</code> when you put stuff in, but also when you try to access data. Thank you for encouraging me to poke in the library code. I will do that in the future first :)"}, {"owner": {"reputation": 186, "user_id": 10232153, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b73f88cd28dc5c5c62c3bd2f16c680be?s=128&d=identicon&r=PG&f=1", "display_name": "marc.soda", "link": "https://stackoverflow.com/users/10232153/marc-soda"}, "reply_to_user": {"reputation": 55, "user_id": 1236359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12f8b663ef9122ee0a7f4fac6ae706c6?s=128&d=identicon&r=PG", "display_name": "droneprime", "link": "https://stackoverflow.com/users/1236359/droneprime"}, "edited": false, "score": 1, "creation_date": 1595639351, "post_id": 45197671, "comment_id": 111553458, "body": "@droneprime this fixed my issue. It seemed bizarre that my sessions were expiring after a server reboot, and I was getting that strange gob error in a place that made no sense. Registering with encoding/gob in the right place fixed my issue"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1500486623, "creation_date": 1500486623, "answer_id": 45197671, "question_id": 45196950, "link": "https://stackoverflow.com/questions/45196950/gorilla-sessions-persistent-between-server-restarts/45197671#45197671", "title": "gorilla/sessions persistent between server restarts?", "body": "<p>I would have had the same assumptions you did, and browsing the source, it looks like it should work as you described. You might try debugging and stepping through it, particularly the <code>New</code> method for the store you're using (e.g. <a href=\"https://github.com/gorilla/sessions/blob/master/store.go#L189\" rel=\"nofollow noreferrer\"><code>FilesystemStore.New</code></a> or <a href=\"https://github.com/boj/redistore/blob/v1.2/redistore.go#L232\" rel=\"nofollow noreferrer\"><code>RediStore.New</code></a>). If that method successfully reads the cookie and finds the session in the store, it should set <code>IsNew = false</code>, according to the source.</p>\n\n<p>Also note that just checking the session ID is not a good way of validating this behavior. If you look at the source, it decodes the session ID from the cookie, <em>then</em> tries to look that up in the backing store. If the lookup fails, then the session ID will match, but <code>IsNew</code> will be <code>true</code> and there won't be any values in the session. Make sure you're setting some value in the session and check for that instead of the session ID. The behavior is different for the <code>CookieStore</code> since it stores the session data in the cookie itself.</p>\n"}], "owner": {"reputation": 55, "user_id": 1236359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12f8b663ef9122ee0a7f4fac6ae706c6?s=128&d=identicon&r=PG", "display_name": "droneprime", "link": "https://stackoverflow.com/users/1236359/droneprime"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 531, "favorite_count": 1, "accepted_answer_id": 45197671, "answer_count": 1, "score": 3, "last_activity_date": 1500486623, "creation_date": 1500484198, "question_id": 45196950, "link": "https://stackoverflow.com/questions/45196950/gorilla-sessions-persistent-between-server-restarts", "title": "gorilla/sessions persistent between server restarts?", "body": "<p>I have a general question about sessions. I am not very seasoned when it comes to this subject. I've tried with:</p>\n\n<pre><code>NewRediStore (gopkg.in/boj/redistore.v1)  \nNewCookieStore  \nNewFileSystemStore\n</code></pre>\n\n<p>I was under the impression that sessions could last between server restarts, hence the need for a 'store'. While my golang backend is running, I am able to set new sessions and retrieve them for multiple users/browsers. No problems there. </p>\n\n<p>When I restart my server, I notice that all session access results in <code>session.IsNew == true</code>.\nIn Redis, I can see all the session keys after the restart, and even verified that <code>.Get</code>ting the session results in the right ID retrieved, but <code>IsNew</code> is still set.</p>\n\n<p>I guess intuitively, this makes sense because there must be some map in memory that leads to the setting of <code>IsNew</code> but I would think that if there was any hit for the cookie key in the store, <code>IsNew</code> should not be set. Am I going crazy? Is there something easy that I am doing wrong? Is this a fundamental misunderstanding of how to use sessions?\nPlease let me know if I need to include code or additional details.</p>\n"}, {"tags": ["go", "hyperledger", "hyperledger-fabric"], "comments": [{"owner": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "edited": false, "score": 0, "creation_date": 1500559562, "post_id": 45196860, "comment_id": 77400486, "body": "What tool are you using for vendoring ? And what import path do you use for packages in the <code>vendor</code> directories ?"}, {"owner": {"reputation": 11, "user_id": 8207554, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e6f5def5d7c68e0447fb67bffd3fe3d?s=128&d=identicon&r=PG&f=1", "display_name": "Sherman Lee", "link": "https://stackoverflow.com/users/8207554/sherman-lee"}, "reply_to_user": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "edited": false, "score": 0, "creation_date": 1500576831, "post_id": 45196860, "comment_id": 77412228, "body": "@yazgazan Does it matter what tools are being used for vendoring?  I am using govendor, and the import paths are packages inside the vendor directories are the same as their original packages"}, {"owner": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "edited": false, "score": 0, "creation_date": 1500622474, "post_id": 45196860, "comment_id": 77428925, "body": "The &quot;conventional&quot; approach is to vendor binaries, not libraries. You can still get away with vendoring inside libraries if your vendoring tool flattens the dep tree (not having nested vendor directories).  You could probably fix your issue by vendoring <code>user-chaincode</code> in <code>transaction-chaincode</code> and vice-versa, but this will make maintaining vendoring a pain. The best solution, I think, is to do the vendoring in your parent directory (assuming the parent directory is the root of your repository)."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 8207554, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e6f5def5d7c68e0447fb67bffd3fe3d?s=128&d=identicon&r=PG&f=1", "display_name": "Sherman Lee", "link": "https://stackoverflow.com/users/8207554/sherman-lee"}, "edited": false, "score": 0, "creation_date": 1501520285, "post_id": 45379277, "comment_id": 77803904, "body": "Yes your understanding is correct. The problem is that I cannot mock inter-chaincode calls, as certain functions rely on invoking the other chaincode.  For example, I need to use transaction_chaincode.transaction in the user_chaincode_test, but go compiler will complain since user_chaincode_test has no way to look for the binded shim import in transaction_chaincode/vendor; it only references the path to user_chaincode/vendor, which is a mismatch for the initiation of transaction MockStub"}], "tags": [], "owner": {"reputation": 46, "user_id": 8209706, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3aa440c0bb2cb0ea9c43e1e1936e6a69?s=128&d=identicon&r=PG&f=1", "display_name": "muralisrini", "link": "https://stackoverflow.com/users/8209706/muralisrini"}, "is_accepted": false, "score": 0, "last_activity_date": 1501263023, "creation_date": 1501263023, "answer_id": 45379277, "question_id": 45196860, "link": "https://stackoverflow.com/questions/45196860/hyperledger-fabric-unit-test-cross-chaincode-invocation-without-collapsing-vendo/45379277#45379277", "title": "Hyperledger Fabric unit test cross-chaincode invocation without collapsing vendor folder", "body": "<p>If I understood correctly, you are putting shim and other dependencies in each vendor folder. user_test.go then does something like NewMockStub(..., &amp;transaction_chaincode.transaction{}).  You want transaction_chaincode.transaction to bind to user/vendor ?</p>\n\n<p>I don't think that'll happen. The shim import in transaction_chaincode.transaction will bind to its transaction_chaincode/vendor.</p>\n\n<p>If the above understanding is correct, why do you think its a \"problem\" ?</p>\n"}], "owner": {"reputation": 11, "user_id": 8207554, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e6f5def5d7c68e0447fb67bffd3fe3d?s=128&d=identicon&r=PG&f=1", "display_name": "Sherman Lee", "link": "https://stackoverflow.com/users/8207554/sherman-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 469, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1501263023, "creation_date": 1500483959, "last_edit_date": 1500564143, "question_id": 45196860, "link": "https://stackoverflow.com/questions/45196860/hyperledger-fabric-unit-test-cross-chaincode-invocation-without-collapsing-vendo", "title": "Hyperledger Fabric unit test cross-chaincode invocation without collapsing vendor folder", "body": "<p>I have been running into compilation issues when I tried to perform unit testing in golang locally, when trying to instantiate and invoke another chaincode through the MockStub object. Below is my file hierarchy:</p>\n\n<pre><code>\u251c\u2500\u2500 transaction-chaincode\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 transaction.go\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 transaction_test.go\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 vendor\n\u2514\u2500\u2500 user-chaincode\n    \u251c\u2500\u2500 user.go\n    \u251c\u2500\u2500 user_test.go\n    \u2514\u2500\u2500 vendor\n</code></pre>\n\n<p>The scenario here basically involves one of the chaincode, for example user.go, calling the other chaincode transaction.go. The vendor folders in both directories contain the exact same content.</p>\n\n<p>The problem occurs when I try to instantiate a new instance of the transaction chaincode thru shim.NewMockStub in user_test.go, as the transaction mock object looks for the init method from within transaction-chaincode/vendor/ instead of user-chaincode/vendor/, despite the vendor folders having the same packages (and thus the same method).</p>\n\n<p>I was able to get rid of this error by having a single vendor folder at the parent directory of transaction-chaincode &amp; user-chaincode, but I cannot do so for developmental purposes.  How would you suggest I solve this unit testing problem while keeping the vendor folders in their respective locations?</p>\n"}, {"tags": ["go", "jwt"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 2, "creation_date": 1500481912, "post_id": 45196147, "comment_id": 77359759, "body": "Check your errors please. An error should never be ignored with <code>_</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1500482360, "post_id": 45196147, "comment_id": 77360035, "body": "Your <code>loginEmployer</code> function isn&#39;t valid. Check that you&#39;ve copy and posted the code correctly."}], "answers": [{"tags": [], "owner": {"reputation": 133, "user_id": 4807063, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9851d6b1619d4321f9237a4cfd1c4a2?s=128&d=identicon&r=PG&f=1", "display_name": "Evan Grayson", "link": "https://stackoverflow.com/users/4807063/evan-grayson"}, "is_accepted": true, "score": 1, "last_activity_date": 1500487339, "last_edit_date": 1500487339, "creation_date": 1500486902, "answer_id": 45197769, "question_id": 45196147, "link": "https://stackoverflow.com/questions/45196147/jwtauth-verifier-fail/45197769#45197769", "title": "jwtauth.Verifier fail", "body": "<p>The problem I am seeing , which I may be incorrect, you are creating tokenAuth for each user that is logging in. There should be one instance of tokenAuth and you encode and decode using that instance. I believe the sign key should be the same for all the users, so you can verify from the tokenAuth instance. You might also want to look into signing it with RS256, because of issues in the past with HS256.</p>\n\n<p><a href=\"https://auth0.com/blog/brute-forcing-hs256-is-possible-the-importance-of-using-strong-keys-to-sign-jwts/\" rel=\"nofollow noreferrer\">https://auth0.com/blog/brute-forcing-hs256-is-possible-the-importance-of-using-strong-keys-to-sign-jwts/</a></p>\n"}], "owner": {"reputation": 11, "user_id": 8103738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/966b41aa622059fd8a77ec212728f11e?s=128&d=identicon&r=PG&f=1", "display_name": "Antoine Briaux", "link": "https://stackoverflow.com/users/8103738/antoine-briaux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 279, "favorite_count": 0, "accepted_answer_id": 45197769, "answer_count": 1, "score": -2, "last_activity_date": 1500487339, "creation_date": 1500481711, "last_edit_date": 1500482296, "question_id": 45196147, "link": "https://stackoverflow.com/questions/45196147/jwtauth-verifier-fail", "title": "jwtauth.Verifier fail", "body": "<p>I'm trying to implement <a href=\"https://github.com/go-chi/jwtauth\" rel=\"nofollow noreferrer\">jwtauth</a> but when the verify jwtoken is supposed to be activated a weird error happens.</p>\n\n<p>So, as in the example they provide, we generate and return a token this way: \n</p>\n\n<pre><code>func (s *Service) loginEmployer(w http.ResponseWriter, r *http.Request) {\nu := &amp;User{}\n\n    hashed, err := bcrypt.GenerateFromPassword([]byte(r.FormValue(\"password\")), 8)\n    if err != nil {\n        panic(err)\n    }\n\n    tokenAuth = jwtauth.New(\"HS256\", []byte(hashed), nil)\n    _, tokenString, _ := tokenAuth.Encode(jwtauth.Claims{\"login\": r.FormValue(\"login\")})\n    u.TokenString = tokenString\n    WriteJSON(w, u, 200)\n} else {\n    http.Error(w, http.StatusText(http.StatusUnauthorized), http.StatusUnauthorized)\n}\n}\n</code></pre>\n\n<p>The jwtauth.Verifier is declared as in the doc, global variable.</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>var tokenAuth *jwtauth.JwtAuth\n\nfunc routes(s *Service) *chi.Mux {\n// Private access login\nr.Group(func(r chi.Router) {\n    r.Use(jwtauth.Verifier(tokenAuth))\n    r.Use(jwtauth.Authenticator)\n    r.Mount(\"/employer\", employerRoutes())\n...\n</code></pre>\n\n<p>But when I try to access the routes within /employer,\nI get this error:</p>\n\n<pre><code>2017/07/19 18:16:22 http: panic serving 127.0.0.1:59856: runtime error: invalid memory address or nil pointer dereference\ngoroutine 15 [running]:\nnet/http.(*conn).serve.func1(0xc420019680)\n    /usr/lib/go-1.8/src/net/http/server.go:1721 +0xd0\npanic(0x7f9620, 0xa64510)\n    /usr/lib/go-1.8/src/runtime/panic.go:489 +0x2cf\ngithub.com/go-chi/jwtauth.(*JwtAuth).Decode(0x0, 0xc420192707, 0x67, 0x6, 0x6e, 0x0)\n    /home/antiaskid/go/src/github.com/go-chi/jwtauth/jwtauth.go:168 +0x40\ngithub.com/go-chi/jwtauth.VerifyRequest(0x0, 0xc4201aa400, 0xc420180b10, 0x1, 0x1, 0x0, 0x1, 0xc420180f30)\n    /home/antiaskid/go/src/github.com/go-chi/jwtauth/jwtauth.go:124 +0x154\ngithub.com/go-chi/jwtauth.Verify.func1.1(0xa40920, 0xc4201a8380, 0xc4201aa400)\n    /home/antiaskid/go/src/github.com/go-chi/jwtauth/jwtauth.go:79 +0x89\nnet/http.HandlerFunc.ServeHTTP(0xc4201ae5c0, 0xa40920, 0xc4201a8380, 0xc4201aa400)\n    /usr/lib/go-1.8/src/net/http/server.go:1942 +0x44\ngithub.com/go-chi/chi.(*ChainHandler).ServeHTTP(0xc4201ae600, 0xa40920, 0xc4201a8380, 0xc4201aa400)\n    /home/antiaskid/go/src/github.com/go-chi/chi/chain.go:29 +0x52\ngithub.com/go-chi/chi.(*Mux).routeHTTP(0xc420192150, 0xa40920, 0xc4201a8380, 0xc4201aa400)\n    /home/antiaskid/go/src/github.com/go-chi/chi/mux.go:415 +0x26d\ngithub.com/go-chi/chi.(*Mux).(github.com/go-chi/chi.routeHTTP)-fm(0xa40920, 0xc4201a8380, 0xc4201aa400)\n    /home/antiaskid/go/src/github.com/go-chi/chi/mux.go:351 +0x48\nnet/http.HandlerFunc.ServeHTTP(0xc4201808a0, 0xa40920, 0xc4201a8380, 0xc4201aa400)\n    /usr/lib/go-1.8/src/net/http/server.go:1942 +0x44\nmain.(*Service).sessionMiddleware.func1(0xa40920, 0xc4201a8380, 0xc4201aa300)\n    /home/antiaskid/go/src/bitbucket.org/victoria/middlewares.go:17 +0x148\nnet/http.HandlerFunc.ServeHTTP(0xc4201824e0, 0xa40920, 0xc4201a8380, 0xc4201aa300)\n    /usr/lib/go-1.8/src/net/http/server.go:1942 +0x44\ngithub.com/go-chi/chi.(*Mux).ServeHTTP(0xc420192150, 0xa40920, 0xc4201a8380, 0xc42000b000)\n    /home/antiaskid/go/src/github.com/go-chi/chi/mux.go:80 +0x1df\nnet/http.serverHandler.ServeHTTP(0xc4201980b0, 0xa40920, 0xc4201a8380, 0xc42000b000)\n    /usr/lib/go-1.8/src/net/http/server.go:2568 +0x92\nnet/http.(*conn).serve(0xc420019680, 0xa41020, 0xc420017300)\n    /usr/lib/go-1.8/src/net/http/server.go:1825 +0x612\ncreated by net/http.(*Server).Serve\n    /usr/lib/go-1.8/src/net/http/server.go:2668 +0x2ce\n</code></pre>\n\n<p>Their example works fine, but the init is always happening. It's written that the Verify will take the token out of the header request as \"Authorization\", if I remove the verify and check the header, the token + header name are present (r.Header.Get(\"Authorization\"))</p>\n\n<p>Any has an idea about how to have it working?</p>\n"}, {"tags": ["mysql", "json", "rest", "go"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 1514992, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8115be46fb1f5a5d565e51fc490d3f43?s=128&d=identicon&r=PG", "display_name": "user1514992", "link": "https://stackoverflow.com/users/1514992/user1514992"}, "edited": false, "score": 0, "creation_date": 1500479796, "post_id": 45195333, "comment_id": 77358524, "body": "Thank you so much. That definitely got me going int he right direction. I had previously attempted appending to the slice, but was doing it incorrectly and couldn&#39;t see the error until comparing with this. Thanks!"}], "tags": [], "owner": {"reputation": 7660, "user_id": 2350684, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yuQa5.jpg?s=128&g=1", "display_name": "Oliver", "link": "https://stackoverflow.com/users/2350684/oliver"}, "is_accepted": true, "score": 2, "last_activity_date": 1500479068, "creation_date": 1500479068, "answer_id": 45195333, "question_id": 45195127, "link": "https://stackoverflow.com/questions/45195127/correctly-remove-second-json-marshal-in-go/45195333#45195333", "title": "Correctly remove second json.Marshal in Go", "body": "<p>Turn <code>result</code> into an array of <code>*Volume</code></p>\n\n<pre><code>result := []*Volume{}\n</code></pre>\n\n<p>and then append new <code>Volume</code> records:</p>\n\n<pre><code>result = append(result, &amp;Volume{Id: id,Name:name,Description: description})\n</code></pre>\n\n<p>and in the end use <code>Marshal(result)</code> to get the JSON result.</p>\n"}], "owner": {"reputation": 33, "user_id": 1514992, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8115be46fb1f5a5d565e51fc490d3f43?s=128&d=identicon&r=PG", "display_name": "user1514992", "link": "https://stackoverflow.com/users/1514992/user1514992"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 45195333, "answer_count": 1, "score": -1, "last_activity_date": 1500479068, "creation_date": 1500478507, "question_id": 45195127, "link": "https://stackoverflow.com/questions/45195127/correctly-remove-second-json-marshal-in-go", "title": "Correctly remove second json.Marshal in Go", "body": "<p>I have, for whatever reason, while trying to build a simple Rest API in Go with MySQL storage, added a second json.Marshal which is double-encoding and producing results with escaped quotes and such. I could strip the quotes, but I think I shouldn't have two json.Marshal things happening in the first place. </p>\n\n<p>The problem is twofold - 1) which is proper to remove (leaning toward the first because \"result\" should be the larger array) and 2)how to keep the code functioning after removal?  I can't just simply remove the first one as I start encountering all sorts of errors. Here are the relevant portions of the code:</p>\n\n<pre><code>type Volume struct {\n    Id int\n    Name string\n    Description string\n}\n</code></pre>\n\n<p>... skipping ahead ....</p>\n\n<pre><code>var result = make([]string,1000)\nswitch request.Method {\n    case \"GET\":\n\n        name  := request.URL.Query().Get(\"name\")\n\n        stmt, err := db.Prepare(\"select id, name, description from idm_assets.VOLUMES where name = ?\")\n            if err != nil{\n                fmt.Print( err );\n            }\n\n            rows, err := stmt.Query(name)\n\n            if err != nil {\n                fmt.Print( err )\n            }\n\n            i := 0\n\n            for rows.Next() {\n                var name string\n                var id int\n                var description string\n                err = rows.Scan( &amp;id, &amp;name, &amp;description )\n                if err != nil {\n                    fmt.Println(\"Error scanning: \" + err.Error())\n                        return\n                }\n                volume := &amp;Volume{Id: id,Name:name,Description: description}\n</code></pre>\n\n<p>Here is the first json.Marshal ...</p>\n\n<pre><code>                b, err := json.Marshal(volume)\n                    fmt.Println(b)\n                if err != nil {\n                    fmt.Println(err)\n                    return\n                }\n                result[i] = fmt.Sprintf(\"%s\", string(b))\n                i++\n            }\n        result = result[:i]\n</code></pre>\n\n<p>...skipping other cases for PUT, DELETE, Etc. To the second json.Marshal ...</p>\n\n<pre><code>default:\n    }\njson, err := json.Marshal(result)\nif err != nil {\n    fmt.Println(err)\n    return\n}\nfmt.Fprintf(response,\"'%v'\\n\",string(json) )\n</code></pre>\n"}, {"tags": ["mysql", "database", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1500476463, "post_id": 45194312, "comment_id": 77356057, "body": "What&#39;s your question?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1500478299, "post_id": 45194312, "comment_id": 77357507, "body": "Related / possible duplicate of <a href=\"https://stackoverflow.com/questions/30867337/golang-order-by-issue-with-mysql/30867686#30867686\">Golang ORDER BY issue with MySql</a>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1500479463, "post_id": 45194312, "comment_id": 77358317, "body": "Whether <code>WHERE ? = ?</code> works depends on your database driver, and what each <code>?</code> represents. In the DBs I&#39;m familiar with (Postgres, MySQL, and SQLite), you can use variable substitution only for values, not for column names. This means if <code>f</code> is your column name, your second try (and equivalent third) is not only &quot;right&quot;, but the only option."}], "answers": [{"tags": [], "owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "is_accepted": false, "score": 1, "last_activity_date": 1500661415, "last_edit_date": 1500661415, "creation_date": 1500490202, "answer_id": 45198775, "question_id": 45194312, "link": "https://stackoverflow.com/questions/45194312/golang-database-sql-db-queryrow-with-multiple-args/45198775#45198775", "title": "Golang database/sql.DB.QueryRow with multiple args", "body": "<p>You need to provide column names directly in sql query. '?' sign is a placeholder for values you provide after sql string.\nYour Ex3. is correct, but it is not a good solution, because it is open for SQL-injection attacks. </p>\n\n<p>If you need a lightweight solution you can create a map with known column names for each table like: <code>userColumns := map[string]bool {\"id\": true, ...}</code> and then just use next check: </p>\n\n<pre><code>if userColumns[f] {\n    ...you able to use f in sql...\n} else {\n    ...provided value is not one of known columns, it is an error...\n}\n</code></pre>\n"}], "owner": {"reputation": 2810, "user_id": 5808504, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/821bb6654d488185345d86bde0a586ef?s=128&d=identicon&r=PG&f=1", "display_name": "twharmon", "link": "https://stackoverflow.com/users/5808504/twharmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2462, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1500684434, "creation_date": 1500476317, "last_edit_date": 1500684434, "question_id": 45194312, "link": "https://stackoverflow.com/questions/45194312/golang-database-sql-db-queryrow-with-multiple-args", "title": "Golang database/sql.DB.QueryRow with multiple args", "body": "<p>I want to execute a query something like this (using MySql):</p>\n\n<pre><code>select * from user where id = 5\n</code></pre>\n\n<p>Ex 1. This returns <code>err = sql.ErrNoRows</code>:</p>\n\n<pre><code>err := db.QueryRow(\"select * from user where ? = ?\", f, v).Scan(&amp;user.Id, etc...)\n</code></pre>\n\n<p>Ex 2. Since the above doesn't work, I am doing it this way, which works but doesn't feel right:</p>\n\n<pre><code>err := db.QueryRow(\"select * from user where \"+f+\" = ?\", v).Scan(&amp;user.Id, etc...)\n</code></pre>\n\n<p>What is wrong in Ex. 1? Is Ex 2. an acceptable way to do this?</p>\n\n<p>EDIT</p>\n\n<p>From the link in the comments I can do it a third way.</p>\n\n<p>Ex 3:</p>\n\n<pre><code>q := fmt.Sprintf(\"select * from user where %s = ?\", f)\nerr := db.QueryRow(q, v).Scan(&amp;user.Id, etc...)\n</code></pre>\n"}, {"tags": ["ubuntu", "docker", "go", "dockerfile", "vertica"], "answers": [{"tags": [], "owner": {"reputation": 899, "user_id": 3260209, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/100000966234908/picture?type=large", "display_name": "Prata", "link": "https://stackoverflow.com/users/3260209/prata"}, "is_accepted": false, "score": 1, "last_activity_date": 1603272007, "last_edit_date": 1603272007, "creation_date": 1500558676, "answer_id": 45216733, "question_id": 45189777, "link": "https://stackoverflow.com/questions/45189777/dockerfile-connect-to-odbce-g-hpe-vertica-setup/45216733#45216733", "title": "Dockerfile connect to ODBC(e.g. HPE Vertica) setup", "body": "<p>Finally I managed it to work with this dockerfile:</p>\n<pre><code>FROM ubuntu:artful\nMAINTAINER Prataksha Gurung &lt;prataksha.gurung@mydomain.net&gt;\nRUN apt-get update\nRUN apt-get install -y curl\n#downloading the relevant linux driver for this docker environment\nRUN curl -O https://my.vertica.com/client_drivers/8.1.x/8.1.1-0/vertica-client-8.1.1-0.x86_64.tar.gz\nRUN ls -la\nRUN tar vzxf vertica-client-8.1.1-0.x86_64.tar.gz &amp;&amp; rm vertica-client-8.1.1-0.x86_64.tar.gz\nRUN apt-get install -y unixodbc-dev\nADD .odbc.ini /root/.odbc.ini         #--&gt;your custom DNS setup\nADD vertica.ini /root/vertica.ini     #--&gt;extra odbc driver setup\nADD main /usr/bin/main                #--&gt;binary executable\nENTRYPOINT [&quot;main&quot;]\n</code></pre>\n"}], "owner": {"reputation": 899, "user_id": 3260209, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/100000966234908/picture?type=large", "display_name": "Prata", "link": "https://stackoverflow.com/users/3260209/prata"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 708, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1603272007, "creation_date": 1500465278, "last_edit_date": 1500466100, "question_id": 45189777, "link": "https://stackoverflow.com/questions/45189777/dockerfile-connect-to-odbce-g-hpe-vertica-setup", "title": "Dockerfile connect to ODBC(e.g. HPE Vertica) setup", "body": "<p>I have a simple <strong>GO</strong> program which successfully connects to Vertica in my ubuntu server. I have setup the <strong>.dobc.ini</strong> and <strong>odbc drvier</strong> in this ubuntu.</p>\n\n<pre><code>db, err := sql.Open(\"odbc\", \"DSN=HPVerticaDSN\")\nif err != nil {\n    log.Fatal(err)\n}\n\nlog.Println(\"DB ping started...\")\nif err = db.Ping(); err != nil {\n    log.Fatalf(\"DB ping failed with error...%v\", err)\n}\nlog.Println(\"DB connected.\")\ndefer db.Close()\n</code></pre>\n\n<p>Now, How do I setup the <em>Dockerfile</em> to run this in docker container. Is it possible to use light weight base image like <strong>alpine</strong> or we have to use <strong>ubuntu</strong> base image. Any examples would be greatly appreciated.</p>\n\n<p>Here is my <strong>Dockerfile</strong></p>\n\n<pre><code>FROM alpine:latest\nMAINTAINER Prataksha Gurung &lt;prataksha.gurung@mydomain.net&gt;\nRUN apk add --no-cache ca-certificates\nADD libverticaodbc.so /libverticaodbc.so\nADD .odbc.ini ~/.odbc.ini\nADD main /usr/bin/main\nENTRYPOINT [\"main\"]\n</code></pre>\n\n<p>and I am getting </p>\n\n<pre><code>panic: standard_init_linux.go:178: exec user process caused \"no such file or directory\" [recovered]\npanic: standard_init_linux.go:178: exec user process caused \"no such file or directory\"\n</code></pre>\n\n<p>when I run this container.</p>\n"}, {"tags": ["go", "struct", "embedding", "composite-literals"], "answers": [{"comments": [{"owner": {"reputation": 1600, "user_id": 4562156, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/WuCmq.jpg?s=128&g=1", "display_name": "Sean Pianka", "link": "https://stackoverflow.com/users/4562156/sean-pianka"}, "edited": false, "score": 0, "creation_date": 1575620269, "post_id": 45189658, "comment_id": 104635463, "body": "Is there a best practice when naming fields in structs which make use of embedded types?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1600, "user_id": 4562156, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/WuCmq.jpg?s=128&g=1", "display_name": "Sean Pianka", "link": "https://stackoverflow.com/users/4562156/sean-pianka"}, "edited": false, "score": 1, "creation_date": 1575620418, "post_id": 45189658, "comment_id": 104635516, "body": "@SeanPianka What do you mean? Naming fields and embedding is controversial: embedded fields are anonymous fields."}, {"owner": {"reputation": 145, "user_id": 10237506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9888f19e5b9fa62a6a8b21a067edceb?s=128&d=identicon&r=PG&f=1", "display_name": "rv.kvetch", "link": "https://stackoverflow.com/users/10237506/rv-kvetch"}, "edited": false, "score": 0, "creation_date": 1616813027, "post_id": 45189658, "comment_id": 118128655, "body": "Omitting the field names does work as mentioned, however if your struct has many fields then unfortunately you&#39;ll also be required to pass them. For example for a struct with four properties, if your embedded struct is one of the first fields then you&#39;ll need to initialize it like <code>ErrorValue{nil, NamedValue{&quot;fine&quot;, 33}, nil, nil}</code> which doesn&#39;t look as clean as passing the unqualified type name of the embedded struct in. The first method as mentioned is a bit better but I can&#39;t help but feeling it&#39;s a bit unnecessarily complicated and unwieldy (compared to a language like Python at least)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 38, "last_activity_date": 1500465228, "last_edit_date": 1500465228, "creation_date": 1500464927, "answer_id": 45189658, "question_id": 45189605, "link": "https://stackoverflow.com/questions/45189605/golang-embedded-struct-type/45189658#45189658", "title": "Golang embedded struct type", "body": "<p>Embedded types are (unnamed) fields, referred to by the unqualified type name.</p>\n\n<p><a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"noreferrer\">Spec: Struct types:</a></p>\n\n<blockquote>\n  <p>A field declared with a type but no explicit field name is an <em>anonymous field</em>, also called an <em>embedded</em> field or an embedding of the type in the struct. An embedded type must be specified as a type name <code>T</code> or as a pointer to a non-interface type name <code>*T</code>, and <code>T</code> itself may not be a pointer type. <strong>The unqualified type name acts as the field name.</strong></p>\n</blockquote>\n\n<p>So try:</p>\n\n<pre><code>e := ErrorValue{NamedValue: NamedValue{Name: \"fine\", Value: 33}, Error: err}\n</code></pre>\n\n<p>Also works if you omit the field names in the composite literal:</p>\n\n<pre><code>e := ErrorValue{NamedValue{\"fine\", 33}, err}\n</code></pre>\n\n<p>Try the examples on the <a href=\"https://play.golang.org/p/Nn9Myd3nb5\" rel=\"noreferrer\">Go Playground</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 59, "user_id": 5347670, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FYu48XvBD5c/AAAAAAAAAAI/AAAAAAAAC7s/LR5S2raIqLk/photo.jpg?sz=128", "display_name": "Anthony Anonde Tonymj", "link": "https://stackoverflow.com/users/5347670/anthony-anonde-tonymj"}, "is_accepted": false, "score": 3, "last_activity_date": 1541615425, "creation_date": 1541615425, "answer_id": 53195628, "question_id": 45189605, "link": "https://stackoverflow.com/questions/45189605/golang-embedded-struct-type/53195628#53195628", "title": "Golang embedded struct type", "body": "<p>In addition to the wonderful answer by icza.</p>\n\n<p>you can simply do this:</p>\n\n<pre><code>v := NamedValue{Name: \"fine\", Value: 33}\ne := ErrorValue{NamedValue:v, Error: err}\n</code></pre>\n\n<p>and it works just fine. checkout the example <a href=\"https://play.golang.org/p/zZZ-NKo0Z4S\" rel=\"nofollow noreferrer\">Here</a></p>\n"}, {"tags": [], "owner": {"reputation": 2401, "user_id": 1797161, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/538748ff6e44c656974e3eda5602bc93?s=128&d=identicon&r=PG", "display_name": "Federico", "link": "https://stackoverflow.com/users/1797161/federico"}, "is_accepted": false, "score": 3, "last_activity_date": 1573058034, "creation_date": 1573058034, "answer_id": 58734721, "question_id": 45189605, "link": "https://stackoverflow.com/questions/45189605/golang-embedded-struct-type/58734721#58734721", "title": "Golang embedded struct type", "body": "<p>For deeply nested structs, the accepted answer's syntax is a little verbose. For example, this :</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Alternative struct {\n    Question\n    AlternativeName string\n}\n\ntype Question struct {\n    Questionnaire\n    QuestionName  string\n}\n\ntype Questionnaire struct {\n    QuestionnaireName string\n}\n\nfunc main() {\n    a := Alternative{\n        Question: Question{\n            Questionnaire: Questionnaire{\n                QuestionnaireName: \"q\",\n            },\n        },\n    }\n    fmt.Printf(\"%v\", a)\n}\n</code></pre>\n\n<p>(<a href=\"https://play.golang.org/p/5bZDkmBl3-_d\" rel=\"nofollow noreferrer\">Go playground</a>)</p>\n\n<p>Could be rewritten like this: </p>\n\n<pre><code>a := Alternative{}\na.QuestionnaireName = \"q\"\n</code></pre>\n"}], "owner": {"reputation": 10335, "user_id": 77222, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/a538e82f454aa387b96f21e37a13ff14?s=128&d=identicon&r=PG", "display_name": "Ayman", "link": "https://stackoverflow.com/users/77222/ayman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 24065, "favorite_count": 10, "accepted_answer_id": 45189658, "answer_count": 3, "score": 25, "last_activity_date": 1573058034, "creation_date": 1500464787, "last_edit_date": 1500540189, "question_id": 45189605, "link": "https://stackoverflow.com/questions/45189605/golang-embedded-struct-type", "title": "Golang embedded struct type", "body": "<p>I have these types:</p>\n\n<pre><code>type Value interface{}\n\ntype NamedValue struct {\n    Name  string\n    Value Value\n}\n\ntype ErrorValue struct {\n    NamedValue\n    Error error\n}\n</code></pre>\n\n<p>I can use use <code>v := NamedValue{Name: \"fine\", Value: 33}</code>, but I am <em>not</em> able to use <code>e := ErrorValue{Name: \"alpha\", Value: 123, Error: err}</code></p>\n\n<p>Seems that embedding syntax was ok, but using it doesn't work?</p>\n"}, {"tags": ["go", "naming-conventions", "getter"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1500464307, "post_id": 45189126, "comment_id": 77345744, "body": "Just use the &quot;Get&quot; prefix. This is what the <a href=\"https://github.com/golang/protobuf\" rel=\"nofollow noreferrer\">Go protobuf generator</a> does."}, {"owner": {"reputation": 8698, "user_id": 961810, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh3.googleusercontent.com/-sx37srgARV4/AAAAAAAAAAI/AAAAAAAAAhw/XUlBN6N5Y6E/photo.jpg?sz=128", "display_name": "Brad Peabody", "link": "https://stackoverflow.com/users/961810/brad-peabody"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1500464525, "post_id": 45189126, "comment_id": 77345920, "body": "@TimCooper I hear you, but I&#39;d almost rather mangle the field name, since the interface method name will appear in more places (and be used across more packages) and is more important to make intuitive and idiomatic."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 5, "creation_date": 1500464588, "post_id": 45189126, "comment_id": 77345964, "body": "Why use a Getter/Setter at all if the field is exported? That&#39;s just making the interface more confusing, by allowing multiple ways to do exactly the same thing."}, {"owner": {"reputation": 8698, "user_id": 961810, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh3.googleusercontent.com/-sx37srgARV4/AAAAAAAAAAI/AAAAAAAAAhw/XUlBN6N5Y6E/photo.jpg?sz=128", "display_name": "Brad Peabody", "link": "https://stackoverflow.com/users/961810/brad-peabody"}, "edited": false, "score": 1, "creation_date": 1500465381, "post_id": 45189126, "comment_id": 77346613, "body": "See edit - it&#39;s not two ways of doing the same thing if you are trying to isolate some parts of the code via interface.  Code that knows about the struct directly uses the field, code that just knows about it via an interface uses the method."}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1500466143, "post_id": 45189126, "comment_id": 77347246, "body": "If all you need is the username then why use an interface at all? Just pass around the username."}, {"owner": {"reputation": 8698, "user_id": 961810, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh3.googleusercontent.com/-sx37srgARV4/AAAAAAAAAAI/AAAAAAAAAhw/XUlBN6N5Y6E/photo.jpg?sz=128", "display_name": "Brad Peabody", "link": "https://stackoverflow.com/users/961810/brad-peabody"}, "edited": false, "score": 0, "creation_date": 1500466310, "post_id": 45189126, "comment_id": 77347373, "body": "Because behaviors change over time and may involve multiple methods.  In this example the somethingelse package needs a <code>Username</code>.  But during the lifetime of the project we might add <code>HasRole(string)bool</code> and a few others.  It would not be an exact duplication of all the struct fields - just what it needs to know; but some of them very well might be exactly the same as field names just by coincidence."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1500471110, "post_id": 45189126, "comment_id": 77351485, "body": "How many different implementations of <code>User</code> are you expecting?"}, {"owner": {"reputation": 8698, "user_id": 961810, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh3.googleusercontent.com/-sx37srgARV4/AAAAAAAAAAI/AAAAAAAAAhw/XUlBN6N5Y6E/photo.jpg?sz=128", "display_name": "Brad Peabody", "link": "https://stackoverflow.com/users/961810/brad-peabody"}, "edited": false, "score": 0, "creation_date": 1500497971, "post_id": 45189126, "comment_id": 77368999, "body": "There&#39;s one User that I&#39;m providing as a default in a library I&#39;m writing; however developers using the library need to be able to use their own struct if they so desire - thus the need for an interface, for interaction with other parts of the system.  I&#39;ve also got at minimally 3-4 other objects/structs where this same pattern applies."}], "answers": [{"comments": [{"owner": {"reputation": 8698, "user_id": 961810, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh3.googleusercontent.com/-sx37srgARV4/AAAAAAAAAAI/AAAAAAAAAhw/XUlBN6N5Y6E/photo.jpg?sz=128", "display_name": "Brad Peabody", "link": "https://stackoverflow.com/users/961810/brad-peabody"}, "edited": false, "score": 0, "creation_date": 1500465316, "post_id": 45189630, "comment_id": 77346564, "body": "I get the idea and yes this would work but is something I&#39;d like to avoid.  Please see my OP edit for more info on what I&#39;m trying to do."}, {"owner": {"reputation": 8698, "user_id": 961810, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh3.googleusercontent.com/-sx37srgARV4/AAAAAAAAAAI/AAAAAAAAAhw/XUlBN6N5Y6E/photo.jpg?sz=128", "display_name": "Brad Peabody", "link": "https://stackoverflow.com/users/961810/brad-peabody"}, "edited": false, "score": 1, "creation_date": 1500466143, "post_id": 45189630, "comment_id": 77347247, "body": "Interesting - you&#39;re right that using two separate structs could might not be too bad.  This is a variation that will handle marshaling without custom code - the struct with the field(s) is embedded in an outer struct that has the method(s): <a href=\"https://play.golang.org/p/l_-PRmmydG\" rel=\"nofollow noreferrer\">play.golang.org/p/l_-PRmmydG</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 8698, "user_id": 961810, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh3.googleusercontent.com/-sx37srgARV4/AAAAAAAAAAI/AAAAAAAAAhw/XUlBN6N5Y6E/photo.jpg?sz=128", "display_name": "Brad Peabody", "link": "https://stackoverflow.com/users/961810/brad-peabody"}, "edited": false, "score": 1, "creation_date": 1500470688, "post_id": 45189630, "comment_id": 77351144, "body": "Using an interface is a good reason to use both structs. You should still use both structs, though, because having both getter/setter and an exported field is still really confusing, and bad design."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 9, "last_activity_date": 1616002156, "last_edit_date": 1616002156, "creation_date": 1500464851, "answer_id": 45189630, "question_id": 45189126, "link": "https://stackoverflow.com/questions/45189126/go-getter-methods-vs-fields-proper-naming/45189630#45189630", "title": "Go Getter Methods vs Fields, Proper Naming", "body": "<p>Don't use getters and setters if your fields are exported.  This just confuses the interface.</p>\n<p>If you need a getter or setter because it does something (validation, formatting, etc), or because you need the struct to satisfy an interface, then don't export the underlying field!</p>\n<p>If you need an exported field for the sake of JSON, database access, etc, <em>and</em> you need a getter/setter, then use two structs, one exported and one private, and define a custom JSON marshaler (or db access method) on the public one:</p>\n<pre><code>type jsonFoo struct {\n    Owner string `json:&quot;owner&quot;`\n}\n\ntype Foo struct {\n    owner string\n}\n\nfunc (f *Foo) SetOwner(username string) {\n    // validate/format username\n    f.owner = username\n}\n\nfunc (f *Foo) Owner() string {\n    return f.owner\n}\n\nfunc (f *Foo) MarshalJSON() ([]byte, error) {\n    return json.Marshal(jsonFoo{\n        Owner: f.owner,\n    })\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1500500916, "post_id": 45201119, "comment_id": 77370424, "body": "This solution still exports the embedded <code>Username</code> field.  Try this:  <code>x := ExportedUser{user: user{Username: &quot;joe&quot;}}; fmt.Println(x.Username)</code>. You can solve this by naming <code>*user</code> as a field in <code>ExportedUser</code> rather than embedding it, as in <code>type ExportedUser struct { user *user }</code>"}, {"owner": {"reputation": 8698, "user_id": 961810, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh3.googleusercontent.com/-sx37srgARV4/AAAAAAAAAAI/AAAAAAAAAhw/XUlBN6N5Y6E/photo.jpg?sz=128", "display_name": "Brad Peabody", "link": "https://stackoverflow.com/users/961810/brad-peabody"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1500505962, "post_id": 45201119, "comment_id": 77372057, "body": "@Flimzy Valid point - although the code in my example does compile, I guess it would be more clear and explicit to have User only have fields, and ExportedUser only have methods, and exclude any possibility of Go&#39;s syntactic sugar (where it translates u.FieldName to u.embeddedStruct.FieldName) causing confusion."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1500506069, "post_id": 45201119, "comment_id": 77372094, "body": "Sure, your code is valid, so should compile. It just doesn&#39;t resolve the concern of exposing the same data via both a getter/setter pattern and an exported variable.  But I think you understand the implications, so now you can make your decision :)"}], "tags": [], "owner": {"reputation": 8698, "user_id": 961810, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh3.googleusercontent.com/-sx37srgARV4/AAAAAAAAAAI/AAAAAAAAAhw/XUlBN6N5Y6E/photo.jpg?sz=128", "display_name": "Brad Peabody", "link": "https://stackoverflow.com/users/961810/brad-peabody"}, "is_accepted": false, "score": 3, "last_activity_date": 1500506273, "last_edit_date": 1500506273, "creation_date": 1500498868, "answer_id": 45201119, "question_id": 45189126, "link": "https://stackoverflow.com/questions/45189126/go-getter-methods-vs-fields-proper-naming/45201119#45201119", "title": "Go Getter Methods vs Fields, Proper Naming", "body": "<p>I'm going to post this as an answer, derived after considering @Flimzy's answer, which makes a lot of sense.</p>\n\n<p>The basic idea is to have one struct with exported fields which can be used for marshaling, and another separate struct which has the sole purpose of providing the methods which meet the needed interface.</p>\n\n<p>This requires no custom marshaling code, and gives a clear meaning to each struct, IMO:</p>\n\n<pre><code>type user struct {\n    Username string `json:\"username\"`\n}\n\ntype ExportedUser struct {\n    // EDIT: explicitly doing \"user *user\" instead of just doing \"*user\"\n    // helps avoid confusion between between field names and methods\n    user *user\n}\n\nfunc (u ExportedUser) Username() string { return u.user.Username }\n\nfunc main() {\n    fmt.Printf(\"Test: %q\", ExportedUser{user: &amp;user{Username: \"joe\"}}.Username())\n}\n</code></pre>\n\n<p>The question of whether it should be <code>user</code> or <code>User</code> above is a bit unclear to me - since it may make sense for the type to be visible for use in a Go template, e.g. <code>{{euser.User.SomeOtherField}}</code> Thus allowing all of the fields to be accessible if needed.  Regardless, the answer above functions the same either way.</p>\n"}], "owner": {"reputation": 8698, "user_id": 961810, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh3.googleusercontent.com/-sx37srgARV4/AAAAAAAAAAI/AAAAAAAAAhw/XUlBN6N5Y6E/photo.jpg?sz=128", "display_name": "Brad Peabody", "link": "https://stackoverflow.com/users/961810/brad-peabody"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3089, "favorite_count": 0, "answer_count": 2, "score": 6, "last_activity_date": 1616002156, "creation_date": 1500463496, "last_edit_date": 1500506609, "question_id": 45189126, "link": "https://stackoverflow.com/questions/45189126/go-getter-methods-vs-fields-proper-naming", "title": "Go Getter Methods vs Fields, Proper Naming", "body": "<p>In Effective Go, it's <a href=\"https://golang.org/doc/effective_go.html#Getters\" rel=\"nofollow noreferrer\">clearly stated</a> that in the case where a field is unexported (begins with a lower case letter) a getter method should have the same field name but starting with upper case; the example they give is a <code>owner</code> as a field and <code>Owner</code> as a method. And they explicitly advise against using <code>Get</code> in front of the getter method name.</p>\n\n<p>I frequently encounter situations where I need the field to be exported for JSON marshaling, use with an ORM, or other reflection related purposes (IIRC reflect can read but not modify unexported fields), so my field would need to be called <code>Owner</code> in the example above and thus cannot have an <code>Owner</code> method.</p>\n\n<p>Is there an idiomatic way of naming which addresses this situation?</p>\n\n<p><strong>EDIT</strong>: Here's a concrete example of what I'm running into:</p>\n\n<pre><code>type User struct {\n    Username string `db:\"username\" json:\"username\"`\n    // ...\n}\n\n// code in this package needs to do json.Unmarshal(b, &amp;user), etc.\n</code></pre>\n\n<p>.</p>\n\n<pre><code>// BUT, I want code in other packages to isolate themselves from\n// the specifics of the User struct - they don't know how it's\n// implemented, only that it has a Username field.  i.e.\npackage somethingelse\n\ntype User interface {\n    Username() string\n}\n\n// the rest of the code in this other package works against the\n// interface and is not aware of the struct directly - by design,\n// because it's important that it can be changed out without\n// affecting this code\n</code></pre>\n"}, {"tags": ["mysql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1500472584, "post_id": 45188299, "comment_id": 77352775, "body": "It&#39;s going to map your fields to columns in the database. How would you go about shoving a map into one column?"}, {"owner": {"reputation": 3514, "user_id": 1794802, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9404788dd9ecd74e3070ec684adbf439?s=128&d=identicon&r=PG", "display_name": "strongjz", "link": "https://stackoverflow.com/users/1794802/strongjz"}, "edited": false, "score": 0, "creation_date": 1500472625, "post_id": 45188299, "comment_id": 77352821, "body": "I know this is for postgres but it might help? <a href=\"http://www.booneputney.com/development/gorm-golang-jsonb-value-copy/\" rel=\"nofollow noreferrer\">booneputney.com/development/gorm-golang-jsonb-value-copy</a>"}, {"owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "reply_to_user": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1500513396, "post_id": 45188299, "comment_id": 77373847, "body": "@Gavin I&#39;ve added the DB schema to the question. Question is whether the ORM would support that. Of course I can convert it to a string field, problem with that is; it&#39;s gonna be too costly in a case where I need to read a list of entries."}], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1942, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1526592264, "creation_date": 1500461289, "last_edit_date": 1500513096, "question_id": 45188299, "link": "https://stackoverflow.com/questions/45188299/json-support-for-mysql-with-go-grom", "title": "JSON support for mysql with go-grom", "body": "<p>I'm trying to use the native JSON support introduced in MySQL 5.7.8</p>\n\n<p>Below is a quick sample app I'm trying out.</p>\n\n<p>DB Schema</p>\n\n<pre><code>CREATE TABLE IF NOT EXISTS `experiment` (\n `id`              INT NOT NULL AUTO_INCREMENT,\n `name`            VARCHAR(255) NOT NULL DEFAULT '',\n `age`             INT(10) NOT NULL DEFAULT 10,\n `content`         JSON NOT NULL,\n PRIMARY KEY (`id`)\n)ENGINE = InnoDB DEFAULT CHARSET=latin1;\n</code></pre>\n\n<p>GO code</p>\n\n<pre><code>package main\n\nimport (\n  \"github.com/jinzhu/gorm\"\n  _ \"github.com/jinzhu/gorm/dialects/mysql\"\n  \"encoding/json\"\n)\n\ntype Experiment struct {\n gorm.Model\n Name    string `json:\"name\"`\n Age     int64  `json:\"age\"`\n Content map[string]interface{} `json:\"content\"`\n}\n\nfunc main() {\n   db, err := gorm.Open(\"mysql\", \"root:root@/testdb?charset=utf8&amp;parseTime=True&amp;loc=Local\")\n   if err != nil {\n        panic(\"failed to connect database\")\n   }\n  defer db.Close()\n  j1 := []byte(`{\"name\":\"anu\", \"age\": 123, \"content\": { \"k1\" : \"v1\",  \"k2\" : [1,2,3]}}`)\n\n    var ex Experiment\n   json.Unmarshal(j1, &amp;ex)\n   // Create\n  db.Create(&amp;ex)\n}\n</code></pre>\n\n<p>Here Experiment.Content values are unpredictable. I have to use a generic map for that reasons.</p>\n\n<p>However This program throws the following error\n<code>(sql: converting Exec argument $6 type: unsupported type map[string]interface {}, a map)</code></p>\n\n<p>Is this not supported yet with the go-gorm library. What's the best way to achieve both read and write for this json content?</p>\n"}, {"tags": ["postgresql", "go", "orm", "go-pg"], "answers": [{"comments": [{"owner": {"reputation": 545, "user_id": 2140732, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/68de07a198b917b05b0274f8bed7f963?s=128&d=identicon&r=PG", "display_name": "madhukar93", "link": "https://stackoverflow.com/users/2140732/madhukar93"}, "edited": false, "score": 0, "creation_date": 1500457931, "post_id": 45186555, "comment_id": 77341284, "body": "I&#39;ll try this out and let you know, but doesn&#39;t <code>ProductID</code> already stand for <code>product_id</code> - *update: this didn&#39;t help"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 545, "user_id": 2140732, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/68de07a198b917b05b0274f8bed7f963?s=128&d=identicon&r=PG", "display_name": "madhukar93", "link": "https://stackoverflow.com/users/2140732/madhukar93"}, "edited": false, "score": 0, "creation_date": 1500459528, "post_id": 45186555, "comment_id": 77342426, "body": "You&#39;re right, this is not gonna fix your problem, I should&#39;ve read the question more carefully."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 1, "last_activity_date": 1500456844, "creation_date": 1500456844, "answer_id": 45186555, "question_id": 45185191, "link": "https://stackoverflow.com/questions/45185191/go-pg-pg-cant-find-dst-value-for-model-id/45186555#45186555", "title": "go-pg - pg: can&#39;t find dst value for model id=&quot;,&quot;", "body": "<p>You should be able to use the <code>sql</code> tag to override the default column names.</p>\n\n<pre><code>type GrProductCategoryMapping struct {\n    tableName  struct{} `sql:\"gr_product_category_mapping\"`\n    ID         int64\n    ProductID  int64 `sql:\"product_id\"`\n    CategoryID int   `sql:\"category_id\"`\n    IsPrimary  bool\n}\n</code></pre>\n\n<p>Read more <a href=\"https://github.com/go-pg/pg/wiki/Model-Definition\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 545, "user_id": 2140732, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/68de07a198b917b05b0274f8bed7f963?s=128&d=identicon&r=PG", "display_name": "madhukar93", "link": "https://stackoverflow.com/users/2140732/madhukar93"}, "is_accepted": true, "score": 0, "last_activity_date": 1500541764, "creation_date": 1500541764, "answer_id": 45210241, "question_id": 45185191, "link": "https://stackoverflow.com/questions/45185191/go-pg-pg-cant-find-dst-value-for-model-id/45210241#45210241", "title": "go-pg - pg: can&#39;t find dst value for model id=&quot;,&quot;", "body": "<p>this was a bug in which is fixed in v6.4.6.\nhere's the relevant issue - <a href=\"https://github.com/go-pg/pg/issues/583\" rel=\"nofollow noreferrer\">https://github.com/go-pg/pg/issues/583</a></p>\n"}], "owner": {"reputation": 545, "user_id": 2140732, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/68de07a198b917b05b0274f8bed7f963?s=128&d=identicon&r=PG", "display_name": "madhukar93", "link": "https://stackoverflow.com/users/2140732/madhukar93"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 785, "favorite_count": 0, "accepted_answer_id": 45210241, "answer_count": 2, "score": 0, "last_activity_date": 1500541764, "creation_date": 1500453426, "question_id": 45185191, "link": "https://stackoverflow.com/questions/45185191/go-pg-pg-cant-find-dst-value-for-model-id", "title": "go-pg - pg: can&#39;t find dst value for model id=&quot;,&quot;", "body": "<p>getting <code>pg: can't find dst value for model id=\",\"</code></p>\n\n<p>I have defined the following models</p>\n\n<pre><code>// omitting fields which don't seem relevant to the issue\n// corresponding queries also shortened as appropriate\ntype GrProduct struct {\n    tableName        struct{} `sql:\"gr_product\"`\n    ID               int64\n    Name             string\n// fk:Product,joinFK:Category given so that joins are made on category_id and product_id with gr_product_category_mapping\n    Categories       []*GrCategory               `pg:\",many2many:gr_product_category_mapping,fk:Product,joinFK:Category\"`\n    CategoryMappings []*GrProductCategoryMapping `pg:\",fk:Product\"`\n}\n\ntype GrProductCategoryMapping struct {\n    tableName  struct{} `sql:\"gr_product_category_mapping\"`\n    ID         int64\n    ProductID  int64 // product_id in db instead of gr_product_id\n    CategoryID int // category id in db instead of gr_category_id\n    IsPrimary  bool\n}\n\ntype GrCategory struct {\n    tableName                struct{} `sql:\"gr_category\"`\n    ID                       int\n    Name                     string\n    Products                 []*GrProduct `pg:\",many2many:gr_product_category_mapping,fk:Category,joinFK:Product\"`\n}\n</code></pre>\n\n<p>on trying this - </p>\n\n<pre><code>p := models.GrProduct{}\nif err := models.DB.Model(&amp;p).\n    Column(\"Categories\").\n    Where(\"id = ?\", 10).\n    Select(); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>These are the queries that are made </p>\n\n<pre><code>SELECT\n    \"gr_product\".\"id\",\n    \"gr_product\".\"name\"  \nFROM\n    gr_product AS \"gr_product\" \nWHERE\n    (\n        id= 10\n    );\n\nSELECT\n    gr_product_category_mapping.*,\n    \"gr_category\".\"id\",\n    \"gr_category\".\"name\"\n\nFROM\n    gr_category AS \"gr_category\" \nJOIN\n    gr_product_category_mapping AS gr_product_category_mapping \n        ON (\n            gr_product_category_mapping.\"product_id\"\n        ) IN (\n            (\n                10\n            )\n        ) \nWHERE\n    (\n        \"gr_category\".\"id\" = gr_product_category_mapping.\"category_id\"\n    );\n</code></pre>\n\n<p>I get <code>panic: pg: can't find dst value for model id=\",\"</code> on line <a href=\"https://github.com/go-pg/pg/blob/master/orm/model_table_m2m.go#L53\" rel=\"nofollow noreferrer\">https://github.com/go-pg/pg/blob/master/orm/model_table_m2m.go#L53</a> I think.\nOn trying to dig deeper with delve I found that that the 'prefix' <code>m.baseTable.ModelName+\"_\"</code> evaluates to <code>gr_product_</code>, but instead probably should be <code>product_</code>, since <code>columns</code> contains</p>\n\n<pre><code>map[string]string [\n        \"product_id\": \"10\",\n        \"category_id\": \"48\",\n        \"is_primary\": \"t\",\n]\n</code></pre>\n\n<p>I haven't been able to figure out how to override this default behaviour(new to both Golang and go-pg), any help would be appreciated, thanks</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 125, "user_id": 4399545, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e1ebf4600cc8dc9a9f17b8ed20c230ba?s=128&d=identicon&r=PG&f=1", "display_name": "Suresh Chatti", "link": "https://stackoverflow.com/users/4399545/suresh-chatti"}, "edited": false, "score": 0, "creation_date": 1500459500, "post_id": 45184001, "comment_id": 77342416, "body": "but if I use nohup for executing program it is still printing stdin available and when I try to read it is printing bad file descriptor"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 125, "user_id": 4399545, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e1ebf4600cc8dc9a9f17b8ed20c230ba?s=128&d=identicon&r=PG&f=1", "display_name": "Suresh Chatti", "link": "https://stackoverflow.com/users/4399545/suresh-chatti"}, "edited": false, "score": 0, "creation_date": 1500463438, "post_id": 45184001, "comment_id": 77345173, "body": "@SureshChatti How are you trying to read from it? It doesn&#39;t print error for me. Please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 125, "user_id": 4399545, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e1ebf4600cc8dc9a9f17b8ed20c230ba?s=128&d=identicon&r=PG&f=1", "display_name": "Suresh Chatti", "link": "https://stackoverflow.com/users/4399545/suresh-chatti"}, "edited": false, "score": 0, "creation_date": 1500478287, "post_id": 45184001, "comment_id": 77357500, "body": "@SureshChatti: This works, but you of course can&#39;t execute the check before you close the file descriptors. Please show a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> if you still are having trouble getting this to work."}, {"owner": {"reputation": 4452, "user_id": 2354099, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/7f136983231a6281fcb14761ef972fa0?s=128&d=identicon&r=PG", "display_name": "pinkpanther", "link": "https://stackoverflow.com/users/2354099/pinkpanther"}, "edited": false, "score": 0, "creation_date": 1502531412, "post_id": 45184001, "comment_id": 78256243, "body": "When we run the executable with <code>nohup yourgoexec</code> command, it still says that the stdin is available, but still the scanning from stdin will give bad file descriptor. So how to identify if <code>stdin</code> is not a bad file descriptor without trying to read it first? To reproduce it please execute your code with nohup command in linux."}, {"owner": {"reputation": 4452, "user_id": 2354099, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/7f136983231a6281fcb14761ef972fa0?s=128&d=identicon&r=PG", "display_name": "pinkpanther", "link": "https://stackoverflow.com/users/2354099/pinkpanther"}, "edited": false, "score": 0, "creation_date": 1502531759, "post_id": 45184001, "comment_id": 78256347, "body": "One more thing to note is, it seems like when we execute with nohup command, stdin is being piped with &quot;/dev/null&quot; which might be causing the bad file descriptor at the end, but in any case we should be able to dect it somehow."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1500450057, "creation_date": 1500450057, "answer_id": 45184001, "question_id": 45183253, "link": "https://stackoverflow.com/questions/45183253/how-to-check-os-stdin-is-available-before-prompting-for-something-with-text-ent/45184001#45184001", "title": "How to check os.stdin is available before prompting for something with text &quot;Enter input&quot;", "body": "<p><code>os.Stdin</code> is an exported variable of the <a href=\"https://golang.org/pkg/os/\" rel=\"nofollow noreferrer\"><code>os</code></a> package, it is of type <a href=\"https://golang.org/pkg/os/#File\" rel=\"nofollow noreferrer\"><code>*os.File</code></a>.</p>\n\n<p>You may call <a href=\"https://golang.org/pkg/os/#File.Stat\" rel=\"nofollow noreferrer\"><code>File.Stat()</code></a> on it to see if it's available and also to get additional info about it (e.g. if it is being piped or its source is a terminal):</p>\n\n<pre><code>if _, err := os.Stdin.Stat(); err != nil {\n    fmt.Println(\"Stdin not available:\", err)\n} else {\n    fmt.Println(\"Stdin available.\")\n}\n</code></pre>\n\n<p>Let's see an example when it's not available. It won't be if we close it first e.g. with the <a href=\"https://golang.org/pkg/os/#File.Close\" rel=\"nofollow noreferrer\"><code>File.Close()</code></a> method:</p>\n\n<pre><code>fmt.Println(\"Closing:\", os.Stdin.Close())\n\nif _, err := os.Stdin.Stat(); err != nil {\n    fmt.Println(\"Stdin not available:\", err)\n} else {\n    fmt.Println(\"Stdin available.\")\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/r_R5MAWNqi\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Stdin available.\nClosing: &lt;nil&gt;\nStdin not available: stat /dev/stdin: Bad file number\n</code></pre>\n\n<p>Also check related question: <a href=\"https://stackoverflow.com/questions/22744443/check-if-there-is-something-to-read-on-stdin-in-golang\">Check if there is something to read on STDIN in Golang</a></p>\n"}], "owner": {"reputation": 125, "user_id": 4399545, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e1ebf4600cc8dc9a9f17b8ed20c230ba?s=128&d=identicon&r=PG&f=1", "display_name": "Suresh Chatti", "link": "https://stackoverflow.com/users/4399545/suresh-chatti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 449, "favorite_count": 0, "accepted_answer_id": 45184001, "answer_count": 1, "score": 1, "last_activity_date": 1500465741, "creation_date": 1500448075, "last_edit_date": 1500465741, "question_id": 45183253, "link": "https://stackoverflow.com/questions/45183253/how-to-check-os-stdin-is-available-before-prompting-for-something-with-text-ent", "title": "How to check os.stdin is available before prompting for something with text &quot;Enter input&quot;", "body": "<p>I have to promt for  some input from os.stdin.How can I check this is available for reading before printing statements like \"Enter your text\" and then read from input.If stdin is not available it is printing bad file descriptor after \"Enter your text\". how to avoid this?</p>\n\n<pre><code>package main\nimport (\n    \"bufio\"\n    \"os\"\n    \"io\"\n    \"fmt\"\n)\nfunc main(){\nconsSource := NewConsoleAccessTokenSource(\"www.google.co.in\", os.Stdin)\nfmt.Print(\"Token: \")\n    consSource.scanner.Scan()\n    err := consSource.scanner.Err()\n    if err != nil {\n        fmt.Print(err)\n    }\n    fmt.Print(consSource.scanner.Text())\n}\nfunc NewConsoleAccessTokenSource(websiteUrl string, reader io.Reader) *ConsoleAccessTokenSource {\n    s := &amp;ConsoleAccessTokenSource{}\n    s.WebsiteUrl = websiteUrl\n    s.scanner = bufio.NewScanner(reader)\n    return s\n}\ntype ConsoleAccessTokenSource struct {\n    WebsiteUrl string\n\n    scanner *bufio.Scanner\n}\n</code></pre>\n\n<p>This is what I am trying to do .when I run this program using \"nohup executable\"\nit is giving bad file descriptor.</p>\n"}, {"tags": ["linux", "go", "ld", "icu", "alpine"], "comments": [{"owner": {"reputation": 1115, "user_id": 1177125, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/wIbfZ.gif?s=128&g=1", "display_name": "buckaroo1177125", "link": "https://stackoverflow.com/users/1177125/buckaroo1177125"}, "reply_to_user": {"reputation": 132964, "user_id": 171318, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ePRKy.jpg?s=128&g=1", "display_name": "hek2mgl", "link": "https://stackoverflow.com/users/171318/hek2mgl"}, "edited": false, "score": 0, "creation_date": 1500444606, "post_id": 45181880, "comment_id": 77332408, "body": "Sure isn&#39;t GNU - but what does this have to do with the issue?"}, {"owner": {"reputation": 132964, "user_id": 171318, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ePRKy.jpg?s=128&g=1", "display_name": "hek2mgl", "link": "https://stackoverflow.com/users/171318/hek2mgl"}, "edited": false, "score": 0, "creation_date": 1500450269, "post_id": 45181880, "comment_id": 77335946, "body": "The point is that musl is a pretty limited version of a libc. Your program links against features of the glibc. Happy porting!"}, {"owner": {"reputation": 1115, "user_id": 1177125, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/wIbfZ.gif?s=128&g=1", "display_name": "buckaroo1177125", "link": "https://stackoverflow.com/users/1177125/buckaroo1177125"}, "reply_to_user": {"reputation": 132964, "user_id": 171318, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ePRKy.jpg?s=128&g=1", "display_name": "hek2mgl", "link": "https://stackoverflow.com/users/171318/hek2mgl"}, "edited": false, "score": 0, "creation_date": 1500488064, "post_id": 45181880, "comment_id": 77363363, "body": "If forking the text package is an option, this can be resolved by removing the hard dependency to a version of icu which is only used for tests, explained here: <a href=\"https://groups.google.com/d/msg/golang-nuts/od8Obi9flDA/mtoQMc3FDAAJ\" rel=\"nofollow noreferrer\">groups.google.com/d/msg/golang-nuts/od8Obi9flDA/mtoQMc3FDAAJ</a> - this circumvents lack of understanding of musl/ld on alpine."}], "owner": {"reputation": 1115, "user_id": 1177125, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/wIbfZ.gif?s=128&g=1", "display_name": "buckaroo1177125", "link": "https://stackoverflow.com/users/1177125/buckaroo1177125"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 999, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1500444508, "creation_date": 1500443240, "last_edit_date": 1500444508, "question_id": 45181880, "link": "https://stackoverflow.com/questions/45181880/compiling-go-with-libicu-on-alpine-linux", "title": "Compiling go with libicu on alpine linux", "body": "<p>I am trying to compile a go project with a dependency on golang.org/x/text/cases which is failing with:</p>\n\n<pre><code># golang.org/x/text/cases \n/usr/lib/gcc/x86_64-alpine-linux-musl/6.2.1/../../../../x86_64-alpine-linux-musl/bin/ld: cannot find -licui18n.57\n/usr/lib/gcc/x86_64-alpine-linux-musl/6.2.1/../../../../x86_64-alpine-linux-musl/bin/ld: cannot find -licuuc.57 \ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>It is being built with go-1.8.3 in an alpine docker container. </p>\n\n<p>The icu packages I've installed are:</p>\n\n<ul>\n<li>icu-libs-57.1-r3 </li>\n<li>icu-57.1-r3 </li>\n<li>icu-dev-57.1-r3</li>\n</ul>\n\n<p>I've also tried with the these environment variables as well and it made no difference:</p>\n\n<pre><code>CGO_LDFLAGS=-L/usr/lib/icu -L/usr/lib/\nCGO_CFLAGS=-I/usr/include/unicode -I/usr/include/layout\nCGO_CPPFLAGS=-I/usr/include/unicode -I/usr/include/layout\n</code></pre>\n\n<p>No sure where else to look for what's wrong.</p>\n\n<p>I do not need to use alpine specifically and was previously using only the compiled go binary (statically linked), but I have found having the distro available for runtime debugging invaluable.</p>\n"}, {"tags": ["postgresql", "amazon-web-services", "docker", "go"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1500447575, "post_id": 45181146, "comment_id": 77334114, "body": "In Docker you can set up (virtual, for the lack of a better word) networks, which come with an DNS server. After which you can use <code>my-db-name</code> to access Postgres. Read <a href=\"https://docs.docker.com/engine/userguide/networking/\" rel=\"nofollow noreferrer\">the according docs</a>, then ask on <a href=\"http://superuser.com\">superuser.com</a> in case you have questions left."}, {"owner": {"reputation": 392, "user_id": 2757014, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cf67790fb92ee2322af057fed9a1617?s=128&d=identicon&r=PG", "display_name": "Lery", "link": "https://stackoverflow.com/users/2757014/lery"}, "edited": false, "score": 0, "creation_date": 1500461556, "post_id": 45181146, "comment_id": 77343802, "body": "There is also the <a href=\"https://docs.docker.com/engine/userguide/networking/default_network/dockerlinks/\" rel=\"nofollow noreferrer\">legacy link feature</a> (but it might get deprecated soon, who knows) which is handy for such cases."}], "answers": [{"tags": [], "owner": {"reputation": 46, "user_id": 3144840, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/usgFv.png?s=128&g=1", "display_name": "mzupan", "link": "https://stackoverflow.com/users/3144840/mzupan"}, "is_accepted": false, "score": 0, "last_activity_date": 1501862884, "creation_date": 1501862884, "answer_id": 45511266, "question_id": 45181146, "link": "https://stackoverflow.com/questions/45181146/how-does-golang-app-talk-to-postgres-using-docker-in-aws-servers/45511266#45511266", "title": "How does golang app talk to postgres using docker in aws servers?", "body": "<p>Are you asking how to configure different environments for your local development and for AWS?</p>\n\n<p>If so, you could use environment variables like this:</p>\n\n<pre><code>env := os.Getenv(\"GO_ENV\")\ndbIP := \"DOCKER_MACHINE_IP\"\nif env == \"production\" {\n    dbIP = \"AWS_POSTGRES_IP\"\n}\n</code></pre>\n\n<p>And simply provide the <code>GO_ENV</code> environment variable set to <code>production</code> to your docker container on AWS.</p>\n"}], "owner": {"reputation": 527, "user_id": 3591466, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/977d21dd4dde36df3ae73e9bef6ecf49?s=128&d=identicon&r=PG&f=1", "display_name": "user3591466", "link": "https://stackoverflow.com/users/3591466/user3591466"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 107, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1501862884, "creation_date": 1500439382, "question_id": 45181146, "link": "https://stackoverflow.com/questions/45181146/how-does-golang-app-talk-to-postgres-using-docker-in-aws-servers", "title": "How does golang app talk to postgres using docker in aws servers?", "body": "<p>I have a docker instance like this</p>\n\n<pre><code>docker run --name my-db-name -e POSTGRES_PASSWORD=mysecretpassword -d postgres:latest\n</code></pre>\n\n<p>running in a server</p>\n\n<p>And I have my golang app wrapped by docker running in the same server</p>\n\n<pre><code>func main() {\n    db, _ := sql.Open(\"postgres\", \"postgres://postgres:@192.168.99.100:5432/postgres?sslmode=disable\")\n\n    http.HandleFunc(\"/test\", handler)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>The above is not working because the ip is not correct.</p>\n\n<p>Since I am using mac, I need to use docker machine ip to connect to the docker postgres db, but in aws I don't</p>\n\n<p>What is a good way to configure this?</p>\n"}, {"tags": ["arrays", "algorithm", "search", "go"], "comments": [{"owner": {"reputation": 3873, "user_id": 2185825, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/NReIt.jpg?s=128&g=1", "display_name": "shole", "link": "https://stackoverflow.com/users/2185825/shole"}, "edited": false, "score": 0, "creation_date": 1500440063, "post_id": 45181087, "comment_id": 77330553, "body": "The algorithm is not correct, try a = {1,2,3}, b = {1,2,1,2,3}"}, {"owner": {"reputation": 5, "user_id": 8325777, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MC8fp.png?s=128&g=1", "display_name": "Benjamin.E", "link": "https://stackoverflow.com/users/8325777/benjamin-e"}, "reply_to_user": {"reputation": 3873, "user_id": 2185825, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/NReIt.jpg?s=128&g=1", "display_name": "shole", "link": "https://stackoverflow.com/users/2185825/shole"}, "edited": false, "score": 0, "creation_date": 1500443932, "post_id": 45181087, "comment_id": 77332090, "body": "@shole Thank you for pointing it out. I do not increment correctly <b>j</b> when <b>i</b> is 0. I will update the code."}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 3, "creation_date": 1500444707, "post_id": 45181087, "comment_id": 77332457, "body": "What you&#39;re dealing with is standard string search, although with a bigger alphabet. Wikipedia lists a lot of algorithms here: <a href=\"https://en.wikipedia.org/wiki/String_searching_algorithm\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/String_searching_algorithm</a> Some of them might not be easily applicable because they depend on a small alphabet, but you could do some clever things with your numbers to fix that."}, {"owner": {"reputation": 65718, "user_id": 844416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e39c2364935265593d76247ddc6d07c?s=128&d=identicon&r=PG", "display_name": "MBo", "link": "https://stackoverflow.com/users/844416/mbo"}, "edited": false, "score": 0, "creation_date": 1500445354, "post_id": 45181087, "comment_id": 77332762, "body": "Sub-sequence assumes that items might be non-consecutive. Is it what you want?"}, {"owner": {"reputation": 3873, "user_id": 2185825, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/NReIt.jpg?s=128&g=1", "display_name": "shole", "link": "https://stackoverflow.com/users/2185825/shole"}, "edited": false, "score": 0, "creation_date": 1500447196, "post_id": 45181087, "comment_id": 77333882, "body": "Please let me know if you have updated the code, as from my knowledge, an O(max(a,b)) algorithm should be optimal using KMP, rabin-karp, or other singe pattern string matching problem, which no one&#39;s implementation looks alike your code. So I am more interested into how you do the string matching in O(b) using your own algorithm :)"}, {"owner": {"reputation": 5, "user_id": 8325777, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MC8fp.png?s=128&g=1", "display_name": "Benjamin.E", "link": "https://stackoverflow.com/users/8325777/benjamin-e"}, "reply_to_user": {"reputation": 3873, "user_id": 2185825, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/NReIt.jpg?s=128&g=1", "display_name": "shole", "link": "https://stackoverflow.com/users/2185825/shole"}, "edited": false, "score": 0, "creation_date": 1500451094, "post_id": 45181087, "comment_id": 77336514, "body": "@shole I have updated the code, also please note that I am not sure that my implementation is O(b) :). If I would be sure of it I would not be asking this question."}, {"owner": {"reputation": 3873, "user_id": 2185825, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/NReIt.jpg?s=128&g=1", "display_name": "shole", "link": "https://stackoverflow.com/users/2185825/shole"}, "edited": false, "score": 0, "creation_date": 1500453255, "post_id": 45181087, "comment_id": 77337892, "body": "Still not correct, try    a = {1, 2, 1, 2, 1}, b { 1, 1, 2, 2, 1, 2, 1 }"}, {"owner": {"reputation": 5, "user_id": 8325777, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MC8fp.png?s=128&g=1", "display_name": "Benjamin.E", "link": "https://stackoverflow.com/users/8325777/benjamin-e"}, "reply_to_user": {"reputation": 3873, "user_id": 2185825, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/NReIt.jpg?s=128&g=1", "display_name": "shole", "link": "https://stackoverflow.com/users/2185825/shole"}, "edited": false, "score": 0, "creation_date": 1500453446, "post_id": 45181087, "comment_id": 77338040, "body": "@shole, true, I just found it."}, {"owner": {"reputation": 3873, "user_id": 2185825, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/NReIt.jpg?s=128&g=1", "display_name": "shole", "link": "https://stackoverflow.com/users/2185825/shole"}, "edited": false, "score": 0, "creation_date": 1500453557, "post_id": 45181087, "comment_id": 77338130, "body": "basically i am not suspecting the complexity of your algorithm. I am suspecting the correctness of it given that it achieves O(b) AND it does not look like those well-known O(b) algorithm"}, {"owner": {"reputation": 5, "user_id": 8325777, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MC8fp.png?s=128&g=1", "display_name": "Benjamin.E", "link": "https://stackoverflow.com/users/8325777/benjamin-e"}, "reply_to_user": {"reputation": 3873, "user_id": 2185825, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/NReIt.jpg?s=128&g=1", "display_name": "shole", "link": "https://stackoverflow.com/users/2185825/shole"}, "edited": false, "score": 1, "creation_date": 1500454071, "post_id": 45181087, "comment_id": 77338481, "body": "@shole: I really do appreciate your insight. I have changed the code again. Unfortunately the process looks like poking with a stick in pond and expect to catch fish. In order to be sure that it works I think the algorithm has to be mathematically proven."}, {"owner": {"reputation": 3873, "user_id": 2185825, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/NReIt.jpg?s=128&g=1", "display_name": "shole", "link": "https://stackoverflow.com/users/2185825/shole"}, "edited": false, "score": 0, "creation_date": 1500454801, "post_id": 45181087, "comment_id": 77339030, "body": "Then it&#39;s your part now :)  You have two options: 1. Learn standard string matching algorithm (KMP for your case is perfect) and implement it  2. Try to sketch a proof of your current algorithm, compared to the logic of those standard one, and proof it is correct / wrong.    For complexity stuff, yes your current code is O(b) as <code>i</code> will increase by 1 no matter what, while for standard one it&#39;s also O(max(a,b)) which is the optimal to reply your OP"}, {"owner": {"reputation": 5, "user_id": 8325777, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MC8fp.png?s=128&g=1", "display_name": "Benjamin.E", "link": "https://stackoverflow.com/users/8325777/benjamin-e"}, "reply_to_user": {"reputation": 3873, "user_id": 2185825, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/NReIt.jpg?s=128&g=1", "display_name": "shole", "link": "https://stackoverflow.com/users/2185825/shole"}, "edited": false, "score": 0, "creation_date": 1500455237, "post_id": 45181087, "comment_id": 77339309, "body": "@shole If you make your comment a <i>response</i> I will vote for it."}], "answers": [{"comments": [{"owner": {"reputation": 5, "user_id": 8325777, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MC8fp.png?s=128&g=1", "display_name": "Benjamin.E", "link": "https://stackoverflow.com/users/8325777/benjamin-e"}, "edited": false, "score": 0, "creation_date": 1500443983, "post_id": 45181900, "comment_id": 77332117, "body": "What interests me is an algorithmic perspective."}, {"owner": {"reputation": 1704, "user_id": 2912740, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/4730dc939ce11655d239d1f54a9cd399?s=128&d=identicon&r=PG&f=1", "display_name": "Edwinner", "link": "https://stackoverflow.com/users/2912740/edwinner"}, "reply_to_user": {"reputation": 5, "user_id": 8325777, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MC8fp.png?s=128&g=1", "display_name": "Benjamin.E", "link": "https://stackoverflow.com/users/8325777/benjamin-e"}, "edited": false, "score": 0, "creation_date": 1500445084, "post_id": 45181900, "comment_id": 77332636, "body": "If i am not wrong, the strings package employs Rabin-Karp algorithm at some point."}, {"owner": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "edited": false, "score": 0, "creation_date": 1500454790, "post_id": 45181900, "comment_id": 77339019, "body": "A quick and dirty solution. You could have at least tried to keep the code of the <code>main</code> function of the question and only replace the implementation of the <code>match</code> function."}, {"owner": {"reputation": 1704, "user_id": 2912740, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/4730dc939ce11655d239d1f54a9cd399?s=128&d=identicon&r=PG&f=1", "display_name": "Edwinner", "link": "https://stackoverflow.com/users/2912740/edwinner"}, "edited": false, "score": 0, "creation_date": 1500596528, "post_id": 45181900, "comment_id": 77420471, "body": "OP had asked for a better way. I don&#39;t see anything wrong with this answer as it even turns out all answers lead the OP to a similar implementation in algorithm."}], "tags": [], "owner": {"reputation": 1704, "user_id": 2912740, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/4730dc939ce11655d239d1f54a9cd399?s=128&d=identicon&r=PG&f=1", "display_name": "Edwinner", "link": "https://stackoverflow.com/users/2912740/edwinner"}, "is_accepted": false, "score": -1, "last_activity_date": 1500446844, "last_edit_date": 1500446844, "creation_date": 1500443305, "answer_id": 45181900, "question_id": 45181087, "link": "https://stackoverflow.com/questions/45181087/find-a-sequence-of-integers-in-a-given-array/45181900#45181900", "title": "Find a sequence of integers in a given array", "body": "<p>Since you are only looking for a sequence, i would probably convert everything to string type and use the standard strings package.\n<a href=\"https://play.golang.org/p/Epc09TsE56\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    fmt.Println(strings.Contains(\"1, 2, 3, 4, 5, 6, 7, 8, 9\", \"1, 2, 3\"))\n    fmt.Println(strings.Contains(\"4, 5, 6, 7, 8, 9\", \"1, 2, 3\"))\n    fmt.Println(strings.Contains(\"1, 5, 3, 7, 8, 9\", \"1, 2, 3\"))\n    fmt.Println(strings.Contains(\"4, 5, 1, 7, 3, 9\", \"1, 2, 3\"))\n    fmt.Println(strings.Contains(\"4, 5, 6, 1, 2, 3\", \"1, 2, 3\"))\n    fmt.Println(strings.Contains(\"4, 5, 6, 1, 2, 3, 2\", \"1, 2, 2, 3\"))\n    fmt.Println(strings.Contains(\"1, 2, 1, 2, 3\", \"1, 2, 3\"))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3873, "user_id": 2185825, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/NReIt.jpg?s=128&g=1", "display_name": "shole", "link": "https://stackoverflow.com/users/2185825/shole"}, "is_accepted": true, "score": 1, "last_activity_date": 1500455943, "creation_date": 1500455943, "answer_id": 45186174, "question_id": 45181087, "link": "https://stackoverflow.com/questions/45181087/find-a-sequence-of-integers-in-a-given-array/45186174#45186174", "title": "Find a sequence of integers in a given array", "body": "<h1>Correctness</h1>\n\n<p>As discussed in the comment section, there are a family of string matching algorithms, which normally categorized into single pattern and multiple pattern matching algorithm. In your case it belongs to single pattern string matching problem. </p>\n\n<p>From my knowledge, the most well-known algorithm is KMP algorithm which uses dynamic programming, and an alternative named Rabin-Karp's algorithm which uses rolling hash technique to speed up the process. Both runs in <code>O(max(a,b))</code>.</p>\n\n<p>However, your code is not very alike to these algorithm's normal implementation, at least to my experience. Therefore I suspect the correctness of your code at the first place. You can try cases like <code>a = {1, 2, 1, 2, 1}, b { 1, 1, 2, 2, 1, 2, 1 }</code> to see it is not giving correct result.</p>\n\n<p>Therefore you can</p>\n\n<ol>\n<li>Abandon current algorithm and learn those standard one, implement them</li>\n<li>Outline the logic and sketch a proof of your current algorithm, compared it with the logic behind those standard algorithms to verify its correctness</li>\n</ol>\n\n<p>I will leave this part to you</p>\n\n<h1>Complexity</h1>\n\n<p>To directly answer your OP: </p>\n\n<p>No, <code>O(max(a,b))</code> is the optimal you can achieve in this problem, which is also the complexity of the standard known algorithms mentioned above.</p>\n\n<p>My understanding is that, it actually makes sense as at worst case, you HAVE TO read each character of the longer string at least 1 time.</p>\n\n<p>Your current algorithm is also <code>O(b)</code> clearly, as you loop using <code>i</code> from 0 to length of <code>b</code>, and no matter which condition you fall into <code>i</code> will increase by 1, giving total <code>O(b)</code></p>\n\n<hr>\n\n<p>Therefore complexity is actually not the problem, the correctness is the problem.</p>\n"}], "owner": {"reputation": 5, "user_id": 8325777, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MC8fp.png?s=128&g=1", "display_name": "Benjamin.E", "link": "https://stackoverflow.com/users/8325777/benjamin-e"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 496, "favorite_count": 0, "accepted_answer_id": 45186174, "answer_count": 2, "score": 0, "last_activity_date": 1500455943, "creation_date": 1500439086, "last_edit_date": 1500453928, "question_id": 45181087, "link": "https://stackoverflow.com/questions/45181087/find-a-sequence-of-integers-in-a-given-array", "title": "Find a sequence of integers in a given array", "body": "<p>I would like to know if there is a better way (in the case my implementation is correct) to find a sub-sequence of integers in a given array. I have implemented the solution using golang (if this is an impediment for a review I could use a different language). If I am not mistaken the bellow implementation is close to O(b).</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    a := []int{1, 2, 3}\n    b := []int{1, 2, 3, 4, 5, 6, 7, 8, 9}\n    r := match(a, b)\n\n    fmt.Println(\"Match found for case 1: \", r)\n\n    a = []int{1, 2, 3}\n    b = []int{4, 5, 6, 7, 8, 9}\n    r = match(a, b)\n\n    fmt.Println(\"Match found for case 2: \", r)\n\n    a = []int{1, 2, 3}\n    b = []int{1, 5, 3, 7, 8, 9}\n    r = match(a, b)\n\n    fmt.Println(\"Match found for case 3: \", r)\n\n    a = []int{1, 2, 3}\n    b = []int{4, 5, 1, 7, 3, 9}\n    r = match(a, b)\n\n    fmt.Println(\"Match found for case 4: \", r)\n\n    a = []int{1, 2, 3}\n    b = []int{4, 5, 6, 1, 2, 3}\n    r = match(a, b)\n\n    fmt.Println(\"Match found for case 5: \", r)\n\n    a = []int{1, 2, 3}\n    b = []int{1, 2, 1, 2, 3}\n    r = match(a, b)\n\n    fmt.Println(\"Match found for case 6: \", r)\n\n    a = []int{1, 2, 3, 4, 5}\n    b = []int{4, 1, 5, 3, 6, 1, 2, 4, 4, 5, 7, 8, 1, 2, 2, 4, 1, 3, 3, 4}\n    r = match(a, b)\n\n    fmt.Println(\"Match found for case 7: \", r)\n\n    a = []int{1, 2, 1, 2, 1}\n    b = []int{1, 1, 2, 2, 1, 2, 1}\n    r = match(a, b)\n\n    fmt.Println(\"Match found for case 8: \", r)\n}\n\nfunc match(a []int, b []int) bool {\n    if len(b) &lt; len(a) {\n        return false\n    }\n\n    lb := len(b) - 1\n    la := len(a) - 1\n    i := 0\n    j := la\n    k := 0\n    counter := 0\n\n    for {\n        if i &gt; lb || j &gt; lb {\n            break\n        }\n\n        if b[i] != a[k] || b[j] != a[la] {\n            i++\n            j++\n            counter = 0\n            continue\n        } else {\n            i++\n            counter++\n            if k &lt; la {\n                k++\n            } else {\n                k = 0\n            }\n        }\n\n        if counter &gt;= la+1 {\n            return true\n        }\n    }\n\n    return counter &gt;= la+1\n}\n</code></pre>\n"}, {"tags": ["file", "go"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1500444172, "post_id": 45180082, "comment_id": 77332209, "body": "@YandryPozo: That doesn&#39;t answer the question."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 7, "last_activity_date": 1500448236, "last_edit_date": 1500448236, "creation_date": 1500443897, "answer_id": 45182039, "question_id": 45180082, "link": "https://stackoverflow.com/questions/45180082/why-golang-file-struct-design-like-this/45182039#45182039", "title": "Why golang File struct design like this", "body": "<p>It is explained in the Go os package source code comments.</p>\n\n<p>For example, this is safe:</p>\n\n<pre><code>package main\n\nimport \"os\"\n\nfunc main() {\n    f, err := os.Create(\"/tmp/atestfile\")\n    if err != nil {\n        *f = os.File{}\n    }\n    // finalizer runs\n}\n</code></pre>\n\n<blockquote>\n  <p>Package os</p>\n\n<pre><code>go/src/os/types.go:\n\n// File represents an open file descriptor.\ntype File struct {\n  *file // os specific\n}\n\ngo/src/os/file_plan9.go:\n\n// file is the real representation of *File.\n// The extra level of indirection ensures that no clients of os\n// can overwrite this data, which could cause the finalizer\n// to close the wrong file descriptor.\ntype file struct {\n  fd      int\n  name    string\n  dirinfo *dirInfo // nil unless directory being read\n}\n\ngo/src/os/file_unix.go:\n\n// +build darwin dragonfly freebsd linux nacl netbsd openbsd solaris\n\n// file is the real representation of *File.\n// The extra level of indirection ensures that no clients of os\n// can overwrite this data, which could cause the finalizer\n// to close the wrong file descriptor.\ntype file struct {\n  pfd      poll.FD\n  name     string\n  dirinfo  *dirInfo // nil unless directory being read\n  nonblock bool     // whether we set nonblocking mode\n}\n\ngo/src/os/file_windows.go:\n\n// file is the real representation of *File.\n// The extra level of indirection ensures that no clients of os\n// can overwrite this data, which could cause the finalizer\n// to close the wrong file descriptor.\ntype file struct {\n  pfd     poll.FD\n  name    string\n  dirinfo *dirInfo // nil unless directory being read\n}\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 81, "user_id": 5121849, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5fea34791de41d24c5ca4069c9259351?s=128&d=identicon&r=PG&f=1", "display_name": "Fan", "link": "https://stackoverflow.com/users/5121849/fan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1790, "favorite_count": 1, "accepted_answer_id": 45182039, "answer_count": 1, "score": -2, "last_activity_date": 1500448236, "creation_date": 1500432330, "question_id": 45180082, "link": "https://stackoverflow.com/questions/45180082/why-golang-file-struct-design-like-this", "title": "Why golang File struct design like this", "body": "<p>golang File struct is like this:</p>\n\n<pre><code>type File struct{\n    *file\n}\n</code></pre>\n\n<p>and File struct functiona is also design to recive a pointer,why it design like this?</p>\n"}, {"tags": ["templates", "go", "struct"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 2, "creation_date": 1500433304, "post_id": 45179681, "comment_id": 77328779, "body": "<i>Always</i> check <code>error</code> returned by <code>ExecuteTemplate</code>. The <code>&quot;cars&quot;</code> is supposed to be template name not variable name. Instead of <code>ExecuteTemplate</code>, you can use <code>tpl.Execute(w, &amp;carsDetail)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 6276570, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f42a9f33aa71183e0cc75f49fd31361d?s=128&d=identicon&r=PG&f=1", "display_name": "Ben ", "link": "https://stackoverflow.com/users/6276570/ben"}, "edited": false, "score": 0, "creation_date": 1500481353, "post_id": 45186249, "comment_id": 77359446, "body": "Thank you for the remarks.  Essentially when I load the page, I&#39;m not seeing any data in the cars.html page.  I already have a folder for templates.  The single query is a great point. Would you recommend adding a field for &#39;primary&#39; just to pull that 1 pic?    The problem I&#39;m having is it won&#39;t render anything to the page.  It works if I try a single one, but ranging over the list of CarDetails is not rendering anything on the html page"}, {"owner": {"reputation": 11, "user_id": 6276570, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f42a9f33aa71183e0cc75f49fd31361d?s=128&d=identicon&r=PG&f=1", "display_name": "Ben ", "link": "https://stackoverflow.com/users/6276570/ben"}, "edited": false, "score": 0, "creation_date": 1500509536, "post_id": 45186249, "comment_id": 77373026, "body": "What&#39;s strange is that it works fine when I pass in a list of &#39;CarDetail&#39;, but when I try pulling it from the database, it does not work.  I know the information is there because it prints out fine right before I execute the template.  i.e. You&#39;re example provided works fine.  But for my example up top nothing renders.  No errors are returned, and the page loads, just no data from server side."}, {"owner": {"reputation": 49, "user_id": 8311809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34e96aecaee3a7b5c06533a77903bf79?s=128&d=identicon&r=PG&f=1", "display_name": "mhcbinder", "link": "https://stackoverflow.com/users/8311809/mhcbinder"}, "reply_to_user": {"reputation": 11, "user_id": 6276570, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f42a9f33aa71183e0cc75f49fd31361d?s=128&d=identicon&r=PG&f=1", "display_name": "Ben ", "link": "https://stackoverflow.com/users/6276570/ben"}, "edited": false, "score": 0, "creation_date": 1500531041, "post_id": 45186249, "comment_id": 77379257, "body": "Possibly go templating does not observe the HTML comments &lt;!-- --&gt;, so maybe your &quot;commented out HTML&quot; received your data :) Just try again with your comments and inspect the source code of your rendered page in the browser."}], "tags": [], "owner": {"reputation": 49, "user_id": 8311809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34e96aecaee3a7b5c06533a77903bf79?s=128&d=identicon&r=PG&f=1", "display_name": "mhcbinder", "link": "https://stackoverflow.com/users/8311809/mhcbinder"}, "is_accepted": false, "score": 1, "last_activity_date": 1500456117, "creation_date": 1500456117, "answer_id": 45186249, "question_id": 45179681, "link": "https://stackoverflow.com/questions/45179681/go-template-ranging-over-struct-of-structs/45186249#45186249", "title": "Go template ranging over struct of structs", "body": "<p>Some remarks on a general level:</p>\n\n<ul>\n<li>Your naming is a bit misleading: Pics holds only a single picture, not many (not an array or map); same applies to CarDetail.Cars</li>\n<li>Not knowing which database you are using I would recommend to build a query returning both cars and (primary) picture, as looking the pics up by every single car will not perform well</li>\n<li>I would recommend storing the templates as files in a sub-folder with specific extensions (e.g. \"cars.gohtml\") and then use template.ParseGlob(\"templates/*.gohtml\")</li>\n</ul>\n\n<p>Apart from that it should work, see a slightly refactored working example here:\n<a href=\"https://play.golang.org/p/CPnad9FxaB\" rel=\"nofollow noreferrer\">https://play.golang.org/p/CPnad9FxaB</a></p>\n\n<p>So what exactly is going wrong in your own code?</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 6276570, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f42a9f33aa71183e0cc75f49fd31361d?s=128&d=identicon&r=PG&f=1", "display_name": "Ben ", "link": "https://stackoverflow.com/users/6276570/ben"}, "is_accepted": false, "score": 1, "last_activity_date": 1500510006, "creation_date": 1500510006, "answer_id": 45203122, "question_id": 45179681, "link": "https://stackoverflow.com/questions/45179681/go-template-ranging-over-struct-of-structs/45203122#45203122", "title": "Go template ranging over struct of structs", "body": "<p>So I found the culprit.  Strangely enough some commented out HTML code from earlier was causing the template not to be rendered.  I'm not sure why.</p>\n\n<pre><code>&lt;!--\n\n&lt;h1&gt;Your Pictures:&lt;/h1&gt;\n{{range .Pics}}\n&lt;img class=\"insertedPics\" src=\"{{.Path}}\" alt=\"pic\" id=\"{{.Id}}\" \nheight=\"500px\" width=\"500px\"&gt;\n{{end}}\n\n{{range .Cars}}\n&lt;h3&gt;{{.Make}} - {{.Model}} - {{.Year}} &lt;/h3&gt;\n{{end}}\n\n&lt;img src=\"{{.Pic.Path}}\" alt=\"car pic\" id=\"{{.Car.Id}}\" height=\"600px\" width=\"600px\"&gt;\n\n--&gt;        &lt;-- Once I removed this, everything worked fine.\n\n{{range .}}\n&lt;h3&gt;{{.C.Make}} - {{.C.Model}}&lt;/h3&gt;\n&lt;img src=\"{{.P.Path}}\" alt=\"some pic\" height=\"500px\" width=\"500px\" \nstyle=\"\"&gt;\n{{end}}\n</code></pre>\n\n<p>Thank you for the help and suggestions! </p>\n"}], "owner": {"reputation": 11, "user_id": 6276570, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f42a9f33aa71183e0cc75f49fd31361d?s=128&d=identicon&r=PG&f=1", "display_name": "Ben ", "link": "https://stackoverflow.com/users/6276570/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1543, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1500510006, "creation_date": 1500428719, "question_id": 45179681, "link": "https://stackoverflow.com/questions/45179681/go-template-ranging-over-struct-of-structs", "title": "Go template ranging over struct of structs", "body": "<p>I'm attempting to range over a list of a struct consisting of 2 structs inside of it.  I have no problem filling the data correctly in the struct, the problem is when I try to render it into the HTML.  I can't get anything to display.</p>\n\n<p>This is my first go web project and I'm working on a website to sell cars for a small business.  My Database is designed as a 1..M of Cars to Pics.  So on the main car page.  I want to just load 1 pic with the details of the car.  I tried using a map for this but I ran into an issue when I wanted to print out just 1 picture to go with the correct car details on the common ID.  So I figured using a third struct that I pull out one pic for each ID would work.</p>\n\n<pre><code>type Car struct {\n    Id int\n    Year, Make, Model, Price string\n}\n\ntype Pics struct {\n    Id int\n    Path string\n}\n\n\ntype CarDetail struct {\n    Cars Car\n    Pic Pics\n}\n\nfunc cars(w http.ResponseWriter, r *http.Request){\n  //loads all the cars in the database\n  cars := loadCars()\n  carDetails := make([]CarDetail,0)\n  carIds := make([]int,len(cars))\n  for i := 0; i &lt; len(cars); i++{\n    //gets all the car IDs in the db\n    carIds[i] = getCarID(cars[i]) \n    photoPath := loadSinglePhoto(carIds[i]) //now have the single photo\n    n := CarDetail{Cars:cars[i],Pic:photoPath}\n    carDetails = append(carDetails, n)\n}\n\nfmt.Println(carDetails) //getting car details the way I want\ntpl.ExecuteTemplate(w, \"cars\", &amp;carDetails)\n}\n</code></pre>\n\n<p>The print statement right before I pass in the struct gives me the information the way I intended.</p>\n\n<p>[{{20 2009 Honda Accord 5000} {20 public/pics/questionMark.jpg}} {{21 2009 Acura TLX 14000} {21 public/pics/kia.png}} {{22 2015 Kia Sportage 34000} {22 public/pics/kia.png}}]</p>\n\n<p>Now when I try to render it in the html</p>\n\n<pre><code>{{range .}}\n  &lt;h3&gt;{{.Cars.Make}} - {{.Cars.Model}} - {{.Cars.Year}}&lt;/h3&gt;\n  &lt;img src=\"{{.Pic.Path}}\" id=\"{{.Pic.Id}}\"&gt;\n{{end}}\n</code></pre>\n\n<p>Feel free to be critical of my code or suggest another way.  Thank you in advance!</p>\n"}, {"tags": ["c", "macos", "gcc", "go", "cgo"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 2, "creation_date": 1500432022, "post_id": 45177958, "comment_id": 77328519, "body": "I managed to get it working on Linux by using <code>.&#47;configure --enable-module-recovery</code>. Since I installed to a directory that was outside the compiler&#39;s standard search path, I also had to modify <code>transactions&#47;signed_transaction.go</code> to fix the <code>#cgo</code> line for things to work correctly and the ldflags in the Makefile in the upvote example directory. You might need to do the same. Then you can use <code>make</code> in the <code>examples&#47;upvote</code> directory to build the example. I&#39;ve written a <a href=\"https://pastebin.com/wCTzgC1y\" rel=\"nofollow noreferrer\">shell script to illustrate/automate things</a>. Read the comments before executing it."}, {"owner": {"reputation": 157, "user_id": 3243289, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4b3cf99ca521466a5fd5d622ddecab1c?s=128&d=identicon&r=PG", "display_name": "Shaun", "link": "https://stackoverflow.com/users/3243289/shaun"}, "edited": false, "score": 0, "creation_date": 1500449275, "post_id": 45177958, "comment_id": 77335239, "body": "Thank you so much!  I followed your steps and it worked, I really appreciate your help. Please add this as an answer so that I can accept it and at least reward you in some way."}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 0, "creation_date": 1500522772, "post_id": 45177958, "comment_id": 77376144, "body": "Glad it helped you. I&#39;ve posted a more detailed answer regarding what&#39;s happening that subverts the need for the commented script, but I&#39;m leaving the comment containing it since it might be useful to someone else later."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "is_accepted": true, "score": 1, "last_activity_date": 1500523020, "last_edit_date": 1500523020, "creation_date": 1500522578, "answer_id": 45204797, "question_id": 45177958, "link": "https://stackoverflow.com/questions/45177958/undefined-symbols-for-architecture-x86-64-for-library-using-cgo-on-macos-sier/45204797#45204797", "title": "&quot;Undefined symbols for architecture x86_64:&quot; for library using cgo on macOS Sierra", "body": "<p>Your problem is twofold:</p>\n\n<ol>\n<li>Improperly configured <code>libsecp256k1</code> package</li>\n<li>Your C compiler not searching <code>/usr/local</code> directories for installed headers/libs</li>\n</ol>\n\n<h2>Fixing the improperly libsecp256k1 configured package</h2>\n\n<p>Your \"undefined symbols\" issue when it comes to linking C libraries sometimes points to an improperly configured package (in the sense of an Autotools package or a CMake package, not a Go package). Running <code>./configure --help</code>, I see there is an option named <code>--enable-module-recovery</code>. Judging by names like <code>_secp256k1_ecdsa_sign_<strong>recoverable</strong></code> and <code>_secp256k1_ecdsa_<strong>recover</strong></code>, you need to add that option when configuring, meaning instead of executing the simpler <code>./configure</code>, you should execute this:</p>\n\n<pre><code>./configure --enable-module-recovery\n</code></pre>\n\n<h2>Is the C compiler broken?</h2>\n\n<p>Since the <code>secp256k1.h</code> header file isn't found in <code>/usr/local/include</code>, despite the fact that the header file most definitely exists after <code>sudo make install</code> is finished, it means <a href=\"https://stackoverflow.com/q/23905661/539810\">your compiler doesn't search <code>/usr/local</code></a>.</p>\n\n<p>Barring any fixes in the linked question, you can work around the issue by altering the source of the Go package as needed to add/modify the <code>CFLAGS</code> and <code>LDFLAGS</code> used when dealing with <code>import \"C\"</code> statements like this:</p>\n\n<pre><code>// #cgo CFLAGS: -I/usr/local/include\n// #cgo LDFLAGS: -L/usr/local/lib -lsecp256k1\n// #include &lt;secp256k1.h&gt;\nimport \"C\"\n</code></pre>\n\n<p>If you have <code>pkg-config</code> installed, you can use that instead of setting <code>CFLAGS</code> and <code>LDFLAGS</code> manually:</p>\n\n<ol>\n<li>Export the <code>PKG_CONFIG_PATH</code> environment variable with a custom set of paths. Because no prefix (i.e. directory serving as the install root) was specified, <code>/usr/local</code> is assumed, meaning <code>/usr/local/include</code> will contain headers and <code>/usr/local/lib</code> will contain libraries. This means you need to export <code>PKG_CONFIG_PATH</code> on your command line as in <code>export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig:/usr/local/share/pkgconfig:/usr/lib/pkgconfig:/usr/share/pkgconfig</code>. The default setting of <code>PKG_CONFIG_PATH</code> when unset includes <code>/usr/lib/pkgconfig</code> and <code>/usr/share/pkgconfig</code> in that order on Linux and are specified as a fallback for other packages that might be used, though it may not be necessary in this case. The default set of paths may differ on OS X, so consult your <code>pkg-config</code> man page for reference.</li>\n<li>Use <code>// #cgo pkg-config: libsecp256k1</code>, and <code>CFLAGS</code> and <code>LDFLAGS</code> will be set as necessary without you needing to do anything to them. Since not all systems have <code>pkg-config</code> installed, relying on this is perhaps a bad idea if you want a package to remain portable. Then again, I think it'd be preferable to the mess you dealt with since <code>pkg-config</code> simply wouldn't be found.</li>\n<li>Change to the upvote directory and type <code>make</code> to build a working upvote binary.</li>\n</ol>\n\n<h2>Additional customization</h2>\n\n<h3>Custom prefix</h3>\n\n<p>If you use something other than <code>/usr/local</code> as your prefix (e.g. <code>./configure --enable-module-recovery --prefix=/opt/libsecp256k1</code>), then you'll need to adjust some things accordingly:</p>\n\n<pre><code>// #cgo CFLAGS: -I/opt/libsecp256k1/include\n// #cgo LDFLAGS: -L/opt/libsecp256k1/lib -lsecp256k1\n// #include \"secp256k1.h\"\nimport \"C\"\n\n// or just use pkg-config and export the PKG_CONFIG_PATH environment\n// variable containing the following paths:\n//   /opt/libsecp256k1/lib/pkgconfig\n//   /opt/libsecp256k1/share/pkgconfig\n//   /usr/lib/pkgconfig\n//   /usr/share/pkgconfig\n</code></pre>\n\n<p>You'll also need to modify the provided Makefile in the upvote directory to set the runtime path of the binary that gets built, else <code>libsecp256k1.0.dylib</code> will not be found:</p>\n\n<pre><code># If you copy and paste this, replace the spaces in front of `go build`\n# with a single horizontal tab character, else `make` will fail.\n#\n# Note that the \"ldflags\" specified are for the Go linker (go tool link),\n# not the system's linker (ld).\nbuild:\n    go build -ldflags=\"-r /opt/libsecp256k1/lib\"\n</code></pre>\n\n<p>For more information about working with cgo, check out the following resources:</p>\n\n<ul>\n<li><a href=\"https://blog.golang.org/c-go-cgo\" rel=\"nofollow noreferrer\">\"C? Go? Cgo!\" introduction to cgo on The Go Blog</a></li>\n<li><a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">Cgo documentation</a></li>\n</ul>\n"}], "owner": {"reputation": 157, "user_id": 3243289, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4b3cf99ca521466a5fd5d622ddecab1c?s=128&d=identicon&r=PG", "display_name": "Shaun", "link": "https://stackoverflow.com/users/3243289/shaun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1645, "favorite_count": 0, "accepted_answer_id": 45204797, "answer_count": 1, "score": 0, "last_activity_date": 1500523020, "creation_date": 1500415875, "question_id": 45177958, "link": "https://stackoverflow.com/questions/45177958/undefined-symbols-for-architecture-x86-64-for-library-using-cgo-on-macos-sier", "title": "&quot;Undefined symbols for architecture x86_64:&quot; for library using cgo on macOS Sierra", "body": "<p>I am trying to make use of a library, <a href=\"https://github.com/go-steem/rpc\" rel=\"nofollow noreferrer\">https://github.com/go-steem/rpc</a>, that makes use of some C code, which references a library.</p>\n\n<p>The C library can be found here, <a href=\"https://github.com/bitcoin-core/secp256k1\" rel=\"nofollow noreferrer\">https://github.com/bitcoin-core/secp256k1</a></p>\n\n<p>I followed the steps to get that installed</p>\n\n<pre><code>$ ./autogen.sh\n$ ./configure\n$ make\n$ ./tests\n$ sudo make install  # optional\n</code></pre>\n\n<p>And have this output;</p>\n\n<pre><code>$ sudo make install\nPassword:\n  CC       src/libsecp256k1_la-secp256k1.lo\n  CCLD     libsecp256k1.la\n  CC       src/tests-tests.o\n  CCLD     tests\n  CC       src/exhaustive_tests-tests_exhaustive.o\n  CCLD     exhaustive_tests\n build-aux/install-sh -c -d '/usr/local/lib'\n /bin/sh ./libtool   --mode=install /usr/bin/install -c   libsecp256k1.la '/usr/local/lib'\nlibtool: install: /usr/bin/install -c .libs/libsecp256k1.0.dylib /usr/local/lib/libsecp256k1.0.dylib\nlibtool: install: (cd /usr/local/lib &amp;&amp; { ln -s -f libsecp256k1.0.dylib libsecp256k1.dylib || { rm -f libsecp256k1.dylib &amp;&amp; ln -s libsecp256k1.0.dylib libsecp256k1.dylib; }; })\nlibtool: install: /usr/bin/install -c .libs/libsecp256k1.lai /usr/local/lib/libsecp256k1.la\nlibtool: install: /usr/bin/install -c .libs/libsecp256k1.a /usr/local/lib/libsecp256k1.a\nlibtool: install: chmod 644 /usr/local/lib/libsecp256k1.a\nlibtool: install: /usr/bin/ranlib /usr/local/lib/libsecp256k1.a\n build-aux/install-sh -c -d '/usr/local/include'\n /usr/bin/install -c -m 644 include/secp256k1.h '/usr/local/include'\n build-aux/install-sh -c -d '/usr/local/lib/pkgconfig'\n /usr/bin/install -c -m 644 libsecp256k1.pc '/usr/local/lib/pkgconfig'\n</code></pre>\n\n<p>I try to run the upvote example from that Go library, go-steem/rpc/examples/upvote/ and get the following output;</p>\n\n<pre><code>$ go run main.go \n# github.com/go-steem/rpc/transactions\n../../transactions/signing.c:5:10: fatal error: 'secp256k1.h' file not found\n</code></pre>\n\n<p>Already it feels as though the wheels are falling off...</p>\n\n<p>Please bear with me as I do not develop in C, so I get a bit hack-y.</p>\n\n<p>After much reading, and googling I decide to copy the files from the 'include' directory where I compiled libsecp256k1 into the same directory as the error is originating from.</p>\n\n<p>You can see the files are not there;</p>\n\n<pre><code>$ ls -la ../../transactions/\ntotal 48\ndrwxr-xr-x   8 shaunmorrow  staff   272 May  8 18:09 .\ndrwxr-xr-x  15 shaunmorrow  staff   510 May  8 18:09 ..\n-rw-r--r--   1 shaunmorrow  staff   256 Apr 27 17:53 chains.go\n-rw-r--r--   1 shaunmorrow  staff  3731 May  8 18:09 signed_transaction.go\n-rw-r--r--   1 shaunmorrow  staff  1849 May  8 18:09 signed_transaction_test.go\n-rw-r--r--   1 shaunmorrow  staff  3075 Apr 27 17:53 signing.c\n-rw-r--r--   1 shaunmorrow  staff   408 Apr 27 17:53 signing.h\n-rw-r--r--   1 shaunmorrow  staff  1049 May  8 18:09 transactions.go\n</code></pre>\n\n<p>and after the copy;</p>\n\n<pre><code>$ ls -la ../../transactions/\ntotal 128\ndrwxr-xr-x  11 shaunmorrow  staff    374 Jul 18 19:08 .\ndrwxr-xr-x  15 shaunmorrow  staff    510 May  8 18:09 ..\n-rw-r--r--   1 shaunmorrow  staff    256 Apr 27 17:53 chains.go\n-rw-r--r--   1 shaunmorrow  staff  27071 Jul 18 19:08 secp256k1.h\n-rw-r--r--   1 shaunmorrow  staff   1014 Jul 18 19:08 secp256k1_ecdh.h\n-rw-r--r--   1 shaunmorrow  staff   4700 Jul 18 19:08 secp256k1_recovery.h\n-rw-r--r--   1 shaunmorrow  staff   3731 Jul 18 19:05 signed_transaction.go\n-rw-r--r--   1 shaunmorrow  staff   1849 May  8 18:09 signed_transaction_test.go\n-rw-r--r--   1 shaunmorrow  staff   3075 Apr 27 17:53 signing.c\n-rw-r--r--   1 shaunmorrow  staff    408 Apr 27 17:53 signing.h\n-rw-r--r--   1 shaunmorrow  staff   1049 May  8 18:09 transactions.go\n</code></pre>\n\n<p>Now I get a new error;</p>\n\n<pre><code>$ go run main.go \n# github.com/go-steem/rpc/transactions\nld: library not found for -lsecp256k1\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\n</code></pre>\n\n<p>This has me reading and googling some more,</p>\n\n<p>Finally I get even more hack-y and change transactions.go;</p>\n\n<pre><code>// #cgo LDFLAGS: -lsecp256k1\n// #include &lt;stdlib.h&gt;\n// #include \"signing.h\"\nimport \"C\"\n</code></pre>\n\n<p>becomes</p>\n\n<pre><code>// #cgo LDFLAGS: -L/usr/local/lib\n// #include &lt;stdlib.h&gt;\n// #include \"signing.h\"\nimport \"C\"\n</code></pre>\n\n<p>which fails, output on that later</p>\n\n<p>I also try;</p>\n\n<pre><code>// #cgo LDFLAGS: -L/usr/local/lib -I/usr/local/include\n// #include &lt;stdlib.h&gt;\n// #include \"signing.h\"\nimport \"C\"\n</code></pre>\n\n<p>and copy the .h files into the /usr/local/include directory.</p>\n\n<p>None of this works and now I am stuck with an error like this</p>\n\n<pre><code>$ go run main.go \n# github.com/go-steem/rpc/transactions\nld: library not found for -lsecp256k1\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\nShaunsSePc-2:upvote shaunmorrow$ go run main.go \n# github.com/go-steem/rpc/transactions\nUndefined symbols for architecture x86_64:\n  \"_secp256k1_context_create\", referenced from:\n      _sign_transaction in signing.o\n      _verify_recoverable_signature in signing.o\n  \"_secp256k1_context_destroy\", referenced from:\n      _sign_transaction in signing.o\n      _verify_recoverable_signature in signing.o\n  \"_secp256k1_ec_pubkey_serialize\", referenced from:\n      _verify_recoverable_signature in signing.o\n  \"_secp256k1_ecdsa_recover\", referenced from:\n      _verify_recoverable_signature in signing.o\n  \"_secp256k1_ecdsa_recoverable_signature_convert\", referenced from:\n      _verify_recoverable_signature in signing.o\n  \"_secp256k1_ecdsa_recoverable_signature_parse_compact\", referenced from:\n      _verify_recoverable_signature in signing.o\n  \"_secp256k1_ecdsa_recoverable_signature_serialize_compact\", referenced from:\n      _sign_transaction in signing.o\n  \"_secp256k1_ecdsa_sign_recoverable\", referenced from:\n      _sign_transaction in signing.o\n  \"_secp256k1_ecdsa_verify\", referenced from:\n      _verify_recoverable_signature in signing.o\nld: symbol(s) not found for architecture x86_64\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\n</code></pre>\n\n<p>At this point I really have no idea how to continue.</p>\n\n<p>As you can see I am not experienced in C at all and have no idea how to test if the library <code>libsecp256k1</code> is even installed properly!</p>\n\n<p>This is where I ended up, but it's highly likely I took a wrong turn early in my journey, I would appreciate any help given as I have been struggling with this for a few nights already now :( </p>\n\n<p>Not sure whats needed so here some env variables</p>\n\n<pre><code>$ go env\nGOARCH=\"amd64\"\nGOBIN=\"\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"darwin\"\nGOOS=\"darwin\"\nGOPATH=\"/Users/shaunmorrow/Work/go/\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/darwin_amd64\"\nGCCGO=\"gccgo\"\nCC=\"clang\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/86/hlqptn5101z5bcydjz05qy8m0000gn/T/go-build689438019=/tmp/go-build -gno-record-gcc-switches -fno-common\"\nCXX=\"clang++\"\nCGO_ENABLED=\"1\"\nPKG_CONFIG=\"pkg-config\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\n</code></pre>\n\n<p>Version is <strong>go version go1.8.3 darwin/amd64</strong> with no old versions lying around.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1500415970, "post_id": 45177878, "comment_id": 77324459, "body": "JSON doesn&#39;t have an integer type. Numbers are unmarshaled as a float64."}], "answers": [{"tags": [], "owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "is_accepted": true, "score": 4, "last_activity_date": 1500471794, "last_edit_date": 1500471794, "creation_date": 1500430969, "answer_id": 45179938, "question_id": 45177878, "link": "https://stackoverflow.com/questions/45177878/golang-json-error-convertering-int-from-json/45179938#45179938", "title": "Golang json error convertering int from json", "body": "<p>If you are converting your <code>byt</code> to <code>map[string]interfaec{}</code> the default value of the number will be <code>float64</code>.</p>\n\n<pre><code>func main(){\n    byt := []byte(`{\"status\": \"USER_MOVED_LEFT\", \"id\":1, \"x\":5, \"y\":3}`)\n    var dat map[string]interface{}\n    if err := json.Unmarshal(byt, &amp;dat); err != nil {\n        panic(err)\n    }\n\n    fmt.Println(reflect.TypeOf(dat[\"id\"])) // print the type of value\n    num := dat[\"id\"].(float64)\n    fmt.Println(num)\n}\n</code></pre>\n\n<p>But you can also change this behavior by converting your <code>byt</code> which is your data to a <code>struct</code> like this :</p>\n\n<pre><code>type myStruct struct {\n    Status string\n    Id     int\n    x      int\n    y      int\n}\n\nfunc main() {\n    byt := []byte(`{\"status\": \"USER_MOVED_LEFT\", \"id\":1, \"x\":5, \"y\":3}`)\n    dat := myStruct{}\n    if err := json.Unmarshal(byt, &amp;dat); err != nil {\n        panic(err)\n    }\n\n    fmt.Println(reflect.TypeOf(dat.Id))\n    fmt.Printf(\"%+v\\n\", dat.Id)\n\n}\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 5291074, "user_type": "registered", "accept_rate": 38, "profile_image": "https://graph.facebook.com/10153559343595761/picture?type=large", "display_name": "kubuni", "link": "https://stackoverflow.com/users/5291074/kubuni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 45179938, "answer_count": 1, "score": 0, "last_activity_date": 1500471794, "creation_date": 1500415522, "question_id": 45177878, "link": "https://stackoverflow.com/questions/45177878/golang-json-error-convertering-int-from-json", "title": "Golang json error convertering int from json", "body": "<p>I'm trying to do a simple unmarshall and extracting the int information from the code below. I found a link from another stackoverflow : <a href=\"https://stackoverflow.com/questions/18041334/convert-interface-to-int-in-golang\">link</a>. Though, it doesn't help in my case. the program according to ideone think the data is a float.</p>\n\n<pre><code>package main\nimport \"fmt\"\nimport \"encoding/json\"\n\nfunc main(){\n    byt := []byte(`{\"status\": \"USER_MOVED_LEFT\", \"id\":1, \"x\":5, \"y\":3}`)\n    var dat map[string]interface{}\n    if err := json.Unmarshal(byt, &amp;dat); err != nil {\n        panic(err)\n    }\n    num := dat[\"id\"].(int)\n    fmt.Println(num)\n}\n</code></pre>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 6, "creation_date": 1500413648, "post_id": 45176997, "comment_id": 77323520, "body": "No, the memory is not immediately returned to the OS. Even if the memory is eventually freed by the runtime, it&#39;s only advisory, and if there&#39;s no memory pressure the OS isn&#39;t guaranteed to ever release it."}, {"owner": {"reputation": 3, "user_id": 6236681, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-gCRhqliBrM4/AAAAAAAAAAI/AAAAAAAAADo/L4gaxC-qugI/photo.jpg?sz=128", "display_name": "Grant Kimball", "link": "https://stackoverflow.com/users/6236681/grant-kimball"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1500434109, "post_id": 45176997, "comment_id": 77328954, "body": "Are you saying this is the normal modus operandi? Is there a way to manually free the memory without calling os.Exit?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1500471977, "post_id": 45176997, "comment_id": 77352269, "body": "It&#39;s not necessary or beneficial to manually force memory to be freed, and it still doesn&#39;t gaurantee that the OS will reclaim it unless it&#39;s actually needed by another process. That&#39;s just how OS memory management works, and it&#39;s not something to be concerned about and does not require any &quot;fix&quot;. If you have continuously increasing memory usage or crashes due to insufficient memory, that&#39;s a different matter entirely, but this sounds like completely normal memory handling."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1500472052, "post_id": 45176997, "comment_id": 77352334, "body": "<a href=\"https://github.com/golang/go/issues/14521#issuecomment-189244596\" rel=\"nofollow noreferrer\">Here it is</a> from Dave Cheney himself."}], "owner": {"reputation": 3, "user_id": 6236681, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-gCRhqliBrM4/AAAAAAAAAAI/AAAAAAAAADo/L4gaxC-qugI/photo.jpg?sz=128", "display_name": "Grant Kimball", "link": "https://stackoverflow.com/users/6236681/grant-kimball"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 227, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1500543636, "creation_date": 1500411717, "last_edit_date": 1500543636, "question_id": 45176997, "link": "https://stackoverflow.com/questions/45176997/why-does-it-appear-that-my-golang-server-has-persistent-memory-usage", "title": "Why does it appear that my Golang server has persistent memory usage?", "body": "<p>Hopefully someone can clear this up. I am writing a recursive crawler, that when complete, returns a JSON string. At first, I thought it was my code in the master project, so I created a bare bones program to isolate and illustrate the issue.</p>\n\n<p>When the below code is executed, it starts a server on port 8080, which delegates 1.1MB of RAM in my Activity Monitor. Everything ok so far..</p>\n\n<p>When you curl that address, i.e. <code>curl http://127.0.0.1:8080</code>, the handler executes by calling the given domain 2000 times. Once the go routines complete, it sends back a canned response. HOWEVER, the activity monitor now reads 29.9MB!? Shouldn't it go back down to 1.1MB because it is no longer operating? This has been driving me crazy, any help would be greatly appreciated.</p>\n\n<p>Here's the dummy program:</p>\n\n<pre><code>package main\n\nimport (\n \"fmt\"\n \"log\"\n \"net/http\"\n \"sync\"\n)\n\nfunc main() {\n\nlog.SetFlags(log.Ldate | log.Ltime | log.Lshortfile)\n\nhttp.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    wg := &amp;sync.WaitGroup{}\n\n    for i := 0; i &lt; 2000; i++ {\n        wg.Add(1)\n        go func() {\n            defer wg.Done()\n            r, err := http.Get(\"http://theswellcompany.com\")\n            if err == nil {\n                fmt.Println(r.StatusCode)\n                err := r.Body.Close()\n                if err != nil {\n                    // do nothing\n                }\n            }\n        }()\n    }\n    wg.Wait()\n    w.Header().Set(\"Content-Type\", \"test/html; charset=UTF-8\")\n    w.WriteHeader(http.StatusOK)\n    fmt.Fprintf(w, string(\"DONE, but if it's done, WHY does the actvity monitor on my mac still read 40MB??\"))\n})\n\nlog.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500409894, "post_id": 45176443, "comment_id": 77321605, "body": "What do you mean it works without <code>String()</code>? Your panic is from dereferencing a nil pointer on line 46; what is that line?"}, {"owner": {"reputation": 329, "user_id": 5776617, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/--RV_ptSa9aA/AAAAAAAAAAI/AAAAAAAAAJk/QI2FQ9xZgn0/photo.jpg?sz=128", "display_name": "Alex Turner", "link": "https://stackoverflow.com/users/5776617/alex-turner"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500410091, "post_id": 45176443, "comment_id": 77321720, "body": "Hey @JimB: Without .String() I get the expected output from the command (line 46 which is fmt.Printf(&quot;Route %s\\n&quot;,  r.Dst.String())) as &quot;Route 1.1.1.0/24&quot;. With .String() I&#39;m getting the above panic. Need to cast as string to insert it into a struct."}, {"owner": {"reputation": 329, "user_id": 5776617, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/--RV_ptSa9aA/AAAAAAAAAAI/AAAAAAAAAJk/QI2FQ9xZgn0/photo.jpg?sz=128", "display_name": "Alex Turner", "link": "https://stackoverflow.com/users/5776617/alex-turner"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500410415, "post_id": 45176443, "comment_id": 77321879, "body": "Should note - 46 was the append() but I&#39;ve moved the command to fmt.print() to make things clearer."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500410617, "post_id": 45176443, "comment_id": 77321978, "body": "You are dereferencing a nil pointer in there. Are the fields in the values returned by RouteList guaranteed to be non-nil? Are there any errors you&#39;re ignoring?"}, {"owner": {"reputation": 329, "user_id": 5776617, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/--RV_ptSa9aA/AAAAAAAAAAI/AAAAAAAAAJk/QI2FQ9xZgn0/photo.jpg?sz=128", "display_name": "Alex Turner", "link": "https://stackoverflow.com/users/5776617/alex-turner"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500411032, "post_id": 45176443, "comment_id": 77322209, "body": "Ah yes - looks like some routes were returning as &lt;nil&gt;, wrote a test which seemed to fix the issue. Want o submit as answer and i&#39;ll accept?"}], "owner": {"reputation": 329, "user_id": 5776617, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/--RV_ptSa9aA/AAAAAAAAAAI/AAAAAAAAAJk/QI2FQ9xZgn0/photo.jpg?sz=128", "display_name": "Alex Turner", "link": "https://stackoverflow.com/users/5776617/alex-turner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 638, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1500409602, "creation_date": 1500409602, "question_id": 45176443, "link": "https://stackoverflow.com/questions/45176443/net-ip-type-to-string-runtime-error", "title": "net.ip type to String() | runtime error", "body": "<p>Trying to convert net.ip array to String as defined in <a href=\"https://golang.org/pkg/net/#IP.String\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/#IP.String</a></p>\n\n<pre><code>  rl, _ := nh.RouteList(nil,1)\n  // if err != nil {\n  //   log.Fatal(err)\n  // }\n  for _, r := range rl {\n    updates = append( updates, Update{Route: r.Dst.String(), GW: r.Gw.String()})\n    fmt.Printf(\"Route %s\\n\",  updates)\n  }\n</code></pre>\n\n<p>Is falling over with .String(), it seems to work (presenting the whole array) without .String()</p>\n\n<pre><code>root@ubuntu:/media/sf_gocode/src/github.com/alexanderturner/netnsplay# ./netnsplay -pid 8066\nLoading routes for container: 8066\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xb code=0x1 addr=0x0 pc=0x564d82bf31e2]\n\ngoroutine 1 [running]:\npanic(0x564d82ca0ae0, 0xc82000e110)\n    /usr/lib/go-1.6/src/runtime/panic.go:481 +0x3e6\nnet.networkNumberAndMask(0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /usr/lib/go-1.6/src/net/ip.go:433 +0x42\nnet.(*IPNet).String(0x0, 0x0, 0x0)\n    /usr/lib/go-1.6/src/net/ip.go:483 +0x42\nmain.(*NSHandle).showInts(0xc820014260)\n    /media/sf_gocode/src/github.com/alexanderturner/netnsplay/netnsplay.go:46 +0xf8\nmain.main()\n    /media/sf_gocode/src/github.com/alexanderturner/netnsplay/netnsplay.go:98 +0xf1\nroot@ubuntu:/media/sf_gocode/src/github.com/alexanderturner/netnsplay#\n</code></pre>\n"}, {"tags": ["mongodb", "go", "graphql"], "comments": [{"owner": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "edited": false, "score": 0, "creation_date": 1500469191, "post_id": 45172215, "comment_id": 77349844, "body": "It seems that the server should be able to be alerted of those new fields, and rebuild the <code>graphql.Schema</code> on those events..."}, {"owner": {"reputation": 155, "user_id": 1851006, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/ef2638964d83d7357ab3d089b409279d?s=128&d=identicon&r=PG", "display_name": "user1851006", "link": "https://stackoverflow.com/users/1851006/user1851006"}, "reply_to_user": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "edited": false, "score": 0, "creation_date": 1500486994, "post_id": 45172215, "comment_id": 77362795, "body": "@dolmen Mongodb doesn&#39;t support triggers or alerts which is a problem."}, {"owner": {"reputation": 4738, "user_id": 4723237, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vNJVW.png?s=128&g=1", "display_name": "vbranden", "link": "https://stackoverflow.com/users/4723237/vbranden"}, "edited": false, "score": 0, "creation_date": 1560537042, "post_id": 45172215, "comment_id": 99783019, "body": "This is probably not a good use of graphql. Imagine that you have several documents with different fields or fields with the same name but different types. Graphql should be defining the type not the backend document"}], "owner": {"reputation": 155, "user_id": 1851006, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/ef2638964d83d7357ab3d089b409279d?s=128&d=identicon&r=PG", "display_name": "user1851006", "link": "https://stackoverflow.com/users/1851006/user1851006"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 369, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1500394566, "creation_date": 1500394566, "question_id": 45172215, "link": "https://stackoverflow.com/questions/45172215/how-to-generate-graphql-schema-on-run-time", "title": "How to generate graphql schema on run time?", "body": "<p>I have a graphql server written in golang using graphql-go api which fetches data from MongoDb and sends the data to the user. But this is when the graphql schema is static. In the future if there is a new field added to a mongodb collection, and the user queries it, then graphql server should be able to fetch that field dynamically. That means, run time schema needs to be generated. The type of the field is unknown. How can this be achieved ?</p>\n"}, {"tags": ["generics", "go"], "answers": [{"comments": [{"owner": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 2, "creation_date": 1500394846, "post_id": 45172168, "comment_id": 77312533, "body": "So is the main difference that in Go that it&#39;s checked at runtime, rather than compile time?"}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 3, "creation_date": 1500395186, "post_id": 45172168, "comment_id": 77312734, "body": "Yes. As Go does not have the &#39;generics&#39; feature, you could work with interface{} and make runtime checks (same as Java developers did prior to Generics making it into the language). Note that collections in Go (slices, maps) are typed, so the need for generics is somehow not so critical since collections are the most prominent place where you need this functionality."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1500395809, "post_id": 45172168, "comment_id": 77313106, "body": "Well, one can also check if the interface is implemented at compile time by simply calling the function - see <a href=\"https://stackoverflow.com/a/44692363/2969090\">stackoverflow.com/a/44692363/2969090</a>"}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "edited": false, "score": 2, "creation_date": 1500396196, "post_id": 45172168, "comment_id": 77313359, "body": "That example is not working with interface{} variables but rather with typed variables. You can check at compile time if a type implements an interface, you cannot check if an interface{} is of a given type at compile time."}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1500396222, "post_id": 45172168, "comment_id": 77313383, "body": "Not to mention with Go, type assertion allows you to see and use the underlying type. With generics, you are essentially giving up knowing your type."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 11, "last_activity_date": 1500394735, "last_edit_date": 1500394735, "creation_date": 1500394425, "answer_id": 45172168, "question_id": 45171642, "link": "https://stackoverflow.com/questions/45171642/how-is-the-empty-interface-different-than-a-generic/45172168#45172168", "title": "How is the empty interface different than a generic?", "body": "<p>If you come from Java, the empty interface (<code>interface{}</code>) is actually closer to working with <code>Object</code> variables in Java than with generics.</p>\n\n<p>You can assign anything to an <code>interface{}</code> (like you can do with an <code>Object</code> variable in Java).</p>\n\n<p>But you should then \"cast\" or \"type assert\" back if you want to use the actual type you stored there (same that you need to do with <code>Object</code> variables in Java).</p>\n\n<p>Generics in Java are quite different, since they allow you to keep type checking at compile time. The different is precisely that you don't need to resort to reflection or type switches if you work with Generics.</p>\n\n<p>You can read more about Java generics here:</p>\n\n<p><a href=\"https://docs.oracle.com/javase/tutorial/java/generics/\" rel=\"noreferrer\">https://docs.oracle.com/javase/tutorial/java/generics/</a></p>\n\n<p>And then follow this and the next 2 or 3 steps of the Go tour here for more on how the empty interface works:</p>\n\n<p><a href=\"https://tour.golang.org/methods/14\" rel=\"noreferrer\">https://tour.golang.org/methods/14</a></p>\n"}, {"comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1597135684, "post_id": 55254443, "comment_id": 112027916, "body": "To add to your excellent answer. Golang now provides experimental support for type parameters for generic programming. See <a href=\"https://www.jetbrains.com/help/go/how-to-use-type-parameters-for-generic-programming.html\" rel=\"nofollow noreferrer\">jetbrains.com/help/go/&hellip;</a>."}], "tags": [], "owner": {"reputation": 612, "user_id": 3042695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e51b11836a61cc2ff0fd4c27e423afc?s=128&d=identicon&r=PG&f=1", "display_name": "hellopeach", "link": "https://stackoverflow.com/users/3042695/hellopeach"}, "is_accepted": false, "score": 3, "last_activity_date": 1553061682, "creation_date": 1553061682, "answer_id": 55254443, "question_id": 45171642, "link": "https://stackoverflow.com/questions/45171642/how-is-the-empty-interface-different-than-a-generic/55254443#55254443", "title": "How is the empty interface different than a generic?", "body": "<p>Considering the main point of generics is to maintain the compile-time type safety check for statically typed languages when providing facilities to write type agnostic functions/methods, the empty interface with runtime type assertions/switches is completely different from generics and I'd say it's almost the complete opposite to generics in terms of programming paradigms.</p>\n\n<p>I'd say more than half of the programming language improvements over the last decade are about avoiding runtime errors, and I guess that's why Go has some \"built-in generics\" like slice and map instead of something like the old JavaScript's Array stuff which only has type checks on its elements during run-time. So the empty interface with type assertion/switch in Go is definitely no replacement for generics and personally, I'd try to avoid using the empty interface as much as possible.</p>\n"}], "owner": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3007, "favorite_count": 1, "accepted_answer_id": 45172168, "answer_count": 2, "score": 12, "last_activity_date": 1553061682, "creation_date": 1500392923, "last_edit_date": 1500394071, "question_id": 45171642, "link": "https://stackoverflow.com/questions/45171642/how-is-the-empty-interface-different-than-a-generic", "title": "How is the empty interface different than a generic?", "body": "<p>Maybe I'm not fully versed on the power of generics, but how is the empty interface, <code>interface{}</code>, different than a generic, especially if we have the ability to use reflection or type switches? People always mention that Go doesn't have generics, but <code>interface{}</code> seems like it does the job pretty comparable to something like <code>&lt;T&gt;</code> in Java. </p>\n"}, {"tags": ["ssl", "go", "x509"], "comments": [{"owner": {"reputation": 2527, "user_id": 3476121, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/1c621706e2e37eed4f82f074af9f706a?s=128&d=identicon&r=PG", "display_name": "sadlil", "link": "https://stackoverflow.com/users/3476121/sadlil"}, "edited": false, "score": 3, "creation_date": 1500378699, "post_id": 45165813, "comment_id": 77299771, "body": "Your code runs perfectly on my local machine. Are you running the directly in the machine or inside any container?"}, {"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1500393498, "post_id": 45165813, "comment_id": 77311684, "body": "this code runs fine inside a Ubuntu docker container"}, {"owner": {"reputation": 137, "user_id": 3206713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80db911f36c2b4f0714a4f7b88fc5e52?s=128&d=identicon&r=PG", "display_name": "Maico Timmerman", "link": "https://stackoverflow.com/users/3206713/maico-timmerman"}, "edited": false, "score": 0, "creation_date": 1500449069, "post_id": 45165813, "comment_id": 77335091, "body": "I&#39;m running Arch Linux kernel version 4.9.37-1-lts. Code is working fine on any other machine, however not on this machine."}, {"owner": {"reputation": 11185, "user_id": 1055637, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8a8b9e4daac99ea95aa3e8e246716e73?s=128&d=identicon&r=PG", "display_name": "Mazzy", "link": "https://stackoverflow.com/users/1055637/mazzy"}, "edited": false, "score": 0, "creation_date": 1541691766, "post_id": 45165813, "comment_id": 93310226, "body": "@MaicoTimmerman How did you solve that? I&#39;ve the same issue"}, {"owner": {"reputation": 137, "user_id": 3206713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80db911f36c2b4f0714a4f7b88fc5e52?s=128&d=identicon&r=PG", "display_name": "Maico Timmerman", "link": "https://stackoverflow.com/users/3206713/maico-timmerman"}, "edited": false, "score": 0, "creation_date": 1541692244, "post_id": 45165813, "comment_id": 93310543, "body": "Please see my final edit, I moved the certificate and reinstalled the ca-certificates-utils manually."}, {"owner": {"reputation": 11185, "user_id": 1055637, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8a8b9e4daac99ea95aa3e8e246716e73?s=128&d=identicon&r=PG", "display_name": "Mazzy", "link": "https://stackoverflow.com/users/1055637/mazzy"}, "edited": false, "score": 0, "creation_date": 1541692909, "post_id": 45165813, "comment_id": 93310979, "body": "I&#39;m using <code>go-pingdom</code> package and running on docker <code>alpine:3.8</code>. I don&#39;t have anything under <code>&#47;etc&#47;ssl&#47;certs</code>. I have tried to install <code>RUN apk add --no-cache --virtual ca-certificates-utils</code> but without any luck."}], "answers": [{"comments": [{"owner": {"reputation": 137, "user_id": 3206713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80db911f36c2b4f0714a4f7b88fc5e52?s=128&d=identicon&r=PG", "display_name": "Maico Timmerman", "link": "https://stackoverflow.com/users/3206713/maico-timmerman"}, "edited": false, "score": 0, "creation_date": 1500448903, "post_id": 45169375, "comment_id": 77334972, "body": "First of all, I&#39;m on arch linux and I&#39;ve got the ca-certificates installed: <code>pacaur -Qsq ca-certificates</code> results in  <code>ca-certificates ca-certificates-cacert ca-certificates-mozilla ca-certificates-utils </code>"}, {"owner": {"reputation": 16871, "user_id": 1281385, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/3590d48970d9b0e96fabb0b23614be61?s=128&d=identicon&r=PG", "display_name": "exussum", "link": "https://stackoverflow.com/users/1281385/exussum"}, "edited": false, "score": 1, "creation_date": 1592392329, "post_id": 45169375, "comment_id": 110407281, "body": "use <code>sudo apt-get install --reinstall ca-certificates</code> as this package almost certainly is installed"}, {"owner": {"reputation": 144, "user_id": 4165274, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/198e14b2db4e43b97c9d6179b700963b?s=128&d=identicon&r=PG&f=1", "display_name": "MeerArtefakt", "link": "https://stackoverflow.com/users/4165274/meerartefakt"}, "edited": false, "score": 0, "creation_date": 1609012266, "post_id": 45169375, "comment_id": 115730723, "body": "Thank you all, worked for me on debian 10  &quot;sudo apt-get install --reinstall ca-certificates&quot; !"}], "tags": [], "owner": {"reputation": 5779, "user_id": 876686, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0dc9f06a29ef13328a46d31db59634ea?s=128&d=identicon&r=PG", "display_name": "tier1", "link": "https://stackoverflow.com/users/876686/tier1"}, "is_accepted": false, "score": 7, "last_activity_date": 1500387331, "creation_date": 1500387331, "answer_id": 45169375, "question_id": 45165813, "link": "https://stackoverflow.com/questions/45165813/x509-certificate-signed-by-unknown-authority/45169375#45169375", "title": "x509 certificate signed by unknown authority", "body": "<p>Based on your error, I'm assuming you are using Linux? </p>\n\n<p>It's likely that you will have to install ca-certificates on the machine your program is running on.</p>\n\n<p>On Ubuntu, you would execute something like this:</p>\n\n<pre><code>sudo apt-get install ca-certificates\n</code></pre>\n"}], "owner": {"reputation": 137, "user_id": 3206713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80db911f36c2b4f0714a4f7b88fc5e52?s=128&d=identicon&r=PG", "display_name": "Maico Timmerman", "link": "https://stackoverflow.com/users/3206713/maico-timmerman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4847, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1541692259, "creation_date": 1500378109, "last_edit_date": 1541692259, "question_id": 45165813, "link": "https://stackoverflow.com/questions/45165813/x509-certificate-signed-by-unknown-authority", "title": "x509 certificate signed by unknown authority", "body": "<p>I'm trying some basic examples to request data from the web, however all requests to different hosts result in an SSL error: <code>x509: certificate signed by unknown authority</code>. <strong>Note</strong>: I'm not behind a proxy and no forms of certificate interception is happening, as using curl or the browser works without problems.</p>\n\n<p>The code sample I'm currently working with is:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"io/ioutil\"\n    \"os\"\n    )\n\nfunc main() {\n    response, err := http.Get(\"https://google.com\")\n    if err != nil {\n        fmt.Printf(\"%s\\n\", err)\n        os.Exit(1)\n    } else {\n        defer response.Body.Close()\n        contents, err := ioutil.ReadAll(response.Body)\n        if err != nil {\n            fmt.Printf(\"%s\", err)\n            os.Exit(1)\n        }\n        fmt.Printf(\"%s\\n\", string(contents))\n    }\n}\n</code></pre>\n\n<p>Edit: Code is run on Arch linux kernel 4.9.37-1-lts.</p>\n\n<p><strong>Edit 2</strong>: Apparently <code>/etc/ssl/certs/ca-certificates.crt</code> had a difference between the version on my system, by (re)moving the certificate and re-installing the <code>ca-certificates-utils</code> package manually, the issue was solved.</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 461, "user_id": 1821490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/U91FX.jpg?s=128&g=1", "display_name": "Alex Kroll", "link": "https://stackoverflow.com/users/1821490/alex-kroll"}, "edited": false, "score": 1, "creation_date": 1500376404, "post_id": 45164649, "comment_id": 77298076, "body": "Add error checking. In some cases your example produce error &quot;expected integer&quot;"}, {"owner": {"reputation": 461, "user_id": 1821490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/U91FX.jpg?s=128&g=1", "display_name": "Alex Kroll", "link": "https://stackoverflow.com/users/1821490/alex-kroll"}, "edited": false, "score": 1, "creation_date": 1500376543, "post_id": 45164649, "comment_id": 77298174, "body": "Also i&#39;ve added &#39;\\n&#39; to format string, and error disappear."}], "answers": [{"comments": [{"owner": {"reputation": 829, "user_id": 4667256, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/860591147318225/picture?type=large", "display_name": "Gilbert Nwaiwu", "link": "https://stackoverflow.com/users/4667256/gilbert-nwaiwu"}, "edited": false, "score": 0, "creation_date": 1500376808, "post_id": 45165250, "comment_id": 77298364, "body": "Tnx. That makes sense. I think i was confused by an example where an int was passed by reference to scanf"}], "tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": true, "score": 1, "last_activity_date": 1500376605, "creation_date": 1500376605, "answer_id": 45165250, "question_id": 45164649, "link": "https://stackoverflow.com/questions/45164649/passing-slice-to-scanf/45165250#45165250", "title": "Passing slice to Scanf", "body": "<p>First of all, values are <strong>not</strong> passed by reference for slices/arrays.</p>\n\n<p>At the same time, if you were passing a slice value to some function, the receiver would be able to modify the same underlying array, because a slice value contains a pointer.</p>\n\n<p>In your case, you are not passing a slice itself, but rather copies of the dereferenced <code>int64</code> values. And <code>fmt.Scanf</code> is not updating <code>mapIsh</code>. Only passing addresses are you able to use the scanned values. </p>\n"}, {"comments": [{"owner": {"reputation": 29582, "user_id": 1427098, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Bvdm0.jpg?s=128&g=1", "display_name": "Darshan Rivka Whittle", "link": "https://stackoverflow.com/users/1427098/darshan-rivka-whittle"}, "reply_to_user": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "edited": false, "score": 0, "creation_date": 1500377312, "post_id": 45165264, "comment_id": 77298742, "body": "Thanks, I spaced and added &quot;or array&quot; without thinking.  Fixed now, and added the note at the end."}], "tags": [], "owner": {"reputation": 29582, "user_id": 1427098, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Bvdm0.jpg?s=128&g=1", "display_name": "Darshan Rivka Whittle", "link": "https://stackoverflow.com/users/1427098/darshan-rivka-whittle"}, "is_accepted": false, "score": 2, "last_activity_date": 1500377160, "last_edit_date": 1500377160, "creation_date": 1500376628, "answer_id": 45165264, "question_id": 45164649, "link": "https://stackoverflow.com/questions/45164649/passing-slice-to-scanf/45165264#45165264", "title": "Passing slice to Scanf", "body": "<p>Arguments are always passed by value in Go, never by reference.</p>\n\n<p>You're right that passing a slice to a function would allow the function to mutate its elements.  But you're not passing a slice into <code>Scanf</code>; your two examples are passing in the int64 elements versus passing in the addresses of those elements.  I think you're getting confused by the indexing syntax and thinking <code>mapIsh[0]</code> somehow means you're passing in something the function will be able to mutate.  But <code>mapIsh[0]</code> really is just an int64, the first element of <code>mapIsh</code>.</p>\n\n<p>As for why you're getting zeros, that's because Go initializes <code>mapIsh</code> to the zero-value, which for an array of int64s is all 0s.  When <code>Scanf</code> can't read into the value you forgot the <code>&amp;</code> for, it was not able to continue.  This is why you should check the error returned from <code>Scanf</code>, which will indicate the error.</p>\n\n<p>(Note that pass-by-value means that passing an array to a function creates a copy of that array, so the function will not be able to mutate the elements like it can for a slice.  That isn't actually relevant here, as described above.)</p>\n"}], "owner": {"reputation": 829, "user_id": 4667256, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/860591147318225/picture?type=large", "display_name": "Gilbert Nwaiwu", "link": "https://stackoverflow.com/users/4667256/gilbert-nwaiwu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 477, "favorite_count": 0, "accepted_answer_id": 45165250, "answer_count": 2, "score": 0, "last_activity_date": 1500386715, "creation_date": 1500374987, "last_edit_date": 1500386715, "question_id": 45164649, "link": "https://stackoverflow.com/questions/45164649/passing-slice-to-scanf", "title": "Passing slice to Scanf", "body": "<p>The snippet:</p>\n\n<pre><code>package main\nimport \"fmt\"\n\nfunc main() {\n    mapIsh := make([]int64, 5)\n    fmt.Scanf(\"%v %v %v %v %v\", &amp;mapIsh[0], &amp;mapIsh[1], &amp;mapIsh[2], &amp;mapIsh[3], &amp;mapIsh[4])\n\n    fmt.Print(mapIsh[0], mapIsh[1], mapIsh[2], mapIsh[3], mapIsh[4])\n}\n</code></pre>\n\n<p>I crate a slice and want to save the contents of a read operation. The above works as expected. What i don't get is why I have to pass pointers to the array elements(I assumed the values are passed by reference for slices/arrays).</p>\n\n<p>Also if I don't make one of the arguments a pointer the subsequent values wont be read. So can someone explain the following:</p>\n\n<p>Input data: 1 2 3 4 5</p>\n\n<p>1) For:</p>\n\n<pre><code>fmt.Scanf(\"%v %v %v %v %v\", mapIsh[0], mapIsh[1], mapIsh[2], mapIsh[3], mapIsh[4])\n</code></pre>\n\n<p>I get: 0 0 0 0 0</p>\n\n<p>2) For:</p>\n\n<pre><code>    fmt.Scanf(\"%v %v %v %v %v\", &amp;mapIsh[0], &amp;mapIsh[1], mapIsh[2], &amp;mapIsh[3], &amp;mapIsh[4])\n</code></pre>\n\n<p>I get: 1 2 0 0 0</p>\n"}, {"tags": ["windows", "gcc", "go", "cygwin", "mingw"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 7845697, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbb2951087da6f78a689579617996c5e?s=128&d=identicon&r=PG&f=1", "display_name": "Chlo&#233;", "link": "https://stackoverflow.com/users/7845697/chlo%c3%a9"}, "edited": false, "score": 0, "creation_date": 1500379688, "post_id": 45166040, "comment_id": 77300488, "body": "Thank you for your answer :) I want to use cygwin gcc with the go build but the issue of the unability to find -lmingwex and -lmingw32 seems related to mingw. Cygwin gcc has access to libltdl in its lib folder"}], "tags": [], "owner": {"reputation": 530, "user_id": 2394541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f9b9b9399b329591f7be92da1c5e442?s=128&d=identicon&r=PG", "display_name": "tim18", "link": "https://stackoverflow.com/users/2394541/tim18"}, "is_accepted": false, "score": -1, "last_activity_date": 1500378787, "creation_date": 1500378787, "answer_id": 45166040, "question_id": 45163876, "link": "https://stackoverflow.com/questions/45163876/error-go-build-using-gcc-on-windows/45166040#45166040", "title": "Error go build using gcc on windows", "body": "<p>You're jumping to conclusions without thinking.  Windows X64 has full support for 32-bit .exe, but of course you must avoid trying to mix 32-bit and 64-bit applications. You will need to look up how to install libtool or libltdl (.dll and .h) corresponding to whichever gcc version you end up choosing.  It's unclear on the cygwin web page whether that is supported for cygwin64.  Also, you may need to think about whether you want cygwin gcc and go or a mingw version.</p>\n"}], "owner": {"reputation": 11, "user_id": 7845697, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbb2951087da6f78a689579617996c5e?s=128&d=identicon&r=PG&f=1", "display_name": "Chlo&#233;", "link": "https://stackoverflow.com/users/7845697/chlo%c3%a9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 263, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1500378787, "creation_date": 1500373061, "question_id": 45163876, "link": "https://stackoverflow.com/questions/45163876/error-go-build-using-gcc-on-windows", "title": "Error go build using gcc on windows", "body": "<p>I'm working on hyperledger fabric sdk client on my computer which is running on Windows 10 64 bits but my problem is general with Go.\nIn order to do the go build command on my .go file, I had to install gcc. So I installed cygwin 64 bits for Windows.\nIn the bin repository, I had 3 differents .exe for gcc. I tried all of them : </p>\n\n<ul>\n<li><strong>gcc.exe</strong> : I have an error because this .exe is for windows 32 bits and go is 64 bits</li>\n<li><strong>x86_64-w64-mingw32-gcc.exe</strong> : I have an error, this .exe isn't able to find -lltdl</li>\n<li><strong>x86_64-pc-cygwin-gcc</strong> : This .exe isn't able to find -lmingwex and -lmingw32</li>\n</ul>\n\n<p>The solution proposed on some subject was to install TDM-GCC-64, but when I do that, I have an error : ltdl.h not found</p>\n\n<p>So if anyone have any idea in order to solve this issue, it will be great !\nThank you :)</p>\n\n<p><em>PS : Sorry for my english</em></p>\n"}, {"tags": ["go", "ssh"], "answers": [{"tags": [], "owner": {"reputation": 466, "user_id": 8307258, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L8i2o.jpg?s=128&g=1", "display_name": "Rados\u0142aw Za\u0142uska", "link": "https://stackoverflow.com/users/8307258/rados%c5%82aw-za%c5%82uska"}, "is_accepted": false, "score": 0, "last_activity_date": 1500381256, "creation_date": 1500381256, "answer_id": 45166969, "question_id": 45162792, "link": "https://stackoverflow.com/questions/45162792/close-ssh-session-after-3-sec/45166969#45166969", "title": "Close SSH Session after 3 sec", "body": "<p>I don't know what ssh lib are you using but based on your code it can be <a href=\"https://github.com/coreos/fleet/blob/master/ssh/ssh.go#L207\" rel=\"nofollow noreferrer\">this</a></p>\n\n<p>To avoid program crash you need to check if ssh connection was established successfully. To do this check error produced by ssh.NewSSHClient</p>\n\n<pre><code>for i := 0; i &lt; 900; i++ {\n    // pick random number\n    randomServer := fmt.Sprint(serverList[rand.Intn(len(serverList))])\n\n    // print info\n    logrus.Warn(\"Loop: \", i)\n    logrus.Warn(\"Connecting to: \", randomServer)\n\n    // connect to server\n    cli, err := ssh.NewSSHClient(\"root\", randomServer)\n    if err != nil {\n        fmt.Println(err)\n        continue;\n    }\n\n    // execute any command\n    cli.ExecuteCmd(\"killall5\")\n    cli.ExecuteCmd(\"exit\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": false, "score": 0, "last_activity_date": 1500399172, "creation_date": 1500399172, "answer_id": 45173541, "question_id": 45162792, "link": "https://stackoverflow.com/questions/45162792/close-ssh-session-after-3-sec/45173541#45173541", "title": "Close SSH Session after 3 sec", "body": "<p>There is a bit missing from the code you posted.. Like which packages are being used etc.. however as an example I've provide code that uses the context package to add a 3 second timeout. You can modify this as you see fit, but I think the use of context is very appropriate here.  If you've never used them see the standard library docs <a href=\"https://golang.org/pkg/context/\" rel=\"nofollow noreferrer\">here</a> and do some googling for more examples.</p>\n\n<pre><code>// whatever this is\nvar serverList []string\n\nfunc serverStuff(ctx context.Context, loop int, server string) {\n    // print info\n    logrus.Warn(\"Loop: \", loop)\n    logrus.Warn(\"Connecting to: \", server)\n\n    // connect to server\n    cli := ssh.NewSSHClient(\"root\", server)\n    // execute any command\n    cli.ExecuteCmd(\"killall5\")\n    return\n}\n\nfunc main() {\n\n    for i := 0; i &lt; 900; i++ {\n        // pick random number\n        // create a context that waits 3 seconds\n        ctx := context.Background()\n        ctx, cancel := context.WithTimeout(ctx, 3*time.Second)\n        defer cancel()\n\n        randomServer := fmt.Sprint(serverList[rand.Intn(len(serverList))])\n        go serverStuff(ctx, i, randomServer)\n        for {\n            select {\n            case &lt;-ctx.Done(): // 3 seconds have passed break this loop bring us back to the top\n                break\n            }\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 6942447, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3485870d3285dad6702a3aee079ad6b5?s=128&d=identicon&r=PG&f=1", "display_name": "user6942447", "link": "https://stackoverflow.com/users/6942447/user6942447"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 248, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1500399172, "creation_date": 1500370279, "last_edit_date": 1500377723, "question_id": 45162792, "link": "https://stackoverflow.com/questions/45162792/close-ssh-session-after-3-sec", "title": "Close SSH Session after 3 sec", "body": "<p>I have a for loop which will connect to a server via SSH, kill some processes. The issue that I am running into is that my program tries to reconnect to the server after killing all processes (including SSH) which won't work. The program crashes. </p>\n\n<p>How can I close the ssh connection after 3 seconds and move on with the for loop?</p>\n\n<pre><code> for i := 0; i &lt; 900; i++ {\n    // pick random number\n    randomServer := fmt.Sprint(serverList[rand.Intn(len(serverList))])\n\n    // print info\n    logrus.Warn(\"Loop: \", i)\n    logrus.Warn(\"Connecting to: \", randomServer)\n\n    // connect to server\n    cli := ssh.NewSSHClient(\"root\", randomServer)\n\n    // execute any command\n    cli.ExecuteCmd(\"killall5\")\n    cli.ExecuteCmd(\"exit\")\n}\n</code></pre>\n"}, {"tags": ["python", "python-2.7", "go", "grumpy"], "comments": [{"owner": {"reputation": 538898, "user_id": 104349, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0f4cefeedec5163556751d61625eedd0?s=128&d=identicon&r=PG", "display_name": "Daniel Roseman", "link": "https://stackoverflow.com/users/104349/daniel-roseman"}, "edited": false, "score": 0, "creation_date": 1500370121, "post_id": 45162642, "comment_id": 77293601, "body": "It appears that that library does not support <i>any</i> of the modules that would allow you to make an external connection, so you seem out of luck."}, {"owner": {"reputation": 69, "user_id": 5378667, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0ade3685c41ec5173c7995fa107c5e5e?s=128&d=identicon&r=PG&f=1", "display_name": "gregoff", "link": "https://stackoverflow.com/users/5378667/gregoff"}, "reply_to_user": {"reputation": 538898, "user_id": 104349, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0f4cefeedec5163556751d61625eedd0?s=128&d=identicon&r=PG", "display_name": "Daniel Roseman", "link": "https://stackoverflow.com/users/104349/daniel-roseman"}, "edited": false, "score": 0, "creation_date": 1500371309, "post_id": 45162642, "comment_id": 77294436, "body": "mm thats what I thought, but maybe python and go can be combined? in that case I could write a go module to be used in this case"}, {"owner": {"reputation": 69, "user_id": 5378667, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0ade3685c41ec5173c7995fa107c5e5e?s=128&d=identicon&r=PG&f=1", "display_name": "gregoff", "link": "https://stackoverflow.com/users/5378667/gregoff"}, "reply_to_user": {"reputation": 538898, "user_id": 104349, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/0f4cefeedec5163556751d61625eedd0?s=128&d=identicon&r=PG", "display_name": "Daniel Roseman", "link": "https://stackoverflow.com/users/104349/daniel-roseman"}, "edited": false, "score": 0, "creation_date": 1500371625, "post_id": 45162642, "comment_id": 77294694, "body": "ignore what i said, this maybe possible with native integrations: <a href=\"https://github.com/google/grumpy/wiki/Native-integration\" rel=\"nofollow noreferrer\">github.com/google/grumpy/wiki/Native-integration</a>"}], "owner": {"reputation": 69, "user_id": 5378667, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0ade3685c41ec5173c7995fa107c5e5e?s=128&d=identicon&r=PG&f=1", "display_name": "gregoff", "link": "https://stackoverflow.com/users/5378667/gregoff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1500369911, "creation_date": 1500369911, "question_id": 45162642, "link": "https://stackoverflow.com/questions/45162642/python-2-7-post-data-without-urllib-urllib2-and-httplib-modules-using-golang", "title": "Python 2.7: post data without urllib, urllib2 and httplib modules? (using Golang Grumpy)", "body": "<p>How does one make http/https requests to external url's in Python 2.7 without using the modules urllib, urllib2 or httplib?</p>\n\n<p>The reason I'm asking is that I would like to use the Go conversion tool named Grumpy which converts Python to Go. Currently Grumpy doesn't support the above named modules and doesn't support c compiled libraries either (so PyCurl wouldn't help me neither).</p>\n\n<p>Supported modules: <a href=\"https://github.com/google/grumpy/wiki/Missing-features\" rel=\"nofollow noreferrer\">https://github.com/google/grumpy/wiki/Missing-features</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1500399804, "post_id": 45162499, "comment_id": 77315524, "body": "This has been done many times in Go already.  If you want something light and that comes with some &quot;batteries&quot; included take a look at <a href=\"https://github.com/urfave/negroni\" rel=\"nofollow noreferrer\">github.com/urfave/negroni</a>  it&#39;s very popular and easy to use.  Logging and recovery from panics are standard."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1500473681, "post_id": 45162499, "comment_id": 77353746, "body": "Recovery from panics is already standard in <code>net&#47;http</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1500473789, "post_id": 45162499, "comment_id": 77353838, "body": "@Tery try to post code that will at least compile (unless you&#39;re posting about a compilation issue). The quoted code references <code>alice</code> which is not defined or imported."}], "answers": [{"tags": [], "owner": {"reputation": 3422, "user_id": 205039, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/syKAT.png?s=128&g=1", "display_name": "Flavio Copes", "link": "https://stackoverflow.com/users/205039/flavio-copes"}, "is_accepted": false, "score": 0, "last_activity_date": 1500371955, "creation_date": 1500371955, "answer_id": 45163421, "question_id": 45162499, "link": "https://stackoverflow.com/questions/45162499/middlewares-in-golang/45163421#45163421", "title": "Middlewares in golang", "body": "<p>The request handler can write a response using any of the <a href=\"https://golang.org/pkg/fmt/#Fprint\" rel=\"nofollow noreferrer\"><code>fmt</code> <code>Fprint*</code> methods</a> by passing the <code>http.ResponseWriter</code> as the first argument.</p>\n\n<p>For example:</p>\n\n<pre><code>func handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"URL.Path = %q\\n\", r.URL.Path)\n}\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 8137568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/466e59ea45260f8fce4cdb5bc6c49d6f?s=128&d=identicon&r=PG&f=1", "display_name": "tery", "link": "https://stackoverflow.com/users/8137568/tery"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1500372094, "creation_date": 1500369537, "last_edit_date": 1500372094, "question_id": 45162499, "link": "https://stackoverflow.com/questions/45162499/middlewares-in-golang", "title": "Middlewares in golang", "body": "<p>I'm trying to chain handlers in my project.</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc loggingHandler(next http.Handler) http.Handler {\n    fn := func(w http.ResponseWriter, r *http.Request) {\n        next.ServeHTTP(w, r)\n    }\n    return http.HandlerFunc(fn)\n}\n\nfunc loginHandler(res http.ResponseWriter, req *http.Request) {\n    if req.Method != \"POST\" {\n        http.ServeFile(res, req, \"login.html\")\n        return\n    }\n    // some code\n}\n\nfunc MainPageHandler(res http.ResponseWriter, req *http.Request) {\n    // some code\n}\n\nfunc main() {\n    db, err = sql.Open(\"\", \"password@()/db name\")\n    if err != nil {\n        fmt.Println(err)\n    }\n    defer db.Close()\n    commonHandlers := alice.New(loggingHandler)\n    http.Handle(\"/Login\", commonHandlers.ThenFunc(loginHandler))\n    http.Handle(\"/\", commonHandlers.ThenFunc(MainPageHandler))\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>what should i do to get an output?\nThanks in advance.</p>\n"}, {"tags": ["go", "goland"], "answers": [{"comments": [{"owner": {"reputation": 464, "user_id": 2110709, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/bcd9ff1a22de06f88ce5e9089bd2ae82?s=128&d=identicon&r=PG", "display_name": "iclinux", "link": "https://stackoverflow.com/users/2110709/iclinux"}, "edited": false, "score": 0, "creation_date": 1500370825, "post_id": 45162786, "comment_id": 77294068, "body": "thanks a lot! I don&#39;t know why set None as default setting for Placement..."}], "tags": [], "owner": {"reputation": 466, "user_id": 8307258, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L8i2o.jpg?s=128&g=1", "display_name": "Rados\u0142aw Za\u0142uska", "link": "https://stackoverflow.com/users/8307258/rados%c5%82aw-za%c5%82uska"}, "is_accepted": true, "score": 2, "last_activity_date": 1500370266, "creation_date": 1500370266, "answer_id": 45162786, "question_id": 45161844, "link": "https://stackoverflow.com/questions/45161844/how-to-show-opened-files-in-tabs-in-gogland-ide/45162786#45162786", "title": "how to show opened files in tabs in Gogland IDE?", "body": "<p>Go to:</p>\n\n<p><strong>File</strong> -> <strong>Settings</strong> -> <strong>Editor</strong> -> <strong>General</strong> -> <strong>Editor Tabs</strong></p>\n\n<p>In section <strong>Tab Appearance</strong> find <strong>Placement</strong> drop down list.</p>\n\n<p>If is it set to <strong>None</strong> then change it to <strong>Top</strong>.</p>\n\n<p>Confirm with <strong>OK</strong> button</p>\n"}], "owner": {"reputation": 464, "user_id": 2110709, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/bcd9ff1a22de06f88ce5e9089bd2ae82?s=128&d=identicon&r=PG", "display_name": "iclinux", "link": "https://stackoverflow.com/users/2110709/iclinux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 45162786, "answer_count": 1, "score": 0, "last_activity_date": 1500370266, "creation_date": 1500367780, "question_id": 45161844, "link": "https://stackoverflow.com/questions/45161844/how-to-show-opened-files-in-tabs-in-gogland-ide", "title": "how to show opened files in tabs in Gogland IDE?", "body": "<p>I'm new to Go lang, and downloaded a IDE named Gogland-EAP.\n (<a href=\"https://download.jetbrains.8686c.com/go/gogland-171.4694.61.dmg\" rel=\"nofollow noreferrer\">https://download.jetbrains.8686c.com/go/gogland-171.4694.61.dmg</a>) </p>\n\n<p>It's very good, but I don't know how to show opened files in tabs, such as other IDE.</p>\n\n<p>I can only see one opened file at a time, there's no tab at all. After another file opened, the first opened file disappeared.</p>\n\n<p>Is there any special setting for Gogland-EAP I need to set?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 56338, "user_id": 4265352, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lzAUc5pYb24/AAAAAAAAAAI/AAAAAAAAAGQ/q3h7bZUnqrs/photo.jpg?sz=128", "display_name": "axiac", "link": "https://stackoverflow.com/users/4265352/axiac"}, "edited": false, "score": 0, "creation_date": 1500365495, "post_id": 45160822, "comment_id": 77290351, "body": "<code>2006-01-02 15:04:05</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 853, "user_id": 8319308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffe9c03af12d10772279677c6f1b9f84?s=128&d=identicon&r=PG&f=1", "display_name": "Vadim Beskrovnov", "link": "https://stackoverflow.com/users/8319308/vadim-beskrovnov"}, "is_accepted": false, "score": 2, "last_activity_date": 1500365035, "creation_date": 1500365035, "answer_id": 45160869, "question_id": 45160822, "link": "https://stackoverflow.com/questions/45160822/what-does-20060102150405-mean/45160869#45160869", "title": "What does 20060102150405 mean?", "body": "<p>See <a href=\"https://golang.org/pkg/time/#pkg-constants\" rel=\"nofollow noreferrer\">https://golang.org/pkg/time/#pkg-constants</a> It is the time \"01/02 03:04:05PM '06 -0700\" Because each component has a different number (1, 2, 3, etc.), it can determine from the numbers what components you want.</p>\n"}, {"tags": [], "owner": {"reputation": 3422, "user_id": 205039, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/syKAT.png?s=128&g=1", "display_name": "Flavio Copes", "link": "https://stackoverflow.com/users/205039/flavio-copes"}, "is_accepted": false, "score": 7, "last_activity_date": 1500374252, "last_edit_date": 1500374252, "creation_date": 1500372909, "answer_id": 45163813, "question_id": 45160822, "link": "https://stackoverflow.com/questions/45160822/what-does-20060102150405-mean/45163813#45163813", "title": "What does 20060102150405 mean?", "body": "<p>Go's time formatting unique and different than what you would do in other languages. Instead of having a conventional format to print the date, Go uses the reference date <code>20060102150405</code> which seems meaningless but actually has a reason, as it's <code>1 2 3 4 5 6</code> in the Posix <code>date</code> command:</p>\n\n<pre><code>Mon Jan 2 15:04:05 -0700 MST 2006\n0   1   2  3  4  5              6\n</code></pre>\n\n<p>The timezone is <code>7</code> but that sits in the middle, so in the end the format resembles <code>1 2 3 4 5 7 6</code>.</p>\n\n<p><a href=\"http://fuckinggodateformat.com\" rel=\"noreferrer\">This online converter</a> is handy, if you are transitioning from the <code>strftime</code> format.</p>\n\n<p>Interesting historical reference: <a href=\"https://github.com/golang/go/issues/444\" rel=\"noreferrer\">https://github.com/golang/go/issues/444</a></p>\n\n<p>The <code>time</code> package provides handy constants as well:</p>\n\n<p><code>\nconst (\n        ANSIC       = \"Mon Jan _2 15:04:05 2006\"\n        UnixDate    = \"Mon Jan _2 15:04:05 MST 2006\"\n        RubyDate    = \"Mon Jan 02 15:04:05 -0700 2006\"\n        RFC822      = \"02 Jan 06 15:04 MST\"\n        RFC822Z     = \"02 Jan 06 15:04 -0700\" // RFC822 with numeric zone\n        RFC850      = \"Monday, 02-Jan-06 15:04:05 MST\"\n        RFC1123     = \"Mon, 02 Jan 2006 15:04:05 MST\"\n        RFC1123Z    = \"Mon, 02 Jan 2006 15:04:05 -0700\" // RFC1123 with numeric zone\n        RFC3339     = \"2006-01-02T15:04:05Z07:00\"\n        RFC3339Nano = \"2006-01-02T15:04:05.999999999Z07:00\"\n        Kitchen     = \"3:04PM\"\n        // Handy time stamps.\n        Stamp      = \"Jan _2 15:04:05\"\n        StampMilli = \"Jan _2 15:04:05.000\"\n        StampMicro = \"Jan _2 15:04:05.000000\"\n        StampNano  = \"Jan _2 15:04:05.000000000\"\n)\n</code></p>\n\n<p>You can use them like this:</p>\n\n<pre><code>t := time.Now()\nfmt.Println(t.Format(time.ANSIC))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5283, "user_id": 6336221, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-Rh8CEJ_IGpA/AAAAAAAAAAI/AAAAAAAAALc/VV4nk6Yyqhg/photo.jpg?sz=128", "display_name": "Nisal Edu", "link": "https://stackoverflow.com/users/6336221/nisal-edu"}, "is_accepted": false, "score": 0, "last_activity_date": 1500373503, "creation_date": 1500373503, "answer_id": 45164046, "question_id": 45160822, "link": "https://stackoverflow.com/questions/45160822/what-does-20060102150405-mean/45164046#45164046", "title": "What does 20060102150405 mean?", "body": "<p>20060102150405 is a date and time format 2006/01/02 15:04:05</p>\n\n<p>package main</p>\n\n<p>import (\n    \"fmt\"\n    \"time\"\n    )</p>\n\n<p>func main() {</p>\n\n<pre><code>date1 := time.Now().Format(\"2006/01/02 15:04\")\nfmt.Println(date1)//2009/11/10 23:00\n\ndate2 := time.Now().Format(\"20060102150405\")\nfmt.Println(date2)//20091110230000\n</code></pre>\n\n<p>}</p>\n\n<p><a href=\"https://play.golang.org/p/kIfNRQ50JP\" rel=\"nofollow noreferrer\">https://play.golang.org/p/kIfNRQ50JP</a></p>\n"}], "owner": {"reputation": 2133, "user_id": 6101969, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/af337f9791a73a3a4590d809a0bbc49e?s=128&d=identicon&r=PG&f=1", "display_name": "J.Done", "link": "https://stackoverflow.com/users/6101969/j-done"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2432, "favorite_count": 1, "answer_count": 3, "score": 2, "last_activity_date": 1500374252, "creation_date": 1500364886, "last_edit_date": 1500365407, "question_id": 45160822, "link": "https://stackoverflow.com/questions/45160822/what-does-20060102150405-mean", "title": "What does 20060102150405 mean?", "body": "<p>I would like to get current time value. I found <a href=\"https://stackoverflow.com/questions/5885486/how-do-i-get-the-current-timestamp-in-go/5885753\">this</a> answer which works for me but don't know why format method take <code>20060102150405</code> value? Not like <code>yyyyMMdd hhmmss</code>.</p>\n"}, {"tags": ["curl", "go", "signals", "go-gin"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500383416, "post_id": 45159694, "comment_id": 77303392, "body": "If you&#39;re on macOS, make sure Go and XCode are up to date."}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500384403, "post_id": 45159694, "comment_id": 77304186, "body": "No I&#39;m on ubuntu, running go 1.8.3."}, {"owner": {"reputation": 7660, "user_id": 2350684, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yuQa5.jpg?s=128&g=1", "display_name": "Oliver", "link": "https://stackoverflow.com/users/2350684/oliver"}, "edited": false, "score": 0, "creation_date": 1500399687, "post_id": 45159694, "comment_id": 77315459, "body": "Is this running in a VPS? Any chance you&#39;re running out of memory? Anything relevant in <code>&#47;var&#47;log&#47;kern.log</code> ?"}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1500407168, "post_id": 45159694, "comment_id": 77320027, "body": "No I&#39;m on my Desktop with abundant RAM. What should I look for at <code>kern.log</code>?"}, {"owner": {"reputation": 990, "user_id": 2681335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa5c2b4a388746403da36ebc31acdda5?s=128&d=identicon&r=PG", "display_name": "menghan", "link": "https://stackoverflow.com/users/2681335/menghan"}, "edited": false, "score": 0, "creation_date": 1540280377, "post_id": 45159694, "comment_id": 92795384, "body": "can you repeat the problem?"}], "owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 119, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1500361682, "creation_date": 1500361144, "last_edit_date": 1500361682, "question_id": 45159694, "link": "https://stackoverflow.com/questions/45159694/signal-killed-and-server-freezes-after-post", "title": "signal: killed and server freezes after post", "body": "<p>I have this weird message after successfully posting an article. </p>\n\n<pre><code>[GIN] 2017/07/18 - 08:43:21 | 200 |   42.729836ms |       127.0.0.1 |  POST     /api/articles\nsignal: killed\n</code></pre>\n\n<p>The post that I make using curl is:</p>\n\n<pre><code> curl -X POST http://127.0.0.1:8080/api/articles  -v --cookie \"domain=somelongstring\"   -F 'title=My title' -F 'content=Some stuff comes here'  -F \"file=@/home/me/Desktop/random.jpg\" -H \"Content-Type: multipart/form-data\" \n</code></pre>\n\n<p>The curl response is this:</p>\n\n<pre><code>&gt; Content-Length: 84289\n&gt; Expect: 100-continue\n&gt; Content-Type: multipart/form-data; boundary=------------------------47d5c18e46bf271a\n&gt; \n&lt; HTTP/1.1 100 Continue\n&lt; HTTP/1.1 200 OK\n&lt; Access-Control-Allow-Origin: *\n&lt; Content-Type: application/json; charset=utf-8\n&lt; Date: Tue, 18 Jul 2017 06:43:21 GMT\n&lt; Content-Length: 28\n&lt; \n* Connection #0 to host 127.0.0.1 left intact\n</code></pre>\n\n<p>The post handler is this:</p>\n\n<pre><code>func PostArticle(c *gin.Context) {\n    var err error\n    userId, userName := getUserId(c)\n    form, err := c.MultipartForm()\n    title := c.PostForm(\"title\")\n    content := c.PostForm(\"content\")\n    if err != nil {\n        fmt.Printf(\"%+v, %+v\\n\", form, err)\n        return\n    }\n    file, err := c.FormFile(\"file\")\n    if err != nil {\n        log.Println(err)\n        c.String(http.StatusBadRequest, fmt.Sprintf(\"get form err: %s\", err.Error()))\n        return\n    }\n\n    dir, err := os.Getwd()\n    if err != nil {\n        log.Fatal(err)\n        return\n    }\n\n    filename := path.Join(shared.RandString(6) + path.Ext(file.Filename))\n\n    dest := dir + \"/static/photos/\" + filename\n\n    if err := c.SaveUploadedFile(file, dest); err != nil {\n        c.String(http.StatusBadRequest, fmt.Sprintf(\"upload file err: %s\", err.Error()))\n        return\n    }\n\n    _, err = shared.Dbmap.Exec(\"INSERT INTO article (user_id, username, title, content, photo) VALUES (?, ?, ?, ?, ?)\", userId, userName, title, content, filename)\n\n    if err != nil {\n        log.Fatal(err)\n        return\n    }\n    c.JSON(http.StatusOK, gin.H{\"success\": \"article is created\"})\n\n}\n</code></pre>\n\n<p>I see that the post is created and get no errors. Nor do I get this <code>signal: killed</code> after any GET request, so wondering what can be wrong here and how to fix it?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1500396991, "post_id": 45159166, "comment_id": 77313879, "body": "Check at this stack as some of your issues are addressed here <a href=\"https://stackoverflow.com/questions/26574594/best-practice-to-maintain-a-mgo-session\" title=\"best practice to maintain a mgo session\">stackoverflow.com/questions/26574594/&hellip;</a>"}, {"owner": {"reputation": 10244, "user_id": 797194, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3728c41e604024f375043551a59b41df?s=128&d=identicon&r=PG", "display_name": "m90", "link": "https://stackoverflow.com/users/797194/m90"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1500398127, "post_id": 45159166, "comment_id": 77314562, "body": "@reticentroot cool thanks for digging that up, somehow wasn&#39;t able to find it."}], "owner": {"reputation": 10244, "user_id": 797194, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3728c41e604024f375043551a59b41df?s=128&d=identicon&r=PG", "display_name": "m90", "link": "https://stackoverflow.com/users/797194/m90"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 121, "favorite_count": 2, "closed_date": 1500400246, "answer_count": 0, "score": 2, "last_activity_date": 1500359940, "creation_date": 1500359551, "last_edit_date": 1500359940, "question_id": 45159166, "link": "https://stackoverflow.com/questions/45159166/how-should-i-handle-the-creation-and-disposal-of-sessions-using-mgo-v2", "closed_reason": "Duplicate", "title": "How should I handle the creation and disposal of sessions using mgo.v2?", "body": "<p>I'm connecting a golang webservice to a MongoDB database. I'm a little confused about what's the best and safest way of creating and storing the database sessions. In other languages I am used to an approach where I can open and close a connection for every request like (pseudocode)</p>\n\n<pre><code>conn = db.newConnection()\nquery = conn.query({id: 'my-id'})\nconn.close()\n</code></pre>\n\n<p>which would ensure that the connection is always closed properly and resources are freed. Whenever there is a connectivity hiccup it will be affected only temporarily. Performance hits are not to be expected as databases are heavily optimized for such behavior.</p>\n\n<p>Now, the <a href=\"http://godoc.org/gopkg.in/mgo.v2#Dial\" rel=\"nofollow noreferrer\">mgo docs on <code>Dial()</code></a>(which is used for establishing a connection) state:</p>\n\n<blockquote>\n  <p>This method is generally called just once for a given cluster. Further\n  sessions to the same cluster are then established using the New or\n  Copy methods on the obtained session. This will make them share the\n  underlying cluster, and manage the pool of connections appropriately.</p>\n</blockquote>\n\n<p>which led to me having a single package level connection that I create on package <code>init</code> and which is then shared by all instantiated clients:</p>\n\n<pre><code>var database *mgo.Database\n// Setup runs all the needed steps to establish a database connection\nfunc Setup() error {\n    var sessionErr error\n    mongoSession, sessionErr = mgo.Dial(os.Getenv(\"MONGO_HOST\"))\n    if sessionErr != nil {\n        return sessionErr\n    }\n    database = mongoSession.DB(os.Getenv(\"DB_NAME\"))\n    return nil\n}\n</code></pre>\n\n<p>This works kind of ok, yet I am running into issues where about once a month the connection to the database is lost and cannot be recovered during the lifetime of the process (making all requests return <code>EOF</code> and requiring someone to restart the process). I have never seen this happen using the connect-and-close-on-each-query approach I have described above.</p>\n\n<p>I'm pretty sure I must be doing something wrong, but I feel I am doing what the docs tell me and all examples I can find on the web are one-off things that do not cover the case of a long-running application.</p>\n\n<p>What is the recommended way of handling Mongo connections in a failure safe way inside long-running applications using <code>mgo</code>? Is there an established pattern of using <a href=\"http://godoc.org/gopkg.in/mgo.v2#Session.Copy\" rel=\"nofollow noreferrer\"><code>Copy()</code></a> or <a href=\"http://godoc.org/gopkg.in/mgo.v2#Session.New\" rel=\"nofollow noreferrer\"><code>New()</code></a> which are mentioned in the documentation? Will using them prevent permanently failed connections?</p>\n"}, {"tags": ["go", "websocket", "gorilla"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1500386081, "last_edit_date": 1500386081, "creation_date": 1500384363, "answer_id": 45168144, "question_id": 45158754, "link": "https://stackoverflow.com/questions/45158754/websocket-freezes-if-disconnected-abnormally/45168144#45168144", "title": "Websocket freezes if disconnected abnormally", "body": "<p>See the <a href=\"https://github.com/gorilla/websocket/tree/master/examples/chat\" rel=\"nofollow noreferrer\">Gorilla Chat Application</a> for an example of how to avoid blocking on a client.</p>\n\n<p>The key parts are:</p>\n\n<ul>\n<li><p><a href=\"https://github.com/gorilla/websocket/blob/462d5c5828f6203e4047c47be2920315937be380/examples/chat/client.go#L130\" rel=\"nofollow noreferrer\">Use a buffered channel for sending to the client</a>. Your application is already doing this.</p></li>\n<li><p><a href=\"https://github.com/gorilla/websocket/blob/462d5c5828f6203e4047c47be2920315937be380/examples/chat/hub.go#L43-L49\" rel=\"nofollow noreferrer\">Send to the client using select/default</a> to avoid blocking. Assume that the client is blocked on write when the client cannot immediately receive a message. Close the client's channel in this situation to cause the client's write loop to exit.</p></li>\n<li><p><a href=\"https://github.com/gorilla/websocket/blob/462d5c5828f6203e4047c47be2920315937be380/examples/chat/client.go#L91\" rel=\"nofollow noreferrer\">Write with a deadline</a>.</p></li>\n</ul>\n"}], "owner": {"reputation": 241, "user_id": 782368, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8544465753d56e89bd1bb2c92e9cea7a?s=128&d=identicon&r=PG", "display_name": "Daniyal", "link": "https://stackoverflow.com/users/782368/daniyal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 308, "favorite_count": 1, "accepted_answer_id": 45168144, "answer_count": 1, "score": 1, "last_activity_date": 1500386081, "creation_date": 1500358122, "question_id": 45158754, "link": "https://stackoverflow.com/questions/45158754/websocket-freezes-if-disconnected-abnormally", "title": "Websocket freezes if disconnected abnormally", "body": "<p>I've created a simple websocket that publishes a JSON stream. I't works fine most of the time except for few cases where I think while looping through the clients to send them message, it gets hung up on a client that is being disconnected abnormally. What measure can I add to this code to mitigate it?</p>\n\n<p><strong>Client.go</strong></p>\n\n<pre><code>import (\n    \"github.com/gorilla/websocket\"\n)\n\ntype client struct {\n    socket *websocket.Conn\n\n    send chan *Message\n}\n\nfunc (c *client) read() {\n    defer c.socket.Close()\n    for {\n        _, _, err := c.socket.ReadMessage()\n        if err != nil {\n            log.Info(\"Websocket: %s\", err)\n            break\n        }\n    }\n}\n\nfunc (c *client) write() {\n    defer c.socket.Close()\n    for msg := range c.send {\n        err := c.socket.WriteJSON(msg)\n        if err != nil {\n            break\n        }\n    }\n}\n</code></pre>\n\n<p><strong>Stream.go</strong></p>\n\n<pre><code>import (\n    \"net/http\"\n\n    \"github.com/gorilla/websocket\"\n)\n\nconst (\n    socketBufferSize  = 1024\n    messageBufferSize = 256\n)\n\nvar upgrader = &amp;websocket.Upgrader{\n    ReadBufferSize:  socketBufferSize,\n    WriteBufferSize: socketBufferSize,\n}\n\ntype Stream struct {\n    Send chan *Message\n\n    join chan *client\n\n    leave chan *client\n\n    clients map[*client]bool\n}\n\nfunc (s *Stream) Run() {\n    for {\n        select {\n        case client := &lt;-s.join: // joining\n            s.clients[client] = true\n        case client := &lt;-s.leave: // leaving\n            delete(s.clients, client)\n            close(client.send)\n        case msg := &lt;-s.Send: // send message to all clients\n            for client := range s.clients {\n                client.send &lt;- msg\n            }\n        }\n    }\n}\n\nfunc (s *Stream) ServeHTTP(w http.ResponseWriter, res *http.Request) {\n    socket, err := upgrader.Upgrade(w, res, nil)\n    if err != nil {\n        log.Error(err)\n        return\n    }\n\n    defer func() {\n        socket.Close()\n    }()\n\n    client := &amp;client{\n        socket: socket,\n        send:   make(chan *Message, messageBufferSize),\n    }\n\n    s.join &lt;- client\n    defer func() { s.leave &lt;- client }()\n\n    go client.write()\n    client.read()\n}        \n</code></pre>\n"}, {"tags": ["c", "go", "long-double"], "comments": [{"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1500355103, "post_id": 45158059, "comment_id": 77284546, "body": "Even in C your code is not meaningful and probably has some <a href=\"https://en.wikipedia.org/wiki/Undefined_behavior\" rel=\"nofollow noreferrer\">undefined behavior</a>. So improve the C code to make it standard compliant."}, {"owner": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "edited": false, "score": 0, "creation_date": 1500470480, "post_id": 45158059, "comment_id": 77350951, "body": "Why not just use an existing implementation of a gaussian distribution in Go (such as <a href=\"https://github.com/chobie/go-gaussian/\" rel=\"nofollow noreferrer\">go-gaussian</a>) instead of porting C code again (and introducing your own bugs)?"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user5817854"}, "edited": false, "score": 0, "creation_date": 1500379039, "post_id": 45158178, "comment_id": 77300019, "body": "I updated the question and added a link to the original source code. Thank you for the explanation regarding the different architectures."}, {"owner": {"reputation": 26934, "user_id": 8316315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44d833a8a46fea39d7bfca1540ea9c07?s=128&d=identicon&r=PG&f=1", "display_name": "Florian Weimer", "link": "https://stackoverflow.com/users/8316315/florian-weimer"}, "edited": false, "score": 0, "creation_date": 1500379919, "post_id": 45158178, "comment_id": 77300674, "body": "Thanks, I had a brief look at the C sources and updated my answer."}], "tags": [], "owner": {"reputation": 26934, "user_id": 8316315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44d833a8a46fea39d7bfca1540ea9c07?s=128&d=identicon&r=PG&f=1", "display_name": "Florian Weimer", "link": "https://stackoverflow.com/users/8316315/florian-weimer"}, "is_accepted": true, "score": 1, "last_activity_date": 1500379898, "last_edit_date": 1500379898, "creation_date": 1500355479, "answer_id": 45158178, "question_id": 45158059, "link": "https://stackoverflow.com/questions/45158059/c-long-double-in-golang/45158178#45158178", "title": "C long double in golang", "body": "<p>The assignment <code>cdf[i] = s</code> performs an implicit conversion to <code>uint64_t</code>.  It's hard to tell if this is intended without the calculations you omitted.</p>\n\n<p>In practice, <code>long double</code> as a type has considerable variance across architectures.  Whether Go's <code>float64</code> is an appropriate replacement depends on the architecture you are porting from.  For example, on x86, <code>long double</code> is an 80-byte extended precision type, but <a href=\"https://github.com/Microsoft/BashOnWindows/issues/830\" rel=\"nofollow noreferrer\">Windows systems are usually configured in such a way to compute results only with the 53-bit mantissa</a>, which means that <code>float64</code> could still be equivalent for your purposes.</p>\n\n<p><strong>EDIT</strong> In this particular case, the values computed by the sources appear to be static and independent of the input.  I would just use <code>float64</code> on the Go side and see if the computed values are identical to those of the C version, when run on a x86 machine under real GNU/Linux (virtualization should be okay), to work around the Windows FPU issues.  The choice of x86 is just a guess because it is likely what the original author used.  I do not understand the underlying cryptography, so I can't say whether a difference in the computed values impact the security.  (Also note that the C code does not seem to properly seed its PRNG.)</p>\n"}, {"tags": [], "owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "is_accepted": false, "score": 1, "last_activity_date": 1575841489, "last_edit_date": 1575841489, "creation_date": 1575841145, "answer_id": 59240137, "question_id": 45158059, "link": "https://stackoverflow.com/questions/45158059/c-long-double-in-golang/59240137#59240137", "title": "C long double in golang", "body": "<blockquote>\n  <p>C long double in golang</p>\n</blockquote>\n\n<p>The title suggests an interest in whether of not Go has an <a href=\"https://en.wikipedia.org/wiki/Extended_precision\" rel=\"nofollow noreferrer\">extended precision</a> floating-point type similar to <a href=\"https://en.wikipedia.org/wiki/Long_double\" rel=\"nofollow noreferrer\"><code>long double</code></a> in C.</p>\n\n<p>The answer is:</p>\n\n<ul>\n<li>Not as a primitive, see <a href=\"https://tour.golang.org/basics/11\" rel=\"nofollow noreferrer\">Basic types</a>.</li>\n<li>But <em>arbitrary precision</em> is supported by the <a href=\"https://golang.org/pkg/math/big/\" rel=\"nofollow noreferrer\">math/big library</a>.</li>\n</ul>\n\n<hr>\n\n<blockquote>\n  <p>Why this is working?</p>\n</blockquote>\n\n<pre><code>long double s = some_calculation();\nuint64_t a = s;\n</code></pre>\n\n<p>It compiles because, unlike Go, C allows for certain implicit type conversions.  The <em>integer portion</em> of the floating-point value of <code>s</code> will be copied.  Presumably the <code>s</code> value has been scaled such that it can be interpreted as a <a href=\"https://en.wikipedia.org/wiki/Fixed-point_arithmetic\" rel=\"nofollow noreferrer\">fixed-point</a> value where, based on the linked library source, <a href=\"https://github.com/mjosaarinen/hilabliss/blob/c098abf744e28a11d8d9dc422a1a0ace98f369fc/distribution.c#L40\" rel=\"nofollow noreferrer\"><code>0xFFFFFFFFFFFFFFFF</code></a> (2^64-1) represents the value 1.0.  In order to make the most of such assignments, it may be worthwhile to have used an extended floating-point type with 64 precision bits.</p>\n\n<p>If I had to guess, I would say that the (crypto-related) library is using fixed-point here because they want to ensure deterministic results, see: <a href=\"https://stackoverflow.com/q/7365790/86967\">How can floating point calculations be made deterministic?</a>.  And since the extended-precision floating point is only being used for initializing a lookup table, using the (presumably slow) math/big library would likely perform perfectly fine in this context.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5817854"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8390, "favorite_count": 1, "accepted_answer_id": 45158178, "answer_count": 2, "score": 0, "last_activity_date": 1575841489, "creation_date": 1500354933, "last_edit_date": 1500378161, "question_id": 45158059, "link": "https://stackoverflow.com/questions/45158059/c-long-double-in-golang", "title": "C long double in golang", "body": "<p>I am porting an algorithm from C to Go. And I got a little bit confused. This is the C function:</p>\n\n<pre><code>void gauss_gen_cdf(uint64_t cdf[], long double sigma, int n)\n{\n    int i;\n    long double s, d, e;\n\n    //Calculations ...\n\n    for (i = 1; i &lt; n - 1; i++) {\n       cdf[i] = s;\n    }   \n}\n</code></pre>\n\n<p>And in the for loop value \"s\" is assigned to element \"x\" the array cdf. How is this possible? As far as I know, a long double is a float64 (in the Go context). So I shouldn't be able to compile the C code because I am assigning an long double to an array which just contains uint64 elements. But the C code is working fine.</p>\n\n<p>So can someone please explain why this is working?</p>\n\n<p>Thank you very much.</p>\n\n<p>UPDATE:</p>\n\n<p>The original C code of the function can be found here: <a href=\"https://github.com/mjosaarinen/hilabliss/blob/master/distribution.c#L22\" rel=\"nofollow noreferrer\">https://github.com/mjosaarinen/hilabliss/blob/master/distribution.c#L22</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1500345483, "post_id": 45156553, "comment_id": 77281907, "body": "you tell us, what&#39;s the error you&#39;re seeing ? well at first look you&#39;re ignoring an error when open a file"}, {"owner": {"reputation": 2133, "user_id": 6101969, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/af337f9791a73a3a4590d809a0bbc49e?s=128&d=identicon&r=PG&f=1", "display_name": "J.Done", "link": "https://stackoverflow.com/users/6101969/j-done"}, "reply_to_user": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1500345564, "post_id": 45156553, "comment_id": 77281926, "body": "Added error message below."}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1500345660, "post_id": 45156553, "comment_id": 77281945, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/26327391/go-json-marshalstruct-returns\">Go json.Marshal(struct) returns &quot;{}&quot;</a>"}, {"owner": {"reputation": 2133, "user_id": 6101969, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/af337f9791a73a3a4590d809a0bbc49e?s=128&d=identicon&r=PG&f=1", "display_name": "J.Done", "link": "https://stackoverflow.com/users/6101969/j-done"}, "reply_to_user": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1500346154, "post_id": 45156553, "comment_id": 77282066, "body": "I&#39;ve tried with Marshal(), and having another error."}], "answers": [{"tags": [], "owner": {"reputation": 7660, "user_id": 2350684, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yuQa5.jpg?s=128&g=1", "display_name": "Oliver", "link": "https://stackoverflow.com/users/2350684/oliver"}, "is_accepted": false, "score": 1, "last_activity_date": 1500346379, "creation_date": 1500346379, "answer_id": 45156684, "question_id": 45156553, "link": "https://stackoverflow.com/questions/45156553/load-json-array-configuration/45156684#45156684", "title": "Load json array configuration", "body": "<p>You should use <code>json.Unmarshal()</code> to populate your config struct.</p>\n\n<pre><code>file, err := ioutil.ReadFile(\"./col.conf\")\nif err != nil {\n    fmt.Printf(\"File error: %v\\n\", err)\n    os.Exit(1)\n}\ncfg := Config{}\njson.Unmarshal(file, &amp;cfg)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 354, "user_id": 2488951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0681fa3aa9503cb0c5563b75384368b0?s=128&d=identicon&r=PG", "display_name": "AnkurJat", "link": "https://stackoverflow.com/users/2488951/ankurjat"}, "is_accepted": true, "score": 1, "last_activity_date": 1500359977, "creation_date": 1500359977, "answer_id": 45159309, "question_id": 45156553, "link": "https://stackoverflow.com/questions/45156553/load-json-array-configuration/45159309#45159309", "title": "Load json array configuration", "body": "<p>You need to change your \"ColInfo\" struct keys so that \"json\" package can read them. I'm attaching a working code snippet</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n)\n\ntype ColInfo struct {\n    Key string `json:\"key\"`\n    Col []int  `json:\"data\"`\n}\ntype Config struct {\n    colInfos []ColInfo\n}\n\nfunc main() {\n    file, err := ioutil.ReadFile(\"configurtaion.txt\")\n    if err != nil {\n        fmt.Printf(\"File error: %v\\n\", err)\n        os.Exit(1)\n    }\n    cfg := Config{}\n    json.Unmarshal(file, &amp;cfg.colInfos)\n    fmt.Println(cfg.colInfos[0])\n}\n</code></pre>\n"}], "owner": {"reputation": 2133, "user_id": 6101969, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/af337f9791a73a3a4590d809a0bbc49e?s=128&d=identicon&r=PG&f=1", "display_name": "J.Done", "link": "https://stackoverflow.com/users/6101969/j-done"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 812, "favorite_count": 0, "accepted_answer_id": 45159309, "answer_count": 2, "score": 0, "last_activity_date": 1500364649, "creation_date": 1500345333, "last_edit_date": 1500364649, "question_id": 45156553, "link": "https://stackoverflow.com/questions/45156553/load-json-array-configuration", "title": "Load json array configuration", "body": "<p>I would like to load json configuration file to go lang app.\nConfiguration data is array since it needs to be dynamically set.</p>\n\n<blockquote>\n  <p>[\n      { \"key\": \"A\", \"data\": [1, 2, 3]},\n      { \"key\": \"B\", \"data\": [1, 2]},\n      { \"key\": \"C\", \"data\": [1, 3]} ]</p>\n</blockquote>\n\n<p>And tried to load like this.</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"os\"\n    \"encoding/json\"\n)\n\ntype ColInfo struct {\n    key     string  `json:\"key\"`\n    col     []int   `json:\"data\"`\n}\ntype Config struct {\n    colInfos    []ColInfo\n}\n\nfunc main() {\n    flag.Parse()\n    file, _ := os.Open(\"col.conf\")\n    decoder := json.Marshal(file)\n    configuration := Config{}\n    if err := decoder.Decode(&amp;configuration); err != nil {\n        fmt.Println(err)\n    }\n    println( configuration.colInfos[0].key)\n}\n</code></pre>\n\n<p>Here is error I've got</p>\n\n<blockquote>\n  <p>./test2.go:23: multiple-value json.Marshal() in single-value context</p>\n</blockquote>\n\n<p>What am i wrong with this?</p>\n"}, {"tags": ["mongodb", "go", "grpc", "mgo"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1500331970, "post_id": 45154825, "comment_id": 77278718, "body": "It might be possible to just manually add the <code>bson</code> tags. Have you tried it as a test? If it works, you could probably write a script to take care of it from then on."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1500332355, "post_id": 45154825, "comment_id": 77278817, "body": "With the <code>bson.ObjectId</code>, you could put both in the struct (or embed), then just make sure when you retrieve one from either source, you populate the empty one. I suppose that still exposes some tedious work, but not as much as converting the entire struct."}, {"owner": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1500332567, "post_id": 45154825, "comment_id": 77278863, "body": "Trouble is, I was planning on automating the code generation on build or something, so it would just override it. I guess I could just not do that and manually update it, but it feels like there should be a standard way of doing this. Surely loads of people are spitting out mongodb queries into gRPC in Golang? Embedding the ID could work actually! Still tricky as you mentioned though"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1500476222, "post_id": 45154825, "comment_id": 77355851, "body": "You can have a look at <a href=\"https://github.com/gogo/protobuf\" rel=\"nofollow noreferrer\">gogoprotobuf&#39;s</a> extension <a href=\"https://github.com/gogo/protobuf/blob/master/extensions.md#more-serialization-formats\" rel=\"nofollow noreferrer\"><b><code>moretags</code></b></a>. I used it for this very use case and it works fine."}, {"owner": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1500541753, "post_id": 45154825, "comment_id": 77386586, "body": "@MarkusWMahlberg how did you deal with the ID parameter naming mismatch (Id string and ID bson.ObjectId) ?"}, {"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1535119498, "post_id": 45154825, "comment_id": 90962187, "body": "Hey ! So how did you handle it?"}, {"owner": {"reputation": 549, "user_id": 1993325, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9df0ef792b4031d7235ad625eb08238b?s=128&d=identicon&r=PG", "display_name": "bazaglia", "link": "https://stackoverflow.com/users/1993325/bazaglia"}, "reply_to_user": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1539556856, "post_id": 45154825, "comment_id": 92533519, "body": "@Emixam23 have you found any good solution?"}, {"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1539560870, "post_id": 45154825, "comment_id": 92534219, "body": "The best idea for me is just to create different objects for the MangoDb uses.. In the protobufs you define messages that are used as interfaced communication. To me, it&#39;s important to separate every layers and to me, the communication and the data stored has to be different structures, even if they are composed of the same data, they don&#39;t have the same roles :) that&#39;s my norme when I concept any architecture or when I code, I try to separate as much as I can, and I write a lot of mappers ..."}], "answers": [{"tags": [], "owner": {"reputation": 6761, "user_id": 664345, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/34de936228acd10be7665e5c73c53d92?s=128&d=identicon&r=PG", "display_name": "Liyan Chang", "link": "https://stackoverflow.com/users/664345/liyan-chang"}, "is_accepted": false, "score": 0, "last_activity_date": 1593707044, "creation_date": 1593707044, "answer_id": 62700887, "question_id": 45154825, "link": "https://stackoverflow.com/questions/45154825/what-would-be-the-best-approach-to-converting-protoc-generated-structs-from-bson/62700887#62700887", "title": "What would be the best approach to converting protoc generated structs from bson structs?", "body": "<p>Having lived with this same issue, there's a couple methods of solving it. They fall into two general methods:</p>\n<ol>\n<li>Use the same data type</li>\n<li>Use two different struct types and map between them</li>\n</ol>\n<p><strong>If you want to use the same data type, you'll have to modify the code generation</strong></p>\n<p>You can use something like <a href=\"https://github.com/gogo/protobuf\" rel=\"nofollow noreferrer\">gogoprotobuf</a> which has an extension to add tags. This should give you <code>bson</code> tags in your structs.</p>\n<p>You could also post-process your generated files, either with regular expressions or something more complicated involving the go abstract syntax tree.</p>\n<p><strong>If you choose to map between them:</strong></p>\n<ol>\n<li><p>Use <code>reflection</code>. You can write a package that will take two structs and try to take the values from one and apply it to another. You'll have to deal with edge cases (slight naming differences, which types are equivalent, etc), but you'll have better control over edge cases if they ever come up.</p>\n</li>\n<li><p>Use JSON as an intermediary. As long as the generated json tags match, this will be a quick coding exercise and the performance hit of serializing and deserializing might be acceptable if this isn't in a tight loop in your code.</p>\n</li>\n<li><p>Hand-write or codegen mapping functions. Depending on how many structs you have, you could write out a bunch of functions that translate between the two.</p>\n</li>\n</ol>\n<p>At my workplace, we ended up doing a bit of all of them: forking the protoc generator to do some custom tags, a reflection based structs overlay package for mapping between arbitrary structs, and some hand-written ones in more performance sensitive or less automatable mappings.</p>\n"}, {"comments": [{"owner": {"reputation": 259, "user_id": 8546258, "user_type": "registered", "profile_image": "https://graph.facebook.com/1751611251806059/picture?type=large", "display_name": "Yehuda Makarov", "link": "https://stackoverflow.com/users/8546258/yehuda-makarov"}, "edited": false, "score": 1, "creation_date": 1606836694, "post_id": 63206372, "comment_id": 115079378, "body": "why exactly did you need to make sure there are custom BSON marshaling and un-marshaling  methods? making sure there are bson tags is not enough? why?"}], "tags": [], "owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "is_accepted": false, "score": 1, "last_activity_date": 1596292447, "creation_date": 1596292447, "answer_id": 63206372, "question_id": 45154825, "link": "https://stackoverflow.com/questions/45154825/what-would-be-the-best-approach-to-converting-protoc-generated-structs-from-bson/63206372#63206372", "title": "What would be the best approach to converting protoc generated structs from bson structs?", "body": "<p>I have played with it and have a working example with:</p>\n<pre><code>github.com/gogo/protobuf v1.3.1\ngo.mongodb.org/mongo-driver v1.4.0\ngoogle.golang.org/grpc v1.31.0\n</code></pre>\n<p>First of all I would like to share my <code>proto/contract/example.proto</code> file:</p>\n<pre><code>syntax = &quot;proto2&quot;;\n\npackage protobson;\n\nimport &quot;gogoproto/gogo.proto&quot;;\n\noption (gogoproto.sizer_all) = true;\noption (gogoproto.marshaler_all) = true;\noption (gogoproto.unmarshaler_all) =  true;\noption go_package = &quot;gitlab.com/8bitlife/proto/go/protobson&quot;;\n\nservice Service {\n    rpc SayHi(Hi) returns (Hi) {}\n}\n\nmessage Hi {\n    required bytes id = 1 [(gogoproto.customtype) = &quot;gitlab.com/8bitlife/protobson/custom.BSONObjectID&quot;, (gogoproto.nullable) = false, (gogoproto.moretags) = &quot;bson:\\&quot;_id\\&quot;&quot;] ;\n    required int64 limit = 2  [(gogoproto.nullable) = false, (gogoproto.moretags) = &quot;bson:\\&quot;limit\\&quot;&quot;] ;\n}\n</code></pre>\n<p>It contains a simple gRPC service <code>Service</code> that has <code>SayHi</code> method with request type <code>Hi</code>. It includes a set of options: <code>gogoproto.sizer_all</code>, <code>gogoproto.marshaler_all</code>, <code>gogoproto.unmarshaler_all</code>. Their meaning you can find at <a href=\"https://github.com/gogo/protobuf/blob/master/extensions.md\" rel=\"nofollow noreferrer\">extensions page</a>. The <code>Hi</code> itself contains two fields:</p>\n<ol>\n<li><code>id</code> that has additional options specified: <code>gogoproto.customtype</code> and <code>gogoproto.moretags</code></li>\n<li><code>limit</code> with only <code>gogoproto.moretags</code> option</li>\n</ol>\n<p><code>BSONObjectID</code> used in <code>gogoproto.customtype</code> for <code>id</code> field is a custom type that I defined as <code>custom/objectid.go</code>:</p>\n<pre><code>package custom\n\nimport (\n    &quot;go.mongodb.org/mongo-driver/bson/bsontype&quot;\n    &quot;go.mongodb.org/mongo-driver/bson/primitive&quot;\n)\n\ntype BSONObjectID primitive.ObjectID\n\nfunc (u BSONObjectID) Marshal() ([]byte, error) {\n    return u[:], nil\n}\n\nfunc (u BSONObjectID) MarshalTo(data []byte) (int, error) {\n    return copy(data, (u)[:]), nil\n}\n\nfunc (u *BSONObjectID) Unmarshal(d []byte) error {\n    copy((*u)[:], d)\n    return nil\n}\n\nfunc (u *BSONObjectID) Size() int {\n    return len(*u)\n}\n\nfunc (u *BSONObjectID) UnmarshalBSONValue(t bsontype.Type, d []byte) error {\n    copy(u[:], d)\n    return nil\n}\n\nfunc (u BSONObjectID) MarshalBSONValue() (bsontype.Type, []byte, error) {\n    return bsontype.ObjectID, u[:], nil\n}\n</code></pre>\n<p>It is needed because we need to define a custom marshaling and un-marshaling methods for both: protocol buffers and mongodb driver. This allows us to use this type as an object identifier in mongodb. And to &quot;explaine&quot; it to mongodb driver I marked it with a <code>bson</code> tag by using <code>(gogoproto.moretags) = &quot;bson:\\&quot;_id\\&quot;&quot;</code> option in proto file.</p>\n<p>To generate source code from the proto file I used:</p>\n<pre><code>protoc \\\n    --plugin=/Users/pstrokov/go/bin/protoc-gen-gogo \\\n    --plugin=/Users/pstrokov/go/bin/protoc-gen-go \\\n    -I=/Users/pstrokov/Workspace/protobson/proto/contract \\\n    -I=/Users/pstrokov/go/pkg/mod/github.com/gogo/protobuf@v1.3.1 \\\n    --gogo_out=plugins=grpc:. \\\n    example.proto\n</code></pre>\n<p>I have tested it on my MacOS with running MongoDB instance: <code>docker run --name mongo -d -p 27017:27017 mongo</code>:</p>\n<pre><code>package main\n\nimport (\n    &quot;context&quot;\n    &quot;log&quot;\n    &quot;net&quot;\n    &quot;time&quot;\n\n    &quot;gitlab.com/8bitlife/protobson/gitlab.com/8bitlife/proto/go/protobson&quot;\n    &quot;go.mongodb.org/mongo-driver/bson&quot;\n    &quot;go.mongodb.org/mongo-driver/mongo&quot;\n    &quot;go.mongodb.org/mongo-driver/mongo/options&quot;\n    &quot;google.golang.org/grpc&quot;\n)\n\ntype hiServer struct {\n    mgoClient *mongo.Client\n}\n\nfunc (s *hiServer) SayHi(ctx context.Context, hi *protobson.Hi) (*protobson.Hi, error) {\n    collection := s.mgoClient.Database(&quot;local&quot;).Collection(&quot;bonjourno&quot;)\n    res, err := collection.InsertOne(ctx, bson.M{&quot;limit&quot;: hi.Limit})\n    if err != nil { panic(err) }\n    log.Println(&quot;generated _id&quot;, res.InsertedID)\n\n    out := &amp;protobson.Hi{}\n    if err := collection.FindOne(ctx, bson.M{&quot;_id&quot;: res.InsertedID}).Decode(out); err != nil { return nil, err }\n    log.Println(&quot;found&quot;, out.String())\n    return out, nil\n}\n\nfunc main() {\n    ctx, cancel := context.WithCancel(context.Background())\n    defer cancel()\n    lis, err := net.Listen(&quot;tcp&quot;, &quot;localhost:0&quot;)\n    if err != nil { log.Fatalf(&quot;failed to listen: %v&quot;, err) }\n    clientOptions := options.Client().ApplyURI(&quot;mongodb://localhost:27017&quot;)\n    clientOptions.SetServerSelectionTimeout(time.Second)\n    client, err := mongo.Connect(ctx, clientOptions)\n    if err != nil { log.Fatal(err) }\n    if err := client.Ping(ctx, nil); err != nil { log.Fatal(err) }\n    grpcServer := grpc.NewServer()\n    protobson.RegisterServiceServer(grpcServer, &amp;hiServer{mgoClient: client})\n    go grpcServer.Serve(lis); defer grpcServer.Stop()\n    conn, err := grpc.Dial(lis.Addr().String(), grpc.WithInsecure())\n    if err != nil { log.Fatal(err) }; defer conn.Close()\n    hiClient := protobson.NewServiceClient(conn)\n    response, err := hiClient.SayHi(ctx, &amp;protobson.Hi{Limit: 99})\n    if err != nil { log.Fatal(err) }\n    if response.Limit != 99 { log.Fatal(&quot;unexpected limit&quot;, response.Limit) }\n    if response.Id.Size() == 0 { log.Fatal(&quot;expected a valid ID of the new entity&quot;) }\n    log.Println(response.String())\n}\n</code></pre>\n<p>Sorry for the formatting of the last code snippet :)\nI hope this can help.</p>\n"}, {"comments": [{"owner": {"reputation": 137, "user_id": 6035532, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4vviTf74ri4/AAAAAAAAAAI/AAAAAAAATSY/TyPWxK2A7Mc/photo.jpg?sz=128", "display_name": "Chandraaditya", "link": "https://stackoverflow.com/users/6035532/chandraaditya"}, "edited": false, "score": 0, "creation_date": 1617953725, "post_id": 65111715, "comment_id": 118459795, "body": "Hey, were you able you able to get it working? And if so can you provide some sample code for it?"}, {"owner": {"reputation": 259, "user_id": 8546258, "user_type": "registered", "profile_image": "https://graph.facebook.com/1751611251806059/picture?type=large", "display_name": "Yehuda Makarov", "link": "https://stackoverflow.com/users/8546258/yehuda-makarov"}, "reply_to_user": {"reputation": 137, "user_id": 6035532, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4vviTf74ri4/AAAAAAAAAAI/AAAAAAAATSY/TyPWxK2A7Mc/photo.jpg?sz=128", "display_name": "Chandraaditya", "link": "https://stackoverflow.com/users/6035532/chandraaditya"}, "edited": false, "score": 0, "creation_date": 1617978031, "post_id": 65111715, "comment_id": 118470095, "body": "@Chandraaditya hey, no. I got a little burnt out on the idea, and looked into postgres/mapping. Then found out some people prefer to have mappers for moving from protobuf to the data layer. And never got back to this."}], "tags": [], "owner": {"reputation": 259, "user_id": 8546258, "user_type": "registered", "profile_image": "https://graph.facebook.com/1751611251806059/picture?type=large", "display_name": "Yehuda Makarov", "link": "https://stackoverflow.com/users/8546258/yehuda-makarov"}, "is_accepted": false, "score": 0, "last_activity_date": 1606924962, "creation_date": 1606924962, "answer_id": 65111715, "question_id": 45154825, "link": "https://stackoverflow.com/questions/45154825/what-would-be-the-best-approach-to-converting-protoc-generated-structs-from-bson/65111715#65111715", "title": "What would be the best approach to converting protoc generated structs from bson structs?", "body": "<p>I'm in the process of testing and may provide code shortly, (ping me if you don't see it and you want it) but <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/bson/bsoncodec\" rel=\"nofollow noreferrer\">https://godoc.org/go.mongodb.org/mongo-driver/bson/bsoncodec</a> looks like the ticket. protoc will make your structs and you don't have to mess with customizing them. Then you can customize the mongo-driver to do the mapping of certain types for you and it looks like their library for this is pretty good.</p>\n<p>This is great because if I use the protogen structs then I'd like that to my application core / domain layer. I don't want to be concerned about mongoDB compatibility over there.</p>\n<p>So right now, it seems to me that @Liyan Chang 's answer saying</p>\n<blockquote>\n<p>If you want to use the same data type, you'll have to modify the code generation\ndoesn't necessarily have to be the case. Because you can opt to use 1 datatype.</p>\n</blockquote>\n<p>You can use one generated type and account for seemingly whatever you need to in terms of getting and setting data to the DB with this codec system.</p>\n<p>See <a href=\"https://stackoverflow.com/a/59561699/8546258\">https://stackoverflow.com/a/59561699/8546258</a> - the bson struct tags are not an end all be all. looks like codec can totally help with this.</p>\n<p>See <a href=\"https://stackoverflow.com/a/58985629/8546258\">https://stackoverflow.com/a/58985629/8546258</a> fo a nice write up about codecs in general.</p>\n<p>Please keep in mind these codecs were released in 1.3 of the mongodb go driver. I found this which directed me there: <a href=\"https://developer.mongodb.com/community/forums/t/mgo-setbson-to-mongo-golang-driver/2340/2?u=yehuda_makarov\" rel=\"nofollow noreferrer\">https://developer.mongodb.com/community/forums/t/mgo-setbson-to-mongo-golang-driver/2340/2?u=yehuda_makarov</a></p>\n"}], "owner": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4047, "favorite_count": 1, "answer_count": 3, "score": 12, "last_activity_date": 1606924962, "creation_date": 1500331741, "question_id": 45154825, "link": "https://stackoverflow.com/questions/45154825/what-would-be-the-best-approach-to-converting-protoc-generated-structs-from-bson", "title": "What would be the best approach to converting protoc generated structs from bson structs?", "body": "<p>I'm writing a RESTful API in Golang, which also has a gRPC api. The API connects to a MongoDB database, and uses structs to map out entities. I also have a .proto definition which matches like for like the struct I'm using for MongoDB. </p>\n\n<p>I just wondered if there was a way to share, or re-use the .proto defined code for the MongoDB calls also. I've noticed the strucs protoc generates has json tags for each field, but obviously there aren't <code>bson</code> tags etc.</p>\n\n<p>I have something like... </p>\n\n<pre><code>// Menu -\ntype Menu struct {\n    ID          bson.ObjectId      `json:\"id\" bson\"_id\"`\n    Name        string             `json:\"name\" bson:\"name\"`\n    Description string             `json:\"description\" bson:\"description\"`\n    Mixers      []mixers.Mixer     `json:\"mixers\" bson:\"mixers\"`\n    Sections    []sections.Section `json:\"sections\" bson:\"sections\"`\n}\n</code></pre>\n\n<p>But then I also have protoc generated code... </p>\n\n<pre><code>type Menu struct {\n    Id          string     `protobuf:\"bytes,1,opt,name=id\" json:\"id,omitempty\"`\n    Name        string     `protobuf:\"bytes,2,opt,name=name\" json:\"name,omitempty\"`\n    Description string     `protobuf:\"bytes,3,opt,name=description\" json:\"description,omitempty\"`\n    Mixers      []*Mixer   `protobuf:\"bytes,4,rep,name=mixers\" json:\"mixers,omitempty\"`\n    Sections    []*Section `protobuf:\"bytes,5,rep,name=sections\" json:\"sections,omitempty\"`\n}\n</code></pre>\n\n<p>Currently I'm having to convert between the two structs depending what I'm doing. Which is tedious and I'm probably quite a considerable performance hit. So is there a better way of converting between the two, or re-using one of them for both tasks? </p>\n"}, {"tags": ["http", "go", "webpack", "reverse-proxy", "eventsource"], "comments": [{"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 1, "creation_date": 1500327361, "post_id": 45151988, "comment_id": 77277103, "body": "<a href=\"https://stackoverflow.com/a/29990521/532430\">it might be your anti-virus software</a>. Alternatively, it might be because both Chrome and Go support HTTP/2 but node doesn&#39;t (don&#39;t quote me on that)."}, {"owner": {"reputation": 48078, "user_id": 279259, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f34f02bafe93e3a3784de74c4d8b7732?s=128&d=identicon&r=PG&f=1", "display_name": "ereOn", "link": "https://stackoverflow.com/users/279259/ereon"}, "reply_to_user": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1500389704, "post_id": 45151988, "comment_id": 77308747, "body": "@thwd: I don&#39;t have an anti-virus (it&#39;s a corporate setting - we have other security mechanisms in place, but not that). When I contact the node server directly, it does work flawlessly (with Chrome) so I still suspect Go to be guilty somehow."}], "owner": {"reputation": 48078, "user_id": 279259, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f34f02bafe93e3a3784de74c4d8b7732?s=128&d=identicon&r=PG&f=1", "display_name": "ereOn", "link": "https://stackoverflow.com/users/279259/ereon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 124, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1500318956, "creation_date": 1500318956, "question_id": 45151988, "link": "https://stackoverflow.com/questions/45151988/go-proxy-doesnt-support-event-sources", "title": "Go proxy doesn&#39;t support event sources", "body": "<p>I am developping a web service in Go which delegates its UI to a <a href=\"https://vuejs.org/\" rel=\"nofollow noreferrer\"><code>vue.js</code></a> website packaged with <code>webpack</code>.</p>\n\n<p>My Go service is responsible for hosting the UI and a REST API that the UI use.</p>\n\n<p>In development mode, I would want to benefit from the <code>vue.js</code> and <code>webpack</code> tooling (inotify-based auto-reload for instance) so I added a switch in my Go program that does this:</p>\n\n<pre><code>var handler http.Handler\n\nif isDevelopment {\n    // url below points to the webpack standalone\n    // development server, at http://localhost:8080.\n    proxy := httputil.NewSingleHostReverseProxy(url)\n    proxy.FlushInterval = time.Millisecond * 100\n    handler = proxy\n} else {\n    handler = http.FileServer(http.Dir(\"www\"))\n}\n</code></pre>\n\n<p>So basically, in development mode I can launch webpack's development server (with <code>npm run dev</code>) and my Go program delegates all the UI requests to it.</p>\n\n<p>This works wonders except that after a couple of seconds, Chrome complains that:</p>\n\n<blockquote>\n  <p>GET <a href=\"http://localhost:9999/__webpack_hmr\" rel=\"nofollow noreferrer\">http://localhost:9999/__webpack_hmr</a> net::ERR_INCOMPLETE_CHUNKED_ENCODING</p>\n</blockquote>\n\n<p>The auto-refresh stops working for a while and eventually comes back, but its way slower than if I directly connect to webpack's standalone server.</p>\n\n<p>I think could track down the problem in Go's <code>httputil.ReverseProxy</code> and I believe it doesn't have any specific code to handle event sources properly.</p>\n\n<p>Is this a know issue ? Is there anything I could do to make my Go reverse proxy event source aware/compatible ?</p>\n"}, {"tags": ["go", "vmware", "vsphere"], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 4337531, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-6K3yTkHoqzM/AAAAAAAAAAI/AAAAAAAACWs/0FWvMnxAa4U/photo.jpg?sz=128", "display_name": "Ivan Buymov", "link": "https://stackoverflow.com/users/4337531/ivan-buymov"}, "is_accepted": true, "score": 1, "last_activity_date": 1500454988, "creation_date": 1500454988, "answer_id": 45185777, "question_id": 45151679, "link": "https://stackoverflow.com/questions/45151679/vsphere-add-existing-hdd-to-vm-via-apigovmomi/45185777#45185777", "title": "vSphere, add existing HDD to VM via API(govmomi)", "body": "<p>I got answer here: <a href=\"https://github.com/vmware/govmomi/issues/790\" rel=\"nofollow noreferrer\">https://github.com/vmware/govmomi/issues/790</a></p>\n\n<p>Working code:</p>\n\n<pre><code>spec := types.VirtualMachineConfigSpec{}\nconfig := &amp;types.VirtualDeviceConfigSpec{\n    Device:    disk,\n    Operation: types.VirtualDeviceConfigSpecOperationAdd,\n}\nspec.DeviceChange = append(spec.DeviceChange, config)\n\nresult, err := vm.Reconfigure(ctx, spec)\nif err != nil {\n    log.Fatal(fmt.Sprintf(\"err: %s\", err.Error()))\n\n}\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 4337531, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-6K3yTkHoqzM/AAAAAAAAAAI/AAAAAAAACWs/0FWvMnxAa4U/photo.jpg?sz=128", "display_name": "Ivan Buymov", "link": "https://stackoverflow.com/users/4337531/ivan-buymov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 497, "favorite_count": 0, "accepted_answer_id": 45185777, "answer_count": 1, "score": 1, "last_activity_date": 1500454988, "creation_date": 1500317832, "question_id": 45151679, "link": "https://stackoverflow.com/questions/45151679/vsphere-add-existing-hdd-to-vm-via-apigovmomi", "title": "vSphere, add existing HDD to VM via API(govmomi)", "body": "<p>I am try to add existing HDD from one virtual machine to other.\nI use golang and this api: <a href=\"https://github.com/vmware/govmomi\" rel=\"nofollow noreferrer\">https://github.com/vmware/govmomi</a></p>\n\n<p>At first i get disks from source vm like this:</p>\n\n<pre><code>for _, device := range devices {\n        currentDeviceLabel := device.GetVirtualDevice().DeviceInfo.GetDescription().Label\n        if strings.Contains(strings.ToLower(currentDeviceLabel), \"hard disk\"){\n        disks = append(disks, device)\n    }    \nreturn disks\n</code></pre>\n\n<p>And then i trying to add received disk to other VM:</p>\n\n<pre><code>func addDisk(vm *object.VirtualMachine, disk types.BaseVirtualDevice) {\n\n    ctx, cancel := context.WithCancel(context.Background())\n    defer cancel()\n\n    spec := types.VirtualMachineConfigSpec{\n\n        DeviceChange : []types.BaseVirtualDeviceConfigSpec {\n\n            &amp;types.VirtualDeviceConfigSpec{\n\n                Operation: types.VirtualDeviceConfigSpecOperationAdd,\n                FileOperation: types.VirtualDeviceConfigSpecFileOperationCreate,\n                Device: disk,\n            },\n\n        },\n    }\n\n    result, err := vm.Reconfigure(ctx, spec)\n    if err != nil {\n        log.Fatal(fmt.Sprintf(\"err: %s\", err.Error()))\n\n    }\n</code></pre>\n\n<p>I get error from vSphere: </p>\n\n<pre><code>Cannot complete the operation because the file or folder [xxxxx] xxxxx/xxxxx.vmdk already exists\n</code></pre>\n\n<p>What i am doing wrong? Thanks!</p>\n"}, {"tags": ["go", "go-flag"], "answers": [{"tags": [], "owner": {"reputation": 3795, "user_id": 4926817, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/0lH0y.png?s=128&g=1", "display_name": "Noam Hacker", "link": "https://stackoverflow.com/users/4926817/noam-hacker"}, "is_accepted": true, "score": 4, "last_activity_date": 1500307330, "creation_date": 1500307330, "answer_id": 45148776, "question_id": 45148775, "link": "https://stackoverflow.com/questions/45148775/check-if-all-flags-were-set-no-flags-blank/45148776#45148776", "title": "Check if all flags were set (no flags blank)", "body": "<p>This can be achieved using the <a href=\"https://golang.org/pkg/flag/#VisitAll\" rel=\"nofollow noreferrer\"><code>VisitAll</code></a> function.</p>\n\n<blockquote>\n  <p>VisitAll visits the command-line flags in lexicographical order, calling fn for each. It visits all flags, even those not set.</p>\n</blockquote>\n\n<p>Sample code (add after <code>flag.Parse()</code>): </p>\n\n<pre><code>flag.VisitAll(func (f *flag.Flag) {\n    if f.Value.String()==\"\" {\n        fmt.Println(f.Name, \"not set!\")\n    }\n})\n</code></pre>\n"}], "owner": {"reputation": 3795, "user_id": 4926817, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/0lH0y.png?s=128&g=1", "display_name": "Noam Hacker", "link": "https://stackoverflow.com/users/4926817/noam-hacker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 958, "favorite_count": 0, "accepted_answer_id": 45148776, "answer_count": 1, "score": 2, "last_activity_date": 1500307330, "creation_date": 1500307330, "question_id": 45148775, "link": "https://stackoverflow.com/questions/45148775/check-if-all-flags-were-set-no-flags-blank", "title": "Check if all flags were set (no flags blank)", "body": "<p>How do I make sure every flag argument was set from the command line? I would like to do this without checking each flag name specifically, and would like to instead check all flags dynamically.</p>\n\n<p>Here is my code, <code>main.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"flag\"\n)\n\nfunc main() {\n    x := flag.String(\"x\", \"\", \"x flag\")\n    y := flag.String(\"y\", \"\", \"y flag\")\n    flag.Parse()\n}\n</code></pre>\n\n<p>I run it, for example, like this: <code>go run main.go -x hello</code></p>\n"}, {"tags": ["forms", "go", "go-gin"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1500307895, "post_id": 45148441, "comment_id": 77267026, "body": "How did you implement <code>getUserId</code>? I guess, when the function <code>getUserId</code> is called, it read all the request body till <code>EOF</code> so when you access the <i>title</i> and <i>content</i>, you got empty value."}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1500308099, "post_id": 45148441, "comment_id": 77267145, "body": "@putu, I added <code>getUserId</code> function to the question. But even if when I comment out t  call to <code>getUserId</code>, the form fields are still empty."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1500309600, "post_id": 45148441, "comment_id": 77268018, "body": "So my initial guess was wrong, since in <code>getUserId</code> you don&#39;t read the request body. How if you try to read the form with <a href=\"https://godoc.org/github.com/gin-gonic/gin#Context.MultipartForm\" rel=\"nofollow noreferrer\">Context.MultipartForm() (*multipart.Form, error)</a> and observe the <code>error</code>? You may also try to <a href=\"http://blog.getpostman.com/2015/06/13/debugging-postman-requests/\" rel=\"nofollow noreferrer\">inspect the Postman request</a> to see what exactly was sent to the server."}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1500309772, "post_id": 45148441, "comment_id": 77268127, "body": "Well, I followed the official gin docs to read the form post. How can I use <code>c.MultipartForm</code> instead?"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1500310016, "post_id": 45148441, "comment_id": 77268254, "body": "Add <code>form, err := c.MultipartForm()</code> before <code>title := c.PostForm(&quot;title&quot;)</code>. Observe the content and error by <code>fmt.Printf(&quot;%+v, %+v\\n&quot;, form, err)</code>. If there was no error, you can read the value from <a href=\"https://godoc.org/mime/multipart#Form\" rel=\"nofollow noreferrer\">multipart.Form.Value</a>."}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1500310440, "post_id": 45148441, "comment_id": 77268466, "body": "I did. And now I get <code>&lt;nil&gt;, invalid URL escape &quot;%\\x00\\x00&quot; </code>"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1500311126, "post_id": 45148441, "comment_id": 77268836, "body": "Now at least we understand why you got empty value. How if you remove <code>file</code> field in the Postman request? Please also inspect the postman request to see what was exactly being sent to the server. The error message indicates that the request was invalid."}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1500311377, "post_id": 45148441, "comment_id": 77268988, "body": "Right. removing file from post does not have any effect. I&#39;m still struggling how to inspect the post. Can you give me curl equivalent (including cookie) so that I bypass Postman?"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1500311808, "post_id": 45148441, "comment_id": 77269217, "body": "You can access and inspect the request through <a href=\"https://www.getpostman.com/docs/postman/sending_api_requests/history\" rel=\"nofollow noreferrer\">history</a>. For cURL and cookie, <a href=\"https://stackoverflow.com/questions/15995919/curl-how-to-send-cookies-via-command-line\">https://stackoverflow.com/questions/15995919/curl-how-to-sen&zwnj;&#8203;d-cookies-via-comman&zwnj;&#8203;d-line</a>"}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1500312438, "post_id": 45148441, "comment_id": 77269531, "body": "Holy moly! When I post using curl, the form values are retrieves. Thanks a lot putu for solving this puzzle! Answer and I&#39;ll accept. I should ditch Postman! Here is the curl: <code>curl -X POST   -v --cookie &quot;mycookename=somelonggibberish&quot;   -F &#39;title=mytitle&#39; -F &#39;content=mycontent&#39; http:&#47;&#47;127.0.0.1:8080&#47;api&#47;post</code>"}], "owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2001, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1500308056, "creation_date": 1500306321, "last_edit_date": 1500308056, "question_id": 45148441, "link": "https://stackoverflow.com/questions/45148441/cannot-get-form-post-body-from-go-gin-context", "title": "Cannot get form post body from Go gin context", "body": "<p>I have updated gin-gonic and want to use it to save a form. </p>\n\n<p>Here is my code:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"github.com/gin-gonic/contrib/sessions\"\n    \"github.com/gin-gonic/gin\"\n...\n\n\nfunc HandlePost(c *gin.Context) {\n    userId, userName := getUserId(c)\n\n    title := c.PostForm(\"title\")\n    content := c.PostForm(\"content\")\n\n    fmt.Println(\"userId is:\", userId) //ok\n    fmt.Println(\"userName is: \", userName) //ok\n    fmt.Println(\"title is:\", title) //empty\n    fmt.Println(\"content is: \", content) //empty\n\n...\n</code></pre>\n\n<p>I use Postman to post form, like this:</p>\n\n<p><a href=\"https://i.stack.imgur.com/n0L7p.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/n0L7p.png\" alt=\"enter image description here\"></a></p>\n\n<p>I don't get any errors but received form fields are empty. So wondering what could be wrong here and how to fix it?</p>\n\n<p>Update: here is how I implemented <code>getUserId</code>:</p>\n\n<pre><code>func getUserId(c *gin.Context) (int, string) {\n    var user []model.User\n    session := sessions.Default(c)\n    userEmail := session.Get(\"user-id\").(string)\n    if userEmail == \"\" {\n        fmt.Println(\"userEmail NOT found\")\n    } else {\n        err := shared.Dbmap.Select(&amp;user, \"SELECT * FROM user WHERE email = ? LIMIT 1\", userEmail)\n        if err != nil {\n            log.Panic(err)\n        }\n    }\n    return user[0].Id, user[0].UserName\n}\n</code></pre>\n"}, {"tags": ["optimization", "go", "slice"], "comments": [{"owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "edited": false, "score": 1, "creation_date": 1500303581, "post_id": 45147353, "comment_id": 77264139, "body": "The first two test functions have nested for loops while the last one doesn&#39;t..."}, {"owner": {"reputation": 6405, "user_id": 3166160, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9054f030b0058573a8338340e6347da8?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Lambert", "link": "https://stackoverflow.com/users/3166160/jacob-lambert"}, "reply_to_user": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "edited": false, "score": 0, "creation_date": 1500306469, "post_id": 45147353, "comment_id": 77266117, "body": "@dev.bmax that isn&#39;t an issue. The benchmark is done inside the <code>b.Run()</code> call."}, {"owner": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "edited": false, "score": 0, "creation_date": 1500310733, "post_id": 45147353, "comment_id": 77268642, "body": "@JRLambert Could you make a gist that would reproduce this issue ? Or tell us what&#39;s happening in <code>TickFive</code> so we can try and reproduce it ?"}, {"owner": {"reputation": 6405, "user_id": 3166160, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9054f030b0058573a8338340e6347da8?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Lambert", "link": "https://stackoverflow.com/users/3166160/jacob-lambert"}, "reply_to_user": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "edited": false, "score": 0, "creation_date": 1500321537, "post_id": 45147353, "comment_id": 77274220, "body": "@yazgazan I added a link to the GitHub repo for the project"}, {"owner": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "edited": false, "score": 0, "creation_date": 1500328726, "post_id": 45147353, "comment_id": 77277651, "body": "Experimenting quickly (without going too deep in your code), I tried a benchmark disabling <code>TickFive</code> and <code>CalculateBallCycle</code> in turns, and the performance issue only seem to arise when both are present. Glancing at your code, there seem to be a lot of side effects going on in your code, so finding the source of the &quot;interference&quot; will be tricky. (long story short, <code>TickFive</code> seems to worsen the performances of <code>CalculateBallCycle</code>). I&#39;ll give it another try tomorrow, with a rested mind and no game of thrones to watch ;)"}], "answers": [{"comments": [{"owner": {"reputation": 6405, "user_id": 3166160, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9054f030b0058573a8338340e6347da8?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Lambert", "link": "https://stackoverflow.com/users/3166160/jacob-lambert"}, "edited": false, "score": 0, "creation_date": 1500306352, "post_id": 45147598, "comment_id": 77266052, "body": "I made that change, and did improve it but not to the extent that I would hope. With the change, the bench mark is now <code>8930347 ns&#47;op</code>, still roughly 1000x more than what I am hoping for."}, {"owner": {"reputation": 6405, "user_id": 3166160, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9054f030b0058573a8338340e6347da8?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Lambert", "link": "https://stackoverflow.com/users/3166160/jacob-lambert"}, "edited": false, "score": 0, "creation_date": 1500306553, "post_id": 45147598, "comment_id": 77266167, "body": "Also, <code>CalculateBallCycle</code> will modify the slice, but that is the expected and wanted side effect."}], "tags": [], "owner": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "is_accepted": false, "score": 0, "last_activity_date": 1500303836, "creation_date": 1500303836, "answer_id": 45147598, "question_id": 45147353, "link": "https://stackoverflow.com/questions/45147353/performance-decrease-with-function-call/45147598#45147598", "title": "Performance decrease with function call", "body": "<p>In your <code>CycleClock</code> function, you are copying the <code>c.BallQueue</code> slice. You can improve performance significantly by using <code>CalculateBallCycle(c.BallQueue)</code> instead (assuming <code>CalculateBallCycle</code> doesn't modify the slice)</p>\n\n<p>For example:</p>\n\n<pre><code>func Sum(values []int) int {\n    sum := 0\n    for _, v := range values {\n        sum += v\n    }\n\n    return sum\n}\n\nfunc BenchmarkNoCopy(b *testing.B) {\n    for n := 0; n &lt; b.N; n++ {\n        Sum(m)\n    }\n}\n\nfunc BenchmarkWithCopy(b *testing.B) {\n    for n := 0; n &lt; b.N; n++ {\n        Sum(append([]int{}, m...))\n    }\n}\n\n// BenchmarkNoCopy-4        20000000            73.5 ns/op\n// BenchmarkWithCopy-4       5000000           306 ns/op\n// PASS\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6405, "user_id": 3166160, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9054f030b0058573a8338340e6347da8?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Lambert", "link": "https://stackoverflow.com/users/3166160/jacob-lambert"}, "edited": false, "score": 0, "creation_date": 1500327627, "post_id": 45152870, "comment_id": 77277205, "body": "Thank you for pointing that out but that is only an issue when using <code>testing.T</code> and calling <code>t.Parallel()</code> in the supplied <code>func</code>. <code>b.Run()</code> run sequentially so the value of <code>i</code> in the <code>func</code> passed to <code>b.Run()</code> is the correct value. Changing the benchmark to use a local variable did not affect the result of the benchmark. <a href=\"https://golang.org/pkg/testing/#hdr-Subtests_and_Sub_benchmarks\" rel=\"nofollow noreferrer\">Documentation</a>"}], "tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": false, "score": 0, "last_activity_date": 1500324141, "last_edit_date": 1500324141, "creation_date": 1500322245, "answer_id": 45152870, "question_id": 45147353, "link": "https://stackoverflow.com/questions/45147353/performance-decrease-with-function-call/45152870#45152870", "title": "Performance decrease with function call", "body": "<p>There is a subtle bug in your tests.</p>\n\n<p>Both methods <code>BenchmarkCycleClock</code> and <code>BenchmarkCycle24</code> run the benchmark in a for loop, passing a closure to <code>b.Run</code>. Inside of those closures you initialize the clocks using the loop variable <code>i</code> like this:<code>ballclock.NewClock(i)</code>.</p>\n\n<p>The problem is, that all instances of your anonymous function share the same variable. And, by the time the function is run by the test runner, the loop will be finished, and all of the clocks will be initialized using the same value: <code>ballclock.MaxBalls</code>.</p>\n\n<p>You can fix this using a local variable:</p>\n\n<pre><code>for i := ballclock.MinBalls; i &lt;= ballclock.MaxBalls; i++ {\n    i := i\n    b.Run(\"BallCount=\"+strconv.Itoa(i), func(b *testing.B) {\n        for n := 0; n &lt; b.N; n++ {\n            c, _ := ballclock.NewClock(i)\n\n            CycleClock(c)\n        }\n    })\n}\n</code></pre>\n\n<p>The line <code>i := i</code> stores a copy of the current value of <code>i</code> (different for each instance of your anonymous function).</p>\n"}, {"comments": [{"owner": {"reputation": 6405, "user_id": 3166160, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9054f030b0058573a8338340e6347da8?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Lambert", "link": "https://stackoverflow.com/users/3166160/jacob-lambert"}, "edited": false, "score": 0, "creation_date": 1500386547, "post_id": 45162597, "comment_id": 77306087, "body": "<i>Face Palm</i>, thank you. I should have realized that was happening."}], "tags": [], "owner": {"reputation": 3287, "user_id": 2898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/ancqg.jpg?s=128&g=1", "display_name": "Krzysztof Kowalczyk", "link": "https://stackoverflow.com/users/2898/krzysztof-kowalczyk"}, "is_accepted": true, "score": 2, "last_activity_date": 1500369793, "creation_date": 1500369793, "answer_id": 45162597, "question_id": 45147353, "link": "https://stackoverflow.com/questions/45147353/performance-decrease-with-function-call/45162597#45162597", "title": "Performance decrease with function call", "body": "<p>You wrote that <code>CalcualteBallCycle()</code> modifies the slice by design.</p>\n\n<p>I can't speak to correctness of that approach, but it is why benchmark time of <code>BenchmarkCalculateBallCycle123</code> is so different.</p>\n\n<p>On first run it does the expected thing but on subsequent runs it does something completely different, because you're passing different data as input.</p>\n\n<p>Benchmark this modified code:</p>\n\n<pre><code>func BenchmarkCalculateBallCycle123v2(b *testing.B) {\n    m := []int{8, 62, 42, 87, 108, 35, 17, 6, 22, 75, 116, 112, 39, 119, 52, 60, 30, 88, 56, 36, 38, 26, 51, 31, 55, 120, 33, 99, 111, 24, 45, 21, 23, 34, 43, 41, 67, 65, 66, 85, 82, 89, 9, 25, 109, 47, 40, 0, 83, 46, 73, 13, 12, 63, 15, 90, 121, 2, 69, 53, 28, 72, 97, 3, 4, 94, 106, 61, 96, 18, 80, 74, 44, 84, 107, 98, 93, 103, 5, 91, 32, 76, 20, 68, 81, 95, 29, 27, 86, 104, 7, 64, 113, 78, 105, 58, 118, 117, 50, 70, 10, 101, 110, 19, 1, 115, 102, 71, 79, 57, 77, 122, 48, 114, 54, 37, 59, 49, 100, 11, 14, 92, 16}\n    for n := 0; n &lt; b.N; n++ {\n        tmp := append([]int{}, m...)\n        CalculateBallCycle(tmp)\n    }\n}\n</code></pre>\n\n<p>This works-around this behavior by making a copy of m, so that <code>CalculateBallCycle</code> modifies a local copy.</p>\n\n<p>The running time becomes more like the others:</p>\n\n<pre><code>BenchmarkCalculateBallCycle123-8         3000000           500 ns/op\nBenchmarkCalculateBallCycle123v2-8           100      10483347 ns/op\n</code></pre>\n"}], "owner": {"reputation": 6405, "user_id": 3166160, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9054f030b0058573a8338340e6347da8?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Lambert", "link": "https://stackoverflow.com/users/3166160/jacob-lambert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 45162597, "answer_count": 3, "score": -1, "last_activity_date": 1500369793, "creation_date": 1500303014, "last_edit_date": 1500338856, "question_id": 45147353, "link": "https://stackoverflow.com/questions/45147353/performance-decrease-with-function-call", "title": "Performance decrease with function call", "body": "<p>For the following function:</p>\n\n<pre><code>func CycleClock(c *ballclock.Clock) int {\n    for i := 0; i &lt; fiveMinutesPerDay; i++ {\n        c.TickFive()\n    }\n\n    return 1 + CalculateBallCycle(append([]int{}, c.BallQueue...))\n}\n</code></pre>\n\n<p>where <code>c.BallQueue</code> is defined as <code>[]int</code> and <code>CalculateBallCycle</code> is defined as <code>func CalculateBallCycle(s []int) int</code>. I am having a huge performance decrease between the <code>for</code> loop and the <code>return</code> statement.</p>\n\n<p>I wrote the following benchmarks to test. The first benchmarks the entire function, the second benchmarks the <code>for</code> loop, while the third benchmarks the <code>CalculateBallCycle</code> function:</p>\n\n<pre><code>func BenchmarkCycleClock(b *testing.B) {\n    for i := ballclock.MinBalls; i &lt;= ballclock.MaxBalls; i++ {\n        j := i\n        b.Run(\"BallCount=\"+strconv.Itoa(i), func(b *testing.B) {\n            for n := 0; n &lt; b.N; n++ {\n                c, _ := ballclock.NewClock(j)\n\n                CycleClock(c)\n            }\n        })\n    }\n}\n\nfunc BenchmarkCycle24(b *testing.B) {\n    for i := ballclock.MinBalls; i &lt;= ballclock.MaxBalls; i++ {\n        j := i\n        b.Run(\"BallCount=\"+strconv.Itoa(i), func(b *testing.B) {\n            for n := 0; n &lt; b.N; n++ {\n                c, _ := ballclock.NewClock(j)\n\n                for k := 0; k &lt; fiveMinutesPerDay; k++ {\n                    c.TickFive()\n                }\n            }\n        })\n    }\n}\n\nfunc BenchmarkCalculateBallCycle123(b *testing.B) {\n    m := []int{8, 62, 42, 87, 108, 35, 17, 6, 22, 75, 116, 112, 39, 119, 52, 60, 30, 88, 56, 36, 38, 26, 51, 31, 55, 120, 33, 99, 111, 24, 45, 21, 23, 34, 43, 41, 67, 65, 66, 85, 82, 89, 9, 25, 109, 47, 40, 0, 83, 46, 73, 13, 12, 63, 15, 90, 121, 2, 69, 53, 28, 72, 97, 3, 4, 94, 106, 61, 96, 18, 80, 74, 44, 84, 107, 98, 93, 103, 5, 91, 32, 76, 20, 68, 81, 95, 29, 27, 86, 104, 7, 64, 113, 78, 105, 58, 118, 117, 50, 70, 10, 101, 110, 19, 1, 115, 102, 71, 79, 57, 77, 122, 48, 114, 54, 37, 59, 49, 100, 11, 14, 92, 16}\n\n    for n := 0; n &lt; b.N; n++ {\n        CalculateBallCycle(m)\n    }\n}\n</code></pre>\n\n<p>Using 123 balls, this gives the following result:</p>\n\n<pre><code>BenchmarkCycleClock/BallCount=123-8                  200           9254136 ns/op\nBenchmarkCycle24/BallCount=123-8                  200000              7610 ns/op\nBenchmarkCalculateBallCycle123-8                 3000000               456 ns/op\n</code></pre>\n\n<p>Looking at this, there is a huge disparity between benchmarks. I would expect that the first benchmark would take roughly <code>~8000 ns/op</code> since that would be the sum of the parts.</p>\n\n<p><a href=\"https://github.com/Nais777/BallClock-golang.git\" rel=\"nofollow noreferrer\">Here</a> is the github repository.</p>\n\n<p>EDIT:</p>\n\n<p>I discovered that the result from the benchmark and the result from the running program are widely different. I took what @yazgazan found and modified the benchmark function in <code>main.go</code> mimic somewhat the <code>BenchmarkCalculateBallCycle123</code> from <code>main_test.go</code>:</p>\n\n<pre><code>func Benchmark() {\n    for i := ballclock.MinBalls; i &lt;= ballclock.MaxBalls; i++ {\n        if i != 123 {\n            continue\n        }\n\n        start := time.Now()\n\n        t := CalculateBallCycle([]int{8, 62, 42, 87, 108, 35, 17, 6, 22, 75, 116, 112, 39, 119, 52, 60, 30, 88, 56, 36, 38, 26, 51, 31, 55, 120, 33, 99, 111, 24, 45, 21, 23, 34, 43, 41, 67, 65, 66, 85, 82, 89, 9, 25, 109, 47, 40, 0, 83, 46, 73, 13, 12, 63, 15, 90, 121, 2, 69, 53, 28, 72, 97, 3, 4, 94, 106, 61, 96, 18, 80, 74, 44, 84, 107, 98, 93, 103, 5, 91, 32, 76, 20, 68, 81, 95, 29, 27, 86, 104, 7, 64, 113, 78, 105, 58, 118, 117, 50, 70, 10, 101, 110, 19, 1, 115, 102, 71, 79, 57, 77, 122, 48, 114, 54, 37, 59, 49, 100, 11, 14, 92, 16})\n\n        duration := time.Since(start)\n\n        fmt.Printf(\"Ballclock with %v balls took %s;\\n\", i, duration)\n    }\n}\n</code></pre>\n\n<p>This gave the output of:</p>\n\n<pre><code>Ballclock with 123 balls took 11.86748ms;\n</code></pre>\n\n<p>As you can see, the total time was 11.86 ms, all of which was spent in the <code>CalculateBallCycle</code> function. What would cause the benchmark to run in <code>456 ns/op</code> while the running program runs in around <code>11867480 ms/op</code>?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500299176, "post_id": 45145873, "comment_id": 77260709, "body": "Why is <code>c</code> in <code>writeToInflux</code> an <code>interface{}</code>? Do you need to pass multiple types to that function for some reason? If you make <code>c</code> the correct type, it will just work."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 8319878, "user_type": "registered", "profile_image": "https://graph.facebook.com/1583427785064493/picture?type=large", "display_name": "Mike Nenych", "link": "https://stackoverflow.com/users/8319878/mike-nenych"}, "edited": false, "score": 0, "creation_date": 1500300034, "post_id": 45146024, "comment_id": 77261394, "body": "Maybe there is some posibility to pass c as argument with all it&#39;s methods?"}, {"owner": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "reply_to_user": {"reputation": 13, "user_id": 8319878, "user_type": "registered", "profile_image": "https://graph.facebook.com/1583427785064493/picture?type=large", "display_name": "Mike Nenych", "link": "https://stackoverflow.com/users/8319878/mike-nenych"}, "edited": false, "score": 0, "creation_date": 1500300250, "post_id": 45146024, "comment_id": 77261560, "body": "Indeed there is :) Your <code>writeToInflux</code> can accept <code>c client.Client</code> in its arguments."}, {"owner": {"reputation": 5639, "user_id": 1277048, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/tGJVH.jpg?s=128&g=1", "display_name": "FuzzyAmi", "link": "https://stackoverflow.com/users/1277048/fuzzyami"}, "edited": false, "score": 0, "creation_date": 1500300722, "post_id": 45146024, "comment_id": 77261933, "body": "But there <i>is</i> a benefit in passing an interface name: by doing that any type that implements the interface can be used, not just Client."}, {"owner": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "reply_to_user": {"reputation": 5639, "user_id": 1277048, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/tGJVH.jpg?s=128&g=1", "display_name": "FuzzyAmi", "link": "https://stackoverflow.com/users/1277048/fuzzyami"}, "edited": false, "score": 1, "creation_date": 1500301414, "post_id": 45146024, "comment_id": 77262522, "body": "@FuzzyAmi The thing is (and I didn&#39;t notice it at first), OP is using <code>github.com&#47;influxdata&#47;influxdb&#47;client&#47;v2</code>, not <code>github.com&#47;influxdata&#47;influxdb&#47;client</code>. This means <code>client.Client</code> is already an interface :)"}], "tags": [], "owner": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "is_accepted": false, "score": 1, "last_activity_date": 1500300348, "last_edit_date": 1500300348, "creation_date": 1500299268, "answer_id": 45146024, "question_id": 45145873, "link": "https://stackoverflow.com/questions/45145873/use-pointer-as-a-functions-argument/45146024#45146024", "title": "Use pointer as a function&#39;s argument", "body": "<p>In <code>writeToInflux</code>, the <code>c interface{}</code> doesn't specify any methods <code>c</code> should implement. You should use sine <code>InfluxWriter</code> interface so you can call <code>c.Write</code>:</p>\n\n<pre><code>type InfluxWriter {\n    Write(bp client.BatchPoints) (*client.Response, error)\n}\n</code></pre>\n\n<p>Alternatively, <code>writeToInflux</code> can accept a <code>client.Client</code>, giving you access to all its methods.</p>\n"}, {"comments": [{"owner": {"reputation": 5639, "user_id": 1277048, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/tGJVH.jpg?s=128&g=1", "display_name": "FuzzyAmi", "link": "https://stackoverflow.com/users/1277048/fuzzyami"}, "edited": false, "score": 1, "creation_date": 1500300104, "post_id": 45146212, "comment_id": 77261450, "body": "I doubt this is the recommended approach. Its better to modify the function parameter to name an actual interface that implements write(). Use type assertion only if you actually benefit from the flexibility that interface{} offers."}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1500302819, "post_id": 45146212, "comment_id": 77263563, "body": "I believe what @yazgazan has done is the better approach. Since the intention is to call a <code>Write</code> method on <code>c</code>, you would want to define an interface for it instead of using an empty interface and type asserting."}], "tags": [], "owner": {"reputation": 75, "user_id": 7064515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/280d817298bfb424e7ed6aaadbbd7f8f?s=128&d=identicon&r=PG&f=1", "display_name": "hari prasad", "link": "https://stackoverflow.com/users/7064515/hari-prasad"}, "is_accepted": true, "score": -1, "last_activity_date": 1500308085, "last_edit_date": 1500308085, "creation_date": 1500299746, "answer_id": 45146212, "question_id": 45145873, "link": "https://stackoverflow.com/questions/45145873/use-pointer-as-a-functions-argument/45146212#45146212", "title": "Use pointer as a function&#39;s argument", "body": "<p>\"c\" is an interface{} type, Having an interface in function parameter, you can able to pass any struct or any data types into it.</p>\n\n<pre><code>In your case you want c to use the function write\nif err := c.Write(bp); err != nil {\n        log.Print(\"write failed \" + err)\n    }\n</code></pre>\n\n<p>The compiler doesn't know the type of c, so you need to type assert it.  </p>\n\n<p>Try this, It will work  </p>\n\n<pre><code>newC,ok:=  c.(type of c)    type of C -&gt; a struct or any type which has a method write\n\nif ok {\n    if err := newC.Write(bp); err != nil {\n            log.Print(\"write failed \" + err)\n        }\n\n}     \n</code></pre>\n\n<p>Or Change your function like this</p>\n\n<pre><code>func writeToInflux(c client.Client, host string, service string, state string) bool\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 8319878, "user_type": "registered", "profile_image": "https://graph.facebook.com/1583427785064493/picture?type=large", "display_name": "Mike Nenych", "link": "https://stackoverflow.com/users/8319878/mike-nenych"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 45146212, "answer_count": 2, "score": 1, "last_activity_date": 1500308475, "creation_date": 1500298884, "last_edit_date": 1500308475, "question_id": 45145873, "link": "https://stackoverflow.com/questions/45145873/use-pointer-as-a-functions-argument", "title": "Use pointer as a function&#39;s argument", "body": "<p>How can I use methods of function arguments?</p>\n\n<pre><code>func writeToInflux(c interface{}, host string, service string, state string) bool {\n    fmt.Println(reflect.TypeOf(c), host, service)\n\n    bp, e := client.NewBatchPoints(client.BatchPointsConfig{\n        Database:  database,\n        Precision: \"us\",\n    })\n\n    if e != nil {\n        log.Print(e)\n    }\n\n    tags := map[string]string{\n        \"host\":    host,\n        \"service\": service,\n    }\n\n    fields := map[string]interface{}{\n        \"state\": state,\n    }\n\n    pt, err := client.NewPoint(\"mon\", tags, fields, time.Now())\n\n    if err != nil {\n        log.Print(err)\n    }\n\n    bp.AddPoint(pt)\n\n    if err := c.Write(bp); err != nil {\n        log.Print(\"write failed \" + err)\n    }\n\n    return true\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    c, err := client.NewHTTPClient(client.HTTPConfig{\n        Addr:     \"http://10.x.x.x:8086\",\n        Username: username,\n        Password: password,\n    })\n    if err != nil {\n        log.Print(err)\n    }\n    a := strings.Split(r.URL.Path, \"/\")\n    writeToInflux(c, a[3], a[4], a[5])\n}\n</code></pre>\n\n<p>In this example i can't use parameters of c variable, or maybe there is another options to use c as parameter to function?</p>\n"}, {"tags": ["go", "server", "plesk"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1500298345, "post_id": 45145400, "comment_id": 77260069, "body": "What do you want it to choose the IP address for? Do you want to listen in a particular address? Do you want to Dial from a particular address?"}, {"owner": {"reputation": 318, "user_id": 4194397, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PeCvC.jpg?s=128&g=1", "display_name": "asanchez", "link": "https://stackoverflow.com/users/4194397/asanchez"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500298892, "post_id": 45145400, "comment_id": 77260494, "body": "I want to Dial from a particular address. The crawler should do the requests it does from a particular address."}], "owner": {"reputation": 318, "user_id": 4194397, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PeCvC.jpg?s=128&g=1", "display_name": "asanchez", "link": "https://stackoverflow.com/users/4194397/asanchez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "closed_date": 1500299014, "answer_count": 0, "score": 0, "last_activity_date": 1500298932, "creation_date": 1500297561, "last_edit_date": 1500298932, "question_id": 45145400, "link": "https://stackoverflow.com/questions/45145400/make-a-program-written-in-golang-use-one-of-the-two-available-ip-addresses", "closed_reason": "Duplicate", "title": "Make a program (written in Golang) use one of the two available IP addresses", "body": "<p>In one Server, I have two IP adresses. I can easily say wich domain uses wich IP Address using Plesk but, I have another program I wrote on Go which crawls some websites and it's not using any particular domain for that. How can I make that programm use one of the two IPs I have?</p>\n\n<p>EDIT: what I want is to dial from a particular Address</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 1, "creation_date": 1500346117, "post_id": 45144788, "comment_id": 77282053, "body": "did you check this repo <a href=\"https://github.com/nightlyone/lockfile\" rel=\"nofollow noreferrer\">github.com/nightlyone/lockfile</a> ?"}], "answers": [{"comments": [{"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "edited": false, "score": 0, "creation_date": 1500296332, "post_id": 45144907, "comment_id": 77258570, "body": "Ahh I see now, thanks for the explanation! That makes sense now... and as for the first part, yes, I am not doing any modifications to the file after reading it. A clone of the contents is made, and that clone is what will be modified (but that is safe from locking of course).   Do I need to close the file after reading?"}, {"owner": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "edited": false, "score": 0, "creation_date": 1500296427, "post_id": 45144907, "comment_id": 77258641, "body": "Note that the seeking method will be an issue if several goroutines are reading/seeking the file at the same time. I&#39;d suggest loading the file in a <code>[]byte</code> at startup, as this would give you performance improvements and you won&#39;t need to worry about the file changing on disk.  Moreover, locking the file using a mutex will only protect you from the file being modified by your own program. You will still run into issues if another program modify the file."}], "tags": [], "owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "is_accepted": false, "score": 1, "last_activity_date": 1500296181, "creation_date": 1500296181, "answer_id": 45144907, "question_id": 45144788, "link": "https://stackoverflow.com/questions/45144788/golang-reading-from-a-file-is-it-safe-from-locking/45144907#45144907", "title": "Golang reading from a file - is it safe from locking?", "body": "<p>If you're modifying the file, you need a mutex. <code>RWMutex</code> should work fine. It looks like you're just reading it, and in that case you should not see any locking behavior or corruption.</p>\n\n<p>The reason you didn't get any data the second time you read from the same file handle is that you're already at the end of the file when you start reading from it the second time. You need to <a href=\"https://golang.org/pkg/os/#File.Seek\" rel=\"nofollow noreferrer\">seek</a> back to offset <code>0</code> if you want to read the contents again.</p>\n"}, {"comments": [{"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "edited": false, "score": 0, "creation_date": 1500298931, "post_id": 45145694, "comment_id": 77260518, "body": "Nice answer! Very well explained. I will test this later today and accept if the concepts work for me."}], "tags": [], "owner": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "is_accepted": false, "score": 2, "last_activity_date": 1500298371, "creation_date": 1500298371, "answer_id": 45145694, "question_id": 45144788, "link": "https://stackoverflow.com/questions/45144788/golang-reading-from-a-file-is-it-safe-from-locking/45145694#45145694", "title": "Golang reading from a file - is it safe from locking?", "body": "<p>Using <code>RWMutex</code> won't protect you from the file being modified by another program. The best option here would be to load your file in a <code>[]byte</code> at startup, and instantiate <code>\"bytes\".Buffer</code> whenever you use <code>goquery.NewDocumentFromReader</code>. In order for the changes to be propagated to the user, you can use fsnotify[1] to detect changes to your file, and update your cached file (<code>[]byte</code>) when necessary (you will need <code>RWMutex</code> for that operation).</p>\n\n<p>For example:</p>\n\n<pre><code>type CachedFile struct {\n    sync.RWMutex\n    FileName string\n    Content  []byte\n    watcher  *fsnotify.Watcher\n}\n\nfunc (c *CachedFile) Buffer() *bytes.Buffer {\n    c.RLock()\n    defer c.RUnlock()\n    return bytes.NewBuffer(c.Content)\n}\n\nfunc (c *CachedFile) Load() error {\n    c.Lock()\n    content, err := ioutil.ReadAll(c.FileName)\n    if err != nil {\n        c.Unlock()\n        return err\n    }\n    c.Content = content\n    c.Unlock()\n}\n\nfunc (c *CachedFile) Watch() error {\n    var err error\n\n    c.watcher, err = fsnotify.NewWatcher()\n    if err != nil {\n        return err\n    }\n\n    go func() {\n        for ev := range c.watcher.Events {\n            if ev.Op != fsnotify.Write {\n                continue\n            }\n            err := c.Load()\n            if err != nil {\n                log.Printf(\"loading %q: %s\", c.FileName, err)\n            }\n        }\n    }()\n\n    err = c.watcher.Add(c.FileName)\n    if err != nil {\n        c.watcher.Close()\n        return err\n    }\n\n    return nil\n}\n\nfunc (c *CachedFile) Close() error {\n    return c.watcher.Close()\n}\n</code></pre>\n\n<p>[1] <a href=\"https://godoc.org/github.com/fsnotify/fsnotify\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/fsnotify/fsnotify</a></p>\n"}], "owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1971, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1500298371, "creation_date": 1500295846, "question_id": 45144788, "link": "https://stackoverflow.com/questions/45144788/golang-reading-from-a-file-is-it-safe-from-locking", "title": "Golang reading from a file - is it safe from locking?", "body": "<p>I have a function that will be called on every single HTTP GET request. The function reads a file, does some stuff to the contents of that file, and returns a slice of bytes of those contents. That slice of bytes of then written as the response body to the HTTP response writer.</p>\n\n<p>Do I need to use a mutex for any of the steps in this function to prevent locking in the event of multiple HTTP requests trying to read the same file? And if so, would a simple RWMutex locking the reading of the file suffice, since I am not actually writing to it but am creating a copy of its contents?</p>\n\n<p>Here is the function:</p>\n\n<pre><code>// prepareIndex will grab index.html and add a nonce to the script tags for the CSP header compliance.\nfunc prepareIndex(nonce string) []byte {\n    // Load index.html.\n    file, err := os.Open(\"./client/dist/index.html\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Convert to goquery document.\n    doc, err := goquery.NewDocumentFromReader(file)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    // Find all script tags and set nonce.\n    doc.Find(\"body &gt; script\").SetAttr(\"nonce\", nonce)\n\n    // Grab the HTML string.\n    html, err := doc.Html()\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    return []byte(html)\n}\n</code></pre>\n\n<p>I also thought about just loading the file once when main starts, but I was having a problem where only the first request could see the data and the subsequent requests saw nothing. Probably an error in the way I was reading the file. But I actually prefer my current approach because if there are any changes to <code>index.html</code>, I want them to be persisted to the user immediately without having to restart the executable.</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 49, "user_id": 8311809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34e96aecaee3a7b5c06533a77903bf79?s=128&d=identicon&r=PG&f=1", "display_name": "mhcbinder", "link": "https://stackoverflow.com/users/8311809/mhcbinder"}, "edited": false, "score": 0, "creation_date": 1500453164, "post_id": 45144716, "comment_id": 77337839, "body": "Thanks for your answer. I&#39;d like to use &quot;restCreate&quot; for a number of different concrete structs, but your answer (and Pavlo&#39;s) solved the issue."}, {"owner": {"reputation": 49, "user_id": 8311809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34e96aecaee3a7b5c06533a77903bf79?s=128&d=identicon&r=PG&f=1", "display_name": "mhcbinder", "link": "https://stackoverflow.com/users/8311809/mhcbinder"}, "edited": false, "score": 0, "creation_date": 1500531979, "post_id": 45144716, "comment_id": 77379757, "body": "After reading up on the link you provided, I think the author is arguing for the exact solution I implemented - use interfaces on underlying concrete types. Thanks again for the information provided!"}], "tags": [], "owner": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "is_accepted": false, "score": 1, "last_activity_date": 1500295620, "creation_date": 1500295620, "answer_id": 45144716, "question_id": 45142452, "link": "https://stackoverflow.com/questions/45142452/golang-json-decoder-does-not-recognize-type/45144716#45144716", "title": "Golang JSON decoder does not recognize type", "body": "<p>You cannot Unmarshal into an interface unless variable is holding a pointer to the concrete type you desire, as <code>json.Decode</code> won't know which concrete type to use. You have two workarounds at your disposal:</p>\n\n<p>Having <code>newResource</code> return a concrete type under the hood:</p>\n\n<pre><code>func newResource() resource {\n    return &amp;anchor{}\n}\n</code></pre>\n\n<p>This way <code>json.Decode</code> knows to unmarshal your JSON into an <code>anchor</code>.</p>\n\n<p>Use <code>newAnchor</code> instead of <code>newResource</code>: this will be more readable in your <code>restCreate</code> function, and is more idiomatic[1].</p>\n\n<p>[1] <a href=\"http://idiomaticgo.com/post/best-practice/accept-interfaces-return-structs/\" rel=\"nofollow noreferrer\">http://idiomaticgo.com/post/best-practice/accept-interfaces-return-structs/</a></p>\n"}, {"comments": [{"owner": {"reputation": 49, "user_id": 8311809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34e96aecaee3a7b5c06533a77903bf79?s=128&d=identicon&r=PG&f=1", "display_name": "mhcbinder", "link": "https://stackoverflow.com/users/8311809/mhcbinder"}, "edited": false, "score": 0, "creation_date": 1500453013, "post_id": 45151974, "comment_id": 77337746, "body": "That works - thanks Pavlo. Just a bit confused why you can return both the composed literal and it&#39;s adress, will explore this further."}], "tags": [], "owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "is_accepted": true, "score": 2, "last_activity_date": 1500661440, "last_edit_date": 1500661440, "creation_date": 1500318897, "answer_id": 45151974, "question_id": 45142452, "link": "https://stackoverflow.com/questions/45142452/golang-json-decoder-does-not-recognize-type/45151974#45151974", "title": "Golang JSON decoder does not recognize type", "body": "<p>It is because you try to use a pointer to the interface to unmarshal into. You need return a pointer in a function </p>\n\n<pre><code>func newAnchor() resource {\n    return &amp;anchor{}\n}\n</code></pre>\n\n<p>And you don't need to get address in this line:\n<code>err := dcdr.Decode(&amp;res)</code></p>\n\n<p>Here is small working example: <a href=\"https://play.golang.org/p/3E0RmGTURO\" rel=\"nofollow noreferrer\">https://play.golang.org/p/3E0RmGTURO</a></p>\n"}], "owner": {"reputation": 49, "user_id": 8311809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34e96aecaee3a7b5c06533a77903bf79?s=128&d=identicon&r=PG&f=1", "display_name": "mhcbinder", "link": "https://stackoverflow.com/users/8311809/mhcbinder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1112, "favorite_count": 1, "accepted_answer_id": 45151974, "answer_count": 2, "score": 0, "last_activity_date": 1500661440, "creation_date": 1500289135, "question_id": 45142452, "link": "https://stackoverflow.com/questions/45142452/golang-json-decoder-does-not-recognize-type", "title": "Golang JSON decoder does not recognize type", "body": "<p>Still a Golang beginner, I am trying to code a generic function to serve ReST requests. I pass a function to create a new resource (struct) with an interface implemented on it, because I would also invoke methods on the struct. When decoding the JSON, logging the type shows the correct (struct) type, but the JSON decoder seems to only recognize the interface, which it cannot decode to.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"github.com/julienschmidt/httprouter\"\n    \"log\"\n    \"net/http\"\n    \"strings\"\n)\n\n// general resource interface\ntype resource interface {\n    // check semantics and return an array of errors or nil if no error found\n    check() []string\n    // update the resource in backend\n    update() error\n}\n\n// specific resource named \"anchor\"\ntype anchor struct {\n    ID   string `json:\"id\"`\n    Name string `json:\"name\"`\n}\n\nfunc newAnchor() resource {\n    return anchor{}\n}\n\nfunc (a anchor) check() []string {\n    return nil\n}\n\nfunc (a anchor) update() error {\n    return nil\n}\n\n// generic function to create (POST) a new resource\nfunc restCreate(newResource func() resource) httprouter.Handle {\n    return func(w http.ResponseWriter, r *http.Request, _ httprouter.Params) {\n        const F = \"restCreate\"\n        var checkErrs []string\n\n        res := newResource()\n        log.Printf(\"%s res type %T\\n\", F, res)\n        dcdr := json.NewDecoder(r.Body)\n        err := dcdr.Decode(&amp;res)\n        log.Printf(\"%s Unmarshalled into %T: %+v\\n\", F, res, res)\n        if err == nil {\n            checkErrs = res.check()\n        }\n        switch {\n        case err != nil:\n            w.WriteHeader(http.StatusInternalServerError)\n            log.Printf(\"[ERR] %s: %v\\n\", F, err)\n        case checkErrs != nil:\n            w.WriteHeader(http.StatusBadRequest)\n            w.Write([]byte(strings.Join(checkErrs, \"\\n\")))\n            log.Printf(\"%s: %v\\n\", F, err)\n        default:\n            res.update()\n            bs, _ := json.Marshal(res)\n            w.Write(bs)\n        }\n    }\n}\n\nfunc main() {\n    r := httprouter.New()\n    r.POST(\"/anchors\", restCreate(newAnchor))\n    http.ListenAndServe(\":8080\", r)\n}\n</code></pre>\n\n<p>The execution log shows:</p>\n\n<p>restCreate res type <strong>main.anchor</strong><br>\nrestCreate Unmarshalled into main.anchor: {ID: Name:}<br>\n[ERR] restCreate: json: cannot unmarshal object into Go value of type <strong>main.resource</strong></p>\n\n<p>Why does Printf show the struct type and json.Decoder the interface?<br>\nI'd appreciate any indicator on what's going wrong and how to solve this in a generic way...</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1500283269, "post_id": 45140270, "comment_id": 77249532, "body": "Are you trying to achieve <a href=\"https://play.golang.org/p/t6lvYq6Kb-\" rel=\"nofollow noreferrer\">this</a>?"}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1500283358, "post_id": 45140270, "comment_id": 77249589, "body": "Using regular expressions instead of parsing is always bad idea."}, {"owner": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "edited": false, "score": 0, "creation_date": 1500283374, "post_id": 45140270, "comment_id": 77249605, "body": "Not quite.  Your example returns <code>{\\&quot;id\\&quot;:\\&quot;ll2.card_4U45pAWUMCLhsu\\&quot;,\\&quot;uid\\&quot;:\\&quot;ll2.acc_727V8M&zwnj;&#8203;6GjPJ9I26CqZHgxN\\&quot;}\\&zwnj;&#8203;&quot;\\013\\022\\006ll2-cc\\&zwnj;&#8203;032\\0019</code>, I just need <code>{\\&quot;id\\&quot;:\\&quot;ll2.card_4U45pAWUMCLhsu\\&quot;,\\&quot;uid\\&quot;:\\&quot;ll2.acc_727V8M&zwnj;&#8203;6GjPJ9I26CqZHgxN\\&quot;}</code>"}, {"owner": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "reply_to_user": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1500283479, "post_id": 45140270, "comment_id": 77249674, "body": "@Grzegorz\u017bur I agree, but in this particular case parsing is not an option"}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1500283785, "post_id": 45140270, "comment_id": 77249879, "body": "@PassKit: Well, it is not a valid JSON... So, you need to get the values of 2 fields, <code>id</code> and <code>uid</code>?"}, {"owner": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1500283790, "post_id": 45140270, "comment_id": 77249889, "body": "@WiktorStribi\u017cew Adapting your playground got me to the result.   <a href=\"https://play.golang.org/p/mFYLwa2ki0\" rel=\"nofollow noreferrer\">play.golang.org/p/mFYLwa2ki0</a>.  If you post as an answer I will accept.  I understand the JSON is not valid, but that can parsed."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1500284174, "post_id": 45140270, "comment_id": 77250154, "body": "Note: If any of the values contain <code>}</code> the accepted solution won&#39;t work."}, {"owner": {"reputation": 1164, "user_id": 4944133, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/94cL7.png?s=128&g=1", "display_name": "Kerwin", "link": "https://stackoverflow.com/users/4944133/kerwin"}, "edited": false, "score": 0, "creation_date": 1500284695, "post_id": 45140270, "comment_id": 77250493, "body": "Regex will pattern which string in memory , not the plain text we see. it&#39;s <code>payload:&quot;{</code> not <code>payload:\\&quot;{</code>"}], "answers": [{"tags": [], "owner": {"reputation": 9384, "user_id": 761132, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/fa462ba2bc6318a8b2e7662bb8e91aa1?s=128&d=identicon&r=PG", "display_name": "Rizwan M.Tuman", "link": "https://stackoverflow.com/users/761132/rizwan-m-tuman"}, "is_accepted": true, "score": 1, "last_activity_date": 1500283996, "creation_date": 1500283996, "answer_id": 45140610, "question_id": 45140270, "link": "https://stackoverflow.com/questions/45140270/go-regex-not-matching/45140610#45140610", "title": "Go Regex not matching", "body": "<p>You can try this: ( <a href=\"http://ideone.com/ncDO0t\" rel=\"nofollow noreferrer\">Run here</a> )</p>\n\n<pre><code>package main\n\nimport (\n    \"regexp\"\n    \"fmt\"\n)\n\nfunc main() {\n    var re = regexp.MustCompile(`payload:\\\\\"(\\{[^\\}]+\\})`)\n    var str = `version:1 response:&lt;status:200 message:\\\"OK\\\" payload:\\\"{\\\\\\\"id\\\\\\\":\\\\\\\"ll2.card_4U45pAWUMCLhsu\\\\\\\",\\\\\\\"uid\\\\\\\":\\\\\\\"ll2.acc_727V8M6GjPJ9I26CqZHgxN\\\\\\\"}\\\\\\\"\\\\013\\\\022\\\\006ll2-cc\\\\032\\\\0019\\\" endorsement:&lt;endorser:\\\"\\\\n\\\\007PASSKIT\\\\022\\\\224\\\\010&gt;`\n    rawJSON := re.FindStringSubmatch(str)\n    fmt.Println(rawJSON[1])    \n}\n</code></pre>\n"}], "owner": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 568, "favorite_count": 0, "accepted_answer_id": 45140610, "answer_count": 1, "score": 0, "last_activity_date": 1500283996, "creation_date": 1500283022, "question_id": 45140270, "link": "https://stackoverflow.com/questions/45140270/go-regex-not-matching", "title": "Go Regex not matching", "body": "<p>I am trying to extract a JSON object from a custom payload.</p>\n\n<p>My regex is working fine here: <a href=\"https://regex101.com/r/G5lBDC/1/\" rel=\"nofollow noreferrer\">https://regex101.com/r/G5lBDC/1/</a></p>\n\n<p>But Go returns no matches</p>\n\n<pre><code>re := regexp.MustCompile(`/payload:\\\\\"(.+?)\\\\\\\\\\\\\"\\\\\\\\/g`)\nrawResponse := \"version:1 response:&lt;status:200 message:\\\"OK\\\" payload:\\\"{\\\\\\\"id\\\\\\\":\\\\\\\"ll2.card_4U45pAWUMCLhsu\\\\\\\",\\\\\\\"uid\\\\\\\":\\\\\\\"ll2.acc_727V8M6GjPJ9I26CqZHgxN\\\\\\\"}\\\\\\\"\\\\013\\\\022\\\\006ll2-cc\\\\032\\\\0019\\\" endorsement:&lt;endorser:\\\"\\\\n\\\\007PASSKIT\\\\022\\\\224\\\\010&gt;\"\nrawJSON := re.FindStringSubmatch(rawResponse)\n</code></pre>\n\n<p>Go Playground <a href=\"https://play.golang.org/p/XRfbExNa9V\" rel=\"nofollow noreferrer\">https://play.golang.org/p/XRfbExNa9V</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1500285057, "post_id": 45139954, "comment_id": 77250761, "body": "<a href=\"https://play.golang.org/p/kV_k_-p4NH\" rel=\"nofollow noreferrer\">play.golang.org/p/kV_k_-p4NH</a>"}], "answers": [{"tags": [], "owner": {"reputation": 468, "user_id": 450333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11263845c2ece6187c3b87b2be66f60a?s=128&d=identicon&r=PG", "display_name": "Kent", "link": "https://stackoverflow.com/users/450333/kent"}, "is_accepted": true, "score": 3, "last_activity_date": 1500286640, "last_edit_date": 1500286640, "creation_date": 1500285011, "answer_id": 45140983, "question_id": 45139954, "link": "https://stackoverflow.com/questions/45139954/dynamic-struct-as-parameter-golang/45140983#45140983", "title": "Dynamic struct as parameter Golang", "body": "<p>You could use an interface like this and an if statement to get it back to whatever struct it orginated as tho.</p>\n\n<pre><code>import (\n    \"fmt\"\n)\n\ntype ReturnValue struct {\n   Status string\n   CustomStruct interface{}\n} \n\nfunc GetReturn(status string, class interface{}){\n   var result = ReturnValue {Status : status, CustomStruct: class}\n\n   fmt.Println(result)\n\n   msg, ok := result.CustomStruct.(Message1)\n   if ok {\n      fmt.Printf(\"Message1 is %s\\n\", msg.message)\n   }\n}\n\ntype Message1 struct {\n   message string\n}\n\ntype Message2 struct {\n   message string\n}\n\nfunc main(){\n   var m1 = Message1 {message: \"Hello1\"}\n   GetReturn(\"success\",  m1)\n\n   var m2 = Message2 {message: \"Hello2\"}\n   GetReturn(\"success\",  m2)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/L6VYV80x27\" rel=\"nofollow noreferrer\">https://play.golang.org/p/L6VYV80x27</a></p>\n"}], "owner": {"reputation": 545, "user_id": 3763112, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/bea14956d83fe906ba4bafcea761250d?s=128&d=identicon&r=PG&f=1", "display_name": "Angger", "link": "https://stackoverflow.com/users/3763112/angger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5308, "favorite_count": 0, "accepted_answer_id": 45140983, "answer_count": 1, "score": 3, "last_activity_date": 1500286640, "creation_date": 1500282130, "last_edit_date": 1500286577, "question_id": 45139954, "link": "https://stackoverflow.com/questions/45139954/dynamic-struct-as-parameter-golang", "title": "Dynamic struct as parameter Golang", "body": "<p>I'm wondering whether it is possible to pass a dynamic struct as function's parameter ?</p>\n\n<pre><code>type ReturnValue struct {\n   Status string\n   CustomStruct // here should store any struct given\n} \n\nfunc GetReturn(status string, class interface{}){\n   var result = ReturnValue {Status : status, CustomStruct : //here any struct should be stored}\n\n   fmt.Prinln(result)\n}\n\ntype Message1 struct {\n   message : string\n}\n\nfunc main(){\n   var message = Message1 {message: \"Hello\"}\n   GetReturn(\"success\",  message)\n}\n</code></pre>\n"}, {"tags": ["for-loop", "go", "compiler-errors", "unused-variables"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1500281428, "post_id": 45137897, "comment_id": 77248356, "body": "Don&#39;t post images of text. Copy the text instead."}], "answers": [{"tags": [], "owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "is_accepted": false, "score": 8, "last_activity_date": 1500275726, "creation_date": 1500275726, "answer_id": 45138077, "question_id": 45137897, "link": "https://stackoverflow.com/questions/45137897/use-of-variable-in-for-loop-not-recognized-in-golang/45138077#45138077", "title": "use of variable in for loop not recognized in Golang", "body": "<blockquote>\n  <p>The Golang compiler doesn't seem to recognise that the i variable is given back to the function in the next loop. Inside this function, the I variable changes value.</p>\n</blockquote>\n\n<p>No, <code>i</code> does not change value; <code>:=</code> declares a new <code>i</code>. (Go allows you to do this because <code>data</code> is also new.) To assign to it instead, you\u2019ll need to declare <code>data</code> separately:</p>\n\n<pre><code>var data RandomDataType\ndata, i = GiveRandomData(i)\n</code></pre>\n\n<p>Or give the new <code>i</code> a temporary name:</p>\n\n<pre><code>data, next := GiveRandomData(i)\ni = next\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 4910743, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-X1VNV4PZnyY/AAAAAAAAAAI/AAAAAAAAABE/UIGF8V2aEPA/photo.jpg?sz=128", "display_name": "TheCodeWizard", "link": "https://stackoverflow.com/users/4910743/thecodewizard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1764, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1500281682, "creation_date": 1500275096, "last_edit_date": 1500281402, "question_id": 45137897, "link": "https://stackoverflow.com/questions/45137897/use-of-variable-in-for-loop-not-recognized-in-golang", "title": "use of variable in for loop not recognized in Golang", "body": "<p>I'm developing in golang and I run the following for loop:</p>\n\n<pre><code>// Define Initial Value\ni := 0\n\nfor {   \n    // Get Random data based on iteration\n    data, i := GiveRandomData(i)\n\n    // Save to database\n    response, err := SaveToDatabase(data)\n\n    if err != nil { log.Fatal(err) }\n    fmt.Println(response)\n}\n</code></pre>\n\n<p>However, when compiling this program, I get the following error:</p>\n\n<blockquote>\n  <p>.\\main.go:26: i declared and not used</p>\n</blockquote>\n\n<p>The Golang compiler doesn't seem to recognise that the i variable is given back to the function in the next loop. Inside this function, the I variable changes value.</p>\n\n<p>What should I do to get rid of this compilation error or to let golang understand that this variable is NOT unused but used in the next iteration of this endless for loop?</p>\n"}, {"tags": ["go", "import"], "answers": [{"tags": [], "owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "is_accepted": true, "score": 4, "last_activity_date": 1500274368, "last_edit_date": 1500274368, "creation_date": 1500250859, "answer_id": 45134481, "question_id": 45134378, "link": "https://stackoverflow.com/questions/45134378/how-to-make-a-short-relative-import/45134481#45134481", "title": "How to make a short/relative import", "body": "<p>Typically import path starts after <code>$GOPATH/src</code>, refer to <a href=\"https://golang.org/doc/code.html#ImportPaths\" rel=\"nofollow noreferrer\">doc</a>.</p>\n\n<p>Let's say you have directory structure:</p>\n\n<pre><code>$GOPATH/src/github.com/hithubuser/app/utils\n\n# your import path is 'github.com/hithubuser/app/utils'\n</code></pre>\n\n<blockquote>\n  <p>Do you write a full the path for all the imports or you avoid to make it?</p>\n</blockquote>\n\n<p>Yes, generally full import is used, since it enables you to distribute your code as go library. So that you can develop reusable code and import it in any project as needed or you can publish it to Go community.</p>\n\n<hr>\n\n<p>Let's say you have standalone project, not referred to any other Go project and you're distributing as binary instead of go library. Then you can to something like this (it is not commonly used/recommended though).</p>\n\n<p>Just git clone your repo at <code>$GOPATH/src</code> like <code>git clone github.com/hithubuser/app</code></p>\n\n<pre><code>$GOPATH/src/app/utils\n\n# then import path is app/utils\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "is_accepted": false, "score": 1, "last_activity_date": 1500252132, "creation_date": 1500252132, "answer_id": 45134579, "question_id": 45134378, "link": "https://stackoverflow.com/questions/45134378/how-to-make-a-short-relative-import/45134579#45134579", "title": "How to make a short/relative import", "body": "<p>Another possibility is to use the vendor facilities introduced in Go 1.5.</p>\n\n<ol>\n<li>Create a <code>vendor</code> directory.</li>\n<li><p>Copy (or <code>git clone</code> or whatever) your <code>utils</code> directory as a subdirectory of <code>vendor</code>, so your hierarchy now looks like this:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>app\n|-- main.go\n`-- vendor/\n    `-- utils/\n        `-- utils.go\n</code></pre></li>\n<li><p><a href=\"https://github.com/golang/go/wiki/PackageManagementTools#go15vendorexperiment\" rel=\"nofollow noreferrer\">Set the <code>GO15VENDOREXPERIMENT</code> environment variable to 1</a> to enable vendoring support if you're using Go 1.5. Newer versions enable it by default.</p></li>\n</ol>\n"}], "owner": {"reputation": 1625, "user_id": 4175590, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2629234c95b90ab0868a1f70c9c6b86d?s=128&d=identicon&r=PG&f=1", "display_name": "Oleksandr Dashkov", "link": "https://stackoverflow.com/users/4175590/oleksandr-dashkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1183, "favorite_count": 0, "accepted_answer_id": 45134481, "answer_count": 2, "score": 1, "last_activity_date": 1609251838, "creation_date": 1500249708, "last_edit_date": 1609251838, "question_id": 45134378, "link": "https://stackoverflow.com/questions/45134378/how-to-make-a-short-relative-import", "title": "How to make a short/relative import", "body": "<p>Is it possible to make a relative import in Go code? I read a lot of examples but I really can't understand how to make it. For example, I have a project <code>app</code> and a sub package <code>utils</code> in it.</p>\n<pre><code>app\n   main.go\n   utils\n        utils.go\n</code></pre>\n<p>utils.go:</p>\n<pre><code>package utils\n\nimport &quot;fmt&quot;\n\nfunc TestFunc()  {\n    fmt.Print(&quot;I'm a TestFunc&quot;)\n}\n</code></pre>\n<p>Is there a way to import this package using only <code>import &quot;./utils&quot;</code> or <code>import &quot;app/utils</code> but not take all the path like <code>import &quot;github.com/hithubuser/app/utils&quot;</code>?</p>\n<p>If there is no way to do it, how do you work with the nested packages? Do you write a full the path for all the imports or you avoid to make it?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "edited": false, "score": 0, "creation_date": 1500255224, "post_id": 45134241, "comment_id": 77239017, "body": "If I am comparing 2 structs like in my example then is it best to just reset those fields and then compare the structs?"}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1500257160, "post_id": 45134241, "comment_id": 77239403, "body": "Yes, for struct reset field <code>f</code> and compare it using <code>reflect.DeepEqual</code>."}], "tags": [], "owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "is_accepted": true, "score": 0, "last_activity_date": 1500255013, "last_edit_date": 1500255013, "creation_date": 1500248115, "answer_id": 45134241, "question_id": 45134172, "link": "https://stackoverflow.com/questions/45134172/how-do-i-compare-equality-of-function-types/45134241#45134241", "title": "How do I compare equality of function types?", "body": "<p>You can compare function like this, Read more about the representation of functions here: <a href=\"http://golang.org/s/go11func\" rel=\"nofollow noreferrer\">http://golang.org/s/go11func</a></p>\n\n<pre><code>func funcEqual(a, b interface{}) bool {\n    av := reflect.ValueOf(&amp;a).Elem()\n    bv := reflect.ValueOf(&amp;b).Elem()\n    return av.InterfaceData() == bv.InterfaceData()\n}\n</code></pre>\n\n<p><strong>For example:</strong> This is just an idea for your start point.</p>\n\n<pre><code>func main() {\n    a := []someFunc{sf1, sf2}\n    b := []someFunc{sf1, sf2}\n\n    for idx, f := range a {\n        fmt.Println(\"Index: \", idx, funcEqual(f, b[idx]))\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Index:  0 true\nIndex:  1 true\n</code></pre>\n\n<p>Play link: <a href=\"https://play.golang.org/p/6cSVXSYfa5\" rel=\"nofollow noreferrer\">https://play.golang.org/p/6cSVXSYfa5</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 0, "accepted_answer_id": 45134241, "answer_count": 1, "score": 2, "last_activity_date": 1500255013, "creation_date": 1500247392, "question_id": 45134172, "link": "https://stackoverflow.com/questions/45134172/how-do-i-compare-equality-of-function-types", "title": "How do I compare equality of function types?", "body": "<p>I am doing some testing and trying to test for equality of some function types. I have <a href=\"https://play.golang.org/p/GeE_YJF5lz\" rel=\"nofollow noreferrer\">https://play.golang.org/p/GeE_YJF5lz</a> :</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype myStruct struct {\n    f []someFunc\n}\n\ntype someFunc func(a string) bool\n\nvar sf1 someFunc = func(a string) bool {\n    return true\n}\n\nvar sf2 someFunc = func(a string) bool {\n    return false\n}\n\nfunc main() {\n    a := []someFunc{sf1, sf2}\n    b := []someFunc{sf1, sf2}\n\n    fmt.Println(reflect.DeepEqual(a, b)) // false\n\n    m := &amp;myStruct{\n        f: []someFunc{sf1, sf2},\n    }\n\n    n := &amp;myStruct{\n        f: []someFunc{sf1, sf2},\n    }\n\n    fmt.Println(reflect.DeepEqual(m, n)) // false\n}\n</code></pre>\n\n<p>I haven't been able to find anything in the docs about comparing functions and know I must be missing something important as to why reflect.DeepEqual doesn't work for them properly.</p>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 1, "creation_date": 1500260902, "post_id": 45134127, "comment_id": 77240100, "body": "Aside: it&#39;s perhaps more intuitive to pass and copy <code>v</code> rather than passing <code>vptr</code> and copying <code>*vptr</code>; if you want to copy <code>*vptr</code>, then pass <code>*vptr</code> instead of <code>vptr</code>. See <a href=\"https://play.golang.org/p/daDVbMp3em\" rel=\"nofollow noreferrer\">play.golang.org/p/daDVbMp3em</a> for an example that will avoid runtime panics."}, {"owner": {"reputation": 12786, "user_id": 499125, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/1e0971e368bdad6e495b2eafcdeb7796?s=128&d=identicon&r=PG", "display_name": "Some Noob Student", "link": "https://stackoverflow.com/users/499125/some-noob-student"}, "edited": false, "score": 0, "creation_date": 1501014957, "post_id": 45134127, "comment_id": 77588581, "body": "@ChronoKitsune what a GREAT example! I thought I was setting the value T.A was pointing to, when I should be setting the address &amp;T.A was pointing to."}], "answers": [{"tags": [], "owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "is_accepted": false, "score": 1, "last_activity_date": 1500250910, "creation_date": 1500250910, "answer_id": 45134486, "question_id": 45134127, "link": "https://stackoverflow.com/questions/45134127/how-do-you-set-a-value-to-a-pointer-containing-nil-using-reflection/45134486#45134486", "title": "How do you set a value to a pointer containing nil using reflection", "body": "<p><code>reflect.ValueOf(dest).Elem().Set(destRef)</code></p>\n\n<p>If you look into this line, <code>reflect.ValueOf(dest)</code> will give you nil, since you passed in a nil pointer. Calling <code>.Elem()</code> on this is invalid, since there is no element to the nil pointer.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 0, "creation_date": 1500260765, "post_id": 45134656, "comment_id": 77240077, "body": "Alternatively, <code>&amp;t.A</code> could be passed, and <code>reflect.New</code> could be used. <a href=\"https://play.golang.org/p/daDVbMp3em\" rel=\"nofollow noreferrer\">play.golang.org/p/daDVbMp3em</a> (I didn&#39;t use <code>srcRef.Elem()</code> or <code>vptr</code> because it&#39;s more intuitive to me to copy <code>v</code> rather than <code>*vptr</code>)"}], "tags": [], "owner": {"reputation": 29582, "user_id": 1427098, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Bvdm0.jpg?s=128&g=1", "display_name": "Darshan Rivka Whittle", "link": "https://stackoverflow.com/users/1427098/darshan-rivka-whittle"}, "is_accepted": false, "score": 1, "last_activity_date": 1500253023, "creation_date": 1500253023, "answer_id": 45134656, "question_id": 45134127, "link": "https://stackoverflow.com/questions/45134127/how-do-you-set-a-value-to-a-pointer-containing-nil-using-reflection/45134656#45134656", "title": "How do you set a value to a pointer containing nil using reflection", "body": "<p><code>t.A</code> is a nil pointer when you pass it in, so <code>CopyValue</code> is being asked to copy a value into an invalid (nil) location.  You need to allocate space for an int for it to point to, and then <code>CopyValue</code> will be able to do the copy into the location pointed at.</p>\n\n<p>This resolves the error and allows the value to be copied:</p>\n\n<pre><code>t := &amp;T{}\nt.A = new(int) // Add this line\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 4, "last_activity_date": 1500260818, "creation_date": 1500260818, "answer_id": 45135395, "question_id": 45134127, "link": "https://stackoverflow.com/questions/45134127/how-do-you-set-a-value-to-a-pointer-containing-nil-using-reflection/45135395#45135395", "title": "How do you set a value to a pointer containing nil using reflection", "body": "<p>In order to be able to modify what <code>t.A</code> points to, you need to send a reference to it to your <code>CopyValue</code> function.</p>\n\n<pre><code>CopyValue(vptr, &amp;t.A) // (note the &amp;)\n</code></pre>\n\n<p>You can then assign the pointer to the new address:</p>\n\n<pre><code>func CopyValue(src interface{}, dest interface{}) {\n    srcRef := reflect.ValueOf(src)\n    vp := reflect.ValueOf(dest)\n    vp.Elem().Set(srcRef)\n}\n</code></pre>\n\n<p>See the 3rd \"law of reflection\" here: <a href=\"https://blog.golang.org/laws-of-reflection\" rel=\"nofollow noreferrer\">https://blog.golang.org/laws-of-reflection</a></p>\n\n<p>Full working code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype T struct {\n    A *int\n}\n\nfunc main() {\n    t := &amp;T{}\n    v := 1\n    vptr := &amp;v\n    CopyValue(vptr, &amp;t.A) // we pass a reference to t.A since we want to modify it\n    fmt.Printf(\"%v\\n\", *t.A)\n}\n\nfunc CopyValue(src interface{}, dest interface{}) {\n    srcRef := reflect.ValueOf(src)\n    vp := reflect.ValueOf(dest)\n    vp.Elem().Set(srcRef)\n}\n</code></pre>\n"}], "owner": {"reputation": 12786, "user_id": 499125, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/1e0971e368bdad6e495b2eafcdeb7796?s=128&d=identicon&r=PG", "display_name": "Some Noob Student", "link": "https://stackoverflow.com/users/499125/some-noob-student"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2606, "favorite_count": 0, "accepted_answer_id": 45135395, "answer_count": 3, "score": 3, "last_activity_date": 1500260818, "creation_date": 1500246860, "question_id": 45134127, "link": "https://stackoverflow.com/questions/45134127/how-do-you-set-a-value-to-a-pointer-containing-nil-using-reflection", "title": "How do you set a value to a pointer containing nil using reflection", "body": "<p>I'm trying to set a value to a nil pointer in a struct like so.</p>\n\n<pre><code>// https://play.golang.org/p/jPTMNC_ZQ9\npackage main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype T struct {\n    A *int\n}\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n    t := &amp;T{}\n\n    v := 1\n    vptr := &amp;v\n\n    CopyValue(vptr, t.A) // I want to set t.A to contain 1\n}\n\nfunc CopyValue(src interface{}, dest interface{}) {\n    srcRef := reflect.ValueOf(src)\n    if srcRef.Kind() == reflect.Ptr {\n        srcRef = srcRef.Elem()\n    }\n\n    destRef := reflect.New(srcRef.Type()).Elem()\n    destRef.Set(srcRef)\n    reflect.ValueOf(dest).Elem().Set(destRef)\n}\n</code></pre>\n\n<p>However, I encounter the following error:</p>\n\n<pre><code>panic: reflect: call of reflect.Value.Set on zero Value\n\ngoroutine 1 [running]:\nreflect.flag.mustBeAssignable(0x0, 0x1040a128)\n    /usr/local/go/src/reflect/value.go:221 +0x260\nreflect.Value.Set(0x0, 0x0, 0x0, 0xdefc0, 0x1040a128, 0x182)\n    /usr/local/go/src/reflect/value.go:1339 +0x40\nmain.CopyValue(0xd7860, 0x1040a124, 0xd7860, 0x0)\n    /tmp/sandbox487854080/main.go:30 +0x1a0\nmain.main()\n    /tmp/sandbox487854080/main.go:19 +0x100\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1500335047, "last_edit_date": 1500335047, "creation_date": 1500264083, "answer_id": 45135802, "question_id": 45133721, "link": "https://stackoverflow.com/questions/45133721/prevent-golang-http-newrequest-from-adding-braces-to-post-body/45135802#45135802", "title": "Prevent golang http.NewRequest from adding braces to POST body", "body": "<p>The printed representation of the body is not the same as the contents of the reader. The http.NewRequest function does not add braces to POST body. </p>\n\n<p>Here's what's going on:</p>\n\n<p>The body is a <a href=\"https://github.com/golang/go/blob/504deee6088c2448fc3e91c94a1ba69ec92fb7ef/src/io/ioutil/ioutil.go#L107-L117\" rel=\"nofollow noreferrer\">ioutil.nopCloser</a> with the Reader field set to the <code>*bytes.Buffer</code>.</p>\n\n<p>The <code>fmt.Print</code> function prints the <code>ioutil.nopCloser</code> struct as <code>{</code> + fields + <code>}</code>. This is the extra set of braces in the printed output. The fmt.Print function prints the <code>Reader</code>  field by calling the <code>*bytes.Buffer.String</code> method. The <code>String</code> method returns the contents as a string.</p>\n\n<p>The body is sent by reading it, not by printing it.</p>\n"}], "owner": {"reputation": 241, "user_id": 1341036, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8661bc2ca2bc5be6e0639f86cee806f0?s=128&d=identicon&r=PG&f=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/1341036/matt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 673, "favorite_count": 1, "accepted_answer_id": 45135802, "answer_count": 1, "score": 3, "last_activity_date": 1500335047, "creation_date": 1500243047, "question_id": 45133721, "link": "https://stackoverflow.com/questions/45133721/prevent-golang-http-newrequest-from-adding-braces-to-post-body", "title": "Prevent golang http.NewRequest from adding braces to POST body", "body": "<p>This must be fairly simple, but I can't work out why, when making an HTTP request with go, the body of the request gets wrapped in an additional set of braces:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc main() {\n    jsonStr := []byte(`{\"some\":\"test\",\"json\":\"data\"}`)\n    req, _ := http.NewRequest(\"POST\", \"http://test.com\", bytes.NewBuffer(jsonStr))\n    fmt.Print(req.Body)\n}\n</code></pre>\n\n<p>This results in:</p>\n\n<pre><code>{{\"some\":\"test\",\"json\":\"data\"}}\n</code></pre>\n\n<p>In my actual code I'm using the json.Marshal and a struct to generate the byte buffer, but getting the same result. The result is the API rejecting the request (as expected).</p>\n\n<p>How do I prevent the extra braces being added?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "is_accepted": false, "score": 0, "last_activity_date": 1500235915, "creation_date": 1500235915, "answer_id": 45132890, "question_id": 45132563, "link": "https://stackoverflow.com/questions/45132563/idiomatic-way-of-renaming-keys-in-map-while-ranging-over-the-original-map/45132890#45132890", "title": "Idiomatic way of renaming keys in map while ranging over the original map", "body": "<p>PEBKAC as always, this seems to solve it quite nicely by first checking if the replacement key is present in the replacement map and also deletes it in one fell swoop</p>\n\n<pre><code>for k, v := range o {\n    if _, ok := r[k]; ok {\n        o[r[k]] = v\n        delete(o, k)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "is_accepted": false, "score": 2, "last_activity_date": 1500236131, "creation_date": 1500236131, "answer_id": 45132929, "question_id": 45132563, "link": "https://stackoverflow.com/questions/45132563/idiomatic-way-of-renaming-keys-in-map-while-ranging-over-the-original-map/45132929#45132929", "title": "Idiomatic way of renaming keys in map while ranging over the original map", "body": "<p>If you range over and modify targeted map at same time, it gives an unexpected behavior which empty key with value. I have seen that before (it happens some time not always). I have not researched around it (may be fellow SO members can shed some light here).</p>\n\n<p>If you do range over source map and update targeted map, you get a desired behavior.</p>\n\n<pre><code>for k, v := range r {\n    o[v] = o[k]\n    delete(o, k)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Modified map: map[1:x 2:y]\n</code></pre>\n\n<p>Play link: <a href=\"https://play.golang.org/p/heVbZFe0Nu\" rel=\"nofollow noreferrer\">https://play.golang.org/p/heVbZFe0Nu</a></p>\n"}, {"tags": [], "owner": {"reputation": 985, "user_id": 1513091, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6c747a3ab3055cba5e470d31b1a547b?s=128&d=identicon&r=PG", "display_name": "bogdanciobanu", "link": "https://stackoverflow.com/users/1513091/bogdanciobanu"}, "is_accepted": false, "score": 2, "last_activity_date": 1500236330, "creation_date": 1500236330, "answer_id": 45132957, "question_id": 45132563, "link": "https://stackoverflow.com/questions/45132563/idiomatic-way-of-renaming-keys-in-map-while-ranging-over-the-original-map/45132957#45132957", "title": "Idiomatic way of renaming keys in map while ranging over the original map", "body": "<p>Simply iterate over the other map:</p>\n\n<pre><code>o := make(map[string]string) // original map\nr := make(map[string]string) // replacement map original -&gt; destination keys\n\no[\"a\"] = \"x\"\no[\"b\"] = \"y\"\n\nr[\"a\"] = \"1\"\nr[\"b\"] = \"2\"\n\nfmt.Println(o) // -&gt; map[a:x b:y]\n\nfor k, v := range r {\n    o[v] = o[k]\n    delete(o, k)\n}\nfmt.Println(o) // -&gt; map[1:x 2:y]\n</code></pre>\n"}], "owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5128, "favorite_count": 1, "answer_count": 3, "score": 4, "last_activity_date": 1500236330, "creation_date": 1500233468, "last_edit_date": 1500233784, "question_id": 45132563, "link": "https://stackoverflow.com/questions/45132563/idiomatic-way-of-renaming-keys-in-map-while-ranging-over-the-original-map", "title": "Idiomatic way of renaming keys in map while ranging over the original map", "body": "<p>I'm attempting to rename the keys of a map <code>o</code> using the keys and values of another map <code>r</code>.</p>\n\n<p>This below attempt seems to fail for reasons I guess are related to the fact that I'm modifying the map while also ranging over it \u2014 I get an extra <code>blank</code> key.</p>\n\n<p>I could simply copy the map over to a new destination map, however the map is part of a much more complex struct \u2014 so any attempts will require me to do some kind of recursive deep copy of that struct, which I would rather avoid.</p>\n\n<pre><code>o := make(map[string]string) // original map\nr := make(map[string]string) // replacement map original -&gt; destination keys\n\no[\"a\"] = \"x\"\no[\"b\"] = \"y\"\n\nr[\"a\"] = \"1\"\nr[\"b\"] = \"2\"\n\nfmt.Println(o) // -&gt; map[a:x b:y]\n\nfor k, v := range o {\n    o[r[k]] = v\n}\n\ndelete(o, \"a\")\ndelete(o, \"b\")\n\nfmt.Println(o) // -&gt; map[1:x 2:y :y]\n</code></pre>\n\n<p>I am expecting this to print <code>map[1:x 2:y]</code>.</p>\n"}, {"tags": ["go", "geolocation", "gomobile"], "answers": [{"comments": [{"owner": {"reputation": 11467, "user_id": 741404, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/28832e0d64ab5e5b21c9a78c02d8aefc?s=128&d=identicon&r=PG", "display_name": "jdevelop", "link": "https://stackoverflow.com/users/741404/jdevelop"}, "edited": false, "score": 0, "creation_date": 1607832035, "post_id": 45133431, "comment_id": 115394968, "body": "out of curiosity - where these imports <code>Java&#47;android&#47;content&#47;Context</code> and <code>Java&#47;android&#47;location&#47;LocationManager</code> are coming from?"}], "tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": true, "score": 3, "last_activity_date": 1500241146, "last_edit_date": 1500241146, "creation_date": 1500240249, "answer_id": 45133431, "question_id": 45130826, "link": "https://stackoverflow.com/questions/45130826/access-geolocation-data-using-gomobile/45133431#45133431", "title": "Access geolocation data using gomobile", "body": "<p>AFAIK there is no ready solution yet to access location on both Android and iOS in  a platform independent way. But in theory you could make separate packages using the <code>gomobile</code> tool to generate bindings for each platform. </p>\n\n<p>For example on Android you would use something like:</p>\n\n<pre><code>import \"Java/android/content/Context\"\nimport \"Java/android/location/LocationManager\"\n\nlocationManager := ctx.GetSystemService(Context.LOCATION_SERVICE)\n// nil check omitted.\nlocation := locationManager.GetLastKnownLocation(LocationManager.GPS_PROVIDER)\n// nil check omitted.\nlat := location.GetLatitude()\nlng := location.GetLongitude()\n</code></pre>\n\n<p>Where <code>ctx</code> is the context (an activity, service, etc.) that you receive in one of their lifecycle callbacks.</p>\n\n<p>Also you can use other providers (network, fused).</p>\n"}], "owner": {"reputation": 694, "user_id": 4766124, "user_type": "registered", "accept_rate": 81, "profile_image": "https://lh3.googleusercontent.com/-hdeRZjguGzc/AAAAAAAAAAI/AAAAAAAAAEA/h8k8MkFzgV4/photo.jpg?sz=128", "display_name": "adrpino", "link": "https://stackoverflow.com/users/4766124/adrpino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 412, "favorite_count": 1, "accepted_answer_id": 45133431, "answer_count": 1, "score": 1, "last_activity_date": 1500241146, "creation_date": 1500222291, "question_id": 45130826, "link": "https://stackoverflow.com/questions/45130826/access-geolocation-data-using-gomobile", "title": "Access geolocation data using gomobile", "body": "<p>Can I access the phone's geolocation using a native <code>gomobile</code> application?</p>\n\n<p>I have seen experimental support for sensor data <a href=\"https://godoc.org/golang.org/x/mobile/exp/sensor\" rel=\"nofollow noreferrer\">here</a>, but nothing about the actual latitude, longitude of the device.</p>\n\n<p>I have no prior experience in app development, and I am learning Go at the moment.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 620, "user_id": 1322651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e59e59204a86ec3da94e49eaf68f932?s=128&d=identicon&r=PG", "display_name": "Lukas Isselb&#228;cher", "link": "https://stackoverflow.com/users/1322651/lukas-isselb%c3%a4cher"}, "is_accepted": false, "score": 0, "last_activity_date": 1500225988, "last_edit_date": 1500225988, "creation_date": 1500218999, "answer_id": 45130298, "question_id": 45129538, "link": "https://stackoverflow.com/questions/45129538/invoke-async-operation-with-result/45130298#45130298", "title": "Invoke async operation with result", "body": "<p>The keyword you have to search for is <code>goroutines</code></p>\n\n<p>Here is one example: <a href=\"https://gobyexample.com/goroutines\" rel=\"nofollow noreferrer\">https://gobyexample.com/goroutines</a></p>\n\n<p>If you follow the tutorial, channels, buffered channels and syncronized channels will give you some way to return data.</p>\n\n<p>Example 2: <a href=\"https://tour.golang.org/concurrency/1\" rel=\"nofollow noreferrer\">https://tour.golang.org/concurrency/1</a></p>\n\n<p>Example 3: <a href=\"http://www.golangbootcamp.com/book/concurrency\" rel=\"nofollow noreferrer\">http://www.golangbootcamp.com/book/concurrency</a></p>\n\n<p>TL;DR: Here is your pattern:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc sum(a []int, c chan int) {\n    sum := 0\n    for _, v := range a {\n        sum += v\n    }\n    c &lt;- sum // send sum to c\n}\n\nfunc main() {\n    a := []int{7, 2, 8, -9, 4, 0}\n\n    c := make(chan int)\n    go sum(a[:len(a)/2], c)\n    go sum(a[len(a)/2:], c)\n    x, y := &lt;-c, &lt;-c // receive from c\n\n    fmt.Println(x, y, x+y)\n}\n</code></pre>\n"}], "owner": {"reputation": 173, "user_id": 8215502, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/923f568594ec0b35bac4b45dbc1e3657?s=128&d=identicon&r=PG&f=1", "display_name": "user8215502", "link": "https://stackoverflow.com/users/8215502/user8215502"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1500225988, "creation_date": 1500214421, "last_edit_date": 1500225257, "question_id": 45129538, "link": "https://stackoverflow.com/questions/45129538/invoke-async-operation-with-result", "title": "Invoke async operation with result", "body": "<p>Can you provide a pattern of how to invoke method async with result?\nis there any best practice to invoke it by configuration sync/async</p>\n"}, {"tags": ["string", "go", "types"], "answers": [{"tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": false, "score": 3, "last_activity_date": 1500206955, "creation_date": 1500206955, "answer_id": 45128418, "question_id": 45127907, "link": "https://stackoverflow.com/questions/45127907/how-to-separate-arrays-type-structs-in-go/45128418#45128418", "title": "How to separate arrays (type structs) in Go?", "body": "<p>You need a stringer method to define how your object will be printed:</p>\n\n<pre><code>func (g Games) String() string {\n    return fmt.Sprintf(\"Game = %v, Creator = %v\", g.game, g.creator)\n}\n</code></pre>\n\n<p>Check out the <a href=\"https://tour.golang.org/methods/17\" rel=\"nofollow noreferrer\">Tour of Go</a></p>\n"}, {"tags": [], "owner": {"reputation": 3422, "user_id": 205039, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/syKAT.png?s=128&g=1", "display_name": "Flavio Copes", "link": "https://stackoverflow.com/users/205039/flavio-copes"}, "is_accepted": false, "score": 1, "last_activity_date": 1500214389, "creation_date": 1500214389, "answer_id": 45129533, "question_id": 45127907, "link": "https://stackoverflow.com/questions/45127907/how-to-separate-arrays-type-structs-in-go/45129533#45129533", "title": "How to separate arrays (type structs) in Go?", "body": "<p><code>fmt.Print()</code> does not allow you to specify the format, but will use the type default format.</p>\n\n<p>Instead, use <code>fmt.Printf()</code>. This should do what you need:</p>\n\n<pre><code>fmt.Printf(\"Game = %s\\nPublisher = %s\", videogames[i].game, videogames[i].creator)\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 7986350, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/18717c456821a90015a6cf613c92063f?s=128&d=identicon&r=PG&f=1", "display_name": "Dr.Topaz", "link": "https://stackoverflow.com/users/7986350/dr-topaz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1500214389, "creation_date": 1500203668, "last_edit_date": 1500207949, "question_id": 45127907, "link": "https://stackoverflow.com/questions/45127907/how-to-separate-arrays-type-structs-in-go", "title": "How to separate arrays (type structs) in Go?", "body": "<p>I just created this code to experiment with <code>type</code>, i will explain the problems later.</p>\n\n<p>My Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\ntype Games struct {\n    game    string\n    creator string\n}\n\nfunc main() {\n    videogames := []Games{\n        {\"inFamous\", \"Sucker Punch Games\"},\n        {\"Halo\", \"343 Games\"},\n        {\"JustCause\", \"Eidos\"},\n    }\n    rand.Seed(time.Now().UTC().UnixNano())\n    i := rand.Intn(len(videogames))\n    fmt.Print(videogames[i])\n}\n</code></pre>\n\n<p>If I run this the result will be,</p>\n\n<pre><code>{inFamous,Sucker Punch Games}\n</code></pre>\n\n<p>Now what i want to do is separate the arrays so that the result will be,</p>\n\n<pre><code>Game = inFamous\nPublisher = Sucker Punch Games\n</code></pre>\n\n<p>Also i need to remove the opening and closing brackets.</p>\n"}, {"tags": ["string", "go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 0, "creation_date": 1500207924, "post_id": 45127882, "comment_id": 77226726, "body": "<a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">blog.golang.org/strings</a>"}], "answers": [{"tags": [], "owner": {"reputation": 985, "user_id": 1513091, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6c747a3ab3055cba5e470d31b1a547b?s=128&d=identicon&r=PG", "display_name": "bogdanciobanu", "link": "https://stackoverflow.com/users/1513091/bogdanciobanu"}, "is_accepted": true, "score": 1, "last_activity_date": 1500205516, "last_edit_date": 1500205516, "creation_date": 1500204640, "answer_id": 45128040, "question_id": 45127882, "link": "https://stackoverflow.com/questions/45127882/access-a-string-as-a-character-array-for-using-in-strings-join-method-go-lang/45128040#45128040", "title": "Access a string as a character array for using in strings.Join() method: GO language", "body": "<p>The <a href=\"https://golang.org/pkg/strings/#Join\" rel=\"nofollow noreferrer\"><strong>strings.Join</strong></a> method expects a slice of strings as first argument, but you are giving it a rune type.</p>\n\n<p>You can use the <a href=\"https://golang.org/pkg/strings/#Split\" rel=\"nofollow noreferrer\"><strong>strings.Split</strong></a> method to obtain a slice of strings from a string. <a href=\"https://play.golang.org/p/P4Bfac30uJ\" rel=\"nofollow noreferrer\">Here is an example</a>.</p>\n"}], "owner": {"reputation": 4792, "user_id": 3957182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/43d0d6b75c03b847afbf11f7bd274ecb?s=128&d=identicon&r=PG&f=1", "display_name": "wandermonk", "link": "https://stackoverflow.com/users/3957182/wandermonk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 379, "favorite_count": 1, "accepted_answer_id": 45128040, "answer_count": 1, "score": 0, "last_activity_date": 1500205516, "creation_date": 1500203486, "last_edit_date": 1500204003, "question_id": 45127882, "link": "https://stackoverflow.com/questions/45127882/access-a-string-as-a-character-array-for-using-in-strings-join-method-go-lang", "title": "Access a string as a character array for using in strings.Join() method: GO language", "body": "<p>I am trying to access a string as a character array or as a rune and join with some separator. What is the right way to do it.</p>\n\n<p>Here are the two ways i tried but i get an error as below</p>\n\n<pre><code>cannot use ([]rune)(t)[i] (type rune) as type []string in argument to strings.Join  \n</code></pre>\n\n<p>How does a string represented in GOLANG. Is it like a character array?</p>\n\n<pre><code>    package main\n\n    import (\n        \"fmt\"\n        \"strings\"\n    )\n\n    func main() {\n        var t = \"hello\"\n        s := \"\"\n        for i, rune := range t {\n            s += strings.Join(rune, \"\\n\")\n        }\n        fmt.Println(s)\n    }\n\n\n\n    package main\n\n    import (\n        \"fmt\"\n        \"strings\"\n    )\n\n    func main() {\n        var t = \"hello\"\n        s := \"\"\n        for i := 0; i &lt; len(t); i++ {\n            s += strings.Join([]rune(t)[i], \"\\n\")\n        }\n        fmt.Println(s)\n    }\n</code></pre>\n\n<p>I also tried the below way.BUt, it does not work for me.</p>\n\n<pre><code>var t = \"hello\"\n    s := \"\"\n    for i := 0; i &lt; len(t); i++ {\n        s += strings.Join(string(t[i]), \"\\n\")\n    }\n    fmt.Println(s)\n</code></pre>\n"}, {"tags": ["unit-testing", "http", "go", "error-handling"], "answers": [{"comments": [{"owner": {"reputation": 10244, "user_id": 797194, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3728c41e604024f375043551a59b41df?s=128&d=identicon&r=PG", "display_name": "m90", "link": "https://stackoverflow.com/users/797194/m90"}, "edited": false, "score": 0, "creation_date": 1500193171, "post_id": 45126402, "comment_id": 77223032, "body": "Great answer, exactly what I was looking for. The return statement is there in my real code, but thanks for stating it anyways, I&#39;ll add it to the question to avoid confusion for others."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 29, "last_activity_date": 1562576458, "last_edit_date": 1562576458, "creation_date": 1500192518, "answer_id": 45126402, "question_id": 45126312, "link": "https://stackoverflow.com/questions/45126312/how-do-i-test-an-error-on-reading-from-a-request-body/45126402#45126402", "title": "How do I test an error on reading from a request body?", "body": "<p>You may create and use an <a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"noreferrer\"><code>http.Request</code></a> forged by you, which deliberately returns an error when reading its body. You don't necessarily need a whole new request, a faulty body is enough (which is an <a href=\"https://golang.org/pkg/io/#ReadCloser\" rel=\"noreferrer\"><code>io.ReadCloser</code></a>).</p>\n\n<p>Simplest achieved by using the <a href=\"https://golang.org/pkg/net/http/httptest/#NewRequest\" rel=\"noreferrer\"><code>httptest.NewRequest()</code></a> function where you can pass an <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"noreferrer\"><code>io.Reader</code></a> value which will be used (wrapped to be an <code>io.ReadCloser</code>) as the request body.</p>\n\n<p>Here's an example <code>io.Reader</code> which deliberately returns an error when attempting to read from it:</p>\n\n<pre><code>type errReader int\n\nfunc (errReader) Read(p []byte) (n int, err error) {\n    return 0, errors.New(\"test error\")\n}\n</code></pre>\n\n<p>Example that will cover your error case:</p>\n\n<pre><code>func HandlePostRequest(w http.ResponseWriter, r *http.Request) {\n    defer r.Body.Close()\n    body, err := ioutil.ReadAll(r.Body)\n    if err != nil {\n        fmt.Printf(\"Error reading the body: %v\\n\", err)\n        return\n    }\n    fmt.Printf(\"No error, body: %s\\n\", body)\n}\n\nfunc main() {\n    testRequest := httptest.NewRequest(http.MethodPost, \"/something\", errReader(0))\n    HandlePostRequest(nil, testRequest)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/i0Rd9Z6rnE\" rel=\"noreferrer\">Go Playground</a>): </p>\n\n<pre><code>Error reading the body: test error\n</code></pre>\n\n<p>See related question if you would need to simulate error reading from a response body (not from a request body): <a href=\"https://stackoverflow.com/questions/53171123/how-to-force-error-on-reading-response-body/53173459#53173459\">How to force error on reading response body</a></p>\n"}], "owner": {"reputation": 10244, "user_id": 797194, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3728c41e604024f375043551a59b41df?s=128&d=identicon&r=PG", "display_name": "m90", "link": "https://stackoverflow.com/users/797194/m90"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6899, "favorite_count": 2, "accepted_answer_id": 45126402, "answer_count": 1, "score": 13, "last_activity_date": 1616502205, "creation_date": 1500191623, "last_edit_date": 1542903640, "question_id": 45126312, "link": "https://stackoverflow.com/questions/45126312/how-do-i-test-an-error-on-reading-from-a-request-body", "title": "How do I test an error on reading from a request body?", "body": "<p>I'm writing unit tests for http Handlers in golang. When looking at code coverage reports of this I am running into the following issue: When reading the request body from a request, <code>ioutil.ReadAll</code> might return an error that I need to handle. Yet, when I write unit tests for my handler I do not know  how to send a request to my handler in a way that it will trigger such an error (premature end of content seems not to generate such an error but will generate an error on unmarshaling the body). This is what I am trying to do:</p>\n\n<pre><code>package demo\n\nimport (\n    \"bytes\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"net/http/httptest\"\n    \"testing\"\n)\n\nfunc HandlePostRequest(w http.ResponseWriter, r *http.Request) {\n    body, bytesErr := ioutil.ReadAll(r.Body)\n    if bytesErr != nil {\n        // intricate logic goes here, how can i test it?\n        http.Error(w, http.StatusText(http.StatusBadRequest), http.StatusBadRequest)\n        return\n    }\n    defer r.Body.Close()\n    // continue...\n}\n\nfunc TestHandlePostRequest(t *testing.T) {\n    ts := httptest.NewServer(http.HandlerFunc(HandlePostRequest))\n    data, _ := ioutil.ReadFile(\"testdata/fixture.json\")\n    res, err := http.Post(ts.URL, \"application/json\", bytes.NewReader(data))\n    // continue...\n}\n</code></pre>\n\n<p>How can I write a test case for <code>HandlePostRequest</code> that also covers the case of <code>bytesErr</code> not being <code>nil</code>?</p>\n"}, {"tags": ["go", "aerospike"], "answers": [{"comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 173, "user_id": 8215502, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/923f568594ec0b35bac4b45dbc1e3657?s=128&d=identicon&r=PG&f=1", "display_name": "user8215502", "link": "https://stackoverflow.com/users/8215502/user8215502"}, "edited": false, "score": 0, "creation_date": 1500193683, "post_id": 45126062, "comment_id": 77223160, "body": "@user8215502 During the compilation or the execution? If it is during the execution, then the original question has been resolved, and you need to read <a href=\"https://stackoverflow.com/help/accepted-answer\">stackoverflow.com/help/accepted-answer</a>"}, {"owner": {"reputation": 173, "user_id": 8215502, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/923f568594ec0b35bac4b45dbc1e3657?s=128&d=identicon&r=PG&f=1", "display_name": "user8215502", "link": "https://stackoverflow.com/users/8215502/user8215502"}, "edited": false, "score": 0, "creation_date": 1500195478, "post_id": 45126062, "comment_id": 77223603, "body": "during execution. i guess it&#39;s related to policy"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 7, "last_activity_date": 1500189857, "last_edit_date": 1500189857, "creation_date": 1500189505, "answer_id": 45126062, "question_id": 45126014, "link": "https://stackoverflow.com/questions/45126014/cannot-run-aerospike-go-example/45126062#45126062", "title": "cannot run aerospike go example", "body": "<p>You can see in the project <a href=\"https://github.com/aerospike/aerospike-client-go\" rel=\"noreferrer\"><code>aerospike/aerospike-client-go</code></a> tests like <a href=\"https://github.com/aerospike/aerospike-client-go/blob/95e1ad7791bdbca44707fedbb29be42024900d9c/example_listiter_int_test.go\" rel=\"noreferrer\"><code>example_listiter_int_test.go</code></a> which:</p>\n\n<ul>\n<li><p>import the project with:</p>\n\n<pre><code>as \"github.com/aerospike/aerospike-client-go\"\n</code></pre></li>\n<li><p>use NewClient with the right prefix:</p>\n\n<pre><code>var v as.Value = as.NewValue(myListInt([]int{1, 2, 3}))\n</code></pre></li>\n</ul>\n\n<p>So don't forget to prefix <code>NewClient</code>.</p>\n\n<p>In your case:</p>\n\n<pre><code>import (\nas \"github.com/aerospike/aerospike-client-go\"\n\"fmt\"\n)\n</code></pre>\n\n<p>And:</p>\n\n<pre><code>client, err := as.NewClient(\"127.0.0.1\", 3000)\n</code></pre>\n\n<p><code>as</code> is an alias for the package name, since, as mentioned in \"<a href=\"https://stackoverflow.com/a/26142332/6309\">Call a function from another package in Go</a>\":</p>\n\n<blockquote>\n  <p>You import the package by its import path, and reference all its exported symbols (those starting with a capital letter) through the package name,</p>\n</blockquote>\n\n<p>Since <a href=\"https://github.com/aerospike/aerospike-client-go/blob/1dc8cf203d24cd454e71ce40ab4cd0bf3112df90/client.go\" rel=\"noreferrer\"><code>NewClient</code> is in <code>client.go</code></a> of the <code>package aerospike</code>, an alternative would be:</p>\n\n<pre><code>client, err := aerospike.NewClient(\"127.0.0.1\", 3000)\n</code></pre>\n"}], "owner": {"reputation": 173, "user_id": 8215502, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/923f568594ec0b35bac4b45dbc1e3657?s=128&d=identicon&r=PG&f=1", "display_name": "user8215502", "link": "https://stackoverflow.com/users/8215502/user8215502"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1500189857, "creation_date": 1500189003, "last_edit_date": 1500189627, "question_id": 45126014, "link": "https://stackoverflow.com/questions/45126014/cannot-run-aerospike-go-example", "title": "cannot run aerospike go example", "body": "<p>I'm trying to run an aerospike go example:</p>\n\n<pre><code>package main\n\n    import (\n    \"github.com/aerospike/aerospike-client-go\"\n    \"fmt\"\n    )\n\n    func panicOnError(err error) {\n    if err != nil {\n        panic(err)\n    }\n    }\n\n     func main() {\n    // define a client to connect to\n    client, err := NewClient(\"127.0.0.1\", 3000)\n    panicOnError(err)\n\n    key, err := NewKey(\"test\", \"aerospike\", \"key\")\n    panicOnError(err)\n\n    // define some bins with data\n    bins := BinMap{\n        \"bin1\": 42,\n        \"bin2\": \"An elephant is a mouse with an operating system\",\n        \"bin3\": []interface{}{\"Go\", 2009},\n    }\n\n    // write the bins\n    err = client.Put(nil, key, bins)\n    panicOnError(err)\n\n    // read it back!\n    rec, err := client.Get(nil, key)\n    panicOnError(err)\n\n    fmt.Printf(\"%#v\\n\", *rec)\n\n    // delete the key, and check if key exists\n    existed, err := client.Delete(nil, key)\n    panicOnError(err)\n    fmt.Printf(\"Record existed before delete? %v\\n\", existed)\n}\n</code></pre>\n\n<p>But I get an error:</p>\n\n<pre><code>Unresolved reference NewClient... \nand many more...\n</code></pre>\n\n<p>I've run the command:</p>\n\n<pre><code>go get github.com/aerospike/aerospike-client-go\n</code></pre>\n\n<p>and it has downloaded the package on the disk.</p>\n\n<p>Can you help?</p>\n"}, {"tags": ["file", "go", "path", "directory", "file-exists"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1500187300, "last_edit_date": 1500187300, "creation_date": 1500186941, "answer_id": 45125797, "question_id": 45125542, "link": "https://stackoverflow.com/questions/45125542/how-to-check-file-name-with-any-extension-does-exist-in-the-directory-in-gol/45125797#45125797", "title": "How to check file `name` (with any extension) does exist in the directory in Golang?", "body": "<p>You may use the <a href=\"https://golang.org/pkg/path/filepath/#Glob\" rel=\"nofollow noreferrer\"><code>filepath.Glob()</code></a> function where you can specify a <em>pattern</em> to list files.</p>\n\n<p>The pattern to be used is basically the name you wish to check if used, extended with the <em>any extension</em> pattern.</p>\n\n<p>Example:</p>\n\n<pre><code>func filenameUsed(name string) (bool, error) {\n    matches, err := filepath.Glob(name + \".*\")\n    if err != nil {\n        return false, err\n    }\n    return len(matches) &gt; 0, nil\n}\n</code></pre>\n\n<p>Using / testing it:</p>\n\n<pre><code>fmt.Print(\"Filename foo used: \")\nfmt.Println(filenameUsed(\"uploads/foo\"))\nfmt.Print(\"Filename bar used: \")\nfmt.Println(filenameUsed(\"uploads/bar\"))\n</code></pre>\n\n<p>Example output:</p>\n\n<pre><code>Filename foo used: true &lt;nil&gt;\nFilename bar used: false &lt;nil&gt;\n</code></pre>\n\n<p>However, note that <code>filenameUsed()</code> returning <code>false</code> (and <code>nil</code> error) does not mean a file with that name won't exist if you attempt to create one after. Meaning checking it and attempting to create such a file does not guarantee atomicity. If your purpose is to create a file if the name is not used, then simply try to create the file in the proper mode (do not overwrite if exists), and handle the (creation) error returned by that call.</p>\n"}], "owner": {"reputation": 1475, "user_id": 5203951, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/fd9dc7df52e3a9be33094cd877e3f8fb?s=128&d=identicon&r=PG", "display_name": "Yami Odymel", "link": "https://stackoverflow.com/users/5203951/yami-odymel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3164, "favorite_count": 0, "accepted_answer_id": 45125797, "answer_count": 1, "score": 3, "last_activity_date": 1500187300, "creation_date": 1500184834, "question_id": 45125542, "link": "https://stackoverflow.com/questions/45125542/how-to-check-file-name-with-any-extension-does-exist-in-the-directory-in-gol", "title": "How to check file `name` (with any extension) does exist in the directory in Golang?", "body": "<p>I know I could check the file does exist or not in Golang by the answers of the following questions.</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/10510691/how-to-check-whether-a-file-or-directory-denoted-by-a-path-exists-in-golang\">How to check whether a file or directory denoted by a path exists in Golang?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/12518876/how-to-check-if-a-file-exists-in-go\">How to check if a file exists in Go?</a></li>\n<li><a href=\"https://gist.github.com/mattes/d13e273314c3b3ade33f\" rel=\"nofollow noreferrer\">Gist - Check if file or directory exists in Golang</a></li>\n</ul>\n\n<p>The code looks like this.</p>\n\n<pre><code>_, err := os.Stat(path)\nif err == nil {\n    log.Printf(\"File %s exists.\", path)\n} else if os.IsNotExist(err) {\n    log.Printf(\"File %s not exists.\", path)\n} else {\n    log.Printf(\"File %s stat error: %v\", path, err)\n}\n</code></pre>\n\n<hr>\n\n<p>But here's my real question, how do I check the <strong>filename</strong> does exist (<em>has been used</em>) in the specified directory? For example if I have a file tree like this:</p>\n\n<pre><code>--- uploads\n       |- foo.png\n       |- bar.mp4\n</code></pre>\n\n<p>I wanted to check if there's any file is using the specified name..</p>\n\n<pre><code>used := filenameUsed(\"uploads/foo\")\nfmt.Println(used) // Output: true\n\nused = filenameUsed(\"uploads/hello\")\nfmt.Println(used) // Output: false\n</code></pre>\n\n<p>How do I implement the <code>filenameUsed</code> function? </p>\n\n<p>Google gave me a <a href=\"https://golang.org/pkg/path/filepath/\" rel=\"nofollow noreferrer\"><code>path/filepath</code></a> package as the result but I have no clue about how to use it.</p>\n"}, {"tags": ["amazon-web-services", "go", "vue.js", "google-cloud-platform", "google-cloud-storage"], "answers": [{"tags": [], "owner": {"reputation": 29582, "user_id": 1427098, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Bvdm0.jpg?s=128&g=1", "display_name": "Darshan Rivka Whittle", "link": "https://stackoverflow.com/users/1427098/darshan-rivka-whittle"}, "is_accepted": true, "score": 0, "last_activity_date": 1500186619, "creation_date": 1500186619, "answer_id": 45125756, "question_id": 45125118, "link": "https://stackoverflow.com/questions/45125118/how-to-deploy-frontend-application-to-gce-properly/45125756#45125756", "title": "How to deploy frontend application to GCE properly?", "body": "<p>Firebase is the simplest way to deploy your frontend on Google's infrastructure.  It handles certificate provisioning for you, so you get HTTPS out of the box.  I'm not sure why you think Cloud Functions is the only backend you can use with it.  You can use any backend you like, including Amazon's ElasticBeanstalk.  I use both App Engine and Compute Engine backends with a Firebase frontend.</p>\n\n<p>You could also do it the \"old way\" (how it was done when App Engine was Google's only cloud offering), and deploy your frontend to App Engine; it handles static content just fine.</p>\n\n<p>There's not a single right way to do it.  Your options are vast, and choosing one service to serve your frontend content in no way limits your choice for running your backend.</p>\n"}], "owner": {"reputation": 468, "user_id": 1117026, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/1b833426c9221e4b886def0ddd170d05?s=128&d=identicon&r=PG", "display_name": "elgris", "link": "https://stackoverflow.com/users/1117026/elgris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 45125756, "answer_count": 1, "score": 0, "last_activity_date": 1500186619, "creation_date": 1500180649, "question_id": 45125118, "link": "https://stackoverflow.com/questions/45125118/how-to-deploy-frontend-application-to-gce-properly", "title": "How to deploy frontend application to GCE properly?", "body": "<p>Here's the problem: I have a web application consisting of frontend part (written in VueJS) and backend part (API service written in Go).</p>\n\n<p>What's the simplest and proper way to deploy such kind of application to GCE? The web application must be able to serve HTTPS.</p>\n\n<p>In AWS world I could deploy frontend part to S3 (which supports HTTPS) and  then deploy Go API to ElasticBeanstalk, for example. In GCE world there is Cloud Storage Standard that also supports serving static content (so I can deploy my VueJS part there), but it does not support HTTPS.</p>\n\n<p>There is also Firebase, that supports HTTPS, but the only backend part I can use with that is Google Cloud Functions which means the whole backend part must be reworked.</p>\n\n<p>Any idea what pattern I can use here to solve the problem? Or maybe I'm totally wrong and need to take a different look at it?</p>\n"}, {"tags": ["linux", "go", "filesystems", "ext4"], "answers": [{"comments": [{"owner": {"reputation": 362, "user_id": 145002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd8aef5581ecb4792aea6eb4bbb01ae3?s=128&d=identicon&r=PG", "display_name": "maths", "link": "https://stackoverflow.com/users/145002/maths"}, "edited": false, "score": 0, "creation_date": 1500185715, "post_id": 45124551, "comment_id": 77221508, "body": "Thanks for pointing out the bug in my benchmark! (not using <code>b.N</code>). I fixed that and now the times make sense.  It also makes sense to me that the problem with non-append writes is not the write itself but the extra work. My understanding is that most databases pack the maximum possible number of records into each page, so adding a new record necessitate repacking even in the absence of indexes."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 2, "last_activity_date": 1500173890, "creation_date": 1500173890, "answer_id": 45124551, "question_id": 45124213, "link": "https://stackoverflow.com/questions/45124213/understanding-linux-write-performance/45124551#45124551", "title": "Understanding Linux write performance", "body": "<p>About (1), I think the issue is related to your benchmarks not doing what the Go tools expect them to do.</p>\n\n<p>From the documentation (<a href=\"https://golang.org/pkg/testing/#hdr-Benchmarks\" rel=\"nofollow noreferrer\">https://golang.org/pkg/testing/#hdr-Benchmarks</a>):</p>\n\n<blockquote>\n  <p>The benchmark function must run the target code b.N times. During benchmark execution, b.N is adjusted until the benchmark function lasts long enough to be timed reliably.</p>\n</blockquote>\n\n<p>I don't see your code using <code>b.N</code>, so while the benchmark tool <em>thinks</em> you run the code <code>b.N</code> times, you are managing the repeats by yourself. Depending on the values the tools are actually using for <code>b.N</code>, the results will vary unexpectedly.</p>\n\n<p>You can actually do things 10, 100 and 1,000 times, but in all cases do them <code>b.N</code> times (make that <code>b.N * 10</code>, <code>b.N * 100</code>, etc) so that the reported benchmark is adjusted properly.</p>\n\n<p>About (2), when some systems rather use a sequential log to store operations to the replay them, it's not because appending to a file is faster than overwriting a single file.</p>\n\n<p>In a database system, if you need to update a specific record, you must first find what's the actual file (and position in the file) you need to update.</p>\n\n<p>That might require several index lookups, and once you update the record, you might need to update those indexes to reflect the new values.</p>\n\n<p>So the right comparison is appending to a single log vs making several reads plus then several writes.</p>\n"}], "owner": {"reputation": 362, "user_id": 145002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd8aef5581ecb4792aea6eb4bbb01ae3?s=128&d=identicon&r=PG", "display_name": "maths", "link": "https://stackoverflow.com/users/145002/maths"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 281, "favorite_count": 0, "accepted_answer_id": 45124551, "answer_count": 1, "score": 0, "last_activity_date": 1500186400, "creation_date": 1500169679, "last_edit_date": 1500186400, "question_id": 45124213, "link": "https://stackoverflow.com/questions/45124213/understanding-linux-write-performance", "title": "Understanding Linux write performance", "body": "<p>I've been doing some benchmarking to try and understand write performance on Linux, and I don't understand the results I got (I'm using ext4 on Ubuntu 17.04, though I'm more interested in understanding ext4 if anything, than I am in comparing filesystems).</p>\n\n<p>Specifically, I understand that some databases/filesystems work by keeping a stale copy of your data, and then writing updates to a modification log. Periodically, the log is replayed over the stale data to get a fresh version of the data which is then persisted. This only makes sense to me if appending to a file is faster than overwriting the whole file (otherwise why write updates to a log? Why not just overwrite the data on disk?). I was curious how much faster appending is than overwriting, so I wrote a small benchmark in go (<a href=\"https://gist.github.com/msteffen/08267045be42eb40900758c419c3bd38\" rel=\"nofollow noreferrer\">https://gist.github.com/msteffen/08267045be42eb40900758c419c3bd38</a>) and got these results:</p>\n\n<pre><code>$ go test ./write_test.go  -bench='.*'\nBenchmarkWrite/Write_10_Bytes_10_times-8                30    46189788 ns/op\nBenchmarkWrite/Write_100_Bytes_10_times-8               30    46477540 ns/op\nBenchmarkWrite/Write_1000_Bytes_10_times-8              30    46214996 ns/op\nBenchmarkWrite/Write_10_Bytes_100_times-8                3   458081572 ns/op\nBenchmarkWrite/Write_100_Bytes_100_times-8               3   678916489 ns/op\nBenchmarkWrite/Write_1000_Bytes_100_times-8              3   448888734 ns/op\nBenchmarkWrite/Write_10_Bytes_1000_times-8               1  4579554906 ns/op\nBenchmarkWrite/Write_100_Bytes_1000_times-8              1  4436367852 ns/op\nBenchmarkWrite/Write_1000_Bytes_1000_times-8             1  4515641735 ns/op\nBenchmarkAppend/Append_10_Bytes_10_times-8              30    43790244 ns/op\nBenchmarkAppend/Append_100_Bytes_10_times-8             30    44581063 ns/op\nBenchmarkAppend/Append_1000_Bytes_10_times-8            30    46399849 ns/op\nBenchmarkAppend/Append_10_Bytes_100_times-8              3   452417883 ns/op\nBenchmarkAppend/Append_100_Bytes_100_times-8             3   458258083 ns/op\nBenchmarkAppend/Append_1000_Bytes_100_times-8            3   452616573 ns/op\nBenchmarkAppend/Append_10_Bytes_1000_times-8             1  4504030390 ns/op\nBenchmarkAppend/Append_100_Bytes_1000_times-8            1  4591249445 ns/op\nBenchmarkAppend/Append_1000_Bytes_1000_times-8           1  4522205630 ns/op\nPASS\nok    command-line-arguments  52.681s\n</code></pre>\n\n<p>This left me with two questions that I couldn't think of an answer to:</p>\n\n<p><s>1) Why does time per operation go up so much when I go from 100 writes to 1000? (I know Go repeats benchmarks for me, so doing multiple writes myself is probably silly, but since I got a weird answer I'd like to understand why)</s> This was due to a bug in the Go test (which is now fixed)</p>\n\n<p>2) Why isn't appending to a file faster than writing to it? I thought the whole point of the update log was to take advantage of the comparative speed of appends? (note that the current bench calls <code>Sync()</code> after every write, but even if I don't do that appends are no faster than writes, though both are much faster overall)</p>\n\n<p>If any of the experts here could enlighten me, I would really appreciate it! Thanks!</p>\n"}, {"tags": ["go", "struct", "syntax"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 26, "last_activity_date": 1546525281, "last_edit_date": 1546525281, "creation_date": 1500156306, "answer_id": 45123114, "question_id": 45122905, "link": "https://stackoverflow.com/questions/45122905/how-do-struct-and-struct-work-in-go/45123114#45123114", "title": "How do struct{} and struct{}{} work in Go?", "body": "<p><code>struct</code> is a <a href=\"https://golang.org/ref/spec#Keywords\" rel=\"noreferrer\">keyword</a> in Go. It is used to define <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"noreferrer\">struct types</a>, which is a sequence of named elements.</p>\n\n<p>For example:</p>\n\n<pre><code>type Person struct {\n    Name string\n    Age  int\n}\n</code></pre>\n\n<p>The <code>struct{}</code> is a <code>struct</code> type with zero elements. It is often used when no information is to be stored. It has the benefit of being 0-sized, so usually no memory is required to store a value of type <code>struct{}</code>.</p>\n\n<p><code>struct{}{}</code> on the other hand is a <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"noreferrer\">composite literal</a>, it constructs a value of type <code>struct{}</code>. A composite literal constructs values for types such as structs, arrays, maps and slices. Its syntax is the type followed by the elements in braces. Since the \"empty\" struct (<code>struct{}</code>) has no fields, the elements list is also empty:</p>\n\n<pre><code> struct{}  {}\n|  ^     | ^\n  type     empty element list\n</code></pre>\n\n<p>As an example let's create a \"set\" in Go. Go does not have a builtin set data structure, but it has a builtin map. We can use a map as a set, as a map can only have at most one entry with a given key. And since we want to only store keys (elements) in the map, we may choose the map value type to be <code>struct{}</code>.</p>\n\n<p>A map with <code>string</code> elements:</p>\n\n<pre><code>var set map[string]struct{}\n// Initialize the set\nset = make(map[string]struct{})\n\n// Add some values to the set:\nset[\"red\"] = struct{}{}\nset[\"blue\"] = struct{}{}\n\n// Check if a value is in the map:\n_, ok := set[\"red\"]\nfmt.Println(\"Is red in the map?\", ok)\n_, ok = set[\"green\"]\nfmt.Println(\"Is green in the map?\", ok)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/zvQU9E6m6J\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Is red in the map? true\nIs green in the map? false\n</code></pre>\n\n<p>Note that however it may be more convenient to use <code>bool</code> as the value type when creating a set out of a map, as the syntax to check if an element is in it is simpler. For details, see <a href=\"https://stackoverflow.com/questions/33207197/how-can-i-create-an-array-that-contains-unique-strings/33207265#33207265\">How can I create an array that contains unique strings?</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 304, "user_id": 1939960, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/qDjNo.jpg?s=128&g=1", "display_name": "InfinityCounter", "link": "https://stackoverflow.com/users/1939960/infinitycounter"}, "is_accepted": false, "score": 6, "last_activity_date": 1500157142, "creation_date": 1500157142, "answer_id": 45123208, "question_id": 45122905, "link": "https://stackoverflow.com/questions/45122905/how-do-struct-and-struct-work-in-go/45123208#45123208", "title": "How do struct{} and struct{}{} work in Go?", "body": "<p>As pointed out by izca:</p>\n\n<p>Struct is a go keyword for defining struct types which are just user defined types composed of variables of whatever arbitrary type you decide.</p>\n\n<pre><code>type Person struct {\n    Name string\n    Age  int\n}\n</code></pre>\n\n<p>Structs can also be empty with Zero elements.\nHowever Struct{}{} has a different meaning. This is a composite struct literal. It inline defines a struct type and defines an struct and assigns no property.</p>\n\n<pre><code>emptyStruct := Struct{} // This is an illegal operation\n// you define an inline struct literal with no types\n// the same is true for the following\n\ncar := struct{\n          Speed  int\n          Weight float\n       }\n// you define a struct be do now create an instance and assign it to car\n// the following however is completely valid\n\ncar2 := struct{\n          Speed  int\n          Weight float\n       }{6, 7.1}\n\n//car2 now has a Speed of 6 and Weight of 7.1\n</code></pre>\n\n<p>This line here just creates a map of empty struct literals which is perfectly legal.</p>\n\n<pre><code>make(map[type]struct{})\n</code></pre>\n\n<p>It is the same as </p>\n\n<pre><code>make(map[type]struct{\n        x int\n        y int\n     })\n</code></pre>\n"}], "owner": {"reputation": 439, "user_id": 6438341, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/1181377385240542/picture?type=large", "display_name": "Qi Zhang", "link": "https://stackoverflow.com/users/6438341/qi-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5779, "favorite_count": 6, "accepted_answer_id": 45123114, "answer_count": 2, "score": 16, "last_activity_date": 1546525281, "creation_date": 1500154183, "last_edit_date": 1500160627, "question_id": 45122905, "link": "https://stackoverflow.com/questions/45122905/how-do-struct-and-struct-work-in-go", "title": "How do struct{} and struct{}{} work in Go?", "body": "<p>I am wondering what does \"struct{}\" and \"struct{}{}\" mean in Go? An example is as follows:</p>\n\n<pre><code>array[index] = struct{}{}\n</code></pre>\n\n<p>or</p>\n\n<pre><code>make(map[type]struct{})\n</code></pre>\n"}, {"tags": ["go", "gzip"], "comments": [{"owner": {"reputation": 28120, "user_id": 492773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4c30dea4ed3e1c2efc5e877f1f3c971?s=128&d=identicon&r=PG", "display_name": "kichik", "link": "https://stackoverflow.com/users/492773/kichik"}, "edited": false, "score": 1, "creation_date": 1500151418, "post_id": 45122513, "comment_id": 77216030, "body": "Maybe it&#39;s complaining because you never actually read the data returned from <code>compress()</code>?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1500200560, "post_id": 45122513, "comment_id": 77224767, "body": "Your <code>compress</code> call would be better replaced by <code>gzip.NewWriter(data)</code>. Everything in your <code>compress</code> function is redundant."}], "answers": [{"comments": [{"owner": {"reputation": 4254, "user_id": 1351597, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6e2b94150c4f96fe11dae1494a054f7b?s=128&d=identicon&r=PG", "display_name": "Dekker1", "link": "https://stackoverflow.com/users/1351597/dekker1"}, "edited": false, "score": 2, "creation_date": 1500151800, "post_id": 45122607, "comment_id": 77216131, "body": "The use of <code>io.Pipe</code> is a odd one to begin with. Maybe you should write to an <code>bytes.Buffer</code> instead."}], "tags": [], "owner": {"reputation": 7911, "user_id": 2788297, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/549bf8eda231e57a7ccbaf226e44bb02?s=128&d=identicon&r=PG&f=1", "display_name": "zeppelin", "link": "https://stackoverflow.com/users/2788297/zeppelin"}, "is_accepted": true, "score": 3, "last_activity_date": 1500151720, "creation_date": 1500151720, "answer_id": 45122607, "question_id": 45122513, "link": "https://stackoverflow.com/questions/45122513/compressing-data-from-a-reader-in-go/45122607#45122607", "title": "Compressing data from a reader in Go", "body": "<p>You write to <code>io.Pipe</code> but you never read from it (in a parallel go routine), hence the deadlock. Here is what the docs say:</p>\n\n<blockquote>\n  <p>Reads and Writes on the pipe are matched one to one except when multiple Reads are needed to consume a single Write. That is, <strong>each Write to the PipeWriter blocks until it has satisfied one or more Reads from the PipeReader</strong> that fully consume the written data. The data is copied directly from the Write to the corresponding Read (or Reads); there is no internal buffering.</p>\n</blockquote>\n\n<p><a href=\"https://golang.org/pkg/io/#Pipe\" rel=\"nofollow noreferrer\">https://golang.org/pkg/io/#Pipe</a></p>\n"}], "owner": {"reputation": 628, "user_id": 2100717, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/373465e9b480009f58e4bb187e3abd2a?s=128&d=identicon&r=PG&f=1", "display_name": "Bob Shannon", "link": "https://stackoverflow.com/users/2100717/bob-shannon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 550, "favorite_count": 0, "accepted_answer_id": 45122607, "answer_count": 1, "score": 1, "last_activity_date": 1500151720, "creation_date": 1500150923, "last_edit_date": 1500151229, "question_id": 45122513, "link": "https://stackoverflow.com/questions/45122513/compressing-data-from-a-reader-in-go", "title": "Compressing data from a reader in Go", "body": "<p>I have the following short program written in Go, which attempts to transparently compress the data in a reader (<a href=\"https://play.golang.org/p/SnvYT6it5r\" rel=\"nofollow noreferrer\">https://play.golang.org/p/SnvYT6it5r</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"bytes\"\n    \"compress/gzip\"\n)\n\nfunc main() {\n    data := bytes.NewReader([]byte(\"hello world\"))\n    compress(data)\n}\n\nfunc compress(data io.Reader) (io.Reader, error) {\n    pr, pw := io.Pipe()\n    gw := gzip.NewWriter(pw)\n\n    n, err := io.Copy(gw, data)\n\n    if err != nil {\n        fmt.Printf(\"error: %s\", err.Error())\n    } else {\n        fmt.Printf(\"%d bytes compressed\", n)\n    }\n    return pr, err\n}\n</code></pre>\n\n<p>When I run it, the program hangs:</p>\n\n<pre><code>fatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [semacquire]:\nsync.runtime_notifyListWait(0x1043e6cc, 0x0)\n    /usr/local/go/src/runtime/sema.go:297 +0x140\nsync.(*Cond).Wait(0x1043e6c4, 0x137118)\n    /usr/local/go/src/sync/cond.go:57 +0xc0\nio.(*pipe).write(0x1043e680, 0x1045a055, 0xa, 0xa, 0x0, 0x0, 0x0, 0x101)\n    /usr/local/go/src/io/pipe.go:90 +0x1a0\nio.(*PipeWriter).Write(0x1040c180, 0x1045a055, 0xa, 0xa, 0xe205ef63, 0x34c, 0x0, 0x0)\n    /usr/local/go/src/io/pipe.go:157 +0x40\ncompress/gzip.(*Writer).Write(0x1045a000, 0x1040a130, 0xb, 0x10, 0x2c380, 0x7654, 0x1059e0, 0x111480)\n    /usr/local/go/src/compress/gzip/gzip.go:168 +0x2e0\nbytes.(*Reader).WriteTo(0x10440240, 0x190610, 0x1045a000, 0x0, 0xfef64000, 0x10440240, 0x1045a001, 0x190670)\n    /usr/local/go/src/bytes/reader.go:134 +0xe0\nio.copyBuffer(0x190610, 0x1045a000, 0x1905d0, 0x10440240, 0x0, 0x0, 0x0, 0x106620, 0x1045a000, 0x0, ...)\n    /usr/local/go/src/io/io.go:380 +0x360\nio.Copy(0x190610, 0x1045a000, 0x1905d0, 0x10440240, 0x10440240, 0x0, 0x1a47c0, 0x0)\n    /usr/local/go/src/io/io.go:360 +0x60\nmain.compress(0x1905d0, 0x10440240, 0x10440240, 0x1040c170, 0x1040a130, 0xb)\n    /tmp/sandbox403912545/main.go:19 +0x180\nmain.main()\n    /tmp/sandbox403912545/main.go:12 +0xe0\n</code></pre>\n\n<p>What is causing the deadlock, and what is the most efficient way to compress data from a reader?</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1500156319, "post_id": 45123050, "comment_id": 77217029, "body": "Yes, but what confuses me about that part of the documentation is that it makes reference to if a pointer were passed. However, it does not explain the necessity of using a pointer to the map. Regarding your explanation, wouldn&#39;t the following lines in the documentation cover the case you&#39;re talking about? &quot;The JSON null value unmarshals into an interface, map, pointer, or slice by setting that Go value to nil. Because null is often used in JSON to mean \u201cnot present,\u201d unmarshaling a JSON null into any other Go type has no effect on the value and produces no error.&quot;"}, {"owner": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1500156417, "post_id": 45123050, "comment_id": 77217053, "body": "Wouldn&#39;t that seem to indicate that a pointer isn&#39;t required? Specifically the language &quot;slice, map, OR pointer&quot; Sorry, I might be missing something."}, {"owner": {"reputation": 29582, "user_id": 1427098, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Bvdm0.jpg?s=128&g=1", "display_name": "Darshan Rivka Whittle", "link": "https://stackoverflow.com/users/1427098/darshan-rivka-whittle"}, "reply_to_user": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1500160793, "post_id": 45123050, "comment_id": 77217914, "body": "That&#39;s referring to the thing pointed at by whatever pointer you pass in as <code>v</code>.  The very first line of the Unmarshal documentation is &quot;Unmarshal parses the JSON-encoded data and stores the result in the value pointed to by v.&quot;  <code>v</code> has to be a pointer, and the source makes that very clear as well (<a href=\"https://golang.org/src/encoding/json/decode.go#L177\" rel=\"nofollow noreferrer\">golang.org/src/encoding/json/decode.go#L177</a>).  You can pass in a pointer to an interface, a pointer to a map, a pointer to a pointer (as I did in my code here), etc."}, {"owner": {"reputation": 29582, "user_id": 1427098, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Bvdm0.jpg?s=128&g=1", "display_name": "Darshan Rivka Whittle", "link": "https://stackoverflow.com/users/1427098/darshan-rivka-whittle"}, "reply_to_user": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 1, "creation_date": 1500161112, "post_id": 45123050, "comment_id": 77217967, "body": "You&#39;re of course right that one could create an Unmarshal function that mutates a map, but this is more consistent, and it allows things like setting map pointers to <code>nil</code>, and unmarshalling into things like ints (<code>var n int; data = &quot;1&quot;; json.Unmarshal([]byte(data), &amp;n)</code>). By having <code>v</code> always be a pointer, possibly to another pointer, possible to a reference type like a map, possibly to a non-reference type like an int, things are consistent."}, {"owner": {"reputation": 29582, "user_id": 1427098, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Bvdm0.jpg?s=128&g=1", "display_name": "Darshan Rivka Whittle", "link": "https://stackoverflow.com/users/1427098/darshan-rivka-whittle"}, "reply_to_user": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 1, "creation_date": 1500161132, "post_id": 45123050, "comment_id": 77217972, "body": "In any case, this is how they chose to do it, and I personally find the documentation clear enough.  But perhaps a sentence of clarification would be a useful addition."}, {"owner": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1500170472, "post_id": 45123050, "comment_id": 77219162, "body": "Awesome. I do like the note about consistency. Thank you!"}], "tags": [], "owner": {"reputation": 29582, "user_id": 1427098, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Bvdm0.jpg?s=128&g=1", "display_name": "Darshan Rivka Whittle", "link": "https://stackoverflow.com/users/1427098/darshan-rivka-whittle"}, "is_accepted": false, "score": 1, "last_activity_date": 1500155596, "creation_date": 1500155596, "answer_id": 45123050, "question_id": 45122496, "link": "https://stackoverflow.com/questions/45122496/why-does-json-unmarshal-need-a-pointer-to-a-map-if-a-map-is-a-reference-type/45123050#45123050", "title": "Why does json.Unmarshal need a pointer to a map, if a map is a reference type?", "body": "<p>The other key part of the documentation is this:</p>\n\n<blockquote>\n  <p>To unmarshal JSON into a pointer, Unmarshal first handles the case of\n  the JSON being the JSON literal null. In that case, Unmarshal sets the\n  pointer to nil. Otherwise, Unmarshal unmarshals the JSON into the\n  value pointed at by the pointer. If the pointer is nil, Unmarshal\n  allocates a new value for it to point to.</p>\n</blockquote>\n\n<p>If Unmarshall accepted a map, it would have to leave the map in the same state whether the JSON were <code>null</code> or <code>{}</code>.  But by using pointers, there's now a difference between the pointer being set to <code>nil</code> and it pointing to an empty map.</p>\n\n<p>Note that in order for Unmarshall to be able to \"set the pointer to nil\", you actually need to pass in a pointer to your map pointer:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\nfunc main() {\n    var m *map[string]string\n    data := `{}`\n    err := json.Unmarshal([]byte(data), &amp;m)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(m)\n\n    data = `null`\n    err = json.Unmarshal([]byte(data), &amp;m)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(m)\n\n    data = `{\"foo\": \"bar\"}`\n    err = json.Unmarshal([]byte(data), &amp;m)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(m)\n}\n</code></pre>\n\n<p>This outputs:</p>\n\n<pre><code>&amp;map[]\n&lt;nil&gt;\n&amp;map[foo:bar]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 3, "creation_date": 1500170458, "post_id": 45123370, "comment_id": 77219160, "body": "I really like this answer. Thank you!"}], "tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 17, "last_activity_date": 1500166701, "last_edit_date": 1500166701, "creation_date": 1500158450, "answer_id": 45123370, "question_id": 45122496, "link": "https://stackoverflow.com/questions/45122496/why-does-json-unmarshal-need-a-pointer-to-a-map-if-a-map-is-a-reference-type/45123370#45123370", "title": "Why does json.Unmarshal need a pointer to a map, if a map is a reference type?", "body": "<p>As stated in the documentation:</p>\n\n<blockquote>\n  <p>Unmarshal uses the inverse of the encodings that Marshal uses, allocating maps, slices, and pointers as necessary, with ... </p>\n</blockquote>\n\n<p><code>Unmarshal</code> may allocates the variable(map, slice, etc.). If we pass a <code>map</code> instead of <em>pointer</em> to a <code>map</code>, then the newly allocated <code>map</code> won't be visible to the caller. The following examples (<a href=\"https://play.golang.org/p/LHBEFiK_Hj\" rel=\"noreferrer\">Go Playground</a>) demonstrates this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc mapFunc(m map[string]interface{}) {\n    m = make(map[string]interface{})\n    m[\"abc\"] = \"123\"\n}\n\nfunc mapPtrFunc(mp *map[string]interface{}) {\n    m := make(map[string]interface{})\n    m[\"abc\"] = \"123\"\n\n    *mp = m\n}\n\nfunc main() {\n    var m1, m2 map[string]interface{}\n    mapFunc(m1)\n    mapPtrFunc(&amp;m2)\n\n    fmt.Printf(\"%+v, %+v\\n\", m1, m2)\n}\n</code></pre>\n\n<p>in which the output is:</p>\n\n<pre><code>map[], map[abc:123]\n</code></pre>\n\n<p>If the requirement says that a function/method may allocate a variable when necessary and the newly allocated variable need to be visible to the caller, the solution will be: (a) the variable must be in function's <em>return</em> statement <strong>or</strong> (b) the variable can be assigned to the function/method argument. Since in <code>go</code> <em>everything</em> is pass by value, in case of (b), the argument must be a <em>pointer</em>. The following diagram illustrates what happen in the above example:</p>\n\n<p><a href=\"https://i.stack.imgur.com/J3WUp.jpg\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/J3WUp.jpg\" alt=\"Illustration of variable allocation\"></a>   </p>\n\n<ol>\n<li>At first, both map <code>m1</code> and <code>m2</code> point to <code>nil</code>.</li>\n<li>Calling <code>mapFunc</code> will copy the value pointed by <code>m1</code> to <code>m</code> resulting <code>m</code> will also point to <code>nil</code> map.</li>\n<li>If in (1) the map already allocated, then in (2) the address of <em>underlying map data structure</em> pointed by <code>m1</code> (<em>not the address of <code>m1</code></em>) will be copied to <code>m</code>. In this case both <code>m1</code> and <code>m</code> point to the same <em>map data structure</em>, thus modifying map items through <code>m1</code> will also be <em>visible</em> to <code>m</code>. </li>\n<li>In the <code>mapFunc</code> function, new map is allocated and assigned to <code>m</code>. There is no way to assign it to <code>m1</code>. </li>\n</ol>\n\n<p>In case of pointer:</p>\n\n<ol>\n<li>When calling <code>mapPtrFunc</code>, the address of <code>m2</code> will be copied to <code>mp</code>.  </li>\n<li>In the <code>mapPtrFunc</code>, new map is allocated and assigned to <code>*mp</code> (not <code>mp</code>). Since <code>mp</code> is pointer to <code>m2</code>, assigning the new map to <code>*mp</code> will change the value pointed by <code>m2</code>. Note that the value of <code>mp</code> is unchanged, i.e. the address of <code>m2</code>.  </li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1500171579, "post_id": 45124288, "comment_id": 77219296, "body": "Could you please clarify the concept of being unaddressable here? I wrote a test to look at the concept of addressability of copies of maps, and I seem to be able to get the address of it just fine. <a href=\"https://play.golang.org/p/leUodSrTxG\" rel=\"nofollow noreferrer\">play.golang.org/p/leUodSrTxG</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "reply_to_user": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1500176439, "post_id": 45124288, "comment_id": 77219986, "body": "@ollien You&#39;re creating a pointer to <code>a</code> in that function, which means the compiler makes <code>a</code> addressable. By default, any function parameters are unaddressable, including method receivers. If you create a pointer to an existing object, the pointer itself is unaddressable, but the object it points to is addressable because it has an address. See a modified version of your example that uses reflection at <a href=\"https://play.golang.org/p/CR_3WSkm_V\" rel=\"nofollow noreferrer\">play.golang.org/p/CR_3WSkm_V</a> . The <a href=\"https://golang.org/pkg/reflect/#Value.CanAddr\" rel=\"nofollow noreferrer\"><code>CanAddr</code> method of <code>reflect.Value</code></a> returns whether a value is addressable or not."}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "reply_to_user": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1500177302, "post_id": 45124288, "comment_id": 77220097, "body": "Note that <code>reflect.ValueOf(foo)</code> results in the <code>CanAddr</code> method of the returned <code>reflect.Value</code> return <code>false</code>. Again, <code>foo</code> was passed to <code>reflect.ValueOf</code> by value. <code>reflect.ValueOf(&amp;foo)</code> will result in <code>&amp;foo</code> being unaddressable still, but <code>foo</code> (<code>reflect.Indirect(rv)</code> or <code>rv.Elem()</code>) is now addressable."}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "reply_to_user": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1500177380, "post_id": 45124288, "comment_id": 77220106, "body": "I highly recommend reading <a href=\"https://blog.golang.org/laws-of-reflection\" rel=\"nofollow noreferrer\">The Laws of Reflection</a> to aid you in your understanding of how reflection works."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "is_accepted": false, "score": 1, "last_activity_date": 1500170633, "creation_date": 1500170633, "answer_id": 45124288, "question_id": 45122496, "link": "https://stackoverflow.com/questions/45122496/why-does-json-unmarshal-need-a-pointer-to-a-map-if-a-map-is-a-reference-type/45124288#45124288", "title": "Why does json.Unmarshal need a pointer to a map, if a map is a reference type?", "body": "<p>Your viewpoint is no different than saying \"a slice is nothing but a pointer\". Slices (and maps) use pointers to make them lightweight, yes, but there are still more things that make them work. A slice contains info about its length and capacity for example.</p>\n\n<p>As for why this happens, from a code perspective, the last line of <code>json.Unmarshal</code> calls <code>d.unmarshal()</code>, which executes the code in <a href=\"https://golang.org/src/encoding/json/decode.go?s=6444:6569#L176\" rel=\"nofollow noreferrer\">lines 176-179 of decode.go</a>. It basically says \"if the value isn't a pointer, or is <code>nil</code>, return an <code>InvalidUnmarshalError</code>.\"</p>\n\n<p>The docs could probably be clearer about things, but consider a couple of things:</p>\n\n<ol>\n<li>How would the JSON <code>null</code> value be assigned to the map as <code>nil</code> if you don't pass a pointer to the map? If you require the ability to modify the map itself (rather than the items in the map), then it makes sense to pass a pointer to the item that needs modified. In this case, it's the map.</li>\n<li>Alternately, suppose you passed a <code>nil</code> map to <code>json.Unmarshal</code>. Values will be unmarshaled as necessary after the code <code>json.Unmarshal</code> uses eventually calls the equivalent of <code>make(map[string]string)</code>. However, you still have a <code>nil</code> map in your function because your map pointed to nothing. There's no way to fix this other than to pass a pointer to the map.</li>\n</ol>\n\n<p>However, let's say there was no need to pass the address of your map because \"it's already a pointer\", and you've already initialized the map, so it's not <code>nil</code>. What happens then? Well, if I bypass the test in the lines I linked earlier by changing line 176 to read <code>if rv.Kind() != reflect.Map &amp;&amp; rv.Kind() != reflect.Ptr || rv.IsNil() {</code>, then this can happen:</p>\n\n<pre><code>`{\"foo\":\"bar\"}`: false map[foo:bar]\n`{}`: false map[]\n`null`: panic: reflect: reflect.Value.Set using unaddressable value [recovered]\n    panic: interface conversion: string is not error: missing method Error\n\ngoroutine 1 [running]:\njson.(*decodeState).unmarshal.func1(0xc420039e70)\n    /home/kit/jstest/src/json/decode.go:172 +0x99\npanic(0x4b0a00, 0xc42000e410)\n    /usr/lib/go/src/runtime/panic.go:489 +0x2cf\nreflect.flag.mustBeAssignable(0x15)\n    /usr/lib/go/src/reflect/value.go:228 +0xf9\nreflect.Value.Set(0x4b8b00, 0xc420012300, 0x15, 0x4b8b00, 0x0, 0x15)\n    /usr/lib/go/src/reflect/value.go:1345 +0x2f\njson.(*decodeState).literalStore(0xc420084360, 0xc42000e3f8, 0x4, 0x8, 0x4b8b00, 0xc420012300, 0x15, 0xc420000100)\n    /home/kit/jstest/src/json/decode.go:883 +0x2797\njson.(*decodeState).literal(0xc420084360, 0x4b8b00, 0xc420012300, 0x15)\n    /home/kit/jstest/src/json/decode.go:799 +0xdf\njson.(*decodeState).value(0xc420084360, 0x4b8b00, 0xc420012300, 0x15)\n    /home/kit/jstest/src/json/decode.go:405 +0x32e\njson.(*decodeState).unmarshal(0xc420084360, 0x4b8b00, 0xc420012300, 0x0, 0x0)\n    /home/kit/jstest/src/json/decode.go:184 +0x224\njson.Unmarshal(0xc42000e3f8, 0x4, 0x8, 0x4b8b00, 0xc420012300, 0x8, 0x0)\n    /home/kit/jstest/src/json/decode.go:104 +0x148\nmain.main()\n    /home/kit/jstest/src/jstest/main.go:16 +0x1af\n</code></pre>\n\n<p>Code leading to that output:</p>\n\n<pre><code>package main\n\n// Note \"json\" is the local copy of the \"encoding/json\" source that I modified.\nimport (\n    \"fmt\"\n    \"json\"\n)\n\nfunc main() {\n    for _, data := range []string{\n        `{\"foo\":\"bar\"}`,\n        `{}`,\n        `null`,\n    } {\n        m := make(map[string]string)\n        fmt.Printf(\"%#q: \", data)\n        if err := json.Unmarshal([]byte(data), m); err != nil {\n            fmt.Println(err)\n        } else {\n            fmt.Println(m == nil, m)\n        }\n    }\n}\n</code></pre>\n\n<p>The key is this bit here:</p>\n\n<pre><code>reflect.Value.Set using unaddressable value\n</code></pre>\n\n<p>Because you passed a copy of the map, it's unaddressable (i.e. it has a temporary address or even no address from the low-level machine perspective). I know of one way around this (<code>x := new(Type)</code> followed by <code>*x = value</code>, except using the <code>reflect</code> package), but it doesn't actually solve the problem; you're creating a local pointer that can't be returned to the caller and using it instead of your original storage location!</p>\n\n<p>So now try a pointer:</p>\n\n<pre><code>        if err := json.Unmarshal([]byte(data), m); err != nil {\n            fmt.Println(err)\n        } else {\n            fmt.Println(m == nil, m)\n        }\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>`{\"foo\":\"bar\"}`: false map[foo:bar]\n`{}`: false map[]\n`null`: true map[]\n</code></pre>\n\n<p>Now it works. Bottom line: use pointers if the object itself may be modified (and the docs say it might be, e.g. if <code>null</code> is used where an object or array (map or slice) is expected.</p>\n"}], "owner": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11279, "favorite_count": 8, "accepted_answer_id": 45123370, "answer_count": 3, "score": 7, "last_activity_date": 1500170633, "creation_date": 1500150788, "question_id": 45122496, "link": "https://stackoverflow.com/questions/45122496/why-does-json-unmarshal-need-a-pointer-to-a-map-if-a-map-is-a-reference-type", "title": "Why does json.Unmarshal need a pointer to a map, if a map is a reference type?", "body": "<p>I was working with <code>json.Unmarshal</code> and came across the following quirk. When running the below code, I get the error <code>json: Unmarshal(non-pointer map[string]string)</code></p>\n\n<pre><code>func main() {\n    m := make(map[string]string)\n    data := `{\"foo\": \"bar\"}`\n    err := json.Unmarshal([]byte(data), m)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(m)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/IbHCz8i1r1\" rel=\"noreferrer\">Playground</a></p>\n\n<p>Looking at the <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"noreferrer\">documentation</a> for <code>json.Unmarshal</code>, there is seemingly no indication that a pointer is required. The closest I can find is the following line</p>\n\n<blockquote>\n  <p>Unmarshal parses the JSON-encoded data and stores the result in the value pointed to by v.</p>\n</blockquote>\n\n<p>The lines regarding the protocol Unmarshal follows for maps are similarly unclear, as it makes no reference to pointers.</p>\n\n<blockquote>\n  <p>To unmarshal a JSON object into a map, Unmarshal first establishes a map to use. If the map is nil, Unmarshal allocates a new map. Otherwise Unmarshal reuses the existing map, keeping existing entries. Unmarshal then stores key-value pairs from the JSON object into the map. The map's key type must either be a string, an integer, or implement encoding.TextUnmarshaler.</p>\n</blockquote>\n\n<p>Why must I pass a pointer to json.Unmarshal, especially if maps are already reference types? I know that if I pass a map to a function, and add data to the map, the underlying data of the map will be changed (see <a href=\"https://play.golang.org/p/O4th9aUvZT\" rel=\"noreferrer\">the following playground example</a>), which means that it shouldn't matter if I pass a pointer to a map. Can someone clear this up?</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 1868948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d3bc822394003443f5b0c7de220d5f9?s=128&d=identicon&r=PG", "display_name": "Danilo", "link": "https://stackoverflow.com/users/1868948/danilo"}, "edited": false, "score": 0, "creation_date": 1500205099, "post_id": 45124074, "comment_id": 77225898, "body": "That actually has the expected outcome but I would have expected that I can have it assembled already like in other ORMs.  otherwise I would have to iterate over Profiles to get the other relations right?"}], "tags": [], "owner": {"reputation": 133, "user_id": 4807063, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9851d6b1619d4321f9237a4cfd1c4a2?s=128&d=identicon&r=PG&f=1", "display_name": "Evan Grayson", "link": "https://stackoverflow.com/users/4807063/evan-grayson"}, "is_accepted": false, "score": 0, "last_activity_date": 1500167465, "creation_date": 1500167465, "answer_id": 45124074, "question_id": 45122077, "link": "https://stackoverflow.com/questions/45122077/select-all-dependencies/45124074#45124074", "title": "Select all dependencies", "body": "<p>Can you add your code for when you call the related function? <a href=\"http://jinzhu.me/gorm/associations.html#has-many\" rel=\"nofollow noreferrer\">http://jinzhu.me/gorm/associations.html#has-many</a> What Im seeing on the documentation for has-many it should look like this.</p>\n\n<pre><code>var acc Account\ndb.Find(&amp;acc, \"custom_id = ?\", myCustomID)\ndb.Model(&amp;acc).Related(&amp;profiles)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6073, "user_id": 66688, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/fdd25d4dedcbe0fc7abaf91052f78ac0?s=128&d=identicon&r=PG", "display_name": "Zahymaka", "link": "https://stackoverflow.com/users/66688/zahymaka"}, "is_accepted": false, "score": 1, "last_activity_date": 1500303192, "creation_date": 1500303192, "answer_id": 45147406, "question_id": 45122077, "link": "https://stackoverflow.com/questions/45122077/select-all-dependencies/45147406#45147406", "title": "Select all dependencies", "body": "<p>I believe you can use the <a href=\"http://jinzhu.me/gorm/crud.html#preloading-eager-loading\" rel=\"nofollow noreferrer\">Preload</a> method which supports ne, i.e.:</p>\n\n<pre><code>account := new(Account)\ndb.Preload(\"Profiles.TheDoo\").Preload(\"Profiles.TheFoo\").Find(account, \"custom_id = ?\", myCustomID)\n</code></pre>\n\n<p>I haven't checked yet if you actually need to preload <code>Profiles</code> as well, but it wouldn't hurt to use it if it turns out you do.</p>\n"}], "owner": {"reputation": 45, "user_id": 1868948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d3bc822394003443f5b0c7de220d5f9?s=128&d=identicon&r=PG", "display_name": "Danilo", "link": "https://stackoverflow.com/users/1868948/danilo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 324, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1527757206, "creation_date": 1500147383, "last_edit_date": 1527757206, "question_id": 45122077, "link": "https://stackoverflow.com/questions/45122077/select-all-dependencies", "title": "Select all dependencies", "body": "<p>Imagine the following model:</p>\n\n<pre><code>type (\n\n    Account struct {\n        gorm.Model\n\n        CustomID string `gorm:\"index;unique\"`\n        Name string\n        Profiles []*Profiles `gorm:\"ForeignKey:AccountID\"`\n    }\n\n    Profile struct {\n        gorm.Model\n\n        AccountID uint `gorm:\"index\"`\n        TheFoo *Foo\n        TheDoo *Doo\n    }\n\n    Foo struct {\n        ProfileID uint `gorm:\"index\"`\n        Boo string\n    }\n\n    Doo struct {\n        ProfileID uint `gorm:\"index\"`\n        Moo string\n    }\n)\n</code></pre>\n\n<p>All my attempts of getting the entire structure always fails. acc is always filled with only the account data and no profiles.</p>\n\n<p>I even expereimented with this <code>db.Model(&amp;acc).Related(&amp;Profile{})</code> stuff but still no success. The (lets say, pretty bad) docs also do not clarify this.</p>\n\n<pre><code>var acc Account\ndb.Find(&amp;acc, \"custom_id = ?\", myCustomID) \n</code></pre>\n\n<p>how would you actually do this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1500147168, "post_id": 45121787, "comment_id": 77214894, "body": "Welcome to stackoverflow. Please follow these guides <a href=\"https://stackoverflow.com/help/mcve\">stackoverflow.com/help/mcve</a> and <a href=\"https://stackoverflow.com/help/how-to-ask\">stackoverflow.com/help/how-to-ask</a> in order to receive help"}], "answers": [{"tags": [], "owner": {"reputation": 4897, "user_id": 1188357, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cKQ6S.png?s=128&g=1", "display_name": "Kiril", "link": "https://stackoverflow.com/users/1188357/kiril"}, "is_accepted": false, "score": 1, "last_activity_date": 1500294929, "creation_date": 1500294929, "answer_id": 45144464, "question_id": 45121787, "link": "https://stackoverflow.com/questions/45121787/how-to-read-data-from-serial-and-process-it-when-a-specific-delimiter-is-found/45144464#45144464", "title": "How to read data from serial and process it when a specific delimiter is found", "body": "<p>For reading data from a serial port you can find a few packages on Github, e.g. <a href=\"https://github.com/tarm/serial\" rel=\"nofollow noreferrer\">tarm/serial</a>.</p>\n\n<p>You can use this package to read data from your serial port. In order to read until a specific delimiter is reached, you can use something like:</p>\n\n<pre><code>config := &amp;serial.Config{Name: \"/dev/ttyUSB\", Baud: 9600}\n\ns, err := serial.OpenPort(config)\nif err != nil {\n    // stops execution\n    log.Fatal(err)\n}\n\n// golang reader interface\nr := bufio.NewReader(s)\n\n// reads until delimiter is reached\ndata, err := r.ReadBytes('\\x21')\nif err != nil {\n    // stops execution\n    log.Fatal(err)\n}\n// or use fmt.Printf() with the right verb\n// https://golang.org/pkg/fmt/#hdr-Printing\nfmt.Println(data)\n</code></pre>\n\n<p>See also: <a href=\"https://stackoverflow.com/questions/17599232/reading-from-serial-port-with-while-loop\">Reading from serial port with while-loop</a></p>\n"}, {"tags": [], "owner": {"reputation": 11257, "user_id": 10197418, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/be8Y6.jpg?s=128&g=1", "display_name": "MrFuppes", "link": "https://stackoverflow.com/users/10197418/mrfuppes"}, "is_accepted": false, "score": 1, "last_activity_date": 1614343326, "last_edit_date": 1614343326, "creation_date": 1563196135, "answer_id": 57040445, "question_id": 45121787, "link": "https://stackoverflow.com/questions/45121787/how-to-read-data-from-serial-and-process-it-when-a-specific-delimiter-is-found/57040445#57040445", "title": "How to read data from serial and process it when a specific delimiter is found", "body": "<p><code>bufio</code>'s reader unfortunately did not work for me - it kept crashing after a while. This was a no-go since I needed a stable solution for a low-performance system.</p>\n<p>My solution was to implement <a href=\"https://stackoverflow.com/questions/17599232/reading-from-serial-port-with-while-loop\">this suggestion</a> with a small tweak. As noted, if you don't use <code>bufio</code>, the buffer gets overwritten every time you call</p>\n<pre class=\"lang-golang prettyprint-override\"><code>n, err := s.Read(buf0)\n</code></pre>\n<p>To fix this, append the bytes from <code>buf0</code> to a second buffer, <code>buf1</code>:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>if n &gt; 0 {\n    buf1 = append(buf1, buf0[:n]...)\n}\n</code></pre>\n<p>Then parse the bytes stored in <code>buf1</code>. If you find a subset you're looking for, process it further.</p>\n<ul>\n<li>make sure to clear the buffers in a suitable manner</li>\n<li>make sure to limit the frequency the loop is running with (e.g. <code>time.Sleep</code>)</li>\n</ul>\n"}], "owner": {"reputation": 17, "user_id": 8313107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8a96da685e59666baf983fc180635c8?s=128&d=identicon&r=PG&f=1", "display_name": "Eborst", "link": "https://stackoverflow.com/users/8313107/eborst"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1085, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1614343326, "creation_date": 1500145474, "last_edit_date": 1500186053, "question_id": 45121787, "link": "https://stackoverflow.com/questions/45121787/how-to-read-data-from-serial-and-process-it-when-a-specific-delimiter-is-found", "title": "How to read data from serial and process it when a specific delimiter is found", "body": "<p>I have a device, which continues to send data over a serial port.\nNow I want to read this and process it.\nThe data send this delimiter <code>\"!\"</code> and\nas soon as this delimiter appears I want to pause reading to processing the data thats already been received.\nHow can I do that? Is there any documentation or examples that I can read or follow.</p>\n"}, {"tags": ["json", "go", "go-gin"], "comments": [{"owner": {"reputation": 11808, "user_id": 1404726, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/an5FZ.jpg?s=128&g=1", "display_name": "tim-montague", "link": "https://stackoverflow.com/users/1404726/tim-montague"}, "edited": false, "score": 0, "creation_date": 1605319902, "post_id": 45121457, "comment_id": 114622502, "body": "You can use JSON to upload files if you base64 encode the file into a string, then base64 decode the string into a buffer (byte array) on the server. However, I recommend that you use the &quot;multipart/form-data&quot; approach instead, as it&#39;s better designed to handle image files. See my answer below for details."}], "answers": [{"comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1500144794, "post_id": 45121605, "comment_id": 77214131, "body": "You should probably go through the gin documentation.. Here is the spot in the docs that shows you the method for gin&#39;s FormFile <a href=\"https://godoc.org/github.com/gin-gonic/gin#Context.FormFile\" rel=\"nofollow noreferrer\">godoc.org/github.com/gin-gonic/gin#Context.FormFile</a>  and this deals with uploads <a href=\"https://godoc.org/github.com/gin-gonic/gin#Context.MultipartForm\" rel=\"nofollow noreferrer\">godoc.org/github.com/gin-gonic/gin#Context.MultipartForm</a>.. its all there so take your time and get to know the docs."}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1500144974, "post_id": 45121605, "comment_id": 77214186, "body": "Still could not figure out how to do that.  I need an example."}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1500145536, "post_id": 45121605, "comment_id": 77214372, "body": "I tried <code>file, header, err := c.FormFile(json.File)</code> but I get this errro: <code>c.FormFile undefined (type *gin.Context has no field or method FormFile)</code>"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1500145655, "post_id": 45121605, "comment_id": 77214411, "body": "Read the documentation.<code>func (c *Context) FormFile(name string) (*multipart.FileHeader, error)</code> The function FormFile requires that you pass it a string. You are passing it a byte slice. <code>string(json.File)</code>  Also if *gin.Context has no field or method FormFile that&#39;s a separate question because thats included in context according to the docs."}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1500145733, "post_id": 45121605, "comment_id": 77214441, "body": "I also tried <code>file, header, err := c.FormFile(&quot;file&quot;)</code> and get <code>: c.FormFile undefined (type *gin.Context has no field or method FormFile) </code>"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1500145819, "post_id": 45121605, "comment_id": 77214474, "body": "It looks like this has been addressed before <a href=\"https://stackoverflow.com/questions/38970180/golang-gin-c-param-undefined-type-gin-context-has-no-field-or-method-param\" title=\"golang gin c param undefined type gin context has no field or method param\">stackoverflow.com/questions/38970180/&hellip;</a>  chances are either your package is wrong or the version is"}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1500145858, "post_id": 45121605, "comment_id": 77214485, "body": "I guess the correct way is <code>file, header, err := c.Request.FormFile(&quot;file&quot;)</code>. This does not cause errors."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1500145928, "post_id": 45121605, "comment_id": 77214510, "body": "c.Request.FormFile isn&#39;t &quot;basic&quot; gin.. It looks like somewhere the http.Requests is being wrapped in gin.. What is the github import you are using"}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1500146008, "post_id": 45121605, "comment_id": 77214535, "body": "<code>&quot;github.com&#47;gin-gonic&#47;gin&quot;</code>"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1500146077, "post_id": 45121605, "comment_id": 77214557, "body": "Then that&#39;s very odd.  If it works cheers.. to be sure you are using the latest version you can use <code>go get -u github.com&#47;gin-gonic&#47;gin</code>"}], "tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": false, "score": 2, "last_activity_date": 1500144375, "creation_date": 1500144375, "answer_id": 45121605, "question_id": 45121457, "link": "https://stackoverflow.com/questions/45121457/how-to-get-file-posted-from-json-in-go-gin/45121605#45121605", "title": "How to get file posted from JSON in go gin?", "body": "<p>In your code you say <code>var json Article</code> where type article is defined as </p>\n\n<pre><code>type Article struct {\n    Title   string `json:\"title\"`\n    Body string `json:\"body\"`\n    File    []byte `json:\"file\"`\n}\n</code></pre>\n\n<p>And File is of type <code>[]byte</code>. Type byte doesn't return anything other than what it holds</p>\n\n<p>Your <code>Article.File</code> is not the same as <code>r.FormFile</code> where <code>FormFile</code> is a method that returns 3 items</p>\n\n<p>So <code>file, header, err := json.File</code> isn't <code>file, header, err := r.FormFile(\"foo\")</code></p>\n\n<p>See the implementation and method description from godocs -> <a href=\"https://golang.org/pkg/net/http/#Request.FormFile\" rel=\"nofollow noreferrer\">here</a> </p>\n"}, {"tags": [], "owner": {"reputation": 11808, "user_id": 1404726, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/an5FZ.jpg?s=128&g=1", "display_name": "tim-montague", "link": "https://stackoverflow.com/users/1404726/tim-montague"}, "is_accepted": false, "score": 1, "last_activity_date": 1605341497, "last_edit_date": 1605341497, "creation_date": 1605204488, "answer_id": 64809390, "question_id": 45121457, "link": "https://stackoverflow.com/questions/45121457/how-to-get-file-posted-from-json-in-go-gin/64809390#64809390", "title": "How to get file posted from JSON in go gin?", "body": "<h1>Using Gin to get an uploaded file</h1>\n<p>I think your question is &quot;Using Gin, how do I get an uploaded file?&quot;. Most developers don't upload files with JSON, which could be done but requires the file to be encoded as a base64 string (and increases the file size about 33%).</p>\n<p>The common (and more efficient) practice is to upload the file using the &quot;multipart/form-data&quot; encoding. The code that others provided <code>file, header, err := c.Request.FormFile(&quot;file&quot;)</code> works, but that hijacks the underlining &quot;net/http&quot; package that Gin extends.</p>\n<p>My recommendation is to use <a href=\"https://godoc.org/github.com/gin-gonic/gin#Context.ShouldBind\" rel=\"nofollow noreferrer\"><code>ShouldBind</code></a>, but you can also use the <a href=\"https://godoc.org/github.com/gin-gonic/gin#Context.FormFile\" rel=\"nofollow noreferrer\"><code>FormFile</code></a> or <a href=\"http://godoc.org/github.com/gin-gonic/gin#Context.MultipartForm\" rel=\"nofollow noreferrer\"><code>MultipartForm</code></a> methods provided by the Gin package.</p>\n<p>Examples below. Similar (but less detailed) explanations are also offered on the Gin page <a href=\"https://github.com/gin-gonic/gin#model-binding-and-validation\" rel=\"nofollow noreferrer\">https://github.com/gin-gonic/gin#model-binding-and-validation</a> and <a href=\"https://github.com/gin-gonic/gin#upload-files\" rel=\"nofollow noreferrer\">https://github.com/gin-gonic/gin#upload-files</a>.</p>\n<hr />\n<h2>Upload one file</h2>\n<hr />\n<h3>Clients</h3>\n<p>HTML</p>\n<pre class=\"lang-html prettyprint-override\"><code>&lt;form action=&quot;/upload&quot; method=&quot;POST&quot;&gt;\n  &lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;\n  &lt;input type=&quot;submit&quot;&gt;\n&lt;/form&gt;\n</code></pre>\n<p>Curl</p>\n<pre class=\"lang-sh prettyprint-override\"><code>curl -X POST http://localhost:8080/upload \\\n  -F &quot;file=../path-to-file/file.zip&quot; \\\n  -H &quot;Content-Type: multipart/form-data&quot;\n</code></pre>\n<h3>Server</h3>\n<p>Go</p>\n<pre><code>package main\n\nimport (\n    &quot;github.com/gin-gonic/gin&quot;\n    &quot;log&quot;\n    &quot;net/http&quot;\n    &quot;io/ioutil&quot;\n)\n\ntype Form struct {\n    File *multipart.FileHeader `form:&quot;file&quot; binding:&quot;required&quot;`\n}\n\nfunc main() {\n    router := gin.Default()\n\n    // Set a lower memory limit for multipart forms (default is 32 MiB)\n    // router.MaxMultipartMemory = 8 &lt;&lt; 20  // 8 MiB\n\n    router.POST(&quot;/upload&quot;, func(c *gin.Context) {\n\n        // Using `ShouldBind`\n        // --------------------\n        var form Form\n        _ := c.ShouldBind(&amp;form)\n\n        // Get raw file bytes - no reader method\n        // openedFile, _ := form.File.Open()\n        // file, _ := ioutil.ReadAll(openedFile)\n\n        // Upload to disk\n        // `form.File` has io.reader method\n        // c.SaveUploadedFile(form.File, path)\n        // --------------------\n\n        // Using `FormFile`\n        // --------------------\n        // formFile, _ := c.FormFile(&quot;file&quot;)\n\n        // Get raw file bytes - no reader method\n        // openedFile, _ := formFile.Open()\n        // file, _ := ioutil.ReadAll(openedFile)\n\n        // Upload to disk\n        // `formFile` has io.reader method\n        // c.SaveUploadedFile(formFile, path)\n        // --------------------\n        \n        c.String(http.StatusOK, &quot;Files uploaded&quot;)\n    })\n\n    // Listen and serve on 0.0.0.0:8080\n    router.Run(&quot;:8080&quot;)\n}\n</code></pre>\n<hr />\n<h2>Upload multiple files</h2>\n<hr />\n<h3>Clients</h3>\n<p>HTML</p>\n<pre class=\"lang-html prettyprint-override\"><code>&lt;form action=&quot;/upload&quot; method=&quot;POST&quot; multiple=&quot;multiple&quot;&gt;\n  &lt;input type=&quot;file&quot; name=&quot;files&quot;&gt;\n  &lt;input type=&quot;submit&quot;&gt;\n&lt;/form&gt;\n</code></pre>\n<p>Curl</p>\n<pre class=\"lang-sh prettyprint-override\"><code>curl -X POST http://localhost:8080/upload \\\n  -F &quot;files=../path-to-file/file1.zip&quot; \\\n  -F &quot;files=../path-to-file/file2.zip&quot; \\\n  -H &quot;Content-Type: multipart/form-data&quot;\n</code></pre>\n<h2>Server</h2>\n<p>Go</p>\n<pre><code>package main\n\nimport (\n    &quot;github.com/gin-gonic/gin&quot;\n    &quot;log&quot;\n    &quot;net/http&quot;\n    &quot;io/ioutil&quot;\n)\n\ntype Form struct {\n    Files []*multipart.FileHeader `form:&quot;files&quot; binding:&quot;required&quot;`\n}\n\nfunc main() {\n    router := gin.Default()\n\n    // Set a lower memory limit for multipart forms (default is 32 MiB)\n    // router.MaxMultipartMemory = 8 &lt;&lt; 20  // 8 MiB\n\n    router.POST(&quot;/upload&quot;, func(c *gin.Context) {\n\n        // Using `ShouldBind`\n        // --------------------\n        var form Form\n        _ := c.ShouldBind(&amp;form)\n\n        // for _, formFile := range form.Files {\n\n          // Get raw file bytes - no reader method\n          // openedFile, _ := formFile.Open()\n          // file, _ := ioutil.ReadAll(openedFile)\n\n          // Upload to disk\n          // `formFile` has io.reader method\n          // c.SaveUploadedFile(formFile, path)\n\n        // }\n        // --------------------\n\n        // Using `MultipartForm`\n        // --------------------\n        // form, _ := c.MultipartForm()\n        // formFiles, _ := form[&quot;files[]&quot;]\n\n        // for _, formFile := range formFiles {\n\n          // Get raw file bytes - no reader method\n          // openedFile, _ := formFile.Open()\n          // file, _ := ioutil.ReadAll(openedFile)\n\n          // Upload to disk\n          // `formFile` has io.reader method\n          // c.SaveUploadedFile(formFile, path)\n\n        // }\n        // --------------------\n        \n        c.String(http.StatusOK, &quot;Files uploaded&quot;)\n    })\n\n    // Listen and serve on 0.0.0.0:8080\n    router.Run(&quot;:8080&quot;)\n}\n</code></pre>\n"}], "owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2921, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1605341497, "creation_date": 1500143291, "last_edit_date": 1500144385, "question_id": 45121457, "link": "https://stackoverflow.com/questions/45121457/how-to-get-file-posted-from-json-in-go-gin", "title": "How to get file posted from JSON in go gin?", "body": "<p>I want to save image file posted by JSON. </p>\n\n<p>Here is the struct of the post:</p>\n\n<pre><code>type Article struct {\n    Title   string `json:\"title\"`\n    Body string `json:\"body\"`\n    File    []byte `json:\"file\"`\n}\n</code></pre>\n\n<p>And the handler is :</p>\n\n<pre><code>   func PostHandler(c *gin.Context) {\n        var err error\n        var json Article\n        err = c.BindJSON(&amp;json)\n        if err != nil {\n            log.Panic(err)\n        }\n\n    //handle photo upload\n        var filename string\n        file, header, err := json.File  //assignment count mismatch: 3 = 1\n\n        if err != nil {\n            fmt.Println(err)\n            filename = \"\"\n\n        } else {\n            data, err := ioutil.ReadAll(file)\n            if err != nil {\n                fmt.Println(err)\n                return\n            }\n\n            filename = path.Join(\"media\", +shared.RandString(5)+path.Ext(header.Filename))\n\n            err = ioutil.WriteFile(filename, data, 0777)\n            if err != nil {\n                io.WriteString(w, err.Error())\n                return\n            }\n\n        }\n...\n</code></pre>\n\n<p>But I get </p>\n\n<blockquote>\n  <p>assignment count mismatch: 3 = 1</p>\n</blockquote>\n\n<p>I copied the file handling part from a working multipart form handler which worked fine but apparently, </p>\n\n<pre><code>file, header, err := r.FormFile(\"uploadfile\")\n</code></pre>\n\n<p>can not be translated into JSON handling. </p>\n\n<p>I have looked at gin docs but could not find examples involving json file handling. \nSo how can I fix this?</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1500142468, "post_id": 45121303, "comment_id": 77213507, "body": "You can use <code>sync.Mutex</code> or <code>sync.RWMutex</code> to make it safe for concurrent use."}, {"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "reply_to_user": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1500143213, "post_id": 45121303, "comment_id": 77213729, "body": "It doesn&#39;t seem very idiomatic to me to keep the state of the last access around. I&#39;d like to &quot;start clean&quot; each time I access it."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1500143753, "post_id": 45121303, "comment_id": 77213855, "body": "&quot;<i>Since my second for loop prints Bob it is apparent that this is not safe for concurrent use.</i>&quot; I don&#39;t think I understand what you&#39;re trying to demonstrate. <code>ExportedMethod</code> alters the elements of the global <code>interfacer</code>. That appears to be its purpose. You called it twice, so it should be no surprise that a second call also modified <code>interfacer</code> and the changes from the first call are still there. The simple solution would seem to be to not modify the same array twice, and also don&#39;t use a global. Is there something else?"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1500143779, "post_id": 45121303, "comment_id": 77213862, "body": "You kinda writing this code like Private and Public methods from Java.. thats not very Go either.. You&#39;ve already exported your field and sync.Mutex is very idiomatic"}, {"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "reply_to_user": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1500143891, "post_id": 45121303, "comment_id": 77213888, "body": "@Schwern that&#39;s my question....is there a better way than a slice of interfacer so that it doesn&#39;t modify?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1500143954, "post_id": 45121303, "comment_id": 77213899, "body": "@reticentroot: I&#39;m not questioning where sync.Mutex is idiomatic....what isn&#39;t idiomatic is seeing state from a prior access."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1500144056, "post_id": 45121303, "comment_id": 77213934, "body": "@kristen If I understand, you don&#39;t want the elements of <code>interfacer</code> modified. But you&#39;re calling a method that modifies the elements of <code>interfacer</code>. So... don&#39;t call that method? Change the method so it doesn&#39;t modify the elements of <code>interfacer</code>? Copy them before modifying? Sorry, I&#39;m pretty sure I still don&#39;t understand."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 2, "creation_date": 1500146389, "post_id": 45121303, "comment_id": 77214657, "body": "I agree your post is still unclear.. however to test for concurrent safely use the <code>race</code> flag <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">golang.org/doc/articles/race_detector.html</a> if the print order is not what you expect then thats normal async behavior... that being said.. nothing about the code above is concurrent. There are no gorountines or channels being used. Lastly, if the code were running in goroutines, the log package is safe for concurrent printing.. fmt is not."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1500146873, "post_id": 45121303, "comment_id": 77214800, "body": "Here&#39;s an example of your code that is concurrent. <a href=\"https://play.golang.org/p/yXDGaAECtX\" rel=\"nofollow noreferrer\">play.golang.org/p/yXDGaAECtX</a>, in this example <code>mx</code> is not exported and therefore not exposed and cannot be accessed outside of it&#39;s package.  So state is hidden."}], "owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1500364150, "creation_date": 1500142164, "last_edit_date": 1500364150, "question_id": 45121303, "link": "https://stackoverflow.com/questions/45121303/slice-of-interface-how-can-i-make-this-safe-for-concurrent-use", "title": "Slice of interface...how can I make this safe for concurrent use?", "body": "<p>I have the following code <a href=\"https://play.golang.org/p/4mlXMhqpLJ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/4mlXMhqpLJ</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype A struct {\n    Name string\n}\n\nfunc (a *A) method(name string) {\n    a.Name = name\n}\n\nfunc (a *A) name() string {\n    return a.Name\n}\n\ntype intt interface {\n    method(string)\n    name() string\n}\n\nvar interfacer = []intt{\n    &amp;A{},\n}\n\nfunc ExportedMethod(name string) bool {\n    for _, aa := range interfacer {\n        fmt.Println(\"Pre:\", aa.name())\n        aa.method(name)\n        fmt.Println(\"Post:\", aa.name())\n        if aa.name() == \"Fred\" {\n            return true\n        }\n    }\n    return false\n}\n\nfunc main() {\n    ExportedMethod(\"Bob\")\n    ExportedMethod(\"Frank\")\n}\n</code></pre>\n\n<p>Since my second for loop prints Bob it is apparent that this is not safe for concurrent use. This is a simple example. In reality, I have many more structs that are going to satisfy interfacer...&amp;B{}, &amp;C{}, &amp;D{}, &amp;E{}, etc...I need a way to be able to loop through all of the structs, which is why I have a slice of interfacer. How can I make this safe for concurrent use?</p>\n"}, {"tags": ["go", "viper-go"], "answers": [{"comments": [{"owner": {"reputation": 5825, "user_id": 2400966, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/937a1ba2c0aa7d9e24fd92b99e26e1e8?s=128&d=identicon&r=PG", "display_name": "jbrown", "link": "https://stackoverflow.com/users/2400966/jbrown"}, "edited": false, "score": 1, "creation_date": 1500147635, "post_id": 45121313, "comment_id": 77215028, "body": "I guess it&#39;s time to take a break :-) Thanks"}], "tags": [], "owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "is_accepted": true, "score": 7, "last_activity_date": 1500142231, "creation_date": 1500142231, "answer_id": 45121313, "question_id": 45120927, "link": "https://stackoverflow.com/questions/45120927/how-to-load-a-list-of-maps-with-viper/45121313#45121313", "title": "How to load a list of maps with viper?", "body": "<p>Are you sure key is <code>artists</code> in the yaml? Do you mean to supply <code>artist</code>?</p>\n\n<p>Working example:</p>\n\n<pre><code>str := []byte(`artist:\n  name: The Beatles\n  albums:\n  - name: The White Album\n    year: 1968\n  - name: Abbey Road\n    year: 1969\n`)\n\n    viper.SetConfigType(\"yaml\")\n    viper.ReadConfig(bytes.NewBuffer(str))\n\n    var artist Artist\n    err := viper.UnmarshalKey(\"artist\", &amp;artist)\n\n    fmt.Printf(\"%v, %#v\\n\", err, artist)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>&lt;nil&gt;, main.Artist{Name:\"The Beatles\", Albums:[]main.Album{main.Album{Name:\"The White Album\", Year:1968}, main.Album{Name:\"Abbey Road\", Year:1969}}}\n</code></pre>\n"}], "owner": {"reputation": 5825, "user_id": 2400966, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/937a1ba2c0aa7d9e24fd92b99e26e1e8?s=128&d=identicon&r=PG", "display_name": "jbrown", "link": "https://stackoverflow.com/users/2400966/jbrown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2470, "favorite_count": 0, "accepted_answer_id": 45121313, "answer_count": 1, "score": 4, "last_activity_date": 1500142231, "creation_date": 1500139621, "question_id": 45120927, "link": "https://stackoverflow.com/questions/45120927/how-to-load-a-list-of-maps-with-viper", "title": "How to load a list of maps with viper?", "body": "<p>I have the following config I want to load with viper:</p>\n\n<pre><code>artist:\n  name: The Beatles\n  albums:\n  - name: The White Album\n    year: 1968\n  - name: Abbey Road\n    year: 1969\n</code></pre>\n\n<p>I can't work out how to load a list of maps. I guess I need to unmarshal just this key, but this code doesn't work:</p>\n\n<pre><code>type Album struct {\n    Name string\n    Year int\n}\n\ntype Artist struct {\n    Name string\n    Albums []Album\n}\n\nvar artist Artist\nviper.UnmarshalKey(\"artists\", &amp;artist)\n</code></pre>\n\n<p>What am I missing?</p>\n"}, {"tags": ["go", "channel", "libvlc", "tui"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1500168408, "post_id": 45119930, "comment_id": 77218915, "body": "For previous you can probably create some data structure that stores &quot;prev&quot;, &quot;current&quot;, &quot;next&quot; kinda like a simple linked list. I&#39;m sure there are many examples if your having trouble implementing your own.. He&#39;s the one of the first hits on Google <a href=\"https://gist.github.com/f76f69198395d18338887a60fb08c7fait\" rel=\"nofollow noreferrer\">gist.github.com/f76f69198395d18338887a60fb08c7fait</a> would have to mod to the nodes to store values of type <code>media</code>.. Whatever that type is. I suggest something like a linked list because they can be transversed forward and backwards."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1500168825, "post_id": 45119930, "comment_id": 77218967, "body": "Otherwise if the linked list route is not something you see yourself implementing or using you&#39;ll have to keep track of the index of the currently running song so that you decrement it and get the previous item. In my opinion it&#39;s more book keeping... This is a better example as it is safe for concurrency <a href=\"http://0xax.blogspot.com/2014/08/thread-safe-linked-list-for-golang.html?m=1\" rel=\"nofollow noreferrer\">0xax.blogspot.com/2014/08/&hellip;</a>"}, {"owner": {"reputation": 6434, "user_id": 4443226, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/C3vUB.png?s=128&g=1", "display_name": "Nevermore", "link": "https://stackoverflow.com/users/4443226/nevermore"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1500182271, "post_id": 45119930, "comment_id": 77220894, "body": "A linked list, or thread-safe list are excellent ideas! Thanks, but how would I then go about iterating through the list? And going <i>back</i> at some point while iterating through the list?"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1500183218, "post_id": 45119930, "comment_id": 77221043, "body": "In the second link I sent you <a href=\"http://0xax.blogspot.com/2014/08/thread-safe-linked-list-for-golang.html\" rel=\"nofollow noreferrer\">0xax.blogspot.com/2014/08/&hellip;</a> the next and prev methods have been defined already. I imagine that they can be used in someway. You can call next in a forever loop <code>for {if{ next is nil break} }</code> and you can send prev on a channel like you send next because it&#39;s already knows what current is. It might mean you change some of your current logic. Start by init the linked list. Play the first song in the linked list. If next is hit send the channel, call next, ditto with prev. Remove your range Playlist loop, not needed"}], "answers": [{"tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": true, "score": 1, "last_activity_date": 1500217980, "creation_date": 1500217980, "answer_id": 45130123, "question_id": 45119930, "link": "https://stackoverflow.com/questions/45119930/implement-previous-with-libvlc-playback/45130123#45130123", "title": "Implement previous with libvlc playback", "body": "<p>Based on the comments and discussion with the OP It was determined that a linked list was probably the best route in trying to control how to go forward and backwards with a bit less effort. Since Go is being used and the modules that are being used require goroutines the linked list also would have to be safe to use within goroutines. </p>\n"}], "owner": {"reputation": 6434, "user_id": 4443226, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/C3vUB.png?s=128&g=1", "display_name": "Nevermore", "link": "https://stackoverflow.com/users/4443226/nevermore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 45130123, "answer_count": 1, "score": 1, "last_activity_date": 1500217980, "creation_date": 1500133104, "last_edit_date": 1500139712, "question_id": 45119930, "link": "https://stackoverflow.com/questions/45119930/implement-previous-with-libvlc-playback", "title": "Implement previous with libvlc playback", "body": "<p>I'm using <code>libvlc</code> (go binding) to play music in a TUI. Instead of using the <code>media_list_player</code>, which has <code>Next</code> and <code>Previous</code> methods, I followed the advice of this answer <a href=\"https://stackoverflow.com/a/44647523/4443226\">https://stackoverflow.com/a/44647523/4443226</a> to use the regular <code>media_player</code> and a loop:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>import vlc\nimport time\nmy_list = ['vp1.mp3','happy.mp3']\ninstance = vlc.Instance()\nplayer = instance.media_player_new()\nplaying = set([1,2,3,4])\nfor i in my_list:\n    player.set_mrl(i)\n    player.play()\n    play=True\n    while play == True:\n        time.sleep(1)\n        play_state = player.get_state()\n        if play_state in playing:\n            continue\n        else:\n            play = False\n</code></pre>\n\n<p>This has the benefit that I can get the index of the current song and I can get the <em>position</em> and <em>duration</em> of the current playing song. </p>\n\n<p>I implemented it in Go, and one of the problems, is that I am unable to implement (effectively) <code>Next</code> and <code>Previous</code> song. </p>\n\n<p>Part of the problem is that this playback loop must be in a <strong>separate <code>goroutine</code></strong> than the UI thread. I use <code>chan</code> to send signals for stopping the <code>goroutine</code> and skipping the song. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func playAlbum(p *vlc.Player, a Album, l *tui.List, s *tui.StatusBar, done, next, prev chan struct{}) (err error) {\n    playlist := make([]*vlc.Media, 0)\n    for _, path := range a.Paths {\n        media, err := vlc.NewMediaFromPath(path)\n        // check eturn err\n        playlist = append(playlist, media)\n    }\n\n    for idx := range playlist {\n        p.SetMedia(playlist[idx])\n        err = p.Play()\n        // check return err\n\n        status, err := p.MediaState()\n        // check return err\n\n    PlaybackLoop:\n        for status != vlc.MediaEnded {\n            status, err = p.MediaState()\n            // continue with err\n\n            l.SetSelected(idx) // TUI list of songs\n\n            song := songStatus(a, l.Selected())\n            s.SetPermanentText(song) // TUI status bar\n\n            select {\n            case &lt;-next:\n                break PlaybackLoop\n            case &lt;-prev:\n                continue // TODO: implement previous\n            case &lt;-done:\n                return err\n            default:\n                time.Sleep(50 * time.Millisecond)\n            }\n        }\n    }\n    return err\n}\n</code></pre>\n\n<p>I am unable to implement <code>Previous</code>, because I can't just go back in the for loop.</p>\n\n<p>Ideally I think I would like to use the <code>libvlc</code> <code>media_list_player</code>. However, if I can't get the song <strong>duration</strong> and <strong>length</strong> as well as the <strong>index</strong> of the song in the <code>media_list</code>, I would rather do this method.</p>\n\n<p>If I must use the <code>media_player</code> instead, is there a better way to handle playback than using nested loops and channels? Something that can use <strong>previous</strong>?</p>\n"}, {"tags": ["mysql", "go", "orm", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 390, "user_id": 2126159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a692be53339bdaa2d0de3cd65fab6a92?s=128&d=identicon&r=PG", "display_name": "Diako Amir", "link": "https://stackoverflow.com/users/2126159/diako-amir"}, "is_accepted": false, "score": 0, "last_activity_date": 1593815197, "creation_date": 1593815197, "answer_id": 62723349, "question_id": 45119583, "link": "https://stackoverflow.com/questions/45119583/foreign-keys-and-related-data-with-gorm/62723349#62723349", "title": "Foreign keys and related data with gorm", "body": "<blockquote>\n<p>How can I make gorm create foreign keys in the DB?</p>\n</blockquote>\n<p>here is a sample:</p>\n<pre><code>db.AutoMigrate(&amp;model.User{}).\n        AddForeignKey(&quot;account_id&quot;, &quot;accounts(id)&quot;, &quot;CASCADE&quot;, &quot;CASCADE&quot;).\n        AddForeignKey(&quot;role_id&quot;, &quot;roles(id)&quot;, &quot;RESTRICT&quot;, &quot;RESTRICT&quot;)\n</code></pre>\n"}], "owner": {"reputation": 1236, "user_id": 1221253, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/c05edd2a49079a60ee18c6609dc44e10?s=128&d=identicon&r=PG&f=1", "display_name": "Dina", "link": "https://stackoverflow.com/users/1221253/dina"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1879, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1593815197, "creation_date": 1500130808, "last_edit_date": 1592644375, "question_id": 45119583, "link": "https://stackoverflow.com/questions/45119583/foreign-keys-and-related-data-with-gorm", "title": "Foreign keys and related data with gorm", "body": "<p>I'm using golang and gorm to talk to a MySQL database.</p>\n<p>I have a table with release metadata:</p>\n<pre><code>type OSType string\nconst (\n    Windows OSType = &quot;windows&quot;\n    Mac     OSType = &quot;mac&quot;\n)\n\ntype AgentMetadata struct {\n    Version         string              `gorm:&quot;primary_key&quot;`\n    OS              OSType              `gorm:&quot;primary_key&quot; sql:&quot;type:ENUM('windows','mac')&quot;`\n    Name            string              `sql:&quot;not null&quot;`\n    Description     string              `sql:&quot;not null&quot;`\n    ReleaseNotesUrl string              `sql:&quot;not null&quot;`\n\n    UpdateTime      time.Time           `sql:&quot;DEFAULT:current_timestamp&quot;`\n}\n</code></pre>\n<p>The releases are identified by a composite key - the OS and Version (number).</p>\n<p>I have another table which defines the default version that clients should download (by OS):</p>\n<pre><code>type GlobalDefault struct {\n    OS              OSType          `gorm:&quot;primary_key&quot; sql:&quot;type:ENUM('windows','mac')&quot;`\n    Version         string\n    AgentMetadata   AgentMetadata   \n\n    UpdateTime      time.Time       `sql:&quot;DEFAULT:current_timestamp&quot;`\n}\n</code></pre>\n<p>What I want is to define two foreign keys from GlobalDefault to AgentMetadata (the pair OS and Version) and I want to be able to query the GlobalDefault table by its key OS and to get back a data structure which already contains the full AgentMetadata.</p>\n<p>After a very long time and reading lots of documentatin, SO questions and code samples I tried to do the following:</p>\n<pre><code>func (repository *AgentRepository)GetGlobalDefault(os OSType) (error, AgentMetadata) {\n    gd := GlobalDefault{ OS:os }\n\n    result := AgentMetadata{}\n    return repository.connection.Find(&amp;gd).Related(&amp;result, &quot;OS&quot;, &quot;Version&quot;).Error, result\n}\n</code></pre>\n<p>This &quot;worked&quot; in the sense that it really got the result filled up with AgentMetadata. However, it was not the correct metadata.</p>\n<p>In my test I added two metadata records and one default:</p>\n<p><a href=\"https://i.stack.imgur.com/B3tCO.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/B3tCO.png\" alt=\"enter image description here\" /></a>\n<a href=\"https://i.stack.imgur.com/PUgit.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/PUgit.png\" alt=\"enter image description here\" /></a></p>\n<p>And when I called <code>err, queryResult := ar.GetGlobalDefault(defaultAgent.OS)</code> instead of getting the 1.2.3 version metadata, I got the 1.2.3.1 metadata.</p>\n<p>Indeed, when I turned on the gorm logs I saw that it ran the query:</p>\n<blockquote>\n<p>[2017-07-15 17:51:50]  [276.74ms]  SELECT * FROM <code>global_defaults</code> WHERE <code>global_defaults</code>.<code>os</code> = 'windows'</p>\n<p>[2017-07-15 17:51:50] [276.55ms]  SELECT * FROM <code>agent_metadata</code>  WHERE (<code>os</code> = 'windows')</p>\n</blockquote>\n<p>First, it ignored the fact that I have a composite key in the agent_metadata table, and second, instead of doing a single query with a join, it made two queries (which is really a waste of time).</p>\n<p>Another thing that bothers me is that I had to explicitly specify the foreign key names, whereas according to the documentation it seems that specifiying them is not needed or at least can be achieved by adding a tag:</p>\n<pre><code>type GlobalDefault struct {\n    OS              OSType          `gorm:&quot;primary_key&quot; sql:&quot;type:ENUM('windows','mac')&quot;`\n    Version         string\n    AgentMetadata   AgentMetadata   `gorm:&quot;ForeignKey:OS;AssociationForeignKey:OS&quot;`\n\n    UpdateTime      time.Time       `sql:&quot;DEFAULT:current_timestamp&quot;`\n}\n</code></pre>\n<p>Here I only added a tag for the OS column, however, I tried concatenating the foreign key names and neither option seemed to have an effect on the result. Without explicitly specifying the foreign key names in the API, the related data would just not be read. Having the pass the names to the query means that my DB mapping is not consolidated in a single place and I don't like that.</p>\n<p>Can my scenario be solved? Can I have a composite foreign key? Can I specify all ORM properties in a single place? How can I make gorm create foreign keys in the DB (I noticed that the schema is created without foreign keys from GlobalDefault to AgentMetadata)?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1934, "user_id": 342359, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/40d592cd1b79374d5fef85b427c7c5f7?s=128&d=identicon&r=PG", "display_name": "zengabor", "link": "https://stackoverflow.com/users/342359/zengabor"}, "edited": false, "score": 13, "creation_date": 1525180104, "post_id": 45117936, "comment_id": 87251268, "body": "This works, thanks a lot. However, please note that <code>os.Args[1]</code> will be <code>--</code>, and only <code>os.Args[2]</code> will be <code>readfile.go</code>"}, {"owner": {"reputation": 2382, "user_id": 6272277, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/522db908ba9addc9a647f5c8a8f8421a?s=128&d=identicon&r=PG&f=1", "display_name": "Lassi", "link": "https://stackoverflow.com/users/6272277/lassi"}, "edited": false, "score": 0, "creation_date": 1542304896, "post_id": 45117936, "comment_id": 93531287, "body": "You can also use the <a href=\"https://golang.org/pkg/flag/\" rel=\"nofollow noreferrer\">flag</a> package. <code>flag.NArg()</code> and <code>flag.Arg(i)</code> get the right arguments whether you used <code>go generate foo.go -- my args</code> or compiled <code>foo.go</code> and run it as <code>.&#47;foo -- my args</code> or <code>.&#47;foo my args</code>. Note that for <code>flag.Arg(i)</code> the first (non-flag) argument index is always zero."}], "tags": [], "owner": {"reputation": 109227, "user_id": 641955, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Hg2nO.jpg?s=128&g=1", "display_name": "janos", "link": "https://stackoverflow.com/users/641955/janos"}, "is_accepted": false, "score": 22, "last_activity_date": 1500119936, "creation_date": 1500119936, "answer_id": 45117936, "question_id": 45117892, "link": "https://stackoverflow.com/questions/45117892/passing-cli-arguments-to-excutables-with-go-run/45117936#45117936", "title": "Passing CLI arguments to excutables with &#39;go run&#39;", "body": "<p>You can use <code>--</code> to separate gofiles from arguments:</p>\n\n<pre><code>go run readfile.go -- readfile.go\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9470, "user_id": 1346701, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/7bfb0a4e8058453d5e3fc3ce01df7d6c?s=128&d=identicon&r=PG", "display_name": "Damien Leroux", "link": "https://stackoverflow.com/users/1346701/damien-leroux"}, "is_accepted": false, "score": 2, "last_activity_date": 1595515914, "creation_date": 1595515914, "answer_id": 63057082, "question_id": 45117892, "link": "https://stackoverflow.com/questions/45117892/passing-cli-arguments-to-excutables-with-go-run/63057082#63057082", "title": "Passing CLI arguments to excutables with &#39;go run&#39;", "body": "<p>To avoid the ambiguity of getting twice <code>readfile.go</code>, I advise you to use named <a href=\"https://golang.org/pkg/flag/#hdr-Usage\" rel=\"nofollow noreferrer\">flags</a>. This will solve the problem too.</p>\n<p>Example:</p>\n<pre><code>package main\n\nimport (\n    &quot;flag&quot;\n    &quot;fmt&quot;\n)\n\nfunc main() {\n    cmd := flag.String(&quot;cmd&quot;, &quot;&quot;, &quot;&quot;)\n    flag.Parse()\n    fmt.Printf(&quot;my cmd: \\&quot;%v\\&quot;\\n&quot;, string(*cmd))\n}\n</code></pre>\n<p><strong>Don't forget using <code>flag.Parse()</code> to retrieve the command line arguments</strong></p>\n<p>You can pass args to the <code>go run</code> command this way: <code>go run .\\main.go -cmd main.go</code> and you'll get as output:</p>\n<pre><code>my cmd: &quot;main.go&quot;\n</code></pre>\n<p>I hope this can help other.</p>\n"}], "owner": {"reputation": 2215, "user_id": 280476, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/8b95b0fe0d0b9a42ef5a5628c827d382?s=128&d=identicon&r=PG", "display_name": "forvaidya", "link": "https://stackoverflow.com/users/280476/forvaidya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12384, "favorite_count": 3, "answer_count": 2, "score": 13, "last_activity_date": 1595515914, "creation_date": 1500119554, "last_edit_date": 1593784951, "question_id": 45117892, "link": "https://stackoverflow.com/questions/45117892/passing-cli-arguments-to-excutables-with-go-run", "title": "Passing CLI arguments to excutables with &#39;go run&#39;", "body": "<p>I have a program <code>readfile.go</code> and I want to give the command line argument <code>os.Args[1]</code> also as <code>readfile.go</code>.</p>\n<p>However 'go run' thinks that it is an additional argument to itself rather than to the output executable. Is there a flag which can tell 'go run' that this is an argument to executable?</p>\n<pre>\nmvaidya@mvaidya-VirtualBox:~/junkeork$ go run readfile.go readfile.go\npackage main: case-insensitive file name collision: \"readfile.go\" and \"readfile.go\"\nmvaidya@mvaidya-VirtualBox:~/junkeork$\n</pre>\n<p>Error:</p>\n<blockquote>\n<p>package main: case-insensitive file name collision: &quot;readfile.go&quot; and\n&quot;readfile.go&quot;</p>\n</blockquote>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1500116149, "post_id": 45117214, "comment_id": 77205903, "body": "surely happens because minecraft detects the stdout is not a real console, so it strips the color, doing so you can redirect output to a file without the colors. Im not sure how you should proceed in go, there should be an option to define, or an env to set when invoking the minecraft program."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 5404370, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6430da5a48d2ba2366103181a69aedae?s=128&d=identicon&r=PG&f=1", "display_name": "LollyPop Lolly", "link": "https://stackoverflow.com/users/5404370/lollypop-lolly"}, "edited": false, "score": 0, "creation_date": 1500208433, "post_id": 45117401, "comment_id": 77226842, "body": "Hi @Flimzy, thanks for the response. I tried to use <code>script</code> but for some reason it says <code>bash: 5: command not found</code>. That is when I run it from <code>exec.Command</code> of course ;P.  But it works when I run it directly from the terminal tho. Any idea why this is happening?"}, {"owner": {"reputation": 23, "user_id": 5404370, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6430da5a48d2ba2366103181a69aedae?s=128&d=identicon&r=PG&f=1", "display_name": "LollyPop Lolly", "link": "https://stackoverflow.com/users/5404370/lollypop-lolly"}, "edited": false, "score": 1, "creation_date": 1500215889, "post_id": 45117401, "comment_id": 77229071, "body": "Hiiii, actually I got it working!!! :D. Well I used what you said about fooling it into thinking it&#39;s running on an active terminal and I did some heavy research on fake tty. After hours I found this fantastic resource: <a href=\"https://github.com/kr/pty\" rel=\"nofollow noreferrer\">https://github.com/kr/pty</a> and every thing&#39;s working perfectly fine! Thanks again, couldn&#39;t have done it without you!"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 4, "last_activity_date": 1500116331, "creation_date": 1500116331, "answer_id": 45117401, "question_id": 45117214, "link": "https://stackoverflow.com/questions/45117214/golang-os-exec-stdoutpipe-with-colors/45117401#45117401", "title": "GoLang os/exec StdoutPipe with colors", "body": "<p>The way to fix this is to force colors from the minecraft server. It's not a problem with your Go program at all.  It's very common for command-line programs to detect whether they're running on an interactive terminal, and disable certain features (such as color output, paging, etc) when they are not, under the assumption that they're being passed through a script (as indeed it is, in your case).</p>\n\n<p>If the minecraft server doesn't have this option, you may be able to <a href=\"https://stackoverflow.com/q/1401002/13860\">fool it into thinking it's running on an interactive terminal</a>.</p>\n"}], "owner": {"reputation": 23, "user_id": 5404370, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6430da5a48d2ba2366103181a69aedae?s=128&d=identicon&r=PG&f=1", "display_name": "LollyPop Lolly", "link": "https://stackoverflow.com/users/5404370/lollypop-lolly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1428, "favorite_count": 0, "accepted_answer_id": 45117401, "answer_count": 1, "score": 0, "last_activity_date": 1500116331, "creation_date": 1500114961, "question_id": 45117214, "link": "https://stackoverflow.com/questions/45117214/golang-os-exec-stdoutpipe-with-colors", "title": "GoLang os/exec StdoutPipe with colors", "body": "<p>I'm making a wrapper for a <strong>minecraft</strong> server console with GoLang. It uses os/exec to run the server and process.StdoutPipe() for realtime output from the subprocess.</p>\n\n<p>But, I can't get it to display the colors for some reason. When I run the server directly from the terminal, colors work, but it doesn't work at all when I run it from GoLang.</p>\n\n<p>What's more is there's no color codes on the log files either when I run it from GoLang. But running it directly from the terminal, the log file is absolutely messed up with color codes. I really don't get how that happens.</p>\n\n<p>Is there any way to fix this?<br>\nThanks!</p>\n"}, {"tags": ["go", "block", "channel", "goroutine"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1500112513, "post_id": 45116247, "comment_id": 77204816, "body": "First, you shouldn&#39;t use TCP for video streams if you don&#39;t mind some data being lost in transit. That&#39;s what UDP is for.  With UDP, just let the network layer take care of this--it should happen without your application ever caring.  Second, you should probably use <code>io.Copy</code> (<a href=\"https://golang.org/pkg/io/#Copy\" rel=\"nofollow noreferrer\">golang.org/pkg/io/#Copy</a>) instead of implementing that yourself."}, {"owner": {"reputation": 1273, "user_id": 4380247, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/CcTFe.jpg?s=128&g=1", "display_name": "acrazing", "link": "https://stackoverflow.com/users/4380247/acrazing"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1500116560, "post_id": 45116247, "comment_id": 77206025, "body": "@Flimzy my problem is not how to implement this, but how to ignore delayed frames"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1500138335, "post_id": 45116247, "comment_id": 77212265, "body": "On an unrelated <code>buf := make([]byte, 10)</code> shouldn&#39;t be inside of a for loop like that. You can initialize it above the for loops and save the number allocations you are doing."}, {"owner": {"reputation": 2908, "user_id": 136087, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2e416152346ae8c9229b87d9f004e656?s=128&d=identicon&r=PG&f=1", "display_name": "EdH", "link": "https://stackoverflow.com/users/136087/edh"}, "edited": false, "score": 0, "creation_date": 1500141270, "post_id": 45116247, "comment_id": 77213134, "body": "I am bit confused by your question, but would be happy to help. So &#39;downstream&#39; is from the server with a lot of bandwidth, and &#39;upstream&#39; is to the server - where your upload bandwidth may be more limited, correct?   If I understand it correctly, you are trying to do what we normally call a non-blocking write. In this case, if you were just using the standard <code>write()</code> system call you would want this to be non-blocking. So if it blocks, you just don&#39;t write, and get the latest frame... If this is the case, you will probably need to use the <code>syscall</code> package and use a regular old <code>write()</code>"}, {"owner": {"reputation": 2908, "user_id": 136087, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2e416152346ae8c9229b87d9f004e656?s=128&d=identicon&r=PG&f=1", "display_name": "EdH", "link": "https://stackoverflow.com/users/136087/edh"}, "edited": false, "score": 0, "creation_date": 1500141296, "post_id": 45116247, "comment_id": 77213141, "body": "I can provide an example of that - but want to make sure this is what you want. You will need to set a <code>syscall.O_NONBLOCK</code> flag on your socket using <code>fcntl</code> which I don&#39;t think is exposed through the io libraries. So you will have to call something like this to do it <code>syscall.Syscall(syscall.SYS_FCNTL, ... )</code>"}, {"owner": {"reputation": 1273, "user_id": 4380247, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/CcTFe.jpg?s=128&g=1", "display_name": "acrazing", "link": "https://stackoverflow.com/users/4380247/acrazing"}, "reply_to_user": {"reputation": 2908, "user_id": 136087, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2e416152346ae8c9229b87d9f004e656?s=128&d=identicon&r=PG&f=1", "display_name": "EdH", "link": "https://stackoverflow.com/users/136087/edh"}, "edited": false, "score": 0, "creation_date": 1500193951, "post_id": 45116247, "comment_id": 77223232, "body": "@EdH For example: the output bandwidth for downstream is 2mbps, the input bandwidth for upstream is 4mbps, and the video stream is 24fps, that means each frame of the video is about 4/24mbit. And then, the downstream could not be write in 4mpbs, some frames should be ignored from the upstream. In this case, if I receive one video frame from the upstream, I need to check the downstream is writing or not, if true, the frame should be ignored(just simplify the model, maybe should keep it for buffer), else it sould be written to the downstream. And the syscall could not resolve this problem."}], "owner": {"reputation": 1273, "user_id": 4380247, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/CcTFe.jpg?s=128&g=1", "display_name": "acrazing", "link": "https://stackoverflow.com/users/4380247/acrazing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 528, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1500112433, "creation_date": 1500107951, "last_edit_date": 1500112433, "question_id": 45116247, "link": "https://stackoverflow.com/questions/45116247/how-to-check-a-conn-write-goroutine-is-blocked", "title": "How to check a conn write goroutine is blocked?", "body": "<p>I'm writing a tcp bridge that pipes data from a conn to another conn, the process is duplex, that means the another conn may need to write data to the first conn.</p>\n\n<p>I open four go-routines to handle the task, each one just does one of the things: read from upstream, write to downstream, read from downstream, and write to upstream. The read go-routine is simple:</p>\n\n<pre><code>func readUpstream(conn *net.TCPConn) {\n    for {\n        buf := make([]byte, 10)\n        _, err := io.ReadFull(conn, buf)\n        if err != nil {\n            break\n        }\n        pipeToDownstream(buf)\n    }\n}\n</code></pre>\n\n<p>In general, the function <code>pipeToDownload</code> just need a channel to write to it, and the <code>writeDownstream</code> function just read the channel, and then write it to the downstream conn, just like follow:</p>\n\n<pre><code>func pipeToDownstream(buf) {\n    downPipe &lt;- buf\n}\n\nfunc writeDownstream(conn *net.Conn) {\n    for {\n        data := &lt;- downPipe\n        _, err := conn.Write(data)\n        if err != nil {\n            break\n        }\n    }\n}\n</code></pre>\n\n<p>But, in my case, the data from upstream is a video stream, I need to ensure the real-time pipe, that means if the downstream is writing, just the last frame read from the upstream should be reserved, and then the write downstream routine read from the reserved data and then write it. Because the video stream needs big bandwidth, but sometimes the client bandwidth is not enough to send data, and then the write downstream routine will be blocked, and then if use <code>pipeToDownstream</code> function directly will block the <code>readUpstream</code> go routine.</p>\n\n<p>So, I added a flag to represent the <code>writeDownstream</code> is writing, the read data from <code>readUpstream</code> should be reserved if the flag is <code>1</code>, else should pipe to the channel directly. This means I need to add a mutex to ensure thread-safe for the <code>flag</code> and the <code>reserved</code> field.</p>\n\n<p>How should I do?</p>\n"}, {"tags": ["go", "concurrency", "channel", "goroutine"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1500112579, "post_id": 45116232, "comment_id": 77204841, "body": "Note that concurrency != parallel processing."}], "answers": [{"comments": [{"owner": {"reputation": 103, "user_id": 5559035, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9037bd7befe765291feedc3c538a016?s=128&d=identicon&r=PG&f=1", "display_name": "14159", "link": "https://stackoverflow.com/users/5559035/14159"}, "edited": false, "score": 0, "creation_date": 1500205345, "post_id": 45116673, "comment_id": 77225974, "body": "thank you, that indeed was the problem. and yes, what i posted was all i could see in the console, just multiple times for each goroutine"}], "tags": [], "owner": {"reputation": 134, "user_id": 4866324, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0aeeb110b6e2209eedfe12e89d0c25f6?s=128&d=identicon&r=PG&f=1", "display_name": "Matteo", "link": "https://stackoverflow.com/users/4866324/matteo"}, "is_accepted": true, "score": 2, "last_activity_date": 1500111134, "creation_date": 1500111134, "answer_id": 45116673, "question_id": 45116232, "link": "https://stackoverflow.com/questions/45116232/go-routines-and-channels-in-go/45116673#45116673", "title": "go-routines and channels in go", "body": "<p>The instruction</p>\n\n<pre><code>var points = make(chan float64)\n</code></pre>\n\n<p>creates an unbuffered channel, which in turn means that </p>\n\n<pre><code>points &lt;- contributions_sum(input, distance, input[i][x_ln])\n</code></pre>\n\n<p>will block until another go-routine reads from points.</p>\n\n<p>Considering that all the go-routines in the code you posted perform a send on the channel before reading from it, they will all block waiting for a read on the same channel that will never happen (unless this is done in the code you didn't post, which you should have). As a result, you have a deadlock (which is usually written, is the error you quoted everything the console displays?). </p>\n"}], "owner": {"reputation": 103, "user_id": 5559035, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9037bd7befe765291feedc3c538a016?s=128&d=identicon&r=PG&f=1", "display_name": "14159", "link": "https://stackoverflow.com/users/5559035/14159"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 45116673, "answer_count": 1, "score": 0, "last_activity_date": 1500112565, "creation_date": 1500107867, "last_edit_date": 1500112565, "question_id": 45116232, "link": "https://stackoverflow.com/questions/45116232/go-routines-and-channels-in-go", "title": "go-routines and channels in go", "body": "<p>I'm trying to run a few calculations in parallel using Go's concurrency:</p>\n\n<pre><code>func intensity_calc(input Matrix, distance float64) Matrix {\n    output := create_matrix(len(input), len(input[0]))\n    var wg sync.WaitGroup\n    reverse := len(input)\n\n    wg.Add(len(input) / 2)\n    for i := 0; i &lt; len(input)/2; i++ {\n        output[i][x_ln] = input[i][x_ln]\n        go func() { // creates a go-routine\n        points &lt;- contributions_sum(input, distance, input[i][x_ln])\n        output[i][y_ln] = &lt;-points\n        output[reverse][y_ln] = output[i][y_ln]\n        fmt.Println(i)\n        defer wg.Done() // process is done\n    }()\n    }\n    wg.Wait() // wait until all processes are finished\n    return output\n}\n</code></pre>\n\n<p>* <em>output</em> is a 2D array</p>\n\n<p>the code supposes to take values from the array <em>input</em> send them to a function that returns the values into the channel <em>points</em>. \nthe channel is defined globally:</p>\n\n<pre><code> var points chan float64\n</code></pre>\n\n<p>and in the main() function:</p>\n\n<pre><code> points = make(chan float64)\n</code></pre>\n\n<p>but I keep getting this error:</p>\n\n<pre><code>goroutine 2017 [chan send]:\nmain.intensity_calc.func1(0xc04206a000, 0xfa1, 0xfa1, 0x3f50624dd2f1a9fc, 0xc0420bb660, 0xc042094000, 0xfa1, 0xfa1, 0xfa1, 0xc0420bb650)\n     C:/.../go concurrent calculation.go:71 +0xbf\ncreated by main.intensity_calc\n     C:/.../go concurrent calculation.go:76 +0x1c0\n</code></pre>\n"}, {"tags": ["go", "microservices"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1500112723, "post_id": 45115860, "comment_id": 77204875, "body": "Microserves are <i>usually</i> more hassle than they&#39;re worth. As a general rule, you should only use microservices when the maintenance overhead between <i>teams</i> is getting in the way of software development. And then, you should probably write one microservice per team.  If your only concern is modules crashing, just use <code>recover</code> to catch panics."}], "answers": [{"comments": [{"owner": {"reputation": 6073, "user_id": 66688, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/fdd25d4dedcbe0fc7abaf91052f78ac0?s=128&d=identicon&r=PG", "display_name": "Zahymaka", "link": "https://stackoverflow.com/users/66688/zahymaka"}, "edited": false, "score": 0, "creation_date": 1500304119, "post_id": 45116062, "comment_id": 77264537, "body": "Great answer. The question screams reverse proxy."}], "tags": [], "owner": {"reputation": 529, "user_id": 1061579, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e80a2c0170d152133bfd5f691b5e2ccf?s=128&d=identicon&r=PG", "display_name": "R3v4n", "link": "https://stackoverflow.com/users/1061579/r3v4n"}, "is_accepted": true, "score": 1, "last_activity_date": 1505384596, "last_edit_date": 1505384596, "creation_date": 1500106518, "answer_id": 45116062, "question_id": 45115860, "link": "https://stackoverflow.com/questions/45115860/how-to-use-golang-microservices/45116062#45116062", "title": "how to use golang microservices?", "body": "<p><a href=\"https://github.com/go-kit/kit\" rel=\"nofollow noreferrer\">Go-kit</a> and <a href=\"https://github.com/micro/go-micro\" rel=\"nofollow noreferrer\">go-micro</a> are for writing microservices, it won't solve your problem.</p>\n\n<p>You should use a reverse proxy in front of your applications, for instance Nginx: <a href=\"https://www.nginx.com/resources/admin-guide/reverse-proxy/\" rel=\"nofollow noreferrer\">https://www.nginx.com/resources/admin-guide/reverse-proxy/</a></p>\n\n<p>Here is an example of a nginx configuration file that does what you want:</p>\n\n<pre><code>server {\n   listen 80 default_server;\n   server_name your-domain;\n\n   location /app1 {\n      proxy_set_header X-Real-IP $remote_addr;\n      proxy_pass http://localhost:3000;\n   }\n\n   location /app2 {\n      proxy_set_header X-Real-IP $remote_addr;\n      proxy_pass http://localhost:4000;\n   }\n}\n</code></pre>\n\n<p>This way, you still deploy your applications on different ports, but they will only be exposed through the port 80.</p>\n"}, {"tags": [], "owner": {"reputation": 403, "user_id": 3902270, "user_type": "registered", "profile_image": "https://graph.facebook.com/100006418927672/picture?type=large", "display_name": "Karl Andresen", "link": "https://stackoverflow.com/users/3902270/karl-andresen"}, "is_accepted": false, "score": 0, "last_activity_date": 1520524470, "last_edit_date": 1520524470, "creation_date": 1520366698, "answer_id": 49139108, "question_id": 45115860, "link": "https://stackoverflow.com/questions/45115860/how-to-use-golang-microservices/49139108#49139108", "title": "how to use golang microservices?", "body": "<p>What you are looking for is an API-gateway. An API-gateway is a form of reverse-proxy too. I've looked into complete solutions like Tyk, Traefik and Zuul which all are great solutions. Of course one can use Nginx, but then you probably have a lot you have to incorporate using Lua scripting, such as client for OpenID-Connect/OAuth for authorization and such. Another things to take into consideration is security, logging, metrics, rate-limiting, (dynamic routing) and more. I really wouldn't base my API-gateway on Nginx. Nginx-Plus includes an API-gateway, but requires payment.</p>\n\n<p>I'm currently working on a very large project and have found that it requires a lot of customization work in form of plugins for the solutions mentioned above. So much in fact, that it will be a lot easier for me to write my API-gateway from scratch (using Golang and libraries).</p>\n\n<p>Since you mention you have tried go-kit and micro, I would suggest you try Traefik as it is very simple to set up and includes a Web UI for convenience.</p>\n"}, {"tags": [], "owner": {"reputation": 42, "user_id": 4671615, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FUIXO851_Kw/AAAAAAAAAAI/AAAAAAAAAF8/WnnZJuU3wx4/photo.jpg?sz=128", "display_name": "Plawan Rath", "link": "https://stackoverflow.com/users/4671615/plawan-rath"}, "is_accepted": false, "score": 0, "last_activity_date": 1520524419, "last_edit_date": 1520524419, "creation_date": 1520522999, "answer_id": 49176772, "question_id": 45115860, "link": "https://stackoverflow.com/questions/45115860/how-to-use-golang-microservices/49176772#49176772", "title": "how to use golang microservices?", "body": "<p>An approach that I used to host Go microservices in Windows is simply run <code>go install &lt;main-package-file&gt;</code> which generated an exe file for Windows. Then I simply used SC to create a Windows service out of it. Then just run it as a normal Windows service. This way I did not need Nginx or any such engine..</p>\n"}], "owner": {"reputation": 11, "user_id": 8311166, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-IhlrHeeJmLo/AAAAAAAAAAI/AAAAAAAAAAo/3gD08vR149E/photo.jpg?sz=128", "display_name": "Smiler", "link": "https://stackoverflow.com/users/8311166/smiler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 836, "favorite_count": 3, "closed_date": 1520531767, "accepted_answer_id": 45116062, "answer_count": 3, "score": -1, "last_activity_date": 1520524470, "creation_date": 1500104947, "last_edit_date": 1500112649, "question_id": 45115860, "link": "https://stackoverflow.com/questions/45115860/how-to-use-golang-microservices", "closed_reason": "Not suitable for this site", "title": "how to use golang microservices?", "body": "<p>My company use Go to build some HTTP API services. We want these services share one HTTP port. </p>\n\n<p>So the solution right now is we create a project named router, and router import some modules, every request pass through router to their own modules.<br>\nBut the question is that if one of these modules process crashed, the router just crash.</p>\n\n<p>Is there any solutions?</p>\n\n<p>Require:</p>\n\n<ol>\n<li>One http port.</li>\n<li>Every service is independent.</li>\n</ol>\n\n<p>I know go-kit and go micro, also I have tried, but still not too understand.</p>\n"}, {"tags": ["regex", "validation", "go"], "comments": [{"owner": {"reputation": 47, "user_id": 2202410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e9b6504d74535c8de219794a98c0f8d6?s=128&d=identicon&r=PG", "display_name": "Aashay Shah", "link": "https://stackoverflow.com/users/2202410/aashay-shah"}, "edited": false, "score": 0, "creation_date": 1500088063, "post_id": 45113907, "comment_id": 77199440, "body": "Also, I tried escaping that &quot;.&quot; in the regex, which did not give me the error &quot;Unknown tag&quot; but it just bypassed that validation. This could be a possible bug. GitHub <a href=\"https://github.com/go-validator/validator/issues/56\" rel=\"nofollow noreferrer\">issue</a>"}, {"owner": {"reputation": 620, "user_id": 1322651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e59e59204a86ec3da94e49eaf68f932?s=128&d=identicon&r=PG", "display_name": "Lukas Isselb&#228;cher", "link": "https://stackoverflow.com/users/1322651/lukas-isselb%c3%a4cher"}, "edited": false, "score": 0, "creation_date": 1500099991, "post_id": 45113907, "comment_id": 77201566, "body": "Have you tried escaping the {}? <code>regexp=^[a-zA-Z .]\\{1,100\\}$</code>"}, {"owner": {"reputation": 47, "user_id": 2202410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e9b6504d74535c8de219794a98c0f8d6?s=128&d=identicon&r=PG", "display_name": "Aashay Shah", "link": "https://stackoverflow.com/users/2202410/aashay-shah"}, "reply_to_user": {"reputation": 620, "user_id": 1322651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e59e59204a86ec3da94e49eaf68f932?s=128&d=identicon&r=PG", "display_name": "Lukas Isselb&#228;cher", "link": "https://stackoverflow.com/users/1322651/lukas-isselb%c3%a4cher"}, "edited": false, "score": 0, "creation_date": 1500100297, "post_id": 45113907, "comment_id": 77201641, "body": "@LukasIsselb&#228;cher Yes, escaping the braces does not help, it gives the same error."}], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 2202410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e9b6504d74535c8de219794a98c0f8d6?s=128&d=identicon&r=PG", "display_name": "Aashay Shah", "link": "https://stackoverflow.com/users/2202410/aashay-shah"}, "edited": false, "score": 0, "creation_date": 1500119775, "post_id": 45116926, "comment_id": 77206899, "body": "Yes, I have added the <a href=\"https://github.com/go-validator/validator/issues/57\" rel=\"nofollow noreferrer\">issue</a> on the project repo. Any other approach for struct field validations?"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1500112883, "creation_date": 1500112883, "answer_id": 45116926, "question_id": 45113907, "link": "https://stackoverflow.com/questions/45113907/go-validator-v2-gives-error-unknown-tag-for-regexp/45116926#45116926", "title": "Go validator.v2 gives error &quot;unknown tag&quot; for regexp", "body": "<p>The problem appears to be the <code>,</code> char in your first regex.  You can see in the validator <a href=\"https://github.com/go-validator/validator/blob/v2/validator.go#L332\" rel=\"nofollow noreferrer\">source code</a> that the tag is split on <code>,</code>. By UTSLing, I see no support for escaped commas in the tags; this is probably an oversight on the part of the project author. I suggest filing a bug/feature request.</p>\n"}], "owner": {"reputation": 47, "user_id": 2202410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e9b6504d74535c8de219794a98c0f8d6?s=128&d=identicon&r=PG", "display_name": "Aashay Shah", "link": "https://stackoverflow.com/users/2202410/aashay-shah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 731, "favorite_count": 0, "accepted_answer_id": 45116926, "answer_count": 1, "score": 0, "last_activity_date": 1500112883, "creation_date": 1500086000, "question_id": 45113907, "link": "https://stackoverflow.com/questions/45113907/go-validator-v2-gives-error-unknown-tag-for-regexp", "title": "Go validator.v2 gives error &quot;unknown tag&quot; for regexp", "body": "<p>I have been trying to understand why some regular expressions give me an error \"Unknown tag\" while using the <a href=\"http://godoc.org/gopkg.in/validator.v2\" rel=\"nofollow noreferrer\">validator.v2</a> package in golang. It works for some regular expressions but does not work with some which have \"{}\" inside them, and when I use the validator.Validate() it gives me an error at runtime \"unknown tag\".</p>\n\n<p>Here's the code:</p>\n\n<pre><code>type Company struct {\n    Name string `validate:\"regexp=^[a-zA-Z .]{1,100}$\"` \n}\n</code></pre>\n\n<p>which gives me the following error at runtime:</p>\n\n<pre><code>Name: unknown tag\n</code></pre>\n\n<p>however this regex works perfectly fine</p>\n\n<pre><code>type Company struct {\n    Name string `validate:\"regexp=^[a-zA-Z .]*$\"` \n}\n</code></pre>\n\n<p>I am using the braces because of length restrictions that I want to put on the string. There could be other ways to do it, but I feel the regex is the way to go and is easier to have it along with other rules right there in the expression.</p>\n"}, {"tags": ["macos", "go", "visual-studio-code"], "comments": [{"owner": {"reputation": 654, "user_id": 3434541, "user_type": "registered", "accept_rate": 82, "profile_image": "https://graph.facebook.com/1096564134/picture?type=large", "display_name": "Joe", "link": "https://stackoverflow.com/users/3434541/joe"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1500088517, "post_id": 45113209, "comment_id": 77199499, "body": "K, that confirms my suspicions, thanks!"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1500136627, "post_id": 45113209, "comment_id": 77211730, "body": "I moved the comment over to an answer so that this question can be closed."}], "answers": [{"tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": true, "score": 0, "last_activity_date": 1500136607, "creation_date": 1500136607, "answer_id": 45120498, "question_id": 45113209, "link": "https://stackoverflow.com/questions/45113209/vscode-set-terminal-gopath-to-match-go-gopath/45120498#45120498", "title": "vscode set terminal gopath to match go.gopath", "body": "<p>VSCode uses go.gopath i used for tools like go vet and go import... You will have to export the GOPATH on the integrate terminal with each use or set it in the bashrc... the integrate terminal is just a \"clone\" of the systems actual terminal. If you read the thread you provided you'll notice that what you want is a feature requests and not a current feature</p>\n"}], "owner": {"reputation": 654, "user_id": 3434541, "user_type": "registered", "accept_rate": 82, "profile_image": "https://graph.facebook.com/1096564134/picture?type=large", "display_name": "Joe", "link": "https://stackoverflow.com/users/3434541/joe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 609, "favorite_count": 0, "accepted_answer_id": 45120498, "answer_count": 1, "score": 2, "last_activity_date": 1500136607, "creation_date": 1500077760, "question_id": 45113209, "link": "https://stackoverflow.com/questions/45113209/vscode-set-terminal-gopath-to-match-go-gopath", "title": "vscode set terminal gopath to match go.gopath", "body": "<p>I have a Go project that I'm maintaining with vscode. </p>\n\n<p>I have set the <code>GOPATH</code> for the project using the <code>go.gopath</code> setting in vscode, and this seems to work just fine for the most part.</p>\n\n<p>However, when I open the integrated terminal, and type <code>echo $GOPATH</code>, the value shown is the value from <code>.bashrc</code> not the value from <code>go.gopath</code>.</p>\n\n<p>I need the integrated terminal to respect the GOPATH that's defined by vscode so when I run commands in the terminal, everything runs properly.</p>\n\n<p>I've tried setting values in <code>terminal.integrated.shell.osx</code> and <code>terminal.integrated.shell.osx</code>, but nothing seems to do what I want.</p>\n\n<p>I want the intergrated terminal to understand the proper GOPATH when vscode is opened, and not have to manually set this each time I open an instance of the terminal.</p>\n\n<p>I've found resources that seem like the <em>should</em> work, such as <a href=\"https://github.com/Microsoft/vscode/issues/14973\" rel=\"nofollow noreferrer\">https://github.com/Microsoft/vscode/issues/14973</a> and many others, but nothing seems straight forward.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 5865, "user_id": 5298696, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_Lk3Kq_mN2c/AAAAAAAAAAI/AAAAAAAAAEQ/4UXPTXc6z6U/photo.jpg?sz=128", "display_name": "CollinD", "link": "https://stackoverflow.com/users/5298696/collind"}, "edited": false, "score": 2, "creation_date": 1500066653, "post_id": 45111605, "comment_id": 77195051, "body": "If your code is too complicated to post, you need to construct an MCVE showcasing the example. Putting a bit more effort into your question is very likely to encourage others to put some effort into answering. Also, if your code is too complicated to make an MCVE, then it&#39;s probably really just poorly laid out (and presumably, impossible to unit test properly) so just the act of cleaning/writing an MCVE may really help you to answer i t. Otherwise, if the code isn&#39;t relevant, than neither is the note saying you&#39;re not including it."}], "answers": [{"comments": [{"owner": {"reputation": 5825, "user_id": 2400966, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/937a1ba2c0aa7d9e24fd92b99e26e1e8?s=128&d=identicon&r=PG", "display_name": "jbrown", "link": "https://stackoverflow.com/users/2400966/jbrown"}, "edited": false, "score": 0, "creation_date": 1500099272, "post_id": 45114054, "comment_id": 77201410, "body": "That&#39;s really useful. Thanks."}], "tags": [], "owner": {"reputation": 3287, "user_id": 2898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/ancqg.jpg?s=128&g=1", "display_name": "Krzysztof Kowalczyk", "link": "https://stackoverflow.com/users/2898/krzysztof-kowalczyk"}, "is_accepted": true, "score": 4, "last_activity_date": 1500087753, "creation_date": 1500087753, "answer_id": 45114054, "question_id": 45111605, "link": "https://stackoverflow.com/questions/45111605/is-it-possible-to-partially-deserialise-json-into-a-struct-in-go/45114054#45114054", "title": "Is it possible to partially deserialise JSON into a struct in go?", "body": "<p>Yes. </p>\n\n<p>Here's an example of having 2 fields in json and only decoding one:</p>\n\n<pre><code>jsonString := `{\"a\": 1, \"b\": 2}`\nvar rec struct {\n    A int `json:\"a\"`\n}\nerr := json.Unmarshal([]byte(jsonString), &amp;rec)\nif err != nil {\n    log.Fatalf(\"json.Unmarshal() failed with '%s'\\n\", err)\n}\nfmt.Printf(\"rec: %+v\\n\", rec)\n</code></pre>\n\n<p>When run it prints:</p>\n\n<pre><code>rec: {A:1}\n</code></pre>\n\n<p>i.e. field \"a\" in json was decoded and field \"b\" was discarded.</p>\n\n<p>See <a href=\"https://play.golang.org/p/89tu-ZC4pR\" rel=\"nofollow noreferrer\">https://play.golang.org/p/89tu-ZC4pR</a> for full example.</p>\n"}], "owner": {"reputation": 5825, "user_id": 2400966, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/937a1ba2c0aa7d9e24fd92b99e26e1e8?s=128&d=identicon&r=PG", "display_name": "jbrown", "link": "https://stackoverflow.com/users/2400966/jbrown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 45114054, "answer_count": 1, "score": 1, "last_activity_date": 1500113169, "creation_date": 1500066451, "last_edit_date": 1500113169, "question_id": 45111605, "link": "https://stackoverflow.com/questions/45111605/is-it-possible-to-partially-deserialise-json-into-a-struct-in-go", "title": "Is it possible to partially deserialise JSON into a struct in go?", "body": "<p>I need to integrate with an API that returns loads of elements in its response.</p>\n\n<p>Is it possible to cherry-pick just the fields I want with go's <code>json</code> library or do I need to deserialise the entire response?</p>\n"}, {"tags": ["go", "methods", "struct", "type-conversion"], "answers": [{"tags": [], "owner": {"reputation": 466, "user_id": 8307258, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L8i2o.jpg?s=128&g=1", "display_name": "Rados\u0142aw Za\u0142uska", "link": "https://stackoverflow.com/users/8307258/rados%c5%82aw-za%c5%82uska"}, "is_accepted": true, "score": 2, "last_activity_date": 1500060844, "creation_date": 1500060844, "answer_id": 45110421, "question_id": 45110223, "link": "https://stackoverflow.com/questions/45110223/struct-conversion-with-methods-in-golang/45110421#45110421", "title": "Struct conversion with methods in golang", "body": "<p>You can use <a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow noreferrer\">struct embeding</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype foo struct {\n    a int\n}\n\nfunc (f *foo) bar() {\n    f.a = 42\n}\n\ntype foo2 struct {\n    foo\n}\n\nfunc main() {\n    f := foo{12}\n    f.bar()\n    f2 := foo2{}\n    f2.a = 0\n    f2.bar()\n    fmt.Println(f)\n    fmt.Println(f2)\n}\n</code></pre>\n\n<p>Just create struct and use foo as one of its members. Don't give it explicit name</p>\n\n<pre><code>type foo2 struct {\n    foo\n}\n</code></pre>\n\n<p>That way all methods of foo will be available for foo2.</p>\n\n<p>Note that output of this program will be:</p>\n\n<pre><code>{42}\n{{42}}\n</code></pre>\n\n<p>More effective way of achieving what I suppose you want to do, will come with new Go 1.9: <a href=\"https://tip.golang.org/doc/go1.9#language\" rel=\"nofollow noreferrer\">https://tip.golang.org/doc/go1.9#language</a></p>\n"}], "owner": {"reputation": 13, "user_id": 8308683, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af9fcfd48345c0e11002d564cd9e109b?s=128&d=identicon&r=PG&f=1", "display_name": "Lead TheSalt", "link": "https://stackoverflow.com/users/8308683/lead-thesalt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 45110421, "answer_count": 1, "score": 1, "last_activity_date": 1500060844, "creation_date": 1500060009, "question_id": 45110223, "link": "https://stackoverflow.com/questions/45110223/struct-conversion-with-methods-in-golang", "title": "Struct conversion with methods in golang", "body": "<p>In order to simplify imports and dependencies for a project, I would like to convert a type struct and still have access to all the methods it is attached to. </p>\n\n<p>This is what I am looking for : </p>\n\n<pre><code>type foo struct {\na int\n}\n\nfunc (f *foo) bar() {\n    f.a = 42\n}\n\ntype foo2 foo\n\nfunc main() {\n    f := foo{12}\n    f.bar()\n    f2 := foo2(f)\n    f2.a = 0\n    f2.bar()\n    fmt.Println(f)\n    fmt.Println(f2)\n}\n</code></pre>\n\n<p>On the line \"f2.Bar()\" I get the error : </p>\n\n<p><strong>\"f2.Bar undefined (type Foo2 has no field or method Bar)\"</strong></p>\n\n<p>How can I do to have access to the method Bar even if I made a conversion. I would like my output to be </p>\n\n<pre><code>{42}\n{42}\n</code></pre>\n"}, {"tags": ["go", "ibm-cloud"], "comments": [{"owner": {"reputation": 16538, "user_id": 1227152, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4hr5l.jpg?s=128&g=1", "display_name": "mustaccio", "link": "https://stackoverflow.com/users/1227152/mustaccio"}, "edited": false, "score": 1, "creation_date": 1500058609, "post_id": 45109890, "comment_id": 77191268, "body": "You probably need to send <code>&quot;--apikey&quot;</code> and <code>risapikey</code> as separate parameters to <code>exec.Command()</code>"}, {"owner": {"reputation": 79, "user_id": 5652547, "user_type": "registered", "accept_rate": 3, "profile_image": "https://www.gravatar.com/avatar/41d9533468103d8637a124d5972b40d4?s=128&d=identicon&r=PG&f=1", "display_name": "Gary Sutherland", "link": "https://stackoverflow.com/users/5652547/gary-sutherland"}, "reply_to_user": {"reputation": 16538, "user_id": 1227152, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4hr5l.jpg?s=128&g=1", "display_name": "mustaccio", "link": "https://stackoverflow.com/users/1227152/mustaccio"}, "edited": false, "score": 0, "creation_date": 1500149527, "post_id": 45109890, "comment_id": 77215518, "body": "Than you,  Had to break all args up as parm to exec.Command  as cmd := exec.Command(&quot;bx&quot;, &quot;login&quot;, &quot;--apikey&quot;, risapikey, &quot;-o&quot;, &quot;Research Integrated Solutions&quot;, &quot;-s&quot;, &quot;dev&quot;)"}], "owner": {"reputation": 79, "user_id": 5652547, "user_type": "registered", "accept_rate": 3, "profile_image": "https://www.gravatar.com/avatar/41d9533468103d8637a124d5972b40d4?s=128&d=identicon&r=PG&f=1", "display_name": "Gary Sutherland", "link": "https://stackoverflow.com/users/5652547/gary-sutherland"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1500058530, "creation_date": 1500058380, "last_edit_date": 1500058530, "question_id": 45109890, "link": "https://stackoverflow.com/questions/45109890/error-logging-into-bluemix-from-a-go-program", "title": "Error logging into Bluemix from a GO program", "body": "<p>I don't know if this is the correct place or not to ask this question.</p>\n\n<p>I am writing a program in GO. I am trying to issue the <code>bx login</code> command from the program and it fails. I can manually login on the command line and have the GO program issue the <code>bx regions</code> command successfully.</p>\n\n<p>The GO code is:</p>\n\n<pre><code>tmpapikey := \"--apikey \" + risapikey\n        cmd := exec.Command(\"bx\", \"login\", tmpapikey, \"-o\", \"\\\"Research Integrated Solutions\\\"\", \"-s dev\")\n        cmd.Stdout = &amp;cmdout\n        cmd.Stderr = &amp;cmderr\n        fmt.Printf(\"DEBUG: cmd struct is: %+v\\n\", cmd)\n        err = cmd.Run()\n        fmt.Printf(\"DEBUG: stdout from cmd %s, stderr from cmd %s\\n\",\n</code></pre>\n\n<p>The command in the exec Command structure is:</p>\n\n<pre><code>bx login --apikey &lt;Real API key&gt; -o \"Research Integrated Solutions\" -s dev\n</code></pre>\n\n<p>The error is:   </p>\n\n<blockquote>\n  <p>Incorrect Usage.</p>\n  \n  <p>NAME:    login - Log user in</p>\n  \n  <p>USAGE:    bx login [-a API_ENDPOINT] [--sso] [-u USERNAME] [-p\n  PASSWORD] [--apikey KEY | @KEY_FILE] [-c ACCOUNT_ID] [-o ORG] [-s\n  SPACE]</p>\n</blockquote>\n\n<p>(plus the rest of the help for the <code>bx login</code> command).</p>\n\n<p>This exact command will work when run from the command line.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1320, "user_id": 357480, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/nSHyr.jpg?s=128&g=1", "display_name": "pbathala", "link": "https://stackoverflow.com/users/357480/pbathala"}, "edited": false, "score": 1, "creation_date": 1500057082, "post_id": 45109397, "comment_id": 77190541, "body": "If you do not want to unmarshal it, the only way is to parse the bytes yourself, you will end up implementing a state machine."}, {"owner": {"reputation": 1204, "user_id": 726786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/906ddd2af9fd394ea34a09dee9ce8d9b?s=128&d=identicon&r=PG", "display_name": "gabeio", "link": "https://stackoverflow.com/users/726786/gabeio"}, "edited": false, "score": 1, "creation_date": 1500057532, "post_id": 45109397, "comment_id": 77190745, "body": "You might be able to do it with regex if you really must not unmarshel it."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 3, "creation_date": 1500058649, "post_id": 45109397, "comment_id": 77191290, "body": "What&#39;s wrong with unmarshaling/modifying/marshaling? That seems pretty straightforward."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1500058530, "creation_date": 1500058530, "answer_id": 45109926, "question_id": 45109397, "link": "https://stackoverflow.com/questions/45109397/how-to-remove-element-from-json-array-in-golang/45109926#45109926", "title": "how to remove element from JSON array in golang?", "body": "<p>If you literally don't want to unmarshal it, you'll be stuck doing some sort of regex replacement, or building a state machine (effectively unmarshaling it yourself). If you're asking the question, then you shouldn't take this approach. This approach is for very advanced users only, and has no advantages except in very extremely rare situations.</p>\n\n<p>I assume you just don't want to bother with the effort of writing code to unmarshal it, though, and wouldn't mind a tool that does the work for you, even if that involves unmarshaling under the covers.</p>\n\n<p>If I'm right in my guess, you could consider a library like <a href=\"https://github.com/Jeffail/gabs\" rel=\"nofollow noreferrer\">gabs</a> (disclaimer: I've never used this library), which provides for easy JSON manipulation.  But of course it unmarshals the JSON in the process, then remarshals it when you ask for the result.</p>\n"}, {"comments": [{"owner": {"reputation": 437, "user_id": 969085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3fd73016395e3a6fef99451ffd3e0f3?s=128&d=identicon&r=PG", "display_name": "bandi shankar", "link": "https://stackoverflow.com/users/969085/bandi-shankar"}, "edited": false, "score": 0, "creation_date": 1500304952, "post_id": 45118253, "comment_id": 77265124, "body": "can we do it without adding &quot;key&quot;"}], "tags": [], "owner": {"reputation": 241, "user_id": 5427367, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e56416b1e446e56c0c715732c918191c?s=128&d=identicon&r=PG&f=1", "display_name": "M-AbdalRahman", "link": "https://stackoverflow.com/users/5427367/m-abdalrahman"}, "is_accepted": true, "score": 2, "last_activity_date": 1500817423, "last_edit_date": 1500817423, "creation_date": 1500121989, "answer_id": 45118253, "question_id": 45109397, "link": "https://stackoverflow.com/questions/45109397/how-to-remove-element-from-json-array-in-golang/45118253#45118253", "title": "how to remove element from JSON array in golang?", "body": "<p>you can do what you want by using, this packages <a href=\"https://github.com/tidwall/gjson\" rel=\"nofollow noreferrer\">gjson</a>,  and <a href=\"https://github.com/tidwall/sjson\" rel=\"nofollow noreferrer\">sjson</a>.</p>\n\n<p>example: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"strconv\"\n\n    \"github.com/tidwall/gjson\"\n    \"github.com/tidwall/sjson\"\n)\n\nfunc main() {\n    bJSON := []byte(`       \n            [\n                {\n                    \"name\": \"abc\",\n                    \"age\": 25\n                },\n                {\n                    \"name\": \"xyz\",\n                    \"age\": 26\n                }\n            ]\n    `)\n\n    newJSON := bJSON\n    var err error\n\n    result := gjson.GetBytes(bJSON, \"#.age\")\n\n    for i := range result.Array() {\n        newJSON, err = sjson.DeleteBytes(newJSON, strconv.Itoa(i)+\".age\")\n        if err != nil {\n            log.Println(err)\n        }\n    }\n\n    fmt.Println(string(newJSON))\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>[\n  {\n    \"name\": \"abc\"\n  },\n  {\n    \"name\": \"xyz\"\n  }\n]\n</code></pre>\n"}], "owner": {"reputation": 437, "user_id": 969085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3fd73016395e3a6fef99451ffd3e0f3?s=128&d=identicon&r=PG", "display_name": "bandi shankar", "link": "https://stackoverflow.com/users/969085/bandi-shankar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2709, "favorite_count": 1, "accepted_answer_id": 45118253, "answer_count": 2, "score": 3, "last_activity_date": 1500817423, "creation_date": 1500056311, "last_edit_date": 1500058757, "question_id": 45109397, "link": "https://stackoverflow.com/questions/45109397/how-to-remove-element-from-json-array-in-golang", "title": "how to remove element from JSON array in golang?", "body": "<p>I have a array of JSON string </p>\n\n<p>ex:</p>\n\n<pre><code>[\n {\n  \"name\":\"abc\"\n  \"age\":25\n }\n {\n  \"name\":\"xyz\"\n  \"age\":\"26\"\n }\n]\n</code></pre>\n\n<p>In run time I want to remove \"name\" from array . How can we do it . I don't want to unmarshal it .</p>\n\n<pre><code>[\n     {\n      \"age\":25\n     }\n     {\n      \"age\":\"26\"\n     }\n  ]\n</code></pre>\n"}, {"tags": ["go", "vagrant", "visual-studio-code", "ubuntu-16.04", "delve"], "answers": [{"tags": [], "owner": {"reputation": 253, "user_id": 1682383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ff32fb9a0a0483e7f3e6d4ef1cc586f?s=128&d=identicon&r=PG", "display_name": "Sadok", "link": "https://stackoverflow.com/users/1682383/sadok"}, "is_accepted": false, "score": 0, "last_activity_date": 1500149880, "creation_date": 1500149880, "answer_id": 45122388, "question_id": 45109131, "link": "https://stackoverflow.com/questions/45109131/remote-debug-over-vagrant-go/45122388#45122388", "title": "Remote debug over vagrant GO", "body": "<p>I resolved it\nI need to put the path to the root of my project in:</p>\n\n<blockquote>\n  <p>remotePath</p>\n</blockquote>\n"}], "owner": {"reputation": 253, "user_id": 1682383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ff32fb9a0a0483e7f3e6d4ef1cc586f?s=128&d=identicon&r=PG", "display_name": "Sadok", "link": "https://stackoverflow.com/users/1682383/sadok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 459, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1500149880, "creation_date": 1500055161, "last_edit_date": 1500149742, "question_id": 45109131, "link": "https://stackoverflow.com/questions/45109131/remote-debug-over-vagrant-go", "title": "Remote debug over vagrant GO", "body": "<p>I'm using vagrant with 16.04 image on host also ubuntu 16.04 \nOn vagrant I start</p>\n\n<pre><code>$ dlv debug --headless --listen=:2345 --log\n</code></pre>\n\n<p>my launch my json:</p>\n\n<p><a href=\"https://i.stack.imgur.com/6X81A.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/6X81A.png\" alt=\"enter image description here\"></a></p>\n\n<p>but vscode start on local he is not connected to the port in vagrant :</p>\n\n<blockquote>\n  <p>config.vm.network :forwarded_port, guest: 2345, host: 2345, id:\n  \"debuggolang\", host_ip: \"localhost\", auto_correct: true</p>\n</blockquote>\n\n<p>when I try to put him in convention format :</p>\n\n<p><a href=\"https://i.stack.imgur.com/Xtmww.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Xtmww.png\" alt=\"enter image description here\"></a></p>\n\n<p>break point doesn't stop</p>\n\n<p><a href=\"https://i.stack.imgur.com/NMwt0.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/NMwt0.png\" alt=\"enter image description here\"></a></p>\n\n<p>and dlv exit</p>\n\n<p>Regards</p>\n"}, {"tags": ["testing", "go", "automated-tests"], "answers": [{"comments": [{"owner": {"reputation": 2211, "user_id": 5785847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7PbW4.jpg?s=128&g=1", "display_name": "Mikey", "link": "https://stackoverflow.com/users/5785847/mikey"}, "edited": false, "score": 0, "creation_date": 1500058860, "post_id": 45109737, "comment_id": 77191406, "body": "Thanks for the reply, looks like a thorough and thought out process to me. Will give it a bit of time for anyone else to chime in before I accept the answer."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 4, "last_activity_date": 1507977371, "last_edit_date": 1507977371, "creation_date": 1500057727, "answer_id": 45109737, "question_id": 45108777, "link": "https://stackoverflow.com/questions/45108777/how-would-i-test-this-method/45109737#45109737", "title": "How would I test this method?", "body": "<p>Writing unit tests consists of:</p>\n\n<ul>\n<li>Providing known state for all of your inputs.</li>\n<li>Testing that, given all meaning combinations of those inputs, you receive the expected outputs.</li>\n</ul>\n\n<p>So you need to first identify your inputs:</p>\n\n<ul>\n<li><code>s Summoner</code></li>\n<li><code>name string</code></li>\n<li><code>region string</code></li>\n</ul>\n\n<p>Plus any \"hidden\" inputs, by way of globals:</p>\n\n<ul>\n<li><code>client := &amp;http.Client{}</code></li>\n</ul>\n\n<p>And your outputs are:</p>\n\n<ul>\n<li><code>summoner *Summoner</code></li>\n<li><code>err error</code></li>\n</ul>\n\n<p>(There can also be \"hidden\" outputs, if you write files, or change global variables, but you don't appear to do that here).</p>\n\n<p>Now the first three inputs are easy to create from scratch for your tests:  Just provide an empty <code>Summoner{}</code> (since you don't read or set that at all in your function, there's no need to set it other than to an empty value).  <code>name</code> and <code>region</code> can simply be set to strings.</p>\n\n<p>The only part remaining is your <code>http.Client</code>.  At minimum, you should probably pass that in as an argument. Not only does this give you control over your tests, but it allows you to use easily use different client in production in the future.</p>\n\n<p>But to ease testing, you might consider actually passing in a client-like interface, which you can easily mock. The only method you call on <code>client</code> is <code>Do</code>, so you could easily create a <code>Doer</code> interface:</p>\n\n<pre><code>type doer interface {\n    Do(req *Request) (*Response, error)\n}\n</code></pre>\n\n<p>Then change your function signature to take that as one argument:</p>\n\n<pre><code>func (s Summoner) ByName(client doer, name string, region string) (summoner *Summoner, err error) {\n</code></pre>\n\n<p>Now, in your test you can create a custom type that fulfills the <code>doer</code> interface, and responds with any <code>http.Response</code> you like, without needing to use a server in your tests.</p>\n"}], "owner": {"reputation": 2211, "user_id": 5785847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7PbW4.jpg?s=128&g=1", "display_name": "Mikey", "link": "https://stackoverflow.com/users/5785847/mikey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 45109737, "answer_count": 1, "score": 2, "last_activity_date": 1507977371, "creation_date": 1500053734, "last_edit_date": 1500054312, "question_id": 45108777, "link": "https://stackoverflow.com/questions/45108777/how-would-i-test-this-method", "title": "How would I test this method?", "body": "<p>Essentially I've begun to work on a wrapper for the Riot Games API and I'm struggling with how to test it. I've got the repository plugged into Travis so on push it runs <code>go test</code> but I'm not sure how to go about testing it since the API_KEY required for the requests changes daily and I can't auto-regenerate it, i'd have to manually add it every day if I tested the endpoints directly.</p>\n\n<p>So I was wondering if it was possible to mock the responses, but in that case I'm guessing I'd need to refactor my code?</p>\n\n<p>So i've made a struct to represent their SummonerDTO</p>\n\n<pre><code>type Summoner struct {\n    ID            int64  `json:\"id\"`\n    AccountID     int64  `json:\"accountId\"`\n    ProfileIconID int    `json:\"profileIconId\"`\n    Name          string `json:\"name\"`\n    Level         int    `json:\"summonerLevel\"`\n    RevisionDate  int64  `json:\"revisionDate\"`\n}\n</code></pre>\n\n<p>That struct has a method: </p>\n\n<pre><code>func (s Summoner) ByName(name string, region string) (summoner *Summoner, err error) {\n    endpoint := fmt.Sprintf(\"https://%s.api.riotgames.com/lol/summoner/%s/summoners/by-name/%s\", REGIONS[region], VERSION, name)\n\n    client := &amp;http.Client{}\n    req, err := http.NewRequest(\"GET\", endpoint, nil)\n    if err != nil {\n        return nil, fmt.Errorf(\"unable to create new client for request: %v\", err)\n    }\n\n    req.Header.Set(\"X-Riot-Token\", API_KEY)\n\n    resp, err := client.Do(req)\n    if err != nil {\n        return nil, fmt.Errorf(\"unable to complete request to endpoint: %v\", err)\n    }\n\n    defer resp.Body.Close()\n\n    if resp.StatusCode != 200 {\n        return nil, fmt.Errorf(\"request to api failed with: %v\", resp.Status)\n    }\n\n    respBody, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        return nil, fmt.Errorf(\"unable to read response body: %v\", err)\n    }\n\n    if err := json.Unmarshal([]byte(respBody), &amp;summoner); err != nil {\n        return nil, fmt.Errorf(\"unable to unmarshal response body to summoner struct: %v\", err)\n    }\n\n    return summoner, nil\n}\n</code></pre>\n\n<p>Is it a case that the struct method doesn't have a single responsibility, in a sense it's building the endpoint, firing off the request and parsing the response. Do I need to refactor it in order to make it testable, and in which case what's the best approach for that? Should I make a Request and Response struct and then test those?</p>\n\n<p>To clarify the API Keys used are rate limited and need to be regenerated daily, Riot Games do not allow you to use a crawler to auto-regenerate your keys. I'm using Travis for continuous integration so I'm wondering if there's a way to mock the request/response.</p>\n\n<p>Potentially my approach is wrong, still learning.</p>\n\n<p>Hopefully that all makes some form of sense, happy to clarify if not.</p>\n"}, {"tags": ["go", "sftp"], "comments": [{"owner": {"reputation": 1880, "user_id": 860453, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/cb3c4c3709da31b1eadf45c38f63fc97?s=128&d=identicon&r=PG", "display_name": "Knetic", "link": "https://stackoverflow.com/users/860453/knetic"}, "edited": false, "score": 1, "creation_date": 1500053443, "post_id": 45108286, "comment_id": 77188721, "body": "What output/error do you get? What are you expecting? What have you tried?"}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 8309111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ecb63670bd49bfdfb8b13a4abc797c4b?s=128&d=identicon&r=PG&f=1", "display_name": "Lureout", "link": "https://stackoverflow.com/users/8309111/lureout"}, "is_accepted": false, "score": 0, "last_activity_date": 1500052707, "creation_date": 1500052707, "answer_id": 45108529, "question_id": 45108286, "link": "https://stackoverflow.com/questions/45108286/how-to-create-sftp-client-over-exist-ssh-connection-on-golang/45108529#45108529", "title": "How to create sftp client over exist ssh connection on golang", "body": "<p>Find the answer: just need client instead of conn:</p>\n\n<p>client, err := ssh.Dial(\"tcp\", addr, config)</p>\n\n<p>sftp, err := sftp.NewClient(client)</p>\n"}], "owner": {"reputation": 11, "user_id": 8309111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ecb63670bd49bfdfb8b13a4abc797c4b?s=128&d=identicon&r=PG&f=1", "display_name": "Lureout", "link": "https://stackoverflow.com/users/8309111/lureout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 654, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1500052707, "creation_date": 1500051897, "question_id": 45108286, "link": "https://stackoverflow.com/questions/45108286/how-to-create-sftp-client-over-exist-ssh-connection-on-golang", "title": "How to create sftp client over exist ssh connection on golang", "body": "<p>guys! I need help. I tried to create a new sftp connection over existing ssh client that i made few minutes ago. I can't. And idk why.</p>\n\n<p>Here is a pie of code:</p>\n\n<pre><code>    config := &amp;ssh.ClientConfig{\n        User: *loginArg,\n        Auth: []ssh.AuthMethod{\n            ssh.Password(*passArg),\n        },\n        HostKeyCallback: func(hostname string, remote net.Addr, key ssh.PublicKey) error {\n            return nil\n        },\n    }\n\n    addr := fmt.Sprintf(\"%s:%d\", *ipArg, *portArg)\n    client, err := ssh.Dial(\"tcp\", addr, config)\n    if err != nil {\n        fmt.Printf(\"Failed to dial: %s\", err)\n    }\n    fmt.Println(\"Successfully connected to \", *ipArg, \":\", *portArg)\n\n    session, err := client.NewSession()\n    if err != nil {\n        fmt.Printf(\"Failed to create a new session: %s\", err)\n    }\n    defer session.Close()\n\n    b, err := session.CombinedOutput(\"/system backup save name=BackUp dont-encrypt=yes\") // /system backup save name=BackUp dont-encrypt=yes\n    if err != nil {\n        fmt.Printf(\"Failed to send output command: %s\", err)\n    }\n    fmt.Print(string(b))\n\n    //*******************\n    var conn *ssh.Client\n    sftp, err := sftp.NewClient(conn)\n    //sftp, err := sftp.NewClient(conn) //err\n    if err != nil {\n        log.Fatal(err) //fmt.Printf(\"Failed to create new sftp-client: %s\", err)\n    }\n    defer sftp.Close()\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "edited": false, "score": 1, "creation_date": 1500051188, "post_id": 45107967, "comment_id": 77187444, "body": "A command can only return a string. If you want a different datatype, you need to parse it yourself. Perhaps by using strconv.ParseInt"}], "answers": [{"tags": [], "owner": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "is_accepted": false, "score": 1, "last_activity_date": 1500053308, "creation_date": 1500053308, "answer_id": 45108672, "question_id": 45107967, "link": "https://stackoverflow.com/questions/45107967/how-i-can-return-value-with-a-same-type-using-exec-command-output/45108672#45108672", "title": "how I can return value with a same type using exec.Command().Output()", "body": "<p>When executing a command, you get a string back. You will need to deserialize it to get the proper type back. If you only expect your Node.js command to print numbers, you can use <code>strconv.ParseFloat</code>:</p>\n\n<pre><code>func main() {\n    cmd := exec.Command(\"/usr/bin/nodejs\", \"-p\", \"1+1\")\n    b, err := cmd.Output()\n    v, err := strconv.ParseFloat(string(b), 64)\n    fmt.Println(v) // v is of type float64\n}\n</code></pre>\n\n<p>If you want to handle more complex types such as javascript objects and array, I suggest serializing/deserializing node's result using JSON:</p>\n\n<pre><code>type Result struct {\n    Value float64\n    Args []float64\n}\nfunc main() {\n    var result Result\n    cmd := exec.Command(\"/usr/bin/nodejs\", \"-p\", `JSON.stringify({\"value\": 1+1, \"args\": [1, 1]})`)\n    b, err := cmd.Output()\n    err = json.Unmarshal(b, &amp;r)\n    fmt.Println(r.Value)\n}\n</code></pre>\n"}], "owner": {"reputation": 125, "user_id": 5695670, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dd079a335a1ef8e7b26cab86b88a6a63?s=128&d=identicon&r=PG&f=1", "display_name": "Unknown", "link": "https://stackoverflow.com/users/5695670/unknown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 612, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1500053308, "creation_date": 1500050696, "question_id": 45107967, "link": "https://stackoverflow.com/questions/45107967/how-i-can-return-value-with-a-same-type-using-exec-command-output", "title": "how I can return value with a same type using exec.Command().Output()", "body": "<p>in the next example, I am using <em>nodejs</em> to calculate 1+1 and I want the result with a same type of value, not string</p>\n\n<p>example:</p>\n\n<pre><code>func main() {\n    cmd := exec.Command(\"/usr/bin/nodejs\", \"-p\", \"1+1\")\n    var out bytes.Buffer\n    var stderr bytes.Buffer\n    cmd.Stdout = &amp;out\n    cmd.Stderr = &amp;stderr\n    err := cmd.Run()\n    if err != nil {\n        log.Println(err, stderr.String())\n        os.Exit(1)\n    }\n\n    fmt.Println(out.String())\n}\n</code></pre>\n\n<p>is there way to do that?</p>\n"}, {"tags": ["reactjs", "authentication", "go", "oauth", "oauth-2.0"], "answers": [{"tags": [], "owner": {"reputation": 9067, "user_id": 88122, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/U0pg3.png?s=128&g=1", "display_name": "jwilleke", "link": "https://stackoverflow.com/users/88122/jwilleke"}, "is_accepted": false, "score": 1, "last_activity_date": 1500059705, "creation_date": 1500059705, "answer_id": 45110175, "question_id": 45107946, "link": "https://stackoverflow.com/questions/45107946/getting-information-of-user-from-oauth2-app-having-the-session-token/45110175#45110175", "title": "Getting information of user from oauth2 app having the session token", "body": "<p>No. </p>\n\n<p><a href=\"http://ldapwiki.com/wiki/OAuth%202.0%20NOT%20an%20Authentication%20protocol\" rel=\"nofollow noreferrer\">OAuth 2.0 NOT an Authentication protocol.</a> \nIf you need Identity Information you need to use OpenID Connect (which is built on OAuth 2.0)</p>\n\n<p>With OpenID Connect you are provided both an Access Token and an Identity Token. The Identity Token will contain \"basic\" profile information about the \"user\". The Access Token may be used to obtain more detailed information about the user from the userinfo_endpoint.</p>\n"}], "owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1500059705, "creation_date": 1500050592, "question_id": 45107946, "link": "https://stackoverflow.com/questions/45107946/getting-information-of-user-from-oauth2-app-having-the-session-token", "title": "Getting information of user from oauth2 app having the session token", "body": "<p>I'm having I think, a misunderstanding of concepts related with Oauth2 protocol. Right now I have 3 applications:</p>\n\n<ol>\n<li>Frontend developed in React</li>\n<li>OAuth2 server developed in Golang (not finished)</li>\n<li>Another backend app, let's call it: Bussiness Logic app</li>\n</ol>\n\n<p>At first, the user from react can login in the system using the OAuth2 server, the OAuth2 server sends the token and everything's perfect.\nNow, when from the the react app some request is send to the Bussiness Logic App the token is also send in the headers. My question is: having the token, should I be able from the Bussiness Logic App to get information fo the user making a request to the OAuth server? is it allowed in the OAuth protocol?</p>\n\n<p>The thing is that I need to know in the Bussiness Logic App which user is logged in, if it's not allowed, how should I fix it?</p>\n"}, {"tags": ["docker", "go", "godeps"], "answers": [{"comments": [{"owner": {"reputation": 445, "user_id": 1515684, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/706bc7f6b63750239ac901c1a5b5b71a?s=128&d=identicon&r=PG", "display_name": "Sheshank Kodam", "link": "https://stackoverflow.com/users/1515684/sheshank-kodam"}, "edited": false, "score": 0, "creation_date": 1500413398, "post_id": 45146344, "comment_id": 77323417, "body": "Ok. How to handle the dependencies in production?"}, {"owner": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "reply_to_user": {"reputation": 445, "user_id": 1515684, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/706bc7f6b63750239ac901c1a5b5b71a?s=128&d=identicon&r=PG", "display_name": "Sheshank Kodam", "link": "https://stackoverflow.com/users/1515684/sheshank-kodam"}, "edited": false, "score": 0, "creation_date": 1500450478, "post_id": 45146344, "comment_id": 77336093, "body": "There are two ways to handle dependencies in production. Option 1 is to commit the <code>vendor</code> in your repo, this way you can <code>go build</code> on your production systems without worrying about dependencies. Option 2 is to omit the <code>vendor</code> directory, and use <code>godep restore</code> to installed the vendored packages. Not that option 2 won&#39;t work if you have dependencies in private repositories."}], "tags": [], "owner": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "is_accepted": false, "score": 0, "last_activity_date": 1500300080, "creation_date": 1500300080, "answer_id": 45146344, "question_id": 45107665, "link": "https://stackoverflow.com/questions/45107665/godep-doesnt-install-required-packages/45146344#45146344", "title": "godep doesnt install required packages", "body": "<p>Godep needs you to have local copies of the dependencies you want to vendor. You should run <code>go get</code> before running <code>godep save</code>. Additionally, assuming you have sub-packages in your app folder, you should run <code>godep save ./...</code>.</p>\n\n<p>Godep's readme: <a href=\"https://github.com/tools/godep#how-to-use-godep-with-a-new-project\" rel=\"nofollow noreferrer\">https://github.com/tools/godep#how-to-use-godep-with-a-new-project</a></p>\n"}], "owner": {"reputation": 445, "user_id": 1515684, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/706bc7f6b63750239ac901c1a5b5b71a?s=128&d=identicon&r=PG", "display_name": "Sheshank Kodam", "link": "https://stackoverflow.com/users/1515684/sheshank-kodam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 600, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1500300080, "creation_date": 1500049511, "question_id": 45107665, "link": "https://stackoverflow.com/questions/45107665/godep-doesnt-install-required-packages", "title": "godep doesnt install required packages", "body": "<p>I'm trying to run the application (written in Go) inside docker. To install dependencies I'm using godep. When executing godep inside docker, following error is received </p>\n\n<pre><code> docker run -ti --rm -v $PWD:/go/src/app -p3000:3000 golang bash \n root@7c491d184712:/go/src/app# go get github.com/tools/godep \n root@7c491d184712:/go/src/reno# godep save \n godep: Package (github.com/Shopify/sarama) not found\n</code></pre>\n"}, {"tags": ["git", "go", "git-submodules"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1500049324, "post_id": 45107525, "comment_id": 77186387, "body": "Why can&#39;t it be in a <code>vendor&#47;</code> folder?"}, {"owner": {"reputation": 1313, "user_id": 2278623, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/rna82.jpg?s=128&g=1", "display_name": "Alex Parker", "link": "https://stackoverflow.com/users/2278623/alex-parker"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500049824, "post_id": 45107525, "comment_id": 77186666, "body": "I&#39;m working with another person&#39;s repository. The design is not my choice."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1500050159, "post_id": 45107525, "comment_id": 77186860, "body": "But you&#39;re changing the import path of the code, so that is your choice. You&#39;ve changed the <code>k-cpi</code> package&#39;s import path to <code>k-cpi-release&#47;src&#47;github.company.com&#47;team&#47;k-cpi</code>. I don&#39;t understand why you&#39;re putting a submodule in your package if you&#39;re not trying to vendor it."}], "owner": {"reputation": 1313, "user_id": 2278623, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/rna82.jpg?s=128&g=1", "display_name": "Alex Parker", "link": "https://stackoverflow.com/users/2278623/alex-parker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 813, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1500049000, "creation_date": 1500049000, "question_id": 45107525, "link": "https://stackoverflow.com/questions/45107525/cannot-find-go-package-inside-submodule", "title": "Cannot find go package inside submodule", "body": "<p>I may be doing this quite wrongly, so I hope this makes sense.</p>\n\n<p>Setup:\n<code>GOPATH=/Users/alex/go</code></p>\n\n<p>I have a project called k-cpi-release located in my GOPATH (i.e., located at /Users/alex/go/src/k-cpi-release. There is a submodule located inside that project at cpi-release/src/github.company.com/team/cpi (i.e., full path is /Users/alex/go/src/k-cpi-release/src/github.company.com/team/k-cpi). I run <code>git submodule update --init --recursive</code> to get that repository.</p>\n\n<p>Inside that submodule, the code is located at k-cpi/cmd/cpi (full path /Users/alex/go/src/k-cpi-release/src/github.company.com/team/k-cpi/cmd/cpi). When I cd to that directory with the code and run <code>go build</code>, I get the following error for several packages:</p>\n\n<pre><code>main.go:13:2: cannot find package \"github.company.com/team/k-cpi/actions\" in any of:\n/Users/alex/go/src/k-cpi-release/src/github.company.com/team/k-cpi/vendor/github.company.com/team/k-cpi/actions (vendor tree)\n/usr/local/Cellar/go/1.8.3/libexec/src/github.company.com/team/k-cpi/actions (from $GOROOT)\n/Users/alex/go/src/github.company.com/team/k-cpi/actions (from $GOPATH)\n</code></pre>\n\n<p>What I infer is that the search the package looks in GOPATH and the vendor folder, but the repository is not located in either place because it is a submodule.</p>\n\n<p>How can this be remedied?</p>\n"}, {"tags": ["go", "shared-libraries"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500047890, "post_id": 45107175, "comment_id": 77185624, "body": "What is your goal here? You can create a shared object on Linux, but it has limited usefulness."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500048040, "post_id": 45107175, "comment_id": 77185714, "body": "Its for a cross platform app, so I would want to be able to build so, dylib and dll. My goal would be a pluggable module system"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500048157, "post_id": 45107175, "comment_id": 77185777, "body": "Plugins are an entirely different concept. Creating a shared object is so it can be called through a C interface, and like I mentioned, it&#39;s <i>not</i> cross platform and only works on Linux. For a &quot;plugin&quot; system, there is the <a href=\"https://golang.org/pkg/plugin/\" rel=\"nofollow noreferrer\"><code>plugin</code> package</a>."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500048395, "post_id": 45107175, "comment_id": 77185891, "body": "I was not aware of that plugin package. I will take a look, maybe I have been barking up the wrong tree. As an aside - I have heard a few people say that you can only build shared libs for linux but I think that has changed - <a href=\"https://stackoverflow.com/questions/40573401/building-a-dll-with-go-1-7\" title=\"building a dll with go 1 7\">stackoverflow.com/questions/40573401/building-a-dll-with-go-&zwnj;&#8203;1-7</a> - am I missing something on that too? I realise you would need different builds for each system"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500048847, "post_id": 45107175, "comment_id": 77186139, "body": "That other answer points to building the dll using gcc, which probably works, it&#39;s just not yet supported via the Go toolchain, and I&#39;m not sure what issues you might encounter doing that (<a href=\"https://golang.org/issue/11058\" rel=\"nofollow noreferrer\">golang.org/issue/11058</a> probably has more relevant info)."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1500050135, "post_id": 45107175, "comment_id": 77186848, "body": "Thanks for the pointers @JimB - If you want to present the fact that this is not yet supported with the standard go tool chain (but may be possible via gcc) as an answer I will accept (since that really addresses the reason for there not being much in the way of documentation)"}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1500058459, "creation_date": 1500058459, "answer_id": 45109903, "question_id": 45107175, "link": "https://stackoverflow.com/questions/45107175/looking-for-basic-example-resource-on-how-to-create-a-dll-so-dylib-in-golang/45109903#45109903", "title": "Looking for basic example / resource on how to create a dll/so/dylib in golang", "body": "<p>The <code>c-shared</code> <a href=\"https://golang.org/cmd/go/#hdr-Description_of_build_modes\" rel=\"nofollow noreferrer\">buildmode</a> is currently only supported on Linux. </p>\n\n<p>As seen here, <a href=\"https://stackoverflow.com/questions/40573401/building-a-dll-with-go-1-7\">Building a dll with Go 1.7</a>, you may be able to build a DLL or shared lib using gcc, but it's not supported directly by the Go toolchain.</p>\n\n<p>However, if you're looking to create a \"plugin\" architecture, you don't want to create a C shared library, in which each instance creates a new Go runtime. There is already a <a href=\"https://golang.org/pkg/plugin/\" rel=\"nofollow noreferrer\"><code>plugin</code> package</a> which is intended for that purpose. </p>\n"}], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 415, "favorite_count": 0, "accepted_answer_id": 45109903, "answer_count": 1, "score": 0, "last_activity_date": 1500058459, "creation_date": 1500047791, "last_edit_date": 1500047904, "question_id": 45107175, "link": "https://stackoverflow.com/questions/45107175/looking-for-basic-example-resource-on-how-to-create-a-dll-so-dylib-in-golang", "title": "Looking for basic example / resource on how to create a dll/so/dylib in golang", "body": "<p>I am looking to convert part of an app I have written in golang to a dll/dylib/so and make calls to it from my core golang app.</p>\n\n<p>Does anyone know of any good resources or guides on how to do this as my searches are not turning up a great deal of info (much of what I'm finding are old requests for the feature which i understand is now included)</p>\n\n<p>Please note: I have seen documentation on how to do the actual build, it is more around how to organise the app and expose methods that I am missing</p>\n\n<p>I would also be interested in pros/cons of this approach if anyone has any experience doing something similar</p>\n"}, {"tags": ["go", "terminal"], "comments": [{"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1500048741, "post_id": 45106922, "comment_id": 77186092, "body": "Eh? Bash has no <code>print</code> builtin. Maybe you&#39;re using <code>zsh</code>, and this question is incorrectly tagged?"}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1500048807, "post_id": 45106922, "comment_id": 77186116, "body": "(Regardless, if you were going to use an external command for this, that command should be <code>tput</code>, which can look up the right sequence to use for your current <code>TERM</code> value; otherwise, your code will be necessarily terminal-specific)."}, {"owner": {"reputation": 156, "user_id": 2330648, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ZugEZ.jpg?s=128&g=1", "display_name": "Ryan Smith", "link": "https://stackoverflow.com/users/2330648/ryan-smith"}, "reply_to_user": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1500050522, "post_id": 45106922, "comment_id": 77187067, "body": "Good call, I&#39;ll remove the tags for better accuracy!"}], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": true, "score": 2, "last_activity_date": 1500048486, "last_edit_date": 1500048486, "creation_date": 1500048025, "answer_id": 45107236, "question_id": 45106922, "link": "https://stackoverflow.com/questions/45106922/how-to-erase-the-scroll-back-aka-saved-lines-in-the-terminal/45107236#45107236", "title": "How to `Erase the scroll-back (aka &quot;Saved Lines&quot;)` in the terminal", "body": "<pre><code>fmt.Printf(string([]byte{0x1b,'[', '3', 'J'}))\n</code></pre>\n\n<p>should suffice. But you really should use a terminal library, which knows which codes to use depending on the terminal emulator in use.</p>\n\n<p>Something like <a href=\"https://github.com/nsf/termbox-go\" rel=\"nofollow noreferrer\">termbox-go</a>.</p>\n\n<p>For the usually available codes and their byte values, you can\ntry <a href=\"https://www.xfree86.org/4.8.0/ctlseqs.html\" rel=\"nofollow noreferrer\">xterm-docu</a> but your\nmileage may vary, as you use different terminal emulators.</p>\n"}, {"comments": [{"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1500048628, "post_id": 45107284, "comment_id": 77186018, "body": "<code>&#47;bin&#47;echo</code>&#39;s behavior is undefined with any sequence containing a backslash -- see <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/utilities/echo.html\" rel=\"nofollow noreferrer\">pubs.opengroup.org/onlinepubs/9699919799/utilities/echo.html</a>&zwnj;&#8203;. Much better to use <code>printf</code> (as suggested in the APPLICATION USAGE section of the docs for <code>echo</code>)... though of course, using any external command here at all rather than doing the output direct from Go (as in your Option 3) is silly in the extreme."}], "tags": [], "owner": {"reputation": 333, "user_id": 1147580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4db449008a79953ec67e3120b1bc2239?s=128&d=identicon&r=PG", "display_name": "yazgazan", "link": "https://stackoverflow.com/users/1147580/yazgazan"}, "is_accepted": false, "score": 2, "last_activity_date": 1500048209, "creation_date": 1500048209, "answer_id": 45107284, "question_id": 45106922, "link": "https://stackoverflow.com/questions/45106922/how-to-erase-the-scroll-back-aka-saved-lines-in-the-terminal/45107284#45107284", "title": "How to `Erase the scroll-back (aka &quot;Saved Lines&quot;)` in the terminal", "body": "<p><code>print</code> is a shell builtin, so it cannot be executed from go. You could use the <code>/bin/echo</code> binary, <code>/usr/bin/clear</code>, or just <code>fmt.Println</code> the escape sequence:</p>\n\n<pre><code>seq := \"\\x1b\\x5b\\x48\"\n\n// option 1\nout, _ := exec.Command(\"/bin/echo\", seq).Output()\nfmt.Println(string(out))\n\n// option 2\nout, _ := exec.Command(\"/usr/bin/clear\").Output()\nfmt.Println(string(out))\n\n// option 3 (prefered)\nfmt.Println(seq)\n</code></pre>\n"}], "owner": {"reputation": 156, "user_id": 2330648, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ZugEZ.jpg?s=128&g=1", "display_name": "Ryan Smith", "link": "https://stackoverflow.com/users/2330648/ryan-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 592, "favorite_count": 2, "accepted_answer_id": 45107236, "answer_count": 2, "score": 1, "last_activity_date": 1562347665, "creation_date": 1500046901, "last_edit_date": 1562347665, "question_id": 45106922, "link": "https://stackoverflow.com/questions/45106922/how-to-erase-the-scroll-back-aka-saved-lines-in-the-terminal", "title": "How to `Erase the scroll-back (aka &quot;Saved Lines&quot;)` in the terminal", "body": "<p>How can I erase the scroll-back in a terminal using Go?</p>\n\n<p>In OS X using Terminal, I can run: </p>\n\n<pre><code>$ print '\\e[3J'\n</code></pre>\n\n<p>and it will \"Erase the scroll-back (aka 'Saved Lines').\" Great!</p>\n\n<p>But, in Go, when I run:</p>\n\n<pre><code>exec.Command(\"print\", `\\e[3J`).CombinedOutput() \n</code></pre>\n\n<p>I get the error that <code>exec: \"print\": executable file not found in $PATH</code>, which makes sense:</p>\n\n<pre><code>$ type -a print\nprint is a shell builtin\n</code></pre>\n\n<p>The helpful Gophers in Slack mentioned I should look into communicating the the terminal app directly (whether it be Terminal, iTerm, iTerm2, etc.). However, I'm at a loss even after looking at this: <a href=\"https://www.iterm2.com/documentation-scripting.html\" rel=\"nofollow noreferrer\">https://www.iterm2.com/documentation-scripting.html</a></p>\n"}, {"tags": ["linux", "go"], "answers": [{"comments": [{"owner": {"reputation": 1641, "user_id": 799887, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/9e6bb5d36fd7a4d6c0f324700fc8cbcb?s=128&d=identicon&r=PG", "display_name": "Grief", "link": "https://stackoverflow.com/users/799887/grief"}, "edited": false, "score": 1, "creation_date": 1500045180, "post_id": 45106183, "comment_id": 77183941, "body": "Right, I missed the existence of the <code>Readdir()</code> method. It makes the idea clear. I guess it is just a bit counterintuitive for those who came to Go from other languages."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1641, "user_id": 799887, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/9e6bb5d36fd7a4d6c0f324700fc8cbcb?s=128&d=identicon&r=PG", "display_name": "Grief", "link": "https://stackoverflow.com/users/799887/grief"}, "edited": false, "score": 1, "creation_date": 1500046981, "post_id": 45106183, "comment_id": 77185036, "body": "@Grief: it might be useful to know that opening a directory and using readdir is a POSIX interface, and not dependent on a particular language. Since Go has roots in C and unix systems, that&#39;s often a good place to look for direction."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1500045180, "last_edit_date": 1500045180, "creation_date": 1500044635, "answer_id": 45106183, "question_id": 45106090, "link": "https://stackoverflow.com/questions/45106090/why-os-open-returns-nil-error-when-opening-a-directory/45106183#45106183", "title": "Why os.Open returns nil error when opening a directory?", "body": "<p>\"Reading\" has more meanings, one of which is reading the contents of a file.</p>\n\n<p>Another meaning is if the file denotes a directory, you may read its content, which is the list of the files / subfolders in it, using <a href=\"https://golang.org/pkg/os/#File.Readdir\" rel=\"nofollow noreferrer\"><code>File.Readdir()</code></a> or <a href=\"https://golang.org/pkg/os/#File.Readdirnames\" rel=\"nofollow noreferrer\"><code>File.Readdirnames()</code></a>. This is perfectly valid for an opened file whose name denotes a directory.</p>\n\n<p>Also you may do a lot more with an opened <a href=\"https://golang.org/pkg/os/#File\" rel=\"nofollow noreferrer\"><code>os.File</code></a> even if it denotes a folder, e.g. call its <a href=\"https://golang.org/pkg/os/#File.Chdir\" rel=\"nofollow noreferrer\"><code>File.Chdir()</code></a> (exclusive for directories) or <a href=\"https://golang.org/pkg/os/#File.Chmod\" rel=\"nofollow noreferrer\"><code>File.Chmod()</code></a> methods, or get statistics about it using <a href=\"https://golang.org/pkg/os/#File.Stat\" rel=\"nofollow noreferrer\"><code>File.Stat()</code></a>. I don't see why \"opening\" a folder should be disallowed. The wording in the doc may not be perfect (or it could be extended to mention this though).</p>\n"}], "owner": {"reputation": 1641, "user_id": 799887, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/9e6bb5d36fd7a4d6c0f324700fc8cbcb?s=128&d=identicon&r=PG", "display_name": "Grief", "link": "https://stackoverflow.com/users/799887/grief"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 0, "accepted_answer_id": 45106183, "answer_count": 1, "score": 2, "last_activity_date": 1500045180, "creation_date": 1500044347, "last_edit_date": 1500044846, "question_id": 45106090, "link": "https://stackoverflow.com/questions/45106090/why-os-open-returns-nil-error-when-opening-a-directory", "title": "Why os.Open returns nil error when opening a directory?", "body": "<p>I've spend some time looking for an error in my code and it appeared that at one place I was trying to read contents of a directory like it was the file. Consider the following code:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"os\"\n)\n\nfunc init() {\n    file, err := os.Open(\"/tmp/\")\n    fmt.Println(file, err) //err == nil here\n    var b []byte\n    n, err := file.Read(b)\n    fmt.Println(n, err) //err == \"read /tmp/: is a directory\"\n}\n</code></pre>\n\n<p>I am wondering, why <code>os.Open</code> allows to 'open' a directory without an error if I cannot 'read' it anyway? The documentation says </p>\n\n<blockquote>\n  <p>Open opens the named file for reading. If successful, methods on the\n  returned file can be used for reading; the associated file descriptor\n  has mode O_RDONLY. If there is an error, it will be of type\n  *PathError. [<a href=\"https://golang.org/pkg/os/#Open\" rel=\"nofollow noreferrer\">reference</a>]</p>\n</blockquote>\n\n<p>If the 'directory' is a 'file' is disputable but for me it looks a bit misleading. Is there any usage for that behavior?</p>\n"}, {"tags": ["json", "go", "dynamic", "struct"], "comments": [{"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1500043789, "post_id": 45105654, "comment_id": 77182930, "body": "Do you have set of known keys like <code>description</code> or just a description?"}, {"owner": {"reputation": 1757, "user_id": 1909569, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/0a02066c0046ce77af47b86c30cd720d?s=128&d=identicon&r=PG", "display_name": "Rogier Lommers", "link": "https://stackoverflow.com/users/1909569/rogier-lommers"}, "reply_to_user": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1500044284, "post_id": 45105654, "comment_id": 77183292, "body": "Nope, <code>description</code> is just one of many values. No known set unfortunately."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1500044341, "post_id": 45105654, "comment_id": 77183345, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/33436730/unmarshal-json-with-unknown-fields\">Unmarshal JSON with unknown fields</a>"}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1500044996, "post_id": 45105654, "comment_id": 77183816, "body": "Thanks, Options are 1) Currently you have inline struct definition instead create individual and handle it with struct composition, at top-level you will end up with two struct, rest would be same 2) Handle it with two fields in the <code>ChangedMetadata</code> 3) Use <code>map[string]interface{}</code> for <code>ChangedMetadata</code>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1508062570, "post_id": 45105654, "comment_id": 80453517, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/29347092/how-to-parse-deserlize-a-dynamic-json-in-golang\">How to parse/deserlize a dynamic JSON in Golang</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1757, "user_id": 1909569, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/0a02066c0046ce77af47b86c30cd720d?s=128&d=identicon&r=PG", "display_name": "Rogier Lommers", "link": "https://stackoverflow.com/users/1909569/rogier-lommers"}, "edited": false, "score": 0, "creation_date": 1500103389, "post_id": 45107659, "comment_id": 77202389, "body": "Thanks for your suggestion, but the keys <code>description</code> and <code>otherKey</code> are not part of a list that I know. They are also &quot;dynamic&quot;. So is there a way to get these values as well?"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1500145491, "post_id": 45107659, "comment_id": 77214359, "body": "At any place that is dynamic use interface{} ... You&#39;ll pay for it later when you have to type cast to access the data, or you can map[string]interface{}"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1757, "user_id": 1909569, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/0a02066c0046ce77af47b86c30cd720d?s=128&d=identicon&r=PG", "display_name": "Rogier Lommers", "link": "https://stackoverflow.com/users/1909569/rogier-lommers"}, "edited": false, "score": 0, "creation_date": 1500251453, "post_id": 45107659, "comment_id": 77238418, "body": "@RogierLommers The field ChangedMetadata is map.  Range over the map to find the keys as one would do with any other map."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1500252947, "last_edit_date": 1500252947, "creation_date": 1500049492, "answer_id": 45107659, "question_id": 45105654, "link": "https://stackoverflow.com/questions/45105654/unmarshal-dynamic-json-content-in-go/45107659#45107659", "title": "Unmarshal dynamic json content in Go", "body": "<p>Use a map for dynamic keys:</p>\n\n<pre><code>type ElvisEvent struct {\n    Timestamp int64  `json:\"timestamp\"`\n    Type      string `json:\"type\"`\n    AssetID   string `json:\"assetId\"`\n    Metadata  struct {\n    } `json:\"metadata\"`\n\n    ChangedMetadata map[string]struct {\n        OldValue interface{} `json:\"oldValue\"`\n        NewValue interface{} `json:\"newValue\"`\n    } `json:\"changedMetadata\"`\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/7_9VS_hcfM\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 1757, "user_id": 1909569, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/0a02066c0046ce77af47b86c30cd720d?s=128&d=identicon&r=PG", "display_name": "Rogier Lommers", "link": "https://stackoverflow.com/users/1909569/rogier-lommers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1138, "favorite_count": 1, "accepted_answer_id": 45107659, "answer_count": 1, "score": 0, "last_activity_date": 1500252947, "creation_date": 1500043092, "question_id": 45105654, "link": "https://stackoverflow.com/questions/45105654/unmarshal-dynamic-json-content-in-go", "title": "Unmarshal dynamic json content in Go", "body": "<p>I have a dynamic json object which I want to unmarshal in my Go app. The problem is that some parts of the json are dynamically named, so I don't know what to put in the struc type json tags. To illustrate my problem, please see this playground: <a href=\"https://play.golang.org/p/q8J0VVO7uj\" rel=\"nofollow noreferrer\">https://play.golang.org/p/q8J0VVO7uj</a></p>\n\n<p>As you can see the <code>s1</code> can perfectly be unmarshalled, because the struct type indeed has tag <code>description</code>. But <code>s2</code> cannot be unmarshalled.</p>\n\n<p>So my question is: how can I solve this? Can I make use of interfaces here?</p>\n"}, {"tags": ["variables", "go", "floating-point"], "comments": [{"owner": {"reputation": 726, "user_id": 387670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de92c7f1d6b452b9e2b3f38c11967cb8?s=128&d=identicon&r=PG", "display_name": "sahaj", "link": "https://stackoverflow.com/users/387670/sahaj"}, "edited": false, "score": 0, "creation_date": 1500270960, "post_id": 45105177, "comment_id": 77242884, "body": "Like you have mentioned C header files, in Go, this information is available in the package documentation. You can view standard library package documentation at: <a href=\"https://golang.org/pkg/\" rel=\"nofollow noreferrer\">golang.org/pkg</a>  In your particular case, you would like to explore math package and builtin package. There you can find MaxFloat64 details under Constants section. For complex128, you can read the source comment above the complex128 declaration to understand possible max value for complex128.  The package documentation also contains links to source files of the package (bold blue hyperlinks)."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 21, "last_activity_date": 1500044093, "last_edit_date": 1500044093, "creation_date": 1500042020, "answer_id": 45105255, "question_id": 45105177, "link": "https://stackoverflow.com/questions/45105177/the-maximum-value-for-float64-and-complex128-type-in-go/45105255#45105255", "title": "The maximum value for float64 and complex128 type in Go", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\nfunc main() {\n    const f = math.MaxFloat64\n    fmt.Printf(\"%[1]T %[1]v\\n\", f)\n    const c = complex(math.MaxFloat64, math.MaxFloat64)\n    fmt.Printf(\"%[1]T %[1]v\\n\", c)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>float64 1.7976931348623157e+308\ncomplex128 (1.7976931348623157e+308+1.7976931348623157e+308i)\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/pkg/math/\" rel=\"noreferrer\">Package math</a></p>\n\n<pre><code>import \"math\" \n</code></pre>\n  \n  <p>Floating-point limit values. Max is the largest finite value\n  representable by the type. SmallestNonzero is the smallest positive,\n  non-zero value representable by the type.</p>\n\n<pre><code>const (\n        MaxFloat32             = 3.40282346638528859811704183484516925440e+38  // 2**127 * (2**24 - 1) / 2**23\n        SmallestNonzeroFloat32 = 1.401298464324817070923729583289916131280e-45 // 1 / 2**(127 - 1 + 23)\n\n        MaxFloat64             = 1.797693134862315708145274237317043567981e+308 // 2**1023 * (2**53 - 1) / 2**52\n        SmallestNonzeroFloat64 = 4.940656458412465441765687928682213723651e-324 // 1 / 2**(1023 - 1 + 52)\n)\n</code></pre>\n</blockquote>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Numeric_types\" rel=\"noreferrer\">Numeric types</a></p>\n  \n  <p>A numeric type represents sets of integer or floating-point values.\n  The predeclared architecture-independent numeric types are:</p>\n\n<pre><code>uint8       the set of all unsigned  8-bit integers (0 to 255)\nuint16      the set of all unsigned 16-bit integers (0 to 65535)\nuint32      the set of all unsigned 32-bit integers (0 to 4294967295)\nuint64      the set of all unsigned 64-bit integers (0 to 18446744073709551615)\n\nint8        the set of all signed  8-bit integers (-128 to 127)\nint16       the set of all signed 16-bit integers (-32768 to 32767)\nint32       the set of all signed 32-bit integers (-2147483648 to 2147483647)\nint64       the set of all signed 64-bit integers (-9223372036854775808 to 9223372036854775807)\n\nfloat32     the set of all IEEE-754 32-bit floating-point numbers\nfloat64     the set of all IEEE-754 64-bit floating-point numbers\n\ncomplex64   the set of all complex numbers with float32 real and imaginary parts\ncomplex128  the set of all complex numbers with float64 real and imaginary parts\n\nbyte        alias for uint8\nrune        alias for int32\n</code></pre>\n  \n  <p>The value of an n-bit integer is n bits wide and represented using\n  two's complement arithmetic.</p>\n  \n  <p>There is also a set of predeclared numeric types with\n  implementation-specific sizes:</p>\n\n<pre><code>uint     either 32 or 64 bits\nint      same size as uint\nuintptr  an unsigned integer large enough to store the uninterpreted bits of a pointer value\n</code></pre>\n  \n  <p>To avoid portability issues all numeric types are distinct except\n  byte, which is an alias for uint8, and rune, which is an alias for\n  int32. Conversions are required when different numeric types are mixed\n  in an expression or assignment. For instance, int32 and int are not\n  the same type even though they may have the same size on a particular\n  architecture.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 721, "user_id": 6495051, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/iPtl5.jpg?s=128&g=1", "display_name": "B Best", "link": "https://stackoverflow.com/users/6495051/b-best"}, "is_accepted": false, "score": 1, "last_activity_date": 1608240224, "creation_date": 1608240224, "answer_id": 65348553, "question_id": 45105177, "link": "https://stackoverflow.com/questions/45105177/the-maximum-value-for-float64-and-complex128-type-in-go/65348553#65348553", "title": "The maximum value for float64 and complex128 type in Go", "body": "<p>You can also consider using the <a href=\"https://golang.org/pkg/math/#Inf\" rel=\"nofollow noreferrer\">Inf</a> method from the <code>math</code> package which\nreturns a value for infinity (positive or negative if you want), but is considered to be <code>float64</code>.</p>\n<p>Not too sure if there is an argument for one or the other between <code>math.MaxFloat64</code> and <code>math.Inf()</code>. Comparing the two I've found that Go interprets the infinity values to be larger than the max float ones.</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;math&quot;\n)\n\nfunc main() {\n    infPos := math.Inf(1) // gives positive infinity\n    fmt.Printf(&quot;%[1]T %[1]v\\n&quot;, infPos)\n    \n    infNeg := math.Inf(-1) // gives negative infinity\n    fmt.Printf(&quot;%[1]T %[1]v\\n&quot;, infNeg)\n}\n\n</code></pre>\n"}], "owner": {"reputation": 325, "user_id": 5379308, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-qDJJzDVsn0s/AAAAAAAAAAI/AAAAAAAAAHg/B0-T3s9fER4/photo.jpg?sz=128", "display_name": "mohsentux", "link": "https://stackoverflow.com/users/5379308/mohsentux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 29811, "favorite_count": 3, "accepted_answer_id": 45105255, "answer_count": 2, "score": 15, "last_activity_date": 1608240224, "creation_date": 1500041730, "question_id": 45105177, "link": "https://stackoverflow.com/questions/45105177/the-maximum-value-for-float64-and-complex128-type-in-go", "title": "The maximum value for float64 and complex128 type in Go", "body": "<p>i need to know the maximum value of float64 and complex128 variable types in golang. go doesn't seem to have an equivalent of float.h and i don't know how to calculate it.  </p>\n"}]