[{"tags": ["go", "aws-lambda"], "answers": [{"tags": [], "owner": {"reputation": 3895, "user_id": 4040931, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/705151302/picture?type=large", "display_name": "David Alsh", "link": "https://stackoverflow.com/users/4040931/david-alsh"}, "is_accepted": true, "score": 1, "last_activity_date": 1556768750, "creation_date": 1556768750, "answer_id": 55945401, "question_id": 55943650, "link": "https://stackoverflow.com/questions/55943650/reading-parameters-from-aws-lambda-function-in-golang/55945401#55945401", "title": "Reading parameters from AWS Lambda function in Golang", "body": "<p>running </p>\n\n<pre><code>func main() {\n    s := \"35c760f4-b3dc-4657-b4f3\u20132c6566d4f42e\"\n    fmt.Println(len(s))\n}\n</code></pre>\n\n<p><code>\"\u2013\"</code> this character comes up as a length of 3. It's just a weird character. Has the character code of <code>8211</code>, you want <code>45</code></p>\n\n<p><a href=\"https://unicodelookup.com/#8211/1\" rel=\"nofollow noreferrer\">https://unicodelookup.com/#8211/1</a></p>\n\n<p><a href=\"https://unicodelookup.com/#45/1\" rel=\"nofollow noreferrer\">https://unicodelookup.com/#45/1</a></p>\n\n<pre><code>len(strings.ReplaceAll(myEvent.Token, \"\u2013\", \"-\"))\n</code></pre>\n\n<p>will give you the right length</p>\n"}], "owner": {"reputation": 13337, "user_id": 775936, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/52fa9069824aa7f202cecbb4daf4fe93?s=128&d=identicon&r=PG", "display_name": "Ashish Agarwal", "link": "https://stackoverflow.com/users/775936/ashish-agarwal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 626, "favorite_count": 0, "accepted_answer_id": 55945401, "answer_count": 1, "score": 1, "last_activity_date": 1556768750, "creation_date": 1556750894, "question_id": 55943650, "link": "https://stackoverflow.com/questions/55943650/reading-parameters-from-aws-lambda-function-in-golang", "title": "Reading parameters from AWS Lambda function in Golang", "body": "<p>I am passing in events into a AWS lambda function from a <code>events.json</code> file and parsing it in a function handler.</p>\n\n<p>The code is:</p>\n\n<pre><code>type MyEvent struct {\n    Param string `json:\"param1\"`\n    Token string `json:\"token\"`\n}\n\nfunc main() {\n    lambda.Start(Handler)\n}\n\nfunc Handler(ctx context.Context, evt json.RawMessage) (events.APIGatewayProxyResponse, error) {\n\n    var myEvent MyEvent\n    json.Unmarshal(evt, &amp;myEvent)\n\n    fmt.Println(myEvent.Token)\n    fmt.Println(len(myEvent.Token))\n\n    // rest of the code is here\n}\n</code></pre>\n\n<p>The <code>event.json</code> file is:</p>\n\n<pre><code>{\n    \"param1\": \"Param\",\n    \"token\": \"35c760f4-b3dc-4657-b4f3\u20132c6566d4f42e\"\n}\n</code></pre>\n\n<p>The output of the function is </p>\n\n<pre><code>35c760f4-b3dc-4657-b4f3\u20132c6566d4f42e\n38\n</code></pre>\n\n<p>The value of the token that is being printed is correct but the length is not. The length of the token is 36 but is being interpreted/printed as 38.</p>\n\n<p>Why is this happening ? </p>\n\n<p>PS: I am using the AWS SAM cli to run the program.</p>\n"}, {"tags": ["go", "aws-sdk", "amazon-route53"], "answers": [{"tags": [], "owner": {"reputation": 6086, "user_id": 2531132, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a842165f1df19a0b40a0684baeb2353b?s=128&d=identicon&r=PG", "display_name": "thomasmichaelwallace", "link": "https://stackoverflow.com/users/2531132/thomasmichaelwallace"}, "is_accepted": true, "score": 1, "last_activity_date": 1556820289, "creation_date": 1556820289, "answer_id": 55957949, "question_id": 55943480, "link": "https://stackoverflow.com/questions/55943480/route53-filter-listresourcerecordsets-by-recordtype/55957949#55957949", "title": "Route53: filter ListResourceRecordSets by RecordType", "body": "<p>I think you've misunderstood what <code>StartRecordName</code> and <code>StartRecordType</code> do. They do not filter the list, only specify where the list begins.</p>\n\n<p>From the <a href=\"https://docs.aws.amazon.com/Route53/latest/APIReference/API_ListResourceRecordSets.html\" rel=\"nofollow noreferrer\">Service Documentation</a>:</p>\n\n<blockquote>\n  <p>If you specify both Name and Type: The <strong>results begin</strong> with the first resource record set in the list whose name is greater than or equal to Name, and whose type is greater than or equal to Type.</p>\n</blockquote>\n\n<p>So from your example I would expect <em>all</em> your records to be returned (up to a limit of 100), but the first record will be the <code>A</code> record for <code>subdomain.subdomain.mydomain.com</code>.</p>\n\n<p>It will then proceed (and wrap) in alphabetical order by name/type.</p>\n"}], "owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 0, "accepted_answer_id": 55957949, "answer_count": 1, "score": 0, "last_activity_date": 1556820289, "creation_date": 1556749576, "question_id": 55943480, "link": "https://stackoverflow.com/questions/55943480/route53-filter-listresourcerecordsets-by-recordtype", "title": "Route53: filter ListResourceRecordSets by RecordType", "body": "<p>I can't get aws route53 service's ListResourceRecordSets to filter by StartRecord Type.  Even with the StartRecordType filter, it returns all records (cname and A) instead of the type I select.</p>\n\n<p>I also noticed I would get a validation error if StartRecordName was not included, so it seems if StartRecordType is used, then StartRecordName is required.</p>\n\n<p>The code below returns all records, but does not filter as it should.</p>\n\n<pre><code>    AWSLogin(instance)\n\n    svc := route53.New(instance.AWSSession)\n\n    listParams := &amp;route53.ListResourceRecordSetsInput{\n        HostedZoneId: aws.String(\"Z2798GPJN9CUFJ\"), // Required\n        StartRecordName: aws.String(\"subdomain.subdomain.mydomain.com\"),\n        StartRecordType: aws.String(route53.RRTypeA),\n    //  StartRecordType: aws.String(route53.RRTypeCname),\n    }\n    respList, err := svc.ListResourceRecordSets(listParams)\n\n    if err != nil {\n        fmt.Println(err.Error())\n        return\n    }\n\n    fmt.Println(\"All Type \"A\" records:\")\n    fmt.Println(respList)\n</code></pre>\n"}, {"tags": ["go", "amazon-route53"], "comments": [{"owner": {"reputation": 26589, "user_id": 1032785, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/30816b3d787c2bd9d6f036318304f225?s=128&d=identicon&r=PG", "display_name": "jordanm", "link": "https://stackoverflow.com/users/1032785/jordanm"}, "edited": false, "score": 1, "creation_date": 1556742972, "post_id": 55940510, "comment_id": 98537992, "body": "You can use <code>ListHostedZones</code> to find the zone id."}], "answers": [{"comments": [{"owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 1, "creation_date": 1556750166, "post_id": 55943258, "comment_id": 98540201, "body": "Good work on the solution, but for the benefit of future readers, let&#39;s note that you can&#39;t necessarily assume that only one hosted zone matches a given domain.  There are some configurations where there could be more than one -- in some advanced, but still valid cases (e.g. split horizon), or misconfigurations (you accidentally ceated more than one) there would be more than one.  Be aware of that."}], "tags": [], "owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "is_accepted": false, "score": 1, "last_activity_date": 1556748261, "creation_date": 1556748261, "answer_id": 55943258, "question_id": 55940510, "link": "https://stackoverflow.com/questions/55940510/route53-query-domain-records-by-domain-name/55943258#55943258", "title": "Route53: query domain records by Domain Name", "body": "<p>You first have to do a lookup to get the HostedZoneID. Here is the func I wrote for it. :</p>\n\n<pre><code>func GetHostedZoneIdByNameLookup(awsSession string, HostedZoneName string) (HostedZoneID string, err error) {\n\n    svc := route53.New(awsSession)\n\n    listParams := &amp;route53.ListHostedZonesByNameInput{\n        DNSName: aws.String(HostedZoneName), // Required\n    }\n    req, resp := svc.ListHostedZonesByNameRequest(listParams)\n    err = req.Send()\n    if err != nil {\n        return \"\", err\n    }\n\n    HostedZoneID = *resp.HostedZones[0].Id\n\n    // remove the /hostedzone/ path if it's there\n    if strings.HasPrefix(HostedZoneID, \"/hostedzone/\") {\n        HostedZoneID = strings.TrimPrefix(HostedZoneID, \"/hostedzone/\")\n    }\n\n    return HostedZoneID, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1556748261, "creation_date": 1556733429, "question_id": 55940510, "link": "https://stackoverflow.com/questions/55940510/route53-query-domain-records-by-domain-name", "title": "Route53: query domain records by Domain Name", "body": "<p>Using Go and AWS-SDK </p>\n\n<p>I'm attempting to query route53 CNAME and A records as listed in the AWS Console under Route53 -> Hosted Zones.  I'm able to query using the following code, but it requires the (cryptic) HostedZoneId I have to know ahead of time. </p>\n\n<p>Is there a different function, or a HostedZoneId lookup based on the Domain Name such as XXX.XXX.com ?</p>\n\n<pre><code>    AWSLogin(instance)\n\n    svc := route53.New(instance.AWSSession)\n\n    listParams := &amp;route53.ListResourceRecordSetsInput{\n        HostedZoneId: aws.String(\"Z2798GPJN9CUFJ\"), // Required\n        // StartRecordType: aws.String(\"CNAME\"),\n    }\n    respList, err := svc.ListResourceRecordSets(listParams)\n\n    if err != nil {\n        fmt.Println(err.Error())\n        return\n    }\n\n    // Pretty-print the response data.\n    fmt.Println(\"All records:\")\n    fmt.Println(respList)\n</code></pre>\n\n<p>edit: oh, additionally, the StartRecordType with the value \"CNAME\" throws a validation error, so I'm not sure what I should be using there.</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 10803, "user_id": 2548147, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cfKie.jpg?s=128&g=1", "display_name": "Raymond Nijland", "link": "https://stackoverflow.com/users/2548147/raymond-nijland"}, "edited": false, "score": 0, "creation_date": 1556732611, "post_id": 55940084, "comment_id": 98533846, "body": "<i>&quot;I don&#39;t know where I&#39;ve made a mistake.&quot;</i> Execute <code>SELECT @@sql_mode;</code> ? and paste it here.."}, {"owner": {"reputation": 10803, "user_id": 2548147, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cfKie.jpg?s=128&g=1", "display_name": "Raymond Nijland", "link": "https://stackoverflow.com/users/2548147/raymond-nijland"}, "edited": false, "score": 1, "creation_date": 1556732892, "post_id": 55940084, "comment_id": 98534006, "body": "As i&#225;m pretty sure your MySQL server seams to be running without SQL mode <code>STRICT_TRANS_TABLES</code> see <a href=\"https://www.db-fiddle.com/f/tQW1j2p5nwJjjg2nr9G1mL/2\" rel=\"nofollow noreferrer\">without</a> and <a href=\"https://www.db-fiddle.com/f/tQW1j2p5nwJjjg2nr9G1mL/1\" rel=\"nofollow noreferrer\">with</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556733291, "post_id": 55940084, "comment_id": 98534192, "body": "You were expecting it to return an error? An error at the DB layer should be a worst-case scenario; something before that should be sanitizing and validating user inputs. I.e., if you don&#39;t want nulls/empties inserted into the DB, they should never make it to your <code>CreateSeller</code> function."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1556734158, "post_id": 55940084, "comment_id": 98534590, "body": "A couple of things: What does <code>seller</code> actually look like, are the fields populated (remember: empty strings are <i>not</i> nil/NULL values)? More over: you create a prepared statement, but that resource is never closed, after the error check on <code>r.db.Prepare()</code>, add a <code>defer stmt.Close()</code>, please."}, {"owner": {"reputation": 595, "user_id": 8447389, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/cfd0136eaadadee6140932e796939f69?s=128&d=identicon&r=PG&f=1", "display_name": "xaos_xv", "link": "https://stackoverflow.com/users/8447389/xaos-xv"}, "reply_to_user": {"reputation": 10803, "user_id": 2548147, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cfKie.jpg?s=128&g=1", "display_name": "Raymond Nijland", "link": "https://stackoverflow.com/users/2548147/raymond-nijland"}, "edited": false, "score": 0, "creation_date": 1556739860, "post_id": 55940084, "comment_id": 98536816, "body": "@RaymondNijland <code>+--------------------------------------------+ | @@sql_mode                                 | +--------------------------------------------+ | NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION | +--------------------------------------------+ </code>"}], "answers": [{"comments": [{"owner": {"reputation": 595, "user_id": 8447389, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/cfd0136eaadadee6140932e796939f69?s=128&d=identicon&r=PG&f=1", "display_name": "xaos_xv", "link": "https://stackoverflow.com/users/8447389/xaos-xv"}, "edited": false, "score": 0, "creation_date": 1556740486, "post_id": 55941199, "comment_id": 98537085, "body": "It&#39;s working. You&#39;re right, Go wasn&#39;t inserting null but empty string. I changed <code>string</code> to <code>sql.NullString</code> in my model and now everything works correctly."}], "tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 4, "last_activity_date": 1556939976, "last_edit_date": 1556939976, "creation_date": 1556736909, "answer_id": 55941199, "question_id": 55940084, "link": "https://stackoverflow.com/questions/55940084/go-mysql-inserts-even-when-if-not-null-set/55941199#55941199", "title": "Go - MySQL inserts even when if NOT NULL set", "body": "<p>Go isn't inserting <code>null</code>s in your table, it is inserting empty strings. Your code is effectively doing this:</p>\n\n<pre><code>seller := Seller{}\nseller.SellerName = \"testt\"\n</code></pre>\n\n<p>to create the <code>seller</code> that you're inserting. So all the fields in your <code>seller</code> except <code>SellerName</code> will have the zero value for their type; the fields causing you trouble are <code>string</code>s and the zero value of a <code>string</code> is <code>\"\"</code> (i.e an empty string) so the SQL ends up looking like:</p>\n\n<pre><code>INSERT INTO seller (name, contact, ...)\nVALUES ('testt', '', ...)\n</code></pre>\n\n<p>and there isn't a NULL in sight.</p>\n\n<p>You could validate the incoming data in Go so that empty strings are rejected, you could use <a href=\"https://golang.org/pkg/database/sql/#NullString\" rel=\"nofollow noreferrer\"><code>NullString</code></a> instead of <code>string</code> and let the database deal with <code>NULL</code>s (assuming MySQL is properly configured), or do both.</p>\n"}, {"tags": [], "owner": {"reputation": 1972, "user_id": 1606146, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JhyjQ.png?s=128&g=1", "display_name": "Grigoreas P.", "link": "https://stackoverflow.com/users/1606146/grigoreas-p"}, "is_accepted": false, "score": 0, "last_activity_date": 1558090239, "creation_date": 1558090239, "answer_id": 56184924, "question_id": 55940084, "link": "https://stackoverflow.com/questions/55940084/go-mysql-inserts-even-when-if-not-null-set/56184924#56184924", "title": "Go - MySQL inserts even when if NOT NULL set", "body": "<p>Yes, because when it comes to Mysql: \nemtpy string (e.g '') is NOT a null. \nIt treats it like being a string (only empty).</p>\n"}], "owner": {"reputation": 595, "user_id": 8447389, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/cfd0136eaadadee6140932e796939f69?s=128&d=identicon&r=PG&f=1", "display_name": "xaos_xv", "link": "https://stackoverflow.com/users/8447389/xaos-xv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 55941199, "answer_count": 2, "score": 0, "last_activity_date": 1558090239, "creation_date": 1556731441, "question_id": 55940084, "link": "https://stackoverflow.com/questions/55940084/go-mysql-inserts-even-when-if-not-null-set", "title": "Go - MySQL inserts even when if NOT NULL set", "body": "<p>I'm writing simple API in Go using MySQL but my MySQL code inserts data to row even the column is set to <code>NOT NULL</code>. Here is my code:</p>\n\n<p>schema.sql</p>\n\n<pre><code>CREATE TABLE IF NOT EXISTS seller (\n    seller_id int NOT NULL AUTO_INCREMENT,\n    name varchar(255) NOT NULL UNIQUE,\n    contact varchar(255) NOT NULL,\n    street varchar(255) NOT NULL,\n    city varchar(255) NOT NULL,\n    nip varchar(255) NOT NULL UNIQUE,\n    bank varchar(255) NOT NULL,\n    account_number varchar(255) NOT NULL UNIQUE,\n    PRIMARY KEY (seller_id)\n);\n</code></pre>\n\n<p>database/mysql/invoice.go</p>\n\n<pre><code>func (r *invoiceRepository) CreateSeller(seller *invoice.Seller) error {\n        query := \"INSERT INTO seller (name, contact, street, city, nip, bank, account_number) VALUES (?, ?, ?, ?, ?, ?, ?)\"\n        stmt, err := r.db.Prepare(query)\n        if err != nil {\n                log.Errorf(\"Unable to create seller %s: %v\", seller.SellerName, err)\n                return err\n        }\n\n        res, err := stmt.Exec(&amp;seller.SellerName, &amp;seller.SellerContact, &amp;seller.SellerStreet, &amp;seller.SellerCity, &amp;seller.SellerNIP, &amp;seller.SellerBank, &amp;seller.SellerAccountNumber)\n        if err != nil {\n                log.Errorf(\"Error while creating seller: %v\", err)\n                return err\n        }\n\n        newID, err := res.LastInsertId()\n        if err != nil {\n                log.Errorf(\"Error while getting inserted id: %v\", err)\n                return err\n        }\n\n        log.Infof(\"Created seller %s [id=%d]\", seller.SellerName, newID)\n        return nil\n}\n</code></pre>\n\n<p>Now when I'm making a POST request (using httpie) with the only seller_name my code creates row even with null columns. It looks like this:\n<code>http POST localhost:8000/api/seller/create seller_name=testt</code></p>\n\n<p>Here is how my row looks in table:</p>\n\n<pre><code>+-----------+-------+---------+--------+------+-----+------+----------------+\n| seller_id | name  | contact | street | city | nip | bank | account_number |\n+-----------+-------+---------+--------+------+-----+------+----------------+\n|         1 | testt |         |        |      |     |      |                |\n+-----------+-------+---------+--------+------+-----+------+----------------+\n</code></pre>\n\n<p>I don't know where I've made a mistake.</p>\n\n<p>EDIT (added model)</p>\n\n<pre><code>type Seller struct {\n        SellerID            int64  `json:\"seller_id\"`\n        SellerName          string `json:\"seller_name\"`\n        SellerContact       string `json:\"seller_contact\"`\n        SellerStreet        string `json:\"seller_street\"`\n        SellerCity          string `json:\"seller_city\"`\n        SellerNIP           string `json:\"seller_nip\"`\n        SellerBank          string `json:\"seller_bank\"`\n        SellerAccountNumber string `json:\"seller_account_number\"`\n}\n</code></pre>\n"}, {"tags": ["ios", "go", "clang", "cydia", "unix-ar"], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 11437242, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-hWHKnV-7Y4o/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re2hmorComje8PyZQEQVHoBunAVVg/mo/photo.jpg?sz=128", "display_name": "Elias Naur", "link": "https://stackoverflow.com/users/11437242/elias-naur"}, "is_accepted": false, "score": 0, "last_activity_date": 1556724533, "creation_date": 1556724533, "answer_id": 55938693, "question_id": 55937319, "link": "https://stackoverflow.com/questions/55937319/creating-static-archives-with-ar-or-libtool-fails-on-jailbroken-ios/55938693#55938693", "title": "Creating static archives with ar or libtool fails on jailbroken iOS", "body": "<p>I worked around the problem by using llvm-ar. The command line flags are slightly different, but at least I now have a working archive.</p>\n"}], "owner": {"reputation": 11, "user_id": 11437242, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-hWHKnV-7Y4o/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re2hmorComje8PyZQEQVHoBunAVVg/mo/photo.jpg?sz=128", "display_name": "Elias Naur", "link": "https://stackoverflow.com/users/11437242/elias-naur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 241, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1556724533, "creation_date": 1556718641, "question_id": 55937319, "link": "https://stackoverflow.com/questions/55937319/creating-static-archives-with-ar-or-libtool-fails-on-jailbroken-ios", "title": "Creating static archives with ar or libtool fails on jailbroken iOS", "body": "<p>I'm trying to build and run Go on a self-hosted jailbroken iOS device (Corellium virtual devices). Go bootstraps and can build and run regular binaries. However, Go archives fail to build because ar doesn't work:</p>\n\n<pre><code>$ dpkg -S /usr/bin/clang /usr/bin/ar /usr/bin/libtool\norg.coolstar.llvm-clang64: /usr/bin/clang\norg.coolstar.cctools: /usr/bin/ar\norg.coolstar.cctools: /usr/bin/libtool\n$ apt policy org.coolstar.cctools org.coolstar.llvm-clang64\norg.coolstar.cctools:\n  Installed: 895\n  Candidate: 895\n  Version table:\n *** 895 500\n        500 http://apt.thebigboss.org/repofiles/cydia stable/main iphoneos-arm Packages\n        100 /Library/dpkg/status\norg.coolstar.llvm-clang64:\n  Installed: 5.0.1-2\n  Candidate: 5.0.1-2\n  Version table:\n *** 5.0.1-2 500\n        500 http://apt.thebigboss.org/repofiles/cydia stable/main iphoneos-arm Packages\n        100 /Library/dpkg/status\n\n$ ../bin/go build -buildmode=c-archive -ldflags=\"-v\" -work ../misc/ios/detect.go\nWORK=/tmp/go-build734936238\n# command-line-arguments\nHEADER = -H1 -T0x2000 -R0x1000\n 0.00 deadcode\n 0.05 symsize = 0\n 0.08 pclntab=740717 bytes, funcdata total 185492 bytes\n 0.08 dodata\n 0.08 symsize = 0\n 0.08 symsize = 0\n 0.09 dynreloc\n 0.09 dwarf\n 0.12 asmb\n 0.13 datblk\n 0.14 reloc\n 0.20 sym\n 0.22 header\narchive: ar -q -c -s $WORK/b001/exe/a.out.a /tmp/go-link-569975294/go.o /tmp/go-link-569975294/000000.o /tmp/go-link-569975294/000001.o /tmp/go-link-569975294/000002.o /tmp/go-link-569975294/000003.o /tmp/go-link-569975294/000004.o /tmp/go-link-569975294/000005.o /tmp/go-link-569975294/000006.o /tmp/go-link-569975294/000007.o /tmp/go-link-569975294/000008.o /tmp/go-link-569975294/000009.o /tmp/go-link-569975294/000010.o /tmp/go-link-569975294/000011.o /tmp/go-link-569975294/000012.o /tmp/go-link-569975294/000013.o /tmp/go-link-569975294/000014.o\n/var/mobile/go-tip/pkg/tool/darwin_arm64/link: running ar failed: exit status 1\nfatal error: ar: can't find or exec: /usr/bin/arm64-apple-darwin14-ranlib (No such file or directory)\nar: internal ranlib command failed\n</code></pre>\n\n<p>Optimistic as I am, I tried symlinking ranlib:</p>\n\n<pre><code># ln -s /usr/bin/ranlib /usr/bin/arm64-apple-darwin14-ranlib\n$ ../bin/go build -buildmode=c-archive -ldflags=\"-v\" -work ../misc/ios/detect.go\nWORK=/tmp/go-build239621581\n# command-line-arguments\nHEADER = -H1 -T0x2000 -R0x1000\n 0.00 deadcode\n 0.06 symsize = 0\n 0.08 pclntab=740717 bytes, funcdata total 185492 bytes\n 0.08 dodata\n 0.09 symsize = 0\n 0.09 symsize = 0\n 0.09 dynreloc\n 0.10 dwarf\n 0.12 asmb\n 0.13 datblk\n 0.15 reloc\n 0.20 sym\n 0.22 header\narchive: ar -q -c -s $WORK/b001/exe/a.out.a /tmp/go-link-618780113/go.o /tmp/go-link-618780113/000000.o /tmp/go-link-618780113/000001.o /tmp/go-link-618780113/000002.o /tmp/go-link-618780113/000003.o /tmp/go-link-618780113/000004.o /tmp/go-link-618780113/000005.o /tmp/go-link-618780113/000006.o /tmp/go-link-618780113/000007.o /tmp/go-link-618780113/000008.o /tmp/go-link-618780113/000009.o /tmp/go-link-618780113/000010.o /tmp/go-link-618780113/000011.o /tmp/go-link-618780113/000012.o /tmp/go-link-618780113/000013.o /tmp/go-link-618780113/000014.o\n/var/mobile/go-tip/pkg/tool/darwin_arm64/link: running ar failed: exit status 1\n/usr/bin/arm64-apple-darwin14-ranlib: archive member: $WORK/b001/exe/a.out.a(go.o) offset in archive not a multiple of 8 (must be since member is an 64-bit object file)\nfatal error: ar: fatal error in /usr/bin/arm64-apple-darwin14-ranlib\n</code></pre>\n\n<p>I even switched Go to use libtool:</p>\n\n<pre><code>$ ../bin/go build -buildmode=c-archive -ldflags=\"-v\" -work ../misc/ios/detect.go\nWORK=/tmp/go-build502332895\n# command-line-arguments\nHEADER = -H1 -T0x2000 -R0x1000\n 0.00 deadcode\n 0.04 symsize = 0\n 0.08 pclntab=740717 bytes, funcdata total 185492 bytes\n 0.08 dodata\n 0.08 symsize = 0\n 0.09 symsize = 0\n 0.09 dynreloc\n 0.10 dwarf\n 0.12 asmb\n 0.14 datblk\n 0.15 reloc\n 0.20 sym\n 0.22 header\narchive: libtool -static -o $WORK/b001/exe/a.out.a /tmp/go-link-320669019/go.o /tmp/go-link-320669019/000000.o /tmp/go-link-320669019/000001.o /tmp/go-link-320669019/000002.o /tmp/go-link-320669019/000003.o /tmp/go-link-320669019/000004.o /tmp/go-link-320669019/000005.o /tmp/go-link-320669019/000006.o /tmp/go-link-320669019/000007.o /tmp/go-link-320669019/000008.o /tmp/go-link-320669019/000009.o /tmp/go-link-320669019/000010.o /tmp/go-link-320669019/000011.o /tmp/go-link-320669019/000012.o /tmp/go-link-320669019/000013.o /tmp/go-link-320669019/000014.o\n/var/mobile/go-tip/pkg/tool/darwin_arm64/link: running libtool failed: signal: segmentation fault\n</code></pre>\n\n<p>Now, ar (with symlinked ranlib) fails on even simple object files:</p>\n\n<pre><code>$ cat blah.c\nint blah() {\n    return 0;\n}\n$ clang -c blah.c\n$ ar -q -c -s blah.a blah.o\n/usr/bin/arm64-apple-darwin14-ranlib: archive member: blah.a(blah.o) offset in archive not a multiple of 8 (must be since member is an 64-bit object file)\n</code></pre>\n\n<p>Libtool works:</p>\n\n<pre><code>$ libtool -static -o blah.a blah.o\n</code></pre>\n\n<p>But segfaults on more complex object files as seen above.</p>\n\n<p>Go can already successfully create archives using the Xcode ar tool. It's only the iOS native \"cctools\" version that fails.</p>\n"}, {"tags": ["go", "yaml"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1556707646, "post_id": 55934961, "comment_id": 98522693, "body": "<code>test = append(configs, configs...)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 11436599, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4b74vAfzTTg/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcrnMzcXnK_hnPynjTE1baYvboldA/mo/photo.jpg?sz=128", "display_name": "Danil Fomichev", "link": "https://stackoverflow.com/users/11436599/danil-fomichev"}, "edited": false, "score": 0, "creation_date": 1556708506, "post_id": 55935045, "comment_id": 98523003, "body": "Thank you. But it changes nothing. Error is identical:   cannot use test (type MapUsers) as type struct...."}, {"owner": {"reputation": 11, "user_id": 11436599, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4b74vAfzTTg/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcrnMzcXnK_hnPynjTE1baYvboldA/mo/photo.jpg?sz=128", "display_name": "Danil Fomichev", "link": "https://stackoverflow.com/users/11436599/danil-fomichev"}, "edited": false, "score": 0, "creation_date": 1556709128, "post_id": 55935045, "comment_id": 98523237, "body": "now I am getting the following:  cannot unmarshal !!map into main.MapUsers"}, {"owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "reply_to_user": {"reputation": 11, "user_id": 11436599, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4b74vAfzTTg/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcrnMzcXnK_hnPynjTE1baYvboldA/mo/photo.jpg?sz=128", "display_name": "Danil Fomichev", "link": "https://stackoverflow.com/users/11436599/danil-fomichev"}, "edited": false, "score": 0, "creation_date": 1556709855, "post_id": 55935045, "comment_id": 98523508, "body": "I see that you are not adding my changes to your code. Append line is still wrong and configs is still not a slice. Please take a look at tutorials on the internet and start with something easier like integers to learn how slices work. <a href=\"http://ghodss.com/2014/the-right-way-to-handle-yaml-in-golang/\" rel=\"nofollow noreferrer\">ghodss.com/2014/the-right-way-to-handle-yaml-in-golang</a>"}, {"owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "reply_to_user": {"reputation": 11, "user_id": 11436599, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4b74vAfzTTg/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcrnMzcXnK_hnPynjTE1baYvboldA/mo/photo.jpg?sz=128", "display_name": "Danil Fomichev", "link": "https://stackoverflow.com/users/11436599/danil-fomichev"}, "edited": false, "score": 0, "creation_date": 1556710427, "post_id": 55935045, "comment_id": 98523732, "body": "Welcome to the world of Go :)"}], "tags": [], "owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "is_accepted": false, "score": 2, "last_activity_date": 1556708819, "last_edit_date": 1556708819, "creation_date": 1556707829, "answer_id": 55935045, "question_id": 55934961, "link": "https://stackoverflow.com/questions/55934961/go-returns-error-when-trying-to-append-structure-of-the-same-type/55935045#55935045", "title": "Go returns error when trying to append structure of the same type", "body": "<p>Your append syntax seems wrong. It should be like this.</p>\n\n<p><code>configs=append(configs,test)</code></p>\n\n<p><code>append</code> function a new slice including your new struct, so you take it and put to your old <code>configs</code> variable.</p>\n\n<p>From golang tour: <a href=\"https://tour.golang.org/moretypes/15\" rel=\"nofollow noreferrer\">https://tour.golang.org/moretypes/15</a></p>\n\n<p>EDIT after comment:</p>\n\n<p>I didn't realize that your <code>configs</code> was not a slice. It should be as follows:</p>\n\n<p><code>var configs []MapUsers</code></p>\n\n<p>There should be a <code>[]</code> before the type to show that it's a slice.</p>\n"}], "owner": {"reputation": 11, "user_id": 11436599, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-4b74vAfzTTg/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcrnMzcXnK_hnPynjTE1baYvboldA/mo/photo.jpg?sz=128", "display_name": "Danil Fomichev", "link": "https://stackoverflow.com/users/11436599/danil-fomichev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1556774416, "creation_date": 1556707359, "last_edit_date": 1556774416, "question_id": 55934961, "link": "https://stackoverflow.com/questions/55934961/go-returns-error-when-trying-to-append-structure-of-the-same-type", "title": "Go returns error when trying to append structure of the same type", "body": "<p>I am getting error trying to merge two structures using append function:</p>\n\n<pre><code>./test.go:33:18: cannot use configs (type MapUsers) as type struct { Userarn string \"yaml:\\\"userarn\\\"\"; Username string \"yaml:\\\"username\\\"\"; Groups []string \"yaml:\\\"groups\\\"\" } in append\n</code></pre>\n\n<p>Here is the code. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n  \"fmt\"\n  \"gopkg.in/yaml.v2\"\n  \"io/ioutil\"\n  \"os\"\n)\n\n\n\ntype MapUsers []struct {\n    Userarn  string\n    Username string\n    Groups   []string \n}\n\n\nfunc main() {\n    filename := os.Args[1]\n    var configs MapUsers\n\n    source, err := ioutil.ReadFile(filename)\n    if err != nil {\n        panic(err)\n    }\n    err = yaml.Unmarshal(source, &amp;configs)\n    if err != nil {\n        panic(err)\n    }\n\n    configs = append(configs, configs)\n    fmt.Printf(\"Value: %#v\\n\", configs)\n\n\n}\n</code></pre>\n\n<p>Here is the data:</p>\n\n<pre><code>- userarn: \"aaaaaaaaaaaa\"\n  username: \"bbbbbbbbbb\"\n  groups:\n    - \"ccccccccccc\"\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["go", "struct", "reflection", "types"], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 9487414, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-RPNNiWhePUU/AAAAAAAAAAI/AAAAAAAAAHY/x9ECES-Kbi8/photo.jpg?sz=128", "display_name": "Nagaraja SV", "link": "https://stackoverflow.com/users/9487414/nagaraja-sv"}, "edited": false, "score": 0, "creation_date": 1556718187, "post_id": 55934368, "comment_id": 98527055, "body": "I have updated my answer little confusing use in the above code I will get dynamic JSON from the frontend, how I can convert to a struct to insert data to datastore."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556718281, "post_id": 55934368, "comment_id": 98527102, "body": "While this is a great solution to the posted question, I would very strongly discourage using it. This seems like a nightmare to manage, slow to run, and in the end very likely to be pointless. Compile-time structs or maps are almost certainly the better solution."}, {"owner": {"reputation": 75, "user_id": 9487414, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-RPNNiWhePUU/AAAAAAAAAAI/AAAAAAAAAHY/x9ECES-Kbi8/photo.jpg?sz=128", "display_name": "Nagaraja SV", "link": "https://stackoverflow.com/users/9487414/nagaraja-sv"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556718776, "post_id": 55934368, "comment_id": 98527351, "body": "@Adrian any suggestion"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1556719317, "post_id": 55934368, "comment_id": 98527626, "body": "@Adrian Yes, this is exactly what I suggest in my first paragraph, the &quot;rest&quot; is to answer the question."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556720585, "post_id": 55934368, "comment_id": 98528206, "body": "Yep, just a second vote for &quot;really, don&#39;t do this, even though it&#39;s possible&quot;!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1556741636, "last_edit_date": 1556741636, "creation_date": 1556703917, "answer_id": 55934368, "question_id": 55934210, "link": "https://stackoverflow.com/questions/55934210/creating-structs-programmatically-at-runtime-possible/55934368#55934368", "title": "Creating structs programmatically at runtime - possible?", "body": "<p><strong>Edit:</strong> Your edit reveals you want to handle dynamic objects to put / retrieve from Google Datastore. For this it is completely unnecessary to create struct types at runtime, you may just use a dynamic map presented in this answer: <a href=\"https://stackoverflow.com/questions/29885431/how-can-i-have-dynamic-properties-in-go-on-the-google-app-engine-datastore/29888449#29888449\">How can I have dynamic properties in go on the google app engine datastore</a>.</p>\n\n<p>Original answer follows.</p>\n\n<hr>\n\n<p>Note that if the types are known at compile time, best / most efficient is to create the types and compile them, so everything will be \"static\". You may create the types manually, or you may use <code>go generate</code> to automate the process.</p>\n\n<p>Also note that you may not necessarily need struct types to model dynamic objects, many times maps may be sufficient.</p>\n\n<p>If types are not known at compile time, and struct types are a must, read on.</p>\n\n<p><strong>Yes, it's possible to create \"dynamic\" struct types at runtime</strong> using Go's reflection, specifically with the <a href=\"https://golang.org/pkg/reflect/#StructOf\" rel=\"nofollow noreferrer\"><code>reflect.StructOf()</code></a> function.</p>\n\n<p>Let's see a simple example, creating a struct type at runtime that has a <code>Name string</code> and an <code>Age int</code> field:</p>\n\n<pre><code>t := reflect.StructOf([]reflect.StructField{\n    {\n        Name: \"Name\",\n        Type: reflect.TypeOf(\"\"), // string\n    },\n    {\n        Name: \"Age\",\n        Type: reflect.TypeOf(0), // int\n    },\n})\n\nfmt.Println(t)\n\nv := reflect.New(t)\nfmt.Printf(\"%+v\\n\", v)\nv.Elem().FieldByName(\"Name\").Set(reflect.ValueOf(\"Bob\"))\nv.Elem().FieldByName(\"Age\").Set(reflect.ValueOf(12))\n\nfmt.Printf(\"%+v\\n\", v)\n</code></pre>\n\n<p>This outputs (try it on the <a href=\"https://play.golang.org/p/4s2YPLKLUhd\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>struct { Name string; Age int }\n&amp;{Name: Age:0}\n&amp;{Name:Bob Age:12}\n</code></pre>\n\n<p>If you want to define validation rules, you may use a 3rd party lib for that, for example <a href=\"https://github.com/go-validator/validator\" rel=\"nofollow noreferrer\"><code>github.com/go-validator/validator</code></a>. This package uses <a href=\"https://stackoverflow.com/questions/10858787/what-are-the-uses-for-tags-in-go/30889373#30889373\">struct tags</a> to specify validation rules, struct tags which you may also specify using reflection.</p>\n\n<p>For example, if you want to specify that the <code>Name</code> must be at least 3 characters and 40 at most, and it may only contain letters of the English alphabet, and valid range for <code>Age</code> is <code>6..100</code> (both inclusive), this is how it would look like:</p>\n\n<pre><code>t := reflect.StructOf([]reflect.StructField{\n    {\n        Name: \"Name\",\n        Type: reflect.TypeOf(\"\"), // string\n        Tag:  reflect.StructTag(`validate:\"min=3,max=40,regexp=^[a-zA-Z]*$\"`),\n    },\n    {\n        Name: \"Age\",\n        Type: reflect.TypeOf(0), // int\n        Tag:  reflect.StructTag(`validate:\"min=6,max=100\"`),\n    },\n})\n</code></pre>\n\n<p>Printing this type would output (wrapped by me) (try it on the <a href=\"https://play.golang.org/p/W3h7fyqnKQb\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>struct { Name string \"validate:\\\"min=3,max=40,regexp=^[a-zA-Z]*$\\\"\";\n    Age int \"validate:\\\"min=6,max=100\\\"\" }\n</code></pre>\n\n<p>Once you create an instance of this struct, you can validate it using the <a href=\"https://godoc.org/gopkg.in/validator.v2#Validate\" rel=\"nofollow noreferrer\"><code>validator.Validate()</code></a> function, e.g.:</p>\n\n<pre><code>v := reflect.New(t)\nv.Elem().FieldByName(\"Name\").Set(reflect.ValueOf(\"Bob\"))\nv.Elem().FieldByName(\"Age\").Set(reflect.ValueOf(12))\n\nif errs := validator.Validate(v.Elem().Interface()); errs != nil {\n    // values not valid, deal with errors here\n}\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 9487414, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-RPNNiWhePUU/AAAAAAAAAAI/AAAAAAAAAHY/x9ECES-Kbi8/photo.jpg?sz=128", "display_name": "Nagaraja SV", "link": "https://stackoverflow.com/users/9487414/nagaraja-sv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 542, "favorite_count": 0, "accepted_answer_id": 55934368, "answer_count": 1, "score": 1, "last_activity_date": 1556741636, "creation_date": 1556703068, "last_edit_date": 1556720743, "question_id": 55934210, "link": "https://stackoverflow.com/questions/55934210/creating-structs-programmatically-at-runtime-possible", "title": "Creating structs programmatically at runtime - possible?", "body": "<p>Is it possible in Go to create a struct type programmatically (i.e. not in the compiled source code)?</p>\n\n<p>We have a particular use case where a type will be created via user-defined metadata (so the schema/types are not known in advance)\nand will vary for every customer. We would then need to auto-generate REST services for those and persist them in a NoSQL backend.\nWe would also need to define different dynamic validators per field (e.g. mandatory, regex, max/min size, max/min value, a reference to another type instance, etc.)</p>\n\n<p>I was wondering if something similar is possible in the Go?</p>\n\n<p><strong>Edit 1:</strong></p>\n\n<p>For example </p>\n\n<blockquote>\n  <p>From frontend in JSON</p>\n</blockquote>\n\n<pre><code>For customer 1:\n{\n\"id\":1,\n\"patientid\":1,\n\"name\":\"test1\",\n\"height\":\"160\",\n\"weight\":\"70\",\n\"temp\":\"98\"\n}\n\nFor customer 2:\n{\n\"id\":2,\n\"patientid\":1,\n\"name\":\"test1\",\n\"height\":\"160\",\n\"weight\":\"70\"\n}\n\nFor customer 3\n\nmay be different new fields will add\n</code></pre>\n\n<blockquote>\n  <p>Backend</p>\n</blockquote>\n\n<pre><code>// For One customer need to have these fields \n\ntype Vitalsigns struct {\n    ID                int64  `datastore:\"-\"`\n    PatientID         int64  `json:\"patientid,omitempty\"`\n    Name              string `json:\"name,omitempty\"`\n    Height            string `json:\"height,omitempty\"`\n    Weight            string `json:\"weight,omitempty\"`\n    Temp              string `json:\"temp,omitempty\"`\n}\n\n\n\n// Another need to have these fields\n\ntype Vitalsigns struct {\n    ID                int64  `datastore:\"-\"`\n    PatientID         int64  `json:\"patientid,omitempty\"`\n    Name              string `json:\"name,omitempty\"`\n    Height            string `json:\"height,omitempty\"`\n    Weight            string `json:\"weight,omitempty\"`\n}\n\n\n//CreateVitalsignsHandler is to create vitals for a patient\nfunc CreateVitalsignsHandler(w http.ResponseWriter, r *http.Request, ps httprouter.Params) {\n\n    //Creating the Vitalsigns\n    kinVitalsigns := &amp;Vitalsigns{}\n    ctx := appengine.NewContext(r)\n    if err := json.NewDecoder(r.Body).Decode(kinVitalsigns); err != nil {\n        RespondErr(w, r, http.StatusInternalServerError, err.Error())\n        return\n    }\n    //Getting namespace\n    namespace := ps.ByName(\"namespace\")\n    ctx, err := appengine.Namespace(ctx, namespace)\n    if err != nil {\n        log.Infof(ctx, \"Namespace error from CreateVitalsignsHandler\")\n        RespondErr(w, r, http.StatusInternalServerError, err.Error())\n        return\n    }\n    //Geting the patientID\n    pID, err := strconv.Atoi(ps.ByName(\"id\"))\n    if err != nil {\n        log.Infof(ctx, \"Srting to Int64 conversion error from CreateVitalsignsHandler\")\n        RespondErr(w, r, http.StatusInternalServerError, err.Error())\n        return\n    }\n    patientID := int64(pID)\n    kinVitalsigns.PatientID = patientID\n\n    //Generating the key\n    vitalsignsKey := datastore.NewIncompleteKey(ctx, \"Vitalsigns\", nil)\n\n    //Inserting the data to the datastore\n    vk, err := datastore.Put(ctx, vitalsignsKey, kinVitalsigns)\n    if err != nil {\n        log.Infof(ctx, \"Entity creation was failed from CreateVitalsignsHandler\")\n        RespondErr(w, r, http.StatusInternalServerError, err.Error())\n        return\n    }\n    kinVitalsigns.ID = vk.IntID()\n    message := \"Vitalsigns created successfully!! \"\n    Respond(w, r, http.StatusOK, SuccessResponse{kinVitalsigns.ID, 0, \"\", message})\n    return\n}\n</code></pre>\n"}, {"tags": ["xml", "go", "encoding", "marshalling", "sqlx"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1556699454, "post_id": 55933508, "comment_id": 98519754, "body": "Have you tried wrapping it in a struct holding the slice?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1556699782, "post_id": 55933508, "comment_id": 98519868, "body": "... <a href=\"https://play.golang.org/p/Ggo2_B191oF\" rel=\"nofollow noreferrer\">play.golang.org/p/Ggo2_B191oF</a>"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1556701807, "post_id": 55933508, "comment_id": 98520572, "body": "The XML is also correct, regardless of wether this is what you wanted. You were writing numerous XML documents with the root element <code>Customer</code> to the same file."}, {"owner": {"reputation": 11, "user_id": 9492624, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-wEoP9aP2xWU/AAAAAAAAAAI/AAAAAAAAATQ/XqCedyYDPjo/photo.jpg?sz=128", "display_name": "W Mettler", "link": "https://stackoverflow.com/users/9492624/w-mettler"}, "edited": false, "score": 0, "creation_date": 1556705853, "post_id": 55933508, "comment_id": 98522039, "body": "So i just got confused. Question then is what the rest clients can work with to consume data or is it bad practice to send multiple xml documents in a rest responce? Browsers couldn&#39;t display the resulting xml."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1556781901, "post_id": 55933508, "comment_id": 98547613, "body": "Interesting. As per convention, I would always expect a single entity as a response. As for your JSON, that would be fulfilled, as a single entity of type list is returned, whereas your XML would be multiple independent documents. I personally would adhere to the single response entity, simply because it is not wrong in both cases. Especially for XML, assuming that there is some sort of validity check on the other end (we always validate XML responses and requests against XSDs) I would prefer to have to run it a single time instead of multiple times. Questions regarding atomicity raise, too."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1556782026, "post_id": 55933508, "comment_id": 98547684, "body": "@WMettler Please <a href=\"https://stackoverflow.com/posts/55933508/edit\">add your elaboration to your question</a> - it makes it much more interesting and relevant."}, {"owner": {"reputation": 11, "user_id": 9492624, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-wEoP9aP2xWU/AAAAAAAAAAI/AAAAAAAAATQ/XqCedyYDPjo/photo.jpg?sz=128", "display_name": "W Mettler", "link": "https://stackoverflow.com/users/9492624/w-mettler"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1556794753, "post_id": 55933508, "comment_id": 98554032, "body": "@mkopriva I tried putting it in a separate struct, but i don&#39;t know how i can do that using sqlx. What i have so far does not compile"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1556795078, "post_id": 55933508, "comment_id": 98554195, "body": "@WMettler <a href=\"https://play.golang.org/p/Hel7OQ9zi80\" rel=\"nofollow noreferrer\">play.golang.org/p/Hel7OQ9zi80</a> no need to force the xml specific solution onto sqlx or json."}], "answers": [{"comments": [{"owner": {"reputation": 2867, "user_id": 2867881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/61Npk.jpg?s=128&g=1", "display_name": "Vikash Pathak", "link": "https://stackoverflow.com/users/2867881/vikash-pathak"}, "edited": false, "score": 0, "creation_date": 1556703486, "post_id": 55934270, "comment_id": 98521172, "body": "Here is the official documentation you can follow. <a href=\"https://golang.org/pkg/encoding/xml/#Marshal\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/xml/#Marshal</a>"}], "tags": [], "owner": {"reputation": 2867, "user_id": 2867881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/61Npk.jpg?s=128&g=1", "display_name": "Vikash Pathak", "link": "https://stackoverflow.com/users/2867881/vikash-pathak"}, "is_accepted": false, "score": 0, "last_activity_date": 1556703403, "creation_date": 1556703403, "answer_id": 55934270, "question_id": 55933508, "link": "https://stackoverflow.com/questions/55933508/xml-marshalling-generates-xml-without-root/55934270#55934270", "title": "XML Marshalling generates XML without Root", "body": "<p>You must have to wrap this customer collection inside another struct as</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n\n    type Customer struct {\n        XMLName   xml.Name `xml:\"Customer\"`\n        CustomerID int            `db:\"CustomerId\"`\n        FirstName  string         `db:\"FirstName\"`\n        LastName   string         `db:\"LastName\"`\n        Company    string `db:\"Company\"`\n    }\n\n    type Customers struct {\n        List []Customer\n    }\n\n    csts := []Customer{\n        Customer{CustomerID: 1, FirstName: \"John\", LastName: \"Doe\", Company: \"Demo Company\"},\n        Customer{CustomerID: 2, FirstName: \"John2\", LastName: \"Doe2\", Company: \"Demo Company2\"},\n    }\n\n\n    res := Customers {\n        List: csts,\n    }\n\n    output, err := xml.MarshalIndent(res, \"  \", \"    \")\n    if err != nil {\n        fmt.Printf(\"error: %v\\n\", err)\n    }\n\n    os.Stdout.Write(output)\n}\n</code></pre>\n\n<p>Default it could take the name of construct. You can also customized the name using xml.Name type.</p>\n"}], "owner": {"reputation": 11, "user_id": 9492624, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-wEoP9aP2xWU/AAAAAAAAAAI/AAAAAAAAATQ/XqCedyYDPjo/photo.jpg?sz=128", "display_name": "W Mettler", "link": "https://stackoverflow.com/users/9492624/w-mettler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 179, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1556793270, "creation_date": 1556699252, "last_edit_date": 1556793270, "question_id": 55933508, "link": "https://stackoverflow.com/questions/55933508/xml-marshalling-generates-xml-without-root", "title": "XML Marshalling generates XML without Root", "body": "<p>I am working on a rest api in golang and was able to marshal data to xml and json. The struct i have has multiple records but xml marshalling does not add a root for these records. The XML is therefore not valid.</p>\n\n<p>I saw some questions that were solved by setting XMLName but i think that will only change my customer type to something else.</p>\n\n<p>What i still might try is to add  around the xml marshalled byte and concatinate. But I am not sure if that is how i have to do it.</p>\n\n<p><strong>EDIT: Apparently XML is marshalled correctly since I am marshalling a struct with multiple objects inside. Marshalling then creates separate XML documents per object. Question then is what the rest clients can work with to consume data or is it bad practice to send multiple xml documents in a rest responce? Browsers couldn't display the resulting xml.</strong></p>\n\n<p><strong>To return a single XML Document I would have to put the list in a struct, which then can be marshalled. I am not sure how I can initialise the struct with sqlx in such a way.</strong></p>\n\n<p><strong>Adding following code does not work:</strong></p>\n\n<pre><code>type custs struct {\n    List []Customer `xml:\"Customer\"`\n}\n\ncusts customers.[]Customer =  []Customer{}\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    json \"encoding/json\"\n    \"encoding/xml\"\n    \"fmt\"\n    \"net/http\"\n)\n\ntype Customer struct {\n    CustomerID int            `db:\"CustomerId\"`\n    FirstName  string         `db:\"FirstName\"`\n    LastName   string         `db:\"LastName\"`\n    Company    sql.NullString `db:\"Company\"`\n}\n\nfunc tstSQLite(w http.ResponseWriter, r *http.Request) {\n\n    contentType := r.Header.Get(\"Content-type\")\n\n    Customers := []Customer{}\n\n    var err error\n\n    fmt.Print(\"executing query\")\n    err = chinookdb.Select(&amp;Customers, \"SELECT CustomerId, FirstName,LastName, Company FROM customers\")\n\n    if err != nil {\n        panic(err)\n    }\n\n    for _, g := range Customers {\n        fmt.Println(\"FirstName:\", g.FirstName, \"LastName:\", g.LastName)\n    }\n\n    var data []byte\n\n    if contentType == \"application/xml\" {\n        data, err = xml.Marshal(Customers)\n    }\n\n    if contentType == \"application/json\" || contentType != \"application/xml\" {\n        data, err = json.Marshal(Customers)\n    }\n\n\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.Write(data)\n}\n\n</code></pre>\n\n<p>What i get is following xml:</p>\n\n<pre><code>   &lt;Customer&gt;\n      &lt;CustomerID&gt;1&lt;/CustomerID&gt;\n      &lt;FirstName&gt;Lu\u00eds&lt;/FirstName&gt;\n      &lt;LastName&gt;Gon\u00e7alves&lt;/LastName&gt;\n      &lt;Company&gt;\n         &lt;String&gt;Embraer - Empresa Brasileira de Aeron\u00e1utica S.A.&lt;/String&gt;\n         &lt;Valid&gt;true&lt;/Valid&gt;\n      &lt;/Company&gt;\n   &lt;/Customer&gt;\n   &lt;Customer&gt;\n      &lt;CustomerID&gt;2&lt;/CustomerID&gt;\n      &lt;FirstName&gt;Leonie&lt;/FirstName&gt;\n      &lt;LastName&gt;K\u00f6hler&lt;/LastName&gt;\n      &lt;Company&gt;\n         &lt;String /&gt;\n         &lt;Valid&gt;false&lt;/Valid&gt;\n      &lt;/Company&gt;\n   &lt;/Customer&gt;\n   &lt;Customer&gt;\n      &lt;CustomerID&gt;3&lt;/CustomerID&gt;\n      &lt;FirstName&gt;Fran\u00e7ois&lt;/FirstName&gt;\n      &lt;LastName&gt;Tremblay&lt;/LastName&gt;\n      &lt;Company&gt;\n         &lt;String /&gt;\n         &lt;Valid&gt;false&lt;/Valid&gt;\n      &lt;/Company&gt;\n   &lt;/Customer&gt;\n</code></pre>\n\n<p>but i think it should be like this: </p>\n\n<pre><code>&lt;Customers&gt;\n   &lt;Customer&gt;\n      &lt;CustomerID&gt;1&lt;/CustomerID&gt;\n      &lt;FirstName&gt;Lu\u00eds&lt;/FirstName&gt;\n      &lt;LastName&gt;Gon\u00e7alves&lt;/LastName&gt;\n      &lt;Company&gt;\n         &lt;String&gt;Embraer - Empresa Brasileira de Aeron\u00e1utica S.A.&lt;/String&gt;\n         &lt;Valid&gt;true&lt;/Valid&gt;\n      &lt;/Company&gt;\n   &lt;/Customer&gt;\n   &lt;Customer&gt;\n      &lt;CustomerID&gt;2&lt;/CustomerID&gt;\n      &lt;FirstName&gt;Leonie&lt;/FirstName&gt;\n      &lt;LastName&gt;K\u00f6hler&lt;/LastName&gt;\n      &lt;Company&gt;\n         &lt;String /&gt;\n         &lt;Valid&gt;false&lt;/Valid&gt;\n      &lt;/Company&gt;\n   &lt;/Customer&gt;\n   &lt;Customer&gt;\n      &lt;CustomerID&gt;3&lt;/CustomerID&gt;\n      &lt;FirstName&gt;Fran\u00e7ois&lt;/FirstName&gt;\n      &lt;LastName&gt;Tremblay&lt;/LastName&gt;\n      &lt;Company&gt;\n         &lt;String /&gt;\n         &lt;Valid&gt;false&lt;/Valid&gt;\n      &lt;/Company&gt;\n   &lt;/Customer&gt;\n&lt;/Customers&gt;\n</code></pre>\n\n<p>The marshalled json looks correct since the customers are in brackets:</p>\n\n<pre><code>[\n   {\n      \"CustomerID\":1,\n      \"FirstName\":\"Lu\u00eds\",\n      \"LastName\":\"Gon\u00e7alves\",\n      \"Company\":{\n         \"String\":\"Embraer - Empresa Brasileira de Aeron\u00e1utica S.A.\",\n         \"Valid\":true\n      }\n   },\n   {\n      \"CustomerID\":2,\n      \"FirstName\":\"Leonie\",\n      \"LastName\":\"K\u00f6hler\",\n      \"Company\":{\n         \"String\":\"\",\n         \"Valid\":false\n      }\n   }\n]\n</code></pre>\n"}, {"tags": ["go", "alpine"], "comments": [{"owner": {"reputation": 1084, "user_id": 2915603, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ea6fc9bc47d33adfb6e88ce2909f1a80?s=128&d=identicon&r=PG", "display_name": "ArkadyB", "link": "https://stackoverflow.com/users/2915603/arkadyb"}, "edited": false, "score": 0, "creation_date": 1556690811, "post_id": 55932233, "comment_id": 98517418, "body": "should you do <code>install</code> instead of <code>run</code>?"}, {"owner": {"reputation": 11210, "user_id": 725937, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/32cba7500e49d4c491289f9e101c693b?s=128&d=identicon&r=PG", "display_name": "abergmeier", "link": "https://stackoverflow.com/users/725937/abergmeier"}, "reply_to_user": {"reputation": 1084, "user_id": 2915603, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ea6fc9bc47d33adfb6e88ce2909f1a80?s=128&d=identicon&r=PG", "display_name": "ArkadyB", "link": "https://stackoverflow.com/users/2915603/arkadyb"}, "edited": false, "score": 0, "creation_date": 1556691600, "post_id": 55932233, "comment_id": 98517597, "body": "You mean using <code>go install</code> instead of <code>go get</code>? Doesn&#39;t change the error message."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556715844, "post_id": 55932233, "comment_id": 98526051, "body": "I&#39;m not sure what alpine is doing with the go package, but I would generally avoid OS distributed go packages for development. At some point you&#39;re going to want to decouple the go version from the OS version, as the stable OS packages will quickly fall out of date."}, {"owner": {"reputation": 11210, "user_id": 725937, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/32cba7500e49d4c491289f9e101c693b?s=128&d=identicon&r=PG", "display_name": "abergmeier", "link": "https://stackoverflow.com/users/725937/abergmeier"}, "edited": false, "score": 0, "creation_date": 1556716037, "post_id": 55932233, "comment_id": 98526126, "body": "Agreed. On the other hand building Go from scratch clutters Dockerfiles a bit too much."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556721603, "post_id": 55932233, "comment_id": 98528744, "body": "That&#39;s where I use multi-stage builds. Make your base image like <code>golang:1.12-alpine</code> and build off that. I usually go one further and build the app in another intermediate stage, ending with a container that doesn&#39;t need the go installation at all."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1556733647, "post_id": 55932233, "comment_id": 98534364, "body": "IIRC, Alpine doesn&#39;t ship with GCC by default, it doesn&#39;t use glibc even (musl I believe). You&#39;re installing musl-dev, but if you want GCC, you&#39;ll have to install <code>build-base</code>, first (<code>apk add build-base</code>). Either way, the error seems to suggest your <code>GOROOT</code> doesn&#39;t contain the standard packages, specifically <code>runtime&#47;cgo</code>, That said: 2 stage docker builds FTW"}, {"owner": {"reputation": 11210, "user_id": 725937, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/32cba7500e49d4c491289f9e101c693b?s=128&d=identicon&r=PG", "display_name": "abergmeier", "link": "https://stackoverflow.com/users/725937/abergmeier"}, "edited": false, "score": 0, "creation_date": 1556739388, "post_id": 55932233, "comment_id": 98536615, "body": "While multistage may be an easy thing to do for (nearly static) go - it gets really ugly for other types of software (<i>cough</i> <i>protoc</i> <i>cough</i>), which uses way more disperse cluttered files."}], "answers": [{"tags": [], "owner": {"reputation": 11210, "user_id": 725937, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/32cba7500e49d4c491289f9e101c693b?s=128&d=identicon&r=PG", "display_name": "abergmeier", "link": "https://stackoverflow.com/users/725937/abergmeier"}, "is_accepted": false, "score": 0, "last_activity_date": 1556708313, "creation_date": 1556708313, "answer_id": 55935158, "question_id": 55932233, "link": "https://stackoverflow.com/questions/55932233/cannot-find-runtime-cgo-in-alpine/55935158#55935158", "title": "cannot find runtime/cgo in Alpine", "body": "<p>For now as a workaround, I copy necessary Go binaries from <code>golang:1.12-alpine</code> into my current container.</p>\n\n<p>With that, <code>go get</code> works as intended.</p>\n"}, {"tags": [], "owner": {"reputation": 1190, "user_id": 5621569, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/n43ph.jpg?s=128&g=1", "display_name": "Auyer", "link": "https://stackoverflow.com/users/5621569/auyer"}, "is_accepted": false, "score": 2, "last_activity_date": 1571614621, "creation_date": 1571614621, "answer_id": 58478169, "question_id": 55932233, "link": "https://stackoverflow.com/questions/55932233/cannot-find-runtime-cgo-in-alpine/58478169#58478169", "title": "cannot find runtime/cgo in Alpine", "body": "<p>One way to avoid this issue is to force a static build disabling <code>cgo</code>. Try building your binary with the following command: </p>\n\n<pre><code>RUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o yourBinaryName\n</code></pre>\n\n<p>If you actually need cgo in your app, you might want to install gcc, musl-dev and  even build-base like @abergmeier pointed out.\nYou can do this with this command:</p>\n\n<pre><code>RUN apk update &amp;&amp; apk add --no-cache musl-dev gcc build-base\n</code></pre>\n\n<p>If none of that works I would check out this gist claiming it creates a Dockerfile capable of compiling protobuffs: <a href=\"https://gist.github.com/rizo/513849f35178d19a13adcddf2d045a19\" rel=\"nofollow noreferrer\">\"Alpine (3.6) based docker image with Protocol Buffers compiler supporting Go\"</a> </p>\n"}], "owner": {"reputation": 11210, "user_id": 725937, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/32cba7500e49d4c491289f9e101c693b?s=128&d=identicon&r=PG", "display_name": "abergmeier", "link": "https://stackoverflow.com/users/725937/abergmeier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6894, "favorite_count": 1, "answer_count": 2, "score": 6, "last_activity_date": 1571614621, "creation_date": 1556690456, "question_id": 55932233, "link": "https://stackoverflow.com/questions/55932233/cannot-find-runtime-cgo-in-alpine", "title": "cannot find runtime/cgo in Alpine", "body": "<p>In an <code>alpine:edge</code> container I installed go via</p>\n\n<pre><code>RUN apk add --no-cache musl-dev go\n</code></pre>\n\n<p>I try to run <code>go get github.com/golang/protobuf/protoc-gen-go</code> then.</p>\n\n<p>This results in the error message:</p>\n\n<pre><code>go: finding github.com/golang/protobuf/protoc-gen-go latest\ngo: finding github.com/golang/protobuf v1.3.1\ngo: downloading github.com/golang/protobuf v1.3.1\ngo: extracting github.com/golang/protobuf v1.3.1\n# github.com/golang/protobuf/protoc-gen-go\nloadinternal: cannot find runtime/cgo\nprotoc-gen-go: program not found or is not executable\n</code></pre>\n\n<p>Now looking at the code, it fails on <code>ctxt.PackageFile[name]</code>.</p>\n\n<p>I double checked though, that both <code>/usr/lib/go/pkg/tool/linux_amd64/cgo</code> and <code>/usr/lib/go/pkg/linux_amd64/runtime/cgo.a</code> are present.</p>\n\n<p>Which should all be in order according to <code>go env</code>:</p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOCACHE=\"/root/.cache/go-build\"\nGOEXE=\"\"\nGOFLAGS=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/root/go\"\nGOPROXY=\"\"\nGORACE=\"\"\nGOROOT=\"/usr/lib/go\"\nGOTMPDIR=\"\"\nGOTOOLDIR=\"/usr/lib/go/pkg/tool/linux_amd64\"\nGCCGO=\"gccgo\"\nCC=\"gcc\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\nGOMOD=\"/dev/null\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\nPKG_CONFIG=\"pkg-config\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build521273293=/tmp/go-build -gno-record-gcc-switches\"\n</code></pre>\n\n<p>Anyone any hints where to look next or what is wrong?</p>\n"}, {"tags": ["excel", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1556688818, "post_id": 55931971, "comment_id": 98517021, "body": "<code>func read() []exceldata</code>. <code>exceldata</code> is a struct type but it is not the <code>struct{}</code> (anonymous empty struct) type."}], "answers": [{"tags": [], "owner": {"reputation": 23600, "user_id": 1695172, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/6319d7eafca7852cf04c88598ca31e75?s=128&d=identicon&r=PG", "display_name": "Netwave", "link": "https://stackoverflow.com/users/1695172/netwave"}, "is_accepted": false, "score": 0, "last_activity_date": 1556690822, "creation_date": 1556690822, "answer_id": 55932282, "question_id": 55931971, "link": "https://stackoverflow.com/questions/55931971/how-to-return-struct-duitonary-in-golang-funtion/55932282#55932282", "title": "how to return struct duitonary in golang funtion", "body": "<p>You are already difining exceldata as a type, so you should use that type:</p>\n\n<pre><code>type exceldata struct\n...\n\n\nfunc read() []exceldata {\n...\n}\n</code></pre>\n"}], "owner": {"reputation": 131, "user_id": 974393, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ebe9451e3700456889e90e5d54053fd7?s=128&d=identicon&r=PG", "display_name": "nu123", "link": "https://stackoverflow.com/users/974393/nu123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1556690822, "creation_date": 1556688398, "question_id": 55931971, "link": "https://stackoverflow.com/questions/55931971/how-to-return-struct-duitonary-in-golang-funtion", "title": "how to return struct duitonary in golang funtion", "body": "<p>i need to retrun struct duitonary from a funtion and when it run script i'm gettting cannot use res (type []exceldata) as type []struct {} in return argument </p>\n\n<p>I have created struct in my go script and i added values to that and added to array now i need to return it to main funtion    </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\npackage main\n\nimport (\n    \"fmt\"\n    \"database/sql\"\n    _ \"github.com/go-sql-driver/mysql\"\n    \"github.com/360EntSecGroup-Skylar/excelize\"\n    \"log\"\n\n)\n\n\ntype exceldata struct {\n    username string\n    rfid  string\n    user string\n}\n\nfunc read() []struct{} {\n    exdata := exceldata{}\n    res := []exceldata{}\n    f, err := excelize.OpenFile(\"./required_details.xlsx\")\n    if err != nil {\n        fmt.Println(err)\n        return res\n    }\n\n    // Get value from cell by given worksheet name and axis.\n    /*cell, err := f.GetCellValue(\"Sheet1\", \"A566\")\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Println(cell)*/\n\n     // Get all the rows in the Sheet1.\n    rows, err := f.GetRows(\"Sheet1\")\n\n    for _, row := range rows {\n        if row[0] != \"eof\"{\n\n            exdata.username = row[0]\n            exdata.rfid = row[1]\n            exdata.user = row[2]\n            res = append(res, exdata)\n            fmt.Println(res)\n\n        }else{\n                return res\n        }\n    }\n    return res;\n\n}\n\nfunc main() {\n\n    fmt.Println(\"Go MySQL Tutorial\")\n    resexceldata := []exceldata{}\n    resexceldata =read() \n    fmt.Println(\"Routes are Loded.\")\n\n}\n\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "amazon-sns", "aws-sdk-go"], "answers": [{"tags": [], "owner": {"reputation": 422, "user_id": 6037139, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155968228550094/picture?type=large", "display_name": "Harris Lummis", "link": "https://stackoverflow.com/users/6037139/harris-lummis"}, "is_accepted": true, "score": 0, "last_activity_date": 1556821734, "creation_date": 1556821734, "answer_id": 55958228, "question_id": 55930596, "link": "https://stackoverflow.com/questions/55930596/how-to-access-message-attributes-in-sns-https-subscription-endpoint/55958228#55958228", "title": "How to access message attributes in SNS HTTPS subscription endpoint", "body": "<p>The solution is as simple as disabling <code>RawMessageDelivery</code>. It would seem as though this option is required for delivering message attributes to an SQS endpoint but <strong>must not</strong> be used when delivering to an HTTP/S endpoint. </p>\n"}], "owner": {"reputation": 422, "user_id": 6037139, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155968228550094/picture?type=large", "display_name": "Harris Lummis", "link": "https://stackoverflow.com/users/6037139/harris-lummis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 616, "favorite_count": 0, "accepted_answer_id": 55958228, "answer_count": 1, "score": 1, "last_activity_date": 1556821734, "creation_date": 1556674013, "last_edit_date": 1556674478, "question_id": 55930596, "link": "https://stackoverflow.com/questions/55930596/how-to-access-message-attributes-in-sns-https-subscription-endpoint", "title": "How to access message attributes in SNS HTTPS subscription endpoint", "body": "<p>I'm setting up an integration test to determine if a program that publishes a message to SNS is working correctly. The published message includes a few critical message attributes that I need to check in order to determine correctness. </p>\n\n<p>So far, I have set up a simple HTTP server that acts as an SNS subscriber. The server correctly confirms its subscription and even receives messages from the topic, however I am at a loss as to how to access the attributes of these messages. </p>\n\n<p>It should be mentioned that I am using ngrok to expose my host to SNS. To accomplish this, I'm using the command:</p>\n\n<pre><code>ngrok http 8080\n</code></pre>\n\n<p>When I create the subscription, I have made sure to enable raw message delivery:</p>\n\n<pre><code>subOut, err := snsCli.Subscribe(&amp;sns.SubscribeInput{\n    Endpoint: &amp;ngrokURL,\n    Attributes: map[string]*string{\n        \"RawMessageDelivery\": aws.String(\"True\"),\n    },\n    Protocol: aws.String(\"https\"),\n    TopicArn: aws.String(topicArn),\n})\n</code></pre>\n\n<p>Note: I have also tried setting \"RawMessageDelivery\" to \"true\" instead of \"True.\" This does not seem to elicit any changes.</p>\n\n<p>I have also tried using the <code>http</code> protocol instead of <code>https</code> but have achieved the same results.</p>\n\n<p>Below is the Notification post request received by the endpoint (I have substituted ARNs with asterisks):</p>\n\n<pre><code>POST / HTTP/1.1\nx-amz-sns-message-type: Notification\nx-amz-sns-message-id: c8bce1ed-3766-5a04-a9ad-b4afc662cc31\nx-amz-sns-topic-arn: ****\nx-amz-sns-subscription-arn: ****\nx-amz-sns-rawdelivery: true\nContent-Length: 1\nContent-Type: text/plain; charset=UTF-8\nHost: ****.ngrok.io\nUser-Agent: Amazon Simple Notification Service Agent\nAccept-Encoding: gzip,deflate\nX-Forwarded-Proto: https\nX-Forwarded-For: 54.240.230.176\n</code></pre>\n\n<p>The messages published to SNS have only one byte in their body (a single space character) - I assume this is why the content length is 1.</p>\n\n<p>One of the message attributes is of binary format and contains characters that are not allowed in the body of an SNS message, otherwise I would simply place the encoded attributes in the message body.</p>\n\n<p>There do not appear to be any attributes available in the request, and I am totally stumped as to why. I would expect that they would be part of the raw request's body, but this does not seem to be the case. Any ideas?</p>\n\n<p>EDIT: I should probably add that I have added an SQS subscriber to this same topic and that the SQS subscriber receives message attributes as would be expected. </p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556718425, "post_id": 55930187, "comment_id": 98527166, "body": "Why do you have a <code>src</code> directory at all?"}, {"owner": {"reputation": 178, "user_id": 8620595, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f046cd65fd96b254e6bc1b2dcf04b364?s=128&d=identicon&r=PG", "display_name": "Lordie", "link": "https://stackoverflow.com/users/8620595/lordie"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556926129, "post_id": 55930187, "comment_id": 98606682, "body": "I like to keep my code separated from my other configs"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1557147767, "post_id": 55930187, "comment_id": 98657053, "body": "That&#39;s not how Go projects are organized, and it means that <code>src</code> will be in all your import paths."}], "answers": [{"tags": [], "owner": {"reputation": 422, "user_id": 6037139, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155968228550094/picture?type=large", "display_name": "Harris Lummis", "link": "https://stackoverflow.com/users/6037139/harris-lummis"}, "is_accepted": true, "score": 3, "last_activity_date": 1556675455, "creation_date": 1556675455, "answer_id": 55930730, "question_id": 55930187, "link": "https://stackoverflow.com/questions/55930187/go-mod-subdirectories-structure/55930730#55930730", "title": "go mod subdirectories structure", "body": "<p>You could just move the <code>app.go</code> file into the src directory. </p>\n\n<p>However, it's generally ill-advised to have an src folder in a Go project. I recommend you take a look <a href=\"https://github.com/golang-standards/project-layout\" rel=\"nofollow noreferrer\">here</a> for recommendations re: project structure. </p>\n"}, {"tags": [], "owner": {"reputation": 3895, "user_id": 4040931, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/705151302/picture?type=large", "display_name": "David Alsh", "link": "https://stackoverflow.com/users/4040931/david-alsh"}, "is_accepted": false, "score": 0, "last_activity_date": 1556769514, "creation_date": 1556769514, "answer_id": 55945481, "question_id": 55930187, "link": "https://stackoverflow.com/questions/55930187/go-mod-subdirectories-structure/55945481#55945481", "title": "go mod subdirectories structure", "body": "<p>I like the following structure</p>\n\n<pre><code>App\n\u251c\u2500\u2500 makefile\n\u251c\u2500\u2500 go.mod\n\u251c\u2500\u2500 httpd &lt;- Entrypoint is here - CLI or Http Server\n|   \u2514\u2500\u2500 main.go\n\u2514\u2500\u2500 platform &lt;- Project specific dependencies that are not shared between projects\n</code></pre>\n\n<p>e.g</p>\n\n<pre><code>App\n\u251c\u2500\u2500 makefile\n\u251c\u2500\u2500 go.mod\n\u251c\u2500\u2500 httpd\n|   \u2514\u2500\u2500 handlers\n|   |    \u2514\u2500\u2500 hello-world_get.go\n|   |    \u2514\u2500\u2500 hello-world_get_test.go\n|   \u2514\u2500\u2500 main.go\n\u2514\u2500\u2500 platform\n    \u2514\u2500\u2500 user\n        \u2514\u2500\u2500 user.go\n        \u2514\u2500\u2500 user_test.go\n</code></pre>\n\n<p>I describe it here on YouTube\n<a href=\"https://youtu.be/zeme_TmXyBk\" rel=\"nofollow noreferrer\">https://youtu.be/zeme_TmXyBk</a></p>\n"}], "owner": {"reputation": 178, "user_id": 8620595, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f046cd65fd96b254e6bc1b2dcf04b364?s=128&d=identicon&r=PG", "display_name": "Lordie", "link": "https://stackoverflow.com/users/8620595/lordie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 55930730, "answer_count": 2, "score": -4, "last_activity_date": 1556769514, "creation_date": 1556669800, "question_id": 55930187, "link": "https://stackoverflow.com/questions/55930187/go-mod-subdirectories-structure", "title": "go mod subdirectories structure", "body": "<p>I'm using the following struct on my project, but it feels hacky</p>\n\n<pre><code>App\n\u251c\u2500\u2500 go.mod\n\u251c\u2500\u2500 app.go\n\u2514\u2500\u2500 src\n    \u2514\u2500\u2500 foo\n    |    \u2514\u2500\u2500 foo.go\n    \u2514\u2500\u2500 bar\n        \u2514\u2500\u2500 bar.go\n</code></pre>\n\n<p>Is there a way to organize it like that?</p>\n\n<pre><code>App\n\u251c\u2500\u2500 go.mod\n\u2514\u2500\u2500 src\n    \u251c\u2500\u2500 app.go\n    \u2514\u2500\u2500 foo\n    |    \u2514\u2500\u2500 foo.go\n    \u2514\u2500\u2500 bar\n        \u2514\u2500\u2500 bar.go\n</code></pre>\n"}, {"tags": ["go", "ip", "cidr"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556649243, "post_id": 55926712, "comment_id": 98507366, "body": "As you can see from <a href=\"https://golang.org/pkg/net\" rel=\"nofollow noreferrer\">the <code>net</code> package documentation</a>, this is not a built-in function, and requests for 3rd-party libraries are off-topic for SO."}, {"owner": {"reputation": 1790, "user_id": 2784487, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DYu2h.jpg?s=128&g=1", "display_name": "Jack", "link": "https://stackoverflow.com/users/2784487/jack"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556649794, "post_id": 55926712, "comment_id": 98507577, "body": "@Adrian I edited the question to not mention third party libraries."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1556653546, "post_id": 55926712, "comment_id": 98509072, "body": "<a href=\"https://golang.org/pkg/net/#IP\" rel=\"nofollow noreferrer\">net.IP is just a byte slice</a>, making this is a fairly easy exercise in bit flipping. For a /32 net set the twelve trailing bytes all to 0x00 or 0xff, for instance."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1556655226, "post_id": 55926712, "comment_id": 98509750, "body": "<a href=\"https://play.golang.org/p/XEvv-_kStoL\" rel=\"nofollow noreferrer\">play.golang.org/p/XEvv-_kStoL</a>"}, {"owner": {"reputation": 1790, "user_id": 2784487, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DYu2h.jpg?s=128&g=1", "display_name": "Jack", "link": "https://stackoverflow.com/users/2784487/jack"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1556656301, "post_id": 55926712, "comment_id": 98510169, "body": "@Peter That is working for me. Can you submit as an answer and add some info on how it works?"}, {"owner": {"reputation": 1790, "user_id": 2784487, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DYu2h.jpg?s=128&g=1", "display_name": "Jack", "link": "https://stackoverflow.com/users/2784487/jack"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1556656544, "post_id": 55926712, "comment_id": 98510265, "body": "@Peter I did also find this solution <a href=\"https://gist.github.com/mzimmerman/78e19eeb2393f9d6ec2ab063d9338273\" rel=\"nofollow noreferrer\">gist.github.com/mzimmerman/78e19eeb2393f9d6ec2ab063d9338273</a> . I don&#39;t really know enough about go internals to know which is better (more efficient)"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1556657285, "post_id": 55926712, "comment_id": 98510543, "body": "I&#39;m on my phone and can&#39;t be bothered to write a proper answer. It&#39;s really just flipping the trailing bits either to all ones or to all zeroes. That gist seems very convoluted. It&#39;s silly to flip bits one at a time when you already have the address and mask in congruent byte slices. I can&#39;t imagine that being faster than going byte-wise."}, {"owner": {"reputation": 1790, "user_id": 2784487, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DYu2h.jpg?s=128&g=1", "display_name": "Jack", "link": "https://stackoverflow.com/users/2784487/jack"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1556657388, "post_id": 55926712, "comment_id": 98510577, "body": "@Peter Ok, well thanks for your help!"}, {"owner": {"reputation": 1790, "user_id": 2784487, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DYu2h.jpg?s=128&g=1", "display_name": "Jack", "link": "https://stackoverflow.com/users/2784487/jack"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1556736825, "post_id": 55926712, "comment_id": 98535630, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/192680/discussion-between-jack-tuck-and-peter\">continue this discussion in chat</a>."}], "owner": {"reputation": 1790, "user_id": 2784487, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DYu2h.jpg?s=128&g=1", "display_name": "Jack", "link": "https://stackoverflow.com/users/2784487/jack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 209, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1556649769, "creation_date": 1556648459, "last_edit_date": 1556649769, "question_id": 55926712, "link": "https://stackoverflow.com/questions/55926712/how-to-get-the-ip-range-of-a-cidr", "title": "How to get the IP range of a CIDR", "body": "<p>How can I get the start and end for v4 and v6 ip addresses of a CIDR? I don't care about addresses which are between.</p>\n\n<p>I have checked the <code>net</code> library and parseCIDR does not return this information. Is there an idiomatic way to calculate the ip range of a CIDR which will work for v6 and v4 addresses alike?</p>\n\n<p>For example, given the CIDR <code>2001:db8:a0b:12f0::1/32</code> I would expect\n<code>2001:0db8:0000:0000:0000:0000:0000:0000</code> and <code>2001:0db8:ffff:ffff:ffff:ffff:ffff:ffff</code> returned as the start and end addresses respectively.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 3, "last_activity_date": 1556644859, "creation_date": 1556644859, "answer_id": 55925932, "question_id": 55925894, "link": "https://stackoverflow.com/questions/55925894/parseint-doesnt-convert-to-the-desired-type/55925932#55925932", "title": "ParseInt doesn&#39;t convert to the desired type", "body": "<p>Note this from the function's doc:</p>\n\n<blockquote>\n  <p>The bitSize argument specifies the integer type that the result must\n  fit into. Bit sizes 0, 8, 16, 32, and 64 correspond to int, int8,\n  int16, int32, and int64. For a bitSize below 0 or above 64 an error is\n  returned.</p>\n</blockquote>\n\n<p>So it's guaranteed that you can convert your result to a byte with <code>byte(i)</code>.</p>\n\n<p>Go doesn't have generics yet, so having a single <code>ParseInt</code> that can accept pointers to multiple integer types is difficult. Instead the guarantee is done with the <code>bitSize</code> argument</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1556651252, "last_edit_date": 1556651252, "creation_date": 1556646117, "answer_id": 55926193, "question_id": 55925894, "link": "https://stackoverflow.com/questions/55925894/parseint-doesnt-convert-to-the-desired-type/55926193#55926193", "title": "ParseInt doesn&#39;t convert to the desired type", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/strconv/\" rel=\"nofollow noreferrer\">Package strconv</a></p>\n\n<pre><code>import \"strconv\"\n</code></pre>\n  \n  <p><a href=\"https://golang.org/pkg/strconv/#ParseInt\" rel=\"nofollow noreferrer\">func ParseInt</a></p>\n\n<pre><code>func ParseInt(s string, base int, bitSize int) (i int64, err error)\n</code></pre>\n  \n  <p>ParseInt interprets a string s in the given base (0, 2 to 36) and bit\n  size (0 to 64) and returns the corresponding value i.</p>\n  \n  <p>If base == 0, the base is implied by the string's prefix: base 16 for\n  \"0x\", base 8 for \"0\", and base 10 otherwise. For bases 1, below 0 or\n  above 36 an error is returned.</p>\n  \n  <p>The bitSize argument specifies the integer type that the result must\n  fit into. Bit sizes 0, 8, 16, 32, and 64 correspond to int, int8,\n  int16, int32, and int64. For a bitSize below 0 or above 64 an error is\n  returned.</p>\n  \n  <p>The errors that ParseInt returns have concrete type *NumError and\n  include err.Num = s. If s is empty or contains invalid digits, err.Err\n  = ErrSyntax and the returned value is 0; if the value corresponding to s cannot be represented by a signed integer of the given size, err.Err\n  = ErrRange and the returned value is the maximum magnitude integer of the appropriate bitSize and sign.</p>\n</blockquote>\n\n<hr>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n    i64, err := strconv.ParseInt(\"10\", 10, 8)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"%[1]d %[1]T\\n\", i64)\n    i8 := int8(i64)\n    fmt.Printf(\"%[1]d %[1]T\\n\", i8)\n\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/HSHtUnC7qql\" rel=\"nofollow noreferrer\">https://play.golang.org/p/HSHtUnC7qql</a></p>\n\n<p>Output:</p>\n\n<pre><code>10 int64\n10 int8\n</code></pre>\n\n<hr>\n\n<p>In Go, we often use functions to hide implementation details. </p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc ParseInt8(s string, base int) (int8, error) {\n    i64, err := strconv.ParseInt(s, base, 8)\n    return int8(i64), err\n}\n\nfunc main() {\n    i8, err := ParseInt8(\"10\", 10)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"%[1]d %[1]T\\n\", i8)\n\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/HdA3O71U54z\" rel=\"nofollow noreferrer\">https://play.golang.org/p/HdA3O71U54z</a></p>\n\n<p>Output:</p>\n\n<pre><code>10 int8\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "is_accepted": false, "score": 1, "last_activity_date": 1556668246, "creation_date": 1556668246, "answer_id": 55930037, "question_id": 55925894, "link": "https://stackoverflow.com/questions/55925894/parseint-doesnt-convert-to-the-desired-type/55930037#55930037", "title": "ParseInt doesn&#39;t convert to the desired type", "body": "<p>I think what you are really asking is what is the point of the 3rd parameter to ParseInt().</p>\n\n<p>It's to save you having to check for overflow manually like this:</p>\n\n<pre><code>i, err := strconv.Atoi(intString)\nif err != nil || i &lt; -128 || i &gt; 127 {\n  // handle error\n}\ni8 := int8(i)\n\n</code></pre>\n"}], "owner": {"reputation": 1283, "user_id": 3246078, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/6a7de53a68c0e67d9b9cbcea5d6e5581?s=128&d=identicon&r=PG&f=1", "display_name": "HH- Apologize to Carole Baskin", "link": "https://stackoverflow.com/users/3246078/hh-apologize-to-carole-baskin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 467, "favorite_count": 1, "accepted_answer_id": 55925932, "answer_count": 3, "score": 0, "last_activity_date": 1556668246, "creation_date": 1556644667, "last_edit_date": 1556644982, "question_id": 55925894, "link": "https://stackoverflow.com/questions/55925894/parseint-doesnt-convert-to-the-desired-type", "title": "ParseInt doesn&#39;t convert to the desired type", "body": "<p>Here's my code:</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"reflect\"\n    \"strconv\"\n)\n\nfunc main() {\n   i, _ := strconv.ParseInt(\"10\", 10, 8)\n   fmt.Println(reflect.TypeOf(i))\n}\n</code></pre>\n\n<p>I expect <code>i</code> to be 8-bits long (the 3rd argument to <code>strconv.ParseInt</code>).  It is int64, however (and the docs state that <code>strconv.ParseInt</code> will return int64).</p>\n\n<p>What's the point of ParseInt if it always returns int64 (why not just use Atoi?)</p>\n"}, {"tags": ["dictionary", "go"], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 3, "last_activity_date": 1556645027, "last_edit_date": 1556645027, "creation_date": 1556644546, "answer_id": 55925866, "question_id": 55925822, "link": "https://stackoverflow.com/questions/55925822/in-golang-why-are-iterations-over-maps-random/55925866#55925866", "title": "In Golang, why are iterations over maps random?", "body": "<p>This is important for <a href=\"http://ocert.org/advisories/ocert-2011-003.html\" rel=\"nofollow noreferrer\">security</a>, among other things. </p>\n\n<p>There are lots of resources talking about this online -- see <a href=\"https://lemire.me/blog/2012/01/17/use-random-hashing-if-you-care-about-security/\" rel=\"nofollow noreferrer\">this post</a> for example</p>\n"}, {"comments": [{"owner": {"reputation": 194, "user_id": 1478294, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1b079763724f5d11cd9381594bb925d?s=128&d=identicon&r=PG", "display_name": "Dippo", "link": "https://stackoverflow.com/users/1478294/dippo"}, "edited": false, "score": 0, "creation_date": 1556647249, "post_id": 55925880, "comment_id": 98506501, "body": "But what i don&#39;t understand is why they make it random on purpose. If i do iterate first and then add to the map, then continue the iterate, it is already random."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 194, "user_id": 1478294, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1b079763724f5d11cd9381594bb925d?s=128&d=identicon&r=PG", "display_name": "Dippo", "link": "https://stackoverflow.com/users/1478294/dippo"}, "edited": false, "score": 1, "creation_date": 1556647959, "post_id": 55925880, "comment_id": 98506816, "body": "@Dippo They made it random on purpose so developers won&#39;t write code that relies on a specific order. E.g. if you add three keys to a map and iteration order <i>happens</i> to be <code>1</code>, <code>2</code>, <code>3</code>, you could write a test that <i>expects</i> this order, and this test may always succeed. Then with the next Go release it <i>could</i> fail with no apparent reason (if a new or changed map implementation would iterate in a different order)..."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 194, "user_id": 1478294, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1b079763724f5d11cd9381594bb925d?s=128&d=identicon&r=PG", "display_name": "Dippo", "link": "https://stackoverflow.com/users/1478294/dippo"}, "edited": false, "score": 1, "creation_date": 1556647964, "post_id": 55925880, "comment_id": 98506819, "body": "...To prevent such cases, the iteration order is always random, so you won&#39;t end up with a test that relies on the order and seemingly always succeeds <i>now</i> and would fail <i>later</i> or another platform."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1556661224, "post_id": 55925880, "comment_id": 98511865, "body": "Maps use hashes for fast key lookups. <code>go</code> adds an initial &quot;salt&quot; to the hash - so incurs no performance   penalty - but creates the illusion of randomness during multiple runs against the same dataset."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 19, "last_activity_date": 1604436655, "last_edit_date": 1604436655, "creation_date": 1556644594, "answer_id": 55925880, "question_id": 55925822, "link": "https://stackoverflow.com/questions/55925822/in-golang-why-are-iterations-over-maps-random/55925880#55925880", "title": "In Golang, why are iterations over maps random?", "body": "<p><strong>TL;DR; They intentionally made it random starting with Go 1 to make developers not rely on it</strong> (to not rely on a specific iteration order which order may change from release-to-relase, from platform-to-platform, or may even change during a single runtime of an app when map internals change due to accommodating more elements).</p>\n<p><a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"noreferrer\">The Go Blog: Go maps in action: Iteration order:</a></p>\n<blockquote>\n<p>When iterating over a map with a range loop, the iteration order is not specified and is not guaranteed to be the same from one iteration to the next. Since the release of Go 1.0, the runtime has randomized map iteration order. <strong>Programmers had begun to rely on the stable iteration order of early versions of Go, which varied between implementations, leading to portability bugs.</strong> If you require a stable iteration order you must maintain a separate data structure that specifies that order.</p>\n</blockquote>\n<p>Also <a href=\"https://golang.org/doc/go1#iteration\" rel=\"noreferrer\">Go 1 Release Notes: Iterating in maps:</a></p>\n<blockquote>\n<p>The old language specification did not define the order of iteration for maps, and in practice it differed across hardware platforms. <strong>This caused tests that iterated over maps to be fragile and non-portable, with the unpleasant property that a test might always pass on one machine but break on another.</strong></p>\n<p>In Go 1, the order in which elements are visited when iterating over a map using a for range statement is defined to be unpredictable, even if the same loop is run multiple times with the same map. Code should not assume that the elements are visited in any particular order.</p>\n<p><strong>This change means that code that depends on iteration order is very likely to break early and be fixed long before it becomes a problem. Just as important, it allows the map implementation to ensure better map balancing even when programs are using range loops to select an element from a map.</strong></p>\n</blockquote>\n<h2>Notable exceptions</h2>\n<p>Please note that the &quot;random&quot; order applies when ranging over the map using <code>for range</code>.</p>\n<p>For reproducible outputs (for easy testing and other conveniences it brings) the standard lib sorts map keys in numerous places:</p>\n<h3>1. <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"noreferrer\"><code>encoding/json</code></a></h3>\n<p>The <code>json</code> package marshals maps using sorted keys. Quoting from <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"noreferrer\"><code>json.Marshal()</code></a>:</p>\n<blockquote>\n<p>Map values encode as JSON objects. The map's key type must either be a string, an integer type, or implement encoding.TextMarshaler. <strong>The map keys are sorted</strong> and used as JSON object keys by applying the following rules, subject to the UTF-8 coercion described for string values above:</p>\n<ul>\n<li>keys of any string type are used directly</li>\n<li>encoding.TextMarshalers are marshaled</li>\n<li>integer keys are converted to strings</li>\n</ul>\n</blockquote>\n<h3>2. <a href=\"https://golang.org/pkg/fmt/\" rel=\"noreferrer\"><code>fmt</code></a> package</h3>\n<p>Starting with <a href=\"https://golang.org/doc/go1.12#fmt\" rel=\"noreferrer\">Go 1.12</a> the <code>fmt</code> package prints maps using sorted keys. Quoting from the release notes:</p>\n<blockquote>\n<p>Maps are now printed in key-sorted order to ease testing. The ordering rules are:</p>\n<ul>\n<li>When applicable, nil compares low</li>\n<li>ints, floats, and strings order by &lt;</li>\n<li>NaN compares less than non-NaN floats</li>\n<li>bool compares false before true</li>\n<li>Complex compares real, then imaginary</li>\n<li>Pointers compare by machine address</li>\n<li>Channel values compare by machine address</li>\n<li>Structs compare each field in turn</li>\n<li>Arrays compare each element in turn</li>\n<li>Interface values compare first by reflect.Type describing the concrete &gt; - type and then by concrete value as described in the previous rules.</li>\n</ul>\n</blockquote>\n<h3>3. Go templates</h3>\n<p>The <code>{{range}}</code> action of <a href=\"https://golang.org/pkg/text/template/\" rel=\"noreferrer\"><code>text/template</code></a> and <a href=\"https://golang.org/pkg/html/template/\" rel=\"noreferrer\"><code>html/template</code></a> packages also visit elements in sorted keys order. Quoting from package doc of <code>text/template</code>:</p>\n<blockquote>\n<pre><code>{{range pipeline}} T1 {{end}}\n  The value of the pipeline must be an array, slice, map, or channel.\n  If the value of the pipeline has length zero, nothing is output;\n  otherwise, dot is set to the successive elements of the array,\n  slice, or map and T1 is executed. If the value is a map and the\n  keys are of basic type with a defined order, the elements will be\n  visited in sorted key order.\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 109, "user_id": 11315083, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-5eGFCUogLek/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re54rdymD1kNx2Fybahs6_vZ5V-xw/mo/photo.jpg?sz=128", "display_name": "chimiconga", "link": "https://stackoverflow.com/users/11315083/chimiconga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2417, "favorite_count": 0, "answer_count": 2, "score": 10, "last_activity_date": 1604436655, "creation_date": 1556644404, "question_id": 55925822, "link": "https://stackoverflow.com/questions/55925822/in-golang-why-are-iterations-over-maps-random", "title": "In Golang, why are iterations over maps random?", "body": "<p>From the Golang <a href=\"https://github.com/golang/go/blob/master/src/runtime/map.go#L23\" rel=\"noreferrer\">source code</a>, they seem to follow a pretty standard implementation of hash tables (ie array of buckets). Based on this it seems that iteration should be deterministic for an unchanged map (ie iterate the array in order, then iterate within the buckets in order). Why do they make the iteration random?</p>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1556635338, "post_id": 55923332, "comment_id": 98500402, "body": "It has a lock because it needs a lock. I don&#39;t understand why you are trying to dereference the <code>*DB</code> returned from <code>Where</code>."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1556636437, "post_id": 55923332, "comment_id": 98501063, "body": "The pointer to the struct is important, especially if it contains a lock. You never want to copy a lock/mutex value, as it will break the locking logic. See <a href=\"https://golang.org/pkg/sync/\" rel=\"nofollow noreferrer\">sync pkg</a> note: &quot;Values containing the (sync) types defined in this package should <i>not</i> be copied.&quot;"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1556637562, "post_id": 55923332, "comment_id": 98501724, "body": "You don&#39;t need to assign the return value. They&#39;re creating what&#39;s called a &quot;fluent API&quot;, basically the method returns its own receiver so that you can chain calls (query.Where().Order().Find()). If you&#39;re not chaining calls, you can ignore the return value."}, {"owner": {"reputation": 21667, "user_id": 539490, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/f41bc8e21c00c13c6afa2da502f79367?s=128&d=identicon&r=PG", "display_name": "AJP", "link": "https://stackoverflow.com/users/539490/ajp"}, "edited": false, "score": 0, "creation_date": 1556709991, "post_id": 55923332, "comment_id": 98523555, "body": "Thanks for the comments.  Yep I understand the you can chain calls.  I was trying to understand how you optionally apply a <code>.Where()</code>, order, limit, etc call.  Please see my comment here: <a href=\"https://stackoverflow.com/questions/55923332/assignment-copies-lock-value?noredirect=1#comment98523529_55924986\" title=\"assignment copies lock value\">stackoverflow.com/questions/55923332/&hellip;</a>"}, {"owner": {"reputation": 21667, "user_id": 539490, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/f41bc8e21c00c13c6afa2da502f79367?s=128&d=identicon&r=PG", "display_name": "AJP", "link": "https://stackoverflow.com/users/539490/ajp"}, "edited": false, "score": 0, "creation_date": 1556710580, "post_id": 55923332, "comment_id": 98523788, "body": "Btw I can&#39;t delete this question so have rewritten it substantially to focus on the first implementation I tried that failed."}], "answers": [{"comments": [{"owner": {"reputation": 21667, "user_id": 539490, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/f41bc8e21c00c13c6afa2da502f79367?s=128&d=identicon&r=PG", "display_name": "AJP", "link": "https://stackoverflow.com/users/539490/ajp"}, "edited": false, "score": 0, "creation_date": 1556709919, "post_id": 55924986, "comment_id": 98523529, "body": "Yeah my first implementation was <code>func applyWhere (db *gorm.DB, filters Filters) *gorm.DB { ... }</code> but didn&#39;t work.  Not sure why.  I will try to go back to that implementation and figure out what was going wrong.  Thank you for the link to the tutorial, that&#39;s useful."}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 2, "last_activity_date": 1556641078, "last_edit_date": 1556641078, "creation_date": 1556640763, "answer_id": 55924986, "question_id": 55923332, "link": "https://stackoverflow.com/questions/55923332/optionally-applying-where-to-gorm-db/55924986#55924986", "title": "Optionally applying .Where() to gorm.DB", "body": "<p>Read on how to do chaining with GORM properly here: <a href=\"http://gorm.io/docs/method_chaining.html\" rel=\"nofollow noreferrer\">Method Chaining tutorial</a>. You take the <code>*gorm.DB</code> returned by one method and apply another method to it, that's it. You can also pass the <code>*gorm.DB</code> around, but be careful to only pass the pointer, not dereference it (otherwise you get the lock copy error as you found).</p>\n\n<p><code>Order</code>s are just another kind of query you can chain: <a href=\"http://gorm.io/docs/query.html#Order\" rel=\"nofollow noreferrer\">http://gorm.io/docs/query.html#Order</a></p>\n\n<p>For example:</p>\n\n<pre><code>var p Product\ndb.Order(\"Price\").Where(\"Price &gt; 1000\").First(&amp;p)\n</code></pre>\n\n<p>So your <code>applyWhere</code> should just return <code>*gorm.DB</code> which you can further query</p>\n"}], "owner": {"reputation": 21667, "user_id": 539490, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/f41bc8e21c00c13c6afa2da502f79367?s=128&d=identicon&r=PG", "display_name": "AJP", "link": "https://stackoverflow.com/users/539490/ajp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1556712336, "creation_date": 1556635155, "last_edit_date": 1556712336, "question_id": 55923332, "link": "https://stackoverflow.com/questions/55923332/optionally-applying-where-to-gorm-db", "title": "Optionally applying .Where() to gorm.DB", "body": "<p>I am new to Go and my pointer knowledge is rusty.  I want to mutate an instance of the gorm.DB so that I can apply 0 or more <code>Where</code> clauses to it.</p>\n\n<pre><code>func () {\n    db := gorm.Open(/* ... */)\n    err := applyWhere(db, filters).Order(\"created_datetime desc\").Find(&amp;rMessages).Error\n    // ...\n}\n\nfunc applyWhere(db *gorm.DB, filters Filters) *gorm.DB {\n    if filters.MessageType != \"\" {\n        db = db.Where(&amp;message{MessageType: string(filters.MessageType)})\n    }\n    return db\n}\n</code></pre>\n\n<p>This seems not to work.  The db instance doesn't have the where applied.</p>\n\n<p><strong>* edit 3 *</strong></p>\n\n<p>This now works.  Not sure what the problem was before.  Please close / delete this question.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1556635219, "post_id": 55923271, "comment_id": 98500329, "body": "The <code>fmt</code> Print functions are not buffered like C&#39;s <code>printf</code> is. Can you provide some more context or code for what you&#39;re trying to accomplish?"}, {"owner": {"reputation": 20741, "user_id": 1657476, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/FnxbC.jpg?s=128&g=1", "display_name": "Meirion Hughes", "link": "https://stackoverflow.com/users/1657476/meirion-hughes"}, "edited": false, "score": 0, "creation_date": 1556635268, "post_id": 55923271, "comment_id": 98500356, "body": "I guess you could recover from the panic at the root level and flush the buffer before exiting?"}, {"owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "edited": false, "score": 0, "creation_date": 1556635508, "post_id": 55923271, "comment_id": 98500511, "body": "I think it also depends on what you want to write to std output. What do you wish to write ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556636187, "post_id": 55923271, "comment_id": 98500933, "body": "You can&#39;t recover panics in other goroutines. You can can either recover your own goroutine&#39;s panics, which mean you can do whatever you want, or you have the let the program crash as intended."}, {"owner": {"reputation": 97, "user_id": 10143812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e1fc65fdf160ed7f1d91d1cace065d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/10143812/peter"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1556637048, "post_id": 55923271, "comment_id": 98501423, "body": "@TimCooper I have added some code.  Thanks for your comment."}], "answers": [{"comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 3, "creation_date": 1556638434, "post_id": 55923700, "comment_id": 98502253, "body": "Careful. This recovers the panic - and the program will continue - which may not be what the OP was asking for.  A side effect of the above, if used within a function that has return values, the returned values will be given default values e.g. RowCount() int - would return 0 - which may or may not be what you want. If not, then the panic should be re-raised in the defer closure."}], "tags": [], "owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "is_accepted": false, "score": 1, "last_activity_date": 1556655230, "last_edit_date": 1556655230, "creation_date": 1556636364, "answer_id": 55923700, "question_id": 55923271, "link": "https://stackoverflow.com/questions/55923271/how-to-write-to-the-console-before-a-function-panics/55923700#55923700", "title": "How to write to the console before a function panics?", "body": "<p>you could use a defered function that calls the recover function, the function below will result in \"Recovered panic here\"</p>\n\n<pre><code>defer func() {\n    r := recover()\n    if r != nil {\n        fmt.Println(\"Recovered\", r)\n    }\n}()\n\npanic(\"panic here\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 194, "user_id": 1478294, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1b079763724f5d11cd9381594bb925d?s=128&d=identicon&r=PG", "display_name": "Dippo", "link": "https://stackoverflow.com/users/1478294/dippo"}, "is_accepted": false, "score": 0, "last_activity_date": 1556642955, "creation_date": 1556642955, "answer_id": 55925498, "question_id": 55923271, "link": "https://stackoverflow.com/questions/55923271/how-to-write-to-the-console-before-a-function-panics/55925498#55925498", "title": "How to write to the console before a function panics?", "body": "<p>Your code checks all lines if it contains a space, but it isn't checking if the line ends (end of line / end of file / line feed). There is a easier way to check what the shortest word is :</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n    \"strings\"\n)\n\nfunc main() {\n    min := math.MaxInt32\n    shortest := math.MaxInt32\n    s := strings.Split(\"this is a test\", \" \")\n    for key, value := range s {\n        if len(value) &lt; min {\n            min = len(value)\n            shortest = key\n        }\n    }\n    fmt.Print(s[shortest])\n}\n</code></pre>\n"}], "owner": {"reputation": 97, "user_id": 10143812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e1fc65fdf160ed7f1d91d1cace065d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/10143812/peter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1556655230, "creation_date": 1556634983, "last_edit_date": 1556638537, "question_id": 55923271, "link": "https://stackoverflow.com/questions/55923271/how-to-write-to-the-console-before-a-function-panics", "title": "How to write to the console before a function panics?", "body": "<p>In C you can use the function <code>write()</code> from the <code>unistd.h</code> library.\n<code>write()</code> is faster than <code>printf()</code>, and allows you to write to the standard output (or a file) before a Segfault breaks your code.</p>\n\n<p>When debugging, I wish to write to the standard output before my Go code panics.  In general, how do I do that?</p>\n\n<p>I have the following code (to find the shortest word in a string of words) which is panicking and I want to isolate where, by inserting write methods.</p>\n\n<pre><code>func FindShort(s string) int {\n  i := 0\n  j := 0\n  min := math.MaxInt32\n  for true {\n    for s[i] == ' ' {\n      i++\n      j++\n    }\n    for s[j] != ' ' &amp;&amp; j &lt; len(s) {\n      j++\n    }\n    if j &gt; i &amp;&amp; (j - i) &lt; min {\n      min = j - i\n    }\n    i = j\n    if j == len(s) {\n      break\n    }\n  }\n  return min\n}\n</code></pre>\n"}, {"tags": ["go", "grpc", "grpc-go"], "answers": [{"comments": [{"owner": {"reputation": 125, "user_id": 10230139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac213abfb2729d97f0c3fa6f76d9ccd2?s=128&d=identicon&r=PG&f=1", "display_name": "Yabetsu2018", "link": "https://stackoverflow.com/users/10230139/yabetsu2018"}, "edited": false, "score": 0, "creation_date": 1556718043, "post_id": 55925110, "comment_id": 98526994, "body": "My problem is the grpc server was deployed and need to connect to the ipaddress and host only like this post. <a href=\"https://medium.com/@jnewmano/grpc-postman-173b62a64341\" rel=\"nofollow noreferrer\">medium.com/@jnewmano/grpc-postman-173b62a64341</a>"}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 3, "last_activity_date": 1556641310, "creation_date": 1556641310, "answer_id": 55925110, "question_id": 55923257, "link": "https://stackoverflow.com/questions/55923257/how-to-connect-to-deployed-grpc-server-by-ip-address-and-host/55925110#55925110", "title": "How to connect to deployed grpc-server by ip address and host", "body": "<pre><code>conn, err := grpc.Dial(\"192.168.0.1:50032\")\nif err != nil {\n    ...\n}\n</code></pre>\n\n<p><a href=\"https://www.grpc.io/docs/tutorials/basic/go/\" rel=\"nofollow noreferrer\">Here's a basic tutorial</a> you should follow</p>\n"}, {"tags": [], "owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "is_accepted": false, "score": 1, "last_activity_date": 1556661440, "creation_date": 1556661440, "answer_id": 55929157, "question_id": 55923257, "link": "https://stackoverflow.com/questions/55923257/how-to-connect-to-deployed-grpc-server-by-ip-address-and-host/55929157#55929157", "title": "How to connect to deployed grpc-server by ip address and host", "body": "<p>Basically you're not able to post GRPC request via Postman, because GRPC messages are binary (protobuf-serialized), while Postman is designed to work only with plain HTTP requests. You'll have to deploy some kind of <a href=\"https://medium.com/@jnewmano/grpc-postman-173b62a64341\" rel=\"nofollow noreferrer\">proxy</a> in front of your service in order to use Postman.</p>\n\n<p>From my point of view, it's much easier just to write your client that fits your needs. The greatest part of job is already done by <code>protoc-gen-grpc</code>, because it generates client API, and you need just to build request and send it.</p>\n"}, {"comments": [{"owner": {"reputation": 125, "user_id": 10230139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac213abfb2729d97f0c3fa6f76d9ccd2?s=128&d=identicon&r=PG&f=1", "display_name": "Yabetsu2018", "link": "https://stackoverflow.com/users/10230139/yabetsu2018"}, "edited": false, "score": 0, "creation_date": 1556717977, "post_id": 55932247, "comment_id": 98526969, "body": "thanks i will try this tomorrow and will let you know @ArkadyB hope this works"}], "tags": [], "owner": {"reputation": 1084, "user_id": 2915603, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ea6fc9bc47d33adfb6e88ce2909f1a80?s=128&d=identicon&r=PG", "display_name": "ArkadyB", "link": "https://stackoverflow.com/users/2915603/arkadyb"}, "is_accepted": false, "score": 0, "last_activity_date": 1556690546, "creation_date": 1556690546, "answer_id": 55932247, "question_id": 55923257, "link": "https://stackoverflow.com/questions/55923257/how-to-connect-to-deployed-grpc-server-by-ip-address-and-host/55932247#55932247", "title": "How to connect to deployed grpc-server by ip address and host", "body": "<p>You cant use http client to send requests against http2 server, but you can do it with any of available h2 client tools.. For example <code>https://github.com/grpc/grpc/blob/master/doc/command_line_tool.md</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 125, "user_id": 10230139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac213abfb2729d97f0c3fa6f76d9ccd2?s=128&d=identicon&r=PG&f=1", "display_name": "Yabetsu2018", "link": "https://stackoverflow.com/users/10230139/yabetsu2018"}, "is_accepted": false, "score": 0, "last_activity_date": 1558651774, "creation_date": 1558651774, "answer_id": 56283824, "question_id": 55923257, "link": "https://stackoverflow.com/questions/55923257/how-to-connect-to-deployed-grpc-server-by-ip-address-and-host/56283824#56283824", "title": "How to connect to deployed grpc-server by ip address and host", "body": "<p>@Eli Bendersky : Setting up the client side answer my question also \nthis code I used </p>\n\n<pre><code>conn, err := grpc.Dial(\"192.168.0.1:50032\", grpc.WithInsecure)\n</code></pre>\n\n<p>Thank you for your help.</p>\n"}], "owner": {"reputation": 125, "user_id": 10230139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac213abfb2729d97f0c3fa6f76d9ccd2?s=128&d=identicon&r=PG&f=1", "display_name": "Yabetsu2018", "link": "https://stackoverflow.com/users/10230139/yabetsu2018"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1949, "favorite_count": 0, "answer_count": 4, "score": 2, "last_activity_date": 1558651774, "creation_date": 1556634944, "last_edit_date": 1556661090, "question_id": 55923257, "link": "https://stackoverflow.com/questions/55923257/how-to-connect-to-deployed-grpc-server-by-ip-address-and-host", "title": "How to connect to deployed grpc-server by ip address and host", "body": "<p>I want to connect to deployed grpc server\nby given ipaddress and host like 192.168.0.1:50032 \ni tried many stuff but as i checked grpc recommendation to \nhave grpc client but i want to try how to post via postman or any \nby grpc interfaces server. Any suggestion?</p>\n"}, {"tags": ["go", "testing", "concourse"], "answers": [{"tags": [], "owner": {"reputation": 3889, "user_id": 561422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JwFD0.jpg?s=128&g=1", "display_name": "marco.m", "link": "https://stackoverflow.com/users/561422/marco-m"}, "is_accepted": false, "score": 1, "last_activity_date": 1556640081, "creation_date": 1556640081, "answer_id": 55924809, "question_id": 55922953, "link": "https://stackoverflow.com/questions/55922953/how-to-test-golang-code-on-concourse-not-using-copy-command/55924809#55924809", "title": "How to test golang code on concourse not using copy command?", "body": "<p>You cannot <code>mv</code> because Concourse makes the <code>inputs</code> available as container volumes, so you cannot delete a volume (side-effect of <code>mv</code>).</p>\n\n<p>I wrote a blog post some time ago that shows how to build Go code without any <code>cp</code>: <a href=\"https://www.orsolabs.com/post/building-go-code-with-concourse/\" rel=\"nofollow noreferrer\">Building Go code, with and without Go modules, with Concourse</a></p>\n\n<p>I am not familiar with topflighttech/go-testing so I cannot give specific advice, but I believe that the blog post will put you in the right direction.</p>\n"}], "owner": {"reputation": 357, "user_id": 3952355, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000081840205/picture?type=large", "display_name": "Janis Karklins", "link": "https://stackoverflow.com/users/3952355/janis-karklins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1556640081, "creation_date": 1556633975, "question_id": 55922953, "link": "https://stackoverflow.com/questions/55922953/how-to-test-golang-code-on-concourse-not-using-copy-command", "title": "How to test golang code on concourse not using copy command?", "body": "<p>In Concourse I used topflighttech/go-testing docker container to test my-go-api. I find that the simplest solution is just copy src code to /go/src/my-go-api and test it. But I wondering how we could test on concourse straightforward without copy to /go/src/myapi? So the image could stay smaller. </p>\n\n<p>Of course mv is not working. Here is output from Concourse. </p>\n\n<pre><code>+ mv my-go-api /go/src\nmv: can't remove 'my-go-api': Resource busy\n</code></pre>\n"}, {"tags": ["mongodb", "go", "bson", "mongo-go"], "comments": [{"owner": {"reputation": 1903, "user_id": 3279175, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uZL6O.jpg?s=128&g=1", "display_name": "Andrea Golin", "link": "https://stackoverflow.com/users/3279175/andrea-golin"}, "edited": false, "score": 0, "creation_date": 1556628296, "post_id": 55921098, "comment_id": 98496096, "body": "I do not think this is a golang related question at all tho. And you are applying relational db primary key notions to a non relational db. A primary key is just an identifier, data could, and often will, be redundant in that kind of database."}, {"owner": {"reputation": 2088, "user_id": 6695608, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/0b62e0f8fc1e5c922623133e2414ce46?s=128&d=identicon&r=PG", "display_name": "Rohit", "link": "https://stackoverflow.com/users/6695608/rohit"}, "reply_to_user": {"reputation": 1903, "user_id": 3279175, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uZL6O.jpg?s=128&g=1", "display_name": "Andrea Golin", "link": "https://stackoverflow.com/users/3279175/andrea-golin"}, "edited": false, "score": 0, "creation_date": 1556628775, "post_id": 55921098, "comment_id": 98496402, "body": "@AndreaGolin i used the word <i>primaryKey</i> just to highlight the fact that column to have unique data. This is a <code>go</code> related because the <code>mongo</code> db driver in question is for <code>go</code>."}, {"owner": {"reputation": 301, "user_id": 11606132, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-zy5BZ6mE26Y/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfjCRlr1l54J2mWg_bS6KqhVBQQxA/mo/photo.jpg?sz=128", "display_name": "Taimoor", "link": "https://stackoverflow.com/users/11606132/taimoor"}, "edited": false, "score": 0, "creation_date": 1609524658, "post_id": 55921098, "comment_id": 115859915, "body": "I think it is a Golang related question, since in Javascript you can use the mongoose driver to enforce unique constraints, required constraints, etc. and I was wondering how to do this in Go."}], "answers": [{"comments": [{"owner": {"reputation": 2088, "user_id": 6695608, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/0b62e0f8fc1e5c922623133e2414ce46?s=128&d=identicon&r=PG", "display_name": "Rohit", "link": "https://stackoverflow.com/users/6695608/rohit"}, "edited": false, "score": 0, "creation_date": 1556629033, "post_id": 55921240, "comment_id": 98496581, "body": "thanks for the reply, i thought about the first solution but the problem was I have to do that from <code>mongo</code> shell."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2088, "user_id": 6695608, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/0b62e0f8fc1e5c922623133e2414ce46?s=128&d=identicon&r=PG", "display_name": "Rohit", "link": "https://stackoverflow.com/users/6695608/rohit"}, "edited": false, "score": 0, "creation_date": 1556629118, "post_id": 55921240, "comment_id": 98496637, "body": "@Rohit You only have to create the index once, why is it a problem to access the shell? By the way, you can create indices from a Go app too."}, {"owner": {"reputation": 2088, "user_id": 6695608, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/0b62e0f8fc1e5c922623133e2414ce46?s=128&d=identicon&r=PG", "display_name": "Rohit", "link": "https://stackoverflow.com/users/6695608/rohit"}, "edited": false, "score": 0, "creation_date": 1556629290, "post_id": 55921240, "comment_id": 98496736, "body": "accessing shell is not a problem, its just that I wanted to do that from Go application, infact that is wanted to ask in first place, sorry if my question was not clear. Can you please update your answer to let me know how can I do that."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2088, "user_id": 6695608, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/0b62e0f8fc1e5c922623133e2414ce46?s=128&d=identicon&r=PG", "display_name": "Rohit", "link": "https://stackoverflow.com/users/6695608/rohit"}, "edited": false, "score": 0, "creation_date": 1556629586, "post_id": 55921240, "comment_id": 98496932, "body": "@Rohit The &quot;how&quot; depends on what Go driver you&#39;re using."}, {"owner": {"reputation": 2088, "user_id": 6695608, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/0b62e0f8fc1e5c922623133e2414ce46?s=128&d=identicon&r=PG", "display_name": "Rohit", "link": "https://stackoverflow.com/users/6695608/rohit"}, "edited": false, "score": 0, "creation_date": 1556629670, "post_id": 55921240, "comment_id": 98496979, "body": "its <code>mongo-go-driver</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2088, "user_id": 6695608, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/0b62e0f8fc1e5c922623133e2414ce46?s=128&d=identicon&r=PG", "display_name": "Rohit", "link": "https://stackoverflow.com/users/6695608/rohit"}, "edited": false, "score": 0, "creation_date": 1556630944, "post_id": 55921240, "comment_id": 98497734, "body": "@Rohit Added example code to create a unique index."}, {"owner": {"reputation": 2088, "user_id": 6695608, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/0b62e0f8fc1e5c922623133e2414ce46?s=128&d=identicon&r=PG", "display_name": "Rohit", "link": "https://stackoverflow.com/users/6695608/rohit"}, "edited": false, "score": 0, "creation_date": 1556631095, "post_id": 55921240, "comment_id": 98497824, "body": "Thank you very much, exactly what I needed !!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1604477626, "last_edit_date": 1604477626, "creation_date": 1556628207, "answer_id": 55921240, "question_id": 55921098, "link": "https://stackoverflow.com/questions/55921098/making-a-unique-field-in-mongo-go-driver/55921240#55921240", "title": "Making a unique field in Mongo-go-driver", "body": "<p>You may use a <a href=\"https://docs.mongodb.com/manual/core/index-unique/\" rel=\"nofollow noreferrer\">unique index</a> to enforce / allow only distinct values of a given field, e.g.:</p>\n<pre><code>db.collectionname.createIndex( { &quot;hostname&quot;: 1 }, { unique: true } )\n</code></pre>\n<p>If you want to create such index using the official MongoDB driver, this is how you can do that:</p>\n<pre><code>indexName, err := coll.Indexes().CreateOne(\n    context.Background(),\n    mongo.IndexModel{\n        Keys:    bson.D{{Key: &quot;hostname&quot;, Value: 1}},\n        Options: options.Index().SetUnique(true),\n    },\n)\n</code></pre>\n<p>But know that in MongoDB each document must have an <code>_id</code> property, so doing the above, documents will have an auto-generated <code>_id</code> field (of <code>ObjectId</code> type). If this doesn't bother you, you're done.</p>\n<p>Also note that you may map <code>Modal.Hostname</code> to the <code>_id</code> field with struct tags:</p>\n<pre><code>type Modal struct {\n    Group     []string           `bson:&quot;group&quot; json:&quot;group&quot;`\n    Hostname  string             `bson:&quot;_id&quot; json:&quot;hostname&quot;`\n    Overrides map[string]string  `bson:&quot;overrides&quot; json:&quot;overrides&quot;`\n    Excludes  []string           `bson:&quot;excludes&quot; json:&quot;excludes&quot;`\n}\n</code></pre>\n<p>And again, you're done. The downside of this solution is that the documents in MongoDB will not have a property named <code>hostname</code>, as it will be stored in <code>_id</code>.</p>\n"}], "owner": {"reputation": 2088, "user_id": 6695608, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/0b62e0f8fc1e5c922623133e2414ce46?s=128&d=identicon&r=PG", "display_name": "Rohit", "link": "https://stackoverflow.com/users/6695608/rohit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3871, "favorite_count": 2, "accepted_answer_id": 55921240, "answer_count": 1, "score": 2, "last_activity_date": 1604477626, "creation_date": 1556627690, "last_edit_date": 1556630815, "question_id": 55921098, "link": "https://stackoverflow.com/questions/55921098/making-a-unique-field-in-mongo-go-driver", "title": "Making a unique field in Mongo-go-driver", "body": "<p>I am very new to both Go and Mongodb and was writing my first rest-api with Go and Mongo. I am using <code>mongo-go-driver</code> and have the following <code>Modal</code> struct in Go </p>\n\n<pre><code>type Modal struct {\n    Group     []string           `bson:\"group\" json:\"group\"`\n    Hostname  string             `bson:\"hostname\" json:\"hostname\"`\n    Overrides map[string]string  `bson:\"overrides\" json:\"overrides\"`\n    Excludes  []string           `bson:\"excludes\" json:\"excludes\"`\n}\n</code></pre>\n\n<p>I do not want to use the default <code>ObjectId</code> field provided by mongo-db as my primary key and instead would like to make the <code>Hostname</code> field as the primary key.</p>\n\n<p>If I make the type of <code>Hostname</code> field as <code>primitive.ObjectID</code>, then the <code>hostname</code> would be unique but its value will be randomly generated string by mongodb and not the actual hostname string value.</p>\n\n<p>So is there a way I can do this.</p>\n"}, {"tags": ["go", "protocol-buffers"], "comments": [{"owner": {"reputation": 2052, "user_id": 639559, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3adac89e63229dfeb3c56db48502148c?s=128&d=identicon&r=PG", "display_name": "nilsmagnus", "link": "https://stackoverflow.com/users/639559/nilsmagnus"}, "edited": false, "score": 1, "creation_date": 1556627718, "post_id": 55920970, "comment_id": 98495798, "body": "Have you tried using go modules instead of dep?"}, {"owner": {"reputation": 337, "user_id": 2099074, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1491488287/picture?type=large", "display_name": "Martin Kosicky", "link": "https://stackoverflow.com/users/2099074/martin-kosicky"}, "reply_to_user": {"reputation": 2052, "user_id": 639559, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3adac89e63229dfeb3c56db48502148c?s=128&d=identicon&r=PG", "display_name": "nilsmagnus", "link": "https://stackoverflow.com/users/639559/nilsmagnus"}, "edited": false, "score": 0, "creation_date": 1556630286, "post_id": 55920970, "comment_id": 98497325, "body": "no because they are experimental opt-in feature. not until it&#39;s ready"}], "answers": [{"tags": [], "owner": {"reputation": 337, "user_id": 2099074, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1491488287/picture?type=large", "display_name": "Martin Kosicky", "link": "https://stackoverflow.com/users/2099074/martin-kosicky"}, "is_accepted": false, "score": 0, "last_activity_date": 1556646123, "creation_date": 1556646123, "answer_id": 55926195, "question_id": 55920970, "link": "https://stackoverflow.com/questions/55920970/golang-with-protobuf-with-dep/55926195#55926195", "title": "golang with protobuf with dep", "body": "<p>It seems that if I configure the dep GOPKG.toml to require my protobuf folders and the compiler I can call </p>\n\n<pre><code>dep ensure -add github.com/golang/protobuf/protoc-gen-go\n</code></pre>\n\n<p>I can build the compiler and the code won't be pruned. And set --go_out to the vendor folder. Seems to be working</p>\n"}], "owner": {"reputation": 337, "user_id": 2099074, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1491488287/picture?type=large", "display_name": "Martin Kosicky", "link": "https://stackoverflow.com/users/2099074/martin-kosicky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 199, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1556646123, "creation_date": 1556627246, "question_id": 55920970, "link": "https://stackoverflow.com/questions/55920970/golang-with-protobuf-with-dep", "title": "golang with protobuf with dep", "body": "<p>how am I supposed to use golang protobufs with dep. If I create a project $GOPATH/src/my_test . My main problems:</p>\n\n<ul>\n<li>protobuf requires that code is generated with a compatible compiler to the library. How to tell dep to download compiler code when it's not used in code and it gets pruned?</li>\n<li>If I have 2 protobufs outside go repo that have structure  proto_root/users/user.go and proto_root/people/person.go  and one references another, where should I generate code so that the generate code looks up the libraries in vendor folders?</li>\n</ul>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 729, "user_id": 9927423, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0389f52eb5c6b3681ef4e8ea6fe593e?s=128&d=identicon&r=PG&f=1", "display_name": "smitty_werbenjagermanjensen", "link": "https://stackoverflow.com/users/9927423/smitty-werbenjagermanjensen"}, "edited": false, "score": 3, "creation_date": 1556626721, "post_id": 55920805, "comment_id": 98495248, "body": "go help modules"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1556626744, "post_id": 55920805, "comment_id": 98495260, "body": "You type <code>go doc import&#47;path&#47;of&#47;package</code>. Read <code>go help doc</code>."}, {"owner": {"reputation": 67, "user_id": 5413680, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/68bf208bf25997eb0ba2aae17975f5be?s=128&d=identicon&r=PG&f=1", "display_name": "Hustels", "link": "https://stackoverflow.com/users/5413680/hustels"}, "edited": false, "score": 0, "creation_date": 1556627079, "post_id": 55920805, "comment_id": 98495447, "body": "Thank you this is what a need."}], "answers": [{"tags": [], "owner": {"reputation": 729, "user_id": 9927423, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0389f52eb5c6b3681ef4e8ea6fe593e?s=128&d=identicon&r=PG&f=1", "display_name": "smitty_werbenjagermanjensen", "link": "https://stackoverflow.com/users/9927423/smitty-werbenjagermanjensen"}, "is_accepted": false, "score": 0, "last_activity_date": 1556626760, "creation_date": 1556626760, "answer_id": 55920853, "question_id": 55920805, "link": "https://stackoverflow.com/questions/55920805/equivalent-of-python-help-in-go/55920853#55920853", "title": "Equivalent of python &quot;help()&quot; in go?", "body": "<p>Official documentation:</p>\n\n<p>Latest HTML documentation for modules on golang.org</p>\n\n<p>Run go help modules for more about modules. (This is the main entry point for modules topics via go help)</p>\n\n<p>Run go help mod for more about the go mod command.</p>\n\n<p>Run go help module-get for more about the behavior of go get when in module-aware mode.</p>\n\n<p>Run go help goproxy for more about the module proxy, including a pure file-based option via a file:/// URL.</p>\n\n<p>From the GitHub of Golang: <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/Modules</a></p>\n"}], "owner": {"reputation": 67, "user_id": 5413680, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/68bf208bf25997eb0ba2aae17975f5be?s=128&d=identicon&r=PG&f=1", "display_name": "Hustels", "link": "https://stackoverflow.com/users/5413680/hustels"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 124, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1556626760, "creation_date": 1556626600, "last_edit_date": 1556626756, "question_id": 55920805, "link": "https://stackoverflow.com/questions/55920805/equivalent-of-python-help-in-go", "title": "Equivalent of python &quot;help()&quot; in go?", "body": "<p>what is the equivalent of python \"help()\" in go? , how I can get help about modules?</p>\n"}, {"tags": ["go", "kubernetes-helm", "go-templates"], "answers": [{"comments": [{"owner": {"reputation": 1794, "user_id": 1463751, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/089f887e5f22d434203d42308a4baab9?s=128&d=identicon&r=PG", "display_name": "Tom Klino", "link": "https://stackoverflow.com/users/1463751/tom-klino"}, "edited": false, "score": 0, "creation_date": 1556630901, "post_id": 55921960, "comment_id": 98497701, "body": "would that function work? the <code>size</code> value is not a number, it&#39;s a string with &#39;Gi&#39; at the end"}, {"owner": {"reputation": 1839, "user_id": 4098408, "user_type": "registered", "profile_image": "https://graph.facebook.com/696311494/picture?type=large", "display_name": "yanivoliver", "link": "https://stackoverflow.com/users/4098408/yanivoliver"}, "reply_to_user": {"reputation": 1794, "user_id": 1463751, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/089f887e5f22d434203d42308a4baab9?s=128&d=identicon&r=PG", "display_name": "Tom Klino", "link": "https://stackoverflow.com/users/1463751/tom-klino"}, "edited": false, "score": 0, "creation_date": 1556634234, "post_id": 55921960, "comment_id": 98499752, "body": "Ah, no. You can use the <a href=\"http://masterminds.github.io/sprig/strings.html#substr\" rel=\"nofollow noreferrer\">substr</a> function as well to trim the suffix characters. This is not a generic (or very elegant) solution, but it should get the work done. You could also implement a generic function (supporting GI, Mi, etc using if/else conditions using <a href=\"http://masterminds.github.io/sprig/strings.html#hasprefix-and-hassuffix\" rel=\"nofollow noreferrer\">hasSuffix</a>, but that&#39;s much more complicated)"}], "tags": [], "owner": {"reputation": 1839, "user_id": 4098408, "user_type": "registered", "profile_image": "https://graph.facebook.com/696311494/picture?type=large", "display_name": "yanivoliver", "link": "https://stackoverflow.com/users/4098408/yanivoliver"}, "is_accepted": false, "score": 2, "last_activity_date": 1556630777, "creation_date": 1556630777, "answer_id": 55921960, "question_id": 55918447, "link": "https://stackoverflow.com/questions/55918447/converting-gigabytes-to-bytes-in-helm-templates/55921960#55921960", "title": "Converting Gigabytes to bytes in helm templates", "body": "<p>You can use the <a href=\"http://masterminds.github.io/sprig/math.html#div\" rel=\"nofollow noreferrer\">div</a> Sprig function. For example, you could do:</p>\n\n<pre><code>{{ div .Values.persistence.size 1024 }}\n</code></pre>\n\n<p>If you'd like to perform a subtraction on the result, you can use the <a href=\"http://masterminds.github.io/sprig/math.html#sub\" rel=\"nofollow noreferrer\">sub</a> function. For example:</p>\n\n<pre><code>{{ sub (div .Values.persistence.size 1024) 10000 }}\n</code></pre>\n"}], "owner": {"reputation": 1794, "user_id": 1463751, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/089f887e5f22d434203d42308a4baab9?s=128&d=identicon&r=PG", "display_name": "Tom Klino", "link": "https://stackoverflow.com/users/1463751/tom-klino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 512, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1556630777, "creation_date": 1556618289, "question_id": 55918447, "link": "https://stackoverflow.com/questions/55918447/converting-gigabytes-to-bytes-in-helm-templates", "title": "Converting Gigabytes to bytes in helm templates", "body": "<p>I have a chart for kafka, that has a pvc size defined in its values file like so: <code>20Gi</code>. I also have a configmap, that has a definition that it takes in bytes, like so: <code>log.retention.bytes=21474836480</code>.</p>\n\n<p>I'm trying to get my chart to use the same value defined in <code>size</code> in the values file, in the configmap (hopefully, do some arithmetics on it before, like taking away a constant value to reserve some extra space)</p>\n\n<p>I've been looking for a while to see if there is such a function built in to helm templates, or a way to create my own functions, with not much luck.</p>\n\n<p>Ideally, I'm looking for something like this:</p>\n\n<pre><code>log.retention.bytes={{ .Values.persistence.size | convert-to-bytes | substract 10000 }}\n\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "amazon-dynamodb", "aws-sdk-go"], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 719, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1556615245, "creation_date": 1556615245, "question_id": 55917515, "link": "https://stackoverflow.com/questions/55917515/how-to-filter-for-empty-values-with-the-golang-filter-builder", "title": "How to filter for empty values with the Golang filter builder?", "body": "<p>Carrying on from <a href=\"https://stackoverflow.com/questions/55898187/how-to-filter-on-null\">How to filter on NULL?</a> I am struggling to replicate the Go code to filter for null values of a particular column:</p>\n\n<pre><code>import (\n        \"github.com/apex/log\"\n        \"github.com/aws/aws-sdk-go-v2/aws\"\n        \"github.com/aws/aws-sdk-go-v2/aws/endpoints\"\n        \"github.com/aws/aws-sdk-go-v2/aws/external\"\n        \"github.com/aws/aws-sdk-go-v2/service/dynamodb\"\n        \"github.com/aws/aws-sdk-go-v2/service/dynamodb/expression\"\n)\n\n// aws --profile dd dynamodb scan --table-name plocal2 --filter-expression 'paymentmethod = :null' --expression-attribute-values '{\":null\" :{\"NULL\":true}}'\n\nvar table = \"plocal2\"\n\nfunc main() {\n        cfg, err := external.LoadDefaultAWSConfig(external.WithSharedConfigProfile(\"dd\"))\n        if err != nil {\n                log.WithError(err).Fatal(\"setting up credentials\")\n                return\n        }\n        cfg.Region = endpoints.ApSoutheast1RegionID\n        db := dynamodb.New(cfg)\n        filt := expression.Name(\"paymentmethod\").Equal(expression.Value(expression.Null))\n        expr, err := expression.NewBuilder().\n                WithFilter(filt).\n                Build()\n        if err != nil {\n                log.WithError(err).Error(\"failed to build expression\")\n                return\n        }\n        scanReq := db.ScanRequest(&amp;dynamodb.ScanInput{\n                ExpressionAttributeValues: expr.Values(),\n                FilterExpression:          expr.Filter(),\n                TableName:                 aws.String(table),\n        })\n        result, err := scanReq.Send()\n        if err != nil {\n                log.WithError(err).Error(\"failed to query table\")\n                return\n        }\n        log.Infof(\"%d\", len(result.Items))\n}\n</code></pre>\n\n<p>The error is:</p>\n\n<pre><code>2019/04/30 16:59:54 error failed to query table     error=ValidationException: Invalid FilterExpression: An expression attribute name used in the document path\n is not defined; attribute name: #0\n        status code: 400, request id: 8CFTOAGVB7M1IM3DC6BFPEVLUNVV4KQNSO5AEMVJF66Q9ASUAAJG\n</code></pre>\n\n<p>Any tips how to debug this or where I am going wrong using the <a href=\"https://godoc.org/github.com/aws/aws-sdk-go-v2/service/dynamodb/expression\" rel=\"nofollow noreferrer\">expression builder</a>?</p>\n\n<p>Really wish there were <a href=\"https://godoc.org/github.com/aws/aws-sdk-go-v2/service/dynamodb/expression#pkg-examples\" rel=\"nofollow noreferrer\">examples</a>, since filtering on NULL should be a pretty common use case to me if one is using <a href=\"https://godoc.org/github.com/aws/aws-sdk-go-v2/service/dynamodb/dynamodbattribute#MarshalMap\" rel=\"nofollow noreferrer\">MarshalMap</a> since empty strings becomes NULLs!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 5, "creation_date": 1556611999, "post_id": 55916496, "comment_id": 98487426, "body": "Have you tried running it with race detector? <code>go run -race toolv2.go</code>? Also try to make your example shorter, aim for a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 1, "user_id": 9149605, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba63811fa34faabc7577e0fd4b8410d3?s=128&d=identicon&r=PG&f=1", "display_name": "ksco HZNU_", "link": "https://stackoverflow.com/users/9149605/ksco-hznu"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1556612407, "post_id": 55916496, "comment_id": 98487644, "body": "The code should be the error of the clock function.thank you,i will try it"}, {"owner": {"reputation": 1, "user_id": 9149605, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba63811fa34faabc7577e0fd4b8410d3?s=128&d=identicon&r=PG&f=1", "display_name": "ksco HZNU_", "link": "https://stackoverflow.com/users/9149605/ksco-hznu"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1556613034, "post_id": 55916496, "comment_id": 98487981, "body": "so i should delete derfer body.close()?i try it, but there will be lots of errors"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9149605, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba63811fa34faabc7577e0fd4b8410d3?s=128&d=identicon&r=PG&f=1", "display_name": "ksco HZNU_", "link": "https://stackoverflow.com/users/9149605/ksco-hznu"}, "edited": false, "score": 0, "creation_date": 1556613321, "post_id": 55916817, "comment_id": 98488148, "body": "i try your code, but there will be error panic: runtime error: invalid memory address or nil pointer dereference [signal SIGSEGV: segmentation violation code=0x1 addr=0x40 pc=0x6782b4]"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 1, "user_id": 9149605, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba63811fa34faabc7577e0fd4b8410d3?s=128&d=identicon&r=PG&f=1", "display_name": "ksco HZNU_", "link": "https://stackoverflow.com/users/9149605/ksco-hznu"}, "edited": false, "score": 1, "creation_date": 1556613357, "post_id": 55916817, "comment_id": 98488175, "body": "That&#39;s <i>your</i> code, not mine. I just added it to point out one of the problematic functions."}, {"owner": {"reputation": 1, "user_id": 9149605, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba63811fa34faabc7577e0fd4b8410d3?s=128&d=identicon&r=PG&f=1", "display_name": "ksco HZNU_", "link": "https://stackoverflow.com/users/9149605/ksco-hznu"}, "edited": false, "score": 0, "creation_date": 1556613603, "post_id": 55916817, "comment_id": 98488297, "body": "I posted all the code because I feel that I should have more than one error.thank you very much for your help"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 1, "user_id": 9149605, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba63811fa34faabc7577e0fd4b8410d3?s=128&d=identicon&r=PG&f=1", "display_name": "ksco HZNU_", "link": "https://stackoverflow.com/users/9149605/ksco-hznu"}, "edited": false, "score": 1, "creation_date": 1556614029, "post_id": 55916817, "comment_id": 98488523, "body": "@kscoHZNU_ you&#39;re calling <code>response.Body.Close()</code> regardless of whether <code>http.Post</code> returned an error or not, if <code>err</code> is not <code>nil</code> then <code>response</code> will be <code>nil</code>, and when you select a field of a <code>nil</code> struct you get the &quot;invalid memory address or nil pointer dereference&quot; error. Simply fix this by <i>NOT</i> calling <code>response.Body.Close()</code> when <code>err != nil</code>."}, {"owner": {"reputation": 1, "user_id": 9149605, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba63811fa34faabc7577e0fd4b8410d3?s=128&d=identicon&r=PG&f=1", "display_name": "ksco HZNU_", "link": "https://stackoverflow.com/users/9149605/ksco-hznu"}, "edited": false, "score": 0, "creation_date": 1556614436, "post_id": 55916817, "comment_id": 98488710, "body": "you mean <code>if err != nil { \t\tlevelOutput.recordStatic(url, false, costTime) \t\tresponse.Body.Close() \t}  </code>?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 1, "user_id": 9149605, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba63811fa34faabc7577e0fd4b8410d3?s=128&d=identicon&r=PG&f=1", "display_name": "ksco HZNU_", "link": "https://stackoverflow.com/users/9149605/ksco-hznu"}, "edited": false, "score": 0, "creation_date": 1556614551, "post_id": 55916817, "comment_id": 98488766, "body": "@kscoHZNU_ No, the opposite <code>... } else { levelOutput.recordStatic(url, true, costTime); response.Body.Close() }</code>. Or <code>if err != nil { levelOutput.recordStatic(url, false, costTime); return }</code>"}, {"owner": {"reputation": 1, "user_id": 9149605, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba63811fa34faabc7577e0fd4b8410d3?s=128&d=identicon&r=PG&f=1", "display_name": "ksco HZNU_", "link": "https://stackoverflow.com/users/9149605/ksco-hznu"}, "edited": false, "score": 0, "creation_date": 1556615706, "post_id": 55916817, "comment_id": 98489405, "body": "I tried your second method and it worked fine. But new questions have emerged. Why the increase in my concurrent volume did not increase the total number of visits. Thank you very much for your solution."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 4, "last_activity_date": 1556613007, "creation_date": 1556613007, "answer_id": 55916817, "question_id": 55916496, "link": "https://stackoverflow.com/questions/55916496/when-my-number-of-goroutine-is-large-the-code-will-get-an-error/55916817#55916817", "title": "When my number of goroutine is large, the code will get an error", "body": "<p>\"invalid memory address or nil pointer dereference\" does not indicate a data race. You are dereferencing a pointer that is nil:</p>\n\n<pre><code>func post(url string, params string) {\n    start := time.Now()\n    response, err := http.Post(url, \"application/x-www-form-urlencoded\", strings.NewReader(params))\n    end := time.Now()\n    costTime := float64((end.Sub(start)).Seconds())\n\n    if err != nil {\n        levelOutput.recordStatic(url, false, costTime)\n    } else {\n        levelOutput.recordStatic(url, true, costTime)\n    }\n\n    response.Body.Close()\n}\n</code></pre>\n\n<p>You must not dereference response after an error occurs, because then response is nil.</p>\n"}], "owner": {"reputation": 1, "user_id": 9149605, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba63811fa34faabc7577e0fd4b8410d3?s=128&d=identicon&r=PG&f=1", "display_name": "ksco HZNU_", "link": "https://stackoverflow.com/users/9149605/ksco-hznu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1556613007, "creation_date": 1556611765, "question_id": 55916496, "link": "https://stackoverflow.com/questions/55916496/when-my-number-of-goroutine-is-large-the-code-will-get-an-error", "title": "When my number of goroutine is large, the code will get an error", "body": "<p>My code works fine with a small number of goroutine, but a large number of errors can occur with memory and pointers.I guess it is my lock used improperly.Can you help me see the tools I wrote? I have been debugging for a long time but I have no way to start.</p>\n\n<p>I thought about adding a read lock to the clock function.But still will report an error.I also tried to use sync.Map. But it did not solve the problem</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\npackage main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"encoding/json\"\n    \"strings\"\n    \"sync\"\n    \"time\"\n    \"strconv\"\n)\n\ntype UrlArray struct {\n    Url string `json:\"url\"`\n    Method string `json:\"method\"`\n    Params string `json:\"params\"`\n}\ntype MsgRequest struct {\n    Command string `json:\"command\"`\n    Concurrent int `json:\"concurrent\"`\n    IncrementalRatio float64 `json:\"incrementalRatio\"`\n    InitialRatio float64 `json:\"initialRatio\"`\n    Intervals int `json:\"intervals\"`\n    UrlArray []UrlArray `json:\"urls\"`\n}\ntype GroupData struct {\n    TotalCount int `json:\"totalCount\"`\n    FailCount int `json:\"failCount\"`\n    SuccessRate float64 `json:\"successRate\"`\n    CostTime float64 `json:\"costTime\"`\n    AvergeTime float64 `json:\"avergeTime\"`\n}\ntype MsgResponse struct {\n    TimeObject map[string]GroupData `json:\"timeObject\"`\n    TotalCount int `json:\"totalCount\"`\n    FailCount int `json:\"failCount\"`\n    SuccessRate float64 `json:\"successRate\"`\n    CostTime float64 `json:\"costTime\"`\n    AvergeTime float64 `json:\"avergeTime\"`\n}\ntype LevelData struct {\n    result map[string]GroupData\n    sync.RWMutex\n}\ntype ResultStatic struct {\n    result map[string]MsgResponse \n}\n\nvar p = fmt.Println\nvar levelOutput LevelData\nvar output ResultStatic\nvar closeAllChan chan int\nvar isHandle = false\n\n\n//write to map\nfunc (r *LevelData) recordStatic(url string, status bool, useTimeSec float64) {\n    r.Lock()\n    defer r.Unlock()\n    val, ok := r.result[url]\n    if ok {\n        val.TotalCount += 1\n        val.CostTime += useTimeSec\n        if status == false {\n            val.FailCount += 1\n        }\n        val.SuccessRate = 1.00 - (float64(val.FailCount) * 1.00) / (float64(val.TotalCount) * 1.00) \n        val.AvergeTime = val.CostTime / float64(val.TotalCount)\n        levelOutput.result[url] = val\n        } else {\n            failcnt := 0\n            if status == false {\n                failcnt = 1\n            }\n            successRate := float64(1 - failcnt)\n            val := GroupData{TotalCount: 1, FailCount: failcnt, SuccessRate: successRate, CostTime: useTimeSec, AvergeTime: useTimeSec}\n            levelOutput.result[url] = val\n        }\n}\n\n//get request\nfunc get(url string, params string) {\n    start := time.Now()\n    data := url + \"?\" + params\n    response, err:= http.Get(data)\n    end := time.Now()\n    costTime := float64((end.Sub(start)).Seconds())\n\n    if err != nil {\n        levelOutput.recordStatic(url, false, costTime)\n    } else {\n        levelOutput.recordStatic(url, true, costTime)\n    }\n\n    defer response.Body.Close()\n}   \n\n// post request\nfunc post(url string, params string) {\n    start := time.Now()\n    response, err := http.Post(url, \"application/x-www-form-urlencoded\", strings.NewReader(params))\n    end := time.Now()\n    costTime := float64((end.Sub(start)).Seconds())\n\n    if err != nil {\n        levelOutput.recordStatic(url, false, costTime)\n    } else {\n        levelOutput.recordStatic(url, true, costTime)\n    }\n\n    response.Body.Close()\n}\n\n//clock ticker\nfunc (r *LevelData) clock(urlArrays []UrlArray, concurrent int, initialRatio float64, incrementalRatio float64, intervals int) {\n    start := int(float64(concurrent) * initialRatio)\n    increment := int(float64(concurrent) * incrementalRatio)\n    ticker := time.NewTicker(time.Duration(intervals) * time.Second)\n    endtotal := increment + concurrent\n    objectKey := 0\n\n    for range ticker.C {\n        select {\n        case &lt;-closeAllChan:\n            p(\"\u6b7b\u5faa\u73af\u9000\u51fa\")\n            return \n        default:\n            if objectKey != 0 {\n                for _, v := range(urlArrays) {\n                    val1, ok1 := output.result[v.Url]\n                    p(val1, ok1)\n                    if !ok1 {\n                        val1 = MsgResponse{}\n                        val1.TimeObject = make(map[string]GroupData)\n                    }\n                    val1.TimeObject[strconv.Itoa(objectKey)] = levelOutput.result[v.Url]\n\n                    val1.TotalCount += (val1.TimeObject[strconv.Itoa(objectKey)]).TotalCount\n                    val1.FailCount += (val1.TimeObject[strconv.Itoa(objectKey)]).FailCount\n                    val1.CostTime += (val1.TimeObject[strconv.Itoa(objectKey)]).CostTime\n                    val1.SuccessRate = 1.00 - (float64(val1.FailCount) * 1.00) / (float64(val1.TotalCount) * 1.00) \n                    val1.AvergeTime = val1.CostTime / float64(val1.TotalCount)\n                    output.result[v.Url] = val1\n                }\n            } \n\n            levelOutput = LevelData{result: map[string]GroupData{}}\n\n            if start &gt;= endtotal {\n                p(\"start == concurrent\")\n                close(closeAllChan)\n                time.Sleep(time.Second)\n                return\n            }\n\n            if objectKey == 0 {\n                for i := 0; i &lt; start; i++ {\n                    go work(urlArrays)\n                }\n            } else {\n                for i := 0; i &lt; increment; i++ {\n                    go work(urlArrays)\n                }\n            }\n\n            objectKey += 1\n            start += increment\n        }\n    }\n}\n\n//work\nfunc work(urlArrays []UrlArray) {\n    i := 0\n    for {\n        select {\n        case &lt;-closeAllChan:\n            return \n        default:\n            index := i % len(urlArrays)\n            i++\n\n            url := urlArrays[index].Url\n            method := urlArrays[index].Method\n            params := urlArrays[index].Params\n\n            if method == \"Get\" {\n                get(url, params)\n            } else {\n                post(url, params)\n            } \n        }\n    }\n} \n\nfunc setupResponse(w *http.ResponseWriter, req *http.Request) {\n    (*w).Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    (*w).Header().Set(\"Access-Control-Allow-Methods\", \"POST, GET, OPTIONS\")\n    (*w).Header().Set(\"Access-Control-Allow-Headers\", \"Accept, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization\")\n}\n\n\nfunc myfunc(w http.ResponseWriter, r *http.Request) {\n    setupResponse(&amp;w, r)\n    if (r).Method == \"OPTIONS\" {\n        return\n    }\n\n    b, err := ioutil.ReadAll(r.Body)\n    defer r.Body.Close()\n    if err != nil {\n        http.Error(w, err.Error(), 501)\n        return \n    }\n    //json decode\n    var msgs MsgRequest\n    err = json.Unmarshal(b, &amp;msgs)\n    if err != nil {\n        p(err.Error())\n        http.Error(w, err.Error(), 502)\n        return\n    }\n\n    var command = msgs.Command\n\n    if command == \"stop\" {\n        p(\"stop start\")\n        if isHandle {\n            close(closeAllChan)\n            isHandle = false \n        } else {\n            p(\"no handle\")\n            http.Error(w, \"\u672a\u6709\u6570\u636e\u5728\u6267\u884c\", 504)\n            return\n        }\n    } else if command == \"get\" {\n        p(\"get start\")\n        if isHandle {\n            p(output.result)\n            js, err := json.Marshal(output.result)\n            if err != nil {\n                http.Error(w, err.Error(), 503)\n                return\n            }\n            w.Header().Set(\"Content-Type\", \"application/json\")\n            w.Write(js)\n        } else {\n            p(\"no handle\")\n            http.Error(w, \"\u672a\u6709\u6570\u636e\u5728\u6267\u884c\", 504)\n            return\n        }\n    } else {\n        isHandle = true\n        closeAllChan = make(chan int)\n        output = ResultStatic{result: map[string]MsgResponse{}}\n        urlArrays := msgs.UrlArray\n        concurrent := msgs.Concurrent\n        initialRatio := msgs.InitialRatio\n        incrementalRatio := msgs.IncrementalRatio\n        intervals := msgs.Intervals\n        levelOutput.clock(urlArrays, concurrent, initialRatio, incrementalRatio, intervals)\n        isHandle = false\n        js, err := json.Marshal(output.result)\n        if err != nil {\n            http.Error(w, err.Error(), 503)\n            return \n        }\n        p(output.result)\n\n        w.Header().Set(\"Content-Type\", \"application/json\")\n        w.Write(js) \n    }\n    return\n}\n\nfunc main() {\n    http.HandleFunc(\"/handle\", myfunc)\n    err := http.ListenAndServe(\":8080\", nil)\n    if err != nil {\n        panic(err)\n    }\n}\n\n\n// json example\n// {\n//  \"command\": \"handle/get/stop\",\n//  \"concurrent\": 100,\n//  \"initialRatio\": 0.60,\n//  \"incrementalRatio\": 0.20,\n//  \"intervals\": 10,\n//  \"urls\": [\n//      {\n//          \"url\": \"http://google.com\",\n//          \"method\": \"GET\",\n//          \"params\": \"\"    \n//      }\n//  ]\n// }\n\n</code></pre>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x40 pc=0x6782c4]\n\ngoroutine 64655 [running]:\nmain.post(0xc00001e0c0, 0x3c, 0xc000188510, 0x2f)\n    /root/toolv2.go:114 +0x1b4\nmain.work(0xc000391380, 0x1, 0x4)\n    /root/toolv2.go:193 +0xcf\ncreated by main.(*LevelData).clock\n    /root/toolv2.go:161 +0x657\nexit status 2\n</code></pre>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "edited": false, "score": 0, "creation_date": 1556612298, "post_id": 55916463, "comment_id": 98487578, "body": "although <code>go get</code> do not work well with gitlab, but at first you might need to solve the <code>connection refused</code> issue"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1556613947, "post_id": 55916463, "comment_id": 98488471, "body": "The first thing to do is getting <code>curl -v https:&#47;&#47;gitlab.local&#47;projectsmall&#47;core?go-get=1</code> to work. This seems to be a networking, connectivity issue unrelated to Go."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556632000, "post_id": 55918481, "comment_id": 98498353, "body": "If you believe there is a solution at one of those links, include the relevant details in the body of your answer. Links can die over time and this answer would become useless to someone searching for it in the future."}], "tags": [], "owner": {"reputation": 34, "user_id": 4053730, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K43yr9BGrRg/AAAAAAAAAAI/AAAAAAAAAEk/B3PNv7TkDq8/photo.jpg?sz=128", "display_name": "Magestro", "link": "https://stackoverflow.com/users/4053730/magestro"}, "is_accepted": false, "score": -1, "last_activity_date": 1556786355, "last_edit_date": 1556786355, "creation_date": 1556618389, "answer_id": 55918481, "question_id": 55916463, "link": "https://stackoverflow.com/questions/55916463/how-to-use-local-go-module-inside-a-go-project/55918481#55918481", "title": "How to use local Go module inside a Go project", "body": "<p>I'm not sure, but it seems to me that the problem may be that you are using the ssh keys and you are connecting via the HTTPs protocol as you can see from the error text. </p>\n\n<p>Try it: <a href=\"https://gist.github.com/dmitshur/6927554\" rel=\"nofollow noreferrer\">https://gist.github.com/dmitshur/6927554</a></p>\n\n<pre><code>$ ssh -A vm\n$ git config --global url.\"git@gitlab.local:\".insteadOf \"https://gitlab.local/\"\n$ cat ~/.gitconfig\n[url \"git@gitlab.local:\"]\n    insteadOf = https://gitlab.local/\n$ go get gitlab.local/private/repo &amp;&amp; echo Success!\nSuccess!\n</code></pre>\n\n<p>And also:\n<a href=\"https://stackoverflow.com/questions/27500861/whats-the-proper-way-to-go-get-a-private-repository\">What&#39;s the proper way to &quot;go get&quot; a private repository?</a></p>\n\n<blockquote>\n  <p>In GitLab, since the repositories always end in .git, I must specify\n  .git at the end of the repository name to make it work, for example:</p>\n  \n  <p><code>import \"example.org/myuser/mygorepo.git\"</code> </p>\n  \n  <p>And:</p>\n  \n  <p><code>$ go get example.org/myuser/mygorepo.git</code> </p>\n  \n  <p>Looks like GitHub solves\n  this by appending \".git\".</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 3572, "user_id": 1037295, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/8a4b0b11ae8fcdc4690db9fa4eb63280?s=128&d=identicon&r=PG", "display_name": "yong ho", "link": "https://stackoverflow.com/users/1037295/yong-ho"}, "is_accepted": true, "score": 1, "last_activity_date": 1557025343, "creation_date": 1557025343, "answer_id": 55988482, "question_id": 55916463, "link": "https://stackoverflow.com/questions/55916463/how-to-use-local-go-module-inside-a-go-project/55988482#55988482", "title": "How to use local Go module inside a Go project", "body": "<p>I found out it is using https, but local gitlab is not using SSL. So I tried <code>go get -v -insecure</code> and it's working now.</p>\n"}], "owner": {"reputation": 3572, "user_id": 1037295, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/8a4b0b11ae8fcdc4690db9fa4eb63280?s=128&d=identicon&r=PG", "display_name": "yong ho", "link": "https://stackoverflow.com/users/1037295/yong-ho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 659, "favorite_count": 0, "accepted_answer_id": 55988482, "answer_count": 2, "score": 1, "last_activity_date": 1557025343, "creation_date": 1556611655, "last_edit_date": 1556611848, "question_id": 55916463, "link": "https://stackoverflow.com/questions/55916463/how-to-use-local-go-module-inside-a-go-project", "title": "How to use local Go module inside a Go project", "body": "<p>In our local network, we have a GitLab running. The IP is bind to <code>gitlab.local</code>. I have a go package <code>http://gitlab.local/projectsmall/core</code>, and it is being used by another Go project. Inside this project, when I try to run <code>go mod tidy</code>, I am getting this error:</p>\n\n<pre><code>go get gitlab.local/projectsmall/core: \nunrecognized import path \"gitlab.local/projectsmall/core\" \n(https fetch: \n  Get https://gitlab.local/projectsmall/core?go-get=1: \n  dial tcp 192.168.28.9:443: \n  connect: connection refused\n)\n</code></pre>\n\n<p>I have added the <code>id_rsa.pub</code> contents to SSH Kyes. I tried to add this <code>core</code> project to go mod path like this: <code>/Users/UserA/go/pkg/mod/gitlab.local/guxin/core</code>. The <code>import \"gitlab.local/guxin/core\"</code> is still red using GoLand IDE. It seems the go mod project can't find this <code>gitlab.local/guxin/core</code> package. In <code>go.mod</code> file, inside require block, when I added this <code>gitlab.local/guxin/core</code>, the IDE alert: <code>usage: require module/path</code>.</p>\n"}, {"tags": ["mysql", "database", "go", "reconnect", "go-xorm"], "comments": [{"owner": {"reputation": 20552, "user_id": 460557, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4565f97815833390c9c880e9e8522e4?s=128&d=identicon&r=PG", "display_name": "Jorge Campos", "link": "https://stackoverflow.com/users/460557/jorge-campos"}, "edited": false, "score": 0, "creation_date": 1556610900, "post_id": 55916171, "comment_id": 98486857, "body": "use connection pooling, research and use this as reference it may help: <a href=\"https://stackoverflow.com/questions/38454970/connection-pooling-with-xorm-and-go-mysql\" title=\"connection pooling with xorm and go mysql\">stackoverflow.com/questions/38454970/&hellip;</a>"}, {"owner": {"reputation": 26, "user_id": 11431093, "user_type": "registered", "profile_image": "https://graph.facebook.com/10213134537306608/picture?type=large", "display_name": "Shourie Ganguly", "link": "https://stackoverflow.com/users/11431093/shourie-ganguly"}, "reply_to_user": {"reputation": 20552, "user_id": 460557, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4565f97815833390c9c880e9e8522e4?s=128&d=identicon&r=PG", "display_name": "Jorge Campos", "link": "https://stackoverflow.com/users/460557/jorge-campos"}, "edited": false, "score": 0, "creation_date": 1556615188, "post_id": 55916171, "comment_id": 98489116, "body": "connection pooling still does not solve the problem of a complete db disconnection."}, {"owner": {"reputation": 20552, "user_id": 460557, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4565f97815833390c9c880e9e8522e4?s=128&d=identicon&r=PG", "display_name": "Jorge Campos", "link": "https://stackoverflow.com/users/460557/jorge-campos"}, "edited": false, "score": 0, "creation_date": 1556639594, "post_id": 55916171, "comment_id": 98502919, "body": "The whole purpose of a connection pool is to prevent the application from running out of connections, it will keep a configured number of connections always open in idle state when not in use, so yes, it solves the problem."}, {"owner": {"reputation": 26, "user_id": 11431093, "user_type": "registered", "profile_image": "https://graph.facebook.com/10213134537306608/picture?type=large", "display_name": "Shourie Ganguly", "link": "https://stackoverflow.com/users/11431093/shourie-ganguly"}, "reply_to_user": {"reputation": 20552, "user_id": 460557, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4565f97815833390c9c880e9e8522e4?s=128&d=identicon&r=PG", "display_name": "Jorge Campos", "link": "https://stackoverflow.com/users/460557/jorge-campos"}, "edited": false, "score": 1, "creation_date": 1556803555, "post_id": 55916171, "comment_id": 98558888, "body": "But in my case I am not running out of connections. For example the database server shuts down . Now from my applications perspective the network connection to the db server is broken. Here how will a pool help ? Because logically all open connections in the pool will become invalid. DB server comes back online after 15 mins. The current connections in the pool will still be invalid unless I reset the connection object by making a new connection object. This is my scenario."}, {"owner": {"reputation": 20552, "user_id": 460557, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b4565f97815833390c9c880e9e8522e4?s=128&d=identicon&r=PG", "display_name": "Jorge Campos", "link": "https://stackoverflow.com/users/460557/jorge-campos"}, "edited": false, "score": 1, "creation_date": 1556812696, "post_id": 55916171, "comment_id": 98564199, "body": "So indeed a connection pool will not help in an disaster event. You should be more specific on your question. Add this information that you want to prevent a disaster scenario (ie database fail). Though a connection pool will not help with the disaster event it will make it easy (if it is implemented correctly) to handle this kind of error and a good connection pool will itself handle the re-connection for you (refresh, retry to connect). Your application would only need to check if there are available connections. This handling is and should be abstracted from your code base."}], "owner": {"reputation": 26, "user_id": 11431093, "user_type": "registered", "profile_image": "https://graph.facebook.com/10213134537306608/picture?type=large", "display_name": "Shourie Ganguly", "link": "https://stackoverflow.com/users/11431093/shourie-ganguly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 756, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1556631741, "creation_date": 1556610426, "last_edit_date": 1556631741, "question_id": 55916171, "link": "https://stackoverflow.com/questions/55916171/how-to-detect-database-disconnection-and-effectively-reconnect-using-go-xorm-f", "title": "How to detect database disconnection , and effectively reconnect using go-xorm for databases like mysql, tiDB etc?", "body": "<p>I need to find an effective way to attempt a reconnection , using go-xorm library. Currently if a disconnection occurs , the connection is lost and further queries fail , even if the database comes back online after some time. </p>\n\n<p>Does xorm generate an event on disconnection ?? If so , how can I listen for this event.</p>\n\n<p>My idea was to listen for a disconnection even in a go routine , via a channel .. and fire a reconnection logic (Close current session and current Engine and recreate a new engine and a session on top of it. )</p>\n\n<p>If xorm does not generate a disconnection event , I would have to ping the db at intervals to check for errors .. which I want to avoid. </p>\n\n<p>Currently I'm making a connection in the folllowing way :- </p>\n\n<pre><code>func (sql *SQL) Connect() error {\n    var err error\n    sql.engine, err = xorm.NewEngine(sql.config.Sql.Engine, sql.config.Sql.Url)\n    // sql.engine.SetMaxOpenConns(1)\n    // sql.engine.SetMaxIdleConns(1)\n    // Use a single connect across this instance apart for transactions\n    sql.session = sql.engine.NewSession()\n    go monitorConnection(sql, sql.config.Sql.Engine, sql.config.Sql.Url)\n    return err\n}\n\nfunc refresh(sql *SQL, engine string, url string) (err error) {\n    sql.session.Close()\n    sql.engine.Close()\n    sql.engine = nil\n    sql.session = nil\n\n    sql.engine, err = xorm.NewEngine(engine, url)\n    sql.session = sql.engine.NewSession()\n    return err\n}\n\nfunc monitorConnection(sql *SQL, engine string, url string) {\n    var err error\n\n    for {\n        err = sql.engine.Ping()\n        if err != nil {\n            refresh(sql, engine, url)\n        }\n        time.Sleep(time.Duration(1000) * time.Millisecond)\n    }\n}\n</code></pre>\n\n<p>The config is filled up via other functions.</p>\n\n<p>So currently the only way I feel I can implement the reconnection is by pinging the db in a separate routine constantly until an error occurs, and then close the current session and engine and create new ones.</p>\n\n<p>Can this be done in a better way , making it event based ?</p>\n\n<p>Do I have to create a new engine and session every time  ? </p>\n\n<p>Or is there a better way to handle all of this , using go-xorm ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 14274, "user_id": 579078, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/xC5kj.png?s=128&g=1", "display_name": "\u11bc\u11ba\u11bc", "link": "https://stackoverflow.com/users/579078/%e1%86%bc%e1%86%ba%e1%86%bc"}, "edited": false, "score": 2, "creation_date": 1556607984, "post_id": 55915520, "comment_id": 98485445, "body": "Just move the <code>var b</code> declaration before <code>select</code>?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1556607993, "post_id": 55915520, "comment_id": 98485449, "body": "Declare <code>b</code> in the scope that encompasses all uses of <code>b</code>.  It sounds like the scope is outside of the select statement."}, {"owner": {"reputation": 842, "user_id": 2751683, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/3558b76b5ea55282b21df6a923f60f4a?s=128&d=identicon&r=PG&f=1", "display_name": "Cholthi Paul Ttiopic", "link": "https://stackoverflow.com/users/2751683/cholthi-paul-ttiopic"}, "reply_to_user": {"reputation": 14274, "user_id": 579078, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/xC5kj.png?s=128&g=1", "display_name": "\u11bc\u11ba\u11bc", "link": "https://stackoverflow.com/users/579078/%e1%86%bc%e1%86%ba%e1%86%bc"}, "edited": false, "score": 0, "creation_date": 1556608595, "post_id": 55915520, "comment_id": 98485728, "body": "@\u11bc\u11ba\u11bc What if I shadow <code>b</code> by assigning to it inside <code>select</code> statement"}, {"owner": {"reputation": 14274, "user_id": 579078, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/xC5kj.png?s=128&g=1", "display_name": "\u11bc\u11ba\u11bc", "link": "https://stackoverflow.com/users/579078/%e1%86%bc%e1%86%ba%e1%86%bc"}, "edited": false, "score": 0, "creation_date": 1556608692, "post_id": 55915520, "comment_id": 98485781, "body": "Hm, could you show example code for what you mean? @CholthiPaulTtiopic"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1556608965, "post_id": 55915520, "comment_id": 98485914, "body": "Just try it out. No need to get fancy here."}], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 2, "last_activity_date": 1556627694, "creation_date": 1556627694, "answer_id": 55921101, "question_id": 55915520, "link": "https://stackoverflow.com/questions/55915520/select-statement-scope/55921101#55921101", "title": "Select statement scope", "body": "<p>It's absolutely fine to declare a <code>var</code> outside the <code>select</code> if it's intended to be used after the <code>select</code>:</p>\n\n<pre><code>var b bytes.Buffer\nselect {\ncase &lt;-ctx.Done():\n    &lt;-ch\n    return ctx.Err()\ncase resp := &lt;-ch:\n    if _, err := io.Copy(&amp;b, resp.Body); err != nil {\n        return err\n    }\n}\n... // use b here\n</code></pre>\n\n<p>There is no shadowing involved here, and you can't shadow unless you have another <code>b</code> declared in an inner scope. An assignment <code>b = &lt;something&gt;</code> inside the select here will just assign to the right <code>b</code>.</p>\n"}], "owner": {"reputation": 842, "user_id": 2751683, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/3558b76b5ea55282b21df6a923f60f4a?s=128&d=identicon&r=PG&f=1", "display_name": "Cholthi Paul Ttiopic", "link": "https://stackoverflow.com/users/2751683/cholthi-paul-ttiopic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 55921101, "answer_count": 1, "score": 0, "last_activity_date": 1582537718, "creation_date": 1556607781, "last_edit_date": 1582537718, "question_id": 55915520, "link": "https://stackoverflow.com/questions/55915520/select-statement-scope", "title": "Select statement scope", "body": "<p>In Go, I know that every new enclosing braces declare a new scope, this is true of all control flow statements. Today while writing a program, I stumbled in a scenario where I needed to use the <code>select</code> statement like below</p>\n\n<pre><code>select {\ncase &lt;-ctx.Done():\n    &lt;-ch\n    return ctx.Err()\ncase resp := &lt;-ch:\n    var b bytes.Buffer\n    if _, err := io.Copy(&amp;b, resp.Body); err != nil {\n        return err\n    }\n}\n</code></pre>\n\n<p>From the above code, I would like to access the <code>b</code> variable after select statement is closed. Will that be possible?</p>\n\n<p>I know I can move the logic that uses <code>b</code> inside the select, but I would rather not go that route because <code>select</code> is much complicated already on its own and want to keep it slim for easy understanding in future.</p>\n"}, {"tags": ["postgresql", "go", "go-gorm", "go-gin"], "comments": [{"owner": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "edited": false, "score": 0, "creation_date": 1556604539, "post_id": 55914830, "comment_id": 98483979, "body": "Maybe <code>IsEnable</code> is actually a <code>boolean</code> in the database? (and if not: why not? a <code>boolean</code> would be the natural choice for a true/false flag)"}, {"owner": {"reputation": 11, "user_id": 11311150, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61cba350b2788d3c046fb7f7de74a28b?s=128&d=identicon&r=PG&f=1", "display_name": "Saketh Bv", "link": "https://stackoverflow.com/users/11311150/saketh-bv"}, "reply_to_user": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "edited": false, "score": 0, "creation_date": 1556605348, "post_id": 55914830, "comment_id": 98484342, "body": "IsEnable is an int in db as well. Yeah boolean does the work but im using 0 and 1 globally. @a_horse_with_no_name"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1556605879, "post_id": 55914830, "comment_id": 98484554, "body": "Maybe try the tag <code>gorm:&quot;default:0&quot;</code>. (<a href=\"http://doc.gorm.io/crud.html#default-values\" rel=\"nofollow noreferrer\">doc.gorm.io/crud.html#default-values</a>) <i>&quot;NOTE all fields having zero value, like 0, &#39;&#39;, false or other zero values won&#39;t be saved into database but will use its default value, it you want to avoid this, consider to use pointer type or scaner/valuer&quot;</i>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1556606054, "post_id": 55914830, "comment_id": 98484621, "body": "... or use a map (<a href=\"http://doc.gorm.io/crud.html#update\" rel=\"nofollow noreferrer\">doc.gorm.io/crud.html#update</a>) <i>&quot;Update with struct only works with none zero values, or use map[string]interface{}&quot;</i>."}, {"owner": {"reputation": 11, "user_id": 11311150, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61cba350b2788d3c046fb7f7de74a28b?s=128&d=identicon&r=PG&f=1", "display_name": "Saketh Bv", "link": "https://stackoverflow.com/users/11311150/saketh-bv"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1556606976, "post_id": 55914830, "comment_id": 98485020, "body": "@mkopriva Using a map[string]interface{} works fine when i am updating all the fields in the struct. But when im updating only &quot;IsEnable&quot; field the remaining fields are updated as blank(existing values are getting erased)."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1556607285, "post_id": 55914830, "comment_id": 98485163, "body": "Did you try with the <code>Updates</code> method, as opposed to <code>Update</code>? <i>&quot;Update multiple attributes with <code>map</code>, will only update those changed fields&quot;</i> taken from here: <a href=\"http://doc.gorm.io/crud.html#update-changed-fields\" rel=\"nofollow noreferrer\">doc.gorm.io/crud.html#update-changed-fields</a>"}, {"owner": {"reputation": 11, "user_id": 11311150, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61cba350b2788d3c046fb7f7de74a28b?s=128&d=identicon&r=PG&f=1", "display_name": "Saketh Bv", "link": "https://stackoverflow.com/users/11311150/saketh-bv"}, "edited": false, "score": 0, "creation_date": 1556607508, "post_id": 55914830, "comment_id": 98485254, "body": "Yeah i have tried with Updates as shown in the link, its the same result."}, {"owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "edited": false, "score": 0, "creation_date": 1556613563, "post_id": 55914830, "comment_id": 98488284, "body": "when update with struct, GORM will only update those non zero value fields, check the  <code>Update Selected Fields</code> section here: <a href=\"http://doc.gorm.io/crud.html#update\" rel=\"nofollow noreferrer\">doc.gorm.io/crud.html#update</a>"}], "owner": {"reputation": 11, "user_id": 11311150, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61cba350b2788d3c046fb7f7de74a28b?s=128&d=identicon&r=PG&f=1", "display_name": "Saketh Bv", "link": "https://stackoverflow.com/users/11311150/saketh-bv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1995, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1594827144, "creation_date": 1556604377, "last_edit_date": 1594827144, "question_id": 55914830, "link": "https://stackoverflow.com/questions/55914830/value-0-zero-not-getting-updated-in-postgres-database-when-updation-is-perfo", "title": "Value &#39;0&#39; (Zero) not getting updated in Postgres database when updation is performed using database query written using go-gorm", "body": "<p>I'm trying to update an existing record in PostgreSQL database. I have a column which accepts integers. I have tried doing the update using db query written in gorm. All the integers are getting updated except <code>0</code> (zero).</p>\n\n<p>Can anyone help me fix this issue? </p>\n\n<pre><code>type RoleTypes struct {\n    ID       int `gorm:\"primary_key,AUTO_INCREMENT\"`\n    RoleName string\n    IsEnable int\n}\n</code></pre>\n\n<p>Below is the db query:</p>\n\n<pre><code>func UpdateRoles(db *gorm.DB, r *models.RoleTypes) (err error) {\n    Logr.Debug(\"Inside UpdateRoles method\")\n\n    if err = db.Debug().Model(&amp;r).Where(\"ID=?\", r.ID).Update(&amp;r).Error; err != nil {\n        Logr.Error(\"error occured!!\", zap.Any(\"Error\", err))\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<p>I'm trying to Update the <code>IsEnable</code> to <code>0</code> (Zero).</p>\n"}, {"tags": ["go", "gopath", "bolt", "boltdb"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1556598760, "post_id": 55913606, "comment_id": 98482282, "body": "You must not (really, never!) install 3rd party packages into your Go installation at C:/Go. Set up a workspace as explained in How to Write Go Code."}, {"owner": {"reputation": 1, "user_id": 11430321, "user_type": "registered", "profile_image": "https://graph.facebook.com/10157211649401798/picture?type=large", "display_name": "Jason Terry", "link": "https://stackoverflow.com/users/11430321/jason-terry"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1556645602, "post_id": 55913606, "comment_id": 98505727, "body": "I do have a workspace setup.  It&#39;s reflected above in my GOPATH"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556716086, "post_id": 55913606, "comment_id": 98526143, "body": "No, the error specifically shows that you put <code>roommate</code> in your Go installation; <code>C:\\Go\\src\\roommate\\db.go</code>. Clean that out and put it in the correct location (which you can do with <code>go get</code> to avoid this situation in the first place)"}], "owner": {"reputation": 1, "user_id": 11430321, "user_type": "registered", "profile_image": "https://graph.facebook.com/10157211649401798/picture?type=large", "display_name": "Jason Terry", "link": "https://stackoverflow.com/users/11430321/jason-terry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 297, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1556667958, "creation_date": 1556595223, "last_edit_date": 1556667958, "question_id": 55913606, "link": "https://stackoverflow.com/questions/55913606/cant-load-package-c-go-src-application-db-go102-non-standard-import-git", "title": "can&#39;t load package: C:\\Go\\src\\&quot;application&quot;\\db.go:10:2: non-standard import &quot;github.com/boltdb/bolt&quot; in standard package &quot;application&quot;", "body": "<p>I'm new to coding so I'm sure my mistake is something simple.  I'm trying to install an application from github.com/benbjohnson/roommate.  I have installed go and am able to get the file. </p>\n\n<pre><code>go get github.com/boltdb/bolt/...\n</code></pre>\n\n<p>However, when I try to build the roommate file I get: \"can't load package: C:\\Go\\src\\roommate\\db.go:10:2: non-standard import \"github.com/boltdb/bolt\" in standard package \"roommate\"\"</p>\n\n<p>I have tried changing the GOPATH.<br>\nI have verified that my GOROOT and GOPATH are not the same.  </p>\n\n<p>My Go environment is:</p>\n\n<pre><code>set GOARCH=amd64\nset GOBIN=\nset GOCACHE=C:\\Users\\Jason\\AppData\\Local\\go-build\nset GOEXE=.exe\nset GOFLAGS=\nset GOHOSTARCH=amd64\nset GOHOSTOS=windows\nset GOOS=windows\nset GOPATH=C:\\Users\\Jason\\go-work\nset GOPROXY=\nset GORACE=\nset GOROOT=C:\\Go\nset GOTMPDIR=\nset GOTOOLDIR=C:\\Go\\pkg\\tool\\windows_amd64\nset GCCGO=gccgo\nset CC=gcc\nset CXX=g++\nset CGO_ENABLED=1\nset GOMOD=\nset CGO_CFLAGS=-g -O2\nset CGO_CPPFLAGS=\nset CGO_CXXFLAGS=-g -O2\nset CGO_FFLAGS=-g -O2\nset CGO_LDFLAGS=-g -O2\nset PKG_CONFIG=pkg-config\nset GOGCCFLAGS=-m64 -mthreads -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=C:\\Users\\Jason\\AppData\\Local\\Temp\\go-build767006230=/tmp/go-build -gno-record-gcc-switches\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "is_accepted": true, "score": 1, "last_activity_date": 1556598477, "creation_date": 1556598477, "answer_id": 55913981, "question_id": 55913590, "link": "https://stackoverflow.com/questions/55913590/how-to-pass-different-type-struct-as-parameter-to-a-function-in-golang/55913981#55913981", "title": "How to pass different type struct as parameter to a function,in Golang", "body": "<p>you can use type <code>interface{}</code>:</p>\n\n<pre><code>func responseBodyDecoder(resp http.Response,response interface{}) {\n    // get result form Response\n    decoder := json.NewDecoder(resp.Body)\n    decode_err := decoder.Decode(response)\n    if decode_err != nil {\n        panic(decode_err)\n    }\n}\n</code></pre>\n\n<p>now, you can:</p>\n\n<pre><code>ret:=loginResult{}\nresponseBodyDecoder(resp, &amp;ret)\n\nret2:=responseResult{}\nresponseBodyDecoder(resp, &amp;ret2)\n\n</code></pre>\n\n<p>but careful, both struct <code>responseResult</code> and <code>responseResult</code> don't export any element.\nyou must modify the definition:</p>\n\n<pre><code>type responseResult struct {\n    Result string\n}\n\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 11206261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d93d57a13796a0cd666a87382c35635?s=128&d=identicon&r=PG&f=1", "display_name": "theNebuchadnezzar", "link": "https://stackoverflow.com/users/11206261/thenebuchadnezzar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 55913981, "answer_count": 1, "score": -2, "last_activity_date": 1556598477, "creation_date": 1556595112, "question_id": 55913590, "link": "https://stackoverflow.com/questions/55913590/how-to-pass-different-type-struct-as-parameter-to-a-function-in-golang", "title": "How to pass different type struct as parameter to a function,in Golang", "body": "<p>I have a function for decode http response json to a struct.And I have two types of structs needed to pass to this function, and have the type of struct as return value to get the decoded json.</p>\n\n<p>My function now can deal with ONE type, need help to make it can handle different type of struct, and return the struct.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// Response json\ntype responseResult struct {\n    result string\n}\n\ntype loginResult struct {\n    responseResult\n    token string\n}\n\nfunc responseBodyDecoder(resp http.Response,response *responseResult) {\n    // get result form Response\n    decoder := json.NewDecoder(resp.Body)\n    decode_err := decoder.Decode(&amp;response)\n    if decode_err != nil {\n        panic(decode_err)\n    }\n}\n\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 274, "user_id": 11423104, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fgaQD.jpg?s=128&g=1", "display_name": "isaactfa", "link": "https://stackoverflow.com/users/11423104/isaactfa"}, "edited": false, "score": 0, "creation_date": 1556595394, "post_id": 55913587, "comment_id": 98481596, "body": "You could try using regexp: <a href=\"https://golang.org/pkg/regexp/\" rel=\"nofollow noreferrer\">golang.org/pkg/regexp</a>."}], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 0, "last_activity_date": 1556628703, "creation_date": 1556628703, "answer_id": 55921363, "question_id": 55913587, "link": "https://stackoverflow.com/questions/55913587/remove-space-between-specific-string/55921363#55921363", "title": "Remove space between specific string", "body": "<p>If you're munging nested/structured data like XML I'd strongly suggest using a real XML parser.</p>\n\n<p>But just using a regexp it isn't too hard:</p>\n\n<pre><code>r := regexp.MustCompile(`(?m:&lt;/Listing&gt;\\s*&lt;Listing&gt;)`)\nvar s string = \"&lt;/Listing&gt;&lt;Listing&gt;\"\nfmt.Println(r.ReplaceAllString(\"&lt;/Listing&gt;  \\n\\n &lt;Listing&gt;\", s))\n</code></pre>\n\n<p>Note the <code>?m</code> regexp flag to enabled multi-line matching (assuming you want to allow <code>&lt;/Listing&gt;</code> and <code>&lt;Listing&gt;</code> to be on separate lines</p>\n"}], "owner": {"reputation": 8219, "user_id": 135605, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7c56ff86a79852b167d84b3838756fba?s=128&d=identicon&r=PG", "display_name": "somejkuser", "link": "https://stackoverflow.com/users/135605/somejkuser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 55921363, "answer_count": 1, "score": -1, "last_activity_date": 1556628703, "creation_date": 1556595042, "question_id": 55913587, "link": "https://stackoverflow.com/questions/55913587/remove-space-between-specific-string", "title": "Remove space between specific string", "body": "<p>I need to remove whitespace between <code>&lt;/Listing&gt;</code> and <code>&lt;Listing&gt;</code> inside a file.</p>\n\n<p>I looked here:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/22688010/how-to-trim-leading-and-trailing-white-spaces-of-a-string/22688229\">How to trim leading and trailing white spaces of a string?</a></p>\n\n<p>But that is not string specific.</p>\n"}, {"tags": ["go", "jinja2"], "comments": [{"owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "edited": false, "score": 1, "creation_date": 1556598982, "post_id": 55913146, "comment_id": 98482336, "body": "i don&#39;t think golang template support it, you can define the array in Go code"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1556608680, "post_id": 55913146, "comment_id": 98485773, "body": "Nothing out of the box that supports something like that in Go&#39;s stdlib <code>html&#47;template</code> package, however you can define your own template functions that will help you with that. For example: <a href=\"https://play.golang.com/p/FXapl76qngy\" rel=\"nofollow noreferrer\">play.golang.com/p/FXapl76qngy</a>"}, {"owner": {"reputation": 1452, "user_id": 1751286, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0d235d4094b8dbf2cd9932667d828795?s=128&d=identicon&r=PG", "display_name": "Joe Abbate", "link": "https://stackoverflow.com/users/1751286/joe-abbate"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1556627540, "post_id": 55913146, "comment_id": 98495701, "body": "Thanks, @mkopriva. That&#39;s certainly useful."}, {"owner": {"reputation": 1452, "user_id": 1751286, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0d235d4094b8dbf2cd9932667d828795?s=128&d=identicon&r=PG", "display_name": "Joe Abbate", "link": "https://stackoverflow.com/users/1751286/joe-abbate"}, "edited": false, "score": 0, "creation_date": 1561757891, "post_id": 55913146, "comment_id": 100181010, "body": "FWIW, I ended up defining the menu items as a slice of structs in the Go code (as suggested by zzn) which gets passed with other page data to <code>template.ExecuteTemplate</code>. The template code then uses a <code>{{range .NavMenu}}</code> where the arg is that slice. I hadn&#39;t shown it before but the <code>&lt;li&gt;</code> also had to identify one of the items as currently active, and that wasn&#39;t as easy as in Jinja, requiring a variable declaration outside the range, because range apparently only has access to the individual elements, not the data visible before the range."}], "owner": {"reputation": 1452, "user_id": 1751286, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0d235d4094b8dbf2cd9932667d828795?s=128&d=identicon&r=PG", "display_name": "Joe Abbate", "link": "https://stackoverflow.com/users/1751286/joe-abbate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 139, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1556590922, "creation_date": 1556590922, "question_id": 55913146, "link": "https://stackoverflow.com/questions/55913146/go-html-templates-defining-array-of-array-of-strings-to-range-over", "title": "Go HTML templates: defining array of array of strings to range over", "body": "<p>In Jinja2 (Python Flask) templates, I'm able to create a static navigation menu by defining a list of tuples with code similar to the following:</p>\n\n<pre><code>{% for item in [('', 'Home'), ('menu1', 'Menu1'), ('menu2', 'Menu2')] %}\n&lt;li&gt;&lt;a href=\"{% if item[0] == '' %}/{% else %}{{ '/%s/' % item[0] }}{% endif %}\"&gt;{{ item[1] }}&lt;/a&gt;&lt;/li&gt;\n{%- endfor %}\n</code></pre>\n\n<p>I'd like to create something similar in Go HTML templates. I assume the equivalent to a list of tuples would be an array/slice of arrays of strings, i.e., something like</p>\n\n<pre><code>{{ $items := { {\"\", \"Home\"}, {\"menu1\", \"Menu1\"}, {\"menu2\", \"Menu2\"} } }}\n{{ range $items }}\n&lt;li&gt;&lt;a href=\"{{if .[0] == \\\"\\\"}}/{{else}}{{ \\\"/.[0]/\\\" }}{{end}}\"&gt;{{ .[1] }}&lt;/a&gt;&lt;/li&gt;\n{{end}}\n</code></pre>\n\n<p>However, at runtime, specifically when Go tries to parse the template files it panics with <code>unexpected \"{\" in command</code> (it used to panic with <code>unexpected \"{\" in range</code> when I used a range directly).</p>\n\n<p>So, is it possible to declare an array of arrays of strings in a template?</p>\n"}, {"tags": ["c#", "go", "dll", "cgo"], "comments": [{"owner": {"reputation": 10620, "user_id": 1347308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4bc3aa2f9229b4076575a65bd465a94?s=128&d=identicon&r=PG", "display_name": "maiorano84", "link": "https://stackoverflow.com/users/1347308/maiorano84"}, "edited": false, "score": 0, "creation_date": 1556594608, "post_id": 55913015, "comment_id": 98481443, "body": "Without fully knowing Go, it looks like you&#39;re at least getting the first character of the string before it breaks. Could it be because you&#39;re typecasting as <code>*C.char</code> rather than a simple <code>string</code>?"}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user10400458"}, "is_accepted": true, "score": 2, "last_activity_date": 1557798988, "last_edit_date": 1557798988, "creation_date": 1557798259, "answer_id": 56121932, "question_id": 55913015, "link": "https://stackoverflow.com/questions/55913015/calling-function-from-go-in-c/56121932#56121932", "title": "Calling function from Go in C#", "body": "<p>It works with <code>byte[]</code> instead of <code>string</code>, that is, with the following C# code:</p>\n\n<pre><code>using System;\nusing System.Runtime.InteropServices;\n\nnamespace test\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            Console.WriteLine(\"Hello\");\n            GoFunctions.Test(System.Text.Encoding.UTF8.GetBytes(\"world\"));\n            Console.WriteLine(\"Goodbye.\");\n        }\n    }\n\n\n    static class GoFunctions\n    {\n    [DllImport(@&lt;path to test.dll&gt;, CharSet = CharSet.Unicode, CallingConvention = CallingConvention.StdCall)]\n    public static extern void Test(byte[] str);\n    }\n}\n</code></pre>\n\n<p>I'm not sure why <code>string</code> does not work here though.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10400458"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 714, "favorite_count": 0, "accepted_answer_id": 56121932, "answer_count": 1, "score": 4, "last_activity_date": 1557798988, "creation_date": 1556589854, "last_edit_date": 1557798168, "question_id": 55913015, "link": "https://stackoverflow.com/questions/55913015/calling-function-from-go-in-c", "title": "Calling function from Go in C#", "body": "<p>I'm trying to make a .dll file from Golang to be used in a C# script. However, I can't make a simple example work.</p>\n\n<p>Here is my Go code:</p>\n\n<pre><code>package main\n\nimport (\n    \"C\"\n    \"fmt\"\n)\n\nfunc main() {}\n\n//export Test \nfunc Test(str *C.char) {\n    fmt.Println(\"Hello from within Go\")\n    fmt.Println(fmt.Sprintf(\"A message from Go: %s\", C.GoString(str)))\n}\n</code></pre>\n\n<p>Here is my C# code:</p>\n\n<pre><code>using System;\nusing System.Runtime.InteropServices;\n\nnamespace test\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            Console.WriteLine(\"Hello\");\n            GoFunctions.Test(\"world\");\n            Console.WriteLine(\"Goodbye.\");\n        }\n    }\n\n\n    static class GoFunctions\n    {\n    [DllImport(@&lt;path to test.dll&gt;, CharSet = CharSet.Unicode, CallingConvention = CallingConvention.StdCall)]\n    public static extern void Test(string str);\n    }\n}\n</code></pre>\n\n<p>I'm building the dll from:</p>\n\n<pre><code>go build -buildmode=c-shared -o test.dll &lt;path to go file&gt;\n</code></pre>\n\n<p>The output is</p>\n\n<pre><code>Hello\nHello from within Go\nA message from Go: w\n\npanic: runtime error: growslice: cap out of range\n</code></pre>\n"}, {"tags": ["arrays", "string", "go", "concatenation"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1556593528, "post_id": 55912728, "comment_id": 98481243, "body": "<code>string_matrix</code> is  not defined."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1556599314, "post_id": 55912728, "comment_id": 98482405, "body": "Sanitize your input, e.g. remove control characters like backspaces or that like."}], "answers": [{"tags": [], "owner": {"reputation": 521, "user_id": 1031060, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/UQH9F.jpg?s=128&g=1", "display_name": "neogeek23", "link": "https://stackoverflow.com/users/1031060/neogeek23"}, "is_accepted": true, "score": 0, "last_activity_date": 1556921408, "creation_date": 1556921408, "answer_id": 55977650, "question_id": 55912728, "link": "https://stackoverflow.com/questions/55912728/why-does-concatenating-these-two-strings-shift-the-end-3-characters-over-the-fro/55977650#55977650", "title": "Why does concatenating these two strings shift the end 3 characters over the front 3 characters of the combined string in Go?", "body": "<p>I never found the solution to this but the <code>temp_add</code> section of the below where I arbitrarily slice off the end of the string works.  There is some voodoo up in here.</p>\n\n<pre><code>func build_executable(cmd shell_command, var_swap string_matrix, is_first bool) string{\n    sleep_duration := cmd.Sleep\n    result := \"\"\n    if !is_first{\n        result = \"send \\\"\"\n    } else {\n        result = \"spawn \"\n    }\n    result += cmd.Command\n    if len(cmd.Options.Dashes) &gt; 0 {\n        for index := range cmd.Options.Dashes{\n            if cmd.Options.Dashes[index] != \"\" || cmd.Options.Flags[index] != \"\"{\n                result += \" \" + cmd.Options.Dashes[index] + cmd.Options.Flags[index]\n            }\n            if cmd.Options.Values[index] != \"\"{\n                result += \" \" + cmd.Options.Values[index]\n            }\n        }\n    }\n    if len(cmd.Targets.Litteral) &gt; 0{\n        result += \" \"\n        for index := range cmd.Targets.Litteral{\n            result += cmd.Targets.Litteral[index] + retrieve_mapped_value(cmd.Targets.Variable[index], var_swap)\n        }\n    }\n    if !is_first{\n        result += \"\\\\r\\\"\\n\"\n    } else {\n        result += \"\\n\"\n    }\n    result += \"sleep \" + sleep_duration + \"\\n\"\n    if len(cmd.Interaction.Prompts) &gt; 0{\n        for p_index := range cmd.Interaction.Prompts{\n            interaction_result := \"expect \\\"\" + cmd.Interaction.Prompts[p_index] + \"\\\"\\nsend \\\"\"\n            temp_add := \"\"\n            for r_index := range cmd.Interaction.Replies[p_index].Litteral{\n                interaction_result += cmd.Interaction.Replies[p_index].Litteral[r_index]\n                temp_add = retrieve_mapped_value(cmd.Interaction.Replies[p_index].Variable[r_index], var_swap)\n                if temp_add != \"\"{      //this looks wasteful but it is needed for reasons I don't understand\n                    temp_add += \"\\n\"    //the basic explaination is it seems `retrieve_mapped_value` appends a carriage return &amp; this\n                    temp_add = temp_add[:len(temp_add) - 2]     //messes up the script, I don't know why it appends it, but removes it\n                }\n                interaction_result += temp_add\n            }\n            interaction_result += \"\\\\r\\\"\\nsleep \" + sleep_duration + \"\\n\"\n            result += interaction_result\n        }\n    }\n    if cmd.Expects != \"\" {\n        result += \"expect \\\"\" + cmd.Expects + \"\\\"\\n\"\n    }\n    return result\n}\n</code></pre>\n"}], "owner": {"reputation": 521, "user_id": 1031060, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/UQH9F.jpg?s=128&g=1", "display_name": "neogeek23", "link": "https://stackoverflow.com/users/1031060/neogeek23"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 55977650, "answer_count": 1, "score": -2, "last_activity_date": 1556921408, "creation_date": 1556587160, "question_id": 55912728, "link": "https://stackoverflow.com/questions/55912728/why-does-concatenating-these-two-strings-shift-the-end-3-characters-over-the-fro", "title": "Why does concatenating these two strings shift the end 3 characters over the front 3 characters of the combined string in Go?", "body": "<p>When trying to concatenate two strings, they combine but the next three characters overwrite earlier concatenated text before again continuing to concatenate as expected.  I suspect this is something to do with the <code>retrieve_mapped_value(cmd.Interaction.Replies[p_index].Variable[r_index], var_swap)</code> function as this phenomena <strong>only</strong> happens when it is called within the double <code>for</code> of the <code>cmd.Interaction</code> section of <code>build_executable</code>.</p>\n\n<p><strong>Where the error is</strong></p>\n\n<pre><code>func build_executable(cmd shell_command, var_swap string_matrix, is_first bool) string{\n    sleep_duration := cmd.Sleep\n    result := \"\"\n    if !is_first{\n        result = \"send \\\"\"\n    } else {\n        result = \"spawn \"\n    }\n    result += cmd.Command\n    if len(cmd.Options.Dashes) &gt; 0 {\n        for index := range cmd.Options.Dashes{\n            if cmd.Options.Dashes[index] != \"\" || cmd.Options.Flags[index] != \"\"{\n                result += \" \" + cmd.Options.Dashes[index] + cmd.Options.Flags[index]\n            }\n            if cmd.Options.Values[index] != \"\"{\n                result += \" \" + cmd.Options.Values[index]\n            }\n        }\n    }\n    if len(cmd.Targets.Litteral) &gt; 0{\n        result += \" \"\n        for index := range cmd.Targets.Litteral{\n            result += cmd.Targets.Litteral[index] + retrieve_mapped_value(cmd.Targets.Variable[index], var_swap)\n        }\n    }\n    if !is_first{\n        result += \"\\\\r\\\"\\n\"\n    } else {\n        result += \"\\n\"\n    }\n    result += \"sleep \" + sleep_duration + \"\\n\"\n    if len(cmd.Interaction.Prompts) &gt; 0{\n        for p_index := range cmd.Interaction.Prompts{\n            fmt.Println(\"cmd.Interaction.Prompts[p_index]\\t\" + cmd.Interaction.Prompts[p_index])\n            result += \"expect \\\"\" + cmd.Interaction.Prompts[p_index] + \"\\\"\\nsend \\\"\"\n            for r_index := range cmd.Interaction.Replies[p_index].Litteral{\n                fmt.Println(\"cmd.Interaction.Replies[p_index].Litteral[r_index]\\t'\" + cmd.Interaction.Replies[p_index].Litteral[r_index] + \"'\")\n                fmt.Println(\"cmd.Interaction.Replies[p_index].Variable[r_index]\\t'\" + cmd.Interaction.Replies[p_index].Variable[r_index] + \"'\")\n                fmt.Println(\"retrieve_mapped_value(cmd.Interaction.Replies[p_index].Variable[r_index], var_swap)\\t'\" + retrieve_mapped_value(cmd.Interaction.Replies[p_index].Variable[r_index], var_swap) + \"'\")\n                result += cmd.Interaction.Replies[p_index].Litteral[r_index] \n                result += retrieve_mapped_value(cmd.Interaction.Replies[p_index].Variable[r_index], var_swap)\n                result += \"\" + \"\" + \"\"\n            }\n            result += \"\\\\r\\\"\\nsleep \" + sleep_duration + \"\\n\"\n        }\n    }\n    if cmd.Expects != \"\" {\n        result += \"expect \\\"\" + cmd.Expects + \"\\\"\\n\"\n    }\n    return result\n}\n</code></pre>\n\n<p><strong>Suspect function</strong></p>\n\n<pre><code>func retrieve_mapped_value(key string, mapping string_matrix) string{\n    if key != \"\" {\n        for _, layer := range mapping{\n            if layer[0] == key {\n                return layer[1]\n            }\n        }\n    } else {\n        return key\n    }\n    return \"***No Match Error***\"\n}\n</code></pre>\n\n<p><strong>What I should get</strong></p>\n\n<pre><code>expect \"Enter password for user root: \"\nsend \"e3H-*HGHu__7\\r\"\nsleep 10\n</code></pre>\n\n<p><strong>What I actually get</strong></p>\n\n<pre><code>expect \"Enter password for user root: \"\n\\r\"d \"e3H-*HGHu__7\nsleep 10\n</code></pre>\n\n<p>It is taking the last 3 characters of one line and overwriting the front with them.  I don't understand.</p>\n"}, {"tags": ["go", "timesten"], "answers": [{"comments": [{"owner": {"reputation": 1223, "user_id": 4424636, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rUfLl.png?s=128&g=1", "display_name": "Greenonline", "link": "https://stackoverflow.com/users/4424636/greenonline"}, "edited": false, "score": 0, "creation_date": 1560078476, "post_id": 56513801, "comment_id": 99614190, "body": "Is this an answer or another question?"}], "tags": [], "owner": {"reputation": 1, "user_id": 11589447, "user_type": "registered", "profile_image": "https://graph.facebook.com/10158174333829796/picture?type=large", "display_name": "Chuongnx", "link": "https://stackoverflow.com/users/11589447/chuongnx"}, "is_accepted": false, "score": -1, "last_activity_date": 1560076066, "creation_date": 1560076066, "answer_id": 56513801, "question_id": 55912657, "link": "https://stackoverflow.com/questions/55912657/how-to-connect-to-timesten-database-using-golang/56513801#56513801", "title": "How to connect to TimesTen database using golang?", "body": "<p>You can run bin/ttenv.sh to set environment variable, but i can connect from window but i am not yet connect from linux</p>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 9730869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bfBTk.jpg?s=128&g=1", "display_name": "ScalableDBDoug", "link": "https://stackoverflow.com/users/9730869/scalabledbdoug"}, "is_accepted": false, "score": 0, "last_activity_date": 1573576858, "creation_date": 1573576858, "answer_id": 58823058, "question_id": 55912657, "link": "https://stackoverflow.com/questions/55912657/how-to-connect-to-timesten-database-using-golang/58823058#58823058", "title": "How to connect to TimesTen database using golang?", "body": "<p>The best way to access Go from Oracle TimesTen In-memory Database is to use the <a href=\"https://oracle.github.io/odpi/\" rel=\"nofollow noreferrer\">ODPI-C</a> based go-goracle SQL driver.</p>\n\n<p>You should use tnsnames.ora to specify a TimesTen service name that will be used to connect to Go. The way you use go-goracle is the same whether you use TimesTen or the Oracle RDBMS.</p>\n"}], "owner": {"reputation": 21, "user_id": 9551301, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Lei Yang", "link": "https://stackoverflow.com/users/9551301/lei-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 147, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1573576858, "creation_date": 1556586390, "question_id": 55912657, "link": "https://stackoverflow.com/questions/55912657/how-to-connect-to-timesten-database-using-golang", "title": "How to connect to TimesTen database using golang?", "body": "<p>I am trying to connect TimesTen database using golang, but no TimesTen driver for golang is available I can find.</p>\n\n<p>Does anybody have such experience using golang to access TimesTen?</p>\n\n<p>Since TimesTen supports OCI api. So I am trying to use a go package called goracle at <a href=\"https://github.com/go-goracle/goracle\" rel=\"nofollow noreferrer\">https://github.com/go-goracle/goracle</a> but failed.</p>\n\n<p>Here is my sys.odbc.ini and sys.tt for TimesTen:</p>\n\n<blockquote>\n  <p>[root@centos-7 ~]# more /var/TimesTen/sys.odbc.ini</p>\n  \n  <p>[ODBC Data Sources] TT_1122=TimesTen 11.2.2 Driver\n  sampledb_1122=TimesTen 11.2.2 Driver sampledbCS_1122=TimesTen 11.2.2\n  Client Driver</p>\n  \n  <p>[TT_1122] Driver=/opt/TimesTen/tt1122/lib/libtten.so\n  DataStore=/var/TimesTen/tt1122/TT_1122 DatabaseCharacterSet=US7ASCII</p>\n  \n  <p>[sampledb_1122] Driver=/opt/TimesTen/tt1122/lib/libtten.so\n  DataStore=/var/TimesTen/tt1122/DemoDataStore/sampledb_1122 PermSize=40\n  TempSize=32 PLSQL=1 DatabaseCharacterSet=US7ASCII</p>\n  \n  <p>[sampledbCS_1122] TTC_SERVER=ttLocalHost_tt1122\n  TTC_SERVER_DSN=sampledb_1122\n  Driver=/opt/TimesTen/tt1122/lib/libttclient.so</p>\n</blockquote>\n\n<p>--</p>\n\n<blockquote>\n  <p>[root@centos-7 TimesTen]# more sys.ttconnect.ini</p>\n  \n  <p>[ttLocalHost_tt1122] Description=TimesTen Server\n  Network_Address=ttLocalHost TCP_PORT=53397</p>\n</blockquote>\n\n<pre><code>db, err := sql.Open(\"goracle\",\"root/XXXXXXX@localhost:53397/sampledbCS_1122:timesten_client\") // Trying to use this connect string for TimesTen, I am not sure if it is correct.\n</code></pre>\n\n<p>When running my test app, it reports error as below:</p>\n\n<blockquote>\n  <p>[root@centos-7 ttrest]# ./ttrest \n  Error running query username=\"root\"\n  SID=\"localhost:53397/sampledbCS_1122:timesten_client\" minSessions=1\n  maxSessions=1000 poolIncrement=1 extAuth=0 : ORA-29158: Unable to open\n  library.</p>\n</blockquote>\n"}, {"tags": ["go", "go-html-template"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1556580901, "post_id": 55911795, "comment_id": 98478919, "body": "The first template has a parse error.  The second template has a typo. There&#39;s only  one <code>{</code> in front of .Nickname."}, {"owner": {"reputation": 291, "user_id": 3141154, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/D0xIs.jpg?s=128&g=1", "display_name": "T1960CT", "link": "https://stackoverflow.com/users/3141154/t1960ct"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1556580987, "post_id": 55911795, "comment_id": 98478939, "body": "@CeriseLim&#243;n Ah dang, sorry, that&#39;s a typo in my question. The template file has both braces"}, {"owner": {"reputation": 291, "user_id": 3141154, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/D0xIs.jpg?s=128&g=1", "display_name": "T1960CT", "link": "https://stackoverflow.com/users/3141154/t1960ct"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1556581859, "post_id": 55911795, "comment_id": 98479092, "body": "I tried passing a UL list by hand with &quot;deviceData.DeviceLinkList = `&lt;ul&gt;&lt;li&gt;asd&lt;/li&gt;&lt;li&gt;asd&lt;/li&gt;&lt;/ul&gt;`&quot; and that also rendered in plaintext. Is there something wrong with the header?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1556584100, "post_id": 55911795, "comment_id": 98479524, "body": "The parse error remains in the first template."}, {"owner": {"reputation": 291, "user_id": 3141154, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/D0xIs.jpg?s=128&g=1", "display_name": "T1960CT", "link": "https://stackoverflow.com/users/3141154/t1960ct"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1556586789, "post_id": 55911795, "comment_id": 98479973, "body": "@CeriseLim&#243;n I corrected that as well, after-the-fact. Thank you for having pointed that out! Would have also been a head scratcher for a while."}], "answers": [{"tags": [], "owner": {"reputation": 291, "user_id": 3141154, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/D0xIs.jpg?s=128&g=1", "display_name": "T1960CT", "link": "https://stackoverflow.com/users/3141154/t1960ct"}, "is_accepted": true, "score": 2, "last_activity_date": 1556583132, "creation_date": 1556583132, "answer_id": 55912319, "question_id": 55911795, "link": "https://stackoverflow.com/questions/55911795/template-partially-rendering-as-plaintext/55912319#55912319", "title": "Template partially rendering as plaintext", "body": "<p>The solution is so much simpler than I thought.\nI wasn't using the correct wording to find this SO answer, but it solves it perfectly: <a href=\"https://stackoverflow.com/questions/18175630/go-template-executetemplate-include-html\">Go template.ExecuteTemplate include html</a></p>\n\n<p>The gist is I needed to make the <code>DeviceLinkList</code> type <code>template.HTML</code> instead of string, and when I assign it a value, it needs to be <code>deviceData.DeviceLinkList = template.HTML(\"&lt;ul&gt;&lt;li&gt;list1&lt;/li&gt;&lt;li&gt;list2&lt;/li&gt;&lt;/ul&gt;\")</code></p>\n"}], "owner": {"reputation": 291, "user_id": 3141154, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/D0xIs.jpg?s=128&g=1", "display_name": "T1960CT", "link": "https://stackoverflow.com/users/3141154/t1960ct"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 1, "accepted_answer_id": 55912319, "answer_count": 1, "score": 1, "last_activity_date": 1556583132, "creation_date": 1556578535, "last_edit_date": 1556581047, "question_id": 55911795, "link": "https://stackoverflow.com/questions/55911795/template-partially-rendering-as-plaintext", "title": "Template partially rendering as plaintext", "body": "<p>I'm having trouble with one particular thing I'm trying to put through Go html templates.</p>\n\n<p>(all will be condensed/simplified for brevity)</p>\n\n<p>I have one <code>base</code> template:</p>\n\n<pre class=\"lang-html prettyprint-override\"><code>&lt;html&gt;\n    &lt;head&gt;\n        &lt;title&gt;{{ .Title }}&lt;/title&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        {{ template .PageBody . }}\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>And a <code>device</code> template:</p>\n\n<pre class=\"lang-html prettyprint-override\"><code>{{ define \"device\" }}\n&lt;div class=\"nav\"&gt;\n    &lt;div class=\"links\"&gt;\n        {{ .DeviceLinkList }}\n    &lt;/div&gt;\n&lt;/div&gt;\n&lt;div class=\"textData\"&gt;\n    &lt;div class=\"deviceNick\"&gt;\n        {{ .Nickname }}\n    &lt;/div&gt;\n&lt;/div&gt;\n{{ end }}\n</code></pre>\n\n<p>The way I set this up is like so:</p>\n\n<p>In the <code>main.go</code> file:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\nimport \"html/template\" //among others, of course. \n\nvar err error\nvar tmplInit *template.Template\ntype TemplVals struct{\n    Title       string\n    Version     string\n    Release     string\n    PageBody    string\n}\nvar templVals TemplVals\n\nfunc init(){\n    // Prepare GOHTML templates\n    tmplInit, err = template.ParseGlob(\"./html_templates/*.gohtml\")\n    if err != nil { log.Panic(\"Cant load templates! \", err) }\n    templVals.Version = serverDetails[\"version\"]\n    templVals.Release = serverDetails[\"release\"]\n}\n\n//Main only has MUX routing using Gorilla Mux\n</code></pre>\n\n<p>In the <code>deviceController.go</code> file:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type DeviceValues struct{\n    DeviceLinkList string\n    Nickname string\n    Title string\n}\n\n\nfunc home(w http.ResponseWriter, r *http.Request){\n    w.Header().Set(\"Content-Type\", \"text/html; charset=utf-8\")\n    var deviceData DeviceValues\n\n    // Seems to not be loaded as HTML when passed to template?\n    deviceData.DeviceLinkList = loadDeviceList(\"example\") \n\n    deviceData.Nickname = loadDeviceData(\"example\")\n    deviceData.PageBody = \"device\"\n    deviceData.Title = \"Home\"\n\n    tmplErr := tmplInit.Execute(w, deviceData)\n    if tmplErr != nil{ log.Panic(tmplErr) }\n}\n\nfunc loadDeviceList(user string)(string){\n    var deviceid, linkList string\n    linkList = `&lt;ul&gt;`\n    for getIDs.Next(){\n        err = getIDs.Scan(&amp;deviceid) // SQL gathers this\n        if err != nil { panic(err) }\n        linkList = linkList + `&lt;li&gt;&lt;a href=\"#\" onclick=\"loadDevice('`+deviceid+`')\"&gt;`+deviceid+`&lt;/a&gt;&lt;/li&gt;`\n    }\n    linkList = linkList + `&lt;/ul&gt;`\n\n    return linkList\n}\n\nfunc loadDeviceData(user string)(string){\n    //SQL retrieves data for devices associated to passed in user\n    //for brevity:\n    return \"Example Nickname\"\n}\n</code></pre>\n\n<p>The problem is the nickname is loaded properly, and there are other fields such as battery levels and sensor readings that all pass through properly and can even be used in JS functions, but the DeviceLinkList is rendered in regular string no matter what I do. It's not a list, just pukes out the HTML as-is in plain text.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556574843, "post_id": 55911261, "comment_id": 98477622, "body": "Since they&#39;re in order, what&#39;s wrong with the obvious method of slicing off the oldest values from the start of the slice?"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1556575033, "post_id": 55911261, "comment_id": 98477664, "body": "@JimB: ah, but with reslicing, doesn&#39;t it (new slice) keep referencing the same big array? I&#39;ll happily be proven wrong :)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 3, "creation_date": 1556575318, "post_id": 55911261, "comment_id": 98477729, "body": "@SergioTulentsev: It&#39;s not a problem when you&#39;re continually appending, since the head of the slice is wasted only until a new array is allocated. You would use up the already allocated memory, which is no loss since you&#39;ve already allocated it, then the old array is dropped completely when you need to extend the slice."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556575379, "post_id": 55911261, "comment_id": 98477736, "body": "@JimB: I see, thanks."}], "answers": [{"comments": [{"owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556575892, "post_id": 55911375, "comment_id": 98477867, "body": "@JimB, it&#39;s ok. A lot of the hacks around slices are more cumbersome then they ought to be. Definitely something to keep an eye on."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1556576098, "post_id": 55911375, "comment_id": 98477916, "body": "On the contrary, I prefer how go doesn&#39;t hide the slice internals, so you can see precisely what&#39;s going on. Make it really obvious when code implements &quot;delete&quot; as O(1) or O(n)."}, {"owner": {"reputation": 2826, "user_id": 560745, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/10a38aa801877ac66ffa9ad8e7a46aa1?s=128&d=identicon&r=PG", "display_name": "TCB13", "link": "https://stackoverflow.com/users/560745/tcb13"}, "edited": false, "score": 0, "creation_date": 1556576107, "post_id": 55911375, "comment_id": 98477918, "body": "Thats an interesting approach doing the cleanup not when I get new data but periodically. Thank you."}, {"owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "edited": false, "score": 1, "creation_date": 1556576372, "post_id": 55911375, "comment_id": 98477978, "body": "When taking this approach for long running processes, it is very important to be sure that your cleanup function never terminates. If it might panic, be sure to add a <code>recover()</code> that starts up the cleanup again. Your sample seems like it&#39;s a lightweight operation so that&#39;s probably not that necessary."}], "tags": [], "owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "is_accepted": true, "score": 2, "last_activity_date": 1556575308, "creation_date": 1556575308, "answer_id": 55911375, "question_id": 55911261, "link": "https://stackoverflow.com/questions/55911261/golang-remove-structs-older-than-1h-from-slice/55911375#55911375", "title": "Golang: remove structs older than 1h from slice", "body": "<p>An approach I've used several times is to start a goroutine early in the project that looks something like this:</p>\n\n<pre><code>go cleanup()\n\n...\n\nfunc cleanup() {\n  for {\n    time.Sleep(...)\n    // do cleanup\n  }\n}\n</code></pre>\n\n<p>Then what you could do is iterate over <code>points</code> using <code>time.Since(point.time)</code> to figure out how old each piece of data is. If it's too old, there's a <a href=\"https://github.com/golang/go/wiki/SliceTricks\" rel=\"nofollow noreferrer\">slice trick</a> to remove an item from a slice given it's position:</p>\n\n<pre><code>points = append(points[:i], points[i+1:]...)\n</code></pre>\n\n<p>(where <code>i</code> is the index to remove)</p>\n\n<p>Because the points are in the slice in order of the time they were added, you could speed things up by simply finding the first index that isn't an hour old and doing <code>points = points[i:]</code> to chop off the old points from the beginning of the slice.</p>\n\n<p>You may run into problems if you get a request that accesses the array while you're cleaning it up. Adding a <code>sync.Mutex</code> can help with that. Just lock the mutex before the cleanup and also attempt to lock the mutex anywhere else you write to the array. This may be premature optimization though. I'd experiment without the mutex before adding it in as this would effectively make interacting with <code>points</code> a serial operation and slow the service down.</p>\n\n<p>The <code>time.Sleep(...)</code> in the loop is to prevent from cleaning too often. You might be tempted to set it to an hour since you want to delete points older than that but you might end up with a situation where a point is added immediately after a cleanup. On the next cleanup it'll be 59 mins old and you don't delete it, on the NEXT cleanup it's nearly 2 hours old. My rule of thumb is that I attempt to clean up every 1/10 the amount of time I want to allow an object to stay in memory but that's rather arbitrary. This approach means an object could be at most 1h 5m 59s old when it's deleted.</p>\n"}], "owner": {"reputation": 2826, "user_id": 560745, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/10a38aa801877ac66ffa9ad8e7a46aa1?s=128&d=identicon&r=PG", "display_name": "TCB13", "link": "https://stackoverflow.com/users/560745/tcb13"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 1, "accepted_answer_id": 55911375, "answer_count": 1, "score": 1, "last_activity_date": 1556575308, "creation_date": 1556574582, "question_id": 55911261, "link": "https://stackoverflow.com/questions/55911261/golang-remove-structs-older-than-1h-from-slice", "title": "Golang: remove structs older than 1h from slice", "body": "<p>So I'm building a small utility that listens on a socket and stores incoming messages as a structs in a slice:</p>\n\n<pre><code>var points []Point\n\ntype Point struct {\n    time   time.Time\n    x    float64\n    y    float64\n}\n\nfunc main() {\n    received = make([]Point, 0)\n    l, err := net.Listen(\"tcp4\", \":8900\")\n    // (...)\n}\n\n\nfunc processIncomingData(data string) {\n\n    // Parse icoming data that comes as: xValue,yValue\n    inData = strings.Split(data, \",\")\n    x, err := strconv.ParseFloat(inData[0], 64);\n    if err != nil {\n        fmt.Println(err)\n    }\n    y, err := strconv.ParseFloat(inData[1], 64);\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    // Store the new Point\n    points = append(points, Point{\n        time:   time.Now(),\n        x:    x,\n        y:    y,\n    })\n\n    // Remove points older than 1h ?\n\n}\n</code></pre>\n\n<p>Now, as you might imagine this will quickly fill my RAM. <strong>What's the best way (faster execution) to remove points older than 1h</strong> after appening each new one? I'll be getting new points 10-15 times peer second.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["go", "kubernetes", "delve"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556573393, "post_id": 55910385, "comment_id": 98477207, "body": "These are just go packages, what happens when you call <code>go build</code> manually? I cloned the repo and it works fine here."}, {"owner": {"reputation": 19, "user_id": 3167487, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d025eb39e03f12b2df211b0b298b739e?s=128&d=identicon&r=PG&f=1", "display_name": "Dani", "link": "https://stackoverflow.com/users/3167487/dani"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556588228, "post_id": 55910385, "comment_id": 98480223, "body": "@JimB you mean calling <code>go build kubelet</code>? I tried that both at <code>kubernetes&#39; root directory and at </code>pkg\\kubelet<code>; both issued </code>go: error loading module requirements` error."}, {"owner": {"reputation": 19, "user_id": 3167487, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d025eb39e03f12b2df211b0b298b739e?s=128&d=identicon&r=PG&f=1", "display_name": "Dani", "link": "https://stackoverflow.com/users/3167487/dani"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556588681, "post_id": 55910385, "comment_id": 98480319, "body": "@JimB <code>make all WHAT=cmd&#47;kubelet</code> is what <code>Makefile</code> recommends. but my main question is how to build <code>kubelet</code> so debug info is included, in order to use <code>delve</code>. BTW, yesterday <a href=\"https://github.com/kubernetes/kubernetes/issues/77174\" rel=\"nofollow noreferrer\">issue #77174</a> was opened about <code>kubelet</code> panic."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556637528, "post_id": 55910385, "comment_id": 98501706, "body": "Their Makefile says that <code>GOGCFLAGS=&quot;-N -l&quot;</code> should suffice. Make sure you&#39;re executing the binary you just built, or build it manually from the correct directory (<code>go build kubelet</code> isn&#39;t a valid command, and the kubelet main package is <code>github.com&#47;kubernetes&#47;kubernetes&#47;cmd&#47;kubelet</code>)"}], "answers": [{"tags": [], "owner": {"reputation": 19, "user_id": 3167487, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d025eb39e03f12b2df211b0b298b739e?s=128&d=identicon&r=PG&f=1", "display_name": "Dani", "link": "https://stackoverflow.com/users/3167487/dani"}, "is_accepted": false, "score": 1, "last_activity_date": 1557804607, "creation_date": 1557804607, "answer_id": 56122624, "question_id": 55910385, "link": "https://stackoverflow.com/questions/55910385/how-to-build-kubernetes-so-debug-information-is-included-in-executable-files/56122624#56122624", "title": "How to build Kubernetes so debug information is included in executable files?", "body": "<p>As <a href=\"https://stackoverflow.com/users/32880/jimb\">JimB</a> advised, <code>go build</code> does the trick:</p>\n\n\n\n<pre class=\"lang-none prettyprint-override\"><code>me@mycomputer:~/kubernetes/cmd/kubelet$ sudo go build kubelet.go\nme@mycomputer:~/kubernetes/cmd/kubelet$ file ./kubelet\nkubelet: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically \nlinked, interpreter /lib64/ld-linux-x86-64.so.2, \nBuildID[sha1]=a1377345bfab4ca57b28af60eed92f23c81d7ae8, for GNU/Linux 3.2.0, \nnot stripped\n</code></pre>\n\n<p>As can be seen, the debug info is <em>not stripped</em> anymore. Now you can copy the output to <code>_output/bin</code> and debug it using <code>delve</code>.</p>\n"}], "owner": {"reputation": 19, "user_id": 3167487, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d025eb39e03f12b2df211b0b298b739e?s=128&d=identicon&r=PG&f=1", "display_name": "Dani", "link": "https://stackoverflow.com/users/3167487/dani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 232, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1557804607, "creation_date": 1556569600, "question_id": 55910385, "link": "https://stackoverflow.com/questions/55910385/how-to-build-kubernetes-so-debug-information-is-included-in-executable-files", "title": "How to build Kubernetes so debug information is included in executable files?", "body": "<p>While trying to debug a panic in <code>kubelet</code>, I have been trying unsuccessfully to attach <code>delve</code> to <code>kubelet</code> executable:</p>\n\n<pre><code>me@mycomputer:~$ sudo dlv attach 23796\ncould not attach to pid 23796: could not open debug info\n</code></pre>\n\n<p><code>file</code> and <code>objdump --syms</code> reveal no debug info is included in <code>kubelet</code>:</p>\n\n<pre><code>me@mycomputer:~$ file _output/bin/kubelet \n_output/bin/kubelet: ELF 64-bit LSB executable, x86-64, version 1 \n(SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, \nBuildID[sha1]=c7a1645940f91048eea9086bd0500deb7ec75b38, for \nGNU/Linux 3.2.0, stripped\n\nme@mycomputer:~$ objdump --syms _output/bin/kubelet \n\n_output/bin/kubelet:     file format elf64-x86-64\nSYMBOL TABLE:\nno symbols\n</code></pre>\n\n<p>I have tried different options while building <code>kubelet</code>:</p>\n\n<pre><code>make WHAT=cmd/kubelet GOGCFLAGS=-dwarf\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>make WHAT=cmd/kubelet GOFLAGS=-dwarf\n</code></pre>\n\n<p>but still no debug info is included in the executable. It seems to me that <code>-w</code> option is included by default in <code>go tool link</code>, which strips the DWARF symbol table to save on final executable size (see <a href=\"https://golang.org/cmd/link/\" rel=\"nofollow noreferrer\">here</a>). But I was not able to reverse that.</p>\n\n<p>Any thoughts on how I should build <code>kubelet</code> to include debug info?</p>\n"}, {"tags": ["go", "unmarshalling"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1556572396, "post_id": 55910252, "comment_id": 98476938, "body": "<a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#Unmarshaler</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1267, "user_id": 1598790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11ea12f06eefbb34068f4c1090e2e0b?s=128&d=identicon&r=PG", "display_name": "ramrunner", "link": "https://stackoverflow.com/users/1598790/ramrunner"}, "is_accepted": true, "score": 2, "last_activity_date": 1556574940, "last_edit_date": 1556574940, "creation_date": 1556574085, "answer_id": 55911174, "question_id": 55910252, "link": "https://stackoverflow.com/questions/55910252/golang-unmarshal-mapstringinterface-to-a-struct-containing-an-array-with-met/55911174#55911174", "title": "golang unmarshal map[string]interface{} to a struct containing an array with meta", "body": "<p>This can be quite tricky because you have a json object that holds everything. So i went with the approach of unmarshalling to map of string to *json.RawMessage and then fixing the struct from there. </p>\n\n<p>To do that you will be using a custom Unmarshaler and the benefit of it is that you delay the actual parsing of the inner messages until you need them. </p>\n\n<p>So for example if your meta field was wrong or the numbers it said didn't match the length of the map-1 you could exit prematurely. </p>\n\n<pre><code>package main\n\nimport (\n        \"encoding/json\"\n        \"fmt\"\n)\n\ntype jdata map[string]*json.RawMessage\n\ntype data struct {\n        Meta     Meta\n        Elements []Element\n}\n\n//Element is a key val assoc\ntype Element struct {\n        Key  string\n        Name string\n}\n\n//Meta holds counts and total of elems\ntype Meta struct {\n        Count int\n        Total int\n}\n\nvar datain = []byte(`\n{\n    \"_meta\": {\n        \"count\": 2,\n        \"total\": 2\n    },\n    \"0\": {\n        \"key\": \"key0\",\n        \"name\": \"name0\"\n    },\n    \"1\": {\n        \"key\": \"key1\",\n        \"name\": \"name1\"\n    },\n    \"2\": {\n        \"key\": \"key2\",\n        \"name\": \"name2\"\n    }\n}`)\n\nfunc (d *data) UnmarshalJSON(buf []byte) (err error) {\n        var (\n                meta *json.RawMessage\n                ok   bool\n        )\n        jdata := new(jdata)\n\n        if err = json.Unmarshal(buf, jdata); err != nil {\n                return\n        }\n        if meta, ok = (*jdata)[\"_meta\"]; !ok {\n                return fmt.Errorf(\"_meta field not found in JSON\")\n        }\n        if err = json.Unmarshal(*meta, &amp;d.Meta); err != nil {\n                return\n        }\n        for k, v := range *jdata {\n                if k == \"_meta\" {\n                        continue\n                }\n                elem := &amp;Element{}\n                if err = json.Unmarshal(*v, elem); err != nil {\n                        return err\n                }\n                d.Elements = append(d.Elements, *elem)\n        }\n        return nil\n\n}\n\nfunc main() {\n        data := &amp;data{}\n        if err := data.UnmarshalJSON(datain); err != nil {\n                panic(err)\n        }\n        fmt.Printf(\"decoded:%v\\n\", data)\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 11428909, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YWq6rihZs2o/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc_a2WWjD0od-bCCiyF3FnEv_pE8A/mo/photo.jpg?sz=128", "display_name": "gopher ", "link": "https://stackoverflow.com/users/11428909/gopher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 579, "favorite_count": 0, "accepted_answer_id": 55911174, "answer_count": 1, "score": 1, "last_activity_date": 1556574940, "creation_date": 1556569005, "last_edit_date": 1556569930, "question_id": 55910252, "link": "https://stackoverflow.com/questions/55910252/golang-unmarshal-mapstringinterface-to-a-struct-containing-an-array-with-met", "title": "golang unmarshal map[string]interface{} to a struct containing an array with meta", "body": "<p>I have the following json data coming through an API. I want to unmarshal this data into a different way of structure as it is defined below. How can I do it in an elegant way? </p>\n\n<pre><code>{\n    \"_meta\": {\n        \"count\": 2,\n        \"total\": 2\n    },\n    \"0\": {\n        \"key\": \"key0\",\n        \"name\": \"name0\"\n    },\n    \"1\": {\n        \"key\": \"key1\",\n        \"name\": \"name1\"\n    },\n    \"2\": {\n        \"key\": \"key2\",\n        \"name\": \"name2\"\n    }\n    // It goes on..\n}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Data struct {\n   Meta Meta `json:\"_meta,omitempty\"`\n   Elements []Element\n}\n\ntype Element struct {\n   Key string\n   Name string\n}\n\ntype Meta struct{\n   Count int\n   Total int\n}\n</code></pre>\n"}, {"tags": ["go", "google-cloud-firestore"], "answers": [{"tags": [], "owner": {"reputation": 4765, "user_id": 3945408, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0jXTc.jpg?s=128&g=1", "display_name": "Juan Lara", "link": "https://stackoverflow.com/users/3945408/juan-lara"}, "is_accepted": true, "score": 1, "last_activity_date": 1556733508, "last_edit_date": 1556733508, "creation_date": 1556566586, "answer_id": 55909762, "question_id": 55909562, "link": "https://stackoverflow.com/questions/55909562/is-there-any-way-to-create-index-exemptions-in-go-code-for-cloud-firestore/55909762#55909762", "title": "Is there any way to create index exemptions in (Go) code for Cloud Firestore?", "body": "<p>This feature is not yet supported in the Go client, but support for the Cloud Firestore Admin API was recently added to the Node.js and Java client libraries:</p>\n\n<ul>\n<li><p><a href=\"https://cloud.google.com/nodejs/docs/reference/firestore/1.2.x/v1.FirestoreAdminClient#updateField\" rel=\"nofollow noreferrer\">updateField for single-field indexes, Node.js</a></p></li>\n<li><p><a href=\"https://googleapis.github.io/google-cloud-java/google-cloud-clients/apidocs/index.html?com/google/cloud/firestore/package-summary.html\" rel=\"nofollow noreferrer\">FirestoreAdminClient in Java</a></p></li>\n</ul>\n\n<p>I suspect they will add this feature to the Go client library soon, but I encourage you to also <a href=\"https://github.com/googleapis/google-cloud-go/issues/new\" rel=\"nofollow noreferrer\">open a feature request for the Go client library</a>.</p>\n\n<p>You can also manage your indexes using the gcloud CLI: <a href=\"https://cloud.google.com/sdk/gcloud/reference/beta/firestore/indexes/fields/update\" rel=\"nofollow noreferrer\">gcloud beta firestore indexes fields update</a></p>\n"}], "owner": {"reputation": 2980, "user_id": 1780216, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12afe9fe3a585945a7ce00e25162cf94?s=128&d=identicon&r=PG", "display_name": "Kevin Chen", "link": "https://stackoverflow.com/users/1780216/kevin-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 55909762, "answer_count": 1, "score": 1, "last_activity_date": 1556733508, "creation_date": 1556565597, "question_id": 55909562, "link": "https://stackoverflow.com/questions/55909562/is-there-any-way-to-create-index-exemptions-in-go-code-for-cloud-firestore", "title": "Is there any way to create index exemptions in (Go) code for Cloud Firestore?", "body": "<p>The GoDoc doesn't seem to support this feature.\n<a href=\"https://godoc.org/cloud.google.com/go/firestore\" rel=\"nofollow noreferrer\">https://godoc.org/cloud.google.com/go/firestore</a></p>\n\n<p>I only want to index very few fields, and it's tedious to manually add index exemptions across multiple environments.</p>\n\n<p>Is there anyway to do this in a more automated fashion?\nWill this feature be added to the Go API in the future?</p>\n\n<p>I know this might come to Terraform in the future (<a href=\"https://github.com/terraform-providers/terraform-provider-google/issues/3305\" rel=\"nofollow noreferrer\">https://github.com/terraform-providers/terraform-provider-google/issues/3305</a>).</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1419, "user_id": 488095, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ro1E0.jpg?s=128&g=1", "display_name": "jamieguinan", "link": "https://stackoverflow.com/users/488095/jamieguinan"}, "edited": false, "score": 0, "creation_date": 1556560881, "post_id": 55908223, "comment_id": 98472427, "body": "Does your <code>C:\\....\\AppData\\Local\\Temp</code> folder exist? What if you do (from the <code>src</code> folder) <code>go install</code> without any arguments?"}, {"owner": {"reputation": 1047, "user_id": 10443472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/051b4da9def21dd0ff5e10f383a96c94?s=128&d=identicon&r=PG", "display_name": "retgits", "link": "https://stackoverflow.com/users/10443472/retgits"}, "edited": false, "score": 0, "creation_date": 1556561995, "post_id": 55908223, "comment_id": 98472940, "body": "Did you create the <code>hello.go</code> file in the src folder directly or did you create the package path as it suggests here <a href=\"https://golang.org/doc/code.html#Command\" rel=\"nofollow noreferrer\">golang.org/doc/code.html#Command</a>?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556569718, "post_id": 55908223, "comment_id": 98476036, "body": "From within the <code>hello</code> directory, please show the output of <code>go build -x</code>"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 9108247, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iOWF0.png?s=128&g=1", "display_name": "NullJupiter", "link": "https://stackoverflow.com/users/9108247/nulljupiter"}, "is_accepted": false, "score": -1, "last_activity_date": 1556568651, "creation_date": 1556568651, "answer_id": 55910170, "question_id": 55908223, "link": "https://stackoverflow.com/questions/55908223/how-to-setup-go-environment-on-windows/55910170#55910170", "title": "How to Setup &quot;Go&quot; environment on Windows", "body": "<p>You should try to do the <code>go install</code> command in the <code>~/go/src/</code> directory and not in <code>~/go/hello</code>. So try to move hello directory into the <code>src</code> directory. Even better would be to make a <code>~/go/src/github.com/[YourGithubName]</code> directory where you put your projects in. </p>\n"}], "owner": {"reputation": 1, "user_id": 11428230, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-7LoD5kvmEWc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reO9v_5mUpgyqLMiZQ0dbxpf_wSQA/mo/photo.jpg?sz=128", "display_name": "Avetis Sargsian", "link": "https://stackoverflow.com/users/11428230/avetis-sargsian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1567, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1556595020, "creation_date": 1556558894, "last_edit_date": 1556595020, "question_id": 55908223, "link": "https://stackoverflow.com/questions/55908223/how-to-setup-go-environment-on-windows", "title": "How to Setup &quot;Go&quot; environment on Windows", "body": "<p>I'm trying to setup Go on my Windows machine,</p>\n\n<p>I followed the instruction on this page <a href=\"https://golang.org/doc/code.html#Workspaces\" rel=\"nofollow noreferrer\">https://golang.org/doc/code.html#Workspaces</a> to launch hello.go and face some difficulties.</p>\n\n<p>So, I downloaded and installed MSI file</p>\n\n<p>Here is my Go version:\ngo version go1.12.4 windows/amd64</p>\n\n<p>my go env:</p>\n\n<pre><code>set GOARCH=amd64\nset GOBIN=F:\\GoWorckspace\\bin\nset GOCACHE=C:\\Users\\Avetis\\AppData\\Local\\go-build\nset GOEXE=.exe\nset GOFLAGS=\nset GOHOSTARCH=amd64\nset GOHOSTOS=windows\nset GOOS=windows\nset GOPATH=F:\\GoWorckspace\nset GOPROXY=\nset GORACE=\nset GOROOT=E:\\Go\nset GOTMPDIR=\nset GOTOOLDIR=E:\\Go\\pkg\\tool\\windows_amd64\nset GCCGO=gccgo\nset CC=gcc\nset CXX=g++\nset CGO_ENABLED=1\nset GOMOD=\nset CGO_CFLAGS=-g -O2\nset CGO_CPPFLAGS=\nset CGO_CXXFLAGS=-g -O2\nset CGO_FFLAGS=-g -O2\nset CGO_LDFLAGS=-g -O2\nset PKG_CONFIG=pkg-config\nset GOGCCFLAGS=-m64 -mthreads -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=C:\\Users\\Avetis\\AppData\\Local\\Temp\\go-build714242958=/tmp/go-build -gno-record-gcc-switches\n</code></pre>\n\n<p>GOPATH dir structure is:\n-bin/\n-pkg/\n-src/\n     -hello/\n            hello.go</p>\n\n<p>hello.go content:</p>\n\n<pre><code>package main\n\n  import (\n      \"fmt\"\n  )\n\n  func main() {\n      fmt.Println(\"Hello World!\")\n  }\n</code></pre>\n\n<p>When I try <code>go install</code> I get this arror:</p>\n\n<pre><code> F:\\GoWorckspace\\src\\hello&gt; go install hello.go\nopen C:\\Users\\Avetis\\AppData\\Local\\Temp\\go-build786217674\\b001\\exe\\a.out.exe: The system cannot find the file specified.\n</code></pre>\n\n<p>I have tried different options, but all of them lead to the same error:</p>\n\n<pre><code>PS F:\\GoWorckspace\\src&gt; go install .\\hello\\hello.go\nopen C:\\Users\\Avetis\\AppData\\Local\\Temp\\go-build220985190\\b001\\exe\\a.out.exe: The system cannot find the file specified.\nPS F:\\GoWorckspace\\src&gt; go install .\\hello\nopen C:\\Users\\Avetis\\AppData\\Local\\Temp\\go-build247169354\\b001\\exe\\a.out.exe: The system cannot find the file specified.\nPS F:\\GoWorckspace\\src&gt; go install hello\nopen C:\\Users\\Avetis\\AppData\\Local\\Temp\\go-build365645162\\b001\\exe\\a.out.exe: The system cannot find the file specified.\nPS F:\\GoWorckspace\\src&gt; go build .\\hello\\hello.go\nopen C:\\Users\\Avetis\\AppData\\Local\\Temp\\go-build274908638\\b001\\exe\\a.out.exe: The system cannot find the file specified.\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 3, "creation_date": 1556556532, "post_id": 55905953, "comment_id": 98470701, "body": "have you attempted to use other libraries ?  a quick google of ... golang merge multiple pdf files  ... shows several repos which say they do pdf merge"}], "owner": {"reputation": 39, "user_id": 10559567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44b746c335475d0b0ab5a610c9522e35?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/10559567/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 449, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1556549827, "creation_date": 1556549827, "question_id": 55905953, "link": "https://stackoverflow.com/questions/55905953/append-other-pdf-files-using-gofpdf", "title": "Append other pdf files using gofpdf", "body": "<p>We are using gofpdf to write multiple images to PDF but we would like to also be able to write other pdfs into it (append it to the document or merge it). We have a base64 of the pdf files to merge.</p>\n\n<p>We can't seem to find how to do it in the docs or if it's even possible. Does anyone know how?</p>\n\n<p>I tried to use RawWriteBuf or RawWriteStr using the base64, but neither seem to work.</p>\n"}, {"tags": ["go", "kubernetes"], "answers": [{"tags": [], "owner": {"reputation": 91, "user_id": 3229735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be86ad29574eb397765fcf32f5c61dcc?s=128&d=identicon&r=PG", "display_name": "ouven", "link": "https://stackoverflow.com/users/3229735/ouven"}, "is_accepted": false, "score": 1, "last_activity_date": 1561553178, "creation_date": 1561553178, "answer_id": 56773194, "question_id": 55905899, "link": "https://stackoverflow.com/questions/55905899/using-k8s-go-client-locally-to-connect-to-cluster/56773194#56773194", "title": "using k8s go-client locally to connect to cluster", "body": "<p>make sure you ran through the dependency installation steps as described here: <a href=\"https://github.com/kubernetes/client-go/blob/master/INSTALL.md#go-modules\" rel=\"nofollow noreferrer\">https://github.com/kubernetes/client-go/blob/master/INSTALL.md#go-modules</a>\nThat solved this problem for me.</p>\n\n<p>Also mentioned in <a href=\"https://github.com/kubernetes/client-go/issues/584\" rel=\"nofollow noreferrer\">https://github.com/kubernetes/client-go/issues/584</a></p>\n"}], "owner": {"reputation": 637, "user_id": 10817276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3483337c13bdb9f2146744dc76999f7e?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny M", "link": "https://stackoverflow.com/users/10817276/jenny-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 695, "favorite_count": 2, "answer_count": 1, "score": 0, "last_activity_date": 1561553178, "creation_date": 1556549571, "last_edit_date": 1556619788, "question_id": 55905899, "link": "https://stackoverflow.com/questions/55905899/using-k8s-go-client-locally-to-connect-to-cluster", "title": "using k8s go-client locally to connect to cluster", "body": "<p>I want to run the Go K8S client library and conect to the cluster with kubeconfig which is locally defined on my \nmac under <code>/Users/i0334456/.kube/config</code></p>\n\n<p>The error is: </p>\n\n<pre><code># k8s-go-client/vendor/k8s.io/client-go/rest\nvendor/k8s.io/client-go/rest/request.go:598:31: not enough arguments in call to watch.NewStreamWatcher\nhave (*versioned.Decoder)\nwant (watch.Decoder, watch.Reporter)\n</code></pre>\n\n<p>This is the program which I try to use</p>\n\n<pre><code>package main\n\nimport (\n   \"flag\"\n   \"fmt\"\n   \"os\"\n   \"path/filepath\"\n   \"time\"\n\n   \"k8s.io/apimachinery/pkg/api/errors\"\n   metav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n   \"k8s.io/client-go/kubernetes\"\n   \"k8s.io/client-go/tools/clientcmd\"\n\n)\n\nfunc main() {\n   var kubeconfig *string\n   if home := homeDir(); home != \"\" {\n      kubeconfig = flag.String(\"kubeconfig\", filepath.Join(home, \".kube\", \"config\"), \"(optional) absolute path to the kubeconfig file\")\n   } else {\n      kubeconfig = flag.String(\"kubeconfig\", \"\", \"absolute path to the kubeconfig file\")\n   }\n   flag.Parse()\n\n   // use the current context in kubeconfig\n   config, err := clientcmd.BuildConfigFromFlags(\"\", *kubeconfig)\n   if err != nil {\n      panic(err.Error())\n   }\n\n   // create the clientset\n   clientset, err := kubernetes.NewForConfig(config)\n   if err != nil {\n      panic(err.Error())\n   }\n   for {\n      pods, err := clientset.CoreV1().Pods(\"\").List(metav1.ListOptions{})\n      if err != nil {\n         panic(err.Error())\n      }\n      fmt.Printf(\"There are %d pods in the cluster\\n\", len(pods.Items))\n\n      // Examples for error handling:\n      // - Use helper functions like e.g. errors.IsNotFound()\n      // - And/or cast to StatusError and use its properties like e.g. ErrStatus.Message\n      namespace := \"default\"\n      pod := \"example-xxxxx\"\n      _, err = clientset.CoreV1().Pods(namespace).Get(pod, metav1.GetOptions{})\n      if errors.IsNotFound(err) {\n         fmt.Printf(\"Pod %s in namespace %s not found\\n\", pod, namespace)\n      } else if statusError, isStatus := err.(*errors.StatusError); isStatus {\n         fmt.Printf(\"Error getting pod %s in namespace %s: %v\\n\",\n            pod, namespace, statusError.ErrStatus.Message)\n      } else if err != nil {\n         panic(err.Error())\n      } else {\n         fmt.Printf(\"Found pod %s in namespace %s\\n\", pod, namespace)\n      }\n\n      time.Sleep(10 * time.Second)\n   }\n}\n\nfunc homeDir() string {\n   if h := os.Getenv(\"HOME\"); h != \"\" {\n      return h\n   }\n   return os.Getenv(\"USERPROFILE\") // windows\n}\n\n</code></pre>\n\n<p>I was tried to provide my path as <code>arguments</code> on Goland IDE \nlike <code>/Users/i0334456/.kube/config</code> without success, what am I missing here ?</p>\n\n<p>I want to access via the Go client for K8S to the cluster via API's</p>\n\n<p>if I can use the path explicit in the code this is good either...</p>\n"}, {"tags": ["go", "go-gtk"], "owner": {"reputation": 1290, "user_id": 3741686, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/OBCXg.jpg?s=128&g=1", "display_name": "Davood Falahati", "link": "https://stackoverflow.com/users/3741686/davood-falahati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1556549521, "creation_date": 1556549521, "question_id": 55905883, "link": "https://stackoverflow.com/questions/55905883/gogtk3-custom-signals", "title": "GoGtk3 custom signals", "body": "<p>I need to know how to write a custom signal in GoGtk3. Having a gui thread wherein gtk is working in, I want to update a textview from adjacent goroutine.</p>\n\n<pre><code>label,_:= gtk.LabelNew()\n\ngo func(){\n   // This is listening to a websocket\n   //update label\n   for {\n       c.ReadJSON(&amp;frame) // c is my gorilla websocket \n       fmt.Printf(\"I received something %v\\n\", frame)\n       // label.SetText(\"update ...\") is not working properly\n\n       }\n}()\n</code></pre>\n\n<p>When using label.SetText method, I noticed that this is not working correctly. I suspect this is not thread safe and I should emit a signal instead. I appreciate if you lead me how.</p>\n"}, {"tags": ["mongodb", "go", "driver", "crud"], "comments": [{"owner": {"reputation": 1164, "user_id": 4710925, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/SZviV.jpg?s=128&g=1", "display_name": "shekwo", "link": "https://stackoverflow.com/users/4710925/shekwo"}, "edited": false, "score": 0, "creation_date": 1614256650, "post_id": 55904685, "comment_id": 117333820, "body": "Where you able to solve this?"}], "answers": [{"comments": [{"owner": {"reputation": 728, "user_id": 4156868, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tsaT7.jpg?s=128&g=1", "display_name": "sumedhe", "link": "https://stackoverflow.com/users/4156868/sumedhe"}, "edited": false, "score": 0, "creation_date": 1556652924, "post_id": 55907792, "comment_id": 98508826, "body": "I tried this method. But, I&#39;m getting this error:   multiple write errors: [{write errors: [{Modifiers operate on fields but we found type binData instead. For example: {$mod: {&lt;field&gt;: ...}} not {$set: BinData(0, 6D0000000275736572000C00000073756D65646865667366730002666972&zwnj;&#8203;73746E616D65000A0000&zwnj;&#8203;0053756D656473737364&zwnj;&#8203;00026C6173746E616D65&zwnj;&#8203;000B0000004469737361&zwnj;&#8203;...)}}]}, {&lt;nil&gt;}] ```"}, {"owner": {"reputation": 558, "user_id": 679458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2245db23b37d33d674a2e31e25472b45?s=128&d=identicon&r=PG", "display_name": "TopherGopher", "link": "https://stackoverflow.com/users/679458/tophergopher"}, "edited": false, "score": 0, "creation_date": 1575496102, "post_id": 55907792, "comment_id": 104590549, "body": "There&#39;s no need to marshal the object to bson - ReplaceOne should* take care of it"}], "tags": [], "owner": {"reputation": 1267, "user_id": 1598790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11ea12f06eefbb34068f4c1090e2e0b?s=128&d=identicon&r=PG", "display_name": "ramrunner", "link": "https://stackoverflow.com/users/1598790/ramrunner"}, "is_accepted": false, "score": 0, "last_activity_date": 1556557041, "creation_date": 1556557041, "answer_id": 55907792, "question_id": 55904685, "link": "https://stackoverflow.com/questions/55904685/how-use-update-function-of-mongo-go-driver-using-struct/55907792#55907792", "title": "How use update function of mongo-go-driver using struct", "body": "<p>how about marshalling the person struct to bson?</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n\n        \"labix.org/v2/mgo/bson\"\n)\n\ntype person struct {\n        ID       string `json:\"_id,omitempty\" bson:\"_id,omitempty\"`\n        Username string `json:\"username,omitempty\" bson:\"username,omitempty\"`\n        Name     string `json:\"name,omitempty\" bson:\"name,omitempty\"`\n}\n\nfunc main() {\n        p := person{\n                ID:       \"id\",\n                Username: \"uname\",\n                Name:     \"name\",\n        }\n        var (\n                bm  []byte\n                err error\n        )\n        if bm, err = bson.Marshal(p); err != nil {\n                panic(fmt.Errorf(\"can't marshal:%s\", err))\n        }\n        update := bson.D{{\"$set\", bm}}\n        fmt.Printf(\"update is:%q\\n\", update)\n}\n</code></pre>\n\n<p>run:</p>\n\n<pre><code> ./sobson\nupdate is:[{\"$set\" \"4\\x00\\x00\\x00\\x02_id\\x00\\x03\\x00\\x00\\x00id\\x00\\x02username\\x00\\x06\\x00\\x00\\x00uname\\x00\\x02name\\x00\\x05\\x00\\x00\\x00name\\x00\\x00\"}]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 657, "user_id": 16015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/687fc707b9a25551fa470b92d62c9218?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/16015/chris"}, "edited": false, "score": 1, "creation_date": 1605831895, "post_id": 59185113, "comment_id": 114780553, "body": "How does replace and update differ? Does reindexing happen if you use replace?"}, {"owner": {"reputation": 558, "user_id": 679458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2245db23b37d33d674a2e31e25472b45?s=128&d=identicon&r=PG", "display_name": "TopherGopher", "link": "https://stackoverflow.com/users/679458/tophergopher"}, "reply_to_user": {"reputation": 657, "user_id": 16015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/687fc707b9a25551fa470b92d62c9218?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/16015/chris"}, "edited": false, "score": 1, "creation_date": 1605856908, "post_id": 59185113, "comment_id": 114785912, "body": "Replace is for when you have the whole object/document that you&#39;re dropping into place whereas Update is used to update just part of a document, e.g. $inc (increment) some integer, $set an arbitrary value, etc. Does that make sense?"}, {"owner": {"reputation": 657, "user_id": 16015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/687fc707b9a25551fa470b92d62c9218?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/16015/chris"}, "edited": false, "score": 0, "creation_date": 1605904415, "post_id": 59185113, "comment_id": 114805934, "body": "That makes sense. Do you know if it does a remove+add or does it modify the document in place?"}, {"owner": {"reputation": 558, "user_id": 679458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2245db23b37d33d674a2e31e25472b45?s=128&d=identicon&r=PG", "display_name": "TopherGopher", "link": "https://stackoverflow.com/users/679458/tophergopher"}, "reply_to_user": {"reputation": 657, "user_id": 16015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/687fc707b9a25551fa470b92d62c9218?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/16015/chris"}, "edited": false, "score": 1, "creation_date": 1605916601, "post_id": 59185113, "comment_id": 114809199, "body": "Effectively modifies in place, just overwriting the existing data and dropping the new data in. Anything that was there is lost."}], "tags": [], "owner": {"reputation": 558, "user_id": 679458, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2245db23b37d33d674a2e31e25472b45?s=128&d=identicon&r=PG", "display_name": "TopherGopher", "link": "https://stackoverflow.com/users/679458/tophergopher"}, "is_accepted": false, "score": 6, "last_activity_date": 1575496068, "creation_date": 1575496068, "answer_id": 59185113, "question_id": 55904685, "link": "https://stackoverflow.com/questions/55904685/how-use-update-function-of-mongo-go-driver-using-struct/59185113#59185113", "title": "How use update function of mongo-go-driver using struct", "body": "<p><code>ReplaceOne</code> I think is what you're after:</p>\n\n<pre><code>        // Use it's ID to replace\n        filter := bson.M{\"_id\": existing.ID}\n        // Create a replacement object using the existing object\n        replacementObj := existing\n        replacementObj.SomeFieldToChange = \"new-replacement-object\"\n        updateResult, err := coll.ReplaceOne(context.Background(), filter, replacementObj)\n        assertNotErr(t, err)\n        assertEquals(t, 1, int(updateResult.ModifiedCount))\n</code></pre>\n\n<p>A note that ErrNotFound is no longer thrown as it was in mgo - you have to check the Modified/Upserted count.</p>\n"}, {"comments": [{"owner": {"reputation": 659, "user_id": 1155514, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mjZMX.jpg?s=128&g=1", "display_name": "Muhammad Tariq", "link": "https://stackoverflow.com/users/1155514/muhammad-tariq"}, "edited": false, "score": 0, "creation_date": 1611495859, "post_id": 59424834, "comment_id": 116464367, "body": "How we can get the &quot;filter&quot; object ? Please add the filter code also"}], "tags": [], "owner": {"reputation": 39, "user_id": 9729182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WJdiu.jpg?s=128&g=1", "display_name": "lakex", "link": "https://stackoverflow.com/users/9729182/lakex"}, "is_accepted": false, "score": 2, "last_activity_date": 1576842627, "creation_date": 1576842627, "answer_id": 59424834, "question_id": 55904685, "link": "https://stackoverflow.com/questions/55904685/how-use-update-function-of-mongo-go-driver-using-struct/59424834#59424834", "title": "How use update function of mongo-go-driver using struct", "body": "<p>You could do something like this:</p>\n\n<pre><code>func Update(person Person) error {\n  pByte, err := bson.Marshal(person)\n  if err != nil {\n    return err\n  }\n\n  var update bson.M\n  err = bson.Unmarshal(pByte, &amp;update)\n  if err != nil {\n    return\n  }\n\n  // NOTE: filter and ctx(Context) should be already defined\n  _, err = collection.UpdateOne(ctx, filter, bson.D{{Key: \"$set\", Value: update}})\n  if err != nil {\n    return err\n  }\n  return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 728, "user_id": 4156868, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tsaT7.jpg?s=128&g=1", "display_name": "sumedhe", "link": "https://stackoverflow.com/users/4156868/sumedhe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2760, "favorite_count": 3, "answer_count": 3, "score": 10, "last_activity_date": 1582022232, "creation_date": 1556545381, "last_edit_date": 1556545723, "question_id": 55904685, "link": "https://stackoverflow.com/questions/55904685/how-use-update-function-of-mongo-go-driver-using-struct", "title": "How use update function of mongo-go-driver using struct", "body": "<p>The update function of mongo-go-driver can be called like this.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>filter := bson.D{\"username\", username}\nupdate := bson.D{{\"$set\",\n    bson.D{\n        {\"name\", person.Name},\n    },\n}}\nresult, err := collection.UpdateOne(ctx, filter, update)\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Person struct {\n    ID       primitive.ObjectID `json:\"_id,omitempty\" bson:\"_id,omitempty\"`\n    Username string             `json:\"username,omitempty\" bson:\"username,omitempty\"`\n    Name     string             `json:\"name,omitempty\" bson:\"name,omitempty\"`\n}\n</code></pre>\n\n<p>But, I need to call the update function using the <code>person</code> struct, without mentioning every field of person struct like this.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>filter := bson.D{\"username\", username}\nupdate := bson.D{{\"$set\", &lt;&lt;how to convert person struct to bson document?&gt;&gt;}}\nresult, err := collection.UpdateOne(ctx, filter, update)\n</code></pre>\n\n<p>How can I convert the person struct to bson document?</p>\n"}, {"tags": ["string", "go", "memory", "size"], "answers": [{"comments": [{"owner": {"reputation": 11490, "user_id": 3317808, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6c8272382fcd9841919bc1f8709d25a0?s=128&d=identicon&r=PG&f=1", "display_name": "overexchange", "link": "https://stackoverflow.com/users/3317808/overexchange"}, "edited": false, "score": 0, "creation_date": 1556546754, "post_id": 55904901, "comment_id": 98465652, "body": "So, can I consider this answer as invalid? <a href=\"https://stackoverflow.com/a/26975872/3317808\">stackoverflow.com/a/26975872/3317808</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 11490, "user_id": 3317808, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6c8272382fcd9841919bc1f8709d25a0?s=128&d=identicon&r=PG&f=1", "display_name": "overexchange", "link": "https://stackoverflow.com/users/3317808/overexchange"}, "edited": false, "score": 3, "creation_date": 1556546870, "post_id": 55904901, "comment_id": 98465718, "body": "@overexchange Again, as stressed in my answer, the value returned by <code>unsafe.Sizeof()</code> does not include any memory possibly referenced by the value. This means the memory needed to hold the actual bytes of a slice or string is not covered by it."}, {"owner": {"reputation": 11490, "user_id": 3317808, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6c8272382fcd9841919bc1f8709d25a0?s=128&d=identicon&r=PG&f=1", "display_name": "overexchange", "link": "https://stackoverflow.com/users/3317808/overexchange"}, "edited": false, "score": 0, "creation_date": 1556547852, "post_id": 55904901, "comment_id": 98466273, "body": "I understand... my question is.. Is it not important to comment this <a href=\"https://stackoverflow.com/a/26975872/3317808\">answer</a> as invalid?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 11490, "user_id": 3317808, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6c8272382fcd9841919bc1f8709d25a0?s=128&d=identicon&r=PG&f=1", "display_name": "overexchange", "link": "https://stackoverflow.com/users/3317808/overexchange"}, "edited": false, "score": 2, "creation_date": 1556548085, "post_id": 55904901, "comment_id": 98466397, "body": "@overexchange It depends on how you define the &quot;size&quot;. If you need the referenced / pointed size too, then it&#39;s not valid."}, {"owner": {"reputation": 11490, "user_id": 3317808, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6c8272382fcd9841919bc1f8709d25a0?s=128&d=identicon&r=PG&f=1", "display_name": "overexchange", "link": "https://stackoverflow.com/users/3317808/overexchange"}, "edited": false, "score": 0, "creation_date": 1556548188, "post_id": 55904901, "comment_id": 98466459, "body": "That answer says: &quot;It returns the size in bytes, occupied by the value you pass into it.&quot;"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 11490, "user_id": 3317808, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6c8272382fcd9841919bc1f8709d25a0?s=128&d=identicon&r=PG&f=1", "display_name": "overexchange", "link": "https://stackoverflow.com/users/3317808/overexchange"}, "edited": false, "score": 2, "creation_date": 1556548279, "post_id": 55904901, "comment_id": 98466519, "body": "@overexchange Yes, because a slice value or a string value is just the header. This is the memory required to hold a slice or string header. But if you want to know how much memory it needs to allocate / create them, that requires to include the size of the array these headers point to."}, {"owner": {"reputation": 51, "user_id": 7835315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/313ea7443a630f7d568e565889aadc00?s=128&d=identicon&r=PG&f=1", "display_name": "sprut", "link": "https://stackoverflow.com/users/7835315/sprut"}, "edited": false, "score": 0, "creation_date": 1618595244, "post_id": 55904901, "comment_id": 118658479, "body": "This throws an error in the go playground. <a href=\"https://play.golang.org/p/ugZoV5PeE9H\" rel=\"nofollow noreferrer\">play.golang.org/p/ugZoV5PeE9H</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 51, "user_id": 7835315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/313ea7443a630f7d568e565889aadc00?s=128&d=identicon&r=PG&f=1", "display_name": "sprut", "link": "https://stackoverflow.com/users/7835315/sprut"}, "edited": false, "score": 0, "creation_date": 1618605210, "post_id": 55904901, "comment_id": 118662063, "body": "@sprut Thanks, fixed."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 11, "last_activity_date": 1618605195, "last_edit_date": 1618605195, "creation_date": 1556546178, "answer_id": 55904901, "question_id": 55904674, "link": "https://stackoverflow.com/questions/55904674/golang-memory-allocation-byte-vs-string/55904901#55904901", "title": "GoLang - memory allocation - []byte vs string", "body": "<p>Both slices and strings in Go are struct-like headers:</p>\n<p><a href=\"https://golang.org/pkg/reflect/#SliceHeader\" rel=\"nofollow noreferrer\"><code>reflect.SliceHeader</code></a>:</p>\n<pre><code>type SliceHeader struct {\n        Data uintptr\n        Len  int\n        Cap  int\n}\n</code></pre>\n<p><a href=\"https://golang.org/pkg/reflect/#StringHeader\" rel=\"nofollow noreferrer\"><code>reflect.StringHeader</code></a>:</p>\n<pre><code>type StringHeader struct {\n        Data uintptr\n        Len  int\n}\n</code></pre>\n<p>The sizes reported by <a href=\"https://golang.org/pkg/unsafe/#Sizeof\" rel=\"nofollow noreferrer\"><code>unsafe.Sizeof()</code></a> are the sizes of these headers, exluding the size of the pointed arrays:</p>\n<blockquote>\n<p>Sizeof takes an expression x of any type and returns the size in bytes of a hypothetical variable v as if v was declared via var v = x. <strong>The size does not include any memory possibly referenced by x.</strong> For instance, if x is a slice, Sizeof returns the size of the slice descriptor, not the size of the memory referenced by the slice.</p>\n</blockquote>\n<p>To get the actual (&quot;recursive&quot;) size of some arbitrary value, use Go's builtin testing and benchmarking framework. For details, see <a href=\"https://stackoverflow.com/questions/44257522/how-to-get-memory-size-of-variable-in-golang/44258164#44258164\">How to get memory size of variable in Go?</a></p>\n<p>For strings specifically, see <a href=\"https://stackoverflow.com/questions/52851788/string-memory-usage-in-golang/52851967#52851967\">String memory usage in Golang</a>. The complete memory required by a <code>string</code> value can be computed like this:</p>\n<pre><code>var str string = &quot;some string&quot;\n\nstringSize := len(str) + int(unsafe.Sizeof(str))\n</code></pre>\n"}], "owner": {"reputation": 11490, "user_id": 3317808, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6c8272382fcd9841919bc1f8709d25a0?s=128&d=identicon&r=PG&f=1", "display_name": "overexchange", "link": "https://stackoverflow.com/users/3317808/overexchange"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1747, "favorite_count": 1, "accepted_answer_id": 55904901, "answer_count": 1, "score": 3, "last_activity_date": 1618605195, "creation_date": 1556545353, "last_edit_date": 1556546722, "question_id": 55904674, "link": "https://stackoverflow.com/questions/55904674/golang-memory-allocation-byte-vs-string", "title": "GoLang - memory allocation - []byte vs string", "body": "<p>In the below code:</p>\n\n<pre><code>c := \"fool\"\nd := []byte(\"fool\")\nfmt.Printf(\"c: %T, %d\\n\", c, unsafe.Sizeof(c)) // 16 bytes\nfmt.Printf(\"d: %T, %d\\n\", d, unsafe.Sizeof(d)) // 24 bytes\n</code></pre>\n\n<hr>\n\n<p>To decide the datatype needed to receive JSON data from CloudFoundry, am testing above sample code to understand the memory allocation for <code>[]byte</code> vs <code>string</code> type.</p>\n\n<hr>\n\n<p>Expected size of <code>string</code> type variable <code>c</code> is 1 byte x 4 ascii encoded letter = 4 bytes, but the size shows 16 bytes.</p>\n\n<p>For <code>byte</code> type variable <code>d</code>, GO embeds the string in the executable program as a string literal. It converts the string literal to a byte slice at runtime using the <code>runtime.stringtoslicebyte</code> function. Something like... <code>[]byte{102, 111, 111, 108}</code></p>\n\n<p>Expected size of <code>byte</code> type variable <code>d</code> is again 1 byte x 4 ascii values = 4 bytes but the size of variable <code>d</code> shows 24 bytes as it's underlying array capacity.</p>\n\n<hr>\n\n<p>Why the size of both variables is not 4 bytes?</p>\n"}, {"tags": ["go", "conditional-statements", "mutex"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1556543496, "post_id": 55903747, "comment_id": 98463844, "body": "You should ask such questions on golang-nuts or golang-dev, not SO."}], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 11426604, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-c4lcpg0WTC8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc1SWR3x0x07yUbb4Nwicd1rjSPFQ/mo/photo.jpg?sz=128", "display_name": "jack", "link": "https://stackoverflow.com/users/11426604/jack"}, "edited": false, "score": 0, "creation_date": 1556593148, "post_id": 55908322, "comment_id": 98481172, "body": "thank you for your answer.  The code &quot; \told := m.state  &quot; on line 85 in <a href=\"https://github.com/golang/go/blob/release-branch.go1.12/src/sync/mutex.go\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/release-branch.go1.12/src/sync/&hellip;</a> confuse me , because m.state is direct read without atomic ensuration."}, {"owner": {"reputation": 1267, "user_id": 1598790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11ea12f06eefbb34068f4c1090e2e0b?s=128&d=identicon&r=PG", "display_name": "ramrunner", "link": "https://stackoverflow.com/users/1598790/ramrunner"}, "reply_to_user": {"reputation": 39, "user_id": 11426604, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-c4lcpg0WTC8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc1SWR3x0x07yUbb4Nwicd1rjSPFQ/mo/photo.jpg?sz=128", "display_name": "jack", "link": "https://stackoverflow.com/users/11426604/jack"}, "edited": false, "score": 0, "creation_date": 1556596727, "post_id": 55908322, "comment_id": 98481839, "body": "since the values are atomically read by compareAndSwaps what would be the point of an atomic Load() there? the documentation of the atomic package says that compareandswaps read atomically the value before they compare and possibly set (all those in one step)."}, {"owner": {"reputation": 1267, "user_id": 1598790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11ea12f06eefbb34068f4c1090e2e0b?s=128&d=identicon&r=PG", "display_name": "ramrunner", "link": "https://stackoverflow.com/users/1598790/ramrunner"}, "reply_to_user": {"reputation": 39, "user_id": 11426604, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-c4lcpg0WTC8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc1SWR3x0x07yUbb4Nwicd1rjSPFQ/mo/photo.jpg?sz=128", "display_name": "jack", "link": "https://stackoverflow.com/users/11426604/jack"}, "edited": false, "score": 0, "creation_date": 1556608260, "post_id": 55908322, "comment_id": 98485578, "body": "yes i understand and i am claiming that it doesn&#39;t need to be. let&#39;s say it&#39;s not and look at the first time it&#39;s used. it is loaded unatomically and checked that it doesn&#39;t contain the woken and starving bits set. if they are not set and runtime_canSpin(iter) is true it enters that if statement. then if mutexwoken is not set it enters the second if and only then it matters. it matters because at that point it atomically makes sure that the m.state is still == old and only then it sets it to old|mutexWoken. so if that premise has changed in the meantime it doesn&#39;t matter.CAS won&#39;t set it."}, {"owner": {"reputation": 39, "user_id": 11426604, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-c4lcpg0WTC8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc1SWR3x0x07yUbb4Nwicd1rjSPFQ/mo/photo.jpg?sz=128", "display_name": "jack", "link": "https://stackoverflow.com/users/11426604/jack"}, "edited": false, "score": 0, "creation_date": 1556609432, "post_id": 55908322, "comment_id": 98486139, "body": "Yeah, My point is that why race detector did not detect the race condition for read."}, {"owner": {"reputation": 39, "user_id": 11426604, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-c4lcpg0WTC8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc1SWR3x0x07yUbb4Nwicd1rjSPFQ/mo/photo.jpg?sz=128", "display_name": "jack", "link": "https://stackoverflow.com/users/11426604/jack"}, "edited": false, "score": 0, "creation_date": 1556609494, "post_id": 55908322, "comment_id": 98486173, "body": "func Test(){     a := int32(1)         go func(){                 atomic.CompareAndSwapInt32(&amp;a, 1, 4)         }()         _ = a }  This function will cause a race condtion."}, {"owner": {"reputation": 1267, "user_id": 1598790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11ea12f06eefbb34068f4c1090e2e0b?s=128&d=identicon&r=PG", "display_name": "ramrunner", "link": "https://stackoverflow.com/users/1598790/ramrunner"}, "reply_to_user": {"reputation": 39, "user_id": 11426604, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-c4lcpg0WTC8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc1SWR3x0x07yUbb4Nwicd1rjSPFQ/mo/photo.jpg?sz=128", "display_name": "jack", "link": "https://stackoverflow.com/users/11426604/jack"}, "edited": false, "score": 0, "creation_date": 1556610232, "post_id": 55908322, "comment_id": 98486520, "body": "cause he is only reading the val not setting it. the example that matches this case would be this:func Test(val *int32) {         a := *val;         go func() {                 atomic.CompareAndSwapInt32(val, 1, 4);         }();         _ = a; }  func main() {         sval := int32(4);         Test(&amp;sval); } this doesn&#39;t have a race as expected."}, {"owner": {"reputation": 39, "user_id": 11426604, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-c4lcpg0WTC8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc1SWR3x0x07yUbb4Nwicd1rjSPFQ/mo/photo.jpg?sz=128", "display_name": "jack", "link": "https://stackoverflow.com/users/11426604/jack"}, "edited": false, "score": 0, "creation_date": 1556619649, "post_id": 55908322, "comment_id": 98491577, "body": "I mean if  put my Test function in the file sync/mute.go, It will not trick race warning."}], "tags": [], "owner": {"reputation": 1267, "user_id": 1598790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11ea12f06eefbb34068f4c1090e2e0b?s=128&d=identicon&r=PG", "display_name": "ramrunner", "link": "https://stackoverflow.com/users/1598790/ramrunner"}, "is_accepted": false, "score": 2, "last_activity_date": 1556566367, "last_edit_date": 1556566367, "creation_date": 1556559355, "answer_id": 55908322, "question_id": 55903747, "link": "https://stackoverflow.com/questions/55903747/is-there-a-race-condition-in-the-golang-implementation-of-mutex-the-m-state-is-r/55908322#55908322", "title": "Is there a race condition in the golang implementation of mutex the m.state is read without atomic function", "body": "<p>First of all the golang source always changes so let's make sure we are looking at the same thing. Take release 1.12 at </p>\n\n<p><a href=\"https://github.com/golang/go/blob/release-branch.go1.12/src/sync/mutex.go\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/release-branch.go1.12/src/sync/mutex.go</a></p>\n\n<p>as you said the Lock function begins</p>\n\n<pre><code>func (m *Mutex) Lock() {\n    // fast path where it will set the high order bit and return if not locked\n    if atomic.CompareAndSwapInt32(&amp;m.state, 0, mutexLocked) {\n        return\n    }\n    //reads value to decide on the lower order bits\n    for {\n        //if statements involving CompareAndSwaps on the lower order bits\n    }\n}\n</code></pre>\n\n<p>What is this CompareAndSwap doing? it looks atomically in that int32 and if it is 0 it swaps it to mutexLocked (which is 1 defined as a const above) and returns true that it swapped it. \nThen it promptly returns. That is its fast path. The goroutine acquired the lock and now it is running can start running it's protected path.</p>\n\n<p>If it is 1 (mutexLocked) already, it doesn't swap it and returns false (it didn't swap it).</p>\n\n<p>Then it reads the state and enters a loop that it does atomic compare and swaps to determine how it should behave.</p>\n\n<p>What are the possible states? combinations of locked, woken and starving as you see from the const block.</p>\n\n<p>Now depending on how long the goroutine has been waiting on the waitlist it will get priority on when to check again if the mutex is now free.</p>\n\n<p>But also observe that only Unlock() can set the mutexLocked bit back to 0. \nin the Lock() CAS loop the only bits that are set are the starving and woken ones.Yes you can have multiple readers but only one writer at any time, and that writer is the one who is holding the mutex and is executing its protected path until calling Unlock(). Check out <a href=\"https://morganwu277.github.io/2018/06/19/from-mutex-to-distributed-lock/\" rel=\"nofollow noreferrer\">this article</a> for more details.</p>\n"}, {"tags": [], "owner": {"reputation": 39, "user_id": 11426604, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-c4lcpg0WTC8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc1SWR3x0x07yUbb4Nwicd1rjSPFQ/mo/photo.jpg?sz=128", "display_name": "jack", "link": "https://stackoverflow.com/users/11426604/jack"}, "is_accepted": false, "score": 0, "last_activity_date": 1556635315, "creation_date": 1556635315, "answer_id": 55923383, "question_id": 55903747, "link": "https://stackoverflow.com/questions/55903747/is-there-a-race-condition-in-the-golang-implementation-of-mutex-the-m-state-is-r/55923383#55923383", "title": "Is there a race condition in the golang implementation of mutex the m.state is read without atomic function", "body": "<p>By disassemble the binary output file, The Test function in different pack generate different code. </p>\n\n<p>The reason is that the compiler forbid to generate race detect instrument in the sync package.</p>\n\n<p>The code is :</p>\n\n<pre><code>\nvar norace_inst_pkgs = []string{\"sync\", \"sync/atomic\"}  // https://github.com/golang/go/blob/release-branch.go1.12/src/cmd/compile/internal/gc/racewalk.go\n``\n\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 11426604, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-c4lcpg0WTC8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc1SWR3x0x07yUbb4Nwicd1rjSPFQ/mo/photo.jpg?sz=128", "display_name": "jack", "link": "https://stackoverflow.com/users/11426604/jack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 577, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1556635315, "creation_date": 1556542083, "last_edit_date": 1556609534, "question_id": 55903747, "link": "https://stackoverflow.com/questions/55903747/is-there-a-race-condition-in-the-golang-implementation-of-mutex-the-m-state-is-r", "title": "Is there a race condition in the golang implementation of mutex the m.state is read without atomic function", "body": "<p>In golang if two goroutines read and write a variable without mutex and atomic, that may bring data race condition.</p>\n\n<p>Use command <code>go run --race xxx.go</code> will detect the race point.</p>\n\n<p>While the implementation of Mutex in src/sync/mutex.go use the following code</p>\n\n<pre><code>       func (m *Mutex) Lock() {\n   // Fast path: grab unlocked mutex.\n   if atomic.CompareAndSwapInt32(&amp;m.state, 0, mutexLocked) {\n       if race.Enabled {\n           race.Acquire(unsafe.Pointer(m))\n       }\n       return\n   }\n\n   var waitStartTime int64\n   starving := false\n   awoke := false\n   iter := 0\n   old := m.state     // This line confuse me !!!\n       ......\n</code></pre>\n\n<p>The code <code>old := m.state</code> confuse me, because m.state is read and write by different goroutine.</p>\n\n<p>The following function Test obvious has race condition problem. But if i put it in mutex.go, no race conditon will detect.</p>\n\n<pre><code># mutex.go\nfunc Test(){\n    a := int32(1)\n        go func(){\n                atomic.CompareAndSwapInt32(&amp;a, 1, 4)\n        }()\n        _ = a\n}\n</code></pre>\n\n<p>If put it in other package like src/os/exec.go, the conditon race problem will detect.</p>\n\n<pre><code>package main\n\nimport(\n    \"sync\"\n    \"os\"\n)\nfunc main(){\n    sync.Test()        // race condition will not detect\n    os.Test()          // race condition will detect\n}\n</code></pre>\n"}, {"tags": ["go", "2d-games", "bulletphysics"], "comments": [{"owner": {"reputation": 1, "user_id": 9108247, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iOWF0.png?s=128&g=1", "display_name": "NullJupiter", "link": "https://stackoverflow.com/users/9108247/nulljupiter"}, "reply_to_user": {"reputation": 26395, "user_id": 1699210, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8bBFu.jpg?s=128&g=1", "display_name": "bummi", "link": "https://stackoverflow.com/users/1699210/bummi"}, "edited": false, "score": 0, "creation_date": 1556548583, "post_id": 55903240, "comment_id": 98466705, "body": "Could you explain that a bit more in detail. I don&#39;t think I get it :) @bummi"}, {"owner": {"reputation": 1, "user_id": 9108247, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iOWF0.png?s=128&g=1", "display_name": "NullJupiter", "link": "https://stackoverflow.com/users/9108247/nulljupiter"}, "reply_to_user": {"reputation": 26395, "user_id": 1699210, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8bBFu.jpg?s=128&g=1", "display_name": "bummi", "link": "https://stackoverflow.com/users/1699210/bummi"}, "edited": false, "score": 0, "creation_date": 1556550095, "post_id": 55903240, "comment_id": 98467564, "body": "I mean if you could explain a bit more about what current distance and reference distance is. @bummi"}, {"owner": {"reputation": 1, "user_id": 9108247, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iOWF0.png?s=128&g=1", "display_name": "NullJupiter", "link": "https://stackoverflow.com/users/9108247/nulljupiter"}, "reply_to_user": {"reputation": 26395, "user_id": 1699210, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8bBFu.jpg?s=128&g=1", "display_name": "bummi", "link": "https://stackoverflow.com/users/1699210/bummi"}, "edited": false, "score": 0, "creation_date": 1556565002, "post_id": 55903240, "comment_id": 98474213, "body": "Ah okay. Thanks."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9108247, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iOWF0.png?s=128&g=1", "display_name": "NullJupiter", "link": "https://stackoverflow.com/users/9108247/nulljupiter"}, "edited": false, "score": 0, "creation_date": 1556553035, "post_id": 55906621, "comment_id": 98469095, "body": "Thanks for your reply but it doesn&#39;t work. It&#39;s the same effect after all just slower."}], "tags": [], "owner": {"reputation": 2116, "user_id": 2907606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cbfc259f764c19589410069fae1a933?s=128&d=identicon&r=PG", "display_name": "spirift", "link": "https://stackoverflow.com/users/2907606/spirift"}, "is_accepted": false, "score": 0, "last_activity_date": 1556552347, "creation_date": 1556552347, "answer_id": 55906621, "question_id": 55903240, "link": "https://stackoverflow.com/questions/55903240/how-do-i-get-my-bullets-move-in-the-direction-of-the-mouse-cursor-with-always-th/55906621#55906621", "title": "How do I get my bullets move in the direction of the mouse cursor with always the same speed?", "body": "<p>Does something like this work? The idea is to create a 0 to 1 value for the direction. To do that you divide both values by the greatest of the two. You can then multiply this by the speed of the bullet. I've not detailed the playerPosition function but hopefully you can infer what it would do. </p>\n\n<pre><code>func Max(x, y float64) float64 {\n    if x &lt; y {\n        return y\n    }\n    return x\n}\ntype Bullet struct {\n  x, y, xDir, yDir float64\n}\nfunc getDirection(b *Bullet) {\n  directionX = float64(mouseX) - playerPosition().x\n  directionY = float64(mouseY) - playerPosition().y\n  greatest = Max(mouseX, mouseY)\n  b.xDir = directionX / greatest\n  b.yDir = directionY / greatest\n}\n</code></pre>\n\n<p>Syntax might be off a bit, I'm mostly a js dev ;(</p>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 9108247, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iOWF0.png?s=128&g=1", "display_name": "NullJupiter", "link": "https://stackoverflow.com/users/9108247/nulljupiter"}, "edited": false, "score": 0, "creation_date": 1556564903, "post_id": 55908997, "comment_id": 98474170, "body": "Thank you very much. Yeah I was probably an idiot for not thinking of that but we all still learn xD"}], "tags": [], "owner": {"reputation": 1455, "user_id": 1261335, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7148159afe3a7065728d44063f3d22d0?s=128&d=identicon&r=PG", "display_name": "GrandOpener", "link": "https://stackoverflow.com/users/1261335/grandopener"}, "is_accepted": true, "score": 0, "last_activity_date": 1556569207, "last_edit_date": 1556569207, "creation_date": 1556562728, "answer_id": 55908997, "question_id": 55903240, "link": "https://stackoverflow.com/questions/55903240/how-do-i-get-my-bullets-move-in-the-direction-of-the-mouse-cursor-with-always-th/55908997#55908997", "title": "How do I get my bullets move in the direction of the mouse cursor with always the same speed?", "body": "<p>The problem is that your b.xDir and b.yDir values are directly calculated from the distance, so the farther the mouse click from the player, the higher the values will be.  When they are multiplied by dt, it makes them move faster.</p>\n\n<p>What you need is to <a href=\"https://stackoverflow.com/questions/10002918/what-is-the-need-for-normalizing-a-vector\">normalize</a> your vector, so you only have a direction and not a magnitude carried over from the original click distance.  You probably want to use a vector library, but if you're going to do it by scratch, it would look like this:</p>\n\n<pre><code>magnitude := math.Sqrt(b.XDir * b.xDir + y.xDir * y.xDir)\nb.xDir /= magnitude\nb.yDir /= magnitude\n</code></pre>\n\n<p>At that point the value of your variables is purely a direction, and multiplying by speed and dt will have the expected effects.</p>\n"}], "owner": {"reputation": 1, "user_id": 9108247, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iOWF0.png?s=128&g=1", "display_name": "NullJupiter", "link": "https://stackoverflow.com/users/9108247/nulljupiter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 0, "accepted_answer_id": 55908997, "answer_count": 2, "score": 0, "last_activity_date": 1556569207, "creation_date": 1556540322, "last_edit_date": 1556549956, "question_id": 55903240, "link": "https://stackoverflow.com/questions/55903240/how-do-i-get-my-bullets-move-in-the-direction-of-the-mouse-cursor-with-always-th", "title": "How do I get my bullets move in the direction of the mouse cursor with always the same speed?", "body": "<p>I got a problem with a game of mine. It is a top down shooter and if I am pressing the mouse a bullet should shoot in the direction of where the mouse was.\nThe problem is that with my attempt the bullet would be faster when the distance between player and mouse is bigger and slower when the distance is smaller. I want that speed to be constant no matter what.</p>\n\n<p>This is what my logic looks like so far:</p>\n\n<p>In the constructor I give the bullet a xDir and a yDir:\n<code>b.xDir = (float64(mouseX) - b.x)</code>\n<code>b.yDir = (float64(mouseY) - b.y)</code></p>\n\n<p>Then in the update function I multiply it with deltaTime and the bullets movementSpeed and add it to the corresponding position axis:\n<code>b.x += b.movementSpeed * dt * b.xDir</code>\n<code>b.y += b.movementSpeed * dt * b.yDir</code></p>\n\n<p>With that logic the bullet speed is depending on the distance between mouse and player. I would appreciate an answer which would not mess with the speed but would still go in the direction of the mouse click.</p>\n\n<p>Thanks in advance :)</p>\n"}, {"tags": ["java", "ssl", "go", "grpc", "grpc-java"], "comments": [{"owner": {"reputation": 16391, "user_id": 4690866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/854931adcbf75ac84630116123920854?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Anderson", "link": "https://stackoverflow.com/users/4690866/eric-anderson"}, "edited": false, "score": 1, "creation_date": 1556551373, "post_id": 55903111, "comment_id": 98468242, "body": "What do you mean you don&#39;t want to pass the certificate? Is the go server using a custom CA for its certificate?"}, {"owner": {"reputation": 319, "user_id": 5410940, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/373a537557ed190000734c0ebbd2b486?s=128&d=identicon&r=PG&f=1", "display_name": "Error Hunter", "link": "https://stackoverflow.com/users/5410940/error-hunter"}, "reply_to_user": {"reputation": 16391, "user_id": 4690866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/854931adcbf75ac84630116123920854?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Anderson", "link": "https://stackoverflow.com/users/4690866/eric-anderson"}, "edited": false, "score": 0, "creation_date": 1556558625, "post_id": 55903111, "comment_id": 98471541, "body": "Not custom , but environment specific self signed certificates"}, {"owner": {"reputation": 319, "user_id": 5410940, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/373a537557ed190000734c0ebbd2b486?s=128&d=identicon&r=PG&f=1", "display_name": "Error Hunter", "link": "https://stackoverflow.com/users/5410940/error-hunter"}, "reply_to_user": {"reputation": 16391, "user_id": 4690866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/854931adcbf75ac84630116123920854?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Anderson", "link": "https://stackoverflow.com/users/4690866/eric-anderson"}, "edited": false, "score": 0, "creation_date": 1556558802, "post_id": 55903111, "comment_id": 98471616, "body": "or in other words I want to bypass the security certificates step , is this possible?"}, {"owner": {"reputation": 16391, "user_id": 4690866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/854931adcbf75ac84630116123920854?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Anderson", "link": "https://stackoverflow.com/users/4690866/eric-anderson"}, "edited": false, "score": 1, "creation_date": 1556648697, "post_id": 55903111, "comment_id": 98507139, "body": "gRPC strongly discourages ignoring the certificates and doesn&#39;t &quot;support&quot; ignoring the certs, as that makes it effectively insecure; plaintext is much easier to use for that. We&#39;ve found there&#39;s not been a use-case where it is necessary, even for testing with TLS. It is possible in Java by providing your own TrustManager, like Netty&#39;s InsecureTrustManagerFactory, but &quot;you&#39;re on your own&quot; when using it.  In your case, you could use a hard-coded cert on the server and still get the same effect, which would keep certificate verification enabled."}, {"owner": {"reputation": 319, "user_id": 5410940, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/373a537557ed190000734c0ebbd2b486?s=128&d=identicon&r=PG&f=1", "display_name": "Error Hunter", "link": "https://stackoverflow.com/users/5410940/error-hunter"}, "reply_to_user": {"reputation": 16391, "user_id": 4690866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/854931adcbf75ac84630116123920854?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Anderson", "link": "https://stackoverflow.com/users/4690866/eric-anderson"}, "edited": false, "score": 0, "creation_date": 1556772627, "post_id": 55903111, "comment_id": 98544224, "body": "I have seen this code in go lib --- conn, err := grpc.Dial(serverAddress, grpc.WithInsecure()) , would it also require certificates to be validated? would you be able to help with the trustmanager code exmple?"}, {"owner": {"reputation": 16391, "user_id": 4690866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/854931adcbf75ac84630116123920854?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Anderson", "link": "https://stackoverflow.com/users/4690866/eric-anderson"}, "edited": false, "score": 0, "creation_date": 1556841973, "post_id": 55903111, "comment_id": 98574753, "body": "To mimic grpc.WithInsecure() you would do managedChannelBuilder.usePlaintext() in Java. There is no TLS in that case and so no certificate validation."}, {"owner": {"reputation": 319, "user_id": 5410940, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/373a537557ed190000734c0ebbd2b486?s=128&d=identicon&r=PG&f=1", "display_name": "Error Hunter", "link": "https://stackoverflow.com/users/5410940/error-hunter"}, "reply_to_user": {"reputation": 16391, "user_id": 4690866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/854931adcbf75ac84630116123920854?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Anderson", "link": "https://stackoverflow.com/users/4690866/eric-anderson"}, "edited": false, "score": 0, "creation_date": 1557897187, "post_id": 55903111, "comment_id": 98914196, "body": "@EricAnderson thanks for your suggestions , I have finally found solution around it , it was mostly to do with infra side instead of client."}], "answers": [{"comments": [{"owner": {"reputation": 319, "user_id": 5410940, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/373a537557ed190000734c0ebbd2b486?s=128&d=identicon&r=PG&f=1", "display_name": "Error Hunter", "link": "https://stackoverflow.com/users/5410940/error-hunter"}, "edited": false, "score": 0, "creation_date": 1556614024, "post_id": 55916637, "comment_id": 98488522, "body": "in my case If I run the similar code with my service it is throwing INTERNAL: http2 exception io.grpc.StatusRuntimeException: INTERNAL: http2 exception \tat io.grpc.stub.ClientCalls.toStatusRuntimeException(ClientCall&zwnj;&#8203;s.java:221) \tat io.grpc.stub.ClientCalls.getUnchecked(ClientCalls.java:202) \tat io.grpc.stub.ClientCalls.blockingUnaryCall(ClientCalls.java:&zwnj;&#8203;131)"}], "tags": [], "owner": {"reputation": 29, "user_id": 11143335, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-QTr1k0uQ2cE/AAAAAAAAAAI/AAAAAAAAJo8/MfGTdDcaruw/photo.jpg?sz=128", "display_name": "Prashant Patel", "link": "https://stackoverflow.com/users/11143335/prashant-patel"}, "is_accepted": false, "score": 2, "last_activity_date": 1556612294, "creation_date": 1556612294, "answer_id": 55916637, "question_id": 55903111, "link": "https://stackoverflow.com/questions/55903111/how-to-create-insecure-java-grpc-cilent-for-secure-go-grpc-service/55916637#55916637", "title": "How to create Insecure Java grpc cilent for secure go grpc service", "body": "<pre><code>\nimport java.util.concurrent.TimeUnit;\nimport java.util.logging.Level;\nimport java.util.logging.Logger;\n\nimport io.grpc.ManagedChannel;\nimport io.grpc.ManagedChannelBuilder;\nimport io.grpc.StatusRuntimeException;\nimport io.kubesure.publish.PublisherGrpc;\nimport io.kubesure.publish.PublisherProtos.Ack;\nimport io.kubesure.publish.PublisherProtos.Message;\nimport io.kubesure.publish.PublisherProtos.Message.Builder;\n\npublic class AppClient {\n\n    private static final Logger logger = Logger.getLogger(AppClient.class.getName());\n    private final ManagedChannel channel;\n    private final PublisherGrpc.PublisherBlockingStub blockingStub;\n\n    public AppClient(String host, int port) {\n        this(ManagedChannelBuilder.forAddress(host, port)\n                // Channels are secure by default (via SSL/TLS). For the example we disable TLS\n                // to avoid\n                // needing certificates.\n                .usePlaintext().build());\n    }\n\n    AppClient(ManagedChannel channel) {\n        this.channel = channel;\n        blockingStub = PublisherGrpc.newBlockingStub(channel);\n    }\n\n    public Ack publish(String payload) {\n        logger.info(\"Payload sent to publisher \");\n        Builder builder = Message.newBuilder();\n        builder.setPayload(payload);\n        builder.setVersion(\"v1\");\n        builder.setType(\"Policy\");\n        builder.setDestination(\"policyissued\");\n        Message message = builder.build();\n        try {\n            Ack ack = blockingStub.publish(message);\n            logger.info(\"is published: \" + ack.getOk());\n            return ack;\n        } catch (StatusRuntimeException e) {\n            logger.log(Level.WARNING, \"RPC failed: {0}\", e.getStatus());\n            return Ack.newBuilder().setOk(false).build(); \n        }\n    }\n\n    public void shutdown() throws InterruptedException {\n        channel.shutdown().awaitTermination(5, TimeUnit.SECONDS);\n    }\n\n    public static void main(String[] args) throws Exception {\n        AppClient client = new AppClient(\"localhost\", 50051);\n        try {\n            /* Access a service running on the local machine on port 50051 */\n            String payload = \"supplies to mars\";\n            if (args.length &gt; 0) {\n                payload = args[0]; /* Use the arg as the name to greet if provided */\n            }\n            client.publish(payload);\n        } finally {\n            client.shutdown();\n        }\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 319, "user_id": 5410940, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/373a537557ed190000734c0ebbd2b486?s=128&d=identicon&r=PG&f=1", "display_name": "Error Hunter", "link": "https://stackoverflow.com/users/5410940/error-hunter"}, "is_accepted": true, "score": 3, "last_activity_date": 1557897804, "creation_date": 1557897804, "answer_id": 56142239, "question_id": 55903111, "link": "https://stackoverflow.com/questions/55903111/how-to-create-insecure-java-grpc-cilent-for-secure-go-grpc-service/56142239#56142239", "title": "How to create Insecure Java grpc cilent for secure go grpc service", "body": "<p>I have figured out the solution finally , in my case</p>\n\n<ol>\n<li>Netty versions were not in sync in my build.gradle , because of that I was receiving the exception as below </li>\n</ol>\n\n<pre><code>Could not find TLS ALPN provider; no working netty-tcnative,\nConscrypt, or Jetty NPN/ALPN available\n</code></pre>\n\n<p>to resolve this I have setup the versions as followed</p>\n\n<blockquote>\n  <p>grpc-netty - 1.20.x-   |||    netty-handler-4.1.34.Final\n  |||   netty-tcnative-boringssl-static version  2.0.22.Final\n  <a href=\"https://github.com/grpc/grpc-java/blob/master/SECURITY.md#netty\" rel=\"nofollow noreferrer\">got idea from here</a></p>\n</blockquote>\n\n<ol start=\"2\">\n<li>for tls connection this works</li>\n</ol>\n\n<pre><code>channel  = NettyChannelBuilder\n                .forAddress(\"host\",port)\n               .sslContext(GrpcSslContexts.forClient().trustManager(InsecureTrustManagerFactory.INSTANCE).build())\n                .build();\n\n</code></pre>\n\n<ol start=\"3\">\n<li>for non tls </li>\n</ol>\n\n<pre><code>\n              channel  = NettyChannelBuilder\n            .forAddress(\"host\",port).usePlaintext()\n       .build();\n</code></pre>\n"}], "owner": {"reputation": 319, "user_id": 5410940, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/373a537557ed190000734c0ebbd2b486?s=128&d=identicon&r=PG&f=1", "display_name": "Error Hunter", "link": "https://stackoverflow.com/users/5410940/error-hunter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1764, "favorite_count": 1, "accepted_answer_id": 56142239, "answer_count": 2, "score": 2, "last_activity_date": 1557897804, "creation_date": 1556539883, "last_edit_date": 1556558868, "question_id": 55903111, "link": "https://stackoverflow.com/questions/55903111/how-to-create-insecure-java-grpc-cilent-for-secure-go-grpc-service", "title": "How to create Insecure Java grpc cilent for secure go grpc service", "body": "<p>I am trying to create grpc service client in Java where server is in goLang and deployed with the https . where I am trying to achieve a non-secured connection [I don't want to pass the certificate ]</p>\n\n<pre><code>public class testgrpc {\n    ManagedChannel channel ;\n    ServiceGrpc.ServiceBlockingStub  blockingStub;\n    String host = \"remotesecuredhost\";\n    int port =\"XXX\";\n\n    @Test\n    public void testgrpc()\n    {\n    channel = ManagedChannelBuilder.forAddress(host,port).build();\n\n     blockingStub = ServiceGrpc.newBlockingStub(channel);\n\n    response =  blockingStub.health(Empty.newBuilder().build());\n\n    }\n\n}\n</code></pre>\n\n<p>the above code gives following exception </p>\n\n<pre><code>io.grpc.StatusRuntimeException: UNAVAILABLE: io exception\n    at io.grpc.stub.ClientCalls.toStatusRuntimeException(ClientCalls.java:221)\n    at io.grpc.stub.ClientCalls.getUnchecked(ClientCalls.java:202)\n    at io.grpc.stub.ClientCalls.blockingUnaryCall(ClientCalls.java:131)\n</code></pre>\n\n<p>can someone help with Client code </p>\n"}, {"tags": ["postgresql", "go", "associations", "go-gorm"], "comments": [{"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1556662846, "post_id": 55902754, "comment_id": 98512299, "body": "How do you update the <code>Car</code> object? What is the full <code>db.Update()</code> command?"}, {"owner": {"reputation": 147, "user_id": 9854579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5b6f1b1a8219172d43eb4f108d33782?s=128&d=identicon&r=PG&f=1", "display_name": "Yuri", "link": "https://stackoverflow.com/users/9854579/yuri"}, "reply_to_user": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1556713941, "post_id": 55902754, "comment_id": 98525179, "body": "` sqlConnection, err := o.Connect() \tif err != nil { \t\treturn \t} \tdefer sqlConnection.Close() \tsqlConnection.Save(&amp;myCar) \tsqlConnection.Close() \treturn `"}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 1, "creation_date": 1556723343, "post_id": 55902754, "comment_id": 98529645, "body": "Exactly the problem. You should use <code>db.Update()</code> and not <code>db.Save()</code>. Check the <a href=\"http://gorm.io/docs/update.html#Update-All-Fields\" rel=\"nofollow noreferrer\">docs</a>: <code>Save</code> will include all fields when perform the Updating SQL, even it is not changed.."}, {"owner": {"reputation": 147, "user_id": 9854579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5b6f1b1a8219172d43eb4f108d33782?s=128&d=identicon&r=PG&f=1", "display_name": "Yuri", "link": "https://stackoverflow.com/users/9854579/yuri"}, "reply_to_user": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1556727248, "post_id": 55902754, "comment_id": 98531550, "body": "But we need to pass fields to db.Update() and I have a million fields... I saw that they have db.Updates() and to pass the entire struct as param  // Update multiple attributes with <code>struct</code>, will only update those changed &amp; non blank fields db.Model(&amp;user).Updates(User{Name: &quot;hello&quot;, Age: 18}) //// UPDATE users SET name=&#39;hello&#39;, age=18, updated_at = &#39;2013-11-17 21:34:10&#39; WHERE id = 111;"}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 1, "creation_date": 1556800698, "post_id": 55902754, "comment_id": 98557154, "body": "Sure, then use <code>db.Updates()</code> instead of <code>db.Update()</code>."}], "owner": {"reputation": 147, "user_id": 9854579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5b6f1b1a8219172d43eb4f108d33782?s=128&d=identicon&r=PG&f=1", "display_name": "Yuri", "link": "https://stackoverflow.com/users/9854579/yuri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2448, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1600970589, "creation_date": 1556538532, "last_edit_date": 1556595506, "question_id": 55902754, "link": "https://stackoverflow.com/questions/55902754/gorm-model-on-update-overwriting-fields-that-i-want-to-ignore", "title": "Gorm model on update overwriting fields that I want to ignore", "body": "<p>I'm using gorm(GoLang) with PostgreSQL.\nrecently I've decided to use association with gorm in order to save time and for best practice...</p>\n\n<p>So the issue is that I want to update a model without overwriting all his fields.</p>\n\n<p>for example' I have this structs:</p>\n\n<pre><code>type Car struct {\n    gorm.Model\n    CarModels []CarModel `json:\"car_models\"`\n    Foo       string     `json:\"foo\"`\n}\n\ntype CarModel struct {\n    gorm.Model\n    Name  string `json:\"name\"`\n    Bar   string `json:\"-\"`\n    CarID uint   `json:\"car_id\"`\n}\n</code></pre>\n\n<ul>\n<li>The user can only see the car model name and car_id. \n\n<ol>\n<li>The user changed the car model name and asked to save it.</li>\n<li>I want to save the changes to DB and Gorm <code>db.Update()</code></li>\n<li>so I save the Car model (not the CarModel !!!) because they are associated </li>\n</ol></li>\n</ul>\n\n<p>And the issue is that field Bar is empty on DB... because I didn't return it to the client...</p>\n\n<p>I've tried to find an answer here and on <a href=\"http://doc.gorm.io/associations.html#has-many\" rel=\"nofollow noreferrer\">Gorm docs</a> and didn't find any...</p>\n\n<p>Does someone have any idea how to handle this problem?</p>\n"}, {"tags": ["for-loop", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1556538553, "post_id": 55902279, "comment_id": 98461086, "body": "Just replace <code>for</code> with a label, a <code>goto</code> and an <code>if</code> like the compiler does anyway and call it a day."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1556538813, "post_id": 55902279, "comment_id": 98461214, "body": "@GeorgesBatikha <a href=\"https://golang.org/ref/spec#Labeled_statements\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Labeled_statements</a> and <a href=\"https://golang.org/ref/spec#Goto_statements\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Goto_statements</a>"}, {"owner": {"reputation": 19, "user_id": 8709909, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aQDoN.jpg?s=128&g=1", "display_name": "w0lf", "link": "https://stackoverflow.com/users/8709909/w0lf"}, "edited": false, "score": 0, "creation_date": 1556541476, "post_id": 55902279, "comment_id": 98462694, "body": "I will give it a go- no pun intended , and will post my solutions. Thank you"}], "answers": [{"comments": [{"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1579081645, "post_id": 55903381, "comment_id": 105644188, "body": "The question has apparently been edited. &quot;Getting the sum of squares in Golang&quot; is a bit terse to understand what the program is supposed to do. What is  the purpose of the instruction <code>fmt.Println(43)</code> in your goto code example ?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1579086182, "post_id": 55903381, "comment_id": 105646637, "body": "Probably an oversight. I removed it."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 2, "last_activity_date": 1579086144, "last_edit_date": 1579086144, "creation_date": 1556540819, "answer_id": 55903381, "question_id": 55902279, "link": "https://stackoverflow.com/questions/55902279/golang-assignment/55903381#55903381", "title": "Golang assignment", "body": "<p>Go does not have the <code>while</code>, <code>until</code>, or <code>foreach</code> loop constructs you may be familiar with from other languages. In Go, the <code>for</code> and <code>range</code> statements replace them all:</p>\n\n<pre><code>// Three expressions, i.e. the usual\nfor i := 0; i &lt; n; i++ {\n}\n\n// Single expression; same as while(condition) in other languages\nfor condition { \n}\n\n// No expressions; endless loop, i.e. same as while(true) or for(;;)\nfor {\n}\n\n// for with range; foreach and similar in other languages. Works with slices, maps, and channels.\nfor i, x := range []T{} {\n}\n</code></pre>\n\n<p>If you are not allowed to use Go's single loop construct, you are left with either recursion or <a href=\"https://golang.org/ref/spec#Goto_statements\" rel=\"nofollow noreferrer\">the <code>goto</code> statement</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    var N int\n    fmt.Scan(&amp;N)\n\n    fmt.Println(f(N, 0))\n}\n\nfunc f(n, sum int) int {\n    if n == 0 {\n        return sum\n    }\n\n    var Y int\n    fmt.Scan(&amp;Y)\n    if Y &gt; 0 {\n        sum += Y * Y\n    }\n\n    return f(n-1, sum)\n}\n</code></pre>\n\n<p>With <code>goto</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    var N, Y, sum int\n    fmt.Scan(&amp;N)\n\nagain:\n    fmt.Scan(&amp;Y)\n    if Y &gt; 0 {\n        sum += Y * Y\n    }\n\n    N--\n    if N &gt; 0 {\n        goto again\n    }\n\n    fmt.Println(sum)\n}\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 8709909, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aQDoN.jpg?s=128&g=1", "display_name": "w0lf", "link": "https://stackoverflow.com/users/8709909/w0lf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 588, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1579086144, "creation_date": 1556536861, "last_edit_date": 1579080183, "question_id": 55902279, "link": "https://stackoverflow.com/questions/55902279/golang-assignment", "title": "Golang assignment", "body": "<p>Getting the sum of squares in Golang</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1592, "user_id": 7251967, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-al-If026iHU/AAAAAAAAAAI/AAAAAAAAABE/9lsheyH-V9Q/photo.jpg?sz=128", "display_name": "negi Yogi", "link": "https://stackoverflow.com/users/7251967/negi-yogi"}, "is_accepted": true, "score": 1, "last_activity_date": 1566286164, "last_edit_date": 1566286164, "creation_date": 1556532396, "answer_id": 55901102, "question_id": 55900613, "link": "https://stackoverflow.com/questions/55900613/how-to-write-golang-bson-mongodb/55901102#55901102", "title": "how to write Golang bson- MongoDB", "body": "<p>Just make one find Query and other one for filter and use these findQ and filter in your mongo connection</p>\n\n<pre><code>    findQ := bson.M{\"nfType\": \"SMF\"}\n    filter := bson.M{\"_id\": 0, \"ipv4Addresses\": 1}\n    data:=[]interface{}// i am using interface. You can use your actual object\nmongo.DB(DBName).C(collectionName).Find(findQ).Select(filter).All(&amp;data)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 373, "user_id": 11129772, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-JvfXdLdVF_o/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcYeexZle2rFSZguSbkAdz0ntkChA/mo/photo.jpg?sz=128", "display_name": "gold three", "link": "https://stackoverflow.com/users/11129772/gold-three"}, "is_accepted": false, "score": 0, "last_activity_date": 1556533549, "creation_date": 1556533549, "answer_id": 55901429, "question_id": 55900613, "link": "https://stackoverflow.com/questions/55900613/how-to-write-golang-bson-mongodb/55901429#55901429", "title": "how to write Golang bson- MongoDB", "body": "<pre><code>session, err := mgo.Dial(mgo_url)\nif err != nil {\n    panic(err)\n}\nc := session.DB(db).C(collection)\ndefer session.Close()\n\nresult := make([]map[string]interface{}, 0)\nerr = c.Find(bson.M(map[string]interface{}{\"nfType\": \"SMF\"})).All(&amp;result)\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 11154131, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Df9Cd5m8YbU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf3t3aLeqiZQsvHjhZOsFrB-0dzvg/mo/photo.jpg?sz=128", "display_name": "Abraham", "link": "https://stackoverflow.com/users/11154131/abraham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 55901102, "answer_count": 2, "score": -1, "last_activity_date": 1566286164, "creation_date": 1556530685, "question_id": 55900613, "link": "https://stackoverflow.com/questions/55900613/how-to-write-golang-bson-mongodb", "title": "how to write Golang bson- MongoDB", "body": "<p>Am trying to write the golang bson query for this mongodb query but cannot. Can anyone help?\nI can query mongo shell with the command</p>\n\n<pre><code>db.collection.find({\"nfType\": \"SMF\"},{\"_id\": 0,\"ipv4Addresses\": 1})\n</code></pre>\n\n<p>which gives the output that i want as</p>\n\n<pre><code>[{ \"ipv4Addresses\": [\"198.51.100.1\"]}]\n</code></pre>\n\n<p>Now am trying to write a golang bson for this query to get only the ipv4Addresses field as shown above but cannot.\nThe document in the collection is of the form</p>\n\n<pre><code>{\n    \"nfType\": [\n      \"SMF\"\n    ],\n    \"nfStatus\": [\n      \"REG\"\n    ],\n    \"sNssais\": [\n      {\n        \"sst\": 1,\n        \"sd\": \"sd1\"\n      }\n    ],\n    \"nsiList\": [\n      \"NSI-ID1\"\n    ],\n    \"ipv4Addresses\": [\n      \"198.51.100.1\"\n    ]\n  }\n</code></pre>\n"}, {"tags": ["pointers", "go", "interface", "null", "compare"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1556533016, "post_id": 55900390, "comment_id": 98458433, "body": "<a href=\"https://golang.org/doc/faq#nil_error\" rel=\"nofollow noreferrer\">golang.org/doc/faq#nil_error</a>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 7, "last_activity_date": 1556532059, "last_edit_date": 1556532059, "creation_date": 1556530306, "answer_id": 55900511, "question_id": 55900390, "link": "https://stackoverflow.com/questions/55900390/how-to-detect-whether-a-struct-pointer-is-nil-in-golang/55900511#55900511", "title": "How to detect whether a struct pointer is nil in golang?", "body": "<p>Why isn't <code>n</code> <code>nil</code>? Type of <code>n</code> is an interface type (<code>localnet.Net</code>) which is a wrapper for a <code>(type; value)</code> pair. The interface value may be non-<code>nil</code> even if it wraps a <code>nil</code> value. See <a href=\"https://stackoverflow.com/questions/29138591/hiding-nil-values-understanding-why-golang-fails-here/29138676#29138676\">Hiding nil values, understanding why golang fails here</a></p>\n\n<p>To answer the question in title: you may use reflection to tell if a non-<code>nil</code> interface value wraps a <code>nil</code> value (e.g. <code>nil</code> pointer):</p>\n\n<pre><code>reflect.ValueOf(someValue).IsNil()\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>type reader struct{}\n\nfunc (*reader) Read(p []byte) (int, error) { return 0, nil }\n\nfunc main() {\n    var r io.Reader = (*reader)(nil)\n\n    fmt.Println(r, r == nil)\n    fmt.Println(reflect.ValueOf(r).IsNil())\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/ONtgvUbFYHb\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>&lt;nil&gt; false\ntrue\n</code></pre>\n"}], "owner": {"reputation": 646, "user_id": 1011932, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/60d5c176edc9aae48133f89107c4c3d5?s=128&d=identicon&r=PG", "display_name": "river", "link": "https://stackoverflow.com/users/1011932/river"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1771, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1556604297, "creation_date": 1556529886, "last_edit_date": 1556604297, "question_id": 55900390, "link": "https://stackoverflow.com/questions/55900390/how-to-detect-whether-a-struct-pointer-is-nil-in-golang", "title": "How to detect whether a struct pointer is nil in golang?", "body": "<p>As is shown by the following code: <code>n := localplugin.NewPluginNet()</code>, the type of <code>n</code> is <code>localnet.Net</code>, which is a interface implemented by the struct pointer <code>*localnet.DomainSocket</code>. Function <code>func NewPluginNet() localnet.Net</code> returns a nil pointer to <code>n</code>.</p>\n\n<pre><code>var n localnet.Net    \nn = localplugin.NewPluginNet()\nfmt.Println(\"----&gt; \", n)\nif n == nil {\n    fmt.Println(\"n is nil\")\n}else{\n    fmt.Println(\"n is not nil : \",  n)\n}\nfmt.Println(reflect.TypeOf(n), reflect.TypeOf(nil), n)\n</code></pre>\n\n<p>The following is the output of the code above.</p>\n\n<pre><code>----&gt;  &lt;nil&gt;\nn is not nil :  &lt;nil&gt;\n*localnet.DomainSocket &lt;nil&gt; &lt;nil&gt;\n</code></pre>\n\n<p>Why does n is not nil ?</p>\n\n<p>===================================</p>\n\n<pre><code>var n1 *localnet.DomainSocket\nn1 = nil\nfmt.Println(\"&gt;&gt; \", n1)\nif n1 == nil {\n    fmt.Println(\"&gt;&gt;n1 is nil\")\n}else{\n    fmt.Println(\"&gt;&gt;n1 is not nil : \",  n)\n}\nfmt.Println(reflect.TypeOf(n1), reflect.TypeOf(nil), n1)\n</code></pre>\n\n<p>However, it's correct for this case:</p>\n\n<pre><code>&gt;&gt;  &lt;nil&gt;\n&gt;&gt;n1 is nil\n*localnet.DomainSocket &lt;nil&gt; &lt;nil&gt;\n</code></pre>\n"}, {"tags": ["go", "compilation"], "comments": [{"owner": {"reputation": 7, "user_id": 10433593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hZZIjerZZJo/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DU_1cGArmTDC-Xp7ClLAFC8Opfg9g/mo/photo.jpg?sz=128", "display_name": "yq w", "link": "https://stackoverflow.com/users/10433593/yq-w"}, "edited": false, "score": 0, "creation_date": 1556534340, "post_id": 55900349, "comment_id": 98459081, "body": "I am thinking about we can write makefile to do this, look&#39;s like need code generateor or something else"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556555169, "post_id": 55900349, "comment_id": 98470118, "body": "I would strongly recommend just writing a unit test to validate the expressions and their usage, and executing tests as part of your build process."}, {"owner": {"reputation": 7, "user_id": 10433593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hZZIjerZZJo/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DU_1cGArmTDC-Xp7ClLAFC8Opfg9g/mo/photo.jpg?sz=128", "display_name": "yq w", "link": "https://stackoverflow.com/users/10433593/yq-w"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556620400, "post_id": 55900349, "comment_id": 98492002, "body": "@Adrian yes, it make sense"}], "answers": [{"comments": [{"owner": {"reputation": 7, "user_id": 10433593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hZZIjerZZJo/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DU_1cGArmTDC-Xp7ClLAFC8Opfg9g/mo/photo.jpg?sz=128", "display_name": "yq w", "link": "https://stackoverflow.com/users/10433593/yq-w"}, "edited": false, "score": 0, "creation_date": 1556530506, "post_id": 55900397, "comment_id": 98457167, "body": "But if I do not implement some interface, it will report an error when compiling. Is this the same"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 7, "user_id": 10433593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hZZIjerZZJo/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DU_1cGArmTDC-Xp7ClLAFC8Opfg9g/mo/photo.jpg?sz=128", "display_name": "yq w", "link": "https://stackoverflow.com/users/10433593/yq-w"}, "edited": false, "score": 0, "creation_date": 1556530824, "post_id": 55900397, "comment_id": 98457324, "body": "No, it&#39;s not the same. The compiler can check if a type implements an interface, but the compiler won&#39;t check the content of your (valid) <code>string</code> literals."}, {"owner": {"reputation": 7, "user_id": 10433593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hZZIjerZZJo/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DU_1cGArmTDC-Xp7ClLAFC8Opfg9g/mo/photo.jpg?sz=128", "display_name": "yq w", "link": "https://stackoverflow.com/users/10433593/yq-w"}, "edited": false, "score": 0, "creation_date": 1556531090, "post_id": 55900397, "comment_id": 98457491, "body": "Can I modify the compiler or add plug-ins to do this? If it&#39;s possiable"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 7, "user_id": 10433593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hZZIjerZZJo/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DU_1cGArmTDC-Xp7ClLAFC8Opfg9g/mo/photo.jpg?sz=128", "display_name": "yq w", "link": "https://stackoverflow.com/users/10433593/yq-w"}, "edited": false, "score": 0, "creation_date": 1556532012, "post_id": 55900397, "comment_id": 98457962, "body": "@yqw Go is open source, you may modify its sources to detect such things at compile time. Is it worth it? No, in my opinion."}, {"owner": {"reputation": 7, "user_id": 10433593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hZZIjerZZJo/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DU_1cGArmTDC-Xp7ClLAFC8Opfg9g/mo/photo.jpg?sz=128", "display_name": "yq w", "link": "https://stackoverflow.com/users/10433593/yq-w"}, "edited": false, "score": 0, "creation_date": 1556533582, "post_id": 55900397, "comment_id": 98458707, "body": "Thanks for your help,  i will consider about it."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1556532147, "last_edit_date": 1556532147, "creation_date": 1556529912, "answer_id": 55900397, "question_id": 55900349, "link": "https://stackoverflow.com/questions/55900349/how-can-i-get-error-at-compile-not-runtime-eg-regexp-mustcompile/55900397#55900397", "title": "How can i get error at compile, not runtime. eg: regexp.MustCompile", "body": "<p><code>regexp.MustCompile()</code> is a function that can only run at runtime, so you can't make a compile-time error using it. The most you can do is call it from a package <code>init()</code> function (or use it in a global variable initialization), so the error will be detected early, at the start of your program.</p>\n\n<p>Generally, you can't validate strings (semantically) at compile time (whether they fulfill your custom, arbitrary rules).</p>\n\n<p>Best practice is to write unit tests for these things, unit tests which should always run as part of your CI process, so these things surface before your code goes to production.</p>\n"}], "owner": {"reputation": 7, "user_id": 10433593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hZZIjerZZJo/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DU_1cGArmTDC-Xp7ClLAFC8Opfg9g/mo/photo.jpg?sz=128", "display_name": "yq w", "link": "https://stackoverflow.com/users/10433593/yq-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1556532147, "creation_date": 1556529737, "question_id": 55900349, "link": "https://stackoverflow.com/questions/55900349/how-can-i-get-error-at-compile-not-runtime-eg-regexp-mustcompile", "title": "How can i get error at compile, not runtime. eg: regexp.MustCompile", "body": "<ul>\n<li><p>I am writing golang program and use function regexp.MustComplile. but it may be panic at some time you don't know</p></li>\n<li><p>just like <code>regexp.MustCompile(\"Expressions John.Smith will cause panic but you don't known\").</code></p></li>\n<li><p>I want got error during compilation , not at the runtime. </p></li>\n<li><p>Is there any way to make that report an error during compilation?</p></li>\n<li><p>thanks for your help</p></li>\n</ul>\n"}, {"tags": ["postgresql", "go", "sqlx"], "answers": [{"tags": [], "owner": {"reputation": 86, "user_id": 5715068, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-o9dzJNgSvKE/AAAAAAAAAAI/AAAAAAAAAQ0/14GkM4SsL8M/photo.jpg?sz=128", "display_name": "Bogdan Daragan", "link": "https://stackoverflow.com/users/5715068/bogdan-daragan"}, "is_accepted": false, "score": 1, "last_activity_date": 1556534465, "creation_date": 1556534465, "answer_id": 55901683, "question_id": 55899890, "link": "https://stackoverflow.com/questions/55899890/convert-a-postgres-row-into-golang-struct-with-array-field/55901683#55901683", "title": "Convert a postgres row into golang struct with array field", "body": "<p>You can use <code>pg-go</code> lib for that. Please look at <a href=\"https://godoc.org/github.com/go-pg/pg#Model\" rel=\"nofollow noreferrer\">pg.Model()</a>. It's possible to pass an entire struct to it.</p>\n"}, {"tags": [], "owner": {"reputation": 563, "user_id": 10138004, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TMCqlmHNIqA/AAAAAAAAAAI/AAAAAAAAALQ/GvxaLDlx5yQ/photo.jpg?sz=128", "display_name": "ShailyAggarwal", "link": "https://stackoverflow.com/users/10138004/shailyaggarwal"}, "is_accepted": true, "score": 2, "last_activity_date": 1557300942, "creation_date": 1557300942, "answer_id": 56035723, "question_id": 55899890, "link": "https://stackoverflow.com/questions/55899890/convert-a-postgres-row-into-golang-struct-with-array-field/56035723#56035723", "title": "Convert a postgres row into golang struct with array field", "body": "<p>Thanks to <a href=\"https://stackoverflow.com/a/44385791/10138004\">https://stackoverflow.com/a/44385791/10138004</a>, I am able to solve this pq driver for sqlx (<a href=\"https://godoc.org/github.com/lib/pq\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/lib/pq</a>) itself by replacing <code>[]string</code> with <code>pq.StringArray</code>.</p>\n\n<p>So, updated struct looks like:</p>\n\n<pre><code>type Foo struct {\nName string `db:\"name\"`\nTypes pq.StringArray `db:\"types\"` //this is what changed.\nRole string `db:\"role\"`\n}\n</code></pre>\n\n<p>and direct mapping is working like a charm now</p>\n\n<pre><code>var foo []Foo\nquery := `SELECT name, types, roles FROM foo`\ndbWrapper.err = dbConn.Select(&amp;foo, query)\n</code></pre>\n"}], "owner": {"reputation": 563, "user_id": 10138004, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TMCqlmHNIqA/AAAAAAAAAAI/AAAAAAAAALQ/GvxaLDlx5yQ/photo.jpg?sz=128", "display_name": "ShailyAggarwal", "link": "https://stackoverflow.com/users/10138004/shailyaggarwal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1354, "favorite_count": 0, "accepted_answer_id": 56035723, "answer_count": 2, "score": 1, "last_activity_date": 1557300942, "creation_date": 1556527940, "last_edit_date": 1556528833, "question_id": 55899890, "link": "https://stackoverflow.com/questions/55899890/convert-a-postgres-row-into-golang-struct-with-array-field", "title": "Convert a postgres row into golang struct with array field", "body": "<p>I am having postgres db table as </p>\n\n<pre><code>CREATE TABLE foo (\nname varchar(50),\ntypes varchar(50)[],\nrole varchar[10]\n);\n</code></pre>\n\n<p>and corresponding struct in go:</p>\n\n<pre><code>type Foo struct {\nName string `db:\"name\"`\nTypes []string `db:\"types\"`\nRole string `db:\"role\"`\n}\n</code></pre>\n\n<p>I want to fetch db rows into my struct. Right now I am able to do this by using:</p>\n\n<pre><code>var foo Foo\nquery := `SELECT name, types, roles FROM foo LIMIT 1`\nerr = dbConn.QueryRow(query).Scan(&amp;foo.Name,  pq.Array(&amp;foo.Types), &amp;foo.Role)\n</code></pre>\n\n<p>But I want to achieve the same using direct mapping. Something like:</p>\n\n<pre><code>var foo []Foo\nquery := `SELECT name, types, roles FROM foo`\ndbWrapper.err = dbConn.Select(&amp;foo, query)\n</code></pre>\n\n<p>Above snippet gives me error because of <code>Types</code> being pq array. Is it possible to directly map pq array as a part of struct?</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1556528614, "post_id": 55899112, "comment_id": 98456198, "body": "Why are you joining the parameters ? Is it not one string ?  It would be good if you can specify your input and expected out put"}, {"owner": {"reputation": 11, "user_id": 6852930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aca577c379da7bbcf9c17c63fc457942?s=128&d=identicon&r=PG&f=1", "display_name": "Ninja", "link": "https://stackoverflow.com/users/6852930/ninja"}, "reply_to_user": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1556529244, "post_id": 55899112, "comment_id": 98456514, "body": "So the input I get is a list of strings. So the input for the string <code>&quot;random token&quot; 45</code> is going to be a list of strings like [&quot;\\&quot;random, &quot;token\\&quot;&quot;, &quot;45&quot;]."}, {"owner": {"reputation": 11, "user_id": 6852930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aca577c379da7bbcf9c17c63fc457942?s=128&d=identicon&r=PG&f=1", "display_name": "Ninja", "link": "https://stackoverflow.com/users/6852930/ninja"}, "reply_to_user": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1556529262, "post_id": 55899112, "comment_id": 98456521, "body": "Updated description with expected input and output."}], "answers": [{"tags": [], "owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "is_accepted": true, "score": 0, "last_activity_date": 1556529811, "creation_date": 1556529811, "answer_id": 55900366, "question_id": 55899112, "link": "https://stackoverflow.com/questions/55899112/how-to-separate-double-quoted-strings-and-non-double-quoted-strings-using-regex/55900366#55900366", "title": "How to separate double quoted strings and non double quoted strings using regex?", "body": "<p>You can use the <code>regex.FindAllStringSubmatch</code>. </p>\n\n<p>Following function would do the job, the function assumes the input to be a single string like <code>\"random token\" 32</code></p>\n\n<pre><code>func parse(str string) (string, string) {\n    regex, _ := regexp.Compile(`(\"[^\"]*\")\\s*(\\S*)`)\n    submatches := regex.FindAllStringSubmatch(str, -1)\n    if len(submatches) == 0 {\n        return \"\",\"\"\n    }\n    return submatches[0][1], submatches[0][2]\n\n}\n</code></pre>\n\n<p>You can find working link to a sample program <a href=\"https://play.golang.com/p/TGtYX2Lu63R\" rel=\"nofollow noreferrer\">here</a></p>\n"}], "owner": {"reputation": 11, "user_id": 6852930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aca577c379da7bbcf9c17c63fc457942?s=128&d=identicon&r=PG&f=1", "display_name": "Ninja", "link": "https://stackoverflow.com/users/6852930/ninja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 55900366, "answer_count": 1, "score": 0, "last_activity_date": 1556529878, "creation_date": 1556524542, "last_edit_date": 1556529878, "question_id": 55899112, "link": "https://stackoverflow.com/questions/55899112/how-to-separate-double-quoted-strings-and-non-double-quoted-strings-using-regex", "title": "How to separate double quoted strings and non double quoted strings using regex?", "body": "<p>I'm trying to build a plugin which accepts parameters and each of the parameters can be a double quoted string or a non double quoted string.</p>\n\n<p>Some examples of valid parameters : </p>\n\n<ol>\n<li><code>\"random token\"</code></li>\n<li><code>\"random token\" 34</code></li>\n<li><code>\"randomtoken\"</code></li>\n</ol>\n\n<p>So I'm trying to write a <code>parseParameters</code> function which would return two values, one is the content inside double quoted string and the other is the non double quoted string.</p>\n\n<p>I tried solving this problem with two regular expressions </p>\n\n<ol>\n<li><code>\\\"(.*?)\\\"\\s*\\d*</code> - <a href=\"https://regex101.com/r/uB4sI9/145\" rel=\"nofollow noreferrer\">https://regex101.com/r/uB4sI9/145</a></li>\n<li><code>\\\"(.*?)\\\"</code> - <a href=\"https://regex101.com/r/Pnh9Xd/1\" rel=\"nofollow noreferrer\">https://regex101.com/r/Pnh9Xd/1</a></li>\n</ol>\n\n<p>Below is one version of the code I tried (which didn't work for some cases though) : </p>\n\n<p>Variable <code>parameters</code> in the below code is going to be a list. Something like [\"\\\"random, \"token\\\"\", \"45\"]</p>\n\n<pre><code>    paramString := strings.Join(parameters, \" \")\n    regex, _ := regexp.Compile(`\\\"(.*?)\\\"\\s*\\d*`)\n    tempString := regex.FindString(paramString)\n    if len(parameters) == 1 &amp;&amp; tempString != \"\" {\n        tempString = strings.TrimLeft(strings.TrimRight(tempString, `\\\"`), `\\\"`)\n        return tempString, \"\", true\n    }\n    if paramString != tempString {\n        return \"\", \"\", false\n    }\n    splitBySpace := strings.Split(tempString, \" \")\n    doubleQuoted := strings.TrimLeft(strings.TrimRight(tempString, `\\\"`), `\\\"`)\n    nonDoubleQuoted := splitBySpace[len(splitBySpace)-1]\n    return doubleQuoted, nonDoubleQuoted, true\n</code></pre>\n\n<p><strong>Expected input and output</strong>:</p>\n\n<p><strong>Input</strong> : [\"\\\"random\", \"token\\\"\"]</p>\n\n<p><strong>Output</strong> : <code>\"random token\", \"\"</code> (first value specifies the double quoted string while the other value specifies the non double quoted string)</p>\n\n<p><strong>Input</strong> : [\"\\\"random\", \"token\\\"\", \"45\"]</p>\n\n<p><strong>Output</strong> : [\"\\\"random token\\\"\", 45]</p>\n\n<p>Note that double quotes are escaped in the input.</p>\n"}, {"tags": ["regex", "string", "go"], "comments": [{"owner": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "edited": false, "score": 1, "creation_date": 1556524223, "post_id": 55898997, "comment_id": 98454165, "body": "Did you try it without the spaces? <code>^(\\-?\\d[.]\\d)(\\d)$</code> See <a href=\"https://regex101.com/r/8rLiLk/2\" rel=\"nofollow noreferrer\">regex101.com/r/8rLiLk/2</a>"}, {"owner": {"reputation": 471, "user_id": 589969, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/743586d634a537e7466e2dd5b16e18a3?s=128&d=identicon&r=PG&f=1", "display_name": "Odinovsky", "link": "https://stackoverflow.com/users/589969/odinovsky"}, "reply_to_user": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "edited": false, "score": 1, "creation_date": 1556524509, "post_id": 55898997, "comment_id": 98454295, "body": "thanks mate..tried it with regexp.MustCompile(<code>^(\\-?\\d[.]\\d)(\\d)$</code>) and it works.."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1556524605, "post_id": 55898997, "comment_id": 98454330, "body": "<code>x</code> is not a supported flag in RE2: <a href=\"https://github.com/google/re2/wiki/Syntax#Flags\" rel=\"nofollow noreferrer\">github.com/google/re2/wiki/Syntax#Flags</a>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1556524541, "creation_date": 1556524541, "answer_id": 55899111, "question_id": 55898997, "link": "https://stackoverflow.com/questions/55898997/splitting-float-string-in-go-regex/55899111#55899111", "title": "Splitting float string in Go regex", "body": "<p>Why do you need regexp for this? Simply slice the string:</p>\n\n<pre><code>func split(s string) []string {\n    if len(s) == 0 {\n        return nil\n    }\n    return []string{s[:len(s)-1], s[len(s)-1:]}\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>nums := []string{\n    fmt.Sprintf(\"%.2f\", 1.25),\n    fmt.Sprintf(\"%.2f\", 1.99),\n    fmt.Sprintf(\"%.2f\", 1.25),\n    fmt.Sprintf(\"%.2f\", 1.2),\n    fmt.Sprintf(\"%.2f\", 0.0),\n    fmt.Sprintf(\"%.2f\", -1.2),\n    \"\",\n}\nfor _, n := range nums {\n    fmt.Printf(\"%q = %q\\n\", n, split(n))\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/IrnnIAe9x-b\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>\"1.25\" = [\"1.2\" \"5\"]\n\"1.99\" = [\"1.9\" \"9\"]\n\"1.25\" = [\"1.2\" \"5\"]\n\"1.20\" = [\"1.2\" \"0\"]\n\"0.00\" = [\"0.0\" \"0\"]\n\"-1.20\" = [\"-1.2\" \"0\"]\n\"\" = []\n</code></pre>\n"}], "owner": {"reputation": 471, "user_id": 589969, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/743586d634a537e7466e2dd5b16e18a3?s=128&d=identicon&r=PG&f=1", "display_name": "Odinovsky", "link": "https://stackoverflow.com/users/589969/odinovsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 55899111, "answer_count": 1, "score": 0, "last_activity_date": 1556524795, "creation_date": 1556524079, "last_edit_date": 1556524795, "question_id": 55898997, "link": "https://stackoverflow.com/questions/55898997/splitting-float-string-in-go-regex", "title": "Splitting float string in Go regex", "body": "<p>I'm, trying to split a certain string type to its constituents using Golang's regex.</p>\n\n<p>What I have is a <code>Sprinf(\".2f\", n)</code> of any given float (to simplify it to 2 decimal places), and would wish to separate the hundredths digit like:</p>\n\n<pre><code>\"1.25\" = [\"1.2\", \"5\"]\n\"1.99\" = [\"1.9\", \"9\"]\n</code></pre>\n\n<p>In PHP, this is something like:</p>\n\n<pre><code>preg_match('/^ (\\-? \\d [.] \\d) (\\d) $/x', sprintf('%1.2f', $input), $matches)\n</code></pre>\n\n<p>and I can get the parts via $matches[0] and $matches[1].</p>\n\n<p>Tried it with :</p>\n\n<pre><code>re := regexp.MustCompile(`/^ (\\-? \\d [.] \\d) (\\d) $/x`)\nfmt.Printf(\"%q\\n\", re.FindAllStringSubmatch(\"1.50\", 2))\n</code></pre>\n\n<p>to no avail. Thanks in advance.</p>\n"}, {"tags": ["go", "package"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1556522697, "post_id": 55898667, "comment_id": 98453465, "body": "For a package to be able to import an internal package the internal one must live in a subfolder of the importing one, if i&#39;m not mistaken."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1556523401, "post_id": 55898667, "comment_id": 98453807, "body": "The whole raison d&#39;&#234;tre of an <i>internal</i> package is that it <i>cannot</i> be imported from some arbitrary package but one from a package &quot;higher up&quot; in the file system layout."}, {"owner": {"reputation": 954, "user_id": 4010665, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d33cc77cdbcaf537cd6ff35195d439ef?s=128&d=identicon&r=PG&f=1", "display_name": "Roel Harbers", "link": "https://stackoverflow.com/users/4010665/roel-harbers"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1556523683, "post_id": 55898667, "comment_id": 98453937, "body": "@volker, I&#39;m not trying to import it from some arbitrary package, I&#39;m importing it from my main package. The idea being that <code>cmd&#47;myapp&#47;main.go</code> only has a tiny bit of boilerplate, and  all application logic is in <code>internal&#47;app</code>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1556524114, "post_id": 55898667, "comment_id": 98454107, "body": "For Go the package cmd/myapp <i>is</i> some arbitrary package and cannot import app/myapp because cmd/myapp is not a parent directory of app/myapp. The fact that you think that cmd/myapp is tightly related to app/myapp is o no concern to the go tooling. Stop fighting the tooling. You simply <i>cannot</i> import internal packages from somehwere else."}, {"owner": {"reputation": 954, "user_id": 4010665, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d33cc77cdbcaf537cd6ff35195d439ef?s=128&d=identicon&r=PG&f=1", "display_name": "Roel Harbers", "link": "https://stackoverflow.com/users/4010665/roel-harbers"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1556524231, "post_id": 55898667, "comment_id": 98454169, "body": "@Volker are you suggesting that the (unoffical) Standard Go Project Layout is doing it wrong? What would your layout be? putting <code>internal</code> under <code>cmd&#47;myapp</code>?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1556525692, "post_id": 55898667, "comment_id": 98454830, "body": "The &quot;Standard Go Project Layout&quot; is just one possible way and far from &quot;standard&quot; but I doubt it is wrong. The problem seems to stem from a misconception on how packages work (read &quot;How to Write Go Code&quot; as a real standard reference): It seems your package import path are <i>not</i> the claimed &quot;cmd/myapp&quot; and &quot;internal/app&quot;. A package import path is the full path ether below GOPATH/src or as declared in the go.mod. Just read How to Write Go Code and stick to that. No need to get fancy and no need to adopt some folder structure claimed &quot;standard&quot; by 1 person."}, {"owner": {"reputation": 954, "user_id": 4010665, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d33cc77cdbcaf537cd6ff35195d439ef?s=128&d=identicon&r=PG&f=1", "display_name": "Roel Harbers", "link": "https://stackoverflow.com/users/4010665/roel-harbers"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1556530401, "post_id": 55898667, "comment_id": 98457117, "body": "@Volker I haven&#39;t claimed anything about my package import path, nor am I fighting the tooling. I am merely a relative new go user, who is trying to figure out how to layout my projects, without reinventing the wheel. The first few google hits for &quot;go project layout&quot; all suggest the <code>cmd</code>/<code>internal</code> separation, which makes sense to me because I&#39;d like to keep my <code>main</code> package small and simple.  Having tried and failed to get that to work, I put the question here. I have no stake in whatever layout.  &quot;How to Write Go Code&quot; says nothing about <code>go.mod</code>, I&#39;ll have to look into that."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1556555386, "post_id": 55899001, "comment_id": 98470217, "body": "That is always true of Go projects. The project path is relevant to dependency resolution."}, {"owner": {"reputation": 880, "user_id": 6632214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f7a11555b6759a1bd6c0205720f6dda?s=128&d=identicon&r=PG", "display_name": "TheDiveO", "link": "https://stackoverflow.com/users/6632214/thediveo"}, "edited": false, "score": 1, "creation_date": 1599328683, "post_id": 55899001, "comment_id": 112743818, "body": "Why not making it a module, then the project&#39;s top directory doesn&#39;t matter anymore, if I&#39;m not mistaken: the module name is set in the associated go.modvfile."}], "tags": [], "owner": {"reputation": 954, "user_id": 4010665, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d33cc77cdbcaf537cd6ff35195d439ef?s=128&d=identicon&r=PG&f=1", "display_name": "Roel Harbers", "link": "https://stackoverflow.com/users/4010665/roel-harbers"}, "is_accepted": false, "score": -1, "last_activity_date": 1556524101, "creation_date": 1556524101, "answer_id": 55899001, "question_id": 55898667, "link": "https://stackoverflow.com/questions/55898667/how-should-i-import-my-own-internal-packages-in-go/55899001#55899001", "title": "How should I import my own internal packages in go?", "body": "<p>I think I found the proper solution: <a href=\"https://github.com/ComaVN/project-layout/commit/6415a8f06dd7fbdcf1c7282bc3ec172c3e145611\" rel=\"nofollow noreferrer\">https://github.com/ComaVN/project-layout/commit/6415a8f06dd7fbdcf1c7282bc3ec172c3e145611</a></p>\n\n<p>You have to import using the project name as well:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    \"project-layout/internal/app/myapp\"\n    \"project-layout/internal/pkg/myprivatelib\"\n)\n</code></pre>\n\n<p>Unfortunatly, this does mean that the build depends on the exact directory name used for the project.</p>\n"}], "owner": {"reputation": 954, "user_id": 4010665, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d33cc77cdbcaf537cd6ff35195d439ef?s=128&d=identicon&r=PG&f=1", "display_name": "Roel Harbers", "link": "https://stackoverflow.com/users/4010665/roel-harbers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2158, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1556524101, "creation_date": 1556522486, "question_id": 55898667, "link": "https://stackoverflow.com/questions/55898667/how-should-i-import-my-own-internal-packages-in-go", "title": "How should I import my own internal packages in go?", "body": "<p>I'm trying to make a Go app using the (unoffical) <a href=\"https://github.com/golang-standards/project-layout\" rel=\"nofollow noreferrer\">Standard Go Project Layout</a>. What I don't understand is how I should import the packages in the <code>internal</code> directory.</p>\n\n<p><a href=\"https://github.com/ComaVN/project-layout/tree/bcfb6365be08ecffd29b0cce5eb43e1cc6651ec1\" rel=\"nofollow noreferrer\">This is my project</a></p>\n\n<p>Using the Dockerfile, which copies the <code>internal</code> directory to the $GOPATH, it works:</p>\n\n<pre><code>~/go/src/project-layout$ docker build --no-cache .\n(...)\nStep 5/7 : RUN ls -la /go/src\n ---&gt; Running in a27235b0bbef\ntotal 24\ndrwxrwxrwx    1 root     root          4096 Apr 29 07:05 .\ndrwxrwxrwx    1 root     root          4096 Apr 12 22:23 ..\n-rw-rw-r--    1 root     root           556 Apr 29 06:06 README.md\ndrwxrwxr-x    3 root     root          4096 Apr 29 06:08 app\ndrwxr-xr-x    1 root     root          4096 Apr 29 07:05 myproject\ndrwxrwxr-x    3 root     root          4096 Apr 29 06:11 pkg\nRemoving intermediate container a27235b0bbef\n ---&gt; bb924f8f88f0\nStep 6/7 : RUN go build -o myapp ./cmd/myapp/main.go\n ---&gt; Running in 06bd6cd778d2\nRemoving intermediate container 06bd6cd778d2\n ---&gt; 31184f9224c8\nStep 7/7 : RUN ./myapp\n ---&gt; Running in baf75d4dd503\nHello World, from myapp main\nHello world, from myapp internals\nHello world, from myprivatelib: 'myapp internal'\nHello world, from myprivatelib: 'myapp main'\nRemoving intermediate container baf75d4dd503\n ---&gt; 5747b6b4686f\nSuccessfully built 5747b6b4686f\n</code></pre>\n\n<p>However, when I try to build locally, I get:</p>\n\n<pre><code>~/go/src/project-layout$ go build -o myapp ./cmd/myapp/main.go\ncmd/myapp/main.go:6:2: cannot find package \"app/myapp\" in any of:\n    /home/comavn/go/src/project-layout/vendor/app/myapp (vendor tree)\n    /usr/lib/go-1.10/src/app/myapp (from $GOROOT)\n    /home/comavn/go/src/app/myapp (from $GOPATH)\ncmd/myapp/main.go:7:2: cannot find package \"pkg/myprivatelib\" in any of:\n    /home/comavn/go/src/project-layout/vendor/pkg/myprivatelib (vendor tree)\n    /usr/lib/go-1.10/src/pkg/myprivatelib (from $GOROOT)\n    /home/comavn/go/src/pkg/myprivatelib (from $GOPATH)\n</code></pre>\n\n<p>I can get it to work by symlinking <code>internal/app</code> and <code>internal/pkg</code> in the vendor directory, but that seems wrong...</p>\n\n<p>So, what am I doing wrong here? How should I import these internal packages?</p>\n"}, {"tags": ["go", "encryption", "tcp", "client-server", "rsa"], "comments": [{"owner": {"reputation": 8340, "user_id": 1645712, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/48781792c1fb7d61086b4fb612938c13?s=128&d=identicon&r=PG", "display_name": "gusto2", "link": "https://stackoverflow.com/users/1645712/gusto2"}, "edited": false, "score": 0, "creation_date": 1556523648, "post_id": 55898217, "comment_id": 98453921, "body": "To transmit any data securely by default SSL is used, creating a secure channel, which is transparent for the client and server.  <code>it should be same on both the side</code> try to print out encoded messages (not the raw byte arrays), if there are not the same, I&#39;d just guess it has nothing to do with encryption, but rather with a way you send/read the data, which is not visible in the code"}, {"owner": {"reputation": 5, "user_id": 9812935, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Q1jTRzBTVBg/AAAAAAAAAAI/AAAAAAAADcM/vDpqMdyR7aI/photo.jpg?sz=128", "display_name": "abhishek singla", "link": "https://stackoverflow.com/users/9812935/abhishek-singla"}, "reply_to_user": {"reputation": 8340, "user_id": 1645712, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/48781792c1fb7d61086b4fb612938c13?s=128&d=identicon&r=PG", "display_name": "gusto2", "link": "https://stackoverflow.com/users/1645712/gusto2"}, "edited": false, "score": 0, "creation_date": 1556524881, "post_id": 55898217, "comment_id": 98454481, "body": "Actually I found the bug. The rsa.EncryptOAEP() returns a []uint8 type variable and I was using []byte and it was not getting typecaste properly."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556553050, "post_id": 55898217, "comment_id": 98469105, "body": "@abhisheksingla: there is no typecasting in Go, and <code>[]uint8</code> and <code>[]byte</code> are identical (<code>byte</code> is and internal alias for <code>uint8</code>). Also, the <code>%s</code> in the <code>Printf</code> statements would attempt to convert both to a <code>string</code> anyway, so there&#39;s no reason they shouldn&#39;t print the exact same thing."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556555614, "post_id": 55898217, "comment_id": 98470309, "body": "&quot;is there some standard protocol or something to deal with encrypted texts?&quot; yes, many many many of them, from HTTPS to SSH, with varying capabilities and target use cases."}], "owner": {"reputation": 5, "user_id": 9812935, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Q1jTRzBTVBg/AAAAAAAAAAI/AAAAAAAADcM/vDpqMdyR7aI/photo.jpg?sz=128", "display_name": "abhishek singla", "link": "https://stackoverflow.com/users/9812935/abhishek-singla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1556523571, "creation_date": 1556520340, "last_edit_date": 1556523571, "question_id": 55898217, "link": "https://stackoverflow.com/questions/55898217/is-there-any-standard-protocol-to-transfer-rsa-encrypted-text-over-a-network", "title": "Is there any standard protocol to transfer RSA encrypted text over a network?", "body": "<p>I have a client and a server side code. I have to take a message as input from the client, encrypt it and send it to the server. But when I print this encrypted message on the server side, it is not the same as it was on the client side. Here's how I am doing this:</p>\n\n<p>First I am encrypting the message using <code>rsa.EncryptOAEP()</code> function. The message is a member of a struct which has other members too. I am encoding this struct with the gob package and sending it to the server.</p>\n\n<p>Here's the snippet of client side code:   </p>\n\n<pre><code>func SocketClient() {\n    conn, err := net.Dial(\"tcp\", \":9000\")\n    if err != nil {\n        log.Fatalln(err)\n    }\n    defer conn.Close()\n    enc := gob.NewEncoder(conn)\n    buff, _ := input_reader.ReadBytes('\\n')    //this is the message to be encrypted\n    label := []byte(\"\")\n    hash := sha256.New()\n    ciphertext, _ := rsa.EncryptOAEP(\n        hash,\n        rand.Reader,\n        &amp;receiverPublicKey,\n        buff,\n        label,\n    )\n    fmt.Printf(\"%s\",ciphertext) //this is to check if the text is same or not\n    block.Message = ciphertext //this is the struct to be sent over network\n    enc.Encode(block)\n}\n</code></pre>\n\n<p>Here's the server side code:</p>\n\n<pre><code>func handleConn(conn net.Conn) {\n    defer conn.Close()\n    dec := gob.NewDecoder(conn)\n    dec.Decode(&amp;block)\n    fmt.Printf(\"%s\",block.Message) //it is different from the text printed in client side code\n}\n</code></pre>\n\n<p>When I am printing the message, it should be the same on both the side. So is there some standard protocol or something to deal with encrypted texts?</p>\n"}, {"tags": ["javascript", "json", "go"], "comments": [{"owner": {"reputation": 2755, "user_id": 9381809, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/m3Iac.jpg?s=128&g=1", "display_name": "AZ_", "link": "https://stackoverflow.com/users/9381809/az"}, "edited": false, "score": 0, "creation_date": 1556517076, "post_id": 55897638, "comment_id": 98451369, "body": "possible dup <a href=\"https://stackoverflow.com/questions/29347092/how-to-parse-deserlize-a-dynamic-json-in-golang\" title=\"how to parse deserlize a dynamic json in golang\">stackoverflow.com/questions/29347092/&hellip;</a>"}, {"owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "edited": false, "score": 1, "creation_date": 1556517217, "post_id": 55897638, "comment_id": 98451418, "body": "the <code>ids</code> in json is an array of json objects, so can&#39;t decode it by map"}, {"owner": {"reputation": 662, "user_id": 7514490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc5891123238579de45eb2c25bcbfaf8?s=128&d=identicon&r=PG&f=1", "display_name": "Sahil", "link": "https://stackoverflow.com/users/7514490/sahil"}, "edited": false, "score": 0, "creation_date": 1556517414, "post_id": 55897638, "comment_id": 98451475, "body": "it means i need to use structure only?"}, {"owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "edited": false, "score": 0, "creation_date": 1556517693, "post_id": 55897638, "comment_id": 98451565, "body": "@Sahil use struct is the most simple way, otherwise, you can try to achieve <code>json.Unmarshaler</code> interface.   <a href=\"https://godoc.org/encoding/json#Unmarshaler\" rel=\"nofollow noreferrer\">godoc.org/encoding/json#Unmarshaler</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1556517734, "post_id": 55897638, "comment_id": 98451583, "body": "A list of objects is representable by a slice of maps, not a map of slices."}], "answers": [{"comments": [{"owner": {"reputation": 662, "user_id": 7514490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc5891123238579de45eb2c25bcbfaf8?s=128&d=identicon&r=PG&f=1", "display_name": "Sahil", "link": "https://stackoverflow.com/users/7514490/sahil"}, "edited": false, "score": 0, "creation_date": 1556691941, "post_id": 55901482, "comment_id": 98517681, "body": "I don&#39;t wanted to use the structure. You posted the same thing by just extracting the structure from main structure."}, {"owner": {"reputation": 1592, "user_id": 7251967, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-al-If026iHU/AAAAAAAAAAI/AAAAAAAAABE/9lsheyH-V9Q/photo.jpg?sz=128", "display_name": "negi Yogi", "link": "https://stackoverflow.com/users/7251967/negi-yogi"}, "reply_to_user": {"reputation": 662, "user_id": 7514490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc5891123238579de45eb2c25bcbfaf8?s=128&d=identicon&r=PG&f=1", "display_name": "Sahil", "link": "https://stackoverflow.com/users/7514490/sahil"}, "edited": false, "score": 0, "creation_date": 1556740485, "post_id": 55901482, "comment_id": 98537083, "body": "yeah i understood the question in wrong way. I have updated the struct, now try this it will work .You just can&#39;t use map[string][]string because your data object is array of object.Either use map[string][]DubnsID or map[string][]interface."}], "tags": [], "owner": {"reputation": 1592, "user_id": 7251967, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-al-If026iHU/AAAAAAAAAAI/AAAAAAAAABE/9lsheyH-V9Q/photo.jpg?sz=128", "display_name": "negi Yogi", "link": "https://stackoverflow.com/users/7251967/negi-yogi"}, "is_accepted": false, "score": 1, "last_activity_date": 1566286148, "last_edit_date": 1566286148, "creation_date": 1556533798, "answer_id": 55901482, "question_id": 55897638, "link": "https://stackoverflow.com/questions/55897638/json-to-go-structure/55901482#55901482", "title": "JSON to Go Structure", "body": "<p>Do something like this and try. If you are fetching the data from mongodb then keep bson:\"\" part else just json tags is ok.</p>\n\n<pre><code>type DubnsID struct {\n  DubnsId string `bson:\"dubns_id\" json:\"dubns_id\"`\n}\n\ntype AutoGenerated struct {\n CompanyID     string    `bson:\"company_id\" json:\"company_id\"`\n CompanyName   string    `bson:\"company_name\" json:\"company_name\"`\n AtsOperators  []string  `bson:\"ats_operators\" json:\"ats_operators\"`\n Ids           map[string][]DubnsID `bson:\"ids\" json:\"ids\"`\n CompanySymbol string    `bson:\"company_symbol\" json:\"company_symbol\"`\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1283, "user_id": 9079863, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e9c7362282ac6c2b944cb216fa2ab4c?s=128&d=identicon&r=PG&f=1", "display_name": "Ilayaraja", "link": "https://stackoverflow.com/users/9079863/ilayaraja"}, "is_accepted": true, "score": 0, "last_activity_date": 1556538604, "creation_date": 1556538604, "answer_id": 55902771, "question_id": 55897638, "link": "https://stackoverflow.com/questions/55897638/json-to-go-structure/55902771#55902771", "title": "JSON to Go Structure", "body": "<p>You might have to use a struct like this:</p>\n\n<pre><code>type AutoGenerated struct {\n    CompanyID     string                   `json:\"company_id\"`\n    CompanyName   string                   `json:\"company_name\"`\n    AtsOperators  []string                 `json:\"ats_operators\"`\n    Ids           []map[string]interface{} `json:\"ids\"`\n    CompanySymbol string                   `json:\"company_symbol\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 662, "user_id": 7514490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc5891123238579de45eb2c25bcbfaf8?s=128&d=identicon&r=PG&f=1", "display_name": "Sahil", "link": "https://stackoverflow.com/users/7514490/sahil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 55902771, "answer_count": 2, "score": 0, "last_activity_date": 1566286148, "creation_date": 1556516953, "last_edit_date": 1556516999, "question_id": 55897638, "link": "https://stackoverflow.com/questions/55897638/json-to-go-structure", "title": "JSON to Go Structure", "body": "<p>I have a JSON like</p>\n\n<pre><code>{\n    \"company_id\": \"Sahil\",\n    \"company_name\": \"Sahil\",\n    \"ats_operators\": [\"123\"],\n    \"ids\": [\n        {\n            \"duns_id\": \"1234\"\n        }\n        ],\n        \"company_symbol\": \"1234\"\n}\n</code></pre>\n\n<p>I wanted to convert the above JSON into the Go Structure.</p>\n\n<p>I have one way to do it like:</p>\n\n<pre><code>type AutoGenerated struct {\n    CompanyID    string   `json:\"company_id\"`\n    CompanyName  string   `json:\"company_name\"`\n    AtsOperators []string `json:\"ats_operators\"`\n    Ids          []struct {\n        DubnsID string `json:\"dubns_id\"`\n    } `json:\"ids\"`\n    CompanySymbol string `json:\"company_symbol\"`\n}\n</code></pre>\n\n<p>But i wanted to use the Go-Map instead of Nested structure.</p>\n\n<p>I tried to use the below code but it is unable to parse the above JSON.</p>\n\n<pre><code>type Test struct {\n    CompanyID     string              `json:\"company_id\"`\n    CompanyName   string              `json:\"company_name\"`\n    CompanySymbol string              `json:\"company_symbol\"`\n    IDs           map[string][]string `json:\"ids\"`\n    AtsOperators  []string            `json:\"ats_operators\"`\n}\n</code></pre>\n\n<p>Please help and let me know what is the wrong with the above Go structure?</p>\n"}, {"tags": ["go", "yacc"], "answers": [{"tags": [], "owner": {"reputation": 23064, "user_id": 3177124, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/65014fdf3cfd04b1452620aeb54dcede?s=128&d=identicon&r=PG&f=1", "display_name": "abligh", "link": "https://stackoverflow.com/users/3177124/abligh"}, "is_accepted": false, "score": 1, "last_activity_date": 1556708516, "creation_date": 1556708516, "answer_id": 55935206, "question_id": 55897562, "link": "https://stackoverflow.com/questions/55897562/goyacc-getting-context-to-the-yacc-parser-no-param/55935206#55935206", "title": "goyacc: getting context to the yacc parser / no `%param`", "body": "<p>My own solution is to modify <code>goyacc</code> (<a href=\"https://github.com/golang/tools/pull/94\" rel=\"nofollow noreferrer\">see this PR</a>) which adds a <code>%param</code> directive allowing one or more fields to be added to the <code>$$ParserImpl</code> structure (accessible as <code>$$rcvr</code> in code). This seems the most idiomatic route. This permits not only passing context in, but the ability for the user to add additional <code>func()</code>s using <code>$$ParserImpl</code> as a receiver.</p>\n"}], "owner": {"reputation": 23064, "user_id": 3177124, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/65014fdf3cfd04b1452620aeb54dcede?s=128&d=identicon&r=PG&f=1", "display_name": "abligh", "link": "https://stackoverflow.com/users/3177124/abligh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1556708516, "creation_date": 1556516428, "last_edit_date": 1556604077, "question_id": 55897562, "link": "https://stackoverflow.com/questions/55897562/goyacc-getting-context-to-the-yacc-parser-no-param", "title": "goyacc: getting context to the yacc parser / no `%param`", "body": "<p>What is the most idiomatic way to get some form of context to the <code>yacc</code> parser in <a href=\"https://godoc.org/golang.org/x/tools/cmd/goyacc\" rel=\"nofollow noreferrer\"><code>goyacc</code></a>, i.e. emulate the <a href=\"https://www.gnu.org/software/bison/manual/html_node/Pure-Calling.html\" rel=\"nofollow noreferrer\"><code>%param</code></a> command in traditional <code>yacc</code>?</p>\n\n<p>I need to parse to my <code>.Parse</code> function some context (in this case including for instance where to build its parse tree).</p>\n\n<p>The <code>goyacc</code> <code>.Parse</code> function is <a href=\"https://github.com/golang/tools/blob/master/cmd/goyacc/yacc.go#L3416\" rel=\"nofollow noreferrer\">declared</a></p>\n\n<pre><code>func ($$rcvr *$$ParserImpl) Parse($$lex $$Lexer) int {\n</code></pre>\n\n<p>Things I've thought of:</p>\n\n<ul>\n<li><code>$$ParserImpl</code> <a href=\"https://github.com/golang/tools/blob/master/cmd/goyacc/yacc.go#L3279\" rel=\"nofollow noreferrer\">cannot be changed</a> by the <code>.y</code> file, so the obvious solution (to add fields to it) is right out, which is a pity.</li>\n<li>As <code>$$Lexer</code> is an interface, I could stuff the parser context into the Lexer implementation, then force type convert <code>$$lex</code> to that implementation (assuming my parser always used the same lexer), but this seems pretty disgusting (for which read non-idiomatic). Moreover there is (seemingly) no way to put a user-generated line at the top of the <code>Parse</code> function like <code>c := yylex.(*lexer).c</code>, so in the many tens of places I want to refer to this variable, I have to use the rather ugly form <code>yylex.(*lexer).c</code> rather than just <code>c</code>.</li>\n<li>Normally I'd use <a href=\"https://www.gnu.org/software/bison/manual/html_node/Pure-Calling.html\" rel=\"nofollow noreferrer\"><code>%param</code></a> in normal <code>yacc</code> / C (well, <code>bison</code> anyway), but that doesn't exist in <code>goyacc</code>.</li>\n<li>I'd like to avoid postprocessing my generated <code>.go</code> file with <code>sed</code> or <code>perl</code> for what are hopefully obvious reasons.</li>\n<li>I want to be able to (go)yacc parse more than one file at once, so a global variable is not possible (and global variables are hardly idiomatic).</li>\n</ul>\n\n<p>What's the most idiomatic solution here? I keep thinking I must be missing something simple.</p>\n"}, {"tags": ["go", "revel"], "comments": [{"owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "edited": false, "score": 1, "creation_date": 1556513421, "post_id": 55897075, "comment_id": 98450435, "body": "Are the packages being imported correctly ?"}, {"owner": {"reputation": 11, "user_id": 11422257, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-WodpSQ1OTYM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePwQGeOSb8CjWeK9rgzkYGBITMGw/mo/photo.jpg?sz=128", "display_name": "toshi Dossy", "link": "https://stackoverflow.com/users/11422257/toshi-dossy"}, "reply_to_user": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "edited": false, "score": 0, "creation_date": 1556517670, "post_id": 55897075, "comment_id": 98451560, "body": "add comments. app.go and gorm.go what is need import packages?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1556518402, "post_id": 55897075, "comment_id": 98451765, "body": "Show what code you have in file <code>app&#47;controllers&#47;gorm.go</code> on line <code>31</code> and file <code>app&#47;controllers&#47;app.go</code> on line <code>26</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1556518759, "post_id": 55897075, "comment_id": 98451900, "body": "... most probably in file <code>app&#47;controllers&#47;gorm.go</code> you&#39;re missing the import of the <code>&quot;database&#47;sql&quot;</code> package. And in file <code>app&#47;controllers&#47;app.go</code> on line <code>26</code> you are referencing <code>c.Txn</code> where <code>c</code> is an instance of <code>Application</code> but you haven&#39;t defined the type <code>Application</code> as having a field <code>Txn</code>. So you should add that field to that type."}, {"owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "edited": false, "score": 0, "creation_date": 1556519163, "post_id": 55897075, "comment_id": 98452057, "body": "Application struct should have *GormController not *revel.Controller"}, {"owner": {"reputation": 11, "user_id": 11422257, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-WodpSQ1OTYM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePwQGeOSb8CjWeK9rgzkYGBITMGw/mo/photo.jpg?sz=128", "display_name": "toshi Dossy", "link": "https://stackoverflow.com/users/11422257/toshi-dossy"}, "edited": false, "score": 0, "creation_date": 1556527856, "post_id": 55897075, "comment_id": 98455836, "body": "&gt;So you should add that field to that type. What do I?"}, {"owner": {"reputation": 11, "user_id": 11422257, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-WodpSQ1OTYM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePwQGeOSb8CjWeK9rgzkYGBITMGw/mo/photo.jpg?sz=128", "display_name": "toshi Dossy", "link": "https://stackoverflow.com/users/11422257/toshi-dossy"}, "edited": false, "score": 0, "creation_date": 1556528037, "post_id": 55897075, "comment_id": 98455924, "body": "&gt;Application struct should have *GormController not *revel.Controller   I edit controllers/app.go  <code>type Application struct { \t*Gorm.Controller }</code>  But new error. <code>ERROR 17:54:44 watcher.go:270: Build detected an error                  error=&quot;Go Compilation Error (in app&#47;controllers&#47;app.go:11): undefined: Gorm&quot;  </code>"}], "owner": {"reputation": 11, "user_id": 11422257, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-WodpSQ1OTYM/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePwQGeOSb8CjWeK9rgzkYGBITMGw/mo/photo.jpg?sz=128", "display_name": "toshi Dossy", "link": "https://stackoverflow.com/users/11422257/toshi-dossy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 202, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1556592441, "creation_date": 1556513015, "last_edit_date": 1556527487, "question_id": 55897075, "link": "https://stackoverflow.com/questions/55897075/go-revel-undefined-sql-or-txn", "title": "go revel undefined: sql or Txn", "body": "<p>mac highsierra\nuse mysql</p>\n\n<p><a href=\"https://paiza.hatenablog.com/entry/2018/03/23/paizacloud_golang_revel\" rel=\"nofollow noreferrer\">https://paiza.hatenablog.com/entry/2018/03/23/paizacloud_golang_revel</a>\uff09</p>\n\n<p>I'm trying to use the Revel framework for mysql.\n It's revel Tutorial booking.</p>\n\n<p>what is error?</p>\n\n<pre><code>ERROR 18:33:28 watcher.go:270: Build detected an error                  error=\"Go Compilation Error (in app/controllers/gorm.go:31): undefined: sql\"\n</code></pre>\n\n<p>before </p>\n\n<pre><code>ERROR 18:18:26 watcher.go:270: Build detected an error                  error=\"Go Compilation Error (in app/controllers/app.go:26): c.Txn undefined (type Application has no field or method Txn)\" \n</code></pre>\n\n<p>I did this because I got an error before</p>\n\n<p>controllers/gorm.go</p>\n\n<pre><code>type Transactional struct {\n    *revel.Controller\n    Txn *sql.Tx\n}\n</code></pre>\n\n<p>After running it results in error\nPlease tell me how you can solve it</p>\n\n<p>add \ncontrollers/app.go</p>\n\n<pre><code>package controllers\n\nimport (\n    \"github.com/revel/revel\"\n    \"booking/app/models\"\n    \"booking/app/routes\"\n    \"database/sql\"\n)\ntype Application struct {\n    *revel.Controller\n}\n\nfunc (c Application) Index() revel.Result {\n    if c.connected() != nil {\n        return c.Redirect(routes.Hotels.Index())\n    }\n    c.Flash.Error(\"Please log in first\")\n    return c.Render()\n}\n\nfunc (c Application) connected() *models.User {\n    if c.ViewArgs[\"user\"] != nil {\n        return c.ViewArgs[\"user\"].(*models.User)\n    }\n    if username, ok := c.Session[\"user\"]; ok {\n        return c.getUser(username.(string))\n    }\n\n    return nil\n}\n\n</code></pre>\n\n<p>controllers/gorm.go</p>\n\n<pre><code>package controllers\n\nimport (\n    _ \"github.com/go-sql-driver/mysql\"\n    \"github.com/jinzhu/gorm\"\n    \"github.com/revel/revel\"\n    \"booking/app/models\"\n    \"log\"\n    )\n\n\ntype GormController struct {\n    *revel.Controller\n    Txn *gorm.DB\n}\nfunc InitDB() {\n    dbInfo, _ := revel.Config.String(\"db.info\")\n    db, err := gorm.Open(\"mysql\", dbInfo)\n    if err != nil {\n        log.Panicf(\"Failed gorm.Open: %v\\n\", err)\n    }\n\n    db.DB()\n    db.AutoMigrate(&amp;models.Booking{})\n    db.AutoMigrate(&amp;models.Hotel{})\n    db.AutoMigrate(&amp;models.User{})\n\n    DB = db\n}\n\n\nfunc (c *GormController) SetDB() revel.Result {\n    c.Txn = DB\n    return nil\n}\n\ntype Transactional struct {\n    *revel.Controller\n    Txn *sql.Tx\n}\n</code></pre>\n\n<p>tree\n<a href=\"https://i.stack.imgur.com/g0APz.png\" rel=\"nofollow noreferrer\">enter image description here</a>\nmaybe import miss?</p>\n"}, {"tags": ["go", "io"], "comments": [{"owner": {"reputation": 3949, "user_id": 1816872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1V08e.jpg?s=128&g=1", "display_name": "Ivan Black", "link": "https://stackoverflow.com/users/1816872/ivan-black"}, "edited": false, "score": 0, "creation_date": 1556512369, "post_id": 55896835, "comment_id": 98450186, "body": "The <code>NewRequest</code> returns <code>Request</code> not <code>Response</code>."}, {"owner": {"reputation": 160, "user_id": 7003027, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eX0kB.jpg?s=128&g=1", "display_name": "Dian Bakti", "link": "https://stackoverflow.com/users/7003027/dian-bakti"}, "reply_to_user": {"reputation": 3949, "user_id": 1816872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1V08e.jpg?s=128&g=1", "display_name": "Ivan Black", "link": "https://stackoverflow.com/users/1816872/ivan-black"}, "edited": false, "score": 0, "creation_date": 1556512482, "post_id": 55896835, "comment_id": 98450215, "body": "My bad, it was meant for &quot;pseudocode&quot; only, fixed. :)"}, {"owner": {"reputation": 3949, "user_id": 1816872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1V08e.jpg?s=128&g=1", "display_name": "Ivan Black", "link": "https://stackoverflow.com/users/1816872/ivan-black"}, "edited": false, "score": 5, "creation_date": 1556514214, "post_id": 55896835, "comment_id": 98450610, "body": "It uses <code>io.Copy</code>. I.e. memory used for buffers only. Ref.: <a href=\"https://golang.org/src/net/http/transfer.go#L346\" rel=\"nofollow noreferrer\">golang.org/src/net/http/transfer.go#L346</a>"}], "owner": {"reputation": 160, "user_id": 7003027, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eX0kB.jpg?s=128&g=1", "display_name": "Dian Bakti", "link": "https://stackoverflow.com/users/7003027/dian-bakti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 363, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1556517970, "creation_date": 1556511000, "last_edit_date": 1556517970, "question_id": 55896835, "link": "https://stackoverflow.com/questions/55896835/golang-streaming-response-body-into-another-http-request-body", "title": "Golang streaming response.Body into another HTTP request body", "body": "<p>I'm trying to understand Go behavior on HTTP io.Reader for response.Body.\nThe overview of the program:</p>\n\n<pre><code>   req1, err := http.NewRequest(\"GET\", url1, nil)\n   resp1, err := httpClient.Do(req1)\n   req2, err := http.NewRequest(\"PUT\", url2, resp1.Body)\n   httpClient.Do(req2)\n</code></pre>\n\n<p>It's expected that resp1.Body could be very big (magnitude of GBs).\nI'm wondering:\nWill Go read resp1.Body entirely and store it in RAM (or disk?) before opening another reader for the second request? Or is Go smart enough to directly stream body from resp1 into the second request as the data flow?</p>\n\n<p>In other words, I'm trying to understand whether this code will put pressure on memory or even incur heavy IO operations in case of big files.</p>\n\n<p>The ideal behavior that I expect will be the second scenario (Go streams the data directly without buffering the entire body). In this case, each stream will only use buffer of size 32KB (Go's default for copy?).</p>\n"}, {"tags": ["firebase", "go", "firebase-realtime-database"], "comments": [{"owner": {"reputation": 9545, "user_id": 3068190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YDAi7.jpg?s=128&g=1", "display_name": "samthecodingman", "link": "https://stackoverflow.com/users/3068190/samthecodingman"}, "edited": false, "score": 0, "creation_date": 1556530923, "post_id": 55896622, "comment_id": 98457394, "body": "Querying your data in this fashion is going to be expensive resource-wise as your entire &quot;vehicles&quot; tree will have to be downloaded to run the query (in addition to be a security problem). Instead, I would suggest implementing a shallow index such as <code>{ &quot;vehiclesByPool&quot;: { &quot;POOL XYZ&quot;: { &quot;VB201&quot;: 0 &#47;* time_out value *&#47;, &quot;VB202&quot;: 1555331615429 }, &quot;POOL ABC&quot;: { &quot;VB203&quot;: 0 } } }</code> which will improve performance significantly."}, {"owner": {"reputation": 61, "user_id": 5648046, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/ND3Nx.jpg?s=128&g=1", "display_name": "Yosafat Vincent Saragih", "link": "https://stackoverflow.com/users/5648046/yosafat-vincent-saragih"}, "reply_to_user": {"reputation": 9545, "user_id": 3068190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YDAi7.jpg?s=128&g=1", "display_name": "samthecodingman", "link": "https://stackoverflow.com/users/3068190/samthecodingman"}, "edited": false, "score": 0, "creation_date": 1556594239, "post_id": 55896622, "comment_id": 98481386, "body": "Thank you sir, but actually this database is implemented (or maybe i don&#39;t know) without shallow index, and I don&#39;t have right to implemented it, due the restriction of my job task. Does someone know the alternatives about it? Btw, i have change the strategy to make the query hard-coded on server only, so the user only access the result without querying in client side."}, {"owner": {"reputation": 9545, "user_id": 3068190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YDAi7.jpg?s=128&g=1", "display_name": "samthecodingman", "link": "https://stackoverflow.com/users/3068190/samthecodingman"}, "edited": false, "score": 0, "creation_date": 1556595897, "post_id": 55896622, "comment_id": 98481688, "body": "Honestly, take it to your supervisor and get the rights to implement it. <a href=\"https://www.youtube.com/watch?v=vKqXSZLLnHA&amp;list=PLl-K7zZEsYLlP-k-RKFa7RyNPa9_wCH2s&amp;index=6\" rel=\"nofollow noreferrer\">Denormalizing data is normal</a> for NoSQL databases like the Firebase RTDB. Adding an index to an existing project is not all too difficult and will save time and money."}, {"owner": {"reputation": 61, "user_id": 5648046, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/ND3Nx.jpg?s=128&g=1", "display_name": "Yosafat Vincent Saragih", "link": "https://stackoverflow.com/users/5648046/yosafat-vincent-saragih"}, "reply_to_user": {"reputation": 9545, "user_id": 3068190, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YDAi7.jpg?s=128&g=1", "display_name": "samthecodingman", "link": "https://stackoverflow.com/users/3068190/samthecodingman"}, "edited": false, "score": 0, "creation_date": 1556614970, "post_id": 55896622, "comment_id": 98489004, "body": "But one thing that bother me, if i do de-normalization on my database, it will affect the entire database (based from what i read from the doc and watch Firebase for SQL programmer video). But my database behavior is update dynamically; it will add new object due in the real case there&#39;s always new vehicle enter and wait at the place. For query reason, i need to denormalizing the data, but i&#39;m affraid about client side about time consumption, due the data must served immediately in client side when client need it."}], "owner": {"reputation": 61, "user_id": 5648046, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/ND3Nx.jpg?s=128&g=1", "display_name": "Yosafat Vincent Saragih", "link": "https://stackoverflow.com/users/5648046/yosafat-vincent-saragih"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1556526691, "creation_date": 1556508843, "last_edit_date": 1556526691, "question_id": 55896622, "link": "https://stackoverflow.com/questions/55896622/count-object-from-firebase-get-that-meet-several-conditions", "title": "Count object from Firebase GET that meet several conditions", "body": "<p>I have a project to implement Golang integration with Firebase. The goal sounds pretty simple: I want to count how many objects in database that meet the condition (for this example if the\n    location \nis in POOL XYZ and \n    time_out \nis 0) and return it with format like this:</p>\n\n<pre><code>pool XYZ,n\n</code></pre>\n\n<p>Where poolXYZ is from the Location and n is number(s) of the objects</p>\n\n<p>This is my JSON Firebase structure example (for testing)</p>\n\n<pre><code>\"vehicles\" : {\n    \"VB201\" : {\n      \"register\" : \"VB201\",\n      \"police_number\" : \"\",\n      \"position\" : {\n        \"content\" : {\n          \"location\" : \"POOL XYZ\",\n          \"stat\" : 0,\n          \"time_in\" : 1555331615429,\n          \"time_out\" : 0,\n          \"username\" : \"POOL XYZ1\"\n        }\n      },\n      \"trips\" : {\n        \"content\" : {\n          \"accept\" : \"POOL XYZ\",\n          \"stat\" : 1,\n          \"status\" : 0,\n          \"time_stop\" : 1555331615429,\n          \"username\" : \"POOL XYZ1\"\n        }\n      }\n    }\n      }\n }\n</code></pre>\n\n<p>The things that i want to do is get the \"register\" of the vehicle, VB201, cause it meet the condition (POOL XYZ and time_out 0). There're several objects like this and has same JSON structure. SO the result might be</p>\n\n<pre><code>POOL XYZ, 1\n</code></pre>\n"}, {"tags": ["c++", "go"], "comments": [{"owner": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 1, "creation_date": 1556508259, "post_id": 55896402, "comment_id": 98449413, "body": "why don&#39;t you just compile the app as a 64-bit one? And <b>don&#39;t use the A version of APIs nowadays</b>. Use the <code>W</code> version instead, because the A one will be internally converted to <code>W</code> which was CPU time"}, {"owner": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 1, "creation_date": 1556510907, "post_id": 55896402, "comment_id": 98449902, "body": "Why are you executing <code>cmd.exe</code> at all? You should be executing <code>bcdedit.exe</code> directly instead. And you should be using <code>CreateProcess()</code> for that, not <code>ShellExecute()</code>"}], "answers": [{"tags": [], "owner": {"reputation": 81087, "user_id": 104458, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/cc46b8a10ecb92e61aaeb1efe436a0c8?s=128&d=identicon&r=PG", "display_name": "selbie", "link": "https://stackoverflow.com/users/104458/selbie"}, "is_accepted": false, "score": 0, "last_activity_date": 1556516737, "creation_date": 1556516737, "answer_id": 55897603, "question_id": 55896402, "link": "https://stackoverflow.com/questions/55896402/compiling-32-bit-programs-and-calling-64-bit-programs-on-64-bit-systems/55897603#55897603", "title": "Compiling 32-bit programs and calling 64-bit programs on 64-bit systems", "body": "<p>So your code attempts to launch <code>\"bcdedit.exe\"</code>.  From the command line, the only location of <code>bcdedit.exe</code> in your PATH environment is the Windows System directory, <code>c:\\Windows\\System32</code>.</p>\n\n<p>When you compile your code as 32-bit and run it on a 64-bit system, your process's view of the file system will change.  Namely, the process view of the <code>C:\\Windows\\System32</code> is replaced by the contents of <code>C:\\Windows\\SysWOW64</code> - where only 32-bit DLLs and EXEs are located. However.... There is no 32-bit version bcdedit.exe located in this folder. (If you want to simulate this, go run c:\\windows\\syswow64\\cmd.exe - you won't be able to find bcdedit.exe in the c:\\windows\\system32 folder anymore).</p>\n\n<p>You probably need something like this: <a href=\"https://stackoverflow.com/questions/3094520/how-to-retrieve-correct-path-of-either-system32-or-syswow64\">How to retrieve correct path of either system32 or SysWOW64?</a></p>\n\n<p>Format your ShellExecute function to directly specificy the SysWow64 path for both bcdedit.exe and cmd.exe.  Or as others have suggested, just compile for 64-bit.</p>\n"}], "owner": {"reputation": 21, "user_id": 7732144, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-NQGrMO6CmzI/AAAAAAAAAAI/AAAAAAAAAP0/cjkf5Zs-jYo/photo.jpg?sz=128", "display_name": "Dean Chou", "link": "https://stackoverflow.com/users/7732144/dean-chou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 116, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1556516737, "creation_date": 1556506481, "question_id": 55896402, "link": "https://stackoverflow.com/questions/55896402/compiling-32-bit-programs-and-calling-64-bit-programs-on-64-bit-systems", "title": "Compiling 32-bit programs and calling 64-bit programs on 64-bit systems", "body": "<p>My system is 64 bit.\nI have a program calls a command \"bcdedit.exe\"</p>\n\n<p>c++ code\uff1a</p>\n\n<pre><code>ShellExecuteA(NULL, \"open\", \"cmd.exe\", \"/c bcdedit.exe /?\", NULL, SW_SHOWNORMAL);\n</code></pre>\n\n<p>I compiled to 32 bit\nWhen I run it back \"file not find\"\nWhen I compiled to 64 bit, run passed</p>\n\n<p>The same problem exists in go\ngo code:</p>\n\n<pre><code>cmd := exec.Command(\"cmd.exe\",\"/c\",\"bcdedit.exe /?\")\nout, err := cmd.CombinedOutput()\nif err != nil {\n    fmt.Println(err)\n}\nfmt.Println(string(out))\n</code></pre>\n\n<p>I found \"bcdedit.exe\" in another directory:</p>\n\n<pre><code>C:\\\\Windows\\\\WinSxS\\\\amd64_microsoft-windows-b..iondata-cmdlinetool_31bf3856ad364e35_10.0.17134.471_none_69b0e05efb5a4702\\\\bcdedit.exe\n</code></pre>\n\n<p>When I call the command in this directory, all passed\nThis directory is different on every PC</p>\n\n<p>How do I run the 32-bit compiled program for this command on each PC</p>\n"}, {"tags": ["macos", "go", "macos-mojave"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1556555784, "post_id": 55896370, "comment_id": 98470387, "body": "The full path is given in the error. <code>&#47;var&#47;folders&#47;</code> is at the root of your filesystem (as indicated by the leading slash)."}], "owner": {"reputation": 11, "user_id": 8577654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YqXXM.jpg?s=128&g=1", "display_name": "RoyalFlush", "link": "https://stackoverflow.com/users/8577654/royalflush"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 228, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1556506160, "creation_date": 1556506160, "question_id": 55896370, "link": "https://stackoverflow.com/questions/55896370/how-to-fix-ld-warning-ignoring-file-file-was-built-for-unsupported-file-form", "title": "How to fix &quot;ld: warning: ignoring file: file was built for unsupported file format which is not the architecture being linked?&quot;", "body": "<p>I tried \"go install\" after update my MacOS to \"Mojave\".</p>\n\n<p>Unexpectedly I got following error: ld: warning: ignoring file</p>\n\n<p>/var/folders/8q/7w329nzx6h1ck5gn44gvksg80000gn/T/go-link-040352046/000000.o, file was built for unsupported file format ( 0x4C 0x01 0x01 0x00 0x00 0x00 0x00 0x00 0xC7 0x02 0x00 0x00 0x01 0x00 0x00 0x00 ) which is not the architecture being linked (x86_64): /var/folders/8q/7w329nzx6h1ck5gn44gvksg80000gn/T/go-link-040352046/000000.o</p>\n\n<p>I appreciate your help. I cannot find where var/folders located.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "viper-go"], "answers": [{"tags": [], "owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "is_accepted": true, "score": 2, "last_activity_date": 1556516812, "last_edit_date": 1556516812, "creation_date": 1556511147, "answer_id": 55896852, "question_id": 55896369, "link": "https://stackoverflow.com/questions/55896369/why-the-switch-t-policy-parameter-type-does-not-work-with-viper-unmarshal/55896852#55896852", "title": "why the &quot;switch t := policy.Parameter.(type)&quot; does not work with viper.Unmarshal()", "body": "<p>It's json unmarshal feature</p>\n\n<p>If you use an <code>interface{}</code> as a decoder, the default json object for <code>interface{}</code> is <code>map[string]interface{}</code></p>\n\n<p>You can see it here:</p>\n\n<p><a href=\"https://godoc.org/encoding/json#Unmarshal\" rel=\"nofollow noreferrer\">https://godoc.org/encoding/json#Unmarshal</a></p>\n\n<pre><code>bool, for JSON booleans\nfloat64, for JSON numbers\nstring, for JSON strings\n[]interface{}, for JSON arrays\nmap[string]interface{}, for JSON objects\nnil for JSON null\n</code></pre>\n\n<p>So in <code>t := policy.Parameter.(type)</code>, the <code>t</code> is <code>map[string]interface{}</code></p>\n\n<p>For solving your problem, you can try to define another field to distinguish <code>CatParameter</code> or <code>DogParameter</code></p>\n\n<p>Maybe:</p>\n\n<pre><code>type Policy struct {\n    Name      string      `json:\"name\"`\n    Parameter Parameter   `json:\"parameter\"`\n}\n\ntype Parameter struct {\n    Name      string `json:\"name\"`   // cat or dog\n    Percent   int    `json:\"percent,omitempty\"`\n    Duration  int    `json:\"duration,omitempty\"`\n    Operation string `json:\"operation,omitempty\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 5235551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb3b0ee835d5e0ee10eaf0d3f9bfe858?s=128&d=identicon&r=PG&f=1", "display_name": "Toni.W", "link": "https://stackoverflow.com/users/5235551/toni-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 55896852, "answer_count": 1, "score": 1, "last_activity_date": 1556516812, "creation_date": 1556506155, "last_edit_date": 1556506813, "question_id": 55896369, "link": "https://stackoverflow.com/questions/55896369/why-the-switch-t-policy-parameter-type-does-not-work-with-viper-unmarshal", "title": "why the &quot;switch t := policy.Parameter.(type)&quot; does not work with viper.Unmarshal()", "body": "<p>I want to unmarshal several types from JSON and use the interface to represent the actual struct that it is different. But when I send the struct as <code>interface{}</code> it converts it to a map. The animal.json is:</p>\n\n<pre><code>\"{\"type\":\"cat\",\"policies\":[{\"name\":\"kitty\",\"parameter\":{\"duration\":600,\"percent\":90}}]}\"\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"reflect\"\n\n    log \"github.com/sirupsen/logrus\"\n    \"github.com/spf13/viper\"\n)\n\nfunc main() {\n    var err error\n    animal := New()\n    viper.SetConfigType(\"json\")\n    viper.SetConfigName(\"animal\")\n    viper.AddConfigPath(\"~/Desktop/\")\n    viper.AddConfigPath(\".\")\n    if err := viper.ReadInConfig(); err != nil {\n        return\n    }\n\n    if err = viper.Unmarshal(&amp;animal); err != nil {\n        return\n    }\n    for _, policy := range animal.Policies {\n        log.Info(policy.Name)\n        log.Info(policy.Parameter)\n        //INFO[0000] map[duration:600 percent:90]\n        log.Info(reflect.TypeOf(policy.Parameter))\n        //INFO[0000] map[string]interface {}, Why is it not an interface{} and how do I get it?\n        switch t := policy.Parameter.(type) {\n        //why does the switch not work?\n        case *CatParameter:\n            log.Info(\"cat\", t)\n        case *DogParameter:\n            log.Info(\"dog\", t)\n        }\n    }\n}\n\nfunc New() *Animal {\n    var animal Animal\n    animal.Type = \"cat\"\n    return &amp;animal\n}\n\ntype Animal struct {\n    Type     string   `json:\"type\" form:\"type\"`\n    Policies []Policy `json:\"policies\" form:\"policies\"`\n}\n\ntype CatParameter struct {\n    Duration int `json:\"duration\"`\n    Percent  int `json:\"percent\"`\n}\n\ntype DogParameter struct {\n    Percent   int    `json:\"percent\"`\n    Duration  int    `json:\"duration\"`\n    Operation string `json:\"operation\"`\n}\n\ntype Policy struct {\n    Name      string      `json:\"name\"`\n    Parameter interface{} `json:\"parameter\"`\n}\n\n\n</code></pre>\n"}, {"tags": ["mysql", "go"], "answers": [{"tags": [], "owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "is_accepted": true, "score": 1, "last_activity_date": 1556509308, "creation_date": 1556509308, "answer_id": 55896665, "question_id": 55896253, "link": "https://stackoverflow.com/questions/55896253/must-i-call-sql-rows-close-before-sql-tx-rollback-calling/55896665#55896665", "title": "Must I call *sql.Rows.Close() before *sql.Tx.Rollback() calling?", "body": "<p><a href=\"https://go-review.googlesource.com/c/go/+/44812/\" rel=\"nofollow noreferrer\">https://go-review.googlesource.com/c/go/+/44812/</a></p>\n\n<p>The code is here</p>\n\n<p>It doesn't matter even if skip the <code>rows.Close()</code> within transaction</p>\n\n<p>When the transaction has commit or rollback, the rows will be closed by transaction context.</p>\n"}], "owner": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 0, "accepted_answer_id": 55896665, "answer_count": 1, "score": 1, "last_activity_date": 1556509308, "creation_date": 1556504731, "question_id": 55896253, "link": "https://stackoverflow.com/questions/55896253/must-i-call-sql-rows-close-before-sql-tx-rollback-calling", "title": "Must I call *sql.Rows.Close() before *sql.Tx.Rollback() calling?", "body": "<p>When I using <code>sql</code> package of golang, if I make a query within transaction, and encounter an error while calling <code>rows.Scan()</code>, which method should I call first after this point? <code>*sql.Tx.Rollback()</code> or <code>*sql.Rows.Close()</code>? Currently I call <code>*sql.Rows.Close()</code> before <code>*sql.Tx.Rollback()</code>, but I want to know, what will happen if I reverse this order?</p>\n\n<pre><code>tx, err := db.Begin()\nif err != nil {\n    ... // handle error\n}\n\n\nrows, err := tx.Query(\"sqlstmt\")\nif err != nil {\n    ... // handle error\n}\n\n\ndefer rows.Close() // can I use defer at this place, though it will be called after tx.Rollback()?\n\n\nif err := rows.Scan(vars...); err != nil {\n    if e := tx.Rollback(); e != nil {\n        log(e)\n        return e\n    }\n    return err\n}\n</code></pre>\n"}, {"tags": ["go", "channel", "pprof"], "comments": [{"owner": {"reputation": 6841, "user_id": 3960399, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/c5OVT.jpg?s=128&g=1", "display_name": "Frank Bryce", "link": "https://stackoverflow.com/users/3960399/frank-bryce"}, "edited": false, "score": 2, "creation_date": 1556477007, "post_id": 55893087, "comment_id": 98443471, "body": "From <a href=\"https://www.reddit.com/r/golang/comments/99ijxe/go_pprof_assistance/\" rel=\"nofollow noreferrer\">reddit</a>  1. are you doing a LOT of channel sends and receives ? Perhaps the amount of work you are doing vs the amount you are handing off between goroutines is relatively small 2. are you generating a lot of garbage ? I recommend running your program with GODEBUG=gctrace=1 and looking at the frequency of the gc trace output, if it is continuous, that could be a sign you are generating too much garbage."}, {"owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "edited": false, "score": 1, "creation_date": 1556505770, "post_id": 55893087, "comment_id": 98448978, "body": "try <code>web</code> command in pprof console: <a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"nofollow noreferrer\">blog.golang.org/profiling-go-programs</a>"}], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 3, "last_activity_date": 1556630488, "creation_date": 1556630488, "answer_id": 55921876, "question_id": 55893087, "link": "https://stackoverflow.com/questions/55893087/what-would-cause-go-to-spend-so-much-time-in-runtime-pthread-cond-signal/55921876#55921876", "title": "what would cause go to spend so much time in runtime.pthread_cond_signal", "body": "<p>This likely means your code is doing a lot of locking/unlocking. <code>pthread_cond_signal</code> is used to notify condition variables, and is only used by Go on OSX, it seems. It's used in the implementation of <code>semawakeup</code> which itself is used in the <code>unlock</code> primitive, which is used everywhere locking/unlocking is done.</p>\n\n<p>As the comments suggested, try the <code>(web)</code> command in <code>go tool pprof</code> to see where these calls are made from.</p>\n\n<p>It's hard to provide more details without seeing your specific benchmark.</p>\n"}], "owner": {"reputation": 71, "user_id": 10613146, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QjYg4.jpg?s=128&g=1", "display_name": "cwcing", "link": "https://stackoverflow.com/users/10613146/cwcing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1769, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1556630488, "creation_date": 1556474370, "question_id": 55893087, "link": "https://stackoverflow.com/questions/55893087/what-would-cause-go-to-spend-so-much-time-in-runtime-pthread-cond-signal", "title": "what would cause go to spend so much time in runtime.pthread_cond_signal", "body": "<p>I have written a multi-goroutine benchmark test in go. And I use the go tool pprof to analyze how to optimize my code. When I use top10 to show some information, I got the following outputs:</p>\n\n<pre><code>Showing top 10 nodes out of 167\n      flat  flat%   sum%        cum   cum%\n    4700ms 17.86% 17.86%     4700ms 17.86%  runtime.pthread_cond_signal\n    1790ms  6.80% 24.66%     1790ms  6.80%  cmpbody\n    1470ms  5.59% 30.24%     1620ms  6.16%  syscall.syscall\n    1360ms  5.17% 35.41%     3280ms 12.46%  runtime.scanobject\n    1170ms  4.45% 39.86%     1410ms  5.36%  runtime.findObject\n     960ms  3.65% 43.50%      960ms  3.65%  runtime.pthread_cond_wait\n     950ms  3.61% 47.11%      950ms  3.61%  runtime.memmove\n     650ms  2.47% 49.58%      650ms  2.47%  runtime.usleep\n     650ms  2.47% 52.05%     2490ms  9.46%  talent.TopN.func1\n     630ms  2.39% 54.45%     2890ms 10.98%  runtime.mallocgc\n\n</code></pre>\n\n<p>It's obviously that the runtime.pthread_cond_signal spend so much time in my code. I try to google to search some usable information about runtime.pthread_cond_signal. But failed to got them. Though Some posts have mentioned it, they just provide few tips, and keep me still confused about it.</p>\n\n<p>I guess that this situation is relative about the channel's usage in Go, but I am not sure about my opinion, and I also don't know some details about that.</p>\n\n<p>What I want to know is the following:</p>\n\n<ol>\n<li><p>What would cause go to spend so much time in runtime.pthread_cond_signal usually?</p></li>\n<li><p>In normal conditions\uff0chow to optimize your go code when this situation happens\uff1f</p></li>\n</ol>\n\n<p>Feel free to provide any information and advice.\nI would appreciate to receive any help from you.</p>\n"}, {"tags": ["go", "google-cloud-functions", "protocol-buffers", "bazel"], "answers": [{"comments": [{"owner": {"reputation": 3025, "user_id": 3154872, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/6e515e9f683ad319f7c73a9ae2c9a87a?s=128&d=identicon&r=PG&f=1", "display_name": "mancini0", "link": "https://stackoverflow.com/users/3154872/mancini0"}, "edited": false, "score": 0, "creation_date": 1559147138, "post_id": 56362323, "comment_id": 99332978, "body": "Thanks - I ended up using bazel to package the go_binary as a go_image, and just deployed the container to Google Cloud Run."}], "tags": [], "owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "is_accepted": true, "score": 1, "last_activity_date": 1559138234, "creation_date": 1559138234, "answer_id": 56362323, "question_id": 55892223, "link": "https://stackoverflow.com/questions/55892223/google-cloud-functions-with-bazel-built-protobuf-dependencies/56362323#56362323", "title": "Google cloud functions with bazel built protobuf dependencies", "body": "<p>I work at Google on Go and Google Cloud Functions.</p>\n\n<p>I see a few options for using Cloud Functions:</p>\n\n<ul>\n<li>Publish the generated code publicly. You may not want to do this for a variety of reasons.</li>\n<li>Copy the generated code into your source directory. This is the easiest. When you deploy your function, the current directory gets zipped up and sent to be built. We don't copy any dependencies from outside your current directory. If you do this, you can import the generated code by having the package path be prefixed by the module path of your directory.</li>\n<li>Use vendoring. If you run <code>go mod vendor</code> and have that grab your generated code (at whatever path you choose), it will create a <code>vendor</code> directory with all of your dependencies. The Cloud Functions builder prefers <code>go.mod</code> over <code>vendor</code>, though. So you would have to <code>.gcloudignore</code> the <code>go.mod</code> and <code>go.sum</code> file to make sure they don't get uploaded when you deploy your code. <a href=\"https://cloud.google.com/functions/docs/writing/specifying-dependencies-go\" rel=\"nofollow noreferrer\">https://cloud.google.com/functions/docs/writing/specifying-dependencies-go</a> has more information.</li>\n</ul>\n"}], "owner": {"reputation": 3025, "user_id": 3154872, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/6e515e9f683ad319f7c73a9ae2c9a87a?s=128&d=identicon&r=PG&f=1", "display_name": "mancini0", "link": "https://stackoverflow.com/users/3154872/mancini0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 311, "favorite_count": 0, "accepted_answer_id": 56362323, "answer_count": 1, "score": 1, "last_activity_date": 1577815942, "creation_date": 1556468560, "last_edit_date": 1577815942, "question_id": 55892223, "link": "https://stackoverflow.com/questions/55892223/google-cloud-functions-with-bazel-built-protobuf-dependencies", "title": "Google cloud functions with bazel built protobuf dependencies", "body": "<p>If I use bazel to build my protobuf dependent Go serverless functions, bazel will make the protobuf generated go code available at the import path that I specify.</p>\n\n<p>Google cloud functions for go requires one to use go modules. </p>\n\n<p>How can I add the dummy import path created by bazel to my go.mod file?  The function deploy to google cloud fails because the dummy import can not be resolved. (G cloud requires me to upload my go source, AWS lambdas would allow me to upload a binary, which would work fine.) </p>\n\n<p>I'm guessing I'll have to either go with AWS lambdas, use serverless containers,  or write a genrule that copies the outputs of the proto generated code into my source directory but I'd like to avoid that ugliness.</p>\n"}, {"tags": ["go", "web", "web-frameworks", "go-gin"], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 4399174, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7bb8ea83982b32dc861a92969d0c9b09?s=128&d=identicon&r=PG&f=1", "display_name": "Hakan", "link": "https://stackoverflow.com/users/4399174/hakan"}, "edited": false, "score": 0, "creation_date": 1556473506, "post_id": 55892272, "comment_id": 98442625, "body": "Thanks, @mkopriva I have a lot of pages for this situation how can I make like it {{ template .pgVariable . }}                               #### pgVariable is the string variable contains page name?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 77, "user_id": 4399174, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7bb8ea83982b32dc861a92969d0c9b09?s=128&d=identicon&r=PG&f=1", "display_name": "Hakan", "link": "https://stackoverflow.com/users/4399174/hakan"}, "edited": false, "score": 0, "creation_date": 1556473699, "post_id": 55892272, "comment_id": 98442673, "body": "That&#39;s not possible, if you look at the documentation on actions linked above you&#39;ll see that the argument must be a <i>literal</i> string containing the name of a template."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 77, "user_id": 4399174, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7bb8ea83982b32dc861a92969d0c9b09?s=128&d=identicon&r=PG&f=1", "display_name": "Hakan", "link": "https://stackoverflow.com/users/4399174/hakan"}, "edited": false, "score": 0, "creation_date": 1556474585, "post_id": 55892272, "comment_id": 98442910, "body": "@Hakan do you have a lot of templates where you need to switch between these two specific templates? Or do you have a lot of templates where you need to switch between <i>different</i> templates, not just userprofile and userregister?"}, {"owner": {"reputation": 77, "user_id": 4399174, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7bb8ea83982b32dc861a92969d0c9b09?s=128&d=identicon&r=PG&f=1", "display_name": "Hakan", "link": "https://stackoverflow.com/users/4399174/hakan"}, "edited": false, "score": 0, "creation_date": 1556476019, "post_id": 55892272, "comment_id": 98443250, "body": "Actually; I have a lot of template pages but I posted my question being two template pages to simplify the problem. I have about 10 different pages (I am not sure yet at now), Do I have to control the template pages with if statement one by one?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 77, "user_id": 4399174, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7bb8ea83982b32dc861a92969d0c9b09?s=128&d=identicon&r=PG&f=1", "display_name": "Hakan", "link": "https://stackoverflow.com/users/4399174/hakan"}, "edited": false, "score": 1, "creation_date": 1556476347, "post_id": 55892272, "comment_id": 98443324, "body": "Maybe rethink how you structure those templates, instead of attempting to render everything from main.html, each template would have a <code>template</code> action on top and bottom to render that content that is shared by all of them."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 1, "last_activity_date": 1556468793, "creation_date": 1556468793, "answer_id": 55892272, "question_id": 55892159, "link": "https://stackoverflow.com/questions/55892159/how-to-set-web-template-variable-to-a-dynamic-htmlgolang-code/55892272#55892272", "title": "How to set web template variable to a dynamic html&amp;golang code?", "body": "<p>Parse all templates when starting the router.</p>\n\n<pre><code>router.LoadHTMLFiles(\"templates/main.html\", \"templates/userregister.html\", \"templates/userprofile.html\")\n</code></pre>\n\n<p>Then in your handler add to the <code>gin.H{ ... }</code> expression a boolean variable, e.g. <code>\"isLoggedIn\"</code>, and then in your main template use an <code>if-else</code> <a href=\"https://golang.org/pkg/text/template/#hdr-Actions\" rel=\"nofollow noreferrer\">action</a> together with the <code>template</code> action.</p>\n\n<pre><code>{{ if .isLoggedIn }}\n    {{ template \"userprofile\" . }}\n{{ else }}\n    {{ template \"userregister\" . }}\n{{ end }}\n</code></pre>\n"}], "owner": {"reputation": 77, "user_id": 4399174, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7bb8ea83982b32dc861a92969d0c9b09?s=128&d=identicon&r=PG&f=1", "display_name": "Hakan", "link": "https://stackoverflow.com/users/4399174/hakan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 496, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1597430897, "creation_date": 1556468145, "last_edit_date": 1597430897, "question_id": 55892159, "link": "https://stackoverflow.com/questions/55892159/how-to-set-web-template-variable-to-a-dynamic-htmlgolang-code", "title": "How to set web template variable to a dynamic html&amp;golang code?", "body": "<p>I have two web page on golang and I want to embed this pages codes to {{.content}} variable (defined in templates/main.html) being with dynamic according to the coming requests.</p>\n\n<p>For example if the guest enter the userregister page I want to the {{.content}} variable will be userregister codes otherwise userprofile codes.</p>\n\n<p>templates/userregister.html page codes;</p>\n\n<pre><code>{{ define \"userregister\" }}\n   ...\n   {{.specialmessage}}\n   ...\n{{ end }}\n</code></pre>\n\n<p>templates/userprofile.html page codes;</p>\n\n<pre><code>{{ define \"userprofile\" }}\n   ...\n   {{.specialmessage}}\n   ...\n{{ end }}\n</code></pre>\n\n<p>templates/main.html;</p>\n\n<pre><code>{{ define \"main\" }}\n&lt;!DOCTYPE html&gt;\n&lt;html lang=\"tr\"&gt;\n    {{ template \"head\" . }}\n    &lt;body&gt;\n        &lt;div class=\"container-fluid\"&gt;\n            {{ template \"header\" . }}\n            &lt;div class=\"row\"&gt;\n                &lt;nav class=\"col-12 col-md-2 p-0\"&gt;\n                    {{ template \"leftmenu\" . }}\n                &lt;/nav&gt;\n                &lt;div class=\"container-fluid col-12 col-md-10\"&gt;\n\n\n                    {{.content}}\n\n\n                &lt;/div&gt;\n            &lt;/div&gt;\n            {{ template \"footer\" . }}\n        &lt;/div&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n{{ end }}\n</code></pre>\n\n<p>The userregister page controller;</p>\n\n<pre><code>func PgUserRegister(c *gin.Context) {\n    c.HTML(http.StatusOK,\"main\", gin.H{\n        \"pgETitle\": \"User Register page\",\n        \"specialmessage\": \"You are on the userregister page.\",\n\n        \"content\": template.ParseFiles(\"userregister.html\"),\n    })\n}\n</code></pre>\n\n<p>The userprofile page controller;</p>\n\n<pre><code>func PgUserProfile(c *gin.Context) {\n    c.HTML(http.StatusOK,\"main\", gin.H{\n        \"pgETitle\": \"User Profile\",\n        \"specialmessage\": \"You are on the userprofile page.\",\n\n        \"content\": template.ParseFiles(\"userprofile.html\"),\n    })\n}\n</code></pre>\n"}, {"tags": ["mysql", "go", "error-handling", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "is_accepted": true, "score": 8, "last_activity_date": 1613568020, "last_edit_date": 1613568020, "creation_date": 1556469182, "answer_id": 55892341, "question_id": 55892035, "link": "https://stackoverflow.com/questions/55892035/how-to-disable-default-error-logger-in-go-gorm/55892341#55892341", "title": "How to disable default error logger in Go-Gorm", "body": "<p>UPDATE: for gorm <code>v2</code>:</p>\n<p>Use the <a href=\"https://gorm.io/docs/logger.html#Log-Levels\" rel=\"nofollow noreferrer\"><code>Logger</code></a> in <code>gorm.Config</code>:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>db, err := gorm.Open(sqlite.Open(&quot;test.db&quot;), &amp;gorm.Config{\n  Logger: logger.Default.LogMode(logger.Silent),\n})\n</code></pre>\n<hr />\n<p>For gorm <code>v1</code>:</p>\n<p>Use <a href=\"https://godoc.org/github.com/jinzhu/gorm?hide=1&amp;import-graph=#DB.LogMode\" rel=\"nofollow noreferrer\">db.LogMode</a> to silence the default error logger.</p>\n<blockquote>\n<p>LogMode set log mode, <code>true</code> for detailed logs, <code>false</code> for no log, default, will only print error logs.</p>\n</blockquote>\n<p><code>db.LogMode(false)</code> should do the job!</p>\n"}], "owner": {"reputation": 700, "user_id": 5484988, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AESxW.jpg?s=128&g=1", "display_name": "Li Jinyao", "link": "https://stackoverflow.com/users/5484988/li-jinyao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2223, "favorite_count": 0, "accepted_answer_id": 55892341, "answer_count": 1, "score": 4, "last_activity_date": 1613568020, "creation_date": 1556467273, "last_edit_date": 1556484624, "question_id": 55892035, "link": "https://stackoverflow.com/questions/55892035/how-to-disable-default-error-logger-in-go-gorm", "title": "How to disable default error logger in Go-Gorm", "body": "<p>I am using GORM with MySQL, I have encountered and handled the error <code>Error 1062: Duplicate entry</code>. The problem is that it's still printed to the console.</p>\n\n<p>Code in <code>gym/models/auth.go:49</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func AddAuth(username, password string) error {\n    passwordHash, err := auth.HashPassword(password, argon2Conf)\n    if err != nil {\n        return err\n    }\n    userAuth := Auth{\n        Username: username,\n        Password: passwordHash,\n    }\n    return db.Create(&amp;userAuth).Error\n}\n</code></pre>\n\n<p>I am handling the error in the handler function:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func SignUpHandler(c *gin.Context) {\n    var form user\n    if err := c.ShouldBind(&amp;form); err != nil {\n        c.JSON(http.StatusBadRequest, gin.H{\"error\": err.Error()})\n        return\n    }\n    if err := models.AddAuth(form.Username, form.Password); err == nil {\n        c.JSON(http.StatusOK, gin.H{\"status\": \"you are signed in\"})\n    } else {\n        // I think I have handled the sql error here\n        c.JSON(http.StatusBadRequest, gin.H{\"error\": \"sign in failed\"})\n    }\n}\n</code></pre>\n\n<p>When I send a <code>POST</code> request, the error is correctly handled and I get the correct response with <code>{\"error\": \"sign in failed\"}</code>. But the console still prints this error message:</p>\n\n<pre><code>(/...../gym/models/auth.go:49) \n[2019-04-28 23:37:06]  Error 1062: Duplicate entry '123123' for key 'username' \n[GIN] 2019/04/28 - 23:37:06 | 400 |  136.690908ms |             ::1 | POST     /signup\n</code></pre>\n\n<p>I am confused since I handled the error but it still gets printed. How to prevent this error from getting printed to the error log? Or am I handle the error correct?</p>\n"}, {"tags": ["go", "concurrency"], "answers": [{"comments": [{"owner": {"reputation": 8073, "user_id": 2852624, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/682806d261e4f00f77aa8633689a9558?s=128&d=identicon&r=PG&f=1", "display_name": "Matthias247", "link": "https://stackoverflow.com/users/2852624/matthias247"}, "edited": false, "score": 0, "creation_date": 1556512016, "post_id": 55892190, "comment_id": 98450113, "body": "You can also close the abort channel instead of writing something to it in order to signal the abort. That&#39;s the convention that most Go programs use for that task. The benefit is also that the closed abort channel can signal an infinite number of consumers, while writing to the channel can only signal a single task."}], "tags": [], "owner": {"reputation": 1, "user_id": 5852322, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--NiR5KNtsj0/AAAAAAAAAAI/AAAAAAAAAFg/Wk3NlL9pDVY/photo.jpg?sz=128", "display_name": "Istvan Darvas", "link": "https://stackoverflow.com/users/5852322/istvan-darvas"}, "is_accepted": false, "score": 0, "last_activity_date": 1556468358, "creation_date": 1556468358, "answer_id": 55892190, "question_id": 55891979, "link": "https://stackoverflow.com/questions/55891979/coordination-and-graceful-closing-of-go-routines/55892190#55892190", "title": "coordination and graceful closing of go-routines", "body": "<p>I have just figured it out! :)\n<a href=\"https://en.wikipedia.org/wiki/Rubber_duck_debugging\" rel=\"nofollow noreferrer\">Rubber_duck_debugging</a></p>\n\n<p>abort needs capacity 1 ;) and checking abort should be in same time when trying to reset the TTL</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var abort = make(chan interface{}, 1)\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func serviceAlpha(min, max int, ttlReset chan&lt;- interface{}, abort &lt;-chan interface{}, wg *sync.WaitGroup) {\n    log.Println(\"serviceAlpha | START\")\n    var randTTL int\nloop:\n    for {\n        randTTL = rand2.Intn(max-min) + min + 1\n        log.Printf(\"serviceAlpha | rand = %v\", randTTL)\n        time.Sleep(time.Duration(randTTL) * time.Second)\n\n        select {\n        case &lt;-abort:\n            log.Println(\"serviceAlpha | There was an abort, breaking from loop\")\n            break loop\n        default:\n            log.Println(\"serviceAlpha | There was not any abort event\")\n            ttlReset &lt;- true\n            break\n        }\n    }\n\n    log.Println(\"serviceAlpha | STOP\")\n    wg.Done()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 271, "user_id": 8849444, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/760b3e84b3d7b6ce9ea0f8f336f4e791?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Khandelwal", "link": "https://stackoverflow.com/users/8849444/tarun-khandelwal"}, "is_accepted": false, "score": 0, "last_activity_date": 1556477382, "creation_date": 1556477382, "answer_id": 55893521, "question_id": 55891979, "link": "https://stackoverflow.com/questions/55891979/coordination-and-graceful-closing-of-go-routines/55893521#55893521", "title": "coordination and graceful closing of go-routines", "body": "<p>While your solution may work for this case, it is still a design flaw. The problem in your original code was an effective deadlock where <code>serviceAlpha</code> was trying to write to <code>ttlReset</code> while <code>serviceBeta</code> was no longer listening to that channel. That blocks <code>serviceAlpha</code>. Now, <code>serviceBeta</code> wants to write to <code>abort</code> but <code>serviceAplha</code> is not currently listening to it, which blocks <code>serviceBeta</code> as well. Using a buffered channel works because it is no longer blocking.</p>\n\n<p>However, I was able to use ticker instead of sleep and make it work. Here is the modified code for <code>serviceAlpha</code>:</p>\n\n<pre><code>   func serviceAlpha(min, max int, ttlReset chan&lt;- interface{}, abort &lt;-chan interface{}, wg *sync.WaitGroup) {\n    log.Println(\"serviceAlpha | START\")\n    var randTTL int\nloop:\n    for {\n        randTTL = rand2.Intn(max-min) + min + 1\n        log.Printf(\"serviceAlpha | rand = %v\", randTTL)\n        ticker := time.NewTicker(time.Duration(randTTL) * time.Second)\n        select {\n        case &lt;-abort:\n            log.Println(\"serviceAlpha | There was an abort, breaking from loop\")\n            break loop\n        case &lt;-ticker.C:\n            log.Println(\"serviceAlpha | There was not abort\")\n            ttlReset &lt;- true\n        }\n    }\n\n    log.Println(\"serviceAlpha | STOP\")\n    wg.Done()\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 5852322, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--NiR5KNtsj0/AAAAAAAAAAI/AAAAAAAAAFg/Wk3NlL9pDVY/photo.jpg?sz=128", "display_name": "Istvan Darvas", "link": "https://stackoverflow.com/users/5852322/istvan-darvas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1556477382, "creation_date": 1556466856, "question_id": 55891979, "link": "https://stackoverflow.com/questions/55891979/coordination-and-graceful-closing-of-go-routines", "title": "coordination and graceful closing of go-routines", "body": "<p>I am totally new in Go just learning (at the moment I am playing with channels, and go routines, I am trying to understand the coordination). I got stuck with a problem.</p>\n\n<p>I do not understand what is happening behind the curtains, when I start 2 go routines.\nServiceAlpha's responsibility to give heartbeat tick to ServiceBeta and die if it gets abort event on abort channel\nServiceBeta's responsibility to write some stupid string to my log output\n and it has a TTL (it comes from serviceAlpha), so if it does not get heartbeat in the TTL time it should finish its job and return to his caller, but before exit it should give some abort event to ServiceAlpha on channel abort</p>\n\n<p>My problem I do not understand why it keeps running, after the TTL and </p>\n\n<p>an output looks like this:</p>\n\n<pre><code>2019/04/28 17:21:44 Main | START\n2019/04/28 17:21:44 serviceBeta | START\n2019/04/28 17:21:44 serviceAlpha | START\n2019/04/28 17:21:44 serviceAlpha | There was not abort\n2019/04/28 17:21:44 serviceAlpha | rand = 3\n2019/04/28 17:21:45 serviceBeta | TICKER:  2019-04-28 17:21:45.2870594 +0200 CEST m=+1.003883901\n2019/04/28 17:21:46 serviceBeta | TICKER:  2019-04-28 17:21:46.2867957 +0200 CEST m=+2.003620201\n2019/04/28 17:21:47 serviceBeta | TICKER:  2019-04-28 17:21:47.2866242 +0200 CEST m=+3.003448701\n2019/04/28 17:21:47 serviceAlpha | There was not abort\n2019/04/28 17:21:47 serviceAlpha | rand = 5\n2019/04/28 17:21:48 serviceBeta | TICKER:  2019-04-28 17:21:48.2869918 +0200 CEST m=+4.003816301\n2019/04/28 17:21:49 serviceBeta | TICKER:  2019-04-28 17:21:49.2863265 +0200 CEST m=+5.003151001\n2019/04/28 17:21:50 serviceBeta | TICKER:  2019-04-28 17:21:50.2868071 +0200 CEST m=+6.003631601\n2019/04/28 17:21:51 serviceBeta | TICKER:  2019-04-28 17:21:51.2866738 +0200 CEST m=+7.003498301\n2019/04/28 17:21:51 serviceBeta | ABORT 2019-04-28 17:21:51.2866738 +0200 CEST m=+7.003498301\n\nKeeps running...\nmissing serviceBeta: STOP\nand ServiceAlpha,and Main also\n</code></pre>\n\n<p>I am pretty sure there are lots of problem with this code, so my questions are\n- What is the problem in this design? :) \n- How should it be coded in the right way?</p>\n\n<p>Every help would be appreciated!</p>\n\n<p>Darvi</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"log\"\n    rand2 \"math/rand\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    log.Println(\"Main | START\")\n    var wg sync.WaitGroup\n    var resetTTL = make(chan interface{})\n    var abort = make(chan interface{})\n    defer func() {\n        log.Println(\"Main | defer closing channels\")\n        close(resetTTL)\n        close(abort)\n    }()\n\n    wg.Add(1)\n    go serviceAlpha(1, 5, resetTTL, abort, &amp;wg)\n\n    wg.Add(1)\n    go serviceBeta(4*time.Second, resetTTL, abort, &amp;wg)\n\n    wg.Wait()\n    log.Println(\"Main | STOP\")\n}\n\nfunc serviceAlpha(min, max int, ttlReset chan&lt;- interface{}, abort &lt;-chan interface{}, wg *sync.WaitGroup) {\n    log.Println(\"serviceAlpha | START\")\n    var randTTL int\nloop:\n    for {\n        select {\n        case &lt;-abort:\n            log.Println(\"serviceAlpha | There was an abort, breaking from loop\")\n            break loop\n        default:\n            log.Println(\"serviceAlpha | There was not abort\")\n            break\n        }\n\n        randTTL = rand2.Intn(max-min) + min + 1\n        log.Printf(\"serviceAlpha | rand = %v\", randTTL)\n        time.Sleep(time.Duration(randTTL) * time.Second)\n        ttlReset &lt;- true\n    }\n\n    log.Println(\"serviceAlpha | STOP\")\n    wg.Done()\n}\n\nfunc serviceBeta(ttl time.Duration, ttlReset &lt;-chan interface{}, abort chan&lt;- interface{}, wg *sync.WaitGroup) {\n    log.Println(\"serviceBeta | START\")\n    var ttlTimer = time.NewTimer(ttl)\n    var tickerTimer = time.NewTicker(1 * time.Second)\n\nloop:\n    for {\n        select {\n        case &lt;-ttlReset:\n            ttlTimer.Stop()\n            ttlTimer.Reset(ttl)\n        case tt := &lt;-tickerTimer.C:\n            log.Println(\"serviceBeta | TICKER: \", tt)\n        case ttl := &lt;-ttlTimer.C:\n            log.Println(\"serviceBeta | ABORT\", ttl)\n            break loop\n        }\n    }\n\n    abort &lt;- true\n\n    log.Println(\"serviceBeta | STOP\")\n    wg.Done()\n}\n\n</code></pre>\n"}, {"tags": ["go", "mime-types"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1556463875, "post_id": 55891524, "comment_id": 98439914, "body": "<a href=\"https://golang.org/pkg/mime/#ExtensionsByType\" rel=\"nofollow noreferrer\"><code>mime.ExtensionsByType</code></a>"}, {"owner": {"reputation": 9, "user_id": 11420975, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XVxQ9M6U24g/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reKXu800EPCbGejxDfVD7NudAAUFw/mo/photo.jpg?sz=128", "display_name": "Suyatno Hardianto", "link": "https://stackoverflow.com/users/11420975/suyatno-hardianto"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1556464555, "post_id": 55891524, "comment_id": 98440129, "body": "@mkopriva <code>mime.ExtensionsByType(&quot;video&#47;mp4&quot;)</code> return nil :/"}, {"owner": {"reputation": 9, "user_id": 11420975, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XVxQ9M6U24g/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reKXu800EPCbGejxDfVD7NudAAUFw/mo/photo.jpg?sz=128", "display_name": "Suyatno Hardianto", "link": "https://stackoverflow.com/users/11420975/suyatno-hardianto"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1556465073, "post_id": 55891524, "comment_id": 98440294, "body": "<a href=\"https://github.com/golang/go/issues/22318#issuecomment-337591992\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/22318#issuecomment-337591992</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1556465120, "post_id": 55891524, "comment_id": 98440311, "body": "You can probably use <a href=\"https://golang.org/pkg/mime/#AddExtensionType\" rel=\"nofollow noreferrer\">golang.org/pkg/mime/#AddExtensionType</a> to add more mime-type extensions. The mime types supported by default are here <a href=\"https://github.com/golang/go/blob/master/src/mime/type.go#L59-L73\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/master/src/mime/type.go#L59-L73</a> and agumented by <a href=\"https://github.com/golang/go/blob/master/src/mime/type.go#L94-L102\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/master/src/mime/type.go#L94-L102</a>"}, {"owner": {"reputation": 9, "user_id": 11420975, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XVxQ9M6U24g/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reKXu800EPCbGejxDfVD7NudAAUFw/mo/photo.jpg?sz=128", "display_name": "Suyatno Hardianto", "link": "https://stackoverflow.com/users/11420975/suyatno-hardianto"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1556465240, "post_id": 55891524, "comment_id": 98440339, "body": "sorry, i test <code>mime.ExtensionsByType(&quot;video&#47;mp4&quot;)</code> in play.golang.org, and it&#39;s return empty slice - nil, but not in my local ubuntu,  thank you !"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1556465899, "post_id": 55891524, "comment_id": 98440530, "body": "Probably because the playground doesn&#39;t have an &quot;/etc/mime.types&quot;. In other words, if you don&#39;t control the machines your program is going to run in, don&#39;t expect the function to always work, or produce a particular result. Register the types you care about most explicitly."}], "owner": {"reputation": 9, "user_id": 11420975, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XVxQ9M6U24g/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reKXu800EPCbGejxDfVD7NudAAUFw/mo/photo.jpg?sz=128", "display_name": "Suyatno Hardianto", "link": "https://stackoverflow.com/users/11420975/suyatno-hardianto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 263, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1556463600, "creation_date": 1556463600, "question_id": 55891524, "link": "https://stackoverflow.com/questions/55891524/get-file-extension-by-mime-type", "title": "Get file extension by mime type", "body": "<p>is there any GO library that convert mime type to file extension ?, I work on API that only give me mime type not the file format or even the file name</p>\n"}, {"tags": ["go"], "owner": {"reputation": 1192, "user_id": 1213186, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d9eabf15c471c4eb5158034e943711ce?s=128&d=identicon&r=PG", "display_name": "ddibiase", "link": "https://stackoverflow.com/users/1213186/ddibiase"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 197, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1556474946, "creation_date": 1556459786, "last_edit_date": 1556474946, "question_id": 55890972, "link": "https://stackoverflow.com/questions/55890972/properly-handling-grpc-types-to-sql-orm", "title": "Properly handling gRPC types to SQL ORM", "body": "<p>I'm implementing a gRPC server and using an ORM called Boiler for Go. I've gotten to a point where I've built all my models and protos and now I'm handling specific type issues.</p>\n\n<p>Within my protobuf files I've declared most types as <code>strings</code>. However my ORM treats (due to how it interfaces with Postgres) strings as null.String in it's models. Hence when I attempt something like so I get an error:</p>\n\n<pre><code>user := &amp;models.User{\n    FirstName:   req.FirstName,\n    LastName:    req.LastName,\n    Email:       req.Email,\n    Gender:      req.Gender,\n    PhoneNumber: req.PhoneNumber,\n}\n</code></pre>\n\n<p>The error: <code>services/users.go:46:3: cannot use req.FirstName (type string) as type null.String in field value</code></p>\n\n<p>The question is what would be the most appropriate way of handling this situation. I could: generate a new struct (which I'm already using for data validation) and cast them into null.String or I suppose I could attempt to force the casting somehow?</p>\n\n<p>The question then becomes if a user doesn't supply a value in the API and the validation process allows it, how would that handle the non-existing record?</p>\n\n<p>Edit: Seems like SQLBoiler developers have a package for handling nulls separately. ie. <code>null.StringFrom()</code>, <code>null.Int15From</code> etc. which I'd in essence wrap all my fields with as such:</p>\n\n<pre><code>user := &amp;models.User{\n    FirstName:        null.StringFrom(req.FirstName),\n    LastName:         null.StringFrom(req.LastName),\n    Email:            null.StringFrom(req.Email),\n    Password:         string(password_hash),\n    Role:             \"BASIC_USER\",\n    Status:           \"ACTIVE\",\n    Gender:           null.Int16From(req.Gender),\n    PhoneNumber:      null.StringFrom(req.PhoneNumber),\n    VerificationCode: null.StringFrom(code.String()),\n}\n</code></pre>\n\n<p>Feels kind of dirty but I don't see any other options. Suggestions/opinions anyone?</p>\n"}, {"tags": ["go", "chroot"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1556458599, "post_id": 55890415, "comment_id": 98438459, "body": "I&#39;m not familiar with Mac OS, but could you please run whatever tool that platform has for <code>nm</code> or <code>objdump</code> (found on other platforms) on the compiled binary to see which exactly symbols it wants to import from that lib? This might give you some clue."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1556459092, "post_id": 55890415, "comment_id": 98438591, "body": "From a cursory look <a href=\"https://github.com/golang/go/issues/31705\" rel=\"nofollow noreferrer\">this</a> is what you&#39;re after: a past change to the Go runtime made it use <code>libSystem</code> for DNS resolution if <code>cgo</code> is disabled. IOW, if you do not disable <code>cgo</code> your binary gets linked with a set of some system libs and if you do disable it your binary gets linked with another system lib. See <a href=\"https://github.com/golang/go/issues/12524\" rel=\"nofollow noreferrer\">this</a> for a background."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1556459272, "post_id": 55890415, "comment_id": 98438628, "body": "From all these threads, I gather that you basically have two options: 1) Make sure your binary runs with <a href=\"https://golang.org/pkg/net/#hdr-Name_Resolution\" rel=\"nofollow noreferrer\"><code>GODEBUG=netdns=go</code></a> in its environment. 2) Make sure your chroot jail has the necessary libs available. Note that with (1) your binary is still linked with <code>libSystem</code> so it might fail to be properly loaded in the jail unless the lib is unavailable anyway. So this looks like (2) may be a path of the least resistance while maintaining the possibility to have as feature-rich resolver as possible."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1556459537, "post_id": 55890415, "comment_id": 98438688, "body": "As to why (2) might be the best bet, see <a href=\"https://engineering.grab.com/dns-resolution-in-go-and-cgo\" rel=\"nofollow noreferrer\">this</a> (you might skip right to the conclusions)\u2014it&#39;s about Linux but the situation with the resolver there is similar."}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 5559746, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zfP2d5KJn8k/AAAAAAAAAAI/AAAAAAAAFXo/tLI5mMVrUaM/photo.jpg?sz=128", "display_name": "Robert Hencke", "link": "https://stackoverflow.com/users/5559746/robert-hencke"}, "is_accepted": false, "score": 2, "last_activity_date": 1556459388, "creation_date": 1556459388, "answer_id": 55890914, "question_id": 55890415, "link": "https://stackoverflow.com/questions/55890415/statically-link-go-program-to-usr-lib-libsystem-b-dylib/55890914#55890914", "title": "Statically link Go program to /usr/lib/libSystem.B.dylib", "body": "<p>As of Go 1.12, you cannot, on macOS - see <a href=\"https://github.com/golang/go/issues/17490\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/17490</a> for details.</p>\n"}], "owner": {"reputation": 645, "user_id": 6562635, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/0DyLm.jpg?s=128&g=1", "display_name": "Jonathan Wilbur", "link": "https://stackoverflow.com/users/6562635/jonathan-wilbur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 979, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1556459388, "creation_date": 1556455765, "question_id": 55890415, "link": "https://stackoverflow.com/questions/55890415/statically-link-go-program-to-usr-lib-libsystem-b-dylib", "title": "Statically link Go program to /usr/lib/libSystem.B.dylib", "body": "<p>I am trying to get my Go program to run as a single stand-alone binary in a <code>chroot</code> jail. When I run the program in a <code>chroot</code> jail, it immediately dies with this error message: <code>Killed: 9</code>. I am building with this script:</p>\n\n<pre><code>#!/bin/sh -e\nexport CGO_ENABLED=0\ngo build -ldflags=-s -o ./dist/contained ./source/main.go\n</code></pre>\n\n<p>Using <code>otool -L ./dist/contained</code> to see if any libraries link to it confirms my suspicion:</p>\n\n<pre><code>./dist/contained:\n        /usr/lib/libSystem.B.dylib (compatibility version 0.0.0, current version 0.0.0)\n</code></pre>\n\n<p>My question is: <strong>how do I get /usr/lib/libSystem.B.dylib and all of its dependencies to statically link to a Go program?</strong> I seem to be following all of the instructions I have seen elsewhere for statically-linking, so I don't get why there are still dynamically-linked files.</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1556458968, "post_id": 55890124, "comment_id": 98438555, "body": "The <code>Request</code> field and method documentation call out the difference between client use and server use.  <a href=\"https://godoc.org/net/http/httptest#NewRequest\" rel=\"nofollow noreferrer\">httptest.NewRequest</a> initializes a request as if it had been received on the server.  <a href=\"https://godoc.org/net/http#NewRequest\" rel=\"nofollow noreferrer\">http.NewRequest</a> initializes a request for client use."}], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 2, "last_activity_date": 1556631101, "creation_date": 1556631101, "answer_id": 55922064, "question_id": 55890124, "link": "https://stackoverflow.com/questions/55890124/what-is-the-difference-between-client-http-request-and-server-http-request-in-go/55922064#55922064", "title": "What is the difference between client HTTP request and server HTTP request in Golang&#39;s &quot;net/http&quot;", "body": "<p>TL;DR: they're the same type, used a bit differently for two use cases and initialized differently to serve these use cases</p>\n\n<hr>\n\n<p>The difference is only in usage - they are the same type <code>http.Request</code>. <code>http.NewRequest</code> is used for the more \"production\" use case which is client - \"create a new request to send to the server\". When writing HTTP servers, it's occasionally useful to create requests for testing, which is what <code>httptest.NewRequest</code> does. The doc of <code>http.NewRequest</code> is helpful here:</p>\n\n<blockquote>\n  <p>NewRequest returns a Request suitable for use with Client.Do or\n  Transport.RoundTrip. To create a request for use with testing a Server\n  Handler, either use the NewRequest function in the net/http/httptest\n  package, use ReadRequest, or manually update the Request fields. See\n  the Request type's documentation for the difference between inbound\n  and outbound request fields.</p>\n</blockquote>\n\n<p>If you check the docs of the <a href=\"https://godoc.org/net/http#Request\" rel=\"nofollow noreferrer\">http.Request type</a>, you'll find things like:</p>\n\n<pre><code>// URL specifies either the URI being requested (for server\n// requests) or the URL to access (for client requests).\n//\n// For server requests, the URL is parsed from the URI\n// supplied on the Request-Line as stored in RequestURI.  For\n// most requests, fields other than Path and RawQuery will be\n// empty. (See RFC 7230, Section 5.3)\n//\n// For client requests, the URL's Host specifies the server to\n// connect to, while the Request's Host field optionally\n// specifies the Host header value to send in the HTTP\n// request.\nURL *url.URL\n</code></pre>\n\n<p>Note the \"For client requests\" vs. \"For server requests\".</p>\n\n<p>If you see a place that doesn't use <code>httptest.NewRequest</code> it could be because:</p>\n\n<ol>\n<li>They're not aware of it</li>\n<li>Or they need more careful fine-tuning that <code>http.NewRequest</code> doesn't provide</li>\n</ol>\n"}], "owner": {"reputation": 2401, "user_id": 1797161, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/538748ff6e44c656974e3eda5602bc93?s=128&d=identicon&r=PG", "display_name": "Federico", "link": "https://stackoverflow.com/users/1797161/federico"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 643, "favorite_count": 0, "accepted_answer_id": 55922064, "answer_count": 1, "score": 0, "last_activity_date": 1556631101, "creation_date": 1556453535, "question_id": 55890124, "link": "https://stackoverflow.com/questions/55890124/what-is-the-difference-between-client-http-request-and-server-http-request-in-go", "title": "What is the difference between client HTTP request and server HTTP request in Golang&#39;s &quot;net/http&quot;", "body": "<p>I have seen people use <code>NewRequest()</code> method of the \"net/http\" package for testing APIs. Why not use the <code>NewRequest()</code> method from \"net/http/httptesting\"? What's the difference? Documentation advises <a href=\"https://golang.org/src/net/http/httptest/httptest.go#L39\" rel=\"nofollow noreferrer\">the following</a>:</p>\n\n<pre><code>// To generate a client HTTP request instead of a server request, see\n// the NewRequest function in the net/http package.\n</code></pre>\n\n<p>What would be the difference in handling cookies, for example? Both seem to be very similar.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 0, "creation_date": 1556453178, "post_id": 55890004, "comment_id": 98437063, "body": "Do you actually mean fields by <i>variables in struct1</i>? First of all, you need a variable of type <code>struct1</code>."}, {"owner": {"reputation": 97, "user_id": 10777965, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-amX9WV9h59I/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-iKUv0d7wHlSqngNHkHttAW8R_6RA/mo/photo.jpg?sz=128", "display_name": "HamiBU", "link": "https://stackoverflow.com/users/10777965/hamibu"}, "reply_to_user": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 0, "creation_date": 1556453713, "post_id": 55890004, "comment_id": 98437177, "body": "yes sure, I want to access the variable X or Y from package A to use it in package B"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1556454105, "post_id": 55890004, "comment_id": 98437276, "body": "If <code>struct1</code> is unexported and there is nothing in its package that would provide an instance of that type to a client package (e.g. an exported variable, or constructor function) then you cannot access those fields."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1556454363, "post_id": 55890004, "comment_id": 98437346, "body": "... also what you call variables are called <i>fields</i> in Go. To access a struct&#39;s field you first need an instance of that struct which, as i&#39;ve already mentioned in the previous comment, needs to be exported in some way or another."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1556989847, "post_id": 55890004, "comment_id": 98619041, "body": "Don&#39;t forget to read <a href=\"https://stackoverflow.com/help/someone-answers\">stackoverflow.com/help/someone-answers</a> for this or your other questions: you are supposed to vote/accept on answers."}], "answers": [{"comments": [{"owner": {"reputation": 97, "user_id": 10777965, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-amX9WV9h59I/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-iKUv0d7wHlSqngNHkHttAW8R_6RA/mo/photo.jpg?sz=128", "display_name": "HamiBU", "link": "https://stackoverflow.com/users/10777965/hamibu"}, "edited": false, "score": 0, "creation_date": 1556529001, "post_id": 55890345, "comment_id": 98456392, "body": "Also, If I want to access a specific field without initializing, how can I do this? for example: (struct1 := A.Struct1.X), Is that correct?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 97, "user_id": 10777965, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-amX9WV9h59I/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-iKUv0d7wHlSqngNHkHttAW8R_6RA/mo/photo.jpg?sz=128", "display_name": "HamiBU", "link": "https://stackoverflow.com/users/10777965/hamibu"}, "edited": false, "score": 0, "creation_date": 1556556918, "post_id": 55890345, "comment_id": 98470827, "body": "@HamiBU: there is no field without initializing. <code>Struct1</code> is a type, there&#39;s nothing to &quot;access&quot;."}], "tags": [], "owner": {"reputation": 4089, "user_id": 2463468, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/ff0435b9a3a69c842a5c26dfaae1164e?s=128&d=identicon&r=PG", "display_name": "benjaminjosephw", "link": "https://stackoverflow.com/users/2463468/benjaminjosephw"}, "is_accepted": false, "score": 1, "last_activity_date": 1556455241, "creation_date": 1556455241, "answer_id": 55890345, "question_id": 55890004, "link": "https://stackoverflow.com/questions/55890004/how-can-i-access-to-a-struct-variable-from-another-package-in-go/55890345#55890345", "title": "How can I access to a struct variable from another package in go?", "body": "<p>In Go, a type can be exported if it begins with a capital letter. For example, <code>Struct1</code> is exported and accessible from outside the package, but <code>struct1</code> is not since it has not been exported. Unexported names are only available inside of that package.</p>\n\n<p>You can import package A into package B and access the exported type as <code>A.Struct1</code>:</p>\n\n<pre><code>package B\n\nimport (\n    \"A\"\n    \"fmt\"\n)\n\nfunc CreateAndPrintStruct() {\n    struct1 := A.Struct1{5, 4}\n    fmt.Printf(\"%+v\", struct1)\n}\n</code></pre>\n"}], "owner": {"reputation": 97, "user_id": 10777965, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-amX9WV9h59I/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-iKUv0d7wHlSqngNHkHttAW8R_6RA/mo/photo.jpg?sz=128", "display_name": "HamiBU", "link": "https://stackoverflow.com/users/10777965/hamibu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1556455241, "creation_date": 1556452465, "last_edit_date": 1556453648, "question_id": 55890004, "link": "https://stackoverflow.com/questions/55890004/how-can-i-access-to-a-struct-variable-from-another-package-in-go", "title": "How can I access to a struct variable from another package in go?", "body": "<p>Assume that we have two different packages let's say A and B. I have a struct in package A as following:</p>\n\n<pre><code>type struct1 struct {\n   X int\n   Y int\n}\n</code></pre>\n\n<p>In package B, I want to access the variables in struct1 which is package A. How can I do this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2010, "user_id": 6625815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XUtQf.jpg?s=128&g=1", "display_name": "Andrew F", "link": "https://stackoverflow.com/users/6625815/andrew-f"}, "edited": false, "score": 1, "creation_date": 1556449744, "post_id": 55889593, "comment_id": 98436339, "body": "It looks like that&#39;s a <a href=\"https://developer.mozilla.org/en-US/docs/Glossary/Forbidden_header_name\" rel=\"nofollow noreferrer\">forbidden header name</a> so you won&#39;t be able to set it programmatically."}, {"owner": {"reputation": 1, "user_id": 9812926, "user_type": "registered", "profile_image": "https://graph.facebook.com/574172432968344/picture?type=large", "display_name": "Ho Phat", "link": "https://stackoverflow.com/users/9812926/ho-phat"}, "reply_to_user": {"reputation": 2010, "user_id": 6625815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XUtQf.jpg?s=128&g=1", "display_name": "Andrew F", "link": "https://stackoverflow.com/users/6625815/andrew-f"}, "edited": false, "score": 0, "creation_date": 1556450100, "post_id": 55889593, "comment_id": 98436430, "body": "Hi. Thanks for your answer, can you help me with a solution to this problem? because I see the orgin curl still works"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9812926, "user_type": "registered", "profile_image": "https://graph.facebook.com/574172432968344/picture?type=large", "display_name": "Ho Phat", "link": "https://stackoverflow.com/users/9812926/ho-phat"}, "edited": false, "score": 0, "creation_date": 1556453609, "post_id": 55890069, "comment_id": 98437154, "body": "Thanks , it worked.  My code: is `  req.Header.Set(&quot;User-Agent&quot;, &quot;Mozilla / 5.0 (Windows NT 10.0; Win64; x64) AppleWebKit / 537.36 (KHTML, like Gecko) Chrome / 73.0.3683.103 Safari / 537.36&quot;) `  and it doesn&#39;t work.  Your work has been active. Thanks for helping me. Thanks very much"}, {"owner": {"reputation": 71, "user_id": 6409145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1abbe0205cf11af428d74e5c332880d?s=128&d=identicon&r=PG&f=1", "display_name": "Anatolii Dev", "link": "https://stackoverflow.com/users/6409145/anatolii-dev"}, "reply_to_user": {"reputation": 1, "user_id": 9812926, "user_type": "registered", "profile_image": "https://graph.facebook.com/574172432968344/picture?type=large", "display_name": "Ho Phat", "link": "https://stackoverflow.com/users/9812926/ho-phat"}, "edited": false, "score": 0, "creation_date": 1556465296, "post_id": 55890069, "comment_id": 98440353, "body": "Glad I could help ;-)"}], "tags": [], "owner": {"reputation": 71, "user_id": 6409145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1abbe0205cf11af428d74e5c332880d?s=128&d=identicon&r=PG&f=1", "display_name": "Anatolii Dev", "link": "https://stackoverflow.com/users/6409145/anatolii-dev"}, "is_accepted": false, "score": 1, "last_activity_date": 1556453054, "creation_date": 1556453054, "answer_id": 55890069, "question_id": 55889593, "link": "https://stackoverflow.com/questions/55889593/how-to-fix-net-http-set-header-origin-in-golang/55890069#55890069", "title": "How to fix \u2018net/http set header ORIGIN\u2019 in Golang", "body": "<p>No sense to set origin because it's can't be modified programmatically.\nProbably your user agent header is not correct. Try this</p>\n\n<pre><code>    req.Header.Set(\"User-Agent\", `Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_5) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.64 Safari/537.11`)\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 9812926, "user_type": "registered", "profile_image": "https://graph.facebook.com/574172432968344/picture?type=large", "display_name": "Ho Phat", "link": "https://stackoverflow.com/users/9812926/ho-phat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1556453054, "creation_date": 1556449382, "question_id": 55889593, "link": "https://stackoverflow.com/questions/55889593/how-to-fix-net-http-set-header-origin-in-golang", "title": "How to fix \u2018net/http set header ORIGIN\u2019 in Golang", "body": "<p>I built a small piece of code with the function of getting information from a website,\nand looks like it can't set orgin,\nbecause with curl in php, I was able to get the data with http status of 200.\nthen I get 403.\nHope everyone helps. Thank you very much</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>req, err:= http.NewRequest(\"GET\", \"https://immortal.hydrax.net/0/BRlsM329RNjbSqlWnRF36A4Kf5jx6qlZmoeLnJRi9A6b\", nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    req.Header.Set(\"User-Agent\", \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36\")\n    req.Header.Set(\"Origin\", \"https://hydrax.net\")\n\n    resp, err := http.DefaultClient.Do(req)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer resp.Body.Close()\n    fmt.Printf(\"%s\", resp.Status)\n</code></pre>\n\n<p>Output : 403 Forbiddenexit</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2862, "user_id": 10115847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Okv0j.jpg?s=128&g=1", "display_name": "Or Yaacov", "link": "https://stackoverflow.com/users/10115847/or-yaacov"}, "edited": false, "score": 6, "creation_date": 1556445009, "post_id": 55888988, "comment_id": 98435219, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/24720097/golang-defer-behavior\">Golang defer behavior</a>"}, {"owner": {"reputation": 2112, "user_id": 583101, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/d287efdca7b2df3361ca31a942083348?s=128&d=identicon&r=PG", "display_name": "mlewis54", "link": "https://stackoverflow.com/users/583101/mlewis54"}, "edited": false, "score": 1, "creation_date": 1556466423, "post_id": 55888988, "comment_id": 98440680, "body": "In your simple example there is little reason (except good practices). However, in more complicated/larger functions you use defer() to ensure that certain actions are taken regardless how the functions ends -- primarily uncaught errors. For example, when I allocate a database handle I always immediately do a defer() to close the handle."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1556466604, "post_id": 55888988, "comment_id": 98440739, "body": "Add error handling to that code and it should be obvious."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1556777259, "post_id": 55888988, "comment_id": 98545672, "body": "It can&#39;t be stated enough: You need to get into the habit of handling possible errors on <b>everything</b>. Once you actually begin doing so, <code>defer</code> becomes the very obvious way of doing cleanup when something goes wrong."}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 2, "last_activity_date": 1556466485, "creation_date": 1556466485, "answer_id": 55891929, "question_id": 55888988, "link": "https://stackoverflow.com/questions/55888988/what-is-the-possible-use-case-for-defer/55891929#55891929", "title": "What is the possible use case for defer?", "body": "<p>Deferred functions always get executed, even after a panic or return statement.</p>\n\n<p>In real world code a lot of stuff happens between Open/Close type of call pairs, and defer lets you keep them close together in the source, and you don't have to repeat the Close call for every return statement.</p>\n\n<p>Go and write some real code. The usefulness of defer will be blatantly obvious before long.</p>\n"}, {"tags": [], "owner": {"reputation": 3895, "user_id": 4040931, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/705151302/picture?type=large", "display_name": "David Alsh", "link": "https://stackoverflow.com/users/4040931/david-alsh"}, "is_accepted": false, "score": 0, "last_activity_date": 1556770148, "creation_date": 1556770148, "answer_id": 55945559, "question_id": 55888988, "link": "https://stackoverflow.com/questions/55888988/what-is-the-possible-use-case-for-defer/55945559#55945559", "title": "What is the possible use case for defer?", "body": "<p>Very useful when catching code that has the potential to panic. </p>\n\n<p>Often when using <code>interface{}</code> (an \"any\" type) or reflection, you will encounter issues where you are trying to cast to a type that doesn't match the actual type of the data. </p>\n\n<p><code>defer</code>ing a function at the top to handle that error is how you save the day and keep your application running.</p>\n"}], "owner": {"reputation": 7, "user_id": 11422479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ed584b758d36ec23d39b3875717eda1?s=128&d=identicon&r=PG&f=1", "display_name": "user11422479", "link": "https://stackoverflow.com/users/11422479/user11422479"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "answer_count": 2, "score": -6, "last_activity_date": 1556770148, "creation_date": 1556444650, "last_edit_date": 1556449906, "question_id": 55888988, "link": "https://stackoverflow.com/questions/55888988/what-is-the-possible-use-case-for-defer", "title": "What is the possible use case for defer?", "body": "<p>What is the actual use of the <code>defer</code> keyword? </p>\n\n<p>for example, instead of writing this: </p>\n\n<pre><code>func main() {\n    f := createFile(\"/tmp/defer.txt\")\n    defer closeFile(f)\n    writeFile(f)\n}\n</code></pre>\n\n<p>I can just write this: </p>\n\n<pre><code>func main() {\n    f := createFile(\"/tmp/defer.txt\")\n    writeFile(f)\n    closeFile(f)\n}\n</code></pre>\n\n<p>So, why should I use it instead of a usual placing of functions?</p>\n"}, {"tags": ["go", "url"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 3373790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc4b887efb848603c4ffb77bcd66e305?s=128&d=identicon&r=PG&f=1", "display_name": "user3373790", "link": "https://stackoverflow.com/users/3373790/user3373790"}, "edited": false, "score": 0, "creation_date": 1557282678, "post_id": 55889407, "comment_id": 98708524, "body": "Python url parse is right. Golang url lib can not parse %%%, so I write a function deal with this question."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 0, "last_activity_date": 1556447833, "creation_date": 1556447833, "answer_id": 55889407, "question_id": 55888479, "link": "https://stackoverflow.com/questions/55888479/golang-url-pathunescape-can-not-worked-in/55889407#55889407", "title": "golang url.PathUnescape can not worked in %%", "body": "<blockquote>\n  <p>but it has error is invalid URL escape \"%%3\". Why?</p>\n</blockquote>\n\n<p>Because %%3 is not a valid percent encoding in an URL path.</p>\n\n<p>If you need to deal with malformed URLs you must implement that yourself. (Or fix upstream.)</p>\n"}], "owner": {"reputation": 33, "user_id": 3373790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc4b887efb848603c4ffb77bcd66e305?s=128&d=identicon&r=PG&f=1", "display_name": "user3373790", "link": "https://stackoverflow.com/users/3373790/user3373790"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 55889407, "answer_count": 1, "score": -2, "last_activity_date": 1556447833, "creation_date": 1556440723, "question_id": 55888479, "link": "https://stackoverflow.com/questions/55888479/golang-url-pathunescape-can-not-worked-in", "title": "golang url.PathUnescape can not worked in %%", "body": "<p>I use golang url.PathUnescape function to unescape url, but it can not worked in %%.</p>\n\n<p>I receive a request it url is /search/?ptp=1&amp;q=%27%22&amp;%%3cacx%3e%3cscript%20%3emcyv9834%3c/script%3e&amp;t=bao.\nwhen I use golang url.PathUnescape function to unescape url, but it has error is invalid URL escape \"%%3\". Why?</p>\n\n<pre><code>package main\nimport (\n    \"net/url\"\n    \"fmt\"\n)\nfunc main() {\n    str := `/search/?ptp=1&amp;q=%27%22&amp;%%3Cacx%3E%3CScRiPt%20%3EmCyV9834%3C/ScRiPt%3E&amp;t=bao`\n    a, b := url.PathUnescape(str)\n    fmt.Println(a, b)\n}\n</code></pre>\n\n<p>The origin url is /search/?ptp=1&amp;q='\"&amp;%mCyV9834&amp;t=bao .</p>\n"}, {"tags": ["go", "filepath"], "comments": [{"owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "edited": false, "score": 2, "creation_date": 1556439396, "post_id": 55888117, "comment_id": 98434008, "body": "<a href=\"https://godoc.org/path/filepath\" rel=\"nofollow noreferrer\">godoc.org/path/filepath</a> that&#39;s you want"}], "answers": [{"tags": [], "owner": {"reputation": 92, "user_id": 10657167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9103e73ebed67f859497de97009b2be0?s=128&d=identicon&r=PG&f=1", "display_name": "Max2019", "link": "https://stackoverflow.com/users/10657167/max2019"}, "is_accepted": true, "score": 2, "last_activity_date": 1556440874, "creation_date": 1556440874, "answer_id": 55888510, "question_id": 55888117, "link": "https://stackoverflow.com/questions/55888117/how-to-give-windows-full-path-to-golang-methods-which-takes-file-path-as-argumen/55888510#55888510", "title": "How to give windows full path to golang methods which takes file path as arguments", "body": "<p>You can use \"/\" in windows as well.</p>\n\n<p><strong>Sample code below.</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n)\n\nfunc main() {\n    content, err := ioutil.ReadFile(\"D:/temp/main.go\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf(\"File contents: %s\", content)\n\n}\n</code></pre>\n\n<p><strong>Output</strong></p>\n\n<pre><code>D:\\temp&gt;go run main.go\nFile contents: package main\n\nimport (\n        \"fmt\"\n        \"io/ioutil\"\n        \"log\"\n)\n\nfunc main() {\n        content, err := ioutil.ReadFile(\"D:/temp/main.go\")\n        if err != nil {\n                log.Fatal(err)\n        }\n\n        fmt.Printf(\"File contents: %s\", content)\n\n}\n</code></pre>\n"}], "owner": {"reputation": 1986, "user_id": 4511560, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/X7lzw.jpg?s=128&g=1", "display_name": "Tinkaal Gogoi", "link": "https://stackoverflow.com/users/4511560/tinkaal-gogoi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 560, "favorite_count": 0, "accepted_answer_id": 55888510, "answer_count": 1, "score": -1, "last_activity_date": 1556440874, "creation_date": 1556437525, "question_id": 55888117, "link": "https://stackoverflow.com/questions/55888117/how-to-give-windows-full-path-to-golang-methods-which-takes-file-path-as-argumen", "title": "How to give windows full path to golang methods which takes file path as arguments", "body": "<p>All golang methods say <code>ioutil.ReadFile</code> understand unix paths but it doesn't take windows path. Is there a way to achieve this in elegant way so that the methods can take both unix and windows path together.</p>\n"}, {"tags": ["go", "initialization"], "comments": [{"owner": {"reputation": 14359, "user_id": 5384363, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/975cbfcd1c4997cb9e85887a5271d48f?s=128&d=identicon&r=PG&f=1", "display_name": "for_stack", "link": "https://stackoverflow.com/users/5384363/for-stack"}, "edited": false, "score": 0, "creation_date": 1556437993, "post_id": 55887963, "comment_id": 98433713, "body": "It seems this is a compiler bug. The order should be <b>d, b, c, a</b>, since <b>b</b> is declared before <b>c</b>"}, {"owner": {"reputation": 14359, "user_id": 5384363, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/975cbfcd1c4997cb9e85887a5271d48f?s=128&d=identicon&r=PG&f=1", "display_name": "for_stack", "link": "https://stackoverflow.com/users/5384363/for-stack"}, "edited": false, "score": 1, "creation_date": 1556438390, "post_id": 55887963, "comment_id": 98433801, "body": "Also, IMHO, it&#39;s a bad idea to write code like that :)"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1556449677, "post_id": 55887963, "comment_id": 98436320, "body": "You should ask on golang-nuts or golang-dev."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 5, "creation_date": 1556489227, "post_id": 55887963, "comment_id": 98446371, "body": "cmd/compile: incorrect package initialization order for spec example #22326: <a href=\"https://github.com/golang/go/issues/22326\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/22326</a>"}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1559790436, "post_id": 55887963, "comment_id": 99531911, "body": "<a href=\"https://github.com/golang/go/issues/22326\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/22326</a> was closed 8 days ago, so I guess that the next release will fix this problem!"}, {"owner": {"reputation": 178, "user_id": 7902052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zuP0s.png?s=128&g=1", "display_name": "Rishabh Bhatnagar", "link": "https://stackoverflow.com/users/7902052/rishabh-bhatnagar"}, "edited": false, "score": 0, "creation_date": 1595346131, "post_id": 55887963, "comment_id": 111439776, "body": "Hello, I&#39;ve tried this on the go 1.14.6 compiler. I couldn&#39;t reproduce this behavior. Link to the playground: <a href=\"https://play.golang.org/p/e-fN3f9Al2W\" rel=\"nofollow noreferrer\">play.golang.org/p/e-fN3f9Al2W</a> ."}], "answers": [{"comments": [{"owner": {"reputation": 14359, "user_id": 5384363, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/975cbfcd1c4997cb9e85887a5271d48f?s=128&d=identicon&r=PG&f=1", "display_name": "for_stack", "link": "https://stackoverflow.com/users/5384363/for-stack"}, "edited": false, "score": 1, "creation_date": 1556438054, "post_id": 55888110, "comment_id": 98433727, "body": "NO. <b>b</b> is declared before <b>c</b>, so <b>b</b> should be initialized before <b>c</b>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1556439272, "post_id": 55888110, "comment_id": 98433985, "body": "The <a href=\"https://golang.org/ref/spec#Package_initialization\" rel=\"nofollow noreferrer\">docs</a> state that <i>&quot;the initialization order is d, b, c, a.&quot;</i> so d,c,b,a seems to be incorrect, or the docs are."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1556485166, "post_id": 55888110, "comment_id": 98445459, "body": "@Vorsprung how did you generate the assembly dump?"}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1556520750, "post_id": 55888110, "comment_id": 98452665, "body": "@colminator added a note to the answer about that"}], "tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 0, "last_activity_date": 1556520694, "last_edit_date": 1556520694, "creation_date": 1556437488, "answer_id": 55888110, "question_id": 55887963, "link": "https://stackoverflow.com/questions/55887963/is-there-an-error-on-variable-initialization/55888110#55888110", "title": "Is there an error on variable initialization", "body": "<p>no, as you said yourself it does d,c,b,a</p>\n\n<p>so d is 3</p>\n\n<p>then c calls f() and d is 4, therefore c is 4</p>\n\n<p>next b calls f() and d is 5, therefore b is 5</p>\n\n<p>finally, a is c+b or 9</p>\n\n<p>and d has ended up as 5 due to side effects in f()</p>\n\n<p>Here's compiler output of the relevant section</p>\n\n<p>As you can see it sets c( <code>c(SB)</code> ), then b, then a</p>\n\n<pre><code>  0x004b 00075 (b2.go:6)  CALL  \"\".f(SB)\n  0x0050 00080 (b2.go:6)  MOVQ  (SP), AX\n  0x0054 00084 (b2.go:6)  MOVQ  AX, \"\".c(SB)\n  0x005b 00091 (b2.go:5)  CALL  \"\".f(SB)\n  0x0060 00096 (b2.go:5)  MOVQ  (SP), AX\n  0x0064 00100 (b2.go:5)  MOVQ  AX, \"\".b(SB)\n  0x006b 00107 (b2.go:4)  MOVQ  \"\".c(SB), CX\n  0x0072 00114 (b2.go:4)  ADDQ  CX, AX\n  0x0075 00117 (b2.go:4)  MOVQ  AX, \"\".a(SB)\n</code></pre>\n\n<p>( to generate this output I used <code>go tool compile -S -N abcd.go &gt; abcd.s</code>\nThe actual code line numbering is from a slightly simplified version with the fmt import and print statements removed )</p>\n\n<p>this is with go version go1.11.4 linux/amd64</p>\n\n<p>Tried the same with go version go1.12.4 linux/amd64, with the same result</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 10221804, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oFZn0.png?s=128&g=1", "display_name": "Rach", "link": "https://stackoverflow.com/users/10221804/rach"}, "is_accepted": false, "score": 0, "last_activity_date": 1598870113, "last_edit_date": 1598870113, "creation_date": 1598869710, "answer_id": 63669066, "question_id": 55887963, "link": "https://stackoverflow.com/questions/55887963/is-there-an-error-on-variable-initialization/63669066#63669066", "title": "Is there an error on variable initialization", "body": "<p><strong>TL;DR</strong> - Yes, there is an error in your output. Here is the code running with the output you expect: <a href=\"https://play.golang.org/p/bNUISdsPKyU\" rel=\"nofollow noreferrer\">https://play.golang.org/p/bNUISdsPKyU</a></p>\n<p>Some background. The variables are initialized in the order <code>d, b, c, a</code>. If a variable refers to another uninitialized variable, Go defers initialisation until it knows about the uninitialised variable referenced.</p>\n<p>At each step of the variable initialisation process ask: <em>is this variable ready for initialisation?</em></p>\n<p>How can we tell?</p>\n<blockquote>\n<p>...a package-level variable is considered\u00a0ready for initialization\u00a0if it is not yet initialized and either has no\u00a0initialization expression\u00a0or its initialization expression has no\u00a0dependencies\u00a0on uninitialized variables\u2026 Dependency analysis does not rely on the actual values of the variables, only on lexical\u00a0references\u00a0to them in the source, analyzed transitively.</p>\n</blockquote>\n<p>So, if <code>var a = b</code>, we won\u2019t initialise <code>a</code> until we have initialized <code>b</code>.</p>\n<p>Let's talk through the first variable in the example code\u2026</p>\n<pre><code>var (\n    a = c + b\n    // Is this var ready for initialisation? \n    // No. It depends on uninitialized variables `c` and `b`.\n    // Go initialization will skip this var until it knows about its dependencies \n</code></pre>\n<p>Repeat this process with the remaining variables and you\u2019ll get the same result as the Go compiler.</p>\n<p>A conceptual summary of the steps:</p>\n<pre><code>1. Try initialise `a`. It depends on uninitialized `b` and `c`. Skip!\n2. Try initialise `b`. It depends on uninitialized `d`. Skip!\n3. Try initialise `c`. It depends on uninitialized `d`. Skip!\n4. Try initialise `d`. Success!\n5. Try initialise `a`. It depends on uninitialized `b` and `c`. Skip!\n6. Try initialise `b`. Success!\n7. Try initialise `c`. Success!\n8. Try initialise `a`. Success!\n</code></pre>\n<p>Notice the order of the steps announcing &quot;Success!&quot;: <code>d, b, c, a</code></p>\n"}], "owner": {"reputation": 71, "user_id": 5406062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d1505da5584234bd21e9c621295e77f?s=128&d=identicon&r=PG&f=1", "display_name": "terryding77", "link": "https://stackoverflow.com/users/5406062/terryding77"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 152, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1598870113, "creation_date": 1556435971, "question_id": 55887963, "link": "https://stackoverflow.com/questions/55887963/is-there-an-error-on-variable-initialization", "title": "Is there an error on variable initialization", "body": "<p>as the <a href=\"https://golang.org/ref/spec#Package_initialization\" rel=\"noreferrer\">spec of golang</a>, I try to write test code.\nas the spec says, the init order is <strong>d,b,c,a</strong>, I think the <strong>b should be 4 and c should be 5</strong>, but I got <strong>b == 5 and c == 4</strong> is there something wrong? or I misunderstand the spec\uff1f</p>\n\n<p>I tried in go version as below</p>\n\n<pre><code>go version go1.12.4 linux/amd64\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nvar (\n    a = c + b\n    b = f()\n    c = f()\n    d = 3\n)\n\nfunc f() int {\n    d++\n    return d\n}\n\nfunc main() {\n    fmt.Println(\"a\", a)\n    fmt.Println(\"b\", b)\n    fmt.Println(\"c\", c)\n    fmt.Println(\"d\", d)\n}\n\n</code></pre>\n\n<p>the result is </p>\n\n<pre><code>result:\na 9\nb 5\nc 4\nd 5\n</code></pre>\n\n<p>expect\nb = 4, c = 5</p>\n"}, {"tags": ["go", "sdk", "couchbase", "gocb"], "answers": [{"tags": [], "owner": {"reputation": 754, "user_id": 497677, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5b903e474a608780f86aed033c61bf9e?s=128&d=identicon&r=PG", "display_name": "chvck", "link": "https://stackoverflow.com/users/497677/chvck"}, "is_accepted": false, "score": 1, "last_activity_date": 1556525089, "creation_date": 1556525089, "answer_id": 55899236, "question_id": 55887601, "link": "https://stackoverflow.com/questions/55887601/any-example-for-combining-geo-location-search-query-with-distance-filter-sorting/55899236#55899236", "title": "Any example for combining geo location search query with distance filter/sorting?", "body": "<p>I've answered at <a href=\"https://forums.couchbase.com/t/any-example-for-combining-geo-location-search-query-with-distance-filter-sorting/21155\" rel=\"nofollow noreferrer\">https://forums.couchbase.com/t/any-example-for-combining-geo-location-search-query-with-distance-filter-sorting/21155</a> but just to put all the info here too:</p>\n\n<p>I think that the issue here is that you\u2019re trying to use sort order as a query, rather than as sorting criteria. I think that what you want is probably <code>gocb.NewSearchQuery(indexName, location).Sort(sort)</code> . This will take the sort criteria and put it into the JSON request under the <code>sort</code> field, as you can see in our documentation.</p>\n"}], "owner": {"reputation": 971, "user_id": 2202757, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/U5NGN.jpg?s=128&g=1", "display_name": "sh0umik", "link": "https://stackoverflow.com/users/2202757/sh0umik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1556525089, "creation_date": 1556432725, "question_id": 55887601, "link": "https://stackoverflow.com/questions/55887601/any-example-for-combining-geo-location-search-query-with-distance-filter-sorting", "title": "Any example for combining geo location search query with distance filter/sorting?", "body": "<p>I am using gocb to query documents based on geo location . So far  <code>NewGeoDistanceQuery</code> works well with the index. Now i need to sort the result based on geo location distance . According to the doc in <a href=\"https://docs.couchbase.com/server/6.0/fts/fts-geospatial-queries.html\" rel=\"nofollow noreferrer\">here</a>  , it says i need to pass sort parameter inside the query! but the <code>NewGeoDistanceQuery</code> doesnt have that. So searched the sdk and found <code>NewSearchSortGeoDistance</code> that is exactly what i was looking for but I am confused on how to combine them. </p>\n\n<pre><code>    location := cbft.NewGeoDistanceQuery(in.Lat, in.Lon, fmt.Sprintf(\"%skm\", in.Distance))\n    sort := cbft.NewSearchSortGeoDistance(\"address\", in.Lat, in.Lon).Unit(\"km\")\n    conjunctionQuery = cbft.NewConjunctionQuery(location, sort)\n</code></pre>\n\n<p>I tried the solution above but got this error</p>\n\n<pre><code>{\"error\":\"rest_index: Query, indexName: restaurant-geo-search, err: bleve: QueryBleve parsing searchRequest, err: unknown query type\",\"request\":{\"ctl\":{\"timeout\":75000},\"query\":{\"conjuncts\":[{\"distance\":\"2km\",\"location\":[90.404272,23.793993]},{\"by\":\"geo_distance\",\"field\":\"address\",\"location\":[90.404272,23.793993],\"unit\":\"km\"}]},\"size\":100},\"status\":\"fail\"}\n</code></pre>\n\n<p>I have also tried to use the <code>NewSearchSortGeoDistance</code> alone but same error. Any help on this ?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "edited": false, "score": 0, "creation_date": 1556420614, "post_id": 55886649, "comment_id": 98431062, "body": "Ok thx, so I can conclude that indeed does lines have no purpose right? Even for a transition package and can be removed?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "edited": false, "score": 0, "creation_date": 1556420834, "post_id": 55886649, "comment_id": 98431079, "body": "@GertCuykens: No. They have a purpose. I&#39;m only interested in the final version."}, {"owner": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "edited": false, "score": 0, "creation_date": 1556421321, "post_id": 55886649, "comment_id": 98431127, "body": "Thx ps <a href=\"https://go.googlesource.com/go/+/refs/heads/master/src/errors\" rel=\"nofollow noreferrer\">go.googlesource.com/go/+/refs/heads/master/src/errors</a> the final version doesn&#39;t have does tests, or am I looking at the wrong place?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "edited": false, "score": 0, "creation_date": 1556421695, "post_id": 55886649, "comment_id": 98431169, "body": "@GertCuykens: <code>xerrors</code> is the transition package. Go1.13 <code>errors</code> is the final package. Obviously, the transition package contains some code that is only necessary for the transition."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1556421770, "last_edit_date": 1556421770, "creation_date": 1556420432, "answer_id": 55886649, "question_id": 55886622, "link": "https://stackoverflow.com/questions/55886622/var-xerrors-formatter-wrapped/55886649#55886649", "title": "var _ xerrors.Formatter = wrapped{}", "body": "<blockquote>\n  <p><a href=\"https://github.com/golang/xerrors\" rel=\"nofollow noreferrer\">https://github.com/golang/xerrors</a></p>\n  \n  <p>This repository holds the transition packages for the new Go 1.13\n  error values.</p>\n</blockquote>\n\n<hr>\n\n<p>Look at the Go source tip for the actual implementation for Go1.13.</p>\n\n<p><a href=\"https://go.googlesource.com/go\" rel=\"nofollow noreferrer\">https://go.googlesource.com/go</a></p>\n\n<hr>\n\n<p>Compile time checks that they satisfy <code>xerrors.Formatter</code>.</p>\n\n<pre><code>var _ xerrors.Formatter = wrapped{}\n\nvar _ xerrors.Formatter = detailed{}\n</code></pre>\n"}], "owner": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "closed_date": 1556449714, "accepted_answer_id": 55886649, "answer_count": 1, "score": -1, "last_activity_date": 1558629776, "creation_date": 1556420078, "last_edit_date": 1558629776, "question_id": 55886622, "link": "https://stackoverflow.com/questions/55886622/var-xerrors-formatter-wrapped", "closed_reason": "Duplicate", "title": "var _ xerrors.Formatter = wrapped{}", "body": "<p><a href=\"https://github.com/golang/xerrors/blob/master/fmt_test.go#L379\" rel=\"nofollow noreferrer\">https://github.com/golang/xerrors/blob/master/fmt_test.go#L379</a></p>\n\n<pre><code>var _ xerrors.Formatter = wrapped{}\n\nvar _ xerrors.Formatter = detailed{}\n</code></pre>\n\n<p>What is the purpose of this two lines?</p>\n"}, {"tags": ["azure", "go", "blob"], "answers": [{"tags": [], "owner": {"reputation": 20467, "user_id": 4989676, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jP8H6.jpg?s=128&g=1", "display_name": "Peter Pan", "link": "https://stackoverflow.com/users/4989676/peter-pan"}, "is_accepted": true, "score": 1, "last_activity_date": 1556525102, "creation_date": 1556525102, "answer_id": 55899242, "question_id": 55886552, "link": "https://stackoverflow.com/questions/55886552/can-i-set-the-access-tier-when-i-upload-a-blob-if-yes-then-how-to-do-that/55899242#55899242", "title": "Can I set the access tier when I upload a blob? If yes, then how to do that?", "body": "<p>The short answer is No. According to the offical REST API reference, the blob operation you want is that to do via two REST APIs <a href=\"https://docs.microsoft.com/en-us/rest/api/storageservices/put-blob\" rel=\"nofollow noreferrer\"><code>Put Blob</code></a> and <a href=\"https://docs.microsoft.com/en-us/rest/api/storageservices/set-blob-tier\" rel=\"nofollow noreferrer\"><code>Set Blob Tier</code></a>. Actually, all SDK APIs for different languages are implemented by wrapping the related REST APIs.</p>\n\n<p>Except for Page Blob, you can set the header <code>x-ms-access-tier</code> in your operation request to do your want, as below.</p>\n\n<p><a href=\"https://i.stack.imgur.com/ycHwK.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ycHwK.png\" alt=\"enter image description here\"></a></p>\n\n<p>For Block Blob, the operations in two steps are necessary, and can not be merged.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 12657839, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20e2687a05bd89725175659dc2626307?s=128&d=identicon&r=PG&f=1", "display_name": "Network", "link": "https://stackoverflow.com/users/12657839/network"}, "is_accepted": false, "score": 0, "last_activity_date": 1578252526, "creation_date": 1578252526, "answer_id": 59603459, "question_id": 55886552, "link": "https://stackoverflow.com/questions/55886552/can-i-set-the-access-tier-when-i-upload-a-blob-if-yes-then-how-to-do-that/59603459#59603459", "title": "Can I set the access tier when I upload a blob? If yes, then how to do that?", "body": "<p>It is now possible using the new x-ms-access-tier header:</p>\n\n<p><a href=\"https://docs.microsoft.com/en-us/rest/api/storageservices/set-blob-tier\" rel=\"nofollow noreferrer\">x-ms-access-tier</a></p>\n\n<p><a href=\"https://docs.microsoft.com/en-us/azure/storage/common/storage-rest-api-auth\" rel=\"nofollow noreferrer\">REST API with auth</a></p>\n\n<pre><code>using System;\nusing System.Collections.Generic;\nusing System.IO;\nusing System.Linq;\nusing System.Net.Http;\nusing System.Net.Http.Headers;\nusing System.Net.Mime;\nusing System.Security.Cryptography;\nusing System.Text;\nusing System.Threading.Tasks;\n\nnamespace WhateverYourNameSpaceIs\n{\n    class Program\n    {\n        private const string StorageKey = @\"PutYourStorageKeyHere\";\n        private const string StorageAccount = \"PutYourStorageAccountHere\";\n        private const string ContainerName = \"PutYourContainerNameHere\";\n        private const string Method = \"PUT\";\n        private const string ContentType = MediaTypeNames.Image.Jpeg;\n        private static readonly string BlobStorageTier = StorageTier.Cool;\n        private static readonly List&lt;Tuple&lt;string, string&gt;&gt; HttpContentHeaders = new List&lt;Tuple&lt;string, string&gt;&gt;()\n        {\n            new Tuple&lt;string, string&gt;(\"x-ms-access-tier\", BlobStorageTier),\n            new Tuple&lt;string, string&gt;(\"x-ms-blob-type\", \"BlockBlob\"),\n            new Tuple&lt;string, string&gt;(\"x-ms-date\", DateTime.UtcNow.ToString(\"R\")),\n            new Tuple&lt;string, string&gt;(\"x-ms-version\", \"2018-11-09\"),\n            new Tuple&lt;string, string&gt;(\"Content-Type\", ContentType),\n        };\n        static async Task Main()\n        {\n            await UploadBlobToAzure(\"DestinationFileNameWithoutPath\", \"LocalFileNameWithPath\");\n        }\n        static async Task&lt;int&gt; UploadBlobToAzure(string blobName, string fileName)\n        {\n            int returnValue = (int)AzureCopyStatus.Unknown;\n            try\n            {\n                using var client = new HttpClient();\n                using var content = new ByteArrayContent(File.ReadAllBytes(fileName));\n                HttpContentHeaders.ForEach(x =&gt; content.Headers.Add(x.Item1, x.Item2));\n                var stringToSign = $\"{Method}\\n\\n\\n{content.Headers.ContentLength.Value}\\n\\n{ContentType}\\n\\n\\n\\n\\n\\n\\n\";\n                foreach (var httpContentHeader in HttpContentHeaders.Where(x =&gt; x.Item1 != \"Content-Type\").OrderBy(x =&gt; x.Item1))\n                    stringToSign += $\"{httpContentHeader.Item1.ToLower()}:{httpContentHeader.Item2}\\n\";\n                stringToSign += $\"/{StorageAccount}/{ContainerName}/{blobName}\";\n                HMACSHA256 hmac = new HMACSHA256(Convert.FromBase64String(StorageKey));\n                string signature = Convert.ToBase64String(hmac.ComputeHash(Encoding.UTF8.GetBytes(stringToSign)));\n                client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue(\"SharedKey\", $\"{StorageAccount}:{signature}\");\n                var httpResponse = await client.PutAsync($\"https://{StorageAccount}.blob.core.windows.net/{ContainerName}/{blobName}\", content);\n                returnValue = (int)httpResponse.StatusCode;\n            }\n            catch (IOException ioException)\n            {\n                Console.WriteLine(ioException.ToString());\n                returnValue = (int)AzureCopyStatus.FileNotFound;\n            }\n            catch (Exception exception)\n            {\n                Console.WriteLine(exception.ToString());\n                returnValue = (int)AzureCopyStatus.Error;\n            }\n            return returnValue;\n        }\n        internal enum AzureCopyStatus\n        {\n            Unknown = -1,\n            Error = 0,\n            FileNotFound = 2\n        }\n        internal static class StorageTier\n        {\n            internal static string Cool = \"Cool\";\n            internal static string Hot = \"Hot\";\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 11421549, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f50a9c3860d545777993f4b32697be0?s=128&d=identicon&r=PG&f=1", "display_name": "sfzeng", "link": "https://stackoverflow.com/users/11421549/sfzeng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 55899242, "answer_count": 2, "score": 3, "last_activity_date": 1578252526, "creation_date": 1556419109, "last_edit_date": 1556419272, "question_id": 55886552, "link": "https://stackoverflow.com/questions/55886552/can-i-set-the-access-tier-when-i-upload-a-blob-if-yes-then-how-to-do-that", "title": "Can I set the access tier when I upload a blob? If yes, then how to do that?", "body": "<p>I did not find any way to set the access tier of a blob when I upload it, I know I can set a blob's access tier after I uploaded it, but I just want to know if I can upload the blob and set it's access tier in only one step. And if there is any golang API to do that?</p>\n\n<p>I googled it but I got nothing helpful till now.</p>\n\n<p>Here is what I did now, I mean upload it and then set it's access tier.</p>\n\n<pre><code>// Here's how to upload a blob.\nblobURL := containerURL.NewBlockBlobURL(fileName)\nctx := context.Background()\n_, err = azblob.UploadBufferToBlockBlob(ctx, data, blobURL, azblob.UploadToBlockBlobOptions{})\nhandleErrors(err)\n\n//set tier\n_, err = blobURL.SetTier(ctx, azblob.AccessTierCool, azblob.LeaseAccessConditions{})\nhandleErrors(err)\n</code></pre>\n\n<p>But I want to upload a blob and set it's tier in one step, not two steps as I do now.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1556469554, "post_id": 55886506, "comment_id": 98441497, "body": "please re-read the OP&#39;s last sentence. You correctly addressed the fact that the function is fulfilling an interface - but the OP is asking why <code>next</code> is in the function signature. Yes, it&#39;s in the interface signature - but it does not <i>have</i> to be. e.g. <a href=\"https://play.golang.org/p/jJ42HdlGJYT\" rel=\"nofollow noreferrer\">play.golang.org/p/jJ42HdlGJYT</a>"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1556419470, "last_edit_date": 1556419470, "creation_date": 1556418300, "answer_id": 55886506, "question_id": 55886460, "link": "https://stackoverflow.com/questions/55886460/func-e-errorstring-formaterrorp-printer-next-error/55886506#55886506", "title": "func (e *errorString) FormatError(p Printer) (next error)", "body": "<blockquote>\n  <p>What is then the purpose of next?</p>\n</blockquote>\n\n<hr>\n\n<p>The <code>FormatError(p Printer) (next error)</code> method satisfies an interface.</p>\n\n<pre><code>// A Formatter formats error messages.\ntype Formatter interface {\n    error\n\n    // FormatError prints the receiver's first error and returns the next error in\n    // the error chain, if any.\n    FormatError(p Printer) (next error)\n}\n</code></pre>\n\n<p>Sometimes we do return a non-nil error.</p>\n\n<pre><code>func (e *noWrapError) FormatError(p Printer) (next error) {\n    p.Print(e.msg)\n    e.frame.Format(p)\n    return e.err\n}\n</code></pre>\n"}], "owner": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 1, "accepted_answer_id": 55886506, "answer_count": 1, "score": 3, "last_activity_date": 1556419470, "creation_date": 1556417500, "question_id": 55886460, "link": "https://stackoverflow.com/questions/55886460/func-e-errorstring-formaterrorp-printer-next-error", "title": "func (e *errorString) FormatError(p Printer) (next error)", "body": "<p><a href=\"https://github.com/golang/xerrors/blob/master/errors.go#L29:47\" rel=\"nofollow noreferrer\">https://github.com/golang/xerrors/blob/master/errors.go#L29:47</a></p>\n\n<pre><code>func (e *errorString) FormatError(p Printer) (next error) {\n    p.Print(e.s)\n    e.frame.Format(p)\n    return nil\n}\n</code></pre>\n\n<p>If am not mistaken this always returns <code>nil</code> right ? What is then the purpose of <code>next</code> if it's always <code>nil</code> ?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1556406420, "last_edit_date": 1556406420, "creation_date": 1556403294, "answer_id": 55885318, "question_id": 55885290, "link": "https://stackoverflow.com/questions/55885290/limit-duration-granularity/55885318#55885318", "title": "Limit Duration granularity", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/time/\" rel=\"nofollow noreferrer\">Package time</a></p>\n\n<pre><code>import \"time\"\n</code></pre>\n  \n  <p><a href=\"https://golang.org/pkg/time/#Duration.Round\" rel=\"nofollow noreferrer\">func (Duration) Round</a> 1.9</p>\n  \n  <p><code>func (d Duration) Round(m Duration) Duration</code></p>\n  \n  <p>Round returns the result of rounding d to the nearest multiple of m.\n  The rounding behavior for halfway values is to round away from zero.\n  If the result exceeds the maximum (or minimum) value that can be\n  stored in a Duration, Round returns the maximum (or minimum) duration.\n  If m &lt;= 0, Round returns d unchanged. </p>\n  \n  <p><a href=\"https://golang.org/pkg/time/#Duration.Truncate\" rel=\"nofollow noreferrer\">func (Duration) Truncate</a> 1.9</p>\n  \n  <p><code>func (d Duration) Truncate(m Duration) Duration</code></p>\n  \n  <p>Truncate returns the result of rounding d toward zero to a multiple of\n  m. If m &lt;= 0, Truncate returns d unchanged.</p>\n</blockquote>\n\n<hr>\n\n<p>Use the <code>Round</code> or <code>Truncate</code> methods on the <code>time.Duration</code>.</p>\n\n<hr>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    d, err := time.ParseDuration(\"1m30.789260489s\")\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(d)\n    fmt.Println(d.Round(10 * time.Millisecond))\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/8b3xAxfSE90\" rel=\"nofollow noreferrer\">https://play.golang.org/p/8b3xAxfSE90</a></p>\n\n<p>Output:</p>\n\n<pre><code>1m30.789260489s\n1m30.79s\n</code></pre>\n"}], "owner": {"reputation": 1283, "user_id": 3246078, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/6a7de53a68c0e67d9b9cbcea5d6e5581?s=128&d=identicon&r=PG&f=1", "display_name": "HH- Apologize to Carole Baskin", "link": "https://stackoverflow.com/users/3246078/hh-apologize-to-carole-baskin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 1, "accepted_answer_id": 55885318, "answer_count": 1, "score": 1, "last_activity_date": 1556406420, "creation_date": 1556403068, "question_id": 55885290, "link": "https://stackoverflow.com/questions/55885290/limit-duration-granularity", "title": "Limit Duration granularity", "body": "<p>I've calculated a Duration by subtracting a saved time from the current time:\n<code>time.Now().Sub(oldTime)</code></p>\n\n<p>Printing it gives me this:\n<code>1m30.789260489s</code></p>\n\n<p>1m30.79s would look better, where I'm using it.  How can I truncate / reduce the granularity of a Duration in Go?</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 6405, "user_id": 3166160, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9054f030b0058573a8338340e6347da8?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Lambert", "link": "https://stackoverflow.com/users/3166160/jacob-lambert"}, "edited": false, "score": 0, "creation_date": 1556422819, "post_id": 55884054, "comment_id": 98431304, "body": "What are you hoping to do with the connection state? Maybe if we had a better idea of what you are wanting to do with it we may have some better ideas. As for what you have, the only improvement I would make is to implement a <code>sync.Map</code> (<a href=\"https://golang.org/pkg/sync/#Map\" rel=\"nofollow noreferrer\">golang.org/pkg/sync/#Map</a>) instead of a regular <code>map</code>."}, {"owner": {"reputation": 302, "user_id": 7659655, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef9b88e3cd11c83af507b890d4ce7f06?s=128&d=identicon&r=PG&f=1", "display_name": "Roman Alexandrovich", "link": "https://stackoverflow.com/users/7659655/roman-alexandrovich"}, "reply_to_user": {"reputation": 6405, "user_id": 3166160, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9054f030b0058573a8338340e6347da8?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Lambert", "link": "https://stackoverflow.com/users/3166160/jacob-lambert"}, "edited": false, "score": 0, "creation_date": 1556435533, "post_id": 55884054, "comment_id": 98433175, "body": "What am I doing with connection state? As u see I have a global map to keep track of all connections, remote address as key(because it&#39;s unique for each connection) and connection state as value. So I added <code>ConnState</code> callback to server, which will be called each time state of connection is changed, using it I support this map of connections. And the main thing, detection of failed connection. As u see I check if current state is closed and the previous one was open - failed http connection, because there was no <code>http.StateActive</code> state."}, {"owner": {"reputation": 6405, "user_id": 3166160, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9054f030b0058573a8338340e6347da8?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Lambert", "link": "https://stackoverflow.com/users/3166160/jacob-lambert"}, "edited": false, "score": 0, "creation_date": 1556459626, "post_id": 55884054, "comment_id": 98438723, "body": "What I am asking is what are you ultimately wanting to do with this information? Are you just logging it? Are you wanting to perform a time sensitive operation based upon the state or can what you are wanting to do be delayed a bit? I can see that you are presently just logging."}, {"owner": {"reputation": 302, "user_id": 7659655, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef9b88e3cd11c83af507b890d4ce7f06?s=128&d=identicon&r=PG&f=1", "display_name": "Roman Alexandrovich", "link": "https://stackoverflow.com/users/7659655/roman-alexandrovich"}, "reply_to_user": {"reputation": 6405, "user_id": 3166160, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9054f030b0058573a8338340e6347da8?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Lambert", "link": "https://stackoverflow.com/users/3166160/jacob-lambert"}, "edited": false, "score": 0, "creation_date": 1556462770, "post_id": 55884054, "comment_id": 98439609, "body": "yeah, I just wanna log such event."}], "answers": [{"tags": [], "owner": {"reputation": 86, "user_id": 5715068, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-o9dzJNgSvKE/AAAAAAAAAAI/AAAAAAAAAQ0/14GkM4SsL8M/photo.jpg?sz=128", "display_name": "Bogdan Daragan", "link": "https://stackoverflow.com/users/5715068/bogdan-daragan"}, "is_accepted": false, "score": 0, "last_activity_date": 1556536332, "creation_date": 1556536332, "answer_id": 55902142, "question_id": 55884054, "link": "https://stackoverflow.com/questions/55884054/detect-failed-http-connections-in-go/55902142#55902142", "title": "Detect failed http connections in go", "body": "<p>If you only need to have logs you can even simplify the code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>srv := &amp;http.Server{\n        Addr: \":8080\",\n        ConnState: func(conn net.Conn, event http.ConnState) {\n            log.Printf(\"addr: %s, changed state to: %s\", conn.RemoteAddr(), event.String())\n        },\n    }\n</code></pre>\n\n<p>That callback will be triggered on each change of the <code>conn</code></p>\n"}, {"comments": [{"owner": {"reputation": 302, "user_id": 7659655, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef9b88e3cd11c83af507b890d4ce7f06?s=128&d=identicon&r=PG&f=1", "display_name": "Roman Alexandrovich", "link": "https://stackoverflow.com/users/7659655/roman-alexandrovich"}, "edited": false, "score": 0, "creation_date": 1556545418, "post_id": 55903215, "comment_id": 98464835, "body": "The main problem with ur solution, that handler is going to be called only when user has finished writing data to connection and waiting for response, so u will be able to detect case, when user has disconnected in time when server processes request, but not in time when user is writing data to opened connection and actually this is what I need to detect. But anyway, ur code snippet is really useful, thank u."}, {"owner": {"reputation": 302, "user_id": 7659655, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef9b88e3cd11c83af507b890d4ce7f06?s=128&d=identicon&r=PG&f=1", "display_name": "Roman Alexandrovich", "link": "https://stackoverflow.com/users/7659655/roman-alexandrovich"}, "edited": false, "score": 0, "creation_date": 1556546255, "post_id": 55903215, "comment_id": 98465341, "body": "I only do not understand why did u pass channel as argument to handler function, can u clarify this please?"}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "reply_to_user": {"reputation": 302, "user_id": 7659655, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef9b88e3cd11c83af507b890d4ce7f06?s=128&d=identicon&r=PG&f=1", "display_name": "Roman Alexandrovich", "link": "https://stackoverflow.com/users/7659655/roman-alexandrovich"}, "edited": false, "score": 0, "creation_date": 1556547463, "post_id": 55903215, "comment_id": 98466052, "body": "Hi @RomanAlexandrovich, this could explain it better <a href=\"https://stackoverflow.com/a/30183888/1135424\">stackoverflow.com/a/30183888/1135424</a>, however, in this case, it can be  omitted, I updated the answer"}], "tags": [], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "is_accepted": false, "score": 1, "last_activity_date": 1556547484, "last_edit_date": 1556547484, "creation_date": 1556540205, "answer_id": 55903215, "question_id": 55884054, "link": "https://stackoverflow.com/questions/55884054/detect-failed-http-connections-in-go/55903215#55903215", "title": "Detect failed http connections in go", "body": "<p>You could use <a href=\"https://golang.org/pkg/context/\" rel=\"nofollow noreferrer\">context</a> within your handler, for example, this would detect when the client disconnects and return and <code>http.StatusPartialContent</code> besides calling <code>someCleanup()</code> in where you could have your logging logic. </p>\n\n<p><a href=\"https://play.golang.org/p/5Yr_HBuyiZW\" rel=\"nofollow noreferrer\">https://play.golang.org/p/5Yr_HBuyiZW</a></p>\n\n<pre><code>func helloWorld(w http.ResponseWriter, r *http.Request) {\n    ctx := r.Context()\n\n    ch := make(chan struct{})\n\n    go func() {\n            time.Sleep(5 * time.Second)\n            fmt.Fprintln(w, \"Hello World!\")\n            ch &lt;- struct{}{}\n    }()\n\n    select {\n    case &lt;-ch:\n    case &lt;-ctx.Done():\n            http.Error(w, ctx.Err().Error(), http.StatusPartialContent)\n            someCleanUP()\n    }\n</code></pre>\n\n<p>}</p>\n"}], "owner": {"reputation": 302, "user_id": 7659655, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef9b88e3cd11c83af507b890d4ce7f06?s=128&d=identicon&r=PG&f=1", "display_name": "Roman Alexandrovich", "link": "https://stackoverflow.com/users/7659655/roman-alexandrovich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 981, "favorite_count": 1, "answer_count": 2, "score": 3, "last_activity_date": 1556547484, "creation_date": 1556392764, "last_edit_date": 1556441631, "question_id": 55884054, "link": "https://stackoverflow.com/questions/55884054/detect-failed-http-connections-in-go", "title": "Detect failed http connections in go", "body": "<p>Let's suppose client uploads heavy image by http with slow internet connection, he opens connection to server, starts to write data and suddenly he loses this connection because of network problems. How can I detect this on server if handler function was not yet called. The solution I found is to check the connection state. But the problem is that it's not scalable, because a lot of goroutines will interact with global variable. Are there any more elegant solutions?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net\"\n    \"net/http\"\n)\n\n// current state of connections\nvar connStates = make(map[string]http.ConnState)\n\nfunc main() {\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        fmt.Println(\"got new request\")\n        fmt.Println(connStates)\n    })\n\n    srv := &amp;http.Server{\n        Addr: \":8080\",\n        ConnState: func(conn net.Conn, event http.ConnState) {\n            if event != http.StateClosed {\n                connStates[conn.RemoteAddr().String()] = event\n            } else {\n                if connStates[conn.RemoteAddr().String()] == http.StateActive {\n                    fmt.Println(\"client cancelled request\")\n                }\n                delete(connStates, conn.RemoteAddr().String())\n            }\n        },\n    }\n    log.Fatal(srv.ListenAndServe())\n}\n\n</code></pre>\n"}, {"tags": ["http", "go", "server", "trace"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1556389022, "last_edit_date": 1556389022, "creation_date": 1556387775, "answer_id": 55883353, "question_id": 55883292, "link": "https://stackoverflow.com/questions/55883292/http-tracing-from-server-perspective/55883353#55883353", "title": "HTTP Tracing from server perspective", "body": "<p>Support for server-side tracing was added a lot earlier, in <a href=\"https://golang.org/doc/go1.3#minor_library_changes\" rel=\"nofollow noreferrer\">Go 1.3</a>. Create your own <a href=\"https://golang.org/pkg/net/http/#Server\" rel=\"nofollow noreferrer\"><code>http.Server</code></a>, and set a callback function in the <code>Server.ConnState</code> field.</p>\n\n<pre><code>// ConnState specifies an optional callback function that is\n// called when a client connection changes state. See the\n// ConnState type and associated constants for details.\nConnState func(net.Conn, ConnState) // Go 1.3\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/net/http/#ConnState\" rel=\"nofollow noreferrer\"><code>http.ConnState</code></a> details when / what connection states the callback is notified about.</p>\n\n<pre><code>// StateNew represents a new connection that is expected to\n// send a request immediately. Connections begin at this\n// state and then transition to either StateActive or\n// StateClosed.\nStateNew ConnState = iota\n\n// StateActive represents a connection that has read 1 or more\n// bytes of a request. The Server.ConnState hook for\n// StateActive fires before the request has entered a handler\n// and doesn't fire again until the request has been\n// handled. After the request is handled, the state\n// transitions to StateClosed, StateHijacked, or StateIdle.\n// For HTTP/2, StateActive fires on the transition from zero\n// to one active request, and only transitions away once all\n// active requests are complete. That means that ConnState\n// cannot be used to do per-request work; ConnState only notes\n// the overall state of the connection.\nStateActive\n\n// StateIdle represents a connection that has finished\n// handling a request and is in the keep-alive state, waiting\n// for a new request. Connections transition from StateIdle\n// to either StateActive or StateClosed.\nStateIdle\n\n// StateHijacked represents a hijacked connection.\n// This is a terminal state. It does not transition to StateClosed.\nStateHijacked\n\n// StateClosed represents a closed connection.\n// This is a terminal state. Hijacked connections do not\n// transition to StateClosed.\nStateClosed\n</code></pre>\n\n<p>A simple example:</p>\n\n<pre><code>srv := &amp;http.Server{\n    Addr: \":8080\",\n    ConnState: func(conn net.Conn, cs http.ConnState) {\n        fmt.Println(\"Client:\", conn.RemoteAddr(), \"- new state:\", cs)\n    },\n}\nlog.Fatal(srv.ListenAndServe())\n</code></pre>\n\n<p>Making a request to the above server:</p>\n\n<pre><code>curl localhost:8080\n</code></pre>\n\n<p>Server output will be:</p>\n\n<pre><code>Client: 127.0.0.1:39778 - new state: new\nClient: 127.0.0.1:39778 - new state: active\nClient: 127.0.0.1:39778 - new state: idle\nClient: 127.0.0.1:39778 - new state: closed\n</code></pre>\n"}], "owner": {"reputation": 302, "user_id": 7659655, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef9b88e3cd11c83af507b890d4ce7f06?s=128&d=identicon&r=PG&f=1", "display_name": "Roman Alexandrovich", "link": "https://stackoverflow.com/users/7659655/roman-alexandrovich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 0, "accepted_answer_id": 55883353, "answer_count": 1, "score": 2, "last_activity_date": 1556389022, "creation_date": 1556387222, "last_edit_date": 1556388248, "question_id": 55883292, "link": "https://stackoverflow.com/questions/55883292/http-tracing-from-server-perspective", "title": "HTTP Tracing from server perspective", "body": "<p>In Go 1.7 http tracing was introduced, but it works only from client perspective. Is it possible somehow trace request from server perspective, I mean I want to add some hooks, for example when connection was established. Should it be implemented as middleware or what?</p>\n\n<pre><code>http.HandlerFunc(func(w http.ResponseWriter, r *http.Request)\n</code></pre>\n"}, {"tags": ["go", "testing", "webassembly"], "answers": [{"tags": [], "owner": {"reputation": 1648, "user_id": 252525, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/422a06312e3faa6319f5787370438194?s=128&d=identicon&r=PG", "display_name": "jonathanberi", "link": "https://stackoverflow.com/users/252525/jonathanberi"}, "is_accepted": true, "score": 3, "last_activity_date": 1556379650, "creation_date": 1556379650, "answer_id": 55882179, "question_id": 55880920, "link": "https://stackoverflow.com/questions/55880920/dial-tcp-protocol-not-available-go-webassembly-test/55882179#55882179", "title": "dial tcp: Protocol not available go webassembly test", "body": "<p>The MVP release was exclusively targeting running WASM in the browser. As such, the browser APIs do not allow arbitrary TCP/IP connections and therefore WASM is equally limited. That said, WASM has always had ambitions to go beyond the browser. The latest initiative called <a href=\"https://hacks.mozilla.org/2019/03/standardizing-wasi-a-webassembly-system-interface/\" rel=\"nofollow noreferrer\">WASI</a> will add features required to be used outside the browser, like File I/O and networking primitives.</p>\n"}], "owner": {"reputation": 43, "user_id": 11419646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfed801211fbc325c38255d6a5af1187?s=128&d=identicon&r=PG&f=1", "display_name": "blade_1", "link": "https://stackoverflow.com/users/11419646/blade-1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 461, "favorite_count": 0, "accepted_answer_id": 55882179, "answer_count": 1, "score": 3, "last_activity_date": 1556379650, "creation_date": 1556370775, "question_id": 55880920, "link": "https://stackoverflow.com/questions/55880920/dial-tcp-protocol-not-available-go-webassembly-test", "title": "dial tcp: Protocol not available go webassembly test", "body": "<p>Attempting to go test a web-assembly function which fires an POST request.</p>\n\n<p>Receive the following error:</p>\n\n<pre><code>firePing_test.go:40: ERROR ON POST REQUEST: Post https://not-the-real-api.execute-api.us-east-1.amazonaws.com/testing: dial tcp: Protocol not available\n</code></pre>\n\n<p>Running: \nUbuntu 18.04.2 LTS\ngo version go1.12.2 linux/amd64</p>\n\n<p>I've tested that the function is valid and will send a request when executing in chrome. \nTest also passes when compiled for linux/amd64.</p>\n\n<p>Problem Function:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// FirePing fires a ping\nfunc FirePing(protocol *string, domain *string, params *map[string]string) (*http.Response, error) {\n\n    // Marshal map into POST request body\n    reqBody, err := json.Marshal(*params)\n    if err != nil {\n        return  nil, fmt.Errorf(\"ERROR ON MARSHAL OF PARAMS: %v\", err)\n    }\n\n    // Send POST request\n    req, err := http.NewRequest(\"POST\", *protocol + \"://\" + *domain, bytes.NewBuffer(reqBody))\n    if err != nil {\n        return  nil, fmt.Errorf(\"ERROR ON FORMING REQUEST: %v\", err)\n    }\n    client := &amp;http.Client{}\n    resp, err := client.Do(req)\n    if err != nil {\n        return nil,fmt.Errorf(\"ERROR ON POST REQUEST: %v\",err)\n    }\n\n    return resp, nil\n}\n</code></pre>\n\n<p>Problem Test Function Call:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// FirePing and receive response\n    resp, err := FirePing(&amp;config.Config.Protocol, &amp;config.Config.Domain, &amp;m)\n    if err != nil {\n        t.Error(err)\n        return\n    }\n</code></pre>\n\n<p>Should pass this test case as it performs the function call fine in the browser.</p>\n\n<p>Only other place I have seen this is:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/30664557/http-get-returns-protocol-not-available-error\">http.Get returns Protocol not available error</a></p>\n\n<p>Which seams to be from playground disabling tcp connections. I am running this test locally</p>\n"}, {"tags": ["go", "floating-point"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1556370737, "post_id": 55880818, "comment_id": 98420508, "body": "<code>*price * float32(volume)</code>"}, {"owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "edited": false, "score": 0, "creation_date": 1556371352, "post_id": 55880818, "comment_id": 98420685, "body": "Why pointer to float32 ?"}, {"owner": {"reputation": 83, "user_id": 5859520, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/321011a9f4b82153756d578eb6f2b5d8?s=128&d=identicon&r=PG&f=1", "display_name": "mr r.", "link": "https://stackoverflow.com/users/5859520/mr-r"}, "edited": false, "score": 0, "creation_date": 1556371401, "post_id": 55880818, "comment_id": 98420698, "body": "mkopriva, thx for the answer but I get the error message: <code>cannot use *price * float32(volume) (type float32) as type *float32 in assignment</code>"}, {"owner": {"reputation": 83, "user_id": 5859520, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/321011a9f4b82153756d578eb6f2b5d8?s=128&d=identicon&r=PG&f=1", "display_name": "mr r.", "link": "https://stackoverflow.com/users/5859520/mr-r"}, "edited": false, "score": 1, "creation_date": 1556371464, "post_id": 55880818, "comment_id": 98420720, "body": "mostafa, I can have a nullable price in my database"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1556372204, "post_id": 55880818, "comment_id": 98420920, "body": "You never want to use floats for price data, especially float32 which has very limited precision."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1556374671, "post_id": 55880818, "comment_id": 98421611, "body": "@mrr. use the address operator on the result of that expression. (<a href=\"https://play.golang.com/p/mlH7y5ccC-D\" rel=\"nofollow noreferrer\">play.golang.com/p/mlH7y5ccC-D</a>)"}, {"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1556389398, "post_id": 55880818, "comment_id": 98425547, "body": "@JimB why you always put focus on what is wrong, instead of showing what would be the right thing to do?"}], "answers": [{"tags": [], "owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "is_accepted": false, "score": 1, "last_activity_date": 1556389696, "last_edit_date": 1556389696, "creation_date": 1556389238, "answer_id": 55883550, "question_id": 55880818, "link": "https://stackoverflow.com/questions/55880818/multiply-float32-and-int-value/55883550#55883550", "title": "Multiply *float32 and int value", "body": "<p>You need to <em>convert</em> using type conversion as is <a href=\"https://tour.golang.org/basics/13\" rel=\"nofollow noreferrer\">explained quickly here</a>. In this case as mkopriva highlight in his comment, you should convert <code>volume</code> variable's value to a float32.</p>\n\n<p>Also allow to show a way to deal with nil values that has a meaning in the application level, for that i wrote the float32PtrToFloat(*float32,float32) with the second parameter that allows you to specify what value shall be taken instead of nil. </p>\n\n<p>Assuming that a nil value translates to zero value, here goes the complete example</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    var totalPrice *float32\n    var price *float32\n    var volume int\n\n    var total = float32PtrToFloat(price, 0) * float32(volume)\n    totalPrice = &amp;total\n    fmt.Println(*totalPrice)\n\n}\n\nfunc float32PtrToFloat(price *float32, valueIfNil float32) float32 {\n    if price == nil {\n        return valueIfNil\n    } else {\n        return *price\n    }\n}\n</code></pre>\n\n<p>And a personal reading, following JimB advice, try to not use floats for currency values as floating point arithmetic is not reliable. Instead use integer values, using the 1 as the lower value in the current currency, for example:</p>\n\n<ul>\n<li>1 = 1 penny (or)</li>\n<li>1 = 1 cent (or)</li>\n<li>1 = 1 centavo (in my case)</li>\n</ul>\n"}], "owner": {"reputation": 83, "user_id": 5859520, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/321011a9f4b82153756d578eb6f2b5d8?s=128&d=identicon&r=PG&f=1", "display_name": "mr r.", "link": "https://stackoverflow.com/users/5859520/mr-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1556397441, "creation_date": 1556370156, "last_edit_date": 1556397441, "question_id": 55880818, "link": "https://stackoverflow.com/questions/55880818/multiply-float32-and-int-value", "title": "Multiply *float32 and int value", "body": "<p>I have 2 fields that I have to multiply. One is a <code>*float32</code> field and another is an <code>int</code> field. How can I multiply these fields?</p>\n\n<pre><code>var totalPrice *float32\nvar price *float32\nvar volume int\n</code></pre>\n\n<p>this code doesn't work. I get the error ... <code>mismatched types *float32 ...</code></p>\n\n<p><code>totalPrice = price * volume</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1556385331, "post_id": 55880714, "comment_id": 98424476, "body": "You can replace the map with a switch statements if the closures bother you, but what you have now is a reasonable solution."}, {"owner": {"reputation": 1457, "user_id": 3193807, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4bee72a650d36b5841b4f6231a4e1d61?s=128&d=identicon&r=PG&f=1", "display_name": "scenia", "link": "https://stackoverflow.com/users/3193807/scenia"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1557335030, "post_id": 55880714, "comment_id": 98733054, "body": "Right, I didn&#39;t even think of switch statements (my original solution, which didn&#39;t work, was simply mapping <code>SQUARE: engines.NewSquare()</code>, but now with the closures added, turning the map into a function with just a switch inside does look like a simplification. Do you know which one has better performance in case I ever face that decision in a context where performance matters?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1557339750, "post_id": 55880714, "comment_id": 98735396, "body": "The difference is minuscule. As always, <a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"nofollow noreferrer\">measure it</a>, but only if and when necessary."}], "answers": [{"tags": [], "owner": {"reputation": 86, "user_id": 5715068, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-o9dzJNgSvKE/AAAAAAAAAAI/AAAAAAAAAQ0/14GkM4SsL8M/photo.jpg?sz=128", "display_name": "Bogdan Daragan", "link": "https://stackoverflow.com/users/5715068/bogdan-daragan"}, "is_accepted": false, "score": 0, "last_activity_date": 1556537962, "creation_date": 1556537962, "answer_id": 55902582, "question_id": 55880714, "link": "https://stackoverflow.com/questions/55880714/functions-creating-instances-of-structs-implementing-an-interface/55902582#55902582", "title": "functions creating instances of structs implementing an interface", "body": "<p>You would rather define a new type (alias to func) than an interface.\n<code>type AddPlayer func() (GameMode, error)</code></p>\n\n<p>And encapsulate this map with functions inside <code>engine</code> package where you can add new handle-functions (on demand) in separate file with <code>init()</code>. Like:\n<code>engine/main.go</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package engins\n\ntype GameMode int\n\nconst (\n    SQUARE = iota\n    TRIANGLE\n)\n\ntype AddPlayer func() (GameMode, error)\n\nvar newGameFuncs = make(map[GameMode]AddPlayer)\n\nfunc GetAddPlayerFuncByGameMode(gm GameMode) AddPlayer {\n    return newGameFuncs[gm]\n}\n</code></pre>\n\n<p><code>engine/square.go</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package engins\n\nfunc init() {\n    newGameFuncs[SQUARE] = engineSquare{}.NewSquare\n}\n\ntype engineSquare struct{}\n\nfunc (engineSquare) NewSquare() (GameMode, error) {\n    return SQUARE, nil\n}\n</code></pre>\n\n<p>And from <code>main.go</code> you will be able to use it like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport e \"./engins\"\n\nfunc main() {\n    e.GetAddPlayerFuncByGameMode(e.SQUARE)\n}\n</code></pre>\n"}], "owner": {"reputation": 1457, "user_id": 3193807, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/4bee72a650d36b5841b4f6231a4e1d61?s=128&d=identicon&r=PG&f=1", "display_name": "scenia", "link": "https://stackoverflow.com/users/3193807/scenia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1556537962, "creation_date": 1556369464, "question_id": 55880714, "link": "https://stackoverflow.com/questions/55880714/functions-creating-instances-of-structs-implementing-an-interface", "title": "functions creating instances of structs implementing an interface", "body": "<p>This question is related to <a href=\"https://stackoverflow.com/questions/35006640/golang-function-to-return-an-interface\">Golang function to return an Interface</a> and expands on it.</p>\n\n<p>My setup is the following:</p>\n\n<p>I'm creating the server side of a game where the client can choose different game modes. These modes are realised through different structs with their own implementation of some methods, all of which are their own file in <code>package engines</code>, for example:</p>\n\n<pre><code>package engines\n\nimport \"fmt\"\n\ntype Square struct {\n    tiles []int\n    players []bool\n}\n\nfunc NewSquare() *Square {\n    return &amp;Square{\n        [25]int{}[:],\n        []bool{false, false},\n    }\n}\n\nfunc (e *Square) AddPlayer() (int, error) {\n    for id := range e.players {\n        if !e.players[id] {\n            e.players[id] = true\n            return id, nil\n        }\n    }\n    return -1, fmt.Printf(\"game already full\")\n}\n</code></pre>\n\n<p>In the main package, when a new game is created, I'm using a map to call the <code>newSomething</code> function of the corresponding game mode. Every engine satifies the interface <code>gameEngine</code>:</p>\n\n<pre><code>package main\n\nimport \"engines\"\n\ntype gameEngine interface {\n    AddPlayer() (int, error)\n}\n\ntype GameMode int\nconst (\n    SQUARE   GameMode = 0\n    TRIANGLE GameMode = 1\n)\n</code></pre>\n\n<p>This interface is defined within the main package for two primary reasons:</p>\n\n<ol>\n<li>It improves readability to have the interface definition in the same file that uses that interface. If I'm unsure what some object is capable of, I can just scroll to the interface definition and check.</li>\n<li>Putting the interface definition inside <code>package engines</code> feels like going back to the situation where classes explicitly state the interfaces they implement, one of the things go is designed not to require.</li>\n</ol>\n\n<p>This means that within the files of my engine implementations, like <code>Square.go</code> and <code>Triangle.go</code>, I don't have access to the interface and the corresponding new-Functions must return their respective type, which makes them of type <code>func() *Square</code> and <code>func() *Triangle</code>, respectively (see above).</p>\n\n<p>Now I can't use these new-functions directly in a <code>map[GameMode]func() gameEngine</code> because their type is wrong. My current solution is to convert them using a rather verbose inline function (inspired by one of the answers in the linked question):</p>\n\n<pre><code>var engine gameEngine\n\nvar newGameFuncs = map[GameMode]func() gameEngine {\n    SQUARE:   func() gameEngine { return engines.NewSquare() },\n    TRIANGLE: func() gameEngine { return engines.NewTriangle() },\n}\n\nfunc JoinGame(mode GameMode) (int, error) {\n    engine = newGameFuncs[mode]()\n    id, err := engine.AddPlayer()\n    // Some other stuff, too\n    return id, nil\n}\n</code></pre>\n\n<p>This map feels very clunky and artificial, but as far as I can tell, it's the only way to do it with this map approach.</p>\n\n<p><strong>Is there a better way or design pattern to achieve my goal?</strong></p>\n\n<ul>\n<li><code>func JoinGame(mode GameMode) (int, error)</code> is part of my client interface, it's the starting point of the whole thing and must keep its signature.</li>\n<li><code>type gameEngine interface</code> should stay in the main package.</li>\n<li>When implementing a new mode (say, <code>Hexagon.go</code>), the only steps necessary should be making the file and registering the <code>newHexagon</code> function in exactly one place.</li>\n</ul>\n"}, {"tags": ["go", "linker-errors", "cgo"], "comments": [{"owner": {"reputation": 663, "user_id": 875977, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0a7a3d5557ddc03f5c5861f703f0386a?s=128&d=identicon&r=PG", "display_name": "Dinesh", "link": "https://stackoverflow.com/users/875977/dinesh"}, "edited": false, "score": 0, "creation_date": 1556368702, "post_id": 55880553, "comment_id": 98419933, "body": "This question is specific to &quot;CGO&quot; and I feel this is not related to the <a href=\"https://stackoverflow.com/questions/12573816/what-is-an-undefined-reference-unresolved-external-symbol-error-and-how-do-i-fix\" title=\"what is an undefined reference unresolved external symbol error and how do i fix\">stackoverflow.com/questions/12573816/&hellip;</a>"}, {"owner": {"reputation": 663, "user_id": 875977, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0a7a3d5557ddc03f5c5861f703f0386a?s=128&d=identicon&r=PG", "display_name": "Dinesh", "link": "https://stackoverflow.com/users/875977/dinesh"}, "edited": false, "score": 0, "creation_date": 1556520547, "post_id": 55880553, "comment_id": 98452587, "body": "Finally go community helped to identify the problem. There was extern &quot;C&quot; missing in my header. after re building the library, linking issue is solved.  More details <a href=\"https://github.com/golang/go/issues/31723\" rel=\"nofollow noreferrer\">here</a>"}], "owner": {"reputation": 663, "user_id": 875977, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0a7a3d5557ddc03f5c5861f703f0386a?s=128&d=identicon&r=PG", "display_name": "Dinesh", "link": "https://stackoverflow.com/users/875977/dinesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 23, "favorite_count": 0, "closed_date": 1556368400, "answer_count": 0, "score": 0, "last_activity_date": 1556368569, "creation_date": 1556368051, "last_edit_date": 1556368569, "question_id": 55880553, "link": "https://stackoverflow.com/questions/55880553/cgo-undefined-reference-error-when-linking-dynamic-library-in-go", "closed_reason": "Duplicate", "title": "cgo - &quot;undefined reference&quot; error when linking dynamic library in GO", "body": "<p>I have a C++ shared library in <code>/opt/xx/lib64</code>. Headers are in C.\nIn my go code, I am including proper header and linker options using CPPFLAGS/CFLAGS and LDFLAGS. Still while building go I am getting 'undefined reference` error.</p>\n\n<pre><code>import (\n    //#cgo LDFLAGS: -L/opt/xxx/lib64/ -lsessionmgmt\n    //#cgo CPPFLAGS: -I/opt/xxx/include/\n    //#include &lt;stdlib.h&gt;\n    //#include &lt;sessionMgmt/sessionMgmt.h&gt;\n    \"C\"\n    \"unsafe\"\n)\n</code></pre>\n\n<pre><code>/tmp/go-build609413262/b163/_x002.o: In function `_cgo_e38947506e9d_Cfunc_um_get_lastlogin_info':\n/tmp/go-build/cgo-gcc-prolog:52: undefined reference to `um_get_lastlogin_info'\ncollect2: error: ld returned 1 exit status\nmake[3]: *** [Makefile:48: vet] Error 2\n</code></pre>\n\n<p>Library is exist in the right path and do contain the required method.\nNot sure why this error.</p>\n\n<p><code>$ grep um_get_lastlogin_info /opt/xxx/lib64/libsessionmgmt.so\nBinary file /opt/xxx/lib64/libsessionmgmt.so matches</code></p>\n\n<p>Also tried using the <code>pkg-config</code> with cgo. Still the same linking error appears.</p>\n"}, {"tags": ["go", "draw"], "answers": [{"tags": [], "owner": {"reputation": 27, "user_id": 11419472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04bf8834d6be1876c6ba4c18e1520dab?s=128&d=identicon&r=PG", "display_name": "Luke Kennedy", "link": "https://stackoverflow.com/users/11419472/luke-kennedy"}, "is_accepted": true, "score": 1, "last_activity_date": 1556367753, "creation_date": 1556367753, "answer_id": 55880515, "question_id": 55880241, "link": "https://stackoverflow.com/questions/55880241/why-does-gos-draw-drawmask-appear-to-ignore-my-black-and-white-mask/55880515#55880515", "title": "Why does Go&#39;s draw.DrawMask appear to ignore my black and white mask?", "body": "<p>TLDR: The mask isn't supposed to be black and white, that's just how they rendered it for visual effect. <strong>The mask is supposed to be opaque where the Src should be used, and transparent where the Src should not be used.</strong></p>\n\n<p>Replace the mask generation in my original code with the following and it all suddenly works as expected. (Replace Black with Transparent, replace White with Opaque):</p>\n\n<pre><code>mask := image.NewNRGBA(bounds)\ndraw.Draw(mask, bounds, image.NewUniform(color.Transparent), image.ZP, draw.Src)\ndraw.Draw(mask, image.Rect(40, 40, 60, 60), image.NewUniform(color.Opaque), image.ZP, draw.Src)\n</code></pre>\n\n<p>I spent a full day and a half banging my head against a wall, finally gave in and posted to SO for the first time, then immediately solved my own problem as soon as I stopped thinking about it, like an idiot.</p>\n"}], "owner": {"reputation": 27, "user_id": 11419472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04bf8834d6be1876c6ba4c18e1520dab?s=128&d=identicon&r=PG", "display_name": "Luke Kennedy", "link": "https://stackoverflow.com/users/11419472/luke-kennedy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 1, "accepted_answer_id": 55880515, "answer_count": 1, "score": 0, "last_activity_date": 1556367753, "creation_date": 1556365669, "last_edit_date": 1556366065, "question_id": 55880241, "link": "https://stackoverflow.com/questions/55880241/why-does-gos-draw-drawmask-appear-to-ignore-my-black-and-white-mask", "title": "Why does Go&#39;s draw.DrawMask appear to ignore my black and white mask?", "body": "<p>I'm attempting to render barcodes in Go with user-input colours for both the data and background, and although the barcodes themselves are produced as expected in black and white, attempting to use them as a mask image in \"image/draw\"'s draw.DrawMask function results in full pass-through of the source image, ignoring the mask entirely. </p>\n\n<p>This is very much counter to the examples given in the <a href=\"https://blog.golang.org/go-imagedraw-package\" rel=\"nofollow noreferrer\">Go blog post on the image/draw package</a>.</p>\n\n<p>I've reduced the problem down to a fairly minimal example, a simple white square on a black background as a mask with uniform colours as source and destination, and the behaviour continues. I'm clearly failing to understand some element of how this function behaves, but attempts at finding similar problems others have encountered all seem to end with a different approach to the problem entirely (eg another library to do the job), rather than understanding the mistake in the usage of draw.DrawMask.</p>\n\n<p>The code I've posted includes a function for writing the three output images to BMP files, but this behaviour is repeated if any other method of saving the image.Image data to a file is used.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    bmp \"golang.org/x/image/bmp\"\n    \"image\"\n    \"image/color\"\n    \"image/draw\"\n    \"io/ioutil\"\n    \"os\"\n)\n\nfunc main() {\n    //Use one rectange to make all new images\n    bounds := image.Rect(0, 0, 100, 100)\n    //Generate a 20px wide white square in the centre of a black background\n    mask := image.NewNRGBA(bounds)\n    draw.Draw(mask, bounds, image.NewUniform(color.Black), image.ZP, draw.Src)\n    draw.Draw(mask, image.Rect(40, 40, 60, 60), image.NewUniform(color.White), image.ZP, draw.Src)\n    //Generate a blue image of the right size - this is unnecessary, but shouldn't hurt\n    blue := image.NewNRGBA(bounds)\n    draw.Draw(blue, bounds, image.NewUniform(color.NRGBA{B: 255, A: 255}), image.ZP, draw.Src)\n    //Copy the blue image into what is the desired output - also unnecessary, but will help to demonstrate each step is working independently\n    result := image.NewNRGBA(bounds)\n    draw.Draw(result, bounds, blue, image.ZP, draw.Src)\n    //Use mask to draw green onto the blue - but only inside the 20px square (in theory)\n    draw.DrawMask(result, bounds, image.NewUniform(color.NRGBA{G: 255, A: 255}), image.ZP, mask, image.ZP, draw.Over)\n\n    writeImageToBMP(blue, \"blue.bmp\")\n    writeImageToBMP(mask, \"mask.bmp\")\n    writeImageToBMP(result, \"result.bmp\")\n}\n\nfunc writeImageToBMP(img image.Image, filename string) {\n    //This part isn't relevant to the problem, I just don't know a better way to show content of an image\n    var imgBytes bytes.Buffer\n    bmp.Encode(&amp;imgBytes, img)\n    ioutil.WriteFile(filename, imgBytes.Bytes(), os.ModeExclusive)\n}\n</code></pre>\n\n<p>I would expect the code above to produce three images:</p>\n\n<ol>\n<li>A blue square, 100px by 100px</li>\n<li>A black square, 100px by 100px, with a 20px by 20px white square in its centre</li>\n<li>A blue square, 100px by 100px with a 20px by 20px green square in its centre</li>\n</ol>\n\n<p>The first two appear as expected, but the third is entirely green.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1556366489, "post_id": 55879631, "comment_id": 98419353, "body": "XML tags appear in the order of the respective fields in the struct types, so change the order of the fields."}, {"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 0, "creation_date": 1556429720, "post_id": 55879631, "comment_id": 98432186, "body": "There is a rather easy way to do it with JSON but unfortunately not XML..."}], "owner": {"reputation": 67, "user_id": 5664838, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/uvjhL.gif?s=128&g=1", "display_name": "\u0418\u0433\u043e\u0440\u044c", "link": "https://stackoverflow.com/users/5664838/%d0%98%d0%b3%d0%be%d1%80%d1%8c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1556361263, "creation_date": 1556361263, "question_id": 55879631, "link": "https://stackoverflow.com/questions/55879631/how-to-marshal-struct-to-xml-with-alphabetically-sorted-elements", "title": "How to marshal struct to XML with alphabetically-sorted elements?", "body": "<p>I need to get XML string with ordered elements from structs with unordered fields. </p>\n\n<p>There is main struct:</p>\n\n<pre><code>type Person struct {\n    Name string\n    Age  int\n    OtherData interface{}\n}\n</code></pre>\n\n<p>And there are also a great many other structs, such as:</p>\n\n<pre><code>type SomeStruct1 struct {\n    Job   string\n    Hobby string\n}\n\ntype SomeStruct2 struct {\n    SkillName  string\n    SkillValue int\n    *SomeStruct3\n}\n</code></pre>\n\n<p>These structs can have other embedded structs.</p>\n\n<p>I get structs like this:</p>\n\n<pre><code>    sample := &amp;Person{}\n    sample.Name = \"Vasya\"\n    sample.Age = 35\n    sample.OtherData = SomeStruct1{\"programmer\", \"driving\"}\n</code></pre>\n\n<p>Then I need to get XML with elements ordered by their names:</p>\n\n<pre><code>&lt;Person&gt;\n    &lt;Age&gt;35&lt;/Age&gt;\n    &lt;Name&gt;Vasya&lt;/Name&gt;\n    &lt;OtherData&gt;\n        &lt;Hobby&gt;driving&lt;/Hobby&gt;\n        &lt;Job&gt;programmer&lt;/Job&gt;\n    &lt;/OtherData&gt;\n&lt;/Person&gt;\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1556357059, "post_id": 55879028, "comment_id": 98417078, "body": "<a href=\"https://golang.org/pkg/reflect/#example_StructTag\" rel=\"nofollow noreferrer\">golang.org/pkg/reflect/#example_StructTag</a>"}, {"owner": {"reputation": 1867, "user_id": 5281215, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/10153631051339031/picture?type=large", "display_name": "Boo Yan Jiong", "link": "https://stackoverflow.com/users/5281215/boo-yan-jiong"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1556357816, "post_id": 55879028, "comment_id": 98417248, "body": "the example shows &quot;json&quot; -&gt; &quot;a1&quot;, but I want do it backwards, such as &quot;a1&quot; -&gt; &quot;Head&quot;... hmmm, I try to read the documentation again... thanks..."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1556358325, "post_id": 55879028, "comment_id": 98417364, "body": "<a href=\"https://play.golang.com/p/8X64XBwh03o\" rel=\"nofollow noreferrer\">play.golang.com/p/8X64XBwh03o</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1556358500, "post_id": 55879028, "comment_id": 98417402, "body": "Range over the fields until you find the one with the tag you&#39;re looking for. <a href=\"https://stackoverflow.com/questions/10858787/what-are-the-uses-for-tags-in-go/30889373#30889373\">What are the use(s) for tags in Go?</a> If you need this frequently, build a map, mapping from tag to field, so future lookups become a single map indexing."}, {"owner": {"reputation": 1867, "user_id": 5281215, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/10153631051339031/picture?type=large", "display_name": "Boo Yan Jiong", "link": "https://stackoverflow.com/users/5281215/boo-yan-jiong"}, "edited": false, "score": 0, "creation_date": 1556358732, "post_id": 55879028, "comment_id": 98417463, "body": "wow... thanks... I keep thinking for a direct lookup approach, but can&#39;t find any. Haven&#39;t think for using the <code>for loop</code> to retrieve the field name... Haha. Thanks for helping..."}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1556631422, "post_id": 55879028, "comment_id": 98498010, "body": "@mkopriva: great answer  - why not post it as an answer instead of comment? Otherwise the question still appears in Unanswered"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 1, "creation_date": 1556633594, "post_id": 55879028, "comment_id": 98499381, "body": "@EliBendersky answer added."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 7, "last_activity_date": 1556633540, "last_edit_date": 1556633540, "creation_date": 1556632389, "answer_id": 55922473, "question_id": 55879028, "link": "https://stackoverflow.com/questions/55879028/golang-get-structs-field-name-by-json-tag/55922473#55922473", "title": "Golang get struct&#39;s field name by JSON tag", "body": "<p>You can use the <code>reflect</code> package to loop over a struct's fields and match against their tag values.</p>\n\n<pre><code>func getFieldName(tag, key string, s interface{}) (fieldname string) {\n    rt := reflect.TypeOf(s)\n    if rt.Kind() != reflect.Struct {\n        panic(\"bad type\")\n    }\n    for i := 0; i &lt; rt.NumField(); i++ {\n        f := rt.Field(i)\n        v := strings.Split(f.Tag.Get(key), \",\")[0] // use split to ignore tag \"options\" like omitempty, etc.\n        if v == tag {\n            return f.Name\n        }\n    }\n    return \"\"\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.com/p/2zCC7pZKJTz\" rel=\"noreferrer\">https://play.golang.com/p/2zCC7pZKJTz</a></p>\n\n<hr>\n\n<p>Alternatively, as pointed out by @icza, you can build up a map and then use that for quicker lookups.</p>\n\n<pre><code>//                         Human            json       a1     Head\nvar fieldsByTag = make(map[reflect.Type]map[string]map[string]string)\n\nfunc buildFieldsByTagMap(key string, s interface{}) {\n    rt := reflect.TypeOf(s)\n    if rt.Kind() != reflect.Struct {\n        panic(\"bad type\")\n    }\n\n    if fieldsByTag[rt] == nil {\n        fieldsByTag[rt] = make(map[string]map[string]string)\n    }\n    if fieldsByTag[rt][key] == nil {\n        fieldsByTag[rt][key] = make(map[string]string)\n    }\n\n    for i := 0; i &lt; rt.NumField(); i++ {\n        f := rt.Field(i)\n        v := strings.Split(f.Tag.Get(key), \",\")[0] // use split to ignore tag \"options\"\n        if v == \"\" || v == \"-\" {\n            continue\n        }\n        fieldsByTag[rt][key][v] = f.Name\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.com/p/qlt_mWsXGju\" rel=\"noreferrer\">https://play.golang.com/p/qlt_mWsXGju</a></p>\n"}], "owner": {"reputation": 1867, "user_id": 5281215, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/10153631051339031/picture?type=large", "display_name": "Boo Yan Jiong", "link": "https://stackoverflow.com/users/5281215/boo-yan-jiong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4885, "favorite_count": 0, "accepted_answer_id": 55922473, "answer_count": 1, "score": 7, "last_activity_date": 1556633540, "creation_date": 1556356920, "question_id": 55879028, "link": "https://stackoverflow.com/questions/55879028/golang-get-structs-field-name-by-json-tag", "title": "Golang get struct&#39;s field name by JSON tag", "body": "<p>I have a struct:</p>\n\n<pre><code>type Human struct {\n    Head  string  `json:\"a1\"`\n    Body  string  `json:\"a2\"`\n    Leg   string  `json:\"a3\"`\n}\n</code></pre>\n\n<p>How can I get the struct's field name by providing JSON tag name? Probably something like this:</p>\n\n<pre><code>fmt.Println(getFieldName(\"a1\")) // \"Head\"\nfmt.Println(getFieldName(\"a2\")) // \"Body\"\nfmt.Println(getFieldName(\"a99\")) // \"\"\n\nfunc getFieldName(tag string) (fieldname string) {\n    /* ... */\n}\n</code></pre>\n\n<p>How should I implement the <code>getFieldName</code> function? I read online, it seems I need to use the <code>reflect</code> package, hmmm... any helping hand? :)</p>\n"}, {"tags": ["go", "goland", "go-interface", "go-guru"], "answers": [{"tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 6, "last_activity_date": 1556351207, "creation_date": 1556351207, "answer_id": 55878415, "question_id": 55878241, "link": "https://stackoverflow.com/questions/55878241/list-all-types-implementing-an-interface-in-go/55878415#55878415", "title": "List all types implementing an interface in Go", "body": "<p>You can use <code>Navigate | Declaration</code> or <code>Navigate | Implementation(s)</code> on any type/interface and you'll see a list of interfaces implemented by a type or of types implementing an interface.</p>\n\n<p>You can also use the green buttons on the IDE left side next to their type definitions to perform the same actions.</p>\n"}], "owner": {"reputation": 708, "user_id": 989827, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2dc4984b386fa22692c93300cfcdb394?s=128&d=identicon&r=PG", "display_name": "jeremie", "link": "https://stackoverflow.com/users/989827/jeremie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 571, "favorite_count": 0, "accepted_answer_id": 55878415, "answer_count": 1, "score": 2, "last_activity_date": 1556351207, "creation_date": 1556349619, "question_id": 55878241, "link": "https://stackoverflow.com/questions/55878241/list-all-types-implementing-an-interface-in-go", "title": "List all types implementing an interface in Go", "body": "<p>I'm new to Go, and I'd like to know if there's a way in Goland or w/ a CLI tool to list all the types that implement a given interface. </p>\n\n<p>I found a tool called <a href=\"https://docs.google.com/document/d/1_Y9xCEMj5S-7rv2ooHpZNH15JgRT5iM742gJkw5LtmQ/edit\" rel=\"nofollow noreferrer\"><code>guru</code></a> that can list all interfaces implemented by a given type, but I haven't been able to make it work in CLI.</p>\n"}, {"tags": ["go", "go-build"], "answers": [{"comments": [{"owner": {"reputation": 734, "user_id": 7716619, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/016882d3e25cfd932efa5c8b7c82d3eb?s=128&d=identicon&r=PG&f=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/7716619/developer"}, "edited": false, "score": 0, "creation_date": 1556391319, "post_id": 55877795, "comment_id": 98426036, "body": "so essentially it&#39;s one <code>so</code> file per package, so how&#39;s it done in real life? I&#39;ve a library of multiple packages, that means I&#39;ll be distributing several <code>so</code> files for my project? is there an archive that allows to combine all so files in a package?"}, {"owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "reply_to_user": {"reputation": 734, "user_id": 7716619, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/016882d3e25cfd932efa5c8b7c82d3eb?s=128&d=identicon&r=PG&f=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/7716619/developer"}, "edited": false, "score": 0, "creation_date": 1556421703, "post_id": 55877795, "comment_id": 98431170, "body": "No there is no such thing you have to combine them yourself"}, {"owner": {"reputation": 734, "user_id": 7716619, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/016882d3e25cfd932efa5c8b7c82d3eb?s=128&d=identicon&r=PG&f=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/7716619/developer"}, "edited": false, "score": 0, "creation_date": 1556421843, "post_id": 55877795, "comment_id": 98431184, "body": "is this applicable -&gt; <a href=\"https://stackoverflow.com/questions/915128/merge-multiple-so-shared-libraries\" title=\"merge multiple so shared libraries\">stackoverflow.com/questions/915128/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "is_accepted": false, "score": 0, "last_activity_date": 1556358758, "last_edit_date": 1556358758, "creation_date": 1556345428, "answer_id": 55877795, "question_id": 55876606, "link": "https://stackoverflow.com/questions/55876606/create-a-plugin-from-multiple-files-from-different-directories/55877795#55877795", "title": "Create a plugin from multiple files from different directories", "body": "<p>You can't put them in different folders because they should have same package name (main). But you can put them in different files like this :</p>\n\n<p>file1:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype greeting_en string\n\nfunc (g greeting_en) Greet() {\n    fmt.Println(\"Hello Universe\")\n}\n\n\nvar GreeterEn greeting_en\n</code></pre>\n\n<p>file2:  </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype greeting_chi string\n\n\nfunc (g greeting_chi) Greet() {\n    fmt.Println(\"\u4f60\u597d\u5b87\u5b99\")\n}\n\n\nvar GreeterChi greeting_chi\n</code></pre>\n\n<p>compile them like this :</p>\n\n<pre><code>go build -buildmode=plugin -o ./langs.go \n</code></pre>\n\n<p>And load langs like this :</p>\n\n<pre><code>mod = \"./langs.so\"\nplug, _ := plugin.Open(mod)\nEnglishGreeter,_ := plug.Lookup(\"GreeterEn\")\nChineseGreeter,_ := plug.Lookup(\"GreeterChi\")\n</code></pre>\n"}], "owner": {"reputation": 734, "user_id": 7716619, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/016882d3e25cfd932efa5c8b7c82d3eb?s=128&d=identicon&r=PG&f=1", "display_name": "Developer", "link": "https://stackoverflow.com/users/7716619/developer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 317, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1556391693, "creation_date": 1556329805, "last_edit_date": 1556391693, "question_id": 55876606, "link": "https://stackoverflow.com/questions/55876606/create-a-plugin-from-multiple-files-from-different-directories", "title": "Create a plugin from multiple files from different directories", "body": "<p>Following this <a href=\"https://medium.com/learning-the-go-programming-language/writing-modular-go-programs-with-plugins-ec46381ee1a9\" rel=\"nofollow noreferrer\">tutorial</a> and the github <a href=\"https://github.com/vladimirvivien/go-plugin-example\" rel=\"nofollow noreferrer\">repo</a> I understood the use of plugins. </p>\n\n<p>The tutorial compiles each file separately into so files.</p>\n\n<pre><code>go build -buildmode=plugin -o eng/eng.so eng/greeter.go\ngo build -buildmode=plugin -o chi/chi.so chi/greeter.go\n</code></pre>\n\n<p>How can I merge two files into a single .so file? I tried following command by separating files through space</p>\n\n<pre><code>go build -buildmode=plugin -o bin/langs.so src/test/eng/greeter.go src/test/chi/greeter.go\n</code></pre>\n\n<p>The error:</p>\n\n<blockquote>\n  <p>named files must all be in one directory; have src/test/eng/ and\n  src/test/chi/</p>\n</blockquote>\n\n<p>The idea is to have a single .so files from different packages.</p>\n\n<p><strong>Edit: I guess the follow up question would be how to combine all <code>.so</code> files into one archive if one has several packages of a library and go only allows one <code>.so</code> file per package.</strong></p>\n"}]