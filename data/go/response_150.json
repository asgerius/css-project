[{"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 15, "last_activity_date": 1511433325, "last_edit_date": 1511433325, "creation_date": 1511399029, "answer_id": 47446114, "question_id": 47445344, "link": "https://stackoverflow.com/questions/47445344/is-there-a-difference-in-go-between-a-counter-using-atomic-operations-and-one-us/47446114#47446114", "title": "Is there a difference in Go between a counter using atomic operations and one using a mutex?", "body": "<p>There is no difference in <em>behavior</em>.  There is a difference in <em>performance</em>.</p>\n\n<p>Mutexes are slow, due to the setup and teardown, and due to the fact that they block other goroutines for the duration of the lock.</p>\n\n<p>Atomic operations are fast because they use an atomic CPU instruction, rather than relying on external locks to.</p>\n\n<p>Therefore, whenever it is feasible, atomic operations should be preferred.</p>\n"}, {"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 3, "last_activity_date": 1511423035, "creation_date": 1511423035, "answer_id": 47450022, "question_id": 47445344, "link": "https://stackoverflow.com/questions/47445344/is-there-a-difference-in-go-between-a-counter-using-atomic-operations-and-one-us/47450022#47450022", "title": "Is there a difference in Go between a counter using atomic operations and one using a mutex?", "body": "<p>Atomics are faster in the common case: the compiler translates each call to a function from the <code>sync/atomic</code> package to a special set of machine instructions which basically operate on the CPU level \u2014 for instance, on x86\narchitectures, an <code>atomic.AddInt64</code> would be translated to some plain\n<code>ADD</code>-class instruction prefixed with the <code>LOCK</code> instruction (see <a href=\"https://stackoverflow.com/q/3339141/720999\">this</a> for an example) \u2014\nwith the latter ensuring coherent view of the updated memory location\nacross all the CPUs in the system.</p>\n\n<p>A mutex is a much complicated thing as it, in the end, wraps some bit\nof the native OS-specific thread synchronization API\n(for instance, on Linux, that's <a href=\"https://en.wikipedia.org/wiki/Futex\" rel=\"nofollow noreferrer\"><code>futex</code></a>).</p>\n\n<p>On the other hand, the Go runtime is pretty much optimized when\nit comes to synchronization stuff (which is kinda expected \u2014\ngiven one of the main selling points of Go), and the mutex implementation\ntries to avoid hitting the kernel to perform synchronization\nbetween goroutines, if possible, and carry it out completely in\nthe Go runtime itself.</p>\n\n<p>This might explain no noticeable difference in the timings\nin your benchmarks, provided the contention over the mutexes\nwas reasonably low.</p>\n\n<hr>\n\n<p>Still, I feel oblidged to note \u2014 just in case \u2014 that atomics and\nhigher-level synchronization facilities are designed to solve different\ntasks.  Say, you can't use atomics to protect some memory state during\nthe execution of a whole function \u2014 and even a single statement,\nin the general case.</p>\n"}, {"tags": [], "owner": {"reputation": 721, "user_id": 8930534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0277bb31c0a6d6334cf3d287289bc17?s=128&d=identicon&r=PG&f=1", "display_name": "Hugh", "link": "https://stackoverflow.com/users/8930534/hugh"}, "is_accepted": true, "score": 7, "last_activity_date": 1511922246, "creation_date": 1511922246, "answer_id": 47544046, "question_id": 47445344, "link": "https://stackoverflow.com/questions/47445344/is-there-a-difference-in-go-between-a-counter-using-atomic-operations-and-one-us/47544046#47544046", "title": "Is there a difference in Go between a counter using atomic operations and one using a mutex?", "body": "<p>Alright, I'm going to attempt to self-answer for some closure. Edits are welcome.</p>\n\n<p>There is some discussion about the atomic package <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/0uPDCRiBWqc\" rel=\"noreferrer\">here</a>. But to quote the most telling comments:</p>\n\n<blockquote>\n  <p>The very short summary is that if you have to ask, you should probably\n  avoid the package.  Or, read the atomic operations chapter of the\n  C++11 standard; if you understand how to use those operations safely\n  in C++, then you are more than capable of using Go's <code>sync/atomic</code>\n  package.</p>\n  \n  <p>That said, sticking to <code>atomic.AddInt32</code> and <code>atomic.LoadInt32</code> is safe as\n  long as you are just reporting statistical information, and not\n  actually relying on the values carrying any meaning about the state of\n  the different goroutines. </p>\n</blockquote>\n\n<p>And:</p>\n\n<blockquote>\n  <p>What atomicity does not guarantee, is any ordering of\n  observability of values.  I mean, <code>atomic.AddInt32()</code> does only guarantee\n  that what this operation stores at &amp;cnt will be exactly <code>*cnt + 1</code> (with\n  the value of <code>*cnt</code> being what the CPU executing the active goroutine\n  fetched from memory when the operation started); it does not provide any\n  guarantee that if another goroutine will attempt to read this value at\n  the same time it will fetch that same value <code>*cnt + 1</code>.</p>\n  \n  <p>On the other hand, mutexes and channels guarantee strict ordering\n  of accesses to values being shared/passed around (subject to the rules\n  of Go memory model). </p>\n</blockquote>\n\n<p>In regards to why the code sample in the question never finishes, this is due to fact that the <code>func</code> that is reading the counter is in a very tight loop. When using the atomic counter, there are no syncronisation events (e.g. <code>mutex</code> lock/unlock, syscalls) which means that the goroutine never yields control. The result of this is that this goroutine starves the thread it is running on, and prevents the scheduler from allocating time to any other goroutines allocated to that thread, this includes ones that increment the counter meaning the counter never reaches 10000000.</p>\n"}], "owner": {"reputation": 721, "user_id": 8930534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0277bb31c0a6d6334cf3d287289bc17?s=128&d=identicon&r=PG&f=1", "display_name": "Hugh", "link": "https://stackoverflow.com/users/8930534/hugh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6194, "favorite_count": 4, "accepted_answer_id": 47544046, "answer_count": 3, "score": 16, "last_activity_date": 1511922246, "creation_date": 1511392915, "last_edit_date": 1511484476, "question_id": 47445344, "link": "https://stackoverflow.com/questions/47445344/is-there-a-difference-in-go-between-a-counter-using-atomic-operations-and-one-us", "title": "Is there a difference in Go between a counter using atomic operations and one using a mutex?", "body": "<p>I have seen some discussion lately about whether there is a difference between a counter implemented using atomic increment/load, and one using a mutex to synchronise increment/load.</p>\n\n<p>Are the following counter implementations functionally equivalent?</p>\n\n<pre><code>type Counter interface {\n    Inc()\n    Load() int64\n}\n\n// Atomic Implementation\n\ntype AtomicCounter struct {\n    counter int64\n}\n\nfunc (c *AtomicCounter) Inc() {\n    atomic.AddInt64(&amp;c.counter, 1)\n}\n\nfunc (c *AtomicCounter) Load() int64 {\n    return atomic.LoadInt64(&amp;c.counter)\n}\n\n// Mutex Implementation\n\ntype MutexCounter struct {\n    counter int64\n    lock    sync.Mutex\n}\n\nfunc (c *MutexCounter) Inc() {\n    c.lock.Lock()\n    defer c.lock.Unlock()\n\n    c.counter++\n}\n\nfunc (c *MutexCounter) Load() int64 {\n    c.lock.Lock()\n    defer c.lock.Unlock()\n\n    return c.counter\n}\n</code></pre>\n\n<p>I have run a bunch of test cases (<a href=\"https://play.golang.org/p/oHnikFHlWq\" rel=\"noreferrer\">Playground Link</a>) and haven't been able to see any different behaviour. Running the tests on my machine the numbers get printed out of order for all the <code>PrintAll</code> test functions.</p>\n\n<p>Can someone confirm whether they are equivalent or if there are any edge cases where these are different? Is there a preference to use one technique over the other? The <a href=\"https://golang.org/pkg/sync/atomic/\" rel=\"noreferrer\">atomic documentation</a> does say it should only be used in special cases.</p>\n\n<p><strong>Update:</strong>\nThe original question that caused me to ask this was <a href=\"https://stackoverflow.com/q/47422284/8930534\">this one</a>, however it is now on hold, and i feel this aspect deserves its own discussion. In the answers it seemed that using a mutex would guarantee correct results, whereas atomics might not, specifically if the program is running in multiple threads. My questions are:</p>\n\n<ul>\n<li><strike>Is it correct that they can produce different results?</strike> (See update below. The answer is yes.).</li>\n<li>What causes this behaviour?</li>\n<li>What are the tradeoffs between the two approaches?</li>\n</ul>\n\n<p><strong>Another Update:</strong></p>\n\n<p>I've found some code where the two counters behave differently. When run on my machine this function will finish with <code>MutexCounter</code>, but not with <code>AtomicCounter</code>. Don't ask me why you would ever run this code:</p>\n\n<pre><code>func TestCounter(counter Counter) {\n    end := make(chan interface{})\n\n    for i := 0; i &lt; 1000; i++ {\n        go func() {\n            r := rand.New(rand.NewSource(time.Now().UnixNano()))\n            for j := 0; j &lt; 10000; j++ {\n                k := int64(r.Uint32())\n                if k &gt;= 0 {\n                    counter.Inc()\n                }\n            }\n        }()\n    }\n\n    go func() {\n        prevValue := int64(0)\n        for counter.Load() != 10000000 { // Sometimes this condition is never met with AtomicCounter.\n            val := counter.Load()\n            if val%1000000 == 0 &amp;&amp; val != prevValue {\n                prevValue = val\n            }\n        }\n\n        end &lt;- true\n\n        fmt.Println(\"Count:\", counter.Load())\n    }()\n\n    &lt;-end\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1511390367, "post_id": 47443339, "comment_id": 81845177, "body": "Why are they logically equivalent?"}, {"owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1511422695, "post_id": 47443339, "comment_id": 81854626, "body": "I was reading the following thread and to me it looked like the order makes a difference: <a href=\"https://stackoverflow.com/questions/10920651/get-the-latest-record-from-mongodb-collection\" title=\"get the latest record from mongodb collection\">stackoverflow.com/questions/10920651/&hellip;</a>"}, {"owner": {"reputation": 1043, "user_id": 1004478, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/297652ae3e1b4a5f82076b8826dbd35a?s=128&d=identicon&r=PG", "display_name": "Jim", "link": "https://stackoverflow.com/users/1004478/jim"}, "edited": false, "score": 1, "creation_date": 1511426689, "post_id": 47443339, "comment_id": 81856849, "body": "it seems you should use sort before limit <a href=\"https://docs.mongodb.com/manual/tutorial/optimize-query-performance-with-indexes-and-projections/#limit-the-number-of-query-results-to-reduce-network-demand\" rel=\"nofollow noreferrer\">docs.mongodb.com/manual/tutorial/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1511427585, "last_edit_date": 1592644375, "creation_date": 1511426879, "answer_id": 47451089, "question_id": 47443339, "link": "https://stackoverflow.com/questions/47443339/how-to-improve-performance-when-retrieving-the-last-document-from-a-collection/47451089#47451089", "title": "How to improve performance when retrieving the last document from a collection", "body": "<p>We might answer regarding the <code>mgo</code> package and MongoDB itself.</p>\n<h2>In <code>mgo</code></h2>\n<p>The <a href=\"https://godoc.org/gopkg.in/mgo.v2#Query.Limit\" rel=\"nofollow noreferrer\"><code>Query.Limit()</code></a> and <a href=\"https://godoc.org/gopkg.in/mgo.v2#Query.Sort\" rel=\"nofollow noreferrer\"><code>Query.Sort()</code></a> methods just operate on the <a href=\"https://godoc.org/gopkg.in/mgo.v2#Query\" rel=\"nofollow noreferrer\"><code>Query</code></a> object locally, and once you setup the query, you execute it e.g. with <a href=\"https://godoc.org/gopkg.in/mgo.v2#Query.One\" rel=\"nofollow noreferrer\"><code>Query.One()</code></a> or <a href=\"https://godoc.org/gopkg.in/mgo.v2#Query.One\" rel=\"nofollow noreferrer\"><code>Query.All()</code></a>. The order in which you called the methods to set it up is not stored and does not matter.</p>\n<h2>In MongoDB</h2>\n<p>Quoting from <a href=\"https://docs.mongodb.com/manual/reference/method/db.collection.find/#combine-cursor-methods\" rel=\"nofollow noreferrer\">MongoDB doc: Combine Cursor Methods:</a></p>\n<blockquote>\n<p>The following statements chain cursor methods <a href=\"https://docs.mongodb.com/manual/reference/method/cursor.limit/#cursor.limit\" rel=\"nofollow noreferrer\"><code>limit()</code></a> and <a href=\"https://docs.mongodb.com/manual/reference/method/cursor.sort/#cursor.sort\" rel=\"nofollow noreferrer\"><code>sort()</code></a>:</p>\n<pre><code>db.bios.find().sort( { name: 1 } ).limit( 5 )\ndb.bios.find().limit( 5 ).sort( { name: 1 } )\n</code></pre>\n<p><strong>The two statements are equivalent</strong>; i.e. the order in which you chain the <a href=\"https://docs.mongodb.com/manual/reference/method/cursor.limit/#cursor.limit\" rel=\"nofollow noreferrer\"><code>limit()</code></a> and the <a href=\"https://docs.mongodb.com/manual/reference/method/cursor.sort/#cursor.sort\" rel=\"nofollow noreferrer\"><code>sort()</code></a> methods is not significant. Both statements return the first five documents, as determined by the ascending sort order on \u2018name\u2019.</p>\n</blockquote>\n<hr />\n<p>So there is no difference, they are equivalent and thus have the same performance.</p>\n"}], "owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 47451089, "answer_count": 1, "score": 1, "last_activity_date": 1511427585, "creation_date": 1511382281, "question_id": 47443339, "link": "https://stackoverflow.com/questions/47443339/how-to-improve-performance-when-retrieving-the-last-document-from-a-collection", "title": "How to improve performance when retrieving the last document from a collection", "body": "<p>Here is a statement where <code>Limit()</code> precedes <code>Sort()</code>...</p>\n\n<pre><code>var result Candle\ndao.c.Find(bson.M{\"symbol\": \"USD\"}).Limit(1).Sort(\"-time\").One(&amp;result);\n</code></pre>\n\n<p>... and here is a statement where <code>Limit()</code> comes after <code>Sort()</code>:</p>\n\n<pre><code>var result Candle\ndao.c.Find(bson.M{\"symbol\": \"USD\"}).Sort(\"-time\").Limit(1).One(&amp;result);\n</code></pre>\n\n<p>Is there any performance difference between the statements above?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1511379189, "post_id": 47442555, "comment_id": 81840182, "body": "They do 2 different things. Do you need the functionality offered by a scanner?"}, {"owner": {"reputation": 3785, "user_id": 2659189, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/aa5208474e7a4c1b7f5dc483beb9e222?s=128&d=identicon&r=PG", "display_name": "blgrnboy", "link": "https://stackoverflow.com/users/2659189/blgrnboy"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1511379639, "post_id": 47442555, "comment_id": 81840421, "body": "As I mentioned, I literally started looking at the language just a day or two ago, so I do not fully understand the functionalities of both."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1511380372, "post_id": 47442555, "comment_id": 81840781, "body": "See <a href=\"https://golang.org/pkg/bufio/#Reader\" rel=\"nofollow noreferrer\"><code>bufio.Reader</code></a>, <a href=\"https://golang.org/pkg/bufio/#Scanner\" rel=\"nofollow noreferrer\"><code>bufio.Scanner</code></a>, and specifically the <a href=\"https://golang.org/pkg/bufio/#example_Scanner_lines\" rel=\"nofollow noreferrer\">Scanner examples</a>, since your usage isn&#39;t quite correct."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511381182, "post_id": 47442555, "comment_id": 81841123, "body": "Oh, I think I see what you&#39;re getting at. The goal either way is to read a file line by line, and both have superficially similar capabilities."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 6, "last_activity_date": 1511459965, "last_edit_date": 1511459965, "creation_date": 1511381395, "answer_id": 47443143, "question_id": 47442555, "link": "https://stackoverflow.com/questions/47442555/bufio-reader-and-bufio-scanner-functionality-and-performance/47443143#47443143", "title": "bufio.Reader and bufio.Scanner functionality and performance", "body": "<p>It's a flawed benchmark. They are not doing the same thing.</p>\n\n<pre><code>func (b *Reader) ReadLine() (line []byte, isPrefix bool, err error)\n</code></pre>\n\n<p>returns <code>[]byte</code>.</p>\n\n<pre><code>func (s *Scanner) Text() string\n</code></pre>\n\n<p>returns <code>string([]byte)</code></p>\n\n<p>To be comparable, use,</p>\n\n<pre><code>func (s *Scanner) Bytes() []byte\n</code></pre>\n\n<hr>\n\n<p>It's a flawed benchmark. It reads short strings, the integers from \"<code>0\\n</code>\" to \"<code>999999\\n</code>\". What real-world data set looks like that?</p>\n\n<p>In the real world we read Shakespeare: <a href=\"http://www.gutenberg.org/ebooks/100\" rel=\"noreferrer\">http://www.gutenberg.org/ebooks/100</a>:  Plain Text UTF-8: <code>pg100.txt</code>.</p>\n\n<pre><code>Took 2.973307ms to read file using reader.   size: 5340315 lines: 124787\nTook 2.940388ms to read file using scanner.  size: 5340315 lines: 124787\n</code></pre>\n"}], "owner": {"reputation": 3785, "user_id": 2659189, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/aa5208474e7a4c1b7f5dc483beb9e222?s=128&d=identicon&r=PG", "display_name": "blgrnboy", "link": "https://stackoverflow.com/users/2659189/blgrnboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4503, "favorite_count": 3, "accepted_answer_id": 47443143, "answer_count": 1, "score": 5, "last_activity_date": 1590352616, "creation_date": 1511379112, "last_edit_date": 1543908438, "question_id": 47442555, "link": "https://stackoverflow.com/questions/47442555/bufio-reader-and-bufio-scanner-functionality-and-performance", "title": "bufio.Reader and bufio.Scanner functionality and performance", "body": "<p>I had seen several blurbs on the interwebs which had loosely talked about why one should use bufio.Scanner instead of bufio.Reader.  </p>\n\n<p>I don't know if my test case is relevant, but I decided to test one vs the other when it comes to reading 1,000,000 lines from a text file:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"bufio\"\n    \"time\"\n    \"os\"\n    //\"bytes\"\n)\n\nfunc main() {\n\n    fileName := \"testfile.txt\"\n\n    // Create 1,000,000 integers as strings\n    numItems := 1000000\n    startInitStringArray := time.Now()\n\n    var input [1000000]string\n    //var input []string\n\n    for i:=0; i &lt; numItems; i++ {\n        input[i] = strconv.Itoa(i)\n        //input = append(input,strconv.Itoa(i))\n    }\n\n    elapsedInitStringArray := time.Since(startInitStringArray)\n    fmt.Printf(\"Took %s to populate string array.\\n\", elapsedInitStringArray)\n\n    // Write to a file\n    fo, _ := os.Create(fileName)\n    for i:=0; i &lt; numItems; i++ {\n        fo.WriteString(input[i] + \"\\n\")\n    }\n\n    fo.Close()\n\n    // Use reader\n    openedFile, _ := os.Open(fileName)\n\n    startReader := time.Now()\n    reader := bufio.NewReader(openedFile)\n\n    for i:=0; i &lt; numItems; i++ {\n        reader.ReadLine()\n    }\n    elapsedReader := time.Since(startReader)\n    fmt.Printf(\"Took %s to read file using reader.\\n\", elapsedReader)\n    openedFile.Close()\n\n    // Use scanner\n    openedFile, _ = os.Open(fileName)\n\n    startScanner := time.Now()\n    scanner := bufio.NewScanner(openedFile)\n\n    for i:=0; i &lt; numItems; i++ {\n        scanner.Scan()\n        scanner.Text()\n    }\n\n    elapsedScanner := time.Since(startScanner)\n    fmt.Printf(\"Took %s to read file using scanner.\\n\", elapsedScanner)\n    openedFile.Close()\n}\n</code></pre>\n\n<p>A pretty average output I receive on the timings looks like this:</p>\n\n<pre><code>Took 44.1165ms to populate string array.\nTook 17.0465ms to read file using reader.\nTook 23.0613ms to read file using scanner.\n</code></pre>\n\n<p>I am curious, when is it better to use a reader vs. a scanner, and is it based on performance, or functionality?</p>\n"}, {"tags": ["python", "bash", "go", "gopath"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511378297, "post_id": 47442153, "comment_id": 81839766, "body": "What does <code>go env GOPATH</code> show from within your python process? <code>go build .&#47;src&#47;folder</code> looks odd too, what exactly are you doing?"}, {"owner": {"reputation": 346, "user_id": 5735210, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b84bfb2c8eb3cebfdf62f514bee0b864?s=128&d=identicon&r=PG&f=1", "display_name": "Cit5", "link": "https://stackoverflow.com/users/5735210/cit5"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511378680, "post_id": 47442153, "comment_id": 81839928, "body": "<code>go: GOPATH entry is relative; must be absolute path: &quot;&#47;c&#47;Users&#47;CitizenCinco&#47;work&quot;.</code>  What is wrong with <code>.&#47;src&#47;folder</code>? It is the source files folder that contain my code. I want to build it and move it to the binary folder."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511379056, "post_id": 47442153, "comment_id": 81840111, "body": "I&#39;ve never run this from windows, but <code>&#47;c&#47;Users&#47;</code> might be a clue. Are you trying to run this from within cygwin or something? <code>go build .&#47;src&#47;folder</code> is odd because you packages are referenced by import path, not by a relative path; i.e. <code>go install my&#47;package&#47;name</code>, or without an argument where the <code>go</code> tool determines the name from the current directory."}, {"owner": {"reputation": 346, "user_id": 5735210, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b84bfb2c8eb3cebfdf62f514bee0b864?s=128&d=identicon&r=PG&f=1", "display_name": "Cit5", "link": "https://stackoverflow.com/users/5735210/cit5"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511380339, "post_id": 47442153, "comment_id": 81840756, "body": "yeah I am using Git Bash MINGW. I wanted to pass the path folder to <code>go build</code> because I would be able to call in from the parent directory where I manage all my other programs/tasks/etc. and still maintain Golang&#39;s suggested folder structure. Isn&#39;t being relative a bad thing here according to this error I&#39;m getting?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1511380614, "post_id": 47442153, "comment_id": 81840888, "body": "It doesn&#39;t matter where you are relative to the source. If you&#39;re not in the package directory, call <code>go build</code> or <code>go install</code> (or <code>go get</code>) with the full package identifier. It&#39;s also possible that the <code>go</code> tool doesn&#39;t work correctly under MINGW, as that&#39;s not a target which is tested or supported."}, {"owner": {"reputation": 346, "user_id": 5735210, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b84bfb2c8eb3cebfdf62f514bee0b864?s=128&d=identicon&r=PG&f=1", "display_name": "Cit5", "link": "https://stackoverflow.com/users/5735210/cit5"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511381071, "post_id": 47442153, "comment_id": 81841077, "body": "yeah its strange. if I call it directly, it works fine. When I call <code>unalias python</code>, I can run my python task normally. So I guess I will just have to alias and unalias which defeats the purpose of creating the python task in the first place. I will have to investigate another solution for python&#39;s getpass import usage with Git Bash I guess."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": -1, "last_activity_date": 1511425567, "creation_date": 1511425567, "answer_id": 47450724, "question_id": 47442153, "link": "https://stackoverflow.com/questions/47442153/gopath-interpreted-differently-when-calling-directly-versus-python-subprocess/47450724#47450724", "title": "GOPATH interpreted differently when calling directly versus Python subprocess", "body": "<p>Under Windows you <em>must</em> use a Windows style GOPATH like eg <code>d:\\code</code> and probably you should use cmd shell and nothing else. Unfortunately cygwin paths (and probably others too) do no longer work especially for go get reaching out to git.</p>\n\n<p>Stick to Windows paths and Windows shell.</p>\n"}, {"tags": [], "owner": {"reputation": 346, "user_id": 5735210, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b84bfb2c8eb3cebfdf62f514bee0b864?s=128&d=identicon&r=PG&f=1", "display_name": "Cit5", "link": "https://stackoverflow.com/users/5735210/cit5"}, "is_accepted": true, "score": 0, "last_activity_date": 1513360885, "creation_date": 1513360885, "answer_id": 47837611, "question_id": 47442153, "link": "https://stackoverflow.com/questions/47442153/gopath-interpreted-differently-when-calling-directly-versus-python-subprocess/47837611#47837611", "title": "GOPATH interpreted differently when calling directly versus Python subprocess", "body": "<p>On top of my <code>unalias python</code> fix, I also discovered something interesting: when I change the environment variables for GOPATH from <code>C:\\work;</code> to <code>C:\\go</code>, all go commands still spit the error <code>go: GOPATH entry is relative; must be absolute: \"\"</code>. I got this same error (but different path) from updating Windows 10 <a href=\"https://arstechnica.com/gadgets/2017/12/microsoft-quietly-snuck-an-ssh-client-and-server-into-the-latest-windows-10/\" rel=\"nofollow noreferrer\">Fall Creators</a> update. Maybe it is related.</p>\n\n<p>Simply closing MINGW and reopening it fixed the issue. So perhaps it was saying a copy of my environment variables and using that as a reference instead of the actual system properties.</p>\n\n<p>I know this is not a popular question, but someone could benefit from my hours of investigating and debugging.</p>\n"}], "owner": {"reputation": 346, "user_id": 5735210, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b84bfb2c8eb3cebfdf62f514bee0b864?s=128&d=identicon&r=PG&f=1", "display_name": "Cit5", "link": "https://stackoverflow.com/users/5735210/cit5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 234, "favorite_count": 0, "accepted_answer_id": 47837611, "answer_count": 2, "score": -1, "last_activity_date": 1513360885, "creation_date": 1511377574, "last_edit_date": 1511381449, "question_id": 47442153, "link": "https://stackoverflow.com/questions/47442153/gopath-interpreted-differently-when-calling-directly-versus-python-subprocess", "title": "GOPATH interpreted differently when calling directly versus Python subprocess", "body": "<p>I recently found a fix for Python getpass not working on Windows: <a href=\"https://stackoverflow.com/questions/32597209/python-not-working-in-the-command-line-of-git-bash\">Python not working in the command line of git bash</a></p>\n\n<p>Or at least that was the last thing I remember about changing my python configurations. (This is for Python 3.6.1 on Windows 10)</p>\n\n<p>Now I also use Python to other tasks which simply has subprocess calls to type several commands on terminal:</p>\n\n<pre><code>go build ./folder/\nmv ./src/ ./bin/\n</code></pre>\n\n<p>I get the error: <code>go: GOPATH entry is relative; must be absolute: \"/c/Users/OP/work\"</code>. But I don't get it if I type <code>go build ./src/folder</code> myself. \nI have GOPATH set to <code>C:\\work</code> in Environment Variables. I have tried with a <code>;</code>.</p>\n\n<p>Is there a way to reverse the alias python every time? Or what is happening exactly when setting an alias for python to winpty?</p>\n\n<p>I'm thinking that when I call go build directly, it is called by either my user profile or system. And when python's subprocess calls it, it calls the opposite. Therefore, I have two GOPATH variables even though I have only 1 set in environment variable.</p>\n\n<p>Side Note: another recent change on GOPATH was changing it from <code>C:/go</code> because it couldn't be the same as GOROOT. That error popped up randomly for some reason. It worked with that setting for a while and I don't remember changing anything before except adding another import package on top of the many other ones already being used.</p>\n\n<p>Update: with <code>type python</code> I get the result: <code>python is aliased to 'winpty python.exe'</code>. Therefore I tried to undo that with <code>unalias python</code>. The new result I get is: <code>python is hashed (/c/Users/OP/AppData/Local/Programs/Python/Python36/python)</code>. </p>\n\n<p>This fixed the <code>go build</code> command within Python's subprocess. However, that alias was a fix for another Python issue with using getpass package.</p>\n"}, {"tags": ["python", "go", "tensorflow"], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 3531540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KThmw.png?s=128&g=1", "display_name": "kgrvamsi", "link": "https://stackoverflow.com/users/3531540/kgrvamsi"}, "edited": false, "score": 0, "creation_date": 1511379242, "post_id": 47440891, "comment_id": 81840208, "body": "Hi i get the following when i tried the above code <code>&gt;&gt;&gt; hello = tf.constant(&#39;Hello, Tensorflow!&#39;) &gt;&gt;&gt; conf = tf.ConfigProto(log_device_placement=True) &gt;&gt;&gt; sess = tf.Session(config=conf) Device mapping: no known devices. 2017-11-22 19:19:26.655582: I tensorflow&#47;core&#47;common_runtime&#47;direct_session.cc:299] Device mapping:  &gt;&gt;&gt; print(sess.run(hello))</code>"}, {"owner": {"reputation": 4713, "user_id": 934904, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b3b6bc75132115c4299964be9c8e2c5f?s=128&d=identicon&r=PG", "display_name": "MatthewScarpino", "link": "https://stackoverflow.com/users/934904/matthewscarpino"}, "reply_to_user": {"reputation": 31, "user_id": 3531540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KThmw.png?s=128&g=1", "display_name": "kgrvamsi", "link": "https://stackoverflow.com/users/3531540/kgrvamsi"}, "edited": false, "score": 0, "creation_date": 1511379939, "post_id": 47440891, "comment_id": 81840557, "body": "That tells you that the session is running on the CPU, not the GPU. You can check if TensorFlow knows the GPU is there by calling <code>device_lib.list_local_devices()</code>. But first, you need to import <code>device_lib</code> with <code>from tensorflow.python.client import device_lib</code>."}, {"owner": {"reputation": 31, "user_id": 3531540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KThmw.png?s=128&g=1", "display_name": "kgrvamsi", "link": "https://stackoverflow.com/users/3531540/kgrvamsi"}, "edited": false, "score": 0, "creation_date": 1511380691, "post_id": 47440891, "comment_id": 81840917, "body": "I tried it and i get the following <code>&gt;&gt;&gt; from tensorflow.python.client import device_lib &gt;&gt;&gt; device_lib.list_local_devices() [name: &quot;&#47;device:CPU:0&quot; device_type: &quot;CPU&quot; memory_limit: 268435456 locality { } incarnation: 13755107272709323438 ]</code> so this means i&#39;m using the cpu but not gpu and i&#39;m still confused why go compiler complains that the cpu don&#39;t support the binary"}, {"owner": {"reputation": 4713, "user_id": 934904, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b3b6bc75132115c4299964be9c8e2c5f?s=128&d=identicon&r=PG", "display_name": "MatthewScarpino", "link": "https://stackoverflow.com/users/934904/matthewscarpino"}, "reply_to_user": {"reputation": 31, "user_id": 3531540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KThmw.png?s=128&g=1", "display_name": "kgrvamsi", "link": "https://stackoverflow.com/users/3531540/kgrvamsi"}, "edited": false, "score": 0, "creation_date": 1511381338, "post_id": 47440891, "comment_id": 81841193, "body": "Ah, you&#39;re talking about the &quot;Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX&quot; message. That&#39;s just a warning that tells you that TensorFlow won&#39;t use your CPU&#39;s advanced capabilities. If you want to use these capabilities, you need to build TensorFlow from source code."}, {"owner": {"reputation": 31, "user_id": 3531540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KThmw.png?s=128&g=1", "display_name": "kgrvamsi", "link": "https://stackoverflow.com/users/3531540/kgrvamsi"}, "edited": false, "score": 0, "creation_date": 1511381784, "post_id": 47440891, "comment_id": 81841404, "body": "even if its a warning i assume i can use all basic tensorflow stuff right ?"}, {"owner": {"reputation": 4713, "user_id": 934904, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b3b6bc75132115c4299964be9c8e2c5f?s=128&d=identicon&r=PG", "display_name": "MatthewScarpino", "link": "https://stackoverflow.com/users/934904/matthewscarpino"}, "reply_to_user": {"reputation": 31, "user_id": 3531540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KThmw.png?s=128&g=1", "display_name": "kgrvamsi", "link": "https://stackoverflow.com/users/3531540/kgrvamsi"}, "edited": false, "score": 0, "creation_date": 1511385583, "post_id": 47440891, "comment_id": 81843237, "body": "Right. You can use the entire TensorFlow API, but it will run faster if you build the package from source. You can suppress the warning by setting the <code>TF_CPP_MIN_LOG_LEVEL</code> environment variable to 3."}, {"owner": {"reputation": 4713, "user_id": 934904, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b3b6bc75132115c4299964be9c8e2c5f?s=128&d=identicon&r=PG", "display_name": "MatthewScarpino", "link": "https://stackoverflow.com/users/934904/matthewscarpino"}, "edited": false, "score": 0, "creation_date": 1511475731, "post_id": 47440891, "comment_id": 81882619, "body": "Yes, and it&#39;s very easy for Linux systems. The directions are at <a href=\"https://www.tensorflow.org/install/install_linux\" rel=\"nofollow noreferrer\">tensorflow.org/install/install_linux</a>."}], "tags": [], "owner": {"reputation": 4713, "user_id": 934904, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/b3b6bc75132115c4299964be9c8e2c5f?s=128&d=identicon&r=PG", "display_name": "MatthewScarpino", "link": "https://stackoverflow.com/users/934904/matthewscarpino"}, "is_accepted": false, "score": 0, "last_activity_date": 1511372453, "creation_date": 1511372453, "answer_id": 47440891, "question_id": 47440787, "link": "https://stackoverflow.com/questions/47440787/tensorflow-binary-error-python-vs-go/47440891#47440891", "title": "Tensorflow Binary Error Python vs Go", "body": "<p>TensorFlow will tell you what device a session is using if you create the session with the <code>log_device_placement</code> option set to true:</p>\n\n<pre><code>conf = tf.ConfigProto(log_device_placement=True)\nsess = tf.Session(config=conf)\nprint(sess.run(hello))\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 3531540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KThmw.png?s=128&g=1", "display_name": "kgrvamsi", "link": "https://stackoverflow.com/users/3531540/kgrvamsi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1511372453, "creation_date": 1511372091, "question_id": 47440787, "link": "https://stackoverflow.com/questions/47440787/tensorflow-binary-error-python-vs-go", "title": "Tensorflow Binary Error Python vs Go", "body": "<p>I'm not sure if the way i installed the tensorflow on my laptop is correct or not and still trying to figure out some of the issues.</p>\n\n<p>Initially i installed Tensorflow on my Mac book pro and have no luck there (will come to that later) then i installed on a vagrant box using a ubuntu 16.04 image.</p>\n\n<pre><code>(tensorflow) ubuntu@ubuntu-xenial:~$ python\nPython 2.7.12 (default, Nov 19 2016, 06:48:10) \n[GCC 5.4.0 20160609] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n&gt;&gt;&gt; import tensorflow\n&gt;&gt;&gt; import tensorflow as tf\n&gt;&gt;&gt; hello = tf.constant('Hello, TensorFlow!')\n&gt;&gt;&gt; sess = tf.Session()\n&gt;&gt;&gt; print(sess.run(hello))\nHello, TensorFlow!\n&gt;&gt;&gt; \n(tensorflow) ubuntu@ubuntu-xenial:~$ go run testing_tensor.go \n2017-11-22 15:50:43.747754: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX\nHello from TensorFlow version 1.4.0\n</code></pre>\n\n<p>Not sure how different this is from using a python library and go library and how can i identify if the tensorflow is using the cpu instead gpu?</p>\n"}, {"tags": ["go", "timezone"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1511363603, "post_id": 47438031, "comment_id": 81830611, "body": "Never omit errors, do check the returned error: <code>loc, err := time.LoadLocation(tz)</code>"}, {"owner": {"reputation": 45, "user_id": 3455961, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z4nmV.jpg?s=128&g=1", "display_name": "Brian Zhang", "link": "https://stackoverflow.com/users/3455961/brian-zhang"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1511364017, "post_id": 47438031, "comment_id": 81830926, "body": "@icza But there is no error"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1511364065, "post_id": 47438031, "comment_id": 81830959, "body": "There is no error on the Go Playground, but I&#39;m asking about your local computer where it does not work."}, {"owner": {"reputation": 45, "user_id": 3455961, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z4nmV.jpg?s=128&g=1", "display_name": "Brian Zhang", "link": "https://stackoverflow.com/users/3455961/brian-zhang"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1511364257, "post_id": 47438031, "comment_id": 81831120, "body": "I did check the error on my server. There is no error retured"}, {"owner": {"reputation": 6841, "user_id": 3960399, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/c5OVT.jpg?s=128&g=1", "display_name": "Frank Bryce", "link": "https://stackoverflow.com/users/3960399/frank-bryce"}, "edited": false, "score": 0, "creation_date": 1511364465, "post_id": 47438031, "comment_id": 81831305, "body": "This should work just fine, are you sure what you&#39;ve posted is what you are running?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 3, "creation_date": 1511364512, "post_id": 47438031, "comment_id": 81831335, "body": "That&#39;s because <a href=\"https://www.timeanddate.com/time/zone/usa/new-york\" rel=\"nofollow noreferrer\">NY <i>is</i> in EST currently</a>, so it works as expected."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1511368783, "post_id": 47438031, "comment_id": 81834395, "body": "Are you rebuilding this on the server? If so, why? Have you tried building locally and deploying the binary to the server?"}, {"owner": {"reputation": 45, "user_id": 3455961, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z4nmV.jpg?s=128&g=1", "display_name": "Brian Zhang", "link": "https://stackoverflow.com/users/3455961/brian-zhang"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1511368840, "post_id": 47438031, "comment_id": 81834435, "body": "@kostix UTC time is the unexpected result"}, {"owner": {"reputation": 45, "user_id": 3455961, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z4nmV.jpg?s=128&g=1", "display_name": "Brian Zhang", "link": "https://stackoverflow.com/users/3455961/brian-zhang"}, "reply_to_user": {"reputation": 6841, "user_id": 3960399, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/c5OVT.jpg?s=128&g=1", "display_name": "Frank Bryce", "link": "https://stackoverflow.com/users/3960399/frank-bryce"}, "edited": false, "score": 0, "creation_date": 1511368896, "post_id": 47438031, "comment_id": 81834474, "body": "@FrankBryce I tested it on my local linux virtual machine and it works as expected. The server which got the weird result is an AWS server. I posted some system info. I thought it may have sth to do with the zoneinfo.zip file in the go lib dir .So i replace it with the file in my local machine which has the  same go version but with no luck. And the most interesting thing is that other time zone name works just fine."}, {"owner": {"reputation": 45, "user_id": 3455961, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z4nmV.jpg?s=128&g=1", "display_name": "Brian Zhang", "link": "https://stackoverflow.com/users/3455961/brian-zhang"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1511369721, "post_id": 47438031, "comment_id": 81835025, "body": "@Adrian Yes, I built it locally and copy the binary to the server.Then run it and got he UTC time. So may be there is something wrong with the OS?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1511370532, "post_id": 47438031, "comment_id": 81835557, "body": "I believe on Linux, Go uses the system&#39;s tzdb; it only uses Go&#39;s built-in tzdb on Windows. So it could be an issue with the tzdb (or missing tzdb) on the server. Try a <code>sudo yum update tzdata</code> on the server and see if it helps."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1511371432, "post_id": 47438031, "comment_id": 81836119, "body": "Sorry, I missed that. I&#39;ve tested locally, and it returned EST. 1.8.3 on linux/amd64."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1511387010, "post_id": 47438031, "comment_id": 81843855, "body": "Are you running your program in a chroot environment or in a stripped-down container or on a system otherwise missing the Olson TZ data? Too tight SELinux or AppArmor or whatever policy may be?"}, {"owner": {"reputation": 45, "user_id": 3455961, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z4nmV.jpg?s=128&g=1", "display_name": "Brian Zhang", "link": "https://stackoverflow.com/users/3455961/brian-zhang"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1511403659, "post_id": 47438031, "comment_id": 81848499, "body": "@Adrian I update the tzdata and it works. Thanks"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1511427245, "post_id": 47438031, "comment_id": 81857179, "body": "@Adrian Post that as an answer."}], "answers": [{"tags": [], "owner": {"reputation": 45, "user_id": 3455961, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z4nmV.jpg?s=128&g=1", "display_name": "Brian Zhang", "link": "https://stackoverflow.com/users/3455961/brian-zhang"}, "is_accepted": true, "score": 0, "last_activity_date": 1511672521, "creation_date": 1511672521, "answer_id": 47493224, "question_id": 47438031, "link": "https://stackoverflow.com/questions/47438031/why-cant-time-in-get-the-right-time-in-the-time-zone-america-new-york/47493224#47493224", "title": "Why can&#39;t time.In() get the right time in the time zone America/New_York", "body": "<p>It turns out that the system <code>tzdata</code> package is out of date</p>\n\n<pre><code>sudo yum update tzdata\n</code></pre>\n\n<p>This command fixed the problem, as suggested by @Adrian </p>\n"}], "owner": {"reputation": 45, "user_id": 3455961, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z4nmV.jpg?s=128&g=1", "display_name": "Brian Zhang", "link": "https://stackoverflow.com/users/3455961/brian-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 47493224, "answer_count": 1, "score": 2, "last_activity_date": 1511672521, "creation_date": 1511363444, "last_edit_date": 1511366247, "question_id": 47438031, "link": "https://stackoverflow.com/questions/47438031/why-cant-time-in-get-the-right-time-in-the-time-zone-america-new-york", "title": "Why can&#39;t time.In() get the right time in the time zone America/New_York", "body": "<p>Here is my code</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"time\"\n)\n\nfunc main() {\n  tz := \"America/New_York\"\n  loc, err := time.LoadLocation(tz)\n  if err != nil {\n    fmt.Println(err)\n  }\n\n  fmt.Println(time.Now().In(loc))\n}\n</code></pre>\n\n<p>And it supposed to get the result like this <a href=\"https://play.golang.org/p/XUmf_vgWXC\" rel=\"nofollow noreferrer\">The Go Playground</a></p>\n\n<pre><code>2009-11-10 18:00:00 -0500 EST\n</code></pre>\n\n<p>The weird thing is that it prints out the <code>UTC</code> time instead of <code>EST</code> when trying to run it on my server </p>\n\n<pre><code>2017-11-22 14:53:16.94672706 +0000 UTC\n</code></pre>\n\n<hr>\n\n<p>Some environments</p>\n\n<pre><code>go version go1.8.3 linux/amd64\n\nLinux version 3.10.0-514.21.2.el7.x86_64 (mockbuild@x86-037.build.eng.bos.redhat.com) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-11) (GCC) ) #1 SMP Sun May 28 17:08:21 EDT 2017\n\nGOARCH=\"amd64\"\nGOBIN=\"\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/root/go\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/linux_amd64\"\nGCCGO=\"gccgo\"\nCC=\"gcc\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build674699918=/tmp/go-build -gno-record-gcc-switches\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\nPKG_CONFIG=\"pkg-config\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 6, "creation_date": 1511362765, "post_id": 47437737, "comment_id": 81829949, "body": "You have a busy loop in your program. There is never a reason to use an empty loop. It&#39;s just consuming 100% of a cpu for no reason, and will eventually block the runtime."}, {"owner": {"reputation": 738, "user_id": 3792660, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RneHj.jpg?s=128&g=1", "display_name": "ajnavarro", "link": "https://stackoverflow.com/users/3792660/ajnavarro"}, "edited": false, "score": 0, "creation_date": 1511364452, "post_id": 47437737, "comment_id": 81831295, "body": "Try to use <code>select{}</code> instead of <code>for{}</code>. Is not the best approach (you should use channels for this to check when the go routines finish), but for testing purposes is ok."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511364484, "post_id": 47437737, "comment_id": 81831315, "body": "Allocating a byte slice in a goroutine is fine as you can see here <a href=\"https://play.golang.org/p/8QawOUTFyb\" rel=\"nofollow noreferrer\">play.golang.org/p/8QawOUTFyb</a>, the problem in your example, as already pointed out by JimB, is the for loop."}, {"owner": {"reputation": 19, "user_id": 8990984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39bf823edcc41ec1305f1ba762c5d49b?s=128&d=identicon&r=PG&f=1", "display_name": "MattA", "link": "https://stackoverflow.com/users/8990984/matta"}, "edited": false, "score": 0, "creation_date": 1511452237, "post_id": 47437737, "comment_id": 81873020, "body": "Well I saw the for {} as an example for demonizing goroutines. I essentially have goroutines that are processing files and I needed a way to demonize them."}], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 8990984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39bf823edcc41ec1305f1ba762c5d49b?s=128&d=identicon&r=PG&f=1", "display_name": "MattA", "link": "https://stackoverflow.com/users/8990984/matta"}, "edited": false, "score": 0, "creation_date": 1511453477, "post_id": 47438459, "comment_id": 81873735, "body": "Well I have goroutines that are processing files and need to remain open and continue to remain open. The issue that I&#39;m having is running the app as a daemon and that is what spurred this issue."}, {"owner": {"reputation": 6841, "user_id": 3960399, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/c5OVT.jpg?s=128&g=1", "display_name": "Frank Bryce", "link": "https://stackoverflow.com/users/3960399/frank-bryce"}, "reply_to_user": {"reputation": 19, "user_id": 8990984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39bf823edcc41ec1305f1ba762c5d49b?s=128&d=identicon&r=PG&f=1", "display_name": "MattA", "link": "https://stackoverflow.com/users/8990984/matta"}, "edited": false, "score": 0, "creation_date": 1511571456, "post_id": 47438459, "comment_id": 81918211, "body": "Looks like <a href=\"https://stackoverflow.com/questions/23736046/how-to-create-a-daemon-process-in-golang\">this post</a> is a good place to start if you would like to make a daemon.  The main problem is you have to not have a busy-wait loop so you don&#39;t waste CPU cycles."}], "tags": [], "owner": {"reputation": 6841, "user_id": 3960399, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/c5OVT.jpg?s=128&g=1", "display_name": "Frank Bryce", "link": "https://stackoverflow.com/users/3960399/frank-bryce"}, "is_accepted": false, "score": 1, "last_activity_date": 1511364717, "creation_date": 1511364717, "answer_id": 47438459, "question_id": 47437737, "link": "https://stackoverflow.com/questions/47437737/creating-slice-byte-goroutine-hangs/47438459#47438459", "title": "Creating slice byte goroutine hangs", "body": "<p>This program hangs because there is an infinite loop in your code.  Try running the code just like this to prove it to yourself.  The goroutine is not what is causing the hanging.</p>\n\n<pre><code>func main() {\n    for {\n    }\n}\n</code></pre>\n\n<p>If you just want to see <code>fmt.Println(..)</code> print, then I'd recommend having a <a href=\"https://golang.org/pkg/time/#Sleep\" rel=\"nofollow noreferrer\"><code>time.Sleep</code></a> call or similar.</p>\n\n<p>If you would like to wait for a bunch of goroutines to complete, then I'd recommend <a href=\"https://stackoverflow.com/a/18207832/3960399\">this excellent answer</a> to that exact question.</p>\n"}, {"comments": [{"owner": {"reputation": 19, "user_id": 8990984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39bf823edcc41ec1305f1ba762c5d49b?s=128&d=identicon&r=PG&f=1", "display_name": "MattA", "link": "https://stackoverflow.com/users/8990984/matta"}, "edited": false, "score": 0, "creation_date": 1511453085, "post_id": 47444611, "comment_id": 81873509, "body": "Well I have several go routines running that are processing files, several of which use a config to determine concurrent processes. The issue is that I need to slice a file into 100MB chucks to send via an http post, so the 100MB isn&#39;t strange. As far as the for loop this issue disappeared, and now I know why, when I added my channel to return the finished files."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 19, "user_id": 8990984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39bf823edcc41ec1305f1ba762c5d49b?s=128&d=identicon&r=PG&f=1", "display_name": "MattA", "link": "https://stackoverflow.com/users/8990984/matta"}, "edited": false, "score": 0, "creation_date": 1511454803, "post_id": 47444611, "comment_id": 81874467, "body": "@MattA: Your example is very contrived. Your real-world case is different. Also, using 100MB of memory per chunk to send 100MB chunks concurrently is inefficient. How much memory will you need to support 10,000 users? You need a better strategy. Google uses Go internally for downloading: <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/BNUNbKSypE0\" rel=\"nofollow noreferrer\">dl.google.com now served by Go</a> and  <a href=\"https://talks.golang.org/2013/oscon-dl.slide#1\" rel=\"nofollow noreferrer\">dl.google.com: Powered by Go</a>."}, {"owner": {"reputation": 19, "user_id": 8990984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39bf823edcc41ec1305f1ba762c5d49b?s=128&d=identicon&r=PG&f=1", "display_name": "MattA", "link": "https://stackoverflow.com/users/8990984/matta"}, "edited": false, "score": 0, "creation_date": 1511460078, "post_id": 47444611, "comment_id": 81877138, "body": "I agree, I should have been a little more explicit with the exact issue and why I was doing it. I was more curious as to the reason behind it and now that I see the responses it makes sense. I actually need to have a channel that blocks and let&#39;s the goroutines continue until an error. As far as the inefficiency goes, this is an upload utility to a DR backup provider so there are no users. You can define max concurrent processes in the config file and that is the limit for the memory consumption. The DR api requires large files to be split into chunks and sent in the body of a POST."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1511397034, "last_edit_date": 1511397034, "creation_date": 1511388421, "answer_id": 47444611, "question_id": 47437737, "link": "https://stackoverflow.com/questions/47437737/creating-slice-byte-goroutine-hangs/47444611#47444611", "title": "Creating slice byte goroutine hangs", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/runtime/\" rel=\"nofollow noreferrer\">Package runtime</a></p>\n\n<pre><code>import \"runtime\"\n</code></pre>\n  \n  <p><a href=\"https://golang.org/pkg/runtime/#Gosched\" rel=\"nofollow noreferrer\">func Gosched</a></p>\n\n<pre><code>func Gosched()\n</code></pre>\n  \n  <p>Gosched yields the processor, allowing other goroutines to run. It\n  does not suspend the current goroutine, so execution resumes\n  automatically.</p>\n</blockquote>\n\n<hr>\n\n<p>When you do something strange (<code>for {}</code> and <code>100MB</code>), you get strange results. Do something reasonable. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n)\n\nfunc main() {\n    go createBuffer()\n    for {\n        runtime.Gosched()\n    }\n}\n\nfunc createBuffer() {\n    buffer := make([]byte, 100000000)\n    fmt.Println(len(buffer))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>100000000\n^Csignal: interrupt\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 8990984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39bf823edcc41ec1305f1ba762c5d49b?s=128&d=identicon&r=PG&f=1", "display_name": "MattA", "link": "https://stackoverflow.com/users/8990984/matta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1511460247, "creation_date": 1511362594, "last_edit_date": 1511460247, "question_id": 47437737, "link": "https://stackoverflow.com/questions/47437737/creating-slice-byte-goroutine-hangs", "title": "Creating slice byte goroutine hangs", "body": "<p>I have an upload program that I am working on and I am running into an issue. I have n go routines that handle uploading the parts to a big file. Essentially it will split the file into 100MB chunks and upload them concurrently depending on the amount of concurrent processes you specify in the config.</p>\n\n<p>The issue I'm having is when I create a buffer to read the file and upload the make([]byte, 100000000) hangs... but only if it's in a go routine. (I'm using 100000000 to simplify the upload calculations)</p>\n\n<p>Here is an example.</p>\n\n<p>This works: <a href=\"https://play.golang.org/p/tkn8JVir9S\" rel=\"nofollow noreferrer\">https://play.golang.org/p/tkn8JVir9S</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    buffer := make([]byte,  100000000)\n    fmt.Println(len(buffer))\n}\n</code></pre>\n\n<p>This doesn't: <a href=\"https://play.golang.org/p/H8626OLpqQ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/H8626OLpqQ</a></p>\n\n<pre><code>package\n\n main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    go createBuffer()\n    for {\n    }\n\n}\n\nfunc createBuffer() {\n    buffer := make([]byte, 100000000)\n    fmt.Println(len(buffer))\n}\n</code></pre>\n\n<p>It just hangs... I'm not sure if there is a memory constraint for a go routine? I tried to research and see what I could find but nothing. Any thoughts would be appreciated.</p>\n\n<p>EDIT: Thanks everyone for the feedback. I will say I didn't explain the real issue very well and will try to provide more of a holistic view next time. I ended up using a channel to block to keep my goroutines ready for new files to process. This is for a DR backup uploading to a 3rd party all that requires large files to be split into 100mb chunks. I guess I should have been more clear as to the nature of my program.</p>\n"}, {"tags": ["json", "unit-testing", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1511358343, "post_id": 47436263, "comment_id": 81826757, "body": "This is probably much easier (and more thorough) to test by mocking the service instead of the client. Take a look at <a href=\"https://golang.org/pkg/net/http/httptest/#Server\" rel=\"nofollow noreferrer\">httptest.Server</a>."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1511358344, "post_id": 47436263, "comment_id": 81826758, "body": "Make a real request to a mock server. Take a look at how the stdlib does it and use net/http/httptest."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511358569, "post_id": 47436263, "comment_id": 81826924, "body": "You can use <code>ioutil.NopCloser(bytes.NewReader(body))</code> to set the response <code>Body</code> field."}], "answers": [{"comments": [{"owner": {"reputation": 3137, "user_id": 982878, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/KoSkA.png?s=128&g=1", "display_name": "George Ananda Eman", "link": "https://stackoverflow.com/users/982878/george-ananda-eman"}, "edited": false, "score": 0, "creation_date": 1511364307, "post_id": 47436393, "comment_id": 81831167, "body": "Did some diving, <code>httptest.Server</code> particularly <code>ts := httptest.NewServer(http.HandlerFunc(handler))</code> gives me a<code>ts.URL</code> property that I can use to aim my test request at. Problem is my URL is generated on the method I&#39;m testing. I can pass the hostname part of the URL to the method, problem now is my method prepends <code>https:&#47;&#47;</code> but <code>httptest.NewServer()</code> doesnt work with <code>https:&#47;&#47;</code> it looks like. I also tried <code>httptest.NewTLSServer()</code>. still no luck. any ideas? @JimB"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 3137, "user_id": 982878, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/KoSkA.png?s=128&g=1", "display_name": "George Ananda Eman", "link": "https://stackoverflow.com/users/982878/george-ananda-eman"}, "edited": false, "score": 0, "creation_date": 1511364463, "post_id": 47436393, "comment_id": 81831301, "body": "If you need https, then you need <code>httptest.NewTLSServer()</code>. What didn&#39;t work?"}, {"owner": {"reputation": 3137, "user_id": 982878, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/KoSkA.png?s=128&g=1", "display_name": "George Ananda Eman", "link": "https://stackoverflow.com/users/982878/george-ananda-eman"}, "edited": false, "score": 0, "creation_date": 1511364785, "post_id": 47436393, "comment_id": 81831536, "body": "<code>http: TLS handshake error from 127.0.0.1:49876: remote error: tls: bad certificate</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 3137, "user_id": 982878, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/KoSkA.png?s=128&g=1", "display_name": "George Ananda Eman", "link": "https://stackoverflow.com/users/982878/george-ananda-eman"}, "edited": false, "score": 0, "creation_date": 1511364879, "post_id": 47436393, "comment_id": 81831599, "body": "Look at the <a href=\"https://golang.org/pkg/net/http/httptest/#example_NewTLSServer\" rel=\"nofollow noreferrer\">TLSServer example</a>, you need to use the test client which has the cert loaded in the transport."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 10, "last_activity_date": 1511359096, "last_edit_date": 1511359096, "creation_date": 1511358599, "answer_id": 47436393, "question_id": 47436263, "link": "https://stackoverflow.com/questions/47436263/how-to-mock-http-client-that-returns-a-json-response/47436393#47436393", "title": "How to mock http.Client that returns a JSON response", "body": "<p>While it's probably more useful to mock the full request cycle with <a href=\"https://golang.org/pkg/net/http/httptest/#Server\" rel=\"noreferrer\"><code>httptest.Server</code></a>, you can use <a href=\"https://golang.org/pkg/io/ioutil/#NopCloser\" rel=\"noreferrer\"><code>ioutil.NopCloser</code></a> to create the closer around any reader:</p>\n\n<pre><code>Body: ioutil.NopCloser(bytes.NewReader(body))\n</code></pre>\n\n<p>and if you want an empty body, just provider a reader with no content.</p>\n\n<pre><code>Body: ioutil.NopCloser(bytes.NewReader(nil))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 4351347, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EthrageVZDw/AAAAAAAAAAI/AAAAAAAAA8A/aDCk1rqI6wo/photo.jpg?sz=128", "display_name": "Dan", "link": "https://stackoverflow.com/users/4351347/dan"}, "is_accepted": false, "score": 0, "last_activity_date": 1524762345, "creation_date": 1524762345, "answer_id": 50048517, "question_id": 47436263, "link": "https://stackoverflow.com/questions/47436263/how-to-mock-http-client-that-returns-a-json-response/50048517#50048517", "title": "How to mock http.Client that returns a JSON response", "body": "<p>I know it's been a little while but I just wrote something to help with this recently.</p>\n\n<p>Like JimB I recommend starting up a real HTTP server locally, since in Go this is easy to do with <a href=\"https://golang.org/pkg/net/http/httptest/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/httptest/</a>.</p>\n\n<p>However having done a lot of HTTP mocking I wanted something that does a little more, like a good mock library would: returning specific data, easy setting of expectations, validation that all requests were made, etc. I have generally used <a href=\"https://godoc.org/github.com/stretchr/testify/mock\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/stretchr/testify/mock</a> for mocking and wanted features like that.</p>\n\n<p>So I wrote <a href=\"https://github.com/dankinder/httpmock\" rel=\"nofollow noreferrer\">https://github.com/dankinder/httpmock</a>, which basically combines the two. If you just want a mock that accepts JSON and spits out JSON, it may be an easier way to go.</p>\n"}, {"tags": [], "owner": {"reputation": 121, "user_id": 1859675, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2540032dd313f63fc2a0277aafa21106?s=128&d=identicon&r=PG", "display_name": "user1859675", "link": "https://stackoverflow.com/users/1859675/user1859675"}, "is_accepted": false, "score": 2, "last_activity_date": 1574016667, "last_edit_date": 1574016667, "creation_date": 1540906544, "answer_id": 53065560, "question_id": 47436263, "link": "https://stackoverflow.com/questions/47436263/how-to-mock-http-client-that-returns-a-json-response/53065560#53065560", "title": "How to mock http.Client that returns a JSON response", "body": "<p>In your test file (my_test.go):</p>\n\n<pre><code>type MyJSON struct {\n        Id          string\n        Age         int\n}\n\n// Interface which is the same as httpClient because it implements \"Do\" method.\ntype ClientMock struct {}\n\nfunc (c *ClientMock) Do(req *http.Request) (*http.Response, error) {\n    mockedRes := MyJSON {\"1\", 3}\n\n    // Marshal a JSON-encoded version of mockedRes\n    b, err := json.Marshal(mockedRes)\n    if err != nil {\n        log.Panic(\"Error reading a mockedRes from mocked client\", err)\n    }\n\n    return &amp;http.Response{Body: ioutil.NopCloser(bytes.NewBuffer(b))}, nil\n}\n\n// your test which will use the mocked response\nfunc TestMyFunction(t *testing.T) {\n\n    mock := &amp;ClientMock{}\n    actualResult := myFunction(mock)\n    assert.NotEmpty(t, actualResult, \"myFunction should have at least 1 result\")\n\n}\n</code></pre>\n\n<p>In your implementation (main.go):</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n)\n\nfunc main() {\n    myFunction(&amp;http.Client{})\n}\n</code></pre>\n"}], "owner": {"reputation": 3137, "user_id": 982878, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/KoSkA.png?s=128&g=1", "display_name": "George Ananda Eman", "link": "https://stackoverflow.com/users/982878/george-ananda-eman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6361, "favorite_count": 2, "accepted_answer_id": 47436393, "answer_count": 3, "score": 6, "last_activity_date": 1574016667, "creation_date": 1511358229, "question_id": 47436263, "link": "https://stackoverflow.com/questions/47436263/how-to-mock-http-client-that-returns-a-json-response", "title": "How to mock http.Client that returns a JSON response", "body": "<p>I'm trying to test a method that uses <code>net/http</code> to make requests. Specifically what I'm trying to achieve is to inject a mock <code>http.Client</code> that responds with a certain JSON body</p>\n\n<pre><code>type clientMock struct{}\n\nfunc (c *clientMock) Do(req *http.Request) (*http.Response, error) {\n  json := struct {\n    AccessToken string `json:\"access_token`\n    Scope       string `json:\"scope\"`\n  }{\n    AccessToken: \"123457678\",\n    Scope:       \"read, write\",\n  }\n  body := json.Marshal(json)\n  res := &amp;http.Response {\n    StatusCode: http.StatusOK,\n    Body:       // I haven't got a clue what to put here\n  }\n  return res\n}\n\nfunc TestRequest(t *testing.T) { //tests here }\n</code></pre>\n\n<p>I do know that the <code>Body</code> is of a  type <code>io.ReadCloser</code> interface. Trouble is I can't for the life of me find a way to implement it in the mock body response.</p>\n\n<p>Examples as found <a href=\"https://play.golang.org/p/l9HJQW37bi\" rel=\"noreferrer\" title=\"here\">here</a> so far only demonstrates returning a blank <code>&amp;http.Response{}</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1511356759, "post_id": 47435467, "comment_id": 81825635, "body": "<a href=\"https://golang.org/pkg/encoding/json/#Number\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#Number</a> Tip: Always read the whole package documentation."}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1511378015, "post_id": 47435467, "comment_id": 81839619, "body": "If the <code>position</code> field in the JSON, is always inside double quote (like <code>&quot;18&quot;</code>) then just change the tag to <code>json:&quot;position,string&quot;</code>. Otherwise you have to implement UnmarshalJSON method."}, {"owner": {"reputation": 13, "user_id": 8285139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d715208945e713b0645807903ed5110?s=128&d=identicon&r=PG", "display_name": "1mmerse", "link": "https://stackoverflow.com/users/8285139/1mmerse"}, "edited": false, "score": 0, "creation_date": 1511390516, "post_id": 47435467, "comment_id": 81845238, "body": "Thanks guys! I&#39;ll look into those options"}, {"owner": {"reputation": 13, "user_id": 8285139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d715208945e713b0645807903ed5110?s=128&d=identicon&r=PG", "display_name": "1mmerse", "link": "https://stackoverflow.com/users/8285139/1mmerse"}, "reply_to_user": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1511390830, "post_id": 47435467, "comment_id": 81845340, "body": "@KavehShahbazian yes it is double quoted, still getting the message when adding your suggestion"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1511421423, "post_id": 47435467, "comment_id": 81854075, "body": "@1mmerse I was wrong. I did not pay enough attention the the other value is <code>&quot;none&quot;</code> and not <code>&quot;&quot;</code>. This can only be implemented by writing a <code>UnmarshalJSON</code> method."}], "answers": [{"tags": [], "owner": {"reputation": 240, "user_id": 8800369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4f69be8fda374dc3075128df3a05f37?s=128&d=identicon&r=PG", "display_name": "Hein Oldewage", "link": "https://stackoverflow.com/users/8800369/hein-oldewage"}, "is_accepted": true, "score": 0, "last_activity_date": 1511444361, "creation_date": 1511444361, "answer_id": 47456895, "question_id": 47435467, "link": "https://stackoverflow.com/questions/47435467/json-response-is-int-but-string-when-empty/47456895#47456895", "title": "JSON response is int but string when empty", "body": "<p>Change the type to <code>interface{}</code>, and then you can check the type at runtime.</p>\n\n<pre><code>type example struct {    \n    Position interface{} `json:\"position\"`\n}\n/*\nReturns an int and a bool, indicating if a position exists.\n*/\nfunc (e * example) getValue() (int,bool){\n    if v,ok := Position.(int) {\n      return v,true\n    } else {\n     return 0,false\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 8285139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d715208945e713b0645807903ed5110?s=128&d=identicon&r=PG", "display_name": "1mmerse", "link": "https://stackoverflow.com/users/8285139/1mmerse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 1, "accepted_answer_id": 47456895, "answer_count": 1, "score": 0, "last_activity_date": 1511444361, "creation_date": 1511355863, "last_edit_date": 1511390931, "question_id": 47435467, "link": "https://stackoverflow.com/questions/47435467/json-response-is-int-but-string-when-empty", "title": "JSON response is int but string when empty", "body": "<p>I am unmarshalling a JSON response into a struct. For one of the fields, it returns an int and a string when empty.</p>\n\n<pre><code>type example struct {    \n  Position int `json:\"position\"`\n}\n\njson: cannot unmarshal string into Go struct field .position of type int\n</code></pre>\n\n<p>The response is either </p>\n\n<pre><code>{\"position\":8} or {\"position\":\"none\"}\n</code></pre>\n\n<p>How can I handle both an int and string response?</p>\n"}, {"tags": ["go", "methods", "struct", "slice"], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 8215010, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bgkKY.png?s=128&g=1", "display_name": "AHahn94", "link": "https://stackoverflow.com/users/8215010/ahahn94"}, "edited": false, "score": 0, "creation_date": 1511355436, "post_id": 47435232, "comment_id": 81824709, "body": "Thanks. I used (self *Guest) previously but removed the pointer while trying to fix the problem. I added it again, but it did not fix the problem. I modified my question accordingly."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 25, "user_id": 8215010, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bgkKY.png?s=128&g=1", "display_name": "AHahn94", "link": "https://stackoverflow.com/users/8215010/ahahn94"}, "edited": false, "score": 0, "creation_date": 1511355628, "post_id": 47435232, "comment_id": 81824852, "body": "@AHahn94 It works for me. Added an example on the Go Playground. See edited answer."}, {"owner": {"reputation": 25, "user_id": 8215010, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bgkKY.png?s=128&g=1", "display_name": "AHahn94", "link": "https://stackoverflow.com/users/8215010/ahahn94"}, "edited": false, "score": 0, "creation_date": 1511360277, "post_id": 47435232, "comment_id": 81828088, "body": "Thank you for the example. It does indeed work. Maybe my problem is rather related to the fact that I have a slice of guest-objects like this: \tvar guests []Guest"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 25, "user_id": 8215010, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bgkKY.png?s=128&g=1", "display_name": "AHahn94", "link": "https://stackoverflow.com/users/8215010/ahahn94"}, "edited": false, "score": 0, "creation_date": 1511360656, "post_id": 47435232, "comment_id": 81828362, "body": "@AHahn94 It works with slices too. Post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> if you want help with that."}, {"owner": {"reputation": 25, "user_id": 8215010, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bgkKY.png?s=128&g=1", "display_name": "AHahn94", "link": "https://stackoverflow.com/users/8215010/ahahn94"}, "edited": false, "score": 0, "creation_date": 1511360889, "post_id": 47435232, "comment_id": 81828525, "body": "I got it working. I had to change the slice from &quot;var guests []Guest&quot; to &quot;var guests []*Guest&quot;, and then fix some argument and return types, as well as the initialization of the elements with &quot;&amp;Guest{}&quot; instead of &quot;Guest{}&quot;. After that, it works. Thank you realy much!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1511355600, "last_edit_date": 1511355600, "creation_date": 1511355068, "answer_id": 47435232, "question_id": 47435161, "link": "https://stackoverflow.com/questions/47435161/remove-an-element-of-a-slice-in-a-struct/47435232#47435232", "title": "Remove an element of a slice in a struct", "body": "<p>Any method that intends / does modify the receiver must use a pointer receiver.</p>\n\n<p>Your <code>Guest.removeFriend()</code> method indeed tries to modify the receiver (of type <code>Guest</code>), namely its <code>friends</code> field (which is of slice type), but since you only used a value receiver, you are only modifying the <code>friends</code> field of a <code>Guest</code> copy. The original <code>Guest</code> value will have the unmodified slice value.</p>\n\n<p>So you <strong>must</strong> use a pointer receiver:</p>\n\n<pre><code>func (self *Guest) removeFriend(id int) {\n    // ...\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>g := &amp;Guest{\n    id:      1,\n    name:    \"Bob\",\n    surname: \"Pats\",\n    friends: []int{1, 2, 3, 4, 5},\n}\n\nfmt.Println(g)\ng.removeFriend(3)\nfmt.Println(g)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/Bv-RVn6Btc\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>&amp;{1 Bob Pats [1 2 3 4 5]}\n&amp;{1 Bob Pats [1 2 4 5]}\n</code></pre>\n\n<p>The explanation for what you see in your version that slices are small struct descriptors pointing to an array that actually holds the elements. In your example you modified the elements of the backing array, so the caller having the original slice will see those modifications, but the size of the original slice will not (cannot) change.</p>\n\n<p>By using a pointer receiver, you will assign the new slice value (returned by <code>append()</code>) to the <code>friends</code> field of the original <code>Guest</code>, the slice value whose length will be smaller by 1 (due to the 1 removed element).</p>\n\n<p>Also note that in Go using receiver names like <code>self</code> and <code>this</code> is not idiomatic, instead you could use <code>guest</code> or simply <code>g</code>.</p>\n"}], "owner": {"reputation": 25, "user_id": 8215010, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bgkKY.png?s=128&g=1", "display_name": "AHahn94", "link": "https://stackoverflow.com/users/8215010/ahahn94"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1755, "favorite_count": 0, "closed_date": 1511356934, "accepted_answer_id": 47435232, "answer_count": 1, "score": 0, "last_activity_date": 1546548028, "creation_date": 1511354889, "last_edit_date": 1546548028, "question_id": 47435161, "link": "https://stackoverflow.com/questions/47435161/remove-an-element-of-a-slice-in-a-struct", "closed_reason": "Duplicate", "title": "Remove an element of a slice in a struct", "body": "<p>I have a struct \"Guest\" which contains metadata of a party guest (a unique ID, name, surname and a list of the unique IDs of the guests who are friends of this guest.</p>\n\n<pre><code>type Guest struct {\n    id      int\n    name    string\n    surname string\n    friends []int\n}\n</code></pre>\n\n<p>I have the following code to remove an ID from the list of friends:</p>\n\n<pre><code>func (self Guest) removeFriend(id int) {\n    for i, other := range self.friends {\n        if other == id {\n            self.friends = append(self.friends[:i], self.friends[i+1:]...)\n            break\n        }\n    }\n}\n</code></pre>\n\n<p>The problem is: The element I want to remove is overwritten by the shift of the elements, but the slice does not get shorter. Instead, the last element of the slice is multiplied.</p>\n\n<p>To give an example: <code>guest1.friends</code> is <code>[1,2,3,4,5]</code>. After I call <code>guest1.removeFriend(3)</code>, the result is <code>[1,2,4,5,5]</code> instead of the desired <code>[1,2,4,5]</code>.</p>\n\n<p>So, what am I doing wrong?</p>\n"}, {"tags": ["go", "cassandra", "cql", "gocql"], "comments": [{"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1511365848, "post_id": 47434206, "comment_id": 81832317, "body": "I&#39;m using gocql for first time so not really sure what the issue is, but looks like CQLC is just a wrapper around gocql? <a href=\"https://github.com/gocql/gocql/blob/f5cee644705e9593c342bfabe667720580a5289f/conn.go#L783\" rel=\"nofollow noreferrer\">github.com/gocql/gocql/blob/&hellip;</a>.  Is page state handling specified by the cql spec and gocql handling of it doesn&#39;t comply with the specification? or is gocql handling of it something you found unintuitive?"}, {"owner": {"reputation": 517, "user_id": 2138524, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EOhzF.jpg?s=128&g=1", "display_name": "Tanny", "link": "https://stackoverflow.com/users/2138524/tanny"}, "reply_to_user": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1511519843, "post_id": 47434206, "comment_id": 81897215, "body": "@dm03514 Does cassandra return page token for boundary limit cases?"}], "owner": {"reputation": 517, "user_id": 2138524, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EOhzF.jpg?s=128&g=1", "display_name": "Tanny", "link": "https://stackoverflow.com/users/2138524/tanny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 480, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1511352061, "creation_date": 1511352061, "question_id": 47434206, "link": "https://stackoverflow.com/questions/47434206/cqlc-go-cassandra-query-returning-page-token-for-boundary-limit", "title": "CQLC: Go Cassandra query returning page token for boundary limit?", "body": "<p>In my Cassandra database for a particular query, I have 8 records, and I am using GoLang <a href=\"https://github.com/relops/cqlc\" rel=\"nofollow noreferrer\">relops/cqlc</a> library.</p>\n\n<p>When I query with limit = 8, it returns 8 records with a PageState which is to be used as page token for the next set of results. I don't think it should have returned that PageState. And also as expected when I query again with that page_token and the same query parameters, it returns no data.</p>\n\n<p>The same thing does not happen if I increase the limit by one more, say 9.</p>\n\n<p>Did someone else face a similar issue? Any hints as to what might be the issue?</p>\n"}, {"tags": ["go", "synchronization"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1511350747, "post_id": 47433579, "comment_id": 81821691, "body": "Regular maps are not safe to write concurrently (as you seem to know). In the 1.9 release there is a concurrent map in <code>sync.Map</code>. You might use that to make sure you don&#39;t have a race condition on write. That said, with each item having a mutex, you only need to worry about adding a new item. You could have a mutex just for adding to the map with a double check after obtaining the lock to make sure you don&#39;t add the same item."}, {"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 1, "creation_date": 1511351747, "post_id": 47433579, "comment_id": 81822320, "body": "Locking your map and locking bunch of structs in the map are 2 different activities. When you are doing any changes to the map itself you need to lock/unlock every reads/writes/deletes of the map. When you locking/unlocking your structs that are inside the map this activity is separate from locking your map."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1511352155, "post_id": 47433579, "comment_id": 81822591, "body": "I forget that maps also cannot be concurrently read if another routine is writing. A write could trigger a rebuild of the underlying buckets, causing a read to go awry. Just use <code>sync.Map</code>."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1511358298, "post_id": 47433579, "comment_id": 81826730, "body": "@RayfenWindspear: &quot;Just use sync.Map.&quot; Read the instructions before using.  &quot;It is optimized for use in concurrent loops with keys that are stable over time, and either few steady-state stores, or stores localized to one goroutine per key. For use cases that do not share these attributes, it will likely have comparable or worse performance and worse type safety than an ordinary map paired with a read-write mutex.&quot; <a href=\"https://golang.org/pkg/sync/#Map\" rel=\"nofollow noreferrer\">sync.Map</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1511358960, "post_id": 47433579, "comment_id": 81827227, "body": "@peterSO sorry, it&#39;s late, I forgot to add to my comment that using sync.Map is the easiest way to not mess it up accidentally, as is so easily done when dealing with concurrency."}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 1, "last_activity_date": 1511359834, "last_edit_date": 1511359834, "creation_date": 1511355347, "answer_id": 47435319, "question_id": 47433579, "link": "https://stackoverflow.com/questions/47433579/initializing-map-elements-where-value-is-a-struct-with-mutex-lock-golang/47435319#47435319", "title": "Initializing map elements, where value is a struct with mutex lock golang", "body": "<p>The Go's map semantics are as follows:</p>\n\n<ul>\n<li><p>A map stores <em>values</em> (not variables) and that's why these values are\nnot adressable, and that's why you can't do something like</p>\n\n<pre><code>type T struct {\n    X int\n}\nm := make(map[int]T)\nm[0] = T{}\nm[0].x = 42 // won't compile\n</code></pre></li>\n<li><p>This requirement mostly comes from from the fact a map, being\nan intricate dynamic data structure, should allow its particular\nimplementations to physically <em>move</em> the values it contains\naround in memory \u2014 when doing rebalancing etc.</p></li>\n</ul>\n\n<p>That's why the only three operations a map supports is adding\n(or replacing) of its elements, getting them back and deleting them.</p>\n\n<p>A map is not safe for concurrent use, so in order to do any of those three\noperations on the same map concurrently, you need to protect it in\none way or another.</p>\n\n<p>Consequently, once you have read a value from a map, orchestrating\nconcurrent access to <em>it</em> is a completely another story,\nand here we're facing another fact about the map's semantics:\nsince it keeps values and is free to <em>copy</em> them around in memory,\nit's not allowed to keep in a map anything which you want to have\nreference semantics. For instance, it would be incorrect to keep values\nof your <code>Stats</code> type in the map directly\u2014because they embed instances\nof <code>sync.Mutex</code>, and copying of them prohibited after they are first used.\nHere you're already doing the right thing by storing pointers to your\nvariables.</p>\n\n<p>Now you can see that it's pretty OK to roll like this:</p>\n\n<ol>\n<li>Access the map itself to get a value bound to a key in a concurrent-safe\nway (say, by holding a lock).</li>\n<li>Lock the mutex on that variable and operate on it. That does not\ninvolve the map at all.</li>\n</ol>\n\n<p>The only remaining possible problem is as follows.\nSuppose you're protecting the access to your map with a lock.\nSo you grab the lock, obtain the value bound to a key, <em>by copying\nit to a variable,</em> release the lock and work with the copy of the\nvalue.</p>\n\n<p>Now while you're working with the copy of that value another\ngoroutine is free to update the map by deleting the value or replacing it.</p>\n\n<p>While in your case it's fine technically \u2014 because your map operates on\npointers to variables, and it's fine to copy pointers \u2014 this might be inappropriate from the standpoint of the semantics of your program,\nand this is something you have to think through.\nTo make it more clear, once you've got a pointer to some instance of <code>Stats</code>\nand locked <em>it,</em> a pointer to this instance can be removed from the map,\nor the map entry which held it could be updated by another pointer \u2014\npointing to another instance of <code>Stats</code>, so once you're done with the\ninstance, it might have become unreachable via the map.</p>\n"}], "owner": {"reputation": 33, "user_id": 8989180, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9dea1e52eb88179659ae919e3afb552?s=128&d=identicon&r=PG&f=1", "display_name": "amtize", "link": "https://stackoverflow.com/users/8989180/amtize"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1426, "favorite_count": 0, "accepted_answer_id": 47435319, "answer_count": 1, "score": 1, "last_activity_date": 1511359834, "creation_date": 1511350142, "last_edit_date": 1511353017, "question_id": 47433579, "link": "https://stackoverflow.com/questions/47433579/initializing-map-elements-where-value-is-a-struct-with-mutex-lock-golang", "title": "Initializing map elements, where value is a struct with mutex lock golang", "body": "<p>I have a map where every value is a pointer to another struct that itself has a lock. </p>\n\n<pre><code>type StatMap map[string]*Stats\n\ntype Stats struct {\n    sync.RWMutex\n    someStats, someMoreStats float64\n}\n</code></pre>\n\n<p>I have implemented a method where I pack the StatMap into another struct and have a Mutex lock for the entire map, but I am expecting to modify every entry in the map simoultaniously from hundreds of goroutines, so it would be more effective to lock every element in the map so that two or more goroutines can read and modify values for entries in parallell.</p>\n\n<p>What I am wondering is how I can initialize a new entry in the map whenever there comes a new key? I cannot lock the entry if it isn't in the map already, and I cannot check if it is in the map (as far as I know) in case another goroutine is currently modifying that entry. </p>\n\n<p>I do not know what keys will be in the map before runtime. </p>\n\n<p>My current implementation (that causes data races):</p>\n\n<pre><code>initializeStatMap(\"key\")\nstatMap[\"key\"].Lock()\n// . . . \n\n\nfunc initializeStatMap(key string) {\n    if statMap[key] != nil {\n        return\n    }\n    statMap[key] = &amp;Stats{someStats: 0, someMoreStats: 0}\n}\n</code></pre>\n"}, {"tags": ["json", "go", "struct", "slice"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1511349499, "post_id": 47433296, "comment_id": 81820843, "body": "What part of the error is confusing you? It tells you exactly the problem."}], "answers": [{"comments": [{"owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1511354593, "post_id": 47433356, "comment_id": 81824125, "body": "How can I do without explictly declaring &quot;InfoA  &quot;, &quot;InfoAB&quot;, etc in structs  ?  I implemented a solution (<a href=\"https://play.golang.org/p/3NoMXoyOCU\" rel=\"nofollow noreferrer\">play.golang.org/p/3NoMXoyOCU</a>), but I got empty result. I don&#39;t see how it might be implemented."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1511354788, "post_id": 47433356, "comment_id": 81824257, "body": "@LeMoussel See <a href=\"https://stackoverflow.com/questions/29347092/how-to-parse-deserlize-a-dynamic-json-in-golang/29347148#29347148\">this answer</a> and <a href=\"https://stackoverflow.com/questions/46585279/unmarshal-json-string-to-a-struct-that-have-one-element-of-the-struct-itself/46585770#46585770\">this answer</a>."}, {"owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1511355404, "post_id": 47433356, "comment_id": 81824680, "body": "Solution:  <code>params2 := make(map[string][]int)</code> <code>_= json.Unmarshal(rawJSON, &amp;params2)</code> <code>fmt.Printf(&quot;\\nparams2: %+v&quot;, params2)</code>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1511349444, "creation_date": 1511349444, "answer_id": 47433356, "question_id": 47433296, "link": "https://stackoverflow.com/questions/47433296/json-error-cannot-unmarshal-object-into-go-value/47433356#47433356", "title": "json error, cannot unmarshal object into Go value", "body": "<p>The JSON source is a single object, yet you try to unmarshal it into a slice. Change the type of <code>params</code> to <code>paramsInfo</code> (non-slice):</p>\n\n<pre><code>var params paramsInfo\nerr := json.Unmarshal(rawJSON, &amp;params)\nif err != nil {\n    fmt.Println(err.Error())\n    os.Exit(1)\n}\nfmt.Printf(\"%+v\", params)\n</code></pre>\n\n<p>And with that the output (try it on the <a href=\"https://play.golang.org/p/d_a9i6A3BI\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>{InfoA:[256 256 20000] InfoB:[256 512 15000] InfoC:[208 512 20000]\n    DEFAULT:[256 256 20000]}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "is_accepted": false, "score": 2, "last_activity_date": 1512641461, "last_edit_date": 1512641461, "creation_date": 1511350355, "answer_id": 47433648, "question_id": 47433296, "link": "https://stackoverflow.com/questions/47433296/json-error-cannot-unmarshal-object-into-go-value/47433648#47433648", "title": "json error, cannot unmarshal object into Go value", "body": "<p>You are decoding a single JSON object but you are attempting to put it into the <code>[]paramsInfo</code> slice.</p>\n\n<p>It works fine when you decode JSON array of objects:</p>\n\n<pre><code>rawJSON := []byte(`[{\n    \"InfoA\" : [256,256,20000],\n    \"InfoB\" : [256,512,15000],\n    \"InfoC\" : [208,512,20000],\n    \"DEFAULT\" : [256,256,20000]\n}]`)\n</code></pre>\n\n<p>(note the square brackets around your object)</p>\n\n<p>By the way, in the <code>if</code> branch handling an error you don't need to call <code>err.Error()</code> to get the error string; <code>fmt.Println(err)</code> is sufficient and it's actually a Go idiom to use it like this. The implementation of <code>fmt.Print*</code> is taking care of handling the <code>error</code> type (contrary to <code>print</code> for example).</p>\n"}], "owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6642, "favorite_count": 0, "accepted_answer_id": 47433356, "answer_count": 2, "score": 4, "last_activity_date": 1576074783, "creation_date": 1511349242, "last_edit_date": 1576074783, "question_id": 47433296, "link": "https://stackoverflow.com/questions/47433296/json-error-cannot-unmarshal-object-into-go-value", "title": "json error, cannot unmarshal object into Go value", "body": "<p>I have this JSON data:</p>\n\n<pre><code>{\n\"InfoA\" : [256,256,20000],\n\"InfoB\" : [256,512,15000],\n\"InfoC\" : [208,512,20000],\n\"DEFAULT\" : [256,256,20000]\n}\n</code></pre>\n\n<p>With <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">JSON-to-Go</a>, I get this Go type definition:</p>\n\n<pre><code>type AutoGenerated struct {\n    InfoA   []int `json:\"InfoA\"`\n    InfoB   []int `json:\"InfoB\"`\n    InfoC   []int `json:\"InfoC\"`\n    DEFAULT []int `json:\"DEFAULT\"`\n}\n</code></pre>\n\n<p>With this code (<a href=\"https://play.golang.org/p/k_ly0IGH1A\" rel=\"nofollow noreferrer\">play.golang.org</a>)</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"os\"\n    \"strings\"\n)\n\nfunc main() {\n    type paramsInfo struct {\n        InfoA   []int `json:\"InfoA\"`\n        InfoB   []int `json:\"InfoB\"`\n        InfoC   []int `json:\"InfoC\"`\n        DEFAULT []int `json:\"DEFAULT\"`\n    }\n    rawJSON := []byte(`{\n\"InfoA\" : [256,256,20000],\n\"InfoB\" : [256,512,15000],\n\"InfoC\" : [208,512,20000],\n\"DEFAULT\" : [256,256,20000]\n}`)\n    var params []paramsInfo\n    err := json.Unmarshal(rawJSON, &amp;params)\n    if err != nil {\n        fmt.Println(err.Error())\n        os.Exit(1)\n    }\n}\n</code></pre>\n\n<p>I get error <code>json: cannot unmarshal object into Go value of type []main.paramsInfo</code> </p>\n\n<p>I don't understand why. Can you help me?</p>\n"}, {"tags": ["firebase", "go", "google-api", "firebase-authentication", "firebase-cloud-messaging"], "comments": [{"owner": {"reputation": 33081, "user_id": 4625829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/tw3Uk.png?s=128&g=1", "display_name": "AL.", "link": "https://stackoverflow.com/users/4625829/al"}, "edited": false, "score": 0, "creation_date": 1511363935, "post_id": 47431757, "comment_id": 81830863, "body": "Hi. Sorry, could you point me to the documentation where it says that you need an <i>access token</i> to send FCM messages from Go? AFAIK, you should only need the <i>Server Key</i> and a valid target to send an FCM message."}, {"owner": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "reply_to_user": {"reputation": 33081, "user_id": 4625829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/tw3Uk.png?s=128&g=1", "display_name": "AL.", "link": "https://stackoverflow.com/users/4625829/al"}, "edited": false, "score": 0, "creation_date": 1511364092, "post_id": 47431757, "comment_id": 81830983, "body": "On the newer protocol FCM v1 HTTP API, you need an access token, as reported here: <a href=\"https://firebase.google.com/docs/cloud-messaging/auth-server\" rel=\"nofollow noreferrer\">firebase.google.com/docs/cloud-messaging/auth-server</a>"}, {"owner": {"reputation": 33081, "user_id": 4625829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/tw3Uk.png?s=128&g=1", "display_name": "AL.", "link": "https://stackoverflow.com/users/4625829/al"}, "edited": false, "score": 1, "creation_date": 1511365553, "post_id": 47431757, "comment_id": 81832114, "body": "Okay. I did a quick read through. I haven&#39;t experienced using FCM from a Service account, nor using Go lang. But basing from the <a href=\"https://github.com/google/google-api-go-client/blob/master/GettingStarted.md\" rel=\"nofollow noreferrer\">Git guide</a> link, the package that you would most need is <code>golang.org&#47;x&#47;oauth2</code>. Instantiating the GoogleCredentials is something I can&#39;t figure out tho. Sorry wasn&#39;t able to help out."}, {"owner": {"reputation": 33081, "user_id": 4625829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/tw3Uk.png?s=128&g=1", "display_name": "AL.", "link": "https://stackoverflow.com/users/4625829/al"}, "edited": false, "score": 1, "creation_date": 1512719875, "post_id": 47431757, "comment_id": 82379714, "body": "Hey @DanieleB. There was a recent vid uploaded by Firebase about <a href=\"https://youtu.be/VuqEOjBMQWE\" rel=\"nofollow noreferrer\">getting auth tokens via the Admin SDK using Go</a>. Not sure if it would help, your post came to mind when I saw it. Good luck."}, {"owner": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "reply_to_user": {"reputation": 33081, "user_id": 4625829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/tw3Uk.png?s=128&g=1", "display_name": "AL.", "link": "https://stackoverflow.com/users/4625829/al"}, "edited": false, "score": 1, "creation_date": 1512720619, "post_id": 47431757, "comment_id": 82380020, "body": "@AL. thanks. This is the same content that was published on the firebase blog in August: <a href=\"https://firebase.googleblog.com/2017/08/introducing-firebase-admin-sdk-for-go.html\" rel=\"nofollow noreferrer\">firebase.googleblog.com/2017/08/&hellip;</a> but these <code>custom tokens</code> seem to be something different from the <code>access tokens</code> that are required for Cloud Messsaging."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user4653455"}, "is_accepted": false, "score": 1, "last_activity_date": 1514574851, "creation_date": 1514574851, "answer_id": 48027325, "question_id": 47431757, "link": "https://stackoverflow.com/questions/47431757/fcm-http-v1-how-to-get-access-token-using-go/48027325#48027325", "title": "FCM HTTP v1: how to get access token using Go?", "body": "<p>I'm working on the go firebase SDK to add FCM HTTP v1.</p>\n\n<p>For now it's almost finished, i have to write tests and integration tests, you can check the code here : <a href=\"https://github.com/chemidy/firebase-admin-go/tree/fcm/messaging\" rel=\"nofollow noreferrer\">https://github.com/chemidy/firebase-admin-go/tree/fcm/messaging</a></p>\n\n<p>I will finish tests and send a PR maybe next week, (it's a little bit tricky to test on ios + android + web) </p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 6508348, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/954c6b2a41795a58d5a42e15d68cc448?s=128&d=identicon&r=PG&f=1", "display_name": "zoro zoro", "link": "https://stackoverflow.com/users/6508348/zoro-zoro"}, "is_accepted": false, "score": 0, "last_activity_date": 1573429327, "creation_date": 1573429327, "answer_id": 58793960, "question_id": 47431757, "link": "https://stackoverflow.com/questions/47431757/fcm-http-v1-how-to-get-access-token-using-go/58793960#58793960", "title": "FCM HTTP v1: how to get access token using Go?", "body": "<p>i am put header Authorization by used volly</p>\n\n<pre><code>  @Override\n            public Map&lt;String, String&gt; getHeaders() throws AuthFailureError {\n                Map&lt;String, String&gt; headerMap = new HashMap&lt;String, String&gt;();\n                headerMap.put(\"Content-Type\", \"application/json\");\n                headerMap.put(\"Authorization\", \"Bearer \" + key);\n                Log.v(TAG,\"getHeaders \"+headerMap);\n\n                return headerMap;\n            }\n</code></pre>\n\n<p>but send Authorization=Bearer  Add..</p>\n\n<p>how change to current \nAuthorization:Bearer  </p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 15128668, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kECVH.png?s=128&g=1", "display_name": "andhikaprbw", "link": "https://stackoverflow.com/users/15128668/andhikaprbw"}, "is_accepted": false, "score": 0, "last_activity_date": 1612491056, "last_edit_date": 1612491056, "creation_date": 1612339456, "answer_id": 66023441, "question_id": 47431757, "link": "https://stackoverflow.com/questions/47431757/fcm-http-v1-how-to-get-access-token-using-go/66023441#66023441", "title": "FCM HTTP v1: how to get access token using Go?", "body": "<p>FCM httpv1 use JSON file for it credentials.</p>\n<p>Download it first, then move it to your project.\n<a href=\"https://i.stack.imgur.com/3aZhH.png\" rel=\"nofollow noreferrer\">download JSON credentials in your firebase</a></p>\n<p>second, do :</p>\n<pre><code>go get &quot;golang.org/x/oauth2/google&quot;\n</code></pre>\n<p>then use this method to get token</p>\n<pre><code>const firebaseScope = &quot;https://www.googleapis.com/auth/firebase.messaging&quot;\n\ntype tokenProvider struct {\n    tokenSource oauth2.TokenSource\n}\n\n// newTokenProvider function to get token for fcm-send\nfunc newTokenProvider(credentialsLocation string) (*tokenProvider, error) {\n    jsonKey, err := ioutil.ReadFile(credentialsLocation)\n    if err != nil {\n        return nil, errors.New(&quot;fcm: failed to read credentials file at: &quot; + credentialsLocation)\n    }\n    cfg, err := google.JWTConfigFromJSON(jsonKey, firebaseScope)\n    if err != nil {\n        return nil, errors.New(&quot;fcm: failed to get JWT config for the firebase.messaging scope&quot;)\n    }\n    ts := cfg.TokenSource(context.Background())\n    return &amp;tokenProvider{\n        tokenSource: ts,\n    }, nil\n}\n\nfunc (src *tokenProvider) token() (string, error) {\n    token, err := src.tokenSource.Token()\n    if err != nil {\n        return &quot;&quot;, errors.New(&quot;fcm: failed to generate Bearer token&quot;)\n    }\n    return token.AccessToken, nil\n}\n</code></pre>\n<p>Then call it in your FCM-Send method :</p>\n<pre><code>tp, err := newTokenProvider(&quot;yourJSONFileLocation&quot;)\nif err != nil {\n    return nil, err\n}\ntoken, err := tp.token()\nif err != nil {\n    return nil, err\n}\n</code></pre>\n<p>last, add it to header :</p>\n<pre><code>r.Header.Add(&quot;Authorization&quot;, &quot;Bearer &quot;+token)\n</code></pre>\n<p>Done.</p>\n"}], "owner": {"reputation": 16583, "user_id": 913867, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/hUicX.jpg?s=128&g=1", "display_name": "Daniele B", "link": "https://stackoverflow.com/users/913867/daniele-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1776, "favorite_count": 1, "answer_count": 3, "score": 4, "last_activity_date": 1612491056, "creation_date": 1511345094, "last_edit_date": 1511351821, "question_id": 47431757, "link": "https://stackoverflow.com/questions/47431757/fcm-http-v1-how-to-get-access-token-using-go", "title": "FCM HTTP v1: how to get access token using Go?", "body": "<p>In order to send Firebase Cloud Messaging with Go, we need to place the access token in the HTTP request header.</p>\n\n<p>On Firebase documentation,\nthere are examples on how to retrieve the access token using <em>Node.JS</em>, <em>Python</em> and <em>Java</em>:</p>\n\n<p><a href=\"https://firebase.google.com/docs/cloud-messaging/auth-server\" rel=\"nofollow noreferrer\">https://firebase.google.com/docs/cloud-messaging/auth-server</a></p>\n\n<p>can anyone show the get the access token using <strong>Go</strong>?</p>\n\n<p>There seems to be many Go packages about Firebase/Google authentication. It's very confusing to understand which ones should be used:</p>\n\n<ul>\n<li>firebase.google.com/go</li>\n<li>firebase.google.com/go/auth</li>\n<li>github.com/firebase/firebase-admin-go</li>\n<li>google.golang.org/api/option</li>\n<li>golang.org/x/oauth2</li>\n<li>golang.org/x/oauth2/google</li>\n<li>github.com/google/google-api-go-client</li>\n</ul>\n"}, {"tags": ["go", "thrift"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 2, "creation_date": 1511347572, "post_id": 47431603, "comment_id": 81819574, "body": "Have you tried using <a href=\"https://godoc.org/github.com/nporsche/golang-thrift#NewTMemoryBuffer\" rel=\"nofollow noreferrer\"><code>NewTMemoryBuffer</code></a> instead of creating a type explicitly?"}, {"owner": {"reputation": 1806, "user_id": 779666, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/d4OTd.jpg?s=128&g=1", "display_name": "T.Coutlakis", "link": "https://stackoverflow.com/users/779666/t-coutlakis"}, "reply_to_user": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1511348397, "post_id": 47431603, "comment_id": 81820161, "body": "@abhink That is working, thank you!  However I cannot understand why."}], "answers": [{"comments": [{"owner": {"reputation": 1806, "user_id": 779666, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/d4OTd.jpg?s=128&g=1", "display_name": "T.Coutlakis", "link": "https://stackoverflow.com/users/779666/t-coutlakis"}, "edited": false, "score": 0, "creation_date": 1511351470, "post_id": 47433519, "comment_id": 81822130, "body": "Gosh I can&#39;t believe I was tearing my hair out over a missing ampersand!  Thank you for the in depth answer and explanation.  It all makes sense now."}], "tags": [], "owner": {"reputation": 240, "user_id": 8800369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4f69be8fda374dc3075128df3a05f37?s=128&d=identicon&r=PG", "display_name": "Hein Oldewage", "link": "https://stackoverflow.com/users/8800369/hein-oldewage"}, "is_accepted": true, "score": 5, "last_activity_date": 1511349996, "creation_date": 1511349996, "answer_id": 47433519, "question_id": 47431603, "link": "https://stackoverflow.com/questions/47431603/how-do-you-use-thrifts-tmemorybuffer-in-golang/47433519#47433519", "title": "How do you use Thrift&#39;s TMemoryBuffer in Golang?", "body": "<p>The important part of that error is <code>Close method has pointer receiver</code>. </p>\n\n<p>A function can be defined on a type, or a pointer to that type (i.e a pointer receiver), the <code>TTransport</code> interface defines a function Close with a pointer receiver. </p>\n\n<p>Read the <a href=\"https://tour.golang.org/methods/4\" rel=\"noreferrer\">tour of go</a> for a refresher on pointer receivers.</p>\n\n<p>Changing your code to the following, should work:</p>\n\n<pre><code>transport := &amp;thrift.TMemoryBuffer{\n    Buffer: bytes.NewBuffer(data),\n}\n</code></pre>\n\n<p>One way to think about the problem would be that <code>thrift.TMemoryBuffer</code> does not have <code>Close</code> function defined on it, but that <code>*thrift.TMemoryBuffer</code> does. And the function <code>NewTBinaryProtocolTransport</code> requires a type with a <code>Close</code> function defined as specified by the interface.</p>\n"}], "owner": {"reputation": 1806, "user_id": 779666, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/d4OTd.jpg?s=128&g=1", "display_name": "T.Coutlakis", "link": "https://stackoverflow.com/users/779666/t-coutlakis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 357, "favorite_count": 0, "accepted_answer_id": 47433519, "answer_count": 1, "score": 1, "last_activity_date": 1511349996, "creation_date": 1511344722, "question_id": 47431603, "link": "https://stackoverflow.com/questions/47431603/how-do-you-use-thrifts-tmemorybuffer-in-golang", "title": "How do you use Thrift&#39;s TMemoryBuffer in Golang?", "body": "<p>In Go, I have a byte array <code>data []byte</code> which I am trying to read into an object generated by Thrift.  In C# the working code is as follows:</p>\n\n<pre><code>var request = new Request();\n\nusing (var transport = new TMemoryBuffer(data))\nusing (var protocol = new TBinaryProtocol(transport))\n{\n   request.Read(protocol);\n}\n</code></pre>\n\n<p>However in Go, it does not work:</p>\n\n<pre><code>request := app.NewRequest()\n\ntransport := thrift.TMemoryBuffer{\n    Buffer: bytes.NewBuffer(data),\n}\nprotocol := thrift.NewTBinaryProtocolTransport(transport) // error here\nrequest.Read(protocol)\n</code></pre>\n\n<p>The error it gives is:</p>\n\n<pre><code>cannot use memoryBuffer (type thrift.TMemoryBuffer) as type thrift.TTransport in argument to thrift.NewTBinaryProtocolTransport:\nthrift.TMemoryBuffer does not implement thrift.TTransport (Close method has pointer receiver)\n</code></pre>\n\n<p>I am unsure of how to fix this, as <code>TMemoryBuffer</code> does not seem to implement <code>TTransport</code> and I can't find documentation of how <code>TMemoryBuffer</code> should be used instead.</p>\n"}, {"tags": ["json", "go", "slice", "decode"], "comments": [{"owner": {"reputation": 515, "user_id": 7804714, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9e70292d73d503d0ef63de4cda71b1ac?s=128&d=identicon&r=PG", "display_name": "hallazzang", "link": "https://stackoverflow.com/users/7804714/hallazzang"}, "edited": false, "score": 0, "creation_date": 1511339984, "post_id": 47430024, "comment_id": 81814681, "body": "Shouldn&#39;t it be json.NewDecoder(resp.Body).Decode(&amp;result) ?"}, {"owner": {"reputation": 61, "user_id": 1860092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98cec8cd9ef857a0d11e310c2cc1f381?s=128&d=identicon&r=PG", "display_name": "Mohamad Nasir", "link": "https://stackoverflow.com/users/1860092/mohamad-nasir"}, "reply_to_user": {"reputation": 515, "user_id": 7804714, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9e70292d73d503d0ef63de4cda71b1ac?s=128&d=identicon&r=PG", "display_name": "hallazzang", "link": "https://stackoverflow.com/users/7804714/hallazzang"}, "edited": false, "score": 0, "creation_date": 1511340169, "post_id": 47430024, "comment_id": 81814798, "body": "still doesn&#39;t work."}, {"owner": {"reputation": 515, "user_id": 7804714, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9e70292d73d503d0ef63de4cda71b1ac?s=128&d=identicon&r=PG", "display_name": "hallazzang", "link": "https://stackoverflow.com/users/7804714/hallazzang"}, "edited": false, "score": 0, "creation_date": 1511340346, "post_id": 47430024, "comment_id": 81814910, "body": "Oh I was like &#39;where&#39;s that result variable? Is this OP&#39;s mistake?&#39; and realized that it was in function paremeters. I&#39;ll take a closer look."}, {"owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "edited": false, "score": 1, "creation_date": 1511340454, "post_id": 47430024, "comment_id": 81814950, "body": "what does it mean it it fails ? whats the output"}, {"owner": {"reputation": 515, "user_id": 7804714, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9e70292d73d503d0ef63de4cda71b1ac?s=128&d=identicon&r=PG", "display_name": "hallazzang", "link": "https://stackoverflow.com/users/7804714/hallazzang"}, "edited": false, "score": 0, "creation_date": 1511340539, "post_id": 47430024, "comment_id": 81814982, "body": "First of all, you should print the result of <code>getJson</code>, which is in type <code>error</code>. Then you can find much more precise description of what you are missing."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1511340606, "post_id": 47430024, "comment_id": 81815010, "body": "You cannot unmarshal into a <code>[]ReactionShow</code>: Unmarshal always into a pointer as encoding/json has to <i>modify</i> its argument. Also: Show the actual JSON response. Is it an array?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1511342022, "post_id": 47430024, "comment_id": 81815833, "body": "As @Volker points out you should pass a pointer to your getJson function: <code>getJson(&quot;http:&#47;&#47;localhost:80&#47;reactions&quot;, &amp;reactList)</code> the rest seems ok."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1511342321, "post_id": 47430024, "comment_id": 81816002, "body": "@MohamadNasir here&#39;s an example <a href=\"https://play.golang.org/p/_PnNK64giE\" rel=\"nofollow noreferrer\">play.golang.org/p/_PnNK64giE</a>"}, {"owner": {"reputation": 61, "user_id": 1860092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98cec8cd9ef857a0d11e310c2cc1f381?s=128&d=identicon&r=PG", "display_name": "Mohamad Nasir", "link": "https://stackoverflow.com/users/1860092/mohamad-nasir"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511342380, "post_id": 47430024, "comment_id": 81816049, "body": "It works @mkopriva, thank you"}], "answers": [{"tags": [], "owner": {"reputation": 515, "user_id": 7804714, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9e70292d73d503d0ef63de4cda71b1ac?s=128&d=identicon&r=PG", "display_name": "hallazzang", "link": "https://stackoverflow.com/users/7804714/hallazzang"}, "is_accepted": false, "score": 0, "last_activity_date": 1511341141, "creation_date": 1511341141, "answer_id": 47430447, "question_id": 47430024, "link": "https://stackoverflow.com/questions/47430024/decode-json-with-go/47430447#47430447", "title": "Decode JSON with Go", "body": "<p>Check this playground: <a href=\"https://play.golang.org/p/VjocUtiDRN\" rel=\"nofollow noreferrer\">https://play.golang.org/p/VjocUtiDRN</a></p>\n\n<p>Maybe this is what you want. So you should make your function <code>getJson</code>(btw <code>getJSON</code> is better name in Golang naming convention) takes <code>[]Reaction</code> parameter, instead of <code>interface{}</code>. Then you can unmarshal your array-like response into slice of <code>Reaction</code>s.</p>\n"}, {"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": true, "score": 3, "last_activity_date": 1511347504, "last_edit_date": 1511347504, "creation_date": 1511341695, "answer_id": 47430626, "question_id": 47430024, "link": "https://stackoverflow.com/questions/47430024/decode-json-with-go/47430626#47430626", "title": "Decode JSON with Go", "body": "<p>As pointed out in the comments you need to pass a pointer to <code>getJson</code> so that it can actually modify the contents of slice.</p>\n\n<pre><code>getJson(\"http://localhost:80/reactions\", &amp;reactList)\n</code></pre>\n\n<p>This is a close representation of what you have <a href=\"https://play.golang.org/p/_PnNK64giE\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_PnNK64giE</a>, just see where things aren't in place in your case.</p>\n"}, {"comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1511347068, "post_id": 47432152, "comment_id": 81819210, "body": "this is incorrect, if he passes a non pointer to <code>getJson</code> and passes a pointer to <code>Decode</code> <b>inside</b> <code>getJson</code>, he&#39;ll still end up with an empty slice after <code>getJson</code> returns."}], "tags": [], "owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "is_accepted": false, "score": 0, "last_activity_date": 1511360007, "last_edit_date": 1511360007, "creation_date": 1511346112, "answer_id": 47432152, "question_id": 47430024, "link": "https://stackoverflow.com/questions/47430024/decode-json-with-go/47432152#47432152", "title": "Decode JSON with Go", "body": "<p>The main error here is that you're passing result without pointer. Should be:</p>\n\n<pre><code>getJson(\"http://localhost:80/reactions\", &amp;reactList)\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 1860092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98cec8cd9ef857a0d11e310c2cc1f381?s=128&d=identicon&r=PG", "display_name": "Mohamad Nasir", "link": "https://stackoverflow.com/users/1860092/mohamad-nasir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 311, "favorite_count": 0, "accepted_answer_id": 47430626, "answer_count": 3, "score": 1, "last_activity_date": 1511360007, "creation_date": 1511339615, "last_edit_date": 1511342396, "question_id": 47430024, "link": "https://stackoverflow.com/questions/47430024/decode-json-with-go", "title": "Decode JSON with Go", "body": "<p>I have a reaction struct like this</p>\n\n<pre><code>type Reaction struct {\n    Id           uint   `json:\"id\" form:\"id\"`\n    ReactionType uint   `json:\"reactionType\" form:\"reactionType\"`\n    PostId       uint   `json:\"postId\" form:\"postId\"`\n    ReactorId    uint   `json:\"reactorId\" form:\"reactorId\"`\n    CreatedAt    string `json:\"createdAt\" form:\"createdAt\"`\n    UpdatedAt    string `json:\"updatedAt\" form:\"createdAt\"`\n}\n</code></pre>\n\n<p>And I have a function that consumes an API that should return a slice of <code>Reaction</code> </p>\n\n<pre><code>var myClient = &amp;http.Client{Timeout: 7 * time.Second}\n\nfunc getJson(url string, result interface{}) error {\n  req, _ := http.NewRequest(\"GET\", url, nil)\n  resp, err := myClient.Do(req)\n\n  if err != nil {\n     return fmt.Errorf(\"cannot fetch URL %q: %v\", url, err)\n  }\n  defer resp.Body.Close()\n\n  if resp.StatusCode != http.StatusOK {\n    return fmt.Errorf(\"unexpected http GET status: %s\", resp.Status)\n  }\n\n  err = json.NewDecoder(resp.Body).Decode(result)\n  if err != nil {\n     return fmt.Errorf(\"cannot decode JSON: %v\", err)\n  }\n  return nil\n}\n</code></pre>\n\n<p>But somehow it failed to display the array/slice of objects that I want to retrieve, I got no data at all. Where did I miss?</p>\n\n<pre><code>func main(){\n   ..\n   ..\n   var reactList []Reaction\n   getJson(\"http://localhost:80/reactions\", reactList)\n\n   for _, r := range reactList {\n        fmt.Print(r.ReactionType)\n    }\n}\n</code></pre>\n\n<p>and this is the original responses</p>\n\n<pre><code>[\n  {\n    \"id\": 55,\n    \"reactionType\": 5,\n    \"reactorId\": 2,\n    \"postId\": 4,\n    \"createdAt\": \"2017-11-18 14:23:29\",\n    \"updatedAt\": \"\"\n  },\n  {\n    \"id\": 56,\n    \"reactionType\": 5,\n    \"reactorId\": 3,\n    \"postId\": 4,\n    \"createdAt\": \"2017-11-18 14:23:42\",\n    \"updatedAt\": \"\"\n  },\n  {\n    \"id\": 57,\n    \"reactionType\": 4,\n    \"reactorId\": 4,\n    \"postId\": 4,\n    \"createdAt\": \"2017-11-18 14:23:56\",\n    \"updatedAt\": \"\"\n  }\n]\n</code></pre>\n"}, {"tags": ["java", "python", "go", "geometry"], "comments": [{"owner": {"reputation": 3222, "user_id": 4068240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c35facdddfc74d23ee378790b905226?s=128&d=identicon&r=PG", "display_name": "Clijsters", "link": "https://stackoverflow.com/users/4068240/clijsters"}, "edited": false, "score": 2, "creation_date": 1511339777, "post_id": 47430010, "comment_id": 81814567, "body": "Why is this tagged with <code>java</code> <b>and</b> with <code>python</code>?"}, {"owner": {"reputation": 75, "user_id": 8963223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28b3dcf07a38a007436420609f9d708b?s=128&d=identicon&r=PG&f=1", "display_name": "Vish K", "link": "https://stackoverflow.com/users/8963223/vish-k"}, "reply_to_user": {"reputation": 3222, "user_id": 4068240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c35facdddfc74d23ee378790b905226?s=128&d=identicon&r=PG", "display_name": "Clijsters", "link": "https://stackoverflow.com/users/4068240/clijsters"}, "edited": false, "score": 0, "creation_date": 1511343688, "post_id": 47430010, "comment_id": 81816951, "body": "Because there are python and Java libraries. Answer can be on any library. Thats why."}], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 8963223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28b3dcf07a38a007436420609f9d708b?s=128&d=identicon&r=PG&f=1", "display_name": "Vish K", "link": "https://stackoverflow.com/users/8963223/vish-k"}, "edited": false, "score": 0, "creation_date": 1511340921, "post_id": 47430297, "comment_id": 81815197, "body": "Thanks, I didn&#39;t find any double arguments from the library to pass (51.577106, 1.067254) ? that&#39;s why I posted the question. Sorry."}, {"owner": {"reputation": 65718, "user_id": 844416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e39c2364935265593d76247ddc6d07c?s=128&d=identicon&r=PG", "display_name": "MBo", "link": "https://stackoverflow.com/users/844416/mbo"}, "reply_to_user": {"reputation": 75, "user_id": 8963223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28b3dcf07a38a007436420609f9d708b?s=128&d=identicon&r=PG&f=1", "display_name": "Vish K", "link": "https://stackoverflow.com/users/8963223/vish-k"}, "edited": false, "score": 0, "creation_date": 1511341291, "post_id": 47430297, "comment_id": 81815400, "body": "FromDegrees and FromRadians get double arguments. What are units for your  <code>(51.577106, 1.067254)</code> values?"}, {"owner": {"reputation": 75, "user_id": 8963223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28b3dcf07a38a007436420609f9d708b?s=128&d=identicon&r=PG&f=1", "display_name": "Vish K", "link": "https://stackoverflow.com/users/8963223/vish-k"}, "edited": false, "score": 0, "creation_date": 1511343540, "post_id": 47430297, "comment_id": 81816858, "body": "(51.577106, 1.067254) = (latitude, longitude) from google map android user location."}, {"owner": {"reputation": 75, "user_id": 8963223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28b3dcf07a38a007436420609f9d708b?s=128&d=identicon&r=PG&f=1", "display_name": "Vish K", "link": "https://stackoverflow.com/users/8963223/vish-k"}, "edited": false, "score": 0, "creation_date": 1511343904, "post_id": 47430297, "comment_id": 81817083, "body": "Oh sorry that map lng and lat in degrees."}], "tags": [], "owner": {"reputation": 65718, "user_id": 844416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e39c2364935265593d76247ddc6d07c?s=128&d=identicon&r=PG", "display_name": "MBo", "link": "https://stackoverflow.com/users/844416/mbo"}, "is_accepted": true, "score": 0, "last_activity_date": 1511340623, "creation_date": 1511340623, "answer_id": 47430297, "question_id": 47430010, "link": "https://stackoverflow.com/questions/47430010/convert-longitude-latitude-to-cell-id-from-s2-geometry-library-python/47430297#47430297", "title": "Convert longitude, latitude to cell id from s2 geometry-library python", "body": "<p>If you already have latlng object, just use it in the second code line.</p>\n\n<p>If not, choose needed constructor <a href=\"https://github.com/micolous/s2-geometry-library/blob/master/geometry/s2/s2latlng.h\" rel=\"nofollow noreferrer\">from repository file</a> (or documentation if exists).</p>\n"}], "owner": {"reputation": 75, "user_id": 8963223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28b3dcf07a38a007436420609f9d708b?s=128&d=identicon&r=PG&f=1", "display_name": "Vish K", "link": "https://stackoverflow.com/users/8963223/vish-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3048, "favorite_count": 1, "accepted_answer_id": 47430297, "answer_count": 1, "score": 0, "last_activity_date": 1511350596, "creation_date": 1511339570, "last_edit_date": 1511350596, "question_id": 47430010, "link": "https://stackoverflow.com/questions/47430010/convert-longitude-latitude-to-cell-id-from-s2-geometry-library-python", "title": "Convert longitude, latitude to cell id from s2 geometry-library python", "body": "<p>I am following <a href=\"http://blog.christianperone.com/2015/08/googles-s2-geometry-on-the-sphere-cells-and-hilbert-curve/\" rel=\"nofollow noreferrer\">this tutorials</a>.</p>\n\n<p>As explained I can convert the cell id from degrees like below</p>\n\n<pre><code>latlng = s2.S2LatLng.FromDegrees(-30.043800, -51.140220)\ncell = s2.S2CellId.FromLatLng(latlng)\n</code></pre>\n\n<p>But I want to get the cell id from lat lng values (Not from degrees)</p>\n\n<pre><code>latlng = s2.S2LatLng.ToLATLANG(51.577106, 1.067254)\n</code></pre>\n\n<p>How can I do it (no need to be python)?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1511337351, "post_id": 47429088, "comment_id": 81813212, "body": "In your case: No. the function you showed will return implicitly when hitting the last <code>}</code>. But most probably you would send some other response after the <code>if</code> so: Yes, of course! You sent the redirect and that&#39;s all, you&#39;re done with this request so return from handling it."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1511356883, "post_id": 47431303, "comment_id": 81825731, "body": "<code>return</code> instead of <code>else</code> is generally considered more idiomatic in Go, and will be suggested by most Go linters if they see an <code>else</code> block after an <code>if</code> block that ends in a <code>return</code>."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 5, "last_activity_date": 1511343846, "creation_date": 1511343846, "answer_id": 47431303, "question_id": 47429088, "link": "https://stackoverflow.com/questions/47429088/http-handlers-when-should-i-use-return/47431303#47431303", "title": "HTTP handlers - when should I use return?", "body": "<p>The rule is: <code>return</code> when you're done processing, to prevent further processing.</p>\n\n<p>In your case, a <code>return</code> is not necessary, because there is no further processing in your function. If you had further logic, though, you would want to return:</p>\n\n<pre><code>func SomeHandler(w http.ResponseWriter, r *http.Request, _ httprouter.Params) {\n    if thisThing != thatThing {\n        log.Print(\"thisThing not equal to thatThing - redirecting\")\n        http.Redirect(w, r, \"/\", http.StatusTemporaryRedirect)\n        return // &lt;-- is this necessary?\n    }\n    w.Header().Add(\"Content-Type\", \"application/json\")\n    // ... add a normal response\n }\n</code></pre>\n\n<p>Without a return in this case, you'll send the headers to initiate a redirect, then you'll <em>also</em> send a normal JSON response.  That is obviously not what you want, so the <code>return</code> is needed.</p>\n\n<p>The astute reader will note that there would be other ways to accomplish this type of control flow.  An <code>else</code> would be an option:</p>\n\n<pre><code>func SomeHandler(w http.ResponseWriter, r *http.Request, _ httprouter.Params) {\n    if thisThing != thatThing {\n        log.Print(\"thisThing not equal to thatThing - redirecting\")\n        http.Redirect(w, r, \"/\", http.StatusTemporaryRedirect)\n    } else {\n        w.Header().Add(\"Content-Type\", \"application/json\")\n        // ... add a normal response\n    }\n }\n</code></pre>\n\n<p>However, as your conditions grow in complexity, a <code>return</code> is often going to be the most readable method. But it is ultimately a style choice at that point.</p>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1511367433, "creation_date": 1511367433, "answer_id": 47439374, "question_id": 47429088, "link": "https://stackoverflow.com/questions/47429088/http-handlers-when-should-i-use-return/47439374#47439374", "title": "HTTP handlers - when should I use return?", "body": "<p><code>return</code> is used for preliminary exit from the function and returning value to caller. As it was pointed before if there\u2019s no more instruction function will exit but itself </p>\n\n<p>When to use <code>return</code>?</p>\n\n<p>One of key ideas of Go is readability - every program should be easy to read. So Go code is structured vertically - main flow goes as a straight line on the left from top to bottom. It\u2019s often considered as a \"good\" or \"basic\" scenario. All diverts from it goes to right. Many diverts often are quite simple - for example it can be error workaround and exit. </p>\n\n<p>For example you have a function whether number is positive:</p>\n\n<pre><code>func IsPositive(n int) bool {\n    if n &lt;= 0 {\n        return false\n    }\n    return true \n}\n</code></pre>\n\n<p>You may trace a main execution line on the left and catch keywords <code>IsPositive</code> below check digression <code>if ...</code> and at the bottom <code>return true</code>.  As you can see we do not use <code>else</code>. We got it \u201cfor free\u201d (without visual overloading) as a sole remaining option in our program. I can say functions structured this way require <code>else</code> quite rarely. Also you won\u2019t find it very often keyword on standard code. </p>\n"}], "owner": {"reputation": 956, "user_id": 6402561, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/1aa8dd9d8c878efcce8226aab763c0d7?s=128&d=identicon&r=PG&f=1", "display_name": "a person", "link": "https://stackoverflow.com/users/6402561/a-person"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 47431303, "answer_count": 2, "score": 2, "last_activity_date": 1511367433, "creation_date": 1511335997, "last_edit_date": 1511337956, "question_id": 47429088, "link": "https://stackoverflow.com/questions/47429088/http-handlers-when-should-i-use-return", "title": "HTTP handlers - when should I use return?", "body": "<p>I'm a little confused about http handlers and handling something like errors or redirects.</p>\n\n<p>For example, if I have to redirect because of some conditional check, should I be doing the following:</p>\n\n<pre><code>func SomeHandler(w http.ResponseWriter, r *http.Request, _ httprouter.Params) {\n    if thisThing != thatThing {\n        log.Print(\"thisThing not equal to thatThing - redirecting\")\n        http.Redirect(w, r, \"/\", http.StatusTemporaryRedirect)\n        return // &lt;-- is this necessary?\n    }\n }\n</code></pre>\n"}, {"tags": ["csv", "go"], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 2, "last_activity_date": 1511337839, "creation_date": 1511337839, "answer_id": 47429570, "question_id": 47429025, "link": "https://stackoverflow.com/questions/47429025/cant-read-json-str-in-csv-file-with-golang/47429570#47429570", "title": "can&#39;t read json str in csv file with golang", "body": "<p>You botched up quoting.\nTo quote a <code>\"</code> in CSV your preceed it with one more double quote (and not with backlashes):</p>\n\n<pre><code>id,name\n42,\"Henry Walton \"\"Indiana\"\" Jones Jr.\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 127, "user_id": 4541972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41UK4.jpg?s=128&g=1", "display_name": "lilin", "link": "https://stackoverflow.com/users/4541972/lilin"}, "edited": false, "score": 0, "creation_date": 1511486727, "post_id": 47433910, "comment_id": 81885052, "body": "it is work, but it change the string, perhaps, i should not use \\,  this csv file generated by php"}, {"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "reply_to_user": {"reputation": 127, "user_id": 4541972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41UK4.jpg?s=128&g=1", "display_name": "lilin", "link": "https://stackoverflow.com/users/4541972/lilin"}, "edited": false, "score": 0, "creation_date": 1511504099, "post_id": 47433910, "comment_id": 81889028, "body": "yeah that is correct if you are using backticks for string literal, you do not need to escape quotation marks &quot;."}], "tags": [], "owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "is_accepted": false, "score": 0, "last_activity_date": 1511351150, "creation_date": 1511351150, "answer_id": 47433910, "question_id": 47429025, "link": "https://stackoverflow.com/questions/47429025/cant-read-json-str-in-csv-file-with-golang/47433910#47433910", "title": "can&#39;t read json str in csv file with golang", "body": "<p>Since what you ingesting is broken, you need to handle this manually. Catching error and putting record back in the format that you want. </p>\n\n<p><a href=\"https://play.golang.org/p/82bfDGLwFd\" rel=\"nofollow noreferrer\">https://play.golang.org/p/82bfDGLwFd</a></p>\n\n\n\n<pre><code>package main\n\nimport (\n    \"encoding/csv\"\n    \"fmt\"\n    \"io\"\n    \"strings\"\n)\n\nfunc main() {\n    csvReader := csv.NewReader(strings.NewReader(data))\n    csvReader.LazyQuotes = true\n    csvReader.Comma = ','\n    csvReader.Comment = '#'\n    for {\n        row, err := csvReader.Read()\n        if err == io.EOF {\n            break\n        }\n        if err != nil {\n\n            // checking here if the error you getting is what you experiencing \n            // due to json which is too many fields\n            // checking for len(row) &gt; 1 to avoid array index out of bound\n            if e, ok := err.(*csv.ParseError); ok &amp;&amp; e.Err == csv.ErrFieldCount &amp;&amp; len(row) &gt; 1 {\n                // we manually stitch it back to the expected format\n                row = []string{row[0], strings.Join(row[1:], \"\")}\n\n            } else {\n                // some other type of error\n                fmt.Println(err)\n                continue\n            }\n        }\n\n\n        for _, str := range row {\n            fmt.Print(str, \"\\t\")\n        }\n        fmt.Print(\"\\n\")\n    }\n}\n\nconst data = `id,request_time\n129,\"{\\\"request\\\":{\\\"protocol\\\":\\\"http\\\",\\\"method\\\":\\\"POST\\\",\\\"is_ajax\\\":false,\\\"query\\\":{\\\"signature\\\":\\\"\\\",\\\"timestamp\\\":\\\"1511107236\\\",\\\"nonce\\\":\\\"\\\",\\\"openid\\\":\\\"\\\",\\\"encrypt_type\\\":\\\"aes\\\"},\\\"url\\\":\\\"\\\",\\\"origin\\\":\\\"\\\",\\\"host\\\":\\\"\\\"},\\\"response\\\":{\\\"status\\\":200}}\"\n`\n</code></pre>\n\n<p>Have fun!</p>\n"}], "owner": {"reputation": 127, "user_id": 4541972, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41UK4.jpg?s=128&g=1", "display_name": "lilin", "link": "https://stackoverflow.com/users/4541972/lilin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 759, "favorite_count": 0, "accepted_answer_id": 47429570, "answer_count": 2, "score": -4, "last_activity_date": 1511351150, "creation_date": 1511335738, "question_id": 47429025, "link": "https://stackoverflow.com/questions/47429025/cant-read-json-str-in-csv-file-with-golang", "title": "can&#39;t read json str in csv file with golang", "body": "<p>I export mysql data to a csv file, and there is one field use json string</p>\n\n<p>when i use \"encoding/csv\" read this file, it show \"wrong number of fields in line\"</p>\n\n<p>but when i delete the field, it's ok</p>\n\n<p>like this:\n<a href=\"https://play.golang.org/p/314zrsZG3R\" rel=\"nofollow noreferrer\">code example</a></p>\n\n<p>is anyway to solve this? </p>\n"}, {"tags": ["go", "cors"], "answers": [{"tags": [], "owner": {"reputation": 1523, "user_id": 148725, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/e98a706034f300c42aba902a1b505cbf?s=128&d=identicon&r=PG", "display_name": "Masonoise", "link": "https://stackoverflow.com/users/148725/masonoise"}, "is_accepted": false, "score": 3, "last_activity_date": 1511402526, "creation_date": 1511402526, "answer_id": 47446492, "question_id": 47428896, "link": "https://stackoverflow.com/questions/47428896/example-using-rs-cors-as-preware-with-buffalo/47446492#47446492", "title": "Example using /rs/cors as preware with Buffalo?", "body": "<p>Finally figured it out, so I'll share the info here for anyone else. This is using Buffalo v0.10.1 and the <a href=\"https://github.com/rs/cors\" rel=\"nofollow noreferrer\">https://github.com/rs/cors</a> project. I dug in and found that I could set up the cors object with (using localhost for example):</p>\n\n<pre><code>    c := cors.New(cors.Options{\n        AllowedOrigins:   []string{\"http://localhost:8080\"},\n        AllowCredentials: true,\n    })\n</code></pre>\n\n<p>and then add it into the Buffalo instantiation by getting the Handler out of it:</p>\n\n<pre><code>app = buffalo.New(buffalo.Options{\n    Env:          ENV,\n    SessionStore: sessions.Null{},\n    SessionName:  \"_creatorhub_session\",\n    PreWares:     []buffalo.PreWare{c.Handler},\n})\n</code></pre>\n\n<p>That worked for me. The issue was that it was difficult to find documentation for what Buffalo wanted passed in to PreWare and matching it up with what could be provided by the cors package.</p>\n\n<p>Hope this helps out someone else in the future!</p>\n"}], "owner": {"reputation": 1523, "user_id": 148725, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/e98a706034f300c42aba902a1b505cbf?s=128&d=identicon&r=PG", "display_name": "Masonoise", "link": "https://stackoverflow.com/users/148725/masonoise"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 363, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1511402526, "creation_date": 1511335139, "question_id": 47428896, "link": "https://stackoverflow.com/questions/47428896/example-using-rs-cors-as-preware-with-buffalo", "title": "Example using /rs/cors as preware with Buffalo?", "body": "<p>I'm trying to get the /rs/cors package to work with the latest Buffalo as Preware, which is supposed to work according to a recent blog post (<a href=\"https://blog.gobuffalo.io/buffalo-v0-9-4-released-5d2327a4742e\" rel=\"nofollow noreferrer\">https://blog.gobuffalo.io/buffalo-v0-9-4-released-5d2327a4742e</a>), but the code snippet there doesn't seem to make sense. If I generate a new buffalo app as an API, and I look at adding the cors package, I start with:</p>\n\n<pre><code>app = buffalo.New(buffalo.Options{\n    Env:          ENV,\n    SessionStore: sessions.Null{},\n    SessionName:  \"_creatorhub_session\",\n})\n// Automatically redirect to SSL\napp.Use(ssl.ForceSSL(secure.Options{\n    SSLRedirect:     ENV == \"production\",\n    SSLProxyHeaders: map[string]string{\"X-Forwarded-Proto\": \"https\"},\n}))\n\n// Set the request content type to JSON\napp.Use(middleware.SetContentType(\"application/json\"))\n</code></pre>\n\n<p>I should obviously add something along the lines of \"PreWares:     []buffalo.PreWare{},\" but it seems to want a HandlerFunc, which /rs/cors doesn't seem to return under normal use, so I'm failing to find the right combination to make these work properly together and I haven't found a working example.</p>\n\n<p>Anyone out there have an example to share? Any ideas appreciated!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1511329169, "post_id": 47427494, "comment_id": 81809462, "body": "See <a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">golang.org/doc/faq#convert_slice_of_interface</a>. Duplicate."}, {"owner": {"reputation": 466, "user_id": 8307258, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L8i2o.jpg?s=128&g=1", "display_name": "Rados\u0142aw Za\u0142uska", "link": "https://stackoverflow.com/users/8307258/rados%c5%82aw-za%c5%82uska"}, "edited": false, "score": 2, "creation_date": 1511330606, "post_id": 47427494, "comment_id": 81809997, "body": "Try this: <a href=\"https://play.golang.org/p/2MgthMr-8v\" rel=\"nofollow noreferrer\">play.golang.org/p/2MgthMr-8v</a>"}, {"owner": {"reputation": 914, "user_id": 661716, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/912c9926d5e4b534aa33e30e26061620?s=128&d=identicon&r=PG", "display_name": "tompal18", "link": "https://stackoverflow.com/users/661716/tompal18"}, "edited": false, "score": 0, "creation_date": 1511335537, "post_id": 47427494, "comment_id": 81812264, "body": "It helps me a lot. Thank you both of you"}], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1511333279, "creation_date": 1511333279, "answer_id": 47428420, "question_id": 47427494, "link": "https://stackoverflow.com/questions/47427494/in-golang-struct-with-a-slice-variable-of-any-type-is-possible/47428420#47428420", "title": "In golang, struct with a slice variable of any type is possible?", "body": "<p>Yes, as a slice of <code>interface{}</code> which can hold any arbitrary value.</p>\n\n<pre><code>var s = []interface{}{1, 2, \"three\", SomeFunction}\nfmt.Printf(\"Hello, %#v \\n\", s)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Hello, []interface {}{1, 2, \"three\", (func())(0xd4b60)} \n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/MQMc689StO\" rel=\"nofollow noreferrer\">https://play.golang.org/p/MQMc689StO</a></p>\n\n<p>But I do not recommend simulate dynamic-typed languages (like Python, JavaScript, PHP, etc) this way. Better to use all static-typed benefits from Go, and leave this feature as a last resort, or as a container for user input. Just to receive it and convert to strict types.</p>\n"}, {"tags": [], "owner": {"reputation": 24361, "user_id": 629685, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cadce7a59af35a66f18b9aaddebfd50f?s=128&d=identicon&r=PG", "display_name": "I159", "link": "https://stackoverflow.com/users/629685/i159"}, "is_accepted": false, "score": 0, "last_activity_date": 1511353608, "creation_date": 1511353608, "answer_id": 47434718, "question_id": 47427494, "link": "https://stackoverflow.com/questions/47427494/in-golang-struct-with-a-slice-variable-of-any-type-is-possible/47434718#47434718", "title": "In golang, struct with a slice variable of any type is possible?", "body": "<h3>Typing</h3>\n\n<p>Go is a strongly explicitly typed language thus you can't substitute an object of one type with another (it is already compiled in this way). Also when you do <code>type Data_A struct {...</code> you define new type named <code>Data_A</code>. <code>[]interface{}</code> and <code>Data_A</code> are completely different types and these types (like any other) are not interchangeable. Note, even <code>interface{}</code> is not interchangeable with anything. You can pass any type in a function like this <code>func f(a interface{}){...</code> but inside the function you will have exactly <code>interface{}</code> type and you should assert it to use properly.</p>\n\n<h3>Fix#1</h3>\n\n<pre><code>package main\n\ntype Data_A struct {\n    a string\n}\n\ntype DTResponse struct {\n    Data Data_A `json:\"data\"`\n}\n\nfunc main() {\n    ds := Data_A{\"1\"}\n    dtResp := &amp;DTResponse{ Data:ds}\n\n    print(dtResp)\n}\n</code></pre>\n\n<h3>Fix#2</h3>\n\n<pre><code>package main\n\ntype DTResponse struct {\n    Data []interface{} `json:\"data\"`\n}\n\nfunc main() {\n    ds := []interface{}{\"1\"}\n    dtResp := &amp;DTResponse{ Data:ds}\n\n    print(dtResp)\n}\n</code></pre>\n\n<p>Possibly the cause of confusion: struct is not slice or array.</p>\n"}], "owner": {"reputation": 914, "user_id": 661716, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/912c9926d5e4b534aa33e30e26061620?s=128&d=identicon&r=PG", "display_name": "tompal18", "link": "https://stackoverflow.com/users/661716/tompal18"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2709, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1511353608, "creation_date": 1511328994, "last_edit_date": 1511352682, "question_id": 47427494, "link": "https://stackoverflow.com/questions/47427494/in-golang-struct-with-a-slice-variable-of-any-type-is-possible", "title": "In golang, struct with a slice variable of any type is possible?", "body": "<p>Simple golang app gives below error</p>\n\n<pre><code>.\\test.go:13: cannot use ds (type Data_A) as type []interface {} in field value\n</code></pre>\n\n<p>for below code</p>\n\n<pre><code>package main\n\ntype Data_A struct {\n    a string\n}\n\ntype DTResponse struct {\n    Data []interface{} `json:\"data\"`\n}\n\nfunc main() {\n    ds := Data_A{\"1\"}\n    dtResp := &amp;DTResponse{ Data:ds}\n\n    print(dtResp)\n}\n</code></pre>\n\n<p>I would like to have a struct with slice variable of any type. Using <code>struct{}</code> gives the same error. </p>\n\n<p>In Java I could use Object as it is the parent object of any object. But I could not find such one in golang.</p>\n\n<p>Any help would be appreciated.</p>\n"}, {"tags": ["go", "locking", "deferred"], "comments": [{"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 1, "creation_date": 1511343295, "post_id": 47427211, "comment_id": 81816701, "body": "Technically the order doesn&#39;t matter. Just that it&#39;s important to <code>Unlock</code>. Just that the first one is more logical and readable."}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1511332781, "post_id": 47427229, "comment_id": 81810933, "body": "Still, I would say the former is clearer as it captures the native flow of events: a resource is first acquired and <i>after that</i> its releasing is scheduled. The second variant puts that backwards. Also, I&#39;ve never seen the second form in production code."}, {"owner": {"reputation": 47412, "user_id": 3141234, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/78b45a835031f4ce03a6653b3262b5d3?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/3141234/alexander"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1511333079, "post_id": 47427229, "comment_id": 81811063, "body": "@kostix Yeah, I would prefer that, too."}], "tags": [], "owner": {"reputation": 47412, "user_id": 3141234, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/78b45a835031f4ce03a6653b3262b5d3?s=128&d=identicon&r=PG", "display_name": "Alexander", "link": "https://stackoverflow.com/users/3141234/alexander"}, "is_accepted": true, "score": 6, "last_activity_date": 1511333135, "last_edit_date": 1511333135, "creation_date": 1511327437, "answer_id": 47427229, "question_id": 47427211, "link": "https://stackoverflow.com/questions/47427211/mutex-lock-and-defered-mutex-unock-order/47427229#47427229", "title": "mutex.Lock and defered mutex.Unock order", "body": "<p>It doesn't matter.</p>\n\n<p>Either way, <code>defer</code> causes <code>mu.Unlock()</code> to be executed when the current scope is exited (e.g. a function that returns).</p>\n\n<p>The first method it's preferable, because it has a more natural ordering (lock, then unlock) for human readability.</p>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 2, "last_activity_date": 1511333535, "creation_date": 1511333535, "answer_id": 47428480, "question_id": 47427211, "link": "https://stackoverflow.com/questions/47427211/mutex-lock-and-defered-mutex-unock-order/47428480#47428480", "title": "mutex.Lock and defered mutex.Unock order", "body": "<p>I see first variant more natural and easily readable. You may see as a lock gets acquired and at the same code piece it gets prepared to release:</p>\n\n<pre><code>mu.Lock()\ndefer mu.Unlock()\n</code></pre>\n\n<p>Anyway deferred function call will be executed later - at function exit.</p>\n"}, {"tags": [], "owner": {"reputation": 24361, "user_id": 629685, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cadce7a59af35a66f18b9aaddebfd50f?s=128&d=identicon&r=PG", "display_name": "I159", "link": "https://stackoverflow.com/users/629685/i159"}, "is_accepted": false, "score": 0, "last_activity_date": 1511341830, "last_edit_date": 1592644375, "creation_date": 1511341830, "answer_id": 47430667, "question_id": 47427211, "link": "https://stackoverflow.com/questions/47427211/mutex-lock-and-defered-mutex-unock-order/47430667#47430667", "title": "mutex.Lock and defered mutex.Unock order", "body": "<h3>defer</h3>\n<blockquote>\n<p>A defer statement defers the execution of a function until the surrounding function returns.</p>\n<p>The deferred call's arguments are evaluated immediately, but the function call is not executed until the surrounding function returns.</p>\n</blockquote>\n<p>Both of your variants are identical because it doesn't matter where <code>defer</code>red functions are placed it will be executed after the surrounding function returns.</p>\n<p><strong>Note</strong> if you have several <code>defer</code>red functions it will be executed in reversed order accordingly to an order of <code>defer</code>s declaration.</p>\n"}], "owner": {"reputation": 63, "user_id": 7004868, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1d5526b70fb222c3382d80858d344857?s=128&d=identicon&r=PG&f=1", "display_name": "wenyi liu", "link": "https://stackoverflow.com/users/7004868/wenyi-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 778, "favorite_count": 1, "accepted_answer_id": 47427229, "answer_count": 3, "score": 0, "last_activity_date": 1511341869, "creation_date": 1511327325, "last_edit_date": 1511341869, "question_id": 47427211, "link": "https://stackoverflow.com/questions/47427211/mutex-lock-and-defered-mutex-unock-order", "title": "mutex.Lock and defered mutex.Unock order", "body": "<p>in golang, sync.Mutex Lock and Unlock are usaul operation,but what is the correct order of Lock and defer Unlock?</p>\n\n<pre><code>mu.Lock()\ndefer mu.Unlock()\n</code></pre>\n\n<p>or</p>\n\n<pre><code>defer mu.Unlock()\nmu.Lock()\n</code></pre>\n\n<p>which is best?</p>\n"}, {"tags": ["c", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1511334974, "post_id": 47425089, "comment_id": 81811959, "body": "If you are interested in such stuff: Why not ask on golang-nuts? I think this would be the better place and yield more answers and real life examples."}], "answers": [{"comments": [{"owner": {"reputation": 1192, "user_id": 1213186, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d9eabf15c471c4eb5158034e943711ce?s=128&d=identicon&r=PG", "display_name": "ddibiase", "link": "https://stackoverflow.com/users/1213186/ddibiase"}, "edited": false, "score": 0, "creation_date": 1511316321, "post_id": 47425459, "comment_id": 81806282, "body": "Interesting. When you run the shared lib does it operate in its own thread/process or more appropriately where does it operate vis-a-vis the C thread you&#39;re running?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1192, "user_id": 1213186, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d9eabf15c471c4eb5158034e943711ce?s=128&d=identicon&r=PG", "display_name": "ddibiase", "link": "https://stackoverflow.com/users/1213186/ddibiase"}, "edited": false, "score": 0, "creation_date": 1511357315, "post_id": 47425459, "comment_id": 81826062, "body": "@ddibiase: a go shared library starts up the normal runtime, it just happens to have a different entry point."}], "tags": [], "owner": {"reputation": 2453, "user_id": 807294, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/78Oun.jpg?s=128&g=1", "display_name": "Jacob Davis-Hansson", "link": "https://stackoverflow.com/users/807294/jacob-davis-hansson"}, "is_accepted": true, "score": 1, "last_activity_date": 1511314362, "creation_date": 1511314362, "answer_id": 47425459, "question_id": 47425089, "link": "https://stackoverflow.com/questions/47425089/using-go-in-c-limitations/47425459#47425459", "title": "Using Go in C limitations", "body": "<p>In theory, there are no limitations - conceptually the .so is just a bunch of machine code that happens to bundle a very smart memory manager, and expose an API that matches the shared library format. </p>\n\n<p>There are, in practice, a minimal set of quirks. For instance, the program linking in the go <code>.so</code> can currently not call <code>dlclose</code> on it: <a href=\"https://github.com/golang/go/issues/11100\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/11100</a></p>\n\n<p>You may find the open list of issues mentioning <code>c-shared</code> to be helpful: <a href=\"https://github.com/golang/go/issues?utf8=%E2%9C%93&amp;q=is%3Aissue%20is%3Aopen%20c-shared\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues?utf8=%E2%9C%93&amp;q=is%3Aissue%20is%3Aopen%20c-shared</a></p>\n"}], "owner": {"reputation": 1192, "user_id": 1213186, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d9eabf15c471c4eb5158034e943711ce?s=128&d=identicon&r=PG", "display_name": "ddibiase", "link": "https://stackoverflow.com/users/1213186/ddibiase"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 47425459, "answer_count": 1, "score": 1, "last_activity_date": 1511314362, "creation_date": 1511311443, "question_id": 47425089, "link": "https://stackoverflow.com/questions/47425089/using-go-in-c-limitations", "title": "Using Go in C limitations", "body": "<p>Recently stumbled on this article about leveraging Go's shared library compiler in C and other languages: <a href=\"https://medium.com/learning-the-go-programming-language/calling-go-functions-from-other-languages-4c7d8bcc69bf\" rel=\"nofollow noreferrer\">https://medium.com/learning-the-go-programming-language/calling-go-functions-from-other-languages-4c7d8bcc69bf</a></p>\n\n<p>I'm wondering what the limitations of the compiler use is? For example once compiled will Go's net and socket libraries all work as they would as a standalone Go application?</p>\n\n<p>ie. could I theoretically have a Go application as the communication layer (lets say HTTP) and a C application performing some lower level processing which is handed to Go for delivery?</p>\n\n<p>Sorry for the awkward explanation of the use case, simply trying to understand how Go would react in a compiled environment in general. I know very little about shared libraries at this level, so just a curiosity.</p>\n"}, {"tags": ["go", "concurrency"], "answers": [{"comments": [{"owner": {"reputation": 5219, "user_id": 4724167, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/2CiEe.jpg?s=128&g=1", "display_name": "Nandu Kalidindi", "link": "https://stackoverflow.com/users/4724167/nandu-kalidindi"}, "edited": false, "score": 0, "creation_date": 1511312812, "post_id": 47425182, "comment_id": 81805474, "body": "If you are accessing <code>&lt;-procchan</code> then aren&#39;t you waiting for the channel until it has a value and then proceeding. That way the for loop is the same as a sequential execution isn&#39;t it?"}, {"owner": {"reputation": 420, "user_id": 5747844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c47f253367f6ff02da1fe8f521a77057?s=128&d=identicon&r=PG&f=1", "display_name": "nissefors", "link": "https://stackoverflow.com/users/5747844/nissefors"}, "reply_to_user": {"reputation": 5219, "user_id": 4724167, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/2CiEe.jpg?s=128&g=1", "display_name": "Nandu Kalidindi", "link": "https://stackoverflow.com/users/4724167/nandu-kalidindi"}, "edited": false, "score": 0, "creation_date": 1511339427, "post_id": 47425182, "comment_id": 81814377, "body": "Yes it is the same as sequential; tou launch one goroutine, wait for it&#39;s first result, print its result, then launch another. The problem is your goroutines returns values on the channel in each recursion, so when you call f(2) before the f(2) call puts its value onto the channel you all f(1) and f(0) that each in turn put their values onto the channel before that. And since you are only grabbing the first value that causes your problem."}, {"owner": {"reputation": 420, "user_id": 5747844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c47f253367f6ff02da1fe8f521a77057?s=128&d=identicon&r=PG&f=1", "display_name": "nissefors", "link": "https://stackoverflow.com/users/5747844/nissefors"}, "reply_to_user": {"reputation": 5219, "user_id": 4724167, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/2CiEe.jpg?s=128&g=1", "display_name": "Nandu Kalidindi", "link": "https://stackoverflow.com/users/4724167/nandu-kalidindi"}, "edited": false, "score": 0, "creation_date": 1511360925, "post_id": 47425182, "comment_id": 81828548, "body": "@NanduKalidindi sorry, I clearly didn&#39;t check the username and responded as if you where 3rdeye7"}], "tags": [], "owner": {"reputation": 420, "user_id": 5747844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c47f253367f6ff02da1fe8f521a77057?s=128&d=identicon&r=PG&f=1", "display_name": "nissefors", "link": "https://stackoverflow.com/users/5747844/nissefors"}, "is_accepted": false, "score": 2, "last_activity_date": 1511312134, "creation_date": 1511312134, "answer_id": 47425182, "question_id": 47424928, "link": "https://stackoverflow.com/questions/47424928/communicating-with-n-goroutines/47425182#47425182", "title": "communicating with n goroutines", "body": "<p>Your solution will try to output more than the one value you extract from the channel as you increase the value of i.\nWhat your code will try to send to the channel for each i:</p>\n\n<pre><code>0: 0\n1: 1\n2: 1,0,1\n3: 1,0,1,1,2\n4: 1,0,1,1,2,1,0,1,3\n...\n</code></pre>\n\n<p>Since you create a new channel for each i and then only extract one value you will always get the first value in the line above.</p>\n\n<p>If you try to run it with these modifications it will output what you wanted (<a href=\"https://play.golang.org/p/_mn3l5x8iZ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_mn3l5x8iZ</a>).</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n// Fibonacci in a recursive version\nfunc fiboRchan(n int, c chan int) {\n    c &lt;- fiboR(n)\n}\n\nfunc fiboR(n int) int {\n\n    if n == 0 {\n        return 0\n    } else if n == 1 {\n        return 1\n    } else {\n        return fiboR(n-1) + fiboR(n-2)\n    }\n\n}\n\nfunc main() {\n\n    for i := 0; i &lt; 10; i++ {\n        procchan := make(chan int)\n        go fiboRchan(i, procchan)\n        fmt.Println(i, &lt;-procchan)\n    }\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5219, "user_id": 4724167, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/2CiEe.jpg?s=128&g=1", "display_name": "Nandu Kalidindi", "link": "https://stackoverflow.com/users/4724167/nandu-kalidindi"}, "is_accepted": false, "score": 1, "last_activity_date": 1511317768, "creation_date": 1511317768, "answer_id": 47425871, "question_id": 47424928, "link": "https://stackoverflow.com/questions/47424928/communicating-with-n-goroutines/47425871#47425871", "title": "communicating with n goroutines", "body": "<p>Adding to @nissefors answer, the main process there is most likely a sequential one because in the for loop you would be waiting on the channel to return and then proceed to the next iteration. </p>\n\n<p>A minor modification in the main function could fire all the fibonaccis at once and then in a separate for loop the channels that are corresponding to each go routine can be accessed</p>\n\n<p>Playground URL: <a href=\"https://play.golang.org/p/7e3JnWeSp6\" rel=\"nofollow noreferrer\">https://play.golang.org/p/7e3JnWeSp6</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n// Fibonacci in a recursive version\nfunc fiboRchan(n int, c chan int) {\n        fmt.Println(\"PROCESSING FOR %d\", n)\n    c &lt;- fiboR(n)\n}\n\nfunc fiboR(n int) int {\n    if n == 0 {\n        return 0\n    } else if n == 1 {\n        return 1\n    } else {\n        return fiboR(n-1) + fiboR(n-2)\n    }\n\n}\n\nfunc main() {\n    var arr[10]chan int\n    for i := 0; i &lt; 10; i++ {\n        procchan := make(chan int)\n        arr[i] = procchan\n        go fiboRchan(i, procchan)\n    }\n    // By now all the go routines are fired\n\n    // Now iterate through the channel array and read from the\n    // respective channel\n    for i:=0; i&lt; 10; i++ {\n        fmt.Println(i, &lt;-arr[i])\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 506, "user_id": 4422622, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/22e49797837acd40aa1be0811ce8d7f7?s=128&d=identicon&r=PG&f=1", "display_name": "3rdeye7", "link": "https://stackoverflow.com/users/4422622/3rdeye7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1511317768, "creation_date": 1511310214, "question_id": 47424928, "link": "https://stackoverflow.com/questions/47424928/communicating-with-n-goroutines", "title": "communicating with n goroutines", "body": "<p>I am trying to implement fibonacci recursion in golang using n goroutines with communicating via channels.</p>\n\n<p>I am returning an integer from the function, but i am actually just sending the sum of f(n-1) +f(n-2) over channel c but this is not working correctly. It prints the first two values correct, and every value after is just 1.   </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n// Fibonacci in a recursive version\nfunc fiboR(n int, c chan int ) int {\n\n  if(n == 0){\n      c &lt;- 0\n      return 0\n  } else if n == 1 {\n      c &lt;- 1\n      return 1\n  } else{\n      c &lt;- fiboR(n-1,c) + fiboR(n-2,c)\n      return fiboR(n-1,c) + fiboR(n-2,c)\n  }\n\n}\n\n\nfunc main() {\n  for i := 0; i &lt; 10; i++ {\n    procchan := make(chan int)\n    go fiboR(i,procchan)\n    fmt.Println(i,&lt;-procchan )\n}\n}\n</code></pre>\n\n<p>Also is it possible to use channels for receiving the two recursive calls?</p>\n"}, {"tags": ["go", "lambda"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 6, "creation_date": 1511310938, "post_id": 47424899, "comment_id": 81804934, "body": "Sure, just call <code>router.ServeHTTP(w, r)</code> where <code>w</code> and <code>r</code> is your <code>http.ResponseWriter</code> implementation and an <code>*http.Request</code> instance."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1511356639, "post_id": 47424899, "comment_id": 81825545, "body": "In AWS lambda there is no <i>virtual machine</i> to start. That doesn&#39;t mean your service can&#39;t start. The concepts are orthogonal."}, {"owner": {"reputation": 22932, "user_id": 793454, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/d2f7eec19f8c465b7515e234f8110899?s=128&d=identicon&r=PG", "display_name": "Homan", "link": "https://stackoverflow.com/users/793454/homan"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1515720569, "post_id": 47424899, "comment_id": 83418593, "body": "@Adrian but if I started a server how would it exit?  I would want it to exit immediately after the one and only request that it receives instead of staying alive for the 5 min lambda time limit"}, {"owner": {"reputation": 6519, "user_id": 613453, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0c744d4e2bee639d69f3e78f7daeba6d?s=128&d=identicon&r=PG", "display_name": "themihai", "link": "https://stackoverflow.com/users/613453/themihai"}, "edited": false, "score": 0, "creation_date": 1521514126, "post_id": 47424899, "comment_id": 85752301, "body": "You may want to look at gorilla mux. They have some methods that allow you to match routes by path. Also check their issues list as there are some &quot;issues&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 1901, "user_id": 225630, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/edb8bd2d383e517e23e87ad10da214f3?s=128&d=identicon&r=PG", "display_name": "davyzhang", "link": "https://stackoverflow.com/users/225630/davyzhang"}, "is_accepted": false, "score": 2, "last_activity_date": 1521513972, "creation_date": 1521513972, "answer_id": 49375595, "question_id": 47424899, "link": "https://stackoverflow.com/questions/47424899/is-there-a-way-use-mux-routing-to-select-a-handler-without-using-http-listenands/49375595#49375595", "title": "Is there a way use mux routing to select a handler without using http listenAndServe for golang?", "body": "<p>I have created a <a href=\"https://github.com/davyzhang/agw\" rel=\"nofollow noreferrer\">lib</a> for this purpose.</p>\n\n<p>The basic idea is to transform apigateway request context which is a json object into http.Request</p>\n"}, {"tags": [], "owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "is_accepted": false, "score": 1, "last_activity_date": 1527376326, "last_edit_date": 1527376326, "creation_date": 1527173488, "answer_id": 50512350, "question_id": 47424899, "link": "https://stackoverflow.com/questions/47424899/is-there-a-way-use-mux-routing-to-select-a-handler-without-using-http-listenands/50512350#50512350", "title": "Is there a way use mux routing to select a handler without using http listenAndServe for golang?", "body": "<p>The most common approach is to use <a href=\"https://github.com/apex/gateway\" rel=\"nofollow noreferrer\"><code>apex/gateway</code></a> which is a drop in replacement for <code>net/http</code> on AWS Lambda. This is started by calling with the same parameters.</p>\n\n<pre><code>gateway.ListenAndServe(port, router)\n</code></pre>\n\n<p>Here is a sample showing it's use:</p>\n\n<pre><code>func main() {\n    http.HandleFunc(\"/\", hello)\n    log.Fatal(gateway.ListenAndServe(\":3000\", nil))\n}\n\nfunc hello(w http.ResponseWriter, r *http.Request) {\n    // example retrieving values from the api gateway proxy request context.\n    requestContext, ok := gateway.RequestContext(r.Context())\n    if !ok || requestContext.Authorizer[\"sub\"] == nil {\n        fmt.Fprint(w, \"Hello World from Go\")\n        return\n    }\n\n    userID := requestContext.Authorizer[\"sub\"].(string)\n    fmt.Fprintf(w, \"Hello %s from Go\", userID)\n}\n</code></pre>\n\n<p>It's also common to use this with the <a href=\"https://github.com/go-chi/chi\" rel=\"nofollow noreferrer\"><code>chi</code></a> router.</p>\n\n<p>Some other options include:</p>\n\n<ul>\n<li><a href=\"https://github.com/davyzhang/agw\" rel=\"nofollow noreferrer\"><code>davyzhang/agw</code></a> (listed in Davy's response)</li>\n<li><a href=\"https://github.com/davidsbond/lux\" rel=\"nofollow noreferrer\"><code>davidsbond/lux</code></a></li>\n<li><a href=\"https://github.com/EtienneBruines/fasthttplambda\" rel=\"nofollow noreferrer\"><code>EtienneBruines/fasthttplambda</code></a></li>\n</ul>\n"}], "owner": {"reputation": 22932, "user_id": 793454, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/d2f7eec19f8c465b7515e234f8110899?s=128&d=identicon&r=PG", "display_name": "Homan", "link": "https://stackoverflow.com/users/793454/homan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1324, "favorite_count": 0, "answer_count": 2, "score": 6, "last_activity_date": 1527376326, "creation_date": 1511310049, "last_edit_date": 1527376272, "question_id": 47424899, "link": "https://stackoverflow.com/questions/47424899/is-there-a-way-use-mux-routing-to-select-a-handler-without-using-http-listenands", "title": "Is there a way use mux routing to select a handler without using http listenAndServe for golang?", "body": "<p>There are a lot of mux routers for golang.  All of the ones I've found assume that I'm building my own http server in go.  However, I would like to use aws apigateway as the external layer and have it forward the method, path, query parameters to a lambda function that I have deployed with apex (go shim for aws lambda functions).  All the api gateway endpoints will forward to one lambda function so that there are fewer things to hook up, like permissions and so forth.  </p>\n\n<p>So I would like to use nice mux libraries for their ability to parse regex or path variables, but use them inside the lambda and be able to invoke the correct handler based on the url path.</p>\n\n<p>Most of the mux routers have a usage like this:</p>\n\n<pre><code>router := NewRouter()\nrouter.Add(\"GET\", \"/my_path/:id\", MyHandler)\n</code></pre>\n\n<p>Where <code>MyHandler</code> is a type of http.HandlerFunc</p>\n\n<p>Then the server is started with something like <code>http.ListenAndServe(port, router)</code></p>\n\n<p>But in aws lambda there is no server to start, I would just like to use the mux to find the handler that I should be calling.</p>\n"}, {"tags": ["go", "utf-8", "string-formatting"], "comments": [{"owner": {"reputation": 16928, "user_id": 1047788, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/xA1rW.png?s=128&g=1", "display_name": "user7610", "link": "https://stackoverflow.com/users/1047788/user7610"}, "edited": false, "score": 0, "creation_date": 1511298986, "post_id": 47422869, "comment_id": 81800261, "body": "Figured it out after I had the question already written. May just answer it as well..."}], "answers": [{"comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 5, "creation_date": 1511303911, "post_id": 47422870, "comment_id": 81802716, "body": "The language you used is a bit confusing: with single quotes it prints the Unicode <i>codepoint</i> (U+16B5). A codepoint is a number assigned by the unicode consortium together with a description of what this should represent. It <i>doesn&#39;t</i> say how this should be represented in a text file. With double quotes it prints the raw bytes in the UTF-8 encoded string. The bytes in UTF-8 don&#39;t directly align in 8-bit bytes, so there is no apparent correspondence if you look at just the hex characters. Wikipedia has a <a href=\"https://en.wikipedia.org/wiki/UTF-8#Examples\" rel=\"nofollow noreferrer\">useful example</a> on how this works."}, {"owner": {"reputation": 16928, "user_id": 1047788, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/xA1rW.png?s=128&g=1", "display_name": "user7610", "link": "https://stackoverflow.com/users/1047788/user7610"}, "reply_to_user": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1511307159, "post_id": 47422870, "comment_id": 81803828, "body": "Sounds better. Post that as an answer and I&#39;ll accept it ;)"}], "tags": [], "owner": {"reputation": 16928, "user_id": 1047788, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/xA1rW.png?s=128&g=1", "display_name": "user7610", "link": "https://stackoverflow.com/users/1047788/user7610"}, "is_accepted": true, "score": 4, "last_activity_date": 1511300407, "last_edit_date": 1511300407, "creation_date": 1511298950, "answer_id": 47422870, "question_id": 47422869, "link": "https://stackoverflow.com/questions/47422869/why-does-fmt-printfx-%e1%9a%b5-16b5-while-fmt-printfx-%e1%9a%b5-e19ab5/47422870#47422870", "title": "Why does fmt.Printf(&quot;%x&quot;, &#39;\u16b5&#39;) ~&gt; 16b5, while fmt.Printf(&quot;%x&quot;, &quot;\u16b5&quot;) ~&gt; e19ab5?", "body": "<p>Because each does a different thing. Both format the argument as a hexadecimal number, but each views the argument differently.</p>\n\n<p><code>fmt.Printf(\"%x\", '\u16b5')</code> prints a single unicode character (a rune, if you will), as a 32 bit integer (int32).</p>\n\n<p><code>fmt.Printf(\"%x\", \"\u16b5\")</code> prints a string (individual bytes of a string) as 8 bit integers (uint8). The rune is encoded on three bytes when utf-8 encoding is used. That is a reason why there is six hexadecimal digits (two for each byte).</p>\n\n<p>To study printing of a string in detail, start at function <code>fmtString</code> in file <code>fmt/print.go</code>.</p>\n\n<pre><code>func (p *pp) fmtString(v string, verb rune) {\n</code></pre>\n"}], "owner": {"reputation": 16928, "user_id": 1047788, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/xA1rW.png?s=128&g=1", "display_name": "user7610", "link": "https://stackoverflow.com/users/1047788/user7610"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 47422870, "answer_count": 1, "score": 2, "last_activity_date": 1511344069, "creation_date": 1511298950, "last_edit_date": 1511344069, "question_id": 47422869, "link": "https://stackoverflow.com/questions/47422869/why-does-fmt-printfx-%e1%9a%b5-16b5-while-fmt-printfx-%e1%9a%b5-e19ab5", "title": "Why does fmt.Printf(&quot;%x&quot;, &#39;\u16b5&#39;) ~&gt; 16b5, while fmt.Printf(&quot;%x&quot;, &quot;\u16b5&quot;) ~&gt; e19ab5?", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Printf(\"%c, %x, %x\", '\u16b5', '\u16b5', \"\u16b5\")\n}\n</code></pre>\n\n<p>Outputs:</p>\n\n<pre><code>\u16b5, 16b5, e19ab5\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/_Bs7JcdOfO\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_Bs7JcdOfO</a></p>\n"}, {"tags": ["function", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1511296794, "post_id": 47422284, "comment_id": 81799041, "body": "Where is the code showing your attempt?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1511298063, "post_id": 47422284, "comment_id": 81799736, "body": "You might also want to take a look at the <a href=\"https://golang.org/pkg/expvar/\" rel=\"nofollow noreferrer\">expvar package</a> which is made for things like this."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1511299445, "post_id": 47422284, "comment_id": 81800553, "body": "<b>To all the down and close voters:</b> This is not as simple in Go. Beware of races."}], "answers": [{"comments": [{"owner": {"reputation": 546, "user_id": 1174534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca8267f69e15cd421deb3ca8a0524ec4?s=128&d=identicon&r=PG", "display_name": "navossoc", "link": "https://stackoverflow.com/users/1174534/navossoc"}, "edited": false, "score": 0, "creation_date": 1511297912, "post_id": 47422446, "comment_id": 81799657, "body": "It is good enough for me :)"}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "reply_to_user": {"reputation": 546, "user_id": 1174534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca8267f69e15cd421deb3ca8a0524ec4?s=128&d=identicon&r=PG", "display_name": "navossoc", "link": "https://stackoverflow.com/users/1174534/navossoc"}, "edited": false, "score": 0, "creation_date": 1511300371, "post_id": 47422446, "comment_id": 81801068, "body": "Why the downvote?"}, {"owner": {"reputation": 546, "user_id": 1174534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca8267f69e15cd421deb3ca8a0524ec4?s=128&d=identicon&r=PG", "display_name": "navossoc", "link": "https://stackoverflow.com/users/1174534/navossoc"}, "edited": false, "score": 0, "creation_date": 1511302418, "post_id": 47422446, "comment_id": 81802016, "body": "it is not mine... I see a lot of &quot;hate&quot; (downvotes) on go questions, not sure why."}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 4, "last_activity_date": 1511297334, "creation_date": 1511297334, "answer_id": 47422446, "question_id": 47422284, "link": "https://stackoverflow.com/questions/47422284/count-how-many-times-function-was-called/47422446#47422446", "title": "Count how many times function was called", "body": "<pre><code>var doThingCounter = 0\nfunc DoThing() {\n  // Do the thing...\n  doThingCounter++\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 546, "user_id": 1174534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca8267f69e15cd421deb3ca8a0524ec4?s=128&d=identicon&r=PG", "display_name": "navossoc", "link": "https://stackoverflow.com/users/1174534/navossoc"}, "edited": false, "score": 0, "creation_date": 1511302448, "post_id": 47422918, "comment_id": 81802029, "body": "You can use the atomic package and get the same safety with less code."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 546, "user_id": 1174534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca8267f69e15cd421deb3ca8a0524ec4?s=128&d=identicon&r=PG", "display_name": "navossoc", "link": "https://stackoverflow.com/users/1174534/navossoc"}, "edited": false, "score": 0, "creation_date": 1511308159, "post_id": 47422918, "comment_id": 81804147, "body": "@navossoc: Not true. For multiple goroutines without synchronization events,  you will read between zero and the written count. For example, <code>atomic.LoadUint64(&amp;a)</code> may always be zero for <code>go func() { for { atomic.AddUint64(&amp;a, uint64(1)) } }()</code>."}, {"owner": {"reputation": 721, "user_id": 8930534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0277bb31c0a6d6334cf3d287289bc17?s=128&d=identicon&r=PG&f=1", "display_name": "Hugh", "link": "https://stackoverflow.com/users/8930534/hugh"}, "edited": false, "score": 0, "creation_date": 1511309143, "post_id": 47422918, "comment_id": 81804424, "body": "@peterSO - Do you have any links for reading/understanding why this is the case?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 721, "user_id": 8930534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0277bb31c0a6d6334cf3d287289bc17?s=128&d=identicon&r=PG&f=1", "display_name": "Hugh", "link": "https://stackoverflow.com/users/8930534/hugh"}, "edited": false, "score": 1, "creation_date": 1511310340, "post_id": 47422918, "comment_id": 81804763, "body": "@Hugh: <a href=\"https://golang.org/ref/mem\" rel=\"nofollow noreferrer\">The Go Memory Model</a>."}, {"owner": {"reputation": 546, "user_id": 1174534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca8267f69e15cd421deb3ca8a0524ec4?s=128&d=identicon&r=PG", "display_name": "navossoc", "link": "https://stackoverflow.com/users/1174534/navossoc"}, "edited": false, "score": 1, "creation_date": 1511314066, "post_id": 47422918, "comment_id": 81805789, "body": "See my answer then... Also he ask a way to count how many times a function has been called, he didn&#39;t specify it should be thread safe or not. So @maerics answer is perfectly fine for me."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511357305, "post_id": 47422918, "comment_id": 81826055, "body": "In practice I think you&#39;ll still find most simple &quot;counters&quot; done with atomics, because pragmatically one usually wants lower contention over perfect ordering of operations."}, {"owner": {"reputation": 721, "user_id": 8930534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0277bb31c0a6d6334cf3d287289bc17?s=128&d=identicon&r=PG&f=1", "display_name": "Hugh", "link": "https://stackoverflow.com/users/8930534/hugh"}, "reply_to_user": {"reputation": 546, "user_id": 1174534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca8267f69e15cd421deb3ca8a0524ec4?s=128&d=identicon&r=PG", "display_name": "navossoc", "link": "https://stackoverflow.com/users/1174534/navossoc"}, "edited": false, "score": 0, "creation_date": 1511399800, "post_id": 47422918, "comment_id": 81847688, "body": "@navossoc and peterSO this is still unclear to me, I can&#39;t tell any functional difference between the two to be honest. I&#39;ve asked a question <a href=\"https://stackoverflow.com/q/47445344/8930534\">here</a> to try to clarify."}, {"owner": {"reputation": 546, "user_id": 1174534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca8267f69e15cd421deb3ca8a0524ec4?s=128&d=identicon&r=PG", "display_name": "navossoc", "link": "https://stackoverflow.com/users/1174534/navossoc"}, "reply_to_user": {"reputation": 721, "user_id": 8930534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0277bb31c0a6d6334cf3d287289bc17?s=128&d=identicon&r=PG&f=1", "display_name": "Hugh", "link": "https://stackoverflow.com/users/8930534/hugh"}, "edited": false, "score": 0, "creation_date": 1511415914, "post_id": 47422918, "comment_id": 81851655, "body": "@Hugh Chad Kunde told me this yesterday on slack group: &quot;Each individual call is atomic, but there&#39;s no order guarantee across threads.&quot; Using this code (peterSO) you will enforce the correct order when you call the <code>fncCount.Count()</code>, so the number count will be <b>exact</b> at that given moment because you are forcing the execution to be serialized. However, if you don&#39;t care about getting the <b>exactly</b> numbers of calls when the goroutines are still running, you can use the <code>atomic</code> version (it may be off by a few). It is the same as @JimB has said above."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 5, "last_activity_date": 1511312090, "last_edit_date": 1511312090, "creation_date": 1511299172, "answer_id": 47422918, "question_id": 47422284, "link": "https://stackoverflow.com/questions/47422284/count-how-many-times-function-was-called/47422918#47422918", "title": "Count how many times function was called", "body": "<p>For example,</p>\n\n<p><code>count.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\ntype Count struct {\n    mx    *sync.Mutex\n    count int64\n}\n\nfunc NewCount() *Count {\n    return &amp;Count{mx: new(sync.Mutex), count: 0}\n}\n\nfunc (c *Count) Incr() {\n    c.mx.Lock()\n    c.count++\n    c.mx.Unlock()\n}\n\nfunc (c *Count) Count() int64 {\n    c.mx.Lock()\n    count := c.count\n    c.mx.Unlock()\n    return count\n}\n\nvar fncCount = NewCount()\n\nfunc fnc() {\n    fncCount.Incr()\n}\n\nfunc main() {\n    for i := 0; i &lt; 42; i++ {\n        go fnc()\n    }\n    time.Sleep(time.Second)\n    fmt.Println(fncCount.Count())\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run count.go\n42\n</code></pre>\n\n<p>Also, run the race detector,</p>\n\n<pre><code>$ go run -race count.go\n42\n</code></pre>\n\n<p>See:</p>\n\n<p><a href=\"https://blog.golang.org/race-detector\" rel=\"nofollow noreferrer\">Introducing the Go Race Detector</a>.</p>\n\n<p><a href=\"https://software.intel.com/en-us/blogs/2013/01/06/benign-data-races-what-could-possibly-go-wrong\" rel=\"nofollow noreferrer\">Benign data races: what could possibly go wrong?</a>.</p>\n\n<p><a href=\"https://golang.org/ref/mem\" rel=\"nofollow noreferrer\">The Go Memory Model</a></p>\n\n<hr>\n\n<p>And here's a racy solution (<a href=\"https://stackoverflow.com/a/47422446/221700\">@maerics answer</a> is racy for the same reason),</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nvar fncCount = 0\n\nfunc fnc() {\n    fncCount++\n}\n\nfunc main() {\n    for i := 0; i &lt; 42; i++ {\n        go fnc()\n    }\n    time.Sleep(time.Second)\n    fmt.Println(fncCount)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run racer.go\n39\n</code></pre>\n\n<p>And, with the race detector,</p>\n\n<p>Output:</p>\n\n<pre><code>$ go run -race racer.go\n==================\nWARNING: DATA RACE\nRead at 0x0000005b5380 by goroutine 7:\n  main.fnc()\n      /home/peter/gopath/src/so/racer.go:11 +0x3a\n\nPrevious write at 0x0000005b5380 by goroutine 6:\n  main.fnc()\n      /home/peter/gopath/src/so/racer.go:11 +0x56\n\nGoroutine 7 (running) created at:\n  main.main()\n      /home/peter/gopath/src/so/racer.go:16 +0x4f\n\nGoroutine 6 (finished) created at:\n  main.main()\n      /home/peter/gopath/src/so/racer.go:16 +0x4f\n==================\n42\nFound 1 data race(s)\nexit status 66\n$ \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1511317924, "post_id": 47425408, "comment_id": 81806648, "body": "You are conflating two different issues. There are no guarantees in the Go memory model that, in the absence of explicit synchronization, the result you see from an attomic.Load in one goroutine will correspond to the most recent atomic.Add in another goroutine."}, {"owner": {"reputation": 546, "user_id": 1174534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca8267f69e15cd421deb3ca8a0524ec4?s=128&d=identicon&r=PG", "display_name": "navossoc", "link": "https://stackoverflow.com/users/1174534/navossoc"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1511319739, "post_id": 47425408, "comment_id": 81807052, "body": "I see what you mean now, but he didn&#39;t say when he wants to get the calls count. So why overcomplicate it?"}], "tags": [], "owner": {"reputation": 546, "user_id": 1174534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca8267f69e15cd421deb3ca8a0524ec4?s=128&d=identicon&r=PG", "display_name": "navossoc", "link": "https://stackoverflow.com/users/1174534/navossoc"}, "is_accepted": false, "score": 5, "last_activity_date": 1511313995, "creation_date": 1511313995, "answer_id": 47425408, "question_id": 47422284, "link": "https://stackoverflow.com/questions/47422284/count-how-many-times-function-was-called/47425408#47425408", "title": "Count how many times function was called", "body": "<p>Let me quote the atomic package documentation:</p>\n\n<blockquote>\n  <p>Package atomic provides low-level atomic memory primitives useful for\n  implementing synchronization algorithms.\n  <a href=\"https://golang.org/pkg/sync/atomic/\" rel=\"noreferrer\">https://golang.org/pkg/sync/atomic/</a></p>\n</blockquote>\n\n<p>Same code, but simpler and safe too.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync/atomic\"\n    \"time\"\n)\n\nvar fncCount uint64\n\nfunc fnc() {\n    atomic.AddUint64(&amp;fncCount, 1)\n}\n\nfunc main() {\n    for i := 0; i &lt; 42; i++ {\n        go fnc()\n    }\n    // this is bad, because it won't wait for the goroutines finish\n    time.Sleep(time.Second)\n\n    fncCountFinal := atomic.LoadUint64(&amp;fncCount)\n    fmt.Println(fncCountFinal)\n}\n</code></pre>\n\n<blockquote>\n  <p>$ go run -race main.go</p>\n  \n  <p>42</p>\n</blockquote>\n"}], "owner": {"reputation": 5971, "user_id": 5537840, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/aKRoy.jpg?s=128&g=1", "display_name": "Kenenbek Arzymatov", "link": "https://stackoverflow.com/users/5537840/kenenbek-arzymatov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 892, "favorite_count": 0, "closed_date": 1511315837, "answer_count": 3, "score": -2, "last_activity_date": 1511313995, "creation_date": 1511296774, "question_id": 47422284, "link": "https://stackoverflow.com/questions/47422284/count-how-many-times-function-was-called", "closed_reason": "Not suitable for this site", "title": "Count how many times function was called", "body": "<p>How can I elegantly do it in <code>go</code>?</p>\n\n<p>In python I could use attribute like this:</p>\n\n<pre><code>def function():\n    function.counter += 1\nfunction.counter = 0\n</code></pre>\n\n<p>Does <code>go</code> have the same opportunity?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1511294825, "post_id": 47421213, "comment_id": 81797905, "body": "Compile error: <code>undefined: UploadChunk</code>."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1511295425, "post_id": 47421934, "comment_id": 81798257, "body": "Or just pass it as a parameter to the anonymous function."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1511295687, "post_id": 47421934, "comment_id": 81798431, "body": "Right, that would also work, although be careful about the function defined at the beginning of the loop, which also uses <code>partno</code> (although only for debugging output) and is called from the goroutine. It will also potentially see the wrong value."}, {"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 0, "creation_date": 1511307157, "post_id": 47421934, "comment_id": 81803825, "body": "Can multiple goroutines safely call f.ReadAt ?"}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1511310147, "post_id": 47421934, "comment_id": 81804687, "body": "Good question. The documentation doesn&#39;t say anything about that. If your system has the <code>pread</code> system call (or equivalent), <code>ReadAt</code> should be goroutine safe. It might not be the best idea to depend on that, though. Instead of the way you&#39;re doing it, you could spawn several workers that read &quot;parts&quot; from a channel and upload them, then in the main goroutine read each part and put it on the channel. You&#39;d need to create a struct type to contain the data and the part number and use that as the data type for the channel."}, {"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 0, "creation_date": 1511315833, "post_id": 47421934, "comment_id": 81806167, "body": "Yes I&#39;m running this on Linux where pread is available and it will never run on any other platform being tied to fuse.  So that&#39;s safe.  I wasn&#39;t aware of pread so it looks like it&#39;ll be fine if it uses it underneath.  I&#39;ll check"}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": false, "score": 0, "last_activity_date": 1511295376, "creation_date": 1511295376, "answer_id": 47421934, "question_id": 47421213, "link": "https://stackoverflow.com/questions/47421213/farm-out-work-to-a-slice-but-limit-number-of-workers/47421934#47421934", "title": "Farm out work to a slice but limit number of workers", "body": "<p>Skipping for the moment the question of how better to structure this code, I see a bug in your code which may be causing the problem you're seeing. Since the function you're running in the goroutine uses the variable <code>partno</code>, which changes with each iteration of the loop, your goroutine isn't necessarily seeing the value of <code>partno</code> at the time you invoked the goroutine. A common way of fixing this is to create a local copy of that variable inside the loop:</p>\n\n<pre><code>for partno := 1; partno &lt;= total; partno++ {\n    partno := partno\n    // ...\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": false, "score": 0, "last_activity_date": 1511302904, "last_edit_date": 1511302904, "creation_date": 1511301193, "answer_id": 47423369, "question_id": 47421213, "link": "https://stackoverflow.com/questions/47421213/farm-out-work-to-a-slice-but-limit-number-of-workers/47423369#47423369", "title": "Farm out work to a slice but limit number of workers", "body": "<p>Data race #1 </p>\n\n<p>Multiple <code>goroutines</code> are using the same buffer concurrently. Note that one <code>gorouting</code> may be filling it with a new chunk while another is still reading an old chunk from it. Instead, each <code>goroutine</code> should have it's own buffer.</p>\n\n<p>Data race #2 </p>\n\n<p>As Andy Schweig has pointed, the value in <code>partno</code> is updated by the loop before the <code>goroutine</code> created in that iteration has a chance to read it. This is why the final <code>partno</code> 22 occurs multiple times. To fix it, you can pass <code>partno</code> as a argument to the anonymous function. That will ensure each <code>goroutine</code> has it's own part number.</p>\n\n<p>Also, you can use a channel to pass the results from the workers. Maybe a struct type with the part number and error. That way, you will be able to observe the progress and retry failed uploads.</p>\n\n<p>For an example of a good pattern check out this <a href=\"https://github.com/adonovan/gopl.io/blob/master/ch8/thumbnail/thumbnail_test.go#L117\" rel=\"nofollow noreferrer\">example</a> from the GOPL book.</p>\n"}, {"comments": [{"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 0, "creation_date": 1511307142, "post_id": 47423716, "comment_id": 81803822, "body": "Thanks that makes sense.  Also, can multiple goroutines safely call f.ReadAt ?"}], "tags": [], "owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "is_accepted": false, "score": 0, "last_activity_date": 1511333878, "last_edit_date": 1511333878, "creation_date": 1511302789, "answer_id": 47423716, "question_id": 47421213, "link": "https://stackoverflow.com/questions/47421213/farm-out-work-to-a-slice-but-limit-number-of-workers/47423716#47423716", "title": "Farm out work to a slice but limit number of workers", "body": "<p>Suggested changes</p>\n\n<p>As noted by dev.bmax <code>buf</code> moved into go routine, as noted by Andy Schweig <code>partno</code> is param to anon function, also added <code>WaitGroup</code> since <code>UploadFile</code> was exiting before uploads were complete. Also <code>defer f.Close()</code> file, good habit.</p>\n\n\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"sync\"\n    \"time\"\n)\n\nconst defaultChunkSize = 1 * 1024 * 1024\n\n// wg for uploads to complete\nvar wg sync.WaitGroup\n\n// Lets have 4 workers\nvar c = make(chan int, 4)\n\nfunc UploadFile(f *os.File) error {\n    // wait for all the uploads to complete before function exit\n    defer wg.Wait()\n\n    fi, err := f.Stat()\n    if err != nil {\n        return fmt.Errorf(\"err: %s\", err)\n    }\n    size := fi.Size()\n    fmt.Printf(\"file size: %v\\n\", size)\n\n    total := int(size/defaultChunkSize + 1)\n    // Upload parts\n    for partno := 1; partno &lt;= total; partno++ {\n\n        readChunk := func(offset int, buf []byte, partno int) (int, error) {\n            fmt.Println(\"readChunk\", partno, offset)\n            n, err := f.ReadAt(buf, int64(offset))\n            if err != nil {\n                return n, err\n            }\n\n            return n, nil\n        }\n\n        // This will block if there are not enough worker slots available\n        c &lt;- partno\n\n        // The actual worker.\n        go func(partno int) {\n            // wait for me to be done\n            wg.Add(1)\n            defer wg.Done()\n\n            buf := make([]byte, defaultChunkSize)\n\n            offset := (partno - 1) * defaultChunkSize\n            n, err := readChunk(offset, buf, partno)\n            if err != nil &amp;&amp; err != io.EOF {\n                return\n            }\n\n            err = uploadPart(partno, buf[:n])\n            if err != nil {\n                fmt.Println(\"Uploadpart failed:\", err)\n            }\n            &lt;-c\n        }(partno)\n    }\n\n    return nil\n}\n\nfunc uploadPart(partno int, buf []byte) error {\n    fmt.Printf(\"Uploading partno: %d, buflen=%d\\n\", partno, len(buf))\n\n    // Actually do the upload.  Simulate long running task with a sleep\n    time.Sleep(time.Second)\n    return nil\n}\n\nfunc main() {\n    filename := \"/home/matthewh/Downloads/largefile.tar.gz\"\n    fmt.Printf(\"Opening file: %s\\n\", filename)\n\n    f, err := os.Open(filename)\n    if err != nil {\n        panic(err)\n    }\n    defer f.Close()\n\n    UploadFile(f)\n}\n</code></pre>\n\n<p>I'm sure you can deal a little smarter with the <code>buf</code> situation. I'm just letting go deal with the garbage. Since you are limiting your workers to specific number <code>4</code> you really need only <code>4</code> x <code>defaultChunkSize</code> buffers. Please do share if you come up with something simple and shareworth.</p>\n\n<p>Have fun!</p>\n"}], "owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 94, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1511333878, "creation_date": 1511292754, "last_edit_date": 1511309136, "question_id": 47421213, "link": "https://stackoverflow.com/questions/47421213/farm-out-work-to-a-slice-but-limit-number-of-workers", "title": "Farm out work to a slice but limit number of workers", "body": "<p>I'm trying to improve the performance of an app.\nOne part of its code uploads a file to a server in chunks.</p>\n\n<p>The original version simply does this in a sequential loop.  However, it's slow and during the sequence it also needs to talk to another server before uploading each chunk.</p>\n\n<p>The upload of chunks could simply be placed in a goroutine.  It works, but is not a good solution because if the source file is extremely large it ends up using a large amount of memory.  </p>\n\n<p>So, I try to limit the number of active goroutines by using a buffered channel.  Here is some code that shows my attempt.  I've stripped it down to show the concept and you can run it to test for yourself.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"time\"\n)\n\nconst defaultChunkSize = 1 * 1024 * 1024\n\n// Lets have 4 workers\nvar c = make(chan int, 4)\n\nfunc UploadFile(f *os.File) error {\n    fi, err := f.Stat()\n    if err != nil {\n        return fmt.Errorf(\"err: %s\", err)\n    }\n    size := fi.Size()\n\n    total := (int)(size/defaultChunkSize + 1)\n    // Upload parts\n    buf := make([]byte, defaultChunkSize)\n    for partno := 1; partno &lt;= total; partno++ {\n        readChunk := func(offset int, buf []byte) (int, error) {\n            fmt.Println(\"readChunk\", partno, offset)\n            n, err := f.ReadAt(buf, int64(offset))\n            if err != nil {\n                return n, err\n            }\n\n            return n, nil\n        }\n\n        // This will block if there are not enough worker slots available\n        c &lt;- partno\n\n        // The actual worker.\n        go func() {\n            offset := (partno - 1) * defaultChunkSize\n            n, err := readChunk(offset, buf)\n            if err != nil &amp;&amp; err != io.EOF {\n                return\n            }\n\n            err = uploadPart(partno, buf[:n])\n            if err != nil {\n                fmt.Println(\"Uploadpart failed:\", err)\n            }\n            &lt;-c\n        }()\n    }\n\n    return nil\n}\n\nfunc uploadPart(partno int, buf []byte) error {\n    fmt.Printf(\"Uploading partno: %d, buflen=%d\\n\", partno, len(buf))\n    // Actually upload the part.  Lets test it by instead writing each\n    // buffer to another file.  We can then use diff to compare the \n    // source and dest files.\n\n    // Open file.  Seek to (partno - 1) * defaultChunkSize, write buffer\n    f, err := os.OpenFile(\"/home/matthewh/Downloads/out.tar.gz\", os.O_CREATE|os.O_WRONLY, 0755)\n    if err != nil {\n        fmt.Printf(\"err: %s\\n\", err)\n    }\n\n    n, err := f.WriteAt(buf, int64((partno-1)*defaultChunkSize))\n    if err != nil {\n        fmt.Printf(\"err=%s\\n\", err)\n    }\n    fmt.Printf(\"%d bytes written\\n\", n)\n    defer f.Close()\n    return nil\n}\n\nfunc main() {\n    filename := \"/home/matthewh/Downloads/largefile.tar.gz\"\n    fmt.Printf(\"Opening file: %s\\n\", filename)\n\n    f, err := os.Open(filename)\n    if err != nil {\n        panic(err)\n    }\n\n    UploadFile(f)\n}\n</code></pre>\n\n<p>It almost works.  But there are several problems.\n1)  The final partno 22 is occuring 3 times.  The correct length is actually 612545 as the file length isn't a multiple of 1MB.</p>\n\n<pre><code>// Sample output\n...\nreadChunk 21 20971520\nreadChunk 22 22020096\nUploading partno: 22, buflen=1048576\nUploading partno: 22, buflen=612545\nUploading partno: 22, buflen=1048576\n</code></pre>\n\n<p>Another problem, the upload could fail and I am not familiar enough with go and how best to solve failure of the goroutine.  </p>\n\n<p>Finally, I want to ordinarily return some data from the uploadPart when it succeeds.  Specifically, it'll be a string (an HTTP ETag header value). These etag values need to be collected by the main function.</p>\n\n<p>What is a better way to structure this code in this instance?  I've not yet found a good golang design pattern that correctly fulfills my needs here.</p>\n"}, {"tags": ["go", "soap", "wsdl", "soap-client"], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 10, "last_activity_date": 1511311310, "creation_date": 1511311310, "answer_id": 47425070, "question_id": 47421135, "link": "https://stackoverflow.com/questions/47421135/calling-soap-with-golang/47425070#47425070", "title": "Calling SOAP with Golang", "body": "<p>To use the generated code you obviously will have to first initialize the soap client with one of the generated \"constructor\" functions <code>NewSOAPClient</code> or <code>NewSOAPClientWithTLSConfig</code>.</p>\n\n<p>After that you'll need to prepare <strong>two</strong> values that you can use as the request and response arguments to the <code>Call</code> method, they represent the body content of the soap request/response payloads.</p>\n\n<p>The types of those two values will depend on what kind of call you want to make, for example the hypothetical calls create_account, update_account, and delete_account would usually require different types. Basically, the type of the <code>request</code> value should be <em>marshalable</em> into an xml that matches the xml expected by the soap service for the specified action, and the type of the <code>response</code> should be <em>unmarshalable</em> from an xml that matches the soap service's documented response for the specified action.</p>\n\n<hr>\n\n<p>Consider this contrived example: </p>\n\n<p>There is a SOAP service that allows you to create users. For you to be able to create a user with the service it requires you to send an email and a password, and if everyting's ok it will return an id. In such a case your two request/response types would look like this:</p>\n\n<pre><code>type CreateUserRequest struct {\n    Email    string `xml:\"Email,omitempty\"`\n    Password string `xml:\"Password,omitempty\"`\n}\n\ntype CreateUserResponse struct {\n    ID string `xml:\"ID\"`\n}\n</code></pre>\n\n<p>Then the client code would look like this:</p>\n\n<pre><code>client := NewSOAPClient(\"https://soap.example.com/call\", true, nil)\n\nreq := &amp;CreateUserRequest{\n    Email:    \"jdoe@example.com\",\n    Password: \"1234567890\",\n}\nres := &amp;CreateUserResponse{}\nif err := client.Call(\"create_user\", req, res); err != nil {\n    panic(err)\n}\n\n// if everything went well res.ID should have its\n// value set with the one returned by the service.\nfmt.Println(res.ID)\n</code></pre>\n"}], "owner": {"reputation": 2066, "user_id": 6363050, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f9db389fc3801b8ecef05ed3074e2f03?s=128&d=identicon&r=PG&f=1", "display_name": "Samuel Dare", "link": "https://stackoverflow.com/users/6363050/samuel-dare"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 18177, "favorite_count": 7, "accepted_answer_id": 47425070, "answer_count": 1, "score": 10, "last_activity_date": 1511311310, "creation_date": 1511292478, "question_id": 47421135, "link": "https://stackoverflow.com/questions/47421135/calling-soap-with-golang", "title": "Calling SOAP with Golang", "body": "<p>I am new to golang and trying make a soap call with <a href=\"https://www.google.co.uk/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;uact=8&amp;ved=0ahUKEwjZhrCzstDXAhXIhRoKHSjUDosQFggoMAA&amp;url=https%3A%2F%2Fgithub.com%2Fhooklift%2Fgowsdl&amp;usg=AOvVaw1Yo3mgaI9pVrSym9gqxClb\" rel=\"noreferrer\">gowsdl</a> . </p>\n\n<p>I have generated the wsdl code and installed it as a package. I am however struggling to understand the syntax for call the method from it. </p>\n\n<p>When I examine the package, this is what I want in the soap body:</p>\n\n<pre><code>type AccountUser struct {\n    XMLName xml.Name `xml:\"http://exacttarget.com/wsdl/partnerAPI AccountUser\"`\n\n    *APIObject\n\n    AccountUserID             int32         `xml:\"AccountUserID,omitempty\"`\n    UserID                    string        `xml:\"UserID,omitempty\"`\n    Password                  string        `xml:\"Password,omitempty\"`\n    Name                      string        `xml:\"Name,omitempty\"`\n    Email                     string        `xml:\"Email,omitempty\"`\n    MustChangePassword        bool          `xml:\"MustChangePassword,omitempty\"`\n    ActiveFlag                bool          `xml:\"ActiveFlag,omitempty\"`\n    ChallengePhrase           string        `xml:\"ChallengePhrase,omitempty\"`\n    ChallengeAnswer           string        `xml:\"ChallengeAnswer,omitempty\"`\n    UserPermissions           []*UserAccess `xml:\"UserPermissions,omitempty\"`\n    Delete                    int32         `xml:\"Delete,omitempty\"`\n    LastSuccessfulLogin       time.Time     `xml:\"LastSuccessfulLogin,omitempty\"`\n    IsAPIUser                 bool          `xml:\"IsAPIUser,omitempty\"`\n    NotificationEmailAddress  string        `xml:\"NotificationEmailAddress,omitempty\"`\n    IsLocked                  bool          `xml:\"IsLocked,omitempty\"`\n    Unlock                    bool          `xml:\"Unlock,omitempty\"`\n    BusinessUnit              int32         `xml:\"BusinessUnit,omitempty\"`\n    DefaultBusinessUnit       int32         `xml:\"DefaultBusinessUnit,omitempty\"`\n    DefaultApplication        string        `xml:\"DefaultApplication,omitempty\"`\n    Locale                    *Locale       `xml:\"Locale,omitempty\"`\n    TimeZone                  *TimeZone     `xml:\"TimeZone,omitempty\"`\n    DefaultBusinessUnitObject *BusinessUnit `xml:\"DefaultBusinessUnitObject,omitempty\"`\n\n    AssociatedBusinessUnits struct {\n        BusinessUnit []*BusinessUnit `xml:\"BusinessUnit,omitempty\"`\n    } `xml:\"AssociatedBusinessUnits,omitempty\"`\n\n    Roles struct {\n        Role []*Role `xml:\"Role,omitempty\"`\n    } `xml:\"Roles,omitempty\"`\n\n    LanguageLocale *Locale `xml:\"LanguageLocale,omitempty\"`\n\n    SsoIdentities struct {\n        SsoIdentity []*SsoIdentity `xml:\"SsoIdentity,omitempty\"`\n    } `xml:\"SsoIdentities,omitempty\"`\n}\n</code></pre>\n\n<p>And the method to call the SOAP is : </p>\n\n<pre><code>func (s *SOAPClient) Call(soapAction string, request, response interface{}) error {\n    envelope := SOAPEnvelope{\n    //Header:        SoapHeader{},\n    }\n\n    envelope.Body.Content = request\n    buffer := new(bytes.Buffer)\n\n    encoder := xml.NewEncoder(buffer)\n    //encoder.Indent(\"  \", \"    \")\n\n    if err := encoder.Encode(envelope); err != nil {\n        return err\n    }\n\n    if err := encoder.Flush(); err != nil {\n        return err\n    }\n\n    log.Println(buffer.String())\n\n    req, err := http.NewRequest(\"POST\", s.url, buffer)\n    if err != nil {\n        return err\n    }\n    if s.auth != nil {\n        req.SetBasicAuth(s.auth.Login, s.auth.Password)\n    }\n\n    req.Header.Add(\"Content-Type\", \"text/xml; charset=\\\"utf-8\\\"\")\n    if soapAction != \"\" {\n        req.Header.Add(\"SOAPAction\", soapAction)\n    }\n\n    req.Header.Set(\"User-Agent\", \"gowsdl/0.1\")\n    req.Close = true\n\n    tr := &amp;http.Transport{\n        TLSClientConfig: &amp;tls.Config{\n            InsecureSkipVerify: s.tls,\n        },\n        Dial: dialTimeout,\n    }\n\n    client := &amp;http.Client{Transport: tr}\n    res, err := client.Do(req)\n    if err != nil {\n        return err\n    }\n    defer res.Body.Close()\n\n    rawbody, err := ioutil.ReadAll(res.Body)\n    if err != nil {\n        return err\n    }\n    if len(rawbody) == 0 {\n        log.Println(\"empty response\")\n        return nil\n    }\n\n    log.Println(string(rawbody))\n    respEnvelope := new(SOAPEnvelope)\n    respEnvelope.Body = SOAPBody{Content: response}\n    err = xml.Unmarshal(rawbody, respEnvelope)\n    if err != nil {\n        return err\n    }\n\n    fault := respEnvelope.Body.Fault\n    if fault != nil {\n        return fault\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>I have imported the package into my go file , and would love pointers on how to call this.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1511280686, "post_id": 47417597, "comment_id": 81789108, "body": "Why do you need the second <code>select</code>? If <code>timeout</code> is <code>0</code>, the first will continue immediately."}, {"owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511280916, "post_id": 47417597, "comment_id": 81789271, "body": "Because if I combine all three cases into a single select, then it exits the loop immediately if nothing is available instead of waiting for something to become available or the timer to go off."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1511281129, "post_id": 47417597, "comment_id": 81789417, "body": "Don&#39;t combine them, just use the first select. The <code>time.After</code> becomes your default when timeout is 0."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1511283659, "post_id": 47417597, "comment_id": 81791292, "body": "Question on behavior: if timeout has occurred but there&#39;s still stuff on the channel, do you want it to exit (and ignore what&#39;s left on the channel), or do you want the timeout-exit to only occur if the input channel is also empty?  Also, If the former, is it important that the select <i>immediately</i> exit on timeout, or simply within a few iterations (because select randomly selects from channel operations that are ready, so if timeout has happened <i>and</i> the input channel has stuff, select could select either operation at random)."}, {"owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "edited": false, "score": 0, "creation_date": 1511290057, "post_id": 47417597, "comment_id": 81795113, "body": "It would be fine for the loop to continue executing as long as there is content immediately available on the channel. The timeout only applies to cases where the select would block."}], "answers": [{"comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1511285176, "post_id": 47418678, "comment_id": 81792283, "body": "Non-compilable (your <code>if</code> doesn&#39;t have an end bracket, and the <code>timer</code> declared in it wouldn&#39;t be accessible outside it anyway).  In addition, a nested select would work the same with less lines: <a href=\"https://play.golang.org/p/gA4VsToAl5\" rel=\"nofollow noreferrer\">play.golang.org/p/gA4VsToAl5</a>.  Only breaks if the timeout has expired <i>and</i> the input channel is empty."}, {"owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1511292590, "post_id": 47418678, "comment_id": 81796641, "body": "It compiles fine (if you ignore the undefined vars). Your example could work and is nicer, but it ignores the timer as long as it is able to process more responses. My solution will finish processing whatever it is working on and exit after the timeout."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1511457892, "post_id": 47418678, "comment_id": 81876089, "body": "How is that different from yours?  Yours will continue until the timer hits, then will keep continuing until the input channel is empty.  Mine doesn&#39;t even check the timer unless the input channel is empty, but if it&#39;s empty and the timer has expired, exits immediately.  They have <i>identical behavior</i>."}, {"owner": {"reputation": 4006, "user_id": 208271, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/02fd82768b314de2d7b1098b0923d1bd?s=128&d=identicon&r=PG", "display_name": "Loupax", "link": "https://stackoverflow.com/users/208271/loupax"}, "edited": false, "score": 0, "creation_date": 1526020513, "post_id": 47418678, "comment_id": 87588656, "body": "Sorry for the unrelated comment but this <code>break</code> feels A LOT like a <code>GOTO</code>"}], "tags": [], "owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "is_accepted": false, "score": 1, "last_activity_date": 1512152397, "last_edit_date": 1512152397, "creation_date": 1511283769, "answer_id": 47418678, "question_id": 47417597, "link": "https://stackoverflow.com/questions/47417597/conditional-cases-in-go-select-statement/47418678#47418678", "title": "Conditional cases in Go select statement", "body": "<p>Here is how I would implement what you want:</p>\n\n<pre><code>func foo() {\n    if timeout &gt; 0 {\n        timer := time.NewTimer(timeout)\n        defer timer.Stop()\n\n    wait:\n        for {\n            select {\n            case value := &lt;-somechannel:\n                // Do something with value\n            case &lt;-timer.C:\n                break wait\n            }\n        }\n    } else {\n    drain:\n        for {\n            select {\n            case value := &lt;-somechannel:\n                // Do something with value\n            default:\n                break drain\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>The first loop is a normal consume until timeout. The second loop drains until there are no more immediately available.</p>\n"}], "owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2308, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1512152397, "creation_date": 1511280593, "question_id": 47417597, "link": "https://stackoverflow.com/questions/47417597/conditional-cases-in-go-select-statement", "title": "Conditional cases in Go select statement", "body": "<p>I'm trying to write a select in Go that incorporates an optional timeout, something like this:</p>\n\n<pre><code>done := false\n\nfor !done {\n    if timeout &gt; 0 {\n        select {\n        case value := &lt;- somechannel:\n            // Do something with value\n        case &lt;- time.After(timeout):\n            done = true\n        }\n    } else {\n        select {\n        case value := &lt;- somechannel:\n            // Do something with value\n        default:\n            done = true\n        }\n    }\n}\n</code></pre>\n\n<p>That is, if nothing is pending on the channel, and I haven't set a timeout, I exit. If a timeout is set and nothing is available, then I wait for either the timeout or for something to be available on the channel. I'd love to combine this into a single select, but I can't see how I can do that. Any idea?</p>\n"}, {"tags": ["ajax", "reactjs", "post", "go"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1511275651, "post_id": 47415754, "comment_id": 81785379, "body": "I&#39;d say your frontend code attaches a file under the form key &quot;name&quot; and your backend code tries to find it using the key &quot;file&quot;, and fails. I&#39;d try to debug it by looking directly at the wire representation of your POST request."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1511275725, "post_id": 47415754, "comment_id": 81785450, "body": "Another approach is to &quot;manually&quot; parsing the form by 1) looking at the <code>Content-Type</code> header field to get the &quot;boundary&quot; string from it; 2) parsing it using the <code>multipart</code> stdlib package. Read up on the <code>multipart&#47;form-data</code> body format."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1511277653, "post_id": 47415754, "comment_id": 81786871, "body": "@kostix that&#39;s not what the posted code shows: <code>name=&quot;file&quot;</code> appears to indicate the form key is <code>file</code>, not <code>name</code> as you suggested."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1511279083, "post_id": 47415754, "comment_id": 81787913, "body": "@Adrian, I was referring to the bit starting with <code>File(61718) {preview:</code>. The <code>&lt;Dropzone&gt;</code> element (whatever it is) indeed has an attribute <code>name=&quot;file&quot;</code> but thet some JS kicks in, and it prepares an XHR request and posts it. I have no idea about how it does the preparation so I started guessing from a level below ;-)"}, {"owner": {"reputation": 309, "user_id": 1396929, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/221315012a0495acf6feed3f7b5de204?s=128&d=identicon&r=PG", "display_name": "deranjer", "link": "https://stackoverflow.com/users/1396929/deranjer"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1511283542, "post_id": 47415754, "comment_id": 81791219, "body": "@kostix I&#39;m using <a href=\"https://github.com/react-dropzone/react-dropzone\" rel=\"nofollow noreferrer\">github.com/react-dropzone/react-dropzone</a> and superagent as described in the react-dropzone example. I think I might have to strip all that out and try a pure js implementation to see if that works."}], "owner": {"reputation": 309, "user_id": 1396929, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/221315012a0495acf6feed3f7b5de204?s=128&d=identicon&r=PG", "display_name": "deranjer", "link": "https://stackoverflow.com/users/1396929/deranjer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 675, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1511312107, "creation_date": 1511275110, "last_edit_date": 1511312107, "question_id": 47415754, "link": "https://stackoverflow.com/questions/47415754/react-dropzone-post-file-to-go-server", "title": "React Dropzone post file to Go server", "body": "<p>I't trying to use React-dropzone to post files to a Go backend but am having issues.</p>\n\n<p>This is my react code:</p>\n\n<pre><code>const request = require('superagent');\n&lt;Dropzone name=\"file\" onDrop={this.onDrop} multiple={false} /&gt; \n\nonDrop = (acceptedFiles) =&gt; {\n   const req = request.post('/uploadTorrent');\n\n    acceptedFiles.forEach(file =&gt; {\n        req.attach(file.name, file);\n    });\n    req.end();\n}\n</code></pre>\n\n<p>This is the error on the JS side:</p>\n\n<pre><code>XHR failed loading: POST \"http://192.168.1.141:8000/uploadTorrent\"\nPOST http://192.168.1.141:8000/uploadTorrent net::ERR_EMPTY_RESPONSE\n</code></pre>\n\n<p>If I console.log the file variable on the JS side I get this:</p>\n\n<pre><code>File(61718) {preview: \"blob:http://192.168.1.141:8000/a3e9ed9f-6f6c-4471-8322-3591e9e138c7\", name: \"ubuntu-17.04-desktop-amd64.iso (1).torrent\", lastModified: 1506018302216, lastModifiedDate: Thu Sep 21 2017 14:25:02 GMT-0400 (Eastern Daylight Time), webkitRelativePath: \"\",\u00a0\u2026}\n</code></pre>\n\n<p>Not sure if that is how it should look or not.</p>\n\n<p>I can CURL the server and it works exactly as expected:</p>\n\n<pre><code>curl http://192.168.1.141:8000/uploadTorrent -F \"file=@ubuntu.torrent;filename=ubuntu.torrent\"\n</code></pre>\n\n<p>Here is the code for the Go side:</p>\n\n<pre><code>http.HandleFunc(\"/uploadTorrent\", func(w http.ResponseWriter, r *http.Request) { //grabbing the uploaded Torrent File and adding it to the client\n\n\n    file, header, err := r.FormFile(\"file\")\n    fmt.Println(reflect.TypeOf(file))\n    fmt.Println(\"File: \", file)\n    if err != nil {\n        fmt.Println(\"Error with fetching file or request issue\", file)\n    }\n</code></pre>\n\n<p>It always pulls in a NIL value for the file variable when I try and upload from JS.</p>\n\n<pre><code>&lt;nil&gt;\nFile:  &lt;nil&gt;\nError with fetching file or request issue &lt;nil&gt;\n2017/11/20 23:54:10 http: panic serving 192.168.1.141:64806: runtime error: \ninvalid memory address or nil pointer dereference\n</code></pre>\n\n<p>Anyone know what could be causing this?</p>\n\n<p>Update:</p>\n\n<p>I started from scratch with this element:</p>\n\n<pre><code>&lt;form  encType=\"multipart/form-data\" method=\"post\" action=\"/uploadTorrent\"&gt;\n   &lt;input  name=\"fileTest\" type=\"file\" /&gt;&lt;p /&gt;\n   &lt;input type=\"submit\" value=\"submit\" /&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>(I edited the backend to look for \"fileTest\").  This works perfectly.  I am forced to do a 301 redirect back to the main page which annoys me since that is not the react way but I am new to this so I will accept this as a workaround I am satisfied with.</p>\n"}, {"tags": ["curl", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511273260, "post_id": 47414940, "comment_id": 81783639, "body": "Are you using <code>net&#47;http.ServeMux</code> or are you using some other 3rd party router that needs a method specified when registering handlers? Would be helpful if you show the code where you setup the router."}, {"owner": {"reputation": 41, "user_id": 5347313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c23747e31442ccd9394743a23bd5ff70?s=128&d=identicon&r=PG&f=1", "display_name": "metric_chicken", "link": "https://stackoverflow.com/users/5347313/metric-chicken"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511273343, "post_id": 47414940, "comment_id": 81783703, "body": "@mkopriva I am using &quot;github.com/gorilla/mux&quot;"}, {"owner": {"reputation": 41, "user_id": 5347313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c23747e31442ccd9394743a23bd5ff70?s=128&d=identicon&r=PG&f=1", "display_name": "metric_chicken", "link": "https://stackoverflow.com/users/5347313/metric-chicken"}, "reply_to_user": {"reputation": 33642, "user_id": 620097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/820980fd43f2607a815c1f3dbfe152cc?s=128&d=identicon&r=PG", "display_name": "shellter", "link": "https://stackoverflow.com/users/620097/shellter"}, "edited": false, "score": 0, "creation_date": 1511273431, "post_id": 47414940, "comment_id": 81783776, "body": "@shellter I am running the curl commands via bash. I need to build an endpoint to test a shell script."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511273539, "post_id": 47414940, "comment_id": 81783851, "body": "when registering the handler or configuring the gorilla router did you specify the http methods allowed?"}, {"owner": {"reputation": 41, "user_id": 5347313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c23747e31442ccd9394743a23bd5ff70?s=128&d=identicon&r=PG&f=1", "display_name": "metric_chicken", "link": "https://stackoverflow.com/users/5347313/metric-chicken"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511273736, "post_id": 47414940, "comment_id": 81783988, "body": "@mkopriva I added my routes.go file. That&#39;s where I specified my routes including the upload route."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1511273750, "post_id": 47414940, "comment_id": 81784001, "body": "Ok, change POST to PUT, because curl documentation on <code>-T</code> says &quot;If this is used on an HTTP(S) server, the PUT command will be used&quot;."}, {"owner": {"reputation": 41, "user_id": 5347313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c23747e31442ccd9394743a23bd5ff70?s=128&d=identicon&r=PG&f=1", "display_name": "metric_chicken", "link": "https://stackoverflow.com/users/5347313/metric-chicken"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511274007, "post_id": 47414940, "comment_id": 81784190, "body": "Ok, I changed the method to PUT. Now I get this error:  curl: (52) Empty reply from server How do I send back a response from the server?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1511274191, "post_id": 47414940, "comment_id": 81784328, "body": "By writing to <code>w</code>. E.g. <code>w.WriteHeader(http.StatusOK)</code> will respond with 200 and empty body, if you need to send some content in the response body you can use <code>w.Write</code> either by itself or with the help of the <code>io</code> or <code>fmt</code> package, depending on what data you want to send back."}, {"owner": {"reputation": 41, "user_id": 5347313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c23747e31442ccd9394743a23bd5ff70?s=128&d=identicon&r=PG&f=1", "display_name": "metric_chicken", "link": "https://stackoverflow.com/users/5347313/metric-chicken"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511274246, "post_id": 47414940, "comment_id": 81784365, "body": "@mkopriva No, I dont think that I am. I&#39;m not sure how to send one back."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511274513, "post_id": 47414940, "comment_id": 81784580, "body": "for example look here <a href=\"https://golang.org/doc/articles/wiki/#tmp_3\" rel=\"nofollow noreferrer\">golang.org/doc/articles/wiki/#tmp_3</a> how <code>fmt.Fprintf</code> is used to send a string back to the client."}, {"owner": {"reputation": 41, "user_id": 5347313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c23747e31442ccd9394743a23bd5ff70?s=128&d=identicon&r=PG&f=1", "display_name": "metric_chicken", "link": "https://stackoverflow.com/users/5347313/metric-chicken"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511274807, "post_id": 47414940, "comment_id": 81784783, "body": "Ok, Ill give it a shot and let you know!"}, {"owner": {"reputation": 41, "user_id": 5347313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c23747e31442ccd9394743a23bd5ff70?s=128&d=identicon&r=PG&f=1", "display_name": "metric_chicken", "link": "https://stackoverflow.com/users/5347313/metric-chicken"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511275090, "post_id": 47414940, "comment_id": 81784983, "body": "So, I added w.WriteHeader(http.StatusOK) and I get this new error in my logs: <code>2017&#47;11&#47;21 09:35:44 request Content-Type isn&#39;t multipart&#47;form-data Endpoint hit: Upload 2017&#47;11&#47;21 09:35:44 http: panic serving [::1]:58918: runtime error: invalid memory address or nil pointer dereference</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511275307, "post_id": 47414940, "comment_id": 81785135, "body": "It panics because your function continues even after this line <code>http.Error(w, err.Error(), http.StatusForbidden)</code>, if parsing multipart form fails you should send the error, as you are doing, but after that you should <code>return</code> from your handler to not execute the subsequent code."}, {"owner": {"reputation": 41, "user_id": 5347313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c23747e31442ccd9394743a23bd5ff70?s=128&d=identicon&r=PG&f=1", "display_name": "metric_chicken", "link": "https://stackoverflow.com/users/5347313/metric-chicken"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511275448, "post_id": 47414940, "comment_id": 81785239, "body": "Added a return in the error block and I get a forbidden, which is expected. Is there another method of uploading that is not multipart?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511276140, "post_id": 47414940, "comment_id": 81785755, "body": "Well if <code>curl -T</code> isn&#39;t sending the body as multipart then it&#39;s probably an octet-stream, in which case it should be enough to write the request body directly to a file. But nothing stops you from first checking the request headers, then dumping the request body and checking its format and depending on that info deciding on how to handle the upload. Also your Upload handler is ignoring almost all errors, that is not ok, your handler should <b>at least</b> look something like this <a href=\"https://play.golang.org/p/yrv640Vzfz\" rel=\"nofollow noreferrer\">play.golang.org/p/yrv640Vzfz</a>."}, {"owner": {"reputation": 41, "user_id": 5347313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c23747e31442ccd9394743a23bd5ff70?s=128&d=identicon&r=PG&f=1", "display_name": "metric_chicken", "link": "https://stackoverflow.com/users/5347313/metric-chicken"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511277090, "post_id": 47414940, "comment_id": 81786471, "body": "So your saying read the file in with something like io.ReadFull and then write it out to a file on disk, correct?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511279269, "post_id": 47414940, "comment_id": 81788043, "body": "I&#39;ve added an aswer that shows how you can write the request body with <code>io.Copy</code> which should be generally a more efficient approach than <code>io.ReadFull</code>. Also don&#39;t forget to <code>Sync</code> and <code>Close</code> the file as I did in the first version of my answer."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 0, "last_activity_date": 1511279118, "last_edit_date": 1511279118, "creation_date": 1511278142, "answer_id": 47416737, "question_id": 47414940, "link": "https://stackoverflow.com/questions/47414940/go-rest-endpoint-for-file-uploads-but-not-using-parsemultipartform/47416737#47416737", "title": "GO REST Endpoint for File Uploads But Not Using ParseMultipartForm", "body": "<p>Using <code>curl -f -s -S -T /path/to/file/foo.tar.gz http://localhost:8080/upload</code> without any additional options that would set the content type, if there are such options (i'm not sure, my curl knowledge is almost non existent), you are sending a request with minimal headers, none of them indicating the type of the content.</p>\n\n<p>For example logging the <code>r.Header</code> will print something like this:</p>\n\n<pre><code>map[Accept:[*/*] Content-Length:[18] Expect:[100-continue] User-Agent:[curl/7.54.0]]\n</code></pre>\n\n<p>This means that all that multipart code in your <code>Upload</code> handler is simply not necessary.</p>\n\n<hr>\n\n<p>The content of the body is what you want, so you can use <code>io.Copy</code> to store that body into a file.</p>\n\n<pre><code>func Upload(w http.ResponseWriter, r *http.Request) {\n    f, err := os.Create(\"filename\")\n    if err != nil {\n        panic(err)\n    }\n    defer f.Close()\n\n    if _, err := io.Copy(f, r.Body); err != nil {\n        panic(err)\n    }\n    if err := f.Sync(); err != nil {\n        panic(err)\n    }\n    fmt.Fprintln(w, \"upload done...\")\n}\n</code></pre>\n\n<p>Since you're using <code>curl -f -s -S -T ...</code> the <code>Upload</code> handler does not know what the name, nor the type, of the file being uploaded is, you will have to generate a random name, or a timestamp name, or whatever in order to be able to create and store more than just one file.</p>\n\n<p>You could also pass some of the file info (name, type) in the query parameters but i'm not sure if that satisfies your requirements. E.g.</p>\n\n<pre><code>curl -f -s -S -T /path/to/file/foo.tar.gz http://localhost:8080/upload?name=foo.tar.gz\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 5347313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c23747e31442ccd9394743a23bd5ff70?s=128&d=identicon&r=PG&f=1", "display_name": "metric_chicken", "link": "https://stackoverflow.com/users/5347313/metric-chicken"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 289, "favorite_count": 0, "accepted_answer_id": 47416737, "answer_count": 1, "score": 0, "last_activity_date": 1511279118, "creation_date": 1511272835, "last_edit_date": 1511273685, "question_id": 47414940, "link": "https://stackoverflow.com/questions/47414940/go-rest-endpoint-for-file-uploads-but-not-using-parsemultipartform", "title": "GO REST Endpoint for File Uploads But Not Using ParseMultipartForm", "body": "<p>Newbie here. I'm trying to build a web server with a RESTful API so that I can test a curl command for file uploads. I was able to create the web server and an endpoint for file uploads. </p>\n\n<p>Here is my upload endpoint:</p>\n\n<pre><code>func Upload(w http.ResponseWriter, r *http.Request) {\n    if err := r.ParseMultipartForm(MAX_MEMORY); err != nil {\n        log.Println(err)\n        http.Error(w, err.Error(), http.StatusForbidden)\n    }\n\n    fmt.Println(\"Endpoint hit: Upload\")\n\n    for key, value := range r.MultipartForm.Value {\n        fmt.Fprintf(w, \"%s:%s \", key, value)\n        log.Printf(\"%s:%s\", key, value)\n    }\n\n    for _, fileHeaders := range r.MultipartForm.File {\n        for _, fileHeader := range fileHeaders {\n            file, _ := fileHeader.Open()\n            path := fmt.Sprintf(\"files/%s\", fileHeader.Filename)\n            buf, _ := ioutil.ReadAll(file)\n            ioutil.WriteFile(path, buf, os.ModePerm)\n            log.Println(http.StatusOK, fmt.Sprintf(\"file %s has been uploaded\", fileHeader.Filename))\n        }\n    }\n}\n</code></pre>\n\n<p>This endpoint works with the following curl command:</p>\n\n<pre><code>curl -F 'data=@/path/to/file/foo.tar.gz' localhost:8080/upload\n</code></pre>\n\n<p>However, this curl command does not:</p>\n\n<pre><code>curl -f -s -S -T /path/to/file/foo.tar.gz http://localhost:8080/upload\ncurl: (22) The requested URL returned error: 405 Method Not Allowed\n</code></pre>\n\n<p>I need help creating an endpoint that will accept</p>\n\n<pre><code>curl -f -s -S -T /path/to/file/foo.tar.gz http://localhost:8080/upload\n</code></pre>\n\n<p>Thank you. </p>\n\n<p>Edit: Here is my routes.go file. </p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"github.com/gorilla/mux\"\n)\n\ntype Route struct {\n    Name        string\n    Method      string\n    Pattern     string\n    HandlerFunc http.HandlerFunc\n}\n\ntype Routes []Route\n\nfunc NewRouter() *mux.Router {\n    router := mux.NewRouter().StrictSlash(true)\n    for _, route := range routes {\n        router.\n        Methods(route.Method).\n        Path(route.Pattern).\n        Name(route.Name).\n        Handler(route.HandlerFunc)\n    }\n\n    return router\n}\n\n\nvar routes = Routes{\n    Route{\n        \"Index\",\n        \"GET\",\n        \"/\",\n        Index,\n    },\n    Route{\n        \"Upload\",\n        \"POST\",\n        \"/upload\",\n        Upload,\n    },\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1511267897, "post_id": 47413097, "comment_id": 81779886, "body": "Because what you &quot;get out&quot; of a <code>map[T]interface{}</code> with indexing like <code>m[&quot;d&quot;]</code> is <i>always</i> of type <code>interface{}</code> and not a map and thus does not allow indexing (the <code>[&quot;test&quot;]</code>). Dead obvious, or? And please do not rely on fmt.Println-style inspection as this does some magic. Remember that GO is statically typed. No magic. Just because you can store a map inside an empty interface does not mean that such a thing magically behaves like a map. It behaves like an empty interface."}, {"owner": {"reputation": 6165, "user_id": 1901658, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/95eee89c6704eb4d075c33821c61af72?s=128&d=identicon&r=PG", "display_name": "Fredrick Brennan", "link": "https://stackoverflow.com/users/1901658/fredrick-brennan"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1511268067, "post_id": 47413097, "comment_id": 81779998, "body": "@Volker I assume you also downvoted me. I&#39;m somewhat new to Go, but I do understand the basics of the problem. What I don&#39;t understand is why it doesn&#39;t work after I&#39;ve already specified that <code>m[&quot;d&quot;]</code> will be of type <code>M</code>. How can I fix it? Is it even possible?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1511268627, "post_id": 47413097, "comment_id": 81780365, "body": "<code>m := M{&quot;d&quot;: M{}}</code> this does not tell Go that <code>m[&quot;d&quot;]</code> will always return a value of type <code>M</code>, the next line could overwrite <code>&quot;d&quot;</code> with another value of different type. You only specified that the values are of type <code>interface{}</code>, so every time you try to access a value of <code>m</code> it&#39;s type will be that which you specified, <code>interface{}</code>. From tha point on, you can use type assertion."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1511269095, "post_id": 47413097, "comment_id": 81780671, "body": "If you are &quot;somewhat new to Go&quot; I&#39;d recommend the Tour of Go tour.golang.org. &quot;I&#39;ve already specified that m[&quot;d&quot;] will be of type M&quot; is plain wrong. m[&quot;d&quot;] is of type interface{} because that is the value type of M. If you know that this interface contains a M you can type-assert it. See <a href=\"https://tour.golang.org/methods/15\" rel=\"nofollow noreferrer\">tour.golang.org/methods/15</a>."}, {"owner": {"reputation": 6165, "user_id": 1901658, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/95eee89c6704eb4d075c33821c61af72?s=128&d=identicon&r=PG", "display_name": "Fredrick Brennan", "link": "https://stackoverflow.com/users/1901658/fredrick-brennan"}, "edited": false, "score": 0, "creation_date": 1511269688, "post_id": 47413097, "comment_id": 81781085, "body": "From the tests I&#39;ve tried, you can&#39;t type assert inside a map. <code>M[&quot;d&quot;].(M)</code> is not legal; type M is not an expression. I don&#39;t see any question that says how to assert the type of a map element, or if it&#39;s even possible, yet I&#39;ve been downvoted twice..."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511271413, "post_id": 47413097, "comment_id": 81782310, "body": "@FredrickBrennan <code>m[&quot;d&quot;].(M)</code> is what you&#39;re looking for."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1511271615, "post_id": 47413097, "comment_id": 81782457, "body": "@FredrickBrennan see an example of that here <a href=\"https://play.golang.org/p/M2m60-45ac\" rel=\"nofollow noreferrer\">play.golang.org/p/M2m60-45ac</a>"}, {"owner": {"reputation": 6165, "user_id": 1901658, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/95eee89c6704eb4d075c33821c61af72?s=128&d=identicon&r=PG", "display_name": "Fredrick Brennan", "link": "https://stackoverflow.com/users/1901658/fredrick-brennan"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511272087, "post_id": 47413097, "comment_id": 81782829, "body": "@mkopriva <code>m[&quot;d&quot;].(M)[&quot;test&quot;]</code> This is really cool :) Thanks! Please add it as an answer so I can accept it."}], "answers": [{"comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1511272757, "post_id": 47414734, "comment_id": 81783317, "body": "In this case, where you&#39;re doing type assertion on the returned value, you can omit the <i>is-key-present</i> check since a non present key will return the zero value of the map value&#39;s type, in this case <code>(interface{})(nil)</code> and doing type assertion on that is fine, as long as you&#39;re using the comma-ok result from the type assertion <a href=\"https://play.golang.org/p/L3htM4xH8C\" rel=\"nofollow noreferrer\">play.golang.org/p/L3htM4xH8C</a>."}], "tags": [], "owner": {"reputation": 18922, "user_id": 3633742, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/thyJX.jpg?s=128&g=1", "display_name": "n00dl3", "link": "https://stackoverflow.com/users/3633742/n00dl3"}, "is_accepted": true, "score": 1, "last_activity_date": 1511273485, "last_edit_date": 1511273485, "creation_date": 1511272158, "answer_id": 47414734, "question_id": 47413097, "link": "https://stackoverflow.com/questions/47413097/typed-nested-map-of-mapstringinterface-returns-type-interface-does-not/47414734#47414734", "title": "Typed, nested map of map[string]interface{} returns &quot;type interface {} does not support indexing&quot;", "body": "<p>Let's take this :</p>\n\n<pre><code>foo:=map[string]interface{}{}\n</code></pre>\n\n<p>When you define a <code>map[string]interface{}</code>, you can set any type you want  (any type that fulfill the  <a href=\"https://tour.golang.org/methods/14\" rel=\"nofollow noreferrer\">empty interface</a> <code>interface{}</code> contract a.k.a any type) for a given string index.</p>\n\n<pre><code>foo[\"bar\"]=\"baz\"\nfoo[\"baz\"]=1234\nfoo[\"foobar\"]=&amp;SomeType{}\n</code></pre>\n\n<p>But when you try to access some key, you don't get some int, string or any custom struct, you get an <code>interface{}</code></p>\n\n<pre><code>var bar string = foo[\"bar\"] // error\n</code></pre>\n\n<p>in order to treat <code>bar</code> as an string, you can make a <a href=\"https://tour.golang.org/methods/15\" rel=\"nofollow noreferrer\">type assertion</a> or a <a href=\"https://tour.golang.org/methods/16\" rel=\"nofollow noreferrer\">type switch</a>. </p>\n\n<p>Here we go for the type assertion (<a href=\"https://play.golang.org/p/OPUP9YPX3M\" rel=\"nofollow noreferrer\">live example</a>) :</p>\n\n<pre><code>if bar,ok := foo[\"bar\"].(string); ok {\n   fmt.Println(bar)\n}\n</code></pre>\n\n<p>But as @Volker said, it is a good idea -as a beginner- to take the <a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">tour of go</a> to get more familiar with such concepts.</p>\n"}], "owner": {"reputation": 6165, "user_id": 1901658, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/95eee89c6704eb4d075c33821c61af72?s=128&d=identicon&r=PG", "display_name": "Fredrick Brennan", "link": "https://stackoverflow.com/users/1901658/fredrick-brennan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1404, "favorite_count": 0, "accepted_answer_id": 47414734, "answer_count": 1, "score": 0, "last_activity_date": 1511273485, "creation_date": 1511267169, "question_id": 47413097, "link": "https://stackoverflow.com/questions/47413097/typed-nested-map-of-mapstringinterface-returns-type-interface-does-not", "title": "Typed, nested map of map[string]interface{} returns &quot;type interface {} does not support indexing&quot;", "body": "<p>I'm experiencing a very strange problem with typed nested maps.</p>\n\n<pre><code>gore version 0.2.6  :help for help\ngore&gt; type M map[string]interface{}\ngore&gt; m := M{\"d\": M{}}\nmain.M{\"d\":main.M{}}\ngore&gt; m[\"d\"][\"test\"] = \"will fail\"\n# command-line-arguments\n/tmp/288178778/gore_session.go:13:8: invalid operation: m[\"d\"][\"test\"] (type interface {} does not support indexing)\n/tmp/288178778/gore_session.go:14:17: invalid operation: m[\"d\"][\"test\"] (type interface {} does not support indexing)\nerror: exit status 2\nexit status 2\ngore&gt; m[\"e\"] = \"this works\"\n\"this works\"\ngore&gt; m\nmain.M{\"d\":main.M{}, \"e\":\"this works\"}\n</code></pre>\n\n<p>What am I doing wrong? Why does this suddenly fail just because the map is nested inside a map?</p>\n"}, {"tags": ["ubuntu", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1511266801, "post_id": 47412955, "comment_id": 81779227, "body": "I think the latest Go is 1.9.something, <code>2.6</code> seems impossible."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511267071, "post_id": 47412955, "comment_id": 81779381, "body": "Try the steps outlined here: <a href=\"https://askubuntu.com/a/755392\">askubuntu.com/a/755392</a>"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511267425, "post_id": 47412955, "comment_id": 81779566, "body": "@mkopriva: Run <code>$ sudo apt show golang</code>. Output: <code>Package: golang  Version: 2:1.6-1ubuntu4</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1511268258, "post_id": 47412955, "comment_id": 81780118, "body": "@peterSO fair enough, but that seems to be the version of the apt package for golang, not of golang itself."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1511268778, "post_id": 47412955, "comment_id": 81780453, "body": "@mkopriva: The question said <code>sudo apt dist-upgrade golang</code>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1511282114, "post_id": 47412955, "comment_id": 81790134, "body": "1. There is no Go 2.6.  2. The best way to install Go, even on Ubuntu/Debian, is to follow the <a href=\"https://golang.org/doc/install\" rel=\"nofollow noreferrer\">official Go instructions</a>, rather than using the package manager."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1511267307, "creation_date": 1511267307, "answer_id": 47413144, "question_id": 47412955, "link": "https://stackoverflow.com/questions/47412955/upgrade-golang-in-ubuntu-but-still-shows-old-version/47413144#47413144", "title": "upgrade golang in ubuntu but still shows old version", "body": "<p>Run <code>sudo apt purge golang</code> to remove your current installation.</p>\n\n<p>Follow the Go <a href=\"https://golang.org/doc/install\" rel=\"nofollow noreferrer\">Getting Started</a> instructions to install a current, supported version of Go.</p>\n"}], "owner": {"reputation": 555, "user_id": 8337498, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8b22e7b8121ee9ea74b80f0783247a02?s=128&d=identicon&r=PG&f=1", "display_name": "taraf", "link": "https://stackoverflow.com/users/8337498/taraf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1120, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1511273491, "creation_date": 1511266659, "question_id": 47412955, "link": "https://stackoverflow.com/questions/47412955/upgrade-golang-in-ubuntu-but-still-shows-old-version", "title": "upgrade golang in ubuntu but still shows old version", "body": "<p>I have upgraded golang from version 1.6 to 2.6 in ubuntu with this command : <code>sudo apt dist-upgrade golang</code>\nbut when I run <code>go version</code> it still shows old version.\nhow I can make ubuntu to use newer version?</p>\n"}, {"tags": ["arrays", "go", "struct"], "comments": [{"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1511265315, "post_id": 47412370, "comment_id": 81778231, "body": "You have problem with writing to buffer, buffer length is 0 - <a href=\"https://play.golang.org/p/Fyq-5TAHRa\" rel=\"nofollow noreferrer\">play.golang.org/p/Fyq-5TAHRa</a>"}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1511265639, "post_id": 47412370, "comment_id": 81778427, "body": "<a href=\"https://play.golang.org/p/P9hX3lk_FI\" rel=\"nofollow noreferrer\">play.golang.org/p/P9hX3lk_FI</a> - the write returns error"}], "answers": [{"comments": [{"owner": {"reputation": 1714, "user_id": 737641, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/fef120f9c6bec7658fc8666f4fea8e09?s=128&d=identicon&r=PG", "display_name": "Arj", "link": "https://stackoverflow.com/users/737641/arj"}, "edited": false, "score": 0, "creation_date": 1511268760, "post_id": 47412727, "comment_id": 81780441, "body": "Aha.. thank you.  That&#39;s easy to miss especially when using a struct that is not exported."}, {"owner": {"reputation": 1714, "user_id": 737641, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/fef120f9c6bec7658fc8666f4fea8e09?s=128&d=identicon&r=PG", "display_name": "Arj", "link": "https://stackoverflow.com/users/737641/arj"}, "edited": false, "score": 0, "creation_date": 1511268857, "post_id": 47412727, "comment_id": 81780495, "body": "I am surprised that <code>Read()</code> doesn&#39;t also error due to the struct not being exported."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1511276593, "post_id": 47412727, "comment_id": 81786107, "body": "It doesn&#39;t matter if the struct is exported because it doesn&#39;t need to reference the type, as it already has an instance of the type. It does need to reference the members though, so they must be exported."}], "tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": true, "score": 2, "last_activity_date": 1511265900, "creation_date": 1511265900, "answer_id": 47412727, "question_id": 47412370, "link": "https://stackoverflow.com/questions/47412370/unable-to-decode-byte-slice-back-into-struct/47412727#47412727", "title": "Unable to decode byte slice back into struct", "body": "<p>You have problems with you struct that it has unexported fields.</p>\n\n<p>Here is the working code:</p>\n\n<p><a href=\"https://play.golang.org/p/LHTeF-_2lX\" rel=\"nofollow noreferrer\">https://play.golang.org/p/LHTeF-_2lX</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"bytes\"\n    \"encoding/binary\"\n    \"net\"\n)\n\ntype myEvent struct {\n    IP_version int32\n    Ipv6_src_addr [16]byte\n}\n\n\nfunc readFromByteArrayIntoStruct() {\n\n    // create event\n    ip := net.ParseIP(\"2001::face\")\n    var ipBytes [16]byte;\n    copy(ipBytes[:], ip.To16())\n    event := myEvent {\n        IP_version: 4, \n        Ipv6_src_addr: ipBytes,\n    }\n\n    // convert to bytes\n    buf := new(bytes.Buffer)\n    if err := binary.Write(buf, binary.BigEndian, event); err != nil {\n        fmt.Println(\"binary.Write failed:\", err)\n        return\n    }\n    eventBytes := buf.Bytes()\n    fmt.Println(buf.Len(), eventBytes)\n\n    // read back the bytes into a new event\n    reader := bytes.NewReader(eventBytes)\n    var decodedEvent myEvent \n\n    if err := binary.Read(reader, binary.BigEndian, &amp;decodedEvent); err != nil {\n        fmt.Println(\"binary.Read failed:\", err)\n    } else {\n        fmt.Printf(\"decodedEvent: %+v\", decodedEvent)\n    }\n}\n\nfunc main() {\n    readFromByteArrayIntoStruct()\n}\n</code></pre>\n"}], "owner": {"reputation": 1714, "user_id": 737641, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/fef120f9c6bec7658fc8666f4fea8e09?s=128&d=identicon&r=PG", "display_name": "Arj", "link": "https://stackoverflow.com/users/737641/arj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 362, "favorite_count": 0, "accepted_answer_id": 47412727, "answer_count": 1, "score": 0, "last_activity_date": 1511519865, "creation_date": 1511264827, "last_edit_date": 1511519865, "question_id": 47412370, "link": "https://stackoverflow.com/questions/47412370/unable-to-decode-byte-slice-back-into-struct", "title": "Unable to decode byte slice back into struct", "body": "<p>I am trying to read a byte array and output it into a struct in Go. The <a href=\"https://golang.org/pkg/encoding/binary/#Read\" rel=\"nofollow noreferrer\">official example</a> is a good starting point, but this only decodes a single <code>float64</code>.  This <a href=\"https://play.golang.org/p/cbHX5Twyrw\" rel=\"nofollow noreferrer\">other snippet</a> shows that it definitely can be done with structs.</p>\n\n<p>My <a href=\"https://play.golang.org/p/cX6YgeBPGj\" rel=\"nofollow noreferrer\">play</a>, however, fails with <code>binary.Read: invalid type ...</code> .  </p>\n\n<p>I thought this was to do with the Read function accepting only fixed-length data to read into:</p>\n\n<blockquote>\n  <p>binary.Read reads structured binary data from r into data. Data must\n  be a pointer to a fixed-size value or a slice of fixed-size values</p>\n</blockquote>\n\n<p>This is why my <code>struct</code> definition contains only fixed-length data.</p>\n\n<p>I can't see that I'm doing anything vastly different to the working examples, and the error code isn't much help beyond the length issue - any ideas?</p>\n"}, {"tags": ["asynchronous", "go"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 1, "creation_date": 1511261863, "post_id": 47411060, "comment_id": 81775972, "body": "An <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/408\" rel=\"nofollow noreferrer\">HTTP 408</a> is basically the remote host closing an idle connection. I don&#39;t think there is anything wrong with your code."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1511264186, "post_id": 47411060, "comment_id": 81777478, "body": "You have a normal error condition and decided to panic. You got a panic. What else to expect. It is perfectly acceptable of the server to respond with 408. Maybe the server answers more often with 408 if accessed concurrently? What&#39;s wrong with your code is other stuff like new Clients for each request and unhandled errors."}, {"owner": {"reputation": 245, "user_id": 7360695, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5ba260c91ea10f26485623058a28e4fc?s=128&d=identicon&r=PG&f=1", "display_name": "Battalgazi", "link": "https://stackoverflow.com/users/7360695/battalgazi"}, "edited": false, "score": 0, "creation_date": 1511266069, "post_id": 47411060, "comment_id": 81778728, "body": "Yea I expected panic from panic() :P . Just wanted to know in which way I could handle it. Thanks for the feedback, i&#39;ll take care of the wrong things."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 4, "last_activity_date": 1511264247, "creation_date": 1511264247, "answer_id": 47412200, "question_id": 47411060, "link": "https://stackoverflow.com/questions/47411060/error-happening-randomly-when-using-goroutines-waitinggroup/47412200#47412200", "title": "Error happening randomly when using goroutines WaitingGroup", "body": "<blockquote>\n  <p>I cant afford the application to terminate.</p>\n</blockquote>\n\n<p>Then do not panic but handle the 408, e.g. by retrying or returning an error upstream.</p>\n"}], "owner": {"reputation": 245, "user_id": 7360695, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5ba260c91ea10f26485623058a28e4fc?s=128&d=identicon&r=PG&f=1", "display_name": "Battalgazi", "link": "https://stackoverflow.com/users/7360695/battalgazi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 47412200, "answer_count": 1, "score": -1, "last_activity_date": 1511264247, "creation_date": 1511260876, "question_id": 47411060, "link": "https://stackoverflow.com/questions/47411060/error-happening-randomly-when-using-goroutines-waitinggroup", "title": "Error happening randomly when using goroutines WaitingGroup", "body": "<p>I have a handler which contains two goroutines. The handler is executed every 10 seconds by the frontend. Once called, the goroutines send a GET http request to an external API. For some reason, sometimes (not often) I randomly get the following error in any of the goroutines (seems that the external API refuses the request). </p>\n\n<p>StatusCode:408</p>\n\n<blockquote>\n  <p><em>panic:read tcp 192.168.1.106:62598->80.243.175.58:443: wsarecv: An existing connection was forcibly closed by the remote host. goroutine\n  8280 [running]:\n  Monitoring/monitoring-v2-goAPI/services.GetNodeCpuLimits.func2(0x815ba0,\n  0xc04231a1c0, 0x0, 0x0, 0x0, 0x0, 0xc042158240, 0x14, 0x0, 0x0, ...)</em></p>\n</blockquote>\n\n<p>When this happens the panic(err) is triggered and my application terminates. This error is happening since I rebuilt the handler in an asynchronous way to improve speed (before the requests were just synchronous).</p>\n\n<p>I would like to know if im doing anything wrong. And if not, how can I handle this? I cant afford the application to terminate.</p>\n\n<p><strong>Code</strong></p>\n\n<pre><code>   func TestFunc(w http.ResponseWriter, r *http.Request) {\n\n        c := make(chan NgxJSON)\n        wg := &amp;sync.WaitGroup{}\n\n        var queryParams QueryParams\n        _ = json.NewDecoder(r.Body).Decode(&amp;queryParams)\n        fmt.Println(\"- queryParams -&gt;\", queryParams)\n\n        wg.Add(1)\n        go func(queryParams QueryParams, c chan NgxJSON, wg *sync.WaitGroup) {\n            defer wg.Done()\n\n            req, err := http.NewRequest(\"GET\", APIURL1+queryParams.Param1, nil)\n\n\n            if err != nil {\n                fmt.Println(err)\n                return\n            }\n\n            client := &amp;http.Client{}\n            resp, err := client.Do(req)\n            if err != nil {\n                panic(err)   //&lt;-- Error triggers here!!\n            }\n            defer resp.Body.Close()\n\n\n            body, _ := ioutil.ReadAll(resp.Body) \n\n            var response Response\n            json.Unmarshal([]byte(string(body)), &amp;response)\n\n\n            //DO THINGS\n\n            c &lt;- ngxJSON\n\n        }(queryParams, c, wg)\n\n        wg.Add(1)\n        go func(queryParams QueryParams, c chan NgxJSON, wg *sync.WaitGroup) {\n            defer wg.Done()\n            req, err := http.NewRequest(\"GET\", APIURL2+APIURL2+queryParams.Param2, nil)\n\n            if err != nil {\n                fmt.Println(err) \n                return\n            }\n\n            client := &amp;http.Client{}\n            resp, err := client.Do(req)\n            if err != nil {\n                panic(err) //&lt;-- Error triggers here!!\n            }\n            defer resp.Body.Close()\n\n\n\n            body, _ := ioutil.ReadAll(resp.Body)\n\n            var response Response\n            json.Unmarshal([]byte(string(body)), &amp;response)\n\n\n           //DO THINGS\n\n                c &lt;- ngxJSON\n\n            }\n\n        }(queryParams, c, wg)\n\n        go func() {\n            wg.Wait()\n            close(c)\n        }()\n\n    //DO THINGS\n\n\n\n    }\n</code></pre>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511278242, "post_id": 47409194, "comment_id": 81787271, "body": "Possible duplicate: <a href=\"https://stackoverflow.com/questions/37446623/c-char-name8-to-golang-name-8byte\" title=\"c char name8 to golang name 8byte\">stackoverflow.com/questions/37446623/&hellip;</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511278308, "post_id": 47409194, "comment_id": 81787323, "body": "You can&#39;t range of a utf8 string and convert the runes to <code>C.char</code>. You need to do it by bytes."}], "owner": {"reputation": 4554, "user_id": 501778, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/9c3a188a1a6116ee15bc9dda726ef19c?s=128&d=identicon&r=PG", "display_name": "Manu", "link": "https://stackoverflow.com/users/501778/manu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 473, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1511277852, "creation_date": 1511255338, "last_edit_date": 1511277852, "question_id": 47409194, "link": "https://stackoverflow.com/questions/47409194/generalized-function-to-pass-array-of-char-from-c-to-go", "title": "Generalized function to pass array of char from C to Go", "body": "<p>I am trying to copy content of structure in Go</p>\n\n<pre><code>type test struct {\n    a string\n    b string\n}\n</code></pre>\n\n<p>to C structure. </p>\n\n<pre><code>typedef struct {\n    char a[10];\n    char b[75];\n}test_c;\n</code></pre>\n\n<p>My requirement does not allow me to change the structure of member types of both Go and C. I have written the following code, to copy Go structure to C structure, and i am able to copy them too.</p>\n\n<blockquote>\n  <p>cmain.h</p>\n</blockquote>\n\n<pre><code>typedef struct {\n    char a[10];\n    char b[75];\n}test_c;\nvoid cmain(test_c* value);\n</code></pre>\n\n<blockquote>\n  <p>cmain.c</p>\n</blockquote>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include \"cmain.h\"\n#include \"_cgo_export.h\"\n\nvoid cmain(test_c *value) {\n    printf(\"Inside C code\\n\");\n    printf(\"C code structure Member:a=%s\\n\", value-&gt;a);\n    printf(\"C code structure Member:b=%s\\n\", value-&gt;b);\n}\n</code></pre>\n\n<blockquote>\n  <p>go_func.go</p>\n</blockquote>\n\n<pre><code> package main\n import (\n    /*\n        #include \"cmain.h\"\n    */\n    \"C\"\n    \"fmt\"\n    \"unsafe\"\n)\n\ntype test struct {\n    a string\n    b string\n}\n\nfunc main() {\n\n    var p_go test\n    var p_c C.test_c\n    p_go.a = \"ABCDEFGHIJ\"\n    p_go.b = \"QRSTUVXWYZ\"\n    fmt.Println(unsafe.Sizeof(p_c.a))\n    StructMemberCopy(&amp;p_c.a, p_go.a)\n    fmt.Println(\"In GO code\\n\")\n    fmt.Println(\"GO code structure Member:a=%s\", p_go.a)\n    fmt.Println(\"GO code structure Member:b=%s\", p_go.b)\n\n    fmt.Println(\"Call C function by passing GO structure\\n\")\n    C.cmain((*C.test_c)(unsafe.Pointer(&amp;p_c)))\n\n}\n\nfunc StructMemberCopy(dest *[10]C.char, src string) {\n    for i, _ := range src {\n        dest[i] = C.char(src[i])\n        fmt.Printf(\"%d %c \\n\", i, src[i])\n    }\n}\n</code></pre>\n\n<p>Here am trying to write a generalized function to copy the content of Go Structure member to C Structure  </p>\n\n<pre><code>func StructMemberCopy(dest *[10]C.char, src string) {\n        for i, _ := range src {\n            dest[i] = C.char(src[i])\n            fmt.Printf(\"%d %c \\n\", i, src[i])\n        }\n    }\n</code></pre>\n\n<p>In the above code, when i call the function <strong>StructMemberCopy(&amp;p_c.a, p_go.a)</strong>, with &amp;p_c.a as argument the code compiles without any error, but when i send &amp;p_c.b, it gives an error</p>\n\n<pre><code>cannot use &amp;p_c.b (type *[75]C.char) as type *[10]C.char in argument to StructMemberCopy\n</code></pre>\n\n<p>Can anyone give some inputs as to how to write the generalized argument for <strong>func StructMemberCopy</strong>, as my C Structure array member size can vary. Mean it can become </p>\n\n<pre><code>typedef struct {\n    char a[10];\n    char b[75]; \n}test_c;\n\nor typedef struct {\n    char a[15];\n    char b[40];\n}test_c;\n</code></pre>\n"}, {"tags": ["c#", "unity3d", "go", "tcp", "multiplayer"], "comments": [{"owner": {"reputation": 5397, "user_id": 2193020, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/aa10d01a3d48851073bd61877a56b5a7?s=128&d=identicon&r=PG", "display_name": "hnefatl", "link": "https://stackoverflow.com/users/2193020/hnefatl"}, "edited": false, "score": 3, "creation_date": 1511254803, "post_id": 47408998, "comment_id": 81771141, "body": "This is too broad - SO is for answering specific questions about specific problems, not general advice. There are plenty of tutorials online."}, {"owner": {"reputation": 1505, "user_id": 4344586, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/zmULe.png?s=128&g=1", "display_name": "Frank AK", "link": "https://stackoverflow.com/users/4344586/frank-ak"}, "edited": false, "score": 0, "creation_date": 1511255151, "post_id": 47408998, "comment_id": 81771382, "body": "Your keyword should be <code>MMORPG</code>, I have write a simple MMORPG server base on <code>websocket</code> write by <code>Redis + Tornado</code>. But you should know some basic of <code>Python</code>. Here is the rep <code>https:&#47;&#47;github.com&#47;land-pack&#47;aking</code>"}, {"owner": {"reputation": 21, "user_id": 6874164, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ENkuK.png?s=128&g=1", "display_name": "Sherzodkh", "link": "https://stackoverflow.com/users/6874164/sherzodkh"}, "edited": false, "score": 0, "creation_date": 1511269073, "post_id": 47408998, "comment_id": 81780656, "body": "This is assignment, Server should be written in Golang, and TCP/IP network in C#. I have made game in unity, need to know how to implement network stuff?"}], "answers": [{"tags": [], "owner": {"reputation": 409, "user_id": 3927977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b285cfec1dae5a6da430dcdf8aee2a3f?s=128&d=identicon&r=PG&f=1", "display_name": "LuisFerrolho", "link": "https://stackoverflow.com/users/3927977/luisferrolho"}, "is_accepted": false, "score": 5, "last_activity_date": 1511279936, "creation_date": 1511279936, "answer_id": 47417356, "question_id": 47408998, "link": "https://stackoverflow.com/questions/47408998/how-to-write-tcp-ip-network-in-c-and-server-in-golang-for-unity-multiplayer-che/47417356#47417356", "title": "How to write Tcp/ip network in C# and Server in Golang for unity multiplayer checkers game", "body": "<p>Okay, so, you're trying to build the server-client communication of your app. When we talk about communication, there is a keyword that always appear: <a href=\"https://www.tutorialspoint.com/unix_sockets/what_is_socket.htm\" rel=\"noreferrer\"><strong>socket</strong></a>. In short, sockets allow communication between two different processes on the same or different machines. There are different types of sockets, you can check differences between some of them <a href=\"https://stackoverflow.com/questions/16945345/differences-between-tcp-sockets-and-web-sockets-one-more-time\">here</a> and <a href=\"https://serverfault.com/questions/124517/whats-the-difference-between-unix-socket-and-tcp-ip-socket\">here</a>.</p>\n\n<p>To establish a communication channel, the steps that are needed on the client side are:</p>\n\n<ol>\n<li>Create socket through <strong>socket()</strong> system call.</li>\n<li>Connect the socket to the server address using <strong>connect()</strong> system call.</li>\n<li>Send and receive data through <strong>read()</strong> and <strong>write()</strong>.</li>\n</ol>\n\n<p>And on the server side are:</p>\n\n<ol>\n<li>Create socket through <strong>socket()</strong> system call.</li>\n<li>Bind the socket to an address (e.g. ip:port) using the <strong>bind()</strong> system call.</li>\n<li>Listen for connections with <strong>listen()</strong> system call.</li>\n<li>Accept a connection with <strong>accept()</strong> system call.</li>\n<li>Send and receive data through <strong>read()</strong> and <strong>write()</strong>.</li>\n</ol>\n\n<p>Normally, on the server side you want to create a socket pool, in order to achieve more performance (instead of creating a new socket for each player that connects to your server).</p>\n\n<p>Check the image below to see how is the interaction flow between server and client. In your case, requests are messages sent from players to the server with game info (e.g., the move a player did in its turn). Messages that go from server to the players can be just an ACK or they can be a more elaborated information (e.g., the move an opponent did in its turn).</p>\n\n<p><a href=\"https://i.stack.imgur.com/GAFj9.gif\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/GAFj9.gif\" alt=\"enter image description here\"></a></p>\n\n<p>Now, the transmission of data: Since Internet just can handle bits and does not understand what an object or a struct are, we have to <a href=\"https://en.wikipedia.org/wiki/Serialization\" rel=\"noreferrer\">Serialize and Deserialize</a> the messages when they go out to the Internet or arrive from it. To achieve this in an easy you can use <a href=\"https://developers.google.com/protocol-buffers/docs/overview\" rel=\"noreferrer\">Protocol Buffers</a>, a tool built by Uncle Google that simplifies this process and that can be used by different languages (e.g., Go and C#).</p>\n\n<p>Take some examples below on how to build a server-client app in Go and C#, separately. You can then choose which parts do you need to your project:</p>\n\n<ul>\n<li><a href=\"https://astaxie.gitbooks.io/build-web-application-with-golang/en/08.1.html\" rel=\"noreferrer\">Client-server Go</a></li>\n<li><a href=\"https://systembash.com/a-simple-go-tcp-server-and-tcp-client/\" rel=\"noreferrer\">Client-server_2 Go</a></li>\n<li><a href=\"https://docs.microsoft.com/en-us/dotnet/framework/network-programming/socket-code-examples\" rel=\"noreferrer\">Clients and servers C#</a></li>\n</ul>\n\n<p>Hope it helped!</p>\n"}], "owner": {"reputation": 21, "user_id": 6874164, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ENkuK.png?s=128&g=1", "display_name": "Sherzodkh", "link": "https://stackoverflow.com/users/6874164/sherzodkh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1894, "favorite_count": 0, "closed_date": 1511276637, "answer_count": 1, "score": -2, "last_activity_date": 1511279936, "creation_date": 1511254695, "question_id": 47408998, "link": "https://stackoverflow.com/questions/47408998/how-to-write-tcp-ip-network-in-c-and-server-in-golang-for-unity-multiplayer-che", "closed_reason": "Not suitable for this site", "title": "How to write Tcp/ip network in C# and Server in Golang for unity multiplayer checkers game", "body": "<p>I'm making Checkers game in unity for android platform. I was given a task to make this game multiplayer and implement TCP/IP network in C# language, and for Server side I have to use Golang. I nearly finished the game itself, but I don't know nothing about server and tcp, how to implement them for my game. \nis there any way to start that or tutorials to show how to do that ?\nAny advice will be great !\nThanks in advance!</p>\n"}, {"tags": ["json", "elasticsearch", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1511252685, "post_id": 47408242, "comment_id": 81769904, "body": "Your raw json is broken: Your &quot;bool&quot; object contains two fields of the same name &quot;filter&quot;. Just pretty print your qstr and you&#39;ll see. Protip: If it doesn&#39;t work you botched up the input."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511252692, "post_id": 47408242, "comment_id": 81769912, "body": "because you have an object with two filter fields"}, {"owner": {"reputation": 1, "user_id": 8095277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48bb3339867fa0a117afc4fd6531646?s=128&d=identicon&r=PG&f=1", "display_name": "user8095277", "link": "https://stackoverflow.com/users/8095277/user8095277"}, "edited": false, "score": 0, "creation_date": 1511253063, "post_id": 47408242, "comment_id": 81770150, "body": "thanks a lot,but this sentence can be execute in Kinaba or curl with elastic server, so this my be elastic server&#39;s problem?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1511254733, "post_id": 47408242, "comment_id": 81771113, "body": "If elasticsearch decides to handle the broken JSON in a specific way it might be a curtesy of ES or a backward compatibility hack or whatnot. Your JSON still has two fields of the same name and unmarshaling that will drop one. There is absolutely nothing you can do about it but fix the JSON."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1511254842, "post_id": 47408242, "comment_id": 81771170, "body": "You want to use two filters under bool, have the filter value be an array of objects just like in the example here <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/query-filter-context.html\" rel=\"nofollow noreferrer\">elastic.co/guide/en/elasticsearch/reference/current/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 0, "last_activity_date": 1511275001, "last_edit_date": 1511275001, "creation_date": 1511274005, "answer_id": 47415357, "question_id": 47408242, "link": "https://stackoverflow.com/questions/47408242/go-json-unmarshal-to-interface-some-clause-disappeared/47415357#47415357", "title": "go json.Unmarshal to interface some clause disappeared", "body": "<p>Your \"qstr\" input JSON string contains the key <code>constant_score.filter.bool.filter</code> twice, which causes the parser to retain the second value for it.</p>\n\n<pre><code>{\n  \"constant_score\": {\n    \"filter\": {\n      \"bool\": {\n        \"filter\": { \"range\": { \"unixtime\": { \"gte\": 1, \"lte\": 2 } } },\n        \"filter\": { \"terms\": { \"uid\": [123] } }\n      }\n    }\n  }\n}\n</code></pre>\n\n<p>JSON syntax <a href=\"https://stackoverflow.com/questions/21832701/does-json-syntax-allow-duplicate-keys-in-an-object\">does not disallow repeated keys</a>; however, it doesn't require that parsers handle them in any special way either, so the vast majority of JSON parsers choose to store the <em>last</em> value of a repeated key in an object, and go's unmarshaler is no different.</p>\n\n<p>Here's an example - consider the following valid JSON string:</p>\n\n<pre><code>{\"a\":1,\"a\":2}\n</code></pre>\n\n<p>Suppose you deserialized this document into an object (e.g. map, dictionary, k/v store, etc). Since keys are unique in such data structures, what value should be stored for they key \"a\", 1 or 2?</p>\n\n<pre><code>// JavaScript\nJSON.parse('{\"a\":1,\"a\":2}'); // =&gt; {a: 2}\n\n# Ruby\nJSON.parse('{\"a\":1,\"a\":2}') # =&gt; {\"a\" =&gt; 2}\n\n# Python\njson.loads('{\"a\":1,\"a\":2}') # =&gt; {u'a': 2}\n\n// Go\nvar obj interface{}\nerr := json.Unmarshal([]byte(`{\"a\":1,\"a\":2}`), &amp;obj)\nif err != nil {\n  panic(err)\n}\nfmt.Printf(\"%#v\\n\", obj)\n// map[string]interface {}{\"a\":2}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 8095277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48bb3339867fa0a117afc4fd6531646?s=128&d=identicon&r=PG&f=1", "display_name": "user8095277", "link": "https://stackoverflow.com/users/8095277/user8095277"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 137, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1511275001, "creation_date": 1511252156, "last_edit_date": 1511255769, "question_id": 47408242, "link": "https://stackoverflow.com/questions/47408242/go-json-unmarshal-to-interface-some-clause-disappeared", "title": "go json.Unmarshal to interface some clause disappeared", "body": "<p>i have a sentence to query a group of users by terms (keyword field present <code>uid</code>) and with a range limit (long filed present unixtime ),the sentence can be executed in Kibana and curl, but when I use golang client(<a href=\"https://github.com/olivere/elastic\" rel=\"nofollow noreferrer\">https://github.com/olivere/elastic</a>) to perform the query, after json. Unmarshal(), the sentence is tampered,the range request is abandoned, why? my sentence disobey the json's rule?</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nvar hot_cache map[string]byte\nvar followers []string\n\nvar prefix = \"{\\\"constant_score\\\" : {\\\"filter\\\" : {\\\"bool\\\" : {\\\"filter\\\" : {\\\"range\\\" : {\\\"unixtime\\\" : {\\\"gte\\\" : %d, \\\"lte\\\" : %d}}}, \\\"filter\\\" : {\\\"terms\\\" : {\\\"uid\\\" : [\"\nvar suffix = \"]}}}}}}\"\n\nfunc main() {\n\n    tmp := prefix\n    tmp += \"\\\"\"\n    tmp += \"123\"\n    tmp += \"\\\"\"\n    tmp += suffix\n\n    qstr := fmt.Sprintf(tmp, 1, 2)\n    fmt.Println(\"raw: \", qstr)\n\n    var f interface{}\n    err := json.Unmarshal([]byte(qstr), &amp;f)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(\"json: \", f)\n}\n</code></pre>\n\n<p><strong>Output:</strong></p>\n\n<pre><code> raw:  {\"constant_score\" : {\"filter\" : {\"bool\" : {\"filter\" : {\"range\" : {\"unixtimestamp\" : {\"gte\" : 1, \"lte\" : 2}}}, \"filter\" : {\"terms\" : {\"uid\" : [\"123\"]}}}}}}\n</code></pre>\n\n<blockquote>\n  <p>json:  map[constant_score:map[filter:map[bool:map[filter:map[terms:map[uid:[123]]]]]]]</p>\n</blockquote>\n\n<p>any one knows why?</p>\n"}, {"tags": ["go", "rabbitmq"], "comments": [{"owner": {"reputation": 1276, "user_id": 6237232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/557d1078fe8ace9c1e6f88d275f5f32a?s=128&d=identicon&r=PG&f=1", "display_name": "RidgeA", "link": "https://stackoverflow.com/users/6237232/ridgea"}, "edited": false, "score": 0, "creation_date": 1511252257, "post_id": 47407888, "comment_id": 81769604, "body": "It seems to me it is an expected behavior, but i cant find any proof :-)."}, {"owner": {"reputation": 1705, "user_id": 2754724, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0db5a1fac483a5c97d7084b35483c8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Crusaderpyro", "link": "https://stackoverflow.com/users/2754724/crusaderpyro"}, "reply_to_user": {"reputation": 1276, "user_id": 6237232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/557d1078fe8ace9c1e6f88d275f5f32a?s=128&d=identicon&r=PG&f=1", "display_name": "RidgeA", "link": "https://stackoverflow.com/users/6237232/ridgea"}, "edited": false, "score": 0, "creation_date": 1511254727, "post_id": 47407888, "comment_id": 81771110, "body": "Yeah..I tried to look for proof but couldn&#39;t find any."}], "answers": [{"tags": [], "owner": {"reputation": 1520, "user_id": 4267030, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BOrG6b-sscc/AAAAAAAAAAI/AAAAAAAAAWA/D2MY5eo53kU/photo.jpg?sz=128", "display_name": "Amir Rahimi Farahani", "link": "https://stackoverflow.com/users/4267030/amir-rahimi-farahani"}, "is_accepted": true, "score": 3, "last_activity_date": 1511267151, "creation_date": 1511267151, "answer_id": 47413093, "question_id": 47407888, "link": "https://stackoverflow.com/questions/47407888/rabbitmq-multiple-acknowledges-to-same-message-closes-the-consumer/47413093#47413093", "title": "RabbitMQ multiple acknowledges to same message closes the consumer", "body": "<p>According to the <a href=\"https://www.rabbitmq.com/amqp-0-9-1-reference.html#basic.ack\" rel=\"nofollow noreferrer\">AMQP reference</a>, a channel exception is raised when a message gets acknowledged for the second time:</p>\n\n<blockquote>\n  <p>A message MUST not be acknowledged more than once. The receiving peer\n  MUST validate that a non-zero delivery-tag refers to a delivered\n  message, and raise a channel exception if this is not the case.</p>\n</blockquote>\n\n<p>Second call to <code>Ack(...)</code> for the same message will not return an error, but the channel gets closed due to this exception received from server:</p>\n\n<pre><code>Exception (406) Reason: \"PRECONDITION_FAILED - unknown delivery tag ?\"\n</code></pre>\n\n<p>It is possible to register a listener via <a href=\"https://godoc.org/github.com/streadway/amqp#Channel.NotifyClose\" rel=\"nofollow noreferrer\">Channel.NotifyClose</a> to observe this exception.</p>\n"}], "owner": {"reputation": 1705, "user_id": 2754724, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0db5a1fac483a5c97d7084b35483c8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Crusaderpyro", "link": "https://stackoverflow.com/users/2754724/crusaderpyro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 277, "favorite_count": 0, "accepted_answer_id": 47413093, "answer_count": 1, "score": 2, "last_activity_date": 1511267151, "creation_date": 1511250793, "question_id": 47407888, "link": "https://stackoverflow.com/questions/47407888/rabbitmq-multiple-acknowledges-to-same-message-closes-the-consumer", "title": "RabbitMQ multiple acknowledges to same message closes the consumer", "body": "<p>If I acknowledge the same message twice using the <a href=\"https://godoc.org/github.com/streadway/amqp#Delivery.Ack\" rel=\"nofollow noreferrer\">Delivery.Ack</a> method, my consumer channel just closes by itself.</p>\n\n<p>Is this expected behaviour? Has anyone experienced this ? </p>\n\n<p>The reason I am acknowledging the same message twice is a special case where I have to break the original message into copies and process them on the consumer. Once the consumer processes everything, it loops and acks everything. Since there are copies of the entity, it acks the same message twice and my consumer channel shuts down</p>\n"}, {"tags": ["oracle", "docker", "go", "build", "pkg-config"], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 11846687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/370481c5aea59df3416abd3c1f90afa4?s=128&d=identicon&r=PG&f=1", "display_name": "SinHub", "link": "https://stackoverflow.com/users/11846687/sinhub"}, "is_accepted": false, "score": 1, "last_activity_date": 1578278705, "creation_date": 1578278705, "answer_id": 59606098, "question_id": 47407093, "link": "https://stackoverflow.com/questions/47407093/pkg-config-path-error-on-building-with-docker/59606098#59606098", "title": "pkg_config_path error on building with docker", "body": "<p>I am not sure had you solved this problem cause this problem has been asked two years ago ...\nFrom your Dockerfile, you already set the <code>PKG_CONFIG_PATH</code>, but after setting WORKDIR you used <code>ADD</code> command, so you add files to your WORKDIR that does not include your <code>PKG_CONFIG_PATH</code>. I think you should use <code>ls</code> for your <code>PKG_CONFIG_PATH</code> to see if any file called oci8.pc exited. In this case I suggest to use <code>COPY</code> command to move oci.pc to <code>PKG_CONFIG_PATH</code> specially.</p>\n"}], "owner": {"reputation": 11, "user_id": 8450108, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-w2RqmCGF5FE/AAAAAAAAAAI/AAAAAAAAIek/8MqIPrNFfyo/photo.jpg?sz=128", "display_name": "Nupur Bansal", "link": "https://stackoverflow.com/users/8450108/nupur-bansal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1030, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1607593597, "creation_date": 1511247745, "last_edit_date": 1607593597, "question_id": 47407093, "link": "https://stackoverflow.com/questions/47407093/pkg-config-path-error-on-building-with-docker", "title": "pkg_config_path error on building with docker", "body": "<p><strong>When I am building an image for my Go application through docker, I am getting the following error:</strong></p>\n<p><strong># pkg-config --cflags oci8</strong></p>\n<p>Package oci8 was not found in the pkg-config search path.\nPerhaps you should add the directory containing `oci8.pc'\nto the PKG_CONFIG_PATH environment variable\nNo package 'oci8' found\npkg-config: exit status 1</p>\n<p>I have set the environment variable in my Dockerfile also. But still the issue persists.\nMy Dockerfile is:</p>\n<pre><code>*FROM golang:1.9\nARG app_env\nENV APP_ENV $app_env\nENV GOPATH /home/nupur/mapi-go\nENV PKG_CONFIG_PATH /home/nupur/mapi-go\nENV ORACLE_HOME /usr/include/oracle/11.2/client64\nENV LD_LIBRARY_PATH /usr/lib/oracle/11.2/client64/lib\nWORKDIR /home/nupur/mapi-go/src/DockerApp/blDocker\nADD . .\nRUN go build /home/nupur/mapi-go/src/DockerApp/blDocker/launch.go\nENTRYPOINT [&quot;./launch&quot;]\nEXPOSE 8093*\n</code></pre>\n<p>Please suggest a solution.</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1511251193, "post_id": 47406876, "comment_id": 81769035, "body": "<code>unexpected EOF</code> could be due to the connection closing before you can read entire data. Try setting a higher <code>db.SetConnMaxLifetime</code>."}, {"owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "reply_to_user": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1511259650, "post_id": 47406876, "comment_id": 81774459, "body": "I tried but didn&#39;t work"}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1511271257, "post_id": 47406876, "comment_id": 81782198, "body": "Are yuo getting the mentioned error occasionally or allways"}, {"owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "edited": false, "score": 0, "creation_date": 1511272544, "post_id": 47406876, "comment_id": 81783146, "body": "Yes, I am getting the same error everytime"}], "answers": [{"comments": [{"owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "edited": false, "score": 0, "creation_date": 1512630329, "post_id": 47678602, "comment_id": 82337833, "body": "I don&#39;t get the error immediately rather I let it read 100k rows from the MySQL table and then I get the error.  As far as table structure is concerned   it contains columns with varchar and int"}, {"owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "reply_to_user": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "edited": false, "score": 0, "creation_date": 1512744063, "post_id": 47678602, "comment_id": 82393257, "body": "Can you update your question to include your <code>Process</code> function?"}], "tags": [], "owner": {"reputation": 1871, "user_id": 4178182, "user_type": "registered", "accept_rate": 59, "profile_image": "https://lh6.googleusercontent.com/-nwJYccYDwvs/AAAAAAAAAAI/AAAAAAAAOUg/A4Wnjm7UsLM/photo.jpg?sz=128", "display_name": "jrkt", "link": "https://stackoverflow.com/users/4178182/jrkt"}, "is_accepted": false, "score": 2, "last_activity_date": 1512576236, "creation_date": 1512576236, "answer_id": 47678602, "question_id": 47406876, "link": "https://stackoverflow.com/questions/47406876/unexpected-eof-and-busy-buffer-in-go-sql-driver-mysql-packets-go/47678602#47678602", "title": "unexpected EOF and busy buffer in (go-sql-driver/mysql) packets.go", "body": "<p>I setup a local MySQL database and ran your code:</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    \"log\"\n    \"time\"\n\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\nfunc main() {\n    db, err := sql.Open(\"mysql\", \"root@tcp(localhost)/test?charset=utf8\")\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    db.SetConnMaxLifetime(time.Second * 5)\n    db.SetMaxIdleConns(0)\n    db.SetMaxOpenConns(151)\n\n    rows, err := db.Query(\"SELECT col1, col2, col3 FROM tbl2\")\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    for rows.Next() {\n        var col1 string\n        var col2 int32\n        var col3 uint64\n\n        err = rows.Scan(&amp;col1, &amp;col2, &amp;col3)\n        if err != nil {\n            log.Fatalln(err)\n        }\n\n        fmt.Println(col1, col2, col3)\n    }\n}\n</code></pre>\n\n<p>..and it worked just fine for me. My <code>CREATE TABLE</code> statement looks like this:</p>\n\n<pre><code>CREATE TABLE `tbl2` (\n`col1` varchar(25) DEFAULT NULL,\n`col2` int(11) DEFAULT NULL,\n`col3` bigint(20) unsigned DEFAULT NULL \n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n</code></pre>\n\n<p>What does your table structure look like?</p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 9575001, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1764810a6856e9fd54019ede653555b9?s=128&d=identicon&r=PG&f=1", "display_name": "Davidu", "link": "https://stackoverflow.com/users/9575001/davidu"}, "is_accepted": false, "score": 2, "last_activity_date": 1522425410, "creation_date": 1522425410, "answer_id": 49577471, "question_id": 47406876, "link": "https://stackoverflow.com/questions/47406876/unexpected-eof-and-busy-buffer-in-go-sql-driver-mysql-packets-go/49577471#49577471", "title": "unexpected EOF and busy buffer in (go-sql-driver/mysql) packets.go", "body": "<p>I found two ways for work arround the <code>packets.go:36: unexpected EOF</code> error, first way was changing driver to <code>ziutek/mymysql</code> driver, works ok and more or less with the same performance.</p>\n\n<p>Second way, with the default driver, is to set <code>db.SetMaxIdleConns(100)</code> and <code>db.SetMaxOpenConns(100)</code>, my mysql has max_connections to 151, \nso I thought that limit to 100 will be ok.</p>\n\n<p>In addition, prepared statements has speeded up a lot, before they were slower than Db.Query, now are at least twice as fast. (Tested with 200k queries in 20 goroutines)</p>\n\n<p>I think the problem could be in file <code>buffer.go</code> of driver <code>go-sql-driver/mysql</code>, in line: <code>nn, err := b.nc.Read(b.buf[n:])</code>, some kind of timeout.</p>\n"}], "owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3813, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1522425410, "creation_date": 1511246988, "question_id": 47406876, "link": "https://stackoverflow.com/questions/47406876/unexpected-eof-and-busy-buffer-in-go-sql-driver-mysql-packets-go", "title": "unexpected EOF and busy buffer in (go-sql-driver/mysql) packets.go", "body": "<p>I am getting the <code>unexpected EOF and busy buffer</code> error in <code>go-sql-driver/mysql</code> despite after setting the <code>SetConnMaxLifetime</code>, <code>SetMaxIdleConns</code> and <code>SetMaxOpenConns</code> as suggested <a href=\"https://github.com/go-sql-driver/mysql/issues/257\" rel=\"nofollow noreferrer\">here</a>. Can anyone tell me the proper solution of this issue nothing seems to work for me?</p>\n\n<pre><code>db, err := sql.Open(\"mysql\", \"USERNAME:PASSWORD@tcp(IP:PORT)/DB?charset=utf8\")\ncheckErr(err)\ndb.SetConnMaxLifetime(time.Second * 5)\ndb.SetMaxIdleConns(0)\ndb.SetMaxOpenConns(151)\n\nrows, err := db.Query(\"Select col1, col2, col3 from tbl\")\ncheckErr(err)\n\nfor rows.Next() {\n    var col1 string     \n    var col2 int32\n    var col3 uint64\n\n    err = rows.Scan(&amp;col1, &amp;col2, &amp;col3)\n    checkErr(err)  \n    Process(col1, col2, col3)\n\n}\n</code></pre>\n"}, {"tags": ["arrays", "string", "go"], "comments": [{"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 1, "creation_date": 1511275114, "post_id": 47406468, "comment_id": 81784997, "body": "What have you tried so far and why isn&#39;t your attempt working?"}, {"owner": {"reputation": 253, "user_id": 1477662, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db5d2c99ff24e8a4a286896037f18a0a?s=128&d=identicon&r=PG", "display_name": "Aviator45003", "link": "https://stackoverflow.com/users/1477662/aviator45003"}, "reply_to_user": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1511276730, "post_id": 47406468, "comment_id": 81786203, "body": "I have not tried things so far. I&#39;m looking for the best approach and anything I&#39;d put down right now would be guesswork. For all I know I just don&#39;t know what term to google for this problem and there is a standard library function just waiting to solve my problem."}], "answers": [{"tags": [], "owner": {"reputation": 149, "user_id": 340945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O0cTZ.jpg?s=128&g=1", "display_name": "Ryan Leyesa", "link": "https://stackoverflow.com/users/340945/ryan-leyesa"}, "is_accepted": false, "score": 1, "last_activity_date": 1511465424, "creation_date": 1511465424, "answer_id": 47462302, "question_id": 47406468, "link": "https://stackoverflow.com/questions/47406468/combine-common-prefix-substrings/47462302#47462302", "title": "Combine common prefix substrings", "body": "<p>Here's one possible solution.  You can check for duplicates before the append() command if you need to.</p>\n\n<p><a href=\"https://play.golang.org/p/XodCgl1fa5\" rel=\"nofollow noreferrer\">https://play.golang.org/p/XodCgl1fa5</a></p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    input := `T: added package to graph: acl-devel/2.2.52_4/armv6l-musl\nT: added package to graph: rofs-filtered/1.7_1/x86_64-musl\nT: added package to graph: rofs-filtered/1.7_1/HOST\nT: added package to graph: libshout/2.4.1_1/i686\nT: added package to graph: mate-terminal/1.18.1_1/armv6l\nT: added package to graph: bullet-devel/2.86.1_1/x86_64-musl\nT: added package to graph: bullet-devel/2.86.1_1/HOST\nT: added package to graph: cubietruck-uboot/2016.11_1/armv6l-musl`\n\n    m := make(map[string][]string)\n    s := bufio.NewScanner(strings.NewReader(input))\n    for s.Scan() {\n        t := s.Text()\n        i := strings.LastIndex(t, \"/\")\n        p := t[:i+1]\n        last := t[i+1 : len(t)]\n        m[p] = append(m[p], last)\n    }\n    for k, v := range m {\n        fmt.Print(k, \"{\", strings.Join(v, \",\"), \"}\", \"\\n\")\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 253, "user_id": 1477662, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db5d2c99ff24e8a4a286896037f18a0a?s=128&d=identicon&r=PG", "display_name": "Aviator45003", "link": "https://stackoverflow.com/users/1477662/aviator45003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1511465424, "creation_date": 1511245316, "last_edit_date": 1511278745, "question_id": 47406468, "link": "https://stackoverflow.com/questions/47406468/combine-common-prefix-substrings", "title": "Combine common prefix substrings", "body": "<p>I have a stream of messages entering a Go channel, most of which look like:</p>\n\n<p><code>T: added package to graph: acl-devel/2.2.52_4/armv6l-musl\nT: added package to graph: rofs-filtered/1.7_1/x86_64-musl\nT: added package to graph: rofs-filtered/1.7_1/HOST\nT: added package to graph: libshout/2.4.1_1/i686\nT: added package to graph: mate-terminal/1.18.1_1/armv6l\nT: added package to graph: bullet-devel/2.86.1_1/x86_64-musl\nT: added package to graph: bullet-devel/2.86.1_1/HOST\nT: added package to graph: cubietruck-uboot/2016.11_1/armv6l-musl\nT: added package to graph: libfontenc/1.1.3_1/i686-musl\nT: added package to graph: apk-tools/2.8.1_1/x86_64\nT: added package to graph: virtualbox-ose/5.1.28_1/armv7l-musl\nT: added package to graph: acl-devel/2.2.52_4/armv7l\nT: added package to graph: apk-tools/2.8.1_1/x86_64-musl\nT: added package to graph: tzutils/2017c_1/x86_64-musl\nT: added package to graph: python-argh/0.26.2_1/noarch\nT: added package to graph: tzutils/2017c_1/HOST\n</code></p>\n\n<p>I wish to be able to efficiently combine the above strings, line by line, but lose no information. This is for printing to an IRC channel, so I don't want to trigger flood warnings. To do that, I want to massage the above to be similar to the below:</p>\n\n<p><code>T: added package to graph: rofs-filtered/1.7_1/{x86_64-musl,HOST}\nT: added package to graph: libshout/2.4.1_1/i686\nT: added package to graph: mate-terminal/1.18.1_1/armv6l\nT: added package to graph: bullet-devel/2.86.1_1/{x86_64-musl,HOST}\nT: added package to graph: cubietruck-uboot/2016.11_1/armv6l-musl\nT: added package to graph: libfontenc/1.1.3_1/i686-musl\nT: added package to graph: apk-tools/2.8.1_1/{x86_64,x86_64-musl}\nT: added package to graph: virtualbox-ose/5.1.28_1/armv7l-musl\nT: added package to graph: acl-devel/2.2.52_4/{armv6l-musl,armv7l}\nT: added package to graph: tzutils/2017c_1/{x86_64-musl,HOST}\nT: added package to graph: python-argh/0.26.2_1/noarch\n</code></p>\n\n<p>While still a lot of output and messages, the bulk of the reporting is about 10-12 lines with common prefixes as above, interspersed with the output of multiple threads doing the above (hence the low number of duplicates in the above data, lots of threads and the data is a snapshot of about 2 seconds).</p>\n\n<p>How might I condense multiple lines to join along their common prefix in Go?</p>\n"}, {"tags": ["rest", "go", "grpc"], "comments": [{"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1511245148, "post_id": 47405341, "comment_id": 81766181, "body": "What is the question? Just run and communicate :)"}, {"owner": {"reputation": 657, "user_id": 1758354, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/52dae9523c89ed427f6b2269fab6800c?s=128&d=identicon&r=PG", "display_name": "nebi", "link": "https://stackoverflow.com/users/1758354/nebi"}, "reply_to_user": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1511251652, "post_id": 47405341, "comment_id": 81769284, "body": "@EugeneLisitsky I have my sample code here: <a href=\"https://play.golang.org/p/Ack83hLV09\" rel=\"nofollow noreferrer\">play.golang.org/p/Ack83hLV09</a>  . Check L30 I need to run gRPC server as goroutine and http server in main. What I am asking is, is this the correct way to do it ? Or is there any other better way ?"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 1, "creation_date": 1511251800, "post_id": 47405341, "comment_id": 81769358, "body": "If they do not conflict and use different ports that\u2019s ok."}], "owner": {"reputation": 657, "user_id": 1758354, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/52dae9523c89ed427f6b2269fab6800c?s=128&d=identicon&r=PG", "display_name": "nebi", "link": "https://stackoverflow.com/users/1758354/nebi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 191, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1512833824, "creation_date": 1511239285, "question_id": 47405341, "link": "https://stackoverflow.com/questions/47405341/rest-endpoint-and-grpc-backend", "title": "REST endpoint and gRPC backend", "body": "<p>I am writing a REST server in Go. The server need to communicate to other gRPC server. The REST server will now also function as gRPC server/client also. What is the suggested way to achieve this ?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1511240731, "post_id": 47405010, "comment_id": 81764612, "body": "&quot;How can I get this to compile, and support both variants of Foo?&quot; You cannot. You have to decide on the type of Foo.M."}], "answers": [{"comments": [{"owner": {"reputation": 7522, "user_id": 149412, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/eaa024a19e43885de663cd7226a77f8f?s=128&d=identicon&r=PG", "display_name": "tekumara", "link": "https://stackoverflow.com/users/149412/tekumara"}, "edited": false, "score": 0, "creation_date": 1511239128, "post_id": 47405127, "comment_id": 81764069, "body": "Thanks @laz that will work, but the thing is, as mentioned, I don&#39;t want to change Foo. I should explain why. I have some other data <code>{&quot;m&quot;: {&quot;a&quot;: { &quot;s&quot;: &quot;hello&quot; }}}</code> that I want to deserialize into Foo as well. I&#39;ve updated the question with both variants, and included your fixes to the use uppercase field names."}], "tags": [], "owner": {"reputation": 27119, "user_id": 8753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NLxHO.jpg?s=128&g=1", "display_name": "laz", "link": "https://stackoverflow.com/users/8753/laz"}, "is_accepted": false, "score": 1, "last_activity_date": 1511238471, "last_edit_date": 1511238471, "creation_date": 1511238127, "answer_id": 47405127, "question_id": 47405010, "link": "https://stackoverflow.com/questions/47405010/deserialize-into-mapstringinterface-as-a-concrete-map-type/47405127#47405127", "title": "Deserialize into map[string]interface{} as a concrete map type", "body": "<p>Change <code>Foo.m</code> to be <code>map[string]Bar</code> instead of what you have, that will allow it to compile. To make it work, you need to change <code>Foo.m</code> to <code>Foo.M</code> and <code>Bar.i</code> to <code>Bar.I</code>. The Go JSON library will not unmarshal to or marshal from unexported properties. Mapping the uppercase properties to lowercase JSON elements requires using tags. Full working example <a href=\"https://play.golang.org/p/oou2oCShBE\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 7522, "user_id": 149412, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/eaa024a19e43885de663cd7226a77f8f?s=128&d=identicon&r=PG", "display_name": "tekumara", "link": "https://stackoverflow.com/users/149412/tekumara"}, "edited": false, "score": 0, "creation_date": 1511241309, "post_id": 47405457, "comment_id": 81764790, "body": "Yes that works. One drawback is that it loses the map type information and so map indexing requires a type assertion, eg: <code>concreteFoo1.M.(map[string]interface{})[&quot;a&quot;]</code> Is there any way to keep the map type, with a flexible type for the value?"}], "tags": [], "owner": {"reputation": 11, "user_id": 4135108, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-6W0NcMyNOwE/AAAAAAAAAAI/AAAAAAAAFgM/e_FNx6egFs4/photo.jpg?sz=128", "display_name": "Stud", "link": "https://stackoverflow.com/users/4135108/stud"}, "is_accepted": false, "score": 1, "last_activity_date": 1511239958, "creation_date": 1511239958, "answer_id": 47405457, "question_id": 47405010, "link": "https://stackoverflow.com/questions/47405010/deserialize-into-mapstringinterface-as-a-concrete-map-type/47405457#47405457", "title": "Deserialize into map[string]interface{} as a concrete map type", "body": "<p>Change this line:\nM map[string]interface{} <code>json:\"m\"</code></p>\n\n<p>into :\nM interface{} <code>json:\"m\"</code></p>\n\n<p><a href=\"https://play.golang.org/p/qRxo81amA7\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qRxo81amA7</a></p>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1511245862, "creation_date": 1511245862, "answer_id": 47406610, "question_id": 47405010, "link": "https://stackoverflow.com/questions/47405010/deserialize-into-mapstringinterface-as-a-concrete-map-type/47406610#47406610", "title": "Deserialize into map[string]interface{} as a concrete map type", "body": "<p>You can make generalized interface </p>\n\n<pre><code>type Foo struct {\n    M map[string]Ibar `json:\"m\"`\n}\n\ntype Ibar interface{}\n</code></pre>\n\n<p>And unpack into it. </p>\n\n<p>When you need specific value of variable make type assertion.</p>\n\n<p><a href=\"https://play.golang.org/p/fcs-Yp-ck2\" rel=\"nofollow noreferrer\">https://play.golang.org/p/fcs-Yp-ck2</a></p>\n"}, {"comments": [{"owner": {"reputation": 7522, "user_id": 149412, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/eaa024a19e43885de663cd7226a77f8f?s=128&d=identicon&r=PG", "display_name": "tekumara", "link": "https://stackoverflow.com/users/149412/tekumara"}, "edited": false, "score": 0, "creation_date": 1511483393, "post_id": 47407673, "comment_id": 81884474, "body": "What is the memory layout of an instance of Bar or Bar2, does it always have two slots for the two pointers?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 7522, "user_id": 149412, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/eaa024a19e43885de663cd7226a77f8f?s=128&d=identicon&r=PG", "display_name": "tekumara", "link": "https://stackoverflow.com/users/149412/tekumara"}, "edited": false, "score": 0, "creation_date": 1511483695, "post_id": 47407673, "comment_id": 81884522, "body": "If you&#39;re asking about size, yes, an instance of <code>BarSet</code> with both pointers <code>nil</code> will have a size of 8 (4 each)."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 1, "last_activity_date": 1511249934, "creation_date": 1511249934, "answer_id": 47407673, "question_id": 47405010, "link": "https://stackoverflow.com/questions/47405010/deserialize-into-mapstringinterface-as-a-concrete-map-type/47407673#47407673", "title": "Deserialize into map[string]interface{} as a concrete map type", "body": "<p>If the set of possible <code>Bar</code> types is infinite you should use the solution from <a href=\"https://stackoverflow.com/a/47405457/965900\">Stud's answer</a>. After unmarshaling you just need to do one type assertion to get the <code>map</code>, which is much better then doing type assertion on each value of a <code>map[string]interface{}</code> type.</p>\n\n<p>If, however, the set is limited to only a few types you could create a parent <code>Bar</code> type that embeds the list of all the possible <code>Bar</code> variations. In case there's a possibility that the fields of the embedded types would collide you can still have the embedding type implement the <code>json.Unmarshaler</code> interface and do some custom logic on what to unmarshal where.</p>\n\n<p>E.g. something like this:</p>\n\n<pre><code>type BarSet struct {\n    *Bar\n    *Bar2\n}\n\ntype Bar struct {\n    I int `json:\"i\"`\n}\n\ntype Bar2 struct {\n    S string `json:\"s\"`\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/tJfqtnP-CX\" rel=\"nofollow noreferrer\">https://play.golang.org/p/tJfqtnP-CX</a></p>\n\n<p>And if you want to be as strict as possible you should create separate <code>Foo</code> types, each with their distincitve <code>M map[string]...</code> field.</p>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1511323608, "creation_date": 1511323608, "answer_id": 47426614, "question_id": 47405010, "link": "https://stackoverflow.com/questions/47405010/deserialize-into-mapstringinterface-as-a-concrete-map-type/47426614#47426614", "title": "Deserialize into map[string]interface{} as a concrete map type", "body": "<p>I've looked again and think custom unmarshaler can be good option.</p>\n\n<pre><code>func (f *Foo) UnmarshalJSON(b []byte) error {\n    var tmp struct {\n        M map[string]json.RawMessage `json:\"m\"`\n    }\n    var foo = Foo{\n        M: make(map[string]interface{}),\n    }\n    var err error\n    //for key, rawValue := range\n    err = json.Unmarshal(b, &amp;tmp)\n    if err != nil {\n        return err\n    }\n    for key, rawValue := range tmp.M {\n        var bar Bar\n        if json.Unmarshal(rawValue, &amp;bar) == nil &amp;&amp; bar.I != 0 { // custom check\n            foo.M[key] = bar\n            continue\n        }\n        var bar2 Bar2\n        if json.Unmarshal(rawValue, &amp;bar2) == nil &amp;&amp; bar2.S != \"\" { // custom check\n            foo.M[key] = bar2\n            continue\n        }\n    }\n    *f = foo\n    return nil\n}\n</code></pre>\n\n<p>Advantages:</p>\n\n<ul>\n<li><p>Logics in one place</p></li>\n<li><p>Standard call <code>UnmarshalJSON</code></p></li>\n<li><p>Can handle several subobjects</p></li>\n</ul>\n\n<p><a href=\"https://play.golang.org/p/ug9rewqjWw\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ug9rewqjWw</a></p>\n"}], "owner": {"reputation": 7522, "user_id": 149412, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/eaa024a19e43885de663cd7226a77f8f?s=128&d=identicon&r=PG", "display_name": "tekumara", "link": "https://stackoverflow.com/users/149412/tekumara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 881, "favorite_count": 1, "answer_count": 5, "score": 2, "last_activity_date": 1511323608, "creation_date": 1511237188, "last_edit_date": 1592644375, "question_id": 47405010, "link": "https://stackoverflow.com/questions/47405010/deserialize-into-mapstringinterface-as-a-concrete-map-type", "title": "Deserialize into map[string]interface{} as a concrete map type", "body": "<pre><code>type Foo struct {\n    M map[string]interface{} `json:&quot;m&quot;`\n}\n\ntype Bar struct {\n    I int `json:&quot;i&quot;`\n}\n\ntype Bar2 struct {\n    S string `json:&quot;s&quot;`\n}\n\n\nfunc do() {\n    concreteFoo1 := Foo {\n        M: make(map[string]Bar),\n    }\n    json.Unmarshal([]byte(`{&quot;m&quot;: {&quot;a&quot;: { &quot;i&quot;: 1 }}}`), &amp;concreteFoo1)\n\n    concreteFoo2 := Foo {\n        M: make(map[string]Bar2),\n    }\n\n    json.Unmarshal([]byte(`{&quot;m&quot;: {&quot;a&quot;: { &quot;s&quot;: &quot;hello&quot; }}}`), &amp;concreteFoo2)\n\n}\n</code></pre>\n<p>fails to compile with:</p>\n<blockquote>\n<p>cannot use make(map[string]Bar) (type map[string]Bar) as type\nmap[string]interface {} in field value</p>\n<p>cannot use make(map[string]Bar2) (type map[string]Bar2) as type\nmap[string]interface {} in field value</p>\n</blockquote>\n<p>How can I get this to compile, and support both variants of Foo?</p>\n"}, {"tags": ["arrays", "go", "slice"], "comments": [{"owner": {"reputation": 126, "user_id": 4061130, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-t_KzaTM98S8/AAAAAAAAAAI/AAAAAAAAADg/AYCfDRGVN3s/photo.jpg?sz=128", "display_name": "Dlacreme", "link": "https://stackoverflow.com/users/4061130/dlacreme"}, "edited": false, "score": 1, "creation_date": 1511235209, "post_id": 47404608, "comment_id": 81763158, "body": "I invite you to add a main function to allow a faster debug.  Anyway, depending on your array <code>arg[lenArg-1]</code> and <code>arg[lenArg-2]</code> may throw out of range exception."}], "answers": [{"tags": [], "owner": {"reputation": 721, "user_id": 8930534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0277bb31c0a6d6334cf3d287289bc17?s=128&d=identicon&r=PG&f=1", "display_name": "Hugh", "link": "https://stackoverflow.com/users/8930534/hugh"}, "is_accepted": false, "score": 3, "last_activity_date": 1511241755, "creation_date": 1511241755, "answer_id": 47405743, "question_id": 47404608, "link": "https://stackoverflow.com/questions/47404608/i-keep-getting-index-out-of-range-error-what-is-wrong-with-my-code/47405743#47405743", "title": "I keep getting index out of range error what is wrong with my code?", "body": "<p>Two possibilities i can see. Firstly, in the first <code>else if</code>:</p>\n\n<pre><code>}else if arg[lenArg - 1] &gt; arg[lenArg -2] {\n</code></pre>\n\n<p>If <code>lenArg</code> is <code>1</code> then <code>lenArg-2</code>will be <code>-1</code>. This means <code>arg[lenArg-2]</code> is <code>arg[-1]</code> which will give you out of bounds.</p>\n\n<p>Secondly, in the second <code>else if</code>:</p>\n\n<pre><code>} else if arg[i] &gt; arg[i+1] ... {\n</code></pre>\n\n<p>On the last iteration over the loop, <code>i</code> will be <code>lenArg-1</code>, if you add <code>1</code> to this you'll get <code>arg[lenArg-1+1]</code> or <code>arg[lenArg]</code> which will out of bounds. (The last available index is at <code>lenArg-1</code>)</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1511249757, "last_edit_date": 1511249757, "creation_date": 1511245322, "answer_id": 47406471, "question_id": 47404608, "link": "https://stackoverflow.com/questions/47404608/i-keep-getting-index-out-of-range-error-what-is-wrong-with-my-code/47406471#47406471", "title": "I keep getting index out of range error what is wrong with my code?", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Index_expressions\" rel=\"nofollow noreferrer\">Index expressions</a></p>\n  \n  <p>A primary expression of the form</p>\n\n<pre><code>a[x]\n</code></pre>\n  \n  <p>denotes the element of the slice <code>a</code> indexed by <code>x</code>.</p>\n  \n  <p>The index <code>x</code> must be of integer type or untyped; it is in range if </p>\n  \n  <p><code>0 &lt;= x &lt; len(a)</code></p>\n  \n  <p>Otherwise it is out of range.</p>\n</blockquote>\n\n<hr>\n\n<p>You need to pay attention to corner cases like lengths <code>0</code>, <code>1</code>, and <code>2</code> for indices <code>i - 1, i, i + 1</code> out of range. For example,</p>\n\n<pre><code>package main\n\n// For array a, a[i] is a peak if it is not smaller than its neighbor(s),\n// where a[-1] = a[n] = -\u221e.\nfunc findPeaks(a []int) []int {\n    var p []int\n    // special cases\n    if len(a) == 0 {\n        return p\n    }\n    if len(a) == 1 {\n        return append(p, a[0])\n    }\n    // first\n    i := 0\n    if a[i] &gt;= a[i+1] {\n        p = append(p, a[i])\n    }\n    // first &lt; i &lt; last\n    for i = 1; i &lt; len(a)-1; i++ {\n        if a[i-1] &lt;= a[i] &amp;&amp; a[i] &gt;= a[i+1] {\n            p = append(p, a[i])\n        }\n    }\n    // last\n    i = len(a) - 1\n    if a[i-1] &lt;= a[i] {\n        p = append(p, a[i])\n    }\n    return p\n}\n\nfunc main() {}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/9klj1wYnXZ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/9klj1wYnXZ</a></p>\n"}], "owner": {"reputation": 17, "user_id": 8545674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2860598e83a8bcf01acae89bbb75c86d?s=128&d=identicon&r=PG&f=1", "display_name": "Sora Dev", "link": "https://stackoverflow.com/users/8545674/sora-dev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1511249757, "creation_date": 1511234262, "last_edit_date": 1511248055, "question_id": 47404608, "link": "https://stackoverflow.com/questions/47404608/i-keep-getting-index-out-of-range-error-what-is-wrong-with-my-code", "title": "I keep getting index out of range error what is wrong with my code?", "body": "<p>My code won't run properly I am trying to get it to find peaks including the end and beginning of the array and then compare all the indexes that aren't the beginning or end to the index before and after them does anyone know why I am getting the out of index range error?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc linearFindPeaks(arg []int) []int {\n    peaks := []int{}\n    lenArg := len(arg)\n    for i := 0; i &lt; lenArg; i++ {\n        //if its the first element run this\n        //second if statement for the end of array\n        // for default statements\n        if arg[0] &gt; arg[1] {\n            peaks = append(peaks, arg[0])\n        } else if arg[lenArg-1] &gt; arg[lenArg-2] {\n            peaks = append(peaks, arg[lenArg-1])\n        } else if arg[i] &gt; arg[i+1] &amp;&amp; arg[i] &gt; arg[i-1] &amp;&amp; arg[i] != arg[0] &amp;&amp; arg[i] != arg[lenArg-1] {\n            peaks = append(peaks, arg[i])\n        }\n    }\n    fmt.Println(peaks)\n    return peaks\n}\n\nfunc main() {}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/2JRgEyRA50\" rel=\"nofollow noreferrer\">https://play.golang.org/p/2JRgEyRA50</a></p>\n"}, {"tags": ["go", "types", "interface"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1511240819, "post_id": 47404497, "comment_id": 81764641, "body": "No this is not possible."}], "answers": [{"comments": [{"owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 0, "creation_date": 1511259040, "post_id": 47410199, "comment_id": 81774099, "body": "But if I use empty interface, will it won&#39;t give the autocomplete suggestions from <code>YParams</code> and <code>XParams</code> will it?"}, {"owner": {"reputation": 4031, "user_id": 4142087, "user_type": "registered", "accept_rate": 92, "profile_image": "https://graph.facebook.com/100004205677206/picture?type=large", "display_name": "Anton Shkurenko", "link": "https://stackoverflow.com/users/4142087/anton-shkurenko"}, "reply_to_user": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 0, "creation_date": 1511259419, "post_id": 47410199, "comment_id": 81774313, "body": "@AyushGupta I updated the answer, check last two links"}, {"owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 0, "creation_date": 1511259508, "post_id": 47410199, "comment_id": 81774367, "body": "hmm, if I go without generics i&#39;ll have to create a Stub got a particular method for XParams"}, {"owner": {"reputation": 4031, "user_id": 4142087, "user_type": "registered", "accept_rate": 92, "profile_image": "https://graph.facebook.com/100004205677206/picture?type=large", "display_name": "Anton Shkurenko", "link": "https://stackoverflow.com/users/4142087/anton-shkurenko"}, "reply_to_user": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 0, "creation_date": 1511259931, "post_id": 47410199, "comment_id": 81774640, "body": "@AyushGupta didn&#39;t understand you"}, {"owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 0, "creation_date": 1511260056, "post_id": 47410199, "comment_id": 81774731, "body": "If I do create a specific type as input , say &#39;CommonParams&#39;, I&#39;ll have to accept a key as input in XStruct, but not do anything with it, and use it in YStruct"}, {"owner": {"reputation": 4031, "user_id": 4142087, "user_type": "registered", "accept_rate": 92, "profile_image": "https://graph.facebook.com/100004205677206/picture?type=large", "display_name": "Anton Shkurenko", "link": "https://stackoverflow.com/users/4142087/anton-shkurenko"}, "reply_to_user": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 0, "creation_date": 1511261798, "post_id": 47410199, "comment_id": 81775925, "body": "You can use switch and type casting for that or create CommonParams as interface with some methods, instead of struct"}, {"owner": {"reputation": 4031, "user_id": 4142087, "user_type": "registered", "accept_rate": 92, "profile_image": "https://graph.facebook.com/100004205677206/picture?type=large", "display_name": "Anton Shkurenko", "link": "https://stackoverflow.com/users/4142087/anton-shkurenko"}, "reply_to_user": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "edited": false, "score": 0, "creation_date": 1511264111, "post_id": 47410199, "comment_id": 81777437, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/159473/discussion-between-anton-shkurenko-and-ayush-gupta\">continue this discussion in chat</a>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1511271367, "post_id": 47410199, "comment_id": 81782278, "body": "Note that there is no type \u201ccasting\u201d in Go. You have \u201ctype conversions\u201d and \u201ctype assertions\u201d, which are both quite different."}], "tags": [], "owner": {"reputation": 4031, "user_id": 4142087, "user_type": "registered", "accept_rate": 92, "profile_image": "https://graph.facebook.com/100004205677206/picture?type=large", "display_name": "Anton Shkurenko", "link": "https://stackoverflow.com/users/4142087/anton-shkurenko"}, "is_accepted": false, "score": 0, "last_activity_date": 1511259406, "last_edit_date": 1511259406, "creation_date": 1511258437, "answer_id": 47410199, "question_id": 47404497, "link": "https://stackoverflow.com/questions/47404497/is-it-possible-to-leave-the-type-of-the-parameter-of-an-interface-to-the-receive/47410199#47410199", "title": "Is it possible to leave the type of the parameter of an interface to the receiver which implements it in Go?", "body": "<p>This is called generics, you can only use empty interface <code>interface{}</code> and \ntype casting.</p>\n\n<p>This is doc about generics in go: <a href=\"https://docs.google.com/document/d/1vrAy9gMpMoS3uaVphB32uVXX4pi-HnNjkMEgyAHX4N4/edit#\" rel=\"nofollow noreferrer\">https://docs.google.com/document/d/1vrAy9gMpMoS3uaVphB32uVXX4pi-HnNjkMEgyAHX4N4/edit#</a>.</p>\n\n<p>This also can help you: </p>\n\n<p><a href=\"https://stackoverflow.com/questions/45171642/how-is-the-empty-interface-different-than-a-generic\">How is the empty interface different than a generic?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/3912089/why-no-generics-in-go\">Why no generics in Go?</a></p>\n\n<p>This article suggests some ways how to live without generics: <a href=\"https://appliedgo.net/generics/\" rel=\"nofollow noreferrer\">https://appliedgo.net/generics/</a></p>\n\n<p>Here you can find code generator for generics (in my honest opinion that's not the best idea) <a href=\"https://github.com/cheekybits/genny\" rel=\"nofollow noreferrer\">https://github.com/cheekybits/genny</a>.</p>\n"}], "owner": {"reputation": 6835, "user_id": 6021597, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/iyl6H.jpg?s=128&g=1", "display_name": "Ayush Gupta", "link": "https://stackoverflow.com/users/6021597/ayush-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1511278768, "creation_date": 1511233300, "last_edit_date": 1511278768, "question_id": 47404497, "link": "https://stackoverflow.com/questions/47404497/is-it-possible-to-leave-the-type-of-the-parameter-of-an-interface-to-the-receive", "title": "Is it possible to leave the type of the parameter of an interface to the receiver which implements it in Go?", "body": "<p>Basically I want to have an interface which has a <code>SetParams</code> method, the declaration of which declares it receives one parameter, and the return type of the method, but leaves the return type of the parameter up to the receiver.</p>\n\n<p>Something like this interface:</p>\n\n<pre><code>type ParamsInterface interface {\n    SetParams(&lt;someType&gt;) ParamsInterface\n}\n</code></pre>\n\n<p>Now, when <code>XStruct</code> implements it, the type of the parameters is <code>XParams</code></p>\n\n<pre><code>type XStruct struct {\n    params XParams\n}\n\nfunc (x *XStruct) SetParams(params *XParams) ParamsInterface {\n    x.params = params\n    return x\n}\n</code></pre>\n\n<p>But when <code>YStruct</code> implements it, the type of the parameters is <code>YParams</code></p>\n\n<pre><code>type YStruct struct {\n    params YParams\n}\n\nfunc (y *YStruct) SetParams(params *YParams) ParamsInterface {\n    y.params = params\n    return y\n}\n</code></pre>\n"}, {"tags": ["database", "mongodb", "go"], "answers": [{"comments": [{"owner": {"reputation": 646, "user_id": 4335622, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh5.googleusercontent.com/-OeTdPDQRltk/AAAAAAAAAAI/AAAAAAAAAE4/KXT0pHbxg9s/photo.jpg?sz=128", "display_name": "i.van", "link": "https://stackoverflow.com/users/4335622/i-van"}, "edited": false, "score": 0, "creation_date": 1511376080, "post_id": 47416417, "comment_id": 81838580, "body": "Thanks Adrian! I&#39;ve tried with 10 batches of 10 goroutines and got 40-50 active connections which is &quot;working correctly&quot; case, I guess.  However, will it auto-truncate the open connections count after a certain amount of time?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 646, "user_id": 4335622, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh5.googleusercontent.com/-OeTdPDQRltk/AAAAAAAAAAI/AAAAAAAAAE4/KXT0pHbxg9s/photo.jpg?sz=128", "display_name": "i.van", "link": "https://stackoverflow.com/users/4335622/i-van"}, "edited": false, "score": 1, "creation_date": 1511380341, "post_id": 47416417, "comment_id": 81840757, "body": "I would think so but that&#39;s an implementation detail of the mongo driver - you can read through the mgo source &amp; docs and probably find out."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1511277180, "creation_date": 1511277180, "answer_id": 47416417, "question_id": 47403785, "link": "https://stackoverflow.com/questions/47403785/go-mongodb-mgo-doesnt-release-closed-connections/47416417#47416417", "title": "Go MongoDB (mgo) - doesn&#39;t release closed connections", "body": "<p>It's connection pooling. When you \"close\" a session, it isn't <em>necessarily</em> closed; it may just be returned to the pool for re-use. In the synchronous example, it doesn't need to expand the pool; you're only using one connection at a time. In the concurrent example, you're using several connections at a time, so it may decide it does need to expand the pool. I would not consider 10 open connections to be cause for concern.</p>\n\n<p>Try it with a larger test - say, 10 batches of 10 goroutines - and see how many connections are open afterward. If you have 100 connections open, something has gone wrong; if you have 10~20, then pooling is working correctly.</p>\n"}], "owner": {"reputation": 646, "user_id": 4335622, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh5.googleusercontent.com/-OeTdPDQRltk/AAAAAAAAAAI/AAAAAAAAAE4/KXT0pHbxg9s/photo.jpg?sz=128", "display_name": "i.van", "link": "https://stackoverflow.com/users/4335622/i-van"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1248, "favorite_count": 0, "accepted_answer_id": 47416417, "answer_count": 1, "score": 0, "last_activity_date": 1511376431, "creation_date": 1511227679, "last_edit_date": 1511376431, "question_id": 47403785, "link": "https://stackoverflow.com/questions/47403785/go-mongodb-mgo-doesnt-release-closed-connections", "title": "Go MongoDB (mgo) - doesn&#39;t release closed connections", "body": "<p>My MongoDB database has a fast-growing amount of active connections.</p>\n\n<p>I wrote a code to test how connection creation/closing flow works. This code sums up how I use the <code>mgo</code> library in my project.</p>\n\n<pre><code>package main\n\nimport (\n    \"time\"\n\n    \"fmt\"\n\n    \"gopkg.in/mgo.v2\"\n)\n\nfunc main() {\n    // No connections\n    // db.serverStatus().connections.current = 6\n\n    mongoSession := connectMGO(\"localhost\", \"27017\", \"admin\")\n    // 1 new connection created\n    //db.serverStatus().connections.current = 7\n\n    produceDataMGO(mongoSession)\n    produceDataMGO(mongoSession)\n    produceDataMGO(mongoSession)\n    produceDataMGO(mongoSession)\n    // 4 new connections created and closed\n    // db.serverStatus().connections.current = 7\n\n    go produceDataMGO(mongoSession)\n    go produceDataMGO(mongoSession)\n    go produceDataMGO(mongoSession)\n    go produceDataMGO(mongoSession)\n    // 4 new connections created and closed concurrently\n    // db.serverStatus().connections.current = 10\n\n    time.Sleep(time.Hour * 24) // wait any amount of time\n    // db.serverStatus().connections.current = 10\n}\n\nfunc connectMGO(host, port, dbName string) *mgo.Session {\n    session, _ := mgo.DialWithInfo(&amp;mgo.DialInfo{\n        Addrs:    []string{fmt.Sprintf(\"%s:%s\", host, port)},\n        Timeout:  10 * time.Second,\n        Database: dbName,\n        Username: \"\",\n        Password: \"\",\n    })\n    return session\n}\n\nfunc produceDataMGO(conn *mgo.Session) {\n    dbConn := conn.Copy()\n    dbConn.DB(\"\").C(\"test\").Insert(\"\")\n    dbConn.Close()\n}\n</code></pre>\n\n<p>I detected a pretty weird thing that I don't understand. Behaviour is somehow different depending on how we create new connections (sync/async). </p>\n\n<p>If we create connection synchronously - mongo closes this new connection immediately after calling <code>.Close()</code> method.</p>\n\n<p>If we create connection asynchronously - mongo keeps this new connection alive even after calling <code>.Close()</code> method.</p>\n\n<p><strike></p>\n\n<ol>\n<li><p>Why is it so?</p></li>\n<li><p>Is there any other way to force-close connection socket?</strike></p></li>\n<li><p>Will it auto-close these open connections after a certain amount of time?</p></li>\n<li>Is there any way to set a limit for the amount of connections MongoDB can expand its pool to?</li>\n<li>Is there any way to setup an auto-truncate after a certain amount of time without high load?</li>\n</ol>\n"}, {"tags": ["windows", "go", "system-calls"], "comments": [{"owner": {"reputation": 55, "user_id": 7933520, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-NalqIX_dG6M/AAAAAAAAAAI/AAAAAAAABAE/N0EejsT6rT0/photo.jpg?sz=128", "display_name": "Ilya Glukhov", "link": "https://stackoverflow.com/users/7933520/ilya-glukhov"}, "edited": false, "score": 0, "creation_date": 1511248940, "post_id": 47403326, "comment_id": 81767901, "body": "Thanks for improving, Tom!"}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 7933520, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-NalqIX_dG6M/AAAAAAAAAAI/AAAAAAAABAE/N0EejsT6rT0/photo.jpg?sz=128", "display_name": "Ilya Glukhov", "link": "https://stackoverflow.com/users/7933520/ilya-glukhov"}, "edited": false, "score": 0, "creation_date": 1511279206, "post_id": 47416424, "comment_id": 81787998, "body": "Thanks a lot, Anton, it works! Where did you get the error codes of the GetExtendedTcpTable(), I did not find them on the MSDN site. Sorry, I&#39;m new in Windows too :-)"}, {"owner": {"reputation": 3721, "user_id": 3936578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfeaef1a08060ac6454b0aabef263aab?s=128&d=identicon&r=PG&f=1", "display_name": "Anton", "link": "https://stackoverflow.com/users/3936578/anton"}, "reply_to_user": {"reputation": 55, "user_id": 7933520, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-NalqIX_dG6M/AAAAAAAAAAI/AAAAAAAABAE/N0EejsT6rT0/photo.jpg?sz=128", "display_name": "Ilya Glukhov", "link": "https://stackoverflow.com/users/7933520/ilya-glukhov"}, "edited": false, "score": 0, "creation_date": 1511283687, "post_id": 47416424, "comment_id": 81791314, "body": "Thanks, happy I could help. I added a link to a page where the error codes are documented."}], "tags": [], "owner": {"reputation": 3721, "user_id": 3936578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfeaef1a08060ac6454b0aabef263aab?s=128&d=identicon&r=PG&f=1", "display_name": "Anton", "link": "https://stackoverflow.com/users/3936578/anton"}, "is_accepted": true, "score": 2, "last_activity_date": 1511283661, "last_edit_date": 1511283661, "creation_date": 1511277207, "answer_id": 47416424, "question_id": 47403326, "link": "https://stackoverflow.com/questions/47403326/empty-response-on-call-getextendedtcptable/47416424#47416424", "title": "Empty response on call GetExtendedTcpTable ()", "body": "<p>Your code has two errors. First, you pass in legnth=0, which causes GetExtendedTcpTable() to return ERROR_INSUFFICIENT_BUFFER\n122 (0x7A). Then, the fifth parameter is not a pointer to the table itself, but an input parameter that states the class (type) of the table to return (write into parameter 1. Here is a corrected version to get over these hurdles:</p>\n\n<pre><code>import (\n        \"fmt\"\n        \"syscall\"\n        \"unsafe\"\n)\n\nconst (\n        TCP_TABLE_BASIC_LISTENER = iota\n        TCP_TABLE_BASIC_CONNECTIONS\n        TCP_TABLE_BASIC_ALL\n        TCP_TABLE_OWNER_PID_LISTENER\n        TCP_TABLE_OWNER_PID_CONNECTIONS\n        TCP_TABLE_OWNER_PID_ALL\n        TCP_TABLE_OWNER_MODULE_LISTENER\n        TCP_TABLE_OWNER_MODULE_CONNECTIONS\n        TCP_TABLE_OWNER_MODULE_ALL\n)\n\nfunc main() {\n        var table [2000]byte\n        var length int = len(table)\n\n        iphelp := syscall.NewLazyDLL(\"iphlpapi.dll\")\n        tcptable := iphelp.NewProc(\"GetExtendedTcpTable\")\n\n        length = len(table)\n\n        res1, res2, err := tcptable.Call(\n                uintptr(unsafe.Pointer(&amp;table)),\n                uintptr(unsafe.Pointer(&amp;length)),\n                1,\n                syscall.AF_INET,\n                TCP_TABLE_BASIC_LISTENER,\n                0,\n        )\n\n        fmt.Println(res1, res2, length, err)\n        fmt.Println(table)\n}\n</code></pre>\n\n<p>I figured this out by inspecting the return code of the GetExtendedTcpTable(). Microsoft system error codes are listed on: <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms681382(v=vs.85).aspx\" rel=\"nofollow noreferrer\">https://msdn.microsoft.com/en-us/library/windows/desktop/ms681382(v=vs.85).aspx</a></p>\n"}], "owner": {"reputation": 55, "user_id": 7933520, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-NalqIX_dG6M/AAAAAAAAAAI/AAAAAAAABAE/N0EejsT6rT0/photo.jpg?sz=128", "display_name": "Ilya Glukhov", "link": "https://stackoverflow.com/users/7933520/ilya-glukhov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 1, "accepted_answer_id": 47416424, "answer_count": 1, "score": 2, "last_activity_date": 1511303097, "creation_date": 1511223760, "last_edit_date": 1511303097, "question_id": 47403326, "link": "https://stackoverflow.com/questions/47403326/empty-response-on-call-getextendedtcptable", "title": "Empty response on call GetExtendedTcpTable ()", "body": "<p>I am new to Go, and I need to catch net information in Windows. I tried to call <code>GetExtendedTcpTable()</code> with pointers to byte arrays as params but get nothing after the call.</p>\n\n<pre><code>var (\n    iphelp   = syscall.NewLazyDLL(\"iphlpapi.dll\")\n    tcptable = iphelp.NewProc(\"GetExtendedTcpTable\")\n)\n\nvar (\n    buffer [20000]byte\n    table  [20000]byte\n    length int\n)\n\nres1, res2, err := tcptable.Call(\n    uintptr(unsafe.Pointer(&amp;buffer)),\n    uintptr(unsafe.Pointer(&amp;length)),\n    1,\n    syscall.AF_INET,\n    uintptr(unsafe.Pointer(&amp;table)),\n    0,\n)\n</code></pre>\n\n<p>I expected some data in 'buffer' and 'table', but there are only 0.\nWhat am I doing wrong?</p>\n"}, {"tags": ["go", "tcp", "server"], "comments": [{"owner": {"reputation": 3365, "user_id": 1736884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c85628cff13ad6178dee34c769fa727?s=128&d=identicon&r=PG", "display_name": "Verran", "link": "https://stackoverflow.com/users/1736884/verran"}, "edited": false, "score": 0, "creation_date": 1511222762, "post_id": 47403123, "comment_id": 81760082, "body": "I&#39;d suggest taking a look at how many connections the process has open when it starts to timeout. It may be surpassing ulimits. If that&#39;s the case consider increasing ulimits or adjusting keep-alive settings to close connections faster."}, {"owner": {"reputation": 585, "user_id": 850019, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffbe5ab7d1201515bf0d9711ad99f507?s=128&d=identicon&r=PG", "display_name": "user850019", "link": "https://stackoverflow.com/users/850019/user850019"}, "reply_to_user": {"reputation": 3365, "user_id": 1736884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c85628cff13ad6178dee34c769fa727?s=128&d=identicon&r=PG", "display_name": "Verran", "link": "https://stackoverflow.com/users/1736884/verran"}, "edited": false, "score": 0, "creation_date": 1511253005, "post_id": 47403123, "comment_id": 81770112, "body": "@Verran how can i increase ulimits?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511276071, "post_id": 47403123, "comment_id": 81785711, "body": "@user850019: I&#39;m sure there are hundreds of ulimit questions and answers between here and ServerFault (or just Google). You should also see what&#39;s tying up your connections, as you may not be releasing them correctly."}], "owner": {"reputation": 585, "user_id": 850019, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffbe5ab7d1201515bf0d9711ad99f507?s=128&d=identicon&r=PG", "display_name": "user850019", "link": "https://stackoverflow.com/users/850019/user850019"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2284, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1529835200, "creation_date": 1511222333, "last_edit_date": 1529835200, "question_id": 47403123, "link": "https://stackoverflow.com/questions/47403123/error-read-tcp-x-x-x-x8080-i-o-timeout", "title": "Error: read tcp x.x.x.x:8080 i/o timeout", "body": "<p>I have an HTTP server running on a VPS, this server serves a lot of requests per minute, so I imagine that's why it might have some load on him.\nAfter a day of the server running, I start getting these errors in the output log:</p>\n\n<pre><code>error : read tcp x.x.x.x:8080-&gt;x.x.x.x:55992: i/o timeout\n</code></pre>\n\n<p>And only when I close the app and reopen it, it's working again.\nBut then again, after a day or sometimes a few hours, the same error comes back.</p>\n\n<p>What could cause this error? And what can I do to avoid it stopping the server from functioning until restarting it?</p>\n\n<p>Thank you upfront.</p>\n"}, {"tags": ["go", "ssh-keys"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1511221216, "post_id": 47402775, "comment_id": 81759585, "body": "Are you sure the ssh client is actually connecting with that key? The client will still offer all other known keys too, so you need to connect with <code>-v</code> and verify which key was offered and accepted."}, {"owner": {"reputation": 1011, "user_id": 722955, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/20f47acfd4f247064e5ec44fc15dd9dc?s=128&d=identicon&r=PG", "display_name": "Devin", "link": "https://stackoverflow.com/users/722955/devin"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511223640, "post_id": 47402775, "comment_id": 81760316, "body": "@JimB nice idea. You might be on to something here. Using the <code>-v</code> option I see that <code>debug1: Offering RSA public key: another_key_name</code>. so it appears it is offering it another key.  Still puzzled why the key pair I generated isn&#39;t working. Both Public and Private key appear to be properly formatted, Public key is definitely in Authorized Keys on remote, and Public key matches the output of <code>ssh-keygen -y -f test_key_1</code>"}, {"owner": {"reputation": 1011, "user_id": 722955, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/20f47acfd4f247064e5ec44fc15dd9dc?s=128&d=identicon&r=PG", "display_name": "Devin", "link": "https://stackoverflow.com/users/722955/devin"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511223986, "post_id": 47402775, "comment_id": 81760410, "body": "To confirm, I ran <code>ssh-add -D</code> to clear out SSH agent and manually connecting no longer works."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511271150, "post_id": 47402775, "comment_id": 81782124, "body": "You probably need the debug logs from the server to find out why it\u2019s not being accepted."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511275629, "post_id": 47402775, "comment_id": 81785364, "body": "I&#39;m also curios as to how to generated a keypair with the crypto/ssh package, as that package has no helpers or code to generate keys."}, {"owner": {"reputation": 1011, "user_id": 722955, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/20f47acfd4f247064e5ec44fc15dd9dc?s=128&d=identicon&r=PG", "display_name": "Devin", "link": "https://stackoverflow.com/users/722955/devin"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511295595, "post_id": 47402775, "comment_id": 81798374, "body": "@JimB If you&#39;re curious, I solved this issue by using the native SSH package to generate PublicKey from a rsa.PrivateKey.PublicKey (as I should have been doing all along) - <a href=\"https://gist.github.com/devinodaniel/8f9b8a4f31573f428f29ec0e884e6673\" rel=\"nofollow noreferrer\">gist.github.com/devinodaniel/8f9b8a4f31573f428f29ec0e884e667&zwnj;&#8203;3</a> . Thanks for your insight."}], "answers": [{"tags": [], "owner": {"reputation": 1011, "user_id": 722955, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/20f47acfd4f247064e5ec44fc15dd9dc?s=128&d=identicon&r=PG", "display_name": "Devin", "link": "https://stackoverflow.com/users/722955/devin"}, "is_accepted": false, "score": 2, "last_activity_date": 1511288142, "creation_date": 1511288142, "answer_id": 47419978, "question_id": 47402775, "link": "https://stackoverflow.com/questions/47402775/go-ssh-key-doesnt-work-with-crypto-ssh-but-does-manually/47419978#47419978", "title": "Go SSH key doesn&#39;t work with crypto/ssh, but does manually", "body": "<p>After the long process of component isolation I was finally able to verify why my Key Pairs weren't authenticating. It's due to a custom connivence package I was using that is generating slightly off Public Keys.</p>\n\n<p>I've post on an open issue he had:</p>\n\n<p><a href=\"https://github.com/ianmcmahon/encoding_ssh/issues/1\" rel=\"nofollow noreferrer\">https://github.com/ianmcmahon/encoding_ssh/issues/1</a></p>\n\n<p>In short:</p>\n\n<p>The Public Key that was created using the <code>EncodePublicKey()</code> function is as below: (truncated for brevity)</p>\n\n<blockquote>\n  <p>ssh-rsa AAAAB3NzaC1yc2EAAAA<strong>EAAEAAQAAAg</strong>C2u3I/nbN9jcWDV..</p>\n</blockquote>\n\n<p>However when running <code>ssh-keygen -y -f id_rsa</code> the below is created:</p>\n\n<blockquote>\n  <p>ssh-rsa AAAAB3NzaC1yc2EAAAA<strong>DAQABAAACAQ</strong>C2u3I/nbN9jcWDV...</p>\n</blockquote>\n\n<p>Notice how the bits in bold are slightly different. This causes SSH authentication to not work.</p>\n"}], "owner": {"reputation": 1011, "user_id": 722955, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/20f47acfd4f247064e5ec44fc15dd9dc?s=128&d=identicon&r=PG", "display_name": "Devin", "link": "https://stackoverflow.com/users/722955/devin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1871, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1511288142, "creation_date": 1511220173, "last_edit_date": 1511278796, "question_id": 47402775, "link": "https://stackoverflow.com/questions/47402775/go-ssh-key-doesnt-work-with-crypto-ssh-but-does-manually", "title": "Go SSH key doesn&#39;t work with crypto/ssh, but does manually", "body": "<p>I generated a SSH RSA keypair with the <code>crypto/ssh</code> package. However, when I try to use it via a script in Go I'm getting the error:</p>\n\n<blockquote>\n  <p>unable to connect: ssh: handshake failed: ssh: unable to authenticate,\n  attempted methods [none publickey], no supported methods remain</p>\n</blockquote>\n\n<p>When I connect to the remote device via CLI, it connects successfully:</p>\n\n<pre><code>ssh -i ~/.ssh/test_key_1 username@172.22.4.1\n</code></pre>\n\n<p>Could I possibly be using the package incorrectly? </p>\n\n<p><strong>Note: Private key does NOT have a passphrase.</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"golang.org/x/crypto/ssh\"\n    \"io/ioutil\"\n    \"log\"\n)\n\nfunc main() {\n    privateKeyFile := \"/Users/username/.ssh/test_key_1\"\n    remoteIP := \"172.22.4.1:22\"\n    user := \"username\"\n\n    privateKeyBytes, err := ioutil.ReadFile(privateKeyFile)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    key, err := ssh.ParsePrivateKey(privateKeyBytes)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    config := &amp;ssh.ClientConfig{\n        User: user,\n        Auth: []ssh.AuthMethod{\n            // Use the PublicKeys method for remote authentication.\n            ssh.PublicKeys(key),\n        },\n        // using InsecureIgnoreHostKey() for testing purposes\n        HostKeyCallback: ssh.InsecureIgnoreHostKey(),\n    }\n\n    client, err := ssh.Dial(\"tcp\", remoteIP, config)\n    if err != nil {\n        log.Fatalf(\"unable to connect: %v\", err)\n    }\n    defer client.Close()\n\n    fmt.Println(\"Success!\")\n}\n</code></pre>\n"}, {"tags": ["rest", "unit-testing", "http", "go", "integration-testing"], "comments": [{"owner": {"reputation": 6832, "user_id": 1124350, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/50953f81a4ba47e3b87aaa744ff20ef9?s=128&d=identicon&r=PG", "display_name": "Fabricio", "link": "https://stackoverflow.com/users/1124350/fabricio"}, "edited": false, "score": 1, "creation_date": 1511216035, "post_id": 47401929, "comment_id": 81757746, "body": "this is a good video about that matter <a href=\"https://www.youtube.com/watch?v=hVFEV-ieeew\" rel=\"nofollow noreferrer\">youtube.com/watch?v=hVFEV-ieeew</a>"}, {"owner": {"reputation": 1383, "user_id": 4167563, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/90cc579fcc609be0144e24cdd6e056fa?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/4167563/max"}, "reply_to_user": {"reputation": 6832, "user_id": 1124350, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/50953f81a4ba47e3b87aaa744ff20ef9?s=128&d=identicon&r=PG", "display_name": "Fabricio", "link": "https://stackoverflow.com/users/1124350/fabricio"}, "edited": false, "score": 0, "creation_date": 1511242694, "post_id": 47401929, "comment_id": 81765258, "body": "@Fabricio thank you."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1511243944, "post_id": 47401929, "comment_id": 81765721, "body": "@Max The accepted answer to  <a href=\"https://stackoverflow.com/a/42474385/4167563\">stackoverflow.com/a/42474385/4167563</a> is not specific to Gorilla mux.  Create the server using <code>ts := httptest.NewServer(http.DefaultServeMux)</code> to test your application."}, {"owner": {"reputation": 1383, "user_id": 4167563, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/90cc579fcc609be0144e24cdd6e056fa?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/4167563/max"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1511287031, "post_id": 47401929, "comment_id": 81793433, "body": "@CeriseLim&#243;n oh, thank you."}], "owner": {"reputation": 1383, "user_id": 4167563, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/90cc579fcc609be0144e24cdd6e056fa?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/4167563/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "closed_date": 1511240851, "answer_count": 0, "score": 2, "last_activity_date": 1511241849, "creation_date": 1511215738, "last_edit_date": 1511241849, "question_id": 47401929, "link": "https://stackoverflow.com/questions/47401929/how-to-write-integration-tests-for-rest-api-in-go", "closed_reason": "Duplicate", "title": "How to write integration tests for REST API in Go?", "body": "<p>I have a simple web application like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"io\"\n)\n\n// hello world, the web server\nfunc HelloServer(w http.ResponseWriter, req *http.Request) {\n    io.WriteString(w, \"hello, world!\\n\")\n}\n\nfunc HelloServer2(w http.ResponseWriter, req *http.Request) {\n    io.WriteString(w, \"hello, world2!\\n\")\n}\n\nfunc main() {\n    http.HandleFunc(\"/hello\", HelloServer)\n    http.HandleFunc(\"/hello2\", HelloServer2)\n    http.ListenAndServe(\":12345\", nil)\n}\n</code></pre>\n\n<p>I want to write a test, which starts my application, then makes call to specific port, then gets <strong>hello, world!</strong> or <strong>hello, world2!</strong> and asserts it. I cannot understand, how to do it with help <a href=\"https://golang.org/pkg/net/http/httptest/\" rel=\"nofollow noreferrer\">httptest</a>.</p>\n\n<p>I cannot test my endpoints like <a href=\"https://stackoverflow.com/a/42474385/4167563\">https://stackoverflow.com/a/42474385/4167563</a> because I don't use <a href=\"http://www.gorillatoolkit.org/\" rel=\"nofollow noreferrer\"><a href=\"http://www.gorillatoolkit.org/\" rel=\"nofollow noreferrer\">http://www.gorillatoolkit.org/</a></a>.</p>\n"}, {"tags": ["docker", "go", "docker-api"], "answers": [{"tags": [], "owner": {"reputation": 3721, "user_id": 3936578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfeaef1a08060ac6454b0aabef263aab?s=128&d=identicon&r=PG&f=1", "display_name": "Anton", "link": "https://stackoverflow.com/users/3936578/anton"}, "is_accepted": true, "score": 2, "last_activity_date": 1511283463, "creation_date": 1511283463, "answer_id": 47418583, "question_id": 47401169, "link": "https://stackoverflow.com/questions/47401169/getting-file-context-from-mounted-file-with-go-docker-api/47418583#47418583", "title": "Getting file context from mounted file with Go Docker API", "body": "<p>First, the <code>Binds</code> parameter is of the format <code>\"source:target[:ro]\"</code>, so you should have it <code>\"/etc/secret.txt:/etc/secret.txt\"</code>, or <code>\"/etc/secret.txt:/etc/secret.txt:ro\"</code> if you want it to be read-only.</p>\n\n<p>Second, the format of the data from the reader returned by <code>CopyFromContainer()</code> is a tar archive. Here is a small modification to your code that fixes Binds, and uses tar from the stdlib to extract the bytes from /etc/secret.</p>\n\n<pre><code>func main() {\n        cli, err := client.NewEnvClient()\n        if err != nil {\n                panic(err)\n        }\n        defer cli.Close()\n\n        ctx := context.Background()\n\n        _, err = cli.ImagePull(ctx, \"alpine\", types.ImagePullOptions{})\n        if err != nil {\n                panic(err)\n\n        }\n\n        containerConfig := &amp;container.Config{\n                Image: \"alpine\",\n                Cmd:   []string{\"sleep\", \"1h\"},\n        }\n\n        // mounted file\n        h := container.HostConfig{\n                Binds: []string{\"/etc/secret.txt:/etc/secret.txt\"},\n        }\n\n        resp, err := cli.ContainerCreate(ctx, containerConfig, &amp;h, nil, \"\")\n        if err != nil {\n                panic(err)\n        }\n\n        rc, _, err := cli.CopyFromContainer(context.Background(), resp.ID, \"/etc/secret.txt\")\n        if err != nil {\n                fmt.Println(err.Error())\n        }\n\n        tr := tar.NewReader(rc)\n        var b []byte\n        for {\n                hdr, err := tr.Next()\n                if err == io.EOF {\n                        break\n                }\n                if err != nil {\n                        break\n                }\n                if hdr.Name == \"secret.txt\" {\n                        b, err = ioutil.ReadAll(tr)\n                        break\n                }\n                fmt.Println(\"Name:\", hdr.Name)\n                if err != nil {\n                        break\n                }\n        }\n        if err != nil {\n                fmt.Println(err.Error())\n        }\n        rc.Close()\n        fmt.Printf(\"%q (len=%d)\\n\", b, len(string(b)))\n}\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 5508661, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UvdFUY3OXBM/AAAAAAAAAAI/AAAAAAAAAEE/n_bblEvYUgg/photo.jpg?sz=128", "display_name": "creaturek", "link": "https://stackoverflow.com/users/5508661/creaturek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 0, "accepted_answer_id": 47418583, "answer_count": 1, "score": 3, "last_activity_date": 1511283463, "creation_date": 1511212477, "last_edit_date": 1511214593, "question_id": 47401169, "link": "https://stackoverflow.com/questions/47401169/getting-file-context-from-mounted-file-with-go-docker-api", "title": "Getting file context from mounted file with Go Docker API", "body": "<p>I'm trying to get mounted file content using Go docker API:</p>\n\n<p>File <code>secret.txt</code> stores a line <code>TOKEN=MY_TOKEN</code></p>\n\n<p>Code:</p>\n\n<pre><code>cli, err := client.NewEnvClient()\nif err != nil {\n    panic(err)\n}\ndefer cli.Close()\n\nctx := context.Background()\n\n_, err = cli.ImagePull(ctx, \"alpine\", types.ImagePullOptions{})\nif err != nil {\n    panic(err)\n\n}\n\ncontainerConfig := &amp;container.Config{\n    Image: \"alpine\",\n    Cmd:   []string{\"echo\", \"hello world\"},\n}\n\n// mounted file\nh := container.HostConfig{\n    Binds: []string{\"/etc/secret.txt\"},\n}\n\nresp, err := cli.ContainerCreate(ctx, containerConfig, &amp;h, nil, \"\")\nif err != nil {\n    panic(err)\n}\n\nrc, _, err := cli.CopyFromContainer(context.Background(), resp.ID, \"/etc/secret.txt\")\nif err != nil {\n    fmt.Println(err.Error())\n}\nb, err := ioutil.ReadAll(rc)\nif err != nil {\n    fmt.Println(err.Error())\n}\nrc.Close()\nfmt.Println(string(b), \"  len=\", len(string(b)))\n</code></pre>\n\n<p>I'm getting <code>secret.txt</code> file with additional information: </p>\n\n<p><code>secret.txt/0040755000000000000000000000000013204637420011354 5ustar0000000000000000   len= 153\n</code></p>\n\n<p>How to get actual data from text file? \nThank you</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1511211551, "post_id": 47400932, "comment_id": 81755481, "body": "<a href=\"https://godoc.org/cloud.google.com/go/datastore#NewClient\" rel=\"nofollow noreferrer\">godoc.org/cloud.google.com/go/datastore#NewClient</a> returns a <code>*Client</code> and an <code>error</code>."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1511212013, "post_id": 47400932, "comment_id": 81755709, "body": "You should also not have a global <code>Context</code>. That doesn&#39;t make any sense."}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 3, "last_activity_date": 1511215398, "last_edit_date": 1511215398, "creation_date": 1511211593, "answer_id": 47400964, "question_id": 47400932, "link": "https://stackoverflow.com/questions/47400932/google-datastore-global-connection/47400964#47400964", "title": "google datastore global connection", "body": "<p>Change <code>client datastore.Client</code> to <code>client *datastore.Client</code>.</p>\n\n<p>Your error message says it all:</p>\n\n<pre><code>cannot assign *\"cloud.google.com/go/datastore\".Client to client (type \"cloud.google.com/go/datastore\".Client) in multiple assignment\n</code></pre>\n\n<p>Condensing it a bit...</p>\n\n<pre><code>cannot assign *ds.Client to client (type ds.Client)...\n  pointer \u2501\u2501\u2501\u2501\u2537\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2519                 \u2502       \u2502\n  plain type \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2537\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2519\n</code></pre>\n\n<p>Note that the first type is a pointer, denoted by the <code>*</code> character and the second type is a plain type (with no asterisk).</p>\n"}], "owner": {"reputation": 458, "user_id": 3066874, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/M5PLK.png?s=128&g=1", "display_name": "Chemdream", "link": "https://stackoverflow.com/users/3066874/chemdream"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 47400964, "answer_count": 1, "score": -1, "last_activity_date": 1511215398, "creation_date": 1511211460, "question_id": 47400932, "link": "https://stackoverflow.com/questions/47400932/google-datastore-global-connection", "title": "google datastore global connection", "body": "<p>How would you declare a global for a datastore client?</p>\n\n<p>So far, I have:</p>\n\n<pre><code>var (\n    db     driver.Conn\n    ctx    context.Context\n    client datastore.Client\n)\n</code></pre>\n\n<p>ignore the db. That's for my global db conn.</p>\n\n<pre><code>func bootstrap() {\n    ctx = context.Background()\n    pId := ProjectId\n    var err error\n    client, err = datastore.NewClient(ctx, pId)\n    if err != nil {\n        fmt.Printf(\"caught error:%v\\n\", err)\n    }\n\n}\n</code></pre>\n\n<p>My error is:\ncannot assign *\"cloud.google.com/go/datastore\".Client to client (type \"cloud.google.com/go/datastore\".Client) in multiple assignment</p>\n"}, {"tags": ["angular", "go", "gorilla"], "comments": [{"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1511211491, "post_id": 47400929, "comment_id": 81755449, "body": "Consider rephrasing your post in the form of a question..."}, {"owner": {"reputation": 3581, "user_id": 2624101, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/682bf5dde0fb968d0fc450809bcb546b?s=128&d=identicon&r=PG&f=1", "display_name": "Brian", "link": "https://stackoverflow.com/users/2624101/brian"}, "edited": false, "score": 0, "creation_date": 1511211732, "post_id": 47400929, "comment_id": 81755571, "body": "I&#39;m not sure why <code>handlers.CORS</code> isn&#39;t working but if you DON&#39;T use CORS, you&#39;ll need to proxy your development requests to port 5000. In production you&#39;ll be running on port 80 so there&#39;s no conflict, but since you&#39;re using angular&#39;s dev server and running your go server locally, <code>localhost:4200</code> and <code>localhost:5000</code> are different origins. I&#39;m not sure what the &quot;angular 5 way&quot; to do this is but <code>webpack-dev-server</code> has an ultra simple <code>proxy</code> field in the <code>package.json</code> and you basically want to replicate that."}, {"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1511212960, "post_id": 47400929, "comment_id": 81756225, "body": "Hello gobuckeyes could you please provide me with the list of headers your client sends in it&#39;s request to the API <i>(from the network tab in dev-tools)</i>. Also does the issue remain if you set all 3 <b>CORS</b> to <code>{&quot;*&quot;}</code>?"}, {"owner": {"reputation": 315, "user_id": 6604003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40329a9052190ea20d5d902787d1eaea?s=128&d=identicon&r=PG&f=1", "display_name": "gobuckeyes2", "link": "https://stackoverflow.com/users/6604003/gobuckeyes2"}, "reply_to_user": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1511214435, "post_id": 47400929, "comment_id": 81756914, "body": "@Mihailo  I posted the headers from the dev-tools. Changing all three CORS to {&quot;*&quot;} changed the error to a 405 - Method not allowed. Thank you"}, {"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1511214647, "post_id": 47400929, "comment_id": 81757019, "body": "Try turning the <code>AllowedMethods()</code> back to what they were. There should be 2 requests sent from your client one has the method <code>OPTIONS</code> and the other should be <code>GET</code> (for this particular) request. After you revert <code>AllowedMethods</code> try sending the request again, and if the error persists update the question with the data from the <code>GET</code> request."}, {"owner": {"reputation": 315, "user_id": 6604003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40329a9052190ea20d5d902787d1eaea?s=128&d=identicon&r=PG&f=1", "display_name": "gobuckeyes2", "link": "https://stackoverflow.com/users/6604003/gobuckeyes2"}, "reply_to_user": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1511215459, "post_id": 47400929, "comment_id": 81757461, "body": "@Mihailo The headers listed above are what&#39;s returned with the AllowedMethods() set as shown in the post right above them.  I think I posted both the Options Request and the Get Request. I don&#39;t think I see any others in the dev tools."}], "answers": [{"tags": [], "owner": {"reputation": 33, "user_id": 5701144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cfc0df6ea1c90fee232626abc881dda2?s=128&d=identicon&r=PG&f=1", "display_name": "David Alexander", "link": "https://stackoverflow.com/users/5701144/david-alexander"}, "is_accepted": false, "score": 0, "last_activity_date": 1511213065, "creation_date": 1511213065, "answer_id": 47401301, "question_id": 47400929, "link": "https://stackoverflow.com/questions/47400929/how-to-add-authorization-header-to-angular-http-request/47401301#47401301", "title": "How to add Authorization Header to Angular http request?", "body": "<p>Here is an example:</p>\n\n<pre><code>this.http\n        .get(url, return new RequestOptions({\n          headers: new Headers({\n            Authorization: `Bearer ${authtoken}`\n          }),\n        }))\n        .map(res =&gt; res.json());\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 315, "user_id": 6604003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40329a9052190ea20d5d902787d1eaea?s=128&d=identicon&r=PG&f=1", "display_name": "gobuckeyes2", "link": "https://stackoverflow.com/users/6604003/gobuckeyes2"}, "edited": false, "score": 2, "creation_date": 1511225682, "post_id": 47401544, "comment_id": 81760857, "body": "This worked for adding the header within the Angular app. Thanks! For the Go piece I was able to use this approach. <a href=\"https://stackoverflow.com/questions/22452804/angularjs-http-get-request-failed-with-custom-header-alllowed-in-cors/22457910#22457910\" title=\"angularjs http get request failed with custom header alllowed in cors\">stackoverflow.com/questions/22452804/&hellip;</a>"}, {"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "reply_to_user": {"reputation": 315, "user_id": 6604003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40329a9052190ea20d5d902787d1eaea?s=128&d=identicon&r=PG&f=1", "display_name": "gobuckeyes2", "link": "https://stackoverflow.com/users/6604003/gobuckeyes2"}, "edited": false, "score": 0, "creation_date": 1511229648, "post_id": 47401544, "comment_id": 81761845, "body": "Neat! Glad I could be of some help :) Good luck!"}], "tags": [], "owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "is_accepted": true, "score": 65, "last_activity_date": 1511215725, "last_edit_date": 1511215725, "creation_date": 1511213955, "answer_id": 47401544, "question_id": 47400929, "link": "https://stackoverflow.com/questions/47400929/how-to-add-authorization-header-to-angular-http-request/47401544#47401544", "title": "How to add Authorization Header to Angular http request?", "body": "<p>Regarding the best way of handling Authentication headers in <strong>Angular > 4</strong> it's best to use<br>\n<code>Http Interceptors</code> for adding them to each request, and afterwards using<br>\n<code>Guards</code> for protecting your routes.</p>\n\n<p>Here's a full example of an <code>AuthInterceptor</code> that I'm using in my app:</p>\n\n<blockquote>\n  <p>auth.interceptor.ts</p>\n</blockquote>\n\n<pre><code>import { HttpEvent, HttpHandler, HttpInterceptor, HttpRequest } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\n\nimport { Observable } from 'rxjs/Observable';\n\nimport { AuthService } from './auth.service';\n\n@Injectable()\nexport class AuthInterceptor implements HttpInterceptor {\n  intercept(req: HttpRequest&lt;any&gt;, next: HttpHandler): Observable&lt;HttpEvent&lt;any&gt;&gt; {\n    req = req.clone({\n      setHeaders: {\n        'Content-Type' : 'application/json; charset=utf-8',\n        'Accept'       : 'application/json',\n        'Authorization': `Bearer ${AuthService.getToken()}`,\n      },\n    });\n\n    return next.handle(req);\n  }\n}\n</code></pre>\n\n<p>You'll need to register your interceptor in the <code>app.module</code> as a provider:</p>\n\n<blockquote>\n  <p>app.module.ts</p>\n</blockquote>\n\n<pre><code>import { HTTP_INTERCEPTORS, HttpClientModule } from '@angular/common/http';\nimport { AuthInterceptor } from '../auth/auth.interceptor';\n\n...\n\nimports: [\n    HttpClientModule,\n    ...\n],\nproviders: [\n    {\n      provide : HTTP_INTERCEPTORS,\n      useClass: AuthInterceptor,\n      multi   : true,\n    },\n    ...\n],\n\n...\n</code></pre>\n\n<p>You can read about this method further in this <a href=\"https://medium.com/@ryanchenkie_40935/angular-authentication-using-the-http-client-and-http-interceptors-2f9d1540eb8\" rel=\"noreferrer\">post</a>.</p>\n\n<hr>\n\n<p>Regarding the <strong>Go</strong>'s side of things, this is most likely a case of mismatch between<br>\n<strong>Request Headers</strong> you're sending and the headers <strong>CORS</strong> allow.<br>\nFirst thing you should try is allowing all of them:</p>\n\n<pre><code>headersOk := handlers.AllowedHeaders([]string{\"*\"})\noriginsOk := handlers.AllowedOrigins([]string{\"*\"})\nmethodsOk := handlers.AllowedMethods([]string{\"GET\", \"HEAD\", \"POST\", \"PUT\", \"OPTIONS\"})\n</code></pre>\n\n<p>And if the problem goes away try carefully structuring your <strong>CORS</strong> one by one to what your client is sending.</p>\n"}, {"tags": [], "owner": {"reputation": 17679, "user_id": 7603109, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/BoIE4.png?s=128&g=1", "display_name": "Adrita Sharma", "link": "https://stackoverflow.com/users/7603109/adrita-sharma"}, "is_accepted": false, "score": 16, "last_activity_date": 1554192937, "creation_date": 1554192937, "answer_id": 55469943, "question_id": 47400929, "link": "https://stackoverflow.com/questions/47400929/how-to-add-authorization-header-to-angular-http-request/55469943#55469943", "title": "How to add Authorization Header to Angular http request?", "body": "<p>In case you don't want to add interceptor, this worked for me:</p>\n\n<pre><code>var header = {\n  headers: new HttpHeaders()\n    .set('Authorization',  `Basic ${btoa(AuthService.getToken())}`)\n}\n\nthis.http.get(url, header)\n</code></pre>\n\n<p>For Bearer, </p>\n\n<pre><code>set('Authorization',  `Bearer ${AuthService.getToken()}`)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 99, "user_id": 9853551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d677c512db7b036278dd336e0e43a0bc?s=128&d=identicon&r=PG&f=1", "display_name": "Mujahid", "link": "https://stackoverflow.com/users/9853551/mujahid"}, "is_accepted": false, "score": 3, "last_activity_date": 1569916872, "last_edit_date": 1569916872, "creation_date": 1569913773, "answer_id": 58179686, "question_id": 47400929, "link": "https://stackoverflow.com/questions/47400929/how-to-add-authorization-header-to-angular-http-request/58179686#58179686", "title": "How to add Authorization Header to Angular http request?", "body": "<p>Angular 6 ==> HTTP Get request example with Authorization Header</p>\n\n<pre><code>public IsClientCreditCardExits(companyId: string, token: any) {\n    let header = new Headers({ 'Authorization': `Bearer ${token}` });\n    const options = new RequestOptions({\n       headers: header,\n    });\n    return this._http.get(this.ApiURL + \"api/Subscriptions/IsClientCreditCardExits/\" + companyId + \"/\", options);    \n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1050, "user_id": 4034959, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/55zTh.png?s=128&g=1", "display_name": "Hamfri", "link": "https://stackoverflow.com/users/4034959/hamfri"}, "is_accepted": false, "score": 0, "last_activity_date": 1581598858, "creation_date": 1581598858, "answer_id": 60208488, "question_id": 47400929, "link": "https://stackoverflow.com/questions/47400929/how-to-add-authorization-header-to-angular-http-request/60208488#60208488", "title": "How to add Authorization Header to Angular http request?", "body": "<p>The following example would fit a situation where you only want some headers added only when accessing resources that require authorization see code below. Kindly note that you need create the getToken method in your <strong>authentication.service.ts</strong>.</p>\n\n<pre><code>import { Injectable } from '@angular/core';\nimport {\n  HttpInterceptor,\n  HttpRequest,\n  HttpHandler,\n  HttpEvent\n} from '@angular/common/http';\nimport { Observable } from 'rxjs';\n\nimport { environment } from '../../environments/environment';\nimport { AuthenticationService } from '../services/authentication.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthenticationInterceptorService implements HttpInterceptor {\n  constructor(public authenticationService: AuthenticationService) {}\n  intercept(\n    request: HttpRequest&lt;any&gt;,\n    next: HttpHandler\n  ): Observable&lt;HttpEvent&lt;any&gt;&gt; {\n    const accessToken: string = this.authenticationService.getToken();\n    // set global application headers.\n    request = request.clone({\n      setHeaders: {\n        'Content-Type': 'application/json; charset=utf-8',\n        Accept: 'application/json',\n        'X-AppName': environment.xAppName,\n        'X-Locale': 'en'\n      }\n    });\n    // Set headers for requests that require authorization.\n    if (accessToken) {\n      const authenticatedRequest = request.clone({\n        headers: request.headers.set(\n          'Authorization',\n          `Token token=${accessToken}`\n        )\n      });\n      // Request with authorization headers\n      return next.handle(authenticatedRequest);\n    } else {\n      // Request without authorization header\n      return next.handle(request);\n    }\n  }\n}\n</code></pre>\n\n<p>Register the interceptor in <strong>app.module.ts</strong> as show below:</p>\n\n<pre><code>import { BrowserModule } from '@angular/platform-browser';\nimport { NgModule } from '@angular/core';\n\nimport { AuthenticationInterceptorService } from './services/authentication-interceptor.service';\n\nimport { AppRoutingModule } from './app-routing.module';\nimport { AppComponent } from './app.component';\nimport { HttpClientModule, HTTP_INTERCEPTORS } from '@angular/common/http';\n\n@NgModule({\n  declarations: [AppComponent],\n  imports: [BrowserModule, AppRoutingModule, HttpClientModule],\n  providers: [\n    {\n      provide: HTTP_INTERCEPTORS,\n      useClass: AuthenticationInterceptorService,\n      multi: true\n    }\n  ],\n  bootstrap: [AppComponent]\n})\nexport class AppModule {}\n</code></pre>\n"}], "owner": {"reputation": 315, "user_id": 6604003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40329a9052190ea20d5d902787d1eaea?s=128&d=identicon&r=PG&f=1", "display_name": "gobuckeyes2", "link": "https://stackoverflow.com/users/6604003/gobuckeyes2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86395, "favorite_count": 14, "accepted_answer_id": 47401544, "answer_count": 5, "score": 29, "last_activity_date": 1581598858, "creation_date": 1511211447, "last_edit_date": 1511214294, "question_id": 47400929, "link": "https://stackoverflow.com/questions/47400929/how-to-add-authorization-header-to-angular-http-request", "title": "How to add Authorization Header to Angular http request?", "body": "<p>This is my first post.</p>\n\n<p>I've just started learning Go and Angular and I'm attempting to connect the angular app to a go api.  I've written both and am stuck identifying the root of the problem. I thought it was a CORS problem, but it works fine if I don't include the headers line of code in my Angular http request. At this point I'm just trying to add the header. The authorization code isn't implemented yet.</p>\n\n<p>Both apps are running locally with the Go app on port 5000 and Angular on 4200</p>\n\n<p>Angular http request that doesn't work:</p>\n\n<pre><code>this.http.get&lt;ProjectedBalance&gt;(requestUrl, {headers: new HttpHeaders().set('Authorization', 'my-auth-token')})\n    .subscribe(data =&gt; {\n     this.projBalance = data.projBalance;\n   }\n</code></pre>\n\n<p>Angular http request that works:</p>\n\n<pre><code>this.http.get&lt;ProjectedBalance&gt;(requestUrl)\n    .subscribe(data =&gt; {\n     this.projBalance = data.projBalance;\n   }\n</code></pre>\n\n<p>I'm getting this error: </p>\n\n<blockquote>\n  <p>Response to preflight request doesn't pass access control check: No\n  'Access-Control-Allow-Origin' header is present on the requested\n  resource. Origin '<a href=\"http://localhost:4200\" rel=\"noreferrer\">http://localhost:4200</a>' is therefore not allowed\n  access. The response had HTTP status code 403</p>\n</blockquote>\n\n<p>I'm using the gorilla/mux and gorilla/handlers in my go code</p>\n\n<pre><code>router := mux.NewRouter()\nrouter.HandleFunc(\"/home/{endDate}\", GetProjBalance).Methods(\"GET\", \"OPTIONS\")\nheadersOk := handlers.AllowedHeaders([]string{\"X-Requested-With, Content-Type, Authorization\"})\noriginsOk := handlers.AllowedOrigins([]string{\"*\"})\nmethodsOk := handlers.AllowedMethods([]string{\"GET\", \"HEAD\", \"POST\", \"PUT\", \"OPTIONS\"})\n//start server on port\nlog.Fatal(http.ListenAndServe(\":5000\", handlers.CORS(originsOk, headersOk, methodsOk)(router)))\n</code></pre>\n\n<p>Headers from Chrome Dev Tools</p>\n\n<pre><code>Request URL:http://localhost:5000/home/2020-12-21\nRequest Method:OPTIONS\nStatus Code:403 Forbidden\nRemote Address:[::1]:5000\nReferrer Policy:no-referrer-when-downgrade\n\nResponse Headers\nview source\nContent-Length:0\nContent-Type:text/plain; charset=utf-8\nDate:Mon, 20 Nov 2017 21:39:43 GMT\n\nRequest Headers\nview source\nAccept:*/*\nAccept-Encoding:gzip, deflate, br\nAccept-Language:en-US,en;q=0.9,uz;q=0.8\nAccess-Control-Request-Headers:authorization\nAccess-Control-Request-Method:GET\nConnection:keep-alive\nHost:localhost:5000\nOrigin:http://localhost:4200\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 3, "creation_date": 1511209452, "post_id": 47400358, "comment_id": 81754362, "body": "JSON defaults to using float64 for all numbers: <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#Unmarshal</a>.  If you want it to be an integer, you need to unmarshal it to a destination with an integer value (example, a <code>map[string]int</code> or a <code>struct{ a int }</code>).  That, or accept that it&#39;ll be a float and simply type-convert it to an int."}, {"owner": {"reputation": 65, "user_id": 4379747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7f3d5e0ba9de9c6e986ef65453d420b?s=128&d=identicon&r=PG&f=1", "display_name": "Steven", "link": "https://stackoverflow.com/users/4379747/steven"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1511299026, "post_id": 47400358, "comment_id": 81800282, "body": "I&#39;m aware that Go&#39;s <code>encoding&#47;json</code> defaults to use float64s for json numbers. Type conversion would be the easiest solution if it worked with large int64 values. I guess I would have to write a custom marshaler or specify the map type. Thanks"}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 2, "last_activity_date": 1511211260, "last_edit_date": 1511211260, "creation_date": 1511210180, "answer_id": 47400608, "question_id": 47400358, "link": "https://stackoverflow.com/questions/47400358/go-converting-json-string-to-mapstringinterface/47400608#47400608", "title": "Go: Converting JSON string to map[string]interface{}", "body": "<p>The <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">go <code>json.Unmarshal(...)</code> function</a> automatically uses float64 for JSON numbers. If you want to unmarshal numbers into a different type then you'll have to use a custom type with a custom unmarshaler. There is no way to force the unmarshaler to deserialize custom values into a generic map.</p>\n\n<p>For example, here's how you could parse values of the \"a\" property as a <a href=\"https://golang.org/pkg/math/big/#Int\" rel=\"nofollow noreferrer\"><code>big.Int</code></a>.</p>\n\n<pre><code>package main\n\nimport (\n  \"encoding/json\"\n  \"fmt\"\n  \"math/big\"\n)\n\ntype MyDoc struct {\n  A BigA `json:\"a\"`\n}\n\ntype BigA struct{ *big.Int }\n\nfunc (a BigA) UnmarshalJSON(bs []byte) error {\n  _, ok := a.SetString(string(bs), 10)\n  if !ok {\n    return fmt.Errorf(\"invalid integer %s\", bs)\n  }\n  return nil\n}\n\nfunc main() {\n  jsonstr := `{\"a\":9223372036854775807}`\n  mydoc := MyDoc{A: BigA{new(big.Int)}}\n\n  err := json.Unmarshal([]byte(jsonstr), &amp;mydoc)\n  if err != nil {\n    panic(err)\n  }\n\n  fmt.Printf(\"OK: mydoc=%#v\\n\", mydoc)\n  // OK: mydoc=main.MyDoc{A:9223372036854775807}\n}\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 4379747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7f3d5e0ba9de9c6e986ef65453d420b?s=128&d=identicon&r=PG&f=1", "display_name": "Steven", "link": "https://stackoverflow.com/users/4379747/steven"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8275, "favorite_count": 1, "accepted_answer_id": 47400608, "answer_count": 1, "score": 3, "last_activity_date": 1511211260, "creation_date": 1511209190, "question_id": 47400358, "link": "https://stackoverflow.com/questions/47400358/go-converting-json-string-to-mapstringinterface", "title": "Go: Converting JSON string to map[string]interface{}", "body": "<p>I'm trying to create a JSON representation within Go using a <code>map[string]interface{}</code> type. I'm dealing with JSON strings and I'm having a hard time figuring out how to avoid the JSON unmarshaler to automatically deal with numbers as float64s. As a result the following error occurs.</p>\n\n<p>Ex.\n<code>\"{ 'a' : 9223372036854775807}\"</code> should be <code>map[string]interface{} = [a 9223372036854775807</code> but in reality it is <code>map[string]interface{} = [a 9.2233720368547758088E18]</code></p>\n\n<p>I searched how structs can be used to avoid this by using <code>json.Number</code> but I'd really prefer using the <code>map</code> type designated above.</p>\n"}, {"tags": ["json", "go", "ascii", "converter"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 7, "creation_date": 1511202187, "post_id": 47398647, "comment_id": 81750370, "body": "ASCII is a character encoding, not a format. That string looks to be URL-encoded. Once decoded, it does appear to be JSON, but it is not a valid JSON document."}, {"owner": {"reputation": 769, "user_id": 4514456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72fdaa340af779a8c8241ba6fc9c94de?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Knife", "link": "https://stackoverflow.com/users/4514456/richard-knife"}, "edited": false, "score": 0, "creation_date": 1511202619, "post_id": 47398647, "comment_id": 81750597, "body": "Thank you guys! like i said, im kinda new to this"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1511203494, "post_id": 47398647, "comment_id": 81751063, "body": "&quot;ASCII formatted string&quot; isn&#39;t a thing."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1511510152, "post_id": 47398647, "comment_id": 81891598, "body": "Where from/how do you get that data? I have a feeling there might be something not qute correct going on before the point at which you&#39;re trying to decode this. So, should we have more background, we could possibly come up with better suggestions for you."}, {"owner": {"reputation": 769, "user_id": 4514456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72fdaa340af779a8c8241ba6fc9c94de?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Knife", "link": "https://stackoverflow.com/users/4514456/richard-knife"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1511607943, "post_id": 47398647, "comment_id": 81925321, "body": "I think the string is intended for dynamic advertising on a car selling site, does this help? @kostix"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1511687172, "post_id": 47398647, "comment_id": 81944072, "body": "No, I rather meant it would be useful to know how do you acquire this string, not what it means ;-) But OK, glad you have it sorted out."}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 2, "last_activity_date": 1511203367, "creation_date": 1511203367, "answer_id": 47398961, "question_id": 47398647, "link": "https://stackoverflow.com/questions/47398647/ascii-to-json-in-go/47398961#47398961", "title": "ASCII to Json in go", "body": "<p>As mentioned by a commenter, your string is URL encoded and can be decoded using <a href=\"https://godoc.org/net/url#QueryUnescape\" rel=\"nofollow noreferrer\"><code>url.QueryUnescape(...)</code></a>:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"net/url\"\n)\n\nfunc main() {\n  querystr := \"debug%22%3Afalse%2C%22pageOpts%22%3A%7B%22noBidIfUnsold%22%3Atrue%2C%22keywords%22%3A%7B%22no-sno-finn-object_type%22%3A%22private%22%2C%22no-sno-finn-car_make%22%3A%22796%22%2C%22aa-sch-publisher%22%3A%22finn%22%2C%22aa-sch-inventory_type%22%3A%22classified%22%2C%22aa-sch-country_code%22%3A%22no%22%2C%22no-sno-finn-section%22%3A%22car%22%2C%22no-sno-finn-ad_owner%22%3A%22false%22%2C%22no-sno-publishergroup%22%3A%22schibsted%22%2C%22aa-sch-supply_type%22%3A%22web_desktop%22%2C%22no-sno-finn-subsection%22%3A%22car_used%22%2C%22aa-sch-page_type%22%3A%22object%22%7D\"\n\n  // Parse the URL encoded string.\n  plainstr, err := url.QueryUnescape(querystr)\n  if err != nil {\n    panic(err)\n  }\n  fmt.Println(plainstr)\n  // debug\":false,\"pageOpts\":{\"noBidIfUnsold\":true,\"keywords\":{\"no-sno-finn-object_type\":\"private\",\"no-sno-finn-car_make\":\"796\",\"aa-sch-publisher\":\"finn\",\"aa-sch-inventory_type\":\"classified\",\"aa-sch-country_code\":\"no\",\"no-sno-finn-section\":\"car\",\"no-sno-finn-ad_owner\":\"false\",\"no-sno-publishergroup\":\"schibsted\",\"aa-sch-supply_type\":\"web_desktop\",\"no-sno-finn-subsection\":\"car_used\",\"aa-sch-page_type\":\"object\"}\n\n}\n</code></pre>\n\n<p>Your example string appears to be incomplete but eventually it can be decoded into a struct or map using <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\"><code>json.Unmarshal(...)</code></a>.</p>\n"}], "owner": {"reputation": 769, "user_id": 4514456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72fdaa340af779a8c8241ba6fc9c94de?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Knife", "link": "https://stackoverflow.com/users/4514456/richard-knife"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 811, "favorite_count": 0, "accepted_answer_id": 47398961, "answer_count": 1, "score": -2, "last_activity_date": 1511203367, "creation_date": 1511202011, "question_id": 47398647, "link": "https://stackoverflow.com/questions/47398647/ascii-to-json-in-go", "title": "ASCII to Json in go", "body": "<p>im kinda new to programming but i found that python didnt have the speed i needed so i switched to go, im building a scraper and i need to convert a what looks like to be a ASCII formated string to json but i cant find any good documentation on how to do this in go.</p>\n\n<p>the string i need converted looks something like this: debug%22%3Afalse%2C%22pageOpts%22%3A%7B%22noBidIfUnsold%22%3Atrue%2C%22keywords%22%3A%7B%22no-sno-finn-object_type%22%3A%22private%22%2C%22no-sno-finn-car_make%22%3A%22796%22%2C%22aa-sch-publisher%22%3A%22finn%22%2C%22aa-sch-inventory_type%22%3A%22classified%22%2C%22aa-sch-country_code%22%3A%22no%22%2C%22no-sno-finn-section%22%3A%22car%22%2C%22no-sno-finn-ad_owner%22%3A%22false%22%2C%22no-sno-publishergroup%22%3A%22schibsted%22%2C%22aa-sch-supply_type%22%3A%22web_desktop%22%2C%22no-sno-finn-subsection%22%3A%22car_used%22%2C%22aa-sch-page_type%22%3A%22object%22%7D</p>\n\n<p>Thanks in advance! </p>\n"}, {"tags": ["go", "gorequest"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1511201836, "post_id": 47398531, "comment_id": 81750196, "body": "You can&#39;t just use an interfere here. For example, <code>Method() *SuperAgent</code> isn&#39;t <code>Method() Getter</code>, they are different signatures."}, {"owner": {"reputation": 3137, "user_id": 982878, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/KoSkA.png?s=128&g=1", "display_name": "George Ananda Eman", "link": "https://stackoverflow.com/users/982878/george-ananda-eman"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511201912, "post_id": 47398531, "comment_id": 81750230, "body": "@JimB any ideas on how do I isolate <code>Method()</code>  then?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1511202283, "post_id": 47398531, "comment_id": 81750423, "body": "Unfortunately you can&#39;t even insert a mocked <code>http.RoundTripper</code>, because the SuperAgent is tied directly to an <code>*http.Transport</code> struct. If you can recreate the endpoints, you could use an <code>httptest.Server</code> and actually make the requests. Otherwise you just have to separate your functionality into testable chunks that can be verified separately from the <code>SuperAgent</code> calls. (Personally I wouldn&#39;t use <code>gorequest</code>.)"}, {"owner": {"reputation": 3137, "user_id": 982878, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/KoSkA.png?s=128&g=1", "display_name": "George Ananda Eman", "link": "https://stackoverflow.com/users/982878/george-ananda-eman"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511202530, "post_id": 47398531, "comment_id": 81750557, "body": "i guess <code>httptest.Server</code> is the only way to go then. Feels wrong on a method test but it should do for now. Thanks @JimB. anything beside <code>gorequest</code> you would reccomend for my use case ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1511203131, "post_id": 47398531, "comment_id": 81750866, "body": "I would use the <code>net&#47;http</code> package. Is the <code>gorequest</code> really saving you from implementing <i>that</i> much code? Note that saving newline characters by chaining methods doesn&#39;t count as saving code, it just formats it differently."}, {"owner": {"reputation": 3137, "user_id": 982878, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/KoSkA.png?s=128&g=1", "display_name": "George Ananda Eman", "link": "https://stackoverflow.com/users/982878/george-ananda-eman"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511203596, "post_id": 47398531, "comment_id": 81751128, "body": "I was under the impression <code>net&#47;http</code> is more low level. Didn&#39;t want to get too down and dirty as I&#39;m still pretty fresh in Go. Will look it up @JimB. cheers"}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 1, "last_activity_date": 1511208182, "last_edit_date": 1511208182, "creation_date": 1511207271, "answer_id": 47399909, "question_id": 47398531, "link": "https://stackoverflow.com/questions/47398531/how-to-write-an-interface-for-a-complex-http-client-like-gorequest-with-methods/47399909#47399909", "title": "How to write an interface for a complex http client like gorequest with methods that returns itself for chaining", "body": "<p>Besides defining the <code>Getter</code> interface you can also define a thin wrapper around <code>*gorequest.SuperAgent</code> that implements the <code>Getter</code> interface.</p>\n\n<pre><code>type saGetter struct {\n    sa *gorequest.SuperAgent\n}\n\nfunc (g *saGetter) Get(url string) Getter {\n    g.sa = g.sa.Get(url)\n    return g\n}\n\nfunc (g *saGetter) Set(param string, value string) Getter {\n    g.sa = g.sa.Set(param, value)\n    return g\n}\n\nfunc (g *saGetter) End(callback ...func(response *gorequest.Response, body string, errs []error)) (*gorequest.Response, string, []error) {\n    return g.sa.End(callback...)\n}\n</code></pre>\n\n<p>Then with your <code>Method</code> defined as:</p>\n\n<pre><code>// subpackage.go\nfunc Method(req Getter) string {\n    req.Get(\"http://www.foo.com\").Set(\"bar\", \"baz\")\n    _, body, _ := req.End()\n    return body\n}\n</code></pre>\n\n<p>You can use the <code>saGetter</code> in main like so:</p>\n\n<pre><code>// main.go\nfunc main() {\n    req := gorequest.New()\n    result := subpackage.Method(&amp;saGetter{req})\n    fmt.Println(result)\n}\n</code></pre>\n\n<p>Then mocking <code>Getter</code> for testing the <code>Method</code> implementation is easy. </p>\n\n<p>That said, I agree with @JimB's comments that you probably don't need <code>gorequest</code> and using <code>net/http</code> is generally the better choice.</p>\n"}], "owner": {"reputation": 3137, "user_id": 982878, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/KoSkA.png?s=128&g=1", "display_name": "George Ananda Eman", "link": "https://stackoverflow.com/users/982878/george-ananda-eman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1511208182, "creation_date": 1511201595, "last_edit_date": 1511202076, "question_id": 47398531, "link": "https://stackoverflow.com/questions/47398531/how-to-write-an-interface-for-a-complex-http-client-like-gorequest-with-methods", "title": "How to write an interface for a complex http client like gorequest with methods that returns itself for chaining", "body": "<p>I'm writing a package which needs to pass an instance of a <code>*gorequest.SuperAgent</code> to a method in a subpackage</p>\n\n<pre><code>// main.go\nfunc main() {\n  req := gorequest.New()\n  result := subpackage.Method(req)\n  fmt.Println(result)\n}\n\n// subpackage.go\nfunc Method(req *gorequest.SuperAgent) string {\n  req.Get(\"http://www.foo.com\").Set(\"bar\", \"baz\")\n  _, body, _ := req.End()\n  return body\n}\n</code></pre>\n\n<p>I keep going in circles trying to write an interface for the gorequest superagent so I can properly isolate and test my subpackage methods with a stub of <code>gorequest</code>.</p>\n\n<pre><code>type Getter Interface {\n  Get(url string) Getter\n  // In the previous Method, Get() returns a *gorequest.SuperAgent\n  // which allows chaining of methods\n  // Here I tried returning the interface itself\n  // But I get a 'wrong type for Get method' error when passing a gorequest instance\n  // have Get(string) *gorequest.SuperAgent\n  // want Get(string) Getter\n\n  End(callback ...func(response *gorequest.Response, body string, errs []error)) (*gorequest.Response, string, []error)\n  // I have no idea how to handle the param and returned *gorequest.Response here\n  // Put another interface ?\n  // Tried replacing it with *http.Response but not quite understanding it\n}\n\nfunc Method(req Getter) string {\n  ...\n}\n</code></pre>\n\n<p>So as you can see I'm tripping up on several points here and haven't been able to find a good source to learn from. Any pointers would be greatly appreciated</p>\n"}, {"tags": ["google-app-engine", "go", "struct", "null", "google-cloud-datastore"], "answers": [{"comments": [{"owner": {"reputation": 458, "user_id": 3066874, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/M5PLK.png?s=128&g=1", "display_name": "Chemdream", "link": "https://stackoverflow.com/users/3066874/chemdream"}, "edited": false, "score": 0, "creation_date": 1511205183, "post_id": 47399176, "comment_id": 81752048, "body": "That was it! Follow up question: Is there a way to have noindex and omitempty in the same tag?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 458, "user_id": 3066874, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/M5PLK.png?s=128&g=1", "display_name": "Chemdream", "link": "https://stackoverflow.com/users/3066874/chemdream"}, "edited": false, "score": 0, "creation_date": 1511208155, "post_id": 47399176, "comment_id": 81753665, "body": "@Chemdream Separate them with a comma, e.g. <code>datastore:&quot;end,omitempty,noindex&quot;</code>, but consult the docs if that&#39;s supported."}, {"owner": {"reputation": 622, "user_id": 7621726, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e924c0eac76608b5725a0f637d91cca?s=128&d=identicon&r=PG&f=1", "display_name": "William Chou", "link": "https://stackoverflow.com/users/7621726/william-chou"}, "edited": false, "score": 0, "creation_date": 1540414429, "post_id": 47399176, "comment_id": 92862024, "body": "Unrelated to this question but I thought you might want to share where <code>iterator.Done</code> comes from.   I went through the google cloud go client library and I see it imported from <code>&quot;google.golang.org&#47;api&#47;iterator&quot;</code>. Did you just import it in the same file as your query functions?"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1511204920, "last_edit_date": 1511204920, "creation_date": 1511204207, "answer_id": 47399176, "question_id": 47398282, "link": "https://stackoverflow.com/questions/47398282/go-google-datastore-nulls/47399176#47399176", "title": "Go Google Datastore nulls", "body": "<p>Two problems that stand out immediately:</p>\n\n<ol>\n<li>Struct fields must be exported, so start their names with capital letter.</li>\n<li>Your <a href=\"https://stackoverflow.com/questions/10858787/what-are-the-uses-for-tags-in-go/30889373#30889373\">tag values</a> are \"invalid\" (they don't follow the conventions). You must not leave a space between the key <code>datastore:</code> and the value <code>\"details,omitempty\"</code>.</li>\n</ol>\n\n<p>So use the following struct definition:</p>\n\n<pre><code>type Edge struct {\n    Created time.Time `datastore:\"created\"`\n    Details string    `datastore:\"details,omitempty\"`\n    Guid    string    `datastore:\"guid,omitempty\"`\n    Start   string    `datastore:\"start,omitempty\"`\n    End     string    `datastore:\"end,omitempty\"`\n}\n</code></pre>\n\n<p>See similar questions for the above-mentioned 2 problems:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/45508642/golang-mgo-getting-empty-objects/45508761#45508761\">golang mgo getting empty objects</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/32674913/why-struct-fields-are-showing-empty/32674930#32674930\">Why struct fields are showing empty?</a></p>\n\n<p>If a property in the Datastore is <code>null</code>, that's not a problem for a Go struct. In such case the corresponding struct field will be the <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">zero-value</a> of its type, which is the empty string <code>\"\"</code> in case of the <code>string</code> type. If you want to be able to differentiate between the Datastore <code>null</code>, Datastore \"missing property\" and the actual empty string <code>\"\"</code>, you may change the field type to be a pointer (like <code>*string</code>), in which case the missing property and the <code>null</code> value will correspond to a <code>nil</code> pointer value, and an existing but empty string value will be a non-<code>nil</code> pointer to an empty string value.</p>\n"}], "owner": {"reputation": 458, "user_id": 3066874, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/M5PLK.png?s=128&g=1", "display_name": "Chemdream", "link": "https://stackoverflow.com/users/3066874/chemdream"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 691, "favorite_count": 1, "accepted_answer_id": 47399176, "answer_count": 1, "score": 1, "last_activity_date": 1511214566, "creation_date": 1511200649, "last_edit_date": 1511214566, "question_id": 47398282, "link": "https://stackoverflow.com/questions/47398282/go-google-datastore-nulls", "title": "Go Google Datastore nulls", "body": "<p>I have datastore objects that look like:</p>\n\n<pre><code>created (timestamp)\nguid (string)\ndetails (string)\nstart (string)\nend (string\n</code></pre>\n\n<p>Often, the <code>details</code>, <code>start</code> or <code>end</code> are <code>NULL</code>.</p>\n\n<p>In Go, I am trying to do this:</p>\n\n<pre><code>    type Edge struct {\n        created   time.Time\n        details   string `datastore: \"details,omitempty\"`\n        guid      string `datastore: \"guid,omitempty\"`\n        start     string `datastore: \"start,omitempty\"`\n        end       string `datastore: \"end,omitempty\"`\n    }\n\n    for t := client.Run(ctx, q); ; {\n        var x Edge\n        key, err := t.Next(&amp;x)\n        if err == iterator.Done {\n            break\n        }\n        if err != nil {\n            fmt.Printf(\"error caught: %v\\n\\n\", err)\n        }\n        fmt.Printf(\"Key=%v\\nEdge=%#v\\n\\n\", key, x)\n    }\n</code></pre>\n\n<p>The output error is always something like:</p>\n\n<pre><code>error caught: datastore: cannot load field \"guid\" into a \"main.Edge\": no such struct field\n\nKey=/edges,4503602429165568\nEdge=main.Edge{created:time.Time{wall:0x0, ext:0, loc:(*time.Location)(nil)}, details:\"\", guid:\"\", start:\"\", end:\"\"}\n</code></pre>\n\n<p>When I search for that key in the datastore console, I see that <code>guid</code> is a valid <code>string</code>.</p>\n\n<p><code>GetAll</code> gave me almost the same problem.</p>\n\n<p>My questions are:</p>\n\n<ul>\n<li>I'm new to Go. Is there anything specific I'm doing wrong here? (Any typos would be Stackoverflow specific. Because I changed a few things here)</li>\n<li>Is there anyway to see what datastore is sending back to be before putting it in a struct?</li>\n<li>Some of the values will sometimes be <code>null</code>. Like <code>start</code>, <code>end</code> and <code>details</code>. Is that valid for a <code>string</code> in a struct?</li>\n</ul>\n\n<p>Thank you.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1511199695, "post_id": 47397927, "comment_id": 81749029, "body": "Nope, using <code>&amp;</code> is the typical method. There is no built-in support (that I know of) for running a Go application as a daemon."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511200200, "post_id": 47397927, "comment_id": 81749303, "body": "The &quot;robust standard way&quot; is whatever your system provides, e.g. &quot;systemd&quot; or equivalent."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1511203595, "post_id": 47397927, "comment_id": 81751126, "body": "Using <code>&amp;</code> is the typical method. Another common approach is fork-and-exit. Which you want depends on your needs. If you don&#39;t have a reason not to use <code>&amp;</code>, though, just use that."}, {"owner": {"reputation": 1829, "user_id": 4242097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1347add4ae303c0258a3db358ed77c55?s=128&d=identicon&r=PG", "display_name": "Parham Alvani", "link": "https://stackoverflow.com/users/4242097/parham-alvani"}, "edited": false, "score": 0, "creation_date": 1511207190, "post_id": 47397927, "comment_id": 81753136, "body": "If you want to create a daemon, Unix daemon processes must detach from their controlling terminal and process group in order to do that you must fork your process twice after doing this and redirect all your outputs and logs into syslog you can go and create systemd script for your daemon management."}], "owner": {"reputation": 9, "user_id": 8972639, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ecfad1380ce70d9c94b0512a4c37af69?s=128&d=identicon&r=PG&f=1", "display_name": "William Fanselow", "link": "https://stackoverflow.com/users/8972639/william-fanselow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1511199373, "creation_date": 1511199373, "question_id": 47397927, "link": "https://stackoverflow.com/questions/47397927/go-chi-web-app-running-in-background", "title": "go-chi web-app running in background", "body": "<p>New to using the go-chi web app framework. After building (go build) a little test app, I am trying to run the compile go app as a daemon (as you would want for any real web-server). Sure, I can run it as a background unix process( # ./myapp &amp; ), but I imagine there must be a more robust standard way to run the web app as a daemon. Any ideas appreciated.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1511199037, "post_id": 47397806, "comment_id": 81748685, "body": "from the FAQ: <a href=\"https://golang.org/doc/faq#nil_error\" rel=\"nofollow noreferrer\">golang.org/doc/faq#nil_error</a>"}, {"owner": {"reputation": 942, "user_id": 170825, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/74b2e22437544a71bf5255429ed0e70f?s=128&d=identicon&r=PG", "display_name": "fabstab", "link": "https://stackoverflow.com/users/170825/fabstab"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511214288, "post_id": 47397806, "comment_id": 81756848, "body": "Thanks!!! Don&#39;t know why I didn&#39;t find it before asking."}], "owner": {"reputation": 942, "user_id": 170825, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/74b2e22437544a71bf5255429ed0e70f?s=128&d=identicon&r=PG", "display_name": "fabstab", "link": "https://stackoverflow.com/users/170825/fabstab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2031, "favorite_count": 1, "closed_date": 1511199132, "answer_count": 0, "score": 1, "last_activity_date": 1511199297, "creation_date": 1511198933, "question_id": 47397806, "link": "https://stackoverflow.com/questions/47397806/golang-check-if-interface-is-nil", "closed_reason": "Duplicate", "title": "Golang check if interface is nil", "body": "<p>I ran into a piece of Go code that I don't really unterstand:</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n)\n\ntype MyCloser struct {\n    internalImplementation io.Closer\n    // other fields here\n}\n\nfunc (c *MyCloser) Close() error {\n    return c.internalImplementation.Close()\n}\n\nfunc closeUnlessNil(c io.Closer) {\n    if c != nil {\n        c.Close()\n    }\n}\n\nfunc main() {\n    var c *MyCloser // c == nil\n    defer closeUnlessNil(c)\n}\n</code></pre>\n\n<p>Try here: <a href=\"https://play.golang.org/p/0CA4fTKpMs\" rel=\"nofollow noreferrer\">https://play.golang.org/p/0CA4fTKpMs</a></p>\n\n<p>The code causes a segmentation fault when <code>c.Close()</code> is called in line 18.</p>\n\n<p>I have two questions about this:</p>\n\n<ol>\n<li>How exactly is this happening? What is the value of <code>c</code> in <code>closeUnlessNil(io.Closer)</code>? I would have thought it's <code>nil</code>, but that's obviously not the case.</li>\n<li>Is it possible to write a generic <code>closeUnlessNil(io.Closer)</code> function that works with any <code>io.Closer</code> and calls <code>Close()</code> only if the parameter is not <code>nil</code>?</li>\n</ol>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1511197335, "post_id": 47397283, "comment_id": 81747668, "body": "Are you having some issue using an <code>if</code> statement? There is nothing in your quoted code that attempts to do what you&#39;re describing."}, {"owner": {"reputation": 819, "user_id": 5136936, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9c1e18e46f49b880d78f0efcec87ee44?s=128&d=identicon&r=PG&f=1", "display_name": "driftavalii", "link": "https://stackoverflow.com/users/5136936/driftavalii"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1511197663, "post_id": 47397283, "comment_id": 81747850, "body": "I updated the question to show what I am trying to do"}], "answers": [{"comments": [{"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "reply_to_user": {"reputation": 819, "user_id": 5136936, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9c1e18e46f49b880d78f0efcec87ee44?s=128&d=identicon&r=PG&f=1", "display_name": "driftavalii", "link": "https://stackoverflow.com/users/5136936/driftavalii"}, "edited": false, "score": 0, "creation_date": 1511199083, "post_id": 47397558, "comment_id": 81748713, "body": "Yup, seems like go was designed for explicit clarity, not for conciseness."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1511199933, "post_id": 47397558, "comment_id": 81749159, "body": "No &quot;seems&quot; about it, Go was <i>explicitly</i> designed in that manner.  The developers of the language state it several times in their various blogs about Go error handling.  Their view is very specifically and openly that clarity &gt; conciseness."}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 2, "last_activity_date": 1511198219, "creation_date": 1511198219, "answer_id": 47397558, "question_id": 47397283, "link": "https://stackoverflow.com/questions/47397283/assign-value-to-field-in-struct-if-empty/47397558#47397558", "title": "Assign value to field in struct if empty", "body": "<p>You cannot use an <code>if ... else</code> statement inline like you would a ternary operator (or if/else statements) in other languages, you must simply do it procedurally:</p>\n\n<pre><code>user := &amp;data{ /* ... */ }\n\nif user.invitecode == \"\" {\n  user.invitecode = \"Mr\"\n} else {\n  user.invitecode = lnames.title\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 819, "user_id": 5136936, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9c1e18e46f49b880d78f0efcec87ee44?s=128&d=identicon&r=PG&f=1", "display_name": "driftavalii", "link": "https://stackoverflow.com/users/5136936/driftavalii"}, "edited": false, "score": 0, "creation_date": 1511198692, "post_id": 47397566, "comment_id": 81748485, "body": "Thanks, was trying to assign all the fields in one go, can the other fields be assigned in the else block and is that a proper way to do it?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 819, "user_id": 5136936, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9c1e18e46f49b880d78f0efcec87ee44?s=128&d=identicon&r=PG&f=1", "display_name": "driftavalii", "link": "https://stackoverflow.com/users/5136936/driftavalii"}, "edited": false, "score": 0, "creation_date": 1511199567, "post_id": 47397566, "comment_id": 81748954, "body": "Sure, if that&#39;s the behavior your&#39;e looking for."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1511198244, "creation_date": 1511198244, "answer_id": 47397566, "question_id": 47397283, "link": "https://stackoverflow.com/questions/47397283/assign-value-to-field-in-struct-if-empty/47397566#47397566", "title": "Assign value to field in struct if empty", "body": "<p>Go does not have ternaries, nor can you do an inline <code>if</code> like you've shown in the code. You will have to do a normal <code>if</code> block:</p>\n\n<pre><code>user = &amp;data{}\nif newUser.inviteCode = \"\" {\n    user.invitecode = \"Mr\"\n} else {\n    user.invitecode = lnames.title\n}\n</code></pre>\n\n<p>And so on. You could extract this into a function:</p>\n\n<pre><code>func coalesce(args ...string) string {\n    for _,str := range args {\n        if str != \"\" {\n            return str\n        }\n    }\n    return \"\"\n}\n</code></pre>\n\n<p>And use it like so:</p>\n\n<pre><code>user.invitecode = coalesce(lnames.title, \"Mr\")\n</code></pre>\n\n<p>Of course, if you deal with multiple types (not just strings), you'll need one such function for each type.</p>\n"}], "owner": {"reputation": 819, "user_id": 5136936, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9c1e18e46f49b880d78f0efcec87ee44?s=128&d=identicon&r=PG&f=1", "display_name": "driftavalii", "link": "https://stackoverflow.com/users/5136936/driftavalii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 597, "favorite_count": 0, "accepted_answer_id": 47397566, "answer_count": 2, "score": -1, "last_activity_date": 1511198934, "creation_date": 1511197281, "last_edit_date": 1511198934, "question_id": 47397283, "link": "https://stackoverflow.com/questions/47397283/assign-value-to-field-in-struct-if-empty", "title": "Assign value to field in struct if empty", "body": "<p>I have a struct defined</p>\n\n<pre><code>type data struct {\n  invitecode string\n  fname string\n  lname string\n}\n</code></pre>\n\n<p>which I populate from retrieving form data after parsing</p>\n\n<pre><code>...\n\nr.ParseForm()\n\nnew user := &amp;data{\n  invitecode: r.FormValue(\"invitecode\"),\n  fname: r.FormValue(\"fname\")\n  lname: r.FormValue(\"lname\")\n}\n</code></pre>\n\n<p>I did like to check if the <code>invitecode</code> field obtained from the form is empty and if so, populate it by calling a function but if it is not, to populate it with the retrieved value (invitecode: if newUser.invitecode == \"\" {\"Mr\"} else {lnames.title},). I understand go doesn't have a tenary operator which I thought of using and reading the questions <a href=\"https://stackoverflow.com/questions/45710188/assign-default-value-for-struct-field-in-golang\">here</a>, <a href=\"https://stackoverflow.com/questions/37135193/how-to-set-default-values-in-golang-structs\">here</a>, <a href=\"https://stackoverflow.com/questions/28447297/how-to-check-for-an-empty-struct\">here</a> &amp; <a href=\"https://stackoverflow.com/questions/19979178/what-is-the-idiomatic-go-equivalent-of-cs-ternary-operator\">here</a> implies using an if else statement but I can't seem to get it to work. Preferable, I am looking for a solution that check's while assigning a new variable. Trying the code below doesn't seem to work. Any help would be appreciated.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype data struct {\n    invitecode string\n    fname      string\n    lname      string\n}\n\nfunc main() {\n    var user data\n\n    newUser := map[string]string{\"invitecode\": \"\", \"fname\": \"Dude\", \"lname\": \"Did\"}\n    user = &amp;data{\n        invitecode: if newUser.invitecode == \"\" {\"Mr\"} else {lnames.title},\n        fname:      newUser.fname,\n        lname:      newUser.lname,\n    }\n    fmt.Println(user)\n}\n</code></pre>\n"}, {"tags": ["android", "go", "jnienv", "gomobile"], "comments": [{"owner": {"reputation": 8500, "user_id": 5108735, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YNWHM.jpg?s=128&g=1", "display_name": "Jon Goodwin", "link": "https://stackoverflow.com/users/5108735/jon-goodwin"}, "edited": false, "score": 0, "creation_date": 1511198454, "post_id": 47396644, "comment_id": 81748330, "body": "This may be of interest   <a href=\"https://github.com/golang/go/wiki/Mobile\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/Mobile</a>"}, {"owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "edited": false, "score": 1, "creation_date": 1511203370, "post_id": 47396644, "comment_id": 81751001, "body": "The reverse binding code from the <code>gobind</code> doc should be compiled using the <code>gomobile</code> tool and not the Go compiler directly."}], "answers": [{"tags": [], "owner": {"reputation": 1595, "user_id": 5276890, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/VfQC8.jpg?s=128&g=1", "display_name": "Roy Falk", "link": "https://stackoverflow.com/users/5276890/roy-falk"}, "is_accepted": false, "score": 0, "last_activity_date": 1513840249, "last_edit_date": 1513840249, "creation_date": 1513227041, "answer_id": 47806107, "question_id": 47396644, "link": "https://stackoverflow.com/questions/47396644/pass-jnienv-or-context-from-java-to-go/47806107#47806107", "title": "Pass JNIEnv or Context from Java to Go", "body": "<p>I hate to answer my own question, but I'd hate someone to go through this as well too. I'll update this answer as I go along.</p>\n\n<p><strong>Basic Setup</strong></p>\n\n<p>Edit build.gradle and add GOPATH and GO to gobind (additions in bold):</p>\n\n<pre><code>gobind {\n    pkg = \".../reverse/reverse\"\n    GOPATH = \"/Users/johndoe/go\"\n    GO = \"/usr/local/go/bin\"\n}\n</code></pre>\n\n<p><strong>How to develop</strong></p>\n\n<ol>\n<li>Start from the reverse example. Get it to compile and run.</li>\n<li>Make one modification and recompile.</li>\n</ol>\n\n<p><strong>Missing gobind</strong></p>\n\n<p>It turns out the installation process neglected to build gobind. Run <code>go install golang.org/x/mobile/cmd/gobind</code></p>\n\n<p><strong>I'm Stuck</strong></p>\n\n<p>Trying to modify the reverse project to do anything other than what it's already doing is failing. Even stuff like passing an object and calling toString will fail.</p>\n\n<p>More to come...</p>\n"}], "owner": {"reputation": 1595, "user_id": 5276890, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/VfQC8.jpg?s=128&g=1", "display_name": "Roy Falk", "link": "https://stackoverflow.com/users/5276890/roy-falk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 427, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1513840249, "creation_date": 1511195174, "last_edit_date": 1511197599, "question_id": 47396644, "link": "https://stackoverflow.com/questions/47396644/pass-jnienv-or-context-from-java-to-go", "title": "Pass JNIEnv or Context from Java to Go", "body": "<p>I've successfully written a go mobile library and used it from an Android Java app.</p>\n\n<p>I've also successfully called a c function from JNI. This one has the JNIEnv pointer.</p>\n\n<p><strong>I'd like to pass the context/JNIEnv from Java to Go.</strong></p>\n\n<p>Here's where it seems to get complicated:</p>\n\n<ol>\n<li>Go Mobile does not seem to use JNIEnv at all. </li>\n<li>LoadJNI.java does have a context object and claims to pass it to the Go side. But there it isn't visible. </li>\n<li>I've been able to include jni.h using the \"C\" directive</li>\n<li>I can transfer the JNIEnv from JNI/C or store it there as a global variable but that's an ugly kludge.</li>\n<li><a href=\"https://github.com/golang/go/issues/16876\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/16876</a> talks about a proposal to do reverse binding but it's unclear what the status is.</li>\n<li><a href=\"https://godoc.org/golang.org/x/mobile/cmd/gobind\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/mobile/cmd/gobind</a> also talks about it but the following code snippet </li>\n</ol>\n\n<p><code>import \"Java/java/lang/System\"\n t := System.CurrentTimeMillis()</code></p>\n\n<p>returns</p>\n\n<pre><code>cannot find package \"Java/java/lang/System\" in any of:\n/usr/local/go/src/Java/java/lang/System (from $GOROOT)\n/Users/----/go/src/Java/java/lang/System (from $GOPATH)\n</code></pre>\n\n<p>In C I solved it with a compiler directive: #cgo CFLAGS: -I...</p>\n\n<p>But I'm not sure how to do it for Java</p>\n\n<p>In short, I'm now stuck and would appreciate help. Ideally, I'd just like to pass the object as a parameter, if possible. However, I'd settle for any reverse binding to call Java from Go.</p>\n"}, {"tags": ["api", "docker", "go", "client", "docker-api"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511195285, "post_id": 47395973, "comment_id": 81746366, "body": "You can&#39;t have nested vendor folders, so you need to properly vendor your dependencies. Also, the import path is now <code>github.com&#47;moby&#47;moby</code>."}], "answers": [{"tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": false, "score": 2, "last_activity_date": 1511195448, "creation_date": 1511195448, "answer_id": 47396719, "question_id": 47395973, "link": "https://stackoverflow.com/questions/47395973/issue-while-using-docker-api-for-go-cannot-import-nat/47396719#47396719", "title": "Issue while using Docker API for GO - cannot import &quot;nat&quot;", "body": "<p>So you need to do more than just copy it, you need to <em>move</em> it.  The same package located in two different locations are <em>different packages</em> to the go tool (because it can't guarantee they are identical, so it uses fully-qualified import paths).</p>\n\n<p>If a package you're using has a vendor directory, and you need to use the packages in it, you have two options:</p>\n\n<ul>\n<li>Move everything out of the <code>vendor</code> directory in that package into your <code>$GOPATH/src</code></li>\n<li>Vendor the package itself, and then move everything from the package's <code>vendor</code> directory into your project's vendor directory (<code>&lt;project root&gt;/vendor</code>).  This is known as \"flattening\" your vendored dependencies, and most Go vendoring utilities (ex. Govendor or Godep) can do this, either automatically or with a flag.  You can also do it manually, though.</li>\n</ul>\n\n<p>The latter is generally the recommended strategy.  The important key, though, is that the package itself cannot have a version of that library in its own <code>vendor</code> directory, as Go tool automatically uses the deepest vendored version of a package that it can access.</p>\n"}], "owner": {"reputation": 51, "user_id": 7727735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fe8290ed4f46f8fb6052326f8dd8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "vickeyshrestha", "link": "https://stackoverflow.com/users/7727735/vickeyshrestha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 471, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1511195448, "creation_date": 1511193176, "question_id": 47395973, "link": "https://stackoverflow.com/questions/47395973/issue-while-using-docker-api-for-go-cannot-import-nat", "title": "Issue while using Docker API for GO - cannot import &quot;nat&quot;", "body": "<p>I am trying to use the docker API for golang that is available from github.com/docker/docker/client. So far I am able to start the containers on the port that is predefined during image built. I am trying to map the port during runtime using the API; something equivalent to </p>\n\n<pre><code>docker run -p 8083:8082 -d myImage:1.0.0\n</code></pre>\n\n<p>I tried to do something like the following for mapping the ports:</p>\n\n<pre><code>host_config := &amp;container.HostConfig{\n     PortBindings: nat.PortMap{\n     \"8082/tcp\": []nat.PortBinding{\n         {\n             HostIP: \"0.0.0.0\",\n             HostPort: \"8983\",\n         },\n      },\n   },\n}\n</code></pre>\n\n<p>The problem here is that the variable \"nat\" lives inside the vendor folder of the API. I couldn't import something directly from the go vendor folder. Someone on the stackoverflow suggested to copy the go-connection folder into the github folder and remove the nested vendor directory. I did as suggested and created a path as follows:</p>\n\n<p><code>\"github.com/docker/go-connections/nat\"</code></p>\n\n<p>now I get the following error during compile time:</p>\n\n<pre><code>src\\main\\createcontainer1.go:53: cannot use \"github.com/docker/go-connections/nat\".PortSet literal (type \"github.com/docker/go-connections/nat\".PortSet) as type \"github.com/docker/docker/vendor/github.com/docker/go-connections/nat\".PortSet in field value\n\nsrc\\main\\createcontainer1.go:65: cannot use \"github.com/docker/go-connections/nat\".PortMap literal (type \"github.com/docker/go-connections/nat\".PortMap) as type \"github.com/docker/docker/vendor/github.com/docker/go-connections/nat\".PortMap in field value\n</code></pre>\n\n<p>Have anyone faced this issue and overcome it? I am using the Go ver 1.8. </p>\n"}, {"tags": ["post", "go", "google-places-api"], "answers": [{"comments": [{"owner": {"reputation": 174, "user_id": 5738406, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TkLn7sW_SOs/AAAAAAAAAAI/AAAAAAAACro/WyBvhTqA6_M/photo.jpg?sz=128", "display_name": "ivan marchenko", "link": "https://stackoverflow.com/users/5738406/ivan-marchenko"}, "edited": false, "score": 0, "creation_date": 1511195665, "post_id": 47396485, "comment_id": 81746589, "body": "Thanks, but now I get an an invalid request as a response. Do you have any idea why I&#39;m not getting a ok response?"}, {"owner": {"reputation": 174, "user_id": 5738406, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TkLn7sW_SOs/AAAAAAAAAAI/AAAAAAAACro/WyBvhTqA6_M/photo.jpg?sz=128", "display_name": "ivan marchenko", "link": "https://stackoverflow.com/users/5738406/ivan-marchenko"}, "edited": false, "score": 0, "creation_date": 1511196242, "post_id": 47396485, "comment_id": 81746970, "body": "{         &quot;status&quot; : &quot;INVALID_REQUEST&quot;     }"}, {"owner": {"reputation": 839, "user_id": 6191855, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/u8HTb.jpg?s=128&g=1", "display_name": "Julien Salinas", "link": "https://stackoverflow.com/users/6191855/julien-salinas"}, "reply_to_user": {"reputation": 174, "user_id": 5738406, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TkLn7sW_SOs/AAAAAAAAAAI/AAAAAAAACro/WyBvhTqA6_M/photo.jpg?sz=128", "display_name": "ivan marchenko", "link": "https://stackoverflow.com/users/5738406/ivan-marchenko"}, "edited": false, "score": 0, "creation_date": 1511198248, "post_id": 47396485, "comment_id": 81748205, "body": "This time I think the error might come from content-type. You should set it to json, which is not the case by default using NewRequest(&quot;POST&quot;,...). Let me check"}, {"owner": {"reputation": 174, "user_id": 5738406, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TkLn7sW_SOs/AAAAAAAAAAI/AAAAAAAACro/WyBvhTqA6_M/photo.jpg?sz=128", "display_name": "ivan marchenko", "link": "https://stackoverflow.com/users/5738406/ivan-marchenko"}, "edited": false, "score": 0, "creation_date": 1511198509, "post_id": 47396485, "comment_id": 81748373, "body": "I tried both, with and without content type, but to no avail. This is how I did it. <code>req.Header.Set(&quot;Content-Type&quot;, &quot;application&#47;json&quot;)</code>"}, {"owner": {"reputation": 839, "user_id": 6191855, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/u8HTb.jpg?s=128&g=1", "display_name": "Julien Salinas", "link": "https://stackoverflow.com/users/6191855/julien-salinas"}, "reply_to_user": {"reputation": 174, "user_id": 5738406, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TkLn7sW_SOs/AAAAAAAAAAI/AAAAAAAACro/WyBvhTqA6_M/photo.jpg?sz=128", "display_name": "ivan marchenko", "link": "https://stackoverflow.com/users/5738406/ivan-marchenko"}, "edited": false, "score": 0, "creation_date": 1511201136, "post_id": 47396485, "comment_id": 81749797, "body": "ok just found the problem at last ! Editing my answer right now :) (this is about your <code>Types</code> which sould be an array, not a string)"}, {"owner": {"reputation": 174, "user_id": 5738406, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TkLn7sW_SOs/AAAAAAAAAAI/AAAAAAAACro/WyBvhTqA6_M/photo.jpg?sz=128", "display_name": "ivan marchenko", "link": "https://stackoverflow.com/users/5738406/ivan-marchenko"}, "edited": false, "score": 0, "creation_date": 1511204171, "post_id": 47396485, "comment_id": 81751453, "body": "Hmm, does it work for you? I still getting the same error."}, {"owner": {"reputation": 839, "user_id": 6191855, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/u8HTb.jpg?s=128&g=1", "display_name": "Julien Salinas", "link": "https://stackoverflow.com/users/6191855/julien-salinas"}, "reply_to_user": {"reputation": 174, "user_id": 5738406, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TkLn7sW_SOs/AAAAAAAAAAI/AAAAAAAACro/WyBvhTqA6_M/photo.jpg?sz=128", "display_name": "ivan marchenko", "link": "https://stackoverflow.com/users/5738406/ivan-marchenko"}, "edited": false, "score": 0, "creation_date": 1511204947, "post_id": 47396485, "comment_id": 81751907, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/159416/discussion-between-julien-salinas-and-ivan-marchenko\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 839, "user_id": 6191855, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/u8HTb.jpg?s=128&g=1", "display_name": "Julien Salinas", "link": "https://stackoverflow.com/users/6191855/julien-salinas"}, "is_accepted": true, "score": 1, "last_activity_date": 1511720733, "last_edit_date": 1511720733, "creation_date": 1511194748, "answer_id": 47396485, "question_id": 47395704, "link": "https://stackoverflow.com/questions/47395704/keep-getting-empty-response-when-adding-place-via-google-place-api/47396485#47396485", "title": "Keep getting empty response when adding place via google place API", "body": "<p>FYI I wrote <a href=\"https://juliensalinas.com/en/REST_API_fetching_go_golang_vs_python/\" rel=\"nofollow noreferrer\">this article</a> on this touchy topic (JSON data encoded into a POST body request in Go).</p>\n\n<p>You're missing 4 things here: </p>\n\n<ul>\n<li>the <code>http.Client</code> creation. Then you need to execute the request you're preparing with <code>http.NewRequest</code> by using <code>client.Do</code>.</li>\n<li>add <code>json</code> fields to your struct and export variables contained in struct by capitalizing variables's first letters</li>\n<li>set <code>Content-Type</code> to <code>application/json</code></li>\n<li>Google is expecting an array instead of a string in <code>types</code>, so I replace with an array containing 1 string (but you should adapt this depending on how many types you want to pass to Google)</li>\n</ul>\n\n<p>Here is a working script:</p>\n\n<pre><code>type latlng struct {\n    Lat float64 `json:\"lat\"`\n    Lng float64 `json:\"lng\"`\n}\n\ntype newPlace struct {\n    Location    latlng    `json:\"location\"`\n    Accuracy    int       `json:\"accuracy\"`\n    Name        string    `json:\"name\"`\n    PhoneNumber string    `json:\"phone_number\"`\n    Address     string    `json:\"address\"`\n    Types       [1]string `json:\"types\"`\n}\n\nfunc main() {\n    requestUrl := \"https://maps.googleapis.com/maps/api/place/add/json?key=&lt;your key&gt;\"\n\n    types := [1]string{\"storage\"}\n    obj := newPlace{\n        Location: latlng{\n            Lat: 52.1502824,\n            Lng: 38.2643063,\n        },\n        Name:  \"some field\",\n        Types: types,\n    }\n\n    bodyBytes, err := json.Marshal(&amp;obj)\n    if err != nil {\n        fmt.Println(err)\n    }\n    body := bytes.NewReader(bodyBytes)\n    client := &amp;http.Client{}\n    req, err := http.NewRequest(\"POST\", requestUrl, body)\n    req.Header.Add(\"Content-Type\", \"application/json\")\n    if err != nil {\n        fmt.Println(err)\n    }\n    rsp, err := client.Do(req)\n    defer rsp.Body.Close()\n\n    body_byte, err := ioutil.ReadAll(rsp.Body)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(string(body_byte))\n}\n</code></pre>\n\n<p>Hope it's working now !</p>\n"}, {"comments": [{"owner": {"reputation": 174, "user_id": 5738406, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TkLn7sW_SOs/AAAAAAAAAAI/AAAAAAAACro/WyBvhTqA6_M/photo.jpg?sz=128", "display_name": "ivan marchenko", "link": "https://stackoverflow.com/users/5738406/ivan-marchenko"}, "edited": false, "score": 0, "creation_date": 1511196870, "post_id": 47397053, "comment_id": 81747368, "body": "Thanks Adrian, but I&#39;m still getting same error <code>{    &quot;status&quot; : &quot;INVALID_REQUEST&quot; }</code>. Could it be because I&#39;m not specifying content type?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 174, "user_id": 5738406, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TkLn7sW_SOs/AAAAAAAAAAI/AAAAAAAACro/WyBvhTqA6_M/photo.jpg?sz=128", "display_name": "ivan marchenko", "link": "https://stackoverflow.com/users/5738406/ivan-marchenko"}, "edited": false, "score": 0, "creation_date": 1511196922, "post_id": 47397053, "comment_id": 81747389, "body": "I don&#39;t know, what happens if you specify it?"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1511196546, "creation_date": 1511196546, "answer_id": 47397053, "question_id": 47395704, "link": "https://stackoverflow.com/questions/47395704/keep-getting-empty-response-when-adding-place-via-google-place-api/47397053#47397053", "title": "Keep getting empty response when adding place via google place API", "body": "<p>You're trying to marshall objects to JSON which have no exported fields, so the resulting JSON document is empty. <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\">Per the JSON documentation</a>, it will only marshall exported fields (those whose names begin with a capital letter). Try:</p>\n\n<pre><code>type latlng struct {\n   Lat float64 `json:\"lat\"`\n   Lng float64 `json:\"lng\"`\n}\n\ntype newPlace struct {\n   Location     latlng `json:\"location\"`\n   Accuracy     int `json:\"accuracy\"`\n   Name         string `json:\"name\"`\n   PhoneNumber string `json:\"phone_number\"`\n   Address      string `json:\"address\"`\n   Types        string `json:\"types\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 174, "user_id": 5738406, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TkLn7sW_SOs/AAAAAAAAAAI/AAAAAAAACro/WyBvhTqA6_M/photo.jpg?sz=128", "display_name": "ivan marchenko", "link": "https://stackoverflow.com/users/5738406/ivan-marchenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 47396485, "answer_count": 2, "score": 1, "last_activity_date": 1511720733, "creation_date": 1511192335, "question_id": 47395704, "link": "https://stackoverflow.com/questions/47395704/keep-getting-empty-response-when-adding-place-via-google-place-api", "title": "Keep getting empty response when adding place via google place API", "body": "<p>I'm trying to add a place within app scope via google place API. For this I'm using golang. But I keep on getting no result, there is no error message. </p>\n\n<p>Here is my code </p>\n\n<p>```</p>\n\n<pre><code>type latlng struct {\n   lat, lng float64\n}\ntype newPlace struct {\n   location     latlng\n   accuracy     int\n   name         string\n   phone_number string\n   address      string\n   types        string\n}\n\nfunc main() {\n   requestUrl := \"https://maps.googleapis.com/maps/api/place/add/json?key=&lt;MYAPIKEY&gt;\"\n\n   obj := newPlace{\n      location: latlng{\n        lat: 52.1502824,\n        lng: 38.2643063,\n     },\n      name:  \"some field\",\n      types: \"storage\",\n   }\n\n   bodyBytes, err := json.Marshal(&amp;obj)\n   if err != nil {\n      panic(err)\n   }\n   body := bytes.NewReader(bodyBytes)\n   rsp, err := http.NewRequest(\"POST\", requestUrl, body)\n   if err != nil {\n       log.Fatal(err)\n   }\n   defer rsp.Body.Close()\n\n   body_byte, err := ioutil.ReadAll(rsp.Body)\n   if err != nil {\n       panic(err)\n   }\n   fmt.Println(string(body_byte))\n}\n</code></pre>\n\n<p>```</p>\n\n<p>Here is the documentation that I followed. <a href=\"https://developers.google.com/places/web-service/add-place\" rel=\"nofollow noreferrer\">https://developers.google.com/places/web-service/add-place</a></p>\n\n<p>I'm a bit new to golang, any help would be much appreciated. </p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 1320, "user_id": 4359699, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d7433b53d461a631e4e1cda7017c28db?s=128&d=identicon&r=PG&f=1", "display_name": "hraban", "link": "https://stackoverflow.com/users/4359699/hraban"}, "edited": false, "score": 0, "creation_date": 1611673286, "post_id": 47395430, "comment_id": 116522868, "body": "The only way to get around the zero values is not to have raw ints or strings in your config struct. Or at least not for values that are non-zero by default, but could be set to zero. You would have to use <code>*int</code> etc for those."}], "answers": [{"comments": [{"owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "edited": false, "score": 0, "creation_date": 1511194133, "post_id": 47396192, "comment_id": 81745661, "body": "I like it; nevertheless need to think more about it as we may need this to be more generic....it&#39;s a complex project with different sections of config, so this type of solution may become very long...as for the slow part, it&#39;s on initialization only, so we may live with a bit of a slower but more generic solution"}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "reply_to_user": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "edited": false, "score": 2, "creation_date": 1511194233, "post_id": 47396192, "comment_id": 81745725, "body": "You make want to look into <code>go generate</code> that will generate the method for you from struct definition. I&#39;ll update my answer to add this point."}], "tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": false, "score": 6, "last_activity_date": 1511194558, "last_edit_date": 1511194558, "creation_date": 1511193826, "answer_id": 47396192, "question_id": 47395430, "link": "https://stackoverflow.com/questions/47395430/merge-fields-two-structs-of-same-type/47396192#47396192", "title": "&quot;Merge&quot; fields two structs of same type", "body": "<p>Reflection is going to make your code slow.</p>\n\n<p>For this struct I would implement a straight <code>Merge()</code> method as:</p>\n\n<pre><code>type Config struct {\n  path string\n  id   string\n  key  string\n  addr string\n  size uint64\n}\n\nfunc (c *Config) Merge(c2 Config) {\n  if c.path == \"\" {\n    c.path = c2.path\n  }\n  if c.id == \"\" {\n    c.id = c2.id\n  }\n  if c.path == \"\" {\n    c.path = c2.path\n  }\n  if c.addr == \"\" {\n    c.addr = c2.addr\n  }\n  if c.size == 0 {\n    c.size = c2.size\n  }\n}\n</code></pre>\n\n<p>It's almost same amount of code, fast and easy to understand.</p>\n\n<p>You can cover this method with uni tests that uses reflection to make sure new fields did not get left behind.</p>\n\n<p>That's the point of Go - you write more to get fast &amp; easy to read code.</p>\n\n<p>Also you may want to look into <code>go generate</code> that will generate the method for you from struct definition. Maybe there event something already implemented and available on GitHub? Here is an example of code that do something similar: <a href=\"https://github.com/matryer/moq\" rel=\"nofollow noreferrer\">https://github.com/matryer/moq</a></p>\n\n<p>Also there are some packages on GitHub that I believe are doing what you want in runtime, for example: <a href=\"https://github.com/imdario/mergo\" rel=\"nofollow noreferrer\">https://github.com/imdario/mergo</a></p>\n"}, {"comments": [{"owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "edited": false, "score": 0, "creation_date": 1511198360, "post_id": 47396406, "comment_id": 81748274, "body": "Supercool, but there&#39;s a little caveat for my case....the file MUST be in TOML syntax, and the function which reads it does already return it as <code>Config</code> instance....thus, everything will be overwritten by this <code>fileContent</code> instance...I didn&#39;t specifically mention this case so I might want to accept your answer"}, {"owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "edited": false, "score": 0, "creation_date": 1511202379, "post_id": 47396406, "comment_id": 81750482, "body": "Turns out I can use the TOML Reader the exact same way as the JSON Reader...awesome!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 15, "last_activity_date": 1511203636, "last_edit_date": 1511203636, "creation_date": 1511194515, "answer_id": 47396406, "question_id": 47395430, "link": "https://stackoverflow.com/questions/47395430/merge-fields-two-structs-of-same-type/47396406#47396406", "title": "&quot;Merge&quot; fields two structs of same type", "body": "<p><strong>Foreword:</strong> The <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"noreferrer\"><code>encoding/json</code></a> package uses reflection (package <a href=\"https://golang.org/pkg/reflect/\" rel=\"noreferrer\"><code>reflect</code></a>) to read/write values, including structs. Other libraries also using reflection (such as implementations of TOML and YAML) may operate in a similar (or even in the same way), and thus the principle presented here may apply to those libraries as well. You need to test it with the library you use.</p>\n\n<p>For simplicity, the solution presented here uses the standard lib's <code>encoding/json</code>.</p>\n\n<hr>\n\n<p>An elegant and \"zero-effort\" solution is to use the <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"noreferrer\"><code>encoding/json</code></a> package and <strong>unmarshal into a value of the \"prepared\", default configuration</strong>.</p>\n\n<p>This handles everything you need:</p>\n\n<ul>\n<li>missing values in config file: default applies</li>\n<li>a value given in file overrides default config (whatever it was)</li>\n<li>explicit overrides to zero values in the file takes precedence (overwrites non-zero default config)</li>\n</ul>\n\n<p>To demonstrate, we'll use this config struct:</p>\n\n<pre><code>type Config struct {\n    S1 string\n    S2 string\n    S3 string\n    S4 string\n    S5 string\n}\n</code></pre>\n\n<p>And the default configuration:</p>\n\n<pre><code>var defConfig = &amp;Config{\n    S1: \"\", // Zero value\n    S2: \"\", // Zero value\n    S3: \"abc\",\n    S4: \"def\",\n    S5: \"ghi\",\n}\n</code></pre>\n\n<p>And let's say the file contains the following configuration:</p>\n\n<pre><code>const fileContent = `{\"S2\":\"file-s2\",\"S3\":\"\",\"S5\":\"file-s5\"}`\n</code></pre>\n\n<p>The file config overrides <code>S2</code>, <code>S3</code> and the <code>S5</code> fields.</p>\n\n<p>Code to load the configuration:</p>\n\n<pre><code>conf := new(Config) // New config\n*conf = *defConfig  // Initialize with defaults\n\nerr := json.NewDecoder(strings.NewReader(fileContent)).Decode(&amp;conf)\nif err != nil {\n    panic(err)\n}\n\nfmt.Printf(\"%+v\", conf)\n</code></pre>\n\n<p>And the output (try it on the <a href=\"https://play.golang.org/p/cZf52lpOF-\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>&amp;{S1: S2:file-s2 S3: S4:def S5:file-s5}\n</code></pre>\n\n<p>Analyzing the results:</p>\n\n<ul>\n<li><code>S1</code> was zero in default, was missing from file, result is zero</li>\n<li><code>S2</code> was zero in default, was given in file, result is the file value</li>\n<li><code>S3</code> was given in config, was overriden to be zero in file, result is zero</li>\n<li><code>S4</code> was given in config, was missing in file, result is the default value</li>\n<li><code>S5</code> was given in config, was given in file, result is the file value</li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1511197218, "post_id": 47397097, "comment_id": 81747592, "body": "In my example I showed <code>encoding&#47;json</code> handles properly when the file contains the zero value, and it will override the non-zero default value, and the result will be the zero value, as intended."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1511197498, "post_id": 47397097, "comment_id": 81747753, "body": "Yeah, I know @icza, your solution is great and I&#39;d recommend it. What I meant to add with my answer is that <i>in case they <b>cannot</b> use your solution</i>, maybe because they aren&#39;t loading the config from a json file or something, they could approach it differently."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 2, "last_activity_date": 1511196674, "creation_date": 1511196674, "answer_id": 47397097, "question_id": 47395430, "link": "https://stackoverflow.com/questions/47395430/merge-fields-two-structs-of-same-type/47397097#47397097", "title": "&quot;Merge&quot; fields two structs of same type", "body": "<blockquote>\n  <p>Another issue I see here is that checking for zero values may be\n  tricky: what if the overriding struct intends to override with a zero\n  value?</p>\n</blockquote>\n\n<p>In case you cannot utilize <code>encoding/json</code> as pointed out by <a href=\"https://stackoverflow.com/a/47396406/965900\">icza</a> or other format encoders that behave similarly you could use two separate types.</p>\n\n<pre><code>type Config struct {\n    Path string\n    Id   string\n    Key  string\n    Addr string\n    Size uint64\n}\n\ntype ConfigParams struct {\n    Path *string\n    Id   *string\n    Key  *string\n    Addr *string\n    Size *uint64\n}\n</code></pre>\n\n<p>Now with a function like this:</p>\n\n<pre><code>func merge(conf *Config, params *ConfigParams)\n</code></pre>\n\n<p>You could check for non-nil fields in <code>params</code> and dereference the pointer to set the value in the corresponding fields in <code>conf</code>. This allows you to unset fields in <code>conf</code> with non-nil zero value fields in <code>params</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1320, "user_id": 4359699, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d7433b53d461a631e4e1cda7017c28db?s=128&d=identicon&r=PG&f=1", "display_name": "hraban", "link": "https://stackoverflow.com/users/4359699/hraban"}, "is_accepted": false, "score": 0, "last_activity_date": 1611674034, "creation_date": 1611674034, "answer_id": 65903976, "question_id": 47395430, "link": "https://stackoverflow.com/questions/47395430/merge-fields-two-structs-of-same-type/65903976#65903976", "title": "&quot;Merge&quot; fields two structs of same type", "body": "<p>This solution won't work for your specific question, but it might help someone who has a similar-but-different problem:</p>\n<p>Instead of creating two separate structs to merge, you can have one &quot;default&quot; struct, and create a modifier function for it. So in your case:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>type Config struct {\n  path string\n  id   string\n  key  string\n  addr string\n  size uint64\n}\n\nvar defcfg = Config {\n  path: &quot;/foo&quot;,\n  id: &quot;default&quot;,\n  key: &quot;key&quot;,\n  addr: &quot;1.2.3.4&quot;,\n  size: 234,\n}\n</code></pre>\n<p>And your modifier function:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>func myCfg(c *Config) {\n  c.key = &quot;different key&quot;\n}\n</code></pre>\n<p>This works in tests where I want to test many small, different variations of a largely unmodified struct:</p>\n<pre><code>func TestSomething(t *testing.T) {\n  modifiers := []func (*Config){\n    .... // modifier functions here\n  }\n  for _, f := range modifiers {\n    tc := defcfg // copy\n    f(&amp;tc)\n    // now you can use tc.\n  }\n}\n</code></pre>\n<p>Not useful when you read your modified config from a file into a struct, though. On the plus side: this also works with zero values.</p>\n"}], "owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6153, "favorite_count": 3, "accepted_answer_id": 47396406, "answer_count": 4, "score": 14, "last_activity_date": 1611674034, "creation_date": 1511191578, "last_edit_date": 1511199577, "question_id": 47395430, "link": "https://stackoverflow.com/questions/47395430/merge-fields-two-structs-of-same-type", "title": "&quot;Merge&quot; fields two structs of same type", "body": "<p>Looking at this <code>struct</code>:</p>\n\n<pre><code>type Config struct {\n  path string\n  id   string\n  key  string\n  addr string\n  size uint64\n}\n</code></pre>\n\n<p>Now I have a <code>DefaultConfig</code> intialized with some values and one loaded from a file, let's say <code>FileConfig</code>.\nI want both structs to me merged, so that I get a <code>Config</code> with the content of both structs. <code>FileConfig</code> should override anything set in <code>DefaultConfig</code>, while <code>FileConfig</code> <strong>may not have all fields set</strong>.\n(Why this? Because a potential user may not know the default value, so removing that entry would be equivalent to setting the default - I think)</p>\n\n<p>I thought I'd need reflection for this:</p>\n\n<pre><code> func merge(default *Config, file *Config) (*Config) {\n  b := reflect.ValueOf(default).Elem()\n  o := reflect.ValueOf(file).Elem()\n\n  for i := 0; i &lt; b.NumField(); i++ {\n    defaultField := b.Field(i)\n    fileField := o.Field(i)\n    if defaultField.Interface() != reflect.Zero(fileField.Type()).Interface() {\n     defaultField.Set(reflect.ValueOf(fileField.Interface()))\n    }\n  }\n\n  return default\n }\n</code></pre>\n\n<p>Here I am not sure:</p>\n\n<ul>\n<li>If reflection is needed at all</li>\n<li>There may be easier ways to do this</li>\n</ul>\n\n<p>Another issue I see here is that checking for zero values may be tricky: what if the overriding struct <em>intends</em> to override with a zero value? Luckily, I don't think it applies to my case - but this becomes a function, it may become a problem later</p>\n"}, {"tags": ["http", "go", "upload", "progress"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1511191675, "post_id": 47395373, "comment_id": 81743960, "body": "I&#39;m not understanding the example, because you have a <code>file</code>, but you don&#39;t do anything with it. Don&#39;t you just use that file as the body for the <code>NewRequest</code>?"}, {"owner": {"reputation": 163, "user_id": 4069456, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/3U0vd.jpg?s=128&g=1", "display_name": "Thomas Szabo", "link": "https://stackoverflow.com/users/4069456/thomas-szabo"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511195614, "post_id": 47395373, "comment_id": 81746557, "body": "thanks @JimB, I just edited the example code. I missed adding <code>file.Read(buffer)</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1511195712, "post_id": 47395373, "comment_id": 81746615, "body": "Yes, but why not just pass <code>file</code> directly to <code>http.NewRequest</code>?"}, {"owner": {"reputation": 163, "user_id": 4069456, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/3U0vd.jpg?s=128&g=1", "display_name": "Thomas Szabo", "link": "https://stackoverflow.com/users/4069456/thomas-szabo"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511196211, "post_id": 47395373, "comment_id": 81746943, "body": "@JimB I only want to upload a range of bytes from a file. Not the whole file. That&#39;s why I am doing the <code>file.Seek(offset, 0)</code>. The function&#39;s arguments take an offset and a size. Size determines how many bytes should be read."}], "answers": [{"comments": [{"owner": {"reputation": 163, "user_id": 4069456, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/3U0vd.jpg?s=128&g=1", "display_name": "Thomas Szabo", "link": "https://stackoverflow.com/users/4069456/thomas-szabo"}, "edited": false, "score": 0, "creation_date": 1511199028, "post_id": 47397141, "comment_id": 81748680, "body": "Looks like what I need but in conjunction with the PUT upload, it gives me a <code>501 Not Implemented</code> server error. <code>&lt;Message&gt;A header you provided implies functionality that is not implemented&lt;&#47;Message&gt;&lt;Header&gt;Transfer-Encoding&lt;&#47;Header&gt;</code>. Any ideas what could be causing this?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 163, "user_id": 4069456, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/3U0vd.jpg?s=128&g=1", "display_name": "Thomas Szabo", "link": "https://stackoverflow.com/users/4069456/thomas-szabo"}, "edited": false, "score": 0, "creation_date": 1511199084, "post_id": 47397141, "comment_id": 81748716, "body": "@ThomasSzabo: does this happen to be from S3?"}, {"owner": {"reputation": 163, "user_id": 4069456, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/3U0vd.jpg?s=128&g=1", "display_name": "Thomas Szabo", "link": "https://stackoverflow.com/users/4069456/thomas-szabo"}, "edited": false, "score": 0, "creation_date": 1511199346, "post_id": 47397141, "comment_id": 81748855, "body": "exactly. I&#39;m trying to upload to S3 with a presigned URL"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 163, "user_id": 4069456, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/3U0vd.jpg?s=128&g=1", "display_name": "Thomas Szabo", "link": "https://stackoverflow.com/users/4069456/thomas-szabo"}, "edited": false, "score": 1, "creation_date": 1511199534, "post_id": 47397141, "comment_id": 81748939, "body": "@ThomasSzabo: S3 is odd (and non-compliant) in that it doesn&#39;t accept chunked encoding. Try setting <code>request.ContentLength = size</code>."}, {"owner": {"reputation": 163, "user_id": 4069456, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/3U0vd.jpg?s=128&g=1", "display_name": "Thomas Szabo", "link": "https://stackoverflow.com/users/4069456/thomas-szabo"}, "edited": false, "score": 0, "creation_date": 1511200016, "post_id": 47397141, "comment_id": 81749204, "body": "Oh wow! That fixed the 501 error. I tried it with <code>request.Header.Set(&quot;Content-Length&quot;, fmt.Sprintf(&quot;%d&quot;, size))</code> before but didn&#39;t worked."}, {"owner": {"reputation": 163, "user_id": 4069456, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/3U0vd.jpg?s=128&g=1", "display_name": "Thomas Szabo", "link": "https://stackoverflow.com/users/4069456/thomas-szabo"}, "edited": false, "score": 0, "creation_date": 1511200516, "post_id": 47397141, "comment_id": 81749464, "body": "what do you think of the accepted answer here: <a href=\"https://stackoverflow.com/questions/26050380/go-tracking-post-request-progress\" title=\"go tracking post request progress\">stackoverflow.com/questions/26050380/&hellip;</a>  Would that solve the progress reporting?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 163, "user_id": 4069456, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/3U0vd.jpg?s=128&g=1", "display_name": "Thomas Szabo", "link": "https://stackoverflow.com/users/4069456/thomas-szabo"}, "edited": false, "score": 0, "creation_date": 1511201094, "post_id": 47397141, "comment_id": 81749764, "body": "@ThomasSzabo: I missed that you wanted upload progress too, you basically have 2 completely separate questions here. Yes that answer shows the basis of what you need."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1511203436, "last_edit_date": 1511203436, "creation_date": 1511196791, "answer_id": 47397141, "question_id": 47395373, "link": "https://stackoverflow.com/questions/47395373/put-upload-a-files-byte-range-with-streams-and-progress/47397141#47397141", "title": "PUT upload a file&#39;s byte range with streams and progress", "body": "<p>You can use an <a href=\"https://golang.org/pkg/io/#LimitReader\" rel=\"nofollow noreferrer\"><code>io.LimitedReader</code></a> to wrap the file and only read the amount of data you want. The implementation returned by <a href=\"https://golang.org/pkg/io/#LimitReader\" rel=\"nofollow noreferrer\"><code>io.LimitReader</code></a> is an <code>*io.LimitedReader</code>.</p>\n\n<pre><code>file.Seek(int64(offset), 0)\nfileReader := io.LimitReader(file, size)\n\nrequest, err := http.NewRequest(http.MethodPut, uploadURL, fileReader)\n</code></pre>\n\n<p>And for S3 you will want to ensure that you don't use chunked encoding by explicitly setting the ContentLength:</p>\n\n<pre><code>request.ContentLength = size\n</code></pre>\n\n<p>As for upload progress, see: <a href=\"https://stackoverflow.com/questions/26050380/go-tracking-post-request-progress\">Go: Tracking POST request progress</a></p>\n"}], "owner": {"reputation": 163, "user_id": 4069456, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/3U0vd.jpg?s=128&g=1", "display_name": "Thomas Szabo", "link": "https://stackoverflow.com/users/4069456/thomas-szabo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 535, "favorite_count": 1, "accepted_answer_id": 47397141, "answer_count": 1, "score": 0, "last_activity_date": 1511203436, "creation_date": 1511191407, "last_edit_date": 1511195573, "question_id": 47395373, "link": "https://stackoverflow.com/questions/47395373/put-upload-a-files-byte-range-with-streams-and-progress", "title": "PUT upload a file&#39;s byte range with streams and progress", "body": "<p>I just got started with Go and need some help. I would like to upload a certain range of bytes from a file. </p>\n\n<p>I already accomplished this by reading the bytes into a buffer. But this increases memory usage.\nInstead of reading bytes into memory, I want to stream them while uploading and have an upload progress. I did something like this in Node.js but struggle to get the puzzle pieces together for Go.\nThe code that I have now looks like this:</p>\n\n<pre><code>func uploadChunk(id, mimeType, uploadURL, filePath string, offset, size uint) {\n    // open file\n    file, err := os.Open(filePath)\n    panicCheck(err, ErrorFileRead) // custom error handler\n    defer file.Close()\n\n    // move to the proper byte\n    file.Seek(int64(offset), 0)\n\n    // read byte chunk into buffer\n    buffer := make([]byte, size)\n    file.Read(buffer)\n    fileReader := bytes.NewReader(buffer)\n\n    request, err := http.NewRequest(http.MethodPut, uploadURL, fileReader)\n\n    client := &amp;http.Client{\n        Timeout: time.Second * 10,\n    }\n\n    response, err := client.Do(request)\n    panicCheck(err, ErrorFileRead)\n\n    defer response.Body.Close()\n\n    b, err := httputil.DumpResponse(response, true)\n    panicCheck(err, ErrorFileRead)\n    fmt.Println(\"response\\n\", string(b))\n}\n</code></pre>\n\n<p>Could you guys help me to figure out how to stream and get progress for an upload?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "automated-tests"], "comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1511200036, "post_id": 47394506, "comment_id": 81749220, "body": "Add <code>RegisterFailHandler(Fail)</code> above your <code>RunSpecs</code> call.  That tells Gomega to use Ginkgo&#39;s fail handler for failed assertions."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1511200204, "post_id": 47394506, "comment_id": 81749306, "body": "Also, for slices, it&#39;s generally better to use <code>ConsistOf</code> rather than <code>Equals</code>, unless the order of the slices is also an important quality of the slice."}], "owner": {"reputation": 1562, "user_id": 4303758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/nbL0i.jpg?s=128&g=1", "display_name": "Manjeet Thakur", "link": "https://stackoverflow.com/users/4303758/manjeet-thakur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 775, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1511189281, "creation_date": 1511188648, "last_edit_date": 1511189281, "question_id": 47394506, "link": "https://stackoverflow.com/questions/47394506/how-to-run-test-with-ginkgo-framwork-in-go", "title": "how to run test with ginkgo framwork in Go", "body": "<p>I am Learning Go and try to understand basics of Go. I have written function and now i want to test function with predefined test cases.</p>\n\n<p><a href=\"https://i.stack.imgur.com/0hznX.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/0hznX.png\" alt=\"enter image description here\"></a></p>\n\n<p>here is code  </p>\n\n<blockquote>\n  <p>filename is arr_test.go</p>\n</blockquote>\n\n<pre><code>package arr_test\n\nimport (\n\n    . \"github.com/onsi/ginkgo\"\n    . \"github.com/onsi/gomega\"\n    \"github.com/manjeettahkur/r_project/arr\"\n    \"testing\"\n)\n\nfunc TestSo(t *testing.T) {\n    RunSpecs(t, \"My Test Suite\")\n}\n\nvar _ = Describe(\"Array\", func() {\n    Context(\"i have no idea why is going here\", func() {\n        It(\"should be like this\", func() {\n            Expect(arr.ArrayExm([]int{1, 2, 3, 4}, 10)).To(Equal([]int{1,2,3,4,4,3,2,1,1,2}))\n        })\n    })\n\n})\n</code></pre>\n\n<blockquote>\n  <p>here is file where function is written  arr.go</p>\n</blockquote>\n\n<pre><code>package arr\n\nfunc ArrayExm(array []int, limit int) []int {\n    var res []int\n\n    length := len(array)\n\n    for i:=0; i &lt; limit; i++ {\n\n        if(i/length)%2 == 0{\n            res = append(res,array[i%length])\n\n        } else {\n            res = append(res, array[length -i % length - 1])\n        }\n    }\n\n    return res\n\n}\n</code></pre>\n\n<p>when i run test case i receive this error </p>\n\n<blockquote>\n  <p>Test Panicked\n      You are trying to make an assertion, but Gomega's fail handler is nil.\n      If you're using Ginkgo then you probably forgot to put your assertion in an It().\n      Alternatively, you may have forgotten to register a fail handler with RegisterFailHandler() or RegisterTestingT().</p>\n</blockquote>\n\n<p>can anyone help what i am doing wrong here.TIA</p>\n"}, {"tags": ["go", "goroutine", "panic"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1511189123, "post_id": 47394452, "comment_id": 81742279, "body": "Is the context your passing to Shutdown allowed to be <code>nil</code>?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511189260, "post_id": 47394452, "comment_id": 81742362, "body": ".. can&#39;t see anywhere in the source (<a href=\"https://github.com/golang/go/blob/master/src/net/http/server.go#L2514-L2538\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/master/src/net/http/&hellip;</a>) that <code>Shutdown</code> is safeguarding against a nil contenxt."}, {"owner": {"reputation": 2731, "user_id": 74361, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/adca63afb01fa2d56850114c337476fb?s=128&d=identicon&r=PG", "display_name": "Bart Silverstrim", "link": "https://stackoverflow.com/users/74361/bart-silverstrim"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511189574, "post_id": 47394452, "comment_id": 81742565, "body": "@mkopriva - I based the function on the accepted &quot;concrete example&quot; from this question, which used a nil: <a href=\"https://stackoverflow.com/questions/39320025/how-to-stop-http-listenandserve\" title=\"how to stop http listenandserve\">stackoverflow.com/questions/39320025/&hellip;</a> (Not commenting on how correct or incorrect it is, just stating why I was using it)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1511190079, "post_id": 47394452, "comment_id": 81742874, "body": "I understand, but the source makes it clear that methods are called on ctx without first checking if it&#39;s nil, so, as @Flimzy points out in his answer, use context.Background/TODO to fix your problem."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1511190524, "post_id": 47394452, "comment_id": 81743163, "body": "There&#39;s no reason for a nil context, and nothing should expect a nil context. If you need a context, always give it a value."}, {"owner": {"reputation": 2731, "user_id": 74361, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/adca63afb01fa2d56850114c337476fb?s=128&d=identicon&r=PG", "display_name": "Bart Silverstrim", "link": "https://stackoverflow.com/users/74361/bart-silverstrim"}, "edited": false, "score": 0, "creation_date": 1511213538, "post_id": 47394452, "comment_id": 81756502, "body": "For future reference in improving question-asking, what is wrong with the question that there are downvotes, if anyone cares to clarify?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511277565, "post_id": 47394452, "comment_id": 81786809, "body": "@BartSilverstrim: my guess is that those are probably RTFM votes. You found the exact line which was the problem yourself, but didn&#39;t try passing in the required argument. Otherwise I wouldn&#39;t worry about it here, the rest of the question is fine."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 4, "last_activity_date": 1511189560, "creation_date": 1511189560, "answer_id": 47394781, "question_id": 47394452, "link": "https://stackoverflow.com/questions/47394452/http-server-shutdown-causes-runtime-error/47394781#47394781", "title": "HTTP.Server Shutdown Causes Runtime Error", "body": "<p>Never use a <code>nil</code> context. Use either <a href=\"https://golang.org/pkg/context/#Background\" rel=\"nofollow noreferrer\"><code>context.Background()</code></a> or <a href=\"https://golang.org/pkg/context/#TODO\" rel=\"nofollow noreferrer\"><code>context.TODO()</code></a>.</p>\n"}], "owner": {"reputation": 2731, "user_id": 74361, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/adca63afb01fa2d56850114c337476fb?s=128&d=identicon&r=PG", "display_name": "Bart Silverstrim", "link": "https://stackoverflow.com/users/74361/bart-silverstrim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 609, "favorite_count": 0, "accepted_answer_id": 47394781, "answer_count": 1, "score": -2, "last_activity_date": 1511189560, "creation_date": 1511188416, "last_edit_date": 1511189491, "question_id": 47394452, "link": "https://stackoverflow.com/questions/47394452/http-server-shutdown-causes-runtime-error", "title": "HTTP.Server Shutdown Causes Runtime Error", "body": "<p>I have a goroutine written in Go 1.9.2 on darwin/amd64 that causes a runtime error: invalid memory address or nil pointer dereference. I think it's because of a race condition of some kind related to the order of routines exiting, but I'm not sure.</p>\n\n<p>There are several things the main application is doing, so I launched the webserver as a goroutine which then listens for an exit signal from the parent process and tries to shut everything down cleanly before returning.</p>\n\n<p>Here's the function:</p>\n\n<pre><code>// WebServer defines the handler endpoints and launches the web server listener\nfunc WebServer(wg *sync.WaitGroup) {\n\n    // Make sure the exit is noted\n    defer wg.Done()\n\n    // Endpoint, handler function\n    http.HandleFunc(\"/version\", WebShowVersion)\n\n    // Go forth and serve\n    // Define the server struct\n    srv := &amp;http.Server{Addr: \":8080\"}\n\n    // Now go serve\n    chnToLogger &lt;- \"Launching web server on port 8080\"\n    go func() {\n        err := srv.ListenAndServe()\n        if err != nil &amp;&amp;\n            err.Error() != \"http: Server closed\" {\n\n            // There...was an error\n            chnToLoggerError &lt;- \"Error launching web server: \" + err.Error()\n        }\n    }()\n\n    // Listen for a shutdown\n    for {\n        select {\n        case &lt;-chnQuitNow:\n\n            // Shut down the process\n            chnToLogger &lt;- \"Shutting down web server process\"\n            if err := srv.Shutdown(nil); err != nil {\n\n                // There was a problem shutting down gracefully\n                chnToLoggerError &lt;- \"Error shutting down web server: \" + err.Error()\n                return\n            }\n\n            // Done\n            chnToLogger &lt;- \"Web server has shut down now\"\n            return\n\n        default:\n            continue\n        }\n    }\n\n    // Done\n    return\n}\n</code></pre>\n\n<p>The panic states:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x28 pc=0x11f7e61]\n\ngoroutine 10 [running]:\nnet/http.(*Server).Shutdown(0xc420158000, 0x0, 0x0, 0x0, 0x0)\n    /usr/local/go/src/net/http/server.go:2506 +0x1b1\nmain.WebServer(0xc4200164a0)\n    /Users/me/go/src/testproj/webhandling.go:45 +0x146\ncreated by main.main\n    /Users/me/go/src/testproj/main.go:94 +0x3d6\n</code></pre>\n\n<p>The line 45 in webhandling.go is:</p>\n\n<pre><code>if err := srv.Shutdown(nil); err != nil {\n</code></pre>\n\n<p>While it's not consistent in being triggered, it does seem to only happen if I launch the program and use a web client to pull localhost:8080/version a few times, leading me to wonder if srv.Shutdown(nil) is trying to close a connection that has a reference but has exited already?</p>\n\n<p>1) Is it possible to get the server to shut down web server processes safely and completely before returning from the goroutine?</p>\n\n<p>2) What is causing the inconsistent runtime error to be triggered?</p>\n"}, {"tags": ["go", "keychain"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1511188259, "post_id": 47394279, "comment_id": 81741741, "body": "Yes, if you want a cert to be a CA, it&#39;s needs to have the <code>CA</code> flag and <code>KeyUsageCertSign</code>, so if you turn that off it worn&#39;t work like you say. What problem are you having exactly? Please create an <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> that explains your problem."}, {"owner": {"reputation": 13, "user_id": 5206578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb5df3007e5573071dade4ef7f860669?s=128&d=identicon&r=PG&f=1", "display_name": "StackingLua", "link": "https://stackoverflow.com/users/5206578/stackinglua"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1511188593, "post_id": 47394279, "comment_id": 81741977, "body": "Well instead of the chain i want to get like in google i get a single blank line instead. The code i use is the same as i have linked above. However i get a blank line when i set the ca to false. And i can&#39;t find out why."}, {"owner": {"reputation": 43, "user_id": 6821449, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f38d300ff92213c148f168b8dd4357b?s=128&d=identicon&r=PG&f=1", "display_name": "R.J.", "link": "https://stackoverflow.com/users/6821449/r-j"}, "edited": false, "score": 0, "creation_date": 1511354899, "post_id": 47394279, "comment_id": 81824343, "body": "please take a look at this example: <a href=\"https://stackoverflow.com/questions/42643048/signing-certificate-request-with-certificate-authority\" title=\"signing certificate request with certificate authority\">stackoverflow.com/questions/42643048/&hellip;</a>"}], "owner": {"reputation": 13, "user_id": 5206578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb5df3007e5573071dade4ef7f860669?s=128&d=identicon&r=PG&f=1", "display_name": "StackingLua", "link": "https://stackoverflow.com/users/5206578/stackinglua"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 113, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1511189343, "creation_date": 1511187872, "last_edit_date": 1511189343, "question_id": 47394279, "link": "https://stackoverflow.com/questions/47394279/how-can-i-create-a-chain-of-trust-in-go", "title": "How can i create a chain of trust in Go?", "body": "<p>So for a long while i have been trying to create a chain of trust in Go.\nI used this code to create the certificate <a href=\"https://golang.org/src/crypto/tls/generate_cert.go\" rel=\"nofollow noreferrer\">https://golang.org/src/crypto/tls/generate_cert.go</a>\nBut if i set the isCA to false the certificate file in the browser will be empty and my browser will display an error saying: SEC_ERROR_UNKNOWN_ISSUER. How can i specify where it should check the certificate?\nI looked at alot of examples but still don\u2019t really understand how it should work. I tried using my own generated server CA and pasted a random intermediate CA under it but it doesn\u2019t know where to check. I know it will deny the certificate, but i\u2019m just trying to understand how the chain works in Go. I don\u2019t know how to use a chain certificate in Go should i use the issuer in template or subject or aren\u2019t those important etc. Does anyone have a example or could point me in the right direction? Thanks.</p>\n\n<p>This is what i am trying to achieve (doesn\u2019t matter if the rootCA is self signed it\u2019s just for testing purposes)\n<a href=\"https://i.stack.imgur.com/FxmJ1.png\" rel=\"nofollow noreferrer\">Click for image</a></p>\n"}, {"tags": ["go", "cgo", "gccgo"], "comments": [{"owner": {"reputation": 159, "user_id": 3573024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d560ff0aeb4ce52219a166547fdb09?s=128&d=identicon&r=PG&f=1", "display_name": "mgagnon", "link": "https://stackoverflow.com/users/3573024/mgagnon"}, "edited": false, "score": 2, "creation_date": 1511182818, "post_id": 47390789, "comment_id": 81738143, "body": "C.GoString() take a C char array, but you pass a go string to it. I guess this will help you: <a href=\"https://stackoverflow.com/q/39023475/3573024\">stackoverflow.com/q/39023475/3573024</a>. (May be duplicate)"}, {"owner": {"reputation": 159, "user_id": 3573024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d560ff0aeb4ce52219a166547fdb09?s=128&d=identicon&r=PG&f=1", "display_name": "mgagnon", "link": "https://stackoverflow.com/users/3573024/mgagnon"}, "edited": false, "score": 0, "creation_date": 1511183379, "post_id": 47390789, "comment_id": 81738501, "body": "Also, if you absolutely need to use fixed char array in C, this may help more: <a href=\"https://stackoverflow.com/q/25327313/3573024\">stackoverflow.com/q/25327313/3573024</a>"}], "owner": {"reputation": 4554, "user_id": 501778, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/9c3a188a1a6116ee15bc9dda726ef19c?s=128&d=identicon&r=PG", "display_name": "Manu", "link": "https://stackoverflow.com/users/501778/manu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 186, "favorite_count": 0, "closed_date": 1511185421, "answer_count": 0, "score": 0, "last_activity_date": 1511188732, "creation_date": 1511176759, "last_edit_date": 1511188732, "question_id": 47390789, "link": "https://stackoverflow.com/questions/47390789/copy-contents-of-golang-structure-to-c-structure", "closed_reason": "Duplicate", "title": "Copy contents of GOLang Structure to C structure", "body": "<p>I want to copy contents of GOLang structure to C Structure. \nHere i want the populated GO Struct (type test struct) to be copied to C structure test_c.</p>\n\n<p>Have put the following logic. I have accessed C structure <strong>test_c</strong> in go file, as <strong>C.test_c</strong>, and tried to copy the content of <strong>test struct</strong> to C.test_c (p_c) by using C.GoString, but when ever i try to do this i get this error </p>\n\n<p>Can anyone let me know what is the mistake that am doing, is there a better method to achive the same ?</p>\n\n<pre><code>./go_structure.go:30: cannot use p_go.a (type string) as type *C.char in argument to _Cfunc_GoString\n./go_structure.go:30: cannot use _Cfunc_GoString(p_go.a) (type string) as type [10]C.uchar in assignment\n./go_structure.go:31: cannot use p_go.b (type string) as type *C.char in argument to _Cfunc_GoString\n./go_structure.go:31: cannot use _Cfunc_GoString(p_go.b) (type string) as type [10]C.uchar in assignment\n</code></pre>\n\n<p>Below is the code,</p>\n\n<blockquote>\n  <p>go_stucture.go</p>\n</blockquote>\n\n<p>package main</p>\n\n<pre><code>import (\n    /*\n        #include \"cmain.h\"\n    */\n    \"C\"\n    \"fmt\"\n    \"unsafe\"\n)\n\ntype test struct {\n    a string\n    b string\n}\n\nfunc main() {\n\n    var p_go test\n    var p_c C.test_c\n    p_go.a = \"ABCDEFGHIJ\"\n    p_go.b = \"QRSTUVXWYZ\"\n\n    //fmt.Println(unsafe.Sizeof(p_c.a))\n\n    fmt.Println(\"In GO code\\n\")\n    fmt.Println(\"GO code structure Member:a=%s\", p_go.a)\n    fmt.Println(\"GO code structure Member:b=%s\", p_go.b)\n\n    p_c.a = C.GoString(p_go.a)\n    p_c.b = C.GoString(p_go.b)\n\n    fmt.Println(\"Call C function by passing GO structure\\n\")\n    C.cmain((*C.test_c)(unsafe.Pointer(&amp;p_c)))\n}\n</code></pre>\n\n<blockquote>\n  <p>cmain.c</p>\n</blockquote>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include \"cmain.h\"\n#include \"_cgo_export.h\"\n\nvoid cmain(test_c *value) {\n    printf(\"Inside C code\\n\");\n    printf(\"C code structure Member:a=%s\\n\", value-&gt;a);\n    printf(\"C code structure Member:b=%s\\n\", value-&gt;b);\n}\n</code></pre>\n\n<blockquote>\n  <p>cmain.h</p>\n</blockquote>\n\n<pre><code>typedef struct {\n    unsigned char a[10];\n    unsigned char b[10];\n}test_c;\nvoid cmain(test_c* value);\n</code></pre>\n"}, {"tags": ["go", "mgo"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1511174936, "post_id": 47389815, "comment_id": 81733342, "body": "It may be you have multiple versions of <code>mgo</code> in your project. Can you can check and post your imports? And check your Go workspace if you have multiple version of <code>mgo</code>?"}, {"owner": {"reputation": 63, "user_id": 4550140, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-RRcQYB3DQ3w/AAAAAAAAAAI/AAAAAAAAA_Q/6KY4lastpeY/photo.jpg?sz=128", "display_name": "Shobhit Tyagi", "link": "https://stackoverflow.com/users/4550140/shobhit-tyagi"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1511178429, "post_id": 47389815, "comment_id": 81735439, "body": "@icza that was it. Feel so annoyed having spent so much time. Thanks a lot for your help. I ll mark this as answered"}], "answers": [{"comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1514892522, "post_id": 47391339, "comment_id": 83092574, "body": "Feel free to accept this answer then in order to prevent this question from showing up in the &quot;unanswered&quot; list."}], "tags": [], "owner": {"reputation": 63, "user_id": 4550140, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-RRcQYB3DQ3w/AAAAAAAAAAI/AAAAAAAAA_Q/6KY4lastpeY/photo.jpg?sz=128", "display_name": "Shobhit Tyagi", "link": "https://stackoverflow.com/users/4550140/shobhit-tyagi"}, "is_accepted": true, "score": 1, "last_activity_date": 1511178562, "creation_date": 1511178562, "answer_id": 47391339, "question_id": 47389815, "link": "https://stackoverflow.com/questions/47389815/extract-string-value-of-id-from-mgo-gridfile/47391339#47391339", "title": "Extract string value of Id from mgo GridFile", "body": "<p>Correct answer by @icza. I had 2 versions of mgo.</p>\n"}], "owner": {"reputation": 63, "user_id": 4550140, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-RRcQYB3DQ3w/AAAAAAAAAAI/AAAAAAAAA_Q/6KY4lastpeY/photo.jpg?sz=128", "display_name": "Shobhit Tyagi", "link": "https://stackoverflow.com/users/4550140/shobhit-tyagi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "accepted_answer_id": 47391339, "answer_count": 1, "score": 1, "last_activity_date": 1511189363, "creation_date": 1511173534, "last_edit_date": 1511189363, "question_id": 47389815, "link": "https://stackoverflow.com/questions/47389815/extract-string-value-of-id-from-mgo-gridfile", "title": "Extract string value of Id from mgo GridFile", "body": "<p>Being quite new to Go, I am having a hard time using mgo.\nI am using mgo to fetch files like this :</p>\n\n<pre><code>gridfs := db.GridFS(\"fs\")\nallFiles := gridfs.Find(nil).Iter()\n</code></pre>\n\n<p>And then I use the returned iterator like </p>\n\n<pre><code>        var f *mgo.GridFile\n        for gridfs.OpenNext(allFiles, &amp;f) {\n\n            //use f.Id()\n        }\n</code></pre>\n\n<p>I want to start using f.Id() as a String but I am unable to convert. One of the ways I found was by using <code>fileId := (f.Id().(bson.ObjectId)).Hex()</code> which just lets me compile but fails at runtime with the message <code>interface conversion: interface {} is bson.ObjectId, not bson.ObjectId</code></p>\n\n<p>Having spent a lot of time on this already, I am definitely open to changing the way I fetch the files if conversion is not possible using <code>GridFile</code>.\nI would appreciate any help with this. Thanks.</p>\n"}, {"tags": ["arrays", "go", "slice"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1511162557, "post_id": 47386732, "comment_id": 81726648, "body": "What exactly is unclear with the error messages printed by the compiler: strings and []bytes are different types and you cannot mix types in append. The second is even more fundamental. All this is explained much better in the Tour of Go than could be explained here."}, {"owner": {"reputation": 7705, "user_id": 1076743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/luioK.png?s=128&g=1", "display_name": "Sir", "link": "https://stackoverflow.com/users/1076743/sir"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1511162597, "post_id": 47386732, "comment_id": 81726666, "body": "I thought it was appending a byte array since i did convert it to a byte array..and seeing as my slice is bytes not a string. I don&#39;t fully understand why it couldn&#39;t append a byte array to a slice of bytes."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1511164846, "post_id": 47386732, "comment_id": 81727731, "body": "&quot; I don&#39;t fully understand why it couldn&#39;t append a byte array to a slice of bytes&quot;. Simply because <code>append</code> works typically like this <code>append([]T, T)</code>: You do not append a slice to a slice you append one or more elements to a slice. If you want to append each element of a slice use <code>...</code> which is explained very well in <a href=\"https://tour.golang.org/moretypes/15\" rel=\"nofollow noreferrer\">tour.golang.org/moretypes/15</a> ad the referenced <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">blog.golang.org/go-slices-usage-and-internals</a>."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1511164860, "post_id": 47386732, "comment_id": 81727736, "body": "There are no arrays in your example, only slices. Please read <a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">this</a>."}], "answers": [{"comments": [{"owner": {"reputation": 7705, "user_id": 1076743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/luioK.png?s=128&g=1", "display_name": "Sir", "link": "https://stackoverflow.com/users/1076743/sir"}, "edited": false, "score": 0, "creation_date": 1511162867, "post_id": 47386855, "comment_id": 81726779, "body": "Ah, so my attempt to append a byte array to a byte slice is not logical then ? I thought append would just attach the two together."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 7705, "user_id": 1076743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/luioK.png?s=128&g=1", "display_name": "Sir", "link": "https://stackoverflow.com/users/1076743/sir"}, "edited": false, "score": 0, "creation_date": 1511163423, "post_id": 47386855, "comment_id": 81727088, "body": "@Sir: See my revised answer."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1511163124, "last_edit_date": 1511163124, "creation_date": 1511162590, "answer_id": 47386855, "question_id": 47386732, "link": "https://stackoverflow.com/questions/47386732/how-to-append-byte-array-to-slice-of-bytes-in-go/47386855#47386855", "title": "How to append byte array to slice of bytes in Go", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    myString := \"Hello there\"\n    slice := make([]byte, 1, 1+len(myString))\n    slice[0] = byte(len(myString))\n    slice = append(slice, myString...)\n    fmt.Println(slice[0], string(slice[1:]))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>11 Hello there\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7705, "user_id": 1076743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/luioK.png?s=128&g=1", "display_name": "Sir", "link": "https://stackoverflow.com/users/1076743/sir"}, "edited": false, "score": 0, "creation_date": 1511162982, "post_id": 47386888, "comment_id": 81726843, "body": "Doesn&#39;t this add the length of string to the end of the slice not the start? I was trying to get it at the start :)"}, {"owner": {"reputation": 1276, "user_id": 6237232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/557d1078fe8ace9c1e6f88d275f5f32a?s=128&d=identicon&r=PG&f=1", "display_name": "RidgeA", "link": "https://stackoverflow.com/users/6237232/ridgea"}, "reply_to_user": {"reputation": 7705, "user_id": 1076743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/luioK.png?s=128&g=1", "display_name": "Sir", "link": "https://stackoverflow.com/users/1076743/sir"}, "edited": false, "score": 0, "creation_date": 1511163470, "post_id": 47386888, "comment_id": 81727113, "body": "Are you about \t<code>myString := &quot;Hello there&quot;; slice := make([]byte, 0, len(myString)+1)</code> ? This create slice with <i>length 0</i> and <i>capacity len(string) + 1</i>. This is small optimization to allocate all memory for slice that you will need to create byte array from string + first byte with string length."}], "tags": [], "owner": {"reputation": 1276, "user_id": 6237232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/557d1078fe8ace9c1e6f88d275f5f32a?s=128&d=identicon&r=PG&f=1", "display_name": "RidgeA", "link": "https://stackoverflow.com/users/6237232/ridgea"}, "is_accepted": false, "score": 0, "last_activity_date": 1511162724, "creation_date": 1511162724, "answer_id": 47386888, "question_id": 47386732, "link": "https://stackoverflow.com/questions/47386732/how-to-append-byte-array-to-slice-of-bytes-in-go/47386888#47386888", "title": "How to append byte array to slice of bytes in Go", "body": "<ol>\n<li>First of all you need to initialize slice with <code>make</code> function</li>\n<li>To add data to slice you should use <code>append</code> function</li>\n<li>To add elements from <code>[]byte</code> to <code>[]byte</code> you can use spread operator in <code>append</code> call.</li>\n<li>And finally you need to use result of calling <code>append</code> function</li>\n</ol>\n\n<p><a href=\"https://play.golang.org/p/CP18akKsCa\" rel=\"nofollow noreferrer\">https://play.golang.org/p/CP18akKsCa</a></p>\n"}], "owner": {"reputation": 7705, "user_id": 1076743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/luioK.png?s=128&g=1", "display_name": "Sir", "link": "https://stackoverflow.com/users/1076743/sir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7814, "favorite_count": 1, "closed_date": 1511164906, "accepted_answer_id": 47386855, "answer_count": 2, "score": 1, "last_activity_date": 1511189379, "creation_date": 1511162002, "last_edit_date": 1511189379, "question_id": 47386732, "link": "https://stackoverflow.com/questions/47386732/how-to-append-byte-array-to-slice-of-bytes-in-go", "closed_reason": "Duplicate", "title": "How to append byte array to slice of bytes in Go", "body": "<p>I have a simple bit of code that i am trying to understand, but am struggling to work out how to get it to work properly.</p>\n\n<p>The general idea is i want to pass some data, and convert it into a byte array. Then i want to apply the length of the byte array at the first index of my byte slice, then add the byte array to end of the slice.</p>\n\n<p>This is what it tried:</p>\n\n<pre><code>    var slice []byte\n    myString := \"Hello there\"\n\n    stringAsByteArray := []byte(myString) //convert my string to byte array\n\n\n    slice[0] = byte(len(stringAsByteArray)) //length of string as byte array\n\n    append(slice, stringAsByteArray) \n</code></pre>\n\n<p>So the idea is the first byte of <code>slice</code> contains the number of <code>len(b)</code> then following on from that, the actual string message as a series of bytes.</p>\n\n<p>But i get:</p>\n\n<pre><code>cannot use stringAsByteArray (type []byte) as type byte in append\nappend(slice, stringAsByteArray) evaluated but not used\n</code></pre>\n"}, {"tags": ["google-app-engine", "session", "go", "gorilla"], "comments": [{"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1511173914, "post_id": 47386440, "comment_id": 81732711, "body": "What exactly is broken? I&#39;m heating some weird bug with losing inserts that&#39;s done in cross-group transactions. Had not chance to create a minimized reproducible example and to fail a bug yet."}, {"owner": {"reputation": 367, "user_id": 1075283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f0c08aacf97ba9d099e8575212681d1a?s=128&d=identicon&r=PG", "display_name": "cheeze", "link": "https://stackoverflow.com/users/1075283/cheeze"}, "reply_to_user": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1511189681, "post_id": 47386440, "comment_id": 81742629, "body": "Sorry, should have been more clear. The session value that I set in the test could not be read from in the function handler. (Edited the original question with an example.)"}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1511190254, "post_id": 47386440, "comment_id": 81742993, "body": "What storage do you use to store sessions? cookies/datastore?"}, {"owner": {"reputation": 367, "user_id": 1075283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f0c08aacf97ba9d099e8575212681d1a?s=128&d=identicon&r=PG", "display_name": "cheeze", "link": "https://stackoverflow.com/users/1075283/cheeze"}, "reply_to_user": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1511190717, "post_id": 47386440, "comment_id": 81743299, "body": "Cookies. <code>store := sessions.NewCookieStore([]byte(&quot;secret&quot;))</code>"}, {"owner": {"reputation": 367, "user_id": 1075283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f0c08aacf97ba9d099e8575212681d1a?s=128&d=identicon&r=PG", "display_name": "cheeze", "link": "https://stackoverflow.com/users/1075283/cheeze"}, "reply_to_user": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1520703569, "post_id": 47386440, "comment_id": 85428586, "body": "I found some that with <code>go version 1.8.5 (appengine-1.9.65)</code> the <code>req</code> variable that represents the request has a different pointer address in the tests than what it has when passed to the middleware layer checking the user credentials.  With <code>go version 1.6.4 (appengine-1.9.54)</code>, the request has the same pointer address in both the tests and the middleware. I think that is causing the tests to fail, but I don&#39;t know the solution to it."}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1520848796, "post_id": 47386440, "comment_id": 85468093, "body": "I&#39;ve seen an open issue about this either on AppEngine or Gorilla repo."}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1520854476, "post_id": 47386440, "comment_id": 85471459, "body": "Check this issue: <a href=\"https://github.com/golang/appengine/issues/99\" rel=\"nofollow noreferrer\">github.com/golang/appengine/issues/99</a>"}, {"owner": {"reputation": 367, "user_id": 1075283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f0c08aacf97ba9d099e8575212681d1a?s=128&d=identicon&r=PG", "display_name": "cheeze", "link": "https://stackoverflow.com/users/1075283/cheeze"}, "reply_to_user": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1520911605, "post_id": 47386440, "comment_id": 85499267, "body": "Thanks @AlexanderTrakhimenok for the reply. Yes, the issue seems related. Unfortunately, after looking through the issue and the source code, I&#39;m still not sure of how to work around this specific issue of mine."}, {"owner": {"reputation": 367, "user_id": 1075283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f0c08aacf97ba9d099e8575212681d1a?s=128&d=identicon&r=PG", "display_name": "cheeze", "link": "https://stackoverflow.com/users/1075283/cheeze"}, "reply_to_user": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1522713708, "post_id": 47386440, "comment_id": 86247634, "body": "After some more investigation, I think it has to do with Gorilla MUX using the <code>contextSet()</code> selectively. Version 1.9.54 of the SDK is based on Go 1.6 which causes the <code>contextSet()</code> function from &quot;context_gorilla.go&quot; to be used. Version 1.9.65 of the SDK is based on Go 1.8 which causes the <code>contextSet()</code> function from &quot;context_native.go&quot; to be used. Unfortunately, I know the cause of the problem but not the solution :("}, {"owner": {"reputation": 367, "user_id": 1075283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f0c08aacf97ba9d099e8575212681d1a?s=128&d=identicon&r=PG", "display_name": "cheeze", "link": "https://stackoverflow.com/users/1075283/cheeze"}, "reply_to_user": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1522714108, "post_id": 47386440, "comment_id": 86247720, "body": "Filed an issue with <a href=\"https://github.com/gorilla/mux/issues/352\" rel=\"nofollow noreferrer\">Mux</a> with sample code to reproduce the issue."}], "owner": {"reputation": 367, "user_id": 1075283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f0c08aacf97ba9d099e8575212681d1a?s=128&d=identicon&r=PG", "display_name": "cheeze", "link": "https://stackoverflow.com/users/1075283/cheeze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1511190521, "creation_date": 1511160624, "last_edit_date": 1511190521, "question_id": 47386440, "link": "https://stackoverflow.com/questions/47386440/gorilla-sessions-break-in-app-engine-sdk-version-1-9-62", "title": "Gorilla Sessions Break in App Engine SDK version 1.9.62", "body": "<p>My unit tests for my API endpoints that checks for authentication via <em>Gorilla Sessions</em> fail when using the latest version of the App Engine SDK. i.e.</p>\n\n<pre><code>// app.go\nsession, _ := store.Get(req, \"login\")\n_, has := session.Values[\"userID\"] //value is set in app_test.go\n// has == false for v1.9.62 onwards, has == true for 1.9.57 and earlier\n</code></pre>\n\n<p>When I switch back to either 1.9.54 or 1.9.57, the tests pass. Nothing was changed in the source code, only the version of the SDK.</p>\n\n<p>I'm using App Engine SDK version 1.9.63 (the App Engine SDK, not the Cloud SDK) with Gorilla Sessions (latest version).</p>\n\n<p>Does anyone has any knowledge about version 1.9.6x of the App Engine SDK breaking Gorilla Sessions?</p>\n\n<p>P.S. Although the download page says the version 1.9.61 (and the downloaded zip file says likewise as well), when running the SDK, it reports as 1.9.63.</p>\n\n<p><code>\n$ goapp version\ngo version 1.8.3 (appengine-1.9.63) linux/amd64\n</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 9144, "user_id": 2431997, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xqDwU.jpg?s=128&g=1", "display_name": "ElmoVanKielmo", "link": "https://stackoverflow.com/users/2431997/elmovankielmo"}, "edited": false, "score": 0, "creation_date": 1511160447, "post_id": 47386317, "comment_id": 81725682, "body": "In the first call to sum(), you are passing a new array (result of a slice), so sum() doesn&#39;t have a reference to the original array and therefore can&#39;t change it."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 6143350, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/ee08b980f6af47fbf74145e23f4a43ba?s=128&d=identicon&r=PG&f=1", "display_name": "Mowen", "link": "https://stackoverflow.com/users/6143350/mowen"}, "edited": false, "score": 0, "creation_date": 1511218124, "post_id": 47387314, "comment_id": 81758592, "body": "Hmmm, most of this code is from the Tour of Go on the official site trying to explain hot to write goroutines and channels, some of the extra code is just me trying to get my head around how it is working. Looks like its time for me to spend more time reading about multi threading fundamentals."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 11, "user_id": 6143350, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/ee08b980f6af47fbf74145e23f4a43ba?s=128&d=identicon&r=PG&f=1", "display_name": "Mowen", "link": "https://stackoverflow.com/users/6143350/mowen"}, "edited": false, "score": 0, "creation_date": 1511240561, "post_id": 47387314, "comment_id": 81764547, "body": "@Mowen The part from the Tour is not the problem. The problem are your modifications which <i>introduce</i> races rendering the Tour&#39;s code invalid."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 1, "last_activity_date": 1511164411, "creation_date": 1511164411, "answer_id": 47387314, "question_id": 47386317, "link": "https://stackoverflow.com/questions/47386317/what-is-the-order-that-things-are-happening/47387314#47387314", "title": "What is the order that things are happening?", "body": "<blockquote>\n  <p>It prints out the first S[0] as 7 even though the function call before it should have modified it to 8, so I'm assuming that the goroutines hasn't run yet? </p>\n</blockquote>\n\n<p>Yes, this interpretation is correct. (But should <em>not</em> be made, see next section).</p>\n\n<blockquote>\n  <p>Then printing the entire array after the second goroutine function call prints it with all the modifications made during the first function call (modifying the first item to 8 and appending 20).</p>\n</blockquote>\n\n<p>NO. Never ever think along these lines.\nThe state of your application at this point is <em>not</em> well defined. 1) You started goroutines which modify the state and you have <em>absolutely</em> <em>no</em> synchronisation between the three goroutines (the main one and the two you started manually). 2) Your code is racy which means it is a) wrong, racy programs are <em>never</em> correct and b) results in undefined behaviour.</p>\n\n<blockquote>\n  <p>Yet the next 2 line print outs are the print outs of the slice segments from within the functions, which logically by the fact that I just said I saw the modifications done by the function call means they should have printed out BEFORE that line.</p>\n</blockquote>\n\n<p>More or less, if your program would not be racy (see above).</p>\n\n<p>Where is your code racy: the <code>main.s</code> is a slice with a backing array and you subslice it twice when starting the goroutines with <code>go sum(...)</code>. Both subslices share the <em>same</em> backing array. Now inside the goroutines you write ( <code>s[0]=8</code>) and append (<code>append(s, 20)</code>) to this subslice. From both goroutines without synchronisation. The first goroutine will fulfill this append using the large enough backing array which is concurrently used by the second goroutine.\nThis results in concurrent write without synchronisation to the fourth element of <code>main.s</code> which is racy and thus undefined.</p>\n\n<p>With reading twice from the channel (<code>&lt;-c, &lt;-c</code>) you introduce synchronisation between the two manually started goroutines and the main goroutine and your program returns to serial execution (but its state is still not welldefined as it is racy).\nThe Println statements you use to track what is going on are problematic too: These statements print stuff which is in a not well defined state because it is accessed concurrently from different goroutines; both may print arbitrary data.</p>\n\n<p>Summing up: You program is racy, its output is undefined, there is no \"reason\" or \"explanation\" why it prints what it prints, its pure chance.\nAlways try your code under the race detector (-race) and do not try to make up pseudo-explanations for racy code.</p>\n\n<p>How to fix: \nThe divide and conquer approach is nice and okay. What is dangerous and thus easy to get wrong (as it happened to you) is modifying the subslice inside the goroutine. While <code>s[0]=9</code>] is harmless in your case the append interferes badly with the shared backing array.\nDo not modify s inside the goroutine. If you must: Make sure you have a new backing array.</p>\n\n<p>(Do not try to mix slices and concurrency. Both have some subtleties, slices the shared backing array and concurrency the problem of undefined racy behaviour. Especially if you are new to all this. Learn one, then the other, then combine both.)</p>\n"}], "owner": {"reputation": 11, "user_id": 6143350, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/ee08b980f6af47fbf74145e23f4a43ba?s=128&d=identicon&r=PG&f=1", "display_name": "Mowen", "link": "https://stackoverflow.com/users/6143350/mowen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1511189657, "creation_date": 1511159953, "last_edit_date": 1511189657, "question_id": 47386317, "link": "https://stackoverflow.com/questions/47386317/what-is-the-order-that-things-are-happening", "title": "What is the order that things are happening?", "body": "<p>I started playing around with Go by going through the Tour of Go on the official site.</p>\n\n<p>I only have basic experience with programming but on coming up to the channels page I started to play around to try get my head around it and I've ended up quite confused.</p>\n\n<p>This is what I have the code as:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc sum(s []int, c chan int) {\n    sum := 0\n    s[0] = 8\n    s = append(s, 20)\n    fmt.Println(s)\n    for _, v := range s {\n        sum += v\n    }\n    c &lt;- sum // send sum to c\n}\n\nfunc main() {\n    s := []int{7, 2, 8, -9, 4, 0}\n\n    c := make(chan int)\n    go sum(s[:len(s)/2], c)\n    fmt.Println(s[0])\n    go sum(s[len(s)/2:], c)\n    fmt.Println(s)\n    x, y := &lt;-c, &lt;-c // receive from c\n\n    fmt.Println(x, y, x+y)\n\n    fmt.Println(s)\n}\n</code></pre>\n\n<p>And this is the result I get:</p>\n\n<pre><code>7\n[8 2 8 20 4 0]\n[8 2 8 20]\n[8 4 0 20]\n26 32 58\n[8 2 8 8 4 0]\n</code></pre>\n\n<p>I get that in creating a slice you get an underlying array with needed number underneath and passes a slice to a function and modifying an element modifying the underlying array but I'm not sure in what sort of order the goroutines are going.</p>\n\n<p>It prints out the first S[0] as 7 even though the function call before it should have modified it to 8, so I'm assuming that the goroutines hasn't run yet?\nThen printing the entire array after the second goroutine function call prints it with all the modifications made during the first function call (modifying the first item to 8 and appending 20).\nYet the next 2 line print outs are the print outs of the slice segments from within the functions, which logically by the fact that I just said I saw the modifications done by the function call means they should have printed out BEFORE that line. </p>\n\n<p>Then I'm not sure how it got the calculations or the final printout of the array.</p>\n\n<p>Can someone familiar with how Go operates explain what the logical progression of this code was?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 1, "creation_date": 1511157983, "post_id": 47385692, "comment_id": 81724802, "body": "Check ulimit, maxfiles, and somaxconn. Possibly system runs  out of limits resources."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1511160050, "post_id": 47385692, "comment_id": 81725544, "body": "I concur with Eugene: 1024 is a typical limit on the number of open files (which, on UNIX, also includes sockets) on a typical commodity Linux-based OS."}, {"owner": {"reputation": 4294, "user_id": 804409, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/52840f12b18e63af6e43815f5c678075?s=128&d=identicon&r=PG", "display_name": "omu_negru", "link": "https://stackoverflow.com/users/804409/omu-negru"}, "edited": false, "score": 0, "creation_date": 1511160069, "post_id": 47385692, "comment_id": 81725554, "body": "just a suggestion.. your use case can actually use channels without an issue instead of wait groups. That would also prevent any mangled/malformed string you might get as the output due to race conditions. Also, the handler is already handled inside a goroutine, to answer your question, so placing it inside another won&#39;t help"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1511161705, "post_id": 47385692, "comment_id": 81726233, "body": "If you&#39;re using Linux, the approach is to raise the so-called &quot;hard&quot; limit for the <code>nofile</code> parameter in the <code>&#47;etc&#47;security&#47;limits.conf</code> \u2014 setting it for the user and/or a group of user which includes the one used to run your server. Then, before starting the server, issue the <code>ulimit -n hard</code> in the shell\u2014to bring the current &quot;soft&quot; limit (which will have a sensible default, usually 1024, as was discussed) up to the &quot;hard&quot; one. The server spawned aftwerwards will inherit this setting and use it. Call <code>ulimit -n</code> or <code>ulimit -a</code> to see the current setting(s)."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1511161731, "post_id": 47385692, "comment_id": 81726246, "body": "Pass it the <code>-H</code> option to see the configured hard limit(s) as by default it displays the soft ones."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1511161889, "post_id": 47385692, "comment_id": 81726326, "body": "Once you have this sorted, I&#39;d recomment looking closely at the documentation on the <code>http.Transport</code> type, \u2014 at its knobs controlling keeping alive idle HTTP connections. By default, it keeps around 2 idle connections per destination host; you might want to tweak these settings: both the size of the idle connection pool and the timeout a connection is allowed to be kept there. This might improve your performance if you&#39;re pressing your HTTP peers sufficiently hard."}, {"owner": {"reputation": 13, "user_id": 3451713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b861022f62a9a44a070c17ae5a9006f4?s=128&d=identicon&r=PG&f=1", "display_name": "lambdaexpression", "link": "https://stackoverflow.com/users/3451713/lambdaexpression"}, "edited": false, "score": 0, "creation_date": 1511171550, "post_id": 47385692, "comment_id": 81731170, "body": "Thanks Eugene Lisitsky changing the limit worked. kostik will read up on http.transport."}, {"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 0, "creation_date": 1511174952, "post_id": 47385692, "comment_id": 81733354, "body": "@user3451713 I wonder what is the limit are you getting now?"}, {"owner": {"reputation": 13, "user_id": 3451713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b861022f62a9a44a070c17ae5a9006f4?s=128&d=identicon&r=PG&f=1", "display_name": "lambdaexpression", "link": "https://stackoverflow.com/users/3451713/lambdaexpression"}, "reply_to_user": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 1, "creation_date": 1511265402, "post_id": 47385692, "comment_id": 81778297, "body": "@biosckon Tested upto 10K concurrent requests and it worked fine. Surprisingly the memory used was only ~120 MB. However CPU was constantly at 50-60 %."}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 8968123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pDaik.jpg?s=128&g=1", "display_name": "stefany", "link": "https://stackoverflow.com/users/8968123/stefany"}, "is_accepted": false, "score": 1, "last_activity_date": 1511175495, "creation_date": 1511175495, "answer_id": 47390413, "question_id": 47385692, "link": "https://stackoverflow.com/questions/47385692/limited-concurrent-connections-in-go/47390413#47390413", "title": "Limited concurrent connections in Go", "body": "<p><strong>Q2: multiple response.WriteHeader calls:</strong>\nIf you don't set your headers go with do it for you. When you launch a go routine the servers sees that there is no header set yet, and then is sets automatically, but after that your go routine does it again.</p>\n\n<p><strong>Q1:The http connections get reset when number of concurrent threads go above 1000:</strong>\nGo routines are not system threads, that means you can run a more routines than threads your system usually can. In a worst case scenario your request run concurrently instead of parallel. I don't see anything wrong in your code, that makes me thing that there is the server you make the request throttling you and dropping your requests because you may exceed the max connection that server allow for one ip.</p>\n\n<p>And you can also modify <code>http.Transport</code> parameter in your request, (see <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">docs</a>) to see if this help your situation about memory consumption and concurrent connections.</p>\n\n<pre><code>tr := &amp;http.Transport{\n    MaxIdleConns:       10,\n    IdleConnTimeout:    30 * time.Second,\n    DisableCompression: true,\n}\nclient := &amp;http.Client{Transport: tr}\nresp, err := client.Get(\"https://example.com\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1511186821, "creation_date": 1511186821, "answer_id": 47393939, "question_id": 47385692, "link": "https://stackoverflow.com/questions/47385692/limited-concurrent-connections-in-go/47393939#47393939", "title": "Limited concurrent connections in Go", "body": "<p>An http handler is expected to run synchronously, because the return of the handler function signals the end of the request. Accessing the <code>http.Request</code> and <code>http.ResponseWriter</code> after the handler returns is not valid, so there is no reason to dispatch the handler in a goroutine. </p>\n\n<p>As the comments have noted, you can't open more file descriptors than the process ulimit allows. Besides increasing the ulimit appropriately, you should have a limit on the number of concurrent requests that can be dispatched at once. </p>\n\n<p>If you're making many connections to the same hosts, you should also adjust your <code>http.Transport</code> accordingly. The default idle connection per host is only 2, so if you need more than 2 concurrent connections to that host, the new connections won't be reused. See <a href=\"https://stackoverflow.com/questions/37774624/go-http-get-concurrency-and-connection-reset-by-peer/37813844#37813844\">Go http.Get, concurrency, and &quot;Connection reset by peer&quot;</a></p>\n\n<p>If you connect to many different hosts, setting <code>Transport.IdleConnTimeout</code> is a good idea to get rid of unused connections. </p>\n\n<p>And as always, on a long running service you will want to make sure that timeouts are set for everything, so that slow or broken connections don't hold unnecessary resources.</p>\n"}], "owner": {"reputation": 13, "user_id": 3451713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b861022f62a9a44a070c17ae5a9006f4?s=128&d=identicon&r=PG&f=1", "display_name": "lambdaexpression", "link": "https://stackoverflow.com/users/3451713/lambdaexpression"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9548, "favorite_count": 1, "accepted_answer_id": 47393939, "answer_count": 2, "score": 1, "last_activity_date": 1511189399, "creation_date": 1511156581, "last_edit_date": 1511189399, "question_id": 47385692, "link": "https://stackoverflow.com/questions/47385692/limited-concurrent-connections-in-go", "title": "Limited concurrent connections in Go", "body": "<p>I have the following basic http server in Go. For every incoming request it posts 5 outgoing http requests. Each of them roughly take 3-5 seconds. I am not able to achieve more than 200 requests/second on 8 gig Ram, quad core machine.</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"net/http\"\n    _\"net/url\"\n    //\"io/ioutil\"\n    \"time\"\n    \"log\"\n    \"sync\"\n    //\"os\"\n    \"io/ioutil\"\n)\n\n// Job holds the attributes needed to perform unit of work.\ntype Job struct {\n    Name  string\n    Delay time.Duration\n}\n\nfunc requestHandler(w http.ResponseWriter, r *http.Request) {\n    // Make sure we can only be called with an HTTP POST request.\n    fmt.Println(\"in request handler\")\n    if r.Method != \"POST\" {\n        w.Header().Set(\"Allow\", \"POST\")\n        w.WriteHeader(http.StatusMethodNotAllowed)\n        return\n    }\n\n    // Set name and validate value.\n    name := r.FormValue(\"name\")\n    if name == \"\" {\n        http.Error(w, \"You must specify a name.\", http.StatusBadRequest)\n        return\n    }\n\n    delay := time.Second * 0\n\n    // Create Job and push the work onto the jobQueue.\n    job := Job{Name: name, Delay: delay}\n    //jobQueue &lt;- job\n\n    fmt.Println(\"creating worker\")\n    result := naiveWorker(name, job)\n    fmt.Fprintf(w, \"your task %s has been completed ,here are the results : %s\", job.Name, result)\n\n}\n\nfunc naiveWorker(id string, job Job) string {\n    var wg sync.WaitGroup\n    responseCounter := 0;\n    totalBodies := \"\";\n    fmt.Printf(\"worker%s: started %s\\n\", id, job.Name)\n\n    var urls = []string{\n        \"https://someurl1\",\n        \"https://someurl2\",\n        \"https://someurl3\",\n        \"https://someurl4\",\n        \"https://someurl5\",\n    }\n\n    for _, url := range urls {\n        // Increment the WaitGroup counter.\n\n        wg.Add(1)\n        // Launch a goroutine to fetch the URL.\n        go func(url string) {\n\n            // Fetch the URL.\n            resp, err := http.Get(url)\n            if err != nil {\n                fmt.Printf(\"got an error\")\n                //  panic(err)\n\n            } else {\n                defer resp.Body.Close()\n                body, err := ioutil.ReadAll(resp.Body)\n                if err != nil {\n                    totalBodies += string(body)\n                }\n            }\n            responseCounter ++\n            // Decrement the counter when the goroutine completes.\n            defer wg.Done()\n\n        }(url)\n    }\n    wg.Wait()\n    fmt.Printf(\"worker%s: completed %s with %d calls\\n\", id, job.Name, responseCounter)\n    return totalBodies\n}\n\nfunc main() {\n    var (\n        port = flag.String(\"port\", \"8181\", \"The server port\")\n    )\n    flag.Parse()\n\n    // Start the HTTP handler.\n    http.HandleFunc(\"/work\", func(w http.ResponseWriter, r *http.Request) {\n        requestHandler(w, r)\n    })\n    log.Fatal(http.ListenAndServe(\":\" + *port, nil))\n}\n</code></pre>\n\n<p>I have the following questions:</p>\n\n<ol>\n<li><p>The http connections get reset when number of concurrent threads go above 1000. Is this acceptable/intended behaviour?</p></li>\n<li><p>if I write go requestHandler(w,r) instead of requestHandler(w,r)  I get\nhttp: multiple response.WriteHeader calls</p></li>\n</ol>\n"}, {"tags": ["mysql", "go", "gorp"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 8968766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90c19da4f05c245c1eb560a224958ea4?s=128&d=identicon&r=PG&f=1", "display_name": "M.S", "link": "https://stackoverflow.com/users/8968766/m-s"}, "edited": false, "score": 0, "creation_date": 1511167550, "post_id": 47386884, "comment_id": 81729016, "body": "I think is the mysql server side closed the timeout connections ,and go side not check the connection is whether alive , so the connection is not closed until to socket leak."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 0, "last_activity_date": 1511162692, "creation_date": 1511162692, "answer_id": 47386884, "question_id": 47384458, "link": "https://stackoverflow.com/questions/47384458/go-use-connection-pool-connect-mysql-occured-socket-leak/47386884#47386884", "title": "go use connection pool connect mysql occured socket leak", "body": "<p>(Not an answer, but too much for a comment.)</p>\n\n<p>Two things:</p>\n\n<ol>\n<li><p>Please try to come up with an <a href=\"https://stackoverflow.com/help/mcve\">MCVE</a>\u2014first for yourself and second (if that alone won't help you solve your problem)\u2014for us.</p>\n\n<p>What I mean, is that there's too much going on in your example: you're using <code>gorp</code> which is not a part of the Go standard library, and this package\u2014which supposedly wraps <code>database/sql</code> machinery\u2014<em>can do absolutely anything</em> when working with the database.</p>\n\n<p>That's not how such problems are approached.\nInstead, you should start from the ground up and first use\nplain <code>database/sql</code> layer and see whether it works.\nIf it does, the problem is with that <code>gorp</code> thing.</p>\n\n<p>Another, however minor, detail is that you should not use\n3rd-party packages to do trivial stuff in your MCVEs;\nhere, I'm talking about logging: in a stripped down example,\nthe standard <code>fmt.Print*</code> functions would be just OK, or,\nif you feel like it's impossible to go full-on-Enterprise-y,\nthe standard <code>log</code> package would fill the bill.</p></li>\n<li><p>The SQL database layer in Go is explicitly designed to\nhave the semantics which are quite unlike the SQL database layers\nimplemented by other popular languages / frameworks.</p>\n\n<p>The Go's is different in that it was designed to handle <em>massive</em>\nworkloads typically generated on the server software.\nAmong other things, it means that</p>\n\n<ul>\n<li>Database connections are pooled by default.</li>\n<li>They are reused as needed, and when you execute a query or\na statement which is not in a transaction, you don't know whether\nthis will create a new connection or reuse an existing one,\nand if yes, then which one exactly.</li>\n<li>New connections do not actually <em>connect</em> unless something\nis executed on them (or their <code>Ping()</code> method is called).</li>\n</ul></li>\n</ol>\n"}], "owner": {"reputation": 1, "user_id": 8968766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90c19da4f05c245c1eb560a224958ea4?s=128&d=identicon&r=PG&f=1", "display_name": "M.S", "link": "https://stackoverflow.com/users/8968766/m-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 598, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1511162692, "creation_date": 1511146640, "last_edit_date": 1511151259, "question_id": 47384458, "link": "https://stackoverflow.com/questions/47384458/go-use-connection-pool-connect-mysql-occured-socket-leak", "title": "go use connection pool connect mysql occured socket leak", "body": "<h3>go verison 1.9.2</h3>\n\n<h3>go-sql-driver/mysql git commit hash cd4cb90</h3>\n\n<h3>mysql server version: 5.6.15-log MySQL Community Server</h3>\n\n<h3>os version:CentOS release 6.7 (Final)</h3>\n\n<h3>db open config</h3>\n\n<p>max_idle_conns = 5</p>\n\n<p>max_open_conns = 30</p>\n\n<p>max_life_time=600</p>\n\n<p>timeout=600</p>\n\n<h3>mysql config</h3>\n\n<pre><code>+-----------------------------+----------+\n| Variable_name               | Value    |\n+-----------------------------+----------+\n| connect_timeout             | 60       |\n| delayed_insert_timeout      | 300      |\n| interactive_timeout         | 600      |\n| lock_wait_timeout           | 31536000 |\n| log_output                  | FILE     |\n| net_read_timeout            | 30       |\n| net_write_timeout           | 60       |\n| wait_timeout                | 600      |\n+-----------------------------+----------+\n</code></pre>\n\n<h3>lsof output</h3>\n\n<p>srv_promo 12672 root   10u  sock      0,6      0t0 63382668 can't identify protocol</p>\n\n<p>srv_promo 12672 root   11u  sock      0,6      0t0 63366850 can't identify protocol</p>\n\n<p>srv_promo 12672 root   12u  sock      0,6      0t0 63366688 can't identify protocol</p>\n\n<p>srv_promo 12672 root   13u  sock      0,6      0t0 63366690 can't identify protocol</p>\n\n<p><a href=\"https://i.stack.imgur.com/vFvxf.png\" rel=\"nofollow noreferrer\">mysql config</a></p>\n\n<p><a href=\"https://i.stack.imgur.com/Hw6d4.png\" rel=\"nofollow noreferrer\">lsof output</a></p>\n\n<h3>below is code:</h3>\n\n<p>package dbtest</p>\n\n<pre><code>import (\n    \"database/sql\"\n    \"fmt\"\n    \"github.com/golang/glog\"\n    \"gopkg.in/gorp.v2\"\n    \"log\"\n    \"os\"\n    \"sync\"\n    \"time\"\n)\n\ntype DatabaseConfig struct {\n    DBName               string `toml:\"dbname\"`\n    Host                 string `toml:\"host\"`\n    Port                 int    `toml:\"port\"`\n    User                 string `toml:\"user\"`\n    Password             string `toml:\"password\"`\n    Sslmode              string `toml:\"sslmode\"`\n    ShowLog              bool\n    DataSaveDir          string\n    DataFileSaveLoopSize int\n    MaxIdleConns         int `toml:\"max_idle_conns\"`\n    MaxOpenConns         int `toml:\"max_open_conns\"`\n    MaxLifeTime          int `toml:\"max_life_time\"`\n    Timeout              int `toml:\"timeout\"`\n    RTimeout             int `toml:\"rtimeout\"`\n    WTimeout             int `toml:\"wtimeout\"`\n}\n\nfunc (c DatabaseConfig) MySQLSource() string {\n    params := make(map[string]string, 0)\n    params[\"charset\"] = \"utf8mb4\"\n    cfg := mysql.Config{}\n    cfg.User = c.User\n    cfg.Passwd = c.Password\n    cfg.DBName = c.DBName\n    cfg.ParseTime = true\n    cfg.Collation = \"utf8mb4_unicode_ci\"\n    cfg.Params = params\n    cfg.Loc, _ = time.LoadLocation(\"Asia/Chongqing\")\n    cfg.Timeout = time.Duration(c.Timeout) * time.Second\n    cfg.MultiStatements = true\n    cfg.ReadTimeout = time.Duration(c.RTimeout) * time.Second\n    cfg.WriteTimeout = time.Duration(c.WTimeout) * time.Second\n    return cfg.FormatDSN()\n}\n\nvar (\n    dbmap     *gorp.DbMap\n    Dbm       *gorp.DbMap\n    config    DatabaseConfig\n    opened    bool\n    openMutex sync.RWMutex\n    DB        *sql.DB\n)\n\n//Open open the database for passport with config\nfunc Open(cfg DatabaseConfig) {\n    if !opened {\n        config = cfg\n        db, err := sql.Open(\"mysql\", config.MySQLSource())\n        glog.Infof(\"open err %v \", err)\n        if err != nil {\n            panic(fmt.Errorf(\"sql.Open failed: %v\", err))\n        }\n        if config.MaxLifeTime &gt; 0 {\n            db.SetConnMaxLifetime(time.Duration(config.MaxLifeTime) * time.Second)\n        }\n        db.SetMaxIdleConns(config.MaxIdleConns)\n        db.SetMaxOpenConns(config.MaxOpenConns)\n        db.Ping()\n        DB = db\n        // construct a gorp DbMap\n        dbmap = &amp;gorp.DbMap{Db: db, Dialect: gorp.MySQLDialect{\"InnoDB\", \"utf8mb4\"}}\n        Dbm = dbmap\n\n        err = dbmap.CreateTablesIfNotExists()\n        if err != nil {\n            panic(\"create table failed \" + err.Error())\n        }\n        openMutex.Lock()\n        opened = true\n        openMutex.Unlock()\n        if config.ShowLog {\n            dbmap.TraceOn(\"[gorp]\", log.New(os.Stdout, schemaName+\" \", log.Lmicroseconds))\n        }\n    }\n}\n\n//Close close the database for passport\nfunc Close() {\n    if dbmap != nil &amp;&amp; opened {\n        glog.Infof(\"close database %s for %s\", config.DBName, schemaName)\n        dbmap.Db.Close()\n        openMutex.Lock()\n        opened = false\n        openMutex.Unlock()\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 956, "user_id": 6402561, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/1aa8dd9d8c878efcce8226aab763c0d7?s=128&d=identicon&r=PG&f=1", "display_name": "a person", "link": "https://stackoverflow.com/users/6402561/a-person"}, "edited": false, "score": 0, "creation_date": 1511135303, "post_id": 47383268, "comment_id": 81719233, "body": "Thanks!  Also, I figure I&#39;d ask this too - any idea how to convert a time.duration to int?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 956, "user_id": 6402561, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/1aa8dd9d8c878efcce8226aab763c0d7?s=128&d=identicon&r=PG&f=1", "display_name": "a person", "link": "https://stackoverflow.com/users/6402561/a-person"}, "edited": false, "score": 0, "creation_date": 1511135366, "post_id": 47383268, "comment_id": 81719245, "body": "Use a <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">type conversion</a> to convert a duration to an int: int(d)"}, {"owner": {"reputation": 956, "user_id": 6402561, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/1aa8dd9d8c878efcce8226aab763c0d7?s=128&d=identicon&r=PG&f=1", "display_name": "a person", "link": "https://stackoverflow.com/users/6402561/a-person"}, "edited": false, "score": 0, "creation_date": 1511135445, "post_id": 47383268, "comment_id": 81719263, "body": "ah i see.  Thank you!"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1511178261, "post_id": 47383268, "comment_id": 81735344, "body": "Generally you should <i>not</i> convert a duration to an <code>int</code>. A duration is an <code>int64</code>, converting to an <code>int</code> will almost always be meaningless. If what you want is the number of seconds, you should use <code>int(dur &#47; time.Second)</code>. This is the <a href=\"https://golang.org/pkg/time/#Duration\" rel=\"nofollow noreferrer\">suggested approach</a>."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1511135223, "creation_date": 1511135223, "answer_id": 47383268, "question_id": 47383242, "link": "https://stackoverflow.com/questions/47383242/go-setting-time-ie-2-weeks-1-month-1-year-etc/47383268#47383268", "title": "Go setting time ie. 2 weeks, 1 month, 1 year, etc", "body": "<p>Use <a href=\"https://godoc.org/time#Time.AddDate\" rel=\"nofollow noreferrer\">AddDate</a></p>\n\n<pre><code> twoWeeksFromNow := time.Now().AddDate(0, 0, 14)\n oneMonthFromNow := time.Now().AddDate(0, 1, 0)\n oneYearFromNow := time.Now().AddDate(1, 0, 0)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1511178131, "creation_date": 1511178131, "answer_id": 47391222, "question_id": 47383242, "link": "https://stackoverflow.com/questions/47383242/go-setting-time-ie-2-weeks-1-month-1-year-etc/47391222#47391222", "title": "Go setting time ie. 2 weeks, 1 month, 1 year, etc", "body": "<p>This is what the <a href=\"https://golang.org/pkg/time/#Duration\" rel=\"nofollow noreferrer\">Duration</a> type is for, along with its predefined constants.</p>\n\n<p>Although be aware that it doesn't always handle days gracefully, due to timezone and daylight savings time changes, etc.  If you're okay with that, do something like:</p>\n\n<pre><code>maxAge := days * 24 * time.Hour\n</code></pre>\n\n<p>To add this to the current time, you can use <a href=\"https://golang.org/pkg/time/#Time.Add\" rel=\"nofollow noreferrer\">Add</a>:</p>\n\n<pre><code>deadline := time.Now().Add(maxAge)\n</code></pre>\n"}], "owner": {"reputation": 956, "user_id": 6402561, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/1aa8dd9d8c878efcce8226aab763c0d7?s=128&d=identicon&r=PG&f=1", "display_name": "a person", "link": "https://stackoverflow.com/users/6402561/a-person"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 47383268, "answer_count": 2, "score": 2, "last_activity_date": 1511189418, "creation_date": 1511134988, "last_edit_date": 1511189418, "question_id": 47383242, "link": "https://stackoverflow.com/questions/47383242/go-setting-time-ie-2-weeks-1-month-1-year-etc", "title": "Go setting time ie. 2 weeks, 1 month, 1 year, etc", "body": "<p>I am still fairly new to Go and I'm refactoring a bunch of my existing code.  In a lot of places, I have used <code>86400 * { days }</code> for setting things like MaxAge, etc.</p>\n\n<p>Is there a more intuitive way to set these?  I have a lot more use cases now where I need to use time validations and things, but I am wondering how to do something like time in 2 standard weeks, or time in 6 standard months, etc. </p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "struct"], "answers": [{"tags": [], "owner": {"reputation": 928, "user_id": 4178151, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Mc3LvwUnV7I/AAAAAAAAAAI/AAAAAAAAAEY/xWbiW0DzNao/photo.jpg?sz=128", "display_name": "nikkon226", "link": "https://stackoverflow.com/users/4178151/nikkon226"}, "is_accepted": true, "score": 2, "last_activity_date": 1511129892, "creation_date": 1511129892, "answer_id": 47382602, "question_id": 47382490, "link": "https://stackoverflow.com/questions/47382490/unable-to-set-the-property-of-a-struct/47382602#47382602", "title": "Unable to set the property of a struct", "body": "<p>It's because you need to make the methods work off of a pointer to the variable and not a copy. Currently each method only uses a copy of the original (which is blank) to run the method. Below will work.</p>\n\n<pre><code>// src/db/db.go\npackage db\n\ntype DB struct {\n  pk string\n}\n// Use the pointer back to the object\nfunc (db *DB) SetPk(s string)  {\n  db.pk = s\n}\n// Use the pointer back to the object\nfunc (db *DB) GetPk() string {\n  return db.pk\n}\n</code></pre>\n"}], "owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "closed_date": 1511130471, "accepted_answer_id": 47382602, "answer_count": 1, "score": -1, "last_activity_date": 1511129892, "creation_date": 1511129157, "last_edit_date": 1511129882, "question_id": 47382490, "link": "https://stackoverflow.com/questions/47382490/unable-to-set-the-property-of-a-struct", "closed_reason": "Duplicate", "title": "Unable to set the property of a struct", "body": "<p>I'm trying to learn how to use structs in go.</p>\n\n<p>I have the following package</p>\n\n<pre><code>// src/db/db.go\npackage db\n\ntype DB struct {\n  pk string\n}\n\nfunc (db DB) SetPk(s string)  {\n  db.pk = s\n}\nfunc (db DB) GetPk() string {\n  return db.pk\n}\n</code></pre>\n\n<p>And this is my main.go</p>\n\n<pre><code>package main\n\nimport (\n  \"log\"\n  \"db\"\n)\n\nfunc main() {\n\n  d := db.DB{}\n  d.SetPk(\"Hello World\")\n  log.Println(d.GetPk())\n\n}\n</code></pre>\n\n<p>When I run the command <code>go run main.go</code>, I get a line break in my command prompt.  I verified that both the SetPk and GetPk are being fired, and that the SetPk is assigning a value to db.pk.  But the moment GetPk is fired, db.pk is empty again.</p>\n\n<p>How do I get the db object to retain the pk value and return it in GetPk?</p>\n"}, {"tags": ["go", "cryptography", "base64"], "answers": [{"tags": [], "owner": {"reputation": 345, "user_id": 6123704, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e20c7424a7c984940268f4d65aa4aa74?s=128&d=identicon&r=PG", "display_name": "Florian Harwoeck", "link": "https://stackoverflow.com/users/6123704/florian-harwoeck"}, "is_accepted": true, "score": 9, "last_activity_date": 1511129657, "creation_date": 1511129657, "answer_id": 47382570, "question_id": 47382035, "link": "https://stackoverflow.com/questions/47382035/unable-to-decrypt-after-aes-gcm-base64-in-go/47382570#47382570", "title": "Unable to decrypt after AES-GCM + Base64 in Go", "body": "<p>Someone from the GopherSlack community came up with the solution:</p>\n\n<p><code>StdEncoding</code> pads it's results which in this case caused decryption problems when (during the encryption process) padding the output was necessary. Therefore you should use <code>RawStdEncoding</code> in this example.</p>\n\n<p>Thanks for the help! :)</p>\n"}, {"tags": [], "owner": {"reputation": 923, "user_id": 6641744, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EkDJp.jpg?s=128&g=1", "display_name": "dpolicastro", "link": "https://stackoverflow.com/users/6641744/dpolicastro"}, "is_accepted": false, "score": 0, "last_activity_date": 1614392170, "creation_date": 1614392170, "answer_id": 66394993, "question_id": 47382035, "link": "https://stackoverflow.com/questions/47382035/unable-to-decrypt-after-aes-gcm-base64-in-go/66394993#66394993", "title": "Unable to decrypt after AES-GCM + Base64 in Go", "body": "<p>I was getting the same error, it just worked when I passed the nonce as the first argument to Seal.</p>\n<pre class=\"lang-golang prettyprint-override\"><code>ciphertext := c.aesGCM.Seal(nonce, nonce, plaintext, nil)\n</code></pre>\n"}], "owner": {"reputation": 345, "user_id": 6123704, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e20c7424a7c984940268f4d65aa4aa74?s=128&d=identicon&r=PG", "display_name": "Florian Harwoeck", "link": "https://stackoverflow.com/users/6123704/florian-harwoeck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4583, "favorite_count": 3, "accepted_answer_id": 47382570, "answer_count": 2, "score": 7, "last_activity_date": 1614392170, "creation_date": 1511125822, "question_id": 47382035, "link": "https://stackoverflow.com/questions/47382035/unable-to-decrypt-after-aes-gcm-base64-in-go", "title": "Unable to decrypt after AES-GCM + Base64 in Go", "body": "<h1>Situation</h1>\n\n<p>I'm trying to implement a structure (the <code>CryptoService</code>) hiding en/decryption from the main program flow. I have implemented \"normal\" functions and base64 variants that should encode the cipher to it's base64 equivalent and visa-versa in decryption. This is done because our internal network protocol uses line-feed <code>\\n</code> as delimiter.</p>\n\n<p><em>See code of implementation below</em></p>\n\n<h1>Problem</h1>\n\n<p>After writing the code below i started testing it. At first it went well and en- and decryption worked but soon I started noticing \"randomly occurring\" errors during the decryption process: <code>cipher: message authentication failed</code>. Now the important fact: the errors <strong>ONLY</strong> returned from the <code>DecryptBase64</code> func. But the base64 usage in go is pretty straight-forward and not much to worry about so I don't have any idea where the problems lies.</p>\n\n<h1>Code</h1>\n\n<p>Below you see the code for my <code>CryptoService</code> implementation and the associated test file. I have tried to clean the code up as much as possible (remove comments, additional input checks, etc.) without removing context. Nevertheless it's much code so thanks to all that read it - really appreciate your help!</p>\n\n<p><strong><code>cryptoservice.go</code></strong></p>\n\n<pre><code>type CryptoService struct {\n    gcm cipher.AEAD\n}\n\nfunc NewCryptoService(key []byte) (cs *CryptoService, err error) {\n    block, err := aes.NewCipher(key)\n    if err != nil {\n        return nil, err\n    }\n    gcm, err := cipher.NewGCM(block)\n    if err != nil {\n        return nil, err\n    }\n    return &amp;CryptoService{\n        gcm: gcm,\n    }, nil\n}\n\nfunc (cs CryptoService) Encrypt(plain []byte) (cipher []byte, err error) {\n    nonce := make([]byte, cs.gcm.NonceSize())\n    _, err = io.ReadFull(rand.Reader, nonce)\n    if err != nil {\n        return nil, err\n    }\n\n    cipher = cs.gcm.Seal(nil, nonce, plain, nil)\n    cipher = append(nonce, cipher...)\n\n    return cipher, nil\n}\n\nfunc (cs CryptoService) EncryptBase64(plain []byte) (base64Cipher []byte, err error) {\n    cipher, err := cs.Encrypt(plain)\n    if err != nil {\n        return nil, err\n    }\n\n    base64Cipher = make([]byte, base64.StdEncoding.EncodedLen(len(cipher)))\n    base64.StdEncoding.Encode(base64Cipher, cipher)\n\n    return\n}\n\nfunc (cs CryptoService) Decrypt(cipher []byte) (plain []byte, err error) {\n    nonce := cipher[0:cs.gcm.NonceSize()]\n    ciphertext := cipher[cs.gcm.NonceSize():]\n\n    plain, err = cs.gcm.Open(nil, nonce, ciphertext, nil)\n    if err != nil {\n        return nil, err\n    }\n\n    return\n}\n\nfunc (cs CryptoService) DecryptBase64(base64Cipher []byte) (plain []byte, err error) {\n    cipher := make([]byte, base64.StdEncoding.DecodedLen(len(base64Cipher)))\n    _, err = base64.StdEncoding.Decode(cipher, base64Cipher)\n    if err != nil {\n        return nil, err\n    }\n\n    return cs.Decrypt(cipher)\n}\n</code></pre>\n\n<p><strong><code>cryptoservice_test.go</code></strong></p>\n\n<ul>\n<li><code>TestCryptoService_EncryptDecryptRoundtrip</code> works fine</li>\n<li><code>TestCryptoService_EncryptBase64DecryptBase64Roundtrip</code> fails \"sometimes\" (also note that it doesn't always fail on the same test-cases)</li>\n</ul>\n\n<p>Additional info: The <code>FastRandomString(n int)</code> func in the Dynamic-Test-Case creation is effectively only a copy-and-past from the accepted answer at: <a href=\"https://stackoverflow.com/questions/22892120/how-to-generate-a-random-string-of-a-fixed-length-in-golang\">How to generate a random string of a fixed length in golang?</a></p>\n\n<pre><code>func TestCryptoService_EncryptDecryptRoundtrip(t *testing.T) {\n    tests := []struct {\n        name   string\n        aeskey string\n        text   string\n    }{\n        {\"Simple 1\", \"c4cc0dfc4ae0e45c045727f84ffd373127453bc232230bf1386972ac692436c1\", \"Text\"},\n        {\"Simple 2\", \"c4cc0dfc4ae0e45c045727f84ffd373127453bc232230bf1386972ac692436c1\", \"Some random content\"},\n        {\"Simple 3\", \"c4cc0dfc4ae0e45c045727f84ffd373127453bc232230bf1386972ac692436c1\", \"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.\"},\n\n        {\"Dynamic 1\", \"c4cc0dfc4ae0e45c045727f84ffd373127453bc232230bf1386972ac692436c1\", FastRandomString(32)},\n        {\"Dynamic 2\", \"c4cc0dfc4ae0e45c045727f84ffd373127453bc232230bf1386972ac692436c1\", FastRandomString(1024)},\n        {\"Dynamic 3\", \"c4cc0dfc4ae0e45c045727f84ffd373127453bc232230bf1386972ac692436c1\", FastRandomString(1024 * 64)},\n        {\"Dynamic 4\", \"c4cc0dfc4ae0e45c045727f84ffd373127453bc232230bf1386972ac692436c1\", FastRandomString(1024 * 256)},\n    }\n    for _, tt := range tests {\n        t.Run(tt.name, func(t *testing.T) {\n            for i := 0; i &lt; 1000; i++ {\n                key, _ := hex.DecodeString(tt.aeskey)\n                cs, _ := NewCryptoService(key)\n                cipher, err := cs.Encrypt([]byte(tt.text))\n                if err != nil {\n                    t.Errorf(\"CryptoService.Encrypt() error = %v\", err)\n                    return\n                }\n\n                plain, err := cs.Decrypt(cipher)\n                if err != nil {\n                    t.Errorf(\"CryptoService.Decrypt() error = %v\", err)\n                    return\n                }\n\n                plainStr := string(plain)\n                if plainStr != tt.text {\n                    t.Errorf(\"CryptoService.Decrypt() plain = %v, want = %v\", plainStr, tt.text)\n                    return\n                }\n            }\n        })\n    }\n}\n\nfunc TestCryptoService_EncryptBase64DecryptBase64Roundtrip(t *testing.T) {\n    tests := []struct {\n        name   string\n        aeskey string\n        text   string\n    }{\n        {\"Simple 1\", \"c4cc0dfc4ae0e45c045727f84ffd373127453bc232230bf1386972ac692436c1\", \"Text\"},\n        {\"Simple 2\", \"c4cc0dfc4ae0e45c045727f84ffd373127453bc232230bf1386972ac692436c1\", \"Some random content\"},\n        {\"Simple 3\", \"c4cc0dfc4ae0e45c045727f84ffd373127453bc232230bf1386972ac692436c1\", \"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.\"},\n\n        {\"Dynamic 1\", \"c4cc0dfc4ae0e45c045727f84ffd373127453bc232230bf1386972ac692436c1\", FastRandomString(32)},\n        {\"Dynamic 2\", \"c4cc0dfc4ae0e45c045727f84ffd373127453bc232230bf1386972ac692436c1\", FastRandomString(1024)},\n        {\"Dynamic 3\", \"c4cc0dfc4ae0e45c045727f84ffd373127453bc232230bf1386972ac692436c1\", FastRandomString(1024 * 64)},\n        {\"Dynamic 4\", \"c4cc0dfc4ae0e45c045727f84ffd373127453bc232230bf1386972ac692436c1\", FastRandomString(1024 * 256)},\n    }\n    for _, tt := range tests {\n        t.Run(tt.name, func(t *testing.T) {\n            for i := 0; i &lt; 1000; i++ {\n                key, _ := hex.DecodeString(tt.aeskey)\n                cs, _ := NewCryptoService(key)\n                cipher, err := cs.EncryptBase64([]byte(tt.text))\n                if err != nil {\n                    t.Errorf(\"CryptoService.EncryptBase64() error = %v\", err)\n                    return\n                }\n\n                plain, err := cs.DecryptBase64(cipher)\n                if err != nil {\n                    t.Errorf(\"CryptoService.DecryptBase64() error = %v\", err)\n                    return\n                }\n\n                plainStr := string(plain)\n                if plainStr != tt.text {\n                    t.Errorf(\"CryptoService.DecryptBase64() plain = %v, want = %v\", plainStr, tt.text)\n                    return\n                }\n            }\n        })\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511125241, "post_id": 47381918, "comment_id": 81716462, "body": "Did you consider a range loop with a switch on index inside?"}, {"owner": {"reputation": 2534, "user_id": 898099, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fde4e02f49a0c28e3a287e86aec38af3?s=128&d=identicon&r=PG", "display_name": "Aleksandr Makov", "link": "https://stackoverflow.com/users/898099/aleksandr-makov"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511125506, "post_id": 47381918, "comment_id": 81716544, "body": "@mkopriva since i&#39;m completely knew to golang, I&#39;m not quite sure how to do that. Range loop presumes that proper field is going to be pointed to respective index, which, again, I&#39;m not sure how to do."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1511125977, "post_id": 47381918, "comment_id": 81716683, "body": "This <a href=\"https://play.golang.org/p/tsh1cNxs3R\" rel=\"nofollow noreferrer\">play.golang.org/p/tsh1cNxs3R</a> is what i had in mind. But Cerise Limon&#39;s answer seems to be a more optimal option."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1511178382, "post_id": 47381918, "comment_id": 81735404, "body": "Note that Go doesn&#39;t support type casting; only time conversion."}], "answers": [{"comments": [{"owner": {"reputation": 2534, "user_id": 898099, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fde4e02f49a0c28e3a287e86aec38af3?s=128&d=identicon&r=PG", "display_name": "Aleksandr Makov", "link": "https://stackoverflow.com/users/898099/aleksandr-makov"}, "edited": false, "score": 0, "creation_date": 1511608191, "post_id": 47382030, "comment_id": 81925385, "body": "Thanks. This is indeed smart and interesting. I was struggling what answer to accept. However, I liked <code>copy</code> just a little bit over your suggestion as it requires less code to write. In any case, thank you very much!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1511127031, "last_edit_date": 1511127031, "creation_date": 1511125805, "answer_id": 47382030, "question_id": 47381918, "link": "https://stackoverflow.com/questions/47381918/how-to-cast-string-with-variable-number-of-items/47382030#47382030", "title": "How to cast []string with variable number of items?", "body": "<p>One option is to use <a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"noreferrer\">switch</a> with <a href=\"https://golang.org/ref/spec#Fallthrough_statements\" rel=\"noreferrer\">fallthrough</a>:</p>\n\n<pre><code>switch len(fields) {\ncase 20:\n    log.Field20 = something(fields[19])\n    fallthrough\n\n// ...\n\ncase 3:\n   log.Field3 = fields[2]\n   fallthrough\ncase 2:\n    log.Field2, _ = strconv.ParseUint(fields[1], 0, 64)\n    fallthrough\ncase 1:\n    log.Field1 = fields[0]\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/szYPmSIPrK\" rel=\"noreferrer\">playground example</a> (thank you @mkopriva for starting example)</p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1511179144, "last_edit_date": 1511179144, "creation_date": 1511178831, "answer_id": 47391414, "question_id": 47381918, "link": "https://stackoverflow.com/questions/47381918/how-to-cast-string-with-variable-number-of-items/47391414#47391414", "title": "How to cast []string with variable number of items?", "body": "<p>One possibility would be to simply ensure that you always have 20 elements in your slice. Assuming you're populating <code>fields</code> with <code>strings.Split</code>, for example:</p>\n\n<pre><code>fields := make([]string, 20)\ncopy(fields, strings.Split(input, \",\"))\n\n// Now `fields` has 20 elements, the first N of which are populated\n// by your input, the remainder of which are empty strings (\"\"), so\n// you can easily set your struct fields now.\n\nlog := Log{\n    Field1:  fields[0],\n    Field2:  fields[1],\n    // ...\n    Field20: fields[19],\n}\n</code></pre>\n"}], "owner": {"reputation": 2534, "user_id": 898099, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fde4e02f49a0c28e3a287e86aec38af3?s=128&d=identicon&r=PG", "display_name": "Aleksandr Makov", "link": "https://stackoverflow.com/users/898099/aleksandr-makov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 47382030, "answer_count": 2, "score": 2, "last_activity_date": 1511179144, "creation_date": 1511124963, "last_edit_date": 1511178355, "question_id": 47381918, "link": "https://stackoverflow.com/questions/47381918/how-to-cast-string-with-variable-number-of-items", "title": "How to cast []string with variable number of items?", "body": "<p>I'm trying to parse log strings, where fields are glued with \"|\" char. All logs suppose to have 20 fields, but some logs have less. I don't want to discard them, but rather fill <code>Log{}</code> with whatever info was there in the log string.</p>\n\n<pre><code>type Log struct {\n     Field1  string\n     Field2  uint64\n     Field3  string\n     // ...\n     Field20 string\n}\n</code></pre>\n\n<p>Knowing that it's not possible to check if index exists within a slice, this looks suboptimal:</p>\n\n<pre><code>log := Log{}\nc := len(fields)\n\nif c &gt; 0 {\n    log.Field1 = fields[0]\n}\n\nif c &gt; 1 {\n    log.Field2, _ = strconv.ParseUint(fields[1], 0, 64)\n}\n\nif c &gt; 3 {\n    log.Field3 = fields[2]\n}\n\n//...\n</code></pre>\n\n<p>Any better ways doing this?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "encryption", "rsa"], "comments": [{"owner": {"reputation": 1917, "user_id": 4039768, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EWQUf.jpg?s=128&g=1", "display_name": "Mohsin", "link": "https://stackoverflow.com/users/4039768/mohsin"}, "edited": false, "score": 1, "creation_date": 1511120156, "post_id": 47380374, "comment_id": 81714646, "body": "Please refer <a href=\"https://stackoverflow.com/help/how-to-ask\">How to ask a good question?</a>   Could you include some more code that you&#39;ve tried so far? To reproduce the problem."}, {"owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "edited": false, "score": 1, "creation_date": 1511135782, "post_id": 47380374, "comment_id": 81719339, "body": "Please provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> of the issue you are having."}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 8968123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pDaik.jpg?s=128&g=1", "display_name": "stefany", "link": "https://stackoverflow.com/users/8968123/stefany"}, "is_accepted": false, "score": 0, "last_activity_date": 1511176751, "creation_date": 1511176751, "answer_id": 47390786, "question_id": 47380374, "link": "https://stackoverflow.com/questions/47380374/import-string-rsa-public-key-to-use-rsa-encryption-in-go/47390786#47390786", "title": "Import string RSA public key to use RSA encryption in Go", "body": "<p>When you receive the base64 encoded password your decode like:</p>\n\n<pre><code>base64.StdEncoding.DecodeString(\"FExEiYPgwrHHyO7DOwCXHNRvVF2S8xirXftuFWmJUzo=\")\n</code></pre>\n\n<p>Then the string you encrypt must be no longer than the length of the public modulus minus twice the hash length, minus 2. See <a href=\"https://golang.org/pkg/crypto/rsa/#EncryptOAEP\" rel=\"nofollow noreferrer\">docs</a> for examples and documentation.</p>\n"}], "owner": {"reputation": 31, "user_id": 7949869, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ed4bcf23dbe153c19b73a9e75719eec?s=128&d=identicon&r=PG&f=1", "display_name": "dowi", "link": "https://stackoverflow.com/users/7949869/dowi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1511, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1511390657, "creation_date": 1511115765, "last_edit_date": 1511390657, "question_id": 47380374, "link": "https://stackoverflow.com/questions/47380374/import-string-rsa-public-key-to-use-rsa-encryption-in-go", "title": "Import string RSA public key to use RSA encryption in Go", "body": "<p>How can I import an RSA public key from a string in Go, so that it can be used to encrypt data ?</p>\n\n<p>My program should do the following:</p>\n\n<ul>\n<li>Receives a public key encoded in base64</li>\n<li>Decode this public key from base64 to bytes</li>\n<li>Import that public key so that it is usable by the RSA implementation of Go \n(Problem is at this stage)</li>\n<li><p>Encrypt an AES key with:</p>\n\n<p><code>ciphertext, err := rsa.EncryptOAEP(sha256.New(), rand.Reader, publicKey, plaintextBytes, []byte(\"\"))</code></p></li>\n</ul>\n\n<p>Thank you in advance !</p>\n\n<p><strong>SOLUTION</strong>:</p>\n\n<p>The public key has to be decoded with the <strong>crypto/x509</strong> package.</p>\n\n<p>For example:</p>\n\n<pre><code>publicKeyInterface, err := x509.ParsePKIXPublicKey(publicKeyDER)\nif err != nil {\n    log.Println(\"Could not parse DER encoded public key (encryption key)\")\n    return []byte(\"\"), err\n}\npublicKey, isRSAPublicKey := publicKeyInterface.(*rsa.PublicKey)\nif !isRSAPublicKey {\n    log.Println(\"Public key parsed is not an RSA public key\")\n    return []byte(\"\"), err\n}\n</code></pre>\n\n<p>You can then use the <code>publicKey</code> with RSA to encrypt.</p>\n"}, {"tags": ["mongodb", "go", "mongodb-query", "mgo"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1511124527, "post_id": 47379455, "comment_id": 81716191, "body": "What have you tried so far? What problems do you have? Aim for a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1511128431, "post_id": 47379455, "comment_id": 81717480, "body": "See updates in my question. Thanks."}], "answers": [{"comments": [{"owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "edited": false, "score": 0, "creation_date": 1511172498, "post_id": 47388623, "comment_id": 81731766, "body": "Thank you very much :-) Regarding performance, is there anything to take into account considering that the collection contains thousands and thousands of documents?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "edited": false, "score": 0, "creation_date": 1511173638, "post_id": 47388623, "comment_id": 81732538, "body": "@j3d Yes, the distinct operation is always &quot;slow&quot;. If you need to do this many times and it needs to be fast, you may consider keeping this info saved, e.g. when you insert a new document, also upsert the symbol into a different collection, keeping the distinct symbols."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1521200480, "last_edit_date": 1521200480, "creation_date": 1511169801, "answer_id": 47388623, "question_id": 47379455, "link": "https://stackoverflow.com/questions/47379455/how-to-get-an-aggregate-from-a-mongodb-collection/47388623#47388623", "title": "How to Get an Aggregate from a MongoDB Collection", "body": "<h2>Using <code>Distinct()</code></h2>\n\n<p>What you want is easiest done using <a href=\"https://docs.mongodb.com/manual/reference/method/db.collection.distinct/\" rel=\"nofollow noreferrer\"><code>collection.distinct()</code></a>. In MongoDB console it would look like this:</p>\n\n<pre><code>db.candles.distinct(\"symbol\")\n</code></pre>\n\n<p>And in Go, using <code>mgo</code>,  <a href=\"https://godoc.org/gopkg.in/mgo.v2#Query.Distinct\" rel=\"nofollow noreferrer\"><code>Query.Distinct()</code></a>:</p>\n\n<pre><code>var sess *mgo.Session = ... // Acquire session\nc := sess.DB(\"dbname\").C(\"candles\")\n\nvar symbols []string\nerr := c.Find(nil).Distinct(\"symbol\", &amp;symbols)\nif err != nil {\n    log.Printf(\"Error: %v\", err)\n    return\n}\nfmt.Println(symbols)\n</code></pre>\n\n<h2>Using the Aggregation Framework</h2>\n\n<p>You can also do it using MongoDB aggregation, which is available via the <a href=\"https://godoc.org/gopkg.in/mgo.v2#Collection.Pipe\" rel=\"nofollow noreferrer\"><code>Collection.Pipe()</code></a> method. You have to pass a slice to it, each element corresponds to an aggregation stage.</p>\n\n<p>The result of an aggregation is always a list of documents, so if you want the result as a slice of strings, you have to do the \"conversion\" manually.</p>\n\n<pre><code>var sess *mgo.Session = ... // Acquire session\nc := sess.DB(\"dbname\").C(\"candles\")\n\npipe := c.Pipe([]bson.M{\n    {\n        \"$group\": bson.M{\n            \"_id\": \"$symbol\",\n        },\n    },\n})\nvar results = []bson.M{}\nif err := pipe.All(&amp;results); err != nil {\n    log.Printf(\"Error: %v\", err)\n    return\n}\n\n// results holds {\"_id\": \"symbol\"} documents\n// To get a slice of symbols:\nsymbols := make([]string, len(results))\nfor i, doc := range results {\n    symbols[i] = doc[\"_id\"].(string)\n}\nfmt.Println(symbols)\n</code></pre>\n\n<p>For more techniques how to get a slice of values result instead of documents, see <a href=\"https://stackoverflow.com/questions/49317887/is-there-a-way-to-get-slice-as-result-of-find/49319677#49319677\">Is there a way to get slice as result of Find()?</a></p>\n"}], "owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 1, "accepted_answer_id": 47388623, "answer_count": 1, "score": 1, "last_activity_date": 1521200480, "creation_date": 1511110582, "last_edit_date": 1511170949, "question_id": 47379455, "link": "https://stackoverflow.com/questions/47379455/how-to-get-an-aggregate-from-a-mongodb-collection", "title": "How to Get an Aggregate from a MongoDB Collection", "body": "<p>The following collection contains the ticks for the diverse exchange symbols (in this case <code>BTCUSD</code> and <code>BTCEUR</code>):</p>\n\n<pre><code>{ \"_id\" : ObjectId(\"5a08d2b956df9b2302759d1a\"), \"symbol\" : \"BTCUSD\", \"time\" : ISODate(\"2013-04-13T00:00:00Z\"), \"open\" : 112, \"close\" : 91.1, \"high\" : 130, \"low\" : 81.12, \"volume\" : 23866.6770456 }\n{ \"_id\" : ObjectId(\"5a08d2b956df9b2302759d1c\"), \"symbol\" : \"BTCUSD\", \"time\" : ISODate(\"2013-04-14T00:00:00Z\"), \"open\" : 91.1, \"close\" : 90.171, \"high\" : 109, \"low\" : 20, \"volume\" : 16437.2196645 }\n{ \"_id\" : ObjectId(\"5a08d2b956df9b2302759d1e\"), \"symbol\" : \"BTCEUR\", \"time\" : ISODate(\"2013-04-15T00:00:00Z\"), \"open\" : 89.86, \"close\" : 83.302, \"high\" : 104, \"low\" : 71.497, \"volume\" : 16393.12856398 }\n{ \"_id\" : ObjectId(\"5a08d2b956df9b2302759d20\"), \"symbol\" : \"BTCEUR\", \"time\" : ISODate(\"2013-04-16T00:00:00Z\"), \"open\" : 84.27, \"close\" : 67.588, \"high\" : 84.48, \"low\" : 0.01, \"volume\" : 26092.5432296 }\n</code></pre>\n\n<p>How do I get the list of symbols actually present in the collection in <code>Go</code>? For instance, the result I'm looking for is:</p>\n\n<pre><code>{ \"BTCUSD\", \"BTCEUR\" }\n</code></pre>\n\n<p>This would let me retrieve the latest tick values from the exchange service without having to store somewhere the symbols I'm interested in.</p>\n\n<p>From the <code>mongo</code> shell I've tried this...</p>\n\n<pre><code>db.candles.aggregate({$group: {_id:\"$symbol\"}})\n</code></pre>\n\n<p>... and here is the result:</p>\n\n<pre><code>{ \"_id\" : \"BTCUSD\" }\n{ \"_id\" : \"BTCEUR\" }\n</code></pre>\n\n<p>What is the equivalent in <code>Go</code> using <code>mgo</code>? Is it possible to just get an array of symbols instead of a collection of <code>\"_id\" : \"value\"</code> pairs?</p>\n"}, {"tags": ["linux", "ubuntu", "go", "vagrant", "ubuntu-16.04"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1511107798, "post_id": 47378854, "comment_id": 81710060, "body": "You should not need to rerun, nor recompile the go app, unless there is some caching going on in the browser you should see changes made to index.html just after refreshing the page."}, {"owner": {"reputation": 789, "user_id": 3987165, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5c47bdb548e5dd8f0e354dffc4a8598d?s=128&d=identicon&r=PG&f=1", "display_name": "\u0415\u0433\u043e\u0440 \u041b\u0435\u0431\u0435\u0434\u0435\u0432", "link": "https://stackoverflow.com/users/3987165/%d0%95%d0%b3%d0%be%d1%80-%d0%9b%d0%b5%d0%b1%d0%b5%d0%b4%d0%b5%d0%b2"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511108279, "post_id": 47378854, "comment_id": 81710215, "body": "I clear history and cache in chrome and even try another browser, but still see old static files, while in file system there is only new version. So it is not about browsers."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1511108604, "post_id": 47378854, "comment_id": 81710296, "body": "Try curl to see if the index.html changes. I&#39;ve just recreated your simple example on my machine and it works with firefox just fine."}, {"owner": {"reputation": 789, "user_id": 3987165, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5c47bdb548e5dd8f0e354dffc4a8598d?s=128&d=identicon&r=PG&f=1", "display_name": "\u0415\u0433\u043e\u0440 \u041b\u0435\u0431\u0435\u0434\u0435\u0432", "link": "https://stackoverflow.com/users/3987165/%d0%95%d0%b3%d0%be%d1%80-%d0%9b%d0%b5%d0%b1%d0%b5%d0%b4%d0%b5%d0%b2"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511108889, "post_id": 47378854, "comment_id": 81710386, "body": "curl shows old version too"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1511109399, "post_id": 47378854, "comment_id": 81710562, "body": "You&#39;re doing something somewhere wrong but there is no problem with how Go&#39;s http.FileServer works. <a href=\"https://imgur.com/a/HnuD7\" rel=\"nofollow noreferrer\">imgur.com/a/HnuD7</a>"}, {"owner": {"reputation": 789, "user_id": 3987165, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5c47bdb548e5dd8f0e354dffc4a8598d?s=128&d=identicon&r=PG&f=1", "display_name": "\u0415\u0433\u043e\u0440 \u041b\u0435\u0431\u0435\u0434\u0435\u0432", "link": "https://stackoverflow.com/users/3987165/%d0%95%d0%b3%d0%be%d1%80-%d0%9b%d0%b5%d0%b1%d0%b5%d0%b4%d0%b5%d0%b2"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511109510, "post_id": 47378854, "comment_id": 81710601, "body": "I think youre right, here is something about my system, but don&#39;t know what and where to look for..."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1511110325, "post_id": 47378854, "comment_id": 81710916, "body": "Try also something like this <a href=\"https://play.golang.org/p/Z1AZ_EthiY\" rel=\"nofollow noreferrer\">play.golang.org/p/Z1AZ_EthiY</a> just to see if Go is receiving a request every time, or only the first time."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1511110489, "post_id": 47378854, "comment_id": 81710989, "body": "Also take a look at this <a href=\"https://jeremyfelt.com/2013/01/08/clear-nginx-cache-in-vagrant/\" rel=\"nofollow noreferrer\">jeremyfelt.com/2013/01/08/clear-nginx-cache-in-vagrant</a>, maybe your issue is similar to that."}, {"owner": {"reputation": 789, "user_id": 3987165, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5c47bdb548e5dd8f0e354dffc4a8598d?s=128&d=identicon&r=PG&f=1", "display_name": "\u0415\u0433\u043e\u0440 \u041b\u0435\u0431\u0435\u0434\u0435\u0432", "link": "https://stackoverflow.com/users/3987165/%d0%95%d0%b3%d0%be%d1%80-%d0%9b%d0%b5%d0%b1%d0%b5%d0%b4%d0%b5%d0%b2"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511110880, "post_id": 47378854, "comment_id": 81711141, "body": "Go is receiving a request every time I refresh page. I got no nginx installed."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1511114692, "post_id": 47378854, "comment_id": 81712641, "body": "You&#39;ve given your go code but I think that this an environment configuration issue - perhaps including your vagrant config and setup details would be more helpful in solving the issue. Request/response headers would also help"}, {"owner": {"reputation": 16516, "user_id": 1133291, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/538bd3553b7540f411a84101e4cbf294?s=128&d=identicon&r=PG", "display_name": "Gal Ben-Haim", "link": "https://stackoverflow.com/users/1133291/gal-ben-haim"}, "edited": false, "score": 2, "creation_date": 1512626841, "post_id": 47378854, "comment_id": 82336408, "body": "make sure the file <i>inside the VM</i> is being changed, there may be a sync/cache issue with that. sounds like something is caching it... (definitely not related to golang or your code)"}], "answers": [{"tags": [], "owner": {"reputation": 4579, "user_id": 1114274, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ebd3b90b30e78d29cc01c13ba6ebb090?s=128&d=identicon&r=PG", "display_name": "Mike Graf", "link": "https://stackoverflow.com/users/1114274/mike-graf"}, "is_accepted": false, "score": 0, "last_activity_date": 1531521216, "creation_date": 1531521216, "answer_id": 51333596, "question_id": 47378854, "link": "https://stackoverflow.com/questions/47378854/static-files-dont-update-while-serving-them-from-go/51333596#51333596", "title": "Static files don&#39;t update while serving them from Go", "body": "<p><a href=\"https://golang.org/cmd/go/#hdr-Compile_and_run_Go_program\" rel=\"nofollow noreferrer\">go run</a> essentially <a href=\"https://stackoverflow.com/a/28755999/1114274\">builds a binary, copies it to a tmp folder and then executes it</a> (its more than that, but good enough for our purposes).  </p>\n\n<p>I tested out your example by copying the main.go you provided then doing the following:</p>\n\n<pre><code>go run main.go\n# in a new tab\ncurl localhost:8080\n#  ==&gt; \"Hello world\"\necho \"2\" &gt;&gt; public/index.html\ncurl localhost:8080\n#  ==&gt; \"Hello world\\n2\"\n</code></pre>\n"}], "owner": {"reputation": 789, "user_id": 3987165, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5c47bdb548e5dd8f0e354dffc4a8598d?s=128&d=identicon&r=PG&f=1", "display_name": "\u0415\u0433\u043e\u0440 \u041b\u0435\u0431\u0435\u0434\u0435\u0432", "link": "https://stackoverflow.com/users/3987165/%d0%95%d0%b3%d0%be%d1%80-%d0%9b%d0%b5%d0%b1%d0%b5%d0%b4%d0%b5%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 223, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1531521216, "creation_date": 1511107181, "last_edit_date": 1511126997, "question_id": 47378854, "link": "https://stackoverflow.com/questions/47378854/static-files-dont-update-while-serving-them-from-go", "title": "Static files don&#39;t update while serving them from Go", "body": "<p>I started to learn Go, and have a problem with static files handle.\nhave this:</p>\n\n<pre><code>func main() {\n    fs := http.FileServer(http.Dir(\"public\"))\n    http.Handle(\"/\", fs)\n    err := http.ListenAndServe(\":8080\", nil)\n    if err != nil {\n        log.Fatal(\"ListenAndServe: \", err)\n    }\n}\n</code></pre>\n\n<p>folder structure:</p>\n\n<pre><code>main.go\n\npublic\n    - index.html\n</code></pre>\n\n<p>When I run <code>go run main.go</code> and after it, change something in <code>index.html</code>, and again run <code>go run main.go</code>, view in browser doesn't changed. So I googled a bit and thought that they are in binary file that go compiles, and because of <code>main.go</code> wasn't changed, go doesn't recompile it. So I run <code>go run -a main.go</code> to force recompile, but it doesn't help.</p>\n\n<p>I clear history and cache in chrome and even try another browser and <code>curl</code>, but still see old static files, while in file system there is only new version. So it is not about browsers. Actually one thing that is working is to rename <code>public</code> to <code>public2</code>(for example) and in <code>main.go</code> make same changes, when I see new version of static files in browser.</p>\n\n<p>It is not Go problem, because this example works OK in other users. So it is something with my system. I run that code on default Ubuntu 16.04 in Vagrant.</p>\n\n<p>vagrantfile:</p>\n\n<pre><code># -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVagrant.configure(\"2\") do |config|\n  config.vm.network \"forwarded_port\", guest: 8080, host: 8080\n  config.vm.network \"forwarded_port\", guest: 5432, host: 5432\nend\n</code></pre>\n\n<p>request header:</p>\n\n<pre><code>2017/11/19 18:25:45 request.RequestURI: /\n2017/11/19 18:25:45 request.RemoteAddr: 10.0.2.2:50584\n2017/11/19 18:25:45 request.TLS: &lt;nil&gt;\n2017/11/19 18:25:45 Request Headers:\n2017/11/19 18:25:45 Accept : [text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8]\n2017/11/19 18:25:45 Accept-Encoding : [gzip, deflate, br]\n2017/11/19 18:25:45 Accept-Language : [en-US,en;q=0.9,ru;q=0.8]\n2017/11/19 18:25:45 Cache-Control : [max-age=0]\n2017/11/19 18:25:45 Connection : [keep-alive]\n2017/11/19 18:25:45 If-Modified-Since : [Sun, 19 Nov 2017 16:24:53 GMT]\n2017/11/19 18:25:45 Upgrade-Insecure-Requests : [1]\n2017/11/19 18:25:45 User-Agent : [Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36]\n</code></pre>\n\n<p>response header:</p>\n\n<pre><code>HTTP/1.1 200 OK\nAccept-Ranges: bytes\nContent-Length: 2010\nContent-Type: text/html; charset=utf-8\nLast-Modified: Sun, 19 Nov 2017 16:24:53 GMT\nDate: Sun, 19 Nov 2017 18:25:27 GMT\n</code></pre>\n\n<p>CONCLUSION: I run that on another vm and everything work fine, so there is something about vm, but now I don't know what is the problem.</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1511105560, "post_id": 47378394, "comment_id": 81709255, "body": "Do you see the same behaviour if you try other browsers or curl?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1511106708, "post_id": 47378394, "comment_id": 81709685, "body": "The server cannot establish new connections on behalf of the client. This is the client behavior your showing."}, {"owner": {"reputation": 515, "user_id": 7804714, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9e70292d73d503d0ef63de4cda71b1ac?s=128&d=identicon&r=PG", "display_name": "hallazzang", "link": "https://stackoverflow.com/users/7804714/hallazzang"}, "edited": false, "score": 0, "creation_date": 1511107206, "post_id": 47378394, "comment_id": 81709865, "body": "Oh, when I try using curl it doesn&#39;t happen so the reason might be the Chrome&#39;s behavior, thank you guys."}], "answers": [{"comments": [{"owner": {"reputation": 515, "user_id": 7804714, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9e70292d73d503d0ef63de4cda71b1ac?s=128&d=identicon&r=PG", "display_name": "hallazzang", "link": "https://stackoverflow.com/users/7804714/hallazzang"}, "edited": false, "score": 0, "creation_date": 1511107285, "post_id": 47378826, "comment_id": 81709889, "body": "Yes it was because of the Chrome&#39;s behavior. I&#39;ll use server side idle timeout as you suggested, thanks!"}], "tags": [], "owner": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "is_accepted": true, "score": 3, "last_activity_date": 1511107001, "creation_date": 1511107001, "answer_id": 47378826, "question_id": 47378394, "link": "https://stackoverflow.com/questions/47378394/weird-behavior-of-http-server-establishes-three-connections-for-each-client/47378826#47378826", "title": "Weird behavior of http.Server - establishes three connections for each client?", "body": "<p>I don't think you are missing anything here. Chrome might have opened multiple connection to your server, may be hoping that there may be many parallel requests to the remote server. Chrome may open upto 6 connections to a server for issuing requests in parallel to that server. But as there is just one GET call from the browser in your test here, so the data transfer is happening only over one of those sockets (or connections) opened. As 2 of the connections (sockets) are not getting data, they may get closed due to idle timeout from client or server side. \nIf you are running the program from Linux/Mac etc., you may check how the data getting transferred over which socket by using Tcpdump. Or alternatively, you may use Wireshark also to inspect the HTTP or TCP traffics and that will give you clear picture of what is happening over those sockets.\nMay be some tcpdump command like the one shown below will help:</p>\n\n<pre><code>  $ sudo tcpdump -i lo0 port 8000  -s 65534 -A\n    Eg. tcpdump -i &lt;interface&gt; port &lt;some port&gt; -s &lt;max-packet-capture-size&gt;  -A\n</code></pre>\n"}], "owner": {"reputation": 515, "user_id": 7804714, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9e70292d73d503d0ef63de4cda71b1ac?s=128&d=identicon&r=PG", "display_name": "hallazzang", "link": "https://stackoverflow.com/users/7804714/hallazzang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 47378826, "answer_count": 1, "score": 0, "last_activity_date": 1511112294, "creation_date": 1511104237, "last_edit_date": 1511112294, "question_id": 47378394, "link": "https://stackoverflow.com/questions/47378394/weird-behavior-of-http-server-establishes-three-connections-for-each-client", "title": "Weird behavior of http.Server - establishes three connections for each client?", "body": "<p>I'm a noob Go programmer. I'm currently writing a web application which streams data to clients. To test if it works well, I've wrote this code(<code>streaming.go</code>):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"X-Content-Type-Options\", \"nosniff\")\n\n    fmt.Println(\"Client connected!\")\n\n    flusher, ok := w.(http.Flusher)\n    if !ok {\n        fmt.Println(\"ResponseWriter doesn't implement Flusher interface\")\n        return\n    }\n\n    closeNotifier, ok := w.(http.CloseNotifier)\n    if !ok {\n        fmt.Println(\"ResponseWriter doesn't implement CloseNotifier interface\")\n        return\n    }\n    closeNotifyChannel := closeNotifier.CloseNotify()\n\n    for {\n        fmt.Println(\"Sending data chunk...\")\n        fmt.Fprintf(w, \"Chunk.\")\n        flusher.Flush()\n\n        select {\n        case &lt;-closeNotifyChannel:\n            goto closed\n        default:\n            time.Sleep(500 * time.Millisecond)\n        }\n    }\n\nclosed:\n    fmt.Println(\"Client disconnected\")\n}\n\nfunc main() {\n    mux := http.NewServeMux()\n    mux.HandleFunc(\"/\", handler)\n\n    server := &amp;http.Server{\n        Addr:    \"localhost:8000\",\n        Handler: mux,\n        ConnState: func(conn net.Conn, state http.ConnState) {\n            fmt.Printf(\"[ConnState] %v: \", conn.RemoteAddr())\n\n            switch state {\n            case http.StateNew:\n                fmt.Println(\"StateNew\")\n            case http.StateActive:\n                fmt.Println(\"StateActive\")\n            case http.StateIdle:\n                fmt.Println(\"StateIdle\")\n            case http.StateHijacked:\n                fmt.Println(\"StateHijacked\")\n            case http.StateClosed:\n                fmt.Println(\"StateClosed\")\n            }\n        },\n    }\n\n    server.ListenAndServe()\n}\n</code></pre>\n\n<p>What it does is:\n1. When a client has connected, get <code>http.Flusher</code> and <code>http.CloseNofier</code> instance for <code>http.ResponseWriter</code>\n2. Send little amount of data(chunk) until client is disconnected(in this example I used simple string, <code>\"Chunk.\"</code>)</p>\n\n<p>Here's a sample output for this program when I enter <code>127.0.0.1:8000</code> in my Chrome browser:</p>\n\n<pre><code>[ConnState] 127.0.0.1:57226: StateNew\n[ConnState] 127.0.0.1:57227: StateNew\n[ConnState] 127.0.0.1:57228: StateNew\n[ConnState] 127.0.0.1:57226: StateActive\nClient connected!\nSending data chunk...\nSending data chunk...\nSending data chunk...\nSending data chunk...\nSending data chunk...\nSending data chunk...\nSending data chunk...\n[ConnState] 127.0.0.1:57227: StateActive\nClient connected!\nSending data chunk...\nSending data chunk...\nClient disconnected\n[ConnState] 127.0.0.1:57226: StateIdle\n[ConnState] 127.0.0.1:57226: StateClosed\nSending data chunk...\nSending data chunk...\nSending data chunk...\nSending data chunk...\n...(forever)\n</code></pre>\n\n<p>So what the hack are those <code>127.0.0.1:57227</code>, <code>127.0.0.1:57228</code>? They don't get activated as soon as client connected but when I press ESC key in my browser, one gets activated. Where does my handler send data to?</p>\n\n<p>I'm wondering if <code>Connection: keep-alive</code>(seems that Chrome automatically adds this header for request) makes this happens, please let me know what I'm missing. Thanks.</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 5, "creation_date": 1511103451, "post_id": 47378207, "comment_id": 81708569, "body": "<code>QueryRow</code> returns one value, <code>Query</code> returns two."}, {"owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511103839, "post_id": 47378207, "comment_id": 81708703, "body": "Great that makes sense now, and it worked."}], "answers": [{"tags": [], "owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "is_accepted": true, "score": 1, "last_activity_date": 1511129278, "creation_date": 1511129278, "answer_id": 47382513, "question_id": 47378207, "link": "https://stackoverflow.com/questions/47378207/go-mysql-select-query-causes-variable-assignment-error/47382513#47382513", "title": "go mysql SELECT query causes variable assignment error", "body": "<p>mkopriva's response</p>\n\n<blockquote>\n  <p>QueryRow returns one value, Query returns two</p>\n</blockquote>\n"}], "owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 328, "favorite_count": 0, "accepted_answer_id": 47382513, "answer_count": 1, "score": 0, "last_activity_date": 1511189518, "creation_date": 1511103122, "last_edit_date": 1511189518, "question_id": 47378207, "link": "https://stackoverflow.com/questions/47378207/go-mysql-select-query-causes-variable-assignment-error", "title": "go mysql SELECT query causes variable assignment error", "body": "<p>I'm new to Go and I'm trying to query a mysql database.   I tried the following code:</p>\n\n<pre><code>rows, err := db.QueryRow(\"SELECT * FROM t_users\")\n</code></pre>\n\n<p>But running the <code>go run main.go</code> gives this error:</p>\n\n<blockquote>\n  <p>cannot assign 1 values to 2 variables</p>\n</blockquote>\n\n<p>But I don't get any errors for this:</p>\n\n<pre><code>rows, err := db.Query(\"DESCRIBE t_user\")\n</code></pre>\n\n<p>How come my select statement is giving an error?</p>\n"}, {"tags": ["php", "go"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 5, "creation_date": 1511090905, "post_id": 47376218, "comment_id": 81704770, "body": "Share your go code."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 4, "creation_date": 1511092313, "post_id": 47376218, "comment_id": 81705114, "body": "As @abhink said, show us your non-working Go code if you want us to help you find the bug. We cannot help you if you show us the php code that actually works. Also here&#39;s json encoding example in Go <a href=\"https://play.golang.org/p/zsVSujWVLZ\" rel=\"nofollow noreferrer\">play.golang.org/p/zsVSujWVLZ</a>."}, {"owner": {"reputation": 91, "user_id": 4417678, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh3.googleusercontent.com/-MrwklBTNP8g/AAAAAAAAAAI/AAAAAAAAAeQ/ezQ_9ZRH0K0/photo.jpg?sz=128", "display_name": "Mohammad", "link": "https://stackoverflow.com/users/4417678/mohammad"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511111352, "post_id": 47376218, "comment_id": 81711311, "body": "@mkopriva special thanks. in many go examples that i have seen there is no highlight on using string(json.Marhsal(MarshalledResult)), in your example i saw that when using string() explicit cast on marshalled result the comma separators will emerge in result. thanks. the problem solved"}], "answers": [{"comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1511112124, "post_id": 47379618, "comment_id": 81711596, "body": "you seem to have misunderstood the purpose of the type conversion in the example, that is there <b>only</b> to tell &quot;fmt.Println&quot; how to print the resulting bytes. <code>json.Marshal</code> always returns a slice of bytes and if you pass that directly to <code>fmt.Println</code> you&#39;ll see just the bytes that represent the json. If redis requires a json string then you are right you need to convert the bytes to a string, but if redis requires json bytes then you don&#39;t need to convert the result from marshal. <a href=\"https://play.golang.org/p/pJKzAUucQG\" rel=\"nofollow noreferrer\">play.golang.org/p/pJKzAUucQG</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511112562, "post_id": 47379618, "comment_id": 81711786, "body": "Also take a look at this <a href=\"https://play.golang.org/p/AFQNQkr1dm\" rel=\"nofollow noreferrer\">play.golang.org/p/AFQNQkr1dm</a>, you can see that the commas are there without the need of conversion."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1511113614, "post_id": 47379618, "comment_id": 81712222, "body": "Your first example definitely doesn\u2019t print <code>[1 2 3 4]</code>"}], "tags": [], "owner": {"reputation": 91, "user_id": 4417678, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh3.googleusercontent.com/-MrwklBTNP8g/AAAAAAAAAAI/AAAAAAAAAeQ/ezQ_9ZRH0K0/photo.jpg?sz=128", "display_name": "Mohammad", "link": "https://stackoverflow.com/users/4417678/mohammad"}, "is_accepted": true, "score": -2, "last_activity_date": 1511111524, "creation_date": 1511111524, "answer_id": 47379618, "question_id": 47376218, "link": "https://stackoverflow.com/questions/47376218/php-json-encode-in-go/47379618#47379618", "title": "php json_encode in Go", "body": "<p>When you use json.Marshal the result will be [1 2 3 4] but if you want to use your result as a string and send it to another place like redis , or print on the screen as a valid json, you should explicitly cast your result.</p>\n\n<p>Here are the incorrect and correct codes:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\nfunc main() {\n    x := []int64{1, 2, 3, 4}\n    y, err := json.Marshal(x)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(y)\n}\n</code></pre>\n\n<p>and the correct code is :\npackage main</p>\n\n<p>import (\n    \"fmt\"\n    \"encoding/json\"\n)</p>\n\n<pre><code>func main() {\n    x := []int64{1, 2, 3, 4}\n    y, err := json.Marshal(x)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(string(y))\n}\n</code></pre>\n"}], "owner": {"reputation": 91, "user_id": 4417678, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh3.googleusercontent.com/-MrwklBTNP8g/AAAAAAAAAAI/AAAAAAAAAeQ/ezQ_9ZRH0K0/photo.jpg?sz=128", "display_name": "Mohammad", "link": "https://stackoverflow.com/users/4417678/mohammad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 854, "favorite_count": 0, "accepted_answer_id": 47379618, "answer_count": 1, "score": -3, "last_activity_date": 1511189461, "creation_date": 1511090284, "last_edit_date": 1511189461, "question_id": 47376218, "link": "https://stackoverflow.com/questions/47376218/php-json-encode-in-go", "title": "php json_encode in Go", "body": "<p>in php I have this:</p>\n\n<pre><code>&lt;?php\n    $x = array(1,2,3,4);\n    $y = json_encode($x);\n    echo $y;\n?&gt;\n</code></pre>\n\n<p>which its result is:</p>\n\n<pre><code>[1,2,3,4]\n</code></pre>\n\n<p>in Go when i use <code>json.Marshal()</code> or <code>jsonEncoder</code> encode method the result is:</p>\n\n<pre><code>[1 2 3 4]\n</code></pre>\n\n<p>which is not equivalent as the json_encode() result in php and I can't decode it in php.</p>\n\n<p>Is there anyway to reach [1, 2, 3, 4] encoded result in go? (which has \",\" separator between each items)</p>\n"}, {"tags": ["go", "sqlx"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1511112956, "post_id": 47375040, "comment_id": 81711951, "body": "You need to read the <i>actual</i> <a href=\"https://godoc.org/github.com/jmoiron/sqlx#NamedStmt.Exec\" rel=\"nofollow noreferrer\">docs</a>, not just the github package summary."}], "answers": [{"tags": [], "owner": {"reputation": 109227, "user_id": 641955, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Hg2nO.jpg?s=128&g=1", "display_name": "janos", "link": "https://stackoverflow.com/users/641955/janos"}, "is_accepted": true, "score": 2, "last_activity_date": 1511081490, "last_edit_date": 1511081490, "creation_date": 1511081089, "answer_id": 47375080, "question_id": 47375040, "link": "https://stackoverflow.com/questions/47375040/how-to-increment-field-value-in-sqlx/47375080#47375080", "title": "How to increment field value in sqlx", "body": "<p>This is how to read the message <code>multiple-value shared.Dbmap.DB.Exec() in single-value context</code>:</p>\n\n<ul>\n<li><code>shared.Dbmap.DB.Exec()</code> has multiple values</li>\n<li>You are trying to use it in a single-value context</li>\n</ul>\n\n<p>In your code you have <code>err = shared.Dbmap.Exec(...)</code>.</p>\n\n<p>On the left side of the assignment there is a single value,\non the right side there are multiple.</p>\n\n<p>Looking at the <a href=\"https://godoc.org/github.com/jmoiron/sqlx#Execer\" rel=\"nofollow noreferrer\">docs</a>, the <code>Exec(...)</code> function returns 2 values,\nbut you assign it to one value.</p>\n\n<p>Write like this:</p>\n\n<pre><code>_, err = shared.Dbmap.Exec(\"UPDATE user SET posts=posts+1 WHERE id=?\", userId)\n</code></pre>\n"}], "owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 309, "favorite_count": 1, "accepted_answer_id": 47375080, "answer_count": 1, "score": 1, "last_activity_date": 1511189542, "creation_date": 1511080735, "last_edit_date": 1511189542, "question_id": 47375040, "link": "https://stackoverflow.com/questions/47375040/how-to-increment-field-value-in-sqlx", "title": "How to increment field value in sqlx", "body": "<p>In a Go app, using <code>sqlx</code> package and mysql database, I want to update table <code>user</code> and increment its <code>posts</code> field by 1:</p>\n\n<pre><code>err = shared.Dbmap.Exec(\"UPDATE user SET posts=posts+1 WHERE id=?\", userId)\nif err != nil {\n    log.Println(err)\n    return\n}\n</code></pre>\n\n<p>However at compile time I get:</p>\n\n<blockquote>\n  <p>multiple-value shared.Dbmap.DB.Exec() in single-value context</p>\n</blockquote>\n\n<p>I looked at <a href=\"https://github.com/jmoiron/sqlx\" rel=\"nofollow noreferrer\">the docs</a> and could not see relevant examples. </p>\n\n<p>How can I fix it?</p>\n"}, {"tags": ["c", "go", "x86", "simd", "avx"], "comments": [{"owner": {"reputation": 195333, "user_id": 253056, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1977cbe0ac5ffec4f6ee5ee24363988a?s=128&d=identicon&r=PG", "display_name": "Paul R", "link": "https://stackoverflow.com/users/253056/paul-r"}, "edited": false, "score": 0, "creation_date": 1511075549, "post_id": 47373650, "comment_id": 81701595, "body": "The performance penalty for unaligned loads in AVX is typically negligible (unlike unaligned loads with SSE on older CPUs, 10+ years ago)."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1511142033, "post_id": 47373650, "comment_id": 81720682, "body": "Go guarantees that the minimal alignment property of <code>var f [8]float32</code> is <code>4</code> not <code>8</code>: <a href=\"https://golang.org/ref/spec#Size_and_alignment_guarantees\" rel=\"nofollow noreferrer\">Size and alignment guarantees</a>. Also, the output of <code>var f [8]float32; fmt.Println(unsafe.Alignof(f))</code> is <code>4</code> not <code>8</code>: <a href=\"https://play.golang.org/p/ok2IvK0214\" rel=\"nofollow noreferrer\">play.golang.org/p/ok2IvK0214</a>"}, {"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "reply_to_user": {"reputation": 195333, "user_id": 253056, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1977cbe0ac5ffec4f6ee5ee24363988a?s=128&d=identicon&r=PG", "display_name": "Paul R", "link": "https://stackoverflow.com/users/253056/paul-r"}, "edited": false, "score": 1, "creation_date": 1511143862, "post_id": 47373650, "comment_id": 81721122, "body": "Unaligned loads have extra cost only if you cross a cache-line or page boundary.  It&#39;s significant for page-splits (especially on CPUs other than Skylake), and fairly minor for cache-line splits on Haswell and later.  (@PaulR: <a href=\"https://gcc.gnu.org/ml/gcc-patches/2011-03/msg01858.html\" rel=\"nofollow noreferrer\">splitting unaligned 256b loads into vmovups / vinsertf128 is actually a win on Sandybridge/Ivybridge, <i>if</i> the data really is misaligned at runtime</a>, rather than just not known to be aligned at build time."}, {"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1511144108, "post_id": 47373650, "comment_id": 81721167, "body": "Gcc enables <code>-mavx256-split-unaligned-load</code> with <code>-mtune=generic</code> even with <code>-mavx2</code>, though, because <a href=\"https://gcc.gnu.org/bugzilla/show_bug.cgi?id=80568\" rel=\"nofollow noreferrer\">there&#39;s no option to &quot;tune for all CPUs that could run this code&quot;</a>. :(  This is why it&#39;s a really good idea to use <code>gcc -march=haswell</code> instead of <code>gcc -mavx2</code> if you&#39;re building for Haswell.  (clang never does this splitting stuff.)  Also, gcc should probably drop it now, because it&#39;s not a big win on SnB, but a big loss on HSW with data that does turn out to be aligned."}, {"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1511225942, "post_id": 47373650, "comment_id": 81760911, "body": "TL:DR: if you can use aligned allocations for all your data, do it.  It doesn&#39;t matter if the code you run on it uses instructions that fault on unaligned or handle it in hardware, as long as the data is aligned at runtime.  This is much more important for AVX512 (where vector size = cache-line size, so misaligned means every load crosses a cache-line boundary) than for AVX2.  Being only 16B-aligned or less with AVX2 is usually not a measurable slowdown for looping over an array in memory or L3 cache.  For AVX2, unaligned may only be a problem with data hot in L1D cache, unlike with AVX512."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1511123668, "last_edit_date": 1511123668, "creation_date": 1511072776, "answer_id": 47374263, "question_id": 47373650, "link": "https://stackoverflow.com/questions/47373650/address-alignment-in-go/47374263#47374263", "title": "Address alignment in Go", "body": "<p>For example, trading more memory for less CPU time,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\n// Float32Align32 returns make([]float32, n) 32-byte aligned.\nfunc Float32Align32(n int) []float32 {\n    // align &gt;= size &amp;&amp; align%size == 0\n    const align = 32 // SIMD AVX byte alignment\n    const size = unsafe.Sizeof(float32(0))\n    const pad = int(align/size - 1)\n    if n &lt;= 0 {\n        return nil\n    }\n    s := make([]float32, n+pad)\n    p := uintptr(unsafe.Pointer(&amp;s[0]))\n    i := int(((p+align-1)/align*align - p) / size)\n    j := i + n\n    return s[i:j:j]\n}\n\nfunc main() {\n    f := Float32Align32(8) // SIMD AVX\n    fmt.Printf(\n        \"SIMD AVX: %T %d %d %p %g\\n\",\n        f, len(f), cap(f), &amp;f[0], f,\n    )\n    CFuncArg := &amp;f[0]\n    fmt.Println(\"CFuncArg:\", CFuncArg)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/mmFnHEwGKt\" rel=\"nofollow noreferrer\">https://play.golang.org/p/mmFnHEwGKt</a></p>\n\n<p>Output:</p>\n\n<pre><code>SIMD AVX: []float32 8 8 0x10436080 [0 0 0 0 0 0 0 0]\nCFuncArg: 0x10436080\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18942, "user_id": 894328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3db17c5296335f63e856be44aa821bf6?s=128&d=identicon&r=PG", "display_name": "Ahmed Masud", "link": "https://stackoverflow.com/users/894328/ahmed-masud"}, "is_accepted": false, "score": 0, "last_activity_date": 1511073360, "creation_date": 1511073360, "answer_id": 47374313, "question_id": 47373650, "link": "https://stackoverflow.com/questions/47373650/address-alignment-in-go/47374313#47374313", "title": "Address alignment in Go", "body": "<p>The only reasonable way to achieve is to prototype the functions in go and then write the (go) assembly as <code>BYTE</code> and <code>WORD</code> directives as it's done in golang libraries itself, as outlined in glang-1.9.1 documentation:</p>\n\n<blockquote>\n  <h2>Unsupported opcodes</h2>\n  \n  <p>The assemblers are designed to support the compiler so not all\n  hardware instructions are defined for all architectures: if the\n  compiler doesn't generate it, it might not be there. If you need to\n  use a missing instruction, there are two ways to proceed. One is to\n  update the assembler to support that instruction, which is\n  straightforward but only worthwhile if it's likely the instruction\n  will be used again. Instead, for simple one-off cases, it's possible\n  to use the BYTE and WORD directives to lay down explicit data into the\n  instruction stream within a TEXT.</p>\n</blockquote>\n\n<p>For example,</p>\n\n<p><a href=\"https://github.com/golang/crypto/blob/master/blake2b/blake2bAVX2_amd64.s#L115\" rel=\"nofollow noreferrer\">blake2b implementation at line 115</a> does this for AVX2</p>\n"}], "owner": {"reputation": 497, "user_id": 5026648, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/899713176741175/picture?type=large", "display_name": "Saksham Jain", "link": "https://stackoverflow.com/users/5026648/saksham-jain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 932, "favorite_count": 1, "answer_count": 2, "score": 6, "last_activity_date": 1511189479, "creation_date": 1511065204, "last_edit_date": 1511189479, "question_id": 47373650, "link": "https://stackoverflow.com/questions/47373650/address-alignment-in-go", "title": "Address alignment in Go", "body": "<p>So I am using c2go to link C code with Go. The C code requires certain arguments of a function called from Go to be 256 bit aligned (the function arguments are all pointers to Go variables). Is there a way to achieve this is Go (i.e. to specify 256 alignment for a variable in Go)?</p>\n\n<p>In Go, \"unsafe.Alignof(f)\" shows as 8 bytes aligned (for \"var f [8]float32\") i.e. the f is guaranteed by Go to be only 8 bytes aligned. I need it to be 32 bytes aligned somehow.</p>\n\n<p>For the curious:\nThe C code is using SIMD instructions (AVX to be specific). I was using \"vmovaps\" instruction which requires 256 bit alignment of operands. I can get away with using \"vmovups\" which doesn't require alignment, but I suspect that has a performance penalty.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 69229, "user_id": 53341, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/98geJ.png?s=128&g=1", "display_name": "MatBailie", "link": "https://stackoverflow.com/users/53341/matbailie"}, "edited": false, "score": 1, "creation_date": 1511059018, "post_id": 47372678, "comment_id": 81698895, "body": "The difference would be that your suggestion requires: walking one tree and storing the results in a list or some such, then walking the other tree and storing the results in a list or some such, and then comparing the lists.  In the Go example, using channels, you can have one &quot;thread&quot; walking one tree and another &quot;thread&quot; walking the other tree, then compare the results as the pop out of their respective channels.  Note that each thread only &quot;stores&quot; one value on its channel, it blocks/waits until that value is received and then carries on."}, {"owner": {"reputation": 32100, "user_id": 1033581, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/e8891617e36b8d1254eb3ce1a5662da4?s=128&d=identicon&r=PG", "display_name": "C\u0153ur", "link": "https://stackoverflow.com/users/1033581/c%c5%93ur"}, "edited": false, "score": 0, "creation_date": 1541314935, "post_id": 47372678, "comment_id": 93169370, "body": "Please <a href=\"https://stackoverflow.com/posts/47372678/edit\">edit</a> the typo in your title, thank you."}], "answers": [{"comments": [{"owner": {"reputation": 21398, "user_id": 1136700, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/e484894210178f84679e4e35695ff8ac?s=128&d=identicon&r=PG", "display_name": "Adam Lee", "link": "https://stackoverflow.com/users/1136700/adam-lee"}, "edited": false, "score": 0, "creation_date": 1511083658, "post_id": 47375314, "comment_id": 81703067, "body": "We just use preorder to traverse the tree, then sort the result list, before comparing. I still don&#39;t see why it is complex."}], "tags": [], "owner": {"reputation": 2221, "user_id": 7359810, "user_type": "registered", "accept_rate": 88, "profile_image": "https://lh3.googleusercontent.com/-8MngnLBsx3E/AAAAAAAAAAI/AAAAAAAAetc/OsGMMV3Set4/photo.jpg?sz=128", "display_name": "Neha", "link": "https://stackoverflow.com/users/7359810/neha"}, "is_accepted": false, "score": 0, "last_activity_date": 1511083059, "creation_date": 1511083059, "answer_id": 47375314, "question_id": 47372678, "link": "https://stackoverflow.com/questions/47372678/about-equivalent-binary-tree-probelm/47375314#47375314", "title": "About &quot;Equivalent Binary Tree&quot; probelm", "body": "<p>It's implicit in the problem definition that you're comparing whether two binary search trees contain the same multiset of elements, and while an in-order of a BST will give you the elements in sorted order, the same is not true of any other traversal. E.g. the tree \u00b9\\\u2082 has preorder 12 while the tree \u2081/\u00b2 has preorder 21, despite that both contain the same elements.</p>\n"}], "owner": {"reputation": 21398, "user_id": 1136700, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/e484894210178f84679e4e35695ff8ac?s=128&d=identicon&r=PG", "display_name": "Adam Lee", "link": "https://stackoverflow.com/users/1136700/adam-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 279, "favorite_count": 1, "answer_count": 1, "score": -1, "last_activity_date": 1511083059, "creation_date": 1511052746, "question_id": 47372678, "link": "https://stackoverflow.com/questions/47372678/about-equivalent-binary-tree-probelm", "title": "About &quot;Equivalent Binary Tree&quot; probelm", "body": "<p>I am reading the tour of Go, it has a problem of equivalent binary tree. The article said A function to check whether two binary trees store the same sequence is quite complex in most languages.</p>\n\n<p><a href=\"https://tour.golang.org/concurrency/7\" rel=\"nofollow noreferrer\">https://tour.golang.org/concurrency/7</a></p>\n\n<p>I am a little confused, could we just use any traversal method like inorder traversal the tree and verify the resulted sequence is same. I think it is pretty simple. Anyone could let me know if my understanding is wrong? </p>\n"}, {"tags": ["api", "go", "concurrency", "timeout"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 2, "creation_date": 1511052134, "post_id": 47372590, "comment_id": 81697873, "body": "What is it that you want to be able to time out? Each of those individual calls?"}, {"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1511054921, "post_id": 47372590, "comment_id": 81698304, "body": "<a href=\"https://gobyexample.com/timeouts\" rel=\"nofollow noreferrer\">gobyexample.com/timeouts</a>"}, {"owner": {"reputation": 117, "user_id": 5559718, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/1068554619822559/picture?type=large", "display_name": "jgulacsy", "link": "https://stackoverflow.com/users/5559718/jgulacsy"}, "edited": false, "score": 0, "creation_date": 1511093094, "post_id": 47372590, "comment_id": 81705319, "body": "Yes, I would like to time out each call"}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1511194300, "post_id": 47374369, "comment_id": 81745775, "body": "This would be more idiomatic implemented using <a href=\"https://golang.org/pkg/context/#WithTimeout\" rel=\"nofollow noreferrer\"><code>Context.WithTimeout</code></a>."}], "tags": [], "owner": {"reputation": 71, "user_id": 5740723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91d0b27106df0fe56c512cff8cfdd9c2?s=128&d=identicon&r=PG&f=1", "display_name": "Viraj Parab", "link": "https://stackoverflow.com/users/5740723/viraj-parab"}, "is_accepted": false, "score": 1, "last_activity_date": 1511074006, "creation_date": 1511074006, "answer_id": 47374369, "question_id": 47372590, "link": "https://stackoverflow.com/questions/47372590/go-timeouts-with-concurrent-methods/47374369#47374369", "title": "Go timeouts with concurrent methods", "body": "<p>You can use something called as circuit breaker design, if you want to be full proof and robust refer: \n- <a href=\"https://godoc.org/github.com/rubyist/circuitbreaker\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/rubyist/circuitbreaker</a>\n- <a href=\"https://martinfowler.com/bliki/CircuitBreaker.html\" rel=\"nofollow noreferrer\">https://martinfowler.com/bliki/CircuitBreaker.html</a></p>\n\n<p>OR</p>\n\n<p>create something like this:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"time\"\n\nfunc apiCall(u string, checked chan&lt;- bool) {\n    time.Sleep(4 * time.Second)\n    checked &lt;- true\n}\n\n\nfunc call(urls []string) bool {\n\n    ch := make(chan bool, 1)\n    for _, url := range urls {\n        go func(u string) {\n            checked := make(chan bool)\n            go apiCall(u, checked)\n            select {\n            case ret := &lt;-checked:\n                ch &lt;- ret\n            case &lt;-time.After(5 * time.Second):\n                ch &lt;- false\n            }\n        }(url)\n    }\n    return &lt;-ch\n}\n\nfunc main() {\n    fmt.Println(call([]string{\"url1\"}))\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1511194293, "post_id": 47375584, "comment_id": 81745772, "body": "This would be more idiomatic implemented using <a href=\"https://golang.org/pkg/context/#WithTimeout\" rel=\"nofollow noreferrer\"><code>Context.WithTimeout</code></a>."}], "tags": [], "owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "is_accepted": false, "score": 1, "last_activity_date": 1511086197, "last_edit_date": 1511086197, "creation_date": 1511085415, "answer_id": 47375584, "question_id": 47372590, "link": "https://stackoverflow.com/questions/47372590/go-timeouts-with-concurrent-methods/47375584#47375584", "title": "Go timeouts with concurrent methods", "body": "<p>Study <code>anyCall()</code> function all the magic is in it :)\nHere I'm assuming you want reply from either of 1 of 3 calls or timeout.</p>\n\n<p><a href=\"https://play.golang.org/p/b-XREKSnP1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/b-XREKSnP1</a></p>\n\n\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\nvar sluggishness = 10\n\n// your 3 synchronous unreliable api sources\n// time.Sleep() is hard work of your api backends :)\nfunc apiCall1() string {\n    time.Sleep(time.Second * time.Duration(rand.Intn(sluggishness)))\n    return \"api call 1\"\n}\n\nfunc apiCall2() string {\n    time.Sleep(time.Second * time.Duration(rand.Intn(sluggishness)))\n    return \"api call 2\"\n}\n\nfunc apiCall3() string {\n    time.Sleep(time.Second * time.Duration(rand.Intn(sluggishness)))\n    return \"api call 3\"\n}\n\n// apiCall makes 3 calls concurrently and returns first\nfunc anyCall() string {\n    // our communicaton channels\n    api1ret := make(chan string)\n    api2ret := make(chan string)\n    api3ret := make(chan string)\n\n    // here we fire off 3 api calls concurrently\n    go func() {\n        // call and block till we get reply\n        api1ret &lt;- apiCall1()\n        // close channel after we are done\n        // since we are only sending one value\n        defer close(api1ret)\n    }()\n    go func() {\n        api2ret &lt;- apiCall2()\n        defer close(api2ret)\n    }()\n    go func() {\n        api3ret &lt;- apiCall3()\n        defer close(api3ret)\n    }()\n\n    // select blocks till one of channels unblocks with a value\n    // or time.After() unblocks after 5 sec\n    select {\n    case val := &lt;-api1ret:\n        return val\n\n    case val := &lt;-api2ret:\n        return val\n\n    case val := &lt;-api3ret:\n        return val\n\n    case &lt;-time.After(time.Second * 5):\n        return \"timeout after 5 sec\"\n    }\n}\n\nfunc main() {\n    // make the apiCall 10 times\n    for i := 0; i &lt; 10; i++ {\n        fmt.Println(anyCall())\n    }\n\n    fmt.Println(\"done\")\n}\n</code></pre>\n\n<p>This is simplistic example that assumes that apiCall1/2/3 always eventually return in the reasonable amount of time. You may want a little more complicated scheme for situations where these calls can block for a very long time. Since all the <code>go func()</code> calls will eventually accumulate to a massive leak.</p>\n\n<p>Have fun!</p>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1511194357, "post_id": 47375610, "comment_id": 81745810, "body": "This is the most straightforward solution. This would be my recommendation unless there is some specific reason for the added complexity of the other answers."}], "tags": [], "owner": {"reputation": 721, "user_id": 8930534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0277bb31c0a6d6334cf3d287289bc17?s=128&d=identicon&r=PG&f=1", "display_name": "Hugh", "link": "https://stackoverflow.com/users/8930534/hugh"}, "is_accepted": false, "score": 2, "last_activity_date": 1511085593, "creation_date": 1511085593, "answer_id": 47375610, "question_id": 47372590, "link": "https://stackoverflow.com/questions/47372590/go-timeouts-with-concurrent-methods/47375610#47375610", "title": "Go timeouts with concurrent methods", "body": "<p>If your API calls are http requests, the best way to implement a timeout would be specifying one in the http client itself. That way, the <code>http.Get(url)</code> will timeout and return an error which can be acted on appropriately. The default http client has an extremely long timeout that can cause applications to hang. Read <a href=\"https://medium.com/@nate510/don-t-use-go-s-default-http-client-4804cb19f779\" rel=\"nofollow noreferrer\">this</a> for a good writeup of this.</p>\n\n<p>Here is a sample implementation of <code>apiCall1()</code> that returns an error if one occurs, including a timeout if a response isn't received within 10 seconds.</p>\n\n<pre><code>func apiCall1() error {\n    var netClient = &amp;http.Client{\n        Timeout: time.Second * 10,\n    }\n\n    resp, err := netClient.Get(\"http://someurl.com/apiEndpoint\")\n\n    if err != nil {\n        return err\n    }\n\n    if resp.StatusCode != http.StatusOK {\n        return fmt.Errorf(\"http request returned code %d\", resp.StatusCode)\n    }\n\n    return handleResponse(resp) // Return error if there is one, nil if not.\n}\n\nfunc handleResponse(resp *http.Response) error {\n    ...\n}\n</code></pre>\n\n<p>When you call <code>apiCall1()</code> you can then handle the error however you want.</p>\n\n<pre><code>if err := apiCall1(); err != nil {\n    log.Print(err)\n}\n</code></pre>\n\n<p>The concurrency aspect of the question is a bit unclear, but i'll leave two bullet points with some ideas:</p>\n\n<ul>\n<li><code>go apiCall1()</code> and handle errors/timeouts in the <code>apiCall1()</code> function.</li>\n<li><a href=\"https://play.golang.org/p/klee4hwulN\" rel=\"nofollow noreferrer\">https://play.golang.org/p/klee4hwulN</a> This is not perfect, but illustrates how you could use a <code>WaitGroup</code> to make the calls concurrent.</li>\n</ul>\n"}], "owner": {"reputation": 117, "user_id": 5559718, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/1068554619822559/picture?type=large", "display_name": "jgulacsy", "link": "https://stackoverflow.com/users/5559718/jgulacsy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 435, "favorite_count": 1, "answer_count": 3, "score": 1, "last_activity_date": 1511189495, "creation_date": 1511051759, "last_edit_date": 1511189495, "question_id": 47372590, "link": "https://stackoverflow.com/questions/47372590/go-timeouts-with-concurrent-methods", "title": "Go timeouts with concurrent methods", "body": "<p>I am building a go application that is using some external apis to get data. Unfortunately one of my sources is pretty unreliable, so I would like to implement a timeout function for my api calls, so that my app doesn't get stucked. Unfortunately I don't know how to get started. Could you please help me? Thanks!</p>\n\n<pre><code>go func() {\n        for {\n\n            ch := make(chan bool, 1)\n            defer close(ch)\n\n            apiCall1()\n\n            apiCall2()\n\n            apiCall3()\n        }\n    }()\n</code></pre>\n"}, {"tags": ["mysql", "go", "export", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 688, "user_id": 2355953, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/c8688f0026ddafb8900d37d5d0244217?s=128&d=identicon&r=PG", "display_name": "M1M6", "link": "https://stackoverflow.com/users/2355953/m1m6"}, "is_accepted": false, "score": 0, "last_activity_date": 1511127736, "creation_date": 1511127736, "answer_id": 47382293, "question_id": 47371524, "link": "https://stackoverflow.com/questions/47371524/how-to-export-endpoint-ip-from-service-description-in-kubernetes-go-template/47382293#47382293", "title": "How to export endpoint ip from service description in kubernetes - Go template", "body": "<p>this will get the ip value of mysql service</p>\n\n<pre><code> export PORT=$(kubectl get endpoints -o go-template='{{range.items}}{{if eq .metadata.name \"mysql\"}}{{(index (index .subsets 0).addresses 0).ip}}{{end}}{{end}}')\n</code></pre>\n"}], "owner": {"reputation": 688, "user_id": 2355953, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/c8688f0026ddafb8900d37d5d0244217?s=128&d=identicon&r=PG", "display_name": "M1M6", "link": "https://stackoverflow.com/users/2355953/m1m6"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 122, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1511127736, "creation_date": 1511042520, "last_edit_date": 1511047350, "question_id": 47371524, "link": "https://stackoverflow.com/questions/47371524/how-to-export-endpoint-ip-from-service-description-in-kubernetes-go-template", "title": "How to export endpoint ip from service description in kubernetes - Go template", "body": "<p>i have a service runinig inside kubernetes, and i need to extract the exndpoint ip in environment variable</p>\n\n<p>Here's the informations about the service </p>\n\n<pre><code> kubectl get endpoints\nNAME                ENDPOINTS                                                     AGE\nkubernetes          10.0.2.15:8443                                                5h\nlocations-service   172.17.0.4:8080,172.17.0.5:8080,172.17.0.4:8081 + 1 more...   2h\nmysql               172.17.0.7:3306                                               3h\nphpmyadmin          172.17.0.6:80                                                 5h\n</code></pre>\n\n<p>How i can get the Endpoints value and export it to a variable?\ni tried the following but it's not working </p>\n\n<pre><code>export PORT=$(kubectl describe service  mysql -o go-template='{{range.spec.endpoints}}')\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1511037494, "post_id": 47370489, "comment_id": 81694159, "body": "Just in case &quot;C:\\Projects\\Go\\&quot; is your <code>$GOPATH</code>, you should know that splitting the source files of a <b>single project</b> into multiple dirs that are <b>direct children</b> of <code>$GOPATH&#47;src</code> is not recommended practice. E.g. <code>$GOPATH&#47;src&#47;controllers</code> + <code>$GOPATH&#47;src&#47;views</code> belonging to one and the same project is <b>not ok</b>. While <code>$GOPATH&#47;src&#47;projectname&#47;controllers</code> + <code>$GOPATH&#47;src&#47;projectname&#47;views</code>, is <b>much better</b>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511038125, "post_id": 47370489, "comment_id": 81694359, "body": "Please tell us what exactly the error says when you print it, and also what is the <code>cwd</code> value you get back from <code>os.Getwd</code>."}, {"owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511045424, "post_id": 47370489, "comment_id": 81696519, "body": "@mkopriva Thanks for the tip, I will change my structure after solving this problem."}, {"owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511045435, "post_id": 47370489, "comment_id": 81696524, "body": "@mkopriva Also, my error is <code>html&#47;template: &quot;C:\\\\Projects\\\\Go\\\\src\\\\views\\\\index.html&quot; is undefined</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511045777, "post_id": 47370489, "comment_id": 81696598, "body": "Did you try <code>template.Execute(w, nil)</code> instead of <code>template.ExecuteTemplate(...</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511046024, "post_id": 47370489, "comment_id": 81696666, "body": "Also if you do <code>template, err := template.ParseFiles</code>, you&#39;ve just declared a new value for the <code>template</code> identifier, meaning that after that line, inside that function, you do not have access to the <code>template</code> package anymore, and you also unnecessarily confuse other developers that might read your code. Instead use a different name for the <code>*template.Template</code> instance variable, like <code>t</code>, or <code>tmpl</code>, or something, just not the package name, that&#39;s too a bad practice."}, {"owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1511046604, "post_id": 47370489, "comment_id": 81696788, "body": "@mkopriva changing it to <code>template.Execute(w, nil)</code> fixed the problem which is strange because the original code worked before I changed the structure. Thank you for the tips too."}], "answers": [{"comments": [{"owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "edited": false, "score": 0, "creation_date": 1511045546, "post_id": 47370574, "comment_id": 81696556, "body": "This makes it attempt to look for <code>C:\\Projects\\Go\\views\\index.html</code> bypassing the <code>src</code> folder."}], "tags": [], "owner": {"reputation": 50, "user_id": 8948102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a347dede705b4efbd263b62cbbdc197?s=128&d=identicon&r=PG&f=1", "display_name": "kkj", "link": "https://stackoverflow.com/users/8948102/kkj"}, "is_accepted": false, "score": 0, "last_activity_date": 1511036020, "creation_date": 1511036020, "answer_id": 47370574, "question_id": 47370489, "link": "https://stackoverflow.com/questions/47370489/cannot-find-html-file-from-another-folder/47370574#47370574", "title": "Cannot find html file from another folder", "body": "<p>You need to use two dots, for one directory up.</p>\n\n<pre><code>\"../views/index.html\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1511046959, "creation_date": 1511046959, "answer_id": 47372099, "question_id": 47370489, "link": "https://stackoverflow.com/questions/47370489/cannot-find-html-file-from-another-folder/47372099#47372099", "title": "Cannot find html file from another folder", "body": "<p>The first part of the problem is that you're using <code>ParseFiles</code>, which uses the <strong>base</strong> name of the first file to set the returned <code>*template.Template</code>'s name.</p>\n\n<p>From the docs:</p>\n\n<blockquote>\n  <p>ParseFiles creates a new Template and parses the template definitions\n  from the named files. The returned template's name will have the\n  (base) name and (parsed) contents of the first file.</p>\n</blockquote>\n\n<p>The second part is that you're using <code>ExecuteTemplate</code> passing the full path as the second argument while the docs say that its second argument should be the <strong>name</strong> of the template to execute.</p>\n\n<p>the docs:</p>\n\n<blockquote>\n  <p>ExecuteTemplate applies the template associated with t that has the\n  given name to the specified data object and writes the output to wr.</p>\n</blockquote>\n\n<p>Couple ways to fix this:</p>\n\n<pre><code>// the name of t becomes the base of first file, which is \"index.html\"\nt, err := template.ParseFiles(filepath.Join(cwd, \"./views/index.html\"), filepath.Join(cwd, \"./views/header.html\"))\nutils.CheckErr(err)\nw.Header().Set(\"Content-Type\", \"text/html; charset=utf-8\")\n// use the base name of the first file from ParseFiles\nerr = t.ExecuteTemplate(w, \"index.html\", nil)\nutils.CheckErr(err)\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>// specify desired name using New\nt, err := template.New(\"my_template\").ParseFiles(filepath.Join(cwd, \"./views/index.html\"), filepath.Join(cwd, \"./views/header.html\"))\nutils.CheckErr(err)\nw.Header().Set(\"Content-Type\", \"text/html; charset=utf-8\")\n// use the name specified with New\nerr = t.ExecuteTemplate(w, \"my_template\", nil)\nutils.CheckErr(err)\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>// don't care about name because we'll use Execute instead of ExecuteTemplate\nt, err := template.ParseFiles(filepath.Join(cwd, \"./views/index.html\"), filepath.Join(cwd, \"./views/header.html\"))\nutils.CheckErr(err)\nw.Header().Set(\"Content-Type\", \"text/html; charset=utf-8\")\n// call Execute\nerr = t.Execute(w, nil)\nutils.CheckErr(err)\n</code></pre>\n\n<p>Read more:</p>\n\n<ul>\n<li><a href=\"https://golang.org/pkg/html/template/#New\" rel=\"nofollow noreferrer\">https://golang.org/pkg/html/template/#New</a></li>\n<li><a href=\"https://golang.org/pkg/html/template/#ParseFiles\" rel=\"nofollow noreferrer\">https://golang.org/pkg/html/template/#ParseFiles</a></li>\n<li><a href=\"https://golang.org/pkg/html/template/#Template.ParseFiles\" rel=\"nofollow noreferrer\">https://golang.org/pkg/html/template/#Template.ParseFiles</a></li>\n<li><a href=\"https://golang.org/pkg/html/template/#Template.Execute\" rel=\"nofollow noreferrer\">https://golang.org/pkg/html/template/#Template.Execute</a></li>\n<li><a href=\"https://golang.org/pkg/html/template/#Template.ExecuteTemplate\" rel=\"nofollow noreferrer\">https://golang.org/pkg/html/template/#Template.ExecuteTemplate</a></li>\n</ul>\n"}], "owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 288, "favorite_count": 0, "accepted_answer_id": 47372099, "answer_count": 2, "score": 1, "last_activity_date": 1511046959, "creation_date": 1511035447, "question_id": 47370489, "link": "https://stackoverflow.com/questions/47370489/cannot-find-html-file-from-another-folder", "title": "Cannot find html file from another folder", "body": "<p>I've recently changed the file structure of my project and now I cannot seem to get my html files to load properly.</p>\n\n<p>I have followed the advice of a couple of different answers on this similar topic to no avail.</p>\n\n<p>In regards to file structure, <code>getIndexPageHandler</code> is in <code>src/controllers/index.go</code> and <code>index.html</code> is in <code>src/views/index.html</code></p>\n\n<p>Also, when I use <code>fmt.Println(filepath.Join(cwd, \"./views/index.html\"))</code> it returns <code>C:\\Projects\\Go\\src\\views\\index.html</code></p>\n\n<p>This confuses me, that's the direct path of the file so why is it telling me that index.html cannot be found whenever I try to navigate to it? Also I didn't post the router that calls this on the <code>/index</code> route but this exact block of code worked before when the html files were in the same directory as my controller files so I believe the error is in this block.</p>\n\n<pre><code>func getIndexPageHandler(w http.ResponseWriter, r *http.Request) {\n    cwd, err := os.Getwd()\n\n    utils.CheckErr(err)\n\n    template, err := template.ParseFiles(filepath.Join(cwd, \"./views/index.html\"), filepath.Join(cwd, \"./views/header.html\"))\n\n    utils.CheckErr(err)\n\n    w.Header().Set(\"Content-Type\", \"text/html; charset=utf-8\")\n\n    err = template.ExecuteTemplate(w, filepath.Join(cwd, \"./views/index.html\"), nil)\n\n    utils.CheckErr(err)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "edited": false, "score": 2, "creation_date": 1511030247, "post_id": 47369621, "comment_id": 81691807, "body": "&quot;Holds installed package objects&quot;... You didn&#39;t research your question?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1511030343, "post_id": 47369621, "comment_id": 81691853, "body": "<a href=\"https://golang.org/doc/code.html#Workspaces\" rel=\"nofollow noreferrer\">golang.org/doc/code.html#Workspaces</a>"}, {"owner": {"reputation": 2338, "user_id": 2570189, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/FlQvh.jpg?s=128&g=1", "display_name": "dvsakgec", "link": "https://stackoverflow.com/users/2570189/dvsakgec"}, "edited": false, "score": 3, "creation_date": 1511032424, "post_id": 47369621, "comment_id": 81692532, "body": "I researched the pkg details but could not grasp the concept of package objects"}], "answers": [{"comments": [{"owner": {"reputation": 2338, "user_id": 2570189, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/FlQvh.jpg?s=128&g=1", "display_name": "dvsakgec", "link": "https://stackoverflow.com/users/2570189/dvsakgec"}, "edited": false, "score": 0, "creation_date": 1511034652, "post_id": 47369867, "comment_id": 81693239, "body": "So does this mean that packages other than main should go there"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 2338, "user_id": 2570189, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/FlQvh.jpg?s=128&g=1", "display_name": "dvsakgec", "link": "https://stackoverflow.com/users/2570189/dvsakgec"}, "edited": false, "score": 1, "creation_date": 1511035355, "post_id": 47369867, "comment_id": 81693440, "body": "@dvsakgec: Yes. An executable command has one and only one <code>main</code> package. It is linked with other imported packages from the <code>pkg</code> directory to form the exectable in the <code>bin</code> directory. Packages other than <code>main</code> are compiled to object form and stored in the <code>pkg</code> directory, which is searched at link time for imported packages."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 22, "last_activity_date": 1511031901, "last_edit_date": 1511031901, "creation_date": 1511031578, "answer_id": 47369867, "question_id": 47369621, "link": "https://stackoverflow.com/questions/47369621/what-is-the-use-of-pkg-directory-in-go/47369867#47369867", "title": "What is the use of pkg directory in Go?", "body": "<p>The <code>pkg</code> directory contains Go package objects compiled from <code>src</code> directory Go source code packages, which are then used, at link time, to create the complete Go executable binary in the <code>bin</code> directory.</p>\n\n<p>We can compile a package once, but link that object into many executables. For example, the <code>fmt</code> package appears in almost every Go program. It's compiled once but linked many times, a big saving.</p>\n"}, {"tags": [], "owner": {"reputation": 14451, "user_id": 1334561, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LhV7w.jpg?s=128&g=1", "display_name": "Muhammad Soliman", "link": "https://stackoverflow.com/users/1334561/muhammad-soliman"}, "is_accepted": false, "score": 4, "last_activity_date": 1541566059, "creation_date": 1541566059, "answer_id": 53183702, "question_id": 47369621, "link": "https://stackoverflow.com/questions/47369621/what-is-the-use-of-pkg-directory-in-go/53183702#53183702", "title": "What is the use of pkg directory in Go?", "body": "<p>You put your source code in <code>src</code> directory while <code>pkg</code> is the directory that holds compilation output of your actual source code. If you use multiple libraries/packages you will have different output with extension <code>.a</code> for each one, A <code>linker</code> should be responsible for linking and combining all of them together to produce one final executable in <code>bin</code> directory. </p>\n\n<p>As <code>pkg</code> and <code>bin</code> are more specific to the machine or operating system into which you build your actual source code so it is not recommended to share both of them, your repo should have only your actual code. </p>\n\n<p>A side note, if you plan to use docker containers, <code>pkg</code> dir should be ignored as we may build the source code in <code>windows</code> for example while you <code>import/mount</code> your code into <code>linux</code> container; at this time <code>pkg</code> will have compiled files that are only valid for <code>windows</code></p>\n"}, {"tags": [], "owner": {"reputation": 788, "user_id": 4883754, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aDyV2.png?s=128&g=1", "display_name": "kyakya", "link": "https://stackoverflow.com/users/4883754/kyakya"}, "is_accepted": false, "score": -1, "last_activity_date": 1599152426, "creation_date": 1599152426, "answer_id": 63728388, "question_id": 47369621, "link": "https://stackoverflow.com/questions/47369621/what-is-the-use-of-pkg-directory-in-go/63728388#63728388", "title": "What is the use of pkg directory in Go?", "body": "<h3><code>~/go/pkg</code></h3>\n<p>From <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a>, we know <code>~/go/pkg</code> can store third party library. For example:</p>\n<ol>\n<li>Create two file <code>main.go</code> and <code>go.mod</code>:</li>\n</ol>\n<pre><code>//main.go\npackage main\n\nimport (\n    &quot;fmt&quot;\n    &quot;github.com/google/go-cmp/cmp&quot;\n)\n\nfunc main() {\n    fmt.Println(cmp.Diff(&quot;Hello World&quot;, &quot;Hello Go&quot;))\n}\n</code></pre>\n<pre><code>//go.mod\nmodule example.com/user/hello\n\ngo 1.13\n</code></pre>\n<ol start=\"2\">\n<li>Install a third party library</li>\n</ol>\n<pre><code>$ ls ~/go/pkg/mod/github.com/google/\n...\n\n$ go install example.com/user/hello\ngo: finding github.com/google/go-cmp v0.5.2\ngo: downloading github.com/google/go-cmp v0.5.2\ngo: extracting github.com/google/go-cmp v0.5.2\n\n$ ls ~/go/pkg/mod/github.com/google/\n... go-cmp@v0.5.2\n\n$ ls ~/go/pkg/mod/github.com/google/go-cmp@v0.5.2\n</code></pre>\n<p>And then, you will see a lot of go files, not compile files.</p>\n<pre><code>$ ls ~/go/pkg/mod/github.com/google/go-cmp@v0.5.2/cmp/\n...  example_test.go   options.go   ...\n</code></pre>\n<h3><code>pkg</code> in user project</h3>\n<p>This <code>pkg</code> is a directory/package of user project. You can see it as Library and it's OK to use by external applications. For more things, you can check <a href=\"https://github.com/golang-standards/project-layout\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 2338, "user_id": 2570189, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/FlQvh.jpg?s=128&g=1", "display_name": "dvsakgec", "link": "https://stackoverflow.com/users/2570189/dvsakgec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10434, "favorite_count": 3, "answer_count": 3, "score": 20, "last_activity_date": 1599152426, "creation_date": 1511029920, "last_edit_date": 1511189600, "question_id": 47369621, "link": "https://stackoverflow.com/questions/47369621/what-is-the-use-of-pkg-directory-in-go", "title": "What is the use of pkg directory in Go?", "body": "<p>If we have bin directory already where executables go then what is the need of pkg directory? Please explain.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1511190624, "post_id": 47369397, "comment_id": 81743238, "body": "A mutex should be locked &amp; unlocked from the same code block if at all possible."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 7659236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab271059d2d5a5a2b519f0fa12098311?s=128&d=identicon&r=PG&f=1", "display_name": "tiango", "link": "https://stackoverflow.com/users/7659236/tiango"}, "edited": false, "score": 0, "creation_date": 1511031297, "post_id": 47369692, "comment_id": 81692179, "body": "Thank you, i may have misled by sync.Cond.wait(). When goroutines is waiting, it not block other goroutines.I will change my code try again."}, {"owner": {"reputation": 21, "user_id": 7659236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab271059d2d5a5a2b519f0fa12098311?s=128&d=identicon&r=PG&f=1", "display_name": "tiango", "link": "https://stackoverflow.com/users/7659236/tiango"}, "edited": false, "score": 0, "creation_date": 1511032493, "post_id": 47369692, "comment_id": 81692554, "body": "Can not, i tried it. The same is not secure, it is a strange thing.Maybe I should go more in-depth study Mutex and Goroutines"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 21, "user_id": 7659236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab271059d2d5a5a2b519f0fa12098311?s=128&d=identicon&r=PG&f=1", "display_name": "tiango", "link": "https://stackoverflow.com/users/7659236/tiango"}, "edited": false, "score": 2, "creation_date": 1511036136, "post_id": 47369692, "comment_id": 81693717, "body": "@tiango: A common method to manage goroutines is a <code>sync.WaitGroup</code> with <code>Add</code>, <code>Wait</code>, and <code>Done</code> methods. See the Go Tour section on concurrency: <a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">tour.golang.org</a>"}, {"owner": {"reputation": 21, "user_id": 7659236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab271059d2d5a5a2b519f0fa12098311?s=128&d=identicon&r=PG&f=1", "display_name": "tiango", "link": "https://stackoverflow.com/users/7659236/tiango"}, "edited": false, "score": 0, "creation_date": 1511075647, "post_id": 47369692, "comment_id": 81701613, "body": "Thank your help, i&#39;m so fool, i confuse the synchronization lock and the mutex. Thank you very much again."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1511030647, "last_edit_date": 1511030647, "creation_date": 1511030343, "answer_id": 47369692, "question_id": 47369397, "link": "https://stackoverflow.com/questions/47369397/in-golang-how-do-i-protect-my-own-lock-safe-from-being-destroyed-by-the-caller/47369692#47369692", "title": "In golang, how do I protect my own lock safe from being destroyed by the caller?", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">Exported identifiers</a></p>\n  \n  <p>An identifier may be exported to permit access to it from another\n  package. An identifier is exported if both:</p>\n  \n  <ul>\n  <li>the first character of the identifier's name is a Unicode upper case letter (Unicode class \"Lu\"); and</li>\n  <li>the identifier is declared in the package block or it is a field name or method name.</li>\n  </ul>\n  \n  <p>All other identifiers are not exported.</p>\n</blockquote>\n\n<p>Put the function in its own package and don't export the mutex. For example.</p>\n\n<pre><code>package b\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nvar mutex sync.Mutex\n\nfunc B(i int) {\n    mutex.Lock()\n    fmt.Println(i)\n    mutex.Unlock()\n}\n</code></pre>\n\n<p>To use,</p>\n\n<pre><code>package a\n\nimport \"b\"\n\nfunc a() {\n    for i := 0; i &lt; 10; i++ {\n        go b.B(i)\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1511031224, "post_id": 47369694, "comment_id": 81692151, "body": "Won&#39;t this destroy the lock? <code>func a() { for i := 0; i &lt; 10; i++ { go b(&amp;mutex, i); mutex.Unlock() } }</code>"}, {"owner": {"reputation": 21, "user_id": 7659236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab271059d2d5a5a2b519f0fa12098311?s=128&d=identicon&r=PG&f=1", "display_name": "tiango", "link": "https://stackoverflow.com/users/7659236/tiango"}, "edited": false, "score": 0, "creation_date": 1511032703, "post_id": 47369694, "comment_id": 81692622, "body": "@Andy Haskell You are right. Other question, &quot;sync.Cond.wait()&quot;  not block other goroutines. I think it is a strange thing.Maybe I should go more in-depth study Mutex and Goroutines. Why the mutex cannot guarantee the safety of the method? How can I better understand golang lock?"}, {"owner": {"reputation": 597, "user_id": 515320, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/56bb98d5e22200a138bbcbf68047cb6f?s=128&d=identicon&r=PG", "display_name": "Andy Haskell", "link": "https://stackoverflow.com/users/515320/andy-haskell"}, "reply_to_user": {"reputation": 21, "user_id": 7659236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab271059d2d5a5a2b519f0fa12098311?s=128&d=identicon&r=PG&f=1", "display_name": "tiango", "link": "https://stackoverflow.com/users/7659236/tiango"}, "edited": false, "score": 0, "creation_date": 1511033748, "post_id": 47369694, "comment_id": 81692966, "body": "@tiango I&#39;ve never used a sync.Cond before. I use Go on the job and the parts of concurrency I use regularly are <code>Mutex</code>, <code>RWMutex</code>, <code>WaitGroup</code>, and channels (which internally use a mutex). This is a good post on understanding WaitGroups <a href=\"https://medium.com/@matryer/very-basic-concurrency-for-beginners-in-go-663e63c6ba07\" rel=\"nofollow noreferrer\">medium.com/@matryer/&hellip;</a> and this post has an example of mutexes <a href=\"https://gobyexample.com/mutexes\" rel=\"nofollow noreferrer\">gobyexample.com/mutexes</a>. Where are you on learning Go right now, and have you used concurrency in other languages?"}, {"owner": {"reputation": 597, "user_id": 515320, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/56bb98d5e22200a138bbcbf68047cb6f?s=128&d=identicon&r=PG", "display_name": "Andy Haskell", "link": "https://stackoverflow.com/users/515320/andy-haskell"}, "edited": false, "score": 0, "creation_date": 1511034344, "post_id": 47369694, "comment_id": 81693152, "body": "Btw updated the code in my example to add a WaitGroup"}, {"owner": {"reputation": 21, "user_id": 7659236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab271059d2d5a5a2b519f0fa12098311?s=128&d=identicon&r=PG&f=1", "display_name": "tiango", "link": "https://stackoverflow.com/users/7659236/tiango"}, "edited": false, "score": 0, "creation_date": 1511075685, "post_id": 47369694, "comment_id": 81701622, "body": "@AndyHaskell Thank your help, i&#39;m so fool, i confuse the synchronization lock and the mutex. Thank you very much again."}], "tags": [], "owner": {"reputation": 597, "user_id": 515320, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/56bb98d5e22200a138bbcbf68047cb6f?s=128&d=identicon&r=PG", "display_name": "Andy Haskell", "link": "https://stackoverflow.com/users/515320/andy-haskell"}, "is_accepted": false, "score": 0, "last_activity_date": 1511034312, "last_edit_date": 1511034312, "creation_date": 1511030353, "answer_id": 47369694, "question_id": 47369397, "link": "https://stackoverflow.com/questions/47369397/in-golang-how-do-i-protect-my-own-lock-safe-from-being-destroyed-by-the-caller/47369694#47369694", "title": "In golang, how do I protect my own lock safe from being destroyed by the caller?", "body": "<p>In the first example, all the calls to <code>go b(i)</code> are called in <code>a</code>'s loop, but the loop can be finished before any of the goroutines have a chance to start, so if main returns, then all those goroutines stop.</p>\n\n<p>In the second example, the mutex locks and doesn't unlock until <code>Unlock</code> is called in each of the <code>b</code> goroutines. The result is that the calls are completely sequential since each iteration of the loop in <code>a</code> can't start until the last iteration's <code>b</code> goroutine finishes and calls <code>Unlock</code>.</p>\n\n<p>A better practice in Go would be for your b function to take in a pointer to the mutex along with the number passed in, so in your original example it would look like:</p>\n\n<pre><code>//caller use\nfunc a() {\n    var wg sync.WaitGroup\n    for i := 0; i &lt; 10; i++ {\n        wg.Add(1)\n        go func() {\n            defer wg.Done()\n            b(&amp;mutex, i)\n        }()\n    }\n    wg.Wait()\n}\n\n//My func\nfunc b(mutex *sync.Mutex, i int) {\n    mutex.Lock()\n    fmt.Println(i)\n    mutex.Unlock()\n}\n</code></pre>\n\n<p>Which would remove reliance on a global variable and also guarantee that all calls to <code>b</code> are using the exact same mutex since we pass in a pointer to one mutex</p>\n"}], "owner": {"reputation": 21, "user_id": 7659236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab271059d2d5a5a2b519f0fa12098311?s=128&d=identicon&r=PG&f=1", "display_name": "tiango", "link": "https://stackoverflow.com/users/7659236/tiango"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 447, "favorite_count": 1, "answer_count": 2, "score": -4, "last_activity_date": 1511034706, "creation_date": 1511028622, "last_edit_date": 1511034706, "question_id": 47369397, "link": "https://stackoverflow.com/questions/47369397/in-golang-how-do-i-protect-my-own-lock-safe-from-being-destroyed-by-the-caller", "title": "In golang, how do I protect my own lock safe from being destroyed by the caller?", "body": "<p>I try use \"sync.mutex\" protect my func,but i found that the lock still uses the caller to destroy it.</p>\n\n<pre><code>var mutex sync.mutex\n</code></pre>\n\n<p>This is error:</p>\n\n<pre><code>//caller use\nfunc a() {\n    for i := 0; i &lt; 10; i++ {\n        go b(i)\n    }\n}\n\n//My func\nfunc b(i int) {\n    mutex.Lock()\n    fmt.Println(i)\n    mutex.Unlock()\n}\n</code></pre>\n\n<p>this is success,but destroyed my encapsulation method:</p>\n\n<pre><code>//caller use\nfunc a() {\n    for i := 0; i &lt; 10; i++ {\n        mutex.Lock()\n        go b(i)\n    }\n}\n\n//my func\nfunc b(i int) {\n    fmt.Println(i)\n    mutex.Unlock()\n}\n</code></pre>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "concurrency", "parallel-processing", "compilation", "gccgo"], "comments": [{"owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1511160660, "post_id": 47366651, "comment_id": 81725767, "body": "Can you tell the command line used with <code>gc</code> &amp; <code>gccgo</code>?"}, {"owner": {"reputation": 196, "user_id": 6008146, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YbpxZ.png?s=128&g=1", "display_name": "JumpAlways", "link": "https://stackoverflow.com/users/6008146/jumpalways"}, "reply_to_user": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "edited": false, "score": 0, "creation_date": 1511189277, "post_id": 47366651, "comment_id": 81742378, "body": "@LeMoussel <code>go build &lt;srcfile&gt;.go</code> and <code>go build -compiler gccgo &lt;srcfile&gt;.go</code>"}], "owner": {"reputation": 196, "user_id": 6008146, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YbpxZ.png?s=128&g=1", "display_name": "JumpAlways", "link": "https://stackoverflow.com/users/6008146/jumpalways"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 132, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1511022381, "creation_date": 1511011767, "last_edit_date": 1511022381, "question_id": 47366651, "link": "https://stackoverflow.com/questions/47366651/concurrency-problems-with-gccgo", "title": "Concurrency problems with gccgo", "body": "<p>I've just landed in the the GO-sphere, so, as usually, I'm trying to implement some of the classics in the new language to make some comparison.</p>\n\n<p>I'm experiencing a strange situation with the Montecarlo Simulation for PI, using concurrency:</p>\n\n<ul>\n<li>when I compile the code using <code>gc</code>, for any number of events value (<code>nevents</code>) I provided all the goroutines starts simultaneously and all works as expected (even if <em>\"concurrency is not parallelism\"</em>, I know)</li>\n<li>when I compile the code using <code>gccgo</code>, it works as above when <code>nevents</code> is less or equal than ~10.000.000, but for bigger values each goroutine starts when the previous one has almost finished and this behaviour is more obvious the bigger <code>nvalues</code> gets (~100.000.000)</li>\n</ul>\n\n<p>What am I missing? Be good, It's my first week with Go!</p>\n\n<p><br>\nHere's the code:</p>\n\n<pre><code>package main\n\nimport (\"os\"\n        \"fmt\"\n        \"log\"\n        \"strconv\"\n        \"math\"\n        \"math/rand\"\n        \"time\"\n)\n\nvar (ncpus         int     = 2\n     threadspercpu int     = 2\n     ngophers      int     = ncpus*threadspercpu\n     rayu          float64 = 1.0\n)\n\nfunc montecarlo(returnvalues chan int, gevents int, id int) {\n    // debug\n           fmt.Println(\"goroutine started\")\n    randgen := rand.New(rand.NewSource(time.Now().UnixNano() + \n               int64(id*id + 1)))\n    insidecircle := 0\n    for i := 0; i &lt; gevents; i++ {\n        if (math.Pow(randgen.Float64(), 2.0) +\n            math.Pow(randgen.Float64(), 2.0)) &lt; rayu {\n            insidecircle++\n        }\n    }\n\n    // debug {\n           time.Sleep(time.Duration(id)*time.Second)\n           fmt.Println(\"goroutine finished\")\n    // }\n    returnvalues &lt;- insidecircle\n}\n\nfunc main() {\n    arg := os.Args[1]\n    nevents64, err := strconv.ParseInt(arg, 10, 32)\n    if (err != nil || nevents64 &lt; 1) {\n        log.Fatalf(\"Invalid number of cases provided: '%s'\", arg)\n    }\n    nevents      := int(nevents64)\n    returnvalues := make(chan int)\n    gopherevents := nevents / ngophers\n\n    for i := 0; i &lt; ngophers-1; i++ {\n        go montecarlo(returnvalues, gopherevents, i)\n    }\n    remaining := gopherevents + (nevents % ngophers)\n    go montecarlo(returnvalues, remaining, ngophers-1)\n\n    insidecircle_events := 0\n    for i := 0; i &lt; ngophers; i++ {\n        insidecircle_events += &lt;- returnvalues\n    }\n\n    fmt.Println(\"pi: \", (float64(insidecircle_events) / \n                         float64(nevents) * 4))\n}\n</code></pre>\n\n<p>I've added a time delay to facilitate the debugging.</p>\n"}, {"tags": ["docker", "go"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 8961783, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550d97d2d337ddb8b0f9cb41c60511aa?s=128&d=identicon&r=PG&f=1", "display_name": "fflost", "link": "https://stackoverflow.com/users/8961783/fflost"}, "edited": false, "score": 0, "creation_date": 1511001568, "post_id": 47365037, "comment_id": 81682962, "body": "can this handle regex somehow?"}, {"owner": {"reputation": 50397, "user_id": 1318694, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JPEVC.png?s=128&g=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/1318694/matt"}, "reply_to_user": {"reputation": 33, "user_id": 8961783, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550d97d2d337ddb8b0f9cb41c60511aa?s=128&d=identicon&r=PG&f=1", "display_name": "fflost", "link": "https://stackoverflow.com/users/8961783/fflost"}, "edited": false, "score": 0, "creation_date": 1511001967, "post_id": 47365037, "comment_id": 81683073, "body": "Not that I&#39;m aware of, but I don&#39;t know a whole lot of Go. It&#39;s possible to add custom functions if you have access to the Go code but it looks like we are stuck with whatever Docker provides for <code>--format</code>."}, {"owner": {"reputation": 33, "user_id": 8961783, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550d97d2d337ddb8b0f9cb41c60511aa?s=128&d=identicon&r=PG&f=1", "display_name": "fflost", "link": "https://stackoverflow.com/users/8961783/fflost"}, "edited": false, "score": 0, "creation_date": 1511075578, "post_id": 47365037, "comment_id": 81701599, "body": "How can I get the numbers of entries that match (from my example desired output would be 2)?"}, {"owner": {"reputation": 50397, "user_id": 1318694, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JPEVC.png?s=128&g=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/1318694/matt"}, "reply_to_user": {"reputation": 33, "user_id": 8961783, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550d97d2d337ddb8b0f9cb41c60511aa?s=128&d=identicon&r=PG&f=1", "display_name": "fflost", "link": "https://stackoverflow.com/users/8961783/fflost"}, "edited": false, "score": 0, "creation_date": 1511136452, "post_id": 47365037, "comment_id": 81719487, "body": "pipe the output into <code>grep -c</code> or <code>wc -l</code> if you use a new line as a delimiter. The other option would be to add a counter that increments inside the <code>if</code>."}], "tags": [], "owner": {"reputation": 50397, "user_id": 1318694, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JPEVC.png?s=128&g=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/1318694/matt"}, "is_accepted": true, "score": 2, "last_activity_date": 1511002450, "last_edit_date": 1511002450, "creation_date": 1511001161, "answer_id": 47365037, "question_id": 47364777, "link": "https://stackoverflow.com/questions/47364777/docker-inspect-how-to-select-only-certain-keys-from-range/47365037#47365037", "title": "docker inspect: how to select only certain keys from range", "body": "<p>The <a href=\"https://golang.org/pkg/text/template/#hdr-Functions\" rel=\"nofollow noreferrer\">Go template functions are available in golang docco</a> </p>\n\n<p><code>eq</code> can test if <code>arg1</code> == <code>arg2</code>.<br> \n<code>printf \"%.3s\" $k</code> will give you the first 3 chars of a string. </p>\n\n<pre><code>docker image inspect \\\n  --format='{{ range $k,$v:=.Config.Labels }}{{ if eq (printf \"%.3s\" $k) \"css\" }}{{ $k }}:{{ $v }} {{end}}{{end}}' \\\n  IMAGE\n</code></pre>\n\n<p>You might want to look at the querying the Docker API <a href=\"https://docs.docker.com/engine/api/v1.32/#operation/ImageInspect\" rel=\"nofollow noreferrer\">images endpoint</a> <code>/images/IMAGE/json</code> directly or processing the JSON output somewhere if you need to do any more advanced processing:</p>\n\n<pre><code>docker image inspect \\\n  --format='{{json .Config.Labels}}' \\\n  IMAGE\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 33, "user_id": 8961783, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550d97d2d337ddb8b0f9cb41c60511aa?s=128&d=identicon&r=PG&f=1", "display_name": "fflost", "link": "https://stackoverflow.com/users/8961783/fflost"}, "edited": false, "score": 0, "creation_date": 1511005529, "post_id": 47365207, "comment_id": 81684016, "body": "I tried to use index in the beginning but could figure out how to do css* for example:     docker image inspect --format &#39;{{ index .Config.Labels &quot;css&quot; }}&#39; labels-test"}], "tags": [], "owner": {"reputation": 23608, "user_id": 2915097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91318014af3b3d389901d50d5f9276d5?s=128&d=identicon&r=PG&f=1", "display_name": "user2915097", "link": "https://stackoverflow.com/users/2915097/user2915097"}, "is_accepted": false, "score": 0, "last_activity_date": 1511013339, "last_edit_date": 1511013339, "creation_date": 1511002382, "answer_id": 47365207, "question_id": 47364777, "link": "https://stackoverflow.com/questions/47364777/docker-inspect-how-to-select-only-certain-keys-from-range/47365207#47365207", "title": "docker inspect: how to select only certain keys from range", "body": "<p>You can do something like</p>\n\n<p><code>docker inspect --format='{{index (index (.Config.Labels)).css1 }}' labels-test</code></p>\n\n<p>which shows for me</p>\n\n<p><code>/var/www/css1</code></p>\n\n<p>and also </p>\n\n<p><code>docker inspect --format='{{index (index (.Config.Labels)).css2 }}' labels-test</code></p>\n\n<p>which shows for me</p>\n\n<p><code>/var/www/css2</code></p>\n\n<p>See my previous answer on that subject\n<a href=\"https://stackoverflow.com/questions/30342796/how-to-get-env-variable-when-doing-docker-inspect/30353018#30353018\">How to get ENV variable when doing Docker Inspect</a></p>\n\n<p>Edit</p>\n\n<p>The following gives exactly what you ask for</p>\n\n<p><code>docker inspect --format='{{index (index (.Config.Labels)).css1 }} {{index (index (.Config.Labels)).css2 }} labels-test</code> </p>\n\n<p>as i get</p>\n\n<p><code>/var/www/css1 /var/www/css2</code></p>\n"}], "owner": {"reputation": 33, "user_id": 8961783, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550d97d2d337ddb8b0f9cb41c60511aa?s=128&d=identicon&r=PG&f=1", "display_name": "fflost", "link": "https://stackoverflow.com/users/8961783/fflost"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1340, "favorite_count": 2, "accepted_answer_id": 47365037, "answer_count": 2, "score": 3, "last_activity_date": 1511013339, "creation_date": 1510999375, "last_edit_date": 1510999760, "question_id": 47364777, "link": "https://stackoverflow.com/questions/47364777/docker-inspect-how-to-select-only-certain-keys-from-range", "title": "docker inspect: how to select only certain keys from range", "body": "<p>I created an docker image that has few labels, here is my Dockerfile section on LABELS:</p>\n\n<pre><code>grep LABEL Dockerfile\n\nLABEL \"css1\"=\"/var/www/css1\"\nLABEL \"css2\"=\"/var/www/css2\"\nLABEL \"img\"=\"/var/www/img\"\nLABEL \"js\"=\"/var/www/js\"\n</code></pre>\n\n<p>Then:</p>\n\n<pre><code>docker image inspect --format='{{.Config.Labels}}' labels-test\n\nmap[css1:/var/www/css1 css2:/var/www/css2 img:/var/www/img js:/var/www/js]\n</code></pre>\n\n<p>I need to get for example all labels starting with <i>css</i>. This is as far as i was able to figure:</p>\n\n<pre><code>docker image inspect --format='{{range $k,$v:=.Config.Labels}}{{$k}}:{{$v}} {{end}}' labels-test\n\ncss1:/var/www/css1 css2:/var/www/css2 img:/var/www/img js:/var/www/js\n</code></pre>\n\n<p>Desired output would be:</p>\n\n<pre><code>css1:/var/www/css1 css2:/var/www/css2\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8928802"}, "edited": false, "score": 0, "creation_date": 1510994431, "post_id": 47364079, "comment_id": 81681107, "body": "func(Addr) bool is the <b>type</b> of the parameter <i>strategy</i>. So the argument &quot;strategy&quot; must be a function that takes  something of type <i>Addr</i> and returns true or false."}, {"owner": {"reputation": 97, "user_id": 8645601, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/92BVV.jpg?s=128&g=1", "display_name": "user8645601", "link": "https://stackoverflow.com/users/8645601/user8645601"}, "edited": false, "score": 0, "creation_date": 1510995006, "post_id": 47364079, "comment_id": 81681222, "body": "so , one thing i want to make sure is that : func(Addr) bool is a type like &quot;string&quot; or &quot;int&quot;?  but how does this func return the fist address which satisfies strategy?"}], "answers": [{"tags": [], "owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "is_accepted": false, "score": 1, "last_activity_date": 1510994742, "creation_date": 1510994742, "answer_id": 47364177, "question_id": 47364079, "link": "https://stackoverflow.com/questions/47364079/cant-understand-some-go-code/47364177#47364177", "title": "can&#39;t understand some Go code", "body": "<p>consider strategy as a filter function, it just checks if addr in the range loop can pass the filter or not\nanother and completely equal way to do this is like</p>\n\n<pre><code>func strategy(addr Addr) bool {\n    if addr == ... {\n        return true\n    }\n\n    return false\n}\n\nfunc main(){\n    addr := first(strategy)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "is_accepted": true, "score": 2, "last_activity_date": 1510998372, "last_edit_date": 1510998372, "creation_date": 1510997895, "answer_id": 47364571, "question_id": 47364079, "link": "https://stackoverflow.com/questions/47364079/cant-understand-some-go-code/47364571#47364571", "title": "can&#39;t understand some Go code", "body": "\n\n<pre><code>1 func (addrs addrList) first(strategy func(Addr) bool) Addr {\n2    for _, addr := range addrs {\n3        if strategy(addr) {\n4            return addr\n         }\n     }\n5    return addrs[0]\n  }\n</code></pre>\n\n<p>In words:</p>\n\n<ol>\n<li>function on <code>addrs</code> named <code>first</code> returns <code>Addr</code> takes <code>strategy</code> argument which must be a function that takes <code>Addr</code> and return <code>bool</code>.</li>\n<li><code>for</code> each <code>addr</code> in <code>range</code> of <code>addrs</code> apply function <code>strategy</code> on <code>addr</code></li>\n<li>if it (the <code>strategy</code> func) returns <code>true</code> </li>\n<li>then whole function <code>first</code> returns that <code>addr</code></li>\n<li>whole function <code>first</code> return the very first <code>[0]</code> <code>Addr</code> from <code>addrs</code>, implied: which only happens if none of <code>strategy</code> calls on <code>addr</code> in <code>range</code> of <code>addrs</code> returned <code>true</code>.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1511011841, "creation_date": 1511011841, "answer_id": 47366669, "question_id": 47364079, "link": "https://stackoverflow.com/questions/47364079/cant-understand-some-go-code/47366669#47366669", "title": "can&#39;t understand some Go code", "body": "<p>Func <code>first</code> accepts as an argument <code>strategy</code> another function with type <code>func(Addr) bool</code>. \nSo second function should take an <code>Addr</code> as input and return <code>bool</code> whether adder is ok. </p>\n\n<p>As first such <code>Addr</code> found first function exits and returns it. </p>\n\n<p>Logins is similar to filters - iterate a list until first matching value is found. </p>\n\n<p>And as a last resort if for no one <code>Addr</code> value was got positive reply first function returns a first value in slice. </p>\n"}], "owner": {"reputation": 97, "user_id": 8645601, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/92BVV.jpg?s=128&g=1", "display_name": "user8645601", "link": "https://stackoverflow.com/users/8645601/user8645601"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 47364571, "answer_count": 3, "score": 2, "last_activity_date": 1511189579, "creation_date": 1510993767, "last_edit_date": 1511189579, "question_id": 47364079, "link": "https://stackoverflow.com/questions/47364079/cant-understand-some-go-code", "title": "can&#39;t understand some Go code", "body": "<p>While I was reading the code of package \"net\", I found some code like this:</p>\n\n<pre><code>// first returns the first address which satisfies strategy, or if\n// none do, then the first address of any kind.\nfunc (addrs addrList) first(strategy func(Addr) bool) Addr {\n    for _, addr := range addrs {\n        if strategy(addr) {\n            return addr\n        }\n    }\n    return addrs[0]\n}\n</code></pre>\n\n<p>I am really confused about why the func first includes another func named func(Addr), and how does this code implement the behaviour which the comments say?</p>\n"}, {"tags": ["ssl", "go"], "answers": [{"tags": [], "owner": {"reputation": 1980, "user_id": 6375498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51ade4f86c3426c9f67f1a54b270b398?s=128&d=identicon&r=PG&f=1", "display_name": "Seva", "link": "https://stackoverflow.com/users/6375498/seva"}, "is_accepted": true, "score": 4, "last_activity_date": 1511056033, "creation_date": 1511056033, "answer_id": 47372951, "question_id": 47362816, "link": "https://stackoverflow.com/questions/47362816/get-the-root-ca-certificate-for-the-connection/47372951#47372951", "title": "Get the root CA certificate for the connection", "body": "<p>As the comment in the code says PeerCertificates only includes certificates returned by the server. VerifiedChains should contain the chain up to a trusted certificate in your local certificate store (assuming that verification passed ok).</p>\n\n<p>E.g. here is a simple sample code snippet:</p>\n\n<pre><code>client := &amp;http.Client{}\n\nresp, err := client.Get(\"https://www.microsoft.com\")\nif err != nil {\n    panic(err)\n}\n\nfor _, cert := range resp.TLS.PeerCertificates {\n    fmt.Printf(\"Peer certificate \\\"%v\\\", ISSUED BY \\\"%v\\\"\\n\", cert.Subject.CommonName, cert.Issuer.CommonName)\n}\nfor i, chain := range resp.TLS.VerifiedChains {\n    for _, cert := range chain {\n        fmt.Printf(\"Verified Chain %v Certificate \\\"%v\\\", ISSUED BY \\\"%v\\\"\\n\", i, cert.Subject.CommonName, cert.Issuer.CommonName)\n    }\n}\n</code></pre>\n\n<p>And it prints following output:</p>\n\n<pre><code>Peer certificate \"www.microsoft.com\", ISSUED BY \"Symantec Class 3 Secure Server CA - G4\"\nPeer certificate \"Symantec Class 3 Secure Server CA - G4\", ISSUED BY \"VeriSign Class 3 Public Primary Certification Authority - G5\"\nVerified Chain 0 Certificate \"www.microsoft.com\", ISSUED BY \"Symantec Class 3 Secure Server CA - G4\"\nVerified Chain 0 Certificate \"Symantec Class 3 Secure Server CA - G4\", ISSUED BY \"VeriSign Class 3 Public Primary Certification Authority - G5\"\nVerified Chain 0 Certificate \"VeriSign Class 3 Public Primary Certification Authority - G5\", ISSUED BY \"VeriSign Class 3 Public Primary Certification Authority - G5\"\n</code></pre>\n\n<p>Now, note that microsoft certificate is signed by Symantec and microsoft server returns both certificates - its own and Symantec certificate used to sign it. You can see both certificates listed in both Peer certificates and Verified chain. But Symantec's certificate isn't commonly present in trust store, but it is signed by VeriSign certificate which is a root certificate that was found in my computer's trust store. And Verified Chain includes this trusted certificate.</p>\n"}], "owner": {"reputation": 934, "user_id": 2508038, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/a401dcb35f89eb3be4a617acf05c31b8?s=128&d=identicon&r=PG&f=1", "display_name": "ProgramCpp", "link": "https://stackoverflow.com/users/2508038/programcpp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 528, "favorite_count": 0, "accepted_answer_id": 47372951, "answer_count": 1, "score": 0, "last_activity_date": 1511056033, "creation_date": 1510982556, "question_id": 47362816, "link": "https://stackoverflow.com/questions/47362816/get-the-root-ca-certificate-for-the-connection", "title": "Get the root CA certificate for the connection", "body": "<p>I am making a https connection to a <code>url</code>. </p>\n\n<pre><code>client.Get(url)\n</code></pre>\n\n<p>Can i get the root certificate that was used to verify the server certificate. </p>\n\n<p>I looked at the <code>crypto/tls</code> package </p>\n\n<pre><code>PeerCertificates            []*x509.Certificate   // certificate chain presented by remote peer\nVerifiedChains              [][]*x509.Certificate // verified chains built from PeerCertificates\n</code></pre>\n\n<p>The ConnectionState doesnt seem to have certificate from the trust store.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 908, "user_id": 2525337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42ee56a548ee6259f9e44a66d1c3aa61?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/2525337/john-smith"}, "edited": false, "score": 1, "creation_date": 1510993464, "post_id": 47362609, "comment_id": 81680938, "body": "By following your reasoning, we should test the integrity of each function at the order level.  We test the results of the function not the integral, so the test should check only the output of the function <code>Hello</code>."}, {"owner": {"reputation": 180, "user_id": 5216248, "user_type": "registered", "profile_image": "https://graph.facebook.com/10203850369894672/picture?type=large", "display_name": "Even", "link": "https://stackoverflow.com/users/5216248/even"}, "reply_to_user": {"reputation": 908, "user_id": 2525337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42ee56a548ee6259f9e44a66d1c3aa61?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/2525337/john-smith"}, "edited": false, "score": 1, "creation_date": 1510994272, "post_id": 47362609, "comment_id": 81681080, "body": "When there is a function <code>Hello</code> and I need to test its correctness. Usually, I will do two things. The first one is to assert the correctness of the output (kind of black box test) and the second one is to assert calledCount and calledParams if <code>Hello</code> call any other function (kind of white box test). The question is more focusing on how can we do the second one gracefully without impacting the normal development experience (two methods I summarize above are bad development experience due to unnecessary complexity)"}], "answers": [{"comments": [{"owner": {"reputation": 180, "user_id": 5216248, "user_type": "registered", "profile_image": "https://graph.facebook.com/10203850369894672/picture?type=large", "display_name": "Even", "link": "https://stackoverflow.com/users/5216248/even"}, "edited": false, "score": 0, "creation_date": 1510992616, "post_id": 47363186, "comment_id": 81680747, "body": "In my opinion, that&#39;s the responsibility of integration test to examine if the &quot;<code>Hello\\n</code>&quot; being written because now the <code>Hello</code> depends on <code>Say</code>.  In unit test, we only care if the <code>Hello</code> truly calls <code>Say</code> and pass the correct parameters to it.  There is no need to understand the implementation detail of <code>Say</code> while doing unit test on <code>Hello</code>"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 1, "creation_date": 1511016359, "post_id": 47363186, "comment_id": 81687040, "body": "Very interesting approach to intercept <code>stdout</code>. But Structly speaking this tests not method <code>Hello</code> itself, but a conjunction of <code>Hello</code>+<code>Say</code>. How to test hello itself?"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1510991497, "last_edit_date": 1510991497, "creation_date": 1510986074, "answer_id": 47363186, "question_id": 47362609, "link": "https://stackoverflow.com/questions/47362609/unit-test-when-receiver-method-call-each-other/47363186#47363186", "title": "Unit test when receiver method call each other", "body": "<p>None of the above. I don't see where you prove that the <code>Hello</code> method actually works, that \"<code>Hello\\n</code>\" is actually written. Check the <code>Say</code> method output. Mock <code>os.Stdout</code>. For example,</p>\n\n<p><code>user.go</code>:</p>\n\n<pre><code>package user\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"os\"\n)\n\ntype user struct{}\n\nconst hello = \"Hello\"\n\nfunc (u user) Hello() {\n    u.Say(hello)\n}\n\nvar stdwrite = io.Writer(os.Stdout)\n\nfunc (u user) Say(sentence string) {\n    fmt.Fprintln(stdwrite, sentence)\n}\n</code></pre>\n\n<p><code>user_test.go</code>:</p>\n\n<pre><code>package user\n\nimport (\n    \"bytes\"\n    \"io\"\n    \"testing\"\n)\n\nfunc TestHello(t *testing.T) {\n    u := user{}\n\n    u.Hello() // for real\n\n    defer func(w io.Writer) { stdwrite = w }(stdwrite)\n    stdwrite = new(bytes.Buffer)\n\n    u.Hello() // for test\n\n    got := stdwrite.(*bytes.Buffer).String()\n    want := hello + \"\\n\"\n    if got != want {\n        t.Errorf(\"want: %q got: %q\", want, got)\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go test -v\n=== RUN   TestHello\nHello\n--- PASS: TestHello (0.00s)\nPASS\nok      say 0.001s\n</code></pre>\n"}], "owner": {"reputation": 180, "user_id": 5216248, "user_type": "registered", "profile_image": "https://graph.facebook.com/10203850369894672/picture?type=large", "display_name": "Even", "link": "https://stackoverflow.com/users/5216248/even"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 837, "favorite_count": 2, "answer_count": 1, "score": 2, "last_activity_date": 1510991497, "creation_date": 1510980427, "question_id": 47362609, "link": "https://stackoverflow.com/questions/47362609/unit-test-when-receiver-method-call-each-other", "title": "Unit test when receiver method call each other", "body": "<p>Imagine there is a <code>User</code> package which contains only two simple methods</p>\n\n<ol>\n<li><code>Hello</code> which says \"Hello\"</li>\n<li><code>Say</code> which implements how a user speaks</li>\n</ol>\n\n<p><strong>Original</strong></p>\n\n<pre><code>package user\n\nimport \"fmt\"\n\ntype user struct {}\n\nfunc (u user) Hello() {\n    u.Say(\"Hello\")\n}\n\nfunc (u user) Say(sentence string) {\n    fmt.Println(sentence)\n}\n</code></pre>\n\n<p>However, we are not able to unit test <code>Hello</code> since it depends on <code>Say</code> which is not mockable.</p>\n\n<p>After searing on StackOverflow and Goole, I summarize two methods to solve the problem, but none of them are perfect.</p>\n\n<p><strong>Method 1 - Use lambda func</strong></p>\n\n<p>user.go</p>\n\n<pre><code>package user\n\nimport \"fmt\"\n\ntype user struct{}\n\nfunc (u user) Hello() {\n    say(\"Hello\")\n}\n\nfunc (u user) Say(sentence string) {\n    say(sentence)\n}\n\nvar say = func(sentence string) {\n    fmt.Println(sentence)\n}\n</code></pre>\n\n<p>user_test.go</p>\n\n<pre><code>package user\n\nimport (\n    \"testing\"\n)\n\nfunc TestHello(t *testing.T) {\n    sayCalled := 0\n    sayCallArg := \"\"\n\n    mockSay := func(sentence string) {\n        sayCalled++\n        sayCallArg = sentence\n    }\n    say = mockSay\n\n    u := user{}\n    u.Hello()\n\n    if sayCalled != 1 {\n        t.Fatalf(\"not called\")\n    }\n    if sayCallArg != \"Hello\" {\n        t.Fatalf(\"wrong arg\")\n    }\n}\n</code></pre>\n\n<p><strong>Method 2 - Use interface</strong></p>\n\n<p>user.go</p>\n\n<pre><code>package user\n\nimport \"fmt\"\n\ntype user struct {\n    sayer Sayer\n}\n\nfunc (u user) Hello() {\n    u.sayer.Say(\"Hello\")\n}\n\nfunc (u user) Say(sentence string) {\n    u.sayer.Say(sentence)\n}\n\ntype Sayer interface {\n    Say(string)\n}\n\ntype sayer struct{}\n\nfunc (s sayer) Say(sentence string) {\n    fmt.Println(sentence)\n}\n</code></pre>\n\n<p>user_test.go</p>\n\n<pre><code>package user\n\nimport (\n    \"testing\"\n)\n\ntype mockSayer struct {\n    called    int\n    calledArg string\n}\n\nfunc (s *mockSayer) Say(sentence string) {\n    s.called++\n    s.calledArg = sentence\n}\n\nfunc TestHello(t *testing.T) {\n    mockSayer := &amp;mockSayer{}\n    u := user{sayer: mockSayer}\n    u.Hello()\n\n    if mockSayer.called != 1 {\n        t.Fatalf(\"not called\")\n    }\n    if mockSayer.calledArg != \"Hello\" {\n        t.Fatalf(\"wrong arg\")\n    }\n}\n</code></pre>\n\n<p>I understand most of the cases, people will suggest to use Method 2 since that's how dependency injection works in Go.</p>\n\n<p>However, in this example, it's weird to extract the implementation of <code>Say</code> to another layer (unnecessary complexity in my opinion).</p>\n\n<p>Is there any better solution to solve this kind of dependency?\nor which method you prefer and why?</p>\n"}]