[{"tags": ["http", "curl", "go", "json-rpc"], "answers": [{"comments": [{"owner": {"reputation": 5468, "user_id": 884491, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/132f685f8b44731e5d0a4eee599bec67?s=128&d=identicon&r=PG", "display_name": "Paul Rumkin", "link": "https://stackoverflow.com/users/884491/paul-rumkin"}, "edited": false, "score": 0, "creation_date": 1460669990, "post_id": 36612614, "comment_id": 60864083, "body": "It doesn&#39;t seem pretty. But it works! Thanks ) Maybe this code should be a separated package?"}, {"owner": {"reputation": 6849, "user_id": 1046738, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fad002f88c1fc7c38c3154d3970f1ad2?s=128&d=identicon&r=PG", "display_name": "jfly", "link": "https://stackoverflow.com/users/1046738/jfly"}, "reply_to_user": {"reputation": 5468, "user_id": 884491, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/132f685f8b44731e5d0a4eee599bec67?s=128&d=identicon&r=PG", "display_name": "Paul Rumkin", "link": "https://stackoverflow.com/users/884491/paul-rumkin"}, "edited": false, "score": 0, "creation_date": 1460684698, "post_id": 36612614, "comment_id": 60868690, "body": "Yes, it&#39;s just a simple example. Actually, there&#39;re already such packages, <a href=\"http://github.com/gorilla/rpc/json\" rel=\"nofollow noreferrer\">here</a> is one."}, {"owner": {"reputation": 5468, "user_id": 884491, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/132f685f8b44731e5d0a4eee599bec67?s=128&d=identicon&r=PG", "display_name": "Paul Rumkin", "link": "https://stackoverflow.com/users/884491/paul-rumkin"}, "edited": false, "score": 0, "creation_date": 1460712666, "post_id": 36612614, "comment_id": 60880332, "body": "Is it standalone package?"}, {"owner": {"reputation": 6849, "user_id": 1046738, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fad002f88c1fc7c38c3154d3970f1ad2?s=128&d=identicon&r=PG", "display_name": "jfly", "link": "https://stackoverflow.com/users/1046738/jfly"}, "reply_to_user": {"reputation": 5468, "user_id": 884491, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/132f685f8b44731e5d0a4eee599bec67?s=128&d=identicon&r=PG", "display_name": "Paul Rumkin", "link": "https://stackoverflow.com/users/884491/paul-rumkin"}, "edited": false, "score": 0, "creation_date": 1460772222, "post_id": 36612614, "comment_id": 60911486, "body": "Yes, use <code>go get github.com&#47;gorilla&#47;rpc&#47;json</code> to install it. More detail <a href=\"http://www.gorillatoolkit.org/pkg/rpc/json\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 5468, "user_id": 884491, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/132f685f8b44731e5d0a4eee599bec67?s=128&d=identicon&r=PG", "display_name": "Paul Rumkin", "link": "https://stackoverflow.com/users/884491/paul-rumkin"}, "edited": false, "score": 0, "creation_date": 1460806924, "post_id": 36612614, "comment_id": 60919481, "body": "Thank&#39;s! That&#39;s what I need!"}], "tags": [], "owner": {"reputation": 6849, "user_id": 1046738, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fad002f88c1fc7c38c3154d3970f1ad2?s=128&d=identicon&r=PG", "display_name": "jfly", "link": "https://stackoverflow.com/users/1046738/jfly"}, "is_accepted": true, "score": 6, "last_activity_date": 1460600281, "last_edit_date": 1495540459, "creation_date": 1460599679, "answer_id": 36612614, "question_id": 36610140, "link": "https://stackoverflow.com/questions/36610140/call-golang-jsonrpc-with-curl/36612614#36612614", "title": "Call golang jsonrpc with curl", "body": "<p>The jsonrpc package doesn't support json-rpc over HTTP currently. So, you can't call jsonrpc with curl. If you really want to do that, you can make a HTTP handler that adapts the HTTP request/response to a <code>ServerCodec</code>. For example:</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"log\"\n    \"net\"\n    \"net/http\"\n    \"net/rpc\"\n    \"net/rpc/jsonrpc\"\n    \"os\"\n)\n\ntype HttpConn struct {\n    in  io.Reader\n    out io.Writer\n}\n\nfunc (c *HttpConn) Read(p []byte) (n int, err error)  { return c.in.Read(p) }\nfunc (c *HttpConn) Write(d []byte) (n int, err error) { return c.out.Write(d) }\nfunc (c *HttpConn) Close() error                      { return nil }\n\n// RPC Api structure\ntype Test struct{}\n\n// Greet method arguments\ntype GreetArgs struct {\n    Name string\n}\n\n// Grret message accept object with single param Name\nfunc (test *Test) Greet(args *GreetArgs, result *string) error {\n    *result = \"Hello \" + args.Name\n    return nil\n}\n\n// Start server with Test instance as a service\nfunc startServer(port string) {\n    test := new(Test)\n\n    server := rpc.NewServer()\n    server.Register(test)\n\n    listener, err := net.Listen(\"tcp\", \":\"+port)\n\n    if err != nil {\n        log.Fatal(\"listen error:\", err)\n    }\n\n    defer listener.Close()\n    http.Serve(listener, http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n\n        if r.URL.Path == \"/test\" {\n            serverCodec := jsonrpc.NewServerCodec(&amp;HttpConn{in: r.Body, out: w})\n            w.Header().Set(\"Content-type\", \"application/json\")\n            w.WriteHeader(200)\n            err := server.ServeRequest(serverCodec)\n            if err != nil {\n                log.Printf(\"Error while serving JSON request: %v\", err)\n                http.Error(w, \"Error while serving JSON request, details have been logged.\", 500)\n                return\n            }\n        }\n\n    }))\n}\n\nfunc main() {\n    if len(os.Args) &lt; 2 {\n        log.Fatal(\"port not specified\")\n    }\n\n    port := os.Args[1]\n\n    startServer(port)\n}\n</code></pre>\n\n<p>Now you can call it with <code>curl -X POST -H \"Content-Type: application/json\" -d '{\"id\": 1, \"method\": \"Test.Greet\", \"params\": [{\"name\":\"world\"}]}' http://localhost:port/test</code></p>\n\n<p>Part of the code is from <a href=\"https://stackoverflow.com/questions/31396924/golang-httpjsonrpc-access-from-web-page\">this post</a></p>\n"}, {"comments": [{"owner": {"reputation": 5468, "user_id": 884491, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/132f685f8b44731e5d0a4eee599bec67?s=128&d=identicon&r=PG", "display_name": "Paul Rumkin", "link": "https://stackoverflow.com/users/884491/paul-rumkin"}, "edited": false, "score": 0, "creation_date": 1460670023, "post_id": 36612942, "comment_id": 60864102, "body": "Thanks for addition it&#39;s very helpful."}], "tags": [], "owner": {"reputation": 894, "user_id": 2406040, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4126afa62f9870ada0859381ca589d20?s=128&d=identicon&r=PG", "display_name": "Serdmanczyk", "link": "https://stackoverflow.com/users/2406040/serdmanczyk"}, "is_accepted": false, "score": 6, "last_activity_date": 1460601818, "creation_date": 1460601818, "answer_id": 36612942, "question_id": 36610140, "link": "https://stackoverflow.com/questions/36610140/call-golang-jsonrpc-with-curl/36612942#36612942", "title": "Call golang jsonrpc with curl", "body": "<p>@jfly has a nifty solution.</p>\n\n<p>Another option, if you still wanted to test with something besides the go jsonrpc cient (probably the easiest option), or use @jfly's answer, is you can use telnet to send raw data: </p>\n\n<pre><code>computer:~ User$ telnet 127.0.0.1 8888\nTrying 127.0.0.1...\nConnected to localhost.\nEscape character is '^]'.\n{\"method\":\"Test.Greet\",\"params\":[{\"Name\":\"world\"}],\"id\":0}\n{\"id\":0,\"result\":\"Hello world\",\"error\":null}\n{\"method\":\"Test.Greet\",\"params\":[{\"Name\":\"world\"}],\"id\":0}\n{\"id\":0,\"result\":\"Hello world\",\"error\":null}\n{\"method\":\"Test.Greet\",\"params\":[{\"Name\":\"world\"}],\"id\":0}\n{\"id\":0,\"result\":\"Hello world\",\"error\":null}\n</code></pre>\n\n<p>The above is the output including payload I typed in and your server's responses.</p>\n\n<p>tcpdump was my friend when I was figuring out the right payload to send.</p>\n"}], "owner": {"reputation": 5468, "user_id": 884491, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/132f685f8b44731e5d0a4eee599bec67?s=128&d=identicon&r=PG", "display_name": "Paul Rumkin", "link": "https://stackoverflow.com/users/884491/paul-rumkin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2297, "favorite_count": 3, "accepted_answer_id": 36612614, "answer_count": 2, "score": 5, "last_activity_date": 1607879762, "creation_date": 1460583903, "last_edit_date": 1607879762, "question_id": 36610140, "link": "https://stackoverflow.com/questions/36610140/call-golang-jsonrpc-with-curl", "title": "Call golang jsonrpc with curl", "body": "<p>I have &quot;hello world&quot; rpc service written in golang. It works fine and go jsonrpc client is working. But I need to send request with curl and this example doesn't work:</p>\n<pre><code>curl \\\n-X POST \\\n-H &quot;Content-Type: application/json&quot; \\\n-d '{&quot;id&quot;: 1, &quot;method&quot;: &quot;Test.Say&quot;, &quot;params&quot;: [{&quot;greet&quot;: &quot;world&quot;}]}' \\\nhttp://localhost:1999/_goRPC_\n</code></pre>\n<p>Go accept connection but produce absolutely no result:</p>\n<pre><code>curl: (52) Empty reply from server \n</code></pre>\n<p>Here my go code:</p>\n<pre><code>package main\n\nimport (\n  &quot;log&quot;\n  &quot;os&quot;\n  &quot;time&quot;\n  &quot;net&quot;\n  &quot;net/rpc&quot;\n  &quot;net/rpc/jsonrpc&quot;\n)\n\n// RPC Api structure\ntype Test struct {}\n\n// Greet method arguments\ntype GreetArgs struct {\n  Name string\n}\n\n// Grret message accept object with single param Name\nfunc (test *Test) Greet(args *GreetArgs, result *string) (error) {\n  *result = &quot;Hello &quot; + args.Name\n  return nil\n}\n\n// Start server with Test instance as a service\nfunc startServer(ch chan&lt;- bool, port string) {\n  test := new(Test)\n\n  server := rpc.NewServer()\n  server.Register(test)\n\n  listener, err := net.Listen(&quot;tcp&quot;, &quot;:&quot; + port)\n\n  if err != nil {\n      log.Fatal(&quot;listen error:&quot;, err)\n  }\n\n  defer listener.Close()\n\n  for {\n      conn, err := listener.Accept()\n\n      if err != nil {\n          log.Fatal(err)\n      }\n\n      go server.ServeCodec(jsonrpc.NewServerCodec(conn))\n      ch &lt;- true\n  }\n}\n\n// Start client and call Test.Greet method\nfunc startClient(port string) {\n  conn, err := net.Dial(&quot;tcp&quot;, &quot;:&quot; + port)\n\n  if err != nil {\n      panic(err)\n  }\n  defer conn.Close()\n\n  c := jsonrpc.NewClient(conn)\n\n  var reply string\n  var args = GreetArgs{&quot;world&quot;}\n  err = c.Call(&quot;Test.Greet&quot;, args, &amp;reply)\n  if err != nil {\n      log.Fatal(&quot;arith error:&quot;, err)\n  }\n  log.Println(&quot;Result: &quot;, reply)\n}\n\nfunc main() {\n  if len(os.Args) &lt; 2 {\n    log.Fatal(&quot;port not specified&quot;)\n  }\n\n  port := os.Args[1]\n  ch := make(chan bool)\n\n  go startServer(ch, port)\n  time.Sleep(500 * time.Millisecond)\n  go startClient(port)\n\n  // Produce log message each time connection closes\n  for {\n    &lt;-ch\n    log.Println(&quot;Closed&quot;)\n  }\n}\n</code></pre>\n"}, {"tags": ["go", "packets"], "comments": [{"owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "edited": false, "score": 1, "creation_date": 1460593210, "post_id": 36609725, "comment_id": 60820289, "body": "What is an HTTP packet? It is a plain text protocol.  Do you mean HTTP2? Or do you mean make HTTP requests? If the second, then you can look at <a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"nofollow noreferrer\">net/http/Request</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1460642372, "post_id": 36609725, "comment_id": 60846775, "body": "HTTP doesn&#39;t have &quot;packets&quot;, do you want to write raw TCP packets to the network? You can&#39;t get around dialing a connection, because TCP packets without an established connection aren&#39;t going to do anything. You can look at the <a href=\"https://godoc.org/golang.org/x/net/ipv4\" rel=\"nofollow noreferrer\">x/net/ipv4</a> and <a href=\"https://godoc.org/golang.org/x/net/ipv6\" rel=\"nofollow noreferrer\">x/net/ipv6</a> packages for some lower-level ip handling."}], "owner": {"reputation": 1945, "user_id": 451664, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7GIPx.jpg?s=128&g=1", "display_name": "Bryan", "link": "https://stackoverflow.com/users/451664/bryan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1460582224, "creation_date": 1460582224, "question_id": 36609725, "link": "https://stackoverflow.com/questions/36609725/how-can-i-write-manually-created-http-packets-on-the-wire-using-go-to-simulate-a", "title": "How can I write manually created http packets on the wire using Go to simulate a SPAN port?", "body": "<p>I'm needing to do some stress testing of an application I've written that takes packets from a mirrored port and processes them. I'd like to use Go to create a test harness that writes well-formatted, but otherwise random, HTTP packets on the wire, but I'm not sure how to do so without dialing a remote HTTP server before writing the packet.</p>\n\n<p>Can someone point me in the direction of how to write raw data on the wire without needing to make a connection first? Is there a way in Go to treat a network interface as a generic I/O device and just write bytes to it?</p>\n"}, {"tags": ["go", "encapsulation"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 3, "creation_date": 1460578476, "post_id": 36608557, "comment_id": 60814093, "body": "the fully-qualified name of <code>Len</code> is <code>packagename.byName.Len</code>. As you say, since <code>byName</code> isn&#39;t exportable, <code>Len</code> isn&#39;t visible to an outside package either."}], "answers": [{"comments": [{"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1460579285, "post_id": 36608792, "comment_id": 60814539, "body": "Oh well. I was hoping to &quot;hide&quot; the definitions, but I guess since they are local only, that will have to suffice."}], "tags": [], "owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "is_accepted": true, "score": 2, "last_activity_date": 1460579350, "last_edit_date": 1460579350, "creation_date": 1460578744, "answer_id": 36608792, "question_id": 36608557, "link": "https://stackoverflow.com/questions/36608557/encapsulating-sort-interface-in-golang/36608792#36608792", "title": "Encapsulating `sort` Interface in Golang", "body": "<p>Simple answer, no, there are no such things as anonymous methods in Go.</p>\n\n<p>As anonymous functions cannot be declared using a receiver, they are effectively not methods, therefore the <code>byName</code> type would not implement the required <code>sort.Interface</code>.</p>\n"}], "owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 36608792, "answer_count": 1, "score": 0, "last_activity_date": 1460579350, "creation_date": 1460578045, "question_id": 36608557, "link": "https://stackoverflow.com/questions/36608557/encapsulating-sort-interface-in-golang", "title": "Encapsulating `sort` Interface in Golang", "body": "<p>I am trying to sort a slice of structs in Go. I can implement the <code>sort.Interface</code> by defining 3 methods at the top level of the package:</p>\n\n<pre><code>type byName []*Foo // struct Foo is defined in another package\n\nfunc (a byName) Len() int           { return len(a) }\nfunc (a byName) Swap(i, j int)      { a[i], a[j] = a[j], a[i] }\nfunc (a byName) Less(i, j int) bool { return a[i].Name &lt; a[j].Name }\n\nfunc Bar() {\n    var foos []*Foo // Populated by a call to an outside function\n\n    sort.Sort(byName(foos))\n    ...\n}\n</code></pre>\n\n<p>Is there any way to move the 3 method definitions (<code>Len</code>, <code>Swap</code>, and <code>Less</code>) into the <code>Bar</code> function, defining an anonymous method in Go?</p>\n\n<pre><code>// Something like this\nfunc Bar() {\n    ...\n    Len := func (a byName)() int { return len(a) }\n}\n</code></pre>\n\n<p>Can the 3 methods defined at the top level be accessed from outside of this package? I am guessing not, because the type <code>byName</code> is local.</p>\n"}, {"tags": ["git", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1460579210, "post_id": 36608154, "comment_id": 60814496, "body": "I also symlink into GOPATH for each project, but do not put any symlinks <i>inside</i> GOPATH; the Go tools purposely don&#39;t follow them when resolving dependencies."}], "answers": [{"comments": [{"owner": {"reputation": 3699, "user_id": 4816175, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/697df6176ef55a7ea25f159e0fcdec38?s=128&d=identicon&r=PG", "display_name": "cool breeze", "link": "https://stackoverflow.com/users/4816175/cool-breeze"}, "edited": false, "score": 0, "creation_date": 1460577113, "post_id": 36608232, "comment_id": 60813295, "body": "Can you share this &#39;b&#39; script of yours?  Is this a batch script?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 3699, "user_id": 4816175, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/697df6176ef55a7ea25f159e0fcdec38?s=128&d=identicon&r=PG", "display_name": "cool breeze", "link": "https://stackoverflow.com/users/4816175/cool-breeze"}, "edited": false, "score": 1, "creation_date": 1460577236, "post_id": 36608232, "comment_id": 60813367, "body": "@coolbreeze yes, simple bash script which makes a <code>ln -s</code>, a <code>cd</code> and a <code>go install</code>, nothing too fancy, but enough to make my go project compile anywhere I want."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 3699, "user_id": 4816175, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/697df6176ef55a7ea25f159e0fcdec38?s=128&d=identicon&r=PG", "display_name": "cool breeze", "link": "https://stackoverflow.com/users/4816175/cool-breeze"}, "edited": false, "score": 0, "creation_date": 1460580095, "post_id": 36608232, "comment_id": 60814975, "body": "@coolbreeze I don&#39;t have it in my current environment (Windows), but I&#39;ll edit the question with (from memory) the general idea"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1460668434, "last_edit_date": 1460668434, "creation_date": 1460577016, "answer_id": 36608232, "question_id": 36608154, "link": "https://stackoverflow.com/questions/36608154/is-it-common-practice-to-symbolic-link-to-the-gopath-folder/36608232#36608232", "title": "Is it common practice to symbolic link to the GOPATH folder?", "body": "<p>What I end up doing is instead created my own <code>GOPATH</code> within a go project I want to keep isolated to my normal global <code>$GOPATH</code>.</p>\n\n<p>I make a '<code>b</code>' script (at the root folder of the project) which:</p>\n\n<ul>\n<li>check if <code>src</code> exists (in the project folder, here in <code>~/dev/git/project1</code>): if not it creates it;</li>\n<li>check if src/mypackage exists: if not, if creates the symbolic link <code>src/mypackage -&gt; ~/dev/git/project1</code>. </li>\n<li>is called with an alias: <code>alias b='. ./b'</code></li>\n</ul>\n\n<p>That way, the same '<code>b</code>' (short for 'build') goes into <code>~/dev/git/project1/src/mypackage</code>, and does a <code>go install</code>.<br>\nIf you have a <code>main</code> package, that will create a binary in <code>~/dev/git/project1/bin</code>.</p>\n\n<p>That way, each of my go project remains autonomous, not lost in a sea of other go packages in my normal <code>$GOPATH/src</code>. I reserve the global <code>$GOPATH</code> for global projects that helps me to develop in go: <code>golang.org/x/tools/cmd/...</code>, <code>github.com/fzipp/gocyclo</code> and the likes (other linters).</p>\n\n<hr>\n\n<p>In other words, <strong>I do not symlink <code>GOPATH</code></strong>.<br>\nI do symlink my package inside my project to a local <code>GOPATH</code> (local to said project), but the GOPATH itself is a fixed folder (again specific to my project), defined as usual, without any symlink)</p>\n\n<p>And that is perfectly compatible with the <a href=\"https://golang.org/cmd/go/#hdr-Vendor_Directories\" rel=\"nofollow\">vendor folder</a> for vendoring source dependencies.</p>\n\n<hr>\n\n<pre><code>alias b='. ./b'\ncd /path/to/my/project\nb:\n\n#!/bin/sh\nif [ ! -e src ]; then mkdir src ; fi\nif [ ! -e src/myproject ]; then ln -s /path/to/my/project src/myproject; fi\ncd src/myproject\ngo install\ncd ../..\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 5, "creation_date": 1460668264, "post_id": 36633879, "comment_id": 60863291, "body": "I don&#39;t symlink my gopath. I symlink my package to my gopath. And I use vendor in my project as well."}], "tags": [], "owner": {"reputation": 4254, "user_id": 1351597, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/6e2b94150c4f96fe11dae1494a054f7b?s=128&d=identicon&r=PG", "display_name": "Dekker1", "link": "https://stackoverflow.com/users/1351597/dekker1"}, "is_accepted": false, "score": 3, "last_activity_date": 1460667532, "creation_date": 1460667532, "answer_id": 36633879, "question_id": 36608154, "link": "https://stackoverflow.com/questions/36608154/is-it-common-practice-to-symbolic-link-to-the-gopath-folder/36633879#36633879", "title": "Is it common practice to symbolic link to the GOPATH folder?", "body": "<p>Because of dependency issues between packages, symlinking was used for the GOPATH. The structure of <a href=\"https://golang.org/cmd/go/#hdr-GOPATH_environment_variable\" rel=\"nofollow\">GOPATH</a>, however, always suggested that it was to be used for multiple projects and symlinking your <code>GOPATH</code> has been discouraged by the go developers.</p>\n\n<p>In the latest version (1.6), however, they finalised a solution to the dependency problem (experimentally introduced in 1.5), in the form of a folder named <code>vendor/</code> placed at top level of your package (<a href=\"https://blog.golang.org/go1.6\" rel=\"nofollow\">link</a>). This folder will be searched before the regular <code>GOPATH</code> for package used by import statement.</p>\n\n<p>There are various tools to use to streamline the dependency process like <a href=\"https://github.com/tools/godep\" rel=\"nofollow\">godep</a> or <a href=\"https://github.com/Masterminds/glide\" rel=\"nofollow\">glide</a>, making using the <code>vendor/</code> folder a lot less time-consuming than symlinking the <code>GOPATH</code>. Using a vendor package is also better reproducible than symlinked dependencies, ensuring your package will work for everyone.</p>\n\n<p>So I would encourage you not to symlink your GOPATH, and use this newly introduced standard.</p>\n"}], "owner": {"reputation": 3699, "user_id": 4816175, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/697df6176ef55a7ea25f159e0fcdec38?s=128&d=identicon&r=PG", "display_name": "cool breeze", "link": "https://stackoverflow.com/users/4816175/cool-breeze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5875, "favorite_count": 2, "answer_count": 2, "score": 7, "last_activity_date": 1460668434, "creation_date": 1460576738, "question_id": 36608154, "link": "https://stackoverflow.com/questions/36608154/is-it-common-practice-to-symbolic-link-to-the-gopath-folder", "title": "Is it common practice to symbolic link to the GOPATH folder?", "body": "<p>My git projects are stored here:</p>\n\n<pre><code>~/dev/git/project1 ...\n</code></pre>\n\n<p>I am starting a golang project, and since it requires using the GOPATH is it common practise to create a symbolic link from my projects git path to GOPATH?</p>\n"}, {"tags": ["xml", "go"], "answers": [{"tags": [], "owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "is_accepted": true, "score": 6, "last_activity_date": 1460578091, "last_edit_date": 1460578091, "creation_date": 1460577402, "answer_id": 36608341, "question_id": 36607875, "link": "https://stackoverflow.com/questions/36607875/golang-marshaling-xml-time-time-as-date-format-for-xml-attribute/36608341#36608341", "title": "Golang - Marshaling XML time.Time as date format for XML attribute", "body": "<p>You are implementing the wrong interface.</p>\n\n<p>Since the Date type is meant to be marshaled as an attribute (as shown from the <code>xml:\"DOB,attr\"</code> tag), it needs to implement the <a href=\"https://golang.org/pkg/encoding/xml/#MarshalerAttr\" rel=\"noreferrer\">xml.MarshalerAttr</a> interface:</p>\n\n<pre><code>type MarshalerAttr interface {\n    MarshalXMLAttr(name Name) (Attr, error)\n}\n</code></pre>\n\n<p>So you probably need to add code like this:</p>\n\n<pre><code>func (d Date) MarshalXMLAttr(name xml.Name) (xml.Attr, error) {\n    dateString := time.Time(d).Format(\"2006-01-02\")    \n    attr := xml.Attr {\n        name,\n        dateString,\n    }\n\n    return attr, nil\n}\n</code></pre>\n\n<p>Note that I removed the apparently unnecessary quotes from the value string.</p>\n"}], "owner": {"reputation": 3554, "user_id": 3233810, "user_type": "registered", "accept_rate": 70, "profile_image": "https://graph.facebook.com/1135890448/picture?type=large", "display_name": "daino3", "link": "https://stackoverflow.com/users/3233810/daino3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1259, "favorite_count": 0, "accepted_answer_id": 36608341, "answer_count": 1, "score": 4, "last_activity_date": 1460578091, "creation_date": 1460575814, "question_id": 36607875, "link": "https://stackoverflow.com/questions/36607875/golang-marshaling-xml-time-time-as-date-format-for-xml-attribute", "title": "Golang - Marshaling XML time.Time as date format for XML attribute", "body": "<p>I'm trying to format a custom time type, Date, that implements the Marshaler interface and simply formats itself as \"2006-01-02\" when written as XML.</p>\n\n<pre><code>type Person struct {\n    ...\n    DateOfBirth           Date      `xml:\"DOB,attr\"`\n    ...\n}\n\ntype Date time.Time\n\nfunc (d Date) MarshalXML(e *xml.Encoder, start xml.StartElement) error {\n    dateString := fmt.Sprintf(\"\\\"%v\\\"\", time.Time(d).Format(\"2006-01-02\"))    \n    e.EncodeElement(dateString, start)\n\n    return nil\n}\n</code></pre>\n\n<p>I was using <a href=\"https://stackoverflow.com/questions/23695479/format-timestamp-in-outgoing-json-in-golang\">this SO</a> as a reference, but the error -  <strong>&amp;xml.UnsupportedTypeError{Type:(*reflect.rtype)}</strong> - is thrown.</p>\n\n<p>I'm missing something, any ideas?</p>\n"}, {"tags": ["dictionary", "go"], "comments": [{"owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1460572561, "post_id": 36606717, "comment_id": 60810443, "body": "Perhaps I don&#39;t understand the question; why wouldn&#39;t the code sample you provided work?"}, {"owner": {"reputation": 1907, "user_id": 3161525, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6c4bdb240d87fd9fa82717d3cfbea305?s=128&d=identicon&r=PG&f=1", "display_name": "EMBLEM", "link": "https://stackoverflow.com/users/3161525/emblem"}, "reply_to_user": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1460572863, "post_id": 36606717, "comment_id": 60810630, "body": "@william.taylor.09 Meant it to be the shortest."}], "answers": [{"comments": [{"owner": {"reputation": 1907, "user_id": 3161525, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6c4bdb240d87fd9fa82717d3cfbea305?s=128&d=identicon&r=PG&f=1", "display_name": "EMBLEM", "link": "https://stackoverflow.com/users/3161525/emblem"}, "edited": false, "score": 0, "creation_date": 1460573523, "post_id": 36606718, "comment_id": 60811081, "body": "Why is this downvoted? Why? It&#39;s a useful little trick I found that&#39;s more efficient than the other answer."}, {"owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1460574658, "post_id": 36606718, "comment_id": 60811783, "body": "Sorry, EMBLEM. I had downvoted since OP had asked for the shorted, and you provided the longest. OP then commented he wanted the shorted, and I provided an answer for the shortest. In the meantime, you had edited your answer to reflect the shorted. However, it won&#39;t allow me to change my vote unless you re-edit the question. I&#39;d gladly upvote you if you provide a quick edit to the answer, so S.O. will stop complaining."}, {"owner": {"reputation": 1907, "user_id": 3161525, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6c4bdb240d87fd9fa82717d3cfbea305?s=128&d=identicon&r=PG&f=1", "display_name": "EMBLEM", "link": "https://stackoverflow.com/users/3161525/emblem"}, "reply_to_user": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1460578440, "post_id": 36606718, "comment_id": 60814073, "body": "@william.taylor.09 I am the OP. I had answered my own question."}, {"owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "edited": false, "score": 0, "creation_date": 1460579432, "post_id": 36606718, "comment_id": 60814612, "body": "@EMBLEM, select it as the answer. And sometimes ugly and working is just what you need"}, {"owner": {"reputation": 1907, "user_id": 3161525, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6c4bdb240d87fd9fa82717d3cfbea305?s=128&d=identicon&r=PG&f=1", "display_name": "EMBLEM", "link": "https://stackoverflow.com/users/3161525/emblem"}, "reply_to_user": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "edited": false, "score": 0, "creation_date": 1460579727, "post_id": 36606718, "comment_id": 60814771, "body": "@matt.s Yes. I know. You do know I can&#39;t accept my own answer for 2 days?"}, {"owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "edited": false, "score": 0, "creation_date": 1460580556, "post_id": 36606718, "comment_id": 60815221, "body": "@EMBLEM, oops, I forgot"}, {"owner": {"reputation": 4124, "user_id": 2629095, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/680dfd61e8b392153c85cf93498b8100?s=128&d=identicon&r=PG", "display_name": "nevets", "link": "https://stackoverflow.com/users/2629095/nevets"}, "edited": false, "score": 0, "creation_date": 1460604412, "post_id": 36606718, "comment_id": 60823346, "body": "your solution works, but I do think defining a var to record the shortest length will solve all problems, like depicted in @desaiparth&#39;s answer."}], "tags": [], "owner": {"reputation": 1907, "user_id": 3161525, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6c4bdb240d87fd9fa82717d3cfbea305?s=128&d=identicon&r=PG&f=1", "display_name": "EMBLEM", "link": "https://stackoverflow.com/users/3161525/emblem"}, "is_accepted": true, "score": 2, "last_activity_date": 1460578459, "last_edit_date": 1460578459, "creation_date": 1460572311, "answer_id": 36606718, "question_id": 36606717, "link": "https://stackoverflow.com/questions/36606717/how-do-i-get-any-given-element-of-a-map-in-go/36606718#36606718", "title": "How do I get any given element of a map in Go?", "body": "<p>You can use a <code>for</code> loop and break out of it immediately to sample just one element.</p>\n\n<pre><code>var shortest string\nfor key, _ := range myMap {\n    shortest = key\n    break\n}\nfor key, _ := range myMap {\n    if len(key) &lt; len(shortest) {\n        shortest = key\n    }\n}\n</code></pre>\n\n<p>Ugly, but it works.</p>\n"}, {"tags": [], "owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "is_accepted": false, "score": 0, "last_activity_date": 1460573347, "creation_date": 1460573347, "answer_id": 36607033, "question_id": 36606717, "link": "https://stackoverflow.com/questions/36606717/how-do-i-get-any-given-element-of-a-map-in-go/36607033#36607033", "title": "How do I get any given element of a map in Go?", "body": "<p>You could iterate over the map, adding the elements to a slice. Then sort the slice:</p>\n\n<pre><code>var keys []string\nfor k := range myMap {\n    keys = append(keys, k)\n}\nsort.Strings(keys) // keys[0] is the shorted\n</code></pre>\n\n<p>GoPlay: <a href=\"http://play.golang.org/p/DULIiQAkfg\" rel=\"nofollow\">http://play.golang.org/p/DULIiQAkfg</a></p>\n"}, {"tags": [], "owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "is_accepted": false, "score": 1, "last_activity_date": 1460575974, "last_edit_date": 1460575974, "creation_date": 1460574688, "answer_id": 36607516, "question_id": 36606717, "link": "https://stackoverflow.com/questions/36606717/how-do-i-get-any-given-element-of-a-map-in-go/36607516#36607516", "title": "How do I get any given element of a map in Go?", "body": "<p>You should first define two variables <code>shortestLength</code> and <code>shortest</code>, they will record shortest length you found until now, and corresponding key, respectively. And then start iterating over the map. </p>\n\n<p>Here, the trick is to initialise <code>shortestLength</code> variable with a value, which will be over-written in the first pass. The benefit is that, you don't have to write any extra code and allocate extra memory to sort the keys, and find the shortest one.</p>\n\n<p>Complete code is as following:</p>\n\n<pre><code>if len(myMap) == 0 {\n   // Empty map\n}\n\n// Will be over-written in first iteration\nshortestLength := maths.MaxInt32\nshortest := \"\"\n\nfor key, _ := range myMap {\n  keyLength := len(key)\n  if keyLength &lt;= shortestLength {\n    shortest = key\n    shortestLength = keyLength\n  }\n}\n</code></pre>\n\n<p>The variable <code>shortestLength</code> will be over-written with the length of first element in the first iteration of our for loop. And at the end of the loop will contain the length of shortest key. And <code>shortest</code> will contain the key itself.</p>\n"}], "owner": {"reputation": 1907, "user_id": 3161525, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6c4bdb240d87fd9fa82717d3cfbea305?s=128&d=identicon&r=PG&f=1", "display_name": "EMBLEM", "link": "https://stackoverflow.com/users/3161525/emblem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 36606718, "answer_count": 3, "score": 0, "last_activity_date": 1460578459, "creation_date": 1460572311, "last_edit_date": 1460573500, "question_id": 36606717, "link": "https://stackoverflow.com/questions/36606717/how-do-i-get-any-given-element-of-a-map-in-go", "title": "How do I get any given element of a map in Go?", "body": "<p>Suppose I have a <code>map[string]int</code>, and I want the key with the shortest length (in bytes). If I don't know any particular element that the map contains, how do I get a sample of it so I can do</p>\n\n<pre><code>var shortest string\nfor key, _ := range myMap {\n    if len(key) &lt; len(shortest) {\n        shortest = key\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1010, "user_id": 3326103, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06afeeee747f8c3245b1dc74f634db88?s=128&d=identicon&r=PG&f=1", "display_name": "linuxfan", "link": "https://stackoverflow.com/users/3326103/linuxfan"}, "edited": false, "score": 0, "creation_date": 1460571977, "post_id": 36605511, "comment_id": 60810094, "body": "Returning from the signal handler goroutine was a mistake. Thanks for pointing it out. However, when the signal-handler goroutine services the signal, I still expect the block under <code>case &lt;-intr:</code> to be executed. Why isn&#39;t that happening?"}, {"owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "reply_to_user": {"reputation": 1010, "user_id": 3326103, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06afeeee747f8c3245b1dc74f634db88?s=128&d=identicon&r=PG&f=1", "display_name": "linuxfan", "link": "https://stackoverflow.com/users/3326103/linuxfan"}, "edited": false, "score": 0, "creation_date": 1460572795, "post_id": 36605511, "comment_id": 60810591, "body": "@linuxfan The reason is that, when you are pressing Ctrl+C, <code>bufio.NewReader(os.Stdin)</code> is actually reading from standard input. So, the main go routine is actually blocked, and control cannot go back to <code>select</code> clause. The block under <code>case &lt;-intr:</code> will be executed, when control is returned from the <code>bufio.NewReader(os.Stdin)</code>."}], "tags": [], "owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "is_accepted": true, "score": 4, "last_activity_date": 1460569297, "last_edit_date": 1460569297, "creation_date": 1460568470, "answer_id": 36605511, "question_id": 36604177, "link": "https://stackoverflow.com/questions/36604177/read-input-from-user-while-ignoring-ctrl-c/36605511#36605511", "title": "Read input from user while ignoring CTRL-C", "body": "<p><code>signal.Notify</code> sends signal information to the channel specified, every time process receives signal. But in your code go routine completes, after first signal. So, It is not able to trap the signal again. </p>\n\n<p>One simple way to do this is, you need to have a infinite loop with select clause in the go routine.</p>\n\n<pre><code>go func(c chan os.Signal, quit chan bool) {\n    for {\n        select {\n        case &lt;-c:\n            fmt.Println(\"Got interrupt signal\")\n            fmt.Println(\"Exiting signal handler..\")\n            intr &lt;- true\n        case &lt;-quit:\n            fmt.Println(\"quit\")\n            return\n        }\n    }\n\n}(c, quit)\n</code></pre>\n\n<p>Here, Channel <code>quit</code> is used, to request go-routine to exit cleanly.</p>\n"}], "owner": {"reputation": 1010, "user_id": 3326103, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06afeeee747f8c3245b1dc74f634db88?s=128&d=identicon&r=PG&f=1", "display_name": "linuxfan", "link": "https://stackoverflow.com/users/3326103/linuxfan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 757, "favorite_count": 0, "accepted_answer_id": 36605511, "answer_count": 1, "score": 0, "last_activity_date": 1460569297, "creation_date": 1460564287, "question_id": 36604177, "link": "https://stackoverflow.com/questions/36604177/read-input-from-user-while-ignoring-ctrl-c", "title": "Read input from user while ignoring CTRL-C", "body": "<p>I'd like to read user-input in go and ignore the user's attempts to kill my process by trapping <code>CTRL-C.</code> I spin a goroutine to trap <code>CTRL-C</code> and also write to a channel. At this stage, I expect control to return to <code>case &lt;-intr</code> in the main goroutine, but that's not happening.</p>\n\n<p>Here's output from a run:</p>\n\n<pre><code>$ go run read.go \nEnter text: hello\nEntered:hello\n\n$go run read.go \nEnter text: ^CGot signal interrupt\nExiting signal handler..\n\nInvalid input2\nInterrupted.. Continuing\nEnter text: ^C\nInvalid input2\nEnter text: ^C\nInvalid input2\nEnter text: ^C^C^C^C\nInvalid input2\nEnter text: ^C\nInvalid input2\nEnter text: ^C\nInvalid input2\nEnter text: \n</code></pre>\n\n<p>The first CTRL-C is trapped alright and soon after it exits, it appears that the main goroutine is executing <code>r := bufio.NewReader(os.Stdin)</code></p>\n\n<p>When I hit CTRL-C as input later, it is simply treated as text and the signal handler isn't invoked.</p>\n\n<p>My code is below (goplay link: <a href=\"http://play.golang.org/p/LiKZMYGr00\" rel=\"nofollow\">http://play.golang.org/p/LiKZMYGr00</a>)</p>\n\n<pre><code>package main\n\nimport (\"fmt\"\n    \"bufio\"\n    \"os\"\n    \"os/signal\"\n    \"syscall\"\n    \"io\"\n    \"strings\"\n)\n\nfunc main() {\n    c := make(chan os.Signal)\n    intr := make(chan bool)\n\n    signal.Notify(c,  syscall.SIGINT)\n    go func() {\n        s := &lt;-c\n        fmt.Println(\"Got signal\", s)\n        fmt.Println(\"Exiting signal handler..\")\n        intr &lt;- true\n        return\n    }()\n\nbreakOutOfHere:\n    for {\n        select {\n        case &lt;-intr:\n            fmt.Println(\"Interrupted.. Continuing\")\n            continue\n        default:\n            fmt.Printf(\"Enter text: \")\n            r := bufio.NewReader(os.Stdin)\n            text, ret := r.ReadString('\\n')\n            if ret == io.EOF {\n                fmt.Println(\"Invalid input1\")\n                continue\n            } else if ret == nil {\n                text = strings.TrimSpace(text)\n                if text == \"\" {\n                    fmt.Println(\"Invalid input2\")\n                    continue\n                } else {\n                    fmt.Printf(\"Entered:%s\\n\", text)\n                    break breakOutOfHere\n                }\n            }\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["http", "go"], "answers": [{"comments": [{"owner": {"reputation": 4989, "user_id": 120901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/981936c810e68793c10f3626f9998c5d?s=128&d=identicon&r=PG", "display_name": "Andrew Y", "link": "https://stackoverflow.com/users/120901/andrew-y"}, "edited": false, "score": 0, "creation_date": 1460646732, "post_id": 36604445, "comment_id": 60850358, "body": "For my use case the single address would not work - because they can be different for each connection. Think of a single interface with a whole lot of IPv6 addresses applied. The connection can then be terminated on any of them and I need to know which one it was..."}], "tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": false, "score": 1, "last_activity_date": 1460568230, "last_edit_date": 1460568230, "creation_date": 1460565089, "answer_id": 36604445, "question_id": 36603347, "link": "https://stackoverflow.com/questions/36603347/how-to-get-servers-own-address-in-a-server-using-net-http/36604445#36604445", "title": "How to get Server&#39;s own address in a server using net/http?", "body": "<p>I personally wouldn't modify anything in the standard library for something I could get other ways.  Is there some advantage to parsing it out of every connection?  </p>\n\n<p>There is probably a simpler way, but I have the following.</p>\n\n<pre><code>func getMyInterfaceAddr() (net.IP, error) {\n\n\n    ifaces, err := net.Interfaces()\n    if err != nil {\n        return nil, err\n    }\n    addresses := []net.IP{}\n    for _, iface := range ifaces {\n\n        if iface.Flags&amp;net.FlagUp == 0 {\n            continue // interface down\n        }\n        if iface.Flags&amp;net.FlagLoopback != 0 {\n            continue // loopback interface\n        }\n        addrs, err := iface.Addrs()\n        if err != nil {\n            continue\n        }\n\n        for _, addr := range addrs {\n            var ip net.IP\n            switch v := addr.(type) {\n            case *net.IPNet:\n                ip = v.IP\n            case *net.IPAddr:\n                ip = v.IP\n            }\n            if ip == nil || ip.IsLoopback() {\n                continue\n            }\n            ip = ip.To4()\n            if ip == nil {\n                continue // not an ipv4 address\n            }\n            addresses = append(addresses, ip)\n        }\n    }\n    if len(addresses) == 0 {\n        return nil, fmt.Errorf(\"no address Found, net.InterfaceAddrs: %v\", addresses)\n    }\n    //only need first\n    return addresses[0], nil\n}\n</code></pre>\n"}], "owner": {"reputation": 4989, "user_id": 120901, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/981936c810e68793c10f3626f9998c5d?s=128&d=identicon&r=PG", "display_name": "Andrew Y", "link": "https://stackoverflow.com/users/120901/andrew-y"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2201, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1571300023, "creation_date": 1460562052, "last_edit_date": 1571300023, "question_id": 36603347, "link": "https://stackoverflow.com/questions/36603347/how-to-get-servers-own-address-in-a-server-using-net-http", "title": "How to get Server&#39;s own address in a server using net/http?", "body": "<p>I would like to write a HTTP server using the Go's net/http package, with the reaction that would depend on <em>server</em> side IP address of the HTTP connection.</p>\n\n<p>In other words, what I am looking for is equivalent of CGI's \"SERVER_ADDR\" variable.  </p>\n\n<p>The closest field in http.Request is \"Host\" - but since it will only be equal to an address if the request uses a literal address, I can not use it (the server might be used by name).</p>\n\n<p>Looking at the sources at <a href=\"https://golang.org/src/net/http/server.go\" rel=\"nofollow noreferrer\">https://golang.org/src/net/http/server.go</a>, seems the only way to get to the server's address is to Hijack() the connection within a handler and implement subsequent HTTP parsing for the subsequent requests on the same connection, but it looks very inelegant to say the least...</p>\n\n<p>It seems like the ideal solution would be to have the http/request and http/server in the golang standard library modified as follows:</p>\n\n<pre><code>diff -u go-stock-library/request.go ./request.go\n--- go-stock-library/request.go 2016-04-13 17:31:48.000000000 +0200\n+++ ./request.go    2016-04-13 17:32:40.000000000 +0200\n@@ -227,6 +227,15 @@\n    // This field is ignored by the HTTP client.\n    RemoteAddr string\n\n+   // LocalAddr allows HTTP servers and other software to record\n+   // the network address that the request was sent to, usually for\n+   // logging. This field is not filled in by ReadRequest and\n+   // has no defined format. The HTTP server in this package\n+   // sets LocalAddr to an \"IP:port\" address before invoking a\n+   // handler.\n+   // This field is ignored by the HTTP client.\n+   LocalAddr string\n+\n    // RequestURI is the unmodified Request-URI of the\n    // Request-Line (RFC 2616, Section 5.1) as sent by the client\n    // to a server. Usually the URL field should be used instead.\ndiff -u go-stock-library/server.go ./server.go\n--- go-stock-library/server.go  2016-04-13 17:29:19.000000000 +0200\n+++ ./server.go 2016-04-13 17:31:38.000000000 +0200\n@@ -161,6 +161,13 @@\n    // This is the value of a Handler's (*Request).RemoteAddr.\n    remoteAddr string\n\n+   // serverAddr is rwc.LocalAddr().String(). It is not populated synchronously\n+   // inside the Listener's Accept goroutine, as some implementations block.\n+   // It is populated immediately inside the (*conn).serve goroutine.\n+   // This is the value of a Handler's (*Request).LocalAddr.\n+   localAddr string\n+   \n+\n    // tlsState is the TLS connection state when using TLS.\n    // nil means not TLS.\n    tlsState *tls.ConnectionState\n@@ -736,6 +743,7 @@\n    delete(req.Header, \"Host\")\n\n    req.RemoteAddr = c.remoteAddr\n+   req.LocalAddr = c.localAddr\n    req.TLS = c.tlsState\n    if body, ok := req.Body.(*body); ok {\n        body.doEarlyClose = true\n@@ -1382,6 +1390,7 @@\n // Serve a new connection.\n func (c *conn) serve() {\n    c.remoteAddr = c.rwc.RemoteAddr().String()\n+   c.localAddr = c.rwc.LocalAddr().String()\n    defer func() {\n        if err := recover(); err != nil {\n            const size = 64 &lt;&lt; 10\n</code></pre>\n\n<p>and then use the new LocalAddr in the code in a nice and clean way.</p>\n\n<p>Is there a cleaner way to do this?</p>\n"}, {"tags": ["go", "time", "calc"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1460561966, "creation_date": 1460561966, "answer_id": 36603310, "question_id": 36603202, "link": "https://stackoverflow.com/questions/36603202/cant-i-use-variables-for-time-calculations-in-golang/36603310#36603310", "title": "Can&#39;t I use variables for time calculations in golang?", "body": "<p>Like the error says, you have mismatched types. Convert the integer result to a <code>time.Duration</code>:</p>\n\n<pre><code>diff = time.Duration(60-i) * time.Minute\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6950, "user_id": 5371821, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/gHZQr.jpg?s=128&g=1", "display_name": "starkshang", "link": "https://stackoverflow.com/users/5371821/starkshang"}, "is_accepted": false, "score": 1, "last_activity_date": 1460562094, "creation_date": 1460562094, "answer_id": 36603366, "question_id": 36603202, "link": "https://stackoverflow.com/questions/36603202/cant-i-use-variables-for-time-calculations-in-golang/36603366#36603366", "title": "Can&#39;t I use variables for time calculations in golang?", "body": "<p><code>time.Duration</code> actually is type <code>int64</code>,so if you want to use variable to make what you want,just declare the variable to <code>time.Duration</code>,like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n\n    // the time now\n    fmt.Println(time.Now())\n\n    // the time 50 minutes ago - WORKS\n    diff := (60 - 10) * time.Minute\n    newTime := time.Now().Add(-diff)\n    fmt.Println(newTime)\n\n    // the time 50 minutes ago - DOESN'T WORKS!\n    var i time.Duration\n    diff = (60 - i) * time.Minute\n    newTime = time.Now().Add(-diff)\n    fmt.Println(newTime)\n}\n</code></pre>\n"}], "owner": {"reputation": 91, "user_id": 5420567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f237a437ac30cc5b4095767040da79ff?s=128&d=identicon&r=PG", "display_name": "dodiku", "link": "https://stackoverflow.com/users/5420567/dodiku"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1685, "favorite_count": 0, "closed_date": 1460576154, "accepted_answer_id": 36603310, "answer_count": 2, "score": 0, "last_activity_date": 1460562106, "creation_date": 1460561689, "question_id": 36603202, "link": "https://stackoverflow.com/questions/36603202/cant-i-use-variables-for-time-calculations-in-golang", "closed_reason": "Duplicate", "title": "Can&#39;t I use variables for time calculations in golang?", "body": "<p>I'm trying to calculate the time 10 minutes ago.\nWhy can't I do this calculation with variables (usable for a for loop).\nSee -</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n\n    // the time now\n    fmt.Println(time.Now())\n\n    // the time 50 minutes ago - WORKS\n    diff := (60 - 10) * time.Minute\n    newTime := time.Now().Add(-diff)\n    fmt.Println(newTime)\n\n    // the time 50 minutes ago - DOESN'T WORKS!\n    i := 10\n    diff = (60 - i) * time.Minute\n    newTime = time.Now().Add(-diff)\n    fmt.Println(newTime)\n}\n</code></pre>\n\n<p>Why <code>diff = (60 - i) * time.Minute</code> doesn't work?\nThis is the error I'm getting -</p>\n\n<pre><code>prog.go:20: invalid operation: (60 - i) * time.Minute (mismatched types int and time.Duration)\n</code></pre>\n\n<p>For Go Playground: <a href=\"https://play.golang.org/p/TJ03K0ULg2\" rel=\"nofollow\">https://play.golang.org/p/TJ03K0ULg2</a></p>\n\n<p>Thanks a lot!</p>\n"}, {"tags": ["json", "go", "struct", "null"], "answers": [{"comments": [{"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 2, "creation_date": 1460560313, "post_id": 36601507, "comment_id": 60802295, "body": "The use of <code>map[string]interface{}</code>, though interesting, in this case is an overkill and overly complicate."}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "reply_to_user": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 0, "creation_date": 1460560534, "post_id": 36601507, "comment_id": 60802473, "body": "Agree with @pie-o-pah, this would hide type of somefield1 but it&#39;s very interesting to know it&#39;s working at all."}], "tags": [], "owner": {"reputation": 1356, "user_id": 5688488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b0072c03a45630ffe30f8a9e1a3f00?s=128&d=identicon&r=PG&f=1", "display_name": "Benjamin Kadish", "link": "https://stackoverflow.com/users/5688488/benjamin-kadish"}, "is_accepted": false, "score": 4, "last_activity_date": 1460558384, "last_edit_date": 1460558384, "creation_date": 1460557636, "answer_id": 36601507, "question_id": 36601367, "link": "https://stackoverflow.com/questions/36601367/json-field-set-to-null-vs-field-not-there/36601507#36601507", "title": "JSON field set to null vs field not there", "body": "<p>If you unmarshall the object into a map[string]interface{} then you can just check if a field is there </p>\n\n<pre><code>type unMarshalledObject map[string]interface{}\njson.Unmarshall(input, unMarshhaledObject)\n_, ok := unMarshalledObject[\"somefield2\"]\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/mmvdPnxmEJ\" rel=\"nofollow\">Go Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": false, "score": 5, "last_activity_date": 1460559051, "last_edit_date": 1460559051, "creation_date": 1460558279, "answer_id": 36601783, "question_id": 36601367, "link": "https://stackoverflow.com/questions/36601367/json-field-set-to-null-vs-field-not-there/36601783#36601783", "title": "JSON field set to null vs field not there", "body": "<p>Good question.</p>\n\n<p>I believe you can use <a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"noreferrer\">https://golang.org/pkg/encoding/json/#RawMessage</a> as:</p>\n\n<pre><code>type MyMessage struct {\n  somefield1 string\n  somefield2 json.RawMessage\n}\n</code></pre>\n\n<p>So after unmarshalling you should have <code>[]byte(\"null\")</code> in case of <code>null</code> and <code>nil</code> if missing.</p>\n\n<p>Here is a playground code: <a href=\"https://play.golang.org/p/UW8L68K068\" rel=\"noreferrer\">https://play.golang.org/p/UW8L68K068</a></p>\n"}, {"comments": [{"owner": {"reputation": 15219, "user_id": 894977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f18198ad9bdf73fa1d90956f7028254?s=128&d=identicon&r=PG", "display_name": "Cetin Basoz", "link": "https://stackoverflow.com/users/894977/cetin-basoz"}, "edited": false, "score": 1, "creation_date": 1460558724, "post_id": 36601869, "comment_id": 60800847, "body": "Sorry, I am a newbie to Go, and I am not sure but wouldn&#39;t this say it is null if say SomeField2 was &quot;hello&quot;?"}, {"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "reply_to_user": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 1, "creation_date": 1460560072, "post_id": 36601869, "comment_id": 60802099, "body": "@AlexanderTrakhimenok thanks for the elaboration edited as commented."}, {"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "reply_to_user": {"reputation": 15219, "user_id": 894977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f18198ad9bdf73fa1d90956f7028254?s=128&d=identicon&r=PG", "display_name": "Cetin Basoz", "link": "https://stackoverflow.com/users/894977/cetin-basoz"}, "edited": false, "score": 0, "creation_date": 1460560144, "post_id": 36601869, "comment_id": 60802153, "body": "@CetinBasoz yes I&#39;ve added the conditions to the code to cover that."}], "tags": [], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "is_accepted": true, "score": 13, "last_activity_date": 1532188734, "last_edit_date": 1532188734, "creation_date": 1460558450, "answer_id": 36601869, "question_id": 36601367, "link": "https://stackoverflow.com/questions/36601367/json-field-set-to-null-vs-field-not-there/36601869#36601869", "title": "JSON field set to null vs field not there", "body": "<p>Use <code>json.RawMessage</code> to \"delay\" the unmarshaling process to determine the raw byte before deciding to do something:</p>\n\n<pre><code>var data = []byte(`{\n        \"somefield1\":\"somevalue1\",\n        \"somefield2\": null\n}`)\n\ntype Data struct {\n    SomeField1 string          \n    SomeField2 json.RawMessage\n}\n\nfunc main() {\n    d := &amp;Data{}\n\n    _ = json.Unmarshal(data, &amp;d)\n\n    fmt.Println(d.SomeField1)\n\n    if len(d.SomeField2) &gt; 0 {\n        if string(d.SomeField2) == \"null\" {\n            fmt.Println(\"somefield2 is there but null\")\n        } else {\n            fmt.Println(\"somefield2 is there and not null\")\n            // Do something with the data\n        }\n    } else {\n        fmt.Println(\"somefield2 doesn't exist\")\n    }\n}\n</code></pre>\n\n<p>See the playground <a href=\"https://play.golang.org/p/Wganpf4sbO\" rel=\"noreferrer\">https://play.golang.org/p/Wganpf4sbO</a></p>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 482870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/317fdbefb209ca4b1cc713cc5294da84?s=128&d=identicon&r=PG", "display_name": "e_asphyx", "link": "https://stackoverflow.com/users/482870/e-asphyx"}, "is_accepted": false, "score": -1, "last_activity_date": 1501752326, "creation_date": 1501752326, "answer_id": 45480093, "question_id": 36601367, "link": "https://stackoverflow.com/questions/36601367/json-field-set-to-null-vs-field-not-there/45480093#45480093", "title": "JSON field set to null vs field not there", "body": "<p>If struct field is a pointer, JSON decoder will allocate new variable if the field is present or leave it nil if not. So I suggest to use pointers.</p>\n\n<pre><code>type Data struct {\n    StrField *string\n    IntField *int\n}\n...\nif data.StrField != nil {\n    handle(*data.StrField)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 751, "user_id": 1041286, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9108812e301f7f0a7ed3dcb70a0e3123?s=128&d=identicon&r=PG", "display_name": "jwall", "link": "https://stackoverflow.com/users/1041286/jwall"}, "is_accepted": false, "score": 0, "last_activity_date": 1512632592, "creation_date": 1512632592, "answer_id": 47689989, "question_id": 36601367, "link": "https://stackoverflow.com/questions/36601367/json-field-set-to-null-vs-field-not-there/47689989#47689989", "title": "JSON field set to null vs field not there", "body": "<p>By using <code>github.com/golang/protobuf/ptypes/struct</code> and jsonpb <code>github.com/golang/protobuf/jsonpb</code>, you can do like this:</p>\n\n<pre><code>func TestFunTest(t *testing.T) {\n    p := &amp;pb.KnownTypes{}\n    e := UnmarshalString(`{\"val\":null}`, p)\n    fmt.Println(e, p)\n    p = &amp;pb.KnownTypes{}\n    e = UnmarshalString(`{\"val\":1}`, p)\n    fmt.Println(e, p)\n    p = &amp;pb.KnownTypes{}\n    e = UnmarshalString(`{\"val\":\"string\"}`, p)\n    fmt.Println(e, p)\n    p = &amp;pb.KnownTypes{}\n    e = UnmarshalString(`{}`, p)\n    fmt.Println(e, p)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[ `go test -test.run=\"^TestFunTest$\"` | done: 1.275431416s ]\n    &lt;nil&gt; val:&lt;null_value:NULL_VALUE &gt; \n    &lt;nil&gt; val:&lt;number_value:1 &gt; \n    &lt;nil&gt; val:&lt;string_value:\"string\" &gt; \n    &lt;nil&gt; \n    PASS\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1513, "user_id": 3316716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afbe3fa1baa8a749dd66449baeb9a837?s=128&d=identicon&r=PG", "display_name": "Sosdoc", "link": "https://stackoverflow.com/users/3316716/sosdoc"}, "is_accepted": false, "score": 1, "last_activity_date": 1603096166, "creation_date": 1603096166, "answer_id": 64423698, "question_id": 36601367, "link": "https://stackoverflow.com/questions/36601367/json-field-set-to-null-vs-field-not-there/64423698#64423698", "title": "JSON field set to null vs field not there", "body": "<p>Another way to do this, with a custom type:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>// OptionalString is a struct that represents a JSON string that can be\n// undefined (Defined == false), null (Value == nil &amp;&amp; Defined == true) or \n// defined with a string value\ntype OptionalString struct {\n    Defined bool\n    Value   *string\n}\n\n// UnmarshalJSON implements the json.Unmarshaler interface.\n// When called, it means that the value is defined in the JSON payload.\nfunc (os *OptionalString) UnmarshalJSON(data []byte) error {\n    // UnmarshalJSON is called only if the key is present\n    os.Defined = true\n    return json.Unmarshal(data, &amp;os.Value)\n}\n\n\n// Payload represents the JSON payload that you want to represent.\ntype Payload struct {\n    SomeField1 string         `json:&quot;somefield1&quot;`\n    SomeField2 OptionalString `json:&quot;somefield2&quot;`\n}\n</code></pre>\n<p>You can then just use the regular <code>json.Unmarshal</code> function to get your values, for example:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>    var p Payload\n    _ = json.Unmarshal([]byte(`{\n            &quot;somefield1&quot;:&quot;somevalue1&quot;,\n            &quot;somefield2&quot;:null\n        }`), &amp;p)\n    fmt.Printf(&quot;Should be defined == true and value == nil: \\n%+v\\n\\n&quot;, p)\n\n\n    p = Payload{}\n    _ = json.Unmarshal([]byte(`{&quot;somefield1&quot;:&quot;somevalue1&quot;}`), &amp;p)\n    fmt.Printf(&quot;Should be defined == false \\n%+v\\n\\n&quot;, p)\n    \n    p = Payload{}\n    _ = json.Unmarshal([]byte(`{\n            &quot;somefield1&quot;:&quot;somevalue1&quot;,\n            &quot;somefield2&quot;:&quot;somevalue2&quot;\n        }`), &amp;p)\n    fmt.Printf(&quot;Parsed should be defined == true and value != nil \\n%+v\\n&quot;, p)\n    if p.SomeField2.Value != nil {\n      fmt.Printf(&quot;SomeField2's value is %s&quot;, *p.SomeField2.Value)\n    }\n</code></pre>\n<p>Should give you this output:</p>\n<pre><code>Should be defined == true and value == nil: \n{SomeField1:somevalue1 SomeField2:{Defined:true Value:&lt;nil&gt;}}\n\nShould be defined == false \n{SomeField1:somevalue1 SomeField2:{Defined:false Value:&lt;nil&gt;}}\n\nParsed should be defined == true and value != nil \n{SomeField1:somevalue1 SomeField2:{Defined:true Value:0xc000010370}}\nSomeField2's value is somevalue2\n</code></pre>\n<p>Link to the playground with the full example: <a href=\"https://play.golang.org/p/AUDwPKHBs62\" rel=\"nofollow noreferrer\">https://play.golang.org/p/AUDwPKHBs62</a></p>\n<p>Do note that you <strong>will need one struct for each type you want to wrap</strong>, so, if you need an optional number you'll need to create an <code>OptionalFloat64</code> (all JSON numbers can be 64 bit floats) struct with a similar implementation.\nIf/when generics land in Go, this could be simplified to a single generic struct.</p>\n"}], "owner": {"reputation": 977, "user_id": 5227724, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d8e7291331d1d6448748bfdef7aa5244?s=128&d=identicon&r=PG&f=1", "display_name": "Nighthee", "link": "https://stackoverflow.com/users/5227724/nighthee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8054, "favorite_count": 5, "accepted_answer_id": 36601869, "answer_count": 6, "score": 18, "last_activity_date": 1603096166, "creation_date": 1460557330, "last_edit_date": 1558953170, "question_id": 36601367, "link": "https://stackoverflow.com/questions/36601367/json-field-set-to-null-vs-field-not-there", "title": "JSON field set to null vs field not there", "body": "<p>Is there a way, in golang, to see if I can differentiate between a json field being set to null vs a json field not being there when unmarshalled into a struct? Because both set the value in the struct to be nil, but I need to know if the field was there to begin with and to see if someone set it to null.</p>\n\n<pre><code>{\n  \"somefield1\":\"somevalue1\",\n  \"somefield2\":null\n}\n</code></pre>\n\n<p>VS</p>\n\n<pre><code>{\n  \"somefield1\":\"somevalue1\",\n}\n</code></pre>\n\n<p>Both jsons will be nil when unmarshalled into a struct.\nAny useful resources will be very appreciated!</p>\n"}, {"tags": ["xml", "go", "marshalling"], "comments": [{"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 0, "creation_date": 1460562542, "post_id": 36599180, "comment_id": 60804047, "body": "You probably need to create your own marshaler to implement <code>xml.Marshaler</code> which will take care of splitting the <code>DateTime</code> field to <code>date</code> and <code>time</code> before marshaling to XML."}], "answers": [{"tags": [], "owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "is_accepted": false, "score": 0, "last_activity_date": 1460552615, "creation_date": 1460552615, "answer_id": 36599281, "question_id": 36599180, "link": "https://stackoverflow.com/questions/36599180/marshal-single-field-into-two-tags-in-golang/36599281#36599281", "title": "Marshal single field into two tags in golang", "body": "<p>Quick guess, you can't. You should implement the <code>xml.Marshaler</code> interface with your <code>Appointment</code> type\u2026</p>\n"}, {"comments": [{"owner": {"reputation": 1084, "user_id": 2915603, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ea6fc9bc47d33adfb6e88ce2909f1a80?s=128&d=identicon&r=PG", "display_name": "ArkadyB", "link": "https://stackoverflow.com/users/2915603/arkadyb"}, "edited": false, "score": 0, "creation_date": 1460795170, "post_id": 36657356, "comment_id": 60916177, "body": "Yes, this is somethingi have done. Not that it would not be a good solution, but i thought there might be some simplier solution"}], "tags": [], "owner": {"reputation": 1525, "user_id": 2119660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ae09f6f1f1e7eabb4438fcde4ddef8b?s=128&d=identicon&r=PG", "display_name": "Jeff Sisson", "link": "https://stackoverflow.com/users/2119660/jeff-sisson"}, "is_accepted": false, "score": 3, "last_activity_date": 1460756769, "creation_date": 1460756769, "answer_id": 36657356, "question_id": 36599180, "link": "https://stackoverflow.com/questions/36599180/marshal-single-field-into-two-tags-in-golang/36657356#36657356", "title": "Marshal single field into two tags in golang", "body": "<p>Complex marshaling/unmarshaling behavior generally requires satisfying a Marshal/Unmarshal interface (this is of true of XML, JSON, and similarly setup types in go).  </p>\n\n<p>You'd need to satisfy the <code>xml.Marshaler</code> interface with a <code>MarshalXML()</code> function, something like the following:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n    \"time\"\n)\n\ntype Appointment struct {\n    DateTime time.Time\n}\n\ntype appointmentExport struct {\n    XMLName struct{} `xml:\"appointment\"`\n    Date    string   `xml:\"date\"`\n    Time    string   `xml:\"time\"`\n}\n\nfunc (a *Appointment) MarshalXML(e *xml.Encoder, start xml.StartElement) error {\n    n := &amp;appointmentExport{\n        Date: a.DateTime.Format(\"2006-01-02\"),\n        Time: a.DateTime.Format(\"15:04\"),\n    }\n    return e.Encode(n)\n}\n\nfunc main() {\n    a := &amp;Appointment{time.Now()}\n    output, _ := xml.MarshalIndent(a, \"\", \"    \")\n    fmt.Println(string(output))\n}\n\n// prints:\n// &lt;appointment&gt;\n//     &lt;date&gt;2016-04-15&lt;/date&gt;\n//     &lt;time&gt;17:43&lt;/time&gt;\n// &lt;/appointment&gt;\n</code></pre>\n"}], "owner": {"reputation": 1084, "user_id": 2915603, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ea6fc9bc47d33adfb6e88ce2909f1a80?s=128&d=identicon&r=PG", "display_name": "ArkadyB", "link": "https://stackoverflow.com/users/2915603/arkadyb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 579, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1460757166, "creation_date": 1460552362, "last_edit_date": 1460757166, "question_id": 36599180, "link": "https://stackoverflow.com/questions/36599180/marshal-single-field-into-two-tags-in-golang", "title": "Marshal single field into two tags in golang", "body": "<p>Trying to understand a way to create custom marshaller for xml structured as:</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;Appointment&gt;\n&lt;Date&gt;2004-12-22&lt;/Date&gt;\n&lt;Time&gt;14:00&lt;/Time&gt;\n&lt;/Appointment&gt;\n</code></pre>\n\n<p>I'm thinking of something like:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>type Appointment struct {\n    DateTime time.Time `xml:\"???\"`\n}\n</code></pre>\n\n<p>Question is, what would i put instead of ??? to have a single field be saved into two different xml tags?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1460552455, "post_id": 36598964, "comment_id": 60795333, "body": "binary.Read reads exactly the size of data required to fill the <code>data</code> argument. So yes, it reads exactly 4 bytes for a <code>uint32</code> and stops."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1460552727, "post_id": 36598964, "comment_id": 60795587, "body": "<code>klen</code> will be assigned the value of 4 bytes (uint32) read from <code>p.buffer</code>, interpreted as big-endian. It will not be assigned the number of bytes read."}, {"owner": {"reputation": 3348, "user_id": 964634, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ecb23bff591cd2ebc53507a963e5b72c?s=128&d=identicon&r=PG", "display_name": "Hard worker", "link": "https://stackoverflow.com/users/964634/hard-worker"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1460555488, "post_id": 36598964, "comment_id": 60798006, "body": "@jimB Are you sure, because that would mean the klen &gt; maxKeyLen condition would never be true, because klen is at most 4 bytes?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1460555537, "post_id": 36598964, "comment_id": 60798046, "body": "Yes. <code>klen</code> is the value read from the buffer, not the number of bytes that was read."}, {"owner": {"reputation": 3348, "user_id": 964634, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ecb23bff591cd2ebc53507a963e5b72c?s=128&d=identicon&r=PG", "display_name": "Hard worker", "link": "https://stackoverflow.com/users/964634/hard-worker"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1460555959, "post_id": 36598964, "comment_id": 60798429, "body": "@jimB I see. So just to confirm, that if statement will never get triggered then? Thanks for your help."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1460556270, "post_id": 36598964, "comment_id": 60798695, "body": "The if statement will be triggered if the value read into <code>klen</code> is greater than 104857600. The same with <code>vlen</code>. Both of those calls will always read exactly 4 bytes, because that&#39;s the size of a <code>uint32</code>, but the value could be anything in <code>[0, 4294967295]</code>"}, {"owner": {"reputation": 3348, "user_id": 964634, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ecb23bff591cd2ebc53507a963e5b72c?s=128&d=identicon&r=PG", "display_name": "Hard worker", "link": "https://stackoverflow.com/users/964634/hard-worker"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1460558417, "post_id": 36598964, "comment_id": 60800603, "body": "@jimb Ok that makes sense. But in that case what is the point of the if statement? I thought it was to prevent key lengths which are too many bytes big (bigger than 100bytes?). But if klen is always 4 bytes, why would the function care what the value is numerically between 0 and 4294967295. Thanks again."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1460559082, "post_id": 36598964, "comment_id": 60801206, "body": "You&#39;re not showing us the rest of the code. These look like they are there to indicate the size of the following data in a length-prefix encoding scheme. The values then should be used to read the correct number of bytes for the corresponding data."}, {"owner": {"reputation": 3348, "user_id": 964634, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ecb23bff591cd2ebc53507a963e5b72c?s=128&d=identicon&r=PG", "display_name": "Hard worker", "link": "https://stackoverflow.com/users/964634/hard-worker"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1460559472, "post_id": 36598964, "comment_id": 60801553, "body": "@jimb This is the source code I am reading: <a href=\"https://github.com/packetzoom/logzoom/blob/master/input/filebeat/parser.go\" rel=\"nofollow noreferrer\">github.com/packetzoom/logzoom/blob/master/input/filebeat/&hellip;</a> I don&#39;t blame you if you don&#39;t want to read that!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1460559668, "post_id": 36598964, "comment_id": 60801755, "body": "it&#39;s is exactly how I described, klen and vlen are used to allocated the correct size slices in order to read in the full key and value."}, {"owner": {"reputation": 3348, "user_id": 964634, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ecb23bff591cd2ebc53507a963e5b72c?s=128&d=identicon&r=PG", "display_name": "Hard worker", "link": "https://stackoverflow.com/users/964634/hard-worker"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1460560791, "post_id": 36598964, "comment_id": 60802671, "body": "@jimb The penny has finally dropped! Now I get it."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1460555656, "post_id": 36599722, "comment_id": 60798167, "body": "the Read function isn&#39;t checking the &quot;fixed size&quot; of p.buffer, it&#39;s checking the size of the type for <code>data</code>. The <code>r</code> argument is just an <code>io.Reader</code> and doesn&#39;t require a size."}, {"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1460632260, "post_id": 36599722, "comment_id": 60838399, "body": "ah. ur right. that&#39;s what I get for answering on a mobile and reading too fast. updated."}], "tags": [], "owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "is_accepted": false, "score": 3, "last_activity_date": 1460632223, "last_edit_date": 1460632223, "creation_date": 1460553589, "answer_id": 36599722, "question_id": 36598964, "link": "https://stackoverflow.com/questions/36598964/how-does-this-binary-read-know-when-to-stop/36599722#36599722", "title": "How does this binary.read know when to stop?", "body": "<p>When questioning the superheros of Go, always refer to their actual source code in question:</p>\n\n<p><a href=\"https://golang.org/src/encoding/binary/binary.go?s=4201:4264#L132\" rel=\"nofollow\">https://golang.org/src/encoding/binary/binary.go?s=4201:4264#L132</a></p>\n\n<pre><code>142 func Read(r io.Reader, order ByteOrder, data interface{}) error {\n143     // Fast path for basic types and slices.\n144     if n := intDataSize(data); n != 0 {\n</code></pre>\n\n<p>Line 144 shows an example of reading the initial size of know types, and iterating or copying as needed later in that scope.</p>\n\n<p>In your code example above, it will be the 4 byte length of klen which is an <code>uint32</code>.  That is, it will read 4 bytes from <code>p.buffer</code> into klen.</p>\n\n<p>It gives a hint in the documentation:</p>\n\n<p><a href=\"https://golang.org/pkg/encoding/binary/#Read\" rel=\"nofollow\">https://golang.org/pkg/encoding/binary/#Read</a></p>\n\n<pre><code>func Read(r io.Reader, order ByteOrder, data interface{}) error\n</code></pre>\n\n<blockquote>\n  <p>Read reads structured binary data from r into data. Data must be a pointer to a fixed-size value or a slice of fixed-size values. Bytes read from r are decoded using the specified byte order and written to successive fields of the data.</p>\n</blockquote>\n"}], "owner": {"reputation": 3348, "user_id": 964634, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/ecb23bff591cd2ebc53507a963e5b72c?s=128&d=identicon&r=PG", "display_name": "Hard worker", "link": "https://stackoverflow.com/users/964634/hard-worker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1460632223, "creation_date": 1460551868, "last_edit_date": 1460554002, "question_id": 36598964, "link": "https://stackoverflow.com/questions/36598964/how-does-this-binary-read-know-when-to-stop", "title": "How does this binary.read know when to stop?", "body": "<p>Please note this is pseudo code and I am summarising.I am reading some source code from inside a function:</p>\n\n<pre><code>maxKeyLen  := 100 * 1024 * 1024\nmaxValueLen  := 100 * 1024 * 1024\nvar klen, vlen uint32\nbinary.Read(p.buffer, binary.BigEndian, &amp;klen)\n\n if klen &gt; maxKeyLen {\n    return nil, nil, fmt.Errorf(\"key exceeds max len %d, got %d bytes\", maxKeyLen, klen)\n}\n</code></pre>\n\n<p>At what point does the binary.Read stop? Because straight after this there is another read: </p>\n\n<pre><code>key := make([]byte, klen)\n_, err := p.buffer.Read(key)\nif err != nil {\n    return nil, nil, err\n}\n\nbinary.Read(p.buffer, binary.BigEndian, &amp;vlen)\nif vlen &gt; maxValueLen {\n    return nil, nil, fmt.Errorf(\"value exceeds max len %d, got %d bytes\", maxValueLen, vlen)\n}\n</code></pre>\n\n<p>Where p.buffer is defined via:</p>\n\n<pre><code>buff := new(bytes.Buffer)\nio.Copy(buff, r)\np.buffer = buff\n</code></pre>\n\n<p>And r is some data that has been passed in.</p>\n\n<p>At first I thought the answer was at 4 bytes it stops. But that's not true because the maxkeylen checks for greater than that. So how does the binary.read know when to stop as there is more data ahead, because the next binary read on for the vlen then finds stuff?</p>\n"}, {"tags": ["if-statement", "select", "go", "return", "goroutine"], "comments": [{"owner": {"reputation": 3, "user_id": 4181182, "user_type": "registered", "profile_image": "https://graph.facebook.com/100006858331812/picture?type=large", "display_name": "Andrei Rudakov", "link": "https://stackoverflow.com/users/4181182/andrei-rudakov"}, "edited": false, "score": 0, "creation_date": 1460553461, "post_id": 36598819, "comment_id": 60796241, "body": "Maybe I&#39;m doing something wrong? I try to transmit the data A1 in the Post request, and treat them to third-party service, the answer of which will come in the form of A2, B2. Then I compare == A1 A2 and write in the Post B2."}], "answers": [{"tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": false, "score": 1, "last_activity_date": 1460552501, "creation_date": 1460552501, "answer_id": 36599236, "question_id": 36598819, "link": "https://stackoverflow.com/questions/36598819/go-how-to-use-golang-goroutine-select-and-if-statement-to-return/36599236#36599236", "title": "go - How to use golang goroutine, select and if statement to return?", "body": "<p>After <code>postHandler</code> receives <code>msg</code> from channel <code>jr</code>, that value is not in the channel anymore for another <code>postHandler</code> to find. Channels do not broadcast.</p>\n\n<p>Either <a href=\"http://play.golang.org/p/K8X7br0Vnp\" rel=\"nofollow\">send the value back into the channel</a> if it's not equal to <code>num</code> or restructure your code entirely.</p>\n"}, {"comments": [{"owner": {"reputation": 3, "user_id": 4181182, "user_type": "registered", "profile_image": "https://graph.facebook.com/100006858331812/picture?type=large", "display_name": "Andrei Rudakov", "link": "https://stackoverflow.com/users/4181182/andrei-rudakov"}, "edited": false, "score": 0, "creation_date": 1460557958, "post_id": 36599286, "comment_id": 60800178, "body": "Interestingly another version."}], "tags": [], "owner": {"reputation": 8433, "user_id": 2667536, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/UfmAF.png?s=128&g=1", "display_name": "Derlin", "link": "https://stackoverflow.com/users/2667536/derlin"}, "is_accepted": true, "score": 1, "last_activity_date": 1460552633, "creation_date": 1460552633, "answer_id": 36599286, "question_id": 36598819, "link": "https://stackoverflow.com/questions/36598819/go-how-to-use-golang-goroutine-select-and-if-statement-to-return/36599286#36599286", "title": "go - How to use golang goroutine, select and if statement to return?", "body": "<p>Ok, there are multiple problems. </p>\n\n<p>First and foremost, it does not work because when something is read from a channel, it disappears (it is not a broadcast, only one thread can read the message).</p>\n\n<p>So in order for your code to pseudo-work, you could do this:</p>\n\n<pre><code> if msg == num {\n      fmt.Println(num, \"hello from\", msg)\n      return\n }else {\n      // not my number, put it back in the channel\n      jr &lt;- num\n }\n</code></pre>\n\n<p>You will ge the expected result, but there is still a problem: your program won't shutdown properly. I guess this is only for experiment/learning purposes, but in a real program you would use a completely different code. Tell me if another version would interest you.</p>\n"}], "owner": {"reputation": 3, "user_id": 4181182, "user_type": "registered", "profile_image": "https://graph.facebook.com/100006858331812/picture?type=large", "display_name": "Andrei Rudakov", "link": "https://stackoverflow.com/users/4181182/andrei-rudakov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1332, "favorite_count": 0, "accepted_answer_id": 36599286, "answer_count": 2, "score": 0, "last_activity_date": 1460552633, "creation_date": 1460551488, "last_edit_date": 1460552430, "question_id": 36598819, "link": "https://stackoverflow.com/questions/36598819/go-how-to-use-golang-goroutine-select-and-if-statement-to-return", "title": "go - How to use golang goroutine, select and if statement to return?", "body": "<p>I'm trying to make a \"if\" statement in goroutine.\nQuestion: how to make 10 from 10?</p>\n\n<pre><code>var jr = make(chan int, 10)\nvar clients = 10 // The number of clients varies with time.\n\nfunc rpcMethod(num int) {\n    time.Sleep(time.Duration(rand.Intn(int(time.Second))))\n    jr &lt;- num\n}\n\nfunc postHandler(num int) {\n    // wait RPC data\n    for {\n        select {\n        case msg := &lt;-jr:\n            {\n                if msg == num {\n                    fmt.Println(num, \"hello from\", msg)\n                    return\n                }\n            }\n        }\n    }\n}\n\nfunc main() {\n    for i := 0; i &lt; clients; i++ {\n        go postHandler(i)\n        go rpcMethod(i)\n    }\n    fmt.Scanln()\n}\n</code></pre>\n\n<h2>Result 2/10</h2>\n\n<ul>\n<li>5 hello from 5</li>\n<li>2 hello from 2</li>\n</ul>\n"}, {"tags": ["go", "https", "client-certificates"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1460548309, "post_id": 36597116, "comment_id": 60791672, "body": "Are the files really in <code>&#47;</code>? What&#39;s the error from your program?"}, {"owner": {"reputation": 1, "user_id": 6124297, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5d3bb29fc6443838c54c139f31b030a?s=128&d=identicon&r=PG&f=1", "display_name": "SHANTANU DAS", "link": "https://stackoverflow.com/users/6124297/shantanu-das"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1460549577, "post_id": 36597116, "comment_id": 60792728, "body": "Yes. Those are paths for the file. I am getting status:500 Null Pointer Exception, as the service is not able to read these certificates for https RESTful webservice."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1460551689, "post_id": 36597116, "comment_id": 60794629, "body": "That&#39;s not a Go error. Please show us the exact error from the code above. Your code will try to deterrence a nil pointer if there&#39;s an error with client.Post, but that&#39;s separate from loading the certs."}, {"owner": {"reputation": 1, "user_id": 6124297, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5d3bb29fc6443838c54c139f31b030a?s=128&d=identicon&r=PG&f=1", "display_name": "SHANTANU DAS", "link": "https://stackoverflow.com/users/6124297/shantanu-das"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1460554169, "post_id": 36597116, "comment_id": 60796862, "body": "From the server Side we are trying to read the certificates in the Request,and that time it is throwing this Exception. <code>CLIENT:  &amp;{0xc8e6090 &lt;nil&gt; &lt;nil&gt; 0}{&quot;timestamp&quot;:1460546631323,&quot;status&quot;:500,&quot;error&quot;:&quot;Internal Server Error&quot;,&quot;exception&quot;:&quot;java.lang.NullPointerException&quot;,&quot;message&zwnj;&#8203;&quot;:&quot;No message available&quot;,&quot;path&quot;:&quot;..&#47;..&quot;</code>"}], "owner": {"reputation": 1, "user_id": 6124297, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5d3bb29fc6443838c54c139f31b030a?s=128&d=identicon&r=PG&f=1", "display_name": "SHANTANU DAS", "link": "https://stackoverflow.com/users/6124297/shantanu-das"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 780, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1460547272, "creation_date": 1460547272, "question_id": 36597116, "link": "https://stackoverflow.com/questions/36597116/golang-issue-how-to-pass-key-pem-cert-pem-chain-pem-certificates-in-golang", "title": "GoLang issue: How to pass key.pem, cert.pem, chain.pem certificates in GoLang", "body": "<p>I am trying with the following code by passing cert.pem, key.pem and ..chain.pem but getting status:500 as the service is not able to read these certificates for https RESTful webservice. I went through all the examples in net and tried but still getting same exception.</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"crypto/x509\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"strings\"\n    \"io\"        \n)\n\nfunc main() {\n\n    UserName := \"user\"\n    appName := \"AP\"\n    PasswordKey := \"key\"\n    ServerName := \"server\"\n    Sid := \"sid\" \n\n    // Load client cert\n    cert, err := tls.LoadX509KeyPair(\"/cert.pem\", \"/key.pem\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Load CA cert\n    caCert, err := ioutil.ReadFile(\"/xyz.chain.pem\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    caCertPool := x509.NewCertPool()\n    ok := caCertPool.AppendCertsFromPEM(caCert)\n    if !ok {\n        panic(\"failed to parse root certificate\")\n    }\n\n    fmt.Println(\"CERT: \",cert)\n\n    // Setup HTTPS client\n    tlsConfig := &amp;tls.Config{\n        Certificates: []tls.Certificate{cert},\n        ServerName: \"serverName\",\n        RootCAs:      caCertPool,\n    }\n\n    tlsConfig.BuildNameToCertificate()\n    transport := &amp;http.Transport{TLSClientConfig: tlsConfig}\n    client := &amp;http.Client{Transport: transport}\n    fmt.Println(\"CLIENT: \",client)\n\n r := strings.NewReader(\"{\\\"userName\\\" : \\\"\" +UserName+\"\\\",\\\"appName\\\" : \\\"\"+appName+\"\\\",\\\"passwordKey\\\" : \\\"\"+PasswordKey+\"\\\",\\\"serverName\\\" : \\\"\"+ServerName+\"\\\",\\\"sid\\\" : \\\"\"+Sid+\"\\\"}\")\n        lr := io.Reader(r)\n\n\n    resp, err := client.Post(\"https://xzytr/password/txt\",\"application/json\",lr)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    contents, err := ioutil.ReadAll(resp.Body)\n    fmt.Printf(\"%s\\n\", string(contents))\n}\n</code></pre>\n"}, {"tags": ["image", "go", "transparency"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1460549938, "last_edit_date": 1460549938, "creation_date": 1460547127, "answer_id": 36597077, "question_id": 36595687, "link": "https://stackoverflow.com/questions/36595687/transparent-pixel-color-go-lang-image/36597077#36597077", "title": "Transparent pixel color - Go lang image", "body": "<p>It's because the <code>Set()</code> method sets (<em>overwrites</em>) the color of the pixel at the specified location. This is not what you want.</p>\n\n<p>You want to combine the original color of the pixel with a color of your choosing, and you want this to be the final color.</p>\n\n<p>For this to achieve, first you may query the original color with <code>Image.At()</code>, then combine the color with whatever you want to (you may do this by red, green, blue and alpha channels separately), and set the final color with the <code>Set()</code> method.</p>\n\n<p><strong>Combining:</strong></p>\n\n<p>Note that the <code>R</code>, <code>G</code>, <code>B</code>, <code>A</code> fields of the <a href=\"https://golang.org/pkg/image/color/#RGBA\" rel=\"nofollow\">color.RGBA</a> struct are alpha-premultiplied values, which means the <code>R</code> field for example holds the value of the color's red component multiplied by the alpha channel.</p>\n\n<p>You may use the <a href=\"https://golang.org/pkg/image/color/#RGBA.RGBA\" rel=\"nofollow\"><code>RGBA.RGBA()</code></a> method which returns all the fields as <code>uint32</code> values, and all will be in the range of <code>0..0xffff</code> so you may do operations on them without having to worry about overflow (max value of <code>uint8</code> is <code>255</code>, so even by adding 2 of them could easily overflow).</p>\n\n<p>So when you combine 2 colors, you may combine by components. But note that type of these fields in <code>color.RGBA</code> is <code>uint8</code>, so after combining you have to convert the result to fit into 8 bits, so you have to shift right by 8.</p>\n\n<p>A very simple combining: calculating average:</p>\n\n<pre><code>// Query:\nx, y := 1, 1\nr, g, b, a := img.At(x, y).RGBA()\n\n// Combine:\ncol := color.RGBA{85, 165, 34, 50}\nr2, g2, b2, a2 := col.RGBA()\n\ncol.R = uint8((r + r2) &gt;&gt; 9) // div by 2 followed by \"&gt;&gt; 8\"  is \"&gt;&gt; 9\"\ncol.G = uint8((g + g2) &gt;&gt; 9)\ncol.B = uint8((b + b2) &gt;&gt; 9)\ncol.A = uint8((a + a2) &gt;&gt; 9)\n\n// Set new pixel:\nimg.Set(x, y, col)\n</code></pre>\n\n<p>You may incorporate this into a helper function:</p>\n\n<pre><code>func combine(c1, c2 color.Color) color.Color {\n    r, g, b, a := c1.RGBA()\n    r2, g2, b2, a2 := c2.RGBA()\n\n    return color.RGBA{\n        uint8((r + r2) &gt;&gt; 9), // div by 2 followed by \"&gt;&gt; 8\"  is \"&gt;&gt; 9\"\n        uint8((g + g2) &gt;&gt; 9),\n        uint8((b + b2) &gt;&gt; 9),\n        uint8((a + a2) &gt;&gt; 9),\n    }\n}\n</code></pre>\n\n<p>And using it:</p>\n\n<pre><code>x, y := 1, 1\nimg.Set(x, y, combine(img.At(x, y), color.RGBA{85, 165, 34, 50}))\n</code></pre>\n\n<p>Please check out the <a href=\"https://en.wikipedia.org/wiki/Alpha_compositing\" rel=\"nofollow\">Alpha compositing</a> page if you need realistic color compositing.</p>\n"}], "owner": {"reputation": 1040, "user_id": 5081185, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/yQ8Wl.jpg?s=128&g=1", "display_name": "Mat&#250;\u0161 \u010congr&#225;dy", "link": "https://stackoverflow.com/users/5081185/mat%c3%ba%c5%a1-%c4%8congr%c3%a1dy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1982, "favorite_count": 2, "accepted_answer_id": 36597077, "answer_count": 1, "score": 4, "last_activity_date": 1460549938, "creation_date": 1460543466, "question_id": 36595687, "link": "https://stackoverflow.com/questions/36595687/transparent-pixel-color-go-lang-image", "title": "Transparent pixel color - Go lang image", "body": "<p>I'm trying to create a heat map from eye-tracker results (showing where on the screen was the user looking most frequently).</p>\n\n<p>For pixels that the user looked frequently onto, I want to set non-transparent red color, for a bit less-frequent orange color, etc..\nI'm using red to green color-scale.\nBut for the pixels with the least frequency, I want them to not only show green color, I want them to be transparent.</p>\n\n<pre><code>imgfile, err := os.Open(\"unchanged.jpeg\")\ndefer imgfile.Close()\nif err != nil {\n    fmt.Println(err.Error())\n}\n\ndecodedImg, err := jpeg.Decode(imgfile)\nimg := image.NewRGBA(decodedImg.Bounds())\n\nsize := img.Bounds().Size()\nfor x := 0; x &lt; size.X; x++ {\n    for y := 0; y &lt; size.Y; y++ {\n        img.Set(x, y, decodedImg.At(x, y))\n    }\n}\n\n// I change some pixels here with img.Set(...)\n\noutFile, _ := os.Create(\"changed.png\")\ndefer outFile.Close()\npng.Encode(outFile, img)\n</code></pre>\n\n<p>The problem is that when I try to change color for example with <code>img.Set(x, y, color.RGBA{85, 165, 34, 50})</code> it doesn't actually color the pixel as averaged value depending on old and new color, it just shows some new, strange-looking color.</p>\n\n<p>Image with alpha RGBA value set to 50: (transparent)</p>\n\n<p><a href=\"https://i.stack.imgur.com/DQAzl.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/DQAzl.png\" alt=\"enter image description here\"></a> </p>\n\n<p>Image with alpha RGBA value set to 255: (opaque)</p>\n\n<p><a href=\"https://i.stack.imgur.com/Q1xKa.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Q1xKa.png\" alt=\"enter image description here\"></a></p>\n\n<p>I'm using png image that as far as I know does support transparency.\nWhy does this happen? Any ideas that can solve this problem and make the least-frequently seen pixels appear transparent?</p>\n\n<p>Thanks for every answer.</p>\n"}, {"tags": ["go", "https", "client"], "comments": [{"owner": {"reputation": 163028, "user_id": 477878, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qounX.jpg?s=128&g=1", "display_name": "Joachim Isaksson", "link": "https://stackoverflow.com/users/477878/joachim-isaksson"}, "edited": false, "score": 1, "creation_date": 1460535705, "post_id": 36592382, "comment_id": 60782355, "body": "If you do <code>resp, err := cli.Head(&quot;https:&#47;&#47;www.google.com&quot;)</code> and print <code>err</code>, what does it say?"}, {"owner": {"reputation": 9, "user_id": 4380050, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6511bc3da99631d387785efd72cbf6a?s=128&d=identicon&r=PG&f=1", "display_name": "hjolin", "link": "https://stackoverflow.com/users/4380050/hjolin"}, "reply_to_user": {"reputation": 163028, "user_id": 477878, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qounX.jpg?s=128&g=1", "display_name": "Joachim Isaksson", "link": "https://stackoverflow.com/users/477878/joachim-isaksson"}, "edited": false, "score": 0, "creation_date": 1460536471, "post_id": 36592382, "comment_id": 60782854, "body": "@JoachimIsaksson it outputs <b>2016/04/13 16:34:15 Head <a href=\"https://www.google.com.sg/?gfe_rd=cr&amp;ei=HAQOV9vnBcLU8AfktoiYCA\" rel=\"nofollow noreferrer\">google.com.sg/?gfe_rd=cr&amp;ei=HAQOV9vnBcLU8AfktoiYCA</a>: dial tcp 59.24.3.173:443: getsockopt: connection refused exit status 1</b>"}, {"owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "edited": false, "score": 0, "creation_date": 1460536610, "post_id": 36592382, "comment_id": 60782963, "body": "btw, you can nest struct pointer literals, ie <code>cli := &amp;http.Client{Transport: &amp;http.Transport{TLSClientConfig:conf}}</code>"}, {"owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "edited": false, "score": 0, "creation_date": 1460536696, "post_id": 36592382, "comment_id": 60783017, "body": "what about printing the other err? <code>caCert, err := ioutil.ReadFile(&quot;.&#47;cacert.pem&quot;)</code>"}, {"owner": {"reputation": 9, "user_id": 4380050, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6511bc3da99631d387785efd72cbf6a?s=128&d=identicon&r=PG&f=1", "display_name": "hjolin", "link": "https://stackoverflow.com/users/4380050/hjolin"}, "reply_to_user": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "edited": false, "score": 0, "creation_date": 1460538412, "post_id": 36592382, "comment_id": 60784214, "body": "@matt.s no error loading cacert.pem"}, {"owner": {"reputation": 9, "user_id": 4380050, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6511bc3da99631d387785efd72cbf6a?s=128&d=identicon&r=PG&f=1", "display_name": "hjolin", "link": "https://stackoverflow.com/users/4380050/hjolin"}, "edited": false, "score": 0, "creation_date": 1460541354, "post_id": 36592382, "comment_id": 60786506, "body": "When I specify the remote host as IP address <code>resp, err := cli.Head(&quot;https:&#47;&#47;202.86.162.172&quot;)</code> , I get this error <b>2016/04/13 17:51:18 Head <a href=\"https://202.86.162.172\" rel=\"nofollow noreferrer\">202.86.162.172</a>: x509: cannot validate certificate for 202.86.162.172 because it doesn&#39;t contain any IP SANs exit status 1</b> ,I don&#39;t understand what this is"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1460543300, "post_id": 36592382, "comment_id": 60787966, "body": "The server doesn&#39;t know what certificate to use if you if you don&#39;t connect with a name, and you can&#39;t verify a cert without a name. A server might have a cert with a SAN for the IP address, but it&#39;s not likely. You should know how SNI works."}], "owner": {"reputation": 9, "user_id": 4380050, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6511bc3da99631d387785efd72cbf6a?s=128&d=identicon&r=PG&f=1", "display_name": "hjolin", "link": "https://stackoverflow.com/users/4380050/hjolin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 827, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1460540481, "creation_date": 1460535149, "last_edit_date": 1460540481, "question_id": 36592382, "link": "https://stackoverflow.com/questions/36592382/how-to-write-a-practical-https-client-in-golang", "title": "How to write a practical https client in golang", "body": "<p>I am building a https client in golang, which is supposed to connect to a specified host and get the server name from the header or the certificate of the host. This is my code</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"crypto/x509\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\nfunc main() {\n    caCert, _ := ioutil.ReadFile(\"./cacert.pem\")\n    caCertPool := x509.NewCertPool()\n    caCertPool.AppendCertsFromPEM(caCert)\n\n    conf := &amp;tls.Config{RootCAs: caCertPool}\n    conf.BuildNameToCertificate()\n    tr := &amp;http.Transport{TLSClientConfig: conf}\n    cli := &amp;http.Client{Transport: tr}\n    resp, _ := cli.Head(\"https://www.google.com\")\n    fmt.Println(resp.TLS.ServerName)\n}\n</code></pre>\n\n<p>But it is running into a panic</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xb code=0x1 addr=0x88 pc=0x401314]\n\ngoroutine 1 [running]:\npanic(0x7145e0, 0xc82000a100)\n/usr/local/go/src/runtime/panic.go:464 +0x3e6\nmain.main()\n/home/huangjian/anti-GFW/go-checkgoogleip/checkip.go:22 +0x314\nexit status 2\n</code></pre>\n\n<p>Maybe I am lack of solid knowledge of public key encryption but now I just want to make it work. Could anyone tell me where did I do wrongly and how to correct it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 2, "creation_date": 1460535223, "post_id": 36592199, "comment_id": 60782036, "body": "First try to understand the language. You need to provide a float64 value to <code>math.Acos()</code> function. The correct way: <code>math.Acos(f1)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 4789, "user_id": 2926113, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/w5pMp.jpg?s=128&g=1", "display_name": "Railslide", "link": "https://stackoverflow.com/users/2926113/railslide"}, "is_accepted": true, "score": 2, "last_activity_date": 1460535483, "creation_date": 1460535483, "answer_id": 36592491, "question_id": 36592199, "link": "https://stackoverflow.com/questions/36592199/how-to-use-built-in-methods-in-golang/36592491#36592491", "title": "How to use built in methods in Golang?", "body": "<p><code>Acos</code> is a function of the <code>math</code> package, not a built-in method of float64, so you must import it first</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"math\"\n)\n</code></pre>\n\n<p>Then, <a href=\"https://golang.org/pkg/math/#Acos\" rel=\"nofollow\">as per documentation</a>, you pass <code>f1</code> as an argument to the <code>math.Acos</code> </p>\n\n<pre><code>fmt.Println(math.Acos(f1))\n</code></pre>\n"}], "owner": {"reputation": 401, "user_id": 1180121, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/4845899d3a9d8556149269f789cf3a82?s=128&d=identicon&r=PG", "display_name": "sid_09", "link": "https://stackoverflow.com/users/1180121/sid-09"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 36592491, "answer_count": 1, "score": -2, "last_activity_date": 1460535483, "creation_date": 1460534598, "question_id": 36592199, "link": "https://stackoverflow.com/questions/36592199/how-to-use-built-in-methods-in-golang", "title": "How to use built in methods in Golang?", "body": "<p>I am trying this simple code:</p>\n\n<pre><code>var f1 float64 = 23.435\nfmt.Println(f1.Acos())\n</code></pre>\n\n<p>But it gives me the following error:</p>\n\n<pre><code>f1.Acos undefined (type float64 has no field or method Acos)\n</code></pre>\n\n<p>Can anybody help me in understanding the right way of using the built in methods ? </p>\n"}, {"tags": ["memory-management", "go", "garbage-collection", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1460553092, "post_id": 36591069, "comment_id": 60795921, "body": "Something is corrupting the Go heap, but I don&#39;t see anything obvious from the excerpts here. Are you using go1.6, and have to checked the code with the Go race detector or memory sanitizer?"}, {"owner": {"reputation": 141, "user_id": 6029027, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ac9c83841db833d09ea9bfaf8d72d42?s=128&d=identicon&r=PG&f=1", "display_name": "Wyatt", "link": "https://stackoverflow.com/users/6029027/wyatt"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1460606565, "post_id": 36591069, "comment_id": 60823972, "body": "@JimB I do use go1.6. Basically, this is not a concurrent program. I tried go race detector, but nothing detected. Is that possible the address allocated by C is out the space of Golang?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1460639925, "post_id": 36591069, "comment_id": 60844593, "body": "No, it&#39;s not going to allocate in the wrong address space. Can you create a standalone test case to so we can reproduce the error? Just a hunch, but can you try refactoring to remove the <code>RgcService</code> struct, and use <code>*C.struct_CRgcMap</code> directly? (also, the mailing list will have more people who can help with this too)"}], "owner": {"reputation": 141, "user_id": 6029027, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ac9c83841db833d09ea9bfaf8d72d42?s=128&d=identicon&r=PG&f=1", "display_name": "Wyatt", "link": "https://stackoverflow.com/users/6029027/wyatt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 415, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1460531465, "creation_date": 1460531465, "question_id": 36591069, "link": "https://stackoverflow.com/questions/36591069/fatal-error-bad-pointer-in-write-barrier-in-cgo", "title": "fatal error: bad pointer in write barrier in Cgo", "body": "<p>My program crashed 1 time within 1000 times. Here is the debug information and stack:</p>\n\n<pre><code>437\nnew map 0   -603977536\naddress&amp;{[&lt;nil&gt; 0x7fafdc0009f0 0x7fafdc000b00]}  0x7fafdc0008c0 0x7fafdc0008c8 0x7fafdc0008d0\n     &amp;{1 0 0x7fafdc000900} &amp;{1 0 0x7fafdc000a10} &amp;{1 0 0x7fafdc000b20}\nrgc map finish\n438\nnew map 0   -603977536\naddress&amp;{[&lt;nil&gt; 0x7fafdc0009f0 0x7fafdc000b00]}  0x7fafdc0008c0 0x7fafdc0008c8 0x7fafdc0008d0\n     &amp;{1 0 0x7fafdc000900} &amp;{1 0 0x7fafdc000a10} &amp;{1 0 0x7fafdc000b20}\nrgc map finish\n439\nnew map 0   -603977536\naddress&amp;{[&lt;nil&gt; 0x7fafdc0009f0 0x7fafdc000b00]}  0x7fafdc0008c0 0x7fafdc0008c8 0x7fafdc0008d0\n\n     &amp;{1 0 0x7fafdc000900} &amp;{1 0 0x7fafdc000a10} &amp;{1 0 0x7fafdc000b20}\nrgc map finish\n440\nnew map 0   -603977536\naddress&amp;{[&lt;nil&gt; 0x7fafdc0009f0 0x7fafdc000b00]}  0x7fafdc0008c0 0x7fafdc0008c8 0x7fafdc0008d0\n\n     &amp;{1 0 0x7fafdc000900} &amp;{1 0 0x7fafdc000a10} &amp;{1 0 0x7fafdc000b20}\nrgc map finish\n441\nnew map 0   -536868672\n\nfatal error: bad pointer in write barrier\n\nruntime stack:\nruntime.throw(0x53d200, 0x1c)\n    /home/map/.jumbo/lib/go/src/runtime/panic.go:530 +0x90\nruntime.writebarrierptr_nostore.func1()\n    /home/map/.jumbo/lib/go/src/runtime/mbarrier.go:157 +0x2c\nruntime.systemstack(0xc820024a00)\n    /home/map/.jumbo/lib/go/src/runtime/asm_amd64.s:291 +0x79\nruntime.mstart()\n    /home/map/.jumbo/lib/go/src/runtime/proc.go:1048\n\ngoroutine 1 [running]:\nruntime.systemstack_switch()\n    /home/map/.jumbo/lib/go/src/runtime/asm_amd64.s:245 fp=0xc82009ebd8 sp=0xc82009ebd0\nruntime.writebarrierptr_nostore(0xc82030e010, 0x20)\n    /home/map/.jumbo/lib/go/src/runtime/mbarrier.go:157 +0x83 fp=0xc82009ebf0 sp=0xc82009ebd8\nruntime.heapBitsBulkBarrier(0xc82030e000, 0x18)\n    /home/map/.jumbo/lib/go/src/runtime/mbitmap.go:437 +0x201 fp=0xc82009ec88 sp=0xc82009ebf0\nruntime.typedmemmove(0x4fa700, 0xc82030e000, 0x7fafe00008c0)\n    /home/map/.jumbo/lib/go/src/runtime/mbarrier.go:197 +0x98 fp=0xc82009ecb8 sp=0xc82009ec88\nreflect.typedmemmove(0x4fa700, 0xc82030e000, 0x7fafe00008c0)\n    /home/map/.jumbo/lib/go/src/runtime/mbarrier.go:202 +0x35 fp=0xc82009ecd8 sp=0xc82009ecb8\nreflect.packEface(0x4fa700, 0x7fafe00008c0, 0x199, 0x0, 0x0)\n    /home/map/.jumbo/lib/go/src/reflect/value.go:113 +0x120 fp=0xc82009ed48 sp=0xc82009ecd8\nreflect.valueInterface(0x4fa700, 0x7fafe00008c0, 0x199, 0x1, 0x0, 0x0)\n    /home/map/.jumbo/lib/go/src/reflect/value.go:938 +0x1ec fp=0xc82009eda0 sp=0xc82009ed48\nreflect.Value.Interface(0x4fa700, 0x7fafe00008c0, 0x199, 0x0, 0x0)\n    /home/map/.jumbo/lib/go/src/reflect/value.go:908 +0x48 fp=0xc82009edd8 sp=0xc82009eda0\nfmt.(*pp).printValue(0xc82040b380, 0x4fa700, 0x7fafe00008c0, 0x199, 0x7faf00000076, 0x1, 0x0)\n    /home/map/.jumbo/lib/go/src/fmt/print.go:842 +0x372 fp=0xc82009eec8 sp=0xc82009edd8\nfmt.(*pp).printReflectValue(0xc82040b380, 0x4cc980, 0x7fafe00008c0, 0x16, 0x76, 0x0, 0xc82001cd00)\n    /home/map/.jumbo/lib/go/src/fmt/print.go:1009 +0x351e fp=0xc82009f680 sp=0xc82009eec8\nfmt.(*pp).printArg(0xc82040b380, 0x4cc980, 0x7fafe00008c0, 0x76, 0x0, 0xc82009f800)\n    /home/map/.jumbo/lib/go/src/fmt/print.go:810 +0x540 fp=0xc82009f808 sp=0xc82009f680\nfmt.(*pp).doPrint(0xc82040b380, 0xc82009fdf8, 0x2, 0x2, 0x400000)\n    /home/map/.jumbo/lib/go/src/fmt/print.go:1273 +0x24d fp=0xc82009f908 sp=0xc82009f808\nfmt.Fprint(0x7faff5a401c0, 0xc820036010, 0xc82009fdf8, 0x2, 0x2, 0x40d75e, 0x0, 0x0)\n    /home/map/.jumbo/lib/go/src/fmt/print.go:222 +0x67 fp=0xc82009f950 sp=0xc82009f908\nfmt.Print(0xc82009fdf8, 0x2, 0x2, 0x4d6ac0, 0x0, 0x0)\n    /home/map/.jumbo/lib/go/src/fmt/print.go:232 +0x73 fp=0xc82009f9a8 sp=0xc82009f950\nservices/newrgc.GetRgcService(0x54cb60, 0x49, 0xc8200aa330, 0x0, 0x0)\n    /home/map/zhanghuaizhi/tmpwork/2/nbserver/src/services/newrgc/mrgc.go:78 +0x390 fp=0xc82009fea0 sp=0xc82009f9a8\nmain.main()\n    /home/map/zhanghuaizhi/tmpwork/2/nbserver/src/services/newrgc/test/ttt.go:219 +0x163 fp=0xc82009ff40 sp=0xc82009fea0\nruntime.main()\n    /home/map/.jumbo/lib/go/src/runtime/proc.go:188 +0x2b0 fp=0xc82009ff90 sp=0xc82009ff40\nruntime.goexit()\n    /home/map/.jumbo/lib/go/src/runtime/asm_amd64.s:1998 +0x1 fp=0xc82009ff98 sp=0xc82009ff90\n\ngoroutine 17 [syscall, locked to thread]:\nruntime.goexit()\n    /home/map/.jumbo/lib/go/src/runtime/asm_amd64.s:1998 +0x1\n</code></pre>\n\n<p>The deug information is before the stack log. <code>437</code> means the 437th loop, <code>new map 0 -603977536</code> is printed in C Code(<code>NewRgcMap</code>, the details can be found in the following content), the next two lines \n<code>address&amp;{[&lt;nil&gt; 0x7fafdc0009f0 0x7fafdc000b00]}     0x7fafdc0008c0 0x7fafdc0008c8 0x7fafdc0008d0\n         &amp;{1 0 0x7fafdc000900} &amp;{1 0 0x7fafdc000a10} &amp;{1 0 0x7fafdc000b20}</code> is printed in Go Code(GO code line 78 and 80).</p>\n\n<p>From the stack information, we can find that the error occurs in line 78. Now here is the Go code(mrgc.go)</p>\n\n<pre><code>30 type RgcService struct {\n31     maps *C.struct_CRgcMap\n32 }    \n\n74 func GetRgcService(cfgFile string) (svc *RgcService, err error) {\n75     svc = new(RgcService)\n76     // Init the skip list\n77     C.NewRgcMap(&amp;svc.maps)\n78     fmt.Print(\"address\", svc.maps)\n79     //fmt.Println(\"\\t\", svc.maps.sl[0], svc.maps.sl[1], svc.maps.sl[2])\n80     fmt.Println(\"\\t\", &amp;svc.maps.sl[0], &amp;svc.maps.sl[1], &amp;svc.maps.sl[2])\n81     C.skiplist_init(unsafe.Pointer(&amp;svc.maps.sl[0]))\n82     C.skiplist_init(unsafe.Pointer(&amp;svc.maps.sl[1]))\n83     C.skiplist_init(unsafe.Pointer(&amp;svc.maps.sl[2]))\n84     fmt.Println(\"\\t\", svc.maps.sl[0], svc.maps.sl[1], svc.maps.sl[2])\n</code></pre>\n\n<p>So, I probably guess the error happens because of the failure of <code>C.NewRgcMap(&amp;svc.maps)</code>. However, in my c code, the funciotn <code>NewRgcMap</code> is:</p>\n\n<pre><code>39 void NewRgcMap(CRgcMap** rgcmap) {\n40     *rgcmap = NULL;\n41     printf(\"new map %d\\t\", *rgcmap);\n42     *rgcmap = (CRgcMap*)malloc(sizeof(CRgcMap));\n43     printf(\"%d\\n\", *rgcmap);\n44     while(*rgcmap == NULL) {\n45         *rgcmap = (CRgcMap*)malloc(sizeof(CRgcMap));\n46     }\n</code></pre>\n\n<p>which means the <code>rgcmap</code> must be allocated correctly.</p>\n\n<p>Another point is, from my debug information, I found that the program crashed when the log <code>new map 0 -603977536</code> is changed to <code>new map -536868672</code> at the first time. In more details, the debug log is exactly the same when the program crashed. <code>new map 0 xxxxx1</code> shows a number of time, then when it changed to <code>new map 0 xxxxx2</code>, it MAY crashes(most of the time, it will not)</p>\n\n<p>How to explain this crash? Moreover, I have used <code>valgrind</code> to test C code(Following is my C test codes)</p>\n\n<pre><code>int main() {\n    CRgcMap map;\n    int num = 0;\n    for(num = 0; num &lt; 10000; num++) {\n        skiplist_init(&amp;map.sl[0]);\n        skiplist_init(&amp;map.sl[1]);\n        skiplist_init(&amp;map.sl[2]);\n        int i = 0;\n        for(i = 0; i &lt; 100; i++) {\n            skiplist_insert(map.sl[0], i, i); \n            skiplist_insert(map.sl[1], i, i); \n            //skiplist_insert(map.sl[2], i, i);\n        }   \n\n        skiplist_test(map.sl[0]);\n        skiplist_test(map.sl[1]);\n        skiplist_test(map.sl[2]);\n    }\n}\n</code></pre>\n\n<p>The report of <code>valgrind</code> shows that there is no memory leaks and everything is okay. But why it MAY crashes when using Golang? Is there anything related Go's GC? Or the address allocated by C is out of the space of Golang?</p>\n"}, {"tags": ["go", "optional-parameters", "named-parameters"], "comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1460527673, "post_id": 36589813, "comment_id": 60777600, "body": "It might be easier to show you the <code>Go</code> way if you provided an example which demonstrates the issue you are having."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1460530005, "post_id": 36589813, "comment_id": 60778860, "body": "<a href=\"http://dave.cheney.net/2014/10/17/functional-options-for-friendly-apis\" rel=\"nofollow noreferrer\">dave.cheney.net/2014/10/17/functional-options-for-friendly-a&zwnj;&#8203;pis</a> Gives a great insight into that topic"}], "answers": [{"comments": [{"owner": {"reputation": 4657, "user_id": 102699, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/81df87e0d3e269d6fa6a17c6914fd656?s=128&d=identicon&r=PG", "display_name": "MikeSchinkel", "link": "https://stackoverflow.com/users/102699/mikeschinkel"}, "edited": false, "score": 0, "creation_date": 1553090519, "post_id": 36590296, "comment_id": 97256427, "body": "My argument is that having optional named parameters <b>reduces complexity</b>. They reduce the explosion of methods required to deal with multiple permutations, eliminate the need to come up with meaningful, discoverable and rememberable names for those methods, and simplify learning of the packages that use methods of that nature.  Also, your example does not address defaulting when <code>MyOptions</code> is not <code>nil</code> but <code>Field2</code> is empty. Which bring us back full circle to the issue the OP complained about."}, {"owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "reply_to_user": {"reputation": 4657, "user_id": 102699, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/81df87e0d3e269d6fa6a17c6914fd656?s=128&d=identicon&r=PG", "display_name": "MikeSchinkel", "link": "https://stackoverflow.com/users/102699/mikeschinkel"}, "edited": false, "score": 0, "creation_date": 1553091017, "post_id": 36590296, "comment_id": 97256827, "body": "@MikeSchinkel, I think you&#39;re misinterpreting me."}, {"owner": {"reputation": 4657, "user_id": 102699, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/81df87e0d3e269d6fa6a17c6914fd656?s=128&d=identicon&r=PG", "display_name": "MikeSchinkel", "link": "https://stackoverflow.com/users/102699/mikeschinkel"}, "edited": false, "score": 0, "creation_date": 1553091124, "post_id": 36590296, "comment_id": 97256912, "body": "Maybe you can elaborate?"}, {"owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "reply_to_user": {"reputation": 4657, "user_id": 102699, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/81df87e0d3e269d6fa6a17c6914fd656?s=128&d=identicon&r=PG", "display_name": "MikeSchinkel", "link": "https://stackoverflow.com/users/102699/mikeschinkel"}, "edited": false, "score": 1, "creation_date": 1553091587, "post_id": 36590296, "comment_id": 97257230, "body": "Sorry, hit enter too fast. My first comment is encouraging the OP (or anyone) to think about if that&#39;s the best solution. Optional args are a good way to reduce complexity, but we should think about if it&#39;s the right fit for this problem.   My second comment is that zero values are a language feature/idiom that we can use to reduce complexity, taking advantage of them seems like a good idea.   PS your comment helped me catch a mistake, thanks!"}, {"owner": {"reputation": 4657, "user_id": 102699, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/81df87e0d3e269d6fa6a17c6914fd656?s=128&d=identicon&r=PG", "display_name": "MikeSchinkel", "link": "https://stackoverflow.com/users/102699/mikeschinkel"}, "edited": false, "score": 0, "creation_date": 1553101341, "post_id": 36590296, "comment_id": 97264024, "body": "Thanks for clarifying.  As a former StackExchange moderator on another site I became steeped in the following philosophy of answering questions <i>&quot;<b>First answer the question</b>, and then \u2014 <b>and only then</b> \u2014 encourage the asker to think differently about the problem if you feel the need to do so.&quot;</i> . So answers that start with questioning that asker why they need what they are asking for have always been one of my bigger pet peeves. #fwiw"}, {"owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "reply_to_user": {"reputation": 4657, "user_id": 102699, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/81df87e0d3e269d6fa6a17c6914fd656?s=128&d=identicon&r=PG", "display_name": "MikeSchinkel", "link": "https://stackoverflow.com/users/102699/mikeschinkel"}, "edited": false, "score": 1, "creation_date": 1553106167, "post_id": 36590296, "comment_id": 97266593, "body": "@MikeSchinkel, I&#39;ll keep that in mind; answer updated to include your advice (plus some more comments)."}, {"owner": {"reputation": 4657, "user_id": 102699, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/81df87e0d3e269d6fa6a17c6914fd656?s=128&d=identicon&r=PG", "display_name": "MikeSchinkel", "link": "https://stackoverflow.com/users/102699/mikeschinkel"}, "edited": false, "score": 0, "creation_date": 1553125450, "post_id": 36590296, "comment_id": 97274682, "body": "Much better, thank you.  I reverse my downvote to an upvote."}], "tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": false, "score": 4, "last_activity_date": 1553105320, "last_edit_date": 1553105320, "creation_date": 1460528886, "answer_id": 36590296, "question_id": 36589813, "link": "https://stackoverflow.com/questions/36589813/how-to-provide-optional-parameters-in-go/36590296#36590296", "title": "How to provide optional parameters in Go?", "body": "<p>Is there any way that you can take advantage of zero values?  All data types get initialized to a zero value, so that is a form of default logic.</p>\n\n<p>An options object is a pretty common idiom. The <a href=\"https://github.com/etcd-io/etcd/blob/master/client/keys.go#L158\" rel=\"nofollow noreferrer\">etcd client library</a> has some examples (SetOptions,GetOptions,DeleteOptions) similar to the following.</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>type MyOptions struct {\n    Field1 int      // zero value (default) of int is 0\n    Field2 string   // zero value (default) of string is \"\"\n}\n\nfunc DoAction(arg1, arg2 string, options *MyOptions){\n    var defaultValue1 int = 30        // some reasonable default\n    var defaultValue2 string = \"west\" // some reasonable default\n\n    if options != nil {\n        defaultValue1 = options.Field1 // override with our values\n        defaultValue2 = options.Field2 \n    }\n    doStuffWithValues\n</code></pre>\n\n<p>An relevant question (and very much in the mindset of Go) would be, do you need this kind of complexity?  The flexibility is nice, but most things in the standard library try to only deal with 1 default piece of info/logic at a time to avoid this.</p>\n"}, {"tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": false, "score": 0, "last_activity_date": 1460530482, "creation_date": 1460530482, "answer_id": 36590751, "question_id": 36589813, "link": "https://stackoverflow.com/questions/36589813/how-to-provide-optional-parameters-in-go/36590751#36590751", "title": "How to provide optional parameters in Go?", "body": "<p>Whether this approach is useful depends on the scenario but in some case at least you could use a <code>map</code> for this. </p>\n\n<p>If all the options are of the same type use <code>map[string]type</code>. That gives you named options and as few or many as you want.</p>\n\n<p>Their existence is easy to test for with something like</p>\n\n<pre><code>if val, exists := opts[\"bar\"]; exists {\n    // Do something here\n}\n</code></pre>\n\n<p>To set the default values you can use a map literal when creating the map.</p>\n\n<p>If the options are not of the same type you can use <code>map[string]interface{}</code> which will allow any type to be stored in the map. You'll just need to typecast the values after retrieving.</p>\n"}], "owner": {"reputation": 111435, "user_id": 1333873, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/7ae9b432531de46073888f1a49c2391c?s=128&d=identicon&r=PG", "display_name": "Golo Roden", "link": "https://stackoverflow.com/users/1333873/golo-roden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3583, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1553105320, "creation_date": 1460527206, "question_id": 36589813, "link": "https://stackoverflow.com/questions/36589813/how-to-provide-optional-parameters-in-go", "title": "How to provide optional parameters in Go?", "body": "<p>I'm coming from a Node.js background, and there a typical pattern is to have a function which takes an options object, i.e. an object where you set properties for optional parameters, such as:</p>\n\n<pre><code>foo({\n  bar: 23,\n  baz: 42\n});\n</code></pre>\n\n<p>This is JavaScript's \"equivalent\" to optional and named parameters.</p>\n\n<p>Now I have learnt that there are no optional parameters in Go, except variadic parameters, but they lack the readability of named parameters. So the usual pattern seems to be to hand over a struct.</p>\n\n<p>OTOH a struct can not be defined with default values, so I need a function to set up the struct.</p>\n\n<p>So I end up with:</p>\n\n<ul>\n<li>Call a function that creates the struct and then fills it with default values.</li>\n<li>Overwrite the values I would like to change.</li>\n<li>Call the function I actually want to call and hand over the struct.</li>\n</ul>\n\n<p>That's quite complicated and lengthy compared to JavaScript's solution.</p>\n\n<p>Is this actually the idiomatic way of dealing with optional and named parameters in Go, or is there a simpler version?</p>\n"}, {"tags": ["unit-testing", "go"], "answers": [{"tags": [], "owner": {"reputation": 10563, "user_id": 1104328, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/df0790774838286ad0d93567ae1fcf56?s=128&d=identicon&r=PG&f=1", "display_name": "Harry", "link": "https://stackoverflow.com/users/1104328/harry"}, "is_accepted": false, "score": 0, "last_activity_date": 1460527606, "creation_date": 1460527606, "answer_id": 36589929, "question_id": 36589747, "link": "https://stackoverflow.com/questions/36589747/how-do-i-mark-a-test-as-inconclusive-in-go/36589929#36589929", "title": "How do I mark a test as inconclusive in Go?", "body": "<p>I'm pretty sure this is not what you want but I'd use skip for this</p>\n\n<pre><code>func TestTimeConsuming(t *testing.T) {\n    if testing.Short() {\n        t.Skip(\"skipping test in short mode.\")\n    }\n    ...\n}\n</code></pre>\n\n<p>This is likely controversial but I don't think tests should be inconclusive. They should Pass/Fail or Skip. </p>\n"}], "owner": {"reputation": 111435, "user_id": 1333873, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/7ae9b432531de46073888f1a49c2391c?s=128&d=identicon&r=PG", "display_name": "Golo Roden", "link": "https://stackoverflow.com/users/1333873/golo-roden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 113, "favorite_count": 0, "closed_date": 1460530760, "answer_count": 1, "score": 0, "last_activity_date": 1460527606, "creation_date": 1460526990, "question_id": 36589747, "link": "https://stackoverflow.com/questions/36589747/how-do-i-mark-a-test-as-inconclusive-in-go", "closed_reason": "Duplicate", "title": "How do I mark a test as inconclusive in Go?", "body": "<p>When writing tests in Go, how do I mark a test as inconclusive, i.e. as existent, but neither succeeding or failing, e.g. because it does not yet have an implementation?</p>\n\n<p>I'm coming from a Node.js background, and e.g. in Mocha (a test-runner for Node.js) you can define a test without an implementation, and then Mocha marks this test as <code>pending</code>.</p>\n\n<p>How can you do this with Go?</p>\n\n<p>(If it makes any difference, I am using <a href=\"https://labix.org/gocheck\" rel=\"nofollow\">gocheck</a> on top of <code>go test</code>.)</p>\n"}, {"tags": ["go", "cross-compiling"], "comments": [{"owner": {"reputation": 10379, "user_id": 69893, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jo6Ks.png?s=128&g=1", "display_name": "Christian Witts", "link": "https://stackoverflow.com/users/69893/christian-witts"}, "edited": false, "score": 2, "creation_date": 1460528909, "post_id": 36589393, "comment_id": 60778243, "body": "Did you specify the <code>GOARCH=arm</code> environment variable ? What is the output of <code>file &lt;binary name&gt;</code> ? <code>ELF 32-bit LSB executable, ARM, version 1 (SYSV), statically linked, not stripped</code> is the output I get from file for <code>export GOARCH=arm; GOARM=7; GOOS=linux go build ls.go</code>."}, {"owner": {"reputation": 1052, "user_id": 467969, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/653cd44d081b3e561847ab0bb1e08e71?s=128&d=identicon&r=PG&f=1", "display_name": "Buchi", "link": "https://stackoverflow.com/users/467969/buchi"}, "reply_to_user": {"reputation": 10379, "user_id": 69893, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jo6Ks.png?s=128&g=1", "display_name": "Christian Witts", "link": "https://stackoverflow.com/users/69893/christian-witts"}, "edited": false, "score": 0, "creation_date": 1460565828, "post_id": 36589393, "comment_id": 60806331, "body": "@ChristianWitts <code>ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, not stripped</code>. I figured that I will have to set <code>GOARCH=arm</code> after asking this question. Giving it a try now but seems like that might be the issue. Thanks for your help!"}], "owner": {"reputation": 1052, "user_id": 467969, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/653cd44d081b3e561847ab0bb1e08e71?s=128&d=identicon&r=PG&f=1", "display_name": "Buchi", "link": "https://stackoverflow.com/users/467969/buchi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1097, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1460525874, "creation_date": 1460525522, "last_edit_date": 1460525874, "question_id": 36589393, "link": "https://stackoverflow.com/questions/36589393/can-i-cross-compile-go-binary-for-armv7-on-os-x", "title": "Can I cross compile GO binary for ARMv7 on OS X?", "body": "<p>I have a GO program and I want to give its binary to a customer for running on RaspberryPi 3. I am cross compiling the GO program on OS X by setting <code>GOARM=7</code> and <code>GOOS=linux</code> in the environment as per the instructions at <a href=\"https://github.com/golang/go/wiki/GoArm\" rel=\"nofollow\">https://github.com/golang/go/wiki/GoArm</a>. However, the binary could not be run on RPi3. It fails with this error.</p>\n\n<pre><code>cannot execute binary file: Exec format error\n</code></pre>\n\n<p>I am pretty sure there might be issue in cross-compilation but it's clear what is the issue. Any help is appreciated.</p>\n"}, {"tags": ["go", "time", "struct"], "comments": [{"owner": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "edited": false, "score": 1, "creation_date": 1460525541, "post_id": 36589364, "comment_id": 60776629, "body": "use <code>*TimeTest</code> instead of <code>TimeTest</code> in function declaration"}, {"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 0, "creation_date": 1460577354, "post_id": 36589364, "comment_id": 60813437, "body": "Every instance passed as an argument to a function in Go is copied, unless it is passed as a reference. Therefore, you never really modify the original <code>TimeTest</code> instance."}], "answers": [{"comments": [{"owner": {"reputation": 18805, "user_id": 34771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c1a3f9227c0cb408f8831d27d611ab2?s=128&d=identicon&r=PG", "display_name": "Vatine", "link": "https://stackoverflow.com/users/34771/vatine"}, "edited": false, "score": 0, "creation_date": 1460565115, "post_id": 36589507, "comment_id": 60805901, "body": "No, a non-pointer called through a method with a pointer receiver has a pointer taken. See <a href=\"http://play.golang.org/p/sZiyU_up8v\" rel=\"nofollow noreferrer\">play.golang.org/p/sZiyU_up8v</a>"}, {"owner": {"reputation": 894, "user_id": 2406040, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4126afa62f9870ada0859381ca589d20?s=128&d=identicon&r=PG", "display_name": "Serdmanczyk", "link": "https://stackoverflow.com/users/2406040/serdmanczyk"}, "reply_to_user": {"reputation": 18805, "user_id": 34771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c1a3f9227c0cb408f8831d27d611ab2?s=128&d=identicon&r=PG", "display_name": "Vatine", "link": "https://stackoverflow.com/users/34771/vatine"}, "edited": false, "score": 0, "creation_date": 1460567393, "post_id": 36589507, "comment_id": 60807323, "body": "@Vatine corrected.  I mistook my receiver rules to interface rules (literals for a struct with a pointer receiver method don&#39;t implement an interface that define that function e.g. <a href=\"http://play.golang.org/p/5eXobphikp\" rel=\"nofollow noreferrer\">play.golang.org/p/5eXobphikp</a>)."}], "tags": [], "owner": {"reputation": 894, "user_id": 2406040, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4126afa62f9870ada0859381ca589d20?s=128&d=identicon&r=PG", "display_name": "Serdmanczyk", "link": "https://stackoverflow.com/users/2406040/serdmanczyk"}, "is_accepted": false, "score": 4, "last_activity_date": 1460567221, "last_edit_date": 1460567221, "creation_date": 1460526025, "answer_id": 36589507, "question_id": 36589364, "link": "https://stackoverflow.com/questions/36589364/golang-struct-member-storing-time-not-holding-value/36589507#36589507", "title": "Golang struct member storing time not holding value", "body": "<p>When you define a receiving function, you can define it on a value or a pointer.  If you define it on a value (as in your example), a <em>copy</em> of the struct is passed to the receiving func, so any updates are lost because that copy is destroyed after the function finishes.  If you define it on a pointer, then the struct itself is passed, so any updates affect the actual copy of the struct the function was called with.</p>\n\n<p>Revised version of your playground example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype TimeTest struct {\n    GoTime time.Time\n}\n\nfunc (t *TimeTest) Update() {\n    fmt.Println(t.GoTime.String())\n    t.GoTime = time.Now()\n    fmt.Println(t.GoTime.String())\n\n}\n\nfunc main() {\n    t := TimeTest{}\n\n    for i := 0; i &lt; 3; i++ {\n        t.Update()\n    }\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3543433"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1460567221, "creation_date": 1460525410, "question_id": 36589364, "link": "https://stackoverflow.com/questions/36589364/golang-struct-member-storing-time-not-holding-value", "title": "Golang struct member storing time not holding value", "body": "<p>I'm trying to store a time in a struct like such</p>\n\n<pre><code>type TimeTest struct {\n    GoTime time.Time\n}\n</code></pre>\n\n<p>I then have an update function that sets GoTime to the current time.</p>\n\n<pre><code>func (t TimeTest) Update() {\n    fmt.Println(t.GoTime.String())\n    t.GoTime = time.Now()\n    fmt.Println(t.GoTime.String())\n}\n</code></pre>\n\n<p>GoTime is always 0 at the start of the call to Update. It never holds it's value.</p>\n\n<p>Here is a <a href=\"https://play.golang.org/p/jx--aNCAEq\" rel=\"nofollow\">playground</a> example</p>\n"}, {"tags": ["facebook", "api", "rest", "go", "oauth-2.0"], "answers": [{"comments": [{"owner": {"reputation": 186, "user_id": 4021293, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/be50cb780c45f41f9fa40b6736d1ca44?s=128&d=identicon&r=PG&f=1", "display_name": "goda", "link": "https://stackoverflow.com/users/4021293/goda"}, "edited": false, "score": 0, "creation_date": 1460557908, "post_id": 36589778, "comment_id": 60800137, "body": "Thank you! I am setting my environment variables with trimspace so it looks like this.   os.Setenv(&quot;fbSecret&quot;, strings.TrimSpace(string(fbSecret)))                     Now it works fine."}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 2, "last_activity_date": 1460527077, "creation_date": 1460527077, "answer_id": 36589778, "question_id": 36589109, "link": "https://stackoverflow.com/questions/36589109/fb-exchange-token-api-throwing-error/36589778#36589778", "title": "FB exchange token api throwing error", "body": "<p>The error message says that your username for Basic Auth must be <code>1543358959292867</code>, yet the <code>client_id</code> you provide is actually <code>1543358959292867\\n</code> &lt;- newline tacked on the end (encoded as <code>%0A</code> in your query params).</p>\n\n<p>I don't think the issue is necessarily tied to being different machines, but the input that is being used from those different machines.</p>\n\n<p>A simple thing to do would be log the <code>client_id</code> so you can see what it is when it works and what it is when id doesn't.  When you log it you may want to wrap it with a known character so you can see newlines.  For example, </p>\n\n<pre><code>fmt.Printf(\"|%s|\", client_id)\n</code></pre>\n\n<p>If <code>client_id</code> contains a newlines then that will log something like</p>\n\n<pre><code>|1543358959292867\n|\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code>|1543358959292867|\n</code></pre>\n\n<p>You could also use <a href=\"https://golang.org/pkg/strings/#TrimSpace\" rel=\"nofollow\">strings.TrimSpace</a> to remove any prefix or suffix whitespace including newlines.</p>\n\n<pre><code>client_id = strings.TrimSpace(client_id)\n</code></pre>\n"}], "owner": {"reputation": 186, "user_id": 4021293, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/be50cb780c45f41f9fa40b6736d1ca44?s=128&d=identicon&r=PG&f=1", "display_name": "goda", "link": "https://stackoverflow.com/users/4021293/goda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "accepted_answer_id": 36589778, "answer_count": 1, "score": 0, "last_activity_date": 1460527077, "creation_date": 1460524288, "last_edit_date": 1460526530, "question_id": 36589109, "link": "https://stackoverflow.com/questions/36589109/fb-exchange-token-api-throwing-error", "title": "FB exchange token api throwing error", "body": "<p>I am testing a GET request on a development server to exchange a code for an access token.</p>\n\n<p>Oauth form URL:</p>\n\n<pre><code>https://www.facebook.com/dialog/oauth?\n    client_id=1543358959292867%0A&amp;\n    redirect_uri=http%3A%2F%2Flocalhost%3A8080%2FFBLoginCallback&amp;\n    response_type=code&amp;\n    scope=email+user_birthday+user_about_me\n</code></pre>\n\n<p>Callback w/code.</p>\n\n<pre><code>http://localhost:8080/FBLoginCallback?code=AQAsGssRxA9nDZ2YQ82Dgdw_NB_MsikZxVanO75QG0hKlH9F49v7CEiu5ssBHLmvF_hc4081Q5KcJq9cgC9pyIacz-ekpL6WKv5x0E12-HRzvR7bSImWJMktfTIfbabIDDy3BsOue2GhGos7qlIbU-XJGrzWMehbEhAb4p-2rpd4bVnIqKvaErU2Ma8onUMM8HICyf7IaArOlZs5VYqQDO0IjxsTot5DdU0j8IyBdmtksdspPK-YMhFcJTXabAxO2tWnvOQhAMCH00rlIByCY-xXMIgiLfrnF_YRrs9x5lU2d8ZF2DZrHgXLfnxH1Hh-bGQ#_=_\n</code></pre>\n\n<p>I get the following response.</p>\n\n<pre><code>oauth2: cannot fetch token: 400 Bad Request\nResponse: {\"error\":{\"message\":\"The username for your HTTP Basic Authorization must be 1543358959292867\",\"type\":\"OAuthException\",\"code\":101,\"fbtrace_id\":\"HTJcNHH6OmY\"}}\n</code></pre>\n\n<p>The issue is that this error occurs on one of my two laptops. They both run the exact same code.</p>\n\n<p>This is the golang function I am using for the exchange.</p>\n\n<pre><code>tok, err := fbConfig.Exchange(oauth2.NoContext, r.FormValue(\"code\"))\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "edited": false, "score": 0, "creation_date": 1460529396, "post_id": 36588294, "comment_id": 60778507, "body": "Is there a library that you are using here?"}, {"owner": {"reputation": 911, "user_id": 4728636, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/yQ2Rl.jpg?s=128&g=1", "display_name": "anonrose", "link": "https://stackoverflow.com/users/4728636/anonrose"}, "reply_to_user": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "edited": false, "score": 0, "creation_date": 1460564008, "post_id": 36588294, "comment_id": 60805064, "body": "@matt.s just `\t&quot;golang.org/x/net/html&quot;`, if you count that. Everything else is in the standard lib."}, {"owner": {"reputation": 8433, "user_id": 2667536, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/UfmAF.png?s=128&g=1", "display_name": "Derlin", "link": "https://stackoverflow.com/users/2667536/derlin"}, "edited": false, "score": 0, "creation_date": 1460624330, "post_id": 36588294, "comment_id": 60832873, "body": "could you give us a minimal working example ?"}], "answers": [{"tags": [], "owner": {"reputation": 134, "user_id": 1334914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W1g1u.jpg?s=128&g=1", "display_name": "Mikhail Andrianov", "link": "https://stackoverflow.com/users/1334914/mikhail-andrianov"}, "is_accepted": false, "score": 0, "last_activity_date": 1463120777, "creation_date": 1463120777, "answer_id": 37202645, "question_id": 36588294, "link": "https://stackoverflow.com/questions/36588294/get-visible-text-on-webpage-given-html-nodes/37202645#37202645", "title": "Get visible text on webpage given html nodes", "body": "<p>With <a href=\"https://github.com/PuerkitoBio/goquery\" rel=\"nofollow\">GOQuery</a> - this is really easy.</p>\n\n<pre><code>doc, err := goquery.NewDocument(\"http://yoursite.com\")\ndoc2.Find(\"h1\").Each(func(i int, s *goquery.Selection) {\nyour_text,_ := s.Text()\n}\n</code></pre>\n\n<p>Good luck! </p>\n"}], "owner": {"reputation": 911, "user_id": 4728636, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/yQ2Rl.jpg?s=128&g=1", "display_name": "anonrose", "link": "https://stackoverflow.com/users/4728636/anonrose"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 114, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1463120777, "creation_date": 1460519824, "last_edit_date": 1460624239, "question_id": 36588294, "link": "https://stackoverflow.com/questions/36588294/get-visible-text-on-webpage-given-html-nodes", "title": "Get visible text on webpage given html nodes", "body": "<p>I have some webpages and I would like to get only the text that is visible to a user. Currently I'm checking for text by doing the following:</p>\n\n<pre><code>n *html.Node\n\nif n.Type == html.TextNode{\n    print\n}\n</code></pre>\n\n<p>The problem is I'm getting CSS code thrown in with my text, is there a way to only get the text? i.e.</p>\n\n<pre><code>&lt;h1&gt; I want to get this text and all others like it &lt;/h1&gt;\n</code></pre>\n"}, {"tags": ["go", "utf-8", "ascii"], "comments": [{"owner": {"reputation": 26680, "user_id": 1806780, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/NCB41.jpg?s=128&g=1", "display_name": "Sami Kuhmonen", "link": "https://stackoverflow.com/users/1806780/sami-kuhmonen"}, "edited": false, "score": 5, "creation_date": 1460518102, "post_id": 36587918, "comment_id": 60774367, "body": "ASCII 0-127 in UTF-8 is 0-127. There is no conversion required."}, {"owner": {"reputation": 137100, "user_id": 874188, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ZcY77.png?s=128&g=1", "display_name": "tripleee", "link": "https://stackoverflow.com/users/874188/tripleee"}, "edited": false, "score": 0, "creation_date": 1460522698, "post_id": 36587918, "comment_id": 60775581, "body": "You can find detailed information for each character e.g. at <a href=\"http://www.fileformat.info/info/unicode/char/07/index.htm\" rel=\"nofollow noreferrer\">fileformat.info/info/unicode/char/07/index.htm</a> (that&#39;s the link for U+0007; adapt for other codes)."}, {"owner": {"reputation": 31, "user_id": 4647979, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-bzRsVL8RBVA/AAAAAAAAAAI/AAAAAAAAAA4/0lWz8nj_QdQ/photo.jpg?sz=128", "display_name": "Alandroid", "link": "https://stackoverflow.com/users/4647979/alandroid"}, "edited": false, "score": 0, "creation_date": 1460529345, "post_id": 36587918, "comment_id": 60778487, "body": "I am trying to figure out how to turn the ASCII code into an actual character.. for example turn 97 into &quot;a&quot;"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1460546124, "post_id": 36587918, "comment_id": 60790038, "body": "I dearly recommend you to get accustomed with what &quot;character code&quot; and &quot;encoding&quot; really stand for, and where the &quot;UTF-8&quot; encoding is placed on that picture. There are two go-to piceces of documentation on these matters: start with <a href=\"https://www.cs.tut.fi/~jkorpela/chars.html\" rel=\"nofollow noreferrer\">this one</a> then continue with <a href=\"https://www.cl.cam.ac.uk/~mgk25/unicode.html\" rel=\"nofollow noreferrer\">this</a>. As to the problem at hand, @matt.s gave the correct answer: the UTF-8 encoding was created with an explicit goal of being compatible with US-ASCII, so you can read your character codes &quot;as is&quot;."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1460546668, "post_id": 36587918, "comment_id": 60790424, "body": "As to &quot;...turning to characters&quot; -- it&#39;s just a matter of interpretation. If you have <code>var a byte = 97</code> and then use <code>fmt.Printf(&quot;%v&quot;, a)</code> the <code>fmt</code> will see your <code>a</code> variable has the type <code>byte</code> and will <i>assume</i> you want the <i>number</i> 97 printed. But if you will make sure to either stuff this code into a string value or directly ask <code>fmt.Printf</code> to <i>interpret</i> your byte values as a character, you will get character printed -- <a href=\"http://play.golang.org/p/BFFL4GCSFN\" rel=\"nofollow noreferrer\">see for yourself</a>. Again, I recommend to absorb the docs I pointed you at."}, {"owner": {"reputation": 517, "user_id": 293427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/428942eac7fea24d525accc0c229b0ee?s=128&d=identicon&r=PG", "display_name": "plod", "link": "https://stackoverflow.com/users/293427/plod"}, "edited": false, "score": 0, "creation_date": 1460708598, "post_id": 36587918, "comment_id": 60877799, "body": "Understanding utf8 as per Sami&#39;s assertion above. The video: <a href=\"https://www.youtube.com/watch?v=MijmeoH9LT4\" rel=\"nofollow noreferrer\">youtube.com/watch?v=MijmeoH9LT4</a> is really worth a watch"}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 4647979, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-bzRsVL8RBVA/AAAAAAAAAAI/AAAAAAAAAA4/0lWz8nj_QdQ/photo.jpg?sz=128", "display_name": "Alandroid", "link": "https://stackoverflow.com/users/4647979/alandroid"}, "edited": false, "score": 0, "creation_date": 1460558430, "post_id": 36590552, "comment_id": 60800614, "body": "Thank you very much matt.s &lt;3!"}], "tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": false, "score": 1, "last_activity_date": 1460529856, "creation_date": 1460529856, "answer_id": 36590552, "question_id": 36587918, "link": "https://stackoverflow.com/questions/36587918/given-an-ascii-character-code-how-do-i-encode-it-as-utf-8/36590552#36590552", "title": "Given an ASCII character code, how do I encode it as UTF-8?", "body": "<p>The numeric values are the bytes.  You can directly convert those to strings.</p>\n\n<pre><code>b := []byte{97,98,99,68} // The ascii codes of abcD\nfmt.Println(string(b))\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 4647979, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-bzRsVL8RBVA/AAAAAAAAAAI/AAAAAAAAAA4/0lWz8nj_QdQ/photo.jpg?sz=128", "display_name": "Alandroid", "link": "https://stackoverflow.com/users/4647979/alandroid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 176, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1460545775, "creation_date": 1460517436, "last_edit_date": 1460545775, "question_id": 36587918, "link": "https://stackoverflow.com/questions/36587918/given-an-ascii-character-code-how-do-i-encode-it-as-utf-8", "title": "Given an ASCII character code, how do I encode it as UTF-8?", "body": "<p>I need to convert my generated ASCII character codes in Go.</p>\n\n<p>My generated codes are as follows:</p>\n\n<ul>\n<li>0 (1-9 are missing, probably useless)</li>\n<li>10 (11-31 are missing, probably even more useless)</li>\n<li>32</li>\n<li>33</li>\n<li>34</li>\n<li>...</li>\n<li>124</li>\n<li>125</li>\n<li>126</li>\n</ul>\n\n<p>How do I convert them to the corresponding UTF-8-encoded characters?</p>\n"}, {"tags": ["go", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "is_accepted": true, "score": 5, "last_activity_date": 1460523509, "creation_date": 1460523509, "answer_id": 36588947, "question_id": 36587727, "link": "https://stackoverflow.com/questions/36587727/golang-template-what-is-in-the-context/36588947#36588947", "title": "Golang template: what is in the context?", "body": "<pre><code>{{ printf \"%#v\" . }}\n</code></pre>\n\n<p>Should print out the variable name and value.</p>\n"}], "owner": {"reputation": 3495, "user_id": 1497443, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/883657c432abe8485fe0b6be073a33e0?s=128&d=identicon&r=PG", "display_name": "Seperman", "link": "https://stackoverflow.com/users/1497443/seperman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1003, "favorite_count": 2, "accepted_answer_id": 36588947, "answer_count": 1, "score": 3, "last_activity_date": 1460523509, "creation_date": 1460516124, "question_id": 36587727, "link": "https://stackoverflow.com/questions/36587727/golang-template-what-is-in-the-context", "title": "Golang template: what is in the context?", "body": "<p>I want to see what is in the context that is passed into the template.\nWhat I do is basically putting the dot right there in the HTML.:</p>\n\n<p><code>{{$.}}</code></p>\n\n<p>What I get back when the HTML is rendered is:</p>\n\n<p><code>\n{http://localhost:1315/blog/index.xml 0xc08fdf36g0 map[Pages:[]] Blog [] map[] 2016-04-07 15:34:03 -0700 PDT 2016-04-07 15:34:03 -0700 PDT { 0} {/blog/ http://localhost:1315/blog/ } false 0xc0825878d0 {{0 0} 1} &lt;nil&gt;}\n</code></p>\n\n<p>I know for example there is <code>.Site</code> inside <code>.</code> but it doesn't even show up in the rendered HTML. How can I get the context in a more understandable form so I can see what it is without previously knowing all the attributes it is supposed to have?</p>\n"}, {"tags": ["go", "gorilla"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1460503177, "post_id": 36585781, "comment_id": 60770398, "body": "If you&#39;re not using templates, just read the file and write it to the responsewriter in the handler, if you&#39;re using templates, just put the static html file there and it will get served as is since it will have no placeholders/code in it to be replaced."}], "answers": [{"comments": [{"owner": {"reputation": 1039, "user_id": 5252955, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh6.googleusercontent.com/-a_QM0l16-xk/AAAAAAAAAAI/AAAAAAAAARc/RFsNPxQgnfs/photo.jpg?sz=128", "display_name": "Nick Rucci", "link": "https://stackoverflow.com/users/5252955/nick-rucci"}, "edited": false, "score": 0, "creation_date": 1460526504, "post_id": 36588223, "comment_id": 60777071, "body": "Yeah, I thought this would do the trick. When I do this I do not get a <code>404 not found</code> but I also do not get the expected file saying <code>&quot;Hello World&quot;</code>"}, {"owner": {"reputation": 255, "user_id": 3446582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wLrPg.jpg?s=128&g=1", "display_name": "Niemi", "link": "https://stackoverflow.com/users/3446582/niemi"}, "reply_to_user": {"reputation": 1039, "user_id": 5252955, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh6.googleusercontent.com/-a_QM0l16-xk/AAAAAAAAAAI/AAAAAAAAARc/RFsNPxQgnfs/photo.jpg?sz=128", "display_name": "Nick Rucci", "link": "https://stackoverflow.com/users/5252955/nick-rucci"}, "edited": false, "score": 0, "creation_date": 1460549410, "post_id": 36588223, "comment_id": 60792598, "body": "My bad. I have updated the answer and this time I cloned your repo and tested that it works :)"}, {"owner": {"reputation": 1039, "user_id": 5252955, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh6.googleusercontent.com/-a_QM0l16-xk/AAAAAAAAAAI/AAAAAAAAARc/RFsNPxQgnfs/photo.jpg?sz=128", "display_name": "Nick Rucci", "link": "https://stackoverflow.com/users/5252955/nick-rucci"}, "edited": false, "score": 0, "creation_date": 1460565367, "post_id": 36588223, "comment_id": 60806070, "body": "This makes it possible to do exactly what you stated but it takes away the possibility to return JSON when <code>&#47;api&#47;posts</code> is hit."}, {"owner": {"reputation": 255, "user_id": 3446582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wLrPg.jpg?s=128&g=1", "display_name": "Niemi", "link": "https://stackoverflow.com/users/3446582/niemi"}, "reply_to_user": {"reputation": 1039, "user_id": 5252955, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh6.googleusercontent.com/-a_QM0l16-xk/AAAAAAAAAAI/AAAAAAAAARc/RFsNPxQgnfs/photo.jpg?sz=128", "display_name": "Nick Rucci", "link": "https://stackoverflow.com/users/5252955/nick-rucci"}, "edited": false, "score": 0, "creation_date": 1460569408, "post_id": 36588223, "comment_id": 60808540, "body": "darn. I have updated the solution again. Haven&#39;t tested your handlers that requires db connections but hopefully this should work better. :)"}, {"owner": {"reputation": 1039, "user_id": 5252955, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh6.googleusercontent.com/-a_QM0l16-xk/AAAAAAAAAAI/AAAAAAAAARc/RFsNPxQgnfs/photo.jpg?sz=128", "display_name": "Nick Rucci", "link": "https://stackoverflow.com/users/5252955/nick-rucci"}, "edited": false, "score": 0, "creation_date": 1460569981, "post_id": 36588223, "comment_id": 60808889, "body": "You were actually on the correct path. The order of where the path is mattered. It had to be below my api routes."}], "tags": [], "owner": {"reputation": 255, "user_id": 3446582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wLrPg.jpg?s=128&g=1", "display_name": "Niemi", "link": "https://stackoverflow.com/users/3446582/niemi"}, "is_accepted": true, "score": 1, "last_activity_date": 1460575573, "last_edit_date": 1460575573, "creation_date": 1460519286, "answer_id": 36588223, "question_id": 36585781, "link": "https://stackoverflow.com/questions/36585781/go-serve-static-pages-their-endpoints-along-side-my-api-endpoints/36588223#36588223", "title": "Go: Serve static pages (their endpoints) along side my API endpoints", "body": "<p><strong>Updated</strong>\n code to fix error. Binding file server only to root path, leaving other routes free to be used by other handlers.</p>\n\n<p>Remove the <strong>Index</strong> route in <strong>routes.go</strong> and update <strong>router.go</strong> like this:</p>\n\n<pre><code>func NewRouter() *mux.Router {\n    // create new router\n    router := mux.NewRouter()\n\n    for _, route := range routes {\n        var handler http.Handler\n\n        handler = route.HandlerFunc\n        handler = Logger(handler, route.Name)\n\n        router.\n            Methods(route.Method).\n            Path(route.Pattern).\n            Name(route.Name).\n            Handler(route.HandlerFunc)\n    }\n\n    router.Path(\"/\").Handler(http.FileServer(http.Dir(\"public/\")))\n\n    return router\n\n}\n</code></pre>\n\n<p>This exposes the index.html file in the public directory under the root of your domain.</p>\n"}, {"tags": [], "owner": {"reputation": 1039, "user_id": 5252955, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh6.googleusercontent.com/-a_QM0l16-xk/AAAAAAAAAAI/AAAAAAAAARc/RFsNPxQgnfs/photo.jpg?sz=128", "display_name": "Nick Rucci", "link": "https://stackoverflow.com/users/5252955/nick-rucci"}, "is_accepted": false, "score": 0, "last_activity_date": 1460528004, "creation_date": 1460528004, "answer_id": 36590044, "question_id": 36585781, "link": "https://stackoverflow.com/questions/36585781/go-serve-static-pages-their-endpoints-along-side-my-api-endpoints/36590044#36590044", "title": "Go: Serve static pages (their endpoints) along side my API endpoints", "body": "<p>What I ended up doing was making a template function and rendering my HTML from there.</p>\n\n<pre><code>func Index(w http.ResponseWriter, r *http.Request) {\n    t := template.New(\"Test\")\n    t, err = t.Parse(\"&lt;html&gt;&lt;body&gt;Hello World&lt;/body&gt;&lt;/html&gt;)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    err = t.Execute(w, t)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1039, "user_id": 5252955, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh6.googleusercontent.com/-a_QM0l16-xk/AAAAAAAAAAI/AAAAAAAAARc/RFsNPxQgnfs/photo.jpg?sz=128", "display_name": "Nick Rucci", "link": "https://stackoverflow.com/users/5252955/nick-rucci"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 753, "favorite_count": 0, "accepted_answer_id": 36588223, "answer_count": 2, "score": 0, "last_activity_date": 1460575573, "creation_date": 1460503028, "last_edit_date": 1460527037, "question_id": 36585781, "link": "https://stackoverflow.com/questions/36585781/go-serve-static-pages-their-endpoints-along-side-my-api-endpoints", "title": "Go: Serve static pages (their endpoints) along side my API endpoints", "body": "<p>So I am having an issue where I can only have my API endpoints working or my static files working. I am using gorilla/mux as my router and I it might have something to do with configuring that.</p>\n\n<p>I have four files that I believe matter in this situation: </p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>func main() {\n    envVars()\n\n    router := NewRouter()\n\n    log.Fatal(http.ListenAndServe(\":8080\", router))\n\n}\n</code></pre>\n\n<p><strong>router.go</strong></p>\n\n<pre><code>func NewRouter() *mux.Router {\n    // create new router\n    router := mux.NewRouter()\n\n    for _, route := range routes {\n        var handler http.Handler\n\n        handler = route.HandlerFunc\n        handler = Logger(handler, route.Name)\n\n        router.\n            Methods(route.Method).\n            Path(route.Pattern).\n            Name(route.Name).\n            Handler(route.HandlerFunc)\n    }\n\n    return router\n\n}\n</code></pre>\n\n<p><strong>routes.go</strong></p>\n\n<pre><code>var routes = Routes{\n\n    Route{\n       // TODO: Find way to render static file\n       \"Index\",\n        \"GET\",\n        \"/\",\n        Index,\n    },\n    Route{\n        \"PostIndex\",\n        \"GET\",\n        \"/api/posts\",\n        PostIndex,\n    },\n    Route{\n        \"PostCreate\",\n        \"POST\",\n        \"/api/posts\",\n        PostCreate,\n    },\n}\n</code></pre>\n\n<p><strong>handlers.go</strong></p>\n\n<pre><code>func Index(w http.ResponseWriter, r *http.Request) {\n    // TODO: Something to render html file\n}\n</code></pre>\n\n<p>From researching I was thinking that I could maybe use a subrouter but it seems like there should be a better way about doing this. For all of my other routes I have implemented methods but for rendering an html file, I am not sure what would be put in that method.</p>\n\n<p>To view the whole project, visit: <a href=\"https://github.com/nicholasrucci/blog\" rel=\"nofollow\">https://github.com/nicholasrucci/blog</a></p>\n\n<h2>Update</h2>\n\n<p>I have found <a href=\"https://groups.google.com/forum/#!topic/gorilla-web/fBAYdk9mPVM\" rel=\"nofollow\">this source</a>. It is similar to what I am going through.</p>\n"}, {"tags": ["go", "time"], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1460553331, "post_id": 36585198, "comment_id": 60796114, "body": "<code>nsec</code> in the <code>time.Unix</code> function is nanoseconds. You can specify the timestamp in seconds, nanoseconds, or a combination of the two."}, {"owner": {"reputation": 105, "user_id": 6194584, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/de7c301366f103d09099914d6abf0828?s=128&d=identicon&r=PG&f=1", "display_name": "N. George", "link": "https://stackoverflow.com/users/6194584/n-george"}, "edited": false, "score": 0, "creation_date": 1460566286, "post_id": 36585198, "comment_id": 60806612, "body": "Thanks for the clarification! These functions are in a sense inverses of each other. seconds &lt;--&gt;Time object converters."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 4, "last_activity_date": 1460500662, "last_edit_date": 1460500662, "creation_date": 1460500041, "answer_id": 36585198, "question_id": 36585143, "link": "https://stackoverflow.com/questions/36585143/golang-time-now-unix-discrepancy-between-documentation-and-implementation/36585198#36585198", "title": "golang time.Now().Unix() discrepancy between documentation and implementation?", "body": "<p>The docs are correct, you're looking at the wrong version of <code>Unix</code>. The method you're using is this; <a href=\"https://golang.org/pkg/time/#Time.Unix\" rel=\"nofollow\">https://golang.org/pkg/time/#Time.Unix</a> it takes no arguments, is called on a time object and returns the unix time as an <code>int64</code>. The version you're referencing takes two arguments, both int64's, the seconds and nanoseconds? (not positive that's what the nseconds stands for) which represent a time in unix format and it returns a <code>time.Time</code></p>\n\n<p>So to extend your second example;</p>\n\n<pre><code>func main() {\n    var now time.Time\n    now = time.Now()\n    fmt.Println(now)\n\n    // var secs time.Time\n    secs := now.Unix()\n    fmt.Println(secs)\n    t := time.Unix(secs, 0) // get a time from the seconds value which is a unix time\n    fmt.Println(t)\n}\n</code></pre>\n\n<p>Here's the above in play with one other line added to print the type of <code>secs</code>. <a href=\"https://play.golang.org/p/KksPPbQ1Jy\" rel=\"nofollow\">https://play.golang.org/p/KksPPbQ1Jy</a></p>\n"}], "owner": {"reputation": 105, "user_id": 6194584, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/de7c301366f103d09099914d6abf0828?s=128&d=identicon&r=PG&f=1", "display_name": "N. George", "link": "https://stackoverflow.com/users/6194584/n-george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2401, "favorite_count": 0, "accepted_answer_id": 36585198, "answer_count": 1, "score": 1, "last_activity_date": 1460503480, "creation_date": 1460499799, "last_edit_date": 1460503480, "question_id": 36585143, "link": "https://stackoverflow.com/questions/36585143/golang-time-now-unix-discrepancy-between-documentation-and-implementation", "title": "golang time.Now().Unix() discrepancy between documentation and implementation?", "body": "<p><a href=\"https://golang.org/pkg/time/#Unix\" rel=\"nofollow\">https://golang.org/pkg/time/#Unix</a></p>\n\n<p>states that the signature of this function is </p>\n\n<pre><code>func Unix(sec int64, nsec int64) Time\n</code></pre>\n\n<p>meaning, it returns a <code>Time</code> object.</p>\n\n<p>But the following program aborts with the error message:</p>\n\n<blockquote>\n  <p>14: cannot use now.Unix() (type int64) as type time.Time in assignment`</p>\n</blockquote>\n\n<pre><code>func main() {\n    var now time.Time\n    now = time.Now()\n    fmt.Println(now)\n\n    var secs time.Time\n    secs = now.Unix()\n    fmt.Println(secs)\n}\n</code></pre>\n\n<p>The following version of the program produces output</p>\n\n<pre><code>func main() {\n    var now time.Time\n    now = time.Now()\n    fmt.Println(now)\n\n    // var secs time.Time\n    secs := now.Unix()\n    fmt.Println(secs)\n}\n</code></pre>\n\n<p><code>2016-04-12 18:20:22.566965512 -0400 EDT</code></p>\n\n<p><code>1460499622</code></p>\n\n<p>Is this just a matter of error in documentation?</p>\n"}, {"tags": ["logging", "go", "scope", "package"], "comments": [{"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1460502170, "post_id": 36584564, "comment_id": 60770064, "body": "I think it&#39;s generally undesirable to have a library vendor it&#39;s own deps, specifically for reasons of version incompatibility and duplication.   The app (main package) should vendor everyone&#39;s deps and deal with conflicts if any."}], "answers": [{"tags": [], "owner": {"reputation": 1855, "user_id": 1558705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1563795271fe55bf0beab2d12cd69b0?s=128&d=identicon&r=PG", "display_name": "Dean Elbaz", "link": "https://stackoverflow.com/users/1558705/dean-elbaz"}, "is_accepted": false, "score": 1, "last_activity_date": 1460547015, "creation_date": 1460547015, "answer_id": 36597032, "question_id": 36584564, "link": "https://stackoverflow.com/questions/36584564/centralised-logging-configuration-when-sharing-libraries-between-packages/36597032#36597032", "title": "Centralised logging configuration when sharing libraries between packages", "body": "<p>You can only mirror <code>WithFields</code> since the other ones accept built in types. Also since <code>logging.Fields</code> and <code>logrus.Fields</code> are the same type you could more simply do</p>\n\n<pre><code>func WithFields(f Fields) log.*Entry {\n    return Log.WithFields(log.Fields(f))\n}\n</code></pre>\n\n<p>Then in your service, you could call</p>\n\n<pre><code>logging.Log.Debug(\"message\")\nlogging.WithFields(logging.Fields{\"k\":\"v\"}).Debug(\"message\")\n</code></pre>\n"}], "owner": {"reputation": 4255, "user_id": 744180, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/4Hp9o.jpg?s=128&g=1", "display_name": "Smudge", "link": "https://stackoverflow.com/users/744180/smudge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1045, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1460547015, "creation_date": 1460497137, "question_id": 36584564, "link": "https://stackoverflow.com/questions/36584564/centralised-logging-configuration-when-sharing-libraries-between-packages", "title": "Centralised logging configuration when sharing libraries between packages", "body": "<p>So I'm using a structured logging library (<a href=\"https://github.com/Sirupsen/\" rel=\"nofollow\">logrus</a>), and I have a <code>core</code> package used as a base for some other packages, lets call this package <code>me/core</code>, then individual packages like <code>me/foo-service</code>, <code>me/bar-service</code> etc. that use this core library for common dependencies/utilities such as setup, configuration loading, and I also wanted to use it for standardized things like logging, so I want <code>me/core</code> to be able to configure logging for the other packages, with Logrus you can do things like</p>\n\n<pre><code>import(\n  log \"github.com/Sirupsen/logrus\"\n)\n[...]\nlog.SetLevel(log.DebugLevel)\nlog.SetFormatter(&amp;log.TextFormatter{FullTimestamp:true})\n</code></pre>\n\n<p>Then do;</p>\n\n<pre><code>log.Debug(\"Moo\")\nlog.WithFields(log.Fields{\"structured\":\"data\"}).Debug(\"I have structure data\")\n</code></pre>\n\n<p>getting an output like</p>\n\n<pre><code>&gt; DEBU[2016-04-12T22:11:38+01:00] Moo\n&gt; DEBU[2016-04-12T22:11:38+01:00] I have structure data           structured=data\n</code></pre>\n\n<p>So I want to configure this in my <code>me/foo-service</code> package with something like</p>\n\n<pre><code>import(\n  \"me/core/logging\"\n)\n\nfunc main(){\n  logging.Setup()\n}\n</code></pre>\n\n<p>Only for various reasons I'm running into issues. The primary issue seems to be that both <code>me/core</code>, and <code>me/foo-service</code> have a vendored version of the <code>logrus</code> library, those <code>log.Set*</code> commands modify the variable <code>logrus.std</code> logger which holds the standard, global logger, but this is a seperate instance for both packages because <code>me/core/vendor/.../logrus/std</code> and <code>me/foo-service/vendor/.../logrus/std</code> are different objects.</p>\n\n<p>First thing I tried was creating a variable in <code>me/core/logging</code> that I could use in the parent, so something like</p>\n\n<pre><code>package logging\n\nimport(\n  log \"github.com/Sirupsen/logrus\"\n)\n\nvar Log *log.Logger\n\nfunc Setup(verbose bool){\n  Log = log.New()\n  if verbose{\n    Log.Level = log.DebugLevel\n  } else {\n    Log.Level = log.InfoLevel\n  }\n  Log.Formatter = &amp;log.TextFormatter{FullTimestamp:true}\n  Log.Debug(\"Logging verbosely\")\n}\n</code></pre>\n\n<p>and that works for simple cases like this</p>\n\n<pre><code>package main\n\nimport(\n  \"me/core/logging\"\n)\n\nfunc main() {\n  logging.Setup(parsedOptions.Verbose)\n  logging.Log.Debug(\"Moo\")\n}\n</code></pre>\n\n<p>However trying to use the structured data <code>Fields</code> causes problems, I can't use the local vendored <code>logrus</code> fields like</p>\n\n<pre><code>logging.Log.WithFields(log.Fields{\"data\":\"hi\"}).Debug(\"test\")\n</code></pre>\n\n<p>as I get</p>\n\n<pre><code>cannot use \"me/foo-service/vendor/github.com/Sirupsen/logrus\".Fields literal (type \"me/foo-service/vendor/github.com/Sirupsen/logrus\".Fields) as type \"me/core/vendor/github.com/Sirupsen/logrus\".Fields in argument to logging.Log.WithFields\n</code></pre>\n\n<p>And trying to mirror the field in <code>me/core/logging</code> with something like</p>\n\n<pre><code>type Fields log.Fields\n</code></pre>\n\n<p>Doesn't work ether because it's still a different type</p>\n\n<pre><code>cannot use logging.Fields literal (type logging.Fields) as type \"me/core/vendor/github.com/Sirupsen/logrus\".Fields in argument to logging.Log.WithFields\n</code></pre>\n\n<p>I also can't think of any way to pass my local <code>log.std</code> from <code>me/foo-service</code> to <code>me/core</code> as it's also a different type due to the vendored package.</p>\n\n<p>My work around for the moment involves creating a mirror of every method, so in <code>me/core/logging</code> I have a set up like</p>\n\n<pre><code>package logging\n\nimport(\n  log \"github.com/Sirupsen/logrus\"\n)\n\nvar Log *log.Logger\ntype Fields map[string]interface{}\n\nfunc Setup(verbose bool){\n  Log = log.New()\n  if verbose{\n    Log.Level = log.DebugLevel\n  } else {\n    Log.Level = log.InfoLevel\n  }\n  Log.Formatter = &amp;log.TextFormatter{FullTimestamp:true}\n  Log.Debug(\"Logging verbosely\")\n}\n\nfunc Debug(msg interface{}){\n  Log.Debug(msg)\n}\n\nfunc WithFields(fields Fields) *log.Entry{\n  lf := log.Fields{}\n  for k,v := range fields{\n    lf[k] = v\n  }\n  return Log.WithFields(lf)\n}\n</code></pre>\n\n<p>But that would involve creating a mirror for <em>every</em> method which seems really inefficient.</p>\n\n<p>So I'd like a suggestion for how I can make <code>me/core/vendor/.../logrus/std</code> avaliable to <code>me/foo-service</code>, or if I'm thinking about this in completely the wrong way a better way to do it.</p>\n"}, {"tags": ["go", "bit-manipulation", "bit-shift"], "answers": [{"comments": [{"owner": {"reputation": 47141, "user_id": 1643939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mww2p.png?s=128&g=1", "display_name": "nemo", "link": "https://stackoverflow.com/users/1643939/nemo"}, "edited": false, "score": 2, "creation_date": 1460494794, "post_id": 36583665, "comment_id": 60766782, "body": "The mask is also always the highest allowed value specified by the field width, e.g. 2 bit wide field =&gt; mask is 3."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 8, "last_activity_date": 1460495811, "last_edit_date": 1460495811, "creation_date": 1460493738, "answer_id": 36583665, "question_id": 36583504, "link": "https://stackoverflow.com/questions/36583504/how-to-unpack-2-2-and-3-bits-out-of-a-byte/36583665#36583665", "title": "How to unpack 2, 2 and 3 bits out of a byte", "body": "<p>You need to mask off the unused bits like you've already done for <code>c</code>. I also added masks to the pack function, to prevent accidental overlapping of values:</p>\n\n<pre><code>const (\n    threeBits = 0x7\n    twoBits   = 0x3\n)\n\nfunc pack(a, b, c byte) byte {\n    return a&lt;&lt;6 | b&amp;twoBits&lt;&lt;4 | c&amp;threeBits\n}\n\nfunc main() {\n    v := pack(1, 2, 6)\n    a := v &gt;&gt; 6\n    b := v &gt;&gt; 4 &amp; twoBits\n    c := v &amp; threeBits\n    fmt.Println(v, a, b, c)\n}\n</code></pre>\n"}], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 36583665, "answer_count": 1, "score": 4, "last_activity_date": 1460495811, "creation_date": 1460493121, "question_id": 36583504, "link": "https://stackoverflow.com/questions/36583504/how-to-unpack-2-2-and-3-bits-out-of-a-byte", "title": "How to unpack 2, 2 and 3 bits out of a byte", "body": "<p>Assuming I have 3 bytes (2x2bits and 1x3bits) packed like this:</p>\n\n<pre><code>func pack(a, b, c byte) byte { // is there a more efficient way to pack them?\n    return a&lt;&lt;6 | b&lt;&lt;4 | c\n}\n\nfunc main() {\n    v := pack(1, 2, 6)\n    a := v &gt;&gt; 6\n    b := v &gt;&gt; 4 // wrong\n    c := v &amp; 7\n    fmt.Println(v, a, b, c)\n}\n</code></pre>\n\n<p>How do I unpack <code>b</code>?</p>\n"}, {"tags": ["javascript", "go", "time", "iso"], "answers": [{"comments": [{"owner": {"reputation": 8641, "user_id": 732539, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d33cc4a619410535e0176138c6971ba3?s=128&d=identicon&r=PG", "display_name": "K2xL", "link": "https://stackoverflow.com/users/732539/k2xl"}, "edited": false, "score": 0, "creation_date": 1460494749, "post_id": 36582947, "comment_id": 60766749, "body": "works great. strange that go doesn&#39;t have something like <code>RFC3339Milli</code> or something defined.. they go from seconds to nanoseconds"}, {"owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "reply_to_user": {"reputation": 8641, "user_id": 732539, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d33cc4a619410535e0176138c6971ba3?s=128&d=identicon&r=PG", "display_name": "K2xL", "link": "https://stackoverflow.com/users/732539/k2xl"}, "edited": false, "score": 2, "creation_date": 1460494856, "post_id": 36582947, "comment_id": 60766827, "body": "You&#39;re right, but the language designers tend to look for a minimum set (even if it sometimes excludes useful stuff).  At least it is pretty easy to make on your own."}], "tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": true, "score": 11, "last_activity_date": 1460493813, "last_edit_date": 1460493813, "creation_date": 1460491188, "answer_id": 36582947, "question_id": 36582789, "link": "https://stackoverflow.com/questions/36582789/javascript-toisostring-time-in-golang/36582947#36582947", "title": "Javascript toISOString time in Golang", "body": "<p>From looking in pkg/time where the <a href=\"https://golang.org/pkg/time/#pkg-constants\" rel=\"noreferrer\">constants are defined</a></p>\n\n<pre><code>RFC3339     = \"2006-01-02T15:04:05Z07:00\"\nRFC3339Nano = \"2006-01-02T15:04:05.999999999Z07:00\"\n</code></pre>\n\n<p>From the documentation: </p>\n\n<blockquote>\n  <p>The reference time used in the layouts is the specific time:\n  Mon Jan 2 15:04:05 MST 2006</p>\n  \n  <p>To define your own format, write down what the reference time would look like formatted your way;</p>\n</blockquote>\n\n<p>It should be something like so:</p>\n\n<pre><code>JavascriptISOString := \"2006-01-02T15:04:05.999Z07:00\"\ntime.Now().UTC().Format(JavascriptISOString)\n</code></pre>\n"}], "owner": {"reputation": 8641, "user_id": 732539, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d33cc4a619410535e0176138c6971ba3?s=128&d=identicon&r=PG", "display_name": "K2xL", "link": "https://stackoverflow.com/users/732539/k2xl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3056, "favorite_count": 2, "accepted_answer_id": 36582947, "answer_count": 1, "score": 6, "last_activity_date": 1472476539, "creation_date": 1460490604, "last_edit_date": 1472476539, "question_id": 36582789, "link": "https://stackoverflow.com/questions/36582789/javascript-toisostring-time-in-golang", "title": "Javascript toISOString time in Golang", "body": "<p>I'm trying to generate ISO 8601 timestamp in Golang.</p>\n\n<p>Doing </p>\n\n<pre><code>time.Now().UTC().Format(time.RFC3339)\n//2016-04-12T19:32:20Z\n</code></pre>\n\n<p>in Javascript</p>\n\n<pre><code>new Date().toISOString()\n//2016-04-12T19:46:47.286Z\n</code></pre>\n\n<p>It appears the only difference is in JavaScript the time reports milliseconds, while Golang it produces it in seconds. I'd like to try and get these to be the same.</p>\n\n<p>I've looked at <code>time.RFC3339Nano</code></p>\n\n<p>But that produces too much precision <code>2016-04-12T19:35:16.341032697Z</code></p>\n\n<p>How can I get Golang to produce time that is equivalent to JavaScript's <code>toISOString()</code>?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 4, "creation_date": 1460487039, "post_id": 36581469, "comment_id": 60762281, "body": "Everytime you use <code>this</code>, a kitten dies.  Follow <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow noreferrer\">Effective Go</a> guidelines, and give it a proper name.  For example:  <code>func (o obj2) printTest() ...</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1460488103, "post_id": 36581469, "comment_id": 60762865, "body": "I don&#39;t understand what you&#39;re asking or how it relates at all to the &quot;go/types&quot; package (which you&#39;re not using) . What do you expect to happen here?"}, {"owner": {"reputation": 1378, "user_id": 3501751, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/cJ4g9.jpg?s=128&g=1", "display_name": "Charlie", "link": "https://stackoverflow.com/users/3501751/charlie"}, "edited": false, "score": 1, "creation_date": 1460834217, "post_id": 36581469, "comment_id": 60928986, "body": "I fixed the this. Please stop hurting animals."}], "answers": [{"comments": [{"owner": {"reputation": 1378, "user_id": 3501751, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/cJ4g9.jpg?s=128&g=1", "display_name": "Charlie", "link": "https://stackoverflow.com/users/3501751/charlie"}, "edited": false, "score": 0, "creation_date": 1460831472, "post_id": 36583148, "comment_id": 60928027, "body": "Your answer help me understand that I&#39;m not creating an alias, but I still don&#39;t know why you would ever &quot;embed the type in a field&quot; like you said. Like you said wouldn&#39;t that be mixing &quot;inheritance&quot; and composition is a very confusing way in a single type?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 1378, "user_id": 3501751, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/cJ4g9.jpg?s=128&g=1", "display_name": "Charlie", "link": "https://stackoverflow.com/users/3501751/charlie"}, "edited": false, "score": 0, "creation_date": 1461007262, "post_id": 36583148, "comment_id": 60992867, "body": "@Charlie it may seem a bit confusing coming from a language where those two concepts are different but it&#39;s pretty intuitive once you start using it. If you want an inheritance hierarchy like you&#39;d make using parent and child classes in typical OO languages you instead embed the base type in others to achieve the same functionality. There are some subtleties to the way it works but it&#39;s probably easiest to begin looking at it as being equivalent to inheritance."}, {"owner": {"reputation": 1378, "user_id": 3501751, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/cJ4g9.jpg?s=128&g=1", "display_name": "Charlie", "link": "https://stackoverflow.com/users/3501751/charlie"}, "edited": false, "score": 0, "creation_date": 1461014630, "post_id": 36583148, "comment_id": 60997037, "body": "Your answer didn&#39;t answer my question but I appreciate you helping my say it more clearly. Please read my refined question here <a href=\"http://stackoverflow.com/questions/36704522/why-would-you-want-to-use-composition-in-golang\" title=\"why would you want to use composition in golang\">stackoverflow.com/questions/36704522/&hellip;</a>"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 1, "last_activity_date": 1460492362, "last_edit_date": 1460492362, "creation_date": 1460491898, "answer_id": 36583148, "question_id": 36581469, "link": "https://stackoverflow.com/questions/36581469/what-is-the-purpose-of-emedding-a-struct-in-a-field-golang/36583148#36583148", "title": "What is the purpose of emedding a struct in a field (golang)?", "body": "<p>You're not aliasing anything and selectors refer to the set of things that can be referenced on a type using dot notation. You're using a concept called embedding, <code>obj1</code> embeds <code>obj2</code>. <code>obj1Selector</code> has a single field called <code>selector</code> of type <code>obj2</code>. And alias would look like this; <code>type obj3 obj2</code> which declares <code>obj3</code> as an alias for <code>obj2</code>.</p>\n\n<p>It breaks Go's promotion mechanism? Sorry but your whole idea of how this works is off basis. <code>obj1Selector</code> does not embed the type <code>obj2</code> and therefor has no field/methods from <code>obj2</code> 'promoted', <code>obj1</code> embeds <code>obj2</code> and therefor has it's fields/methods 'promoted'. <code>obj1Selector</code> does not implement that interface, <code>obj1Selector.selector</code> does.</p>\n\n<p>Why would I want to embed? Well it's somewhat equivalent to inheritance or at least provides a similar feature set when developing in Go. Perhaps I have a number of records in a data store that all share 10 common fields and then have another 10 fields that depend on which table they came off of. Just as I'd use inheritance to reduce duplication in typical OO languages like C++, C# or Java I would use embedding in Go. In my opinion that is the main use case for it. It's sort of a weird mix of composition and inheritance. You're composing on object of others (the ones you're embedding) but since the embedded types methods/fields are promoted to the embedors scope it functions a lot like if the embedor inherited from the embedded type. Hope that gives some clarification as to what you're dealing with here... You haven't really posed a question that can be answered but there isn't space in the comments for such a lengthy explanation of the features/concepts you're using your sample code.</p>\n"}], "owner": {"reputation": 1378, "user_id": 3501751, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/cJ4g9.jpg?s=128&g=1", "display_name": "Charlie", "link": "https://stackoverflow.com/users/3501751/charlie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "closed_date": 1460527858, "accepted_answer_id": 36583148, "answer_count": 1, "score": -1, "last_activity_date": 1460831502, "creation_date": 1460486408, "last_edit_date": 1460831502, "question_id": 36581469, "link": "https://stackoverflow.com/questions/36581469/what-is-the-purpose-of-emedding-a-struct-in-a-field-golang", "closed_reason": "Needs details or clarity", "title": "What is the purpose of emedding a struct in a field (golang)?", "body": "<p>Based on the below sample it seems that the point of \"embedding an struct in a field\" is to break Go's \"promotion\" mechanism. Why would you want to do this? </p>\n\n<pre><code>type obj1 struct {\n    obj2\n}\n\ntype obj1Selector struct {\n    selector obj2\n}\n\ntype obj2 struct {\n}\n\nfunc (o obj2) printTest() {\n    fmt.Println(\"obj2\")\n}\n\nfunc main() {\n    o := obj1{}\n    o.printTest() //fine\n\n    oSelector := obj1Selector{}\n    oSelector.selector.printTest() //fine\n    oSelector.printTest() //not fine\n</code></pre>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 2679, "user_id": 6153562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee9c9f355300df5464bc13e3563a1deb?s=128&d=identicon&r=PG&f=1", "display_name": "C Panda", "link": "https://stackoverflow.com/users/6153562/c-panda"}, "edited": false, "score": 0, "creation_date": 1460486491, "post_id": 36581093, "comment_id": 60761991, "body": "You might probably wanna use <code>\\{(.*?)\\}</code>."}, {"owner": {"reputation": 1010, "user_id": 3326103, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06afeeee747f8c3245b1dc74f634db88?s=128&d=identicon&r=PG&f=1", "display_name": "linuxfan", "link": "https://stackoverflow.com/users/3326103/linuxfan"}, "reply_to_user": {"reputation": 2679, "user_id": 6153562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee9c9f355300df5464bc13e3563a1deb?s=128&d=identicon&r=PG&f=1", "display_name": "C Panda", "link": "https://stackoverflow.com/users/6153562/c-panda"}, "edited": false, "score": 0, "creation_date": 1460487216, "post_id": 36581093, "comment_id": 60762373, "body": "@CPanda Your tip doesn&#39;t work. The error with my regex is that it doesn&#39;t match newlines. The solution given by tonisuter works."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 1, "creation_date": 1460487486, "post_id": 36581093, "comment_id": 60762523, "body": "You can also use <code>re := regexp.MustCompile(`{[\\s\\S]*?}`)</code>"}, {"owner": {"reputation": 2679, "user_id": 6153562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee9c9f355300df5464bc13e3563a1deb?s=128&d=identicon&r=PG&f=1", "display_name": "C Panda", "link": "https://stackoverflow.com/users/6153562/c-panda"}, "edited": false, "score": 0, "creation_date": 1460488021, "post_id": 36581093, "comment_id": 60762840, "body": "@linuxfan I am a python guy. I could have told you use the <code>re.DOTALL</code> flag. But this won&#39;t make sense for Go. Sorry if I trespassed."}], "answers": [{"comments": [{"owner": {"reputation": 1010, "user_id": 3326103, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06afeeee747f8c3245b1dc74f634db88?s=128&d=identicon&r=PG&f=1", "display_name": "linuxfan", "link": "https://stackoverflow.com/users/3326103/linuxfan"}, "edited": false, "score": 1, "creation_date": 1460486504, "post_id": 36581456, "comment_id": 60761999, "body": "Right on @tonisuter. Thanks"}], "tags": [], "owner": {"reputation": 684, "user_id": 624631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91ba8cd2ae7edc7b61422d104ce3375c?s=128&d=identicon&r=PG", "display_name": "tonisuter", "link": "https://stackoverflow.com/users/624631/tonisuter"}, "is_accepted": true, "score": 1, "last_activity_date": 1460486354, "creation_date": 1460486354, "answer_id": 36581456, "question_id": 36581093, "link": "https://stackoverflow.com/questions/36581093/capture-all-data-between-two-braces/36581456#36581456", "title": "Capture all data between two braces", "body": "<p>Here's a solution:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    x := `\nlease {\n    interface \"eth0\";\n    fixed-address 10.11.0.1;\n    option subnet-mask 255.255.0.0;\n}\nlease {\n    interface \"eth0\";\n    fixed-address 10.11.0.2;\n    option subnet-mask 255.255.0.0;\n}\nlease {\n    interface \"eth0\";\n    fixed-address 10.11.0.2;\n    option subnet-mask 255.255.0.0;\n}`\n\n    re := regexp.MustCompile(`(?s){.*?}`)\n    fmt.Println(re.FindAllString(x, -1))\n}\n</code></pre>\n\n<p>I changed two things. The <code>(?s)</code> flag means that it will match newlines as for <code>.</code> wildcards as well. And the <code>.*?</code> means that it will rather match fewer than more characters between the braces. If you would use <code>.*</code>, it would match the outer pair of braces instead.</p>\n\n<p>Here's the link to the documentation of the regex syntax used for Go regular expressions: <a href=\"https://github.com/google/re2/wiki/Syntax\" rel=\"nofollow\">https://github.com/google/re2/wiki/Syntax</a></p>\n"}], "owner": {"reputation": 1010, "user_id": 3326103, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06afeeee747f8c3245b1dc74f634db88?s=128&d=identicon&r=PG&f=1", "display_name": "linuxfan", "link": "https://stackoverflow.com/users/3326103/linuxfan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 36581456, "answer_count": 1, "score": 0, "last_activity_date": 1460487451, "creation_date": 1460485023, "last_edit_date": 1460487451, "question_id": 36581093, "link": "https://stackoverflow.com/questions/36581093/capture-all-data-between-two-braces", "title": "Capture all data between two braces", "body": "<p>Trying to read all data enclosed within two curly braces. I suspect my regex fails because it cannot match newlines. Link to source in go playground: <a href=\"http://play.golang.org/p/uNjd01CL8Z\" rel=\"nofollow\">http://play.golang.org/p/uNjd01CL8Z</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    x := `\nlease {\n  interface \"eth0\";\n  fixed-address 10.11.0.1;\n  option subnet-mask 255.255.0.0;\n}\nlease {\n  interface \"eth0\";\n  fixed-address 10.11.0.2;\n  option subnet-mask 255.255.0.0;\n}\nlease {\n  interface \"eth0\";\n  fixed-address 10.11.0.2;\n  option subnet-mask 255.255.0.0;\n}`\n\n    re := regexp.MustCompile(`{(.+)?}`)\n    fmt.Println(re.FindAllString(x, -1))\n\n}\n</code></pre>\n"}, {"tags": ["go", "aggregate"], "answers": [{"tags": [], "owner": {"reputation": 1762, "user_id": 5120331, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YhTAB.png?s=128&g=1", "display_name": "Corvus Crypto", "link": "https://stackoverflow.com/users/5120331/corvus-crypto"}, "is_accepted": false, "score": 2, "last_activity_date": 1460494069, "creation_date": 1460494069, "answer_id": 36583755, "question_id": 36581072, "link": "https://stackoverflow.com/questions/36581072/missing-type-in-composite-literal-in-golang-mongodb-aggregate-query/36583755#36583755", "title": "missing type in composite literal in golang/mongodb aggregate query", "body": "<p>You have a missing type declaration on a set of braces in your $group query:\n<code>{\"rollno\":bson.M{\"$atndnc.rollno\"},\"attend\":bson.M{\"$atndnc.attend\"}}\n</code></p>\n\n<p>I would assume should be:\n<code>bson.M{\"rollno\":bson.M{\"$atndnc.rollno\"},\"attend\":bson.M{\"$atndnc.attend\":nil}}\n</code></p>\n\n<p>there are also a few other initialization things like initializations with just a string key (remember, a bson.M is just an alias for map[string]interface{}</p>\n"}, {"tags": [], "owner": {"reputation": 79, "user_id": 6180676, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-emttGcROwWU/AAAAAAAAAAI/AAAAAAAANa8/Ulmsa8KZ_oc/photo.jpg?sz=128", "display_name": "Hossain Ahamed", "link": "https://stackoverflow.com/users/6180676/hossain-ahamed"}, "is_accepted": false, "score": 0, "last_activity_date": 1460664608, "creation_date": 1460664608, "answer_id": 36633014, "question_id": 36581072, "link": "https://stackoverflow.com/questions/36581072/missing-type-in-composite-literal-in-golang-mongodb-aggregate-query/36633014#36633014", "title": "missing type in composite literal in golang/mongodb aggregate query", "body": "<p>Thanks for your support.I got the desired output by doing this.</p>\n\n<pre><code>cond :=[]bson.M{\n    bson.M{\"$match\": bson.M{\n            \"stream\" : srchobj.Stream,\n            \"semester\" : srchobj.Semester,\n            \"section\" : srchobj.Section,\n            \"college_id\":srchobj.College_id,\n            \"date\":bson.M{\n                \"$gt\":srchobj.Startdate,\n                \"$lt\":srchobj.Enddate},\n     },\n    },\n    bson.M{\"$unwind\":  \"$atndnc\"},\n    bson.M{\"$group\":bson.M{\n        \"_id\":bson.M{\n            \"rollno\":\"$atndnc.rollno\",\n            \"attend\":\"$atndnc.attend\",\n            \"name\":\"$atndnc.name\",\n            },\n        \"count\":bson.M{\"$sum\":1},\n        },\n    },\n    bson.M{\"$project\":bson.M{\n        \"rollno\":\"$_id.rollno\",\n        \"name\":\"$_id.name\",\n        \"count\":\"$count\",\n        \"attend\":\"$_id.attend\",\n        },\n    },\n    bson.M{\"$sort\":bson.M{\"rollno\":1}},\n}\n</code></pre>\n"}], "owner": {"reputation": 79, "user_id": 6180676, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-emttGcROwWU/AAAAAAAAAAI/AAAAAAAANa8/Ulmsa8KZ_oc/photo.jpg?sz=128", "display_name": "Hossain Ahamed", "link": "https://stackoverflow.com/users/6180676/hossain-ahamed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1865, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1460664608, "creation_date": 1460484956, "question_id": 36581072, "link": "https://stackoverflow.com/questions/36581072/missing-type-in-composite-literal-in-golang-mongodb-aggregate-query", "title": "missing type in composite literal in golang/mongodb aggregate query", "body": "<p>I want to write mongo query in golang. my mongo query is - </p>\n\n<pre><code>aggregate([\n    {$match: {$and :\n        [\n            {\"stream\" : \"CS\"},\n            {\"semester\" : \"sem3\"},\n            {\"section\" : \"A\"}\n        ]\n\n    }},\n    {$unwind:  '$atndnc'},\n    { $group: { _id:{rollno: \"$atndnc.rollno\",attend:\"$atndnc.attend\"},count: { $sum: 1 }}},\n    {  $project:\n    {  _id: '$_id.rollno',\n        'attend' : '$_id.attend',\n        'count' : '$count'\n    }}\n])\n</code></pre>\n\n<p>And my Go code is -</p>\n\n<pre><code>cond:=[]bson.M{\n    bson.M{\"$match\": bson.M{\"$and \":[]interface{}{\n        bson.M{\"stream\" : srchobj.Stream},\n        bson.M{\"semester\" : srchobj.Semester},\n        bson.M{\"section\" : srchobj.Section},\n        bson.M{\"college_id\":srchobj.College_id},\n        bson.M{\"date\":bson.M{\"$gt\":srchobj.Startdate,\"$lt\":srchobj.Enddate}}}}},\n    bson.M{\"$unwind\":  \"$atndnc\"},\n    bson.M{\"$group\":bson.M{\"_id\":{\"rollno\":bson.M{\"$atndnc.rollno\"},\"attend\":bson.M{\"$atndnc.attend\"}},\"count\":bson.M{\"$sum\":1}}},\n    bson.M{\"$project\":bson.M{\"_id\":\"$_id.rollno\",\"count\":\"$_id.count\"}}}\n</code></pre>\n\n<p>but it give the error \"missing type in composite literal\" in </p>\n\n<pre><code>    bson.M{\"$group\":bson.M{\"_id\":{\"rollno\":bson.M{\"$atndnc.rollno\"},\"attend\":bson.M{\"$atndnc.attend\"}},\"count\":bson.M{\"$sum\":1}}},\n</code></pre>\n\n<p>in this line.what should i do now?</p>\n"}, {"tags": ["testing", "go", "testify"], "answers": [{"comments": [{"owner": {"reputation": 3554, "user_id": 3233810, "user_type": "registered", "accept_rate": 70, "profile_image": "https://graph.facebook.com/1135890448/picture?type=large", "display_name": "daino3", "link": "https://stackoverflow.com/users/3233810/daino3"}, "edited": false, "score": 0, "creation_date": 1460485326, "post_id": 36581099, "comment_id": 60761260, "body": "Thanks Matt. But we do want to test the actual format of the XML because it&#39;s being consumed by a 3rd party that specs the xml format (we have to jump through some hoops). Any ideas how to incorporate that?"}, {"owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "reply_to_user": {"reputation": 3554, "user_id": 3233810, "user_type": "registered", "accept_rate": 70, "profile_image": "https://graph.facebook.com/1135890448/picture?type=large", "display_name": "daino3", "link": "https://stackoverflow.com/users/3233810/daino3"}, "edited": false, "score": 0, "creation_date": 1460485929, "post_id": 36581099, "comment_id": 60761649, "body": "Unless there are some weird whitespace requirements,  I would do the above and then do a xml prettyprint/canonicalization on the xml output.  Most xml consuming apps don&#39;t care about whitespace (since the xml libary level logic usually handles that).  If you need more control encoding/xml has Encoder.Indent to control whitespace that is output."}], "tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": true, "score": 1, "last_activity_date": 1460485056, "creation_date": 1460485056, "answer_id": 36581099, "question_id": 36580403, "link": "https://stackoverflow.com/questions/36580403/custom-testify-output-for-failing-test-of-xml-strings/36581099#36581099", "title": "Custom testify output for failing test of xml / strings", "body": "<p>Unless the formatting matters a whole bunch, a quick thorough way to test something like xml.Marshal is to marshal to and from and compare the objects</p>\n\n<pre><code>func (suite *BookSuite) TestXMLMarshal() {\n\n    priceXML, priceErr := xml.Marshal(PriceType{Price: 10, Type: \"IND\"})\n\n    suite.Nil(priceErr)\n\n    var secondPrice PriceType\n    unerr :=  xml.Unmarshal(priceXML, &amp;secondPrice)\n    suite.Nil(unerr)\n\n    if !reflect.DeepEqual(&amp;priceXML,&amp;secondPrice){\n        err := fmt.Errorf(\"Expected: '%+v'\\nGot: %+v\\n\",priceXML,secondPrice)\n        suite.Error(err, err.Error())\n        fmt.Println(err)\n    }\n}\n</code></pre>\n\n<p>not tested but should be something like that.</p>\n"}], "owner": {"reputation": 3554, "user_id": 3233810, "user_type": "registered", "accept_rate": 70, "profile_image": "https://graph.facebook.com/1135890448/picture?type=large", "display_name": "daino3", "link": "https://stackoverflow.com/users/3233810/daino3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "accepted_answer_id": 36581099, "answer_count": 1, "score": 0, "last_activity_date": 1460485056, "creation_date": 1460482814, "question_id": 36580403, "link": "https://stackoverflow.com/questions/36580403/custom-testify-output-for-failing-test-of-xml-strings", "title": "Custom testify output for failing test of xml / strings", "body": "<p>I'm testing XML marshaling with testify and using <code>strings.Contains</code> to check if lines I expect to be included in the XML are in fact there. </p>\n\n<p>However, I want to diff the actual vs. desired xml. </p>\n\n<p>Currently, my code looks something like:</p>\n\n<pre><code>func (suite *BookSuite) TestXMLMarshal() {\n    priceXML, priceErr := xml.Marshal(PriceType{Price: 10, Type: \"IND\"})\n\n    suite.Nil(priceErr)\n    linePresent := strings.Contains(string(priceXML), `&lt;PriceType Price=\"10\" Type=\"IND\"&gt;&lt;/PriceType&gt;`)\n\n    if true != linePresent {\n        err := errors.New(\"Expected: \\n\" + `&lt;PriceType Price=\"10\" Type=\"IND\"&gt;&lt;/PriceType&gt;` + \"\\nGot: \\n\" + bookString)\n        suite.Error(err, err.Error())\n        fmt.Println(err)\n    }\n}\n</code></pre>\n\n<p>There are more lines in the xml file than the single one in the test, so as you can imagine that if statement is going to be gross. Any ideas on cleaning this up that's more scalable?</p>\n"}, {"tags": ["go", "time"], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 5420567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f237a437ac30cc5b4095767040da79ff?s=128&d=identicon&r=PG", "display_name": "dodiku", "link": "https://stackoverflow.com/users/5420567/dodiku"}, "edited": false, "score": 0, "creation_date": 1460500855, "post_id": 36580099, "comment_id": 60769546, "body": "Thanks a lot! Super useful!"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1460495474, "last_edit_date": 1460495474, "creation_date": 1460481818, "answer_id": 36580099, "question_id": 36580014, "link": "https://stackoverflow.com/questions/36580014/how-do-i-get-the-time-one-day-ago-relative-to-the-current/36580099#36580099", "title": "How do I get the time one day ago relative to the current?", "body": "<p>Use the <a href=\"https://golang.org/pkg/time/#Duration\" rel=\"nofollow\">Duration constants</a> provided in the time package, like <code>time.Hour</code></p>\n\n<pre><code>diff := 24 * time.Hour\nthen := time.Now().Add(-diff)\n</code></pre>\n\n<p>Or if you want the same time on the previous day (which may not be 24 hours earlier, <a href=\"http://play.golang.org/p/B32RbtUuuS\" rel=\"nofollow\">http://play.golang.org/p/B32RbtUuuS</a>)</p>\n\n<pre><code>then := time.Now().AddDate(0, 0, -1)\n</code></pre>\n"}], "owner": {"reputation": 91, "user_id": 5420567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f237a437ac30cc5b4095767040da79ff?s=128&d=identicon&r=PG", "display_name": "dodiku", "link": "https://stackoverflow.com/users/5420567/dodiku"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 599, "favorite_count": 0, "accepted_answer_id": 36580099, "answer_count": 1, "score": 1, "last_activity_date": 1460495474, "creation_date": 1460481553, "last_edit_date": 1460490293, "question_id": 36580014, "link": "https://stackoverflow.com/questions/36580014/how-do-i-get-the-time-one-day-ago-relative-to-the-current", "title": "How do I get the time one day ago relative to the current?", "body": "<p>I need to query my db for events occurred within a single hour.\nTherefore, I want to get events between <strong>now</strong> and <strong>then</strong> (which is now - 24 hours, or now - 1 full day).</p>\n\n<p>I tried this approach, but it is incorrect - </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n\n    now := time.Now()\n\n    // print the time now\n    fmt.Println(now)\n\n    then := time.Now()\n    diff := 24\n    diff = diff.Hours()\n    then = then.Add(-diff)\n\n    // print the time before 24 hours\n    fmt.Println(then)\n\n    // print the delta between 'now' and 'then'\n    fmt.Println(now.Sub(then))\n}\n</code></pre>\n\n<p>How can I make <strong>then</strong> == 1 full day / 24 hours before <strong>now</strong> ?</p>\n\n<p>Thanks a lot for your help!!</p>\n"}, {"tags": ["go", "rabbitmq"], "answers": [{"tags": [], "owner": {"reputation": 4124, "user_id": 2629095, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/680dfd61e8b392153c85cf93498b8100?s=128&d=identicon&r=PG", "display_name": "nevets", "link": "https://stackoverflow.com/users/2629095/nevets"}, "is_accepted": true, "score": 8, "last_activity_date": 1460516970, "creation_date": 1460516970, "answer_id": 36587859, "question_id": 36579759, "link": "https://stackoverflow.com/questions/36579759/golang-rabbitmq-channel-connection-is-not-open/36587859#36587859", "title": "Golang - RabbitMq : channel/connection is not open", "body": "<p>Inside your <code>init</code>, you wrote <code>defer config.conn.Close()</code>, which will be executed when the function return. That is to say, whenever <code>init</code> finished, your connection will be closed, which causes unopen connection.</p>\n\n<p>You need to defer the connection closing in main, or somewhere you want it to be closed.</p>\n"}], "owner": {"reputation": 3293, "user_id": 5120292, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2d26cfd2bc52de7902b76cb433685f96?s=128&d=identicon&r=PG&f=1", "display_name": "Xys", "link": "https://stackoverflow.com/users/5120292/xys"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7104, "favorite_count": 2, "accepted_answer_id": 36587859, "answer_count": 1, "score": 7, "last_activity_date": 1460516970, "creation_date": 1460480744, "question_id": 36579759, "link": "https://stackoverflow.com/questions/36579759/golang-rabbitmq-channel-connection-is-not-open", "title": "Golang - RabbitMq : channel/connection is not open", "body": "<p>I'm new to golang, and I would like to refactorate my code so that the rabbitmq initialization is in another function that main. So I use a struct pointer (containing all the rabbitmq infos initilized) and pass it to the send function, but it tells me : Failed to publish a message: Exception (504) Reason: \"channel/connection is not open\"</p>\n\n<p>struct :</p>\n\n<pre><code>type RbmqConfig struct {\n    q amqp.Queue\n    ch *amqp.Channel\n    conn *amqp.Connection\n    rbmqErr error\n}\n</code></pre>\n\n<p>the init function :</p>\n\n<pre><code>func initRabbitMq() *RbmqConfig {\n\n    config := &amp;RbmqConfig{}\n\n    config.conn, config.rbmqErr = amqp.Dial(\"amqp://guest:guest@localhost:5672/\")\n    failOnError(config.rbmqErr, \"Failed to connect to RabbitMQ\")\n    defer config.conn.Close()\n\n    config.ch, config.rbmqErr = config.conn.Channel()\n    failOnError(config.rbmqErr, \"Failed to open a channel\")\n    defer config.ch.Close()\n\n    config.q, config.rbmqErr = config.ch.QueueDeclare(\n        \"&lt;my_queue_name&gt;\",\n        true,   // durable\n        false,   // delete when unused\n        false,   // exclusive\n        false,   // no-wait\n        nil,     // arguments\n    )\n    failOnError(config.rbmqErr, \"Failed to declare a queue\")\n\n    return config\n}\n</code></pre>\n\n<p>main :</p>\n\n<pre><code>config := initRabbitMq()\n\nfmt.Println(\"queue name : \", config.q.Name)\n\nsendMessage(config, &lt;message_to_send&gt;)\n</code></pre>\n\n<p>in send message :</p>\n\n<pre><code>func sendMessage(config *RbmqConfig, &lt;message_to_send&gt;) {\n\n    config.rbmqErr = config.ch.Publish(\n        \"\",           // exchange\n        config.q.Name,       // routing key\n        false,        // mandatory\n        false,\n        amqp.Publishing{\n            DeliveryMode: amqp.Persistent,\n            ContentType:  \"text/plain\",\n            Body:         []byte(&lt;message_to_send&gt;),\n        })\n    failOnError(config.rbmqErr, \"Failed to publish a message\")\n</code></pre>\n\n<p>If someone has any idea, that would be very helpful. Thank you in advance</p>\n"}, {"tags": ["sorting", "go", "fuzzy"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1460476001, "post_id": 36578109, "comment_id": 60755258, "body": "The Less method must be deterministic, i.e. calling Less for the same 2 values must always produce the same result."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1460476318, "post_id": 36578109, "comment_id": 60755525, "body": "Fuzz the output instead of modifying the less function."}, {"owner": {"reputation": 875, "user_id": 233523, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uxHAA.jpg?s=128&g=1", "display_name": "Brian Gerard", "link": "https://stackoverflow.com/users/233523/brian-gerard"}, "edited": false, "score": 0, "creation_date": 1460476596, "post_id": 36578109, "comment_id": 60755741, "body": "Philosophically, I completely agree.  Technically, do you mean that that will be enforced in some way?  Ie - are you saying that having a nondeterministic <code>Less()</code> will/can cause a panic?"}, {"owner": {"reputation": 41, "user_id": 5612148, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/deb3af2fdf0d79f9eafc0f6aed6158f0?s=128&d=identicon&r=PG&f=1", "display_name": "Y01rY5Ogfl", "link": "https://stackoverflow.com/users/5612148/y01ry5ogfl"}, "edited": false, "score": 0, "creation_date": 1460476865, "post_id": 36578109, "comment_id": 60755992, "body": "I just port my function from perls  builtin sort to golangs builtin sort and surprised a bit. There is no official info about deterministic/nondeterministic requirements in &quot;sort&quot; godoc."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 875, "user_id": 233523, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uxHAA.jpg?s=128&g=1", "display_name": "Brian Gerard", "link": "https://stackoverflow.com/users/233523/brian-gerard"}, "edited": false, "score": 2, "creation_date": 1460478087, "post_id": 36578109, "comment_id": 60756858, "body": "@BrianGerard Yes, the <a href=\"https://golang.org/src/sort/sort.go#L112\" rel=\"nofollow noreferrer\">code</a> assumes that the ordering is deterministic."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1460478114, "post_id": 36578109, "comment_id": 60756876, "body": "@Y01rY5Ogfl: a randomized sort comparator is the incorrect way to add randomness. This introduces unintended bias (see <a href=\"https://bost.ocks.org/mike/shuffle/compare.html\" rel=\"nofollow noreferrer\">bost.ocks.org/mike/shuffle/compare.html</a> for a good visualization) and possibly (as seen here) completely unexpected behavior."}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1460483472, "post_id": 36578109, "comment_id": 60760174, "body": "Your code snippet doesn&#39;t panicking neither on my machine nor on playground. Can you present some reproducible case or your full panic message?"}, {"owner": {"reputation": 41, "user_id": 5612148, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/deb3af2fdf0d79f9eafc0f6aed6158f0?s=128&d=identicon&r=PG&f=1", "display_name": "Y01rY5Ogfl", "link": "https://stackoverflow.com/users/5612148/y01ry5ogfl"}, "reply_to_user": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1460484024, "post_id": 36578109, "comment_id": 60760512, "body": "@Uvelichitel you need execute code several times it panics both on machine and playground , i&#39;v added full panic message to body of initial post. If you rerun code in playground several times &gt;3 i think, don&#39;t forget to add extra space to code in order to prevent playground caching"}], "answers": [{"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 0, "last_activity_date": 1460492726, "creation_date": 1460492726, "answer_id": 36583398, "question_id": 36578109, "link": "https://stackoverflow.com/questions/36578109/golang-sort-package-fuzzy-sorting-error/36583398#36583398", "title": "Golang Sort package - Fuzzy sorting error", "body": "<p>As far as I can understand Go sort implementation it expect two negative comparisons eg. <code>Less(i, j)</code> and <code>Less(j, i)</code> both return false, which it treats as equality, but not positive. E.g <code>Less(i, j)</code> and <code>Less(j, i)</code> can't both return true. So you can easily achieve desired result logically correct and deterministic  way, just</p>\n\n<pre><code>if (u[i] - u[j]) &lt; -1 {\n        return true\n    } else {\n        return false\n    }\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/VcKI9uzcM9\" rel=\"nofollow\">https://play.golang.org/p/VcKI9uzcM9</a></p>\n"}, {"tags": [], "owner": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "is_accepted": false, "score": 0, "last_activity_date": 1480684100, "creation_date": 1480684100, "answer_id": 40932998, "question_id": 36578109, "link": "https://stackoverflow.com/questions/36578109/golang-sort-package-fuzzy-sorting-error/40932998#40932998", "title": "Golang Sort package - Fuzzy sorting error", "body": "<p>As of Go 1.8, there is an easier way to sort a slice that does not require you to define new types. You simply create a Less (anonymous) lambda.</p>\n\n<pre><code>a := []int{5, 3, 4, 7, 8, 9}\nsort.Slice(a, func(i, j int) bool {\n    return a[i] &lt; a[j]\n})\nfor _, v := range a {\n    fmt.Println(v)\n}\n</code></pre>\n\n<p>This will sort in ascending order, if you want the opposite, simply write <code>a[i] &lt; a[j]</code></p>\n"}], "owner": {"reputation": 41, "user_id": 5612148, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/deb3af2fdf0d79f9eafc0f6aed6158f0?s=128&d=identicon&r=PG&f=1", "display_name": "Y01rY5Ogfl", "link": "https://stackoverflow.com/users/5612148/y01ry5ogfl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 439, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1480684100, "creation_date": 1460475840, "last_edit_date": 1460484073, "question_id": 36578109, "link": "https://stackoverflow.com/questions/36578109/golang-sort-package-fuzzy-sorting-error", "title": "Golang Sort package - Fuzzy sorting error", "body": "<p>I tried to modify standard sorting approach and add certain randomness to sorting Less interface.\nwhen </p>\n\n<pre><code>if (u[i] - u[j]) &lt;= 0\n</code></pre>\n\n<p>or</p>\n\n<pre><code>if u[i] &lt; u[j]\n</code></pre>\n\n<p>it works as expected\nBut </p>\n\n<pre><code>if (u[i] - u[j]) &lt;= rv\n</code></pre>\n\n<p>condition produces panic after several executions</p>\n\n<pre><code>package main\nimport ( \n    \"crypto/rand\"\n    \"fmt\"\n    \"math/big\"\n    \"sort\"\n)\n\ntype FuzzySorter []float64\n\nfunc (u FuzzySorter) Len() int {\n    return len(u)\n}\nfunc (u FuzzySorter) Swap(i, j int) {\n    u[i], u[j] = u[j], u[i]\n}\nfunc (u FuzzySorter) Less(i, j int) bool {\n    pom, _ := rand.Int(rand.Reader, big.NewInt(int64(2)))\n    rv := float64(pom.Int64())\n    if (u[i] - u[j]) &lt;= rv {\n        return true\n    } else {\n        return false\n    }\n\n}\nfunc (u FuzzySorter) Sort() FuzzySorter {\n    sort.Sort(u)\n    return u\n}\n\nfunc main() {\n    unsorted := FuzzySorter{\n        0,\n        1,\n        1,\n        1,\n        1,\n        6,\n        0,\n        4,\n        6,\n        1,\n        1,\n        1,\n        0,\n        2,\n        8,\n        1,\n        5,\n        4,\n        6,\n        6,\n        6,\n        16,\n        12,\n        6,\n        1,\n        1,\n        1,\n        0,\n        0,\n        11,\n        2,\n        14,\n        16,\n        6,\n        12,\n        0,\n        4,\n        1,\n        0,\n        16,\n        2,\n        6,\n        0,\n        0,\n        0,\n        0,\n        1,\n        11,\n        1,\n        0,\n        2,\n        1,\n        1,\n        1,\n        1,\n        0,\n        1,\n        12,\n        10,\n        1,\n        5,\n        2,\n        6,\n        4,\n        1,\n        0,\n        0,\n        11,\n        1,\n        1,\n        2,\n        2,\n        1,\n        0,\n        0,\n        1,\n        0,\n        1,\n        17,\n        2,\n        1,\n        1,\n        2,\n        0,\n        3,\n        7,\n        1,\n        5,\n        1,\n        0,\n        1,\n        0,\n        0,\n        0,\n        1,\n        3,\n        1,\n        1,\n        1,\n        2,\n        1,\n        0,\n        3,\n        1,\n        6,\n        1,\n        1,\n        0,\n        1,\n        12,\n        0,\n        1,\n        1,\n        0,\n        1,\n        0,\n        0,\n        6,\n        1,\n        2,\n        2,\n        0,\n        0,\n        2,\n        1,\n        1,\n        0,\n        4,\n        4,\n        1,\n        1,\n        1,\n        0,\n        1,\n        1,\n        1,\n        2,\n        0,\n        0,\n        1,\n        0,\n        1,\n        2,\n        1,\n        2,\n        1,\n        1,\n        0,\n        0,\n        4,\n        1,\n        0,\n        1,\n        0,\n        1,\n        1,\n        3,\n        1,\n        0,\n    }\n    unsorted.Sort()\n    fmt.Println(unsorted)\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/4AxNRN4VD7\" rel=\"nofollow\">https://play.golang.org/p/4AxNRN4VD7</a></p>\n\n<p>panic message</p>\n\n<pre><code>panic: runtime error: index out of range\n\ngoroutine 1 [running]:\npanic(0x176ba0, 0x1040a010)\n    /usr/local/go/src/runtime/panic.go:464 +0x700\nmain.FuzzySorter.Less(0x10456000, 0x9f, 0x9f, 0x19, 0xffffffff, 0x4, 0x1, 0xd)\n    /tmp/sandbox201242525/main.go:21 +0x140\nmain.(*FuzzySorter).Less(0x10434140, 0x19, 0xffffffff, 0x5c, 0x1, 0x10434140)\n    &lt;autogenerated&gt;:3 +0xc0\nsort.doPivot(0xfef741b0, 0x10434140, 0x19, 0x9f, 0x7, 0x19)\n    /usr/local/go/src/sort/sort.go:128 +0x280\nsort.quickSort(0xfef741b0, 0x10434140, 0x19, 0x9f, 0xe, 0xfef741b0)\n    /usr/local/go/src/sort/sort.go:195 +0xa0\nsort.Sort(0xfef741b0, 0x10434140)\n    /usr/local/go/src/sort/sort.go:229 +0x80\nmain.FuzzySorter.Sort(0x10456000, 0x9f, 0x9f, 0x1, 0x0, 0x0, 0x0, 0x1777a0)\n    /tmp/sandbox201242525/main.go:29 +0xa0\nmain.main()\n    /tmp/sandbox201242525/main.go:195 +0xc0\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": false, "score": 0, "last_activity_date": 1460475077, "creation_date": 1460475077, "answer_id": 36577810, "question_id": 36577128, "link": "https://stackoverflow.com/questions/36577128/custom-reader-until-mark-is-encountered/36577810#36577810", "title": "Custom reader until mark is encountered", "body": "<p>First, are you making a custom type or just using a normal ReadWriter?</p>\n\n<ul>\n<li><p>http.Response.Body is an io.ReadCloser so io.Copy can call its Close()</p></li>\n<li><p>To signal the end,have your ReadWriter write an io.EOF to signal it has finished.  You should take a look at ReadCloser (and its usages), so maybe you want an io.ReadWriteCloser. </p></li>\n<li><p>Probably</p></li>\n</ul>\n\n<p>Go's libary code is <em>very</em> readable don't be afraid to click on the functions in the documentation to look at the actual source.</p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1460475730, "last_edit_date": 1460475730, "creation_date": 1460475388, "answer_id": 36577944, "question_id": 36577128, "link": "https://stackoverflow.com/questions/36577128/custom-reader-until-mark-is-encountered/36577944#36577944", "title": "Custom reader until mark is encountered", "body": "<p>If your goal is to write in one goroutine and read from another, then use an <a href=\"https://godoc.org/io#Pipe\" rel=\"nofollow\">io.Pipe</a>:</p>\n\n<pre><code>r, w := io.Pipe()\ngo func(w io.WriteCloser) {\n    fmt.Fprintf(w, \"Line one\\n\")\n    // ...more writes\n    w.Close()\n}(w)\nio.Copy(dst, r)\n</code></pre>\n\n<p>Close the write side of the pipe to indicate that the writer is done.</p>\n\n<p><a href=\"http://play.golang.org/p/Bi174piVgc\" rel=\"nofollow\">playground example</a></p>\n\n<p>An io.Reader returns <a href=\"https://godoc.org/io#EOF\" rel=\"nofollow\">io.EOF</a> to indicate that no more data is available. The http response body reader returns io.EOF at the end of the body. The read side of the pipe above returns io.EOF after returning all data from the writer.</p>\n"}], "owner": {"reputation": 1598, "user_id": 1104534, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ad2bdd8c4d37364f52e6ab7aa92ef570?s=128&d=identicon&r=PG", "display_name": "Calin", "link": "https://stackoverflow.com/users/1104534/calin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 36577944, "answer_count": 2, "score": 0, "last_activity_date": 1460475730, "creation_date": 1460473400, "question_id": 36577128, "link": "https://stackoverflow.com/questions/36577128/custom-reader-until-mark-is-encountered", "title": "Custom reader until mark is encountered", "body": "<p>After reading a lot about readers/writers in go, I'm now a bit confused on how to implement a custom <code>io.ReadWriter</code> that reads (and blocks) until <strong>it is marked as finished</strong>. A sample implementation looks like this:</p>\n\n<pre><code>var rw io.ReadWriter // my custom ReadWriter\n\n// write to it in a non blocking way:\ngo func() {\n    fmt.Fprintf(rw, \"Line one\\n\")\n    // ...more writes\n    fmt.Fprintf(rw, \"END\") // what would be best to mark the writer as finished???\n}()\n\n// read from it and block until **encountering finish mark??**\n_, _ = io.Copy(dst, rw)\n</code></pre>\n\n<p>Some related questions:</p>\n\n<ul>\n<li>How <code>http.Response.Body</code> marks the body as finished, so <code>io.Copy()</code> knows when to stop reading?</li>\n<li>What would be the best way to mark it as finished?</li>\n<li>Maybe it should also be an <code>io.Closer</code>, as the <code>http.Response.Body</code>?</li>\n</ul>\n\n<p>These might be silly questions but I can't wrap my head around it after reading for a while. Also there might be a better way to implement this, I don't know. Thanks!</p>\n"}, {"tags": ["image", "go", "draw"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1460464532, "post_id": 36573413, "comment_id": 60745400, "body": "Related / Possible duplicate of <a href=\"http://stackoverflow.com/questions/28992396/draw-a-rectangle-in-golang\">Draw a rectangle in golang?</a>"}, {"owner": {"reputation": 1040, "user_id": 5081185, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/yQ8Wl.jpg?s=128&g=1", "display_name": "Mat&#250;\u0161 \u010congr&#225;dy", "link": "https://stackoverflow.com/users/5081185/mat%c3%ba%c5%a1-%c4%8congr%c3%a1dy"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1460465012, "post_id": 36573413, "comment_id": 60745796, "body": "To be fair, I dont understand that answer. Even after reading it twice I have no idea how is it possible to use that Set method."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1460473392, "post_id": 36573413, "comment_id": 60753079, "body": "All right, see my answer below."}], "answers": [{"comments": [{"owner": {"reputation": 1040, "user_id": 5081185, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/yQ8Wl.jpg?s=128&g=1", "display_name": "Mat&#250;\u0161 \u010congr&#225;dy", "link": "https://stackoverflow.com/users/5081185/mat%c3%ba%c5%a1-%c4%8congr%c3%a1dy"}, "edited": false, "score": 0, "creation_date": 1460466446, "post_id": 36574000, "comment_id": 60747102, "body": "I can&#39;t use this. I still cant use Set method, since my encoded image is of type image.Image, which doesnt have Set method. Looping over whole image isn&#39;t what I&#39;d like to do either, I need to change just a few pixels. Thanks for the answer anyway"}, {"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "reply_to_user": {"reputation": 1040, "user_id": 5081185, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/yQ8Wl.jpg?s=128&g=1", "display_name": "Mat&#250;\u0161 \u010congr&#225;dy", "link": "https://stackoverflow.com/users/5081185/mat%c3%ba%c5%a1-%c4%8congr%c3%a1dy"}, "edited": false, "score": 0, "creation_date": 1460466849, "post_id": 36574000, "comment_id": 60747482, "body": "How about to create a new RGBA image, which returns RGBA interface, on which you can use the <code>Set</code> method <code>m := image.NewRGBA(image.Rect(0, 0, width, height))</code>"}, {"owner": {"reputation": 1040, "user_id": 5081185, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/yQ8Wl.jpg?s=128&g=1", "display_name": "Mat&#250;\u0161 \u010congr&#225;dy", "link": "https://stackoverflow.com/users/5081185/mat%c3%ba%c5%a1-%c4%8congr%c3%a1dy"}, "edited": false, "score": 0, "creation_date": 1460467324, "post_id": 36574000, "comment_id": 60747942, "body": "Aight, I just thought I can draw pixels directly to my encoded image. Creating new image and copying content of old encoded image just so I can change a few pixels seems a bit odd to me."}], "tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 2, "last_activity_date": 1460467280, "last_edit_date": 1460467280, "creation_date": 1460465820, "answer_id": 36574000, "question_id": 36573413, "link": "https://stackoverflow.com/questions/36573413/change-color-of-a-single-pixel-golang-image/36574000#36574000", "title": "Change color of a single pixel - Golang image", "body": "<p>The image decode returns an <a href=\"https://golang.org/pkg/image/#Decode\" rel=\"nofollow\">image interface</a> which has a <code>Bounds</code> method to obtain the image pixel width and height.</p>\n\n<pre><code>img, _, err := image.Decode(imgfile)\nif err != nil {\n    fmt.Println(err.Error())\n}\nsize := img.Bounds().Size()\n</code></pre>\n\n<p>Once you have the width and height you can iterate over the pixels with two nested for loops (one for the <code>x</code> and one for <code>y</code> coordinate).</p>\n\n<pre><code>for x := 0; x &lt; size.X; x++ {\n    for y := 0; y &lt; size.Y; y++ {\n        color := color.RGBA{\n            uint8(255 * x / size.X),\n            uint8(255 * y / size.Y),\n            55,\n            255}\n        m.Set(x, y, color)\n    }\n}\n</code></pre>\n\n<p>Once your are done with the image manipulation you can encode the file. But because <code>image.Image</code> does not have <code>Set</code> method, you can create a new RGBA image, which returns an <code>RGBA</code> struct, on which you can use the <code>Set</code> method.</p>\n\n<pre><code>m := image.NewRGBA(image.Rect(0, 0, width, height))\noutFile, err := os.Create(\"changed.jpg\")\nif err != nil {\n    log.Fatal(err)\n}\ndefer outFile.Close()\npng.Encode(outFile, m)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1040, "user_id": 5081185, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/yQ8Wl.jpg?s=128&g=1", "display_name": "Mat&#250;\u0161 \u010congr&#225;dy", "link": "https://stackoverflow.com/users/5081185/mat%c3%ba%c5%a1-%c4%8congr%c3%a1dy"}, "edited": false, "score": 4, "creation_date": 1460466142, "post_id": 36574027, "comment_id": 60746825, "body": "I tried to do this before. Im getting this error: &quot; *image.YCbCr is not draw.Image: missing method Set &quot;"}], "tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": false, "score": 0, "last_activity_date": 1460465870, "creation_date": 1460465870, "answer_id": 36574027, "question_id": 36573413, "link": "https://stackoverflow.com/questions/36573413/change-color-of-a-single-pixel-golang-image/36574027#36574027", "title": "Change color of a single pixel - Golang image", "body": "<p>image.Image is immutable by default, but draw.Image is mutable.</p>\n\n<p>If you do a type conversion to draw.Image, that should give you a Set method</p>\n\n<pre><code>img.(draw.Image).Set(0,0, color.RGBA{85, 165, 34, 1})\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5867, "user_id": 899048, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/6aL47.png?s=128&g=1", "display_name": "Justin Self", "link": "https://stackoverflow.com/users/899048/justin-self"}, "edited": false, "score": 0, "creation_date": 1495914548, "post_id": 36577076, "comment_id": 75452478, "body": "Even looking through the go source for those packages, I don&#39;t know how you were able to determine that you can create an interface with Set on it. How did you arrive at that conclusion?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5867, "user_id": 899048, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/6aL47.png?s=128&g=1", "display_name": "Justin Self", "link": "https://stackoverflow.com/users/899048/justin-self"}, "edited": false, "score": 0, "creation_date": 1495966273, "post_id": 36577076, "comment_id": 75462200, "body": "@JustinSelf The different concrete <code>image.Image</code> implementations in the <code>image</code> package all have a <code>Set(x, y int, c color.Color)</code> method. So image decoding functions of the standard library are highly likely to return an image implementation that will have this <code>Set()</code> method. So that&#39;s why we should check that first. If the image does not have a <code>Set()</code> method, then we can name our custom <code>Set()</code> method whatever we like (it doesn&#39;t matter as long as only we will call it), I just used the same method signature for clarity."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 17, "last_activity_date": 1460503885, "last_edit_date": 1460503885, "creation_date": 1460473268, "answer_id": 36577076, "question_id": 36573413, "link": "https://stackoverflow.com/questions/36573413/change-color-of-a-single-pixel-golang-image/36577076#36577076", "title": "Change color of a single pixel - Golang image", "body": "<p>On successful decoding <a href=\"https://golang.org/pkg/image/#Decode\" rel=\"noreferrer\"><code>image.Decode()</code></a> (and also specific decoding functions like <a href=\"https://golang.org/pkg/image/jpeg/#Decode\" rel=\"noreferrer\"><code>jpeg.Decode()</code></a>) return a value of <a href=\"https://golang.org/pkg/image/#Image\" rel=\"noreferrer\"><code>image.Image</code></a>. <code>image.Image</code> is an interface which defines a read-only view of an image: it does not provide methods to change / draw on the image.</p>\n\n<p>The <code>image</code> package provides several <code>image.Image</code> implementations which allow you to change / draw on the image, usually with a <code>Set(x, y int, c color.Color)</code> method.</p>\n\n<p><code>image.Decode()</code> however does not give you any guarantee that the returned image will be any of the image types defined in the <code>image</code> package, or even that the dynamic type of the image has a <code>Set()</code> method (it may, but no guarantee). Registered custom image decoders may return you an <code>image.Image</code> value being a custom implementation (meaning not an image type defined in the <code>image</code> package).</p>\n\n<p>If the (dynamic type of the) image does have a <code>Set()</code> method, you may use <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"noreferrer\">type assertion</a> and use its <code>Set()</code> method to draw on it. This is how it can be done:</p>\n\n<pre><code>type Changeable interface {\n    Set(x, y int, c color.Color)\n}\n\nimgfile, err := os.Open(\"unchanged.jpg\")\nif err != nil {\n    panic(err.Error())\n}\ndefer imgfile.Close()\n\nimg, err := jpeg.Decode(imgfile)\nif err != nil {\n    panic(err.Error())\n}\n\nif cimg, ok := img.(Changeable); ok {\n    // cimg is of type Changeable, you can call its Set() method (draw on it)\n    cimg.Set(0, 0, color.RGBA{85, 165, 34, 255})\n    cimg.Set(0, 1, color.RGBA{255, 0, 0, 255})\n    // when done, save img as usual\n} else {\n    // No luck... see your options below\n}\n</code></pre>\n\n<p>If the image does not have a <code>Set()</code> method, you may choose to \"override its view\" by implementing a custom type which implements <code>image.Image</code>, but in its <code>At(x, y int) color.Color</code> method (which returns / supplies the colors of pixels) you return the new colors that you would set if the image would be changeable, and return the pixels of the original image where you would not change the image.</p>\n\n<p>Implementing the <code>image.Image</code> interface is easiest done by utilizing <em>embedding</em>, so you only need to implement the changes you want. This is how it can be done:</p>\n\n<pre><code>type MyImg struct {\n    // Embed image.Image so MyImg will implement image.Image\n    // because fields and methods of Image will be promoted:\n    image.Image\n}\n\nfunc (m *MyImg) At(x, y int) color.Color {\n    // \"Changed\" part: custom colors for specific coordinates:\n    switch {\n    case x == 0 &amp;&amp; y == 0:\n        return color.RGBA{85, 165, 34, 255}\n    case x == 0 &amp;&amp; y == 1:\n        return color.RGBA{255, 0, 0, 255}\n    }\n    // \"Unchanged\" part: the colors of the original image:\n    return m.Image.At(x, y)\n}\n</code></pre>\n\n<p>Using it: extremely simple. Load the image as you did, but when saving, provide a value of our <code>MyImg</code> type which will take care of providing the altered image content (colors) when it is asked by the encoder:</p>\n\n<pre><code>jpeg.Encode(outFile, &amp;MyImg{img}, nil)\n</code></pre>\n\n<p>If you have to change many pixels, it's not practical to include all in the <code>At()</code> method. For that we can extend our <code>MyImg</code> to have our <code>Set()</code> implementation which stores the pixels that we want to change. Example implementation:</p>\n\n<pre><code>type MyImg struct {\n    image.Image\n    custom map[image.Point]color.Color\n}\n\nfunc NewMyImg(img image.Image) *MyImg {\n    return &amp;MyImg{img, map[image.Point]color.Color{}}\n}\n\nfunc (m *MyImg) Set(x, y int, c color.Color) {\n    m.custom[image.Point{x, y}] = c\n}\n\nfunc (m *MyImg) At(x, y int) color.Color {\n    // Explicitly changed part: custom colors of the changed pixels:\n    if c := m.custom[image.Point{x, y}]; c != nil {\n        return c\n    }\n    // Unchanged part: colors of the original image:\n    return m.Image.At(x, y)\n}\n</code></pre>\n\n<p>Using it:</p>\n\n<pre><code>// Load image as usual, then\n\nmy := NewMyImg(img)\nmy.Set(0, 0, color.RGBA{85, 165, 34, 1})\nmy.Set(0, 1, color.RGBA{255, 0, 0, 255})\n\n// And when saving, save 'my' instead of the original:\njpeg.Encode(outFile, my, nil)\n</code></pre>\n\n<p>If you have to change many pixels, then it might be more profitable to just create a new image which supports changing its pixels, e.g. <a href=\"https://golang.org/pkg/image/#RGBA\" rel=\"noreferrer\"><code>image.RGBA</code></a>, draw the original image on it and then proceed to change pixels you want to.</p>\n\n<p>To draw an image onto another, you can use the <a href=\"https://golang.org/pkg/image/draw/\" rel=\"noreferrer\"><code>image/draw</code></a> package.</p>\n\n<pre><code>cimg := image.NewRGBA(img.Bounds())\ndraw.Draw(cimg, img.Bounds(), img, image.Point{}, draw.Over)\n\n// Now you have cimg which contains the original image and is changeable\n// (it has a Set() method)\ncimg.Set(0, 0, color.RGBA{85, 165, 34, 255})\ncimg.Set(0, 1, color.RGBA{255, 0, 0, 255})\n\n// And when saving, save 'cimg' of course:\njpeg.Encode(outFile, cimg, nil)\n</code></pre>\n\n<p>The above code is just for demonstration. In \"real-life\" images <code>Image.Bounds()</code> may return a rectangle that does not start at <code>(0;0)</code> point, in which case some adjustment would be needed to make it work.</p>\n"}], "owner": {"reputation": 1040, "user_id": 5081185, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/yQ8Wl.jpg?s=128&g=1", "display_name": "Mat&#250;\u0161 \u010congr&#225;dy", "link": "https://stackoverflow.com/users/5081185/mat%c3%ba%c5%a1-%c4%8congr%c3%a1dy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9881, "favorite_count": 4, "accepted_answer_id": 36577076, "answer_count": 3, "score": 12, "last_activity_date": 1554156679, "creation_date": 1460464384, "last_edit_date": 1554156679, "question_id": 36573413, "link": "https://stackoverflow.com/questions/36573413/change-color-of-a-single-pixel-golang-image", "title": "Change color of a single pixel - Golang image", "body": "<p>I want to open jpeg image file, encode it, change some pixel colors, and then save it back as it was.</p>\n\n<p>I'd like to do something like this</p>\n\n<pre><code>imgfile, err := os.Open(\"unchanged.jpeg\")\ndefer imgfile.Close()\nif err != nil {\n    fmt.Println(err.Error())\n}\n\nimg,err := jpeg.Decode(imgfile)\nif err != nil {\n    fmt.Println(err.Error())\n}\nimg.Set(0, 0, color.RGBA{85, 165, 34, 1})\nimg.Set(1,0,....)\n\noutFile, _ := os.Create(\"changed.jpeg\")\ndefer outFile.Close()\njpeg.Encode(outFile, img, nil)\n</code></pre>\n\n<p>I just can't come up with a working solution, since default image type that I get after encoding image-file doesn't have Set method.</p>\n\n<p>Can anyone explain how to do this? Thanks a lot.</p>\n"}, {"tags": ["go", "google-cloud-storage"], "answers": [{"tags": [], "owner": {"reputation": 875, "user_id": 233523, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uxHAA.jpg?s=128&g=1", "display_name": "Brian Gerard", "link": "https://stackoverflow.com/users/233523/brian-gerard"}, "is_accepted": true, "score": 0, "last_activity_date": 1460475909, "creation_date": 1460475909, "answer_id": 36578142, "question_id": 36572872, "link": "https://stackoverflow.com/questions/36572872/how-to-set-the-acl-to-publicread-with-predefinedacl-function/36578142#36578142", "title": "How to set the ACL to publicRead with PredefinedAcl function?", "body": "<p>Going by <a href=\"https://godoc.org/google.golang.org/api/storage/v1#ObjectsInsertCall.PredefinedAcl\" rel=\"nofollow\">what i found in the docs</a>, it looks like this would do it...</p>\n\n<pre><code>if res, err := service.Objects.Insert(*bucketName, object).Media(file).PredefinedAcl(\"publicRead\").Do(); err == nil {\n    fmt.Printf(\"Created object %v at location %v\\n\\n\", res.Name, res.SelfLink)\n} else {\n    fatalf(service, \"Objects.Insert failed: %v\", err)\n}\n</code></pre>\n\n<p>(Inserted it right before the <code>Do()</code> call.) HTH, YMMV, etc.</p>\n"}], "owner": {"reputation": 13, "user_id": 3132501, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ehbTU.png?s=128&g=1", "display_name": "Oxynux", "link": "https://stackoverflow.com/users/3132501/oxynux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 2, "accepted_answer_id": 36578142, "answer_count": 1, "score": 1, "last_activity_date": 1460475909, "creation_date": 1460463054, "last_edit_date": 1460463342, "question_id": 36572872, "link": "https://stackoverflow.com/questions/36572872/how-to-set-the-acl-to-publicread-with-predefinedacl-function", "title": "How to set the ACL to publicRead with PredefinedAcl function?", "body": "<pre><code>if res, err := service.Objects.Insert(*bucketName, object).Media(file).Do(); err == nil {\n     fmt.Printf(\"Created object %v at location %v\\n\\n\", res.Name, res.SelfLink)\n} else {\n     fatalf(service, \"Objects.Insert failed: %v\", err)\n}\n</code></pre>\n\n<p>I want to modify this code to set the ACL to publicRead, I have noticed there is a function in the API <code>func (*ObjectsInsertCall) PredefinedAcl</code> but I can't find how to use it.</p>\n"}, {"tags": ["go", "memory-leaks"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 5, "creation_date": 1460460874, "post_id": 36571917, "comment_id": 60742526, "body": "Go is memory managed and garbage collected, so there is no way to manually free up memory.  and because of that I&#39;m not sure examining Go apps with valgrind is useful."}, {"owner": {"reputation": 141, "user_id": 6029027, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ac9c83841db833d09ea9bfaf8d72d42?s=128&d=identicon&r=PG&f=1", "display_name": "Wyatt", "link": "https://stackoverflow.com/users/6029027/wyatt"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1460461665, "post_id": 36571917, "comment_id": 60743149, "body": "@Not_a_Golfer <code>valgrind</code> is a powerful memory test tool. You can have a try"}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 6, "creation_date": 1460462042, "post_id": 36571917, "comment_id": 60743437, "body": "@Wyatt His point is that valgrind is useless on Go programs. It doesn&#39;t know how Go manages memory. Go does not use malloc/free (except in a few rare cases where the standard library needs to be used, like here) which is what valgrind overrides to know about memory allocations."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1460465390, "post_id": 36571917, "comment_id": 60746131, "body": "@Wyatt I&#39;ve been working with valgrind for over a decade :) You just can&#39;t  really use it (and don&#39;t need to use it) with Go programs."}], "answers": [{"tags": [], "owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "is_accepted": true, "score": 20, "last_activity_date": 1460462214, "last_edit_date": 1460462214, "creation_date": 1460461829, "answer_id": 36572467, "question_id": 36571917, "link": "https://stackoverflow.com/questions/36571917/memory-leaks-in-golang/36572467#36572467", "title": "memory leaks in golang", "body": "<p>Nothing was leaked. The memory is still reachable and it's quite common to not free things on exit, it just takes unnecessary time and the OS will deal with it anyway.</p>\n\n<p>This is memory allocated to thread local storage to a thread that's still running, so it would be incorrect to free it. A better question would be \"how do I stop this thread?\", to which an answer is: you don't, the Go runtime deals with it. It is quite common to not stop threads at exit, it just takes unnecessary time and the OS will deal with it anyway.</p>\n\n<p>It has nothing to do with your code and your function call, it's something that Go runtime allocates for itself.</p>\n\n<p>Go is a garbage collected language and using valgrind on it will not tell you much. It will neither detect real memory leaks nor will it understand which memory is still in use.</p>\n"}, {"tags": [], "owner": {"reputation": 321, "user_id": 308709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3e3ddfb47c9f77d331df9cb80b8ee89?s=128&d=identicon&r=PG", "display_name": "bobpaul", "link": "https://stackoverflow.com/users/308709/bobpaul"}, "is_accepted": false, "score": 1, "last_activity_date": 1476469530, "creation_date": 1476469530, "answer_id": 40049793, "question_id": 36571917, "link": "https://stackoverflow.com/questions/36571917/memory-leaks-in-golang/40049793#40049793", "title": "memory leaks in golang", "body": "<p>You can manually run garbage collection:\n<a href=\"https://golang.org/pkg/runtime/#GC\" rel=\"nofollow\">https://golang.org/pkg/runtime/#GC</a></p>\n\n<p>I think that would free up the memory, but as others have said, that memory will get freed eventually when the runtime's scheduled garbage collector runs.</p>\n"}], "owner": {"reputation": 141, "user_id": 6029027, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ac9c83841db833d09ea9bfaf8d72d42?s=128&d=identicon&r=PG&f=1", "display_name": "Wyatt", "link": "https://stackoverflow.com/users/6029027/wyatt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7171, "favorite_count": 2, "accepted_answer_id": 36572467, "answer_count": 2, "score": 2, "last_activity_date": 1476469530, "creation_date": 1460460403, "question_id": 36571917, "link": "https://stackoverflow.com/questions/36571917/memory-leaks-in-golang", "title": "memory leaks in golang", "body": "<p>Here is the code.\nIn the golang main function, which in main.go</p>\n\n<pre><code>func main() {\n    rgc.GetRgcService()\n}\n</code></pre>\n\n<p>where the <code>rgc</code> is in another golang file, named <code>mrgc.go</code>. The code inside is</p>\n\n<pre><code>package rgc\nfunc GetRgcService() (svc *RgcService, err error) {}\n</code></pre>\n\n<p>The function GetRgcService is a empty function.</p>\n\n<p>However, when I used <code>valgrind</code> to test the memory, I got the following output</p>\n\n<pre><code> ==58156== HEAP SUMMARY:\n ==58156==     in use at exit: 1,152 bytes in 4 blocks\n ==58156==   total heap usage: 9 allocs, 5 frees, 1,304 bytes allocated\n ==58156== 288 bytes in 1 blocks are possibly lost in loss record 4 of 4\n ==58156==    at 0x4A27F63: calloc (vg_replace_malloc.c:593)\n ==58156==    by 0x4010DE1: allocate_dtv (in /home/opt/gcc-4.8.2.bpkg-r2/gcc-4.8.2.bpkg-r2/lib64/ld-2.18.so)\n==58156==    by 0x40114ED: _dl_allocate_tls (in /home/opt/gcc-4.8.2.bpkg-r2/gcc-4.8.2.bpkg-r2/lib64/ld-2.18.so)\n==58156==    by 0x4B36DE2: pthread_create@@GLIBC_2.2.5 (in /home/opt/gcc-4.8.2.bpkg-r2/gcc-4.8.2.bpkg-r2/lib64/libpthread-2.18.so)\n==58156==    by 0x4B2937: _cgo_sys_thread_start (gcc_linux_amd64.c:75)\n==58156==    by 0x45506C: runtime.asmcgocall (/home/map/.jumbo/lib/go/src/runtime/asm_amd64.s:612)\n==58156==    by 0x50619F: ??? (in /home/users/zhanghuaizhi/ttt.38)\n==58156==    by 0xC7FFFFFFFF: ???\n==58156==    by 0xC820067FFF: ???\n==58156==    by 0x42D69B: runtime.allocm (/home/map/.jumbo/lib/go/src/runtime/proc.go:1260)\n==58156==    by 0x42DD3A: runtime.newm (/home/map/.jumbo/lib/go/src/runtime/proc.go:1510)\n==58156==    by 0x42E071: runtime.startm (/home/map/.jumbo/lib/go/src/runtime/proc.go:1583)\n==58156== \n==58156== LEAK SUMMARY:\n==58156==    definitely lost: 0 bytes in 0 blocks\n==58156==    indirectly lost: 0 bytes in 0 blocks\n==58156==      possibly lost: 1,152 bytes in 4 blocks\n==58156==    still reachable: 0 bytes in 0 blocks\n==58156==         suppressed: 0 bytes in 0 blocks\n</code></pre>\n\n<p>How can I free these memory? Since I need to used this function to do a lot of process. It causes lots of memory leaks, which can not be freed</p>\n"}, {"tags": ["go", "character-encoding"], "answers": [{"comments": [{"owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "edited": false, "score": 0, "creation_date": 1462547776, "post_id": 36569133, "comment_id": 61696361, "body": "Thanks. But doesn&#39;t it kill the concept of runes ? if you iterate over the runes of  &#39;e\u0301\u0301\u0301&#39;, Go will return 4 runes ? Because &#39;&#233;&#39; (with one accent) makes perfectly sense to have just 1 rune, not 2."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "edited": false, "score": 0, "creation_date": 1462563791, "post_id": 36569133, "comment_id": 61705240, "body": "@Thomas It&#39;s not a concept of <code>rune</code>s. Please see edited answer."}, {"owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "edited": false, "score": 0, "creation_date": 1462605070, "post_id": 36569133, "comment_id": 61715641, "body": "Thank you I think I understand now"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1559106732, "last_edit_date": 1592644375, "creation_date": 1460453381, "answer_id": 36569133, "question_id": 36569018, "link": "https://stackoverflow.com/questions/36569018/can-a-character-span-multiple-runes-in-go/36569133#36569133", "title": "Can a character span multiple runes in Go?", "body": "<p>Yes it can:</p>\n<pre><code>s := &quot;e\u0301\u0301\u0301&quot;\nfmt.Println(s, []rune(s))\n</code></pre>\n<p>Output (try it on the <a href=\"http://play.golang.org/p/MmTr6k95ah\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n<pre><code>e\u0301\u0301\u0301 [101 769 769 769]\n</code></pre>\n<p>One character, 4 runes. It may be arbitrary long...</p>\n<p>Example taken from <a href=\"http://blog.golang.org/normalization\" rel=\"nofollow noreferrer\">The Go Blog: Text Normalization in Go</a>.</p>\n<blockquote>\n<p><strong>What is a character?</strong></p>\n<p>As was mentioned in the strings blog post, characters can span multiple runes. For example, an 'e' and '\u25cc\u0301' (acute &quot;\\u0301&quot;) can combine to form '\u00e9' (&quot;e\\u0301&quot; in NFD).  Together these two runes are one character. The definition of a character may vary depending on the application. For normalization we will define it as a sequence of runes that starts with a starter, a rune that does not modify or combine backwards with any other rune, followed by possibly empty sequence of non-starters, that is, runes that do (typically accents). The normalization algorithm processes one character at at time.</p>\n</blockquote>\n<p>A character can be followed by any number of <a href=\"https://en.wikipedia.org/wiki/Spacing_Modifier_Letters\" rel=\"nofollow noreferrer\">modifiers</a> (modifiers can be repeated and stacked):</p>\n<blockquote>\n<p>Theoretically, there is no bound to the number of runes that can make up a Unicode character. In fact, there are no restrictions on the number of modifiers that can follow a character and a modifier may be repeated, or stacked. Ever seen an 'e' with three acutes? Here you go: 'e\u0301\u0301\u0301'. That is a perfectly valid 4-rune character according to the standard.</p>\n</blockquote>\n<p>Also see: <a href=\"https://en.wikipedia.org/wiki/Combining_character\" rel=\"nofollow noreferrer\">Combining character</a>.</p>\n<p><strong>Edit:</strong> <em>&quot;Doesn't this kill the 'concept of runes'?&quot;</em></p>\n<p>Answer: It's not a concept of runes. A <code>rune</code> is not a character. A rune is an integer value identifying a Unicode code point. A character <em>may</em> be one Unicode code point in which case 1 character is 1 <code>rune</code>. Most of the general use of <code>rune</code>s fits into this case, so in practice this hardly gives any headaches. It's a concept of the <a href=\"https://en.wikipedia.org/wiki/Unicode\" rel=\"nofollow noreferrer\">Unicode standard</a>.</p>\n"}], "owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2059, "favorite_count": 0, "accepted_answer_id": 36569133, "answer_count": 1, "score": 2, "last_activity_date": 1559106732, "creation_date": 1460453127, "question_id": 36569018, "link": "https://stackoverflow.com/questions/36569018/can-a-character-span-multiple-runes-in-go", "title": "Can a character span multiple runes in Go?", "body": "<p>I read this on <a href=\"http://devs.cloudimmunity.com/gotchas-and-common-mistakes-in-go-golang/\" rel=\"nofollow\">this blog</a> </p>\n\n<blockquote>\n  <p>Even with rune slices a single character might span multiple runes, which can happen if you have characters with grave accent, for example. This complicated and ambiguous nature of \"characters\" is the reason why Go strings are represented as byte sequences.</p>\n</blockquote>\n\n<p>Is it true ? (it seems like a blog from someone who knows Go). I tested on my machine and \"\u00e8\" is 1 rune and 2 bytes. And the <a href=\"https://blog.golang.org/strings\" rel=\"nofollow\">Go doc</a> seems to say otherwise.</p>\n\n<p>Have you encountered such characters ? (utf-8) Can a character span multiple runes in Go ?</p>\n"}, {"tags": ["testing", "go"], "answers": [{"comments": [{"owner": {"reputation": 315, "user_id": 114635, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/717b265d0d107e0bbd2cf0c66e834f1f?s=128&d=identicon&r=PG", "display_name": "e-Jah", "link": "https://stackoverflow.com/users/114635/e-jah"}, "edited": false, "score": 0, "creation_date": 1460466127, "post_id": 36573750, "comment_id": 60746801, "body": "Thanks! I will check this out"}], "tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": true, "score": 0, "last_activity_date": 1460465246, "creation_date": 1460465246, "answer_id": 36573750, "question_id": 36568335, "link": "https://stackoverflow.com/questions/36568335/testing-a-rest-api-with-goconvey/36573750#36573750", "title": "Testing a REST API with GoConvey", "body": "<p>the <a href=\"https://golang.org/pkg/net/http/httptest/\" rel=\"nofollow\">net/http/httptest</a> package is useful for creating a server for a specific http.Handler.</p>\n\n<p><a href=\"https://talks.golang.org/2014/testing.slide#12\" rel=\"nofollow\">Andrew Gerrand's testing talk</a> goes over the httptest.Server and httptest.ResponseRecorder starting slide 12</p>\n"}], "owner": {"reputation": 315, "user_id": 114635, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/717b265d0d107e0bbd2cf0c66e834f1f?s=128&d=identicon&r=PG", "display_name": "e-Jah", "link": "https://stackoverflow.com/users/114635/e-jah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 508, "favorite_count": 0, "accepted_answer_id": 36573750, "answer_count": 1, "score": 1, "last_activity_date": 1460465246, "creation_date": 1460451538, "question_id": 36568335, "link": "https://stackoverflow.com/questions/36568335/testing-a-rest-api-with-goconvey", "title": "Testing a REST API with GoConvey", "body": "<p>I am writing a simple service and was wondering how should I approach testing the REST API Endpoints using GoConvey?</p>\n\n<p>Ideally I believe I would have to launch my server to test it against, but for some reason I am not able to wrap my head around on how to do it with Go.</p>\n\n<p>I am using the vanilla net/http stack for this service and mgo for the database.</p>\n\n<p>Any idea and help would be very welcomed :)</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "timer"], "comments": [{"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1460449578, "post_id": 36567456, "comment_id": 60734506, "body": "What do you mean that you&#39;ve checked the go API and found nothing?  If you google &quot;golang timer&quot; the first result is the official standard library docs for golang&#39;s time package.  The <code>Timer</code> type has only two methods, one of which is <code>Reset</code>.  Is that not exactly what you want?"}], "answers": [{"comments": [{"owner": {"reputation": 346, "user_id": 4476748, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/9411f33f09008556e0b6b5323f78fc35?s=128&d=identicon&r=PG&f=1", "display_name": "fding", "link": "https://stackoverflow.com/users/4476748/fding"}, "edited": false, "score": 0, "creation_date": 1460450156, "post_id": 36567691, "comment_id": 60734933, "body": "I&#39;m not sure Reset() will start from 0, or continue timing."}, {"owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "reply_to_user": {"reputation": 346, "user_id": 4476748, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/9411f33f09008556e0b6b5323f78fc35?s=128&d=identicon&r=PG&f=1", "display_name": "fding", "link": "https://stackoverflow.com/users/4476748/fding"}, "edited": false, "score": 0, "creation_date": 1460452440, "post_id": 36567691, "comment_id": 60736536, "body": "@fding I&#39;ve updated answer, to address your concern."}], "tags": [], "owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "is_accepted": false, "score": 1, "last_activity_date": 1460452408, "last_edit_date": 1460452408, "creation_date": 1460449895, "answer_id": 36567691, "question_id": 36567456, "link": "https://stackoverflow.com/questions/36567456/golang-timer-re-calculate-from-zero/36567691#36567691", "title": "golang timer re-calculate from zero", "body": "<p>You can use <code>timer.Reset</code> function, to reset the timer. To renew it, pass the same duration, you used initially as parameter. (In your case <code>10</code>)</p>\n\n<p>From package documentation:</p>\n\n<blockquote>\n  <p>Reset changes the timer to expire after duration d. It returns true if the timer had been active, false if the timer had expired or been stopped.</p>\n</blockquote>\n\n<p>So, when you pass the same duration to <code>Reset</code>, timer will start counting from that duration d. And you effectively <code>renew</code> the timer. </p>\n\n<p>For example:</p>\n\n<pre><code>if eventHappened {\n   timer.Reset(10)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 2, "last_activity_date": 1460452652, "creation_date": 1460452652, "answer_id": 36568807, "question_id": 36567456, "link": "https://stackoverflow.com/questions/36567456/golang-timer-re-calculate-from-zero/36568807#36568807", "title": "golang timer re-calculate from zero", "body": "<p>What about to use <a href=\"https://golang.org/pkg/time/#Timer.Reset\" rel=\"nofollow\"><code>time.Reset</code></a>?</p>\n\n<blockquote>\n  <p>Reset changes the timer to expire after duration d. It returns true if\n  the timer had been active, false if the timer had expired or been\n  stopped.</p>\n</blockquote>\n\n<p>Another solution would be to initialize another timer.</p>\n\n<pre><code>t.Reset(x)\nt := time.NewTimer(x)\n</code></pre>\n\n<p>are identical, except for avoiding the garbage collection.</p>\n\n<p>A typical example would be the following. It will reset the timer in case the elapsed time is less then the timeout.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\nfunc main() {\n    const timeout = 1 * time.Millisecond\n    t := time.NewTimer(timeout)\n    for {\n        t2 := timeout + time.Duration(rand.Intn(100)-50)*timeout/100\n        start := time.Now()\n        select {\n        case &lt;-time.After(t2):\n            fmt.Println(\"Time after:\", t2)\n        }\n        elapsed := time.Since(start)\n        if elapsed &lt; timeout {\n            fmt.Println(\"Time ellapsed:\", elapsed)\n            t.Reset(timeout)\n        }        \n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 346, "user_id": 4476748, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/9411f33f09008556e0b6b5323f78fc35?s=128&d=identicon&r=PG&f=1", "display_name": "fding", "link": "https://stackoverflow.com/users/4476748/fding"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3274, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1460473334, "creation_date": 1460449235, "last_edit_date": 1460473334, "question_id": 36567456, "link": "https://stackoverflow.com/questions/36567456/golang-timer-re-calculate-from-zero", "title": "golang timer re-calculate from zero", "body": "<p>I need to write a timer, which may reset itself to zero. For example, I have a</p>\n\n<pre><code>trm := time.NewTimer(10)\n</code></pre>\n\n<p>then, if something happened before it has expired, the timer will clear all the data it has, and re-calculate from 0, just like when I re-new a same timer.</p>\n\n<p>I've checked Go's time API, and haven't found anything. Any tips?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": true, "score": 1, "last_activity_date": 1460446065, "creation_date": 1460446065, "answer_id": 36566412, "question_id": 36566288, "link": "https://stackoverflow.com/questions/36566288/which-is-best-way-to-wait-event-until-expire-in-golang-timer-or-goroutine-loop/36566412#36566412", "title": "Which is best way to wait event until expire in golang, timer or goroutine loop?", "body": "<p>Since you mention a time period of days, of the two given, you should probably go with the second option.  This way you can store state to a file (or database) and restart the process if necessary.  The first option makes storing the state more difficult, but still possible.</p>\n"}], "owner": {"reputation": 3728, "user_id": 2073991, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/hjYJt.jpg?s=128&g=1", "display_name": "Yi Jiang", "link": "https://stackoverflow.com/users/2073991/yi-jiang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 514, "favorite_count": 0, "accepted_answer_id": 36566412, "answer_count": 1, "score": 0, "last_activity_date": 1460446065, "creation_date": 1460445761, "question_id": 36566288, "link": "https://stackoverflow.com/questions/36566288/which-is-best-way-to-wait-event-until-expire-in-golang-timer-or-goroutine-loop", "title": "Which is best way to wait event until expire in golang, timer or goroutine loop?", "body": "<p>the state machine's first state is waiting for one event, if the event doesn't happen in certain days, the status machine will switch to the second state. If the event happened in the period, the state machine will switch to the third state. </p>\n\n<p>I have two option:\n1, Use a timer. Set up a timer as certain days. When time is up, checking does the event happened or not. If happened, switch to the third state. If not, switch to the second state. It is possible that thousands of timers will be created in the period.</p>\n\n<p>2, Use a looping with routine. Start a routine to run a loop. Every half hour, the goroutine will check the event happened or not. If the event happened, switch to the third state. Else, keep looping until expired the certain days, then switch to the second state. </p>\n\n<p>My question is time.Timer vs goroutine, which is more suit for this case?</p>\n"}, {"tags": ["arrays", "string", "go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 3680, "user_id": 1813875, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6078165a3f6a8693a0b1a1101e9260c7?s=128&d=identicon&r=PG", "display_name": "harryz", "link": "https://stackoverflow.com/users/1813875/harryz"}, "edited": false, "score": 0, "creation_date": 1460445739, "post_id": 36566139, "comment_id": 60732047, "body": "Thanks @icza, very detailed explanation!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1460445825, "last_edit_date": 1460445825, "creation_date": 1460445339, "answer_id": 36566139, "question_id": 36566080, "link": "https://stackoverflow.com/questions/36566080/deepequal-treats-array-initialized-with-back-tick-differently/36566139#36566139", "title": "DeepEqual treats array initialized with back tick differently?", "body": "<p>Those are <a href=\"https://golang.org/ref/spec#Slice_types\">slices</a>, not <a href=\"https://golang.org/ref/spec#Array_types\">arrays</a>, and your first slice has 2 elements, and the second has 3 elements, so how could they be equal?</p>\n\n<p>Try printing them like this:</p>\n\n<pre><code>fmt.Printf(\"%d %q\\n\", len(x), x)\nfmt.Printf(\"%d %q\\n\", len(y), y)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>2 [\"hello world\" \"me\"]\n3 [\"hello\" \"world\" \"me\"]\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/fmt/#Println\"><code>fmt.Prinln()</code></a> will print all values of the passed slice, printing a space between elements. And first element of <code>x</code> is a string which equals to the first 2 elements of <code>y</code> joined with a space, that's why you see equal printed content for the slices.</p>\n\n<p>When you use the same 3 strings to initialize your first slice with backticks, they will be equal:</p>\n\n<pre><code>x = []string{`hello`, `world`, \"me\"}\ny = []string{\"hello\", \"world\", \"me\"}\nfmt.Printf(\"%d %q\\n\", len(x), x)\nfmt.Printf(\"%d %q\\n\", len(y), y)\nfmt.Println(reflect.DeepEqual(x, y))\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>3 [\"hello\" \"world\" \"me\"]\n3 [\"hello\" \"world\" \"me\"]\ntrue\n</code></pre>\n\n<p>Try these on the <kbd><a href=\"http://play.golang.org/p/b46ySGQHfc\">Go Playground</a></kbd>.</p>\n"}], "owner": {"reputation": 3680, "user_id": 1813875, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6078165a3f6a8693a0b1a1101e9260c7?s=128&d=identicon&r=PG", "display_name": "harryz", "link": "https://stackoverflow.com/users/1813875/harryz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 36566139, "answer_count": 1, "score": 0, "last_activity_date": 1460447309, "creation_date": 1460445143, "last_edit_date": 1460447309, "question_id": 36566080, "link": "https://stackoverflow.com/questions/36566080/deepequal-treats-array-initialized-with-back-tick-differently", "title": "DeepEqual treats array initialized with back tick differently?", "body": "<p>My question is quite simple, I use back tick to initiate a string array, but I found that golang treats this array differently: </p>\n\n<pre><code>import (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    x := []string{`hello world`, \"me\"}\n    y := []string{\"hello\", \"world\", \"me\"}\n    fmt.Println(x)\n    fmt.Println(y)\n    fmt.Println(reflect.DeepEqual(x, y))\n}\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>[hello world me]\n[hello world me]\nfalse\n</code></pre>\n\n<p>This makes me confused: should I make sure all string arrays are initiated in the same way?</p>\n"}, {"tags": ["json", "go", "unmarshalling", "google-cloud-datastore"], "answers": [{"comments": [{"owner": {"reputation": 762, "user_id": 766584, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Itlls.png?s=128&g=1", "display_name": "djneely", "link": "https://stackoverflow.com/users/766584/djneely"}, "edited": false, "score": 0, "creation_date": 1460461006, "post_id": 36565103, "comment_id": 60742626, "body": "Matt, thanks I do know that time.Time has an unmarshaljson method in and of itself. The issue is with handling different input types. That is I may receive a date/time string that i snot in RFC3339 format and thus need to parse it into time.Time. That is what I&#39;m doing here. However, I then need to get it back out of Timestamp and into time.Time to go into the datastore. In the above example the JSON coming in has a date of: 2016-03-31 16:49:48 +0000 which is erroring: panic : parsing time &quot;&quot;2016-03-31 16:49:48 +0000&quot;&quot; as &quot;&quot;2006-01-02T15:04:05Z07:00&quot;&quot;: cannot parse &quot; 16:49:48 +0000&quot;&quot; as &quot;T&quot;"}], "tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": false, "score": 0, "last_activity_date": 1460442351, "creation_date": 1460442351, "answer_id": 36565103, "question_id": 36563836, "link": "https://stackoverflow.com/questions/36563836/custom-time-time-type-back-into-datastore/36565103#36565103", "title": "Custom time.Time type back into datastore", "body": "<p>time.Time has an <a href=\"https://golang.org/pkg/time/#Time.UnmarshalJSON\" rel=\"nofollow\">UnmarshalJSON method</a> already.  It will unmarshal from a JSON string that is RFC3339 formatted to a time.Time.</p>\n\n<p>If you need it in a different string format after that, you can just use </p>\n\n<pre><code>(t *time.Time).Format(layout string)\n</code></pre>\n\n<p>with whatever formatting desired.</p>\n"}, {"comments": [{"owner": {"reputation": 4902, "user_id": 3682162, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/QslZH.png?s=128&g=1", "display_name": "Vikrant", "link": "https://stackoverflow.com/users/3682162/vikrant"}, "edited": false, "score": 0, "creation_date": 1525412016, "post_id": 50167678, "comment_id": 87353158, "body": "add some explanation to your link... the only link in an answer is not much help to others."}], "tags": [], "owner": {"reputation": 21, "user_id": 9739158, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Liam Lian", "link": "https://stackoverflow.com/users/9739158/liam-lian"}, "is_accepted": false, "score": 0, "last_activity_date": 1525412163, "last_edit_date": 1525412163, "creation_date": 1525411386, "answer_id": 50167678, "question_id": 36563836, "link": "https://stackoverflow.com/questions/36563836/custom-time-time-type-back-into-datastore/50167678#50167678", "title": "Custom time.Time type back into datastore", "body": "<p>If there are lots of struct and you just implement custom marshal und unmarshal functions, that's a lot of work to do so. You can use another lib instead\uff0csuch as a json-iterator extension <a href=\"https://github.com/liamylian/jsontime\" rel=\"nofollow noreferrer\">jsontime</a>:</p>\n\n<pre><code>import \"github.com/liamylian/jsontime\"\n\nvar json = jsontime.ConfigWithCustomTimeFormat\n\ntype Book struct {\n    Id        int           `json:\"id\"`\n    UpdatedAt *time.Time    `json:\"updated_at\" time_format:\"sql_date\" time_utc:\"true\"`\n    CreatedAt time.Time     `json:\"created_at\" time_format:\"sql_datetime\" time_location:\"UTC\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 762, "user_id": 766584, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Itlls.png?s=128&g=1", "display_name": "djneely", "link": "https://stackoverflow.com/users/766584/djneely"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1615, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1588327638, "creation_date": 1460436547, "last_edit_date": 1588327638, "question_id": 36563836, "link": "https://stackoverflow.com/questions/36563836/custom-time-time-type-back-into-datastore", "title": "Custom time.Time type back into datastore", "body": "<p>I've been working with various examples of custom time formats that come from a JSON POST to our Go API. I've got an overridden function of the UnmarshalJSON all seemingly working fine. However, when I go to save the struct into the datastore it is not being recognized as a time.Time value therefore not being set/saved. The 'toString' function is printing out the correct time I'd like to see in the datastore but can't figure out how to convert it or cast it to time.Time on datastore save. This is a simple logging API feature we're building out. See code below. </p>\n\n<p>I guess like the UnmarshalJSON that converts an arbitrary string to time.Time then to 'Timestamp' (in this case) is there then a Datastore equivalent for putting it back to time.Time before saving?</p>\n\n<p>Thank you for any help/guidance. I did have it such that a 'DateString' was a string value set via JSON when unmarshaling the 'AppLog' struck then I converted that to the 'Date' time.Time, but would like to be a little more 'slick' and utilized the UnmarshalJSON if possible.</p>\n\n<pre><code>package logger\n\nimport (\n    \"encoding/json\"\n    \"errors\"\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n\n    \"golang.org/x/net/context\"\n\n    \"google.golang.org/appengine\"\n    \"google.golang.org/appengine/datastore\"\n\n    \"github.com/gorilla/mux\"\n)\n\nfunc init() {\n    router := mux.NewRouter()\n\n    router.HandleFunc(\"/applogger\", DoLog).Methods(\"POST\")\n\n    http.Handle(\"/applogger/\", router)\n}\n\n// DoLog --\nfunc DoLog(rw http.ResponseWriter, request *http.Request) {\n    var applog AppLog\n\n    body, err := ioutil.ReadAll(io.LimitReader(request.Body, 1048576))\n\n    if err != nil {\n        panic(err)\n    }\n\n    if err := request.Body.Close(); err != nil {\n        panic(err)\n    }\n\n    if err := json.Unmarshal(body, &amp;applog); err != nil {\n        panic(err)\n    }\n\n    applog.IP = request.RemoteAddr\n\n    log.Print(\"my timestamp\", applog.Date)\n\n    ctx := appengine.NewContext(request)\n    applog.Save(ctx)\n\n    fmt.Fprint(rw, \"applogger - success\")\n}\n\n// AppLog struct\ntype AppLog struct {\n    Application string    `json:\"application\" datastore:\"application\"`\n    Platform    string    `json:\"platform\" datastore:\"platform,noindex\"`\n    Date        Timestamp `json:\"date\" datastore:\"date\"`\n    Data        string    `json:\"data\" datastore:\"data,noindex\"`\n    IP          string    `json:\"-\" datastore:\"ip,noindex\"`\n}\n\n// Save --\nfunc (al *AppLog) Save(ctx context.Context) *datastore.Key {\n\n    key := datastore.NewKey(ctx, \"AppLog\", \"\", 0, nil)\n\n    if _, err := datastore.Put(ctx, key, al); err != nil {\n        return nil\n    }\n\n    return key\n}\n\n// Timestamp -- Generic Timestamp entity to handle different generic date formats\ntype Timestamp time.Time\n\nconst TimestampDateLayout1 = \"2006-01-02 15:04:05 +0000\"\n\nfunc (t *Timestamp) UnmarshalJSON(b []byte) error {\n    ts, err := time.Parse(TimestampDateLayout1, string(b[1:len(b)-1]))\n    if err == nil {\n        log.Print(\"ts \", ts)\n        *t = Timestamp(ts)\n        log.Print(\"t \", t)\n        return nil\n    }\n\n    *t = Timestamp(time.Now())\n    return nil\n}\n\nfunc (t Timestamp) String() string {\n    return time.Time(t).String()\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1847, "user_id": 391464, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1XdRz.png?s=128&g=1", "display_name": "yee", "link": "https://stackoverflow.com/users/391464/yee"}, "is_accepted": false, "score": 0, "last_activity_date": 1460439248, "last_edit_date": 1460439248, "creation_date": 1460438357, "answer_id": 36564175, "question_id": 36563805, "link": "https://stackoverflow.com/questions/36563805/golang-html-charset-decoding/36564175#36564175", "title": "golang HTML charset decoding", "body": "<p><a href=\"https://github.com/PuerkitoBio/goquery\" rel=\"nofollow\">goquery</a> may meet your needs. e.g.:</p>\n\n<pre><code>import \"https://github.com/PuerkitoBio/goquery\"\n\nfunc main() {\n    d, err := goquery.NewDocument(\"http://www.google.com\")\n    dh := d.Find(\"head\")\n    dc := dh.Find(\"meta[http-equiv]\")\n    c, err := dc.Attr(\"content\") // get charset\n    // ...\n}\n</code></pre>\n\n<p>more operations can be found with the <a href=\"https://github.com/PuerkitoBio/goquery/blob/4126223a86db8598275b29db04d511cfdab67cf1/type.go#L17\" rel=\"nofollow\">Document</a> struct.</p>\n"}, {"tags": [], "owner": {"reputation": 1143, "user_id": 370213, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/PH4vL.jpg?s=128&g=1", "display_name": "zhengchun", "link": "https://stackoverflow.com/users/370213/zhengchun"}, "is_accepted": false, "score": 2, "last_activity_date": 1501682508, "last_edit_date": 1501682508, "creation_date": 1477361547, "answer_id": 40230300, "question_id": 36563805, "link": "https://stackoverflow.com/questions/36563805/golang-html-charset-decoding/40230300#40230300", "title": "golang HTML charset decoding", "body": "<p>Golang officially provides the extension packages: <a href=\"https://godoc.org/golang.org/x/net/html/charset\" rel=\"nofollow noreferrer\">charset</a> and <a href=\"https://godoc.org/golang.org/x/text/encoding/htmlindex\" rel=\"nofollow noreferrer\">encoding</a>.</p>\n\n<p>The code below makes sure the document can be parsed correctly by the HTML package:</p>\n\n<pre><code>func detectContentCharset(body io.Reader) string {\n    r := bufio.NewReader(body)\n    if data, err := r.Peek(1024); err == nil {\n        if _, name, ok := charset.DetermineEncoding(data, \"\"); ok {\n            return name\n        }\n    }\n    return \"utf-8\"\n}\n\n// Decode parses the HTML body on the specified encoding and\n// returns the HTML Document.\nfunc Decode(body io.Reader, charset string) (interface{}, error) {\n    if charset == \"\" {\n        charset = detectContentCharset(body)\n    }\n    e, err := htmlindex.Get(charset)\n    if err != nil {\n        return nil, err\n    }\n\n    if name, _ := htmlindex.Name(e); name != \"utf-8\" {\n        body = e.NewDecoder().Reader(body)\n    }\n\n    node, err := html.Parse(body)\n    if err != nil {\n        return nil, err\n    }\n    return node, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 19241, "user_id": 614944, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/f92772ec8a16758d669026f736aa7f0f?s=128&d=identicon&r=PG", "display_name": "daisy", "link": "https://stackoverflow.com/users/614944/daisy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2940, "favorite_count": 2, "answer_count": 2, "score": 2, "last_activity_date": 1501682508, "creation_date": 1460436367, "question_id": 36563805, "link": "https://stackoverflow.com/questions/36563805/golang-html-charset-decoding", "title": "golang HTML charset decoding", "body": "<p>I'm trying to decode HTML pages that are <em>NOT</em> utf-8 encoded.</p>\n\n<pre><code>&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=gb2312\"&gt;\n</code></pre>\n\n<p>Is there any library that can do that? I couldn't find one online.</p>\n\n<p>P.S Of course, I can extract charset and decode the HTML page with goquery and iconv-go, but I'm trying not to re-invent the wheels.</p>\n"}, {"tags": ["go", "channels"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 2, "creation_date": 1460433759, "post_id": 36563396, "comment_id": 60727005, "body": "you only receive from the channel once, so..."}, {"owner": {"reputation": 29, "user_id": 1091381, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3cb595276fc7dc5b22ca09ec279b3a4?s=128&d=identicon&r=PG", "display_name": "pjonesdotca", "link": "https://stackoverflow.com/users/1091381/pjonesdotca"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1460433922, "post_id": 36563396, "comment_id": 60727057, "body": "#facepalm Thanks hobbs!"}], "answers": [{"tags": [], "owner": {"reputation": 99, "user_id": 852329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11bcadf15046a199c661894f9c35680b?s=128&d=identicon&r=PG", "display_name": "lafolle", "link": "https://stackoverflow.com/users/852329/lafolle"}, "is_accepted": false, "score": 3, "last_activity_date": 1460435899, "creation_date": 1460435899, "answer_id": 36563718, "question_id": 36563396, "link": "https://stackoverflow.com/questions/36563396/how-to-populate-an-array-with-channels-in-go/36563718#36563718", "title": "How to populate an array with channels in go", "body": "<p>You need to read <em>continuously</em> from channel, as data is being written into it. And when you're done pumping data into channel, close it. Here is how it can work.  </p>\n\n<p>Note: AddToMap is not being called as independent goroutine. It can be done using waitgroup, because we need to know when we need to close channel <em>c</em>, which will be after all <em>AddToMap</em> have been run.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc AddToMap(thing string, val string, c chan map[string]string) {\n    mappy := make(map[string]string)\n    mappy[thing] = val\n    c &lt;- mappy\n}\n\nfunc main() {\n    item := make([]map[string]string, 0, 10)\n    list1 := []string{\"foo\", \"bar\", \"baz\", \"blah\", \"barf\"}\n    list2 := []string{\"one\", \"two\", \"three\", \"four\", \"five\"}\n    c := make(chan map[string]string)\n    go func(){\n        for index, val := range list1 {\n            AddToMap(val, list2[index], c)\n        }\n        close(c)\n    }()\n    for ret := range c {\n        item = append(item, ret)\n    }\n    fmt.Println(item)\n}\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 1091381, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3cb595276fc7dc5b22ca09ec279b3a4?s=128&d=identicon&r=PG", "display_name": "pjonesdotca", "link": "https://stackoverflow.com/users/1091381/pjonesdotca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2312, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1460435899, "creation_date": 1460433596, "question_id": 36563396, "link": "https://stackoverflow.com/questions/36563396/how-to-populate-an-array-with-channels-in-go", "title": "How to populate an array with channels in go", "body": "<p>I am trying to build an array with go channels. I do not care about insertion order however I only receive the last item from the channel.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc AddToMap(thing string, val string, c chan map[string]string) {\n    mappy := make(map[string]string)\n    mappy[thing] = val\n    c &lt;- mappy\n}\n\nfunc main() {\n    item := make([]map[string]string, 0, 10)\n    list1 := []string{\"foo\", \"bar\", \"baz\", \"blah\", \"barf\"}\n    list2 := []string{\"one\", \"two\", \"three\", \"four\", \"five\"}\n    c := make(chan map[string]string)\n    for index, val := range list1 {\n    go AddToMap(val, list2[index], c)\n}\n    ret := &lt;-c\n    item = append(item, ret)\n    fmt.Println(item)\n}\n</code></pre>\n\n<p>My output is: [map[barf:five]]</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "edited": false, "score": 0, "creation_date": 1460421846, "post_id": 36561638, "comment_id": 60723757, "body": "it would <i>very unsafe</i> to be able to install binaries without specifying what they are.  I think being explicit when installing binaries is a good trade off between ease of use and safety."}, {"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 2, "creation_date": 1460424593, "post_id": 36561638, "comment_id": 60724534, "body": "Yes, <code>go install -v -u  .&#47;...</code> is the command.  You say that&#39;s not happening.  can u update the question with what <i>is</i> happening?"}, {"owner": {"reputation": 11871, "user_id": 373522, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0235f7d6e9cef30c7337506e067ed35?s=128&d=identicon&r=PG", "display_name": "gylaz", "link": "https://stackoverflow.com/users/373522/gylaz"}, "edited": false, "score": 0, "creation_date": 1460439253, "post_id": 36561638, "comment_id": 60728691, "body": "I&#39;ve updated the description (only the main package is built and added to <code>$GOPATH&#47;bin</code>. <code>-u</code> doesn&#39;t seem to be a valid <code>go install</code> flag (are you thinking of <code>go get</code>?)."}], "answers": [{"tags": [], "owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "is_accepted": true, "score": 1, "last_activity_date": 1460650575, "last_edit_date": 1460650575, "creation_date": 1460461737, "answer_id": 36572431, "question_id": 36561638, "link": "https://stackoverflow.com/questions/36561638/how-to-install-binaries-of-dependencies/36572431#36572431", "title": "How to install binaries of dependencies?", "body": "<p>Are you asking for a way to install the binaries you want to call, from your local machine, automatically from a <code>go install ./...</code> of your code?</p>\n\n<p>That isn't going to happen with straight up Go, unless they are listed in the same username or pattern you can type in a single go install command.  But just the two listed above are different enough that that can't happen.</p>\n\n<p>Option 1) Either state to your users to call <code>go install</code> for each Dependency (this is very common).</p>\n\n<p>Option 2) Or, create a bash/batch file to run them with a simple <code>install.sh</code> command in your repo.  Which, would call <code>go install</code> for all of your dependencies.  Another more UNIX/C like approach would be to create a <code>Makefile</code>, and tell your users to run <code>make</code></p>\n\n<p>Personally, I prefer option 2 as it gives you very complex control over your service or utility.  You can start simple; but, later on add tests, <code>go generate</code> commands and whatever else you like in the future - all without having to change your installation instructions <code>just run 'make install' and it will handle it</code>.  It also helps with C.I. servers that you can have a <code>make test</code> or anything to your hearts desire; but, different enough that normal users would usually run it.  All, within a single <code>Makefile</code> that you can change later.</p>\n\n<p>I think my Updater script has like 25 <code>go get -u -v</code> commands.</p>\n"}], "owner": {"reputation": 11871, "user_id": 373522, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c0235f7d6e9cef30c7337506e067ed35?s=128&d=identicon&r=PG", "display_name": "gylaz", "link": "https://stackoverflow.com/users/373522/gylaz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 572, "favorite_count": 0, "accepted_answer_id": 36572431, "answer_count": 1, "score": 2, "last_activity_date": 1460650575, "creation_date": 1460421278, "last_edit_date": 1460439194, "question_id": 36561638, "link": "https://stackoverflow.com/questions/36561638/how-to-install-binaries-of-dependencies", "title": "How to install binaries of dependencies?", "body": "<p>My Golang project depends on a few packages (i.e. <a href=\"https://github.com/mattes/migrate\" rel=\"nofollow\">https://github.com/mattes/migrate</a> and <a href=\"https://github.com/joho/godotenv\" rel=\"nofollow\">https://github.com/joho/godotenv</a>). I know I can <code>go get</code> or <code>go install</code> them separately, but is there a way to install all of the dependencies of a project in one shot? Ideally, I would expect <code>go install ./...</code> to put the <code>migrate</code> and <code>godotenv</code> binaries in my <code>$GOPATH/bin</code>, but it only installs the main package binary and not the binaries of the dependencies.</p>\n"}, {"tags": ["networking", "go", "connection"], "answers": [{"comments": [{"owner": {"reputation": 253, "user_id": 5719160, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/abd92cbc314012f263ee283c0fe8f323?s=128&d=identicon&r=PG&f=1", "display_name": "Kim Byer", "link": "https://stackoverflow.com/users/5719160/kim-byer"}, "edited": false, "score": 0, "creation_date": 1460399231, "post_id": 36556298, "comment_id": 60713170, "body": "Is it okay to say that the value of the SetWriteDeadline should be the same as the frequency at which the application is sending a PING FRAME (in terms of ws protocol)?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 253, "user_id": 5719160, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/abd92cbc314012f263ee283c0fe8f323?s=128&d=identicon&r=PG&f=1", "display_name": "Kim Byer", "link": "https://stackoverflow.com/users/5719160/kim-byer"}, "edited": false, "score": 0, "creation_date": 1460399622, "post_id": 36556298, "comment_id": 60713411, "body": "The write deadline specifies when you expect write operation to complete. This time is unrelated to the how often the application sends a ping."}, {"owner": {"reputation": 253, "user_id": 5719160, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/abd92cbc314012f263ee283c0fe8f323?s=128&d=identicon&r=PG&f=1", "display_name": "Kim Byer", "link": "https://stackoverflow.com/users/5719160/kim-byer"}, "edited": false, "score": 0, "creation_date": 1460400165, "post_id": 36556298, "comment_id": 60713763, "body": "Understood. Well Mr.Kake, thanks for your help and time!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1460399305, "last_edit_date": 1460399305, "creation_date": 1460398869, "answer_id": 36556298, "question_id": 36556122, "link": "https://stackoverflow.com/questions/36556122/what-are-the-uses-of-setwritedeadline/36556298#36556298", "title": "What are the uses of SetWriteDeadline", "body": "<p><a href=\"https://godoc.org/net#Conn.Write\" rel=\"nofollow\">Write to a connection</a> returns an error when the write operation does not complete by <a href=\"https://godoc.org/net#Conn.SetWriteDeadline\" rel=\"nofollow\">the last set deadline</a>.</p>\n\n<p>The typical use of a write deadline is to detect a peer that is not reading data or is not reading data at an acceptable rate.</p>\n\n<p>A robust application will set both read and write deadlines (but usually not to the same value).</p>\n"}, {"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 0, "last_activity_date": 1541967197, "creation_date": 1541967197, "answer_id": 53252780, "question_id": 36556122, "link": "https://stackoverflow.com/questions/36556122/what-are-the-uses-of-setwritedeadline/53252780#53252780", "title": "What are the uses of SetWriteDeadline", "body": "<blockquote>\n  <p>A robust application will set both read and write deadlines</p>\n</blockquote>\n\n<p>But preferable with Go 1.12 (Q1 2019).<br>\nSee <a href=\"https://github.com/golang/go/issues/25729\" rel=\"nofollow noreferrer\">golang/go issue 25729</a>: <code>net: SetDeadline</code> performance is poor</p>\n\n<p>That has recently been fixed:</p>\n\n<blockquote>\n  <p>Both the improvements in throughput and latency are far less affected by -cpu values. Nice job!</p>\n</blockquote>\n"}], "owner": {"reputation": 253, "user_id": 5719160, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/abd92cbc314012f263ee283c0fe8f323?s=128&d=identicon&r=PG&f=1", "display_name": "Kim Byer", "link": "https://stackoverflow.com/users/5719160/kim-byer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 896, "favorite_count": 1, "accepted_answer_id": 36556298, "answer_count": 2, "score": 3, "last_activity_date": 1541967197, "creation_date": 1460398322, "question_id": 36556122, "link": "https://stackoverflow.com/questions/36556122/what-are-the-uses-of-setwritedeadline", "title": "What are the uses of SetWriteDeadline", "body": "<p>Can someone please give me a few scenarios where I might use <a href=\"https://golang.org/pkg/net/#IPConn.SetWriteDeadline\" rel=\"nofollow\">SetWriteDeadline</a>? I know that <a href=\"https://golang.org/pkg/net/#IPConn.SetReadDeadline\" rel=\"nofollow\">SetReadDeadline</a> helps a developer to determine whether the connected endpoint is still reachable or not (with the help of PING/PONG frames), but I can't figure out why I might use SetWriteDeadline.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 842, "user_id": 1198986, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6af477723fb832487f84973e990d2466?s=128&d=identicon&r=PG", "display_name": "libertylocked", "link": "https://stackoverflow.com/users/1198986/libertylocked"}, "edited": false, "score": 2, "creation_date": 1460396425, "post_id": 36555352, "comment_id": 60711465, "body": "Because int is a named type and array is an unnamed type. See <a href=\"http://stackoverflow.com/questions/19334542/why-can-i-type-alias-functions-and-use-them-without-casting\" title=\"why can i type alias functions and use them without casting\">stackoverflow.com/questions/19334542/&hellip;</a>"}, {"owner": {"reputation": 6881, "user_id": 1052922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4bf2f8cc6f4dc4dac32fdd12702134e6?s=128&d=identicon&r=PG", "display_name": "woodings", "link": "https://stackoverflow.com/users/1052922/woodings"}, "reply_to_user": {"reputation": 842, "user_id": 1198986, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6af477723fb832487f84973e990d2466?s=128&d=identicon&r=PG", "display_name": "libertylocked", "link": "https://stackoverflow.com/users/1198986/libertylocked"}, "edited": false, "score": 0, "creation_date": 1460397254, "post_id": 36555352, "comment_id": 60711973, "body": "@LibertyLocked Is int64 a named type? what&#39;s the actual type behind it?"}, {"owner": {"reputation": 842, "user_id": 1198986, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6af477723fb832487f84973e990d2466?s=128&d=identicon&r=PG", "display_name": "libertylocked", "link": "https://stackoverflow.com/users/1198986/libertylocked"}, "edited": false, "score": 0, "creation_date": 1460397370, "post_id": 36555352, "comment_id": 60712027, "body": "byte array is a composed from an existing type, <code>byte</code>, while <code>byte</code> itself is a type literal, not composed from any existing type"}], "answers": [{"tags": [], "owner": {"reputation": 842, "user_id": 1198986, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6af477723fb832487f84973e990d2466?s=128&d=identicon&r=PG", "display_name": "libertylocked", "link": "https://stackoverflow.com/users/1198986/libertylocked"}, "is_accepted": true, "score": 4, "last_activity_date": 1460397188, "last_edit_date": 1495541260, "creation_date": 1460397188, "answer_id": 36555771, "question_id": 36555352, "link": "https://stackoverflow.com/questions/36555352/why-does-golang-allow-named-slice-type-assignment-without-explicit-type-conversi/36555771#36555771", "title": "Why does golang allow named slice type assignment without explicit type conversion?", "body": "<p><code>int64</code> is a named type, <code>[]byte</code> is an unamed type.</p>\n\n<blockquote>\n  <p>Named types are specified by a (possibly qualified) type name; unnamed types are specified using a type literal, which composes a new type from existing types - <a href=\"https://golang.org/ref/spec#Types\" rel=\"nofollow noreferrer\">golang spec</a></p>\n</blockquote>\n\n<p>Also</p>\n\n<blockquote>\n  <p>Two named types are identical if their type names originate in the same TypeSpec. A named and an unnamed type are always different. Two unnamed types are identical if the corresponding type literals are identical, that is, if they have the same literal structure and corresponding components have identical types. - <a href=\"https://golang.org/ref/spec#Type_identity\" rel=\"nofollow noreferrer\">golang spec</a></p>\n</blockquote>\n\n<p>Therefore</p>\n\n<pre><code>type MyByteArray []byte\ntype MyInt int\n\nvar a MyByteArray\nvar b []byte\na = b // legal because array is unnamed - their corresponding type literals are identical\n\nvar x MyInt\nvar y int\nx = y // illegal because int is named - they don't originate in the same type spec\n</code></pre>\n\n<p>Also see <a href=\"https://stackoverflow.com/questions/19334542/why-can-i-type-alias-functions-and-use-them-without-casting\">Why can I type alias functions and use them without casting?</a></p>\n"}], "owner": {"reputation": 6881, "user_id": 1052922, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4bf2f8cc6f4dc4dac32fdd12702134e6?s=128&d=identicon&r=PG", "display_name": "woodings", "link": "https://stackoverflow.com/users/1052922/woodings"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 533, "favorite_count": 0, "accepted_answer_id": 36555771, "answer_count": 1, "score": 5, "last_activity_date": 1460419277, "creation_date": 1460395789, "last_edit_date": 1460419277, "question_id": 36555352, "link": "https://stackoverflow.com/questions/36555352/why-does-golang-allow-named-slice-type-assignment-without-explicit-type-conversi", "title": "Why does golang allow named slice type assignment without explicit type conversion?", "body": "<p>I thought go didn't allow any named type to actual type assignment without explicit type conversion. </p>\n\n<p>But how does it compile without an error if I assign <code>[]byte</code> to <code>json.RawMessage</code>?</p>\n\n<pre><code>var a json.RawMessage // type RawMessage []byte\nvar b []byte\n\na = b\n\nvar x time.Duration // type Duration int64\nvar y int64\n\nx = y // ERROR: cannot use y (type int64) as type time.Duration in assignment\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/oD5LwJl7an\" rel=\"nofollow\">https://play.golang.org/p/oD5LwJl7an</a></p>\n"}, {"tags": ["go", "struct", "interface"], "answers": [{"tags": [], "owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "is_accepted": false, "score": 0, "last_activity_date": 1460392109, "last_edit_date": 1460392109, "creation_date": 1460391806, "answer_id": 36554173, "question_id": 36554127, "link": "https://stackoverflow.com/questions/36554127/how-can-i-access-the-fields-of-an-interface-in-go/36554173#36554173", "title": "How can I access the fields of an interface in Go?", "body": "<p>You will need to know the type. Let's say we know it's a CEvent:</p>\n\n<pre><code>cEvent, ok := Event.(CEvent)\nif !ok {\n    // You lied, not a CEvent\n    return\n}\n\n// Otherwise, you can get the type!\nfmt.Println(cEvent.Type)\n</code></pre>\n\n<p>Of course if you <em>don't</em> know the type, you can keep type asserting until you get it right. Otherwise, throw an error, return a default value, etc:</p>\n\n<pre><code>func getType(i interface{}) uint32 {\n    cEvent, ok := i.(CEvent)\n    if ok {\n        return cEvent.Type\n    }\n\n    commonEvent, ok := i.(CommonEvent)\n    if ok {\n        return commonEvent.Type\n    }\n\n    // Etc\n\n    return &lt;default&gt;\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1460392458, "post_id": 36554302, "comment_id": 60709068, "body": "I&#39;m fairly new to go, but I don&#39;t know that this way is possible? <a href=\"http://play.golang.org/p/2cxLDoabfs\" rel=\"nofollow noreferrer\">play.golang.org/p/2cxLDoabfs</a>"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 1, "creation_date": 1460392659, "post_id": 36554302, "comment_id": 60709190, "body": "@william.taylor.09 it works fine, your example correctly produces &#39;unknown&#39; because you&#39;re passing a <code>*WindowEvent</code> - which is not the same type as a <code>WindowEvent</code> and there is no case for it. Here&#39;s a modified example that does what you&#39;d expect; <a href=\"http://play.golang.org/p/ZEkf3tKI53\" rel=\"nofollow noreferrer\">play.golang.org/p/ZEkf3tKI53</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3835277"}, "edited": false, "score": 0, "creation_date": 1460395791, "post_id": 36554302, "comment_id": 60711090, "body": "This seems to work, but I&#39;m getting really annoying <code>variable declared but not used</code> error at compile time if I don&#39;t use <code>v</code>. I don&#39;t want to use <code>v</code> aside from each <code>case SomeEvent:</code> line. Is there anyway to get around having to using it?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1460396124, "post_id": 36554302, "comment_id": 60711295, "body": "@gragas I&#39;d have to see the rest of your code but my guess would be that you&#39;re declaring <code>v</code> above the switch, rather than making declaration and assignment part of switch statement like in the example above. If <code>v</code> is declared in the switch statement like in the example above then it&#39;s scope is limited to the switch statement so you shouldn&#39;t have to use it anywhere but in the case statements."}, {"owner": {"user_type": "does_not_exist", "display_name": "user3835277"}, "edited": false, "score": 0, "creation_date": 1460397010, "post_id": 36554302, "comment_id": 60711847, "body": "@evanmcdonnal I&#39;m running essentially your example, except I don&#39;t use <code>v</code> inside any of the cases. Because once I know the type of the event, I don&#39;t need to use it. Could this be a golang bug? Here&#39;s a gist of my code that causes this problem: <a href=\"https://gist.github.com/gragas/696a16cbc6bd2cee201d82f75c12fbb6\" rel=\"nofollow noreferrer\">gist.github.com/gragas/696a16cbc6bd2cee201d82f75c12fbb6</a>"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1460397727, "post_id": 36554302, "comment_id": 60712243, "body": "@gragas ah I see. Nah, you just write the switch without any assignment. Since there is a variable declared in that example, it must be used in order to be valid Go. But, if you just care to know the type of the variable and don&#39;t actually need to do anything with it then you can write it like this; <a href=\"http://play.golang.org/p/RaClQUWn-O\" rel=\"nofollow noreferrer\">play.golang.org/p/RaClQUWn-O</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3835277"}, "edited": false, "score": 0, "creation_date": 1460399073, "post_id": 36554302, "comment_id": 60713072, "body": "@evanmcdonnal Ah that makes sense."}, {"owner": {"user_type": "does_not_exist", "display_name": "user3835277"}, "edited": false, "score": 0, "creation_date": 1460399505, "post_id": 36554302, "comment_id": 60713336, "body": "@evanmcdonnal This still does not allow me to access the field <code>Type</code>. I don&#39;t really care about the <code>type</code> of the object in Golang. I just want to know the value of the first field (which happens to have the name <code>Type</code>)."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1460401500, "post_id": 36554302, "comment_id": 60714583, "body": "@gragas you have to assign <code>v</code> in order to access fields on that type. Look at my first example in the comments (<a href=\"http://play.golang.org/p/ZEkf3tKI53\" rel=\"nofollow noreferrer\">play.golang.org/p/ZEkf3tKI53</a>) it prints the value of <code>v.Type</code>."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 3, "last_activity_date": 1460392198, "creation_date": 1460392198, "answer_id": 36554302, "question_id": 36554127, "link": "https://stackoverflow.com/questions/36554127/how-can-i-access-the-fields-of-an-interface-in-go/36554302#36554302", "title": "How can I access the fields of an interface in Go?", "body": "<p>You actually can't. Interfaces only define a method set that is available on a type, they do nothing to expose fields. In your case I would recommend doing a type switch. It would look a little like this;</p>\n\n<pre><code>     switch v := myInstance.(type) {\n                case CEvent:\n                        fmt.Println(v)\n                case CommonEvent:\n                        fmt.Println(v)\n                case WindowEvent:\n                        fmt.Println(v)\n                default:\n                        fmt.Println(\"unknown\")\n        }\n</code></pre>\n\n<p>You may want to structure your code a bit differently depending on what you're doing with the instance after this but that gives you the basic idea. You can also do a type assertion with a single type like; <code>v, err := myInstance.(CommonEvent)</code> but I doubt it would be as effective here. It also returns an error if the type of <code>myInstance</code> is not <code>CommonEvent</code> so it's not really the best way to go about figuring out what type and interface instance may be.</p>\n"}, {"tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": false, "score": 0, "last_activity_date": 1460392880, "creation_date": 1460392880, "answer_id": 36554501, "question_id": 36554127, "link": "https://stackoverflow.com/questions/36554127/how-can-i-access-the-fields-of-an-interface-in-go/36554501#36554501", "title": "How can I access the fields of an interface in Go?", "body": "<p>You can spend a lot of time doing reflection calls or trying to guess the type or using type switches.</p>\n\n<p>Or you can just define an interface with functions that return the information you need.</p>\n\n<p>For example you could do</p>\n\n<pre><code>type Event interface {\n    GetCommonEvent() *CommonEvent\n    GetWindowEvent() *WindowEvent\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user3835277"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2892, "favorite_count": 0, "accepted_answer_id": 36554302, "answer_count": 3, "score": 0, "last_activity_date": 1460400382, "creation_date": 1460391654, "last_edit_date": 1460400382, "question_id": 36554127, "link": "https://stackoverflow.com/questions/36554127/how-can-i-access-the-fields-of-an-interface-in-go", "title": "How can I access the fields of an interface in Go?", "body": "<p>I'm trying to do this:</p>\n\n<pre><code>if event.Type == sdl.QUIT {\n    utils.Running = false\n}\n</code></pre>\n\n<p>But I can't because when I try to build, I get this error:</p>\n\n<pre><code> ./mm.go:11: event.Type undefined (type sdl.Event has no field or method Type)\n</code></pre>\n\n<p>Here is the relevant source code of the library I'm trying to use:</p>\n\n<pre><code>type Event interface{}    \n\ntype CEvent struct {\n    Type uint32\n    _    [52]byte // padding\n}\n\ntype CommonEvent struct {\n    Type      uint32\n    Timestamp uint32\n}\n\n// WindowEvent (https://wiki.libsdl.org/SDL_WindowEvent)\ntype WindowEvent struct {\n    Type      uint32\n    Timestamp uint32\n    WindowID  uint32\n    Event     uint8\n    _         uint8 // padding\n    _         uint8 // padding\n    _         uint8 // padding\n    Data1     int32\n    Data2     int32\n}\n</code></pre>\n\n<p>As you can see, all of the other Events have the field <code>Type</code>. How can I access this?</p>\n\n<h1>Solution</h1>\n\n<p>This how I ended up polling events in <a href=\"https://github.com/veandco/go-sdl2/\" rel=\"nofollow\">this SDL2 binding for Go</a>, in case anyone is wondering:</p>\n\n<pre><code>func PollEvents() {\n    for {\n        if event := sdl.PollEvent(); event != nil {\n            switch event.(type) {\n            case *sdl.QuitEvent:\n                utils.Running = false\n            }\n        } else {\n            break\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1460422579, "post_id": 36553953, "comment_id": 60723964, "body": "Hmm. That&#39;s more of a workaround than a solution. You&#39;d still have to define all of the possible properties and their types in advance in a single struct, no?"}], "tags": [], "owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "is_accepted": false, "score": 1, "last_activity_date": 1460391179, "creation_date": 1460391179, "answer_id": 36553953, "question_id": 36553742, "link": "https://stackoverflow.com/questions/36553742/returning-json-structs-of-different-types-dynamically/36553953#36553953", "title": "Returning JSON structs of different types, dynamically?", "body": "<p>To solve your json issue, you could use one struct and tag each field with json:\"omitempty\":</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype foostruct struct {\n    Myfoo   string `json:\"myfoo,omitempty\"`\n    Yourfoo string `json:\"yourfoo,omitempty\"`\n    Ourfoo string `json:\"ourfoo,omitempty\"`\n}\n\nfunc main() {\n    j := []byte(\"{\\\"myfoo\\\":\\\"mine\\\", \\\"yourfoo\\\":\\\"yours\\\"}\")\n    fstruct := &amp;foostruct{}\n    err := json.Unmarshal(j, fstruct)\n    if err != nil {\n        panic(err)\n    }\n\n    b, err := json.Marshal(fstruct)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(string(b))\n}\n</code></pre>\n\n<p>You'll see the the output does not contain the field \"ourfoo\":</p>\n\n<pre><code>{\"myfoo\":\"mine\",\"yourfoo\":\"yours\"}\n</code></pre>\n\n<p>Try it out here:\n<a href=\"http://play.golang.org/p/zKwFaxbLJu\" rel=\"nofollow\">http://play.golang.org/p/zKwFaxbLJu</a></p>\n"}, {"comments": [{"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1460460322, "post_id": 36563335, "comment_id": 60742110, "body": "So, is there a clean way to recurse over an object&#39;s own hierarchy or through its children to create a mapped tree? Or are you relying on abstract strings instead of struct var names that the compiler can catch errors in?"}, {"owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "reply_to_user": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1460463086, "post_id": 36563335, "comment_id": 60744263, "body": "Do you means recurse to each field on the struct? Yes, it possible using reflect. Sorry, actually I don&#39;t really understand what do you want to achieve? And something you need to keep away is the object oriented thingy on Golang, it will not fit to Golang, you have to play on the interface"}], "tags": [], "owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "is_accepted": false, "score": 0, "last_activity_date": 1460434124, "last_edit_date": 1460434124, "creation_date": 1460433241, "answer_id": 36563335, "question_id": 36553742, "link": "https://stackoverflow.com/questions/36553742/returning-json-structs-of-different-types-dynamically/36563335#36563335", "title": "Returning JSON structs of different types, dynamically?", "body": "<p>I use map instead of struct on my application, especially when I want to return back a json answer to client. Its give me more flexibility. Please take a look this :</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    m := make(map[string]interface{})\n    m[\"appVersion\"] = \"0.0.1\"\n    m[\"uploadStatus\"] = \"success\"\n\n    strJson, _ := json.Marshal(m)\n    str := string(strJson)\n    fmt.Println(\"---ENCODING--\")\n    fmt.Println(str)\n\n    //put it back\n    fmt.Println(\"---DECODING--\")\n    n := make(map[string]interface{})\n    json.Unmarshal([]byte(str), &amp;n)\n    for key, val := range n {\n        fmt.Println(key, \":\", val)\n    }\n}\n</code></pre>\n\n<p>and the output is :</p>\n\n<pre><code>---ENCODING--\n{\"appVersion\":\"0.0.1\",\"uploadStatus\":\"success\"}\n---DECODING--\nappVersion : 0.0.1\nuploadStatus : success\n</code></pre>\n\n<p>You can check here : <a href=\"http://play.golang.org/p/h4b4-nkZ4M\" rel=\"nofollow\">http://play.golang.org/p/h4b4-nkZ4M</a></p>\n"}], "owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1460434124, "creation_date": 1460390610, "last_edit_date": 1460422538, "question_id": 36553742, "link": "https://stackoverflow.com/questions/36553742/returning-json-structs-of-different-types-dynamically", "title": "Returning JSON structs of different types, dynamically?", "body": "<p>I'm playing around with Go and having trouble adapting some of my \"inheriting\" designs from other languages to its structure. I've coded in OCaml and some other languages bearing a similar structure, but I'm confused. Without type inheritance it becomes a bit strange to return JSON from different places using shared structures.</p>\n\n<p>I have to iterate <strong>recursively</strong> through input data as needed to build a single JSON object to respond with.</p>\n\n<p>Take for instance:</p>\n\n<pre><code>{\n    \"appVersion\": \"1.0.0\",\n    \"messageStatus\": \"received\"\n}\n</code></pre>\n\n<p>... and:</p>\n\n<pre><code>{\n    \"appVersion\": \"1.0.0\",\n    \"uploadStatus\": \"received\"\n}\n</code></pre>\n\n<p>The only way I can find to make this work in Go so far is to copy and paste the base structure that includes \"appVersion\" into the two output generating functions separately, but I don't want to do that because I don't want to have to maintain the same set of code twice.</p>\n\n<p>Here's where I'm stuck trying to fix that:</p>\n\n<pre><code>type JSONResponse struct {\n    appVersion string\n}\ntype MessageJSONResponse struct {\n    JSONResponse\n    messageStatus string\n}\ntype UploadJSONResponse struct {\n    JSONResponse\n    uploadStatus string\n}\n</code></pre>\n\n<p>... Then:</p>\n\n<pre><code>type Message struct {\n    formattingVersion *int\n\n}\n\nfunc NewMessageObject(r *http.Request) (bool, *MessageJSONResponse) {\n    message := new(Message)\n\n    if (true) {\n        // #TODO: INSERT LOGIC HERE!\n        *message.formattingVersion = 2;\n\n    }\n\n    if (message.formattingVersion != nil) {\n        response := new(MessageJSONResponse)\n        response.messageStatus = \"OK\"\n\n        return false, errorResponse\n\n    }\n\n    return true, nil\n\n}\n</code></pre>\n\n<p>... And:</p>\n\n<pre><code>func init() {\n    http.Handle(\"/endpoints/message\", JSONResponseHandler(messageHandler))\n\n}\n\nfunc JSONResponseHandler(h func (w http.ResponseWriter, r *http.Request) interface {}) http.Handler {\n\n// #TODO - convert `JSONResponse` into actual JSON or output JSON Error!\n\n}\n\nfunc messageHandler(w http.ResponseWriter, r *http.Request) JSONResponse { // #BROKEN TYPES?\n\n    hasError, messageResponse := NewMessageObject(r)\n    if (hasError || messageResponse==nil) { return nil } // #TODO\n    ////\n\n    // #TODO ... more message things.\n\n    return messageResponse;\n\n};\n</code></pre>\n\n<p>This approach (sorry for any code mistakes, really long day and I'm headed to bed) doesn't work because in order to pass the varied return values around... the type can't change, etc.</p>\n\n<p>The <strong><code>JSONResponseHandler</code></strong> wrapper method actually works on my end but only with the <code>interface {}</code> type given the variations in type... so I've left it out since it'd clutter up the code. However, if I use <code>interface {}</code> on subsequent blocks with optional asterisked return properties (such as \"NewMessageObject\"), the JSON constructors seems to ignore those values since they're wrapped in an empty interface instead of just exposed as their raw type. However, they have to have a nil option....</p>\n\n<p>What's wrong? The design in general? <strong>I'm basically trying to build a JSON object response (or return with a JSON-formatted error) through subsequent calls based on input data... in a neatly abstracted way.</strong></p>\n"}, {"tags": ["go", "scope", "lexical-scope", "shadowing"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1460389590, "post_id": 36553134, "comment_id": 60707130, "body": "I am not really sure about your purpose here, but maybe you can make a nice blogpost out of this."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1460389672, "post_id": 36553134, "comment_id": 60707172, "body": "just  interesting and informative to share, thanks."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 5, "last_activity_date": 1523429963, "last_edit_date": 1523429963, "creation_date": 1460389024, "answer_id": 36553135, "question_id": 36553134, "link": "https://stackoverflow.com/questions/36553134/where-can-we-use-variable-scoping-and-shadowing-in-go/36553135#36553135", "title": "Where can we use Variable Scoping and Shadowing in Go?", "body": "<p><strong>Variable scoping and shadowing:</strong></p>\n\n<blockquote>\n  <p>Go is lexically scoped using blocks:</p>\n  \n  <ol>\n  <li>The scope of a predeclared identifier is the universe block.   </li>\n  <li>The scope of an identifier denoting a constant, type, variable, or\n  function (but not method) declared at top level (outside any function)\n  is the package block.   </li>\n  <li>The scope of the package name of an imported\n  package is the file block of the file containing the import\n  declaration.   </li>\n  <li>The scope of an identifier denoting a method\n  receiver, function parameter, or result variable is the function body.  </li>\n  <li>The scope of a constant or variable identifier declared inside a\n  function begins at the end of the ConstSpec or VarSpec (ShortVarDecl\n  for short variable declarations) and ends at the end of the innermost\n  containing block.   </li>\n  <li>The scope of a type identifier declared inside a\n  function begins at the identifier in the TypeSpec and ends at the end\n  of the innermost containing block.<br>\n  <strong>An identifier declared in a block may be redeclared in an inner block.</strong><br>\n  While the identifier of the inner declaration is in scope, it\n  denotes the entity declared by the inner declaration.  </li>\n  </ol>\n  \n  <p>The package clause is not a declaration; the package name does not\n  appear in any scope. Its purpose is to identify the files belonging to\n  the same package and to specify the default package name for import\n  declarations.</p>\n</blockquote>\n\n<h3>Advantages:</h3>\n\n<ul>\n<li>Since data cannot be accessed from outer scope, Data Integrity is preserved</li>\n</ul>\n\n<hr>\n\n<h3>Different forms of Variable shadowing in Go:</h3>\n\n<ol>\n<li><p>Golang way to limit variable scope (using short-hand assignment inside statements):  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\nimport \"fmt\"\nfunc main() {\n    i := 10 //scope: main\n    j := 4\n    for i := 'a'; i &lt; 'b'; i++ {\n        // i shadowed inside this block\n        fmt.Println(i, j) //97 4\n    }\n    fmt.Println(i, j) //10 4\n\n    if i := \"test\"; len(i) == j {\n        // i shadowed inside this block\n        fmt.Println(i, j) // i= test , j= 4\n    } else {\n        // i shadowed inside this block\n        fmt.Println(i, j) //test 40\n    }\n    fmt.Println(i, j) //10 4\n}\n</code></pre></li>\n<li><p>When \"we need more alphabets\", this is nice way to <strong>limit variables scope</strong>.<br>\nAlso this works well when you need more local variables or scope:  </p>\n\n<p><strong>using <code>{</code> and <code>}</code> pair:</strong><br>\nPros: no need to extra statements like if, for, \u2026  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\nimport \"fmt\"\nfunc main() {\n    i := 1\n    j := 2\n    //new scope :\n    {\n        i := \"hi\" //new local var\n        j++\n        fmt.Println(i, j) //hi 3\n    }\n    fmt.Println(i, j) //1 3\n}\n</code></pre></li>\n<li><p>Another way to limit variable scope is <strong>using function calls</strong>:<br>\nPros: scope limit, input value type parameters are usable like local variables,<br>\nCons: call/return time, and stack usage: if it is not optimized by compiler  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\nimport \"fmt\"\nfunc fun(i int, j *int) {\n    i++                //+nice: use as local var without side effect\n    *j++               //+nice: intentionally use as global var\n    fmt.Println(i, *j) //11 21\n}\nfunc main() {\n    i := 10 //scope: main\n    j := 20\n    fun(i, &amp;j)\n    fmt.Println(i, j) //10 21\n}\n</code></pre></li>\n<li><p>Another way is <strong>shadowing global variables</strong>:    </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\nimport \"fmt\"\nvar i int = 1 //global\nfunc main() {\n    j := 2\n    fmt.Println(i, j) //1 2\n    i := 10           //Shadowing global var\n    fmt.Println(i, j) //10 2\n    fun(i, j)         //10 2\n}\nfunc fun(i, j int) {\n    //i := 100        //error: no new variables on left side of :=\n    //var i int = 100 //error: i redeclared in this block\n    fmt.Println(i, j) //10 2\n}\n</code></pre></li>\n</ol>\n\n<p>See: <a href=\"https://en.wikipedia.org/wiki/Variable_shadowing\" rel=\"nofollow noreferrer\">Variable shadowing</a> and <a href=\"https://en.wikipedia.org/wiki/Scope_(computer_science)\" rel=\"nofollow noreferrer\">Scope</a>.<br>\nAnd: <a href=\"https://golang.org/ref/spec#Declarations_and_scope\" rel=\"nofollow noreferrer\">Declarations and scope</a>: </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2264, "favorite_count": 3, "answer_count": 1, "score": 1, "last_activity_date": 1523429963, "creation_date": 1460389024, "last_edit_date": 1495540831, "question_id": 36553134, "link": "https://stackoverflow.com/questions/36553134/where-can-we-use-variable-scoping-and-shadowing-in-go", "title": "Where can we use Variable Scoping and Shadowing in Go?", "body": "<p>Some related posts I've found:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/33458547/go-variable-scope-and-shadowing\">go variable scope and shadowing</a>  </li>\n<li><a href=\"https://stackoverflow.com/questions/24475153/golang-variable-scope-inside-if-statements\">Golang: variable scope inside if statements</a>  </li>\n<li><a href=\"https://stackoverflow.com/questions/36531188/limit-the-scope-of-variables-storing-error/36533655\">Limit the scope of variables storing error</a>  </li>\n</ul>\n\n<p>Also there are many use cases to Variable Scoping and Shadowing.<br>\nAny code samples or answers will be appreciated.</p>\n"}, {"tags": ["go", "google-compute-engine", "google-cloud-pubsub"], "answers": [{"comments": [{"owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "edited": false, "score": 1, "creation_date": 1460450958, "post_id": 36555751, "comment_id": 60735476, "body": "Ok, that makes logical sense, thanks. So, in your opinion, it&#39;s ok to run in an endless loop, without sleep?"}, {"owner": {"reputation": 9109, "user_id": 1121288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/299e0ebf3759ba2e2e6f69fc30653016?s=128&d=identicon&r=PG", "display_name": "Kamal Aboul-Hosn", "link": "https://stackoverflow.com/users/1121288/kamal-aboul-hosn"}, "reply_to_user": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "edited": false, "score": 1, "creation_date": 1460458501, "post_id": 36555751, "comment_id": 60740866, "body": "Yes, an endless loop that starts a request as soon as one is complete is pretty typical."}, {"owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "edited": false, "score": 0, "creation_date": 1460463289, "post_id": 36555751, "comment_id": 60744409, "body": "Thanks for the help."}, {"owner": {"reputation": 1107, "user_id": 2579309, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/37f47fd5ebdaa3c4b2eb0b90522e6d1a?s=128&d=identicon&r=PG", "display_name": "Mullefa", "link": "https://stackoverflow.com/users/2579309/mullefa"}, "edited": false, "score": 0, "creation_date": 1462311392, "post_id": 36555751, "comment_id": 61581723, "body": "@KamalAboul-Hosn in many instances pushing is a lot cleaner. Do you know if support for pushing to https servers running on compute engine vm instances will be supported in the future? I&#39;ve asked a question about it here: <a href=\"http://stackoverflow.com/questions/37004434/google-pub-sub-push-to-compute-engine\" title=\"google pub sub push to compute engine\">stackoverflow.com/questions/37004434/&hellip;</a>"}, {"owner": {"reputation": 9109, "user_id": 1121288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/299e0ebf3759ba2e2e6f69fc30653016?s=128&d=identicon&r=PG", "display_name": "Kamal Aboul-Hosn", "link": "https://stackoverflow.com/users/1121288/kamal-aboul-hosn"}, "reply_to_user": {"reputation": 1107, "user_id": 2579309, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/37f47fd5ebdaa3c4b2eb0b90522e6d1a?s=128&d=identicon&r=PG", "display_name": "Mullefa", "link": "https://stackoverflow.com/users/2579309/mullefa"}, "edited": false, "score": 0, "creation_date": 1462809787, "post_id": 36555751, "comment_id": 61781763, "body": "I&#39;ve added an answer to that question, @Mullefa. It is possible, but you&#39;ll need to set up a domain and point it to the GCE instance."}], "tags": [], "owner": {"reputation": 9109, "user_id": 1121288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/299e0ebf3759ba2e2e6f69fc30653016?s=128&d=identicon&r=PG", "display_name": "Kamal Aboul-Hosn", "link": "https://stackoverflow.com/users/1121288/kamal-aboul-hosn"}, "is_accepted": true, "score": 4, "last_activity_date": 1460397137, "creation_date": 1460397137, "answer_id": 36555751, "question_id": 36552727, "link": "https://stackoverflow.com/questions/36552727/using-google-pubsub-with-golang-the-most-efficient-cost-way-to-poll-the-servi/36555751#36555751", "title": "Using Google PubSub with Golang. The most efficient (cost) way to poll the service", "body": "<p>In general, the key to pull subscribers in Cloud Pub/Sub is to make sure you always have at least a few outstanding Pull requests with max_messages set to a value that works well for:</p>\n\n<ul>\n<li>the rate at which you publish messages,</li>\n<li>the size of those messages, and</li>\n<li>the rate of messages your subscriber can process messages.</li>\n</ul>\n\n<p>As soon as a pull request returns, you should issue another one. That means processing and acking the messages returned to you in the pull response asynchronously (or starting up the new pull request asynchronously). If you ever find that throughput or latency isn't what you expect, the first thing to do is add more concurrent pull requests.</p>\n\n<p>The statement \"if polling is used, high network usage may be incurred if you are opening connections frequently and closing them immediately\" applies if your publish rate is extremely low. Imagine you only publish two or three messages in a day, but you constantly poll with pull requests. Every one of those pull requests incurs a cost for making the request, but you won't get any messages to process except for the few times when you actually have a message, so the \"cost per message\" is fairly high. If you are publishing at a pretty steady rate and your pull requests are returning a non-zero number of messages, then the network usage and costs will be in line with the message rate.</p>\n"}], "owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3477, "favorite_count": 1, "accepted_answer_id": 36555751, "answer_count": 1, "score": 5, "last_activity_date": 1460397137, "creation_date": 1460387846, "question_id": 36552727, "link": "https://stackoverflow.com/questions/36552727/using-google-pubsub-with-golang-the-most-efficient-cost-way-to-poll-the-servi", "title": "Using Google PubSub with Golang. The most efficient (cost) way to poll the service", "body": "<p>We're in the process of moving from AMQP to Google's Pubsub. </p>\n\n<p><a href=\"https://cloud.google.com/pubsub/subscriber\" rel=\"noreferrer\">The docs suggest</a> that pull might be the best choice for us since we're using compute engine and can't open our workers to receive via the push service.</p>\n\n<p>It also says that pull might incur additional costs depending on usage:</p>\n\n<blockquote>\n  <p>If polling is used, high network usage may be incurred if you are\n  opening connections frequently and closing them immediately.</p>\n</blockquote>\n\n<p>We'd created a test subscriber in go that runs in a loop as so:</p>\n\n<pre><code>func main() {\n    jsonKey, err := ioutil.ReadFile(\"pubsub-key.json\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    conf, err := google.JWTConfigFromJSON(\n        jsonKey,\n        pubsub.ScopeCloudPlatform,\n        pubsub.ScopePubSub,\n    )\n    if err != nil {\n        log.Fatal(err)\n    }\n    ctx := cloud.NewContext(\"xxx\", conf.Client(oauth2.NoContext))\n\n    msgIDs, err := pubsub.Publish(ctx, \"topic1\", &amp;pubsub.Message{\n        Data: []byte(\"hello world\"),\n    })\n\n    if err != nil {\n        log.Println(err)\n    }\n\n    log.Printf(\"Published a message with a message id: %s\\n\", msgIDs[0])\n\n    for {\n        msgs, err := pubsub.Pull(ctx, \"subscription1\", 1)\n        if err != nil {\n            log.Println(err)\n        }\n\n        if len(msgs) &gt; 0 {\n            log.Printf(\"New message arrived: %v, len: %d\\n\", msgs[0].ID, len(msgs))\n            if err := pubsub.Ack(ctx, \"subscription1\", msgs[0].AckID); err != nil {\n                log.Fatal(err)\n            }\n            log.Println(\"Acknowledged message\")\n            log.Printf(\"Message: %s\", msgs[0].Data)\n        }\n    }\n}\n</code></pre>\n\n<p>The question I have though is really whether this is the correct / recommended way to go about pulling messages.</p>\n\n<p>We recieve about 100msg per second throughout the day. I'm not sure if running it in an endless loop is going to bankrupt us and can't find any other decent go examples.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5459, "user_id": 1734730, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/L8dDj.jpg?s=128&g=1", "display_name": "Nathan Cooper", "link": "https://stackoverflow.com/users/1734730/nathan-cooper"}, "edited": false, "score": 3, "creation_date": 1460386040, "post_id": 36551835, "comment_id": 60704596, "body": "Duplicate: <a href=\"http://stackoverflow.com/a/22093762/1734730\">Constant Parameter in golang function</a>"}], "answers": [{"comments": [{"owner": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "edited": false, "score": 2, "creation_date": 1460386414, "post_id": 36551999, "comment_id": 60704877, "body": "map/channel are actually implicitly passed by reference."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "edited": false, "score": 0, "creation_date": 1460386555, "post_id": 36551999, "comment_id": 60704973, "body": "@NipunTalukdar yeah that&#39;s why I said that, I guess I should make it clearer."}, {"owner": {"reputation": 3551, "user_id": 2137314, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/LjaqW.jpg?s=128&g=1", "display_name": "siritinga", "link": "https://stackoverflow.com/users/2137314/siritinga"}, "edited": false, "score": 0, "creation_date": 1460387784, "post_id": 36551999, "comment_id": 60705875, "body": "Shouldn&#39;t it be <code>if *m == nil {</code> ?"}, {"owner": {"reputation": 4936, "user_id": 102852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cd1a03727472c03ab6628d437a24e00?s=128&d=identicon&r=PG", "display_name": "alex vasi", "link": "https://stackoverflow.com/users/102852/alex-vasi"}, "edited": false, "score": 0, "creation_date": 1460450044, "post_id": 36551999, "comment_id": 60734848, "body": "@OneOfOne &quot;structs are reference-types&quot;?"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 4936, "user_id": 102852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cd1a03727472c03ab6628d437a24e00?s=128&d=identicon&r=PG", "display_name": "alex vasi", "link": "https://stackoverflow.com/users/102852/alex-vasi"}, "edited": false, "score": 0, "creation_date": 1460465743, "post_id": 36551999, "comment_id": 60746478, "body": "@alexvasi slices, oops"}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 6, "last_activity_date": 1460465753, "last_edit_date": 1460465753, "creation_date": 1460386008, "answer_id": 36551999, "question_id": 36551835, "link": "https://stackoverflow.com/questions/36551835/const-reference-in-c-and-equivalent-in-golang/36551999#36551999", "title": "Const reference in C++ and equivalent in Golang", "body": "<p>There's no direct equivalent in Go.</p>\n\n<ol>\n<li>Pass by pointer if the object is big (~bigger than 32-64bytes) and/or requires changing.</li>\n<li>Pass by value if the above rule doesn't apply.</li>\n<li>maps/channels/slices are reference-types, they contain inner pointers, so you don't need to pass them by pointer unless you plan on possibly passing a nil or want to append (not modify already contained elements) to a slice.</li>\n</ol>\n\n<p>Example:</p>\n\n<pre><code>func doMap(m *map[string]string) {\n    if *m == nil {\n        *m = map[string]string{}\n    }\n    .....\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 47884, "user_id": 164234, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6b34a2a81515583dc95e5c0809db06bb?s=128&d=identicon&r=PG", "display_name": "Nick Craig-Wood", "link": "https://stackoverflow.com/users/164234/nick-craig-wood"}, "edited": false, "score": 2, "creation_date": 1460388129, "post_id": 36552686, "comment_id": 60706108, "body": "strings are passed by reference, but they are immutable so behave as if they are passed by value."}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "reply_to_user": {"reputation": 47884, "user_id": 164234, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6b34a2a81515583dc95e5c0809db06bb?s=128&d=identicon&r=PG", "display_name": "Nick Craig-Wood", "link": "https://stackoverflow.com/users/164234/nick-craig-wood"}, "edited": false, "score": 0, "creation_date": 1460388364, "post_id": 36552686, "comment_id": 60706287, "body": "@NickCraig-Wood, does it mean that if we pass a string by value like t1(s string) it&#39;s not copied in memory and we can easily pass huge strings back &amp; forth?"}], "tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": false, "score": -1, "last_activity_date": 1460387730, "creation_date": 1460387730, "answer_id": 36552686, "question_id": 36551835, "link": "https://stackoverflow.com/questions/36551835/const-reference-in-c-and-equivalent-in-golang/36552686#36552686", "title": "Const reference in C++ and equivalent in Golang", "body": "<p>For strings you can use <code>*string</code> as parameter and it seems you can not change the original string:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    )\n\nfunc t1(s *string) {\n    fmt.Println(\"Inside before: %s\", *s)\n    s2 := \"tEsT1\"\n    s = &amp;s2\n    fmt.Println(\"Inside after 1: %s\", *s)\n}\n\nfunc main() {\n    var s = \"test\"\n    fmt.Println(\"Ourside before: %v\", s)\n    t1(&amp;s)\n    fmt.Println(\"Ourside  after: %v\", s)\n}\n</code></pre>\n\n<p>Prints:</p>\n\n<pre><code>Ourside before: %v test\nInside before: %s test\nInside after 1: %s tEsT1\nOurside  after: %v test\n</code></pre>\n\n<p>For complex structs it would be harder or impossible to pass be ref &amp; prevent editing.</p>\n\n<p>Please correct me if I got it wrong (<em>i'm just learning Go</em>).</p>\n"}], "owner": {"reputation": 1148, "user_id": 2587442, "user_type": "registered", "accept_rate": 24, "profile_image": "https://graph.facebook.com/598829485/picture?type=large", "display_name": "Georgy Buranov", "link": "https://stackoverflow.com/users/2587442/georgy-buranov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2889, "favorite_count": 2, "answer_count": 2, "score": 10, "last_activity_date": 1462641610, "creation_date": 1460385605, "last_edit_date": 1462641610, "question_id": 36551835, "link": "https://stackoverflow.com/questions/36551835/const-reference-in-c-and-equivalent-in-golang", "title": "Const reference in C++ and equivalent in Golang", "body": "<p>I came to go from the C++ world and in C++ usually when you care about performance and you don't need you object to be changed, you pass it using constant reference</p>\n\n<pre><code>void func(const std::string&amp; str)\n</code></pre>\n\n<p>In this case, the string is NOT COPIED and cannot be modified in the function.</p>\n\n<p>I know, that in Go there are two ways to pass object:</p>\n\n<ul>\n<li>By value, and then you cannot modify (or actually you can but it makes no sense) it, but it very memory consuming</li>\n<li>By pointer, this is good from the terms of memory, but you can modify object.</li>\n</ul>\n\n<p>So, what is best approach? Always pass object by pointer even if you don't want to modify it because it is faster? Or there are some compiler optimizations and even if you send it by value sometimes it is sent as reference?</p>\n"}, {"tags": ["image", "go", "concurrency", "rendering"], "answers": [{"comments": [{"owner": {"reputation": 5926, "user_id": 3128156, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/h3FIS.jpg?s=128&g=1", "display_name": "Sahand", "link": "https://stackoverflow.com/users/3128156/sahand"}, "edited": false, "score": 0, "creation_date": 1460393542, "post_id": 36552433, "comment_id": 60709750, "body": "mutex wasn&#39;t necessary"}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 0, "last_activity_date": 1460387084, "creation_date": 1460387084, "answer_id": 36552433, "question_id": 36551154, "link": "https://stackoverflow.com/questions/36551154/julia-set-image-rendering-ruined-by-concurrency/36552433#36552433", "title": "Julia set image rendering ruined by concurrency", "body": "<p>There are 2 problems:</p>\n\n<ol>\n<li>You don't actually wait for your goroutines to finish.</li>\n<li>You don't pass <code>i and j</code> to the goroutine, so they will almost always be the last i and j.</li>\n</ol>\n\n<p>Your function should look something like:</p>\n\n<pre><code>func Julia(f ComplexFunc, n int) image.Image {\n    var wg sync.WaitGroup\n    bounds := image.Rect(-n/2, -n/2, n/2, n/2)\n    img := image.NewRGBA(bounds)\n    s := float64(n / 4)\n    for i := bounds.Min.X; i &lt; bounds.Max.X; i++ {\n        for j := bounds.Min.Y; j &lt; bounds.Max.Y; j++ {\n            wg.Add(1)\n            go func(i, j int) {\n                n := Iterate(f, complex(float64(i)/s, float64(j)/s), 256)\n                r := uint8(0)\n                g := uint8(0)\n                b := uint8(n % 32 * 8)\n                img.Set(i, j, color.RGBA{r, g, b, 255})\n                wg.Done()\n            }(i, j)\n        }\n    }\n    wg.Wait()\n    return img\n}\n</code></pre>\n\n<p>A bonus tip, when diving into concurrency, it's usually a good idea to try your code with the <a href=\"http://blog.golang.org/race-detector\" rel=\"nofollow\">race detector</a>.</p>\n\n<p>You <em>might</em> have to use a mutex to call <code>img.Set</code> but I'm not very sure and I can't test atm.</p>\n"}], "owner": {"reputation": 5926, "user_id": 3128156, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/h3FIS.jpg?s=128&g=1", "display_name": "Sahand", "link": "https://stackoverflow.com/users/3128156/sahand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "accepted_answer_id": 36552433, "answer_count": 1, "score": 1, "last_activity_date": 1460387084, "creation_date": 1460383896, "last_edit_date": 1460385440, "question_id": 36551154, "link": "https://stackoverflow.com/questions/36551154/julia-set-image-rendering-ruined-by-concurrency", "title": "Julia set image rendering ruined by concurrency", "body": "<p>I have the following code that I am to change into a concurrent program.</p>\n\n<pre><code>// Stefan Nilsson 2013-02-27\n\n// This program creates pictures of Julia sets (en.wikipedia.org/wiki/Julia_set).\npackage main\n\nimport (\n    \"image\"\n    \"image/color\"\n    \"image/png\"\n    \"log\"\n    \"math/cmplx\"\n    \"os\"\n    \"strconv\"\n)\n\ntype ComplexFunc func(complex128) complex128\n\nvar Funcs []ComplexFunc = []ComplexFunc{\n    func(z complex128) complex128 { return z*z - 0.61803398875 },\n    func(z complex128) complex128 { return z*z + complex(0, 1) },\n}\n\nfunc main() {\n    for n, fn := range Funcs {\n        err := CreatePng(\"picture-\"+strconv.Itoa(n)+\".png\", fn, 1024)\n        if err != nil {\n            log.Fatal(err)\n        }\n    }\n}\n\n// CreatePng creates a PNG picture file with a Julia image of size n x n.\nfunc CreatePng(filename string, f ComplexFunc, n int) (err error) {\n    file, err := os.Create(filename)\n    if err != nil {\n        return\n    }\n    defer file.Close()\n    err = png.Encode(file, Julia(f, n))\n    return\n}\n\n// Julia returns an image of size n x n of the Julia set for f.\nfunc Julia(f ComplexFunc, n int) image.Image {\n    bounds := image.Rect(-n/2, -n/2, n/2, n/2)\n    img := image.NewRGBA(bounds)\n    s := float64(n / 4)\n    for i := bounds.Min.X; i &lt; bounds.Max.X; i++ {\n        for j := bounds.Min.Y; j &lt; bounds.Max.Y; j++ {\n            n := Iterate(f, complex(float64(i)/s, float64(j)/s), 256)\n            r := uint8(0)\n            g := uint8(0)\n            b := uint8(n % 32 * 8)\n            img.Set(i, j, color.RGBA{r, g, b, 255})\n        }\n    }\n    return img\n}\n\n// Iterate sets z_0 = z, and repeatedly computes z_n = f(z_{n-1}), n \u00e2\u2030\u00a5 1,\n// until |z_n| &gt; 2  or n = max and returns this n.\nfunc Iterate(f ComplexFunc, z complex128, max int) (n int) {\n    for ; n &lt; max; n++ {\n        if real(z)*real(z)+imag(z)*imag(z) &gt; 4 {\n            break\n        }\n        z = f(z)\n    }\n    return\n}\n</code></pre>\n\n<p>I have decided to try and make the <code>Julia()</code> function concurrent. So I changed it to:</p>\n\n<pre><code>func Julia(f ComplexFunc, n int) image.Image {  \n    bounds := image.Rect(-n/2, -n/2, n/2, n/2)  \n    img := image.NewRGBA(bounds)                \n    s := float64(n / 4)                          \n    for i := bounds.Min.X; i &lt; bounds.Max.X; i++ {\n        for j := bounds.Min.Y; j &lt; bounds.Max.Y; j++ {\n            go func(){\n                n := Iterate(f, complex(float64(i)/s, float64(j)/s), 256)\n                r := uint8(0)   \n                g := uint8(0)   \n                b := uint8(n % 32 * 8)  \n                img.Set(i, j, color.RGBA{r, g, b, 255}) \n            }()\n        }\n    }\n    return img \n</code></pre>\n\n<p>This change causes the images to look very different. The patterns are essentially the same, but there are a lot of white pixels that were not there before. </p>\n\n<p>What is happening here? </p>\n"}, {"tags": ["pointers", "go", "interface", "slice", "type-assertion"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1460383863, "post_id": 36551041, "comment_id": 60702935, "body": "You dereference pointers with <code>*</code>; <code>(*member).([]string)</code>. But, <i>why</i> are you using a pointer to an interface? There&#39;s no reason here (or ever really) to use a pointer to an interface."}, {"owner": {"reputation": 2755, "user_id": 3244776, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/a3E89.jpg?s=128&g=1", "display_name": "nohup", "link": "https://stackoverflow.com/users/3244776/nohup"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1460384941, "post_id": 36551041, "comment_id": 60703773, "body": "Thank you @JimB. I tried range <code>*member.([]string)</code> which apparently didnt work because I didn&#39;t give the curly brackets. I will point it out in the question."}], "answers": [{"comments": [{"owner": {"reputation": 2755, "user_id": 3244776, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/a3E89.jpg?s=128&g=1", "display_name": "nohup", "link": "https://stackoverflow.com/users/3244776/nohup"}, "edited": false, "score": 0, "creation_date": 1460385017, "post_id": 36551287, "comment_id": 60703846, "body": "Thank you. I tried de-referencing it as <code>range *member.([]string)</code>, but since I missed the brackets part, it didn;t work. I will add that part to the question. It worked."}], "tags": [], "owner": {"reputation": 4124, "user_id": 2629095, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/680dfd61e8b392153c85cf93498b8100?s=128&d=identicon&r=PG", "display_name": "nevets", "link": "https://stackoverflow.com/users/2629095/nevets"}, "is_accepted": true, "score": 3, "last_activity_date": 1460384188, "last_edit_date": 1495540238, "creation_date": 1460384188, "answer_id": 36551287, "question_id": 36551041, "link": "https://stackoverflow.com/questions/36551041/pointer-to-an-empty-interface-type-assertion/36551287#36551287", "title": "Pointer to an empty interface type assertion", "body": "<p>You need to dereferencing before assertion:</p>\n\n<pre><code>func convertMember(member *interface{})  {\n    for _, members := range (*member).([]string) { ... }\n}\n</code></pre>\n\n<p>But why do you want a pointer to interface? When a struct implements some interface, the pointer of that struct implements that interface too. So a pointer to interface is kind of never-need.</p>\n\n<p>For your reference, here's a related question: <a href=\"https://stackoverflow.com/questions/13511203/why-cant-i-assign-a-struct-to-an-interface\">Why can&#39;t I assign a *Struct to an *Interface?</a></p>\n"}], "owner": {"reputation": 2755, "user_id": 3244776, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/a3E89.jpg?s=128&g=1", "display_name": "nohup", "link": "https://stackoverflow.com/users/3244776/nohup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2411, "favorite_count": 0, "accepted_answer_id": 36551287, "answer_count": 1, "score": 0, "last_activity_date": 1460385102, "creation_date": 1460383558, "last_edit_date": 1460385102, "question_id": 36551041, "link": "https://stackoverflow.com/questions/36551041/pointer-to-an-empty-interface-type-assertion", "title": "Pointer to an empty interface type assertion", "body": "<p>I am receiving a pointer to an interface to my function, and I am trying to iterate over it. The underlying type is a string slice, which I can convert to it if I am using type <code>interface{}</code> and not a pointer to it <code>*interface{}</code> What is the best way to type assert pointer to interface? Using pointer because the value to be transformed is of huge size. </p>\n\n<p>Code that doesn't work:</p>\n\n<pre><code>func convertMember(member *interface{})  {\n    for _, members := range member.([]string) {\n</code></pre>\n\n<p><code>invalid type assertion: member.([]string) (non-interface type *interface {} on left)</code></p>\n\n<p>Code that doesn't work with dereferencing pointer:</p>\n\n<pre><code>func convertMember(member *interface{})  {\n    for _, members := range *member.([]string) {\n</code></pre>\n\n<p><code>invalid type assertion: member.([]string) (non-interface type *interface {} on left)</code></p>\n\n<p>Code that works if I change the parent function to send an interface instead of its pointer:</p>\n\n<pre><code>func convertMember(member interface{})  {\n    for _, members := range member.([]string) {\n</code></pre>\n\n<p>Or should I type assert it to string slice and use a pointer to it?</p>\n"}, {"tags": ["go", "newrelic"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1460382805, "post_id": 36550590, "comment_id": 60702130, "body": "Use <code>WrapHandler</code> instead: <a href=\"https://godoc.org/github.com/yvasiyarov/gorelic#Agent.WrapHTTPHandler\" rel=\"nofollow noreferrer\">godoc.org/github.com/yvasiyarov/gorelic#Agent.WrapHTTPHandle&zwnj;&#8203;r</a>"}, {"owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1460383934, "post_id": 36550590, "comment_id": 60702998, "body": "Oops, didn&#39;t see that. Thanking by the way"}], "answers": [{"tags": [], "owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "is_accepted": false, "score": 0, "last_activity_date": 1544613233, "last_edit_date": 1544613233, "creation_date": 1460447469, "answer_id": 36566893, "question_id": 36550590, "link": "https://stackoverflow.com/questions/36550590/capture-http-metrics-using-gorelic-agent-of-custom-http-handler/36566893#36566893", "title": "Capture HTTP metrics using goRelic agent of custom http handler", "body": "<p>I just need to use <code>WrapHandler</code>. Credits to elithrar for the <a href=\"https://stackoverflow.com/questions/36550590/capture-http-metrics-using-gorelic-agent-of-custom-http-handler/36566893#comment60702130_36550590\">suggestion</a>.</p>\n\n<pre><code>agent.CollectHTTPStat  = true\nhttp.HandleFunc(\"/\", agent.WrapHandler(handler)\n</code></pre>\n"}], "owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 98, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1544613233, "creation_date": 1460382399, "question_id": 36550590, "link": "https://stackoverflow.com/questions/36550590/capture-http-metrics-using-gorelic-agent-of-custom-http-handler", "title": "Capture HTTP metrics using goRelic agent of custom http handler", "body": "<p>I was trying to capture the system resources used by http handler, Latency etc. Since there is no newrelic agent for go lang. So, I found this <a href=\"https://github.com/yvasiyarov/gorelic\" rel=\"nofollow\">goRelic</a> agent.<br>\nWhich says using the folowing way i can capture the http metric:</p>\n\n<pre><code>agent.CollectHTTPStat  = true\nhttp.HandleFunc(\"/\", agent.WrapHTTPHandlerFunc(handler))\n</code></pre>\n\n<p>But the problem is i am using custom http handler given in the <a href=\"https://elithrar.github.io/article/custom-handlers-avoiding-globals/\" rel=\"nofollow\">link</a> as follows:</p>\n\n<pre><code>type appHandler struct {\n    *appContext\n    H func(*appContext, http.ResponseWriter, *http.Request) (int, error)\n}\n\n\nfunc (ah appHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    // Updated to pass ah.appContext as a parameter to our handler type.\n    status, err := ah.H(ah.appContext, w, r)\n    if err != nil {\n        log.Printf(\"HTTP %d: %q\", status, err)\n        switch status {\n        case http.StatusNotFound:\n            http.NotFound(w, r)\n            // And if we wanted a friendlier error page, we can\n            // now leverage our context instance - e.g.\n            // err := ah.renderTemplate(w, \"http_404.tmpl\", nil)\n        case http.StatusInternalServerError:\n            http.Error(w, http.StatusText(status), status)\n        default:\n            http.Error(w, http.StatusText(status), status)\n        }\n    }\n}\n\nfunc main() {\n    r := web.New()\n    // We pass an instance to our context pointer, and our handler.\n    r.Get(\"/\", appHandler{context, IndexHandler})     \n    graceful.ListenAndServe(\":8086\", r)    \n\n}\n</code></pre>\n\n<p>So, how do i capture the http metric for this handle or is there any other tool by which i can capture the similar metrics?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 1, "creation_date": 1460381956, "post_id": 36550292, "comment_id": 60701419, "body": "Please shrink your code to the minimum and provide full working sample (including calls to the routines). All the circle/radius stuff is not related to the channels."}, {"owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 1, "creation_date": 1460382583, "post_id": 36550292, "comment_id": 60701950, "body": "Keep in mind that if you have more than one goroutine that&#39;s counting on that failchannel, you&#39;ll have an issue. Only one of those channel receivers will get the fail notification, not all."}, {"owner": {"reputation": 4124, "user_id": 2629095, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/680dfd61e8b392153c85cf93498b8100?s=128&d=identicon&r=PG", "display_name": "nevets", "link": "https://stackoverflow.com/users/2629095/nevets"}, "edited": false, "score": 2, "creation_date": 1460382943, "post_id": 36550292, "comment_id": 60702243, "body": "how do you initialize fail channel? is it buffered? an unbuffered channel will result in a hang."}, {"owner": {"reputation": 4124, "user_id": 2629095, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/680dfd61e8b392153c85cf93498b8100?s=128&d=identicon&r=PG", "display_name": "nevets", "link": "https://stackoverflow.com/users/2629095/nevets"}, "edited": false, "score": 0, "creation_date": 1460383580, "post_id": 36550292, "comment_id": 60702707, "body": "it&#39;s because your producer routine never ends, and it will reach a point where nobody consumes <code>fail</code> anymore. If your <code>fail</code> is unbuffered, your producer will be blocked, and thus hang."}, {"owner": {"reputation": 4124, "user_id": 2629095, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/680dfd61e8b392153c85cf93498b8100?s=128&d=identicon&r=PG", "display_name": "nevets", "link": "https://stackoverflow.com/users/2629095/nevets"}, "edited": false, "score": 0, "creation_date": 1460383596, "post_id": 36550292, "comment_id": 60702719, "body": "oh, @MitchellIngram good to know you fixed your problem :)"}], "answers": [{"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 2, "last_activity_date": 1460398860, "creation_date": 1460398860, "answer_id": 36556296, "question_id": 36550292, "link": "https://stackoverflow.com/questions/36550292/passing-any-value-over-cancel-channel-causes-program-to-hang/36556296#36556296", "title": "Passing any value over cancel channel causes program to hang", "body": "<p>You can close a channel to signal completion:</p>\n\n<pre><code>failed := make(chan struct{})\nselect {\ncase &lt;-failed:\n}\n</code></pre>\n\n<p>In another goroutine:</p>\n\n<pre><code>close(failed)\n</code></pre>\n\n<p>Will cause the <code>failed</code> case to happen. This will work with any number of goroutines listening on <code>failed</code>. Be careful to only do this once though, because closing an already close channel will panic. You could use this pattern:</p>\n\n<pre><code>// A Stopper signals completion over C by closing it when Stop is called\ntype Stopper struct {\n    C    chan struct{}\n    once sync.Once\n}\n\n// NewStopper creates a new Stopper\nfunc NewStopper() *Stopper {\n    return &amp;Stopper{\n        C: make(chan struct{}),\n    }\n}\n\n// Stop closes C. It is safe to call multiple times\nfunc (s *Stopper) Stop() {\n    s.once.Do(func() {\n        close(s.C)\n    })\n}\n</code></pre>\n"}], "owner": {"reputation": 674, "user_id": 866376, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/1175553f0c746b7a2711465792aefe42?s=128&d=identicon&r=PG", "display_name": "Mitchell Ingram", "link": "https://stackoverflow.com/users/866376/mitchell-ingram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1460398860, "creation_date": 1460381664, "last_edit_date": 1460382858, "question_id": 36550292, "link": "https://stackoverflow.com/questions/36550292/passing-any-value-over-cancel-channel-causes-program-to-hang", "title": "Passing any value over cancel channel causes program to hang", "body": "<p>I am trying to use worker goroutines to check diameters out to a certain distance, it works great when I do one tile at a time, but when I do a bunch, there is a massive slow down. I figure this is because a lot of goroutines are still running even though they are no longer needed. I added a fail channel to tell all running goroutines to close up shop, but doing this causes the app to hang. Actually, passing any value to the channel causes the app to hang, even if I don't consume it.</p>\n\n<pre><code> caught := 0\nloop:\n    for angle := float64(0); angle &lt; 360; angle++ {\n        select {\n        case &lt;-failChannel:\n            break loop\n        default:\n         log.Print(angle)\n        }\n\n    }\n    channelOut &lt;- []int{radius, caught}\n</code></pre>\n\n<p>is the routine that uses the channel </p>\n\n<pre><code>for {\n        select {\n        case circle := &lt;-channelOut:\n            if circle[1] == 0 {\n                radiusMap[circle[0]] = 0\n                if _, radius := testLine(radiusMap); radius &lt;= circle[0] {\n                    failChannel &lt;- 0\n\n\n                }\n            } else {\n                radiusMap[circle[0]] = 1\n\n            }\n\n        default:    \n        }\n    }\n</code></pre>\n\n<p>Is the loop that will pass the int to the failChannel. I am doing an int channel because I want to see if a lower radius failed, and if so stop. I made it just any int right now as a test. </p>\n\n<p>Does anyone have any clue why this would be hanging? It doesn't seem to make sense to me. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "edited": false, "score": 0, "creation_date": 1460380256, "post_id": 36549600, "comment_id": 60699985, "body": "the scan() stops either by reaching the end of the input or an error"}, {"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1460381566, "post_id": 36549600, "comment_id": 60701094, "body": "<a href=\"https://golang.org/pkg/bufio/#Scanner.Scan\" rel=\"nofollow noreferrer\">golang.org/pkg/bufio/#Scanner.Scan</a>"}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1460382214, "post_id": 36549600, "comment_id": 60701641, "body": "Agree with @icza it&#39;s a duplicate. By the way just curious according to what document it is supposed to stop for a blank newline?"}, {"owner": {"reputation": 110, "user_id": 2095115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5686c6cef3261b63f6d277dff433d75?s=128&d=identicon&r=PG", "display_name": "Hewei Liu", "link": "https://stackoverflow.com/users/2095115/hewei-liu"}, "reply_to_user": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 1, "creation_date": 1460441030, "post_id": 36549600, "comment_id": 60729441, "body": "@AlexanderTrakhimenok I misunderstand the document. I&#39;ve got the answer from the duplicate question. Thanks."}], "answers": [{"comments": [{"owner": {"reputation": 110, "user_id": 2095115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5686c6cef3261b63f6d277dff433d75?s=128&d=identicon&r=PG", "display_name": "Hewei Liu", "link": "https://stackoverflow.com/users/2095115/hewei-liu"}, "edited": false, "score": 1, "creation_date": 1460440854, "post_id": 36552007, "comment_id": 60729358, "body": "Thanks for the answer."}, {"owner": {"reputation": 1048, "user_id": 1281652, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/46a85c94539819d787e4eb6d6c604d23?s=128&d=identicon&r=PG&f=1", "display_name": "rgb", "link": "https://stackoverflow.com/users/1281652/rgb"}, "edited": false, "score": 0, "creation_date": 1566238948, "post_id": 36552007, "comment_id": 101585822, "body": "You can simulate <code>EOF</code> in terminal. On <b>Linux</b> is <code>CTRL + D</code>, on <b>Windows</b> <code>CTRL + Z</code>: <a href=\"https://stackoverflow.com/questions/1118957/c-how-to-simulate-an-eof\">source</a>"}], "tags": [], "owner": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "is_accepted": true, "score": 3, "last_activity_date": 1460386028, "creation_date": 1460386028, "answer_id": 36552007, "question_id": 36549600, "link": "https://stackoverflow.com/questions/36549600/how-to-break-from-the-scanner-scan-for-loop/36552007#36552007", "title": "How to break from the scanner.scan() for-loop?", "body": "<p>You may input some specific string as a signal to stop the loop. In the below example, whenever \"quit\" is entered, the loop breaks.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"os\"\n)\n\nfunc main() {\n    input := bufio.NewScanner(os.Stdin)\n    for input.Scan() {\n        indata := input.Text()\n        if indata == \"quit\" {\n            break\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 110, "user_id": 2095115, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5686c6cef3261b63f6d277dff433d75?s=128&d=identicon&r=PG", "display_name": "Hewei Liu", "link": "https://stackoverflow.com/users/2095115/hewei-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2052, "favorite_count": 0, "closed_date": 1460440810, "accepted_answer_id": 36552007, "answer_count": 1, "score": 0, "last_activity_date": 1460386028, "creation_date": 1460379997, "question_id": 36549600, "link": "https://stackoverflow.com/questions/36549600/how-to-break-from-the-scanner-scan-for-loop", "closed_reason": "Duplicate", "title": "How to break from the scanner.scan() for-loop?", "body": "<p>When I use \"bufio\" package, the standard code is just like:</p>\n\n<pre><code>input := bufio.NewScanner(os.Stdin)\nfor input.Scan() {\n    // xxxxx\n}\n</code></pre>\n\n<p>When I run the program, the for-loop can't stop whatever I input. I have tried newline, space, ctrl-d, ctrl-z. According to the document, a blank newline should be able to stop the program.</p>\n\n<p>The program is running under Windows 7 CMD environment, or mingw-bash.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "concurrency", "rwlock"], "answers": [{"tags": [], "owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "is_accepted": false, "score": 8, "last_activity_date": 1460397594, "creation_date": 1460397594, "answer_id": 36555912, "question_id": 36548702, "link": "https://stackoverflow.com/questions/36548702/read-preferring-rw-mutex-lock-in-golang/36555912#36555912", "title": "Read preferring RW mutex lock in Golang", "body": "<p><code>sync.RWMutex</code> implements both write preferred and read preferred locking.  It all depends on how you use it to gain either write preferred or read preferred.</p>\n\n<p>Taking your wikipedia link pseudo code as an example of Lock-For-Read (in a read-preferred situation):</p>\n\n<pre><code>* Input: mutex m, condition variable c, integer r (number of readers waiting), flag w (writer waiting).\n* Lock m (blocking).\n* While w:\n* wait c, m[a]\n* Increment r.\n* Unlock m.\n</code></pre>\n\n<p>And the Lock-For-Write pattern in a read-preferred sistuation as long as you are following the pattern above for Lock-For-Reads:</p>\n\n<pre><code>* Lock m (blocking).\n* While (w or r &gt; 0):\n* wait c, m\n* Set w to true.\n* Unlock m.\n</code></pre>\n\n<p>You can see this mechanism at play within how the <code>RWMutex</code> is implemented.  Remember, the Go framework is just Go code - view the code to see how it is implemented:</p>\n\n<p><a href=\"https://golang.org/src/sync/rwmutex.go?s=879:905#L20\" rel=\"noreferrer\">https://golang.org/src/sync/rwmutex.go?s=879:905#L20</a></p>\n\n<pre><code>29  // RLock locks rw for reading.\n30  func (rw *RWMutex) RLock() {\n31      if race.Enabled {\n32          _ = rw.w.state\n33          race.Disable()\n34      }\n35      if atomic.AddInt32(&amp;rw.readerCount, 1) &lt; 0 {\n36          // A writer is pending, wait for it.\n37          runtime_Semacquire(&amp;rw.readerSem)\n38      }\n39      if race.Enabled {\n40          race.Enable()\n41          race.Acquire(unsafe.Pointer(&amp;rw.readerSem))\n42      }\n43  }\n</code></pre>\n\n<p>A key to note is the <code>rw.readerSem</code> in the code above which gives you your <code>integer r</code> in the wikipedia example pattern, which languages (like Go and others) call a Semaphore:</p>\n\n<p><a href=\"http://www.golangpatterns.info/concurrency/semaphores\" rel=\"noreferrer\">http://www.golangpatterns.info/concurrency/semaphores</a></p>\n\n<p>The real meat of of the wait is on line 37, for the <code>runtime_Semaquire()</code>:</p>\n\n<p><a href=\"https://golang.org/src/sync/runtime.go\" rel=\"noreferrer\">https://golang.org/src/sync/runtime.go</a></p>\n\n<pre><code>11  // Semacquire waits until *s &gt; 0 and then atomically decrements it.\n12  // It is intended as a simple sleep primitive for use by the synchronization\n13  // library and should not be used directly.\n14  func runtime_Semacquire(s *uint32)\n</code></pre>\n\n<p>Knowing that, and seeing how a <code>RWMutex.RLock()</code> increments a read that number, you can refactor your code accordingly.  </p>\n\n<p>Take a look at how <code>RWMutex.RUnlock</code> decrements that but most importantly how <code>RWMutex.Lock()</code> forces the wait for all active readers:</p>\n\n<pre><code>71  // Lock locks rw for writing.\n72  // If the lock is already locked for reading or writing,\n73  // Lock blocks until the lock is available.\n74  // To ensure that the lock eventually becomes available,\n75  // a blocked Lock call excludes new readers from acquiring\n76  // the lock.\n77  func (rw *RWMutex) Lock() {\n78      if race.Enabled {\n79          _ = rw.w.state\n80          race.Disable()\n81      }\n82      // First, resolve competition with other writers.\n83      rw.w.Lock()\n84      // Announce to readers there is a pending writer.\n85      r := atomic.AddInt32(&amp;rw.readerCount, -rwmutexMaxReaders) + rwmutexMaxReaders\n86      // Wait for active readers.\n87      if r != 0 &amp;&amp; atomic.AddInt32(&amp;rw.readerWait, r) != 0 {\n88          runtime_Semacquire(&amp;rw.writerSem)\n89      }\n90      if race.Enabled {\n91          race.Enable()\n92          race.Acquire(unsafe.Pointer(&amp;rw.readerSem))\n93          race.Acquire(unsafe.Pointer(&amp;rw.writerSem))\n94      }\n95  }\n</code></pre>\n\n<p>That's most likely why you are seeing the 2nd reader waiting.</p>\n\n<p>Remember, the Semaphores are shared across not just the <code>RWMutex</code> instance you created, but also throughout the runtime to schedule around other goroutines and other locks.  Hence why trying to force a pattern can do more harm than good overall in an app.</p>\n\n<p>My advise would be to take a step back and consider why you want read-preferred locking in your architecture at all.  Are you truly at a performance level that CPU context switching is slowing down your high frequency application? I'd say there's a more systematic approach that could be taken instead of trying to implement a 'read-preferred locking` pattern just because it sounds cool and sounds like it solve all your problems.  What are your benchmarks numbers?  What is the size of input data, and across how many concurrent processes?  Does it have to be shared?  Is it under X GB of memory consumption and can you switch to putting things on the stack (e.g. channels, no mutex locking)?  What about the read data on the stack and keep a write set for locking?  For how long until the GC cleans up the stack vs having to keep things on the heap?  Etc etc.</p>\n"}, {"comments": [{"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 0, "creation_date": 1460407247, "post_id": 36557757, "comment_id": 60718080, "body": "Nice.  I don&#39;t use mutex&#39;s a lot and just gave the long spill on how one would research it."}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 2, "last_activity_date": 1460403499, "creation_date": 1460403499, "answer_id": 36557757, "question_id": 36548702, "link": "https://stackoverflow.com/questions/36548702/read-preferring-rw-mutex-lock-in-golang/36557757#36557757", "title": "Read preferring RW mutex lock in Golang", "body": "<p>Seems you can achieve desired behaviour with <code>sync.WaitGroup</code> <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow\">sync primitive</a> for example</p>\n\n<pre><code>var wg sync.WaitGroup\ngo func() {\n            defer fmt.Println(\"done second read\")\n            fmt.Println(\"second read req\")\n            y.RLock()   //wait writer\n            wg.Add(1)   //report busy\n            fmt.Println(\"after second read granted\")\n            defer wg.Done() //report done\n            defer y.RUnlock()\n        }()\n//forcing writer to wait all readers\ngo func() {\n            defer fmt.Println(\"done first write\")\n            fmt.Println(\"first write req\")\n            wg.Wait()  //wait all readers\n            y.Lock()\n            fmt.Println(\"after first write granted\")\n            defer y.Unlock()\n        }()\n</code></pre>\n\n<p>You can try <a href=\"https://play.golang.org/p/y831xIrglj\" rel=\"nofollow\">https://play.golang.org/p/y831xIrglj</a></p>\n"}], "owner": {"reputation": 1024, "user_id": 2702306, "user_type": "registered", "accept_rate": 32, "profile_image": "https://i.stack.imgur.com/FlJhs.jpg?s=128&g=1", "display_name": "IhtkaS", "link": "https://stackoverflow.com/users/2702306/ihtkas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5600, "favorite_count": 1, "answer_count": 2, "score": 4, "last_activity_date": 1460403499, "creation_date": 1460377648, "question_id": 36548702, "link": "https://stackoverflow.com/questions/36548702/read-preferring-rw-mutex-lock-in-golang", "title": "Read preferring RW mutex lock in Golang", "body": "<p>I need a <a href=\"https://en.wikipedia.org/wiki/Readers%E2%80%93writer_lock\" rel=\"nofollow\">read preferring RW</a> mutex in golang. Is there a package in golang that will satisfy my needs. I tried sync.RWMutex, but it seems to be write preferring lock. Here goes my attempt to distinguish Go's RWMutex,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n\ny := &amp;resource{x: 10}\n\ngo func() {\n    defer fmt.Println(\"done first read\")\n    y.RLock()\n    defer y.RUnlock()\n    go func() {\n        defer fmt.Println(\"done first write\")\n        fmt.Println(\"first write req\")\n        y.Lock()\n        fmt.Println(\"after first write granted\")\n        defer y.Unlock()\n    }()\n    time.Sleep(time.Second)\n    go func() {\n        defer fmt.Println(\"done second read\")\n        fmt.Println(\"second read req\")\n        y.RLock()\n        fmt.Println(\"after second read granted\")\n        defer y.RUnlock()\n    }()\n\n    time.Sleep(10 * time.Second)\n}()\n\ntime.Sleep(time.Minute)\n\n}\n\ntype resource struct {\n    sync.RWMutex\n    x int\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>first write req\nsecond read req\ndone first read\nafter first write granted\ndone first write\nafter second read granted\ndone second read\n</code></pre>\n\n<p>Second reader is kept waiting till the writer releases the lock.</p>\n"}, {"tags": ["go", "build"], "answers": [{"comments": [{"owner": {"reputation": 3063, "user_id": 450598, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/780c14039de44c48349f578fdcfa66e0?s=128&d=identicon&r=PG", "display_name": "soupdiver", "link": "https://stackoverflow.com/users/450598/soupdiver"}, "edited": false, "score": 0, "creation_date": 1460375204, "post_id": 36546892, "comment_id": 60696212, "body": "The idea is to build everything under the path <code>github.com&#47;...&#47;cmd&#47;...</code> at once and not for every binary"}, {"owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "reply_to_user": {"reputation": 3063, "user_id": 450598, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/780c14039de44c48349f578fdcfa66e0?s=128&d=identicon&r=PG", "display_name": "soupdiver", "link": "https://stackoverflow.com/users/450598/soupdiver"}, "edited": false, "score": 1, "creation_date": 1460375829, "post_id": 36546892, "comment_id": 60696661, "body": "So append &quot;...&quot; to your directory path (like you did). In Go, &quot;x/...&quot; means &quot;every path under x/&quot;."}, {"owner": {"reputation": 3063, "user_id": 450598, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/780c14039de44c48349f578fdcfa66e0?s=128&d=identicon&r=PG", "display_name": "soupdiver", "link": "https://stackoverflow.com/users/450598/soupdiver"}, "edited": false, "score": 0, "creation_date": 1460382969, "post_id": 36546892, "comment_id": 60702259, "body": "As I described in my question: When adding <code>...</code> then NO files are placed into my current dir. Only if I specify an exact binary to build it will be placed into my current dir."}, {"owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "reply_to_user": {"reputation": 3063, "user_id": 450598, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/780c14039de44c48349f578fdcfa66e0?s=128&d=identicon&r=PG", "display_name": "soupdiver", "link": "https://stackoverflow.com/users/450598/soupdiver"}, "edited": false, "score": 0, "creation_date": 1460392200, "post_id": 36546892, "comment_id": 60708898, "body": "Please post a concrete case of what you&#39;re trying to do, not an example. Post the command and the output. Use &quot;go build -v&quot; to enable more verbose output. I&#39;m running the command I posted in my answer and it generates a binary file in my current directory (which is somewhere very different from where the code is). It should also work for you."}, {"owner": {"reputation": 3063, "user_id": 450598, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/780c14039de44c48349f578fdcfa66e0?s=128&d=identicon&r=PG", "display_name": "soupdiver", "link": "https://stackoverflow.com/users/450598/soupdiver"}, "edited": false, "score": 0, "creation_date": 1460392532, "post_id": 36546892, "comment_id": 60709115, "body": "This is exactly my use case. On a CI system I have to build a Docker image. So I <code>cd</code> into the dir where the <code>Dockerfile</code> is. I need <code>...&#47;cmd&#47;cliA</code> and <code>...&#47;cmd&#47;cliB</code> to build into my current dir. I could build <code>cliA</code> and <code>cliB</code> one after another but I would like to have it in one command. But <code>go build ...&#47;cmd&#47;...</code> does NOT build BOTH binaries into my current dir. This only happens if I specify <code>cliA</code> or <code>cliB</code> explicitly"}, {"owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "reply_to_user": {"reputation": 3063, "user_id": 450598, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/780c14039de44c48349f578fdcfa66e0?s=128&d=identicon&r=PG", "display_name": "soupdiver", "link": "https://stackoverflow.com/users/450598/soupdiver"}, "edited": false, "score": 0, "creation_date": 1460393187, "post_id": 36546892, "comment_id": 60709536, "body": "File paths don&#39;t start with &quot;...&quot;. Try &quot;go build ./cmd/...&quot;, assuming you&#39;re in the directory which contains &quot;cmd&quot;."}], "tags": [], "owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "is_accepted": false, "score": 1, "last_activity_date": 1460372634, "creation_date": 1460372634, "answer_id": 36546892, "question_id": 36546681, "link": "https://stackoverflow.com/questions/36546681/build-multiple-binaries-into-current-directory/36546892#36546892", "title": "Build multiple binaries into current directory", "body": "<p>You can compile your binary using the project's file path (instead of the package name) to generate them in your current directory.</p>\n\n<p>For example:</p>\n\n<pre><code>$ go build ~/Go/src/github.com/.../cmd\n</code></pre>\n\n<p>And the binaries will be in your current directory.</p>\n"}, {"tags": [], "owner": {"reputation": 1108, "user_id": 2127103, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8HRpT.jpg?s=128&g=1", "display_name": "N&#225;ndor Kr&#225;cser", "link": "https://stackoverflow.com/users/2127103/n%c3%a1ndor-kr%c3%a1cser"}, "is_accepted": false, "score": 0, "last_activity_date": 1488800754, "creation_date": 1488800754, "answer_id": 42624834, "question_id": 36546681, "link": "https://stackoverflow.com/questions/36546681/build-multiple-binaries-into-current-directory/42624834#42624834", "title": "Build multiple binaries into current directory", "body": "<p>From <code>go build -h</code>:</p>\n\n<blockquote>\n  <p>When compiling multiple packages or a single non-main package,\n  build compiles the packages but discards the resulting object,\n  serving only as a check that the packages can be built.</p>\n</blockquote>\n\n<p>But you can use this one-liner to achieve the same result (only the binaries directly under cmd will be built):\n<code>find $GOPATH/src/github.com/.../cmd -mindepth 1 -maxdepth 1 | xargs -n1 go build</code></p>\n"}, {"comments": [{"owner": {"reputation": 3063, "user_id": 450598, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/780c14039de44c48349f578fdcfa66e0?s=128&d=identicon&r=PG", "display_name": "soupdiver", "link": "https://stackoverflow.com/users/450598/soupdiver"}, "edited": false, "score": 0, "creation_date": 1548841960, "post_id": 54407726, "comment_id": 95684731, "body": "The actual discussion thread is here: <a href=\"https://github.com/golang/go/issues/14295\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/14295</a>. At least after &quot;some&quot; it seems it will make its way into Go :D"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 1, "last_activity_date": 1548698280, "creation_date": 1548698280, "answer_id": 54407726, "question_id": 36546681, "link": "https://stackoverflow.com/questions/36546681/build-multiple-binaries-into-current-directory/54407726#54407726", "title": "Build multiple binaries into current directory", "body": "<p>As the <a href=\"https://github.com/golang/go/issues/23616\" rel=\"nofollow noreferrer\">issue 23616</a> states:</p>\n\n<blockquote>\n  <p>The fact that <code>go build</code> doesn't build is counter-intuitive</p>\n</blockquote>\n\n<p>You will be able to get multiple binaries in your current directory when... the issue <a href=\"https://github.com/golang/go/issues/14295#issuecomment-411862866\" rel=\"nofollow noreferrer\">14295 \"cmd/go: go build should be able to write multiple executables\"</a> will be completed.</p>\n\n<p>But that will be for Go 1.13 (not 1.12, so late 2019)</p>\n\n<blockquote>\n  <p>This is so close to working. I'm not sure why it doesn't.<br>\n  We should fix it for Go 1.12.<br>\n  Clearly <code>-o</code> can't be used with multiple binary targets, but the implicit \"write to the current directory\" should work, and instead it does nothing.</p>\n  \n  <p>There is a bit of discussion on the proposed CL, as well s the comment that the CL as implemented breaks <code>go build -a std cmd</code>.</p>\n</blockquote>\n\n<p>See <a href=\"https://go-review.googlesource.com/c/go/+/143139/\" rel=\"nofollow noreferrer\">CL 143139/</a> (<a href=\"https://stackoverflow.com/a/27520705/6309\">CL = \"Change List\"</a>).</p>\n"}], "owner": {"reputation": 3063, "user_id": 450598, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/780c14039de44c48349f578fdcfa66e0?s=128&d=identicon&r=PG", "display_name": "soupdiver", "link": "https://stackoverflow.com/users/450598/soupdiver"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2305, "favorite_count": 1, "accepted_answer_id": 54407726, "answer_count": 3, "score": 1, "last_activity_date": 1548698280, "creation_date": 1460372060, "question_id": 36546681, "link": "https://stackoverflow.com/questions/36546681/build-multiple-binaries-into-current-directory", "title": "Build multiple binaries into current directory", "body": "<p>When doing <code>go build github.com/.../foo</code> from any directory, the compiled binary will be placed in the directory from which I executed the command. When doing <code>go build /github.com/.../cmd/...</code> I expected all of the compiled binaries to appear in my current directory. But they don't.</p>\n\n<p>How can I compile multiple/all binaries of that package into my current work dir?</p>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 3328, "user_id": 1825593, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t3gK8.jpg?s=128&g=1", "display_name": "prl900", "link": "https://stackoverflow.com/users/1825593/prl900"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1460368909, "post_id": 36542385, "comment_id": 60691954, "body": "The main problem here is casting the array into a new type, not the array to slice same type transformation..."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1460368980, "post_id": 36542385, "comment_id": 60691994, "body": "Sorry, missed that. there&#39;s no way other than a loop, but of course no need to manually do it one by one."}], "answers": [{"tags": [], "owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "is_accepted": true, "score": 1, "last_activity_date": 1460372740, "creation_date": 1460372740, "answer_id": 36546929, "question_id": 36542385, "link": "https://stackoverflow.com/questions/36542385/casting-a-cgo-array-into-a-slice/36546929#36546929", "title": "casting a cgo array into a slice", "body": "<p>You have the normal and safe way of doing this:</p>\n\n<pre><code>c := [6]C.double{ 1, 2, 3, 4, 5, 6 }\nfs := make([]float64, len(c))\nfor i := range c {\n        fs[i] = float64(c[i])\n}\n</code></pre>\n\n<p>Or you could cheat unportably and do this:</p>\n\n<pre><code>c := [6]C.double{ 1, 2, 3, 4, 5, 6 }\ncfa := (*[6]float64)(unsafe.Pointer(&amp;c))\ncfs := cfa[:]\n</code></pre>\n\n<p>If <code>C.double</code> and <code>float64</code> are the same underlying type we can take a pointer to the C.double array, unsafely cast it to a pointer to a same size float64 array, then take a slice of that array.</p>\n\n<p>Of course it's called <code>unsafe</code> for a very good reason. </p>\n"}], "owner": {"reputation": 3328, "user_id": 1825593, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t3gK8.jpg?s=128&g=1", "display_name": "prl900", "link": "https://stackoverflow.com/users/1825593/prl900"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1132, "favorite_count": 1, "accepted_answer_id": 36546929, "answer_count": 1, "score": 0, "last_activity_date": 1460372740, "creation_date": 1460359689, "last_edit_date": 1460368718, "question_id": 36542385, "link": "https://stackoverflow.com/questions/36542385/casting-a-cgo-array-into-a-slice", "title": "casting a cgo array into a slice", "body": "<p>At the moment I do this for casting a CGO array of doubles into a slice of float64:</p>\n\n<pre><code>doubleSlc := [6]C.double{}\n\n// Fill doubleSlc\n\nfloatSlc := []float64{float64(doubleSlc[0]), float64(doubleSlc[1]), float64(doubleSlc[2]),\n                      float64(doubleSlc[3]), float64(doubleSlc[4]), float64(doubleSlc[5])}\n</code></pre>\n\n<p>Is there a less cumbersome way of doing the same thing? I suppose this can also be seen as a general way of casting between slices/arrays of different types in Go.</p>\n"}, {"tags": ["xml", "go", "unmarshalling", "gml-geographic-markup-lan", "xml-encoding"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 6186749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/878ca405737fc2d79956f60267e7bd90?s=128&d=identicon&r=PG&f=1", "display_name": "user6186749", "link": "https://stackoverflow.com/users/6186749/user6186749"}, "edited": false, "score": 0, "creation_date": 1460365989, "post_id": 36542531, "comment_id": 60689840, "body": "Thanks, I probably should have mentioned the original tagging came from using github.com/wicast/xj2s. I changed the flat structure that tool came up with, but obviously got it wrong. I thought the tags were a little verbose. That all works perfectly now."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1473775609, "last_edit_date": 1473775609, "creation_date": 1460360178, "answer_id": 36542531, "question_id": 36541694, "link": "https://stackoverflow.com/questions/36541694/error-unmarshalling-gml-with-golang-encoding-xml/36542531#36542531", "title": "Error unmarshalling GML with golang encoding/xml", "body": "<p>An XML tag can only be mapped to (at most) one struct field. The <a href=\"https://golang.org/pkg/encoding/xml/\" rel=\"nofollow\"><code>encoding/xml</code></a> package has to decide for each XML tag into which struct field it will be decoded. Your structs that model the XML are weird, and make this decision ambiguous.</p>\n\n<p>For example let's take this example:</p>\n\n<pre><code>type FeatureCollection struct {\n    ...\n    LowerCorner    string   `xml:\"boundedBy&gt;Envelope&gt;lowerCorner\"`\n    UpperCorner    string   `xml:\"boundedBy&gt;Envelope&gt;upperCorner\"`\n    Envelope       Envelope `xml:\"boundedBy&gt;Envelope\"`\n    ...\n}\n</code></pre>\n\n<p>The <code>encoding/xml</code> package can't decide where the XML tag <code>&lt;Envelope&gt;</code> should be decoded into, e.g. into <code>LowerCorner</code>? into <code>UpperCorner</code>? into <code>Envelope</code>? Yes, I know <code>LowerCorner</code> is only a sub-element of <code>&lt;Envelope&gt;</code> but since the whole <code>&lt;Envelope&gt;</code> element is mapped to <code>FeatureCollection.Envelope</code>, this is not allowed.</p>\n\n<p>You should move <code>LowerCorner</code> and <code>UpperCorner</code> fields into your <code>Envelope</code> struct type because that's where they belong to and you want to unmarshal the whole <code>Envelope</code> xml tag (or if not, <code>FeatureCollection.Envelope</code> could be removed entirely). So follow this pattern to put fields to where they belong.</p>\n\n<p>Here is your updated model which extracts all the info you wanted:</p>\n\n<pre><code>type FeatureCollection struct {\n    Xsi            string   `xml:\"xsi,attr\"`\n    Fme            string   `xml:\"fme,attr\"`\n    Gml            string   `xml:\"gml,attr\"`\n    Xlink          string   `xml:\"xlink,attr\"`\n    Envelope       Envelope `xml:\"boundedBy&gt;Envelope\"`\n    SchemaLocation string   `xml:\"schemaLocation,attr\"`\n    FeaturesGML    []GML    `xml:\"featureMember&gt;GML\"`\n}\ntype Envelope struct {\n    SrsName      string `xml:\"srsName,attr\"`\n    SrsDimension string `xml:\"srsDimension,attr\"`\n    LowerCorner  string `xml:\"lowerCorner\"`\n    UpperCorner  string `xml:\"upperCorner\"`\n}\ntype GML struct {\n    ID          string `xml:\"id,attr\"`\n    PlaceID     string `xml:\"Place_ID\"`\n    StateID     string `xml:\"STATE_ID\"`\n    Postcode    string `xml:\"POSTCODE\"`\n    CGDN        string `xml:\"CGDN\"`\n    Map100K     string `xml:\"MAP_100K\"`\n    Point       Point  `xml:\"pointProperty&gt;Point\"`\n    VariantName string `xml:\"VARIANT_NAME\"`\n    RecordID    string `xml:\"RECORD_ID\"`\n    LatSeconds  string `xml:\"lat_seconds\"`\n    Status      string `xml:\"STATUS\"`\n    LongSeconds string `xml:\"long_seconds\"`\n    ConciseGAZ  string `xml:\"CONCISE_GAZ\"`\n    Lattitude   string `xml:\"LATITUDE\"`\n    AuthorityID string `xml:\"AUTHORITY_ID\"`\n    Longitude   string `xml:\"LONGITUDE\"`\n    LongMinutes string `xml:\"long_minutes\"`\n    LatDegrees  string `xml:\"lat_degrees\"`\n    NAME        string `xml:\"NAME\"`\n    LatMinutes  string `xml:\"lat_minutes\"`\n    ObjectID    string `xml:\"OBJECTID\"`\n    FeatCode    string `xml:\"FEAT_CODE\"`\n    LongDegrees string `xml:\"long_degrees\"`\n}\ntype Point struct {\n    SrsName      string `xml:\"srsName,attr\"`\n    SrsDimension string `xml:\"srsDimension,attr\"`\n    Pos          string `xml:\"pos\"`\n}\n</code></pre>\n\n<p>Here is the modified version of your code on the <a href=\"http://play.golang.org/p/8SmwjsbpAQ\" rel=\"nofollow\">Go Playground</a> which runs without errors.</p>\n\n<p>To verify that your struct holds all the unmarshalled info from the XML:</p>\n\n<pre><code>fmt.Printf(\"%+v\", v)\n</code></pre>\n\n<p>Output:</p>\n\n<blockquote>\n  <p>&amp;{Xsi:<a href=\"http://www.w3.org/2001/XMLSchema-instance\" rel=\"nofollow\">http://www.w3.org/2001/XMLSchema-instance</a> Fme:<a href=\"http://www.safe.com/gml/fme\" rel=\"nofollow\">http://www.safe.com/gml/fme</a> Gml:<a href=\"http://www.opengis.net/gml\" rel=\"nofollow\">http://www.opengis.net/gml</a> Xlink:<a href=\"http://www.w3.org/1999/xlink\" rel=\"nofollow\">http://www.w3.org/1999/xlink</a> Envelope:{SrsName:EPSG:3112 SrsDimension:2 LowerCorner:45.2921142578125 -80.2166748046875 UpperCorner:169.000122070313 -9.14251708984375} SchemaLocation:<a href=\"http://www.safe.com/gml/fme\" rel=\"nofollow\">http://www.safe.com/gml/fme</a> tblMainGML.xsd FeaturesGML:[{ID:id5255fa48-42b3-43d1-9e0d-b2ba8b57a936 PlaceID:45880 StateID:QLD Postcode: CGDN:N Map100K:7272 Point:{SrsName:EPSG:3112 SrsDimension:2 Pos:141.625915527344 -12.5836181640625} VariantName: RecordID:QLD48234 LatSeconds:0 Status:U LongSeconds:32 ConciseGAZ:N Lattitude:-12.58361 AuthorityID:QLD Longitude:141.62583 LongMinutes:37 LatDegrees:-12 NAME:HATCHMAN POINT LatMinutes:35 ObjectID:1 FeatCode:PT LongDegrees:141}]}</p>\n</blockquote>\n"}], "owner": {"reputation": 13, "user_id": 6186749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/878ca405737fc2d79956f60267e7bd90?s=128&d=identicon&r=PG&f=1", "display_name": "user6186749", "link": "https://stackoverflow.com/users/6186749/user6186749"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 346, "favorite_count": 0, "accepted_answer_id": 36542531, "answer_count": 1, "score": 1, "last_activity_date": 1473775609, "creation_date": 1460357453, "last_edit_date": 1460361290, "question_id": 36541694, "link": "https://stackoverflow.com/questions/36541694/error-unmarshalling-gml-with-golang-encoding-xml", "title": "Error unmarshalling GML with golang encoding/xml", "body": "<p>I am trying to unmarshal some XML, actually Geography Markup Language (GML).</p>\n\n<p>I have an example at <a href=\"http://play.golang.org/p/qS6GjCOtHF\" rel=\"nofollow\">http://play.golang.org/p/qS6GjCOtHF</a></p>\n\n<p>Two problems, the first:</p>\n\n<blockquote>\n  <p>error reading xml main.FeatureCollection field \"LowerCorner\" with tag \"boundedBy>Envelope>lowerCorner\" conflicts with field \"Envelope\" with tag \"boundedBy>Envelope\"</p>\n</blockquote>\n\n<p>I have no idea how to fix that. I commented those out and get the GML to unmarshal without errors but then there are no <code>Features</code> in the <code>FeatureCollection</code>.</p>\n\n<p>Any clues?</p>\n\n<p>An example of the GML is:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;gml:FeatureCollection xmlns:gml=\"http://www.opengis.net/gml\"\n    xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n    xmlns:fme=\"http://www.safe.com/gml/fme\" xsi:schemaLocation=\"http://www.safe.com/gml/fme tblMainGML.xsd\"&gt;\n    &lt;gml:boundedBy&gt;\n        &lt;gml:Envelope srsName=\"EPSG:3112\" srsDimension=\"2\"&gt;\n            &lt;gml:lowerCorner&gt;45.2921142578125 -80.2166748046875&lt;/gml:lowerCorner&gt;\n            &lt;gml:upperCorner&gt;169.000122070313 -9.14251708984375&lt;/gml:upperCorner&gt;\n        &lt;/gml:Envelope&gt;\n    &lt;/gml:boundedBy&gt;\n    &lt;gml:featureMember&gt;\n        &lt;fme:GML gml:id=\"id5255fa48-42b3-43d1-9e0d-b2ba8b57a936\"&gt;\n            &lt;fme:OBJECTID&gt;1&lt;/fme:OBJECTID&gt;\n            &lt;fme:RECORD_ID&gt;QLD48234&lt;/fme:RECORD_ID&gt;\n            &lt;fme:NAME&gt;HATCHMAN POINT&lt;/fme:NAME&gt;\n            &lt;fme:FEAT_CODE&gt;PT&lt;/fme:FEAT_CODE&gt;\n            &lt;fme:CGDN&gt;N&lt;/fme:CGDN&gt;\n            &lt;fme:AUTHORITY_ID&gt;QLD&lt;/fme:AUTHORITY_ID&gt;\n            &lt;fme:CONCISE_GAZ&gt;N&lt;/fme:CONCISE_GAZ&gt;\n            &lt;fme:LATITUDE&gt;-12.58361&lt;/fme:LATITUDE&gt;\n            &lt;fme:lat_degrees&gt;-12&lt;/fme:lat_degrees&gt;\n            &lt;fme:lat_minutes&gt;35&lt;/fme:lat_minutes&gt;\n            &lt;fme:lat_seconds&gt;0&lt;/fme:lat_seconds&gt;\n            &lt;fme:LONGITUDE&gt;141.62583&lt;/fme:LONGITUDE&gt;\n            &lt;fme:long_degrees&gt;141&lt;/fme:long_degrees&gt;\n            &lt;fme:long_minutes&gt;37&lt;/fme:long_minutes&gt;\n            &lt;fme:long_seconds&gt;32&lt;/fme:long_seconds&gt;\n            &lt;fme:STATE_ID&gt;QLD&lt;/fme:STATE_ID&gt;\n            &lt;fme:STATUS&gt;U&lt;/fme:STATUS&gt;\n            &lt;fme:VARIANT_NAME /&gt;\n            &lt;fme:MAP_100K&gt;7272&lt;/fme:MAP_100K&gt;\n            &lt;fme:Place_ID&gt;45880&lt;/fme:Place_ID&gt;\n            &lt;gml:pointProperty&gt;\n                &lt;gml:Point srsName=\"EPSG:3112\" srsDimension=\"2\"&gt;\n                    &lt;gml:pos&gt;141.625915527344 -12.5836181640625&lt;/gml:pos&gt;\n                &lt;/gml:Point&gt;\n            &lt;/gml:pointProperty&gt;\n        &lt;/fme:GML&gt;\n    &lt;/gml:featureMember&gt;\n&lt;/gml:FeatureCollection&gt;\n&lt;/xml&gt;\n</code></pre>\n\n<p>My structs</p>\n\n<pre><code>type FeatureCollection struct {\n    Xsi            string   `xml:\"xsi,attr\"`\n    Fme            string   `xml:\"fme,attr\"`\n    Gml            string   `xml:\"gml,attr\"`\n    Xlink          string   `xml:\"xlink,attr\"`\n    LowerCorner    string   `xml:\"boundedBy&gt;Envelope&gt;lowerCorner\"`\n    UpperCorner    string   `xml:\"boundedBy&gt;Envelope&gt;upperCorner\"`\n    Envelope       Envelope `xml:\"boundedBy&gt;Envelope\"`\n    SchemaLocation string   `xml:\"schemaLocation,attr\"`\n    Features       []Feature\n}\n\ntype Feature struct {\n    PlaceID     string `xml:\"featureMember&gt;GML&gt;Place_ID\"`\n    StateID     string `xml:\"featureMember&gt;GML&gt;STATE_ID\"`\n    Postcode    string `xml:\"featureMember&gt;GML&gt;POSTCODE\"`\n    CGDN        string `xml:\"featureMember&gt;GML&gt;CGDN\"`\n    Map100K     string `xml:\"featureMember&gt;GML&gt;MAP_100K\"`\nETC...\n}\n</code></pre>\n"}, {"tags": ["http", "go", "server", "http-content-range"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 28, "last_activity_date": 1460376953, "last_edit_date": 1460376953, "creation_date": 1460363129, "answer_id": 36543480, "question_id": 36540610, "link": "https://stackoverflow.com/questions/36540610/how-to-serve-http-partial-content-with-go/36543480#36543480", "title": "How to serve http partial content with Go?", "body": "<p>Serving partial content is non-trivial. See <a href=\"https://en.wikipedia.org/wiki/Byte_serving\" rel=\"noreferrer\">Byte serving</a> on wikipedia for an introduction. You have to handle specific status codes and headers (both request and response), which is not too hard but you shouldn't waste your time doing that yourself.</p>\n\n<p>If the content to serve (or serve from) is a file, you may use <a href=\"https://golang.org/pkg/net/http/#ServeFile\" rel=\"noreferrer\"><code>http.ServeFile()</code></a> just as you mentioned, which handles serving partial content (Range requests).</p>\n\n<p>If the content to be served is not present as a file, then <a href=\"https://golang.org/pkg/net/http/#ServeContent\" rel=\"noreferrer\"><code>http.ServeContent()</code></a> is your friend:</p>\n\n<pre><code>func ServeContent(w ResponseWriter, req *Request,\n    name string, modtime time.Time, content io.ReadSeeker)\n</code></pre>\n\n<p>And yes, it also handles serving partial content (Range requests):</p>\n\n<blockquote>\n  <p>The main benefit of ServeContent over io.Copy is that it handles Range requests properly, sets the MIME type, and handles If-Modified-Since requests.</p>\n</blockquote>\n\n<p>All you need to do is provide an <a href=\"https://golang.org/pkg/io/#ReadSeeker\" rel=\"noreferrer\"><code>io.ReadSeeker</code></a> \"view\" of your content, this is required so that the implementation can \"jump\" to the part that is requested by the client, the part that needs to be served. You might ask: how to do that?</p>\n\n<p>The <a href=\"https://golang.org/pkg/bytes/\" rel=\"noreferrer\"><code>bytes</code></a> package contains a type that implements <code>io.ReadSeeker</code>: <a href=\"https://golang.org/pkg/bytes/#Reader\" rel=\"noreferrer\"><code>bytes.Reader</code></a>.</p>\n\n<p>So for example if you have the content as a <code>[]byte</code>, you may obtain an <code>io.ReadSeeker</code> like this:</p>\n\n<pre><code>var content []byte\n// fill content\nr := bytes.NewReader(content)\n</code></pre>\n\n<p>And what if you don't have the whole content as a <code>[]byte</code>? One option is to provide a value of your own type that implements <code>io.ReadSeeker</code>.</p>\n\n<p><code>io.ReadSeeker</code> is:</p>\n\n<pre><code>type ReadSeeker interface {\n    Reader\n    Seeker\n}\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/io/#Reader\" rel=\"noreferrer\"><code>io.Reader</code></a> contains one method:</p>\n\n<pre><code>Read(p []byte) (n int, err error)\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/io/#Seeker\" rel=\"noreferrer\"><code>io.Seeker</code></a> also contains one method:</p>\n\n<pre><code>Seek(offset int64, whence int) (int64, error)\n</code></pre>\n\n<p>Your content is accessible somewhere, somehow, you know how. <code>Seek()</code> is called to let you know what part (position) is required from your content, and <code>Read()</code> is called so you can populate the passed slice (to provide the actual content). Note that these methods may be called multiple times, so you have to keep track where you are in your content (source). If you choose to go down this path, please read the doc of the linked interfaces to make sure you meet the \"general contract\" of the interfaces to avoid surprise errors.</p>\n"}], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6797, "favorite_count": 9, "accepted_answer_id": 36543480, "answer_count": 1, "score": 11, "last_activity_date": 1460376953, "creation_date": 1460353335, "last_edit_date": 1460364389, "question_id": 36540610, "link": "https://stackoverflow.com/questions/36540610/how-to-serve-http-partial-content-with-go", "title": "How to serve http partial content with Go?", "body": "<p>I have a webserver written in go and I'm serving some audio files from different sources (local, other servers, S3). I want to enable serving partial content for this files so the HTML audio tags are able to seek and loop.</p>\n\n<p>How can I achive this? I know that the <code>http</code> package <code>ServeContent</code> function does this but how can I do it by serving the files myself? I need to do it without this so that I can serve files from different sources with the same handler.</p>\n"}, {"tags": ["go", "build", "blockchain", "protocol-buffers"], "comments": [{"owner": {"reputation": 4124, "user_id": 2629095, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/680dfd61e8b392153c85cf93498b8100?s=128&d=identicon&r=PG", "display_name": "nevets", "link": "https://stackoverflow.com/users/2629095/nevets"}, "edited": false, "score": 2, "creation_date": 1460354323, "post_id": 36540427, "comment_id": 60683481, "body": "so you are sure by importing the package using <code>import github.com&#47;golang&#47;protobuf&#47;proto</code> does not help as suggested in the link you gave? why you insist using <code>google&#47;protobuf</code>?"}, {"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 0, "creation_date": 1460383140, "post_id": 36540427, "comment_id": 60702384, "body": "Post your Go code of how you are importing it.  It is quite obvious in the error messages that you are importing <code>googlr&#47;protobuf</code>, which is wrong. It has to be <code>import &quot;github.com&#47;GoLang&#47;protobuf&#47;proto&quot; </code>"}, {"owner": {"reputation": 261, "user_id": 5720093, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh6.googleusercontent.com/-kV6m51eFbYQ/AAAAAAAAAAI/AAAAAAAAB84/sNxLIKvSoxk/photo.jpg?sz=128", "display_name": "visweshn92", "link": "https://stackoverflow.com/users/5720093/visweshn92"}, "edited": false, "score": 0, "creation_date": 1460608497, "post_id": 36540427, "comment_id": 60824558, "body": "Updated. Please take a look"}], "answers": [{"comments": [{"owner": {"reputation": 261, "user_id": 5720093, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh6.googleusercontent.com/-kV6m51eFbYQ/AAAAAAAAAAI/AAAAAAAAB84/sNxLIKvSoxk/photo.jpg?sz=128", "display_name": "visweshn92", "link": "https://stackoverflow.com/users/5720093/visweshn92"}, "edited": false, "score": 0, "creation_date": 1460608153, "post_id": 36553334, "comment_id": 60824455, "body": "I edited my source code to have the import as mentioned. I get this similar error when I do the &#39;go get&#39;.  &quot;can&#39;t load package: package github.com/google/protobuf: no buildable Go source files in /home/vichu/go/src/github.com/google/protobuf&quot;"}, {"owner": {"reputation": 2349, "user_id": 653331, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8a4bf914078e4f4732891156dd917d69?s=128&d=identicon&r=PG&f=1", "display_name": "p_mcp", "link": "https://stackoverflow.com/users/653331/p-mcp"}, "reply_to_user": {"reputation": 261, "user_id": 5720093, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh6.googleusercontent.com/-kV6m51eFbYQ/AAAAAAAAAAI/AAAAAAAAB84/sNxLIKvSoxk/photo.jpg?sz=128", "display_name": "visweshn92", "link": "https://stackoverflow.com/users/5720093/visweshn92"}, "edited": false, "score": 0, "creation_date": 1460630742, "post_id": 36553334, "comment_id": 60837312, "body": "github.com/google/protobuf: isn&#39;t a go package, its C++, they are hosted at  <a href=\"https://github.com/golang/protobuf\" rel=\"nofollow noreferrer\">github.com/golang/protobuf</a>. Try go get github.com/golang/protobuf/proto and go get github.com/golang/protobuf/protoc-gen-go"}, {"owner": {"reputation": 462, "user_id": 6602159, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/phhUH.jpg?s=128&g=1", "display_name": "M. Rostami", "link": "https://stackoverflow.com/users/6602159/m-rostami"}, "edited": false, "score": 1, "creation_date": 1586028115, "post_id": 36553334, "comment_id": 107976770, "body": "So, why the google changed the src link to <code>go install google.golang.org&#47;protobuf&#47;cmd&#47;protoc-gen-go</code> that is not working for me? The same error occur if I use this src. However, your solution has worked."}], "tags": [], "owner": {"reputation": 2349, "user_id": 653331, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8a4bf914078e4f4732891156dd917d69?s=128&d=identicon&r=PG&f=1", "display_name": "p_mcp", "link": "https://stackoverflow.com/users/653331/p-mcp"}, "is_accepted": false, "score": 4, "last_activity_date": 1460630798, "last_edit_date": 1460630798, "creation_date": 1460389472, "answer_id": 36553334, "question_id": 36540427, "link": "https://stackoverflow.com/questions/36540427/cannot-find-package-google-protobuf/36553334#36553334", "title": "Cannot find package &quot;google/protobuf&quot;", "body": "<p>Firstly, your import is wrong, you are trying to import a C++ package, not a golang package. It needs to be:</p>\n\n<pre><code>import (\"github.com/golang/protobuf/proto\")\n</code></pre>\n\n<p>If you don't have this package installed already, you need to run from command line:</p>\n\n<pre><code>go get github.com/golang/protobuf/proto\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3, "user_id": 9468510, "user_type": "registered", "profile_image": "https://graph.facebook.com/1645777978822120/picture?type=large", "display_name": "Nguyen Nguyen Vu", "link": "https://stackoverflow.com/users/9468510/nguyen-nguyen-vu"}, "is_accepted": false, "score": 0, "last_activity_date": 1531713212, "creation_date": 1531713212, "answer_id": 51354368, "question_id": 36540427, "link": "https://stackoverflow.com/questions/36540427/cannot-find-package-google-protobuf/51354368#51354368", "title": "Cannot find package &quot;google/protobuf&quot;", "body": "<p>I think,  at the end of your *.pb.go file you also do not have some thing like \"gzipped FileDescriptorProto\n    0x1f, 0x8b, 0x08, 0x00 ....\" </p>\n\n<p>The issue is we use a wrong compiler for generating.</p>\n\n<p>So:</p>\n\n<p>1) I reinstall protobuf from: \n     <a href=\"https://github.com/google/protobuf/releases\" rel=\"nofollow noreferrer\">https://github.com/google/protobuf/releases</a></p>\n\n<p>2) Then (I'm using ubuntu and it has a proto compiler also):\n     apt remove protobuf-compiler</p>\n\n<p>Rebuild the *.proto file. It fixed the bug.</p>\n"}], "owner": {"reputation": 261, "user_id": 5720093, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh6.googleusercontent.com/-kV6m51eFbYQ/AAAAAAAAAAI/AAAAAAAAB84/sNxLIKvSoxk/photo.jpg?sz=128", "display_name": "visweshn92", "link": "https://stackoverflow.com/users/5720093/visweshn92"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10781, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1531713212, "creation_date": 1460352419, "last_edit_date": 1495541348, "question_id": 36540427, "link": "https://stackoverflow.com/questions/36540427/cannot-find-package-google-protobuf", "title": "Cannot find package &quot;google/protobuf&quot;", "body": "<p>I am compiling an open source project written in go (openblockchain). I get the following error when I do <code>go build</code>. Can anyone help me with this issue</p>\n\n<p><strong>Compilation Error</strong></p>\n\n<pre><code>&gt; go build\n../go/src/github.com/openblockchain/obc-peer/openchain/util/utils.go:28:2: cannot find package \"google/protobuf\" in any of:\n    /usr/src/pkg/google/protobuf (from $GOROOT)\n    /home/vichu/go/src/google/protobuf (from $GOPATH)\n</code></pre>\n\n<p><strong>Additional Information</strong></p>\n\n<p>I referred the question <a href=\"https://stackoverflow.com/questions/33930028/using-protoc-gen-go-creates-a-pb-go-that-imports-google-golang-but-cant-find-p\">here</a> in Stack Overflow but still no luck in solving the issue. Here is some more information about what all I have:</p>\n\n<p>Protoc version is up to date.</p>\n\n<pre><code>&gt; protoc --version \nlibprotoc 3.0.0\n</code></pre>\n\n<p>My environment variables</p>\n\n<pre><code>&gt; echo $GOPATH\n/home/vichu/go\n&gt; echo $GOBIN\n/home/vichu/go/bin\n</code></pre>\n\n<p>Protobuf has been built using the README.</p>\n\n<pre><code>~/go/src/github.com/golang/protobuf$ ls\nAUTHORS  CONTRIBUTORS  jsonpb  LICENSE  Makefile  Make.protobuf  proto  protoc-gen-go  proto.pb.go  ptypes  README.md\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>I did the following <code>Util.go</code> in source code as mentioned in answer.\nThe source code is open source and here is the <a href=\"https://github.com/openblockchain/obc-peer/blob/master/openchain/util/utils.go\" rel=\"nofollow noreferrer\">link</a></p>\n\n<pre><code>-       gp \"google/protobuf\"\n+       gp \"github.com/google/protobuf\"\n</code></pre>\n\n<p>When I do <code>go get</code>, the below is the error</p>\n\n<pre><code>&gt; go get github.com/google/protobuf\ncan't load package: package github.com/google/protobuf: no buildable Go source files in /home/vichu/go/src/github.com/google/protobuf\n</code></pre>\n"}, {"tags": ["http", "ssl", "go", "httprequest", "handshake"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1460352169, "post_id": 36540246, "comment_id": 60682666, "body": "An single http client should be used for all your requests. There&#39;s no point in creating many identical clients. As long as the timeouts are the same, just use the same client. It will likely fix your problem. A client is not a connection, it has internal connection pools and caching, etc."}, {"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1460352965, "post_id": 36540246, "comment_id": 60682917, "body": "@Not_a_Golfer - It helped me solving the first issue I guess [did a simple test]. I appreciate the help. But the other issue still exists :( . Something related to default retries I guess."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1460353193, "post_id": 36540246, "comment_id": 60683007, "body": "I&#39;m not sure what &quot;client&quot; means. it&#39;s probably more related to the buffer around the data string."}, {"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1460353493, "post_id": 36540246, "comment_id": 60683121, "body": "@Not_a_Golfer - I mean when I call the RequestService() function it makes 5 extra calls even after getting a successful response. But the <code>request</code> value is <code>undefined</code> for those calls."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1460353738, "post_id": 36540246, "comment_id": 60683218, "body": "you&#39;ll need to show how you&#39;re doing those 5 extra calls"}, {"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1460354311, "post_id": 36540246, "comment_id": 60683476, "body": "@Not_a_Golfer - I updated the question with the console output."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1460376086, "post_id": 36540246, "comment_id": 60696838, "body": "Print the error returned from client.Do.  It will likely explain the first issue. The app is leaking file descriptors because it creates a discards a transport on every request. Use a single transport."}], "owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 866, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1460354266, "creation_date": 1460351303, "last_edit_date": 1592644375, "question_id": 36540246, "link": "https://stackoverflow.com/questions/36540246/go-http-client-fails-after-several-requests", "title": "go http client fails after several requests", "body": "<p>I am using golang's net/http package in my application. In my use case I am trying to make http calls several times continuously using my custom http client. I am facing following issues with this.</p>\n<p><strong>Issue 1:</strong> After several calls [ ~100 less than a minute], client fails to make calls.I mean the request is not hitting the server.</p>\n<p>Here is my custom client code,</p>\n<pre><code>package serviceclient\n\nimport (\n    &quot;bytes&quot;\n    &quot;io/ioutil&quot;\n    &quot;net&quot;\n    &quot;net/http&quot;\n    &quot;time&quot;\n    &quot;log&quot;\n)\n\nconst(\n    HTTP_DIAL_TIME_OUT          = 5    //seconds\n    HTTP_TLS_HANDSHAKE_TIME_OUT = 5\n    HTTP_CLIENT_TIME_OUT        = 10\n)\n\n// RequestService requests the api through the service URL\nfunc RequestService(methodType string, serviceURL string, data string, contentType string) string {\n    log.Printf(&quot;Request string %s&quot;, data)\n    dataBytes := bytes.NewBufferString(data)\n    req, err := http.NewRequest(methodType, serviceURL, dataBytes)\n    if err != nil {\n        log.Printf(&quot;Client request creation issue&quot;)\n    }\n    req.Header.Set(&quot;Content-Type&quot;, contentType)\n\n    client := getHTTPClient()\n    res, err := client.Do(req)\n    log.Printf(&quot;Response Object original : %s&quot;, res)\n    if err != nil {\n        log.Printf(&quot;Could not make the client request&quot;)\n    }\n    defer res.Body.Close()\n    responseBytes, err := ioutil.ReadAll(res.Body)\n    if err != nil {\n        log.Printf(&quot;Response string conversion issue&quot;)\n    }\n    responseString := string(responseBytes[:])\n    return responseString\n}\n\nfunc getHTTPClient() *http.Client {\n    var netTransport = &amp;http.Transport{\n          Dial: (&amp;net.Dialer{\n            Timeout: HTTP_DIAL_TIME_OUT * time.Second,\n          }).Dial,\n          TLSHandshakeTimeout: HTTP_TLS_HANDSHAKE_TIME_OUT * time.Second,\n        }\n    var client = &amp;http.Client{\n          Timeout: time.Second * HTTP_CLIENT_TIME_OUT,\n          Transport: netTransport,\n        }\n    return client\n}\n</code></pre>\n<p><strong>Issue 2:</strong> Also every time the client tries to make calls even after successful response with an empty request[Not with the original request]. I mean when I call the RequestService() function it makes 5 extra calls even after getting a successful response. But the <code>request</code> value is <code>undefined</code> for those calls.</p>\n<p>Here is my console output[I printed the http request and few info] for one http call,</p>\n<pre><code>Got in appserver ops api  &amp;{GET /api/services/appserverops/ HTTP/1.1 1 1 map[Content-Type:[application/json] Accept-Encoding:[gzip] User-Agent:[Go-http-client/1.1] Content-Length:[160]] 0xc820398180 160 [] false localhost:8081 map[] map[] &lt;nil&gt; map[] [::1]:57455 /api/services/appserverops/ &lt;nil&gt; &lt;nil&gt;}\nappserveropslogic :: Getappserver() :: request Wg\nappserveropslogic :: Getappserver() :: response &amp;{{127 https://www.youtube.com/watch?v=0SMoqP9eCwM https://www.youtube.com/embed/0SMoqP9eCwM 1} {44 www.github.com/docker 1} 2016-04-09 05:38:32 {} 2016-04-09 05:38:32 [0xc82000c4c0 0xc8200d4da0 0xc82000c600] {1005   0 0    0    []} false}\n\nGot in appserver ops api  &amp;{GET /api/services/appserverops/ HTTP/1.1 1 1 map[User-Agent:[Go-http-client/1.1] Content-Length:[167] Content-Type:[application/json] Accept-Encoding:[gzip]] 0xc8203f4800 167 [] false localhost:8081 map[] map[] &lt;nil&gt; map[] [::1]:57455 /api/services/appserverops/ &lt;nil&gt; &lt;nil&gt;}\nappserveropslogic :: Getappserver() :: request undefined\nappserveropslogic :: Getappserver() :: response &lt;nil&gt;\n\nGot in appserver ops api  &amp;{GET /api/services/appserverops/ HTTP/1.1 1 1 map[User-Agent:[Go-http-client/1.1] Content-Length:[167] Content-Type:[application/json] Accept-Encoding:[gzip]] 0xc8203f4880 167 [] false localhost:8081 map[] map[] &lt;nil&gt; map[] [::1]:57455 /api/services/appserverops/ &lt;nil&gt; &lt;nil&gt;}\nappserveropslogic :: Getappserver() :: request undefined\nappserveropslogic :: Getappserver() :: response &lt;nil&gt;\n\nGot in appserver ops api  &amp;{GET /api/services/appserverops/ HTTP/1.1 1 1 map[User-Agent:[Go-http-client/1.1] Content-Length:[167] Content-Type:[application/json] Accept-Encoding:[gzip]] 0xc8203f49c0 167 [] false localhost:8081 map[] map[] &lt;nil&gt; map[] [::1]:57455 /api/services/appserverops/ &lt;nil&gt; &lt;nil&gt;}\nappserveropslogic :: Getappserver() :: request undefined\nappserveropslogic :: Getappserver() :: response &lt;nil&gt;\n\nGot in appserver ops api  &amp;{GET /api/services/appserverops/ HTTP/1.1 1 1 map[User-Agent:[Go-http-client/1.1] Content-Length:[167] Content-Type:[application/json] Accept-Encoding:[gzip]] 0xc8203f4a40 167 [] false localhost:8081 map[] map[] &lt;nil&gt; map[] [::1]:57455 /api/services/appserverops/ &lt;nil&gt; &lt;nil&gt;}\nappserveropslogic :: Getappserver() :: request undefined\nappserveropslogic :: Getappserver() :: response &lt;nil&gt;\n\nGot in appserver ops api  &amp;{GET /api/services/appserverops/ HTTP/1.1 1 1 map[User-Agent:[Go-http-client/1.1] Content-Length:[167] Content-Type:[application/json] Accept-Encoding:[gzip]] 0xc8203f4b00 167 [] false localhost:8081 map[] map[] &lt;nil&gt; map[] [::1]:57455 /api/services/appserverops/ &lt;nil&gt; &lt;nil&gt;}\nappserveropslogic :: Getappserver() :: request undefined\nappserveropslogic :: Getappserver() :: response &lt;nil&gt;\n\nGot in appserver ops api  &amp;{GET /api/services/appserverops/ HTTP/1.1 1 1 map[User-Agent:[Go-http-client/1.1] Content-Length:[167] Content-Type:[application/json] Accept-Encoding:[gzip]] 0xc8203f4c00 167 [] false localhost:8081 map[] map[] &lt;nil&gt; map[] [::1]:57455 /api/services/appserverops/ &lt;nil&gt; &lt;nil&gt;}\nappserveropslogic :: Getappserver() :: request undefined\nappserveropslogic :: Getappserver() :: response &lt;nil&gt;\n\nGot in appserver ops api  &amp;{GET /api/services/appserverops/ HTTP/1.1 1 1 map[User-Agent:[Go-http-client/1.1] Content-Length:[167] Content-Type:[application/json] Accept-Encoding:[gzip]] 0xc8203f4c80 167 [] false localhost:8081 map[] map[] &lt;nil&gt; map[] [::1]:57455 /api/services/appserverops/ &lt;nil&gt; &lt;nil&gt;}\nappserveropslogic :: Getappserver() :: request undefined\nappserveropslogic :: Getappserver() :: response &lt;nil&gt;\n</code></pre>\n<p>Am I doing anything wrong? Could someone help me with this?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 4, "last_activity_date": 1569586939, "last_edit_date": 1569586939, "creation_date": 1460332435, "answer_id": 36537807, "question_id": 36537806, "link": "https://stackoverflow.com/questions/36537806/what-does-b-do-in-fmt-printf-for-float64-and-what-is-min-subnormal-positive-d/36537807#36537807", "title": "What does &quot;%b&quot; do in fmt.Printf for float64 and what is Min subnormal positive double in float64 in binary format?", "body": "<p>I did some research and after many hours of research with IEEE 754 binary representation:<br>\nA good point to start is:</p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Double-precision_floating-point_format\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Double-precision_floating-point_format</a>\n<a href=\"https://en.wikipedia.org/wiki/IEEE_floating_point\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/IEEE_floating_point</a></p>\n\n<p>Results:</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"math\"\n    \"strconv\"\n       )\n\nfunc main() {\nfmt.Printf(\"0b%b\\n\", 255) //0b11111111\n\nfmt.Printf(\"%b\\n\", 1.0)               //4503599627370496p-52\nfmt.Printf(\"%#X\\n\", 4503599627370496) //0X10000000000000\n//float64: 1.0 = binary: 0X3FF0000000000000\n//so 4503599627370496*2**-52 =(\"1\"+\"Fraction\")*2**-52\n//=0X10 0000 0000 0000*2**-52=  2**52 * 2**-52 = 2**0 = 1=   significand\n//2**52=0x10 0000 0000 0000\n\n//1bit=sign 11bit=exponent-biased 52bit)=64 bit:\nfmt.Printf(\"%#X\\n\", math.Float64bits(1.0)) //1.0=0X3FF0000000000000\n//Exp: 0x3FF=1023=E(0) :bias=1023 Emin=1 Emax=2046    Exp=pow(2,0x3FF - 1023)=pow(2,0)=1\n//significant: 1.mantisa (53bit nice!) 1.0000000000000\n\n//1.0000000000000002, the smallest number &gt; 1\nfmt.Printf(\"%#X\\n\", math.Float64bits(1.0000000000000002)) //0X3FF0000000000001\n\n// 1.0000000000000004, the next numer after 1.0000000000000002\nfmt.Printf(\"%#X\\n\", math.Float64bits(1.0000000000000004)) //0X3FF0000000000002\n\nfmt.Printf(\"%#X\\n\", math.Float64bits(2.0))  //0X4000000000000000\nfmt.Printf(\"%#X\\n\", math.Float64bits(-2.0)) //0XC000000000000000\n\n// Min subnormal positive double\nfmt.Printf(\"%v\\n\", math.Float64frombits(1))   //5e-324\nfmt.Printf(\"%#X\\n\", math.Float64bits(5e-324)) //0X0000000000000001\n//Exp(2,-1022-52)=Exp(2,-1074)=5e-324\n\n//Max subnormal double\nfmt.Printf(\"%v\\n\", math.Float64frombits(0x000fffffffffffff)) //2.225073858507201e-308\n\nfmt.Printf(\"%v\\n\", math.Float64frombits(0X0000000000000000)) //0\nfmt.Printf(\"%v\\n\", math.Float64frombits(0X8000000000000000)) //-0\nfmt.Printf(\"%v\\n\", math.Float64frombits(0X7FF0000000000000)) //+Inf\nfmt.Printf(\"%v\\n\", math.Float64frombits(0XFFF0000000000000)) //-Inf\nfmt.Printf(\"%v\\n\", math.Float64frombits(0x7fffffffffffffff)) //NaN\n\nfmt.Printf(\"%#X\\n%[1]b\\n\", math.Float64bits(0.1)) //0X3FB 999999999999A\n//0 1111111011 1001100110011001100110011001100110011001100110011010\n\nfmt.Printf(\"%#X\\n%[1]b\\n\", math.Float64bits(0.2)) //0X3FC999999999999A\n//11111111001001100110011001100110011001100110011001100110011010\n\nfmt.Printf(\"%#X\\n%[1]b\\n\", math.Float64bits(0.3)) //0X3FD3333333333333\n//11111111010011001100110011001100110011001100110011001100110011\nfmt.Println(1.0 / 3.0) //0.3333333333333333\n//By default, 1/3 rounds down, instead of up like single precision,\n//because of the odd number of bits in the significand\nfmt.Printf(\"%#X\\n%[1]b\\n\", math.Float64bits(1.0/3.0)) //0X3FD5555555555555\n//11111111010101010101010101010101010101010101010101010101010101\n/*\n   Given the hexadecimal representation 3FD5 5555 5555 555516,\n     Sign = 0\n     Exponent = 0x3FD = 1021\n     Exponent Bias = 1023 (constant value)\n     Fraction = 5 5555 5555 555516\n     Value = 2(Exponent \u2212 Exponent Bias) \u00d7 1.Fraction // Note that Fraction must not be converted to decimal here\n           = 2**\u22122 \u00d7 (15 5555 5555 555516 \u00d7 2**\u221252)\n           = 2**\u221254 \u00d7 15 5555 5555 555516\n           = 0.333333333333333314829616256247390992939472198486328125\n           \u2248 1/3\n*/\n\nvar f float64 = 0.1\nvar bits uint64 = math.Float64bits(f) //IEEE 754 binary representation of f\nfmt.Printf(\"%#X %[1]b\\n\", bits)\n//0X3FB999999999999A 11111110111001100110011001100110011001100110011001100110011010\n\nfmt.Printf(\"%b\\n\", f) //7205759403792794p-56\nfmt.Printf(\"%b  %b\\n\", 7205759403792794, -56)\n//11001100110011001100110011001100110011001100110011010  111000\nfmt.Println(len(\"11001100110011001100110011001100110011001100110011010\"))\n//text search in this text=&gt; 53 bit right side\n\n// 1 11111110101 100011110110001111100111100101011000111010000110011\nfmt.Printf(\"-: %b\\n\", math.Float64bits(-0.1e+308)) // so left bit is sign bit\n//1 111111110101 100011110110001111100111100101011000111010000110011\nfmt.Printf(\"exp: %b\\n\", math.Float64bits(+0.1e-308))\n//1 01110000001 010101110010011010001111110110101111\n// 11Exponent bits\n\n//  12345678901\ni, err := strconv.ParseInt(\"11111110101\", 2, 64) //2037\nfmt.Println(\"E\", i-1023)                         //1014\n\nfmt.Printf(\"%b\\n\", 0.2) //7205759403792794p-55\nfmt.Printf(\"%b\\n\", 0.3) //5404319552844595p-54\n\nn, err := fmt.Printf(\"%b %b\\n\", 1.0, math.Float64bits(1.0))\n//4503599627370496p-52 11111111110000000000000000000000000000000000000000000000000000\nfmt.Println(n, err) //84 &lt;nil&gt;\n//no err\nfmt.Printf(\"'%[1]*.[2]*[3]f'\\n\", 12, 4, 1234.1234) //'   1234.1234'\n</code></pre>\n\n<p>}</p>\n\n<p>Conclusion:<br>\n <code>%b</code> for <code>float64</code> shows only <strong>significand</strong>, done.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 632, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1569586939, "creation_date": 1460332435, "last_edit_date": 1569586805, "question_id": 36537806, "link": "https://stackoverflow.com/questions/36537806/what-does-b-do-in-fmt-printf-for-float64-and-what-is-min-subnormal-positive-d", "title": "What does &quot;%b&quot; do in fmt.Printf for float64 and what is Min subnormal positive double in float64 in binary format?", "body": "<p>Go doc for <code>Package fmt Floating-point and complex constituents</code>\nsays:</p>\n\n<blockquote>\n  <p>Floating-point and complex constituents:<br>\n  %b  decimalless scientific notation with exponent a power of two,\n      in the manner of strconv.FormatFloat with the 'b' format,\n      e.g. -123456p-78  </p>\n</blockquote>\n\n<p>Code:</p>\n\n<pre><code>fmt.Printf(\"0b%b\\n\", 255) // 0b11111111\nfmt.Printf(\"%b\\n\", 1.0)   // 4503599627370496p-52 \n</code></pre>\n\n<p>What is <code>4503599627370496p-52</code>?   </p>\n"}, {"tags": ["arrays", "go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 1300, "user_id": 5368873, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d570671ba2f5b6a1ada7f35cc816f3d8?s=128&d=identicon&r=PG&f=1", "display_name": "Nirnae", "link": "https://stackoverflow.com/users/5368873/nirnae"}, "edited": false, "score": 0, "creation_date": 1460322210, "post_id": 36535458, "comment_id": 60674667, "body": "This fixed the compiling error, but now the sibling result is really weird, I&#39;ve got a total of 20268 similar words on a file that&#39;s only 20000 words long compared to a 1000 words long file O.O"}, {"owner": {"reputation": 2088, "user_id": 3309046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5ce388de97238b3147f3d4ba62b17cb?s=128&d=identicon&r=PG", "display_name": "nishanthshanmugham", "link": "https://stackoverflow.com/users/3309046/nishanthshanmugham"}, "reply_to_user": {"reputation": 1300, "user_id": 5368873, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d570671ba2f5b6a1ada7f35cc816f3d8?s=128&d=identicon&r=PG&f=1", "display_name": "Nirnae", "link": "https://stackoverflow.com/users/5368873/nirnae"}, "edited": false, "score": 0, "creation_date": 1460322439, "post_id": 36535458, "comment_id": 60674749, "body": "Since the slice is initialized to a length of 2000 and 40000, the range loop iterates over them all. Ignore empty strings, or make both slices with a length of 0 and append to them."}], "tags": [], "owner": {"reputation": 2088, "user_id": 3309046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5ce388de97238b3147f3d4ba62b17cb?s=128&d=identicon&r=PG", "display_name": "nishanthshanmugham", "link": "https://stackoverflow.com/users/3309046/nishanthshanmugham"}, "is_accepted": true, "score": 1, "last_activity_date": 1460322941, "last_edit_date": 1460322941, "creation_date": 1460321792, "answer_id": 36535458, "question_id": 36534813, "link": "https://stackoverflow.com/questions/36534813/count-similar-array-value/36535458#36535458", "title": "Count similar array value", "body": "<ol>\n<li>bufferUrl1 is an array: <code>[4000]string</code>. You meant to use <code>v</code> (each\nstring in <code>bufferUrl1</code>). But in fact, you meant to use the second\nvariable\u2014the first variable is the index which is ignored in the code\nbelow using <code>_</code>.</li>\n<li>type <code>[2000]string</code> is different from <code>[]string</code>. In Go, arrays and slices are not the same. Read <a href=\"http://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow\">Go Slices: usage and internals</a>. I've changed both variable declarations to use slices with the same initial length using make.</li>\n</ol>\n\n<p>These are changes you need to make to compile.</p>\n\n<p>Declarations:</p>\n\n<pre><code>// Create storing slices\nbuffer := make([]string, 2000)\nbufferUrl1 := make([]string, 40000)\n</code></pre>\n\n<p>and the loop on Line 69:</p>\n\n<pre><code>for _, s := range bufferUrl1 {\n    if stringInSlice(s, buffer) {\n        sibling++\n        fmt.Println(\"FIND\")\n    }\n}\n</code></pre>\n\n<p>As a side-note, consider using a map instead of a slice for <code>buffer</code> for more efficient lookup instead of looping through the list in <code>stringInSlice</code>. </p>\n\n<p><a href=\"https://play.golang.org/p/UcaSVwYcIw\" rel=\"nofollow\">https://play.golang.org/p/UcaSVwYcIw</a> has the fix for the comments below (you won't be able to make HTTP requests from the Playground).</p>\n"}], "owner": {"reputation": 1300, "user_id": 5368873, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d570671ba2f5b6a1ada7f35cc816f3d8?s=128&d=identicon&r=PG&f=1", "display_name": "Nirnae", "link": "https://stackoverflow.com/users/5368873/nirnae"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 364, "favorite_count": 0, "accepted_answer_id": 36535458, "answer_count": 1, "score": 0, "last_activity_date": 1460324340, "creation_date": 1460318063, "last_edit_date": 1460324340, "question_id": 36534813, "link": "https://stackoverflow.com/questions/36534813/count-similar-array-value", "title": "Count similar array value", "body": "<p>I'm trying to learn Go (or Golang) and can't seem to get it right. I have 2 texts files, each containing a list of words. I'm trying to count the amount of words that are present in both files.</p>\n\n<p>Here is my code so far :</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"bufio\"\n)\n\nfunc stringInSlice(str string, list []string) bool {\n    for _, v := range list {\n        if v == str {\n            return true\n        }\n    }\n    return false\n}\n\nfunc main() {\n    // Texts URL\n    var list = \"https://gist.githubusercontent.com/alexcesaro/c9c47c638252e21bd82c/raw/bd031237a56ae6691145b4df5617c385dffe930d/list.txt\"\n    var url1 = \"https://gist.githubusercontent.com/alexcesaro/4ebfa5a9548d053dddb2/raw/abb8525774b63f342e5173d1af89e47a7a39cd2d/file1.txt\"\n\n    //Create storing arrays\n    var buffer [2000]string\n    var bufferUrl1 [40000]string\n\n    // Set a sibling counter\n    var sibling = 0\n\n    // Read and store text files\n    wordList, err := http.Get(list)\n    if err != nil {\n        log.Fatalf(\"Error while getting the url : %v\", err)\n    }\n    defer wordList.Body.Close()\n\n    wordUrl1, err := http.Get(url1)\n    if err != nil {\n        log.Fatalf(\"Error while getting the url : %v\", err)\n    }\n    defer wordUrl1.Body.Close()\n\n    streamList := bufio.NewScanner(wordList.Body)\n    streamUrl1 := bufio.NewScanner(wordUrl1.Body)\n\n    streamList.Split(bufio.ScanLines)\n    streamUrl1.Split(bufio.ScanLines)\n\n    var i = 0;\n    var j = 0;\n\n    //Fill arrays with each lines\n    for streamList.Scan() {\n        buffer[i] = streamList.Text()\n        i++\n    }\n    for streamUrl1.Scan() {\n        bufferUrl1[j] = streamUrl1.Text()\n        j++\n    }\n\n    //ERROR OCCURRING HERE :\n    // This code if i'm not wrong is supposed to compare through all the range of bufferUrl1 -&gt; bufferUrl1 values with buffer values, then increment sibling and output FIND\n    for v := range bufferUrl1{\n        if stringInSlice(bufferUrl1, buffer) {\n            sibling++\n            fmt.Println(\"FIND\")\n        }\n    }\n\n    // As a testing purpose thoses lines properly paste both array\n    // fmt.Println(buffer)\n    // fmt.Println(bufferUrl1)\n\n}\n</code></pre>\n\n<p>But right now, my build doesn't even succeed. I'm only greeted with this message:</p>\n\n<pre><code>.\\hello.go:69: cannot use bufferUrl1 (type [40000]string) as type string in argument to stringInSlice\n.\\hello.go:69: cannot use buffer (type [2000]string) as type []string in argument to stringInSlice\n</code></pre>\n"}, {"tags": ["go", "html-parsing", "html-escape-characters"], "comments": [{"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 0, "creation_date": 1460337555, "post_id": 36534609, "comment_id": 60679197, "body": "Please edit and make the question clearer so it&#39;s easier for people to help you out. What was the key-value pair? Was it Javascript? How are you using it with Go? Provide Go code, and real information than just &quot;SOME HTML&quot;, &quot;Blah Blah&quot; and &quot;Bleh Bleh&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 1506, "user_id": 713486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c2a3b1ea7651ccc1259578b0f2853f4?s=128&d=identicon&r=PG", "display_name": "Brian", "link": "https://stackoverflow.com/users/713486/brian"}, "is_accepted": false, "score": 1, "last_activity_date": 1460338419, "creation_date": 1460338419, "answer_id": 36538490, "question_id": 36534609, "link": "https://stackoverflow.com/questions/36534609/how-to-parse-http-get-response-in-golang/36538490#36538490", "title": "How to Parse HTTP.GET response in Golang", "body": "<p>The easiest way is to extract the JSON and then unmarshal it into a struct. The <code>\\uXXXX</code> parts are unicode characters</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"regexp\"\n)\n\n// Data follows the structure of the JSON data in the response\ntype Data struct {\n    HTMLInfo  string `json:\"htmlInfo\"`\n    OtherInfo string `json:\"otherInfo\"`\n    MoreInfo  string `json:\"moreInfo\"`\n}\n\nfunc main() {\n    // input is an example of the raw response data. It's probably a []byte if\n    // you got it from ioutil.ReadAll(resp.Body)\n    input := []byte(`this=ajax({\"htmlInfo\":\"\\u003Cdiv class=\\u0022container columns-2\\u0022\\u003E\\n\\n \\u003Csection class=\\u0022col-main\\u0022\\u003E\\n \\r\\n\\u003Cdiv class=\\u0027visor-article-list list list-view-recent\\u0027 \\u003E\\r\\n\\u003Cdiv class=\\u0027grid_item visor-article-teaser list_default\\u0027 \\u003E\\n \\u003Ca class=\\u0027grid_img\\u0027 href=\\u0027/manUnited-is-the-best\\u0027\\u003E\\n \\u003Cimg src=\\u0022http://example.com/sites//files/styles/w400h22\", \"otherInfo\": \"Blah Blah\", \"moreInfo\": \"Bleh Bleh\"})`)\n\n    // First we want to extract the data json using regex with a capture group.\n    dataRegex, err := regexp.Compile(\"ajax\\\\((.*)\\\\)\")\n    if err != nil {\n        fmt.Println(\"regex failed to compile:\", err)\n        return\n    }\n\n    // FindSubmatch should return two matches:\n    // 0: The full match\n    // 1: The contents of the capture group (what we want)\n    matches := dataRegex.FindSubmatch(input)\n    if len(matches) != 2 {\n        fmt.Println(\"incorrect number of match results:\", len(matches))\n        return\n    }\n    dataJSON := matches[1]\n\n    // Since the data is in JSON format, we can unmarshal it into a struct.  If\n    // you don't care at all about the fields other than \"htmlInfo\", you can\n    // omit them from the struct.\n    data := &amp;Data{}\n    if err := json.Unmarshal(dataJSON, data); err != nil {\n        fmt.Println(\"failed to unmarshal data json:\", err)\n    }\n\n    // You now have access to the \"htmlInfo\" property\n    fmt.Println(\"HTML INFO:\", data.HTMLInfo)\n}\n</code></pre>\n\n<p>Which will produce:</p>\n\n<pre><code>HTML INFO: &lt;div class=\"container columns-2\"&gt;\n\n &lt;section class=\"col-main\"&gt;\n\n&lt;div class='visor-article-list list list-view-recent' &gt;\n&lt;div class='grid_item visor-article-teaser list_default' &gt;\n &lt;a class='grid_img' href='/manUnited-is-the-best'&gt;\n &lt;img src=\"http://example.com/sites//files/styles/w400h22\n</code></pre>\n"}], "owner": {"reputation": 307, "user_id": 1503786, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/6cd9bdefe988688b78e5250815a45afe?s=128&d=identicon&r=PG", "display_name": "Muhammad Umer", "link": "https://stackoverflow.com/users/1503786/muhammad-umer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1169, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1460338419, "creation_date": 1460317027, "question_id": 36534609, "link": "https://stackoverflow.com/questions/36534609/how-to-parse-http-get-response-in-golang", "title": "How to Parse HTTP.GET response in Golang", "body": "<p>I am getting this type of response from the url that I am hitting and I need to parse this to get the desired HTML.</p>\n\n<blockquote>\n  <p>this=ajax({\"htmlInfo\":\"SOME-HTML\", \"otherInfo\": \"Blah Blah\", \"moreInfo\": \"Bleh Bleh\"})</p>\n</blockquote>\n\n<p>As mentioned above, I have three key-pair values from which I need to get \"SOME-HTML\", how can I get that and the main problem is that \"SOME-HTML\" has escape characters. Below is the kind of response that that will be present.</p>\n\n<blockquote>\n  <p>\\u003Cdiv class=\\u0022container columns-2\\u0022\\u003E\\n\\n      \\u003Csection class=\\u0022col-main\\u0022\\u003E\\n        \\r\\n\\u003Cdiv class=\\u0027visor-article-list list list-view-recent\\u0027 \\u003E\\r\\n\\u003Cdiv class=\\u0027grid_item visor-article-teaser list_default\\u0027 \\u003E\\n                \\u003Ca class=\\u0027grid_img\\u0027 href=\\u0027/manUnited-is-the-best\\u0027\\u003E\\n            \\u003Cimg src=\\u0022http://www.xyz.com/sites//files/styles/w400h22</p>\n</blockquote>\n\n<p>Can anyone please help me in this regard. I am not sure how to tackle this. </p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["git", "go", "gogs"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1460341029, "post_id": 36533727, "comment_id": 60679939, "body": "This might be a question better asked over on the gogs GitHub repo: <a href=\"https://github.com/gogits/gogs\" rel=\"nofollow noreferrer\">github.com/gogits/gogs</a>"}], "answers": [{"tags": [], "owner": {"reputation": 242, "user_id": 2628875, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/595b9f3d4067de84b6e15ec8a4066676?s=128&d=identicon&r=PG", "display_name": "just_a_coder", "link": "https://stackoverflow.com/users/2628875/just-a-coder"}, "is_accepted": true, "score": 0, "last_activity_date": 1460617279, "creation_date": 1460617279, "answer_id": 36615897, "question_id": 36533727, "link": "https://stackoverflow.com/questions/36533727/how-can-gogs-be-configured-to-load-large-git-repositories-fast/36615897#36615897", "title": "How can gogs be configured to load large git repositories fast?", "body": "<p>This is a known limitation of gogs. The issue can be tracked <a href=\"https://github.com/gogits/gogs/issues/1518\" rel=\"nofollow\">here</a>.\nThis issue can be rectified by building a cache system for git repository data.</p>\n"}], "owner": {"reputation": 242, "user_id": 2628875, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/595b9f3d4067de84b6e15ec8a4066676?s=128&d=identicon&r=PG", "display_name": "just_a_coder", "link": "https://stackoverflow.com/users/2628875/just-a-coder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 334, "favorite_count": 0, "accepted_answer_id": 36615897, "answer_count": 1, "score": 0, "last_activity_date": 1460617279, "creation_date": 1460312651, "question_id": 36533727, "link": "https://stackoverflow.com/questions/36533727/how-can-gogs-be-configured-to-load-large-git-repositories-fast", "title": "How can gogs be configured to load large git repositories fast?", "body": "<p>I setup <a href=\"https://gogs.io/\" rel=\"nofollow\">gogs</a> on my DigitalOcean virtual machine with 1 cpu, 1GB RAM and a 30GB SSD. It works well with small repositories and everything is snappy. To test how gogs handles larger repositories, I cloned/imported the <a href=\"https://github.com/git/git\" rel=\"nofollow\">git</a> repository to my gogs installation. Everytime I open the repository through the web interface, it takes at least 5 seconds to load and CPU usage hovers at 95% and memory at 900MB. So i assumed my virtual machine resources were insufficient. So I resized the virtual machine and gave it 8 CPU cores and 16GB of RAM. Yet, loading the git repository still takes around 5 seconds. My guess is that it's either a configuration issue or a problem with gogs itself and the way it handles git repositories. Is there a way to get gogs to work fast with large repositories?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2103, "user_id": 3119050, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/mZahs.jpg?s=128&g=1", "display_name": "fredmaggiowski", "link": "https://stackoverflow.com/users/3119050/fredmaggiowski"}, "edited": false, "score": 1, "creation_date": 1460308750, "post_id": 36532909, "comment_id": 60669598, "body": "Why don&#39;t you just concatenate the strings?"}, {"owner": {"reputation": 67, "user_id": 5262581, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/627081a297aced294e4be065ac65a01f?s=128&d=identicon&r=PG&f=1", "display_name": "cmelone", "link": "https://stackoverflow.com/users/5262581/cmelone"}, "reply_to_user": {"reputation": 2103, "user_id": 3119050, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/mZahs.jpg?s=128&g=1", "display_name": "fredmaggiowski", "link": "https://stackoverflow.com/users/3119050/fredmaggiowski"}, "edited": false, "score": 0, "creation_date": 1460308945, "post_id": 36532909, "comment_id": 60669672, "body": "@FredMaggiowski Can you give me an example as to how I can do that? Sorry I&#39;m pretty new to Golang."}], "answers": [{"tags": [], "owner": {"reputation": 2103, "user_id": 3119050, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/mZahs.jpg?s=128&g=1", "display_name": "fredmaggiowski", "link": "https://stackoverflow.com/users/3119050/fredmaggiowski"}, "is_accepted": true, "score": 6, "last_activity_date": 1461055320, "last_edit_date": 1461055320, "creation_date": 1460309220, "answer_id": 36533056, "question_id": 36532909, "link": "https://stackoverflow.com/questions/36532909/allowing-more-than-one-argument-in-a-string-go/36533056#36533056", "title": "Allowing more than one argument in a string [Go]", "body": "<p>The issue is that you're using Sprintf the wrong way.</p>\n\n<p>The <code>Sprintf</code>\u00a0needs a string format as first argument and then all the variables you need to be inserted in the final string.</p>\n\n<p>Thus your code should be:</p>\n\n<pre><code>m.SetBody(\"text/html\", fmt.Sprintf(\"&lt;b&gt;Full Name&lt;/b&gt;: %s &lt;br&gt;&lt;b&gt;Message&lt;/b&gt; %s\", msg.completeName, msg.Content))\n</code></pre>\n\n<p>For more informations I suggest you to read the <a href=\"https://golang.org/pkg/fmt/#Sprintf\" rel=\"nofollow\">Sprintf documentation</a></p>\n\n<p><em>NOTE</em>: In the comment I said \"why don't you concatenate the string?\" since you can also do:</p>\n\n<pre><code>m.SetBody(\"text/html\", \"&lt;b&gt;Full Name&lt;/b&gt;: \"+ msg.completeName +\" &lt;br&gt;&lt;b&gt;Message&lt;/b&gt; \" + msg.Content))\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 5262581, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/627081a297aced294e4be065ac65a01f?s=128&d=identicon&r=PG&f=1", "display_name": "cmelone", "link": "https://stackoverflow.com/users/5262581/cmelone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 36533056, "answer_count": 1, "score": 0, "last_activity_date": 1461055320, "creation_date": 1460308509, "question_id": 36532909, "link": "https://stackoverflow.com/questions/36532909/allowing-more-than-one-argument-in-a-string-go", "title": "Allowing more than one argument in a string [Go]", "body": "<p>I'm using Gomail to grab data from a form and email it to myself. If I wanted to get the users full name, this is what I would use:</p>\n\n<pre><code>m.SetBody(\"text/html\", fmt.Sprintf(\"&lt;b&gt;Full Name&lt;/b&gt;: %s\", msg.completeName))\n</code></pre>\n\n<p>It something like this in the email:</p>\n\n<p><strong>Full Name</strong>: John Michael Smith</p>\n\n<p>Now if I wanted to add a message field to the code</p>\n\n<pre><code>m.SetBody(\"text/html\", fmt.Sprintf(\"&lt;b&gt;Full Name&lt;/b&gt;: %s\", msg.completeName, \"&lt;br&gt; &lt;b&gt;Message&lt;/b&gt; %s\", msg.Content))\n</code></pre>\n\n<p>It outputs this: </p>\n\n<p><strong>Full Name</strong>: John Michael Smith%!(EXTRA string=</p>\n\n<p><strong>Message</strong>: %s, string=Hi there!.)</p>\n\n<p>I want it to look like this:</p>\n\n<p><strong>Full Name</strong>: John Michael Smith</p>\n\n<p><strong>Message</strong>: Hi there!</p>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "is_accepted": false, "score": 0, "last_activity_date": 1460378917, "creation_date": 1460378917, "answer_id": 36549153, "question_id": 36532809, "link": "https://stackoverflow.com/questions/36532809/im-trying-to-find-a-record-by-email/36549153#36549153", "title": "I&#39;m trying to find a record by email", "body": "<p>So it turns out I needed to set the <code>DeletedAt</code> field to a null value. Under the hood, GORM automatically checks for a <code>DeletedAt</code> value. I.e <code>SELECT * FROM users WHERE email = 'someone@gmail.com' AND deleted_at IS NULL</code>. However, my <code>DeletedAt</code> fields were automatically being set to a blank date, which technically isn't <code>NULL</code>. </p>\n\n<p>I added a struct... </p>\n\n<pre><code>type NullTime struct {\n  time.Time\n  Valid bool\n}\n</code></pre>\n\n<p>Then updated my model... </p>\n\n<pre><code>type User struct {\n    ID        string `gorm:\"primary_key:true\"`\n    FirstName string `form:\"first_name\" json:\"first_name,omitempty\"`\n    LastName  string `form:\"last_name\" json:\"last_name,omitempty\"`\n    Password  string `form:\"password\" json:\"password\" bindind:\"required\"`\n    Email     string `gorm:\"type:varchar(110);unique_index\" form:\"email\" json:\"email,omitempty\" binding:\"required\"`\n    Location  string `form:\"location\" json:\"location,omitempty\"`\n    Avatar    string `form:\"avatar\" json:\"avatar,omitempty\"`\n    BgImg     string `form:\"bg_img\" json:\"bg_img,omitempty\"`\n    CreatedAt time.Time\n    UpdatedAt time.Time\n    DeletedAt NullTime\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 6221259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84e57003a2f746896deb9cb89d216f90?s=128&d=identicon&r=PG&f=1", "display_name": "Steve Miller", "link": "https://stackoverflow.com/users/6221259/steve-miller"}, "is_accepted": false, "score": 0, "last_activity_date": 1461003746, "creation_date": 1461003746, "answer_id": 36701556, "question_id": 36532809, "link": "https://stackoverflow.com/questions/36532809/im-trying-to-find-a-record-by-email/36701556#36701556", "title": "I&#39;m trying to find a record by email", "body": "<p>The convention in 'gorm' is to include the base model in your structs.</p>\n\n<pre><code>// Base Model definition from gomodel.go\ntype Model struct {\n  ID        uint `gorm:\"primary_key\"`\n  CreatedAt time.Time\n  UpdatedAt time.Time\n  DeletedAt *time.Time\n}\n\n// Your struct\ntype User struct {\n  gorm.Model\n  Name string\n}\n</code></pre>\n\n<p>As you can see, 'gorm' expected a pointer to handle the NULL value.</p>\n"}], "owner": {"reputation": 3113, "user_id": 1541609, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/b489568449345d3e18dbf7aa4fa44f22?s=128&d=identicon&r=PG", "display_name": "Ewan Valentine", "link": "https://stackoverflow.com/users/1541609/ewan-valentine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 367, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1554731657, "creation_date": 1460307967, "last_edit_date": 1554731657, "question_id": 36532809, "link": "https://stackoverflow.com/questions/36532809/im-trying-to-find-a-record-by-email", "title": "I&#39;m trying to find a record by email", "body": "<p>I have the following code.</p>\n\n<p>Handler</p>\n\n<pre><code>func (authHandler *AuthHandler) Login(c *gin.Context) {\n    var user models.User\n\n    c.Bind(&amp;user)\n\n    if &amp;user == nil {\n        c.BindJSON(&amp;user)\n    }\n\n    userObject, err := authHandler.userRepo.FindBy(\n        models.User{\n            Email: user.Email,\n        },\n    )\n\n    if err != nil {\n        c.JSON(401, gin.H{\"_message\": \"User not found.\"})\n        return\n    }\n\n    passErr := bcrypt.CompareHashAndPassword([]byte(userObject.Password), []byte(user.Password))\n\n    if passErr != nil {\n        c.JSON(401, gin.H{\"_message\": \"Password incorrect.\"})\n        return\n    }\n\n    token, err := services.CreateToken(userObject)\n\n    if err != nil {\n        c.JSON(401, gin.H{\"_message\": \"Password incorrect.\"})\n        return\n    }\n\n    c.JSON(200, gin.H{\"token\": token, \"user\": gin.H{\n        \"id\":         &amp;userObject.ID,\n        \"first_name\": &amp;userObject.FirstName,\n        \"last_name\":  &amp;userObject.LastName,\n        \"email\":      &amp;userObject.Email,\n        \"avatar\":     &amp;userObject.Avatar,\n        \"location\":   &amp;userObject.Location,\n        \"bg_img\":     &amp;userObject.BgImg,\n    }})\n}\n</code></pre>\n\n<p>Model</p>\n\n<pre><code>// user.go\ntype User struct {\n    ID        string `gorm:\"primary_key:true\"`\n    FirstName string `form:\"first_name\" json:\"first_name,omitempty\"`\n    LastName  string `form:\"last_name\" json:\"last_name,omitempty\"`\n    Password  string `form:\"password\" json:\"password\" bindind:\"required\"`\n    Email     string `gorm:\"type:varchar(110);unique_index\" form:\"email\" json:\"email,omitempty\" binding:\"required\"`\n    Location  string `form:\"location\" json:\"location,omitempty\"`\n    Avatar    string `form:\"avatar\" json:\"avatar,omitempty\"`\n    BgImg     string `form:\"bg_img\" json:\"bg_img,omitempty\"`\n    CreatedAt time.Time\n    UpdatedAt time.Time\n    DeletedAt time.Time\n}\n\nfunc (repo *UserRepo) FindBy(params User) (User, error) {\n\n    var user User\n\n    err := repo.db.First(&amp;user, \"email = ?\", params.Email).Error\n\n    fmt.Println(err)\n\n    if err != nil {\n        return user, err\n    }\n\n    return user, nil\n}\n</code></pre>\n\n<p>I've tried doing the find in several different ways with no luck. I get a 401 response every time and the fmt.Prinlnt(err) in the model shows an <code>record not found</code> error. </p>\n"}, {"tags": ["macos", "sockets", "networking", "go", "httpserver"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1460312343, "post_id": 36532359, "comment_id": 60670958, "body": "what happens when you listen on <code>:8080</code> only with no ip address?"}, {"owner": {"reputation": 2279, "user_id": 706650, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ef3096b4882fbd87055934614385bcb9?s=128&d=identicon&r=PG", "display_name": "mabn", "link": "https://stackoverflow.com/users/706650/mabn"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1460312389, "post_id": 36532359, "comment_id": 60670974, "body": "same thing, also tried on other interfaces"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1460312451, "post_id": 36532359, "comment_id": 60671000, "body": "did you check if an error is returned from <code>ListenAndServe</code>?"}, {"owner": {"reputation": 2279, "user_id": 706650, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ef3096b4882fbd87055934614385bcb9?s=128&d=identicon&r=PG", "display_name": "mabn", "link": "https://stackoverflow.com/users/706650/mabn"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1460312641, "post_id": 36532359, "comment_id": 60671073, "body": "tcp4 0 0 127.0.0.1:8080 <i>.</i> LISTEN, tcp4 0 0 127.0.0.1:53123 127.0.0.1:8080 SYN_SENT"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1460312781, "post_id": 36532359, "comment_id": 60671125, "body": "this is under docker or native on your system?"}, {"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 0, "creation_date": 1460337880, "post_id": 36532359, "comment_id": 60679276, "body": "Was the server in the listening loop or did it return right away?"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 6, "creation_date": 1460340393, "post_id": 36532359, "comment_id": 60679779, "body": "OS X version? Go version? I can&#39;t replicate on 10.11.4 w/ Go 1.6."}, {"owner": {"reputation": 1584, "user_id": 211438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9dc1fb93b959c0d838bf6a900306d9b9?s=128&d=identicon&r=PG", "display_name": "clsung", "link": "https://stackoverflow.com/users/211438/clsung"}, "edited": false, "score": 0, "creation_date": 1460443398, "post_id": 36532359, "comment_id": 60730596, "body": "what if you use different port? maybe some process is binding 8080?"}, {"owner": {"reputation": 2279, "user_id": 706650, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ef3096b4882fbd87055934614385bcb9?s=128&d=identicon&r=PG", "display_name": "mabn", "link": "https://stackoverflow.com/users/706650/mabn"}, "edited": false, "score": 0, "creation_date": 1460500217, "post_id": 36532359, "comment_id": 60769301, "body": "Changing the port does not help"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1460961353, "post_id": 36532359, "comment_id": 60962606, "body": "How do you run your Go server? With <code>go run filename.go</code>? Try <code>go build</code> and launch the executable that is created. Also try <code>localhost:8080</code> in Go, and connect to <code>localhost:8080</code>."}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1460983236, "post_id": 36532359, "comment_id": 60976692, "body": "@mabn I have OSX machine. If you share your compiled binary on github, googledisk or something I can at least check if it works on mine."}, {"owner": {"reputation": 1426, "user_id": 1520594, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b1fcaa128750715b5631f1c2c109e4eb?s=128&d=identicon&r=PG", "display_name": "algrebe", "link": "https://stackoverflow.com/users/1520594/algrebe"}, "edited": false, "score": 0, "creation_date": 1460991208, "post_id": 36532359, "comment_id": 60982854, "body": "@mabn could you try spawning a goroutine individually ? If you&#39;re new to go and find it confusing I can post a gist for you. Im thinking that it blocks indefinitely and isn&#39;t spawning a goroutine to handle the socket accept."}, {"owner": {"reputation": 1426, "user_id": 1520594, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b1fcaa128750715b5631f1c2c109e4eb?s=128&d=identicon&r=PG", "display_name": "algrebe", "link": "https://stackoverflow.com/users/1520594/algrebe"}, "edited": false, "score": 0, "creation_date": 1460992274, "post_id": 36532359, "comment_id": 60983643, "body": "@mabn could you try <a href=\"https://gist.github.com/algrebe/18d35a2f330a85269e494969d5d0bbf1\" rel=\"nofollow noreferrer\">this gist</a> and see if the count increases ?"}, {"owner": {"reputation": 1615, "user_id": 1376205, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3ff8ba613f2dc50cc30e7f3af3e2914?s=128&d=identicon&r=PG", "display_name": "Will C", "link": "https://stackoverflow.com/users/1376205/will-c"}, "edited": false, "score": 0, "creation_date": 1461026295, "post_id": 36532359, "comment_id": 61000916, "body": "@mabn Curious as to what happens if you don&#39;t use <code>Fprintf</code> and just use <code>w.Write([]byte(fmt.Sprintf(&quot;Hi there, I love %s!&quot;, r.URL.Path[1:]))</code>. It looks like a response is not written and so it times out."}, {"owner": {"reputation": 2279, "user_id": 706650, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ef3096b4882fbd87055934614385bcb9?s=128&d=identicon&r=PG", "display_name": "mabn", "link": "https://stackoverflow.com/users/706650/mabn"}, "reply_to_user": {"reputation": 1426, "user_id": 1520594, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b1fcaa128750715b5631f1c2c109e4eb?s=128&d=identicon&r=PG", "display_name": "algrebe", "link": "https://stackoverflow.com/users/1520594/algrebe"}, "edited": false, "score": 0, "creation_date": 1461279553, "post_id": 36532359, "comment_id": 61140125, "body": "@algrebe I&#39;m very new to go. I&#39;ve run your gist, it outputs 2 routines, 3 routines, 4 routines... etc. I&#39;m not sure if you want me to do anything more to it."}, {"owner": {"reputation": 2279, "user_id": 706650, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ef3096b4882fbd87055934614385bcb9?s=128&d=identicon&r=PG", "display_name": "mabn", "link": "https://stackoverflow.com/users/706650/mabn"}, "reply_to_user": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1461279962, "post_id": 36532359, "comment_id": 61140258, "body": "@Uvelichitel I&#39;ve added the code and the binary here: <a href=\"https://github.com/mabn/golang_issue\" rel=\"nofollow noreferrer\">github.com/mabn/golang_issue</a>"}, {"owner": {"reputation": 1426, "user_id": 1520594, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/b1fcaa128750715b5631f1c2c109e4eb?s=128&d=identicon&r=PG", "display_name": "algrebe", "link": "https://stackoverflow.com/users/1520594/algrebe"}, "edited": false, "score": 0, "creation_date": 1461300085, "post_id": 36532359, "comment_id": 61145308, "body": "@mabn I was trying to figure out if goroutines were getting spawned to handle a request. Since the gist works, there is no problem there. That&#39;s all I got , no idea how to help further."}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1461327438, "post_id": 36532359, "comment_id": 61161544, "body": "@mabn Your binary provided in your gist just works on my machine. So it&#39;s OSX issue or your specific environment. Check /etc/hosts and firewall policy on your machine for instance."}], "answers": [{"comments": [{"owner": {"reputation": 2279, "user_id": 706650, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ef3096b4882fbd87055934614385bcb9?s=128&d=identicon&r=PG", "display_name": "mabn", "link": "https://stackoverflow.com/users/706650/mabn"}, "edited": false, "score": 0, "creation_date": 1461279414, "post_id": 36751218, "comment_id": 61140085, "body": "added to the question"}, {"owner": {"reputation": 296, "user_id": 755976, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-VrGFZDwASP4/AAAAAAAAAAI/AAAAAAAAAo4/AEy1OTlapvM/photo.jpg?sz=128", "display_name": "9nut", "link": "https://stackoverflow.com/users/755976/9nut"}, "reply_to_user": {"reputation": 2279, "user_id": 706650, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ef3096b4882fbd87055934614385bcb9?s=128&d=identicon&r=PG", "display_name": "mabn", "link": "https://stackoverflow.com/users/706650/mabn"}, "edited": false, "score": 0, "creation_date": 1461282182, "post_id": 36751218, "comment_id": 61140843, "body": "is it possible that you&#39;re linking against a locally modified net/http package?"}, {"owner": {"reputation": 2279, "user_id": 706650, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ef3096b4882fbd87055934614385bcb9?s=128&d=identicon&r=PG", "display_name": "mabn", "link": "https://stackoverflow.com/users/706650/mabn"}, "edited": false, "score": 0, "creation_date": 1461286434, "post_id": 36751218, "comment_id": 61141852, "body": "I don&#39;t think so. The root problem is that docker-machine is not able to connect to it&#39;s rpc server and I just grabbed binary release of docker-machine. I tried later building it myself and debugging and reduced the problem to the issue I described in this question."}], "tags": [], "owner": {"reputation": 296, "user_id": 755976, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-VrGFZDwASP4/AAAAAAAAAAI/AAAAAAAAAo4/AEy1OTlapvM/photo.jpg?sz=128", "display_name": "9nut", "link": "https://stackoverflow.com/users/755976/9nut"}, "is_accepted": false, "score": 2, "last_activity_date": 1461173784, "creation_date": 1461173784, "answer_id": 36751218, "question_id": 36532359, "link": "https://stackoverflow.com/questions/36532359/go-http-server-does-not-work-on-osx/36751218#36751218", "title": "go: http server does not work on osx", "body": "<p>I'd like to see the output of 'ifconfig -a'.</p>\n\n<p>This smells like a local configuration issue; I can't reproduced this on OS X 10.11.4, Go 1.6</p>\n\n<p>My W.A.G is that a tunnel device is actually using 127.0.0.1 not the loop back device.</p>\n"}, {"comments": [{"owner": {"reputation": 2279, "user_id": 706650, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ef3096b4882fbd87055934614385bcb9?s=128&d=identicon&r=PG", "display_name": "mabn", "link": "https://stackoverflow.com/users/706650/mabn"}, "edited": false, "score": 0, "creation_date": 1461279391, "post_id": 36781042, "comment_id": 61140076, "body": "Don&#39;t have it. I tried other ports too and it&#39;s the same"}], "tags": [], "owner": {"reputation": 10563, "user_id": 1104328, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/df0790774838286ad0d93567ae1fcf56?s=128&d=identicon&r=PG&f=1", "display_name": "Harry", "link": "https://stackoverflow.com/users/1104328/harry"}, "is_accepted": false, "score": 0, "last_activity_date": 1461275115, "creation_date": 1461275115, "answer_id": 36781042, "question_id": 36532359, "link": "https://stackoverflow.com/questions/36532359/go-http-server-does-not-work-on-osx/36781042#36781042", "title": "go: http server does not work on osx", "body": "<p>Do you have Cisco Anyconnect installed? If so find <code>websecurity_uninstall.sh</code> and uninstall websecurity </p>\n\n<pre><code>sudo /opt/cisco/anyconnect/bin/websecurity_uninstall.sh\n</code></pre>\n\n<p>It forwards port 8080 to port 5001 and you cannot use netstat, lsof or any of the normal tools to see why nothing can use port 8080.</p>\n"}, {"comments": [{"owner": {"reputation": 2279, "user_id": 706650, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ef3096b4882fbd87055934614385bcb9?s=128&d=identicon&r=PG", "display_name": "mabn", "link": "https://stackoverflow.com/users/706650/mabn"}, "edited": false, "score": 0, "creation_date": 1461706107, "post_id": 36818103, "comment_id": 61318871, "body": "Don&#39;t have it. I uninstalled firewall and it didn&#39;t help."}], "tags": [], "owner": {"reputation": 48, "user_id": 6242353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3839a426531864d4be8cfa6af69577a7?s=128&d=identicon&r=PG&f=1", "display_name": "Clyde McQueen", "link": "https://stackoverflow.com/users/6242353/clyde-mcqueen"}, "is_accepted": false, "score": 0, "last_activity_date": 1461459100, "last_edit_date": 1490005096, "creation_date": 1461459100, "answer_id": 36818103, "question_id": 36532359, "link": "https://stackoverflow.com/questions/36532359/go-http-server-does-not-work-on-osx/36818103#36818103", "title": "go: http server does not work on osx", "body": "<p>I'm sure you checked this, but by any chance do you have packet filtering (pfctl) or some other firewall turned on? See <a href=\"https://superuser.com/questions/505128/deny-access-to-a-port-from-localhost-on-osx\">https://superuser.com/questions/505128/deny-access-to-a-port-from-localhost-on-osx</a></p>\n"}, {"tags": [], "owner": {"reputation": 2279, "user_id": 706650, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ef3096b4882fbd87055934614385bcb9?s=128&d=identicon&r=PG", "display_name": "mabn", "link": "https://stackoverflow.com/users/706650/mabn"}, "is_accepted": true, "score": 1, "last_activity_date": 1461942955, "last_edit_date": 1492087506, "creation_date": 1461942955, "answer_id": 36941972, "question_id": 36532359, "link": "https://stackoverflow.com/questions/36532359/go-http-server-does-not-work-on-osx/36941972#36941972", "title": "go: http server does not work on osx", "body": "<p>I fixed it! I remembered that a while earlier I tried to increase limit of connections on my machine and applied the changes described here: <a href=\"https://apple.stackexchange.com/a/169606\">https://apple.stackexchange.com/a/169606</a></p>\n\n<p>Reverting them fixed the issue. This is what helped:</p>\n\n<pre><code>sudo rm /etc/sysctl.conf\nsudo sysctl kern.ipc.somaxconn=128\nsudo rm /Library/LaunchDaemons/limit.maxproc.plist\nsudo rm /Library/LaunchDaemons/limit.maxfiles.plist\n</code></pre>\n\n<p>Btw: after some more investigation I found out that:</p>\n\n<ul>\n<li>the problem was that accept() syscall was returning EAGAIN every time but not accepting any connections</li>\n<li>it behaved the same for non-blocking connections in C and Java programs</li>\n</ul>\n\n<p>But I still don't know why exactly it was broken.</p>\n"}], "owner": {"reputation": 2279, "user_id": 706650, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ef3096b4882fbd87055934614385bcb9?s=128&d=identicon&r=PG", "display_name": "mabn", "link": "https://stackoverflow.com/users/706650/mabn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4478, "favorite_count": 1, "accepted_answer_id": 36941972, "answer_count": 4, "score": 21, "last_activity_date": 1461942955, "creation_date": 1460305644, "last_edit_date": 1461280184, "question_id": 36532359, "link": "https://stackoverflow.com/questions/36532359/go-http-server-does-not-work-on-osx", "title": "go: http server does not work on osx", "body": "<p>The <a href=\"https://golang.org/doc/articles/wiki/#tmp_3\">example http server</a> doesn't work for me. Source code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hi there, I love %s!\", r.URL.Path[1:])\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", handler)\n    http.ListenAndServe(\"127.0.0.1:8080\", nil)\n}\n</code></pre>\n\n<p>When I try to connect all I get is:</p>\n\n<pre><code>$ curl 127.0.0.1:8080\ncurl: (7) Failed to connect to 127.0.0.1 port 8080: Operation timed out\n$ nc -v -G 5 127.0.0.1 8080\nnc: connectx to 127.0.0.1 port 8080 (tcp) failed: Operation timed out\n</code></pre>\n\n<p>While nc tries to connect tcpdump shows only SYN packets:</p>\n\n<pre><code>$ tcpdump -i lo0 port 8080\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on lo0, link-type NULL (BSD loopback), capture size 262144 bytes\n18:21:30.906638 IP localhost.52799 &gt; localhost.http-alt: Flags [S], seq 3375761924, win 65535, options [mss 16344,nop,wscale 5,nop,nop,TS val 118569352 ecr 0,sackOK,eol], length 0\n18:21:31.006824 IP localhost.52799 &gt; localhost.http-alt: Flags [S], seq 3375761924, win 65535, options [mss 16344,nop,wscale 5,nop,nop,TS val 118569452 ecr 0,sackOK,eol], length 0\n18:21:31.106989 IP localhost.52799 &gt; localhost.http-alt: Flags [S], seq 3375761924, win 65535, options [mss 16344,nop,wscale 5,nop,nop,TS val 118569552 ecr 0,sackOK,eol], length 0\n18:21:31.208141 IP localhost.52799 &gt; localhost.http-alt: Flags [S], seq 3375761924, win 65535, options [mss 16344,nop,wscale 5,nop,nop,TS val 118569653 ecr 0,sackOK,eol], length 0\n18:21:31.308288 IP localhost.52799 &gt; localhost.http-alt: Flags [S], seq 3375761924, win 65535, options [mss 16344,nop,wscale 5,nop,nop,TS val 118569753 ecr 0,sackOK,eol], length 0\n18:21:31.408336 IP localhost.52799 &gt; localhost.http-alt: Flags [S], seq 3375761924, win 65535, options [mss 16344,nop,wscale 5,nop,nop,TS val 118569853 ecr 0,sackOK,eol], length 0\n18:21:31.609143 IP localhost.52799 &gt; localhost.http-alt: Flags [S], seq 3375761924, win 65535, options [mss 16344,nop,wscale 5,nop,nop,TS val 118570053 ecr 0,sackOK,eol], length 0\n18:21:32.011215 IP localhost.52799 &gt; localhost.http-alt: Flags [S], seq 3375761924, win 65535, options [mss 16344,nop,wscale 5,nop,nop,TS val 118570453 ecr 0,sackOK,eol], length 0\n18:21:32.812512 IP localhost.52799 &gt; localhost.http-alt: Flags [S], seq 3375761924, win 65535, options [mss 16344,nop,wscale 5,nop,nop,TS val 118571253 ecr 0,sackOK,eol], length 0\n18:21:34.414686 IP localhost.52799 &gt; localhost.http-alt: Flags [S], seq 3375761924, win 65535, options [mss 16344,nop,wscale 5,nop,nop,TS val 118572853 ecr 0,sackOK,eol], length 0\n</code></pre>\n\n<p>And here's the last part of dtruss output of the server-side (starting from socket call):</p>\n\n<pre><code>socket(0x2, 0x1, 0x0)            = 3 0\nfcntl(0x3, 0x2, 0x1)             = 0 0\nfcntl(0x3, 0x3, 0x0)             = 2 0\nfcntl(0x3, 0x4, 0x6)             = 0 0\nsetsockopt(0x3, 0xFFFF, 0x20)            = 0 0\nsetsockopt(0x3, 0xFFFF, 0x4)             = 0 0\nbind(0x3, 0xC8200BA6AC, 0x10)            = 0 0\nlisten(0x3, 0xFDE8, 0x10)                = 0 0\nkqueue(0x3, 0xFDE8, 0x10)                = 4 0\nfcntl(0x4, 0x2, 0x1)             = 0 0\nkevent(0x4, 0xC8200558C0, 0x2)           = 0 0\ngetsockname(0x3, 0xC82005592C, 0xC820055928)             = 0 0\naccept(0x3, 0xC820055AA4, 0xC820055A94)          = -1 Err#35\nkevent(0x4, 0x0, 0x0)            = 0 0\nselect(0x0, 0x0, 0x0, 0x0, 0x700000080DE8)               = 0 0\n</code></pre>\n\n<p>Nothing more appears when I run nc, so it does not even notice connection attempts.</p>\n\n<p>I don't have firewall enabled, everything else works, only Go programs have this issue (in particular I can't use docker-machine)</p>\n\n<p>How do I fix it?</p>\n\n<p>Edit:\nI assume that #Err35 is:</p>\n\n<pre><code>#define EDEADLK     35  /* Resource deadlock would occur */\n</code></pre>\n\n<p>...wat?</p>\n\n<p>Edit2:</p>\n\n<ul>\n<li>go: version go1.6 darwin/amd64 </li>\n<li>OSX: 10.11.4</li>\n</ul>\n\n<p>The server is not exiting, it listens indefinitely.</p>\n\n<p>Edit3:  </p>\n\n<p>I tried both \"go build\" and \"go run - no difference</p>\n\n<p>Using localhost instead of 127.0.0.1 - no difference</p>\n\n<p>Using <code>w.Write([]byte(fmt.Sprintf(\"Hi there, I love %s!\", r.URL.Path[1:]))</code> instead - no difference. Btw - it says <code>nc: connectx to 127.0.0.1 port 8080 (tcp) failed: Operation timed out</code>, so the connection attempt times out, not the read</p>\n\n<p>ifconfig -a and netstat -r output: <a href=\"https://gist.github.com/mabn/ed171f180725b563d32bb86d5ec61988\">https://gist.github.com/mabn/ed171f180725b563d32bb86d5ec61988</a></p>\n"}, {"tags": ["pointers", "go"], "answers": [{"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": true, "score": 3, "last_activity_date": 1460304970, "creation_date": 1460304970, "answer_id": 36532226, "question_id": 36531948, "link": "https://stackoverflow.com/questions/36531948/go-delete-an-object-by-its-pointer/36532226#36532226", "title": "Go: delete an object by its pointer", "body": "<p>All assignments in Go are copy by value.</p>\n\n<pre><code> m := map[string]*obj{\n        \"foo\": o1,\n        \"bar\": o2,\n    }\n</code></pre>\n\n<p>is an assignment, so value of foo is a copy of o1.\nTo achieve your goal you need one more level of indirection  </p>\n\n<pre><code>o1 := &amp;obj{1, \"hello\"}\no2 := &amp;obj{2, \"world\"}\n\n    m := map[string]**obj{\n        \"foo\": &amp;o1,\n        \"bar\": &amp;o2,\n    }\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/XutneOziaM\" rel=\"nofollow\">http://play.golang.org/p/XutneOziaM</a></p>\n"}, {"tags": [], "owner": {"reputation": 2088, "user_id": 3309046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5ce388de97238b3147f3d4ba62b17cb?s=128&d=identicon&r=PG", "display_name": "nishanthshanmugham", "link": "https://stackoverflow.com/users/3309046/nishanthshanmugham"}, "is_accepted": false, "score": 1, "last_activity_date": 1460320887, "creation_date": 1460320887, "answer_id": 36535317, "question_id": 36531948, "link": "https://stackoverflow.com/questions/36531948/go-delete-an-object-by-its-pointer/36535317#36535317", "title": "Go: delete an object by its pointer", "body": "<p>Explaining @Uvelichitel's note on copy by value,</p>\n\n<pre><code>o1 := &lt;0x10434120&gt;\nm := map[string]*obj{\n    \"foo\": &lt;0x10434120&gt;,\n}\n\no1.a = \"WWW\" // &lt;0x10434120&gt;.a = \"WWW\" changing both places\n\no1 = nil\nm[\"foo\"] // still is &lt;0x10434120&gt;\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 3693962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/def0c4e18fe60afb98f570b34e3e9ea5?s=128&d=identicon&r=PG&f=1", "display_name": "artsafin", "link": "https://stackoverflow.com/users/3693962/artsafin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2727, "favorite_count": 2, "accepted_answer_id": 36532226, "answer_count": 2, "score": 2, "last_activity_date": 1460394896, "creation_date": 1460303551, "last_edit_date": 1460394896, "question_id": 36531948, "link": "https://stackoverflow.com/questions/36531948/go-delete-an-object-by-its-pointer", "title": "Go: delete an object by its pointer", "body": "<p>I'm currently learning golang, and have the following code.\nThe idea is to have an object with a number of pointers to it, and I'd like to modify and delete the object using one of the pointers.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype obj struct {\n    a int\n    b string\n}\n\nfunc main() {\n    o1 := &amp;obj{1, \"hello\"}\n    o2 := &amp;obj{2, \"world\"}\n\n    m := map[string]*obj{\n        \"foo\": o1,\n        \"bar\": o2,\n    }\n\n    fmt.Printf(\"1: %t %v\\n\", o1, o1)\n    fmt.Println(\"2:\", m, m[\"foo\"], o1)\n\n    o1.b = \"WWWW\"\n    fmt.Println(\"3:\", m, m[\"foo\"], o1)\n\n    o1 = nil\n    fmt.Println(\"4:\", m, m[\"foo\"], o1)\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/lqQviVuTQN\" rel=\"nofollow\">http://play.golang.org/p/lqQviVuTQN</a></p>\n\n<p>Output:</p>\n\n<pre><code>1: &amp;{%!t(int=1) %!t(string=hello)} &amp;{1 hello}\n2: map[foo:0x10434120 bar:0x10434130] &amp;{1 hello} &amp;{1 hello}\n3: map[foo:0x10434120 bar:0x10434130] &amp;{1 WWWW} &amp;{1 WWWW}\n4: map[foo:0x10434120 bar:0x10434130] &amp;{1 WWWW} &lt;nil&gt;\n</code></pre>\n\n<p>Changing object's internals works as I expect (#3).\nHowever when I try deleting the actual object (#4) it seems just <code>nil</code>s the pointer itself without touching actual object.</p>\n\n<p>What am I missing?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "is_accepted": false, "score": 1, "last_activity_date": 1460302302, "creation_date": 1460302302, "answer_id": 36531701, "question_id": 36531421, "link": "https://stackoverflow.com/questions/36531421/golang-interface-parameter-how-to-judge-pass-value-or-pass-pointer/36531701#36531701", "title": "Golang interface{} parameter how to judge pass value or pass pointer", "body": "<p>The <code>interface{}</code> type for a function argument indicates, that you can pass value with any type to that argument. That is because all types implements <code>interface{}</code> (empty interface).  This also includes a pointer type as well.</p>\n\n<p>Because of that, You cannot judge whether you need to pass pointer or value based on the <code>interface{}</code> type declaration of that argument alone. Because It will accept both. So, you need to consult documentation of the specific function, and see what author expects.</p>\n\n<p>In your case, the error is defined at <a href=\"https://golang.org/src/encoding/gob/decoder.go\" rel=\"nofollow\">https://golang.org/src/encoding/gob/decoder.go</a> As the error says, decoder need a pointer for the <code>reply parameter</code>. Otherwise, the <code>reply</code> won't get back to the caller.</p>\n"}], "owner": {"reputation": 45, "user_id": 4301992, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PgjWh.jpg?s=128&g=1", "display_name": "Andrew_liu", "link": "https://stackoverflow.com/users/4301992/andrew-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 718, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1460355653, "creation_date": 1460300897, "last_edit_date": 1460355653, "question_id": 36531421, "link": "https://stackoverflow.com/questions/36531421/golang-interface-parameter-how-to-judge-pass-value-or-pass-pointer", "title": "Golang interface{} parameter how to judge pass value or pass pointer", "body": "<p>When I learn go language, I was confused by <code>interface{} parameter</code></p>\n\n<p>for example, I use the net/rpc</p>\n\n<p>the interface is:</p>\n\n<pre><code>// description: Call invokes the named function, waits for it to complete, and returns its error status.\nfunc (client *Client) Call(serviceMethod string, args interface{}, reply interface{}) error\n</code></pre>\n\n<p>I just pass the reply parameter as value, the program will error:<br>\n<code>rpc call error:reading body gob: attempt to decode into a non-pointer</code></p>\n\n<p>so how to distinguish when I should pass pointer or pass value for the interface.</p>\n"}, {"tags": ["go", "error-handling", "scope"], "comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1460303084, "post_id": 36531188, "comment_id": 60667479, "body": "1. why do you want to limit it? what&#39;s your logic there. 2.  both <code>if err = ioutil.WriteFile(&quot;text.json&quot;, entryJson, 0644); err != nil{}</code> and <code>if err := ioutil.WriteFile(&quot;text.json&quot;, entryJson, 0644); err != nil{}</code> works fine"}, {"owner": {"reputation": 435, "user_id": 3162261, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/06813697a52abdc3b82be98f99d479ba?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/3162261/chris"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1460305209, "post_id": 36531188, "comment_id": 60668305, "body": "I have no particular reason limiting the scope. It just seemed a good idea and was encouraged by the course I took. (I&#39;m fairly new to Go coming from a Java background.)"}], "answers": [{"comments": [{"owner": {"reputation": 435, "user_id": 3162261, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/06813697a52abdc3b82be98f99d479ba?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/3162261/chris"}, "edited": false, "score": 1, "creation_date": 1460366722, "post_id": 36537855, "comment_id": 60690354, "body": "From what I understand of Go, which is admittedly not that much yet, I find the second solution of this answer to be the best. In my specific example this is particular true since I have now another methods which will use the same logic to write to the JSON. Therefore putting it into a separate function makes the most sense and limits the scope. Thank you."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 435, "user_id": 3162261, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/06813697a52abdc3b82be98f99d479ba?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/3162261/chris"}, "edited": false, "score": 0, "creation_date": 1460386468, "post_id": 36537855, "comment_id": 60704913, "body": "@Chris welcome to Go, the #1 tip I can give you is, don&#39;t try to apply other languages to Go, once you can do that, your experience with Go will be much better."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 2, "last_activity_date": 1460332812, "creation_date": 1460332812, "answer_id": 36537855, "question_id": 36531188, "link": "https://stackoverflow.com/questions/36531188/limit-the-scope-of-variables-storing-error/36537855#36537855", "title": "Limit the scope of variables storing error", "body": "<p>First, there's no need to isolate variables.\nSecond, you can do short-hand assignment inside if statements, for example:</p>\n\n<pre><code>entryJson, err := json.MarshalIndent(entry, \"\", \" \")\nif err != nil{\n    log.Println(err)\n} else {\n    log.Println(entryJson)\n}\n\nif err = ioutil.WriteFile(\"text.json\", entryJson, 0644); err != nil{\n    log.Println(err)\n}\n\n// or if you want to limit the scope of err badly, this is also legal:\n\nif err := ioutil.WriteFile(\"text.json\", entryJson, 0644); err != nil{\n    log.Println(err)\n}\n</code></pre>\n\n<p>A clean way to handle this specific example though is to put it in it is own function and call it:</p>\n\n<pre><code>func writeJSON(fn string, v interface{}) error {\n    j, err := json.MarshalIndent(v, \"\", \" \")\n    if err != nil {\n        return err\n    }\n\n    return ioutil.WriteFile(fn, j, 0644)\n}\n\nfunc main() {\n    var test struct {\n        A string\n        B string\n    }\n    if err := writeJSON(\"file.json\", test); err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "is_accepted": false, "score": 0, "last_activity_date": 1460336347, "creation_date": 1460336347, "answer_id": 36538245, "question_id": 36531188, "link": "https://stackoverflow.com/questions/36531188/limit-the-scope-of-variables-storing-error/36538245#36538245", "title": "Limit the scope of variables storing error", "body": "<p>You can write file in the <code>else</code> statement following the error checking, although I can't say it's idiomatic/readable.</p>\n\n<pre><code>var entry = []byte(`{\n    \"name\": \"bob\",\n    \"age\" : 74\n}`)\n\nfunc main() {\n    if entryJson, err := json.MarshalIndent(entry, \"\", \" \"); err != nil {\n        log.Fatal(err)\n    } else {\n        if err = ioutil.WriteFile(\"text.json\", entryJson, 0644); err != nil {\n            log.Fatal(err)\n        }   \n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 435, "user_id": 3162261, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/06813697a52abdc3b82be98f99d479ba?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/3162261/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 36537855, "answer_count": 2, "score": 0, "last_activity_date": 1460387785, "creation_date": 1460299488, "question_id": 36531188, "link": "https://stackoverflow.com/questions/36531188/limit-the-scope-of-variables-storing-error", "title": "Limit the scope of variables storing error", "body": "<p>I have the following code:</p>\n\n<pre><code>if entryJson, err := json.MarshalIndent(entry, \"\", \" \"); err != nil{\n    log.Println(err)\n} else {\n    log.Println(entryJson)\n}\n\nif err := ioutil.WriteFile(\"text.json\", entryJson, 0644); err != nil {\n    log.Println(err)\n}\n</code></pre>\n\n<p>I want to limit the scope of <em>err</em> as much as possible. The problem I'm facing with this is, that the variable <code>entryJson</code> is out of scope when I want to write it to the file.<br>\nWhat is the idiomatic way to deal with this. Should I just reuse the variable <em>err</em> and check for it in an additional <em>if</em> block? Like this:</p>\n\n<pre><code>entryJson, err := json.MarshalIndent(entry, \"\", \" \")\nif err != nil{\n    log.Println(err)\n} else {\n    log.Println(entryJson)\n}\n\nerr = ioutil.WriteFile(\"text.json\", entryJson, 0644)\nif err != nil{\n    log.Println(err)\n}\n</code></pre>\n\n<p>This works but looks less readable to me.</p>\n"}, {"tags": ["go", "time", "duration"], "comments": [{"owner": {"reputation": 3761, "user_id": 142020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vKJEv.png?s=128&g=1", "display_name": "T0xicCode", "link": "https://stackoverflow.com/users/142020/t0xiccode"}, "edited": false, "score": 0, "creation_date": 1460295662, "post_id": 36530251, "comment_id": 60664754, "body": "How precise do you need it to be? Imprecise relative timestamps would make that a bit simpler"}, {"owner": {"reputation": 1282, "user_id": 3648229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6b730f6984c01d9409a83abacb234580?s=128&d=identicon&r=PG", "display_name": "gempir", "link": "https://stackoverflow.com/users/3648229/gempir"}, "reply_to_user": {"reputation": 3761, "user_id": 142020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vKJEv.png?s=128&g=1", "display_name": "T0xicCode", "link": "https://stackoverflow.com/users/142020/t0xiccode"}, "edited": false, "score": 0, "creation_date": 1460295784, "post_id": 36530251, "comment_id": 60664808, "body": "I would prefer it to be precise to the second"}, {"owner": {"reputation": 1282, "user_id": 3648229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6b730f6984c01d9409a83abacb234580?s=128&d=identicon&r=PG", "display_name": "gempir", "link": "https://stackoverflow.com/users/3648229/gempir"}, "reply_to_user": {"reputation": 3761, "user_id": 142020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vKJEv.png?s=128&g=1", "display_name": "T0xicCode", "link": "https://stackoverflow.com/users/142020/t0xiccode"}, "edited": false, "score": 0, "creation_date": 1460296897, "post_id": 36530251, "comment_id": 60665167, "body": "@T0xicCode could give me the solution that is less precise?  Maybe I can improve it somehow"}], "answers": [{"comments": [{"owner": {"reputation": 1282, "user_id": 3648229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6b730f6984c01d9409a83abacb234580?s=128&d=identicon&r=PG", "display_name": "gempir", "link": "https://stackoverflow.com/users/3648229/gempir"}, "edited": false, "score": 0, "creation_date": 1460297343, "post_id": 36530742, "comment_id": 60665341, "body": "can&#39;t figure out why but 2015-06-27T09:34:22+00:00 time returns 1 year and 10 months which is incorrect."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 1282, "user_id": 3648229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6b730f6984c01d9409a83abacb234580?s=128&d=identicon&r=PG", "display_name": "gempir", "link": "https://stackoverflow.com/users/3648229/gempir"}, "edited": false, "score": 0, "creation_date": 1460302450, "post_id": 36530742, "comment_id": 60667231, "body": "@danielps1 my math was off, updating the post now"}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 1, "last_activity_date": 1460302475, "last_edit_date": 1460302475, "creation_date": 1460297041, "answer_id": 36530742, "question_id": 36530251, "link": "https://stackoverflow.com/questions/36530251/time-since-with-months-and-years/36530742#36530742", "title": "time.Since() with months and years", "body": "<p>Something like this would work, probably not the most efficient but it is as accurate as you gonna get:</p>\n\n<pre><code>func main() {\n    a := time.Date(2015, 10, 15, 0, 0, 0, 0, time.UTC)\n    b := time.Date(2016, 11, 15, 0, 0, 0, 0, time.UTC)\n    fmt.Println(monthYearDiff(a, b))\n}\n\nfunc monthYearDiff(a, b time.Time) (years, months int) {\n    m := a.Month()\n    for a.Before(b) {\n        a = a.Add(time.Hour * 24)\n        m2 := a.Month()\n        if m2 != m {\n            months++\n        }\n        m = m2\n    }\n    years = months / 12\n    months = months % 12\n    return\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/DMYxXKkD11\" rel=\"nofollow\"><kbd>playground</kbd></a></p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 51, "last_activity_date": 1578575741, "last_edit_date": 1578575741, "creation_date": 1460300989, "answer_id": 36531443, "question_id": 36530251, "link": "https://stackoverflow.com/questions/36530251/time-since-with-months-and-years/36531443#36531443", "title": "time.Since() with months and years", "body": "<p><strong>Foreword:</strong> I released this utility in <a href=\"https://github.com/icza/gox\" rel=\"noreferrer\"><code>github.com/icza/gox</code></a>, see <a href=\"https://godoc.org/github.com/icza/gox/timex#Diff\" rel=\"noreferrer\"><code>timex.Diff()</code></a>.</p>\n\n<hr>\n\n<p>The days in a month depends on the date, just like the days in a year (leap years).</p>\n\n<p>If you use <a href=\"https://golang.org/pkg/time/#Since\" rel=\"noreferrer\"><code>time.Since()</code></a> to get the elapsed time since a <a href=\"https://golang.org/pkg/time/#Time\" rel=\"noreferrer\"><code>time.Time</code></a> value, or when you calculate the difference between 2 <code>time.Time</code> values using the <a href=\"https://golang.org/pkg/time/#Time.Sub\" rel=\"noreferrer\"><code>Time.Sub()</code></a> method, the result is a <a href=\"https://golang.org/pkg/time/#Duration\" rel=\"noreferrer\"><code>time.Duration</code></a> which loses the time context (as <code>Duration</code> is just the time difference in nanoseconds). This means you cannot accurately and  unambiguously calculate the difference in years, months, etc. from a <code>Duration</code> value.</p>\n\n<p>The right solution must calculate the difference in the context of the time. You may calculate the difference for each field (year, month, day, hour, minute, second), and then normalize the result to not have any negative values. It is also recommended to swap the <code>Time</code> values if the relation between them is not the expected.</p>\n\n<p>Normalization means if a value is negative, add the maximum value of that field and decrement the next field by 1. For example if <code>seconds</code> is negative, add <code>60</code> to it and decrement <code>minutes</code> by 1. One thing to look out for is when normalizing the difference of days (days in month), the number of days in the proper month has to be applied. This can easily be calculated with this little trick:</p>\n\n<pre><code>// Max days in year y1, month M1\nt := time.Date(y1, M1, 32, 0, 0, 0, 0, time.UTC)\ndaysInMonth := 32 - t.Day()\n</code></pre>\n\n<p>The logic behind this is that the day <code>32</code> is bigger than the max day in any month. It will get automatically normalized (extra days rolled to the next month and day decremented properly). And when we subtract day we have after normalization from 32, we get exactly what the last day was in the month.</p>\n\n<p><strong>Time zone handling:</strong></p>\n\n<p>The difference calculation will only give correct result if both of the time values we pass in are in the same time zone (<a href=\"https://golang.org/pkg/time/#Location\" rel=\"noreferrer\"><code>time.Location</code></a>). We incorporate a check into our function: if this is not the case, we \"convert\" one of the time value to be in the same location as the other using the <a href=\"https://golang.org/pkg/time/#Time.In\" rel=\"noreferrer\"><code>Time.In()</code></a> method:</p>\n\n<pre><code>if a.Location() != b.Location() {\n    b = b.In(a.Location())\n}\n</code></pre>\n\n<p><strong>Here's a solution which calculates difference in year, month, day, hour, min, sec:</strong></p>\n\n<pre><code>func diff(a, b time.Time) (year, month, day, hour, min, sec int) {\n    if a.Location() != b.Location() {\n        b = b.In(a.Location())\n    }\n    if a.After(b) {\n        a, b = b, a\n    }\n    y1, M1, d1 := a.Date()\n    y2, M2, d2 := b.Date()\n\n    h1, m1, s1 := a.Clock()\n    h2, m2, s2 := b.Clock()\n\n    year = int(y2 - y1)\n    month = int(M2 - M1)\n    day = int(d2 - d1)\n    hour = int(h2 - h1)\n    min = int(m2 - m1)\n    sec = int(s2 - s1)\n\n    // Normalize negative values\n    if sec &lt; 0 {\n        sec += 60\n        min--\n    }\n    if min &lt; 0 {\n        min += 60\n        hour--\n    }\n    if hour &lt; 0 {\n        hour += 24\n        day--\n    }\n    if day &lt; 0 {\n        // days in month:\n        t := time.Date(y1, M1, 32, 0, 0, 0, 0, time.UTC)\n        day += 32 - t.Day()\n        month--\n    }\n    if month &lt; 0 {\n        month += 12\n        year--\n    }\n\n    return\n}\n</code></pre>\n\n<p>Some tests:</p>\n\n<pre><code>var a, b time.Time\na = time.Date(2015, 5, 1, 0, 0, 0, 0, time.UTC)\nb = time.Date(2016, 6, 2, 1, 1, 1, 1, time.UTC)\nfmt.Println(diff(a, b)) // Expected: 1 1 1 1 1 1\n\na = time.Date(2016, 1, 2, 0, 0, 0, 0, time.UTC)\nb = time.Date(2016, 2, 1, 0, 0, 0, 0, time.UTC)\nfmt.Println(diff(a, b)) // Expected: 0 0 30 0 0 0\n\na = time.Date(2016, 2, 2, 0, 0, 0, 0, time.UTC)\nb = time.Date(2016, 3, 1, 0, 0, 0, 0, time.UTC)\nfmt.Println(diff(a, b)) // Expected: 0 0 28 0 0 0\n\na = time.Date(2015, 2, 11, 0, 0, 0, 0, time.UTC)\nb = time.Date(2016, 1, 12, 0, 0, 0, 0, time.UTC)\nfmt.Println(diff(a, b)) // Expected: 0 11 1 0 0 0\n</code></pre>\n\n<p>Output is as expected:</p>\n\n<pre><code>1 1 1 1 1 1\n0 0 30 0 0 0\n0 0 28 0 0 0\n0 11 1 0 0 0\n</code></pre>\n\n<p>Try it on the <a href=\"http://play.golang.org/p/NgNnBW6gpq\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<p>To calculate how old you are:</p>\n\n<pre><code>// Your birthday: let's say it's January 2nd, 1980, 3:30 AM\nbirthday := time.Date(1980, 1, 2, 3, 30, 0, 0, time.UTC)\nyear, month, day, hour, min, sec := diff(birthday, time.Now())\n\nfmt.Printf(\"You are %d years, %d months, %d days, %d hours, %d mins and %d seconds old.\",\n    year, month, day, hour, min, sec)\n</code></pre>\n\n<p>Example output:</p>\n\n<pre><code>You are 36 years, 3 months, 8 days, 11 hours, 57 mins and 41 seconds old.\n</code></pre>\n\n<p>The magic date/time at which the Go playground time starts is: <code>2009-11-10 23:00:00 UTC</code><br>\nThis is the time when Go was first announced. Let's calculate how old Go is:</p>\n\n<pre><code>goAnnounced := time.Date(2009, 11, 10, 23, 0, 0, 0, time.UTC)\nyear, month, day, hour, min, sec := diff(goAnnounced, time.Now())\nfmt.Printf(\"Go was announced \"+\n    \"%d years, %d months, %d days, %d hours, %d mins and %d seconds ago.\",\n    year, month, day, hour, min, sec)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Go was announced 6 years, 4 months, 29 days, 16 hours, 53 mins and 31 seconds ago.\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "is_accepted": false, "score": 2, "last_activity_date": 1460414135, "creation_date": 1460414135, "answer_id": 36560499, "question_id": 36530251, "link": "https://stackoverflow.com/questions/36530251/time-since-with-months-and-years/36560499#36560499", "title": "time.Since() with months and years", "body": "<p>You could try working with my <a href=\"https://github.com/rickb777/date\" rel=\"nofollow\">date</a> package, which includes the <a href=\"https://godoc.org/github.com/rickb777/date/period\" rel=\"nofollow\">period</a> package for working with ISO-style periods of time (<a href=\"https://en.wikipedia.org/wiki/ISO_8601#Durations\" rel=\"nofollow\">Wikipedia</a>).</p>\n\n<p>The Period type comes with a formatter that understands plurals, printing readable strings such as \"9 years, 2 months\" and \"3 hours, 4 minutes, 1 second\", along with the ISO equivalents (\"P9Y2M\" and \"PT3H4M1S\").</p>\n\n<p>Periods are, of course, tricky due to the variable lengths of days (due to DST) and months (due to the Gregorian calendar). The <code>period</code> package tries to help you by providing an API that allows both precise and imprecise calculations. For short periods (up to \u00b13276 hours) it is able to convert a Duration precisely.</p>\n\n<pre><code>duration := time.Since(...)\np, _ := period.NewOf(duration)\nstr := p.String()\n</code></pre>\n\n<p>If you need precise durations over longer spans, you need to use the Between function (which embody icza's excellent answer).</p>\n\n<pre><code>p := period.Between(t1, t2)\nstr := p.String()\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 873, "user_id": 448956, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/5a265029969d2bf5c5c46d396f5d920f?s=128&d=identicon&r=PG", "display_name": "sbartell", "link": "https://stackoverflow.com/users/448956/sbartell"}, "edited": false, "score": 0, "creation_date": 1504053432, "post_id": 37856861, "comment_id": 78859103, "body": "I&#39;m upvoting this because, even though it has nothing to do with golang, it is a well explained approach in sql. ty sir."}], "tags": [], "owner": {"reputation": 112, "user_id": 927561, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6IX5h.jpg?s=128&g=1", "display_name": "alanzirek", "link": "https://stackoverflow.com/users/927561/alanzirek"}, "is_accepted": false, "score": 2, "last_activity_date": 1466096093, "last_edit_date": 1466096093, "creation_date": 1466073707, "answer_id": 37856861, "question_id": 36530251, "link": "https://stackoverflow.com/questions/36530251/time-since-with-months-and-years/37856861#37856861", "title": "time.Since() with months and years", "body": "<p>If you use PostgreSQL, you can easily get the result with <code>age</code> function.</p>\n\n<p>Suppose you have two dates <code>a</code> and <code>b</code>.</p>\n\n<p>Like icza said, be careful, <code>a</code> and <code>b</code> must be in the same time zone.</p>\n\n<p>First, you can invoke <code>age</code> with two parameters, in your case date <code>a</code> and date <code>b</code>. This function return a interval type that contains years, months, weeks, days, hours, minutes, seconds, and milliseconds.</p>\n\n<pre><code>SELECT age('2016-03-31', '2016-06-30'); -- result is: -2 mons -30 days\n</code></pre>\n\n<p>The second possibilty is to use <code>age</code> function with one parameter. The result is a interval too but in this case, <code>age</code> subtract from current_date (at midnight). Suppose today is 2016/06/16:</p>\n\n<pre><code>SELECT age(timestamp '2016-06-30'); -- result is: -14 days\n</code></pre>\n\n<p>Note, <code>timestamp</code> keyword is needed to cast the date '2016-06-30'.</p>\n\n<p>For more details, you can use <code>date_part</code> or directly <code>extract</code> function that return one specific field (years, months, days...).</p>\n\n<pre><code>SELECT date_part('month', age('2016-03-31', '2016-06-30')); --result is: -2\nSELECT date_part('day',   age('2016-03-31', '2016-06-30')); --result is: -30\n</code></pre>\n\n<p>Full request:</p>\n\n<pre><code>SELECT  \n    date_part('year', diff) as year\n  , date_part('month', diff) as month\n  , date_part('day', diff) as day\nFROM (\n  SELECT age(timestamp '2016-06-30') AS diff\n) as qdiff;\n\n-- result is: \n-- year month day\n-- 0    0     -14\n</code></pre>\n\n<p>(with CTE - Common Table Expression):</p>\n\n<pre><code>WITH qdiff AS (\n  SELECT age(timestamp '2016-06-30') AS diff\n)\nSELECT  \n    date_part('year', diff) as year\n  , date_part('month', diff) as month\n  , date_part('day', diff) as day\nFROM qdiff\n\n-- result is: \n-- year month day\n-- 0    0     -14\n</code></pre>\n\n<p>PostgreSQL documentation (current version): <a href=\"https://www.postgresql.org/docs/current/static/functions-datetime.html\" rel=\"nofollow\">https://www.postgresql.org/docs/current/static/functions-datetime.html</a></p>\n"}, {"tags": [], "owner": {"reputation": 2942, "user_id": 887427, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/84abfab913d9a8d7c5f34bf9a241ae80?s=128&d=identicon&r=PG", "display_name": "robermorales", "link": "https://stackoverflow.com/users/887427/robermorales"}, "is_accepted": false, "score": 3, "last_activity_date": 1520504819, "creation_date": 1520504819, "answer_id": 49170822, "question_id": 36530251, "link": "https://stackoverflow.com/questions/36530251/time-since-with-months-and-years/49170822#49170822", "title": "time.Since() with months and years", "body": "<p>The solution proposed by <a href=\"https://stackoverflow.com/a/36531443/887427\">izca</a> is great, but it misses one thing. If you add the following example, you can see the effect:</p>\n\n<pre><code>a = time.Date(2015, 1, 11, 0, 0, 0, 0, time.UTC)\nb = time.Date(2015, 3, 10, 0, 0, 0, 0, time.UTC)\nfmt.Println(diff(a, b))\n// Expected: 0 1 27 0 0 0\n// Actual output: 0 1 30 0 0 0\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/-v7NjMUjYCI\" rel=\"nofollow noreferrer\"><kbd>playground</kbd></a></p>\n\n<p>The code is calculating the remaining days of the next incomplete month based on the total days of the first month (<code>y1,M1</code>), but it needs to be computed from the previous month of the later date month (<code>y2,M2-1</code>).</p>\n\n<p>The final code is as follows:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\n\nfunc DaysIn(year int, month time.Month) int {\n    return time.Date(year, month+1, 0, 0, 0, 0, 0, time.UTC).Day()\n}\n\nfunc Elapsed(from, to time.Time) (inverted bool, years, months, days, hours, minutes, seconds, nanoseconds int) {\n    if from.Location() != to.Location() {\n        to = to.In(to.Location())\n    }\n\n    inverted = false\n    if from.After(to) {\n        inverted = true\n        from, to = to, from\n    }\n\n    y1, M1, d1 := from.Date()\n    y2, M2, d2 := to.Date()\n\n    h1, m1, s1 := from.Clock()\n    h2, m2, s2 := to.Clock()\n\n    ns1, ns2 := from.Nanosecond(), to.Nanosecond()\n\n    years = y2 - y1\n    months = int(M2 - M1)\n    days = d2 - d1\n\n    hours = h2 - h1\n    minutes = m2 - m1\n    seconds = s2 - s1\n    nanoseconds = ns2 - ns1\n\n    if nanoseconds &lt; 0 {\n        nanoseconds += 1e9\n        seconds--\n    }\n    if seconds &lt; 0 {\n        seconds += 60\n        minutes--\n    }\n    if minutes &lt; 0 {\n        minutes += 60\n        hours--\n    }\n    if hours &lt; 0 {\n        hours += 24\n        days--\n    }\n    if days &lt; 0 {\n        days += DaysIn(y2, M2-1)\n        months--\n    }\n    if months &lt; 0 {\n        months += 12\n        years--\n    }\n    return\n}\n\nfunc main() {\n    var a, b time.Time\n    a = time.Date(2015, 5, 1, 0, 0, 0, 0, time.UTC)\n    b = time.Date(2016, 6, 2, 1, 1, 1, 1, time.UTC)\n    fmt.Println(Elapsed(a, b)) // Expected: false 1 1 1 1 1 1\n\n    a = time.Date(2016, 1, 2, 0, 0, 0, 0, time.UTC)\n    b = time.Date(2016, 2, 1, 0, 0, 0, 0, time.UTC)\n    fmt.Println(Elapsed(a, b)) // Expected: false 0 0 30 0 0 0\n\n    a = time.Date(2016, 2, 2, 0, 0, 0, 0, time.UTC)\n    b = time.Date(2016, 3, 1, 0, 0, 0, 0, time.UTC)\n    fmt.Println(Elapsed(a, b)) // Expected: false 0 0 28 0 0 0\n\n    a = time.Date(2015, 2, 11, 0, 0, 0, 0, time.UTC)\n    b = time.Date(2016, 1, 12, 0, 0, 0, 0, time.UTC)\n    fmt.Println(Elapsed(a, b)) // Expected: false 0 11 1 0 0 0\n\n    a = time.Date(2015, 1, 11, 0, 0, 0, 0, time.UTC)\n    b = time.Date(2015, 3, 10, 0, 0, 0, 0, time.UTC)\n    fmt.Println(Elapsed(a, b)) // Expected: false 0 1 27 0 0 0\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Zep3IMd7rpl\" rel=\"nofollow noreferrer\"><kbd>playground</kbd></a></p>\n"}], "owner": {"reputation": 1282, "user_id": 3648229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6b730f6984c01d9409a83abacb234580?s=128&d=identicon&r=PG", "display_name": "gempir", "link": "https://stackoverflow.com/users/3648229/gempir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 24085, "favorite_count": 8, "accepted_answer_id": 36531443, "answer_count": 5, "score": 23, "last_activity_date": 1578575741, "creation_date": 1460294163, "last_edit_date": 1565768959, "question_id": 36530251, "link": "https://stackoverflow.com/questions/36530251/time-since-with-months-and-years", "title": "time.Since() with months and years", "body": "<p>I am trying to convert a timestamp like this:</p>\n\n<pre><code>2015-06-27T09:34:22+00:00\n</code></pre>\n\n<p>to a time since format so it would say like 9 months ago 1 day 2 hours 30 minutes 2 seconds.</p>\n\n<p>something like that.</p>\n\n<p>I used <code>time.Parse</code> and <code>time.Since</code> to get to this:</p>\n\n<pre><code>6915h7m47.6901559s\n</code></pre>\n\n<p>But how do I convert from there on? Something like this is what I thought:</p>\n\n<pre><code>for hours &gt; 24 {\n        days++\n        hours -= 24\n}\n</code></pre>\n\n<p>But the issue with this is that this won't be accurate for months because months can have 28, 30 and 31 days.</p>\n\n<p>Is there a better way of achieving what I want?</p>\n"}, {"tags": ["go", "tuples", "ternary-operator"], "comments": [{"owner": {"reputation": 332764, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 1, "creation_date": 1460294153, "post_id": 36530175, "comment_id": 60664287, "body": "As you saw there&#39;s no generics in Go. You should embrace Go instead of trying to code as if it was Python. Your &quot;ternary&quot; would be considered bad practice in Go."}, {"owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "reply_to_user": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 0, "creation_date": 1460466124, "post_id": 36530175, "comment_id": 60746799, "body": "@Zoidberg Noted, thanks. I thought that multiple values returned by functions were tuples"}], "answers": [{"comments": [{"owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "edited": false, "score": 0, "creation_date": 1460368113, "post_id": 36530275, "comment_id": 60691371, "body": "By the way, how to do if the tuple is <code>string, int</code> ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "edited": false, "score": 0, "creation_date": 1460370050, "post_id": 36530275, "comment_id": 60692791, "body": "@Thomas Then the function could look like this: <code>func t(test bool, true1 string, true2 int, false1 string, false2 int) (string, int)</code> and everything can be the same. With slices, the slice type may be <code>[]interface{}</code> which can hold any value, but using it requires type assertion."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "edited": false, "score": 0, "creation_date": 1460370956, "post_id": 36530275, "comment_id": 60693386, "body": "@Thomas Please see edited answer. I also added a 3rd solution (with a wrapper <code>struct</code>), which may hold arbitrary number of values and with different types."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1471854906, "last_edit_date": 1471854906, "creation_date": 1460294301, "answer_id": 36530275, "question_id": 36530175, "link": "https://stackoverflow.com/questions/36530175/in-go-how-to-write-functions-that-take-tuple-arguments/36530275#36530275", "title": "In Go, how to write functions that take tuple arguments?", "body": "<h3>Implementing with 2 <code>string</code> return values</h3>\n\n<p>It could look something like this:</p>\n\n<pre><code>func t(test bool, true1, true2, false1, false2 string) (string, string) {\n    if test {\n        return true1, true2\n    }\n    return false1, false2\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>a1, a2 := t(false, \"hi\", \"hello\", \"bye\", \"goodbye\")\nfmt.Println(a1, a2)\n\na1, a2 = t(true, \"hi\", \"hello\", \"bye\", \"goodbye\")\nfmt.Println(a1, a2)\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/DlbektI_g2\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>bye goodbye\nhi hello\n</code></pre>\n\n<h3>Implementing with slice <code>[]string</code> return value</h3>\n\n<p>It might be easier to read and work with if we implement it with <code>string</code> slices: <code>[]string</code>.</p>\n\n<pre><code>func t(test bool, trueVal []string, falseVal []string) []string {\n    if test {\n        return trueVal\n    }\n    return falseVal\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>trueVal := []string{\"hi\", \"hello\"}\nfalseVal := []string{\"bye\", \"goodbye\"}\n\na := t(false, trueVal, falseVal)\nfmt.Println(a)\n\na = t(true, trueVal, falseVal)\nfmt.Println(a)\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/iwfI1xFIkl\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>[bye goodbye]\n[hi hello]\n</code></pre>\n\n<h3>Implementing with a wrapper <code>struct</code> return value</h3>\n\n<p>You may also choose to create a wrapper <code>struct</code> to hold an arbitrary number of values (even having arbitrary / different types):</p>\n\n<pre><code>type Pair struct {\n    v1, v2 string\n}\n\nfunc t(test bool, trueVal Pair, falseVal Pair) Pair {\n    if test {\n        return trueVal\n    }\n    return falseVal\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>trueVal := Pair{\"hi\", \"hello\"}\nfalseVal := Pair{\"bye\", \"goodbye\"}\n\na := t(false, trueVal, falseVal)\nfmt.Println(a)\n\na = t(true, trueVal, falseVal)\nfmt.Println(a)\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/3pDfRwjk-C\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>{bye goodbye}\n{hi hello}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 0, "last_activity_date": 1460294552, "creation_date": 1460294552, "answer_id": 36530318, "question_id": 36530175, "link": "https://stackoverflow.com/questions/36530175/in-go-how-to-write-functions-that-take-tuple-arguments/36530318#36530318", "title": "In Go, how to write functions that take tuple arguments?", "body": "<p>You can use an array (or even a slice if it the number is variable):</p>\n\n<pre><code>func iff(test bool, true_val, false_val [2]string) (string, string) {\n    if test {\n        return true_val[0], true_val[1]\n    }\n    return false_val[0], false_val[1]\n}\n</code></pre>\n\n<p>test:</p>\n\n<pre><code>func main() {\n    a, b := iff(false, [2]string{\"hi\", \"hello\"}, [2]string{\"bye\", \"goodbye\"})\n    fmt.Println(a, b)\n\n    a, b = iff(true, [2]string{\"hi\", \"hello\"}, [2]string{\"bye\", \"goodbye\"})\n    fmt.Println(a, b)\n}\n</code></pre>\n"}], "owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1495, "favorite_count": 0, "accepted_answer_id": 36530275, "answer_count": 2, "score": 2, "last_activity_date": 1471854906, "creation_date": 1460293704, "last_edit_date": 1460332489, "question_id": 36530175, "link": "https://stackoverflow.com/questions/36530175/in-go-how-to-write-functions-that-take-tuple-arguments", "title": "In Go, how to write functions that take tuple arguments?", "body": "<p>I'm new to Go and I am translating a Python program to Go.</p>\n\n<p>I'm a big fan of ternary operator so I quickly implemented</p>\n\n<pre><code>func t2(test bool, true_val, false_val string) string {\n    if test {\n        return true_val\n    } else {\n        return false_val\n    }\n}\n</code></pre>\n\n<p>which works fine.</p>\n\n<p>Unfortunately I had this in Python: <code>a = 'hi', 'hello' if xxx else 'bye', 'goodbye'</code></p>\n\n<p>How does my ternary operator would have to be written for tuples of strings?</p>\n\n<p>I have tried:</p>\n\n<ul>\n<li>generics but learnt they don't exist in Go</li>\n<li>do <code>func t2(test bool, true_val, false_val (string, string)) (string, string)</code> but it doesn't compile</li>\n<li>typedef: <code>type s2 string, string</code> and <code>func t2(test bool, true_val, false_val s2) s2</code> but it doesn't compile</li>\n</ul>\n\n<p>Thanks</p>\n"}, {"tags": ["html", "string", "go", "escaping", "html-escape-characters"], "answers": [{"comments": [{"owner": {"reputation": 307, "user_id": 1503786, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/6cd9bdefe988688b78e5250815a45afe?s=128&d=identicon&r=PG", "display_name": "Muhammad Umer", "link": "https://stackoverflow.com/users/1503786/muhammad-umer"}, "edited": false, "score": 0, "creation_date": 1460290606, "post_id": 36529158, "comment_id": 60663071, "body": "Thank you kind sir! You are awesome! :)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1476267240, "last_edit_date": 1476267240, "creation_date": 1460288051, "answer_id": 36529158, "question_id": 36528575, "link": "https://stackoverflow.com/questions/36528575/how-to-convert-escape-characters-in-html-tags/36529158#36529158", "title": "How to convert escape characters in HTML tags?", "body": "<p>You can use the <a href=\"https://golang.org/pkg/strconv/#Unquote\" rel=\"nofollow\"><code>strconv.Unquote()</code></a> to do the conversion.</p>\n\n<p>One thing you should be aware of is that <code>strconv.Unquote()</code> can only unquote strings that are in quotes (e.g. start and end with a quote char <code>\"</code> or a back quote char <code>`</code>),  so we have to manually append that.</p>\n\n<p>Example:</p>\n\n<pre><code>// Important to use backtick ` (raw string literal)\n// else the compiler will unquote it (interpreted string literal)!\n\ns := `\\u003chtml\\u003e`\nfmt.Println(s)\ns2, err := strconv.Unquote(`\"` + s + `\"`)\nif err != nil {\n    panic(err)\n}\nfmt.Println(s2)\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/e9UOovTYN-\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>\\u003chtml\\u003e\n&lt;html&gt;\n</code></pre>\n\n<hr>\n\n<p><strong>Note:</strong> To do HTML text escaping and unescaping, you can use the <a href=\"https://golang.org/pkg/html/\" rel=\"nofollow\"><code>html</code></a> package. Quoting its doc:</p>\n\n<blockquote>\n  <p>Package html provides functions for escaping and unescaping HTML text.</p>\n</blockquote>\n\n<p>But the <code>html</code> package (specifically <a href=\"https://golang.org/pkg/html/#UnescapeString\" rel=\"nofollow\"><code>html.UnescapeString()</code></a>) does not decode unicode sequences of the form <code>\\uxxxx</code>, only <code>&amp;#decimal;</code> or <code>&amp;#xHH;</code>.</p>\n\n<p>Example:</p>\n\n<pre><code>fmt.Println(html.UnescapeString(`\\u003chtml\\u003e`)) // wrong\nfmt.Println(html.UnescapeString(`&amp;#60;html&amp;#62;`))   // good\nfmt.Println(html.UnescapeString(`&amp;#x3c;html&amp;#x3e;`)) // good\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/bcqJohzYlq\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>\\u003chtml\\u003e\n&lt;html&gt;\n&lt;html&gt;\n</code></pre>\n\n<hr>\n\n<p><strong>Note #2:</strong></p>\n\n<p>You should also note that if you write a code like this:</p>\n\n<pre><code>s := \"\\u003chtml\\u003e\"\n</code></pre>\n\n<p>This quoted string will be unquoted by the compiler itself as it is an <em>interpreted string literal</em>, so you can't really test that. To specify quoted string in the source, you may use the backtick to specify a <em>raw string literal</em> or you may use a <em>double quoted</em> interpreted string literal:</p>\n\n<pre><code>s := \"\\u003chtml\\u003e\" // Interpreted string literal (unquoted by the compiler!)\nfmt.Println(s)\n\ns2 := `\\u003chtml\\u003e` // Raw string literal (no unquoting will take place)\nfmt.Println(s2)\n\ns3 := \"\\\\u003chtml\\\\u003e\" // Double quoted interpreted string literal\n                           // (unquoted by the compiler to be \"single\" quoted)\nfmt.Println(s3)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>&lt;html&gt;\n\\u003chtml\\u003e\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1460290140, "post_id": 36529251, "comment_id": 60662943, "body": "Actually <code>&quot;\\u003chtml\\u003e&quot;</code> is unquoted by the compiler, not by the <code>fmt</code> package. You will see it if you try it with the backtick: `"}], "tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 1, "last_activity_date": 1460288511, "creation_date": 1460288511, "answer_id": 36529251, "question_id": 36528575, "link": "https://stackoverflow.com/questions/36528575/how-to-convert-escape-characters-in-html-tags/36529251#36529251", "title": "How to convert escape characters in HTML tags?", "body": "<p>You can use the <code>fmt</code> string formatting package for this scope. </p>\n\n<pre><code>fmt.Printf(\"%v\",\"\\u003chtml\\u003e\") // will output &lt;html&gt;\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ZEot6bxO1H\" rel=\"nofollow\">https://play.golang.org/p/ZEot6bxO1H</a></p>\n"}, {"tags": [], "owner": {"reputation": 598, "user_id": 9552116, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Coconut", "link": "https://stackoverflow.com/users/9552116/coconut"}, "is_accepted": false, "score": 1, "last_activity_date": 1532852194, "creation_date": 1532852194, "answer_id": 51578497, "question_id": 36528575, "link": "https://stackoverflow.com/questions/36528575/how-to-convert-escape-characters-in-html-tags/51578497#51578497", "title": "How to convert escape characters in HTML tags?", "body": "<p>I think it's a common problem. This is how I get it work.</p>\n\n<pre><code>func _UnescapeUnicodeCharactersInJSON(_jsonRaw json.RawMessage) (json.RawMessage, error) {\n    str, err := strconv.Unquote(strings.Replace(strconv.Quote(string(_jsonRaw)), `\\\\u`, `\\u`, -1))\n    if err != nil {\n        return nil, err\n    }\n    return []byte(str), nil\n}\n\nfunc main() {\n    // Both are valid JSON.\n    var jsonRawEscaped json.RawMessage   // json raw with escaped unicode chars\n    var jsonRawUnescaped json.RawMessage // json raw with unescaped unicode chars\n\n    // '\\u263a' == '\u263a'\n    jsonRawEscaped = []byte(`{\"HelloWorld\": \"\\uC548\\uB155, \\uC138\\uC0C1(\\u4E16\\u4E0A). \\u263a\"}`) // \"\\\\u263a\"\n    jsonRawUnescaped, _ = _UnescapeUnicodeCharactersInJSON(jsonRawEscaped)                        // \"\u263a\"\n\n    fmt.Println(string(jsonRawEscaped))   // {\"HelloWorld\": \"\\uC548\\uB155, \\uC138\\uC0C1(\\u4E16\\u4E0A). \\u263a\"}\n    fmt.Println(string(jsonRawUnescaped)) // {\"HelloWorld\": \"\uc548\ub155, \uc138\uc0c1(\u4e16\u4e0a). \u263a\"}\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/pUsrzrrcDG-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pUsrzrrcDG-</a></p>\n\n<p>Hope this helps someone.</p>\n"}], "owner": {"reputation": 307, "user_id": 1503786, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/6cd9bdefe988688b78e5250815a45afe?s=128&d=identicon&r=PG", "display_name": "Muhammad Umer", "link": "https://stackoverflow.com/users/1503786/muhammad-umer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2613, "favorite_count": 0, "accepted_answer_id": 36529158, "answer_count": 3, "score": 2, "last_activity_date": 1532852194, "creation_date": 1460283984, "last_edit_date": 1460288238, "question_id": 36528575, "link": "https://stackoverflow.com/questions/36528575/how-to-convert-escape-characters-in-html-tags", "title": "How to convert escape characters in HTML tags?", "body": "<p>How can we directly convert <code>\"\\u003chtml\\u003e\"</code> to <code>\"&lt;html&gt;\"</code>? Conversion of <code>\"&lt;html&gt;\"</code> to <code>\"\\u003chtml\\u003e\"</code> is quite easy using <code>json.Marshal()</code>, but <code>json.Unmarshal()</code> is quite lengthy and cumbersome. Is there any direct way to do that in golang?</p>\n"}, {"tags": ["windows", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1460283352, "post_id": 36528186, "comment_id": 60661013, "body": "You either have to add c:\\go\\bin to your path or call go by it&#39;s full path."}], "answers": [{"comments": [{"owner": {"reputation": 3902, "user_id": 4664382, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/199793134126c6e53309c85f04f30242?s=128&d=identicon&r=PG&f=1", "display_name": "Apswak", "link": "https://stackoverflow.com/users/4664382/apswak"}, "edited": false, "score": 0, "creation_date": 1460282997, "post_id": 36528380, "comment_id": 60660910, "body": "Already tried that but seems to not work. Should I be calling &quot;go&quot; from a specific directory in the cmd?"}, {"owner": {"reputation": 254, "user_id": 5907262, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72f7bbf9ea306da3e322d886f8f7ed19?s=128&d=identicon&r=PG&f=1", "display_name": "Xeph", "link": "https://stackoverflow.com/users/5907262/xeph"}, "reply_to_user": {"reputation": 3902, "user_id": 4664382, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/199793134126c6e53309c85f04f30242?s=128&d=identicon&r=PG&f=1", "display_name": "Apswak", "link": "https://stackoverflow.com/users/4664382/apswak"}, "edited": false, "score": 1, "creation_date": 1460283090, "post_id": 36528380, "comment_id": 60660937, "body": "What about &#39;PATH&#39; it self? Does it include &#39;C:\\Go\\bin&#39;? It should."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1460283304, "post_id": 36528380, "comment_id": 60660999, "body": "<b>Never</b> <b>ever</b> (except you know what you are doing) set GOROOT. Never. And do not give this advice to anybody."}, {"owner": {"reputation": 3902, "user_id": 4664382, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/199793134126c6e53309c85f04f30242?s=128&d=identicon&r=PG&f=1", "display_name": "Apswak", "link": "https://stackoverflow.com/users/4664382/apswak"}, "edited": false, "score": 0, "creation_date": 1460283408, "post_id": 36528380, "comment_id": 60661031, "body": "Setting &quot;Path&quot; to that made it work. Now when I type go it lists all the commands so I think it works, but when I type &quot;go env&quot;, it says &quot;GOPATH entry is relative; must be absolute path: &quot;\\\\USERS\\\\William\\\\Go&quot;. Do you know what this means?"}, {"owner": {"reputation": 254, "user_id": 5907262, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72f7bbf9ea306da3e322d886f8f7ed19?s=128&d=identicon&r=PG&f=1", "display_name": "Xeph", "link": "https://stackoverflow.com/users/5907262/xeph"}, "edited": false, "score": 1, "creation_date": 1460283587, "post_id": 36528380, "comment_id": 60661076, "body": "Set it to &quot;C:\\Users\\William\\Go&quot; instead of &quot;%HOMEPATH%\\Go"}], "tags": [], "owner": {"reputation": 254, "user_id": 5907262, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72f7bbf9ea306da3e322d886f8f7ed19?s=128&d=identicon&r=PG&f=1", "display_name": "Xeph", "link": "https://stackoverflow.com/users/5907262/xeph"}, "is_accepted": true, "score": 9, "last_activity_date": 1460283949, "last_edit_date": 1460283949, "creation_date": 1460282872, "answer_id": 36528380, "question_id": 36528186, "link": "https://stackoverflow.com/questions/36528186/golang-getting-started-go-is-not-recognized-as-an-internal-or-external-comm/36528380#36528380", "title": "Golang: Getting started - &quot;go&quot; is not recognized as an internal or external command&quot;", "body": "<p>EDITED for future reference.</p>\n\n<ol>\n<li><p>You set your 'GOROOT' wrong. Set it to C:\\Go\\</p></li>\n<li><p>Include C:\\Go\\bin to your 'Path'</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 7660599, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/6d40759e48bb5dd7212e94e7ef00a68b?s=128&d=identicon&r=PG", "display_name": "Garima", "link": "https://stackoverflow.com/users/7660599/garima"}, "is_accepted": false, "score": 3, "last_activity_date": 1488695257, "creation_date": 1488695257, "answer_id": 42605230, "question_id": 36528186, "link": "https://stackoverflow.com/questions/36528186/golang-getting-started-go-is-not-recognized-as-an-internal-or-external-comm/42605230#42605230", "title": "Golang: Getting started - &quot;go&quot; is not recognized as an internal or external command&quot;", "body": "<p>Run command \"go env\" and check the path for variable \"gopath\" that's where you should keep your project. Else where if you run go command you will get error \"go is not recognized as internal or external command\"</p>\n"}, {"tags": [], "owner": {"reputation": 617, "user_id": 1434153, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/OlC2X.jpg?s=128&g=1", "display_name": "Nth.gol", "link": "https://stackoverflow.com/users/1434153/nth-gol"}, "is_accepted": false, "score": 4, "last_activity_date": 1551468618, "creation_date": 1551468618, "answer_id": 54951161, "question_id": 36528186, "link": "https://stackoverflow.com/questions/36528186/golang-getting-started-go-is-not-recognized-as-an-internal-or-external-comm/54951161#54951161", "title": "Golang: Getting started - &quot;go&quot; is not recognized as an internal or external command&quot;", "body": "<p>Aside from @Xeph's answer, just make sure if you recently installed Go that you use a fresh terminal/cmd window. </p>\n"}, {"tags": [], "owner": {"reputation": 243, "user_id": 3366943, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SoRp2.jpg?s=128&g=1", "display_name": "user3366943", "link": "https://stackoverflow.com/users/3366943/user3366943"}, "is_accepted": false, "score": 1, "last_activity_date": 1587050218, "creation_date": 1587050218, "answer_id": 61253835, "question_id": 36528186, "link": "https://stackoverflow.com/questions/36528186/golang-getting-started-go-is-not-recognized-as-an-internal-or-external-comm/61253835#61253835", "title": "Golang: Getting started - &quot;go&quot; is not recognized as an internal or external command&quot;", "body": "<p>here's what made it work for me, assuming you hadnt change anything from a fresh GO install in windows 10.</p>\n\n<ol>\n<li><p>set GOROOT in user variables:  <strong><code>C:\\Go\\</code></strong></p>\n\n<ul>\n<li><a href=\"https://i.stack.imgur.com/fNus2.jpg\" rel=\"nofollow noreferrer\">GOROOT User Variable screen shot</a></li>\n</ul></li>\n<li><p>add path in user variables: <strong><code>%USERPROFILE%\\Go\\bin</code></strong></p>\n\n<ul>\n<li><a href=\"https://i.stack.imgur.com/493ZB.jpg\" rel=\"nofollow noreferrer\">Add path to User Variables screen shot</a></li>\n</ul></li>\n<li><p>add path in system variables: <strong><code>C:\\Go\\bin</code></strong></p>\n\n<ul>\n<li><a href=\"https://i.stack.imgur.com/OA0Zz.jpg\" rel=\"nofollow noreferrer\">Add path to System Variables screen shot</a></li>\n</ul></li>\n</ol>\n"}], "owner": {"reputation": 3902, "user_id": 4664382, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/199793134126c6e53309c85f04f30242?s=128&d=identicon&r=PG&f=1", "display_name": "Apswak", "link": "https://stackoverflow.com/users/4664382/apswak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17184, "favorite_count": 0, "accepted_answer_id": 36528380, "answer_count": 4, "score": 6, "last_activity_date": 1587735584, "creation_date": 1460281438, "last_edit_date": 1587735584, "question_id": 36528186, "link": "https://stackoverflow.com/questions/36528186/golang-getting-started-go-is-not-recognized-as-an-internal-or-external-comm", "title": "Golang: Getting started - &quot;go&quot; is not recognized as an internal or external command&quot;", "body": "<p>Trying to get started with Go but I cant manage to set up the work environnement properly.</p>\n"}, {"tags": ["go", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 419, "user_id": 1477957, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/9d7fe98fbe5095cd2c71d729459ab7f5?s=128&d=identicon&r=PG", "display_name": "MrSSS16", "link": "https://stackoverflow.com/users/1477957/mrsss16"}, "edited": false, "score": 0, "creation_date": 1460295226, "post_id": 36530002, "comment_id": 60664623, "body": "Thanks for the answer and yes I am aware of the uppercase scope rule however when I tried your solution the <code>config</code> was not picked up by other packages. So my <code>main.go</code> is in <code>package main</code> I renamed the variable to <code>Config</code> as suggested then tried referencing it in <code>database&#47;dbaccess.go</code> . However I get <code>unresolved reference</code> seems like it did not work"}, {"owner": {"reputation": 6950, "user_id": 5371821, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/gHZQr.jpg?s=128&g=1", "display_name": "starkshang", "link": "https://stackoverflow.com/users/5371821/starkshang"}, "reply_to_user": {"reputation": 419, "user_id": 1477957, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/9d7fe98fbe5095cd2c71d729459ab7f5?s=128&d=identicon&r=PG", "display_name": "MrSSS16", "link": "https://stackoverflow.com/users/1477957/mrsss16"}, "edited": false, "score": 0, "creation_date": 1460296578, "post_id": 36530002, "comment_id": 60665061, "body": "@MrSSS16,sorry,you should also declare it as a global variable,My answer has been updated."}, {"owner": {"reputation": 419, "user_id": 1477957, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/9d7fe98fbe5095cd2c71d729459ab7f5?s=128&d=identicon&r=PG", "display_name": "MrSSS16", "link": "https://stackoverflow.com/users/1477957/mrsss16"}, "edited": false, "score": 0, "creation_date": 1460298775, "post_id": 36530002, "comment_id": 60665854, "body": "I don&#39;t see your change in the answer and still have the same issue where the other packages can&#39;t detect my <code>Config</code> from <code>main.go</code>. So I declared in my main <code>var Config *models.Config</code> but I can&#39;t access this from other packages, specifically <code>database</code>."}, {"owner": {"reputation": 6950, "user_id": 5371821, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/gHZQr.jpg?s=128&g=1", "display_name": "starkshang", "link": "https://stackoverflow.com/users/5371821/starkshang"}, "reply_to_user": {"reputation": 419, "user_id": 1477957, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/9d7fe98fbe5095cd2c71d729459ab7f5?s=128&d=identicon&r=PG", "display_name": "MrSSS16", "link": "https://stackoverflow.com/users/1477957/mrsss16"}, "edited": false, "score": 0, "creation_date": 1460299108, "post_id": 36530002, "comment_id": 60665955, "body": "@MrSSS16,maybe network issue,I add the example code,according your newest question,have you import the main package by add code <code>import &quot;xx&#47;main&quot;</code>?"}, {"owner": {"reputation": 419, "user_id": 1477957, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/9d7fe98fbe5095cd2c71d729459ab7f5?s=128&d=identicon&r=PG", "display_name": "MrSSS16", "link": "https://stackoverflow.com/users/1477957/mrsss16"}, "edited": false, "score": 1, "creation_date": 1460302064, "post_id": 36530002, "comment_id": 60667077, "body": "Right but from what I read it is discouraged to do that but rather define the &#39;var Config *models.config&#39; in a separate package then reference it from there rather then import the main package into sub packages. So I defined the global config inside &#39;Config.go&#39;. The issue is that the variable is empty when I access it from &#39;database&#39;"}, {"owner": {"reputation": 700, "user_id": 5484988, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AESxW.jpg?s=128&g=1", "display_name": "Li Jinyao", "link": "https://stackoverflow.com/users/5484988/li-jinyao"}, "edited": false, "score": 0, "creation_date": 1556023166, "post_id": 36530002, "comment_id": 98289664, "body": "Is there a better way to prevent modification of the global configuration?"}], "tags": [], "owner": {"reputation": 6950, "user_id": 5371821, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/gHZQr.jpg?s=128&g=1", "display_name": "starkshang", "link": "https://stackoverflow.com/users/5371821/starkshang"}, "is_accepted": false, "score": 2, "last_activity_date": 1460298972, "last_edit_date": 1460298972, "creation_date": 1460292786, "answer_id": 36530002, "question_id": 36528091, "link": "https://stackoverflow.com/questions/36528091/golang-sharing-configurations-between-packages/36530002#36530002", "title": "Golang sharing configurations between packages", "body": "<p>Now what you want just is to provide a variable can be used in another package,the solution is easy,remember that if you declare a variable name begins with uppercase letter:[A-Z],this variable can be visible and used in another package in go.</p>\n\n<p>So you just need to rename <code>config</code> in your <code>main.go</code> to <code>Config</code> and extract it as global variable:</p>\n\n<pre><code>var Config *models.Config\nfunc main(){\nargs := os.Args[1:]\nif len(args) == 0{\n   fmt.Println(\"********************\\nMust specify a config file   in args\\n********************\")\nos.Exit(1)\n}\n\nConfig = models.NewConfig(args[0])\nport := Config.Server[\"PORT\"]\n\nrouter := routing.NewRouter()\nfmt.Printf(  \"-------------------------------------------------\\n\"+\n    \"Listening and Serving on Port %s\\n\"+\n    \"-------------------------------------------------\",port)\n\nlog.Fatal(http.ListenAndServe(\":\"+port,router))\n}\n</code></pre>\n\n<p>when you want to use it in another package,just call <code>&lt;package name&gt;.Config</code>,the package name is the package name which your main.go belongs to,maybe <code>main</code> in your case.</p>\n"}, {"comments": [{"owner": {"reputation": 193, "user_id": 6021141, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh6.googleusercontent.com/-HYxHwhV_pCY/AAAAAAAAAAI/AAAAAAAAC7U/c14EUCgteQg/photo.jpg?sz=128", "display_name": "Marvin Collins", "link": "https://stackoverflow.com/users/6021141/marvin-collins"}, "edited": false, "score": 0, "creation_date": 1617024651, "post_id": 36693867, "comment_id": 118177628, "body": "Avoid using global variable and init functions in your golang applications"}], "tags": [], "owner": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "is_accepted": false, "score": 5, "last_activity_date": 1460982542, "last_edit_date": 1460982542, "creation_date": 1460982106, "answer_id": 36693867, "question_id": 36528091, "link": "https://stackoverflow.com/questions/36528091/golang-sharing-configurations-between-packages/36693867#36693867", "title": "Golang sharing configurations between packages", "body": "<p>What I would suggest is declaring a global variable in <code>config.go</code> and initialize it using the <code>init()</code> function. That way, you know that the variable will always be initialized when any package imports it. Here's some code:</p>\n\n<pre><code>package models\n\nimport (\n   \"io/ioutil\"\n   \"encoding/json\"\n)\n\n\nvar (\n\n    Configuration Config \n)\n\n\ninit() {\n\n    args := os.Args[1:]\n    if len(args) == 0{\n       fmt.Println(\"********************\\nMust specify a config file   in args\\n********************\")\n       os.Exit(1)\n   }\n\n   Configuration = NewConfig(args[0]) // configuration initialized here\n}\n\ntype Config struct  {\n   Db map[string]string `json:\"db\"`\n   Server map[string]string `json:\"server\"`\n}\n\n\nfunc NewConfig(fname string) *Config{\n   data,err := ioutil.ReadFile(fname)\n   if err != nil{\n      panic(err)\n   }\n   config := Config{}\n   err = json.Unmarshal(data,&amp;config)\n   if err != nil {\n      panic(err)\n   }\n   return config\n}\n</code></pre>\n\n<p><code>var()</code> is going to run before <code>init()</code>, but <code>init()</code> will run <strong>before the code in the package importing it</strong>. So if <code>main.go</code> imports the <code>models</code> package, then <code>init()</code> in <code>models</code> will run before any code inside <code>main.go</code> and thus the variable <code>Configuration</code> will be initialized before it is used.</p>\n\n<p><a href=\"https://golang.org/doc/effective_go.html#init\" rel=\"noreferrer\">Effective Go explanation of init()</a> </p>\n"}, {"tags": [], "owner": {"reputation": 1105, "user_id": 3079922, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RdiYz.png?s=128&g=1", "display_name": "Marco M", "link": "https://stackoverflow.com/users/3079922/marco-m"}, "is_accepted": false, "score": 0, "last_activity_date": 1533041899, "creation_date": 1533041899, "answer_id": 51613966, "question_id": 36528091, "link": "https://stackoverflow.com/questions/36528091/golang-sharing-configurations-between-packages/51613966#51613966", "title": "Golang sharing configurations between packages", "body": "<p>I've built a library just for that, a toolbox factory (singletons) &amp; an agnostic config parser (yaml, json and toml), give it a look, watch the example: <a href=\"https://github.com/oblq/sprbox\" rel=\"nofollow noreferrer\">SpareBox</a></p>\n"}], "owner": {"reputation": 419, "user_id": 1477957, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/9d7fe98fbe5095cd2c71d729459ab7f5?s=128&d=identicon&r=PG", "display_name": "MrSSS16", "link": "https://stackoverflow.com/users/1477957/mrsss16"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8749, "favorite_count": 4, "answer_count": 3, "score": 14, "last_activity_date": 1557849734, "creation_date": 1460280824, "question_id": 36528091, "link": "https://stackoverflow.com/questions/36528091/golang-sharing-configurations-between-packages", "title": "Golang sharing configurations between packages", "body": "<p>So I just started learning the Go programming language and have spent hours on end looking at examples, references and so forth. As most of you would agree there is no better way to learn a language than to dive in and make something, which is what I am attempting to do at the moment. I am building a Restful web service. I have managed to get the basics running as well as inserting into db, registering routes etc. However for the past two days I have been struggling to implement application configurations/properties. It could just be that since I'm newbie my Go project architecture is all wrong hence why I am having such difficulty with this. Without further a due here is my project structure</p>\n\n<pre><code>src\n   server\n      database\n         dbaccess.go\n         dbcomm.go\n      handling\n         handler.go\n         handlercomm.go\n      models\n         config.go\n         response.go\n         user.go\n      routing\n         routes.go\n      main.go\n</code></pre>\n\n<p>Here is my config.go</p>\n\n<pre><code>package models\n\nimport (\n   \"io/ioutil\"\n   \"encoding/json\"\n)\n\ntype Config struct  {\n   Db map[string]string `json:\"db\"`\n   Server map[string]string `json:\"server\"`\n}\n\n\nfunc NewConfig(fname string) *Config{\n   data,err := ioutil.ReadFile(fname)\n   if err != nil{\n      panic(err)\n   }\n   config := Config{}\n   err = json.Unmarshal(data,&amp;config)\n   if err != nil {\n   panic(err)\n}\nreturn config\n</code></pre>\n\n<p>This is my main</p>\n\n<pre><code>func main(){\n    args := os.Args[1:]\n    if len(args) == 0{\n       fmt.Println(\"********************\\nMust specify a config file   in args\\n********************\")\n    os.Exit(1)\n   }\n\n   config := models.NewConfig(args[0])\n   port := config.Server[\"PORT\"]\n\n   router := routing.NewRouter()\n   fmt.Printf(  \"-------------------------------------------------\\n\"+\n        \"Listening and Serving on Port %s\\n\"+\n        \"-------------------------------------------------\",port)\n\n   log.Fatal(http.ListenAndServe(\":\"+port,router))\n }\n</code></pre>\n\n<p>And finally this is where my routes get mapped</p>\n\n<pre><code>type Route struct {\n   Name string\n   Method string\n   Pattern string\n   HandlerFunc http.HandlerFunc\n}\n\nvar routes = []Route{\n   Route{\n    \"signup\",\n    \"POST\",\n    \"/signup\",\n    handling.PostSignUpUser,\n   },\n\n   Route{\n    \"authenticate\",\n    \"POST\",\n    \"/login\",\n    handling.PostLogin,\n   },\n}\n\nfunc NewRouter() *mux.Router{\n router :=  mux.NewRouter().StrictSlash(true)\n for _,route := range routes{       \n    router.Methods(route.Method)\n          .Path(route.Pattern)\n          .Name(route.Name)\n          .Handler(route.HandlerFunc)\n}\n\nreturn router\n}\n</code></pre>\n\n<p>So as you can see in my Main I initialise the relevant configurations from a file which is fine. But the issue is how would I go about using that same config object from main in the database package,since I will need to set Host,Ports etc ? I could parse the file again but I would prefer if I could share that one object from the start. Please point me in the right direction </p>\n"}, {"tags": ["go", "timezone"], "answers": [{"comments": [{"owner": {"reputation": 1012, "user_id": 1812225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f4353e2db7dca0676814e41a0582980?s=128&d=identicon&r=PG", "display_name": "let4be", "link": "https://stackoverflow.com/users/1812225/let4be"}, "edited": false, "score": 0, "creation_date": 1460299896, "post_id": 36529883, "comment_id": 60666276, "body": "correct, but i&#39;m talking about <i>daylight</i> savings times, and this an is <i>additional</i> +/-1 hours shifting in addition to the timezone. 26 Oct, 2014 02:00am was the last time we&#39;ve had this time shift, golang doesn&#39;t seem to know about this... Other time shiftings regarding daylight savings time seem to work within Europe/Moscow timezone, just not this specific date/time"}, {"owner": {"reputation": 1253974, "user_id": 22656, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6d8ebb117e8d83d74ea95fbdd0f87e13?s=128&d=identicon&r=PG", "display_name": "Jon Skeet", "link": "https://stackoverflow.com/users/22656/jon-skeet"}, "edited": false, "score": 1, "creation_date": 1460614650, "post_id": 36529883, "comment_id": 60826760, "body": "The OP is printing both <code>testz</code> and <code>testz.UTC()</code>. Look at the output - each line contains the local time <i>and</i> the UTC time. The OP is (understandably) alarmed that the UTC offset isn&#39;t changing when they expect it to be - which is explained in my answer."}], "tags": [], "owner": {"reputation": 6950, "user_id": 5371821, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/gHZQr.jpg?s=128&g=1", "display_name": "starkshang", "link": "https://stackoverflow.com/users/5371821/starkshang"}, "is_accepted": false, "score": -2, "last_activity_date": 1460292226, "creation_date": 1460292226, "answer_id": 36529883, "question_id": 36528017, "link": "https://stackoverflow.com/questions/36528017/golang-timezone-daylight-savings-time-doesnt-work/36529883#36529883", "title": "golang timezone daylight savings time doesn&#39;t work", "body": "<p>It's not because your code has error,just for <code>time.UTC()</code> will print UTC time,that is timezone 0 time,and from your code <code>time.LoadLocation(\"Europe/Moscow\")</code> we can know maybe you are in Moscow,which belongs to east timezone 3,so the time will be earlier than utc time by three hours,meaning that <strong>&lt;your time>=&lt;utc time>+3.</strong></p>\n"}, {"comments": [{"owner": {"reputation": 1012, "user_id": 1812225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f4353e2db7dca0676814e41a0582980?s=128&d=identicon&r=PG", "display_name": "let4be", "link": "https://stackoverflow.com/users/1812225/let4be"}, "edited": false, "score": 0, "creation_date": 1460742473, "post_id": 36589934, "comment_id": 60900538, "body": "Just checked, it shows 0:59, 1:00, 1:01 but in +0400 MSK timezone... And I don&#39;t get it... This time(&#39;2014-10-26 02:00:00 +0300 MSK 2014-10-25 23:00:00 +0000 UTC&#39;) and any further within this hour from the first output is not technically possible at all, as clocks were moved and this hour should be skipped"}, {"owner": {"reputation": 1253974, "user_id": 22656, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6d8ebb117e8d83d74ea95fbdd0f87e13?s=128&d=identicon&r=PG", "display_name": "Jon Skeet", "link": "https://stackoverflow.com/users/22656/jon-skeet"}, "reply_to_user": {"reputation": 1012, "user_id": 1812225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f4353e2db7dca0676814e41a0582980?s=128&d=identicon&r=PG", "display_name": "let4be", "link": "https://stackoverflow.com/users/1812225/let4be"}, "edited": false, "score": 0, "creation_date": 1460742737, "post_id": 36589934, "comment_id": 60900674, "body": "@let4be: Are you sure you included the <code>Add(time.Hour)</code> part? It sounds like it. Don&#39;t forget that the hour isn&#39;t skipped - it&#39;s <i>repeated</i>. I think you may have confused yourself about the kind of change this is."}, {"owner": {"reputation": 1253974, "user_id": 22656, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6d8ebb117e8d83d74ea95fbdd0f87e13?s=128&d=identicon&r=PG", "display_name": "Jon Skeet", "link": "https://stackoverflow.com/users/22656/jon-skeet"}, "reply_to_user": {"reputation": 1012, "user_id": 1812225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f4353e2db7dca0676814e41a0582980?s=128&d=identicon&r=PG", "display_name": "let4be", "link": "https://stackoverflow.com/users/1812225/let4be"}, "edited": false, "score": 0, "creation_date": 1460742818, "post_id": 36589934, "comment_id": 60900713, "body": "@let4be: I&#39;m installing Go now so I can try it for myself :)"}, {"owner": {"reputation": 1253974, "user_id": 22656, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6d8ebb117e8d83d74ea95fbdd0f87e13?s=128&d=identicon&r=PG", "display_name": "Jon Skeet", "link": "https://stackoverflow.com/users/22656/jon-skeet"}, "reply_to_user": {"reputation": 1012, "user_id": 1812225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f4353e2db7dca0676814e41a0582980?s=128&d=identicon&r=PG", "display_name": "let4be", "link": "https://stackoverflow.com/users/1812225/let4be"}, "edited": false, "score": 0, "creation_date": 1460743389, "post_id": 36589934, "comment_id": 60901047, "body": "@let4be: I&#39;ve just tried it myself, and the output is exactly what I expect it to be. Make sure you&#39;ve got the second line of the code I showed."}], "tags": [], "owner": {"reputation": 1253974, "user_id": 22656, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6d8ebb117e8d83d74ea95fbdd0f87e13?s=128&d=identicon&r=PG", "display_name": "Jon Skeet", "link": "https://stackoverflow.com/users/22656/jon-skeet"}, "is_accepted": true, "score": 2, "last_activity_date": 1460614774, "last_edit_date": 1460614774, "creation_date": 1460527625, "answer_id": 36589934, "question_id": 36528017, "link": "https://stackoverflow.com/questions/36528017/golang-timezone-daylight-savings-time-doesnt-work/36589934#36589934", "title": "golang timezone daylight savings time doesn&#39;t work", "body": "<p>Given your output, it looks like this line:</p>\n\n<pre><code>testz , _ := time.ParseInLocation(timeFormat, \"26 Oct, 2014 01:59am\", loc)\n</code></pre>\n\n<p>... is actually giving you the <em>later</em> of the two occurrences of 1:59am, given that it's showing an offset of +3. In other words, you're looking at three minutes of time an hour later than you want to be - starting nearly an hour after the daylight saving transition.</p>\n\n<p>You can change your code to start with an unambiguous value like this:</p>\n\n<pre><code>testz, _ := time.ParseInLocation(timeFormat, \"26 Oct, 2014 00:59am\", loc)\ntestz = testz.Add(time.Hour)\n</code></pre>\n\n<p>I'd expect that to then show</p>\n\n<pre><code>2014-10-26 01:59:00 +0400 MSK 2014-10-25 21:59:00 +0000 UTC\n2014-10-26 01:00:00 +0300 MSK 2014-10-25 22:00:00 +0000 UTC\n2014-10-26 01:01:00 +0300 MSK 2014-10-25 22:01:00 +0000 UTC\n</code></pre>\n\n<p>(I haven't tried this, as I don't have Go installed - but I'd expect it to work.)</p>\n"}], "owner": {"reputation": 1012, "user_id": 1812225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f4353e2db7dca0676814e41a0582980?s=128&d=identicon&r=PG", "display_name": "let4be", "link": "https://stackoverflow.com/users/1812225/let4be"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2015, "favorite_count": 0, "accepted_answer_id": 36589934, "answer_count": 2, "score": 1, "last_activity_date": 1460614774, "creation_date": 1460280297, "question_id": 36528017, "link": "https://stackoverflow.com/questions/36528017/golang-timezone-daylight-savings-time-doesnt-work", "title": "golang timezone daylight savings time doesn&#39;t work", "body": "<p>I know that on 26 Oct, 2014 02:00am the clock should go backwards 1 hour, but I can't reproduce this using a simple golang program</p>\n\n<pre><code>const timeFormat = \"2 Jan, 2006 3:04pm\"\n\nloc, err := time.LoadLocation(\"Europe/Moscow\")\nlog.Print(loc, err)\n\ntestz , _ := time.ParseInLocation( timeFormat, \"26 Oct, 2014 01:59am\",  loc)\nfmt.Println( testz , testz.UTC())\ntestz = testz.Add( time.Minute )\nfmt.Println( testz , testz.UTC())\ntestz = testz.Add( time.Minute )\nfmt.Println( testz , testz.UTC())\n</code></pre>\n\n<p>outputs</p>\n\n<pre><code>2014-10-26 01:59:00 +0300 MSK 2014-10-25 22:59:00 +0000 UTC\n2014-10-26 02:00:00 +0300 MSK 2014-10-25 23:00:00 +0000 UTC\n2014-10-26 02:01:00 +0300 MSK 2014-10-25 23:01:00 +0000 UTC\n</code></pre>\n\n<p>go 1.6, linux</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4124, "user_id": 2629095, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/680dfd61e8b392153c85cf93498b8100?s=128&d=identicon&r=PG", "display_name": "nevets", "link": "https://stackoverflow.com/users/2629095/nevets"}, "edited": false, "score": 0, "creation_date": 1460276582, "post_id": 36527261, "comment_id": 60659132, "body": "agree with Roland lllig&#39;s answer. Your panic is reporting <code>schema.MerchantResultset</code> is not implementing the method, this is true since Add method has pointer receiver. You need to pass <code>&amp;MerchantResultset{}</code> around, not <code>MerchantResultset{}</code>."}, {"owner": {"reputation": 6987, "user_id": 816415, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6718587772b15f57b3e7923aee8420ea?s=128&d=identicon&r=PG", "display_name": "gextra", "link": "https://stackoverflow.com/users/816415/gextra"}, "reply_to_user": {"reputation": 4124, "user_id": 2629095, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/680dfd61e8b392153c85cf93498b8100?s=128&d=identicon&r=PG", "display_name": "nevets", "link": "https://stackoverflow.com/users/2629095/nevets"}, "edited": false, "score": 0, "creation_date": 1460277653, "post_id": 36527261, "comment_id": 60659397, "body": "Somehow both options still gives the same panic:  1) item := schema.Merchant{}; resultSet.Add(item) 2) item := schema.Merchant{}; resultSet.Add(&amp;item)"}, {"owner": {"reputation": 6987, "user_id": 816415, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6718587772b15f57b3e7923aee8420ea?s=128&d=identicon&r=PG", "display_name": "gextra", "link": "https://stackoverflow.com/users/816415/gextra"}, "reply_to_user": {"reputation": 4124, "user_id": 2629095, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/680dfd61e8b392153c85cf93498b8100?s=128&d=identicon&r=PG", "display_name": "nevets", "link": "https://stackoverflow.com/users/2629095/nevets"}, "edited": false, "score": 0, "creation_date": 1460278616, "post_id": 36527261, "comment_id": 60659676, "body": "so basically it means that the only implementer would be func (mr MerchantResultset) Add(item interface{}) ?"}, {"owner": {"reputation": 4124, "user_id": 2629095, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/680dfd61e8b392153c85cf93498b8100?s=128&d=identicon&r=PG", "display_name": "nevets", "link": "https://stackoverflow.com/users/2629095/nevets"}, "edited": false, "score": 2, "creation_date": 1460278814, "post_id": 36527261, "comment_id": 60659734, "body": "you misunderstood, please have a look at the difference between <a href=\"http://nathanleclaire.com/blog/2014/08/09/dont-get-bitten-by-pointer-vs-non-pointer-method-receivers-in-golang/\" rel=\"nofollow noreferrer\">pointer receiver and non-pointer receiver</a> and how you could initialize them. Basically you need to do <code>item := &amp;schema.Merchant{}</code> to get it implemented the interface."}], "answers": [{"tags": [], "owner": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "is_accepted": true, "score": 19, "last_activity_date": 1460275093, "creation_date": 1460275093, "answer_id": 36527323, "question_id": 36527261, "link": "https://stackoverflow.com/questions/36527261/interface-conversion-panic-when-method-is-not-actually-missing/36527323#36527323", "title": "interface conversion panic when method is not actually missing", "body": "<p>Probably it\u2019s because you are passing around a <code>MerchantResultset</code>, but the <code>Add</code> method is only defined for a <em>pointer to</em> that type.</p>\n"}], "owner": {"reputation": 6987, "user_id": 816415, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6718587772b15f57b3e7923aee8420ea?s=128&d=identicon&r=PG", "display_name": "gextra", "link": "https://stackoverflow.com/users/816415/gextra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5124, "favorite_count": 1, "accepted_answer_id": 36527323, "answer_count": 1, "score": 11, "last_activity_date": 1548753374, "creation_date": 1460274684, "question_id": 36527261, "link": "https://stackoverflow.com/questions/36527261/interface-conversion-panic-when-method-is-not-actually-missing", "title": "interface conversion panic when method is not actually missing", "body": "<p>Somehow, at runtime, I am getting  the following <strong>panic</strong> message, even if it appears to me the method is properly defined to the struct that implements that interface.</p>\n\n<pre><code>panic: interface conversion: schema.MerchantResultset \nis not search.ResultsetInterface: missing method Add\n</code></pre>\n\n<p>This is the <strong>interface</strong> blueprint</p>\n\n<pre><code>type ResultsetInterface interface {\n    Init(string)\n    CacheSet(context.Context) error\n    CacheSetPart(context.Context, int) error\n    CacheGet(context.Context, string) error\n    Add(interface{})\n    AddResultset(interface{})\n}\n</code></pre>\n\n<p>The following is the method that is reported <strong>missing</strong> during runtime, which is assigned to my struct MerchantResultset. </p>\n\n<pre><code>func (mr *MerchantResultset) Add(item interface{}) {\n    mr.Data = append(mr.Data, item.(Merchant))\n}\n</code></pre>\n\n<p>I am somehow very puzzled trying to understand what is actually being needed here</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2705585"}, "edited": false, "score": 0, "creation_date": 1460271827, "post_id": 36526889, "comment_id": 60657966, "body": "At first look I think <code>+</code> should not be escaped if that&#39;s what you are doing with `\\\\`, because then it will be literal and not meta-character."}, {"owner": {"reputation": 693, "user_id": 3990434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JMTJk.jpg?s=128&g=1", "display_name": "Gon", "link": "https://stackoverflow.com/users/3990434/gon"}, "edited": false, "score": 0, "creation_date": 1460272111, "post_id": 36526889, "comment_id": 60658033, "body": "That was one of the attempt :) I tried every combination, and still couldn&#39;t find why it&#39;s not working.. :&#39;("}, {"owner": {"user_type": "does_not_exist", "display_name": "user2705585"}, "edited": false, "score": 0, "creation_date": 1460272160, "post_id": 36526889, "comment_id": 60658042, "body": "Did you tried <code>(\\w)\\1+</code> ?"}, {"owner": {"reputation": 693, "user_id": 3990434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JMTJk.jpg?s=128&g=1", "display_name": "Gon", "link": "https://stackoverflow.com/users/3990434/gon"}, "edited": false, "score": 0, "creation_date": 1460272296, "post_id": 36526889, "comment_id": 60658072, "body": "Yes, not working; Go&#39;s regexp is really different"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2705585"}, "edited": false, "score": 0, "creation_date": 1460272404, "post_id": 36526889, "comment_id": 60658094, "body": "<a href=\"https://golang.org/pkg/regexp/#MustCompile\" rel=\"nofollow noreferrer\">MustCompile is like Compile but panics if the expression cannot be parsed. It simplifies safe initialization of global variables holding compiled regular expressions.</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2705585"}, "edited": false, "score": 0, "creation_date": 1460272482, "post_id": 36526889, "comment_id": 60658112, "body": "Try with <code>(\\\\w)\\\\1\\+</code>. If this doesn&#39;t work then I will have to go through whole documentation."}, {"owner": {"reputation": 693, "user_id": 3990434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JMTJk.jpg?s=128&g=1", "display_name": "Gon", "link": "https://stackoverflow.com/users/3990434/gon"}, "edited": false, "score": 0, "creation_date": 1460272610, "post_id": 36526889, "comment_id": 60658142, "body": "Sorry noob; it&#39;s not working. Go&#39;s regexp is very different than Python or Java somehow.. See <a href=\"https://play.golang.org/p/4kDJMbT1jH\" rel=\"nofollow noreferrer\">play.golang.org/p/4kDJMbT1jH</a> you can try there."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2705585"}, "reply_to_user": {"reputation": 693, "user_id": 3990434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JMTJk.jpg?s=128&g=1", "display_name": "Gon", "link": "https://stackoverflow.com/users/3990434/gon"}, "edited": false, "score": 0, "creation_date": 1460272816, "post_id": 36526889, "comment_id": 60658197, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/108737/discussion-between-noob-and-gon\">continue this discussion in chat</a>."}, {"owner": {"reputation": 10272, "user_id": 1996394, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/bb7cf5d8bf03c5335a0ece8f6673541d?s=128&d=identicon&r=PG", "display_name": "rock321987", "link": "https://stackoverflow.com/users/1996394/rock321987"}, "edited": false, "score": 0, "creation_date": 1460273763, "post_id": 36526889, "comment_id": 60658412, "body": "It seems <code>regexp</code> package of <code>go</code> do not support <code>backreferences</code>"}, {"owner": {"reputation": 693, "user_id": 3990434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JMTJk.jpg?s=128&g=1", "display_name": "Gon", "link": "https://stackoverflow.com/users/3990434/gon"}, "edited": false, "score": 0, "creation_date": 1460274535, "post_id": 36526889, "comment_id": 60658602, "body": "Sadly it seems so.. Closing question. Thank you all"}], "answers": [{"tags": [], "owner": {"reputation": 693, "user_id": 3990434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JMTJk.jpg?s=128&g=1", "display_name": "Gon", "link": "https://stackoverflow.com/users/3990434/gon"}, "is_accepted": false, "score": 2, "last_activity_date": 1460274623, "creation_date": 1460274623, "answer_id": 36527251, "question_id": 36526889, "link": "https://stackoverflow.com/questions/36526889/golang-regexp-reference-within-mustcompile-find-repeating-character/36527251#36527251", "title": "Golang Regexp Reference within MustCompile (Find repeating character)", "body": "<p>Apparently Golang doesn't supposed back referencing due to efficiency. :(\nThank you everyone for your help. </p>\n"}], "owner": {"reputation": 693, "user_id": 3990434, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JMTJk.jpg?s=128&g=1", "display_name": "Gon", "link": "https://stackoverflow.com/users/3990434/gon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 501, "favorite_count": 0, "closed_date": 1460291533, "answer_count": 1, "score": -1, "last_activity_date": 1460274623, "creation_date": 1460271634, "last_edit_date": 1460273296, "question_id": 36526889, "link": "https://stackoverflow.com/questions/36526889/golang-regexp-reference-within-mustcompile-find-repeating-character", "closed_reason": "Duplicate", "title": "Golang Regexp Reference within MustCompile (Find repeating character)", "body": "<p>I am having a hard time with Go's regex. It seems it's different than other language, can someone help me on this.</p>\n\n<p>Obj. I want MustCompile to find all repeated characters in the string.\nAPPLE (where P's repeating)</p>\n\n<pre><code>re := regexp.MustCompile(\"(\\\\w)\\\\${1}\\\\+\")\n</code></pre>\n\n<p>Above is what I have tried but didn't work at all. Basically I wanted to do:</p>\n\n<pre><code>([A-Za-z])\\1+\n</code></pre>\n\n<p>Can someone tell me what I am doing wrong?</p>\n\n<p>Example below:</p>\n\n<p><a href=\"https://play.golang.org/p/DeuaIva968\" rel=\"nofollow\">https://play.golang.org/p/DeuaIva968</a></p>\n"}, {"tags": ["forms", "go", "gomail"], "answers": [{"comments": [{"owner": {"reputation": 67, "user_id": 5262581, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/627081a297aced294e4be065ac65a01f?s=128&d=identicon&r=PG&f=1", "display_name": "cmelone", "link": "https://stackoverflow.com/users/5262581/cmelone"}, "edited": false, "score": 0, "creation_date": 1460269364, "post_id": 36526448, "comment_id": 60657405, "body": "Thanks for the answer, I had to change m.Content to msg.Content in order to avoid confusion with the compiler. This is what I had to change my code to: <a href=\"http://pastebin.com/raw/TxZPmiw6\" rel=\"nofollow noreferrer\">pastebin.com/raw/TxZPmiw6</a>. Now when I compile,  I get <code>.&#47;main.go:59: undefined: msg in msg.Content</code>"}, {"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "reply_to_user": {"reputation": 67, "user_id": 5262581, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/627081a297aced294e4be065ac65a01f?s=128&d=identicon&r=PG&f=1", "display_name": "cmelone", "link": "https://stackoverflow.com/users/5262581/cmelone"}, "edited": false, "score": 0, "creation_date": 1460270196, "post_id": 36526448, "comment_id": 60657584, "body": "You are instantiating the message struct in the send function, that&#39;s why you are getting the undefined error. You have to move out the struct into the main execution thread. Because i suppose <code>Deliver</code> func is getting executed on start."}, {"owner": {"reputation": 67, "user_id": 5262581, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/627081a297aced294e4be065ac65a01f?s=128&d=identicon&r=PG&f=1", "display_name": "cmelone", "link": "https://stackoverflow.com/users/5262581/cmelone"}, "edited": false, "score": 0, "creation_date": 1460271940, "post_id": 36526448, "comment_id": 60657993, "body": "If I add the <code>Message</code> struct to the main function, (<a href=\"https://git.io/vVSXR0\" rel=\"nofollow noreferrer\">git.io/vVSXR0</a>) i get the following errors: <code>.&#47;main.go:29: undefined: msg in msg.Content .&#47;main.go:43: undefined: Message</code>"}, {"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "reply_to_user": {"reputation": 67, "user_id": 5262581, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/627081a297aced294e4be065ac65a01f?s=128&d=identicon&r=PG&f=1", "display_name": "cmelone", "link": "https://stackoverflow.com/users/5262581/cmelone"}, "edited": false, "score": 0, "creation_date": 1460272938, "post_id": 36526448, "comment_id": 60658237, "body": "i cannot access the url"}, {"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "reply_to_user": {"reputation": 67, "user_id": 5262581, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/627081a297aced294e4be065ac65a01f?s=128&d=identicon&r=PG&f=1", "display_name": "cmelone", "link": "https://stackoverflow.com/users/5262581/cmelone"}, "edited": false, "score": 0, "creation_date": 1460281610, "post_id": 36526448, "comment_id": 60660564, "body": "The issue is not where the struct type is defined, but where is referenced. You are referencing, in other words constructing the struct type in the send function, but you are trying to access it in the deliver function, and of course this is not yet accessible. So my suggestion is to either reference the message struct as a pointer, or to move the <code>Deliver()</code> content inside the send function."}, {"owner": {"reputation": 67, "user_id": 5262581, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/627081a297aced294e4be065ac65a01f?s=128&d=identicon&r=PG&f=1", "display_name": "cmelone", "link": "https://stackoverflow.com/users/5262581/cmelone"}, "edited": false, "score": 0, "creation_date": 1460281706, "post_id": 36526448, "comment_id": 60660593, "body": "I figured it all out, thanks for your help! I was wondering if you could look at something else really quick."}], "tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": true, "score": 1, "last_activity_date": 1460268383, "creation_date": 1460268383, "answer_id": 36526448, "question_id": 36526304, "link": "https://stackoverflow.com/questions/36526304/creating-a-contact-form-with-gomail/36526448#36526448", "title": "Creating a contact form with Gomail", "body": "<p>In this case what you can do, is to use the <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow\"><code>Sprintf</code></a> formatting method. In your particular case:</p>\n\n<pre><code>m.SetBody(\"text/html\", fmt.Sprintf(\"&lt;b&gt;Message&lt;/b&gt;: %s\", m.Content))\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 5262581, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/627081a297aced294e4be065ac65a01f?s=128&d=identicon&r=PG&f=1", "display_name": "cmelone", "link": "https://stackoverflow.com/users/5262581/cmelone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 572, "favorite_count": 0, "accepted_answer_id": 36526448, "answer_count": 1, "score": 0, "last_activity_date": 1460268383, "creation_date": 1460267136, "question_id": 36526304, "link": "https://stackoverflow.com/questions/36526304/creating-a-contact-form-with-gomail", "title": "Creating a contact form with Gomail", "body": "<p>I am currently learning Go, and I am trying to create a contact form. I was using the default <code>net/smtp</code> package to send my mail, but then I stumbled upon <a href=\"https://github.com/go-gomail/gomail\" rel=\"nofollow\">Gomail</a>. It made it so much easier to send an email. </p>\n\n<p><strong>Here is the html for the contact form</strong>:</p>\n\n<pre><code>&lt;h1&gt;Contact Us&lt;/h1&gt;\n&lt;form action=\"/\" method=\"post\" novalidate&gt;\n  &lt;div&gt;\n    &lt;label&gt;Email Address&lt;/label&gt;\n    &lt;input type=\"email\" name=\"email\" value=\"{{ .Email }}\"&gt;\n  &lt;/div&gt;\n  &lt;div&gt;\n    &lt;label&gt;Message:&lt;/label&gt;\n    &lt;textarea name=\"content\"&gt;{{ .Content }}&lt;/textarea&gt;\n  &lt;/div&gt;\n  &lt;div&gt;\n    &lt;input type=\"submit\" value=\"Submit\"&gt;\n  &lt;/div&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>I'm using Go's <code>html/template</code> package to get the values.</p>\n\n<p><strong>main.go</strong>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/bmizerany/pat\"\n    \"gopkg.in/gomail.v2\"\n    \"html/template\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    mux := pat.New()\n    mux.Get(\"/\", http.HandlerFunc(index))\n    mux.Post(\"/\", http.HandlerFunc(send))\n    mux.Get(\"/confirmation\", http.HandlerFunc(confirmation))\n\n    log.Println(\"Listening...\")\n    http.ListenAndServe(\":2016\", mux)\n}\n\nfunc index(w http.ResponseWriter, r *http.Request) {\n    render(w, \"templates/index.html\", nil)\n}\n\nfunc send(w http.ResponseWriter, r *http.Request) {\n  m := &amp;Message{\n    Email: r.FormValue(\"email\"),\n    Content: r.FormValue(\"content\"),\n  }\n\n  if err := m.Deliver(); err != nil {\n    http.Error(w, err.Error(), http.StatusInternalServerError)\n    return\n  }\n  http.Redirect(w, r, \"/confirmation\", http.StatusSeeOther)\n}\n\nfunc confirmation(w http.ResponseWriter, r *http.Request) {\n    render(w, \"templates/confirmation.html\", nil)\n}\n\nfunc render(w http.ResponseWriter, filename string, data interface{}) {\n    tmpl, err := template.ParseFiles(filename)\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n    }\n    if err := tmpl.Execute(w, data); err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n    }\n}\n\ntype Message struct {\n    Email   string\n    Content string\n}\n\nfunc (m *Message) Deliver() {\n    m := gomail.NewMessage()\n    m.SetHeader(\"From\", \"John Smith &lt;jsmith@gmail.com&gt;\")\n    m.SetHeader(\"To\", \"John Smith &lt;jsmith@gmail.com&gt;\")\n    m.SetAddressHeader(\"reply-to\", \"m.Email\")\n    m.SetHeader(\"Subject\", \"Contact\")\n    m.SetBody(\"text/html\", \"&lt;b&gt;Message&lt;/b&gt;: m.Content\")\n    d := gomail.NewDialer(\"smtp.gmail.com\", 587, \"jsmith@gmail.com\", \"password\")\n    if err := d.DialAndSend(m); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>Basically what this does is serve the index page (the contact form) and the confirmation page. It also defines the <code>Email</code> and <code>Contact</code> strings. If I wanted to print out the content of the message, I can just use <code>m.Content</code>, but since Gomail asks for the body and serves html, I don't really know a way to get the string from the form and add it like this: </p>\n\n<pre><code>m.SetBody(\"text/html\", \"&lt;b&gt;Message&lt;/b&gt;: &lt;!-- Content Goes Here --&gt;\")`\n</code></pre>\n"}, {"tags": ["javascript", "go", "steam"], "answers": [{"comments": [{"owner": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "edited": false, "score": 1, "creation_date": 1460358574, "post_id": 36531901, "comment_id": 60685522, "body": "3rd time you&#39;ve answered a question about golang for me lol, thanks heaps!"}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 0, "last_activity_date": 1460303299, "creation_date": 1460303299, "answer_id": 36531901, "question_id": 36526091, "link": "https://stackoverflow.com/questions/36526091/unable-to-find-steam-umqid-for-chat-message/36531901#36531901", "title": "Unable to Find Steam UMQID for Chat Message", "body": "<p>You can see he's decoding it by making a call to <a href=\"https://api.steampowered.com/ISteamWebUserPresenceOAuth/Logon/v0001/\" rel=\"nofollow\">https://api.steampowered.com/ISteamWebUserPresenceOAuth/Logon/v0001/</a>  at <a href=\"https://github.com/Zemnmez/geothermal/blob/master/chat/chat.go#L158\" rel=\"nofollow\">https://github.com/Zemnmez/geothermal/blob/master/chat/chat.go#L158</a></p>\n"}], "owner": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 0, "accepted_answer_id": 36531901, "answer_count": 1, "score": 0, "last_activity_date": 1460303299, "creation_date": 1460265349, "last_edit_date": 1460277197, "question_id": 36526091, "link": "https://stackoverflow.com/questions/36526091/unable-to-find-steam-umqid-for-chat-message", "title": "Unable to Find Steam UMQID for Chat Message", "body": "<p>Using Golang, I am trying to send a chat message through <a href=\"https://steamcommunity.com/chat\" rel=\"nofollow\">Steam</a>. The requirements for the post are</p>\n\n<ul>\n<li><p><code>jsonp: jQuery1111021217753615295387_1460262983441</code> <em>&lt;- I am able to get this one</em></p></li>\n<li><p><code>umqid: 6271781725479270872</code> <strong>&lt;- I am unable to understand what this is and how to retreive it.</strong></p></li>\n<li><p><code>type: saytext</code> <em>&lt;- I am able to get this one</em></p></li>\n<li><code>steamid_dst: 76561198208696745</code> <em>&lt;- I am able to get this one</em></li>\n<li><code>text: foobar</code> <em>&lt;- I am able to get this one</em></li>\n<li><code>access_token: 87e689c612b38f535a4d2b645b3aa3a7</code> <em>&lt;- I am able to get this one</em></li>\n<li><code>_: 1460262983442</code> <em>&lt;- I am able to get this one</em></li>\n</ul>\n\n<p>I understand all the variables required and am able to use them except for the UMQID variable. I have been through <a href=\"https://steamcommunity-a.akamaihd.net/public/javascript/chat.js?v=CO5oN56q_gcZ&amp;l=english\" rel=\"nofollow\">Steam's javascript source code</a> over and over trying to figure out what the value of it is and how they generate the value but I haven't managed to understand it.</p>\n\n<p>I've even been through <a href=\"https://github.com/Zemnmez/geothermal/blob/master/chat/chat.go\" rel=\"nofollow\">someone else's Golang source code</a> <em>(line 211)</em> which does exactly what I am aiming for but I still can't even figure out how they got the UMQID.</p>\n\n<p>If anyone could explain how I am able to get the UMQID so I can post <a href=\"https://api.steampowered.com/ISteamWebUserPresenceOAuth/Message/v0001/\" rel=\"nofollow\">https://api.steampowered.com/ISteamWebUserPresenceOAuth/Message/v0001/</a> to send a Steam message, it would be greatly appreciated.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "is_accepted": true, "score": 3, "last_activity_date": 1543564494, "last_edit_date": 1543564494, "creation_date": 1460265885, "answer_id": 36526155, "question_id": 36526027, "link": "https://stackoverflow.com/questions/36526027/is-it-possible-to-use-cpu-cache-in-golang/36526155#36526155", "title": "Is it possible to use CPU cache in Golang?", "body": "<p>Yes, and just like all other code running on your machine, they all use CPU cache.</p>\n\n<p>It's much too broad of a question to tell you how to code your app to make it the most efficient use of cache.  I highly recommend setting up Go Benchmarks and then refactor your code and compare times.  (Note, do not benchmark within a VM - VMs, and kind on any platform, do not have accurate enough clocks for Go's benchmarking.  Run all Benchmarks native to your OS instead, no VM).</p>\n\n<p>It all comes down to your ability to code the application to <em>make efficient use</em> of that CPU cache.  This is a much broader topic for how you use your variables, how often they get updated, what stays on the heap or gets GC on the stack and how often, etc.</p>\n\n<p>One tiny example to point you in the right direction to read more about efficient L1 and L2 cache development...</p>\n\n<p>L1 cache uses 64 bit rows.  If you want to store 4x 16bit Int16s, typically they will be allocated on the stack and most likely all stored on the same row of cache.</p>\n\n<p>Say you want to update one of the Int16s?  Well, CPU cache cannot update part of the row: It will have to invalidate the entire row, and allocate a whole new row of cache with the previous 3 Int16s and your new updates value.</p>\n\n<p>Very inefficient.  </p>\n\n<p>One solution to that problem is use Int64s, which the CPU cache will only invalidate 1 row but yet keep the other 3 in cache for quick reads.  Are you doing more push or pops?  etc.</p>\n\n<p>Again, it highly depends on your use case: this may even slow things down if you are using a lot of context switching of those 4 ints (e.g. mutex locks). In which case that's a whole different problem to optimize. </p>\n\n<p>I recommend reading up on high frequency scaling and memory allocations on the stack and heaps.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1521, "favorite_count": 1, "accepted_answer_id": 36526155, "answer_count": 1, "score": 1, "last_activity_date": 1543564494, "creation_date": 1460264731, "last_edit_date": 1473417266, "question_id": 36526027, "link": "https://stackoverflow.com/questions/36526027/is-it-possible-to-use-cpu-cache-in-golang", "title": "Is it possible to use CPU cache in Golang?", "body": "<p>Consider some memory and CPU intensive task:<br>\ne.g.: Task Block: read 16 bytes from memory then do CPU job. Then write back to memory.<br>\nAnd this Task Block can be parallelizable meaning each core can ran one Task Block.<br>\ne.g.: 8 CPU needs 8*16 byte cache but concurrently.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 1, "last_activity_date": 1460265033, "creation_date": 1460265033, "answer_id": 36526059, "question_id": 36525757, "link": "https://stackoverflow.com/questions/36525757/golang-logger-polymorphism/36526059#36526059", "title": "Golang Logger polymorphism?", "body": "<p>If their package takes an actual *log.Logger, there's nothing you can do to inject your own logger other than set the output of a log.Logger to a custom writer where you intercept their log statements and you then re-log them through yours.</p>\n\n<p>But that will be sub-awesome as you'd basically be parsing all their log statements just so you can re-log.   Not sure if log.Logger writes a log message as one call to Write.  if it does, it's easy as all you do is re-log for every call to Write.</p>\n\n<p>You might also want to consider finding another library or forking and changing that library as nothing should really depend on log.Logger like that.</p>\n"}], "owner": {"reputation": 1346, "user_id": 1112946, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/os4wu.jpg?s=128&g=1", "display_name": "bydsky", "link": "https://stackoverflow.com/users/1112946/bydsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 36526059, "answer_count": 1, "score": 0, "last_activity_date": 1460265033, "creation_date": 1460262176, "last_edit_date": 1460264553, "question_id": 36525757, "link": "https://stackoverflow.com/questions/36525757/golang-logger-polymorphism", "title": "Golang Logger polymorphism?", "body": "<p>We use a third party library which accepts <code>*log.Logger</code> (stdlib Logger) as a parameter in its New function, but we implement <code>Logger</code> by ourself. It has the same \"interface\" with stdlib Logger.</p>\n\n<p>Is there any hack way to pass our own implementation of Logger to the third library excepting asking the library owner to change the parameter type to interface\uff1f</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "is_accepted": false, "score": 3, "last_activity_date": 1613688476, "last_edit_date": 1613688476, "creation_date": 1460264349, "answer_id": 36525978, "question_id": 36525602, "link": "https://stackoverflow.com/questions/36525602/can-i-unmarshal-json-into-implementers-of-an-interface/36525978#36525978", "title": "Can I unmarshal JSON into implementers of an Interface?", "body": "<p>Use the <code>json.Unmarshaler</code> interface to create a custom <code>UnmarshalJSON</code> method.  Then within the method, test the type casting to see which type works, assign it, and return it.</p>\n<p>Good summary at the end of this post:</p>\n<p><a href=\"http://attilaolah.eu/2013/11/29/json-decoding-in-go/\" rel=\"nofollow noreferrer\">http://attilaolah.eu/2013/11/29/json-decoding-in-go/</a></p>\n"}, {"tags": [], "owner": {"reputation": 4124, "user_id": 2629095, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/680dfd61e8b392153c85cf93498b8100?s=128&d=identicon&r=PG", "display_name": "nevets", "link": "https://stackoverflow.com/users/2629095/nevets"}, "is_accepted": true, "score": 7, "last_activity_date": 1460280707, "last_edit_date": 1592644375, "creation_date": 1460277958, "answer_id": 36527698, "question_id": 36525602, "link": "https://stackoverflow.com/questions/36525602/can-i-unmarshal-json-into-implementers-of-an-interface/36527698#36527698", "title": "Can I unmarshal JSON into implementers of an Interface?", "body": "<p>There is no straight forward way to achieve what you want based on the current condition you gave us. @eduncan911 provided a very general method, but however, if you are able to tweak the <code>JSON</code> input a bit, you are able to achieve it using the following method.</p>\n<p>The core idea is to use <a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"noreferrer\"><code>json.RawMessage</code></a> as a buffer to delay the unmarshal until it knows the type it's gonna unmarshal to.</p>\n<p>Firstly, tweak the <code>JSON</code> input to something like below:</p>\n<pre><code>{\n    &quot;Animals&quot;: [{\n        &quot;Type&quot;: &quot;dog&quot;,\n        &quot;Property&quot;: {\n            &quot;Name&quot;: &quot;Fido&quot;\n        }\n    },{\n        &quot;Type&quot;: &quot;fish&quot;,\n        &quot;Property&quot;: {\n            &quot;NumScales&quot;: 123\n        }\n    }]\n}\n</code></pre>\n<p>From what I can see, this tweak does not make the JSON worse, but actually make it better in terms of readability.</p>\n<p>Then, create a new struct, say <code>AnimalCard</code>:</p>\n<pre><code>type AnimalCard struct {\n    Type string\n    Property json.RawMessage\n    Animal Animal\n}\n</code></pre>\n<p>And modify your <code>Zoo</code> to</p>\n<pre><code>type Zoo struct {\n    Animals []*AnimalCard\n}\n</code></pre>\n<p>Now unmarshal your json to zoo, you will get an array of <code>*AnimalCard</code>. Now you could iterate through zoo array and unmarshal it according to type:</p>\n<pre><code>for _, card := range zoo.Animals {\n    if card.Type == &quot;dog&quot; {\n        dog := Dog{}\n        _ = json.Unmarshal(card.Property, &amp;dog)\n        card.Animal = dog\n    } else if card.Type == &quot;fish&quot; {\n        fish := Fish{}\n        _ = json.Unmarshal(card.Property, &amp;fish)\n        card.Animal = fish\n    }\n}\n</code></pre>\n<p>Playground Exmaple is <a href=\"https://play.golang.org/p/7gA_extizz\" rel=\"noreferrer\">here</a>.</p>\n<h2>What if I got more and more Animals in the Zoo?</h2>\n<p>Good question :) The problem the above solution gave won't be that scalable. What if we have 20 animals, not only 2? What if 200? 2000? We need a more general way to do it.</p>\n<p>The core idea this time is to use <code>reflect</code>.</p>\n<p>First, we could maintain a map, which maps a type name to an interface implementation:</p>\n<pre><code>mapper map[string]Animal{}\n</code></pre>\n<p>Then we put in our animals <strong>pointers</strong>:</p>\n<pre><code>mapper[&quot;dog&quot;] = &amp;Dog{}\nmapper[&quot;fish&quot;] = &amp;Fish{}\n</code></pre>\n<p>Now, after we unmarshalled the JSON into <code>AnimalCard</code> and start iterating, we use reflection to initialize a new instance pointer and unmarshal into it:</p>\n<pre><code>for _, card := range zoo.Animals {\n    // get the animal type pointer\n    animal := mapper[card.Type]\n    // get the pointer's type\n    animalType := reflect.TypeOf(animal)\n    // create a new instance pointer of the same type\n    newInstancePtr := reflect.New(animalType.Elem()).Interface().(Animal)\n    // unmarshal to the pointer\n    _ = json.Unmarshal(card.Property, newInstancePtr)\n    // assign the pointer back\n    card.Animal = newInstancePtr\n}\n</code></pre>\n<p>Playground Example is <a href=\"https://play.golang.org/p/koA5yyPplX\" rel=\"noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 124, "user_id": 3701361, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4e381f6a737701ad5b9d98995ffeabb3?s=128&d=identicon&r=PG&f=1", "display_name": "The Legend of Dave", "link": "https://stackoverflow.com/users/3701361/the-legend-of-dave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 689, "favorite_count": 1, "accepted_answer_id": 36527698, "answer_count": 2, "score": 2, "last_activity_date": 1613688476, "creation_date": 1460260674, "question_id": 36525602, "link": "https://stackoverflow.com/questions/36525602/can-i-unmarshal-json-into-implementers-of-an-interface", "title": "Can I unmarshal JSON into implementers of an Interface?", "body": "<p>I have an interface that declares a method and some structs that implement that interface. Now I want to unmarshal some JSON into instances of these structs. To wit:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Animal interface {\n    makeNoise() string\n}\n\ntype Dog struct {\n    Name string\n}\n\nfunc (d Dog) makeNoise() string {\n    return \"woof\"\n}\n\ntype Fish struct {\n    NumScales int\n}\n\nfunc (f Fish) makeNoise() string {\n    return \"glub glub glub\"\n}\n\ntype Zoo struct {\n    Animals []Animal\n}\n\nfunc main() {\n    animals := `{\"Animals\": [{\"Name\": \"Fido\"}, {\"NumScales\": 123}]}`\n    animalBytes := []byte(animals)\n    var zoo Zoo\n    er := json.Unmarshal(animalBytes, &amp;zoo)\n    if er != nil {\n        panic(er)\n    } else {\n        fmt.Println(zoo)\n    }\n}\n</code></pre>\n\n<p>But when I run that, I get \"panic: json: cannot unmarshal object into Go value of type main.Animal\". Can I instead get a Zoo whose Animals are a Dog named Fido and a Fish with 123 scales?</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 3008, "user_id": 3204951, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/8aca84582c72a22e9cb5245571103d92?s=128&d=identicon&r=PG", "display_name": "Nate Mara", "link": "https://stackoverflow.com/users/3204951/nate-mara"}, "edited": false, "score": 0, "creation_date": 1460263633, "post_id": 36525559, "comment_id": 60656349, "body": "There&#39;s really no automatic way to do this with tags, I have to specify the key every time?"}, {"owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "reply_to_user": {"reputation": 3008, "user_id": 3204951, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/8aca84582c72a22e9cb5245571103d92?s=128&d=identicon&r=PG", "display_name": "Nate Mara", "link": "https://stackoverflow.com/users/3204951/nate-mara"}, "edited": false, "score": 0, "creation_date": 1460267290, "post_id": 36525559, "comment_id": 60657010, "body": "@NateMara <a href=\"https://github.com/jinzhu/gorm/blob/master/scope.go#L962\" rel=\"nofollow noreferrer\">github.com/jinzhu/gorm/blob/master/scope.go#L962</a> I see only one way to automate it - name your fields after submodel."}], "tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": false, "score": 0, "last_activity_date": 1460260212, "creation_date": 1460260212, "answer_id": 36525559, "question_id": 36524406, "link": "https://stackoverflow.com/questions/36524406/unable-to-create-foreign-key-relationship-with-gorm-where-field-name-type-nam/36525559#36525559", "title": "Unable to create foreign-key relationship with gorm where field name != type name", "body": "<p>Simplest way in your case is specify foreign field name. So your</p>\n\n<pre><code>db.Model(cars[i]).Related(&amp;cars[i].Owner)\n</code></pre>\n\n<p>should be like</p>\n\n<pre><code>db.Model(cars[i]).Related(&amp;cars[i].Owner, \"Owner\")\n</code></pre>\n\n<p>Alternative ways are</p>\n\n<ul>\n<li>Rename <code>Owner</code> and <code>OwnerID</code> fields to <code>User</code> and <code>UserID</code> or</li>\n<li>Rename <code>User</code> structure to <code>Owner</code></li>\n</ul>\n\n<p>In these cases GORM will select right foreign keys automatically. From <a href=\"http://jinzhu.me/gorm/associations.html#has-one\" rel=\"nofollow\">GORM documentation about associations</a>:</p>\n\n<blockquote>\n  <p>If the field name is same as the variable's type name it could be omitted.</p>\n</blockquote>\n"}], "owner": {"reputation": 3008, "user_id": 3204951, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/8aca84582c72a22e9cb5245571103d92?s=128&d=identicon&r=PG", "display_name": "Nate Mara", "link": "https://stackoverflow.com/users/3204951/nate-mara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2280, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1460260212, "creation_date": 1460248497, "question_id": 36524406, "link": "https://stackoverflow.com/questions/36524406/unable-to-create-foreign-key-relationship-with-gorm-where-field-name-type-nam", "title": "Unable to create foreign-key relationship with gorm where field name != type name", "body": "<p>I'm trying to create a \"belongs-to\" relationship in my application where the name of the field (and db column) is not the same as the type name. Gorm is complaining about this. Here is a short example that demonstrates the problem:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/mattn/go-sqlite3\"\n)\n\ntype Car struct {\n    gorm.Model\n    Owner   User\n    OwnerID int\n}\n\ntype User struct {\n    gorm.Model\n}\n\nfunc main() {\n    db, _ := gorm.Open(\"sqlite3\", \"test.db\")\n    defer db.Close()\n    db.LogMode(true)\n\n    db.CreateTable(&amp;Car{}, &amp;User{})\n\n    u := User{}\n    u.ID = 1\n    db.Create(&amp;u)\n\n    c := Car{}\n    c.ID = 1\n    c.Owner = u\n    db.Create(&amp;c)\n\n    cars := make([]Car, 5)\n    db.Find(&amp;cars)\n    for i := range cars {\n        db.Model(cars[i]).Related(&amp;cars[i].Owner)\n    }\n\n    for i := range cars {\n        fmt.Println(cars[i].Owner.ID)\n    }\n}\n</code></pre>\n\n<p>We would expect this program to print out \"1\" as its last line, as this is the primary key of the Users relation that \"owns\" the only car in the database. Instead \"0\" is printed out, and verbose logging shows an error at the <code>Related(&amp;cars[i].Owner)</code> step:</p>\n\n<pre><code>(/home/nate/gocode/src/foo/main.go:26)\n[2016-04-09 19:33:46]  [122.35ms]  CREATE TABLE \"cars\" (\"id\" integer primary key autoincrement,\"created_at\" datetime,\"updated_at\" datetime,\"deleted_at\" datetime,\"owner_id\" integer )\n\n(/home/nate/gocode/src/foo/main.go:26)\n[2016-04-09 19:33:46]  [98.96ms]  CREATE INDEX idx_cars_deleted_at ON \"cars\"(deleted_at)\n\n(/home/nate/gocode/src/foo/main.go:26)\n[2016-04-09 19:33:46]  [108.95ms]  CREATE TABLE \"users\" (\"id\" integer primary key autoincrement,\"created_at\" datetime,\"updated_at\" datetime,\"deleted_at\" datetime )\n\n(/home/nate/gocode/src/foo/main.go:26)\n[2016-04-09 19:33:46]  [125.74ms]  CREATE INDEX idx_users_deleted_at ON \"users\"(deleted_at)\n\n(/home/nate/gocode/src/foo/main.go:30)\n[2016-04-09 19:33:46]  [0.53ms]  INSERT INTO \"users\" (\"id\",\"created_at\",\"updated_at\",\"deleted_at\") VALUES ('1','2016-04-09T19:33:46-04:00','2016-04-09T19:33:46-04:00','&lt;nil&gt;')\n\n(/home/nate/gocode/src/foo/main.go:35)\n[2016-04-09 19:33:46]  [1.98ms]  UPDATE \"users\" SET \"created_at\" = '2016-04-09T19:33:46-04:00', \"updated_at\" = '2016-04-09T19:33:46-04:00', \"deleted_at\" = '&lt;nil&gt;'  WHERE \"users\".deleted_at IS NULL AND \"users\".\"id\" = '1'\n\n(/home/nate/gocode/src/foo/main.go:35)\n[2016-04-09 19:33:46]  [0.43ms]  INSERT INTO \"cars\" (\"id\",\"created_at\",\"updated_at\",\"deleted_at\",\"owner_id\") VALUES ('1','2016-04-09T19:33:46-04:00','2016-04-09T19:33:46-04:00','&lt;nil&gt;','1')\n\n(/home/nate/gocode/src/foo/main.go:38)\n[2016-04-09 19:33:46]  [0.64ms]  SELECT * FROM \"cars\"  WHERE \"cars\".deleted_at IS NULL\n\n(/home/nate/gocode/src/foo/main.go:40)\n[2016-04-09 19:33:46]  invalid association []\n0\n</code></pre>\n\n<p>What is going on here? Is there some special tag that I have to use on the <code>Owner</code> field? I've tried using <code>gorm:\"ForeignKey:owner_id\"</code> and <code>gorm:\"AssociationForeignKey:owner_id\"</code>, both giving the same result.</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 4857837, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/19c080c1f0dc5d8d46db9e7e4155dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Lakhan Mankani", "link": "https://stackoverflow.com/users/4857837/lakhan-mankani"}, "edited": false, "score": 0, "creation_date": 1460244447, "post_id": 36523810, "comment_id": 60652624, "body": "Thank you very much. This is right what I was looking for!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1460243388, "creation_date": 1460243388, "answer_id": 36523810, "question_id": 36523400, "link": "https://stackoverflow.com/questions/36523400/print-value-from-json-file-in-go/36523810#36523810", "title": "Print value from JSON file in Go", "body": "<p><a href=\"https://godoc.org/encoding/json#Decoder.Decode\" rel=\"nofollow\">Decode</a> the response to a type that matches the shape of the response.  For example:</p>\n\n<pre><code>var data struct {\n    Base  string\n    Date  string\n    Rates map[string]float64\n}\nif err := json.NewDecoder(resp.Body).Decode(&amp;data); err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>Print the the appropriate value:</p>\n\n<pre><code>if r, ok := data.Rates[\"USD\"]; ok {\n    log.Println(\"Rate\", r)\n} else {\n    log.Println(\"no rate\")\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/ek5hCJG2V7\" rel=\"nofollow\">complete example</a></p>\n"}], "owner": {"reputation": 69, "user_id": 4857837, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/19c080c1f0dc5d8d46db9e7e4155dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Lakhan Mankani", "link": "https://stackoverflow.com/users/4857837/lakhan-mankani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 1, "accepted_answer_id": 36523810, "answer_count": 1, "score": 1, "last_activity_date": 1460243388, "creation_date": 1460240379, "question_id": 36523400, "link": "https://stackoverflow.com/questions/36523400/print-value-from-json-file-in-go", "title": "Print value from JSON file in Go", "body": "<p>I am making a currency converter in Go which downloads a JSON file and it then reads it to print the current currency rate. I am unable to understand how to print the value, I know I have to use Unmarshal but I don't understand how to use it.</p>\n\n<p>For example I want to print the value <code>1.4075</code> from the JSON file.</p>\n\n<p>Here is the JSON file (This is pulled from <a href=\"http://api.fixer.io/latest?base=GBP&amp;symbols=USD\" rel=\"nofollow\">here</a>):</p>\n\n<pre><code>{\"base\":\"GBP\",\"date\":\"2016-04-08\",\"rates\":{\"USD\":1.4075}}\n</code></pre>\n\n<p>Here is what I have done so far.</p>\n\n<pre><code>package main\n\nimport(\n  \"encoding/json\"\n  \"fmt\"\n  \"io/ioutil\"\n)\n\nfunc main(){\n  fromCurrency:=\"GBP\"\n  toCurrency:=\"USD\"\n\n  out, err := os.Create(\"latest.json\")\n  if err != nil{\n      fmt.Println(\"Error:\", err)\n  }\n  defer out.Close()\n  resp, err := http.Get(\"http://api.fixer.io/latest?base=\" +    fromCurrency + \"&amp;symbols=\" + toCurrency)\n  defer resp.Body.Close()\n  _, err = io.Copy(out, resp.Body)\n  if err!= nil{\n      fmt.Println(\"Error:\", err)\n  }\n}\n</code></pre>\n"}, {"tags": ["design-patterns", "go"], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 4413903, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8a77e148c2627b8105ebe6db59e7f825?s=128&d=identicon&r=PG", "display_name": "manorie", "link": "https://stackoverflow.com/users/4413903/manorie"}, "edited": false, "score": 0, "creation_date": 1460275473, "post_id": 36525977, "comment_id": 60658848, "body": "Than how you structure database migrations? Manually with an sql script?"}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "reply_to_user": {"reputation": 19, "user_id": 4413903, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8a77e148c2627b8105ebe6db59e7f825?s=128&d=identicon&r=PG", "display_name": "manorie", "link": "https://stackoverflow.com/users/4413903/manorie"}, "edited": false, "score": 0, "creation_date": 1460303061, "post_id": 36525977, "comment_id": 60667471, "body": "updated article to explain how I do migrations.  May not be sufficient for you"}, {"owner": {"reputation": 19, "user_id": 4413903, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8a77e148c2627b8105ebe6db59e7f825?s=128&d=identicon&r=PG", "display_name": "manorie", "link": "https://stackoverflow.com/users/4413903/manorie"}, "edited": false, "score": 0, "creation_date": 1460373977, "post_id": 36525977, "comment_id": 60695370, "body": "Thank you @David Budworth !"}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 2, "last_activity_date": 1460303038, "last_edit_date": 1460303038, "creation_date": 1460264329, "answer_id": 36525977, "question_id": 36522643, "link": "https://stackoverflow.com/questions/36522643/go-lang-folder-structure-for-a-web-app/36525977#36525977", "title": "Go Lang folder structure for a web app", "body": "<p>I tend to structure my apps as:\n<code>\n$GOPATH/github.com/yourname/projectname/\n  cmd/\n    app1/\n      main.go\n    app2/\n      main.go\n  db/\n    001_initial_schema.sql\n    002_add_timestamps.sql\n    ... etc ...\n  lib/\n    lib1/\n    lib2/\n  html/\n    ..all the html stuff..\n</code>\nwhere app1 / app2 are the command line apps.  Often it is only be one app (your web server).</p>\n\n<p>lib/* is just whatever segregated pieces of functionality you have.</p>\n\n<p>Usually, i start with just cmd/app1 and then expand in to lib when the project gets sufficiently complex.</p>\n\n<p>And make your static file server (assuming you have one), use \"html\" as the directory.</p>\n\n<p>For database migrations, I use a really simple migrator I wrote as I find the others to be too complicated / too large.</p>\n\n<p><a href=\"https://gist.github.com/dbudworth/babe3eae9676724d5aa2807212893bb0\" rel=\"nofollow\">Here's the code</a> I'm using in my projects.<br>\nI thought of making it a real library, but I'm pretty sure this is postgresql specific as it assumes that DDL is transactional.  </p>\n\n<p>With this structure, you can simply do (from the project root):</p>\n\n<p><code>go install ./... &amp;&amp; app1</code></p>\n\n<p>To build / test your app.</p>\n\n<p>This structure will also naturally work if you then want to deploy to Heroku as heroku sets your working dir to your project root.</p>\n"}, {"tags": [], "owner": {"reputation": 22421, "user_id": 306478, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/f790d6d3f1a75a30f6e525890f1d1964?s=128&d=identicon&r=PG", "display_name": "Bijan", "link": "https://stackoverflow.com/users/306478/bijan"}, "is_accepted": false, "score": 0, "last_activity_date": 1618695134, "last_edit_date": 1618695134, "creation_date": 1618693689, "answer_id": 67142963, "question_id": 36522643, "link": "https://stackoverflow.com/questions/36522643/go-lang-folder-structure-for-a-web-app/67142963#67142963", "title": "Go Lang folder structure for a web app", "body": "<h1>Standard Go Project Layout</h1>\n<p>There is a Repo on GitHub that has lot's of stars (22k as of writing)\nThis approach is actually quite complete but might be overkill for smaller projects.</p>\n<p><a href=\"https://github.com/golang-standards/project-layout\" rel=\"nofollow noreferrer\">https://github.com/golang-standards/project-layout</a></p>\n<h2>Go Directories (Base)</h2>\n<div class=\"s-table-container\">\n<table class=\"s-table\">\n<thead>\n<tr>\n<th>Folder</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>/cmd</td>\n<td>Main applications for this project.</td>\n</tr>\n<tr>\n<td>/internal</td>\n<td>Private application and library code.</td>\n</tr>\n<tr>\n<td>/pkg</td>\n<td>Library code that's ok to use by external applications.</td>\n</tr>\n<tr>\n<td>/vendor</td>\n<td>Application dependencies (managed manually or by your favorite dependency management tool like the new built-in Go Modules feature).</td>\n</tr>\n</tbody>\n</table>\n</div><h2>Service Application Directories</h2>\n<div class=\"s-table-container\">\n<table class=\"s-table\">\n<thead>\n<tr>\n<th>Folder</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>/api</td>\n<td>OpenAPI/Swagger specs, JSON schema files, protocol definition files.</td>\n</tr>\n</tbody>\n</table>\n</div><h2>Web Application Directories</h2>\n<div class=\"s-table-container\">\n<table class=\"s-table\">\n<thead>\n<tr>\n<th>Folder</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>/web</td>\n<td>Web application specific components: static web assets, server side templates and SPAs.</td>\n</tr>\n</tbody>\n</table>\n</div><h2>Common Application Directories</h2>\n<div class=\"s-table-container\">\n<table class=\"s-table\">\n<thead>\n<tr>\n<th>Folder</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>/configs</td>\n<td>Configuration file templates or default configs.</td>\n</tr>\n<tr>\n<td>/init</td>\n<td>System init (systemd, upstart, sysv) and process manager/supervisor (runit, supervisord) configs.</td>\n</tr>\n<tr>\n<td>/scripts</td>\n<td>Scripts to perform various build, install, analysis, etc operations.</td>\n</tr>\n<tr>\n<td>/build</td>\n<td>Packaging and Continuous Integration.</td>\n</tr>\n<tr>\n<td>/deployments</td>\n<td>IaaS, PaaS, system and container orchestration deployment configurations and templates.</td>\n</tr>\n<tr>\n<td>/test</td>\n<td>Additional external test apps and test data.</td>\n</tr>\n</tbody>\n</table>\n</div><h2>Other Directories</h2>\n<div class=\"s-table-container\">\n<table class=\"s-table\">\n<thead>\n<tr>\n<th>Folder</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>/docs</td>\n<td>Design and user documents (in addition to your godoc generated documentation).</td>\n</tr>\n<tr>\n<td>/tools</td>\n<td>Supporting tools for this project.</td>\n</tr>\n<tr>\n<td>/examples</td>\n<td>Examples for your applications and/or public libraries.</td>\n</tr>\n<tr>\n<td>/third_party</td>\n<td>External helper tools, forked code and other 3rd party utilities (e.g., Swagger UI).</td>\n</tr>\n<tr>\n<td>/githooks</td>\n<td>Git hooks.</td>\n</tr>\n<tr>\n<td>/assets</td>\n<td>Other assets to go along with your repository (images, logos, etc).</td>\n</tr>\n<tr>\n<td>/website</td>\n<td>This is the place to put your project's website data if you are not using GitHub pages.</td>\n</tr>\n</tbody>\n</table>\n</div>"}], "owner": {"reputation": 19, "user_id": 4413903, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8a77e148c2627b8105ebe6db59e7f825?s=128&d=identicon&r=PG", "display_name": "manorie", "link": "https://stackoverflow.com/users/4413903/manorie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2329, "favorite_count": 1, "accepted_answer_id": 36525977, "answer_count": 2, "score": 0, "last_activity_date": 1618695134, "creation_date": 1460235560, "question_id": 36522643, "link": "https://stackoverflow.com/questions/36522643/go-lang-folder-structure-for-a-web-app", "title": "Go Lang folder structure for a web app", "body": "<p>As you know Go is a modern approach to OOP imo, with brilliant things like forcing you to use composition over inheritance. I am just trying to understand how a well written go code has to be designed in terms of folder and package structure.</p>\n\n<p>I am just wondering if this React like approach which can be seen below - dividing app as components to different packages can work?</p>\n\n<p>Or can you give me an example, link, idea for a good structure in terms of folder/packaging of a web api. Go will only be an api in the background to my open source project, on client side I am planing to have a single-page React app btw.</p>\n\n<p>Thanks a lot,</p>\n\n<p><a href=\"https://i.stack.imgur.com/aRhUD.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/aRhUD.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["html", "templates", "go", "go-html-template"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1460275159, "post_id": 36521839, "comment_id": 60658761, "body": "Also related / useful: <a href=\"http://stackoverflow.com/questions/28674199/in-a-go-template-range-loop-are-variables-declared-outside-the-loop-reset-on-ea\">In a Go template range loop, are variables declared outside the loop reset on each iteration?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1590080463, "last_edit_date": 1590080463, "creation_date": 1460273715, "answer_id": 36527130, "question_id": 36521839, "link": "https://stackoverflow.com/questions/36521839/how-to-create-a-global-variable-and-change-in-multiple-places-in-golang-html-tem/36527130#36527130", "title": "How to create a global variable and change in multiple places in golang html/template?", "body": "<p>Go 1.11 added support for <a href=\"https://golang.org/doc/go1.11#text/template\" rel=\"nofollow noreferrer\">changing values of template variables</a>. To define a variable, use <code>:=</code>:</p>\n\n<pre><code>{{$currentUserId := 0}}\n</code></pre>\n\n<p>To change its value, use assignment <code>=</code>:</p>\n\n<pre><code>{{$currentUserId = .UserData.UserId}}\n</code></pre>\n\n<p>If the variable is created outside of the <code>{{if}}</code> block but changed inside it, changes will be visible after the <code>{{if}}</code> block.</p>\n\n<pre><code>{{$currentUserId := 0 -}}\nBefore: {{$currentUserId}}\n{{if .UserData -}}\n    {{$currentUserId = .UserData.UserId}}\n    [&lt;a href=\"#ask_question\"&gt;Inside {{$currentUserId}}&lt;/a&gt;]\n{{else}}\n    {{$currentUserId = 0}}\n{{end}}\n[&lt;a href=\"#ask_question\"&gt;outside {{$currentUserId}}&lt;/a&gt;]\n</code></pre>\n\n<p>Testing this like:</p>\n\n<pre><code>m := map[string]interface{}{}\nt := template.Must(template.New(\"\").Parse(src))\n\nm[\"UserData\"] = UserData{99}\nif err := t.Execute(os.Stdout, m); err != nil {\n    panic(err)\n</code></pre>\n\n<p>The output is (try it on the <a href=\"https://play.golang.org/p/HfsIbKEOygy\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Before: 0\n\n    [&lt;a href=\"#ask_question\"&gt;Inside 99&lt;/a&gt;]\n\n[&lt;a href=\"#ask_question\"&gt;outside 99&lt;/a&gt;]\n</code></pre>\n\n<p>Original answer follows.</p>\n\n<hr>\n\n<p>Short answer is: you can't.</p>\n\n<p>By design philosophy, templates should not contain complex logic. In templates you can only create new variables, you cannot change the values of existing template variables. When you do <code>{{$currentUserId := .UserData.UserId}}</code> inside an <code>{{if}}</code> block, that creates a new variable which shadows the outer one, and its scope extends to the <code>{{end}}</code> action.</p>\n\n<p>This is described in the <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\"><code>text/template</code></a> package, <a href=\"https://golang.org/pkg/text/template/#hdr-Variables\" rel=\"nofollow noreferrer\">Variables section</a> (the same applies to the <a href=\"https://golang.org/pkg/html/template/\" rel=\"nofollow noreferrer\"><code>html/template</code></a> package too):</p>\n\n<blockquote>\n  <p>A variable's scope extends to the \"end\" action of the control structure (\"if\", \"with\", or \"range\") in which it is declared, or to the end of the template if there is no such control structure. A template invocation does not inherit variables from the point of its invocation.</p>\n</blockquote>\n\n<h2>Possible workarounds</h2>\n\n<p>Easiest in your case would be to register a custom function <code>CurrentUserId()</code> to your template, which if <code>UserData</code> is present, returns its id <code>UserData.UserId()</code>, and if it is not present, returns <code>0</code> as in your case.</p>\n\n<p>This is an example how it can be done:</p>\n\n<pre><code>type UserData struct {\n    UserId int\n}\n\nfunc main() {\n    m := map[string]interface{}{}\n    t := template.Must(template.New(\"\").Funcs(template.FuncMap{\n        \"CurrentUserId\": func() int {\n            if u, ok := m[\"UserData\"]; ok {\n                return u.(UserData).UserId\n            }\n            return 0\n        },\n    }).Parse(src))\n\n    if err := t.Execute(os.Stdout, m); err != nil {\n        panic(err)\n    }\n    m[\"UserData\"] = UserData{99}\n    if err := t.Execute(os.Stdout, m); err != nil {\n        panic(err)\n    }\n}\n\nconst src = `Current user id: {{CurrentUserId}}\n`\n</code></pre>\n\n<p>It first executes the template without <code>UserData</code>, then it executes the template with <code>UserData</code> having <code>UserId = 99</code>. The output is:</p>\n\n<pre><code>Current user id: 0\nCurrent user id: 99\n</code></pre>\n\n<p>Try it on the <a href=\"http://play.golang.org/p/6fSla6u8qr\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<h2>Simulating changeable variables</h2>\n\n<p>You can also simulate changeable variables, but also with registered custom function(s). You could register a function like <code>SetCurrentUserId()</code> which would change the value of a variable, preferably in the params that is passed to the template execution so it remains safe for concurrent use.</p>\n\n<p>This is an example how to do it (it uses a <code>map</code> as template data, and <code>SetCurrentUserId()</code> sets the current user id as a value in this map):</p>\n\n<pre><code>func main() {\n    m := map[string]interface{}{}\n    t := template.Must(template.New(\"\").Funcs(template.FuncMap{\n        \"SetCurrentUserId\": func(id int) string {\n            m[\"CurrentUserId\"] = id\n            return \"\"\n        },\n    }).Parse(src))\n\n    if err := t.Execute(os.Stdout, m); err != nil {\n        panic(err)\n    }\n    m[\"UserData\"] = UserData{99}\n    if err := t.Execute(os.Stdout, m); err != nil {\n        panic(err)\n    }\n}\n\nconst src = `Before: {{.CurrentUserId}}\n{{if .UserData}}\n    {{SetCurrentUserId .UserData.UserId}}Inside: {{.CurrentUserId}}\n{{else}}\n    {{SetCurrentUserId 0}}Inside: {{.CurrentUserId}}\n{{end}}\nAfter: {{.CurrentUserId}}\n`\n</code></pre>\n\n<p>This again first executes the template without <code>UserData</code>, then it executes the template with <code>UserData</code> having <code>UserId = 99</code>. The output is:</p>\n\n<pre><code>Before: \n    Inside: 0\nAfter: 0\nBefore: 0\n    Inside: 99\nAfter: 99\n</code></pre>\n\n<p>Try it on the <a href=\"http://play.golang.org/p/buAevWz4SG\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6272, "favorite_count": 3, "accepted_answer_id": 36527130, "answer_count": 1, "score": 3, "last_activity_date": 1590080463, "creation_date": 1460231183, "last_edit_date": 1460275361, "question_id": 36521839, "link": "https://stackoverflow.com/questions/36521839/how-to-create-a-global-variable-and-change-in-multiple-places-in-golang-html-tem", "title": "How to create a global variable and change in multiple places in golang html/template?", "body": "<p>I am creating a variable in <code>html/template</code> and and changing the value based on a condition. But the scope of the value stays only inside the <code>if</code> condition:</p>\n\n<pre><code>{{if .UserData}}\n    {{$currentUserId := .UserData.UserId}}\n    [&lt;a href=\"#ask_question\"&gt;Inside {{$currentUserId}}&lt;/a&gt;]\n{{else}}\n    {{$currentUserId := 0}}\n{{end}}\n[&lt;a href=\"#ask_question\"&gt;outside {{$currentUserId}}&lt;/a&gt;]\n</code></pre>\n\n<p>Inside the if condition I am getting the correct value but outside it is <code>0</code>. How can I use the <code>$currentUserId</code>outside the condition? Could someone help me with this?</p>\n"}, {"tags": ["angularjs", "go", "typescript", "angular", "servemux"], "answers": [{"tags": [], "owner": {"reputation": 582, "user_id": 3810847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9fb0232361ca73d269d5845b062c2ac6?s=128&d=identicon&r=PG&f=1", "display_name": "Abhinav", "link": "https://stackoverflow.com/users/3810847/abhinav"}, "is_accepted": false, "score": 0, "last_activity_date": 1460228997, "creation_date": 1460228997, "answer_id": 36521433, "question_id": 36521237, "link": "https://stackoverflow.com/questions/36521237/how-to-serve-a-file-if-url-doesnt-match-to-any-pattern-in-go/36521433#36521433", "title": "How to serve a file if URL doesn&#39;t match to any pattern in Go?", "body": "<p>I think you will need to change the URL provider settings in your angular2 app to use <a href=\"https://angular.io/docs/js/latest/api/router/HashLocationStrategy-class.html\" rel=\"nofollow\">HashLocationStrategy</a>. Using this, your routes will be of the form </p>\n\n<blockquote>\n  <p>#/posts </p>\n</blockquote>\n\n<p>and will not trigger any route in your golang app.</p>\n"}, {"tags": [], "owner": {"reputation": 690, "user_id": 764638, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/85a6d21c92dced9a43bcf8e7c260cf4c?s=128&d=identicon&r=PG", "display_name": "Randex", "link": "https://stackoverflow.com/users/764638/randex"}, "is_accepted": true, "score": 1, "last_activity_date": 1460233467, "creation_date": 1460233467, "answer_id": 36522260, "question_id": 36521237, "link": "https://stackoverflow.com/questions/36521237/how-to-serve-a-file-if-url-doesnt-match-to-any-pattern-in-go/36522260#36522260", "title": "How to serve a file if URL doesn&#39;t match to any pattern in Go?", "body": "<p>Well, that was pretty easy actually. \nThe <code>net/http</code> documentation <a href=\"https://golang.org/pkg/net/http/#ServeMux\" rel=\"nofollow\">says</a> this:</p>\n\n<blockquote>\n  <p>Note that since a pattern ending in a slash names a rooted subtree,\n  the pattern \"/\" matches all paths not matched by other registered\n  patterns, not just the URL with Path == \"/\".</p>\n</blockquote>\n\n<p>So I needed to do something with my <code>\"/\"</code> handler. <code>http.FileServer</code> looks for files in a directory that is specified in the pattern string, so I just replaced it with this:</p>\n\n<pre><code>mux.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    http.ServeFile(w, r, mysiteRoot + \"index.html\")\n})\n</code></pre>\n\n<p>And it works just fine.</p>\n"}], "owner": {"reputation": 690, "user_id": 764638, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/85a6d21c92dced9a43bcf8e7c260cf4c?s=128&d=identicon&r=PG", "display_name": "Randex", "link": "https://stackoverflow.com/users/764638/randex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "accepted_answer_id": 36522260, "answer_count": 2, "score": 1, "last_activity_date": 1460233467, "creation_date": 1460227995, "question_id": 36521237, "link": "https://stackoverflow.com/questions/36521237/how-to-serve-a-file-if-url-doesnt-match-to-any-pattern-in-go", "title": "How to serve a file if URL doesn&#39;t match to any pattern in Go?", "body": "<p>I'm building a Single Page Application using Angular 2 and Go, and in Angular I use routing. If I open the site at, say, <code>http://example.com/</code>, Go will serve me my <code>index.html</code> file, which is good because I wrote this:</p>\n\n<pre><code>mux.Handle(\"/\", http.FileServer(http.Dir(mysiteRoot)))\n</code></pre>\n\n<p>Now I have a route in Angular, let's say, <code>/posts</code>, and If it's a default route (that is, when <code>useAsDefault</code> is <code>true</code>) or if I just manually go to <code>http://example.com/posts</code>, I'll get a 404 error from Go, which means that no handler is specified for this path.</p>\n\n<p>I don't think that creating a handler in Go for every single Angular route is a good idea, because there may be a lot of routes. So my question is, how can I serve <code>index.html</code> in Go if the request URL doesn't match any other pattern that I set in my <code>ServeMux</code>?</p>\n"}, {"tags": ["ruby", "sockets", "asynchronous", "go"], "answers": [{"comments": [{"owner": {"reputation": 5041, "user_id": 4288305, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-SabTTMIHSb8/AAAAAAAAAAI/AAAAAAAAAjQ/EmdFmLWi2MY/photo.jpg?sz=128", "display_name": "Integralist", "link": "https://stackoverflow.com/users/4288305/integralist"}, "edited": false, "score": 0, "creation_date": 1460270934, "post_id": 36520350, "comment_id": 60657761, "body": "Thanks @caleb. I&#39;m going to look at gRPC (as you suggested) which looks to let me take advantage of HTTP/2 and let&#39;s me easily define services and generate client/server code for multiple languages including Ruby and Go."}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 0, "last_activity_date": 1460223384, "creation_date": 1460223384, "answer_id": 36520350, "question_id": 36520190, "link": "https://stackoverflow.com/questions/36520190/is-this-example-tcp-socket-programming-sequence-of-events-safe/36520350#36520350", "title": "Is this example tcp socket programming sequence of events safe?", "body": "<p>Yes this is safe if you create a new connection every time. </p>\n\n<p>That said there are latent issues with your approach:</p>\n\n<ol>\n<li>TCP connections are rather expensive to establish, so you probably want to re-use connections with a connection pool</li>\n<li>If you make too many simultaneous requests you will exhaust ports/open file descriptors which will cause your program to crash</li>\n<li>You don't have any timeouts in place, so it's possible to end up with orphaned TCP connections which never complete (either because of something bad on the Go side, or network problems)</li>\n</ol>\n\n<p>I think you'd be better off using HTTP (despite the overhead) since libraries are already written to cope with these problems. HTTP is also much more debuggable since you can just curl an endpoint to test it.</p>\n\n<p>Personally I'd probably go with <a href=\"http://www.grpc.io/\" rel=\"nofollow\">gRPC</a>.</p>\n"}], "owner": {"reputation": 5041, "user_id": 4288305, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-SabTTMIHSb8/AAAAAAAAAAI/AAAAAAAAAjQ/EmdFmLWi2MY/photo.jpg?sz=128", "display_name": "Integralist", "link": "https://stackoverflow.com/users/4288305/integralist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "accepted_answer_id": 36520350, "answer_count": 1, "score": 0, "last_activity_date": 1460223384, "creation_date": 1460222351, "question_id": 36520190, "link": "https://stackoverflow.com/questions/36520190/is-this-example-tcp-socket-programming-sequence-of-events-safe", "title": "Is this example tcp socket programming sequence of events safe?", "body": "<p>I plan on having two services. </p>\n\n<ol>\n<li>HTTP REST service written in Ruby</li>\n<li>JSON RPC service written in Go</li>\n</ol>\n\n<p>The Ruby service will open a TCP socket connection to a Go JSON RPC service. It'll do this for each incoming HTTP request it receives. It will send some data over the socket to the Go service and that service will subsequently send back the corresponding data back down the socket.</p>\n\n<h2>Go code</h2>\n\n<p>The Go service go would look something like this (simplified):</p>\n\n<pre><code>srv := new(service.App) // this would expose a Process method\n\nrpc.Register(srv)\n\nlistener, err := net.Listen(\"tcp\", \":8080\")\nif err != nil {\n    // handle error\n}\n\nfor {\n    conn, err := listener.Accept()\n    if err != nil {\n        // handle error\n    }\n\n    go jsonrpc.ServeConn(conn)\n}\n</code></pre>\n\n<p>Notice we serve the incoming connection using a goroutine, so we can handle requests concurrently.</p>\n\n<h2>Ruby code</h2>\n\n<p>Below is a simple snippet of Ruby code that demonstrates (in theory) the way I would send data to the Go service:</p>\n\n<pre><code>require \"socket\"\nrequire \"json\"\n\nsocket = TCPSocket.new \"localhost\", \"8080\"\n\nb = {\n  :method =&gt; \"App.Process\",\n  :params =&gt; [{ :Config =&gt; JSON.generate({ :foo =&gt; :bar }) }],\n  :id     =&gt; \"0\"\n}\n\nsocket.write(JSON.dump(b))\n\nresponse = JSON.load socket.readline\n</code></pre>\n\n<p>My concern is: <strong>will this be a safe sequence of events?</strong></p>\n\n<p>I'm not asking if this will be 'thread safe', because i'm not worried about manipulating shared memory across the go routines. I'm more concerned around whether my Ruby HTTP service will get back the data it's expecting?</p>\n\n<p>If I have two parallel requests coming into my HTTP Service (or maybe the Ruby app is hosted behind a load balancer and so different <em>instances</em> of the HTTP service is handling multiple requests), then I could have instance A send the message Foo to the Go service; while instance B sends the message Bar.</p>\n\n<p>The business logic inside the Go service will return different responses depending on its input so I want to be sure that Ruby instance A gets back the correct response for Foo, and B gets back the correct response for Bar.</p>\n\n<p>I assume a socket connection is more like a queue in that if instance A makes a request to the Go service first and <em>then</em> B does, but B is quicker responding for whatever reason, then the Go service will write the response for B to the socket and instance A of the Ruby app will end up reading in the wrong socket data (this is obviously just one possible <em>scenario</em> considering that I could get <em>lucky</em> and have instance B read the socket data before instance A does).</p>\n\n<h2>Solutions?</h2>\n\n<p>I'm not sure if there is <em>simple</em> solution to this problem. Unless I don't use a TCP socket or RPC and instead rely on standard HTTP in the Go service. But I wanted the performance and less overhead of TCP.</p>\n\n<p>I'm worried the design could get more complicated by maybe having to implement an external queue as a way of synchronising the responses with the Ruby service.</p>\n\n<p>It maybe because the nature of my Ruby service is fundamentally synchronous (HTTP response/request) that I have no option but to switch to HTTP for the Go service.</p>\n\n<p>But wanted to double check with the community first just in case I'm missing something obvious.</p>\n"}, {"tags": ["logging", "go"], "answers": [{"tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": true, "score": 1, "last_activity_date": 1460224364, "last_edit_date": 1460224364, "creation_date": 1460222892, "answer_id": 36520282, "question_id": 36519524, "link": "https://stackoverflow.com/questions/36519524/how-to-add-custom-non-const-string-information-to-log-format/36520282#36520282", "title": "How to add custom (non const) string information to log format?", "body": "<ul>\n<li><p>The simplest answer of course is to just type it in when you write the line of logging.  Lots of libraries actually use a convention like </p>\n\n<p><code>logger.Logf(\"myfilename.go:123\" + \"other logging info\")</code></p>\n\n<p>where 123 is the line number. This is pretty scriptable by an ide or editor as well.  </p></li>\n<li><p>If you change <code>_enter()</code> to return the name of the function, that would make the rest of this much simpler.  You can call <code>logger.SetPrefix()</code> inside each function, which might look like the following based on your example code.</p>\n\n<p><code>Info.SetPrefix(\"INFO: \" + _enter() + \":\")\n</code> </p>\n\n<p>You could wrap the logger in a struct that would help do the above automatically, but you should be aware of the overhead of making the call to <code>_enter()</code> <em>every</em> time.</p></li>\n<li><p>Though at this point, you might want to look into using a logging library with more features.  I have had good experiences with <a href=\"https://github.com/Sirupsen/logrus\" rel=\"nofollow\">logrus</a> which can be a drop in replacement for the standard lib's log package.</p></li>\n</ul>\n"}], "owner": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 1, "accepted_answer_id": 36520282, "answer_count": 1, "score": 0, "last_activity_date": 1460224364, "creation_date": 1460218957, "question_id": 36519524, "link": "https://stackoverflow.com/questions/36519524/how-to-add-custom-non-const-string-information-to-log-format", "title": "How to add custom (non const) string information to log format?", "body": "<p>I have started working with logging in Go and I have encountered this article about logging in Go <a href=\"https://www.goinggo.net/2013/11/using-log-package-in-go.html\" rel=\"nofollow\">https://www.goinggo.net/2013/11/using-log-package-in-go.html</a></p>\n\n<p>with the following source code (slightly changed):</p>\n\n<pre><code>var (\n  Trace   *log.Logger\n  Info    *log.Logger\n  Warning *log.Logger\n  Error   *log.Logger\n)\n\nfunc Init(\n    traceHandle io.Writer,\n    infoHandle io.Writer,\n    warningHandle io.Writer,\n    errorHandle io.Writer) {\n\n    Trace = log.New(traceHandle,\n        \u201cTRACE: \u201c,\n        log.Ldate|log.Ltime|log.Lshortfile)\n\n    Info = log.New(infoHandle,\n        \u201cINFO: \u201c,\n        log.Ldate|log.Ltime|log.Lshortfile)\n\n    Warning = log.New(warningHandle,\n        \u201cWARNING: \u201c,\n        log.Ldate|log.Ltime|log.Lshortfile)\n\n    Error = log.New(errorHandle,\n        \u201cERROR: \u201c,\n        log.Ldate|log.Ltime|log.Lshortfile)\n}\n\nfunc main() {\n  Init(ioutil.Discard, os.Stdout, os.Stdout, os.Stderr)\n}\n</code></pre>\n\n<p>now I would like to add some custom information to log entries produced by this logger but which are not const string literals (like added there <code>INFO:</code> or <code>WARNING:</code>)</p>\n\n<p>For example I would like to add a name of the function in which the log has been triggered. Let's say I have the following function which I would like to use for this: (from <a href=\"http://sabhiram.com/go/2015/01/21/golang_trace_fns_part_1.html\" rel=\"nofollow\">here</a>)</p>\n\n<pre><code>func _enter() {\n  // Skip this function, and fetch the PC and file for its parent\n  pc, _, _, _ := runtime.Caller(1)\n  // Retrieve a Function object this functions parent\n  functionObject := runtime.FuncForPC(pc)\n  // Regex to extract just the function name (and not the module path)\n  extractFnName := regexp.MustCompile(`^.*\\.(.*)$`)\n  fnName := extractFnName.ReplaceAllString(functionObject.Name(), \"$1\")\n  fmt.Printf(\"Entering %s\\n\", fnName)\n}\n</code></pre>\n\n<p>How can I add this to the logger?</p>\n"}]