[{"tags": ["xml", "go", "ietf-netmod-yang", "ietf-netconf"], "comments": [{"owner": {"reputation": 1153, "user_id": 1371064, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/NnrmE.jpg?s=128&g=1", "display_name": "Carlos Andr&#233;s Garc&#237;a", "link": "https://stackoverflow.com/users/1371064/carlos-andr%c3%a9s-garc%c3%ada"}, "edited": false, "score": 3, "creation_date": 1515015791, "post_id": 48085443, "comment_id": 83146012, "body": "Can you add the XML file that you want to construct programatically?"}, {"owner": {"reputation": 1, "user_id": 9095706, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-tbTJmxZg3-E/AAAAAAAAAAI/AAAAAAAAEiw/THcHdWUlF8c/photo.jpg?sz=128", "display_name": "madyjosh", "link": "https://stackoverflow.com/users/9095706/madyjosh"}, "reply_to_user": {"reputation": 1153, "user_id": 1371064, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/NnrmE.jpg?s=128&g=1", "display_name": "Carlos Andr&#233;s Garc&#237;a", "link": "https://stackoverflow.com/users/1371064/carlos-andr%c3%a9s-garc%c3%ada"}, "edited": false, "score": 0, "creation_date": 1515096859, "post_id": 48085443, "comment_id": 83181077, "body": "apologies for the lack of details, I have added the snippets above. Thanks for your time."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9095706, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-tbTJmxZg3-E/AAAAAAAAAAI/AAAAAAAAEiw/THcHdWUlF8c/photo.jpg?sz=128", "display_name": "madyjosh", "link": "https://stackoverflow.com/users/9095706/madyjosh"}, "edited": false, "score": 0, "creation_date": 1515096984, "post_id": 48085503, "comment_id": 83181145, "body": "thanks for the pointers! I am stuck at the first step - basically to generate xml tagged go structs from yang schema."}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 2, "last_activity_date": 1515016142, "last_edit_date": 1515016142, "creation_date": 1515015547, "answer_id": 48085503, "question_id": 48085443, "link": "https://stackoverflow.com/questions/48085443/programatically-construct-netconf-edit-config-request/48085503#48085503", "title": "Programatically construct netconf edit-config request", "body": "<ol>\n<li>Map the XML document to tagged structs.</li>\n<li>Create a struct that represents the configuration you desire.</li>\n<li>Marshal the struct using <a href=\"https://golang.org/pkg/encoding/xml/#MarshalIndent\" rel=\"nofollow noreferrer\"><code>xml.MarshalIndent</code></a> (see example).</li>\n</ol>\n\n<p>See also <a href=\"https://github.com/Juniper/go-netconf\" rel=\"nofollow noreferrer\">https://github.com/Juniper/go-netconf</a></p>\n"}], "owner": {"reputation": 1, "user_id": 9095706, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-tbTJmxZg3-E/AAAAAAAAAAI/AAAAAAAAEiw/THcHdWUlF8c/photo.jpg?sz=128", "display_name": "madyjosh", "link": "https://stackoverflow.com/users/9095706/madyjosh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 366, "favorite_count": 0, "closed_date": 1515043476, "answer_count": 1, "score": -2, "last_activity_date": 1515096819, "creation_date": 1515015294, "last_edit_date": 1515096819, "question_id": 48085443, "link": "https://stackoverflow.com/questions/48085443/programatically-construct-netconf-edit-config-request", "closed_reason": "Needs details or clarity", "title": "Programatically construct netconf edit-config request", "body": "<p>I am trying to programatically construct netconf edit-config request for a yang schema config object. Currently I am constructing this xml string manually. Is there a way I can do this programatically? I am using golang</p>\n\n<p>for example, I am trying to send edit-config request for bgp config element as defined in the schema bgp-config.yang:</p>\n\n<pre><code>module bgp-config {\n    namespace \"http://exnet.com/bgp-config\";\n    prefix bgp-config;\n    import ietf-inet-types { prefix inet; }\n    import tailf-common { prefix tailf; }\n    import ietf-yang-types { prefix yang; }\n    import ietf-bgp-types { prefix bgp-types; }\n    import ietf-bgp-multiprotocol { prefix bgp-mp; }\n    import openconfig-routing-policy { prefix rpol; }\n    import myietf-routing {prefix rt;}\n    revision \"2016-04-07\" {\n    description \"Revisied on 2016-04-07.\";\n    }\n    augment \"/rt:router\"\n    {\n list bgp {\n     //presence \"Container for BGP protocol hierarchy\";\n     //tailf:cli-add-mode;\n     tailf:info \"Top-level configuration and state for the BGP router\";\n     tailf:cli-full-no;\n     tailf:cli-suppress-list-no;\n     key \"local-as\";\n     max-elements 1;\n     description\n         \"Top-level configuration and state for the BGP router\";\n     uses bgp_config;\n     uses bgp-graceful-restart;\n     uses bgp-mp:bgp-route-selection-options;\n     //tailf:cli-suppress-no;\n     container afi-safis {\n         tailf:cli-drop-node-name;\n         description\n             \"Address family specific configuration\";\n         uses bgp-mp:bgp-common-afi-safi-list;\n     }\n\n          }\n}\n</code></pre>\n\n<p>I have this code snippet to send edit-config request to the netconf server for the bgp config element:</p>\n\n<pre><code>var s *netconf.Session \nlocalas := 888 \nxmlstr := `&lt;edit-config&gt;\n        &lt;target&gt;&lt;candidate/&gt;&lt;/target&gt;\n         &lt;config&gt;\n         &lt;router xmlns=\"urn:ietf:params:xml:ns:yang:ietf-routing\"&gt;\n         &lt;bgp xmlns=\"http://exnet.com/bgp-config\"&gt;\n         &lt;local-as&gt;` + strconv.Itoa(localas) + `&lt;/local-as&gt;\n         &lt;/bgp&gt;\n      &lt;/router&gt;\n     &lt;/config&gt;\n    &lt;/edit-config&gt;`\n NetConfSendRPC(s, xmlstr)\n xmlstr = \"&lt;commit/&gt;\"\n NetConfSendRPC(s, xmlstr)\n s.Close()\n</code></pre>\n\n<p>My question is on the lines of how I can programatically construct the xml string to send edit-config for all the config elements. The first step would be to generate xml tagged go structs from the yang schema (this is where I need help/pointers) and then I can use xml marshal methods to construct the request. Any suggestions for the first step would be helpful. Thanks.</p>\n"}, {"tags": ["csv", "go", "struct", "slice"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1515011078, "post_id": 48084587, "comment_id": 83144012, "body": "There&#39;s no code in the actual question, and the playground link has way too much. Please include a <a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable example</a>. Your question will surely be just as valid with one or two fields."}, {"owner": {"reputation": 57, "user_id": 5081941, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ebbaa05eb3f2fece6685b69bebf6b564?s=128&d=identicon&r=PG&f=1", "display_name": "shishh03", "link": "https://stackoverflow.com/users/5081941/shishh03"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1515011539, "post_id": 48084587, "comment_id": 83144180, "body": "added, sorry about that. Let me know if anything is missing"}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1515013066, "post_id": 48084587, "comment_id": 83144889, "body": "Does the fact that the source of your data is an API response have any bearing on your actual problem? It seems that you just want to know how to convert your &quot;Response&quot; struct to CSV without having to explicitly refer to each of its fields (A, B, C, etc)."}, {"owner": {"reputation": 57, "user_id": 5081941, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ebbaa05eb3f2fece6685b69bebf6b564?s=128&d=identicon&r=PG&f=1", "display_name": "shishh03", "link": "https://stackoverflow.com/users/5081941/shishh03"}, "edited": false, "score": 0, "creation_date": 1515013719, "post_id": 48084587, "comment_id": 83145181, "body": "I don&#39;t think my source of data is an issue. The sample response I have provided above is what my API response looks like except its a large JSON blob. I am trying to iterate through the fields in that struct and output to a csv file but not sure if there&#39;s a direct way to do that."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1515013788, "post_id": 48084587, "comment_id": 83145220, "body": "To iterate over the fields of an arbitrary struct you should use the package <code>reflect</code>."}, {"owner": {"reputation": 1759, "user_id": 1512962, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/EfW0L.png?s=128&g=1", "display_name": "Anonymous Penguin", "link": "https://stackoverflow.com/users/1512962/anonymous-penguin"}, "edited": false, "score": 0, "creation_date": 1515014036, "post_id": 48084587, "comment_id": 83145312, "body": "Why don&#39;t you use the CSV package itself? (<a href=\"https://golang.org/pkg/encoding/csv/\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/csv</a>) Also: is that a runtime error or a compile error? If it&#39;s a compile error, please post the entire error message (or at least the line that it is causing the error)"}, {"owner": {"reputation": 57, "user_id": 5081941, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ebbaa05eb3f2fece6685b69bebf6b564?s=128&d=identicon&r=PG&f=1", "display_name": "shishh03", "link": "https://stackoverflow.com/users/5081941/shishh03"}, "edited": false, "score": 0, "creation_date": 1515021269, "post_id": 48084587, "comment_id": 83147945, "body": "added the error code. I don&#39;t think I can write slice of slice interface to a csv file as mentioned in my code. Also, I used the reflect package however, had trouble making it work with nested structs"}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 5081941, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ebbaa05eb3f2fece6685b69bebf6b564?s=128&d=identicon&r=PG&f=1", "display_name": "shishh03", "link": "https://stackoverflow.com/users/5081941/shishh03"}, "edited": false, "score": 0, "creation_date": 1515020436, "post_id": 48085247, "comment_id": 83147698, "body": "that&#39;s great, thank you. Would it be possible to show another example with nested structs as shown in my example? I tried using &quot;reflect&quot; but it didn&#39;t quite work with nested structs. Sorry for the trouble"}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "reply_to_user": {"reputation": 57, "user_id": 5081941, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ebbaa05eb3f2fece6685b69bebf6b564?s=128&d=identicon&r=PG&f=1", "display_name": "shishh03", "link": "https://stackoverflow.com/users/5081941/shishh03"}, "edited": false, "score": 0, "creation_date": 1515027767, "post_id": 48085247, "comment_id": 83149532, "body": "@shishh03 I don&#39;t see any nested structs in your sample code, just <code>ApiStruct.Response</code>..."}, {"owner": {"reputation": 57, "user_id": 5081941, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ebbaa05eb3f2fece6685b69bebf6b564?s=128&d=identicon&r=PG&f=1", "display_name": "shishh03", "link": "https://stackoverflow.com/users/5081941/shishh03"}, "edited": false, "score": 0, "creation_date": 1515079647, "post_id": 48085247, "comment_id": 83171849, "body": "i&#39;m fairly new to golang so i assumed Response struct inside API struct is called nested struct, my bad :) In your example, you just have Foo struct with different fields inside whereas in my example, I have APIStruct then Response Struct with various fields. I wasn&#39;t sure on how to iterate through the fields inside the response struct. I will take the example you provided and experiment with it. Give me few hours!"}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 2, "last_activity_date": 1515015034, "last_edit_date": 1515015034, "creation_date": 1515014243, "answer_id": 48085247, "question_id": 48084587, "link": "https://stackoverflow.com/questions/48084587/iterate-through-nested-structs-in-golang-and-store-values-in-slice-of-slice-stri/48085247#48085247", "title": "Iterate through nested structs in golang and store values in slice of slice string", "body": "<p>You can handle the fields of a struct programmatically by using the <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\"><code>reflect</code> package</a>, in particular the <a href=\"https://golang.org/pkg/reflect/#Type\" rel=\"nofollow noreferrer\"><code>Type</code></a> and <a href=\"https://golang.org/pkg/reflect/#Value\" rel=\"nofollow noreferrer\"><code>Value</code></a> types. For example:</p>\n\n<pre><code>type Foo struct {\n  A int\n  B bool\n  C string\n  D float64\n  E interface{}\n}\n\nfunc main() {\n  f := Foo{1, true, \"foo\", 3.45, nil}\n  t := reflect.TypeOf(f)\n  v := reflect.ValueOf(f)\n\n  for i := 0; i &lt; v.NumField(); i++ {\n    fmt.Printf(\"OK: %q -&gt; %#v\\n\", t.Field(i).Name, v.Field(i))\n  }\n  // OK: \"A\" -&gt; 1\n  // OK: \"B\" -&gt; true\n  // OK: \"C\" -&gt; \"foo\"\n  // OK: \"D\" -&gt; 3.45\n  // OK: \"E\" -&gt; interface {}(nil)\n}\n</code></pre>\n\n<p>Using the field names and values as demonstrated above you can generate strings to use with the <a href=\"https://golang.org/pkg/encoding/csv/\" rel=\"nofollow noreferrer\"><code>csv</code> package</a> to generate CSV:</p>\n\n<pre><code>func (f Foo) ValueStrings() []string {\n  v := reflect.ValueOf(f)\n  ss := make([]string, v.NumField())\n  for i := range ss {\n    ss[i] = fmt.Sprintf(\"%v\", v.Field(i))\n  }\n  return ss\n}\n\nfunc main() {\n  foos := []Foo{Foo{1, true, \"foo\", 2.34, nil}, Foo{2, false, \"bar\", 3.45, 1234}}\n  w := csv.NewWriter(os.Stdout)\n\n  // Write the CSV header.\n  t := reflect.TypeOf(foos[0])\n  names := make([]string, t.NumField())\n  for i := range names {\n    names[i] = t.Field(i).Name\n  }\n  if err := w.Write(names); err != nil {\n    panic(err)\n  }\n\n  // Write the CSV rows.\n  for _, foo := range foos {\n    if err := w.Write(foo.ValueStrings()); err != nil {\n      panic(err)\n    }\n  }\n  w.Flush()\n\n  if err := w.Error(); err != nil {\n    panic(err)\n  }\n}\n// A,B,C,D,E\n// 1,true,foo,2.34,&lt;nil&gt;\n// 2,false,bar,3.45,1234\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 5081941, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ebbaa05eb3f2fece6685b69bebf6b564?s=128&d=identicon&r=PG&f=1", "display_name": "shishh03", "link": "https://stackoverflow.com/users/5081941/shishh03"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2178, "favorite_count": 0, "accepted_answer_id": 48085247, "answer_count": 1, "score": 0, "last_activity_date": 1515020091, "creation_date": 1515010919, "last_edit_date": 1515020091, "question_id": 48084587, "link": "https://stackoverflow.com/questions/48084587/iterate-through-nested-structs-in-golang-and-store-values-in-slice-of-slice-stri", "title": "Iterate through nested structs in golang and store values in slice of slice string", "body": "<p>I have a nested structs which I need to iterate through the fields and store it in a string slice of slice. Then, output it to a csv file. \nProblem right now is that I am manually accessing each field in the struct and storing it in a slice of slice interface but my actual code has 100 fields so doesn't make sense to call each field manually.\nAlso, having trouble storing slice of slice interface to csv as I get the following error when writing to a csv file where output is [][]interface{}</p>\n\n<pre><code>//      for _, value := range output {\n//          err := writer.Write(value) //ERROR: can't use value (type []interface{}) as type []string in argument to writer.Write (build)\n//          checkError(\"Failed write to file\", err)\n//      }: \n`can't use value (type []interface{}) as type []string in argument to writer.Write (build)`\n</code></pre>\n\n<p>Code: </p>\n\n<pre><code>type ApiStruct struct {\n    Response []struct { //100 more fields\n        A int         `json:\"a\"`\n        B interface{} `json:\"b\"`\n        C bool        `json:\"c\"`\n        D string      `json:\"d\"`\n        E int         `json:\"e\"`\n        F float64     `json:\"f\"`\n        G []string    `json:\"g\"`\n        H bool        `json:\"h\"`\n        I interface{} `json:\"i\"`\n    } `json:\"response\"`\n}\n\nfunc main() {\n    output := api_call()\n    for _, value := range output {\n        fmt.Println(value)\n    }\n\n    // write_file(output)\n\n}\n\nfunc api_call() (api_data [][]interface{}) {\n\n    api_response := `{\n    \"response\": [{\n            \"a\": 2,\n            \"b\": null,\n            \"c\": false,\n            \"d\": \"sdasdas\",\n            \"e\": 22,\n            \"f\": -123.2131231,\n            \"g\": [\"string1\", \"string2\"],\n            \"h\": true,\n            \"i\": null\n        },\n        {\n            \"a\": 4,\n            \"b\": null,\n            \"c\": true,\n            \"d\": \"sd\",\n            \"e\": 22,\n            \"f\": 1223.2131231,\n            \"g\": [\"string3\", \"string4\"],\n            \"h\": true,\n            \"i\": null\n        }\n    ]\n  }`\n\n    var d ApiStruct\n    err := json.Unmarshal([]byte(api_response), &amp;d)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    //instead of manually creating the headers or row lables for CSV output, want to know if there's a way to iterate through the key values in the struct\n    api_data = append(api_data, []interface{}{\"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"H\", \"I\"})\n\n    for _, v := range d.Response {\n        api_data = append(api_data, []interface{}{v.A, v.B, v.C, v.D, v.E, v.F, v.G, v.H, v.I})\n\n        /*\n            I want to do a for loop on those fields and store values in an array like this or any other way that's easier to store in a csv file.\n            Instead of accessing each field individually (v.A, v.B), I want to iterate through the fields because\n            I have 100 fields in the struct so doesn't make sense to do v.A, etc 100 times.\n            Also, I am not sure if I can range over the interface slice of slice and store it in a csv file. Think it needs to be a string slice of slice [][]string.\n            Maybe need to convert interface slice of slice: [][]interface{} to string slice of slice: [][]string\n\n        */\n\n    }\n\n    return\n}\n</code></pre>\n\n<p>Please see the link below for more details/comments in the code:</p>\n\n<p><a href=\"https://play.golang.org/p/OEdi7Dfm_KL\" rel=\"nofollow noreferrer\">https://play.golang.org/p/OEdi7Dfm_KL</a></p>\n\n<p>Let me know if anything is unclear! Any help is appreciated!</p>\n"}, {"tags": ["unit-testing", "go", "mocking", "gomock"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1515048558, "post_id": 48082858, "comment_id": 83154459, "body": "What is the purpose of testing something which doesn&#39;t have any effect? None. If the method call has an effect, here a side effect, test for this side effect. This might be state change of the object (simple to observe) or a state change in the environment (harder to test). Mocking is often a sign for a bad test plan and/or bad design."}], "answers": [{"comments": [{"owner": {"reputation": 2264, "user_id": 1964489, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dced6d8951b4771cde68c08e372bbede?s=128&d=identicon&r=PG", "display_name": "Ziva", "link": "https://stackoverflow.com/users/1964489/ziva"}, "edited": false, "score": 0, "creation_date": 1515034010, "post_id": 48084110, "comment_id": 83150817, "body": "Oh, I see now. Thanks a lot!"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 4, "last_activity_date": 1515008932, "last_edit_date": 1515008932, "creation_date": 1515008619, "answer_id": 48084110, "question_id": 48082858, "link": "https://stackoverflow.com/questions/48082858/testing-and-mocking-a-function-which-does-not-return-any-value/48084110#48084110", "title": "Testing and mocking a function which does not return any value", "body": "<p>The two methods called by <code>DoSomething</code> are concrete implementations, you cannot mock something like that in Go.</p>\n\n<p>To achieve what you want <code>DoSomething</code> would have to <em>depend</em> on an interface that defines those two methods and call those instead of the concrete ones.</p>\n\n<pre><code>type DoMorer interface {\n    DoEvenMore(arg int)\n    AndEvenMore(arg int)\n} \n\ntype ExampleStruct struct {\n     Id string \n     // Other fields\n}\n\nfunc (e *ExampleStruct) DoSomething(arg int, dm DoMorer) {\n     arg2 := arg * 2\n     dm.DoEvenMore(arg2)\n     arg3 := arg * 3\n     dm.AndEvenMore(arg3)  \n}\n</code></pre>\n\n<p>With a setup like this, during testing, you can create a mock for the <code>DoMorer</code> interface and pass that to <code>DoSomething</code>.</p>\n\n<hr>\n\n<p><code>DoMorer</code> doesn't have to be passed to as an argument, it could be a field of <code>ExampleStruct</code> or a global, whatever suits your needs.</p>\n"}], "owner": {"reputation": 2264, "user_id": 1964489, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dced6d8951b4771cde68c08e372bbede?s=128&d=identicon&r=PG", "display_name": "Ziva", "link": "https://stackoverflow.com/users/1964489/ziva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4380, "favorite_count": 1, "accepted_answer_id": 48084110, "answer_count": 1, "score": 5, "last_activity_date": 1515008932, "creation_date": 1515002910, "last_edit_date": 1515006209, "question_id": 48082858, "link": "https://stackoverflow.com/questions/48082858/testing-and-mocking-a-function-which-does-not-return-any-value", "title": "Testing and mocking a function which does not return any value", "body": "<p>I want to test a function, which does not return any value, but instead triggers other functions. While reading about testing, I found information that this is called a behavioral verification and that by mocking I can check what functions and in what order are triggered. However, I have a problem to implement the proper mocking technique for my code. </p>\n\n<p>Let's consider a simple example of the following interface and struct (the example is very basic just to make it easier to explain):</p>\n\n<pre><code>type ExampleInterface interface {\n    DoSomething(arg int)\n    DoEvenMore(arg int)\n    AndEvenMore(arg int)\n} \n\ntype ExampleStruct struct {\n     Id string \n     // Other fields\n}\n\nfunc (e *ExampleStruct) DoSomething(arg int) {\n     arg2 := arg * 2\n     e.DoEvenMore(arg2)\n     arg3 := arg * 3\n     e.AndEvenMore(arg3)  \n}\n\nfunc (e *ExampleStruct) DoEvenMore(arg int){\n     fmt.Println(\"I did so many operations here using \", arg)\n}\n\nfunc (e *ExampleStruct) AndEvenMore(arg int) {\n     // Performing other operations on arg\n}\n</code></pre>\n\n<p>Now, I want to test function <code>DoSomething</code>. Since it does not return any value what I want to do is to test whether after calling this function with argument 3 the following chain of events happens: function <code>DoEvenMore</code> is called once with argument <code>6</code>, and next function <code>AndEvenMore</code> is called once with argument <code>9</code></p>\n\n<p>I wrote the following mocking test:</p>\n\n<pre><code>func TestDoSomething(t *testing.T) {\n\n    mockCtrl := gomock.NewController(t)\n    defer mockCtrl.Finish()\n\n    mockClient := mocks.NewMockExampleInterface(mockCtrl)\n\n    example := ExampleStruct(\"ExampleId\")\n\n    gomock.InOrder(\n        mockClient.EXPECT().DoSomething(3).Return().Times(1)\n        mockClient.EXPECT().DoEvenMore(6).Return().Times(1)\n        mockClient.EXPECT().AndEvenMore(9).Return().Times(1) \n    )\n\n    example.DoSomething(3)\n}\n</code></pre>\n\n<p>However, when I run this test I get the error: <code>Unexpected call to *mocks.MockExampleInterface.DoSomething(..)</code>. </p>\n\n<p>How I should properly perform the mocking in such example?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1514997880, "post_id": 48081530, "comment_id": 83137450, "body": "Those are 2 different data structures. If you want to copy the values into a different structure, you have to do that manually."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1514997894, "post_id": 48081530, "comment_id": 83137457, "body": "You have to use something <i>dynamic</i> to model your <i>dynamic</i> input. See possible duplicates: <a href=\"https://stackoverflow.com/questions/29347092/how-to-parse-deserlize-a-dynamic-json-in-golang/29347148#29347148\">How to parse/deserlize a dynamic JSON in Golang</a>; and <a href=\"https://stackoverflow.com/questions/46585279/unmarshal-json-string-to-a-struct-that-have-one-element-of-the-struct-itself/46585770#46585770\">Unmarshal json string to a struct that have one element of the struct itself</a>."}], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 6, "last_activity_date": 1514998365, "last_edit_date": 1514998365, "creation_date": 1514997975, "answer_id": 48081623, "question_id": 48081530, "link": "https://stackoverflow.com/questions/48081530/map-response-to-a-struct-using-golang/48081623#48081623", "title": "Map response to a struct using Golang", "body": "<p>The mapping doesn't work that way. Instead, you should use a map:</p>\n\n<pre><code>    data := []byte(`{\n       \"GBP\": 657.54\n     }`)\n\n    priceMap := map[string]float64{}\n    err := json.Unmarshal(data, &amp;priceMap)\n    // Check your errors!\n    if err != nil {\n      log.Fatal(err.Error())\n    }\n    fmt.Println(priceMap)\n</code></pre>\n\n<p>This will print:</p>\n\n<pre><code>map[GBP:657.54]\n</code></pre>\n\n<p>You can then iterate over the map and build the struct you mentioned above, or just access the entry directly if you know the currency. eg: <code>priceMap[\"GBP\"]</code></p>\n\n<p>You should really check your errors, especially if you're not getting the output you expect from <code>Unmarshal</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 3, "last_activity_date": 1515001424, "last_edit_date": 1515001424, "creation_date": 1514998601, "answer_id": 48081782, "question_id": 48081530, "link": "https://stackoverflow.com/questions/48081530/map-response-to-a-struct-using-golang/48081782#48081782", "title": "Map response to a struct using Golang", "body": "<p>The problem is that the unmarshaler cannot guess that <em>keys</em> in a JSON object should correspond to some <em>value</em> in a struct. Golang JSON mapping simply doesn't work that way.</p>\n\n<p>However, you can make your \"Price\" type <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\">implement <code>json.Unmarshaler</code></a> to deserialize a message into a map of floats (<code>map[string]float64</code>) then ensure the shape is right and populate the struct accordingly:</p>\n\n<pre><code>func (p *Price) UnmarshalJSON(bs []byte) error {\n  kvs := map[string]float64{}\n  err := json.Unmarshal(bs, &amp;kvs)\n  if err != nil {\n    return err\n  }\n  if len(kvs) != 1 {\n    return fmt.Errorf(\"expected 1 key, got %d\", len(kvs))\n  }\n  for name, value := range kvs {\n    p.Name, p.Value = name, value\n  }\n  return nil\n}\n\nfunc main() {\n  jsonstr := `[{\"GBP\":657.54},{\"USD\":123.45}]`\n  ps := []Price{}\n  err := json.Unmarshal([]byte(jsonstr), &amp;ps)\n  if err != nil {\n    panic(err)\n  }\n  // ps=[]main.Price{\n  //   main.Price{Name:\"GBP\", Value:657.54},\n  //   main.Price{Name:\"USD\", Value:123.45}\n  // }\n}\n</code></pre>\n"}], "owner": {"reputation": 1591, "user_id": 7304216, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7948f2563d2a2d276561b3a05c357150?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Pocock", "link": "https://stackoverflow.com/users/7304216/nick-pocock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5299, "favorite_count": 0, "accepted_answer_id": 48081623, "answer_count": 2, "score": 5, "last_activity_date": 1515001424, "creation_date": 1514997617, "question_id": 48081530, "link": "https://stackoverflow.com/questions/48081530/map-response-to-a-struct-using-golang", "title": "Map response to a struct using Golang", "body": "<p>I am attempting to map a response from an API to a struct using Golang. </p>\n\n<p>The JSON that comes back when I view the link in the browser is below:</p>\n\n<pre><code>{\n\"GBP\": 657.54\n}\n</code></pre>\n\n<p>And I just want to map it to a simple struct like so:</p>\n\n<pre><code>type Price struct {\n    Name  string\n    Value float64\n}\n</code></pre>\n\n<p>Here is my current code.</p>\n\n<pre><code>func FetchCoinPrice(fsym string, tsyms string) Price {\n    url := fmt.Sprintf(\"https://min-api.cryptocompare.com/data/price?fsym=\" + fsym + \"&amp;tsyms=\" + tsyms)\n\n    fmt.Println(\"Requesting data from \" + url)\n\n    price := Price{}\n\n    // getting the data using http\n    request, err := http.Get(url)\n    if err != nil {\n        log.Fatal(err.Error())\n    }\n\n    // Read the response body using ioutil\n    body, err := ioutil.ReadAll(request.Body)\n    if err != nil {\n        log.Fatal(err.Error())\n    }\n\n    defer request.Body.Close()\n\n    if request.StatusCode == http.StatusOK {\n        json.Unmarshal(body, &amp;price)\n    }\n\n    return price\n\n}\n</code></pre>\n\n<p>At the moment all I receive is an empty struct, I know the link is bringing back the correct data and I've tested it in my browser.</p>\n"}, {"tags": ["string", "go"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1514995904, "post_id": 48080999, "comment_id": 83136274, "body": "Is there any reason you can&#39;t use an existing markdown parser? eg: <a href=\"https://godoc.org/gopkg.in/russross/blackfriday.v2\" rel=\"nofollow noreferrer\">godoc.org/gopkg.in/russross/blackfriday.v2</a>"}, {"owner": {"reputation": 4671, "user_id": 4927751, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VwUAi.jpg?s=128&g=1", "display_name": "Kshitij Saraogi", "link": "https://stackoverflow.com/users/4927751/kshitij-saraogi"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1514996070, "post_id": 48080999, "comment_id": 83136383, "body": "This is a general purpose question on parsing strings given a format. I think a markdown parser will be an overkill for my task.  Moreover, there is no guarantee that a suitable parser will always exist."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 2, "creation_date": 1514996150, "post_id": 48080999, "comment_id": 83136436, "body": "Ok, then please read the <a href=\"https://golang.org/pkg/fmt/#hdr-Scanning\" rel=\"nofollow noreferrer\">fmt scanning docs</a>, it clearly states: &quot; the %s verb (...) stops consuming input at the first space or newline character&quot;. It then can&#39;t find a <code>]</code> so never gets to parsing the URL. You shouldn&#39;t ignore the returns from <code>Sscanf</code>."}, {"owner": {"reputation": 4671, "user_id": 4927751, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VwUAi.jpg?s=128&g=1", "display_name": "Kshitij Saraogi", "link": "https://stackoverflow.com/users/4927751/kshitij-saraogi"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1514996262, "post_id": 48080999, "comment_id": 83136494, "body": "Thank you for the suggestion. I did read the doc before asking here and I have also mentioned in this my post."}, {"owner": {"reputation": 830, "user_id": 3872894, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006705821837/picture?type=large", "display_name": "Jared Hooper", "link": "https://stackoverflow.com/users/3872894/jared-hooper"}, "edited": false, "score": 3, "creation_date": 1514996534, "post_id": 48080999, "comment_id": 83136642, "body": "&quot;there is no guarantee that a suitable parser will always exist&quot; - do you just want to accomplish this by using regexp?"}, {"owner": {"reputation": 4671, "user_id": 4927751, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VwUAi.jpg?s=128&g=1", "display_name": "Kshitij Saraogi", "link": "https://stackoverflow.com/users/4927751/kshitij-saraogi"}, "edited": false, "score": 0, "creation_date": 1514997039, "post_id": 48080999, "comment_id": 83136925, "body": "Thank you and sorry for asking such an easy question."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1515000034, "post_id": 48080999, "comment_id": 83138622, "body": "There are no silver bullet to string manipulation and parsing. You always need to pick a specified tool. In the op&#39;s case, using regex is most reasonable (a MD parser is too heavy for the simple case). If you want some exercise, write codes to pair matching bracelets can do the job too."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1515005319, "post_id": 48080999, "comment_id": 83141353, "body": "@KshitijSaraogi there is no general solution to such a general problem, only a multitude of different approaches, which is why the guidance to ask about &quot;a specific programming problem&quot; exists :)"}], "answers": [{"comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1514997072, "post_id": 48081295, "comment_id": 83136957, "body": "That would work for the examples listed by OP. But do note that <code>[\\[foo\\]](foo.com)</code> is valid markdown."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1514997772, "post_id": 48081295, "comment_id": 83137392, "body": "@Marc You&#39;re right, I forgot about that. I added a note mentioning this."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1515004585, "last_edit_date": 1515004585, "creation_date": 1514996746, "answer_id": 48081295, "question_id": 48080999, "link": "https://stackoverflow.com/questions/48080999/parsing-formatted-strings-in-go/48081295#48081295", "title": "Parsing formatted strings in Go", "body": "<p><strong>Note:</strong> The following solution only works for \"simple\", non-escaped input markdown links. If this suits your needs, go ahead and use it. For full markdown-compatibility you should use a proper markdown parser such as <a href=\"https://godoc.org/gopkg.in/russross/blackfriday.v2\" rel=\"nofollow noreferrer\">gopkg.in/russross/blackfriday.v2</a>.</p>\n\n<hr>\n\n<p>You could use regexp to get the link text and the URL out of a markdown link.</p>\n\n<p>So the general input text is in the form of:</p>\n\n<pre><code>[some text](somelink)\n</code></pre>\n\n<p>A regular expression that models this:</p>\n\n<pre><code>\\[([^\\]]+)\\]\\(([^)]+)\\)\n</code></pre>\n\n<p>Where:</p>\n\n<ul>\n<li><code>\\[</code> is the literal <code>[</code></li>\n<li><code>([^\\]]+)</code> is for the <code>\"some text\"</code>, it's everything except the closing square brackets</li>\n<li><code>\\]</code> is the literal <code>]</code></li>\n<li><code>\\(</code> is the literal <code>(</code></li>\n<li><code>([^)]+)</code> is for the <code>\"somelink\"</code>, it's everything except the closing brackets</li>\n<li><code>\\)</code> is the literal <code>)</code></li>\n</ul>\n\n<p>Example:</p>\n\n<pre><code>r := regexp.MustCompile(`\\[([^\\]]+)\\]\\(([^)]+)\\)`)\n\ninputs := []string{\n    \"[Some text](#some/link)\",\n    \"[What did I just commit?](#what-did-i-just-commit)\",\n    \"invalid\",\n}\n\nfor _, input := range inputs {\n    fmt.Println(\"Parsing:\", input)\n    allSubmatches := r.FindAllStringSubmatch(input, -1)\n\n    if len(allSubmatches) == 0 {\n        fmt.Println(\"   No match!\")\n    } else {\n        parts := allSubmatches[0]\n        fmt.Println(\"   Text:\", parts[1])\n        fmt.Println(\"   URL: \", parts[2])\n    }\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/UkqemSNO0QO\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Parsing: [Some text](#some/link)\n   Text: Some text\n   URL:  #some/link\nParsing: [What did I just commit?](#what-did-i-just-commit)\n   Text: What did I just commit?\n   URL:  #what-did-i-just-commit\nParsing: invalid\n   No match!\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 162, "user_id": 3434431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05e5568006202d634570c88ee5ddae3e?s=128&d=identicon&r=PG", "display_name": "benschumacher", "link": "https://stackoverflow.com/users/3434431/benschumacher"}, "is_accepted": false, "score": 0, "last_activity_date": 1515015888, "creation_date": 1515015888, "answer_id": 48085561, "question_id": 48080999, "link": "https://stackoverflow.com/questions/48080999/parsing-formatted-strings-in-go/48085561#48085561", "title": "Parsing formatted strings in Go", "body": "<p>You could create a simple lexer in pure-Go code for this use case. There's a <a href=\"https://youtu.be/HxaD_trXwRE\" rel=\"nofollow noreferrer\">great talk</a> by Rob Pike from years ago that goes into the design of <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\">text/template</a> which would be applicable. The implementation chains together a series of state functions into an overall state machine, and delivers the tokens out through a channel (via Goroutine) for later processing.</p>\n"}], "owner": {"reputation": 4671, "user_id": 4927751, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VwUAi.jpg?s=128&g=1", "display_name": "Kshitij Saraogi", "link": "https://stackoverflow.com/users/4927751/kshitij-saraogi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 407, "favorite_count": 0, "accepted_answer_id": 48081295, "answer_count": 2, "score": 0, "last_activity_date": 1515015888, "creation_date": 1514995693, "last_edit_date": 1514996460, "question_id": 48080999, "link": "https://stackoverflow.com/questions/48080999/parsing-formatted-strings-in-go", "title": "Parsing formatted strings in Go", "body": "<p><strong>The Problem</strong></p>\n\n<p>I have slice of <code>string</code> values wherein each value is formatted based on a template. In my particular case, I am trying to parse Markdown URLs as shown below:</p>\n\n<pre><code>- [What did I just commit?](#what-did-i-just-commit)\n- [I wrote the wrong thing in a commit message](#i-wrote-the-wrong-thing-in-a-commit-message)\n- [I committed with the wrong name and email configured](#i-committed-with-the-wrong-name-and-email-configured)\n- [I want to remove a file from the previous commit](#i-want-to-remove-a-file-from-the-previous-commit)\n- [I want to delete or remove my last commit](#i-want-to-delete-or-remove-my-last-commit)\n- [Delete/remove arbitrary commit](#deleteremove-arbitrary-commit)\n- [I tried to push my amended commit to a remote, but I got an error message](#i-tried-to-push-my-amended-commit-to-a-remote-but-i-got-an-error-message)\n- [I accidentally did a hard reset, and I want my changes back](#i-accidentally-did-a-hard-reset-and-i-want-my-changes-back)\n</code></pre>\n\n<p><strong>What I want to do?</strong></p>\n\n<p>I am looking for ways to parse this into a value of type:</p>\n\n<pre><code>type Entity struct {\n    Statement string\n    URL string\n}\n</code></pre>\n\n<p><strong>What have I tried?</strong></p>\n\n<p>As you can see, all the items follow the pattern: <code>- [{{ .Statement }}]({{ .URL }})</code>. I tried using the <code>fmt.Sscanf</code> function to scan each string as:</p>\n\n<pre><code>var statement, url string\nfmt.Sscanf(s, \"[%s](%s)\", &amp;statement, &amp;url)\n</code></pre>\n\n<p>This results in:</p>\n\n<pre><code>statement = \"I\"\nurl = \"\"\n</code></pre>\n\n<p>The issue is with the scanner storing space-separated values only. I do not understand why the URL field is not getting populated based on this rule.</p>\n\n<p>How can I get the Markdown values as mentioned above?</p>\n\n<p><strong>EDIT</strong>: As suggested by Marc, I will add couple of clarification points:</p>\n\n<ol>\n<li>This is a general purpose question on parsing strings based on a format. In my particular case, a Markdown parser might help me but my intention to learn how to handle such cases in general where a library might not exist.</li>\n<li>I have read the official documentation before posting here.</li>\n</ol>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 6, "creation_date": 1514993451, "post_id": 48080270, "comment_id": 83134835, "body": "<code>go get</code> takes packages as arguments, not files"}, {"owner": {"reputation": 914, "user_id": 5843840, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/58ecdbd6cee1807add0dcbbeb0f22a64?s=128&d=identicon&r=PG&f=1", "display_name": "Jones", "link": "https://stackoverflow.com/users/5843840/jones"}, "edited": false, "score": 0, "creation_date": 1514993892, "post_id": 48080270, "comment_id": 83135110, "body": "using either <code>go get .&#47;</code> or <code>go get .&#47;...</code> results in <code>go install: no install location for directory &#47;app outside GOPATH</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1514994626, "post_id": 48080270, "comment_id": 83135530, "body": "the docker file declares <code>GOPATH=&#47;go</code>, but you&#39;re putting the source in <code>&#47;app</code>."}, {"owner": {"reputation": 914, "user_id": 5843840, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/58ecdbd6cee1807add0dcbbeb0f22a64?s=128&d=identicon&r=PG&f=1", "display_name": "Jones", "link": "https://stackoverflow.com/users/5843840/jones"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1514994725, "post_id": 48080270, "comment_id": 83135596, "body": "I tried changing the path to /go and I&#39;m getting <code>go install: no install location for directory &#47;go outside GOPATH</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1514994874, "post_id": 48080270, "comment_id": 83135682, "body": "Package import paths are relative to <code>$GOPATH&#47;src</code>. You may want to review <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">&quot;How to Write Go Code&quot;</a>."}], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1515147179, "creation_date": 1515147179, "answer_id": 48111377, "question_id": 48080270, "link": "https://stackoverflow.com/questions/48080270/cant-go-get-dependencies-during-docker-build/48111377#48111377", "title": "Can&#39;t `go get` dependencies during docker build", "body": "<p>You may use my <code>Dockerfile</code> as a base. First stage produces working image. That\u2019s enough for many cases. \n<a href=\"https://github.com/lisitsky/go-site-search-string/blob/light-docker/Dockerfile\" rel=\"nofollow noreferrer\">https://github.com/lisitsky/go-site-search-string/blob/light-docker/Dockerfile</a></p>\n\n<p>If you want to shrink image size from ~800MB to about ~10-20MB use second stage too. </p>\n"}, {"tags": [], "owner": {"reputation": 13897, "user_id": 1713660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5aa62fae5a22b542d2a188b95384aee?s=128&d=identicon&r=PG", "display_name": "vladkras", "link": "https://stackoverflow.com/users/1713660/vladkras"}, "is_accepted": false, "score": 0, "last_activity_date": 1545823848, "creation_date": 1545823848, "answer_id": 53931487, "question_id": 48080270, "link": "https://stackoverflow.com/questions/48080270/cant-go-get-dependencies-during-docker-build/53931487#53931487", "title": "Can&#39;t `go get` dependencies during docker build", "body": "<p>Just use <code>$GOPATH</code> everywhere in your path to build your images, e.g. <code>$GOPATH/src/app</code> instead of <code>/app</code></p>\n\n<p>Full example of multistage build:</p>\n\n<pre><code>FROM golang:alpine as builder\n\nRUN apk add --update git\n\nRUN mkdir -p $GOPATH/src/build\n\nADD . $GOPATH/src/build/\n\nWORKDIR $GOPATH/src/build\n\nRUN go get ./...\n\nRUN go build -o main .\n\nFROM alpine\n\nRUN adduser -S -D -H -h /app appuser\n\nUSER appuser\n\nCOPY --from=builder /go/src/build/main /app/\n\nWORKDIR /app\n\nCMD [\"./main\"]\n</code></pre>\n"}], "owner": {"reputation": 914, "user_id": 5843840, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/58ecdbd6cee1807add0dcbbeb0f22a64?s=128&d=identicon&r=PG&f=1", "display_name": "Jones", "link": "https://stackoverflow.com/users/5843840/jones"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1691, "favorite_count": 1, "answer_count": 2, "score": -4, "last_activity_date": 1545823848, "creation_date": 1514992919, "question_id": 48080270, "link": "https://stackoverflow.com/questions/48080270/cant-go-get-dependencies-during-docker-build", "title": "Can&#39;t `go get` dependencies during docker build", "body": "<p>I'm fairly new to both Docker and go, so this might be something obvious, but my google searches haven't found anything.</p>\n\n<p>I'm trying to build a simple go program with docker, but I'm havign trouble with dependencies.</p>\n\n<p>go file:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"html\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n)\n\nfunc hello(writer http.ResponseWriter, r *http.Request) {\n    path := mux.Vars(r)[\"rest\"]\n    fmt.Fprintf(writer, \"Hello, %q\", html.EscapeString(path))\n}\n\nfunc main() {\n    router := mux.NewRouter().StrictSlash(true)\n\n    router.HandleFunc(\"/{rest:.*}\", hello)\n\n    log.Println(\"Listening...\")\n    log.Fatal(http.ListenAndServe(\":8080\", router))\n}\n</code></pre>\n\n<p>Docker file:</p>\n\n<pre><code>FROM golang:latest\nRUN mkdir /app\nADD ./HelloWorld.go /app/\nWORKDIR /app\nRUN go get ./*.go\nRUN go build -o main .\nCMD [\"/app/main\"]\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>Sending build context to Docker daemon  6.482MB\nStep 1/7 : FROM golang:latest\n ---&gt; 138bd936fa29\n...\nStep 5/7 : RUN go get ./*.go\n ---&gt; Running in 1e29844961a2\nHelloWorld.go:9:5: cannot find package \"github.com/gorilla/mux\" in any of:\n        /usr/local/go/src/github.com/gorilla/mux (from $GOROOT)\n        /go/src/github.com/gorilla/mux (from $GOPATH)\nThe command '/bin/sh -c go get ./*.go' returned a non-zero code: 1\n</code></pre>\n"}, {"tags": ["go", "struct", "interface", "embedding", "overriding"], "answers": [{"comments": [{"owner": {"reputation": 1235, "user_id": 4470895, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ac18a4e724071d9e029e921786264b97?s=128&d=identicon&r=PG&f=1", "display_name": "HenryTK", "link": "https://stackoverflow.com/users/4470895/henrytk"}, "edited": false, "score": 0, "creation_date": 1514991887, "post_id": 48079876, "comment_id": 83133857, "body": "The reason for me adding <code>PrintViaMethod</code> is me trying to replicate an issue I am getting with mocking an AWS service client like it says <a href=\"https://github.com/aws/aws-sdk-go/blob/master/service/cloudformation/cloudformationiface/interface.go#L17-L56\" rel=\"nofollow noreferrer\">in the documentation</a>. My code seemed too hard to put here so I tried to distill the problem. Perhaps I didn&#39;t do it correctly."}, {"owner": {"reputation": 1235, "user_id": 4470895, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ac18a4e724071d9e029e921786264b97?s=128&d=identicon&r=PG&f=1", "display_name": "HenryTK", "link": "https://stackoverflow.com/users/4470895/henrytk"}, "edited": false, "score": 0, "creation_date": 1514991890, "post_id": 48079876, "comment_id": 83133862, "body": "The problem I have is when I call <code>something.Client.InterfaceMethod()</code> it uses the correct client, but when I call <code>something.Method()</code>, which in turn calls via the client, the client seems to be nil. My theory was I wasn&#39;t overriding the client correctly."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514993636, "post_id": 48079876, "comment_id": 83134950, "body": "There is no overriding in go at all. Why do you try to mock something in this way?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514996687, "post_id": 48079876, "comment_id": 83136727, "body": "This sounds like an XY problem. You&#39;re focused on your solution, rather than the problem. What is the problem to be solved?"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 4, "last_activity_date": 1514991478, "creation_date": 1514991478, "answer_id": 48079876, "question_id": 48079775, "link": "https://stackoverflow.com/questions/48079775/type-composition-overriding-interface-types/48079876#48079876", "title": "Type Composition: overriding interface types", "body": "<blockquote>\n  <p>Why does it print 'PrinterService'? I want it to print 'SomeOtherService'.</p>\n</blockquote>\n\n<p>Because that's what your code says to do.  <code>PrintViaMethod</code> calls <code>s.Client.Print()</code>, and <code>s.Client</code> is a (zero value) instance of <code>PrinterService</code>, which outputs <code>PrinterService</code>.</p>\n\n<p>What you probably want is to call <code>s.Print()</code> in <code>main()</code>. I don't see any reason for your <code>PrintByMethod</code> function at all.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1514992927, "last_edit_date": 1514992927, "creation_date": 1514991741, "answer_id": 48079955, "question_id": 48079775, "link": "https://stackoverflow.com/questions/48079775/type-composition-overriding-interface-types/48079955#48079955", "title": "Type Composition: overriding interface types", "body": "<p>By <code>s.PrintViaMethod()</code>, you are calling the <em>promoted</em> method <code>FakeService.Service.PrintViaMethod()</code>, and the method receiver will be <code>FakeService.Service</code> which is of type <code>Service</code>, and <code>Service.PrintViaMethod()</code> calls <code>Service.Client.Print()</code>, where <code>Service.Client</code> is of type which <code>PrinterService</code>, that's why it prints <code>\"PrinterService\"</code>.</p>\n\n<p>In Go there is <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">embedding</a>, but there is no <a href=\"https://en.wikipedia.org/wiki/Polymorphism_(computer_science)\" rel=\"nofollow noreferrer\">polymorphism</a>. When you embed a type in a struct, methods of the embedded type get promoted and will be part of the method set of the embedder type. But when such a promoted method is called, it will get the <em>embedded value</em> as the receiver, not the embedder.</p>\n\n<p>To achieve what you want, you would have to \"override\" the <code>PrintViaMethod()</code> method by providing your implementation of it for the <code>FakeService</code> type (with <code>FakeService</code> receiver type), and inside it call <code>FakeService.Client.Print()</code>.</p>\n\n<p>By doing so <code>s.PrintViaMethod()</code> will denote the <code>FakeService.PrintViaMethod()</code> method as that will be at the shallowest depth where the <code>PrintViaMethod()</code> exists (and not <code>FakeService.Service.PrintViaMethod()</code>). This is detailed in <a href=\"https://golang.org/ref/spec#Selectors\" rel=\"nofollow noreferrer\">Spec: Selectors</a>.</p>\n\n<p>For example:</p>\n\n<pre><code>func (fs FakeService) PrintViaMethod() {\n    fs.Client.Print()\n}\n</code></pre>\n\n<p>Then the output will be (try it on the <a href=\"https://play.golang.org/p/HtOIfuq24ge\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>SomeOtherService\n</code></pre>\n\n<p>See related questions and answers with more details:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/29390736/go-embedded-struct-call-child-method-instead-parent-method/29390981#29390981\">Go embedded struct call child method instead parent method</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/41819033/does-fragile-base-class-issue-exist-in-go/41827686#41827686\">Does fragile base class issue exist in Go?</a></p>\n"}, {"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1515421675, "creation_date": 1515421675, "answer_id": 48152325, "question_id": 48079775, "link": "https://stackoverflow.com/questions/48079775/type-composition-overriding-interface-types/48152325#48152325", "title": "Type Composition: overriding interface types", "body": "<p>As per <code>Flimzy</code> you are calling print <code>s.Client.Print()</code> which is of type <code>PrinterService</code> implemented as receiver to <code>Print()</code> function printing <code>PrinterService</code>. You can also change type of <code>Client</code> <code>PrinterService</code> in <code>Service</code> struct to <code>Someother service</code></p>\n\n<pre><code>package embedded\n\nimport (\n    \"fmt\"\n)\n\ntype Printer interface {\n    Print()\n}\n\ntype PrinterService struct{}\n\nfunc (ps PrinterService) Print() { fmt.Println(\"PrinterService\") }\n\ntype Service struct {\n    Client SomeOtherService\n}\n\nfunc (s Service) PrintViaMethod() { s.Client.Print() }\n\ntype FakeService struct {\n    Service\n    Client Printer\n}\n\ntype SomeOtherService struct{}\n\nfunc (sos SomeOtherService) Print() { fmt.Println(\"SomeOtherService\") }\n\nfunc Call() {\n    s := FakeService{Client: SomeOtherService{}}\n    s.PrintViaMethod()\n}\n</code></pre>\n"}], "owner": {"reputation": 1235, "user_id": 4470895, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ac18a4e724071d9e029e921786264b97?s=128&d=identicon&r=PG&f=1", "display_name": "HenryTK", "link": "https://stackoverflow.com/users/4470895/henrytk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 2, "accepted_answer_id": 48079955, "answer_count": 3, "score": 3, "last_activity_date": 1515421675, "creation_date": 1514991141, "last_edit_date": 1514992632, "question_id": 48079775, "link": "https://stackoverflow.com/questions/48079775/type-composition-overriding-interface-types", "title": "Type Composition: overriding interface types", "body": "<p>I want to compose a type of another type, but replace one of the fields (which is an interface value) with a fake. The problem I am getting is the underlying field is being used, so I can't seem to override the field.</p>\n\n<p>I've demoed the problem here: <a href=\"https://play.golang.org/p/lHGnyjzIS-Y\" rel=\"nofollow noreferrer\">https://play.golang.org/p/lHGnyjzIS-Y</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Printer interface {\n    Print()\n}\n\ntype PrinterService struct {}\n\nfunc (ps PrinterService) Print() { fmt.Println(\"PrinterService\") }\n\ntype Service struct {\n    Client PrinterService\n}\n\nfunc (s Service) PrintViaMethod() { s.Client.Print() }\n\ntype FakeService struct {\n    Service\n    Client Printer\n}\n\ntype SomeOtherService struct {}\n\nfunc (sos SomeOtherService) Print() { fmt.Println(\"SomeOtherService\") }\n\nfunc main() {\n    s := FakeService{Client: SomeOtherService{}}\n    s.PrintViaMethod()\n}\n</code></pre>\n\n<p>Why does it print <code>\"PrinterService\"</code>? I want it to print <code>\"SomeOtherService\"</code>.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["facebook-graph-api", "go", "oauth-2.0"], "answers": [{"tags": [], "owner": {"reputation": 383, "user_id": 5070241, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/846396272062579/picture?type=large", "display_name": "Eduard Hasanaj", "link": "https://stackoverflow.com/users/5070241/eduard-hasanaj"}, "is_accepted": false, "score": 1, "last_activity_date": 1536951014, "last_edit_date": 1536951014, "creation_date": 1514988344, "answer_id": 48078983, "question_id": 48078002, "link": "https://stackoverflow.com/questions/48078002/golang-oauth-2-facebook-error-code-2500-cannot-specify-an-empty-identifier/48078983#48078983", "title": "Golang oauth 2 facebook error code 2500 (Cannot specify an empty identifier)", "body": "<p>The error is at <code>?id</code></p>\n\n<pre><code>res, err := oauthConf.Client(oauth2.NoContext, token.convertFacebookToken()).Get(\"https://graph.facebook.com/me?id\")\n</code></pre>\n\n<p>I was trying to use it like in facebook graph(it was not throwing any error). I was completely wrong. It should be:</p>\n\n<pre><code>res, err := oauthConf.Client(oauth2.NoContext, token.convertFacebookToken()).Get(\"https://graph.facebook.com/me?fields=id\")\n</code></pre>\n"}], "owner": {"reputation": 383, "user_id": 5070241, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/846396272062579/picture?type=large", "display_name": "Eduard Hasanaj", "link": "https://stackoverflow.com/users/5070241/eduard-hasanaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 446, "favorite_count": 0, "closed_date": 1536953270, "answer_count": 1, "score": 0, "last_activity_date": 1536951034, "creation_date": 1514984697, "question_id": 48078002, "link": "https://stackoverflow.com/questions/48078002/golang-oauth-2-facebook-error-code-2500-cannot-specify-an-empty-identifier", "closed_reason": "Not suitable for this site", "title": "Golang oauth 2 facebook error code 2500 (Cannot specify an empty identifier)", "body": "<p>I am struggling with this error for days. Here are the steps that I followed to obtain the token.</p>\n\n<ol>\n<li>login in client side using facebook sdk</li>\n<li>pass the short lived token to server</li>\n<li>get long lived token</li>\n</ol>\n\n<p>here is the error</p>\n\n<pre><code>{\"error\":{\"message\":\"Cannot specify an empty identifier\",\"type\":\"OAuthException\",\"code\":2500,\"fbtrace_id\":\"BIEldWBZras\"}}\n</code></pre>\n\n<p>Should Client authenticate directly? It looks like the oauth authentication is not established because of error code 2500. I also don't understand this sentence from the error \"Cannot specify an empty identifier\" \nhere is the code so far:</p>\n\n<pre><code>func handleExtendFacebookToken(w http.ResponseWriter, r *http.Request)  {\nw.Header().Add(\"Access-Control-Allow-Origin\", \"*\")\n\nshortLivedToken := r.FormValue(\"token\")\n\ntokenExpiration := time.Now().Local()\n\nresp, err := http.Get(\"https://graph.facebook.com/oauth/access_token?client_id=\" + oauthConf.ClientID + \"&amp;client_secret=\" + oauthConf.ClientSecret +  \"&amp;grant_type=fb_exchange_token&amp;fb_exchange_token=\" +\n    url.QueryEscape(shortLivedToken))\nif err != nil {\n    fmt.Printf(\"Get: %s\\n\", err)\n    return\n}\ndefer resp.Body.Close()\n\nresponse, err := ioutil.ReadAll(resp.Body)\n\nif err != nil {\n    return\n}\n\nvar token FacebookToken;\n\n//fmt.Print(\"response \",string(response))\n\nerr = json.Unmarshal(response, &amp;token)\n\nif err != nil {\n    log.Fatal(\"error\" + err.Error())\n    return\n}\n\n\n//fmt.Println(\"duration \", token.AccessToken)\n\ntokenExpiration = tokenExpiration.Add(time.Duration(token.Expiry) * time.Second)\n\nfmt.Println(tokenExpiration)\n\n/*resp, err = http.Get(\"https://graph.facebook.com/me?id&amp;access_token=\" +\n    url.QueryEscape(token.AccessToken))\nif err != nil {\n    fmt.Printf(\"Get: %s\\n\", err)\n    return\n}\ndefer resp.Body.Close()\n\nresponse, err = ioutil.ReadAll(resp.Body)\nif err != nil {\n    fmt.Printf(\"ReadAll: %s\\n\", err)\n    return\n}\n\n\n//fmt.Println(string(response))\ntoken.userId = string(response)*/\n\ntoken.Expire_Date = tokenExpiration\ntoken.AccessToken = strings.TrimSpace(token.AccessToken)\nres, err := oauthConf.Client(oauth2.NoContext, token.convertFacebookToken()).Get(\"https://graph.facebook.com/me?id\")\n\nif err != nil {\n    fmt.Printf(\"ReadAll: %s\\n\", err)\n    return\n}\n\ndefer res.Body.Close()\n\nresponse, err = ioutil.ReadAll(res.Body)\nif err != nil {\n    fmt.Printf(\"ReadAll: %s\\n\", err)\n    return\n}\n\nfmt.Println(string (response))\ntoken.saveTokenToDB()\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 909, "user_id": 3222918, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/u76JU.jpg?s=128&g=1", "display_name": "krezus", "link": "https://stackoverflow.com/users/3222918/krezus"}, "edited": false, "score": 0, "creation_date": 1514981915, "post_id": 48077142, "comment_id": 83128165, "body": "possible duplicate of <a href=\"https://stackoverflow.com/questions/39507065/enable-cors-in-golang\" title=\"enable cors in golang\">stackoverflow.com/questions/39507065/enable-cors-in-golang</a> ?"}, {"owner": {"reputation": 916, "user_id": 6763074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-NkPGt4saSn4/AAAAAAAAAAI/AAAAAAAAABs/Orsm5ritSTs/photo.jpg?sz=128", "display_name": "Patrick Bucher", "link": "https://stackoverflow.com/users/6763074/patrick-bucher"}, "edited": false, "score": 1, "creation_date": 1514982617, "post_id": 48077142, "comment_id": 83128581, "body": "The front end pages must be served using the CORS headers, as far as I know."}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 909, "user_id": 3222918, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/u76JU.jpg?s=128&g=1", "display_name": "krezus", "link": "https://stackoverflow.com/users/3222918/krezus"}, "edited": false, "score": 0, "creation_date": 1514987833, "post_id": 48077142, "comment_id": 83131496, "body": "@krezus the link you provided is for Mux. And I am using Gin."}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 916, "user_id": 6763074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-NkPGt4saSn4/AAAAAAAAAAI/AAAAAAAAABs/Orsm5ritSTs/photo.jpg?sz=128", "display_name": "Patrick Bucher", "link": "https://stackoverflow.com/users/6763074/patrick-bucher"}, "edited": false, "score": 0, "creation_date": 1514987897, "post_id": 48077142, "comment_id": 83131529, "body": "@PatrickBucher I am providing headers to the request as mentioned above. But it s not working. Do I need to pass something more or else ??"}, {"owner": {"reputation": 12311, "user_id": 2095090, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/3vmqn.jpg?s=128&g=1", "display_name": "Vincent van der Weele", "link": "https://stackoverflow.com/users/2095090/vincent-van-der-weele"}, "edited": false, "score": 2, "creation_date": 1514988114, "post_id": 48077142, "comment_id": 83131646, "body": "I don&#39;t think this is a backend problem. It&#39;s the browser blocking your request before it even arrives at the backend. You should look into angular instead."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514988192, "post_id": 48077142, "comment_id": 83131686, "body": "Are you properly responding to <code>OPTIONS</code> <a href=\"https://developer.mozilla.org/en-US/docs/Glossary/Preflight_request\" rel=\"nofollow noreferrer\">preflight requests</a>?"}, {"owner": {"reputation": 916, "user_id": 6763074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-NkPGt4saSn4/AAAAAAAAAAI/AAAAAAAAABs/Orsm5ritSTs/photo.jpg?sz=128", "display_name": "Patrick Bucher", "link": "https://stackoverflow.com/users/6763074/patrick-bucher"}, "edited": false, "score": 0, "creation_date": 1514988510, "post_id": 48077142, "comment_id": 83131842, "body": "@Amandeepkaur It&#39;s the Angular user interface that needs to be served with your CORS headers, not the Go application. Your Go backend doesn&#39;t care about the same origin policy, it&#39;s your browser!"}], "answers": [{"tags": [], "owner": {"reputation": 114, "user_id": 4792198, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bsCFN.jpg?s=128&g=1", "display_name": "dvaltrick", "link": "https://stackoverflow.com/users/4792198/dvaltrick"}, "is_accepted": false, "score": 0, "last_activity_date": 1515072123, "creation_date": 1515072123, "answer_id": 48096278, "question_id": 48077142, "link": "https://stackoverflow.com/questions/48077142/cross-origin-request-blocked-even-though-primary-domain-is-same/48096278#48096278", "title": "Cross origin request blocked even though primary domain is same", "body": "<p>Try to set the <code>OPTIONS</code> in your router \n<code>router.HandleFunc(\"/\", getModulos).Methods(\"POST\", \"GET\", \"OPTIONS\")</code> </p>\n\n<p>You can put the <code>CONTENT-TYPE</code> too like this <code>w.Header().Set(\"Access-Control-Allow-Headers\", \"Content-Type\")</code></p>\n"}], "owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 828, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1515072123, "creation_date": 1514981484, "last_edit_date": 1514987521, "question_id": 48077142, "link": "https://stackoverflow.com/questions/48077142/cross-origin-request-blocked-even-though-primary-domain-is-same", "title": "Cross origin request blocked even though primary domain is same", "body": "<p>I am working on an application that use image uploading functionality. The application back end is written in Golang where as front end is in Angular4. I am using Gin framework to run http requests in Golang.</p>\n\n<p>Following is the Golang code to upload image:</p>\n\n<pre><code>func UploadFile(c *gin.Context){\n    imageData := make(map[string]interface{})\n    response := ResponseController{}\n\n    /* ------ Get current date ------ */\n    currDate        := time.Now().UTC()\n    yearString      := strconv.Itoa(currDate.Year())\n    monthString     := strconv.Itoa(int(currDate.Month()))\n    dayString       := strconv.Itoa(currDate.Day())\n\n    path := config.UploadBasePath+config.AppFolder+config.UploadsFolder+yearString+\"/\"+monthString+\"/\"+dayString+\"/\"\n\n    /* create temp directory if does not exist */\n    if _, err := os.Stat(path); os.IsNotExist(err) {\n        os.MkdirAll(path, 0755)\n    }\n\n    /* read data from form */\n    file, err := c.FormFile(\"file\")\n    if err != nil {\n        response = ResponseController{\n            config.FailureCode,\n            config.FailureFlag,\n            \"Error while reading image.\",\n            nil,\n        }\n        GetResponse(c, response)\n        return\n    }\n    filePath := path+file.Filename\n    if err := c.SaveUploadedFile(file, filePath); err != nil {\n        response = ResponseController{\n            config.FailureCode,\n            config.FailureFlag,\n            \"Error while uploading image.\",\n            err,\n        }\n        GetResponse(c, response)\n        return\n    }\n    uploadUrl := \"/\"+config.UploadsFolder+yearString+\"/\"+monthString+\"/\"+dayString+\"/\"+file.Filename\n    imageData[\"upload_url\"] = uploadUrl\n\n    response = ResponseController{\n        config.SuccessCode,\n        config.SuccessFlag,\n        \"Image uploaded successfully.\",\n        imageData,\n    }\n    GetResponse(c, response)\n}\n</code></pre>\n\n<p>The front end and back end are on same domain having subdomains also. When request generate from front end. </p>\n\n<p>I have passed following headers in Golang code:</p>\n\n<pre><code>c.Writer.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\nc.Writer.Header().Set(\"Access-Control-Allow-Credentials\", \"true\")\n</code></pre>\n\n<p>Still when I am uploading image, it returns following error in console and image is not getting uploaded:</p>\n\n<p><code>Cross-Origin Request Blocked: The Same Origin Policy disallows reading the remote resource at http://SUBDOMAIN.DOMAIN:8080/api/v1/upload. (Reason: CORS header \u2018Access-Control-Allow-Origin\u2019 does not match \u2018http://[DOMAIN-NAME].com\u2019).</code> </p>\n\n<p>Can anyone guide me what I am missing here. Thanks!</p>\n"}, {"tags": ["http", "curl", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1514983628, "post_id": 48077098, "comment_id": 83129119, "body": "&quot;Is there any way I can get the values without specifically using curl&quot; Why not <code>start:=time.Now(); r, _ := http.Get(&quot;url&quot;); b := []byte{0}, r.Read(b); time.Since(start)</code> If you are interested in TTFB of the Body. For TTFB of Header you have to go deeper, use package net directly."}], "answers": [{"comments": [{"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 0, "creation_date": 1515130360, "post_id": 48077762, "comment_id": 83190832, "body": "Thanks. Is there a way I can set timeout in this http request."}, {"owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "edited": false, "score": 0, "creation_date": 1515132270, "post_id": 48077762, "comment_id": 83191415, "body": "No worries , I found it in the article <a href=\"https://blog.golang.org/http-tracing\" rel=\"nofollow noreferrer\">blog.golang.org/http-tracing</a> under <code>Tracing with http.Client</code>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 26, "last_activity_date": 1524825352, "last_edit_date": 1524825352, "creation_date": 1514983747, "answer_id": 48077762, "question_id": 48077098, "link": "https://stackoverflow.com/questions/48077098/getting-ttfb-time-to-first-byte-value-in-golang/48077762#48077762", "title": "Getting TTFB (time to first byte) value in golang", "body": "<p>There's builtin support for this since Go 1.7. Go 1.7 added HTTP Tracing, read blog post: <a href=\"https://blog.golang.org/http-tracing\" rel=\"noreferrer\">Introducing HTTP Tracing</a></p>\n\n<p>You can specify callback functions which get called at the appropriate phases / points when making an HTTP(S) request. You can specify your callback functions by creating a value of <a href=\"https://golang.org/pkg/net/http/httptrace/#ClientTrace\" rel=\"noreferrer\"><code>httptrace.ClientTrace</code></a>, and \"arm\" it using <a href=\"https://golang.org/pkg/net/http/httptrace/#WithClientTrace\" rel=\"noreferrer\"><code>httptrace.WithClientTrace()</code></a>.</p>\n\n<p>Here's an example function which gets a URL param, and prints the timing of getting it:</p>\n\n<pre><code>func timeGet(url string) {\n    req, _ := http.NewRequest(\"GET\", url, nil)\n\n    var start, connect, dns, tlsHandshake time.Time\n\n    trace := &amp;httptrace.ClientTrace{\n        DNSStart: func(dsi httptrace.DNSStartInfo) { dns = time.Now() },\n        DNSDone: func(ddi httptrace.DNSDoneInfo) {\n            fmt.Printf(\"DNS Done: %v\\n\", time.Since(dns))\n        },\n\n        TLSHandshakeStart: func() { tlsHandshake = time.Now() },\n        TLSHandshakeDone: func(cs tls.ConnectionState, err error) {\n            fmt.Printf(\"TLS Handshake: %v\\n\", time.Since(tlsHandshake))\n        },\n\n        ConnectStart: func(network, addr string) { connect = time.Now() },\n        ConnectDone: func(network, addr string, err error) {\n            fmt.Printf(\"Connect time: %v\\n\", time.Since(connect))\n        },\n\n        GotFirstResponseByte: func() {\n            fmt.Printf(\"Time from start to first byte: %v\\n\", time.Since(start))\n        },\n    }\n\n    req = req.WithContext(httptrace.WithClientTrace(req.Context(), trace))\n    start = time.Now()\n    if _, err := http.DefaultTransport.RoundTrip(req); err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"Total time: %v\\n\", time.Since(start))\n}\n</code></pre>\n\n<p>Example calling it:</p>\n\n<pre><code>timeGet(\"https://google.com\")\n</code></pre>\n\n<p>Example output:</p>\n\n<pre><code>DNS Done: 7.998465ms\nConnect time: 12.677085ms\nTLS Handshake: 128.65394ms\nTime from start to first byte: 176.461087ms\nTotal time: 176.723402ms\n</code></pre>\n\n<p>Also be sure to check out <a href=\"https://github.com/davecheney/httpstat\" rel=\"noreferrer\">github.com/davecheney/httpstat</a> which gives you a CLI utility that also uses the <code>httptracing</code> package under the hood.</p>\n"}], "owner": {"reputation": 8720, "user_id": 6149787, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/edf1a61aa50a231d521d940d60928292?s=128&d=identicon&r=PG&f=1", "display_name": "Jagrati", "link": "https://stackoverflow.com/users/6149787/jagrati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4117, "favorite_count": 5, "accepted_answer_id": 48077762, "answer_count": 1, "score": 9, "last_activity_date": 1524825393, "creation_date": 1514981297, "last_edit_date": 1524825393, "question_id": 48077098, "link": "https://stackoverflow.com/questions/48077098/getting-ttfb-time-to-first-byte-value-in-golang", "title": "Getting TTFB (time to first byte) value in golang", "body": "<p>I am trying to get value TTFB and Connect value </p>\n\n<pre><code>    c := exec.Command(\n        \"curl\", \"-w\",\n        \"Connect: %{time_connect} TTFB: %{time_starttransfer} Total time: %{time_total}\",\n        \"-o\",\n        \"/dev/null\",\n        \"http://my.domain/favicon.ico\")\n\n    cID, err := c.Run()\n    fmt.Printf(\"%s\", cID)\n</code></pre>\n\n<p>It prints a sting like </p>\n\n<pre><code>Connect: 0.205 TTFB: 0.353 Total time: 0.354\n</code></pre>\n\n<p>However, I need only the value of <code>TTFB , Connect, Total time</code> value in golang variable.</p>\n\n<p>Also, Is there any way I can get the values without specifically using curl?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 51929, "user_id": 1524450, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BSzDV.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/1524450/michael"}, "edited": false, "score": 2, "creation_date": 1514980188, "post_id": 48076705, "comment_id": 83127229, "body": "By the looks of things, <code>AllErrors</code> is a variable local to <code>ErrorHandle</code> and you&#39;re initializing it to an empty slice each time you enter <code>ErrorHandle</code>."}, {"owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "reply_to_user": {"reputation": 51929, "user_id": 1524450, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BSzDV.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/1524450/michael"}, "edited": false, "score": 0, "creation_date": 1514997394, "post_id": 48076705, "comment_id": 83137148, "body": "@Michael i used <code>AllErrors</code> as global variable and its working well but it could be generate unexpected result when multiple user request for same URL, how to fix these issue."}], "answers": [{"comments": [{"owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "edited": false, "score": 0, "creation_date": 1514980544, "post_id": 48076814, "comment_id": 83127440, "body": "Thanks for reply its working but need to append Error Field And Desc as per Error code. suppose in Errors already has one errors with 403 then another error occurred with same error code(403) then i have to add only Error Field and Desc with respect to Error Code."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "edited": false, "score": 1, "creation_date": 1514980661, "post_id": 48076814, "comment_id": 83127508, "body": "Then you can manipulate the existing errors. The overall problem with your code is that you&#39;re returning a new slice every time. You need to modify the existing one instead."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1514982124, "post_id": 48076814, "comment_id": 83128272, "body": "parse the json object into an interface and then get underlying value of that interface to check if error code already exists. By this way you can update your existing slice of error with new error field"}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 2, "last_activity_date": 1514980190, "creation_date": 1514980190, "answer_id": 48076814, "question_id": 48076705, "link": "https://stackoverflow.com/questions/48076705/error-handling-in-golang/48076814#48076814", "title": "Error Handling in golang", "body": "<p>You're always creating a new empty <code>AllErrors</code> slice, adding a single error to it, then returning it.</p>\n\n<p>Your <code>ErrorHandle</code> should either take the existing list of errors and append to it or you should have a custom <code>type Errors []Error</code> used as such:</p>\n\n<pre><code>type Errors []Error\nfunc (Errors *e) ErrorHandle(...) {\n  ...\n  e = append(e, &lt;new error&gt;)\n}\n\nErrors myerrors;\nmyerrors.ErrorHandle(&lt;first error&gt;)\nmyerrors.ErrorHandle(&lt;second error&gt;)\n</code></pre>\n\n<p>This is just high-level code, you should be able to fill in the rest.</p>\n"}], "owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 461, "favorite_count": 0, "accepted_answer_id": 48076814, "answer_count": 1, "score": 0, "last_activity_date": 1514991110, "creation_date": 1514979762, "last_edit_date": 1514991110, "question_id": 48076705, "link": "https://stackoverflow.com/questions/48076705/error-handling-in-golang", "title": "Error Handling in golang", "body": "<p>I need to handle errors with error code and return errors in JSON format like below.</p>\n\n<pre><code>{\n    \"errorCode\":400,\n    \"errors\":[\n        {\n            \"errorField\":\"dispachNumber\",\n            \"errorDescription\": \"This is not a valid dispatch Number\"\n        },\n        {\n            \"errorField\":\"phone\",\n            \"errorDescription\": \"Phone numbers must be in the XXX-XXX-XXXX format\"\n        }\n    ]\n}\n\n{\n    \"errorCode\":500,\n    \"errors\":[\n        {\n            \"errorDescription\": \"there was an internal server error\"\n        }\n    ]\n}\n</code></pre>\n\n<p>My problem is how to handle this way , here i am able to do with single error only but when i do with multiple errors it return only one error struct , see code how i am doing this.</p>\n\n<pre><code>Errors := ErrorHandle(403, \"User Id\", \"User Id must be of integer type\")\nErrors = ErrorHandle(403, \"Phone Number\", \"Phone Number type\")\n</code></pre>\n\n<p>and <code>ErrorHandle()</code> function as </p>\n\n<pre><code>func ErrorHandle(ErrorCode int, ErrorFields, ErrorDesc string) []Errors {\n    AllErrors := []Errors{}\n\n    if len(AllErrors) &gt; 0 {\n        AllErrors = IterateErrors(AllErrors, ErrorCode, ErrorFields, ErrorDesc)\n    } else {\n        Errorsvalue := Errors{\n            ErrorCode: ErrorCode,\n        }\n        Error := Error{}\n        Error.ErrorFields = ErrorFields\n        Error.ErrorDescription = ErrorDesc\n        Errorsvalue.ErrorDesc = append(Errorsvalue.ErrorDesc, Error)\n\n        AllErrors = append(AllErrors, Errorsvalue)\n    }\n    return AllErrors\n}\n</code></pre>\n\n<p>Thanks in Advance !</p>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 2, "creation_date": 1514972702, "post_id": 48074329, "comment_id": 83123151, "body": "If your question about code-refactoring <a href=\"http://codereview.stackexchange.com\">codereview.stackexchange.com</a> is a better place for it, otherwise rephrase your question."}], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": false, "score": -1, "last_activity_date": 1514976589, "creation_date": 1514976589, "answer_id": 48075878, "question_id": 48074329, "link": "https://stackoverflow.com/questions/48074329/best-solution-for-execution-sql-file-by-golang-gorm-lib/48075878#48075878", "title": "Best solution for execution sql file by golang gorm lib", "body": "<p>When executing a SQL file full of statements, the existing sql command-line clients do not just send the file contents over to the server. Instead, they parse the file and issue individual statements.</p>\n\n<p>If you want to replicate this functionality, you will need to parse the file yourself into individual statements and execute them.</p>\n\n<p>The easiest way is to invoke an external command-line client.\nFor example for postgresql you should <a href=\"https://golang.org/pkg/os/exec/\" rel=\"nofollow noreferrer\">exec</a> something like <code>psql [connection args] -f &lt;sql file&gt;</code>.</p>\n"}], "owner": {"reputation": 11, "user_id": 9167328, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ESRlnewNj9g/AAAAAAAAAAI/AAAAAAAAAGU/85SSgKIZKys/photo.jpg?sz=128", "display_name": "Sergey Kulesh", "link": "https://stackoverflow.com/users/9167328/sergey-kulesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1126, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1527757013, "creation_date": 1514970794, "last_edit_date": 1527757013, "question_id": 48074329, "link": "https://stackoverflow.com/questions/48074329/best-solution-for-execution-sql-file-by-golang-gorm-lib", "title": "Best solution for execution sql file by golang gorm lib", "body": "<p>Mabye someone have more simple code for execution sql file by gorm lib?</p>\n\n<pre><code>// CARRIERS IMPORT\nerr := DB.Session.Model(model.Carriers{}).Count(&amp;carriers).Error\nif err != nil {\n    panic(err)\n} else if carriers == 0 {\n    path, err := filepath.Abs(\"./dumps/carriers.sql\")\n    if err != nil {\n        panic(err)\n    }\n    file, err := ioutil.ReadFile(path)\n    if err != nil {\n        panic(err)\n    }\n    DB.Session.Model(model.Carriers{}).Exec(string(file))\n}\n</code></pre>\n"}, {"tags": ["ssl", "go", "https", "tls1.2"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 2, "creation_date": 1514972130, "post_id": 48074154, "comment_id": 83122841, "body": "This seems to be a known problem with go&#39;s TLS library talking to some servers. <a href=\"https://github.com/golang/go/issues/8549\" rel=\"nofollow noreferrer\">A patch</a> was sent back in the days of go 1.4 to make the <code>certificateStatusMsg</code> optional, but it never got merged. The patch seems to implement RFC4366 more accurately, so I&#39;m not sure why it was not integrated."}, {"owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "edited": false, "score": 0, "creation_date": 1514972288, "post_id": 48074154, "comment_id": 83122910, "body": "interesting, what go version are you using ?"}, {"owner": {"reputation": 189, "user_id": 2073897, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Kz8hU.jpg?s=128&g=1", "display_name": "greenkey", "link": "https://stackoverflow.com/users/2073897/greenkey"}, "reply_to_user": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "edited": false, "score": 0, "creation_date": 1514972369, "post_id": 48074154, "comment_id": 83122962, "body": "@GujaratSantana I tried with 1.4 and 1.8, same behaviour."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 2, "creation_date": 1514972504, "post_id": 48074154, "comment_id": 83123036, "body": "There is no version that fixes this, the patch was never merged: <a href=\"https://golang.org/src/crypto/tls/handshake_client.go#L336\" rel=\"nofollow noreferrer\">here</a> is the relevant section from the client handshake code. Go requires a <code>certificateStatusMsg</code> when the RFC says &quot;The server MAY return a &quot;certificate_status&quot; message.&quot;"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1514972584, "post_id": 48074154, "comment_id": 83123075, "body": "@greenkey: the patch linked above &quot;should work&quot;, but I realize patching go is a bit annoying."}, {"owner": {"reputation": 189, "user_id": 2073897, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Kz8hU.jpg?s=128&g=1", "display_name": "greenkey", "link": "https://stackoverflow.com/users/2073897/greenkey"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1514973181, "post_id": 48074154, "comment_id": 83123439, "body": "@Marc thanks, I&#39;ll try"}], "answers": [{"comments": [{"owner": {"reputation": 739, "user_id": 634236, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/446db9307c9bf2ff186dd104f4493d86?s=128&d=identicon&r=PG", "display_name": "Justin", "link": "https://stackoverflow.com/users/634236/justin"}, "edited": false, "score": 0, "creation_date": 1516907783, "post_id": 48075208, "comment_id": 83893466, "body": "Where does OptionalCertificateStatus.patch come from? Also where does ./all.bash come from? It looks like go1.10rc1 has the fix so I&#39;m trying to apply that to 1.9.3. I guess I&#39;ll just compile it and run it separate from 1.9.3"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 739, "user_id": 634236, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/446db9307c9bf2ff186dd104f4493d86?s=128&d=identicon&r=PG", "display_name": "Justin", "link": "https://stackoverflow.com/users/634236/justin"}, "edited": false, "score": 0, "creation_date": 1516950824, "post_id": 48075208, "comment_id": 83906711, "body": "The patch comes from either the github issue linked at the beginning of my answer, or from the go-review link in the update. all.bash is part of the go source tarball."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": false, "score": 5, "last_activity_date": 1515102398, "last_edit_date": 1515102398, "creation_date": 1514974048, "answer_id": 48075208, "question_id": 48074154, "link": "https://stackoverflow.com/questions/48074154/received-unexpected-handshake-message-of-type-tls-serverkeyexchangemsg-when-wai/48075208#48075208", "title": "received unexpected handshake message of type *tls.serverKeyExchangeMsg when waiting for *tls.certificateStatusMsg", "body": "<p>This is a bug in Go's TLS handshake handling. There is a patch that was sent in around go 1.4: <a href=\"https://github.com/golang/go/issues/8549\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/8549</a>.\nHowever, it has not been applied as of 1.9.2.</p>\n\n<p>The patch itself clearly shows that it's a mistake in Go's implementation:</p>\n\n<pre><code>// RFC4366 on Certificate Status Request:       \n// The server MAY return a \"certificate_status\" message.\n</code></pre>\n\n<p>Whereas the go TLS client was basically implementing \"The server MUST return ...\".</p>\n\n<p>We can reproduce the problem with a smaller example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"os\"\n)\n\nfunc main() {\n    _, err := http.Get(os.Args[1])\n    fmt.Println(err)\n}\n</code></pre>\n\n<p>And running: </p>\n\n<pre><code>$ go run foo.go https://jobs-eu.hudson.com\nGet https://jobs-eu.hudson.com: tls: received unexpected handshake message of type *tls.serverKeyExchangeMsg when waiting for *tls.certificateStatusMsg\n</code></pre>\n\n<p>Applying the above patch to the <a href=\"https://golang.org/dl/#stable\" rel=\"nofollow noreferrer\">go 1.9.2</a> source and rebuilding now yields the correct functionality:</p>\n\n<pre><code>~/tmp$ GOROOT=${HOME}/tmp/go go/bin/go run foo.go https://jobs-eu.hudson.com\n&lt;nil&gt;\n</code></pre>\n\n<p>To patch Go, I did the following: (but you may want to follow the <a href=\"https://golang.org/doc/install/source\" rel=\"nofollow noreferrer\">install from source</a> instructions, they're more thorough)</p>\n\n<ul>\n<li>download the <a href=\"https://golang.org/dl/#stable\" rel=\"nofollow noreferrer\">go 1.9.2 source tarball</a></li>\n<li>extract it to <code>~/tmp/go</code></li>\n<li>apply the patch: <code>~/tmp/go$ patch -p1 &lt; /tmp/OptionalCertificateStatus.patch</code></li>\n<li>rebuild: <code>~/tmp/go$ GOROOT_BOOTSTRAP=&lt;my previous go install&gt; ./all.bash</code></li>\n<li>run as mentioned above</li>\n</ul>\n\n<p>I've pinged the <a href=\"https://github.com/golang/go/issues/8549\" rel=\"nofollow noreferrer\">patch issue</a>, I'm curious to know why this patch hasn't been picked.</p>\n\n<p><strong>Update</strong>: patch is <a href=\"https://go-review.googlesource.com/c/go/+/86115\" rel=\"nofollow noreferrer\">now merged</a>. 1.11 is probably the earliest release to have it (I'm guessing based on the fact that 1.10 is already in beta).</p>\n"}], "owner": {"reputation": 189, "user_id": 2073897, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Kz8hU.jpg?s=128&g=1", "display_name": "greenkey", "link": "https://stackoverflow.com/users/2073897/greenkey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1079, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1515102398, "creation_date": 1514970108, "question_id": 48074154, "link": "https://stackoverflow.com/questions/48074154/received-unexpected-handshake-message-of-type-tls-serverkeyexchangemsg-when-wai", "title": "received unexpected handshake message of type *tls.serverKeyExchangeMsg when waiting for *tls.certificateStatusMsg", "body": "<p>I need to check some website for updates, my script is working for all the sites I tried except one.</p>\n\n<p>I'm pretty sure it's something related to TLS/SSL but I didn't find any useful information about the error.</p>\n\n<p>Here is the script:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"fmt\"\n    \"os\"\n    \"crypto/tls\"\n)\n\nfunc main(){\n\n    client := &amp;http.Client{\n        Transport: &amp;http.Transport{\n            DisableKeepAlives:   false,\n            MaxIdleConnsPerHost: 10,\n            TLSClientConfig: &amp;tls.Config{\n                InsecureSkipVerify: true,\n            },\n        },\n    }\n\n    fmt.Println(client)\n\n    req, _ := http.NewRequest(\"GET\", os.Args[1], nil)\n\n    _, err := client.Do(req)\n    if err != nil {\n        fmt.Println(\"Something bad happened: \", err)\n    }\n\n}\n</code></pre>\n\n<p>And here is the output:</p>\n\n<pre><code>[root@74dfbb491710 wd]# go run ssl.go https://google.com\n&amp;{0xc4200ce000 &lt;nil&gt; &lt;nil&gt; 0s}\n[root@74dfbb491710 wd]# go run ssl.go https://jobs-eu.hudson.com\n&amp;{0xc4200e4000 &lt;nil&gt; &lt;nil&gt; 0s}\nSomething bad happened:  Get https://jobs-eu.hudson.com: tls: received unexpected handshake message of type *tls.serverKeyExchangeMsg when waiting for *tls.certificateStatusMsg\n</code></pre>\n\n<p>Do I need to add some code to handle the handshake? Why the website is sending me that unexpected message?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1514960948, "post_id": 48072236, "comment_id": 83118082, "body": "Read the directory, select the files wich match the desired pattern and Remove them. No library but some programming."}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 2, "creation_date": 1514961897, "post_id": 48072236, "comment_id": 83118478, "body": "Or something with <a href=\"https://golang.org/pkg/path/filepath/#Glob\" rel=\"nofollow noreferrer\"><code>filepath.Glob</code></a>."}, {"owner": {"reputation": 916, "user_id": 6763074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-NkPGt4saSn4/AAAAAAAAAAI/AAAAAAAAABs/Orsm5ritSTs/photo.jpg?sz=128", "display_name": "Patrick Bucher", "link": "https://stackoverflow.com/users/6763074/patrick-bucher"}, "edited": false, "score": 1, "creation_date": 1514964399, "post_id": 48072236, "comment_id": 83119458, "body": "The wildcard <code>*</code> is a feature of the shell, not one of the file system. So you have to go through the list of files and test their names against a pattern. The <code>regexp</code> package can deal with complicated patterns, however <code>strings.HasPrefix(str, prefix)</code> can do the task at hand quite well."}], "answers": [{"tags": [], "owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "is_accepted": true, "score": 22, "last_activity_date": 1514968012, "creation_date": 1514968012, "answer_id": 48073701, "question_id": 48072236, "link": "https://stackoverflow.com/questions/48072236/remove-files-with-wildcard/48073701#48073701", "title": "Remove files with wildcard", "body": "<p>As people mentioned wildcard is a feature of shell (e.g. Windows <code>cmd.exe</code>) not OS and usually programming languages don't provide equivalent of <code>del xyz*</code>. You should use <code>Glob</code> function to find files you want to delete.</p>\n\n<pre><code>files, err := filepath.Glob(\"/foo/123_*\")\nif err != nil {\n    panic(err)\n}\nfor _, f := range files {\n    if err := os.Remove(f); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1568, "user_id": 5865556, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/nSrTp.png?s=128&g=1", "display_name": "sungyong", "link": "https://stackoverflow.com/users/5865556/sungyong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5885, "favorite_count": 1, "accepted_answer_id": 48073701, "answer_count": 1, "score": 6, "last_activity_date": 1514968012, "creation_date": 1514960759, "last_edit_date": 1514966773, "question_id": 48072236, "link": "https://stackoverflow.com/questions/48072236/remove-files-with-wildcard", "title": "Remove files with wildcard", "body": "<p>I am trying to delete files with a wildcard like shell scripts like:</p>\n\n<p><strong><code>c:\\del 123_*</code></strong></p>\n\n<p>My trial as below was failed.  </p>\n\n<pre><code>os.RemoveAll(\"/foo/123_*\")\nos.Remove(\"/foo/123_*\")\n</code></pre>\n\n<p>I guess I need to use some library to use a wildcard.<br>\nWhat is good practice for deleting files with a wildcard?</p>\n"}, {"tags": ["go", "protocol-buffers"], "answers": [{"tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": false, "score": 2, "last_activity_date": 1514947801, "last_edit_date": 1592644375, "creation_date": 1514947801, "answer_id": 48070533, "question_id": 48070485, "link": "https://stackoverflow.com/questions/48070485/how-to-ask-protoc-to-use-a-value-instead-of-a-pointer-as-the-value-side-of-a-map/48070533#48070533", "title": "How to ask protoc to use a value instead of a pointer as the value side of a map with Go?", "body": "<p>If you use <a href=\"https://godoc.org/github.com/gogo/protobuf/gogoproto\" rel=\"nofollow noreferrer\">gogoprotobuf</a> then there is an extension that will allow that</p>\n<pre><code>map&lt;string, albums&gt; artists_albums = 1 [(gogoproto.nullable) = false];\n</code></pre>\n<p>With regular goprotobuf I don't believe there is a way.</p>\n<blockquote>\n<p>nullable, if false, a field is generated without a pointer (see warning below).</p>\n<p>Warning about nullable: According to the Protocol\nBuffer specification, you should be able to tell whether a field is\nset or unset. With the option nullable=false this feature is lost,\nsince your non-nullable fields will always be set. It can be seen as a\nlayer on top of Protocol Buffers, where before and after marshalling\nall non-nullable fields are set and they cannot be unset.</p>\n</blockquote>\n"}], "owner": {"reputation": 15752, "user_id": 16998, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/PstY2.jpg?s=128&g=1", "display_name": "jrwren", "link": "https://stackoverflow.com/users/16998/jrwren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1514947801, "creation_date": 1514947283, "question_id": 48070485, "link": "https://stackoverflow.com/questions/48070485/how-to-ask-protoc-to-use-a-value-instead-of-a-pointer-as-the-value-side-of-a-map", "title": "How to ask protoc to use a value instead of a pointer as the value side of a map with Go?", "body": "<p>I am using protocol buffers defined like this:</p>\n\n<pre><code>message Index {\n     message albums {\n         repeated string name = 1;\n     }\n     map&lt;string, albums&gt; artists_albums= 1;\n     map&lt;int32, albums&gt; year_albums = 2;\n}\n</code></pre>\n\n<p>It generates go code like this:</p>\n\n<pre><code>type Index struct {\n    ArtistsAlbums map[string]*IndexAlbums\n    YearAlbums     map[int32]*IndexAlbums\n }\n</code></pre>\n\n<p>How can I make it generate map values of type <code>IndexAlbums</code> instead of <code>*IndexAlbums</code>?</p>\n"}, {"tags": ["json", "go", "error-handling"], "comments": [{"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1514925905, "post_id": 48067498, "comment_id": 83108678, "body": "Where is a &quot;response&quot; sent in your example code?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6216224"}, "reply_to_user": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1514926012, "post_id": 48067498, "comment_id": 83108722, "body": "It&#39;s send to a<code>http.ResponseWriter</code>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514966951, "post_id": 48067498, "comment_id": 83120505, "body": "Please use <code>gofmt</code>. Your code is very difficult to read."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514967002, "post_id": 48067498, "comment_id": 83120533, "body": "For an anonymous struct only to be JSON-encoded, a <code>map[string]interface{}</code> would be a more natural data type to use."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 9, "last_activity_date": 1514929181, "last_edit_date": 1514929181, "creation_date": 1514926062, "answer_id": 48067639, "question_id": 48067498, "link": "https://stackoverflow.com/questions/48067498/distinguish-between-json-and-other-errors/48067639#48067639", "title": "Distinguish between JSON and other errors", "body": "<p>The <code>encoding/json</code> package defines the error types it will return. For encoding you have <a href=\"https://golang.org/pkg/encoding/json/#MarshalerError\" rel=\"noreferrer\"><code>MarshalerError</code></a>,\n <a href=\"https://golang.org/pkg/encoding/json/#UnsupportedTypeError\" rel=\"noreferrer\"><code>UnsupportedTypeError</code></a>,\n and <a href=\"https://golang.org/pkg/encoding/json/#UnsupportedValueError\" rel=\"noreferrer\"><code>UnsupportedValueError</code></a>.</p>\n\n<p>You can inspect if the error type returned by <code>Encode</code> is one of these 3.</p>\n\n<p>If the responses are not huge and don't rely on sending multiple json values per the <code>json.Encoder</code> protocol, you can simply use <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"noreferrer\"><code>json.Marshal</code></a> and write the response separately. </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6216224"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1514929181, "creation_date": 1514925309, "question_id": 48067498, "link": "https://stackoverflow.com/questions/48067498/distinguish-between-json-and-other-errors", "title": "Distinguish between JSON and other errors", "body": "<pre><code>enc := json.NewEncoder(w)\nerr := enc.Encode(struct {\n    Method    string        `json:\"method\"`\n    Results   []interface{} `json:\"results\"`\n    CacheTime int           `json:\"cache_time\"`\n}{Method: answerInlineQueryMethod, Results: results, CacheTime: 0})\nif err != nil {\n    log.Printf(\"failed to answer to inline query: %s\", err)\n}\n</code></pre>\n\n<p>How can I distinguish between JSON errors, which should cause a panic and errors caused by sending the response, which should be logged?</p>\n"}, {"tags": ["arrays", "go", "cryptography"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1514924421, "post_id": 48067303, "comment_id": 83108000, "body": "The &quot;nice solution&quot; is the final solution. The others don&#39;t work for exactly the reasons given in the error message - slices and bytes aren&#39;t interchangeable, and you can&#39;t take a slice of an unaddressable value like a function return value; you have to put it in an addressable value, i.e. a variable."}, {"owner": {"reputation": 916, "user_id": 6763074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-NkPGt4saSn4/AAAAAAAAAAI/AAAAAAAAABs/Orsm5ritSTs/photo.jpg?sz=128", "display_name": "Patrick Bucher", "link": "https://stackoverflow.com/users/6763074/patrick-bucher"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514924486, "post_id": 48067303, "comment_id": 83108044, "body": "So the secret is not getting the address from the return value, but to store the result in the function context? EDIT: Is it not about the syntax but about memory management?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514924592, "post_id": 48067303, "comment_id": 83108100, "body": "Not exactly. Slicing an array requires getting a reference (address) to the array internally."}, {"owner": {"reputation": 916, "user_id": 6763074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-NkPGt4saSn4/AAAAAAAAAAI/AAAAAAAAABs/Orsm5ritSTs/photo.jpg?sz=128", "display_name": "Patrick Bucher", "link": "https://stackoverflow.com/users/6763074/patrick-bucher"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514924679, "post_id": 48067303, "comment_id": 83108135, "body": "@Adrian: This is what I tried to do in the third attempt. Is the syntax wrong  or is there just no syntax for doing what I&#39;m trying to achieve?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514924756, "post_id": 48067303, "comment_id": 83108163, "body": "No, that&#39;s not at all what you&#39;re trying to do in the third attempt. It doesn&#39;t work because you&#39;re still trying to take the address of a return value, which you can&#39;t, and you don&#39;t need to slice a pointer to an array - the <i>slice operation itself</i> has to be able to address the array <i>internally</i>. A slice is just a <i>pointer to an array</i> and start/end indices."}, {"owner": {"reputation": 916, "user_id": 6763074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-NkPGt4saSn4/AAAAAAAAAAI/AAAAAAAAABs/Orsm5ritSTs/photo.jpg?sz=128", "display_name": "Patrick Bucher", "link": "https://stackoverflow.com/users/6763074/patrick-bucher"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514924957, "post_id": 48067303, "comment_id": 83108246, "body": "That&#39;s what I <i>wanted</i> to do, which seems to be impossible technically. So is it important to <i>store</i> the return value so that I can slice it? What&#39;s the underlying difference? I see that there <i>is</i> a difference between attempt three and four, I just don&#39;t understand <i>why</i> this is the case."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1514924998, "post_id": 48067303, "comment_id": 83108269, "body": "Yes, you have to store the value before you can slice it or get a pointer to it. Until you store it, there is no address to get."}, {"owner": {"reputation": 916, "user_id": 6763074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-NkPGt4saSn4/AAAAAAAAAAI/AAAAAAAAABs/Orsm5ritSTs/photo.jpg?sz=128", "display_name": "Patrick Bucher", "link": "https://stackoverflow.com/users/6763074/patrick-bucher"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514925078, "post_id": 48067303, "comment_id": 83108300, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/162374/discussion-between-patrick-bucher-and-adrian\">continue this discussion in chat</a>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1514967073, "post_id": 48067303, "comment_id": 83120558, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/28886616/convert-array-to-slice-in-go\">Convert array to slice in Go</a>"}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 1, "last_activity_date": 1514932125, "last_edit_date": 1514932125, "creation_date": 1514931056, "answer_id": 48068535, "question_id": 48067303, "link": "https://stackoverflow.com/questions/48067303/function-should-return-sha256-sha384-sha512-result-as-byte-slice/48068535#48068535", "title": "Function should return sha256/sha384/sha512 result as byte slice", "body": "<p>Importantly, note that the signature for the <a href=\"https://golang.org/pkg/crypto/sha256/#Sum256\" rel=\"nofollow noreferrer\"><code>sha256.Sum256</code> function</a> (and the other SHA functions) returns an <em>array</em>, which is a different type entirely from a <em>slice</em>. This article explains the difference clearly: <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">Go Slices: usage and internals</a>.</p>\n\n<p>To illustrate, consider the following:</p>\n\n<pre><code>x := [3]int{1, 2, 3} // x has type [3]int\ny := []int(x) // ERROR: cannot convert x (type [3]int) to type []int\n</code></pre>\n\n<p>Here's why each of your attempts does not work:</p>\n\n<ol>\n<li><p>The <code>shaSum</code> function returns a tuple of <code>([]byte, error)</code> but each return statement attempts to return <code>([Size]byte, error)</code>, so the compiler complains about the mismatched types.</p></li>\n<li><p>Each <code>sha*.Sum*</code> function returns a <code>([Size]byte, error)</code> tuple; you cannot use the <code>[:]</code> operator on a such a tuple, only on <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow noreferrer\">arrays and slices</a>.</p></li>\n<li><p>Similar to #2 above, you can only use the <code>&amp;</code> operator on <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">addressable types</a>, which does not include function calls (or the values they return, until they are stored locally).</p></li>\n<li><p>This working example is idiomatic go. The language designers deliberately chose to optimize for clarity to readers rather than shorthand for writers.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1514939675, "last_edit_date": 1514939675, "creation_date": 1514932185, "answer_id": 48068731, "question_id": 48067303, "link": "https://stackoverflow.com/questions/48067303/function-should-return-sha256-sha384-sha512-result-as-byte-slice/48068731#48068731", "title": "Function should return sha256/sha384/sha512 result as byte slice", "body": "<p>The language specification <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow noreferrer\">states this about the slice operator</a>:</p>\n\n<blockquote>\n  <p>If the sliced operand is an array, it must be addressable and the result of the slice operation is a slice with the same element type as the array.</p>\n</blockquote>\n\n<p>and <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">this about addressability</a>:</p>\n\n<blockquote>\n  <p>The operand must be addressable, that is, either a variable, pointer indirection, or slice indexing operation; or a field selector of an addressable struct operand; or an array indexing operation of an addressable array. </p>\n</blockquote>\n\n<p>It follows from this that the fourth attempt is the only one that works.</p>\n\n<p>Here's an alternative approach using the  <a href=\"https://godoc.org/hash\" rel=\"nofollow noreferrer\">hash.Hash</a> interface.</p>\n\n<pre><code>var hashFactory = map[int]func() hash.Hash{\n    256: sha256.New,\n    384: sha512.New384,\n    512: sha512.New,\n}\n\nfunc shaSum(data string, size int) ([]byte, error) {\n    f := hashFactory[size]\n    if f == nil {\n        return nil, errors.New(\"unsupported sha size\")\n    }\n    h := f()\n    io.WriteString(h, data)\n    return h.Sum(nil), nil\n}\n</code></pre>\n"}], "owner": {"reputation": 916, "user_id": 6763074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-NkPGt4saSn4/AAAAAAAAAAI/AAAAAAAAABs/Orsm5ritSTs/photo.jpg?sz=128", "display_name": "Patrick Bucher", "link": "https://stackoverflow.com/users/6763074/patrick-bucher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1218, "favorite_count": 0, "accepted_answer_id": 48068731, "answer_count": 2, "score": 0, "last_activity_date": 1514969845, "creation_date": 1514924301, "last_edit_date": 1514969845, "question_id": 48067303, "link": "https://stackoverflow.com/questions/48067303/function-should-return-sha256-sha384-sha512-result-as-byte-slice", "title": "Function should return sha256/sha384/sha512 result as byte slice", "body": "<p>I'm writing a function that takes input data as a string and the bit size of the SHA algorithm to be called. It should return the resulting hash as a byte slice (first attempt):</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/sha256\"\n    \"crypto/sha512\"\n    \"errors\"\n    \"fmt\"\n)\n\nfunc main() {\n    input := \"This is a test.\"\n    sha256, _ := shaSum(input, 256)\n    sha384, _ := shaSum(input, 384)\n    sha512, _ := shaSum(input, 512)\n    fmt.Println(input, sha256, sha384, sha512)\n}\n\nfunc shaSum(data string, size uint) ([]byte, error) {\n    input := []byte(data)\n    switch size {\n    case 256:\n        return sha256.Sum256(input), nil\n    case 384:\n        return sha512.Sum384(input), nil\n    case 512:\n        return sha512.Sum512(input), nil\n    default:\n        return nil, errors.New(\"unsupported sha size\")\n    }\n}\n</code></pre>\n\n<p>This doesn't work, of course:</p>\n\n<pre><code>$ go run shasum.go\n# command-line-arguments\n./shasum.go:22:23: cannot use sha256.Sum256(input) (type [32]byte) as type []byte in return argument\n./shasum.go:24:23: cannot use sha512.Sum384(input) (type [48]byte) as type []byte in return argument\n./shasum.go:26:23: cannot use sha512.Sum512(input) (type [64]byte) as type []byte in return argument\n</code></pre>\n\n<p>So I'm trying to get a slice from the hash function's return value instead, adding <code>[:]</code> after each call (second attempt):</p>\n\n<pre><code>func shaSum(data string, size uint) ([]byte, error) {\n    input := []byte(data)\n    switch size {\n    case 256:\n        return sha256.Sum256(input)[:], nil\n    case 384:\n        return sha512.Sum384(input)[:], nil\n    case 512:\n        return sha512.Sum512(input)[:], nil\n    default:\n        return nil, errors.New(\"unsupported sha size\")\n    }\n}\n</code></pre>\n\n<p>This doesn't work either:</p>\n\n<pre><code>$ go run shasum.go\n# command-line-arguments\n./shasum.go:22:30: invalid operation sha256.Sum256(input)[:] (slice of unaddressable value)\n./shasum.go:24:30: invalid operation sha512.Sum384(input)[:] (slice of unaddressable value)\n./shasum.go:26:30: invalid operation sha512.Sum512(input)[:] (slice of unaddressable value)\n</code></pre>\n\n<p>So I'm trying to get the address of the return value, using parentheses to ensure that the address of the expression is taken first and then sliced (third attempt):</p>\n\n<pre><code>func shaSum(data string, size uint) ([]byte, error) {\n    input := []byte(data)\n    switch size {\n    case 256:\n        return (&amp;(sha256.Sum256(input)))[:], nil\n    case 384:\n        return (&amp;(sha512.Sum384(input)))[:], nil\n    case 512:\n        return (&amp;(sha512.Sum512(input)))[:], nil\n    default:\n        return nil, errors.New(\"unsupported sha size\")\n    }\n}\n</code></pre>\n\n<p>Which yields this error message:</p>\n\n<pre><code>$ go run shasum.go\n# command-line-arguments\n./shasum.go:22:10: cannot take the address of sha256.Sum256(input)\n./shasum.go:24:10: cannot take the address of sha512.Sum384(input)\n./shasum.go:26:10: cannot take the address of sha512.Sum512(input)\n</code></pre>\n\n<p>So I'm giving up and solve it using extra lines (fourth attempt):</p>\n\n<pre><code>func shaSum(data string, size uint) ([]byte, error) {\n    input := []byte(data)\n    switch size {\n    case 256:\n        bytes := sha256.Sum256(input)\n        return bytes[:], nil\n    case 384:\n        bytes := sha512.Sum384(input)\n        return bytes[:], nil\n    case 512:\n        bytes := sha512.Sum512(input)\n        return bytes[:], nil\n    default:\n        return nil, errors.New(\"unsupported sha size\")\n    }\n}\n</code></pre>\n\n<p>Which finally compiles and runs. Now I'm wondering: why does the fourth attempt work and the others (especially the third attempt) don't? And how would a nice solution look like? Is there a way to avoid those additional lines like in the fourth attempt?</p>\n\n<p><strong>EDIT</strong>: The underlying problem of my question is not how to cast from a byte array to a byte slice, but my lack of understanding of the addressability notion, and on how to express the solution to my problem in idiomatic Go.</p>\n"}, {"tags": ["go", "codeanywhere"], "comments": [{"owner": {"reputation": 2789, "user_id": 539481, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/547216d430260884299bed09f012aeb1?s=128&d=identicon&r=PG", "display_name": "Pawe\u0142 Pra\u017cak", "link": "https://stackoverflow.com/users/539481/pawe%c5%82-pra%c5%bcak"}, "edited": false, "score": 0, "creation_date": 1515005280, "post_id": 48066868, "comment_id": 83141334, "body": "a comment on a down-vote would be appreciated..."}], "answers": [{"tags": [], "owner": {"reputation": 2789, "user_id": 539481, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/547216d430260884299bed09f012aeb1?s=128&d=identicon&r=PG", "display_name": "Pawe\u0142 Pra\u017cak", "link": "https://stackoverflow.com/users/539481/pawe%c5%82-pra%c5%bcak"}, "is_accepted": false, "score": -1, "last_activity_date": 1518024222, "last_edit_date": 1518024222, "creation_date": 1514922120, "answer_id": 48066869, "question_id": 48066868, "link": "https://stackoverflow.com/questions/48066868/how-to-update-golang-on-codeanywhere-com-with-ubuntu/48066869#48066869", "title": "How to update golang on codeanywhere.com with Ubuntu", "body": "<p>Create and new <code>Blank Container</code> with Ubuntu:\n<a href=\"https://i.stack.imgur.com/FeaeV.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/FeaeV.png\" alt=\"enter image description here\"></a></p>\n\n<p>Connect to the container with SSH.</p>\n\n<p>Follow the <a href=\"https://github.com/golang/go/wiki/Ubuntu\" rel=\"nofollow noreferrer\">instructions on the official wiki</a>.</p>\n\n<p>First install the <code>add-apt-repository</code> support:</p>\n\n<pre><code>sudo apt-get update\nsudo apt-get install -y software-properties-common\n</code></pre>\n\n<p>Now install the recent version of golang (refer to the wiki for up to date instructions):</p>\n\n<pre><code>sudo add-apt-repository ppa:gophers/archive\nsudo apt-get update\nsudo apt-get install golang-1.9-go\n</code></pre>\n\n<p>Make sure to put the binary on <code>PATH</code>, e.g.:</p>\n\n<pre><code>sudo ln -s /usr/lib/go-1.9/bin/go /usr/local/bin/go\n</code></pre>\n\n<p>Now the newer version should be available:</p>\n\n<pre><code>$ go version\ngo version go1.9.2 linux/amd64\n</code></pre>\n\n<p>Add <code>$GOPATH</code> pointing to the <code>workspace</code> and add <code>$GOPATH/bin</code> to <code>$PATH</code> in <code>~/.profile</code>:</p>\n\n<pre><code>cat &lt;&lt; EOF &gt;&gt; ~/.profile\nexport GOPATH=\"\\$HOME/workspace\"\nexport PATH=\"\\$GOPATH/bin:\\$PATH\"\nEOF\n</code></pre>\n\n<p>Apply the new <code>~/.profile</code>:</p>\n\n<pre><code>. ~/.profile\n</code></pre>\n\n<p>Also <code>make</code> is missing, if you need it:</p>\n\n<pre><code>sudo apt-get install build-essential\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2789, "user_id": 539481, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/547216d430260884299bed09f012aeb1?s=128&d=identicon&r=PG", "display_name": "Pawe\u0142 Pra\u017cak", "link": "https://stackoverflow.com/users/539481/pawe%c5%82-pra%c5%bcak"}, "edited": false, "score": 0, "creation_date": 1518022358, "post_id": 48550924, "comment_id": 84336170, "body": "<code>$HOME&#47;go</code> resolves to <code>&quot;&#47;home&#47;cabox&#47;go&quot;</code> and it&#39;s the go default"}], "tags": [], "owner": {"reputation": 11, "user_id": 6412260, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-bbV4EQ3FglQ/AAAAAAAAAAI/AAAAAAAABIQ/zHhd65t8Mhc/photo.jpg?sz=128", "display_name": "Dyrg", "link": "https://stackoverflow.com/users/6412260/dyrg"}, "is_accepted": false, "score": 1, "last_activity_date": 1517430589, "creation_date": 1517430589, "answer_id": 48550924, "question_id": 48066868, "link": "https://stackoverflow.com/questions/48066868/how-to-update-golang-on-codeanywhere-com-with-ubuntu/48550924#48550924", "title": "How to update golang on codeanywhere.com with Ubuntu", "body": "<p>(can't comment yet) Just an additional information, the steps in Pawe\u0142 Pra\u017cak's answer work when you run on a Blank Container. If you run them on a Go predefined stack it won't update.</p>\n\n<p>I also recommend to change the GOPATH value to your workspace, running </p>\n\n<pre><code>export GOPATH=$HOME/go\n</code></pre>\n\n<p>Then run <code>go env</code> to check if the values are correctly updated.</p>\n\n<p>Thanks for the answer by the way, Pawe\u0142!</p>\n"}, {"tags": [], "owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "is_accepted": false, "score": 0, "last_activity_date": 1528395870, "creation_date": 1528395870, "answer_id": 50747871, "question_id": 48066868, "link": "https://stackoverflow.com/questions/48066868/how-to-update-golang-on-codeanywhere-com-with-ubuntu/50747871#50747871", "title": "How to update golang on codeanywhere.com with Ubuntu", "body": "<p>You can easily install the latest golang release in the container by using this script:</p>\n\n<pre><code>git clone https://github.com/udhos/update-golang\ncd update-golang\nsudo ./update-golang.sh\n</code></pre>\n\n<p>Full details: <a href=\"https://github.com/udhos/update-golang\" rel=\"nofollow noreferrer\">https://github.com/udhos/update-golang</a></p>\n"}], "owner": {"reputation": 2789, "user_id": 539481, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/547216d430260884299bed09f012aeb1?s=128&d=identicon&r=PG", "display_name": "Pawe\u0142 Pra\u017cak", "link": "https://stackoverflow.com/users/539481/pawe%c5%82-pra%c5%bcak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 698, "favorite_count": 0, "answer_count": 3, "score": -1, "last_activity_date": 1528395870, "creation_date": 1514922120, "last_edit_date": 1515005341, "question_id": 48066868, "link": "https://stackoverflow.com/questions/48066868/how-to-update-golang-on-codeanywhere-com-with-ubuntu", "title": "How to update golang on codeanywhere.com with Ubuntu", "body": "<p>How to update golang on codeanywhere.com with Ubuntu 14.04?</p>\n\n<p>The default container uses the version from Ubuntu repos, instead of golang PPA.</p>\n\n<p>As of writing it's 1.6 and the newest version is 1.9.</p>\n"}, {"tags": ["arrays", "go", "error-handling"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 2, "creation_date": 1514920802, "post_id": 48066518, "comment_id": 83106459, "body": "Actually, you can catch a first index error using<code>defer</code>, but it would be impossible to recover the expression being calculated. Why don&#39;t you use a loop?"}, {"owner": {"reputation": 2186, "user_id": 1647656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0a27a80f0a9800a2fc5935ecf7071eca?s=128&d=identicon&r=PG", "display_name": "Alex Guerra", "link": "https://stackoverflow.com/users/1647656/alex-guerra"}, "edited": false, "score": 1, "creation_date": 1514922657, "post_id": 48066518, "comment_id": 83107206, "body": "IMO make a method that returns the value at [row][col], put the bounds checks in there and return an error or a bool if its not in range. The overhead of this is negligible."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514922879, "post_id": 48066518, "comment_id": 83107307, "body": "Bounds checking is the correct thing to do. Recovering panics incurs more overhead than a simple bounds check."}, {"owner": {"reputation": 4589, "user_id": 5612096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51821186ffde540f4d10b86544ca1a7d?s=128&d=identicon&r=PG", "display_name": "Adirio", "link": "https://stackoverflow.com/users/5612096/adirio"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514965589, "post_id": 48066518, "comment_id": 83119935, "body": "@Adrian Recovering a panic incurs more overhead <b>only during errors</b> while they incur less overhead on successfull lookups as you don&#39;t need to check anything. They still should be negligible unless we are talking about huge arrays."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 4589, "user_id": 5612096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51821186ffde540f4d10b86544ca1a7d?s=128&d=identicon&r=PG", "display_name": "Adirio", "link": "https://stackoverflow.com/users/5612096/adirio"}, "edited": false, "score": 2, "creation_date": 1514973828, "post_id": 48066518, "comment_id": 83123794, "body": "@Adirio I seriously doubt it. Recovering a panic involves a <code>defer</code>, a <code>recover</code> and a comparison between two error (or even type assertion), which is more overhead to me than a boundary check."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514983498, "post_id": 48066518, "comment_id": 83129039, "body": "Registering there recover handler incurs overhead whether or not it&#39;s triggered. This is also a case of favoring a horrible practice (panic as flow control) in order to get a dubious performance benefit that is unlikely to make any meaningful difference in application performance."}, {"owner": {"reputation": 4589, "user_id": 5612096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51821186ffde540f4d10b86544ca1a7d?s=128&d=identicon&r=PG", "display_name": "Adirio", "link": "https://stackoverflow.com/users/5612096/adirio"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514990397, "post_id": 48066518, "comment_id": 83132914, "body": "@leafbebop You guys are right, in this case it is a bigger overhead plus a bad practice (panic as flow control) but in some cases it may be slightly outperforming. I could provide examples but I don&#39;t think they will offer anything new to the OP. Just take into account that the order of execution is: check -&gt; rest of the function vs defer -&gt; rest of the function -&gt; additional overhead so if the rest of the function is on a hurry and the check takes some time even if the total overhead is bigger the rest of the function may be executed before in the panic case."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 4589, "user_id": 5612096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51821186ffde540f4d10b86544ca1a7d?s=128&d=identicon&r=PG", "display_name": "Adirio", "link": "https://stackoverflow.com/users/5612096/adirio"}, "edited": false, "score": 0, "creation_date": 1514992240, "post_id": 48066518, "comment_id": 83134092, "body": "@Adirio I can hardly imagine a situation that you cannot use a <code>else</code> to do the &quot;overhead part&quot; but <code>recover</code> can excluding normal panic handling. Would you please enlighten me?"}, {"owner": {"reputation": 4589, "user_id": 5612096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51821186ffde540f4d10b86544ca1a7d?s=128&d=identicon&r=PG", "display_name": "Adirio", "link": "https://stackoverflow.com/users/5612096/adirio"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1515051647, "post_id": 48066518, "comment_id": 83155759, "body": "@leafbebop Imagine you have to do some promised based execution, where you are actually returning the promise. For example for some sort of communication or BD read/write. You would want to prepare the promise as fast as you can as the bottle neck will be its execution but then you can affor d to do other things while it is getting served."}], "answers": [{"tags": [], "owner": {"reputation": 1759, "user_id": 1512962, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/EfW0L.png?s=128&g=1", "display_name": "Anonymous Penguin", "link": "https://stackoverflow.com/users/1512962/anonymous-penguin"}, "is_accepted": false, "score": 2, "last_activity_date": 1533657106, "last_edit_date": 1533657106, "creation_date": 1515017249, "answer_id": 48085865, "question_id": 48066518, "link": "https://stackoverflow.com/questions/48066518/catching-array-index-error/48085865#48085865", "title": "Catching array index error", "body": "<p><em>What overhead?</em></p>\n\n<p>\"Heavy\" and \"slow\" programs generally work with tens or hundreds of thousands of data points every second. A single if statement quite literally takes a handful of clock cycles out of the billions of clock cycles that your computer goes through every second (1 GHz = 1 billion clock cycles on a single core machine).</p>\n\n<p>If you're worried about <em>bounds checking</em> overhead for (what seems to be) a fairly straightforward program, you shouldn't use Go. You shouldn't even use C++ or C. You should be writing this program directly in assembly and should spend hours fine-tuning each instruction to optimize on the scale of <em>fractions</em> of a nanosecond.</p>\n\n<p>Like @leafbebop stated in the comments, any other pattern will carry significantly more overhead.</p>\n\n<hr>\n\n<p>More generally, unless you go into a situation knowing the need for exceptionally high performance and low latency (such as electronic stock trading systems, gaming, or 3D rendering), it's usually better to build first and optimize later after you have \"profiled\" your code to identify the heavy parts. And unless your function is called millions of times a second, the amount of compute power that it'll use is virtually zero. What makes code slow is iterating over very large data sets, being bottlenecked waiting for the network (if processing thousands of network requests), or using large amounts of memory (in the range of gigabytes).</p>\n\n<p>An if statement does not make a program slow.</p>\n\n<p>Buying faster hardware is almost always cheaper than buying faster software (with more development time). :)</p>\n"}], "owner": {"reputation": 7, "user_id": 5464514, "user_type": "registered", "profile_image": "https://graph.facebook.com/1486323775003884/picture?type=large", "display_name": "Chayce Heiberg", "link": "https://stackoverflow.com/users/5464514/chayce-heiberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1533657106, "creation_date": 1514920331, "question_id": 48066518, "link": "https://stackoverflow.com/questions/48066518/catching-array-index-error", "title": "Catching array index error", "body": "<p>I'm just starting to learn Go, and I implemented an algorithm that checks four consecutive array indexes for an equal value in both diagonal directions, vertical, and horizontal. I designed it so that there is a function for each direction, and I'm wondering if there is a way for me to catch index errors without having to do the overhead to check if each index is in the range of index constraints.</p>\n\n<pre><code>func (state *State) checkTopLeftDiagonal(row, col int) bool {\n    token := state.Board[row][col]\n    b := token == state.Board[row-3][col-3] &amp;&amp; token == state.Board[row-2][col-2] \n                  &amp;&amp; token == state.Board[row-1][col-1]\n    return b\n}\n\nfunc (state *State) CheckWinner(row, col int) bool {\n    for i := 0; i &lt; 4; i++ {\n        if state.checkTopLeftDiagonal(row+i, col+i) == true {\n            return true\n        }\n    }\n    return false\n}\n</code></pre>\n"}, {"tags": ["go", "imagick"], "answers": [{"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1514920099, "post_id": 48066332, "comment_id": 83106172, "body": "OT but I am curious about how did you manage to figure out what version OP is using?"}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1514921013, "post_id": 48066332, "comment_id": 83106550, "body": "@leafbebop I just looked up the version in Ubuntu 14.04 on packages.ubuntu.com."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514921140, "post_id": 48066332, "comment_id": 83106596, "body": "That&#39;s a lesson I missed. Thank you for the insight."}, {"owner": {"reputation": 230, "user_id": 4725089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/883113800d5e499286629ed77d944b5a?s=128&d=identicon&r=PG&f=1", "display_name": "StainlessSteelRat", "link": "https://stackoverflow.com/users/4725089/stainlesssteelrat"}, "edited": false, "score": 0, "creation_date": 1590442590, "post_id": 48066332, "comment_id": 109676451, "body": "Can apt-get be used to get 7 and up?"}], "tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 7, "last_activity_date": 1514919534, "creation_date": 1514919534, "answer_id": 48066332, "question_id": 48066196, "link": "https://stackoverflow.com/questions/48066196/unable-to-import-imagick-package/48066332#48066332", "title": "Unable to import Imagick package", "body": "<p><em>Also</em> as per the documentation, <code>imagick.v3</code> supports ImageMagick version 7 and up. You have ImageMagick version 6.7.7-10. This is too old for imagick v3, and also too old for imagick v2, but v1 may work.</p>\n"}, {"tags": [], "owner": {"reputation": 1914, "user_id": 9811969, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/184e2e46b8d8b8c483c85589709b8563?s=128&d=identicon&r=PG&f=1", "display_name": "Nik", "link": "https://stackoverflow.com/users/9811969/nik"}, "is_accepted": false, "score": 0, "last_activity_date": 1549879065, "last_edit_date": 1549879065, "creation_date": 1549750945, "answer_id": 54611382, "question_id": 48066196, "link": "https://stackoverflow.com/questions/48066196/unable-to-import-imagick-package/54611382#54611382", "title": "Unable to import Imagick package", "body": "<p>I had the same error on Mac OS High Sierra. First, you need to install ImageMagick and then specify the library path.</p>\n\n<ol>\n<li><p>Install ImageMagick: (I used Homebrew)</p>\n\n<pre><code>brew install imagemagick\n</code></pre></li>\n<li><p>Set the <code>PKG_CONFIG_PATH</code> environment variable if ImageMagick is not in your default system path:</p>\n\n<pre><code>export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig\n</code></pre>\n\n<p>from <a href=\"https://www.imagemagick.org/script/magick-wand.php\" rel=\"nofollow noreferrer\">here</a> </p></li>\n<li><p>Go get the package:</p>\n\n<pre><code>go get -u gopkg.in/gographics/imagick.v3/imagick\n</code></pre></li>\n</ol>\n\n<p>To find out more about <code>pkg-config</code>, just type <code>man pkg-config</code></p>\n"}], "owner": {"reputation": 122, "user_id": 7754127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea305091e568094aa593f7566ff070c3?s=128&d=identicon&r=PG&f=1", "display_name": "Sum Truth", "link": "https://stackoverflow.com/users/7754127/sum-truth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 503, "favorite_count": 0, "accepted_answer_id": 48066332, "answer_count": 2, "score": 4, "last_activity_date": 1549879065, "creation_date": 1514918915, "last_edit_date": 1514922691, "question_id": 48066196, "link": "https://stackoverflow.com/questions/48066196/unable-to-import-imagick-package", "title": "Unable to import Imagick package", "body": "<p>I am trying to install the Imagick package for Go. I run the command:</p>\n\n<pre><code>go get gopkg.in/gographics/imagick.v3/imagick\n</code></pre>\n\n<p>As per <a href=\"https://gopkg.in/gographics/imagick.v3/imagick\" rel=\"nofollow noreferrer\">the documentation</a> but I always get this error:</p>\n\n<pre><code># gopkg.in/gographics/imagick.v3/imagick\nsrc/gopkg.in/gographics/imagick.v3/imagick/affine_matrix.go:8:35: fatal error: MagickWand/MagickWand.h: No such file or directory\n #include &lt;MagickWand/MagickWand.h&gt;\n                                   ^\ncompilation terminated.\n</code></pre>\n\n<p>I've looked online but have yet to find a solution that works. I have tried using <code>apt-get libmagickwand-dev</code> and that did not resolve the issue. I am currently running Ubuntu 14.04 LTS.</p>\n"}, {"tags": ["sql", "postgresql", "go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user9163363"}, "edited": false, "score": 6, "creation_date": 1514904794, "post_id": 48062965, "comment_id": 83098901, "body": "I don&#39;t think the execution time of <code>EXPLAIN</code> can be compared to actually executing the query. <code>EXPLAIN</code> only tells you what PostgreSQL <i>would</i> do in case you executed the query."}], "answers": [{"tags": [], "owner": {"reputation": 181, "user_id": 6641598, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c08c68deec6212299e3d318c6bf0d5c?s=128&d=identicon&r=PG&f=1", "display_name": "Matt McCoy", "link": "https://stackoverflow.com/users/6641598/matt-mccoy"}, "is_accepted": true, "score": 2, "last_activity_date": 1514947569, "creation_date": 1514947569, "answer_id": 48070503, "question_id": 48062965, "link": "https://stackoverflow.com/questions/48062965/golang-sql-package-queries-slower-than-postgresql-sql-queries/48070503#48070503", "title": "Golang sql package queries slower than PostgreSQL SQL queries", "body": "<p>This is really comparing apples to oranges. The Go code time represents the time to send the query to PostgreSQL, the time it takes to execute the query in PostgreSQL, and the time it takes for the response to return and be processed. The EXPLAIN command only represents the time it takes to execute the query in PostgreSQL.</p>\n"}], "owner": {"reputation": 833, "user_id": 7498628, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh5.googleusercontent.com/-qMH6F-M2q4U/AAAAAAAAAAI/AAAAAAAAAA0/UpXnAhY-GiY/photo.jpg?sz=128", "display_name": "Shubham Chaudhary", "link": "https://stackoverflow.com/users/7498628/shubham-chaudhary"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 0, "accepted_answer_id": 48070503, "answer_count": 1, "score": -1, "last_activity_date": 1514947569, "creation_date": 1514904264, "question_id": 48062965, "link": "https://stackoverflow.com/questions/48062965/golang-sql-package-queries-slower-than-postgresql-sql-queries", "title": "Golang sql package queries slower than PostgreSQL SQL queries", "body": "<p>I am using Golang SQL package for making calls to my database. I am using prepared statements, and having index on column </p>\n\n<pre><code>stmtHas := db.Prepare(`SELECT value FROM `+tableName+` WHERE key = $1;`)\nnow     := time.Now()\nerr     := db.stmtGet.QueryRow(key).Scan(&amp;value)  \nelapsed := time.Since(now)\nfmt.Println(elapsed)\n</code></pre>\n\n<p>This prints-</p>\n\n<blockquote>\n  <p>40.874782ms</p>\n</blockquote>\n\n<p>However raw SQL query is taking very less time compared to this.</p>\n\n<pre><code>EXPLAIN (ANALYZE, BUFFERS) SELECT value FROM tableName WHERE key = 'some_key';\n</code></pre>\n\n<p>gives- </p>\n\n<blockquote>\n  <p>Planning time: 0.062 ms<br>\n  Execution time: 0.040 ms</p>\n</blockquote>\n\n<p>Is the difference in these time normal? If not, how can I optimize it?</p>\n"}, {"tags": ["go", "command-line-interface", "hashicorp-vault"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1514904879, "post_id": 48062633, "comment_id": 83098950, "body": "Just FYI, hashicorp likes to define test helpers in <code>testing.go</code> as opposed to <code>_test.go</code> files so that the helpers can then be imported and used by other packages. In the case of the <code>aws</code> package, some of its non testing files import the <code>framework</code> package which does have a <code>testing.go</code> file that imports the <code>testing</code> package from the std lib. So, just be ready, when using hashicorp libs, to have your flagspace polluted with the testing flags."}, {"owner": {"reputation": 2130, "user_id": 703814, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4ac2e6b49ee626250ccdc4195d86dd10?s=128&d=identicon&r=PG", "display_name": "Alex Forbes", "link": "https://stackoverflow.com/users/703814/alex-forbes"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514905306, "post_id": 48062633, "comment_id": 83099128, "body": "Thanks, that&#39;s good to know. Looks like using a separate flagspace is the way to go."}], "answers": [{"comments": [{"owner": {"reputation": 2130, "user_id": 703814, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4ac2e6b49ee626250ccdc4195d86dd10?s=128&d=identicon&r=PG", "display_name": "Alex Forbes", "link": "https://stackoverflow.com/users/703814/alex-forbes"}, "edited": false, "score": 0, "creation_date": 1514903770, "post_id": 48062814, "comment_id": 83098360, "body": "Sorry, I perhaps wasn&#39;t clear, this script is to demonstrate the issue, and is not my actual code.I need to use the aws module, and it is correct that it is imported, however I don&#39;t want the flags from the testing module to be in my app."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 3, "last_activity_date": 1514904259, "last_edit_date": 1514904259, "creation_date": 1514903657, "answer_id": 48062814, "question_id": 48062633, "link": "https://stackoverflow.com/questions/48062633/importing-vault-builtin-credential-aws-adds-testing-flags-to-command-line-app/48062814#48062814", "title": "Importing vault/builtin/credential/aws adds testing flags to command-line app", "body": "<p>That is because even though you use <code>_</code> to mask <code>github.com/hashicorp/vault/builtin/credential/aws</code>, the import auctually happened. And the package imported <code>testing</code>, which generate all these flags.</p>\n\n<p>You can get rid of the <code>testing</code> flags by using a new FlagSet.</p>\n\n<pre><code>func main() {\n    f:=flag.NewFlagSet(\"Your app name\",flag.ExitOnError)\n    f.StringVar(\n        &amp;myFlag, \"myFlag\", \"\", \"Test flag\",\n    )\n    f.Parse(os.Args)\n    f.Usage()\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/O8ibPn77L46\" rel=\"nofollow noreferrer\">https://play.golang.org/p/O8ibPn77L46</a></p>\n"}], "owner": {"reputation": 2130, "user_id": 703814, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4ac2e6b49ee626250ccdc4195d86dd10?s=128&d=identicon&r=PG", "display_name": "Alex Forbes", "link": "https://stackoverflow.com/users/703814/alex-forbes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 48062814, "answer_count": 1, "score": 1, "last_activity_date": 1514904259, "creation_date": 1514902845, "last_edit_date": 1514903972, "question_id": 48062633, "link": "https://stackoverflow.com/questions/48062633/importing-vault-builtin-credential-aws-adds-testing-flags-to-command-line-app", "title": "Importing vault/builtin/credential/aws adds testing flags to command-line app", "body": "<p>I'm creating a quick and dirty Go app to pull application secrets from Vault, and authenticating using the Vault code itself. As part of this, I'm importing the aws credential module from <code>github.com/hashicorp/vault/builtin/credential/aws</code>. This is all working well.</p>\n\n<p>However when running my app, I notice that the command line flags from the Go \"testing\" module are appearing in the flags. </p>\n\n<p>This can be reproduced by compiling and running the following example script:</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    _ \"github.com/hashicorp/vault/builtin/credential/aws\"\n    // Note: this import is masked only to make this demo script compile.\n    // In my actual code I need to use it, and it is not masked.\n)\n\nvar myFlag string\n\nfunc main() {\n    flag.StringVar(\n        &amp;myFlag, \"myFlag\", \"\", \"Test flag\",\n    )\n    flag.Parse()\n    flag.Usage()\n}\n</code></pre>\n\n<p>The flags appear like so when calling the binary: </p>\n\n<pre><code>Usage of poc:\n  -myFlag string\n        Test flag\n  -test.bench regexp\n        run only benchmarks matching regexp\n  -test.benchmem\n        print memory allocations for benchmarks\n  -test.benchtime d\n        run each benchmark for duration d (default 1s)\n  -test.blockprofile file\n        write a goroutine blocking profile to file\n  -test.blockprofilerate rate\n        set blocking profile rate (see runtime.SetBlockProfileRate) (default 1)\n  -test.count n\n        run tests and benchmarks n times (default 1)\n  [... more flags from the go testing module ...]\n</code></pre>\n\n<p>I'm a newbie to Go, so it's entirely possible I'm doing something I'm not supposed to here, but at first glance it seems reasonable to import this module for a command-line tool.</p>\n\n<p>As far as I can see, nothing within the module uses the testing library (other than backend_test.go), so I'm a bit confused as to how these flags are appearing, especially as they don't appear in the Vault command line interface itself. </p>\n\n<p>Is it possible to import and use Vault's credential/aws module without including these flags? Or somehow clear the testing flags before defining my own?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 3658, "user_id": 1381745, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/acb5807e26cde875b19995ee6ecb09be?s=128&d=identicon&r=PG", "display_name": "user1381745", "link": "https://stackoverflow.com/users/1381745/user1381745"}, "edited": false, "score": 0, "creation_date": 1514900947, "post_id": 48062181, "comment_id": 83096817, "body": "Good god, I don&#39;t believe it. Thank you, that&#39;s worked. Will accept as soon as the timer&#39;s up."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1514901775, "last_edit_date": 1514901775, "creation_date": 1514900906, "answer_id": 48062181, "question_id": 48062148, "link": "https://stackoverflow.com/questions/48062148/using-timestamps-in-a-find-query-with-mgo/48062181#48062181", "title": "Using timestamps in a find query with mgo", "body": "<p>The solution is simple: don't format your time, just pass a <code>time.Time</code> value:</p>\n\n<pre><code>now := time.Now()\n</code></pre>\n\n<p>The <code>mgo</code> package will encode the time in the appropriate format. In your example you passed the time as a <code>string</code> which would only work if the <code>published</code> field in MongoDB would also be a <code>string</code> in the same format (and not a MongoDB <code>date</code>).</p>\n"}], "owner": {"reputation": 3658, "user_id": 1381745, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/acb5807e26cde875b19995ee6ecb09be?s=128&d=identicon&r=PG", "display_name": "user1381745", "link": "https://stackoverflow.com/users/1381745/user1381745"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 603, "favorite_count": 0, "accepted_answer_id": 48062181, "answer_count": 1, "score": 1, "last_activity_date": 1514975741, "creation_date": 1514900722, "last_edit_date": 1514975741, "question_id": 48062148, "link": "https://stackoverflow.com/questions/48062148/using-timestamps-in-a-find-query-with-mgo", "title": "Using timestamps in a find query with mgo", "body": "<p>I'm trying to run a fairly simple query using MGO that only has one condition included: <code>published</code> field must be less than or equal to the current time.</p>\n\n<p>I have a test document in my database that was created as follows:</p>\n\n<pre><code>db.articles.insert([{\n    \"title\": \"Woo this is a test title\",\n    \"published\": ISODate(\"2017-01-02T12:00:00Z\")\n}])\n</code></pre>\n\n<p>My querying code is:</p>\n\n<pre><code>now := time.Now().Format(time.RFC3339)\narticlesCollection.Find(bson.M{\"published\": bson.M{\"$lte\": now}}).\n     Sort(\"-published\").All(&amp;frontPageArticles.Articles)\n</code></pre>\n\n<p>But I get no records returned.</p>\n\n<p>I'm comfortable with Mongo, but very new to Go (and thus mgo) - I'm sure I'm doing something wrong at a basic level, but am not sure what. Can anyone help?</p>\n"}, {"tags": ["go", "gcloud"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514900225, "post_id": 48061650, "comment_id": 83096471, "body": "Did you also install <code>github.com&#47;davecgh&#47;go-spew&#47;spew</code>? Can you locate it in your <code>vendor</code> folder. Do you have a <code>vendor</code> folder in your project?"}, {"owner": {"reputation": 515, "user_id": 8811309, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/4476b7cc4e5b6bce944fc80edc861729?s=128&d=identicon&r=PG&f=1", "display_name": "awsm sid", "link": "https://stackoverflow.com/users/8811309/awsm-sid"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514957548, "post_id": 48061650, "comment_id": 83117016, "body": "No, I do not have vendor directory in my project. My project is in the directory /home/go/src/bitbucket.org/bigkittylabs.com/uout-go and I have installed &quot;github.com/davecgh/go-spew/spew&quot; in src folder. please help me."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514960227, "post_id": 48061650, "comment_id": 83117824, "body": "I&#39;m not familiar with gcloud but I suspect you need to <i>vendor your dependencies</i>, search the internet for <code>go dep</code> or <code>govendor</code>, or some other go dependency management tool and go from there."}, {"owner": {"reputation": 515, "user_id": 8811309, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/4476b7cc4e5b6bce944fc80edc861729?s=128&d=identicon&r=PG&f=1", "display_name": "awsm sid", "link": "https://stackoverflow.com/users/8811309/awsm-sid"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514969616, "post_id": 48061650, "comment_id": 83121638, "body": "@mkopriva I used govander on running govander init and govendor add +external. Now I have a vendor directory inside my project. But I am still unable to deploy it because I am getting different error  ERROR: (gcloud.app.deploy) Error Response: [9] Deployment contains files that cannot be compiled: Compile failed: 2018/01/03 00:39:14 go-app-builder: Failed parsing input: package &quot;bitbucket.org/bigkittylabs/uout-go/vendor/golang.org/x/oaut&zwnj;&#8203;h2&quot; cannot import internal package &quot;golang.org/x/oauth2/internal&quot;"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514970789, "post_id": 48061650, "comment_id": 83122181, "body": "(<a href=\"https://github.com/kardianos/govendor#package-specifier\" rel=\"nofollow noreferrer\">github.com/kardianos/govendor#package-specifier</a>) Try <code>govendor add golang.org&#47;x&#47;oaut\u200c\u200bh2&#47;^</code>, although I think the internal package should have been vendored automatically..."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514970831, "post_id": 48061650, "comment_id": 83122202, "body": "Also take a look at this <a href=\"https://github.com/kardianos/govendor/issues/137\" rel=\"nofollow noreferrer\">github.com/kardianos/govendor/issues/137</a>"}], "answers": [{"tags": [], "owner": {"reputation": 636, "user_id": 2063744, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/43SNP.png?s=128&g=1", "display_name": "nikolay_turpitko", "link": "https://stackoverflow.com/users/2063744/nikolay-turpitko"}, "is_accepted": false, "score": 0, "last_activity_date": 1517759852, "creation_date": 1517759852, "answer_id": 48610024, "question_id": 48061650, "link": "https://stackoverflow.com/questions/48061650/how-to-deploy-golang-application-on-gcloud/48610024#48610024", "title": "How to deploy golang application on gcloud", "body": "<p><code>gcloud</code> is broken: <a href=\"https://issuetracker.google.com/issues/38449183\" rel=\"nofollow noreferrer\">https://issuetracker.google.com/issues/38449183</a> try to use <code>goapp</code>.</p>\n"}], "owner": {"reputation": 515, "user_id": 8811309, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/4476b7cc4e5b6bce944fc80edc861729?s=128&d=identicon&r=PG&f=1", "display_name": "awsm sid", "link": "https://stackoverflow.com/users/8811309/awsm-sid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 427, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1517759852, "creation_date": 1514898657, "last_edit_date": 1514906189, "question_id": 48061650, "link": "https://stackoverflow.com/questions/48061650/how-to-deploy-golang-application-on-gcloud", "title": "How to deploy golang application on gcloud", "body": "<p>Hi i am trying to deploy a golang application on gcloud using command on ubuntu:-</p>\n\n<pre><code>gcloud app deploy app.yaml index.yaml\n</code></pre>\n\n<p>But i am getting an error as follow:-</p>\n\n<pre><code>ERROR: (gcloud.app.deploy) Error Response: [9] Deployment contains files that cannot be compiled: Compile failed: /work_dir/github.com/stretchr/testify/assert/assertions.go:17: can't find import: \"github.com/davecgh/go-spew/spew\" 2018/01/02 04:59:26 go-app-builder: build timing: 23\u00d7compile (14.75s total), 0\u00d7link (0s total) 2018/01/02 04:59:26 go-app-builder: failed running compile: exit status 2\n</code></pre>\n\n<p>I have installed all the dependencies and packages please help me thanx in advance :)</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514892708, "post_id": 48060080, "comment_id": 83092680, "body": "Add <code>log.Println(string(body))</code> after you read the bytes with <code>ioutil.ReadAll</code> to see if it&#39;s valid json."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514892885, "post_id": 48060080, "comment_id": 83092774, "body": "Setting the header on a response after you&#39;ve retrieved it with <code>http.Get</code> has zero effect on how the response&#39;s Body is read. You can omit that line."}, {"owner": {"reputation": 5260, "user_id": 668929, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1ca58d0a4a10ea07fabd4e4d32968982?s=128&d=identicon&r=PG", "display_name": "Dhanush Gopinath", "link": "https://stackoverflow.com/users/668929/dhanush-gopinath"}, "edited": false, "score": 0, "creation_date": 1514893843, "post_id": 48060080, "comment_id": 83093281, "body": "You probably need to set the header on the http request rather than response. <code>req.Header.Set(&quot;name&quot;, &quot;value&quot;)</code> is how you do it."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1514893880, "post_id": 48060080, "comment_id": 83093301, "body": "<b>Server</b> crashed? Please show suspected crashing code instead of the <b>client</b>."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 1, "creation_date": 1514896645, "post_id": 48060080, "comment_id": 83094725, "body": "The error states, quite clearly that the response contains an unexpected <code>&lt;</code>, which leads me to believe you&#39;re getting an HTML/XML response back (not JSON). Create a request, set the <code>Accept</code> header to <code>application&#47;json</code> and make sure you&#39;re calling the API correctly"}, {"owner": {"reputation": 1951, "user_id": 1442219, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6398031dc321aa3c975436e11d752f6b?s=128&d=identicon&r=PG", "display_name": "Lanti", "link": "https://stackoverflow.com/users/1442219/lanti"}, "edited": false, "score": 0, "creation_date": 1514902840, "post_id": 48060080, "comment_id": 83097828, "body": "I just logged the response to the console and the last request, where the server crashes, indeed returning a html error page with 403 (Down for maintenance). Probably the API that I using is rate limited?"}], "answers": [{"comments": [{"owner": {"reputation": 1951, "user_id": 1442219, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6398031dc321aa3c975436e11d752f6b?s=128&d=identicon&r=PG", "display_name": "Lanti", "link": "https://stackoverflow.com/users/1442219/lanti"}, "edited": false, "score": 0, "creation_date": 1514902855, "post_id": 48062112, "comment_id": 83097836, "body": "I just logged the response to the console and the last request, where the server crashes, indeed returning a html error page with 403 (Down for maintenance). Probably the API that I using is rate limited?"}, {"owner": {"reputation": 1951, "user_id": 1442219, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6398031dc321aa3c975436e11d752f6b?s=128&d=identicon&r=PG", "display_name": "Lanti", "link": "https://stackoverflow.com/users/1442219/lanti"}, "edited": false, "score": 0, "creation_date": 1514902901, "post_id": 48062112, "comment_id": 83097866, "body": "I accepting your answer, because it&#39;s solving the proper header setting."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1514900598, "creation_date": 1514900598, "answer_id": 48062112, "question_id": 48060080, "link": "https://stackoverflow.com/questions/48060080/set-headers-in-json-get-request/48062112#48062112", "title": "Set headers in JSON get request", "body": "<p>You probably want to set the header on the request. Setting the header on the response has no impact.</p>\n\n<pre><code>func Request(url string, contentType string) []byte {\n    req, err := http.NewRequest(\"GET\", url, nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n    req.Header.Set(\"Content-Type\", contentType)\n    resp, err := http.DefaultClient.Do(req)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer resp.Body.Close()\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        log.Fatal(err)\n    }\n    return body\n}\n</code></pre>\n"}], "owner": {"reputation": 1951, "user_id": 1442219, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6398031dc321aa3c975436e11d752f6b?s=128&d=identicon&r=PG", "display_name": "Lanti", "link": "https://stackoverflow.com/users/1442219/lanti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3728, "favorite_count": 0, "accepted_answer_id": 48062112, "answer_count": 1, "score": 4, "last_activity_date": 1514900598, "creation_date": 1514892232, "last_edit_date": 1514892385, "question_id": 48060080, "link": "https://stackoverflow.com/questions/48060080/set-headers-in-json-get-request", "title": "Set headers in JSON get request", "body": "<p>I'm getting JSON resonse from an external API with the following way:</p>\n\n<pre><code>func Request(url string, contentType string) []byte {\n    resp, err := http.Get(url)\n    resp.Header.Set(\"Content-Type\", contentType)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    body, err := ioutil.ReadAll(resp.Body)\n    resp.Body.Close()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    return body\n}\n\nurl := fmt.Sprintf(\"https://example.com/api/category/%s\", category)\ncontentType := \"application/json\"\nbody := Request(url, contentType)\n\nres := &amp;JSONRespStruct{}\nerr := json.Unmarshal([]byte(body), res)\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>The problem if I start to benchmark my site with <code>go-wrk</code>, the server crashes with the following error message:</p>\n\n<pre><code>2018/01/02 12:13:35 invalid character '&lt;' looking for beginning of value\n</code></pre>\n\n<p>I think the code try to parse the JSON response as HTML. How I can force to get the response as a JSON?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 2, "creation_date": 1514891441, "post_id": 48059760, "comment_id": 83092043, "body": "The <code>Department</code> struct itself doesn&#39;t have tags, only its fields. You need to loop over the fields of <code>Department</code> itself."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514891455, "post_id": 48059760, "comment_id": 83092049, "body": "Since it&#39;s nested you need to go one level deeper for each nesting level. <code>NumField</code> returns only the number of fields of the type on which you called it. And correspondingly <code>Field</code> only returns fields of the type on which you called it, it&#39;s not gonna return nested fields. <a href=\"https://play.golang.org/p/_NCk8n_bC51\" rel=\"nofollow noreferrer\">play.golang.org/p/_NCk8n_bC51</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1246, "user_id": 4516106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37134b731235c61f94701c9e5d6882cf?s=128&d=identicon&r=PG", "display_name": "khue bui", "link": "https://stackoverflow.com/users/4516106/khue-bui"}, "edited": false, "score": 0, "creation_date": 1514965939, "post_id": 48060258, "comment_id": 83120084, "body": "btw, can I get value of each fields??"}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "reply_to_user": {"reputation": 1246, "user_id": 4516106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37134b731235c61f94701c9e5d6882cf?s=128&d=identicon&r=PG", "display_name": "khue bui", "link": "https://stackoverflow.com/users/4516106/khue-bui"}, "edited": false, "score": 0, "creation_date": 1514975967, "post_id": 48060258, "comment_id": 83124966, "body": "In the example above you are iterating over <code>Type</code>s information. If you want values, you should use <code>reflect.ValueOf</code> in <code>main</code> and use similar loop."}], "tags": [], "owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "is_accepted": true, "score": 5, "last_activity_date": 1514893369, "last_edit_date": 1514893369, "creation_date": 1514892937, "answer_id": 48060258, "question_id": 48059760, "link": "https://stackoverflow.com/questions/48059760/get-tags-from-nested-struct/48060258#48060258", "title": "Get tags from nested struct", "body": "<p>Hi and Happy New Year!</p>\n\n<p>Your <strong>Department</strong> sub-structure doesn't have tags itself and you were trying to print them.</p>\n\n<p>Your code should consider that the field being checked inside the loop can be struct itself and descend into it accordingly.</p>\n\n<p>Here's a simple recursive version of the tags printer:</p>\n\n<pre><code>func printTags(t reflect.Type) {\n    for i := 0; i &lt; t.NumField(); i++ {\n        field := t.Field(i)\n\n        if field.Type.Kind() == reflect.Struct {\n            printTags(field.Type)\n            continue\n        }\n\n        column := field.Tag.Get(\"sql\")\n        fmt.Println(\"column: \", column)\n    }\n}\n\nfunc main() {\n    printTags(reflect.TypeOf(&amp;Employee{}).Elem())\n}\n</code></pre>\n\n<p>Then you have the output:</p>\n\n<pre><code>column:  id\ncolumn:  first_name\ncolumn:  last_name\ncolumn:  name\ncolumn:  size\n</code></pre>\n\n<p>Hope this helps.</p>\n"}], "owner": {"reputation": 1246, "user_id": 4516106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37134b731235c61f94701c9e5d6882cf?s=128&d=identicon&r=PG", "display_name": "khue bui", "link": "https://stackoverflow.com/users/4516106/khue-bui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2166, "favorite_count": 0, "accepted_answer_id": 48060258, "answer_count": 1, "score": 1, "last_activity_date": 1514903854, "creation_date": 1514890892, "last_edit_date": 1514903854, "question_id": 48059760, "link": "https://stackoverflow.com/questions/48059760/get-tags-from-nested-struct", "title": "Get tags from nested struct", "body": "<p>Let say I have a struct look like:</p>\n\n<pre><code>type Employee struct {\n    ID        uint32    `json:\"id\" sql:\"id\"`\n    FirstName string    `json:\"first_name\" sql:\"first_name\"`\n    LastName  string    `json:\"last_name\" sql:\"last_name\"`\n    Department struct {\n        Name string `json:\"name\" sql:\"name\"`\n        Size int `json:\"size\" sql:\"size\"`\n    }\n}\n</code></pre>\n\n<p>The code below can not get tags from nested struct <strong>Department</strong></p>\n\n<pre><code>func main(){\n    t := reflect.TypeOf(&amp;Employee{}).Elem()\n    for i := 0; i &lt; t.NumField(); i++ {\n        field := t.Field(i)\n        column := field.Tag.Get(\"sql\")\n        fmt.Println(\"column: \", column)\n    }\n}\n</code></pre>\n\n<p>Result: </p>\n\n<pre><code>column:  id\ncolumn:  first_name\ncolumn:  last_name\ncolumn: \n</code></pre>\n\n<p>Is there any way to get tags from nested struct ?? thanks.</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1514890107, "post_id": 48059228, "comment_id": 83091351, "body": "The <code>parseRates</code>&#39;s call to <code>db.QueryRow</code>... you&#39;re not handling the result. Either use <code>db.Exec</code> or call <code>Scan</code> on the returned row."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1514890183, "post_id": 48059228, "comment_id": 83091383, "body": "For more details see this answer: <a href=\"https://stackoverflow.com/questions/47706147/how-to-reuse-a-single-postgres-db-connection-for-row-inserts-in-go/47711577#47711577\" title=\"how to reuse a single postgres db connection for row inserts in go\">stackoverflow.com/questions/47706147/&hellip;</a>"}, {"owner": {"reputation": 975, "user_id": 2148352, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/HcT8H.jpg?s=128&g=1", "display_name": "James May", "link": "https://stackoverflow.com/users/2148352/james-may"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514891095, "post_id": 48059228, "comment_id": 83091880, "body": "Thank you a lot !!!"}], "owner": {"reputation": 975, "user_id": 2148352, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/HcT8H.jpg?s=128&g=1", "display_name": "James May", "link": "https://stackoverflow.com/users/2148352/james-may"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3326, "favorite_count": 0, "closed_date": 1514910991, "answer_count": 0, "score": 2, "last_activity_date": 1514888656, "creation_date": 1514888656, "question_id": 48059228, "link": "https://stackoverflow.com/questions/48059228/panic-pq-sorry-too-many-clients-already", "closed_reason": "Duplicate", "title": "panic: pq: sorry, too many clients already", "body": "<p>I'm trying to run a pretty straightforward parser of coinmarketcap. I only have two tables: <strong>currency</strong> and <strong>rate</strong>, so I add the new currencies on the fly and insert a new rate after that.</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"os\"\n    \"../helpers\"\n    \"fmt\"\n    \"database/sql\"\n    _ \"github.com/lib/pq\"\n    \"encoding/json\"\n    \"strconv\"\n)\n\nfunc chk(err error) {\n    if err != nil {\n        log.Panic(err)\n    }\n}\n\ntype Rate struct {\n    Name   string `json:\"name\"`\n    Symbol string `json:\"symbol\"`\n    Price  string `json:\"price_usd\"`\n}\n\nfunc getCreateCurrency(db *sql.DB, rate Rate) int {\n    var id int\n\n    res, err := db.Query(\"SELECT id FROM currency WHERE symbol = $1\", rate.Symbol)\n    chk(err)\n    defer res.Close()\n\n    if res.Next() {\n        err = res.Scan(&amp;id)\n        chk(err)\n        return id\n    }\n\n    err = db.QueryRow(`\n        INSERT INTO currency\n        (name, symbol)\n        VALUES ($1, $2)\n        RETURNING id\n    `, rate.Name, rate.Symbol).Scan(&amp;id)\n    chk(err)\n\n    return id\n}\n\nfunc parseRates(db *sql.DB) {\n    for {\n        ratesBody, err := helpers.GetHttpBody(\"https://api.coinmarketcap.com/v1/ticker/?limit=0\")\n        chk(err)\n\n        rates := make([]Rate, 0)\n        json.Unmarshal([]byte(ratesBody), &amp;rates)\n\n        for _, rate := range rates {\n            currencyId := getCreateCurrency(db, rate)\n            price, err := strconv.ParseFloat(rate.Price, 64)\n            if err != nil {\n                continue\n            }\n\n            db.QueryRow(`INSERT INTO rate (currency_id, rate) VALUES ($1, $2)`, currencyId, price)\n\n            fmt.Println(rate.Symbol, rate.Price)\n        }\n\n        break\n    }\n}\n\nfunc main() {\n    cfg, err := helpers.GetConfig(os.Args[1])\n    chk(err)\n\n    db, err := sql.Open(\"postgres\", cfg.DbConnection)\n    chk(err)\n    defer db.Close()\n\n    parseRates(db)\n}\n</code></pre>\n\n<p>All of a sudden a got an error exactly after 100 loop iterations:</p>\n\n<pre><code>panic: pq: sorry, too many clients already\n</code></pre>\n\n<p>The problem somewhere at the <strong>getCreateCurrency</strong> function. I get the hung connection somehow, because if I turn it off all works just fine.</p>\n\n<p>Of course I have max_connections = 100 at postgres.conf, but I thought I only use one connection, because I event don't use async functionality here.</p>\n\n<p>I use macos, pg 9.6, go 1.9.2.</p>\n"}, {"tags": ["go", "aes"], "answers": [{"comments": [{"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1514883650, "post_id": 48057859, "comment_id": 83088333, "body": "Ah that works! Now to figure out how to pad in Golang."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1514884405, "post_id": 48057859, "comment_id": 83088663, "body": "A hint: the encoded IV should be 32-digit long while decoded should be 16 bytes."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 4, "last_activity_date": 1514882245, "creation_date": 1514882245, "answer_id": 48057859, "question_id": 48057470, "link": "https://stackoverflow.com/questions/48057470/how-to-decrypt-an-aes-encrypted-transport-stream-segment-with-golang/48057859#48057859", "title": "How to decrypt an AES encrypted transport stream segment with Golang?", "body": "<p>Your <code>iv</code> is indeed too short so the openssl just padded zero for you:</p>\n\n<pre><code>openssl aes-128-cbc -d -in enc.ts -out clear.ts -iv 353833383634 -K 9e8c69bcaafa6b636e076935e29986b5 -nosalt -P\nkey=9E8C69BCAAFA6B636E076935E29986B5\niv =35383338363400000000000000000000\n</code></pre>\n"}], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 838, "favorite_count": 0, "accepted_answer_id": 48057859, "answer_count": 1, "score": 4, "last_activity_date": 1514882245, "creation_date": 1514879800, "question_id": 48057470, "link": "https://stackoverflow.com/questions/48057470/how-to-decrypt-an-aes-encrypted-transport-stream-segment-with-golang", "title": "How to decrypt an AES encrypted transport stream segment with Golang?", "body": "<p>I know using openssl (tested with OpenSSL 1.1.0g), the following stanza works to decrypt <a href=\"https://s.natalian.org/2018-01-02/enc.ts\" rel=\"nofollow noreferrer\">enc.ts</a>, mimetype: video/MP2T, to a <code>ffplay</code> playable clear.ts h264 segment:</p>\n\n<pre><code>openssl aes-128-cbc -d -in enc.ts -out clear.ts -iv 353833383634 -K 9e8c69bcaafa6b636e076935e29986b5 -nosalt\n</code></pre>\n\n<p>Though with Golang's <a href=\"https://golang.org/pkg/crypto/cipher/#NewCBCDecrypter\" rel=\"nofollow noreferrer\">https://golang.org/pkg/crypto/cipher/#NewCBCDecrypter</a> I'm very confused how the hexadecimal key and iv are set as byte slices, whether block sizes are a factor and how to load and write out the file.</p>\n\n<p>I have tried:</p>\n\n<pre><code>package main\n\nimport (\n        \"crypto/aes\"\n        \"crypto/cipher\"\n        \"encoding/hex\"\n        \"fmt\"\n        \"io/ioutil\"\n)\n\nfunc checkerror(err error) {\n        if err != nil {\n                panic(err)\n        }\n}\n\nfunc main() {\n        key, err := hex.DecodeString(\"9e8c69bcaafa6b636e076935e29986b5\")\n        checkerror(err)\n        iv, err := hex.DecodeString(\"353833383634\")\n        checkerror(err)\n        ciphertext, err := ioutil.ReadFile(\"enc.ts\")\n        checkerror(err)\n        block, err := aes.NewCipher(key)\n        checkerror(err)\n        mode := cipher.NewCBCDecrypter(block, iv)\n        mode.CryptBlocks(ciphertext, ciphertext)\n        fmt.Printf(\"%s\\n\", ciphertext)\n}\n</code></pre>\n\n<p>But that results in a <code>panic: cipher.NewCBCDecrypter: IV length must equal block size</code>. What am I missing?</p>\n"}, {"tags": ["html", "go", "struct", "handler"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514877578, "post_id": 48057000, "comment_id": 83086146, "body": "Please show type <code>session.SessionData</code>."}, {"owner": {"reputation": 680, "user_id": 3184454, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yu2Gc.jpg?s=128&g=1", "display_name": "Khrisna Gunanasurya", "link": "https://stackoverflow.com/users/3184454/khrisna-gunanasurya"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514877820, "post_id": 48057000, "comment_id": 83086235, "body": "@leafbebop edited"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1514878294, "post_id": 48057000, "comment_id": 83086446, "body": "<code>tmp.Execute</code> returns an error, if you check that it will tell you exactly why you don&#39;t see what you want to see."}, {"owner": {"reputation": 1592, "user_id": 7251967, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-al-If026iHU/AAAAAAAAAAI/AAAAAAAAABE/9lsheyH-V9Q/photo.jpg?sz=128", "display_name": "negi Yogi", "link": "https://stackoverflow.com/users/7251967/negi-yogi"}, "edited": false, "score": 0, "creation_date": 1514878406, "post_id": 48057000, "comment_id": 83086482, "body": "export  sessionDataHandler . make  &quot;sessionDataHandler&quot; to &quot;SessionDataHandler&quot; in  type dataHandler struct {     sessionDataHandler session.SessionData }  and then use  SessionDataHandler every where and see if it works ."}, {"owner": {"reputation": 680, "user_id": 3184454, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yu2Gc.jpg?s=128&g=1", "display_name": "Khrisna Gunanasurya", "link": "https://stackoverflow.com/users/3184454/khrisna-gunanasurya"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514878467, "post_id": 48057000, "comment_id": 83086517, "body": "@mkopriva added and now it giving me this error <code>executing &quot;index.html&quot; at &lt;.SessionDataHandler....&gt;: can&#39;t evaluate field SessionDataHandler in type handler.dataHandler</code>"}, {"owner": {"reputation": 680, "user_id": 3184454, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yu2Gc.jpg?s=128&g=1", "display_name": "Khrisna Gunanasurya", "link": "https://stackoverflow.com/users/3184454/khrisna-gunanasurya"}, "reply_to_user": {"reputation": 1592, "user_id": 7251967, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-al-If026iHU/AAAAAAAAAAI/AAAAAAAAABE/9lsheyH-V9Q/photo.jpg?sz=128", "display_name": "negi Yogi", "link": "https://stackoverflow.com/users/7251967/negi-yogi"}, "edited": false, "score": 0, "creation_date": 1514878489, "post_id": 48057000, "comment_id": 83086525, "body": "@negiYogi done already and it giving me this error <code>executing &quot;index.html&quot; at &lt;.SessionDataHandler....&gt;: can&#39;t evaluate field SessionDataHandler in type handler.dataHandler</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514878565, "post_id": 48057000, "comment_id": 83086554, "body": "Did you also update your dataHandler to have the field name start with an uppercase letter, or did you just change it in the template?"}, {"owner": {"reputation": 1592, "user_id": 7251967, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-al-If026iHU/AAAAAAAAAAI/AAAAAAAAABE/9lsheyH-V9Q/photo.jpg?sz=128", "display_name": "negi Yogi", "link": "https://stackoverflow.com/users/7251967/negi-yogi"}, "edited": false, "score": 0, "creation_date": 1514878629, "post_id": 48057000, "comment_id": 83086581, "body": "could you update your code snippet if you have made the changes ."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514878667, "post_id": 48057000, "comment_id": 83086597, "body": "Please edit it to your updated code ( and include some part in index.html)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1514878744, "post_id": 48057000, "comment_id": 83086620, "body": "@KhrisnaGunanasurya here&#39;s an example: <a href=\"https://play.golang.org/p/J4k2r35us-p\" rel=\"nofollow noreferrer\">play.golang.org/p/J4k2r35us-p</a>"}, {"owner": {"reputation": 680, "user_id": 3184454, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yu2Gc.jpg?s=128&g=1", "display_name": "Khrisna Gunanasurya", "link": "https://stackoverflow.com/users/3184454/khrisna-gunanasurya"}, "edited": false, "score": 0, "creation_date": 1514878964, "post_id": 48057000, "comment_id": 83086699, "body": "it&#39;s edited now"}], "answers": [{"comments": [{"owner": {"reputation": 680, "user_id": 3184454, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yu2Gc.jpg?s=128&g=1", "display_name": "Khrisna Gunanasurya", "link": "https://stackoverflow.com/users/3184454/khrisna-gunanasurya"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514879589, "post_id": 48057310, "comment_id": 83086916, "body": "@leafbebop ah yes! the go clean command were helping, I already rebuild my code but it doesn&#39;t fix, but now it&#39;s done. Thanks!"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 680, "user_id": 3184454, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yu2Gc.jpg?s=128&g=1", "display_name": "Khrisna Gunanasurya", "link": "https://stackoverflow.com/users/3184454/khrisna-gunanasurya"}, "edited": false, "score": 0, "creation_date": 1514879662, "post_id": 48057310, "comment_id": 83086949, "body": "It might be silly, but did you rebuild your code? If you did it, try <code>go clean</code> and then rebuild it again to see if it works. @KhrisnaGunanasurya"}], "tags": [], "owner": {"reputation": 1592, "user_id": 7251967, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-al-If026iHU/AAAAAAAAAAI/AAAAAAAAABE/9lsheyH-V9Q/photo.jpg?sz=128", "display_name": "negi Yogi", "link": "https://stackoverflow.com/users/7251967/negi-yogi"}, "is_accepted": false, "score": 2, "last_activity_date": 1566286274, "last_edit_date": 1566286274, "creation_date": 1514878927, "answer_id": 48057310, "question_id": 48057000, "link": "https://stackoverflow.com/questions/48057000/how-to-get-this-value-in-html-files-golang/48057310#48057310", "title": "How to get this value in html files golang", "body": "<pre><code>// package main  \npackage main\n\n    import (\n        \"fmt\"\n        \"os\"\n        \"html/template\"\n    )\n\n    type SessionData struct {\n        ID int\n        Username string\n    }\n\n    type dataHandler struct {\n        SessionDataHandler SessionData\n    }\n\n    var data = dataHandler{\n        SessionDataHandler: SessionData{\n            ID:       123,       // This\n            Username: \"Joe\", // and This\n        },\n    }\n\n    var tmpl = `\n    {{ .SessionDataHandler.ID }}\n    `\n\n    type dataHandler2 struct {\n        SessionDataHandler SessionData\n    }\n\n    var data2 = dataHandler2{\n        SessionDataHandler: SessionData{\n            ID:       123,       // This\n            Username: \"Joe\", // and This\n        },\n    }\n\n    var tmpl2 = `\n    {{ .SessionDataHandler.ID }}\n    {{ .SessionDataHandler.Username }}\n    `\n\n    func main() {\n        t, err := template.New(\"tmpl\").Parse(tmpl)\n        if err != nil {\n            panic(err)\n        }\n        fmt.Println(t.Execute(os.Stdout, data))\n\n        t2, err := template.New(\"tmpl\").Parse(tmpl2)\n        if err != nil {\n            panic(err)\n        }\n        fmt.Println(t2.Execute(os.Stdout, data2))\n    }\n</code></pre>\n\n<p>This should be the correct one.</p>\n"}], "owner": {"reputation": 680, "user_id": 3184454, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yu2Gc.jpg?s=128&g=1", "display_name": "Khrisna Gunanasurya", "link": "https://stackoverflow.com/users/3184454/khrisna-gunanasurya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 574, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566286274, "creation_date": 1514877426, "last_edit_date": 1514878937, "question_id": 48057000, "link": "https://stackoverflow.com/questions/48057000/how-to-get-this-value-in-html-files-golang", "title": "How to get this value in html files golang", "body": "<p>In HTML file, I want to get the ID and the Username, but how to do that? because what I got always a blank page.</p>\n\n<pre><code>// DataHandler struct\ntype DataHandler struct {\n    SessionDataHandler session.SessionData\n}\n\n// HomeHandler function\nfunc HomeHandler(w http.ResponseWriter, r *http.Request) {\n    sessionData := session.GetSession(w, r)\n    data := DataHandler{\n        SessionDataHandler: session.SessionData{\n            ID:       sessionData.ID,\n            Username: sessionData.Username,\n        },\n    }\n\n    tmp, err := template.ParseFiles(\n        \"web/index.html\",\n        \"web/template/header.html\",\n        \"web/template/footer.html\",\n    )\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    err = tmp.Execute(w, data)\n    if err != nil {\n        log.Println(err)\n    }\n}\n</code></pre>\n\n<p>I already tried using these in the HTML but still no luck.</p>\n\n<pre><code>{{ .SessionDataHandler }}\n{{ .SessionDataHandler.ID }}\n{{ .SessionDataHandler.session.ID }}\n{{ .SessionDataHandler.sessionData.ID }}\n{{ .SessionDataHandler.session.sessionData.ID }}\n</code></pre>\n\n<p>how to call them? </p>\n\n<p>Edited: </p>\n\n<pre><code>// SessionData struct\ntype SessionData struct {\n    ID       int\n    Username string\n}\n</code></pre>\n\n<p>Edited again: (HTML files)</p>\n\n<pre><code>{{ template \"header.html\" . }}\n{{ .SessionDataHandler.ID }}\n  &lt;!-- HOME PRO--&gt;\n  &lt;div class=\"home-pro\"&gt; \n\n    &lt;!-- PRO BANNER HEAD --&gt;\n    &lt;div class=\"banr-head\"&gt;\n      &lt;div class=\"container\"&gt;\n        &lt;div class=\"row\"&gt; \n</code></pre>\n"}, {"tags": ["http", "pointers", "go", "scope"], "comments": [{"owner": {"reputation": 243983, "user_id": 35070, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f92354195e8874dbee44d5c8714d506?s=128&d=identicon&r=PG", "display_name": "phihag", "link": "https://stackoverflow.com/users/35070/phihag"}, "edited": false, "score": 1, "creation_date": 1514874419, "post_id": 48056387, "comment_id": 83085037, "body": "What does <code>edgar.GetCompanyFilingListRes</code> do? Very likely, the problem is there. Please post a <a href=\"https://stackoverflow.com/help/mcve\"><b>complete</b> example</a>."}, {"owner": {"reputation": 799, "user_id": 2980967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ecQ8D.jpg?s=128&g=1", "display_name": "dustinevan", "link": "https://stackoverflow.com/users/2980967/dustinevan"}, "edited": false, "score": 0, "creation_date": 1514874791, "post_id": 48056387, "comment_id": 83085157, "body": "You&#39;re gonna want to check the error. <code>res, err := http.Get(url) if err != nil { log.Fatal(err) }</code>"}, {"owner": {"reputation": 415, "user_id": 5319281, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/22148896d125fa2c7357852622e2911d?s=128&d=identicon&r=PG&f=1", "display_name": "AppTest", "link": "https://stackoverflow.com/users/5319281/apptest"}, "reply_to_user": {"reputation": 243983, "user_id": 35070, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f92354195e8874dbee44d5c8714d506?s=128&d=identicon&r=PG", "display_name": "phihag", "link": "https://stackoverflow.com/users/35070/phihag"}, "edited": false, "score": 0, "creation_date": 1514944803, "post_id": 48056387, "comment_id": 83114250, "body": "@phihag It scrapes a webpage and as I mentioned it returns a map slice."}], "answers": [{"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 3, "last_activity_date": 1514875203, "creation_date": 1514875203, "answer_id": 48056586, "question_id": 48056387, "link": "https://stackoverflow.com/questions/48056387/invalid-memory-address-or-nil-pointer-dereference-after-first-loop-iteration/48056586#48056586", "title": "invalid memory address or nil pointer dereference after first loop iteration", "body": "<p>It seems very likely to be because <code>res</code> is a <code>Response</code> and <code>Response.Body</code> is a <code>ReadCloser</code> which can only be consumed once.</p>\n\n<p>If you want to re-use the body, read it into a buffer (like []byte or a string) using <code>ioutil.ReadAll</code>. If you want extra data from <code>res</code>, use a struct to wrap it.</p>\n\n<p>If your use case auctually use different responses (which make more sense to me), move the <code>http.Get</code> into the loop. (Warning: fetch an url 1e5 times can cause trouble).</p>\n"}], "owner": {"reputation": 415, "user_id": 5319281, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/22148896d125fa2c7357852622e2911d?s=128&d=identicon&r=PG&f=1", "display_name": "AppTest", "link": "https://stackoverflow.com/users/5319281/apptest"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 0, "closed_date": 1514887751, "accepted_answer_id": 48056586, "answer_count": 1, "score": -5, "last_activity_date": 1514945270, "creation_date": 1514873893, "last_edit_date": 1514945270, "question_id": 48056387, "link": "https://stackoverflow.com/questions/48056387/invalid-memory-address-or-nil-pointer-dereference-after-first-loop-iteration", "closed_reason": "Needs details or clarity", "title": "invalid memory address or nil pointer dereference after first loop iteration", "body": "<p>When I return (A map slice) from <code>GetCompanyFilingListRes</code> and print the output my code runs fine for one iteration. But on the second iteration I get a <code>panic: runtime error: invalid memory address or nil pointer dereference</code>.</p>\n\n<pre><code>package main\n\nimport (\n    \"data/edgar\"\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc main() {\n    url := \"calltomylocalserver.com/page.html\"\n    res, _ := http.Get(url)\n    for i := 0; i &lt; 100000; i++ {\n        // GetCompanyFilingListRes comsumes res.Body \n        // before returning a slice of maps\n        m := edgar.GetCompanyFilingListRes(res)\n        fmt.Println(m)\n    }\n}\n</code></pre>\n\n<p>I'm sure this is something quite simple I'm missing but I don't why <code>res</code> doesn't seem to be accessible after the first iteration. Is the GC removing it from memory? How would I stop this happening? Thanks.</p>\n\n<p>Edit: </p>\n\n<p>I think my mistake with this question was not including the fact that GetCompanyFilingListRes consumes the <code>res.Body</code>. And as <a href=\"https://stackoverflow.com/a/48056586/5319281\">leaf bebop mentioned</a> it can only be consumed once. </p>\n\n<p>There's a related answer I found <a href=\"https://stackoverflow.com/questions/24879587/xml-newdecoderresp-body-decode-giving-eof-error-golang\">here</a>.</p>\n"}, {"tags": ["rest", "go", "kubernetes", "istio"], "comments": [{"owner": {"reputation": 144, "user_id": 18913, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60593154b58d4a80f50889a0c6eed7b7?s=128&d=identicon&r=PG", "display_name": "markdevilliers", "link": "https://stackoverflow.com/users/18913/markdevilliers"}, "edited": false, "score": 0, "creation_date": 1514901433, "post_id": 48055276, "comment_id": 83097075, "body": "The type definitions here that Istio uses (generated from the .proto file) are here - <a href=\"https://github.com/istio/api/blob/master/routing/v1alpha2/\" rel=\"nofollow noreferrer\">github.com/istio/api/blob/master/routing/v1alpha2</a>  I&#39;m not too sure if they are what you are looking for?"}, {"owner": {"reputation": 659, "user_id": 7265601, "user_type": "registered", "profile_image": "https://graph.facebook.com/1033028356807313/picture?type=large", "display_name": "Jasmitha", "link": "https://stackoverflow.com/users/7265601/jasmitha"}, "reply_to_user": {"reputation": 144, "user_id": 18913, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60593154b58d4a80f50889a0c6eed7b7?s=128&d=identicon&r=PG", "display_name": "markdevilliers", "link": "https://stackoverflow.com/users/18913/markdevilliers"}, "edited": false, "score": 0, "creation_date": 1514971060, "post_id": 48055276, "comment_id": 83122308, "body": "I&#39;m looking for the way to achieve istioctl operations using istio apis. I found that route rule can be created using <code>curl -X POST -d @test2.json -H &quot;Content-Type: application&#47;json&quot;  http:&#47;&#47;localhost:8001&#47;apis&#47;config.istio.io&#47;v1alpha2&#47;namespac&zwnj;&#8203;es&#47;default&#47;routerule&zwnj;&#8203;s</code>.  In the same way is it possible to inject sidecars into pod using an api?"}], "answers": [{"tags": [], "owner": {"reputation": 2172, "user_id": 3514300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15475931fb58ff8302ae449fb886da2c?s=128&d=identicon&r=PG", "display_name": "Tummala Dhanvi", "link": "https://stackoverflow.com/users/3514300/tummala-dhanvi"}, "is_accepted": false, "score": 0, "last_activity_date": 1577667908, "creation_date": 1577667908, "answer_id": 59524667, "question_id": 48055276, "link": "https://stackoverflow.com/questions/48055276/how-can-i-access-istio-apis/59524667#59524667", "title": "How can I access Istio APIs?", "body": "<p><a href=\"https://github.com/istio/client-go\" rel=\"nofollow noreferrer\">https://github.com/istio/client-go</a> is the one you are looking for.</p>\n"}], "owner": {"reputation": 659, "user_id": 7265601, "user_type": "registered", "profile_image": "https://graph.facebook.com/1033028356807313/picture?type=large", "display_name": "Jasmitha", "link": "https://stackoverflow.com/users/7265601/jasmitha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 517, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1577667908, "creation_date": 1514863673, "last_edit_date": 1517087079, "question_id": 48055276, "link": "https://stackoverflow.com/questions/48055276/how-can-i-access-istio-apis", "title": "How can I access Istio APIs?", "body": "<p>I have created route rule using command line <code>istioctl create -f file.yaml</code>. I want to achieve same from custom GO code. Is there an Istio API to create route rules?</p>\n"}, {"tags": ["session", "go"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514863545, "post_id": 48055222, "comment_id": 83082807, "body": "What do you mean by call cookie value? Would you please give a use case?"}, {"owner": {"reputation": 680, "user_id": 3184454, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yu2Gc.jpg?s=128&g=1", "display_name": "Khrisna Gunanasurya", "link": "https://stackoverflow.com/users/3184454/khrisna-gunanasurya"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514864823, "post_id": 48055222, "comment_id": 83083032, "body": "@leafbebop ah sorry, I make myself unclear, I already edited it"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1514865081, "post_id": 48055222, "comment_id": 83083073, "body": "So you want to access the session in the browser? You can use JavaScript to do so."}, {"owner": {"reputation": 680, "user_id": 3184454, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yu2Gc.jpg?s=128&g=1", "display_name": "Khrisna Gunanasurya", "link": "https://stackoverflow.com/users/3184454/khrisna-gunanasurya"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514866777, "post_id": 48055222, "comment_id": 83083340, "body": "@leafbebop there are no function in go to get the session like PHP does?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514867447, "post_id": 48055222, "comment_id": 83083431, "body": "PHP just generated it into HTML just like you passing the variable into template.There are no better options than that as far as I know, but there are better templates such as fasttemplate."}, {"owner": {"reputation": 680, "user_id": 3184454, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yu2Gc.jpg?s=128&g=1", "display_name": "Khrisna Gunanasurya", "link": "https://stackoverflow.com/users/3184454/khrisna-gunanasurya"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514868251, "post_id": 48055222, "comment_id": 83083558, "body": "@leafbebop I see, then I&#39;ll start writing some JS then, anyway, do you know how to get the values from <code>gorilla&#47;sessions</code>? I&#39;m using <code>session.Values[&quot;ID&quot;] = 1</code> to set, and I think to get that value just write <code>session.Values[&quot;ID&quot;]</code> but it doesn&#39;t work, I read the docs but didnt find the right function. Do you know about it too?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514868523, "post_id": 48055222, "comment_id": 83083617, "body": "I think you are doing it right. Maybe you forget to do a type assertion? What error do you get? It is hard to debug without these information."}, {"owner": {"reputation": 680, "user_id": 3184454, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yu2Gc.jpg?s=128&g=1", "display_name": "Khrisna Gunanasurya", "link": "https://stackoverflow.com/users/3184454/khrisna-gunanasurya"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514869214, "post_id": 48055222, "comment_id": 83083771, "body": "@leafbebop I already do a type assertion like this <code>session.Values[&quot;ID&quot;].int</code>,   this is the error what I got <b>session.Values[&quot;ID&quot;].int undefined (type interface {} is interface with no methods)</b>"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1514869628, "post_id": 48055222, "comment_id": 83083881, "body": "It&#39;s <code>.(int)</code> not <code>.int</code>."}, {"owner": {"reputation": 680, "user_id": 3184454, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yu2Gc.jpg?s=128&g=1", "display_name": "Khrisna Gunanasurya", "link": "https://stackoverflow.com/users/3184454/khrisna-gunanasurya"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514869875, "post_id": 48055222, "comment_id": 83083937, "body": "@leafbebop ah I forgot about the () brackets, that&#39;s why it&#39;s error. Thanks !"}], "answers": [{"comments": [{"owner": {"reputation": 530, "user_id": 1099057, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/96aca568d9bc245c3cd61bf227914c46?s=128&d=identicon&r=PG", "display_name": "kreamik", "link": "https://stackoverflow.com/users/1099057/kreamik"}, "edited": false, "score": 0, "creation_date": 1571914294, "post_id": 48057964, "comment_id": 103401399, "body": "what if the template is header template? should i do this for all method?"}, {"owner": {"reputation": 1479, "user_id": 4608714, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4a9e5bcd7f1b37e22e6d75843e10dd78?s=128&d=identicon&r=PG&f=1", "display_name": "Charas", "link": "https://stackoverflow.com/users/4608714/charas"}, "reply_to_user": {"reputation": 530, "user_id": 1099057, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/96aca568d9bc245c3cd61bf227914c46?s=128&d=identicon&r=PG", "display_name": "kreamik", "link": "https://stackoverflow.com/users/1099057/kreamik"}, "edited": false, "score": 0, "creation_date": 1592114755, "post_id": 48057964, "comment_id": 110304659, "body": "Hi @kreamik I am having the exact same issue and have been searching everywhere, do you manage to find a way to check for the user session in a template?"}, {"owner": {"reputation": 530, "user_id": 1099057, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/96aca568d9bc245c3cd61bf227914c46?s=128&d=identicon&r=PG", "display_name": "kreamik", "link": "https://stackoverflow.com/users/1099057/kreamik"}, "edited": false, "score": 0, "creation_date": 1592321951, "post_id": 48057964, "comment_id": 110381147, "body": "Like the ansers above, i duplicate the session for every page"}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 0, "last_activity_date": 1514882808, "creation_date": 1514882808, "answer_id": 48057964, "question_id": 48055222, "link": "https://stackoverflow.com/questions/48055222/checking-user-session-in-html-files-in-golang/48057964#48057964", "title": "Checking user session in HTML files in golang", "body": "<p>I think from your description you have a session variable accessible within the .go file (the handlerfunc), and wish to use it in the html file. This is relatively simple, it's just a value. Yes, passing it through ExecuteTemplate is the right approach. The session is just a cookie sent with the request to your server from the browser, it's there in the request headers. </p>\n\n<p>You could set a func in your set of funcs for the template which accessed some sort of global variable, but then you'd get into problems with syncing across goroutines (every request handler runs in a goroutine), so the simpler approach is best.</p>\n\n<p>You should not be trying to perform operations on the session in a template like decrypting it and extracting a user id - this is more suited to your handlers and far more secure there and not in the template. </p>\n\n<p>First extract it from the cookie using your preferred library (you are encrypting your sessions right?), then add it to the view context (let's say you use a map of values). </p>\n\n<pre><code>// use a lib like gorilla sessions\nsession, err := store.Get(r, \"session-name\")\nuserID := session.Get(\"user\")\n\n// store data (here in a map[string]interface{})\ndata := make(map[string]interface{})\ndata[\"userID\"] = userID \n\n// Send this data to the view\nt.Execute(w, data) // Sets the . variable in templates\n</code></pre>\n\n<p>Then in the view, just use something like this to access the values you need:</p>\n\n<pre><code>{{ .userID }}\n</code></pre>\n\n<p>Alternatively yes you can just use javascript to access the session, but you'd need to know how it is encrypted, which is probably a security hole if it contains any information of value - anything js can get at your user can get at too.</p>\n"}, {"tags": [], "owner": {"reputation": 1759, "user_id": 1512962, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/EfW0L.png?s=128&g=1", "display_name": "Anonymous Penguin", "link": "https://stackoverflow.com/users/1512962/anonymous-penguin"}, "is_accepted": false, "score": 0, "last_activity_date": 1515018381, "creation_date": 1515018381, "answer_id": 48086075, "question_id": 48055222, "link": "https://stackoverflow.com/questions/48055222/checking-user-session-in-html-files-in-golang/48086075#48086075", "title": "Checking user session in HTML files in golang", "body": "<p>Templating is by far the most universal approach. There are third-party alternatives to ExecuteTemplate, such as <a href=\"https://github.com/valyala/quicktemplate\" rel=\"nofollow noreferrer\">https://github.com/valyala/quicktemplate</a>.</p>\n\n<p>An alternative is to do \"client-side templating\" where ALL of the renderings are done on the client using JavaScript and communicating to the server using a REST-like/JSON API.</p>\n\n<p><strong><em>Which should I choose?</em></strong> That depends on your use case. If your website needs live updates and does a lot of back-and-forth with the server, client-side scripting can make things significantly easier so you only have to have a JavaScript function to render part of the page, not a JavaScript function <em>and</em> an equivalent Go function. It can also create a smoother overall interface; for example, if an action takes a few seconds to \"process,\" client-side templating and rendering <em>can</em> be built so the page doesn't have to completely refresh (thus avoiding the \"flash of white\" while the page refreshes).</p>\n\n<p>On the other hand, if you have a simple application, server-side templating will be faster to build (you don't have to build an API) and result in a faster overall page load time.</p>\n\n<hr>\n\n<p>Of course, rarely is an application all client-side or all all-server side. Reading URLs in JavaScript is difficult, so I have seen people using a templating engine to inject an object ID into a JavaScript constant. Even with an all client-side approach, using a templating engine to standardize navigation/footer/site layout between all pages (rendering all of the templates when the server starts up) is useful.</p>\n"}], "owner": {"reputation": 680, "user_id": 3184454, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/yu2Gc.jpg?s=128&g=1", "display_name": "Khrisna Gunanasurya", "link": "https://stackoverflow.com/users/3184454/khrisna-gunanasurya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1033, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1515018381, "creation_date": 1514863097, "last_edit_date": 1514864804, "question_id": 48055222, "link": "https://stackoverflow.com/questions/48055222/checking-user-session-in-html-files-in-golang", "title": "Checking user session in HTML files in golang", "body": "<p>How to check the user login session directly in the HTML files? I already searched it on google but I can't find the checking session directly in the html file, is it not possible to do that? </p>\n\n<p>The only thing I can found is by pass it through <code>ExecuteTemplate()</code>, is that the only thing I can do?</p>\n"}, {"tags": ["go", "concurrency", "channel"], "answers": [{"comments": [{"owner": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "edited": false, "score": 0, "creation_date": 1514854159, "post_id": 48054409, "comment_id": 83081235, "body": "Thanks for your feedback @leafbebop, I will attempt suggested and accept answer once I have this sorted out."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "edited": false, "score": 2, "creation_date": 1514854469, "post_id": 48054409, "comment_id": 83081278, "body": "<a href=\"https://blog.golang.org/advanced-go-concurrency-patterns\" rel=\"nofollow noreferrer\">blog.golang.org/advanced-go-concurrency-patterns</a> You may find this blog post helpful."}, {"owner": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "edited": false, "score": 0, "creation_date": 1514860494, "post_id": 48054409, "comment_id": 83082270, "body": "Hi @leafbebop. Maybe I&#39;m confused about your comment <code>&#47;&#47;call dispatch according to the queue here.</code>. I updated the queue to loop until the length of <code>EXEC_THROTTLE</code>, but as you can see only the first two <code>Job</code>s are run if <code>EXEC_THROTTLE == 2</code>. What am I missing? <a href=\"https://play.golang.org/p/Ye35isSP8kv\" rel=\"nofollow noreferrer\">play.golang.org/p/Ye35isSP8kv</a> Also, I think I need to wait for <code>logger</code> to return to call <code>wg.Done()</code>."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "edited": false, "score": 1, "creation_date": 1514861270, "post_id": 48054409, "comment_id": 83082420, "body": "You indeed missed my point. I changed your code here:<a href=\"https://play.golang.org/p/HhkDh3WYgBH\" rel=\"nofollow noreferrer\">play.golang.org/p/HhkDh3WYgBH</a> Try to understand it with my explaining in the answer first. I find it hard to explain more but if there is still something unclear, feel free to ask."}, {"owner": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "edited": false, "score": 0, "creation_date": 1514862475, "post_id": 48054409, "comment_id": 83082640, "body": "Thank you. The reason I previously felt it necessary to call <code>run</code> in a goroutine is that I want to block for the value of <code>EXEC_THROTTLE</code>, not each <code>Job</code>. As edited, it appeared that each <code>Job</code> was running sequentially, rather than executing the first two in parallel, but now from studying your answer I realize that was my misinterpretation because it was sending to <code>logger</code>as soon as <code>run</code> returned. If I edit any pair of <code>Job</code>s to have the same value of <code>runtime</code> this it is clear it is executing in parallel. I really appreciate you taking the time to clear this up."}, {"owner": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "edited": false, "score": 0, "creation_date": 1514862866, "post_id": 48054409, "comment_id": 83082705, "body": "Also, +1 for the talk by Sameer Ajmani. This is really quite profound and very well done."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 1, "last_activity_date": 1514853737, "creation_date": 1514853737, "answer_id": 48054409, "question_id": 48053950, "link": "https://stackoverflow.com/questions/48053950/throttle-number-of-concurrent-executing-processes-via-buffered-channels-golang/48054409#48054409", "title": "Throttle number of concurrent executing processes via buffered channels (Golang)", "body": "<p>If I understand you right, you mean to establish a mechanism to ensure that at any time at most a number of <code>EXEC_THROTTLE</code> jobs are running. And if that is your intention, the code does not work.</p>\n\n<p>It is because when you <strong>start</strong> a job, you have already consumed the channel - allowing another job to be started, yet no jobs have been finished. You can debug this by add an counter (you'll need atomic add or mutex).</p>\n\n<p>You may do the work by simply start a group of goroutine with an unbuffered channel and block when executating jobs:</p>\n\n<pre><code>func Run(j Job) r Result {\n    //Run your job here\n}\n\nfunc Dispatch(ch chan Job) {\n    for j:=range ch {\n        wg.Add(1)\n        Run(j)\n        wg.Done()\n    }\n}\n\nfunc main() {\n    ch := make(chan Job)\n    for i:=0; i&lt;EXEC_THROTTLE; i++ {\n        go Dispatch(ch)\n    }\n    //call dispatch according to the queue here.\n}\n</code></pre>\n\n<p>It works because as along as one goroutine is consuming the channel, it means at least one goroutine is not running and there is at most <code>EXEC_THROTTLE-1</code> jobs running so it is good to execuate one more and it does so.</p>\n"}, {"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514875359, "post_id": 48056234, "comment_id": 83085361, "body": "Your second part of code has unmatched bracelets. I am having trouble to understand how it work so I won&#39;t edit for you."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514875956, "post_id": 48056234, "comment_id": 83085567, "body": "Ok I get it and fixed it for you. But I would say, it is so over-complicated on such an issue."}, {"owner": {"reputation": 799, "user_id": 2980967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ecQ8D.jpg?s=128&g=1", "display_name": "dustinevan", "link": "https://stackoverflow.com/users/2980967/dustinevan"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514876495, "post_id": 48056234, "comment_id": 83085767, "body": "Well, If you&#39;re just doing a little playground app, sure. But if you&#39;re trying to manage the use of external resources, then it&#39;s real nice to just say: <code>sem.Acquire()</code> then <code>sem.Release()</code> when using resources. As you&#39;ve shown above, workers are also a way of solving this problem."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514877095, "post_id": 48056234, "comment_id": 83085970, "body": "If the code contains some option for auctual memory management, or capabilities for distributed calculation, I would really appreciate the abstract. But as it is just some wraps around a buffered channel doing basic stuff, the code seem unnature and redunctant to me. But that is a very personal point of view."}], "tags": [], "owner": {"reputation": 799, "user_id": 2980967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ecQ8D.jpg?s=128&g=1", "display_name": "dustinevan", "link": "https://stackoverflow.com/users/2980967/dustinevan"}, "is_accepted": false, "score": 0, "last_activity_date": 1514873057, "creation_date": 1514873057, "answer_id": 48056234, "question_id": 48053950, "link": "https://stackoverflow.com/questions/48053950/throttle-number-of-concurrent-executing-processes-via-buffered-channels-golang/48056234#48056234", "title": "Throttle number of concurrent executing processes via buffered channels (Golang)", "body": "<p>I use this a lot. <a href=\"https://github.com/dustinevan/go-utils\" rel=\"nofollow noreferrer\">https://github.com/dustinevan/go-utils</a></p>\n\n<pre><code>package async\nimport (\n    \"context\"\n\n    \"github.com/pkg/errors\"\n)\n\ntype Semaphore struct {\n    buf    chan struct{}\n    ctx    context.Context\n    cancel context.CancelFunc\n}\n\nfunc NewSemaphore(max int, parentCtx context.Context) *Semaphore {\n\n    s := &amp;Semaphore{\n        buf:    make(chan struct{}, max),\n        ctx:    parentCtx,\n    }\n\n    go func() {\n        &lt;-s.ctx.Done()\n        close(s.buf)\n        drainStruct(s.buf)\n    }()\n\n    return s\n}\n\nvar CLOSED = errors.New(\"the semaphore has been closed\")\n\nfunc (s *Semaphore) Acquire() error {\n    select {\n    case &lt;-s.ctx.Done():\n        return CLOSED\n    case s.buf &lt;- struct{}{}:\n        return nil\n    }\n}\n\nfunc (s *Semaphore) Release() {\n    &lt;-s.buf\n}\n</code></pre>\n\n<p>you'd use it like this:</p>\n\n<pre><code>func main() {\n\n    sem := async.NewSemaphore(10, context.Background())\n    ...\n    var wg sync.Waitgroup \n    for _, job := range jobs {\n        go func() {\n            wg.Add(1)\n            err := sem.Acquire()\n            if err != nil {\n                 // handle err, \n            }\n            defer sem.Release()\n            defer wg.Done()\n            job()\n    }\n    wg.Wait()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3360, "user_id": 329463, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cc84f018e9d2d814cd7c1feffb6d624a?s=128&d=identicon&r=PG", "display_name": "vearutop", "link": "https://stackoverflow.com/users/329463/vearutop"}, "is_accepted": false, "score": 2, "last_activity_date": 1562765203, "last_edit_date": 1562765203, "creation_date": 1557906817, "answer_id": 56144181, "question_id": 48053950, "link": "https://stackoverflow.com/questions/48053950/throttle-number-of-concurrent-executing-processes-via-buffered-channels-golang/56144181#56144181", "title": "Throttle number of concurrent executing processes via buffered channels (Golang)", "body": "<p>You can also cap concurrency with buffered channel:</p>\n\n<pre><code>concurrencyLimit := 2 // Number of simultaneous jobs.\nlimiter := make(chan struct{}, concurrencyLimit)\nfor job := range jobs {\n    job := job // Pin loop variable.\n    limiter &lt;- struct{}{} // Reserve limiter slot.\n    go func() {\n        defer func() {\n            &lt;-limiter // Free limiter slot.\n        }()\n\n        do(job) // Do the job.\n    }()\n}\n// Wait for goroutines to finish by filling full channel.\nfor i := 0; i &lt; cap(limiter); i++ {\n    limiter &lt;- struct{}{}\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 326, "user_id": 2622328, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tYk8d.jpg?s=128&g=1", "display_name": "Pradip Vaghasiya", "link": "https://stackoverflow.com/users/2622328/pradip-vaghasiya"}, "is_accepted": false, "score": 1, "last_activity_date": 1562418860, "creation_date": 1562418860, "answer_id": 56914419, "question_id": 48053950, "link": "https://stackoverflow.com/questions/48053950/throttle-number-of-concurrent-executing-processes-via-buffered-channels-golang/56914419#56914419", "title": "Throttle number of concurrent executing processes via buffered channels (Golang)", "body": "<p>Replace processItem function with required execution of your job. </p>\n\n<p>Below will execute jobs in proper order. Atmost EXEC_CONCURRENT items will be executed concurrently. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nfunc processItem(i int, done chan int, wg *sync.WaitGroup) { \n    fmt.Printf(\"Async Start: %d\\n\", i)\n    time.Sleep(100 * time.Millisecond * time.Duration(i))\n    fmt.Printf(\"Async Complete: %d\\n\", i)\n    done &lt;- 1\n    wg.Done()\n}\n\nfunc popItemFromBufferChannelWhenItemDoneExecuting(items chan int, done chan int) { \n    _ = &lt;- done\n    _ = &lt;-items\n}\n\n\nfunc main() {\n    EXEC_CONCURRENT := 3\n\n    items := make(chan int, EXEC_CONCURRENT)\n    done := make(chan int)\n    var wg sync.WaitGroup\n\n    for i:= 1; i &lt; 11; i++ {\n        items &lt;- i\n        wg.Add(1)   \n        go processItem(i, done, &amp;wg)\n        go popItemFromBufferChannelWhenItemDoneExecuting(items, done)\n    }\n\n    wg.Wait()\n}\n</code></pre>\n\n<p>Below will execute jobs in Random order. Atmost EXEC_CONCURRENT items will be executed concurrently. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nfunc processItem(i int, items chan int, wg *sync.WaitGroup) { \n    items &lt;- i\n    fmt.Printf(\"Async Start: %d\\n\", i)\n    time.Sleep(100 * time.Millisecond * time.Duration(i))\n    fmt.Printf(\"Async Complete: %d\\n\", i)\n    _ = &lt;- items\n    wg.Done()\n}\n\nfunc main() {\n    EXEC_CONCURRENT := 3\n\n    items := make(chan int, EXEC_CONCURRENT)\n    var wg sync.WaitGroup\n\n    for i:= 1; i &lt; 11; i++ {\n        wg.Add(1)   \n        go processItem(i, items, &amp;wg)\n    }\n\n    wg.Wait()\n}\n</code></pre>\n\n<p>You can choose according to your requirement.</p>\n"}], "owner": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1647, "favorite_count": 0, "accepted_answer_id": 48054409, "answer_count": 4, "score": 1, "last_activity_date": 1562765203, "creation_date": 1514847500, "last_edit_date": 1514862034, "question_id": 48053950, "link": "https://stackoverflow.com/questions/48053950/throttle-number-of-concurrent-executing-processes-via-buffered-channels-golang", "title": "Throttle number of concurrent executing processes via buffered channels (Golang)", "body": "<p>Intent:</p>\n\n<p>I am looking for a means to run os-level shell commands in parallel, but want to be careful to not clobber CPU and am wondering if a buffered channel would fit this use case.</p>\n\n<p>Implemented:</p>\n\n<p>Create a series of <code>Job</code>s with a simulated runtime duration. Send these jobs to a queue which will <code>dispatch</code> them to <code>run</code> over a buffered channel as throttled by <code>EXEC_THROTTLE</code>.</p>\n\n<p>Observations:</p>\n\n<p>This 'works' (to the extent that it compiles and runs), but I am wondering if the buffer is working as specified (see: 'Intent') to throttle the number of processes running in parallel.</p>\n\n<p>Disclaimer:</p>\n\n<p>Now, I am aware that newbies tend to over-use channels, but I feel this request for insight is honest, as I've at least exercised the restraint to use a <code>sync.WaitGroup</code>. Forgive the somewhat toy example, but all insight would be appreciated.</p>\n\n<p><a href=\"https://play.golang.org/p/wS_WefJ2vqy\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<pre><code>package main\n\nimport (\n    // \"os/exec\"\n    \"log\"\n    \"math/rand\"\n    \"strconv\"\n    \"sync\"\n    \"time\"\n)\n\nconst (\n    EXEC_THROTTLE = 2\n)\n\ntype JobsManifest []Job\n\ntype Job struct {\n    cmd     string\n    result  string\n    runtime int // Simulate long-running task\n}\n\nfunc (j JobsManifest) queueJobs(logChan chan&lt;- string, runChan chan Job, wg *sync.WaitGroup) {\n    go dispatch(logChan, runChan)\n    for _, job := range j {\n        wg.Add(1)\n        runChan &lt;- job\n    }\n}\n\nfunc dispatch(logChan chan&lt;- string, runChan chan Job) {\n    for j := range runChan {\n        go run(j, logChan)\n    }\n}\n\nfunc run(j Job, logChan chan&lt;- string) {\n    time.Sleep(time.Second * time.Duration(j.runtime))\n    j.result = strconv.Itoa(rand.Intn(10)) // j.result = os.Exec(\"/bin/bash\", \"-c\", j.cmd).Output()\n    logChan &lt;- j.result\n    log.Printf(\"   ran: %s\\n\", j.cmd)\n}\n\nfunc logger(logChan &lt;-chan string, wg *sync.WaitGroup) {\n    for {\n        res := &lt;-logChan\n        log.Printf(\"logged: %s\\n\", res)\n        wg.Done()\n    }\n}\n\nfunc main() {\n\n    jobs := []Job{\n        Job{\n            cmd:     \"ps -p $(pgrep vim) | tail -n 1 | awk '{print $3}'\",\n            runtime: 1,\n        },\n        Job{\n            cmd:     \"wc -l /var/log/foo.log | awk '{print $1}'\",\n            runtime: 2,\n        },\n        Job{\n            cmd:     \"ls -l ~/go/src/github.com/ | wc -l | awk '{print $1}'\",\n            runtime: 3,\n        },\n        Job{\n            cmd:     \"find /var/log/ -regextype posix-extended -regex '.*[0-9]{10}'\",\n            runtime: 4,\n        },\n    }\n\n    var wg sync.WaitGroup\n    logChan := make(chan string)\n    runChan := make(chan Job, EXEC_THROTTLE)\n    go logger(logChan, &amp;wg)\n\n    start := time.Now()\n    JobsManifest(jobs).queueJobs(logChan, runChan, &amp;wg)\n    wg.Wait()\n    log.Printf(\"finish: %s\\n\", time.Since(start))\n}\n</code></pre>\n"}, {"tags": ["go", "ssh", "timeout"], "comments": [{"owner": {"reputation": 1592, "user_id": 7251967, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-al-If026iHU/AAAAAAAAAAI/AAAAAAAAABE/9lsheyH-V9Q/photo.jpg?sz=128", "display_name": "negi Yogi", "link": "https://stackoverflow.com/users/7251967/negi-yogi"}, "edited": false, "score": 0, "creation_date": 1514875718, "post_id": 48053349, "comment_id": 83085484, "body": "instead of using ssh.Dial  use DialTimeout  e.g :-   listener, err := net.DialTimeout(&quot;tcp&quot;, &quot;192.xxx.x.xxx:8899&quot;, 10*time.Second) \tif err != nil { \t\tfmt.Printf(&quot;connection error &quot;, err.Error()) \t} DialTimeout acts like Dial but takes a timeout."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514885066, "post_id": 48053349, "comment_id": 83088991, "body": "I am curious at what makes the code hang. Would you please provide some more info on the situation?"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1514907964, "post_id": 48053770, "comment_id": 83100553, "body": "That doesn&#39;t timeout anything, and just leaves the hanging function running indefinitely, which may or may not be tying up system resources."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1515297758, "post_id": 48053770, "comment_id": 83245719, "body": "But it\u2019s not \u201ctiming out\u201d RunRequest if it\u2019s blocked, it leaves it blocked indefinitely. If the timeout isn\u2019t working, figure what\u2019s blocked rather than ignoring it."}], "tags": [], "owner": {"reputation": 45, "user_id": 9092157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64dea89df17f3006c22af0f849b99acb?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Johnson", "link": "https://stackoverflow.com/users/9092157/jack-johnson"}, "is_accepted": false, "score": 0, "last_activity_date": 1514845795, "creation_date": 1514845795, "answer_id": 48053770, "question_id": 48053349, "link": "https://stackoverflow.com/questions/48053349/golang-custom-timeout-solution/48053770#48053770", "title": "Golang custom timeout solution", "body": "<p>Did this and it worked:</p>\n\n<pre><code>    c1 := make(chan bool, 1)\n    go RunRequest(element, authInfo, c1)\n    select {\n        case &lt;-c1:\n        case &lt;-time.After(time.Second * 4):\n    }\n</code></pre>\n\n<p>The ssh.Dial was inside the RunRequest GoRoutine.</p>\n"}, {"comments": [{"owner": {"reputation": 45, "user_id": 9092157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64dea89df17f3006c22af0f849b99acb?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Johnson", "link": "https://stackoverflow.com/users/9092157/jack-johnson"}, "edited": false, "score": 2, "creation_date": 1515297062, "post_id": 48056469, "comment_id": 83245631, "body": "It takes a timeout. It just doesn&#39;t respect it and will hang on some IPs indefinitely."}], "tags": [], "owner": {"reputation": 799, "user_id": 2980967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ecQ8D.jpg?s=128&g=1", "display_name": "dustinevan", "link": "https://stackoverflow.com/users/2980967/dustinevan"}, "is_accepted": false, "score": 1, "last_activity_date": 1514874443, "creation_date": 1514874443, "answer_id": 48056469, "question_id": 48053349, "link": "https://stackoverflow.com/questions/48053349/golang-custom-timeout-solution/48056469#48056469", "title": "Golang custom timeout solution", "body": "<p>It looks like the config takes a timeout. See: <a href=\"https://godoc.org/golang.org/x/crypto/ssh#ClientConfig\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/crypto/ssh#ClientConfig</a></p>\n\n<p>in other words: </p>\n\n<pre><code>conn, err := ssh.Dail(\"tcp\", \"X.X.X.X:22\", ssh.ClientConfig{Timeout: time.Second * 4})\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 9092157, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64dea89df17f3006c22af0f849b99acb?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Johnson", "link": "https://stackoverflow.com/users/9092157/jack-johnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1514874443, "creation_date": 1514841886, "question_id": 48053349, "link": "https://stackoverflow.com/questions/48053349/golang-custom-timeout-solution", "title": "Golang custom timeout solution", "body": "<p>I need to create a custom timeout solution for <code>ssh.Dial</code>. I tried setting the timeout in the sshConfig, but it just doesn't work sometimes which causes the whole program to hang. </p>\n\n<pre><code>connection, err := ssh.Dial(\"tcp\", \"X.X.X.X:22\", sshConfig)\n</code></pre>\n\n<p>In some cases it times out, it works in other cases. But it stumbles on specific IPs and doesn't do <em>anything</em>. It just hangs the entire program.</p>\n\n<p>So how would I go about coding \"my own\" timeout solution for this line of code?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1514838823, "post_id": 48052917, "comment_id": 83078240, "body": "You need to implement your own marshaller for a custom datatype (eg: name it <code>MyRawMessage</code>). You can find something very similar in <a href=\"https://stackoverflow.com/questions/14177862/how-to-marshal-a-byte-uint8-array-as-json-array-in-go\" title=\"how to marshal a byte uint8 array as json array in go\">stackoverflow.com/questions/14177862/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 0, "last_activity_date": 1514906853, "creation_date": 1514906853, "answer_id": 48063575, "question_id": 48052917, "link": "https://stackoverflow.com/questions/48052917/preserve-json-rawmessage-through-multiple-marshallings/48063575#48063575", "title": "Preserve json.RawMessage through multiple marshallings", "body": "<p>You will need a custom type with its own marshaler, in place of <code>json.RawMessage</code> for your <code>VerifiedSignatureReq</code> struct to use.  Example:</p>\n\n<pre><code>type VerifiedSignatureReq {\n    Raw           RawMessage  `json:\"random\"`\n    Signature     string      `json:\"signature\"`\n}\n\ntype RawMessage []byte\n\nfunc (m RawMessage) MarshalJSON() ([]byte, error) {\n    return []byte(m), nil\n}\n</code></pre>\n"}], "owner": {"reputation": 7789, "user_id": 2271269, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/d7CGe.jpg?s=128&g=1", "display_name": "Akshat Mahajan", "link": "https://stackoverflow.com/users/2271269/akshat-mahajan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 271, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1514906853, "creation_date": 1514837744, "last_edit_date": 1514838113, "question_id": 48052917, "link": "https://stackoverflow.com/questions/48052917/preserve-json-rawmessage-through-multiple-marshallings", "title": "Preserve json.RawMessage through multiple marshallings", "body": "<h1>Background</h1>\n\n<p>I'm working with JSON data that must be <a href=\"https://www.wikiwand.com/en/Non-repudiation\" rel=\"nofollow noreferrer\">non-repudiable</a>. </p>\n\n<p>The API that grants me this data also has a service to verify that the data originally came from them. </p>\n\n<p><a href=\"https://api.random.org/verify/manual\" rel=\"nofollow noreferrer\">As best as I can tell</a>, they do this by requiring that the complete JSON they originally sent needs to be supplied to them inside another JSON request, with no byte changes. </p>\n\n<h1>Issue</h1>\n\n<p>I can't seem to preserve the original JSON!</p>\n\n<p>Because I cannot modify the original JSON, I have carefully preserved it as a <code>json.RawMessage</code> when unmarshalling:</p>\n\n<pre><code>// struct I unmarshal my original data into \ntype SignedResult struct {\n    Raw           json.RawMessage `json:\"random\"`\n    Signature     string          `json:\"signature\"`\n    ...\n}\n\n// struct I marshal my data back into\ntype VerifiedSignatureReq {\n    Raw          json.RawMessage  `json:\"random\"`\n    Signature     string          `json:\"signature\"`\n}\n\n// ... getData is placeholder for function that gets my data\nresponse := SignedResult{}\nx, _ := json.Unmarshal(getData(), &amp;response)\n\n// do some post-processing with SignedResult that does not alter `Raw` or `Signature`\n\n// trouble begins here - x.Raw started off as json.RawMessage...\ny := json.Marshal(VerifiedSignatureReq{Raw: x.Raw, Signature: x.Signature}\n\n// but now y.Raw is base64-encoded.\n</code></pre>\n\n<p>The problem is that <a href=\"https://stackoverflow.com/questions/34089750/go-marshal-byte-to-json-giving-a-strange-string\"><code>[]bytes</code> / <code>RawMessages</code> are base64-encoded when marshaled</a>. So I can't use this method, because it completely alters the string.</p>\n\n<p>I'm unsure how to ensure this string is correctly preserved. I had assumed that the <code>json.RawMessage</code> specification in my struct would survive the perils of marshaling an already marshaled instance because it implements the <code>Marshaler</code> interface, but I appear mistaken. </p>\n\n<h1>Things I've Tried</h1>\n\n<p>My next attempt was to try:</p>\n\n<pre><code>// struct I unmarshal my original data into \ntype SignedResult struct {\n    Raw           json.RawMessage `json:\"random\"`\n    Signature     string          `json:\"signature\"`\n    ...\n}\n\n// struct I marshal my data back into\ntype VerifiedSignatureReq {\n    Raw          map[string]interface{}  `json:\"random\"`\n    Signature     string          `json:\"signature\"`\n}\n\n// ... getData is placeholder for function that gets my data\nresponse := SignedResult{}\nx, _ := json.Unmarshal(getData(), &amp;response)\n\n// do some post-processing with SignedResult that does not alter `Raw` or `Signature`\n\nvar object map[string]interface{}\njson.Unmarshal(x.Raw, &amp;object)\n// now correctly generates the JSON structure.\ny := json.Marshal(VerifiedSignatureReq{Raw: object, Signature: x.Signature}\n\n// but now this is not the same JSON string as received!\n</code></pre>\n\n<p>The issue with this approach is that there are minor byte-wise differences in the spacing between the data. It no longer looks exactly the same when <code>cat</code>ted to a file.</p>\n\n<p>I cannot use <code>string(x.Raw)</code> either because it escapes certain characters when marshaled with <code>\\</code>. </p>\n"}, {"tags": ["pointers", "go", "slice"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 6, "creation_date": 1514837416, "post_id": 48052722, "comment_id": 83077949, "body": "Are you looking for an answer outside of what is mentioned in the <a href=\"https://golang.org/ref/spec#Size_and_alignment_guarantees\" rel=\"nofollow noreferrer\">language spec</a>? <i>A struct or array type has size zero if it contains no fields (or elements, respectively) that have a size greater than zero. Two distinct zero-size variables may have the same address in memory.</i>"}, {"owner": {"reputation": 510, "user_id": 3112694, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/cxTvv.png?s=128&g=1", "display_name": "Kevin Ghaboosi", "link": "https://stackoverflow.com/users/3112694/kevin-ghaboosi"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1514838234, "post_id": 48052722, "comment_id": 83078123, "body": "Thanks @TimCooper for the note. Basically yes. I wonder what <code>fmt.Println</code> does that may lead to compiler deciding to choose different address for the backing arrays&#39; elements. However, I agree that the spec note is clear enough and sufficiently convincing."}], "answers": [{"comments": [{"owner": {"reputation": 510, "user_id": 3112694, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/cxTvv.png?s=128&g=1", "display_name": "Kevin Ghaboosi", "link": "https://stackoverflow.com/users/3112694/kevin-ghaboosi"}, "edited": false, "score": 0, "creation_date": 1514838449, "post_id": 48052903, "comment_id": 83078161, "body": "Thanks @Marc for the note. I was reading exactly the same article where I had encountered the aforementioned behavior. Therein, I also noted that <code>var a, b struct{}; fmt.Println(&amp;a == &amp;b) &#47;&#47; true</code> indeed returns <code>false</code> although it was claimed to return <code>true</code>. The way I explain this to myself is based upon the same idea you and @TimCooper have recommended, i.e., the specs."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": false, "score": 2, "last_activity_date": 1514839085, "last_edit_date": 1514839085, "creation_date": 1514837585, "answer_id": 48052903, "question_id": 48052722, "link": "https://stackoverflow.com/questions/48052722/addresses-of-slices-of-empty-structs/48052903#48052903", "title": "Addresses of slices of empty structs", "body": "<p>An empty struct is basically: pretty much nothing. It's of size 0:</p>\n\n<pre><code>var s struct{}\nfmt.Println(unsafe.Sizeof(s))\n</code></pre>\n\n<p>Returns <code>0</code>.</p>\n\n<p>Now, as to why the addresses of two empty structs are sometimes the same and sometimes not, this is down to the go internals.\nThe only clue we can get is from <a href=\"https://golang.org/ref/spec#Size_and_alignment_guarantees\" rel=\"nofollow noreferrer\">the spec</a>:</p>\n\n<blockquote>\n  <p>A struct or array type has size zero if it contains no fields (or\n  elements, respectively) that have a size greater than zero. Two\n  distinct zero-size variables may have the same address in memory.</p>\n</blockquote>\n\n<p>Note also the following code, with the first print moved to last:</p>\n\n<pre><code>fmt.Println(\"&amp;a == &amp;b\", &amp;a == &amp;b)\nfmt.Println(\"&amp;a[0] == &amp;b[0]\", &amp;a[0] == &amp;b[0])\nfmt.Println(a[0], &amp;a[0])\n</code></pre>\n\n<p>This outputs:</p>\n\n<pre><code>&amp;a == &amp;b false\n&amp;a[0] == &amp;b[0] false\n{} &amp;{}\n</code></pre>\n\n<p>Or the same as your second case.\nBasically, this shows that the compiler chose to use different addresses. Given the \"may have the same address in memory\", you should not rely on equality as the exact behavior depends on go internals and may change at any time.</p>\n\n<p>For further reading, I would recommend <a href=\"https://dave.cheney.net/2014/03/25/the-empty-struct\" rel=\"nofollow noreferrer\">this excellent article on the empty struct</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 510, "user_id": 3112694, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/cxTvv.png?s=128&g=1", "display_name": "Kevin Ghaboosi", "link": "https://stackoverflow.com/users/3112694/kevin-ghaboosi"}, "edited": false, "score": 0, "creation_date": 1514841856, "post_id": 48053270, "comment_id": 83078920, "body": "Thanks @icza for the response. Very interesting and detailed explanation. They look sufficiently convincing to me."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1514864790, "post_id": 48053270, "comment_id": 83083027, "body": "I will not be surprised if escape analysis has something to do with the issue, but it&#39;s not the entire story.  In <a href=\"https://play.golang.org/p/hfUz0F2iMCz\" rel=\"nofollow noreferrer\">play.golang.org/p/hfUz0F2iMCz</a>,  <code>&amp;a[0]</code> does not escape, <code>&amp;b[0]</code> do does not escape and <code>&amp;a[0] != &amp;b[0]</code>.  In <a href=\"https://play.golang.org/p/zeaphGffFjN\" rel=\"nofollow noreferrer\">play.golang.org/p/zeaphGffFjN</a>, <code>&amp;a[0]</code> escapes, <code>&amp;b[0]</code> escapes and <code>&amp;a[0] == &amp;b[0]</code>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1514903835, "post_id": 48053270, "comment_id": 83098394, "body": "@CeriseLim&#243;n You&#39;re right, there is more in the background than just the pointer escaping. Your 2nd example could be reasoned with using the same &quot;dynamically&quot; allocated backing array for both <code>a</code> and <code>b</code> as they both escape."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1514905122, "post_id": 48053270, "comment_id": 83099059, "body": "See <a href=\"https://github.com/golang/go/blob/6317adeed7815ad335e2e97c463a7c3c4d82fc19/src/runtime/malloc.go#L586\" rel=\"nofollow noreferrer\">this line in the runtime source code</a> for why &quot;dynamically&quot; allocated backing arrays share the same address."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1514885376, "last_edit_date": 1514885376, "creation_date": 1514841176, "answer_id": 48053270, "question_id": 48052722, "link": "https://stackoverflow.com/questions/48052722/addresses-of-slices-of-empty-structs/48053270#48053270", "title": "Addresses of slices of empty structs", "body": "<p>Before going any deeper, know that according to the spec, a program is correct regardless of whether it yields equal or different addresses for values having zero size, as the spec only states that they <em>may</em> be the same, but does not require them to be the same.</p>\n\n<p><a href=\"https://golang.org/ref/spec#Size_and_alignment_guarantees\" rel=\"nofollow noreferrer\">Spec: Size and alignment guarantees:</a></p>\n\n<blockquote>\n  <p>A struct or array type has size zero if it contains no fields (or elements, respectively) that have a size greater than zero. Two distinct zero-size variables <strong>may</strong> have the same address in memory.</p>\n</blockquote>\n\n<p>So what you experience is an implementation detail. There are more details and factors to the decisions made, the following explanation is valid and sufficient only to your concrete examples:</p>\n\n<p>In your first example addresses of the backing array(s) for your slices are only used inside the <code>main()</code> function, they don't escape to the heap. What you print is only the result of the comparison of the addresses. These are just <code>bool</code> values, they don't include the address values. So the compiler chooses to use the same address for the backing array of <code>a</code> and <code>b</code>.</p>\n\n<p>In your second example addresses of the backing arrays (more specifically addresses of some elements of the backing arrays) are used <em>outside</em> of the <code>main()</code> function, they are passed to and used inside the <code>fmt.Println()</code> function, because you are also printing these addresses.</p>\n\n<p>We can \"prove\" this by passing the <code>-gcflags '-m'</code> params to the Go tool, asking it to print the result of the escape analysis.</p>\n\n<p>In your first example, saving your code in <code>play.go</code>, running the <code>go run -gcflags '-m' play.go</code> command, the output is:</p>\n\n<pre><code>./play.go:10:14: \"&amp;a == &amp;b\" escapes to heap\n./play.go:10:29: &amp;a == &amp;b escapes to heap\n./play.go:11:14: \"&amp;a[0] == &amp;b[0]\" escapes to heap\n./play.go:11:38: &amp;a[0] == &amp;b[0] escapes to heap\n./play.go:8:11: main make([]struct {}, 10) does not escape\n./play.go:9:11: main make([]struct {}, 20) does not escape\n./play.go:10:26: main &amp;a does not escape\n./play.go:10:32: main &amp;b does not escape\n./play.go:10:13: main ... argument does not escape\n./play.go:11:32: main &amp;a[0] does not escape\n./play.go:11:41: main &amp;b[0] does not escape\n./play.go:11:13: main ... argument does not escape\n&amp;a == &amp;b false\n&amp;a[0] == &amp;b[0] true\n</code></pre>\n\n<p>As we can see, addresses don't escape.</p>\n\n<p>Running <code>go run -gcflags '-m' play.go</code> with your second example, the output is:</p>\n\n<pre><code>./play.go:10:15: a[0] escapes to heap\n./play.go:10:20: &amp;a[0] escapes to heap\n./play.go:10:20: &amp;a[0] escapes to heap\n./play.go:8:11: make([]struct {}, 10) escapes to heap\n./play.go:11:14: \"&amp;a == &amp;b\" escapes to heap\n./play.go:11:29: &amp;a == &amp;b escapes to heap\n./play.go:12:14: \"&amp;a[0] == &amp;b[0]\" escapes to heap\n./play.go:12:38: &amp;a[0] == &amp;b[0] escapes to heap\n./play.go:9:11: main make([]struct {}, 20) does not escape\n./play.go:10:13: main ... argument does not escape\n./play.go:11:26: main &amp;a does not escape\n./play.go:11:32: main &amp;b does not escape\n./play.go:11:13: main ... argument does not escape\n./play.go:12:32: main &amp;a[0] does not escape\n./play.go:12:41: main &amp;b[0] does not escape\n./play.go:12:13: main ... argument does not escape\n{} &amp;{}\n&amp;a == &amp;b false\n&amp;a[0] == &amp;b[0] false\n</code></pre>\n\n<p>As you can see, <code>a[0]</code>, <code>&amp;a[0]</code> escape to heap, so the backing array of <code>a</code> is dynamically allocated, and thus it will have a different address than that of <code>b</code>'s.</p>\n\n<p>Let's \"prove\" this further. Let's modify your second example, to have a third variable <code>c</code> whose address will also not be printed, and let's compare <code>b</code> to <code>c</code>:</p>\n\n<pre><code>a := make([]struct{}, 10)\nb := make([]struct{}, 20)\nc := make([]struct{}, 30)\nfmt.Println(a[0], &amp;a[0])\nfmt.Println(\"&amp;a == &amp;b\", &amp;a == &amp;b)\nfmt.Println(\"&amp;a[0] == &amp;b[0]\", &amp;a[0] == &amp;b[0])\nfmt.Println(\"&amp;b == &amp;c\", &amp;b == &amp;c)\nfmt.Println(\"&amp;b[0] == &amp;c[0]\", &amp;b[0] == &amp;c[0])\n</code></pre>\n\n<p>Running <code>go run -gcflags '-m' play.go</code> on this, the output is:</p>\n\n<pre><code>./play.go:11:15: a[0] escapes to heap\n./play.go:11:20: &amp;a[0] escapes to heap\n./play.go:11:20: &amp;a[0] escapes to heap\n./play.go:8:11: make([]struct {}, 10) escapes to heap\n./play.go:12:14: \"&amp;a == &amp;b\" escapes to heap\n./play.go:12:29: &amp;a == &amp;b escapes to heap\n./play.go:13:14: \"&amp;a[0] == &amp;b[0]\" escapes to heap\n./play.go:13:38: &amp;a[0] == &amp;b[0] escapes to heap\n./play.go:14:14: \"&amp;b == &amp;c\" escapes to heap\n./play.go:14:29: &amp;b == &amp;c escapes to heap\n./play.go:15:14: \"&amp;b[0] == &amp;c[0]\" escapes to heap\n./play.go:15:38: &amp;b[0] == &amp;c[0] escapes to heap\n./play.go:9:11: main make([]struct {}, 20) does not escape\n./play.go:10:11: main make([]struct {}, 30) does not escape\n./play.go:11:13: main ... argument does not escape\n./play.go:12:26: main &amp;a does not escape\n./play.go:12:32: main &amp;b does not escape\n./play.go:12:13: main ... argument does not escape\n./play.go:13:32: main &amp;a[0] does not escape\n./play.go:13:41: main &amp;b[0] does not escape\n./play.go:13:13: main ... argument does not escape\n./play.go:14:26: main &amp;b does not escape\n./play.go:14:32: main &amp;c does not escape\n./play.go:14:13: main ... argument does not escape\n./play.go:15:32: main &amp;b[0] does not escape\n./play.go:15:41: main &amp;c[0] does not escape\n./play.go:15:13: main ... argument does not escape\n{} &amp;{}\n&amp;a == &amp;b false\n&amp;a[0] == &amp;b[0] false\n&amp;b == &amp;c false\n&amp;b[0] == &amp;c[0] true\n</code></pre>\n\n<p>Since only <code>&amp;a[0]</code> is printed but not <code>&amp;b[0]</code> nor <code>&amp;c[0]</code>, thus <code>&amp;a[0] == &amp;b[0]</code> will be <code>false</code> but <code>&amp;b[0] == &amp;c[0]</code> will be <code>true</code>.</p>\n"}], "owner": {"reputation": 510, "user_id": 3112694, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/cxTvv.png?s=128&g=1", "display_name": "Kevin Ghaboosi", "link": "https://stackoverflow.com/users/3112694/kevin-ghaboosi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 831, "favorite_count": 4, "accepted_answer_id": 48053270, "answer_count": 2, "score": 7, "last_activity_date": 1537466149, "creation_date": 1514835853, "last_edit_date": 1537466149, "question_id": 48052722, "link": "https://stackoverflow.com/questions/48052722/addresses-of-slices-of-empty-structs", "title": "Addresses of slices of empty structs", "body": "<p>I have a basic question on <code>empty struct</code>s and am trying to get my head around the following different outputs I am getting when attempting to get the address of backing arrays' elements for two slices:</p>\n\n<pre><code>a := make([]struct{}, 10)\nb := make([]struct{}, 20)\nfmt.Println(\"&amp;a == &amp;b\", &amp;a == &amp;b)\nfmt.Println(\"&amp;a[0] == &amp;b[0]\", &amp;a[0] == &amp;b[0])\n</code></pre>\n\n<p>The above snippet <a href=\"https://play.golang.org/p/64i5lA3BgDk\" rel=\"nofollow noreferrer\">returns</a>:</p>\n\n<pre><code>&amp;a == &amp;b false\n&amp;a[0] == &amp;b[0] true\n</code></pre>\n\n<p>However, considering the following slightly changed snippet:</p>\n\n<pre><code>a := make([]struct{}, 10)\nb := make([]struct{}, 20)\nfmt.Println(a[0], &amp;a[0])\nfmt.Println(\"&amp;a == &amp;b\", &amp;a == &amp;b)\nfmt.Println(\"&amp;a[0] == &amp;b[0]\", &amp;a[0] == &amp;b[0])\n</code></pre>\n\n<p>The above snippet <a href=\"https://play.golang.org/p/5GRmA3bsuur\" rel=\"nofollow noreferrer\">returns</a>:</p>\n\n<pre><code>{} &amp;{}\n&amp;a == &amp;b false\n&amp;a[0] == &amp;b[0] false\n</code></pre>\n\n<p>Can someone please explain the reason for the above difference? Thank you!</p>\n\n<p><strong>[Follow Up]</strong> Making the following modifications:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype S struct{}\n\nfunc (s *S) addr() { fmt.Printf(\"%p\\n\", s) }\n\nfunc main() {\n    a := make([]S, 10)\n    b := make([]S, 20)\n    fmt.Println(a[0], &amp;a[0])\n    fmt.Println(\"&amp;a == &amp;b\", &amp;a == &amp;b)\n    fmt.Println(\"&amp;a[0] == &amp;b[0]\", &amp;a[0] == &amp;b[0])\n    //a[0].addr()\n    //b[0].addr()\n}\n</code></pre>\n\n<p>Still returns the same output:</p>\n\n<pre><code>{} &amp;{}\n&amp;a == &amp;b false\n&amp;a[0] == &amp;b[0] false\n</code></pre>\n\n<p>Though, uncommenting the method calls, <a href=\"https://play.golang.org/p/DWViA8JxGTN\" rel=\"nofollow noreferrer\">returns</a>:</p>\n\n<pre><code>{} &amp;{}\n&amp;a == &amp;b false\n&amp;a[0] == &amp;b[0] true\n0x19583c // ==&gt; [depends upon env]\n0x19583c // ==&gt; [depends upon env]\n</code></pre>\n"}, {"tags": ["go", "networking", "ssh", "network-programming", "cisco"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514903022, "post_id": 48052483, "comment_id": 83097939, "body": "I am thinking that the <code>user</code> and <code>password</code> prompt isn&#39;t a part of ssh auth but an app auth. Try <code>ssh user@ip:port</code> and see if you need to type user again."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514903133, "post_id": 48052483, "comment_id": 83098000, "body": "If that is the case, I think you can try <code>stdin.Write</code> and write your username, and password before <code>show ap summary</code>. I am curious that why you choose <code>\\r</code> as a line break, and I think you should replace it with <code>\\n</code>."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514903240, "post_id": 48052483, "comment_id": 83098069, "body": "And for the output. Your <code>fmt.Println(loadStr)</code> printed the welcome and prompt, and after that, you send the <code>show ap summary</code>, and did not require any other action. It exits naturelly."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514903332, "post_id": 48052483, "comment_id": 83098132, "body": "After you done with the auth part, you&#39;ll need <code>session.Run</code> to run a command; the <code>std</code> pipelines are for programs that is running, not the shell itself."}, {"owner": {"reputation": 267, "user_id": 8020595, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e03b1dff3295eab007f791de5f787f60?s=128&d=identicon&r=PG&f=1", "display_name": "mwalto7", "link": "https://stackoverflow.com/users/8020595/mwalto7"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514918980, "post_id": 48052483, "comment_id": 83105694, "body": "@leafbebop Doing <code>ssh user@ip:port</code> does not remove the username or password prompts when logging into the controller. The output looks the same as what I have above. Also, I was using the pipeline for stdout and stderr because I eventually need to be able to send multiple commands, and I was under the impression that <code>session.Run</code> could only be run once."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514919810, "post_id": 48052483, "comment_id": 83106047, "body": "<a href=\"https://stackoverflow.com/questions/24440193/golang-ssh-how-to-run-multiple-commands-on-the-same-session\" title=\"golang ssh how to run multiple commands on the same session\">stackoverflow.com/questions/24440193/&hellip;</a> I come to this link, please check if it is helpful."}, {"owner": {"reputation": 267, "user_id": 8020595, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e03b1dff3295eab007f791de5f787f60?s=128&d=identicon&r=PG&f=1", "display_name": "mwalto7", "link": "https://stackoverflow.com/users/8020595/mwalto7"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514920860, "post_id": 48052483, "comment_id": 83106487, "body": "@leafbebop Thanks. I\u2019ve already seen that thread, but it\u2019s not much help for my case."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514921098, "post_id": 48052483, "comment_id": 83106580, "body": "Unfortunately I have no device to debug not protocol documents to relate to. Did you try using <code>stdin.Write([]byte(username+&quot;\\n&quot;))</code> ? If you did what&#39;s new or it hanged the same?"}, {"owner": {"reputation": 267, "user_id": 8020595, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e03b1dff3295eab007f791de5f787f60?s=128&d=identicon&r=PG&f=1", "display_name": "mwalto7", "link": "https://stackoverflow.com/users/8020595/mwalto7"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514928440, "post_id": 48052483, "comment_id": 83109687, "body": "@leafbebop Just tried that and I still get the same output; no errors or anything new."}], "answers": [{"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514945761, "post_id": 48068908, "comment_id": 83114411, "body": "I need to point out that the part &quot;fixing&quot; the problem is binding <code>stout</code> to <code>os.Stdout</code>. You get all the stuff but you did not read it nor print it in your original code after writing to stdin."}], "tags": [], "owner": {"reputation": 267, "user_id": 8020595, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e03b1dff3295eab007f791de5f787f60?s=128&d=identicon&r=PG&f=1", "display_name": "mwalto7", "link": "https://stackoverflow.com/users/8020595/mwalto7"}, "is_accepted": true, "score": 2, "last_activity_date": 1514933487, "creation_date": 1514933487, "answer_id": 48068908, "question_id": 48052483, "link": "https://stackoverflow.com/questions/48052483/golang-ssh-to-cisco-wireless-controller-and-run-commands/48068908#48068908", "title": "Golang SSH to Cisco Wireless Controller and Run Commands", "body": "<p>Finally got it working. Here is my new code inspired by <a href=\"https://stackoverflow.com/questions/44449543/entering-ssh-prompt-data\">this post</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"golang.org/x/crypto/ssh\"\n    \"log\"\n    \"io/ioutil\"\n    \"os\"\n    \"strings\"\n    \"path/filepath\"\n    \"bufio\"\n    \"fmt\"\n    \"errors\"\n    \"time\"\n)\n\nfunc main() {\n    client, err := authenticate(\"10.4.112.11\", \"mwalto7\", \"lion$Tiger$Bear$\")\n    if err != nil {\n        log.Fatalf(\"unable to connect: %v\", err)\n    }\n    defer client.Close()\n\n    // Create a session\n    session, err := client.NewSession()\n    if err != nil {\n        log.Fatal(\"Failed to create session: \", err)\n    }\n    defer session.Close()\n\n    stdin, err := session.StdinPipe()\n    if err != nil {\n        log.Fatal(err)\n    }\n    session.Stdout = os.Stdout\n    session.Stderr = os.Stderr\n\n    if err := session.Shell(); err != nil {\n        log.Fatal(err)\n    }\n\n    for _, cmd := range os.Args[1:] {\n        stdin.Write([]byte(cmd + \"\\n\"))\n    }\n\n    stdin.Write([]byte(\"logout\\n\"))\n    stdin.Write([]byte(\"N\\n\"))\n\n    session.Wait()\n}\n\nfunc authenticate(host, username, password string) (ssh.Client, error) {\n    hostKey, err := checkHostKey(host)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    key, err := ioutil.ReadFile(filepath.Join(os.Getenv(\"HOME\"), \".ssh\", \"id_rsa\"))\n    if err != nil {\n        log.Fatalf(\"unable to read private key: %v\", err)\n    }\n\n    // Create the Signer for this private key.\n    signer, err := ssh.ParsePrivateKey(key)\n    if err != nil {\n        log.Fatalf(\"unable to parse private key: %v\", err)\n    }\n\n    // Create client config\n    config := &amp;ssh.ClientConfig{\n        User: username,\n        Auth: []ssh.AuthMethod{\n            ssh.Password(password),\n            // Use the PublicKeys method for remote authentication.\n            ssh.PublicKeys(signer),\n        },\n        HostKeyCallback: ssh.FixedHostKey(hostKey),\n        Timeout: time.Second * 5,\n    }\n\n    // Connect to the remote server and perform the SSH handshake.\n    client, err := ssh.Dial(\"tcp\", host+\":22\", config)\n\n    return *client, err\n}\n\nfunc checkHostKey(host string) (ssh.PublicKey, error) {\n    file, err := os.Open(filepath.Join(os.Getenv(\"HOME\"), \".ssh\", \"known_hosts\"))\n    if err != nil {\n        return nil, err\n    }\n    defer file.Close()\n\n    scanner := bufio.NewScanner(file)\n    var hostKey ssh.PublicKey\n    for scanner.Scan() {\n        fields := strings.Split(scanner.Text(), \" \")\n        if len(fields) != 3 {\n            continue\n        }\n        if strings.Contains(fields[0], host) {\n            hostKey, _, _, _, err = ssh.ParseAuthorizedKey(scanner.Bytes())\n            if err != nil {\n                return nil, errors.New(fmt.Sprintf(\"error parsing %q: %v\", fields[2], err))\n            }\n            break\n        }\n    }\n\n    if hostKey == nil {\n        return nil, errors.New(fmt.Sprintf(\"no hostkey for %s\", host))\n    }\n\n    return hostKey, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 267, "user_id": 8020595, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e03b1dff3295eab007f791de5f787f60?s=128&d=identicon&r=PG&f=1", "display_name": "mwalto7", "link": "https://stackoverflow.com/users/8020595/mwalto7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1595, "favorite_count": 1, "accepted_answer_id": 48068908, "answer_count": 1, "score": 2, "last_activity_date": 1514933523, "creation_date": 1514833881, "last_edit_date": 1514933523, "question_id": 48052483, "link": "https://stackoverflow.com/questions/48052483/golang-ssh-to-cisco-wireless-controller-and-run-commands", "title": "Golang SSH to Cisco Wireless Controller and Run Commands", "body": "<p>I am trying to SSH to a Cisco wireless controller through Go, using Go's <code>golang.org/x/crypto/ssh</code> library, to programmatically configure access points. The problem I'm running into is correctly parsing the controller CLI in Go. For example, this is the typical SSH login to the controller:</p>\n\n<pre><code>$ ssh &lt;controller_ip&gt;\n\n\n(Cisco Controller)\nUser: username\nPassword:****************\n(Cisco Controller) &gt;\n</code></pre>\n\n<p>I am trying to figure out how to send the username and then the password after the SSH session is established in Go. So far, I am able to successfully SSH to the controller, but the program exits at the username prompt, like this:</p>\n\n<pre><code>$ go run main.go \n\n\n(Cisco Controller) \nUser: \n</code></pre>\n\n<p><strong>How would I go about sending the username when prompted, then repeating that for the password prompt?</strong> </p>\n\n<p>No errors are being thrown or exit codes are being given, so I'm not sure why the program is exiting immediately at the username prompt. But Even if it wasn't exiting that way, I'm still unsure of how to send the username and password when the controller's CLI is expecting it.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"golang.org/x/crypto/ssh\"\n    \"log\"\n    \"io/ioutil\"\n    \"os\"\n    \"strings\"\n    \"path/filepath\"\n    \"bufio\"\n    \"fmt\"\n    \"errors\"\n    \"time\"\n)\n\nconst (\n    HOST = \"host\"\n)\n\nfunc main() {\n    hostKey, err := checkHostKey(HOST)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    key, err := ioutil.ReadFile(\"/Users/user/.ssh/id_rsa\")\n    if err != nil {\n        log.Fatalf(\"unable to read private key: %v\", err)\n    }\n\n    // Create the Signer for this private key.\n    signer, err := ssh.ParsePrivateKey(key)\n    if err != nil {\n        log.Fatalf(\"unable to parse private key: %v\", err)\n    }\n\n    // Create client config\n    config := &amp;ssh.ClientConfig{\n        User: \"username\",\n        Auth: []ssh.AuthMethod{\n            ssh.Password(\"password\"),\n            // Use the PublicKeys method for remote authentication.\n            ssh.PublicKeys(signer),\n        },\n        HostKeyCallback: ssh.FixedHostKey(hostKey),\n        Timeout: time.Second * 5,\n    }\n\n    // Connect to the remote server and perform the SSH handshake.\n    client, err := ssh.Dial(\"tcp\", HOST+\":22\", config)\n    if err != nil {\n        log.Fatalf(\"unable to connect: %v\", err)\n    }\n    defer client.Close()\n    // Create a session\n    session, err := client.NewSession()\n    if err != nil {\n        log.Fatal(\"Failed to create session: \", err)\n    }\n    defer session.Close()\n\n    stdin, err := session.StdinPipe()\n    if err != nil {\n        log.Fatal(err)\n    }\n    stdout, err := session.StdoutPipe()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    modes := ssh.TerminalModes{\n        ssh.ECHO:          0,\n        ssh.TTY_OP_ISPEED: 9600,\n        ssh.TTY_OP_OSPEED: 9600,\n    }\n\n    if err := session.RequestPty(\"xterm\", 0, 200, modes); err != nil {\n        log.Fatal(err)\n    }\n    if err := session.Shell(); err != nil {\n        log.Fatal(err)\n    }\n\n    buf := make([]byte, 1000)\n    n, err := stdout.Read(buf) //this reads the ssh terminal welcome message\n    loadStr := \"\"\n    if err == nil {\n        loadStr = string(buf[:n])\n    }\n    for (err == nil) &amp;&amp; (!strings.Contains(loadStr, \"(Cisco Controller)\")) {\n        n, err = stdout.Read(buf)\n        loadStr += string(buf[:n])\n    }\n    fmt.Println(loadStr)\n\n    if _, err := stdin.Write([]byte(\"show ap summary\\r\")); err != nil {\n        panic(\"Failed to run: \" + err.Error())\n    }\n}\n\nfunc checkHostKey(host string) (ssh.PublicKey, error) {\n    file, err := os.Open(filepath.Join(os.Getenv(\"HOME\"), \".ssh\", \"known_hosts\"))\n    if err != nil {\n        return nil, err\n    }\n    defer file.Close()\n\n    scanner := bufio.NewScanner(file)\n    var hostKey ssh.PublicKey\n    for scanner.Scan() {\n        fields := strings.Split(scanner.Text(), \" \")\n        if len(fields) != 3 {\n            continue\n        }\n        if strings.Contains(fields[0], host) {\n            hostKey, _, _, _, err = ssh.ParseAuthorizedKey(scanner.Bytes())\n            if err != nil {\n                return nil, errors.New(fmt.Sprintf(\"error parsing %q: %v\", fields[2], err))\n            }\n            break\n        }\n    }\n\n    if hostKey == nil {\n        return nil, errors.New(fmt.Sprintf(\"no hostkey for %s\", host))\n    }\n\n    return hostKey, nil\n}\n</code></pre>\n"}, {"tags": ["json", "go", "unmarshalling", "duration"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514823431, "post_id": 48050945, "comment_id": 83074209, "body": "For types defined outside of your project that do not implement the Unmarshaler interface, or do but in a way that is not sufficient for your requirements, you should define a &quot;wrapper&quot; type and have it implement the Unmarshaler interface so that it meets your needs."}], "answers": [{"comments": [{"owner": {"reputation": 7096, "user_id": 3990767, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0a5741a212e3b0e6bd46a8a1e6d76a4a?s=128&d=identicon&r=PG", "display_name": "SOFe", "link": "https://stackoverflow.com/users/3990767/sofe"}, "edited": false, "score": 1, "creation_date": 1530959859, "post_id": 48051946, "comment_id": 89425128, "body": "Why is it float64 not int64?"}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "reply_to_user": {"reputation": 7096, "user_id": 3990767, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0a5741a212e3b0e6bd46a8a1e6d76a4a?s=128&d=identicon&r=PG", "display_name": "SOFe", "link": "https://stackoverflow.com/users/3990767/sofe"}, "edited": false, "score": 3, "creation_date": 1530960561, "post_id": 48051946, "comment_id": 89425298, "body": "Because the JSON package unmarshals numbers into <code>interface{}</code> as <code>float64</code>."}, {"owner": {"reputation": 4578, "user_id": 5180047, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-Z8PTw2eJC9E/AAAAAAAAAAI/AAAAAAAAAco/2C4t6AgoQNc/photo.jpg?sz=128", "display_name": "Nick Brady", "link": "https://stackoverflow.com/users/5180047/nick-brady"}, "edited": false, "score": 0, "creation_date": 1553042209, "post_id": 48051946, "comment_id": 97236404, "body": "why is <code>Duration</code> a <code>struct</code> of  <code>time.Duration</code> instead of as in the other answer: i.e. <code>type Duration time.Duration</code>? Thank you in advance :)"}, {"owner": {"reputation": 116, "user_id": 4769416, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d9a246dc38ac5cfa1514b4d447f53611?s=128&d=identicon&r=PG", "display_name": "James Durand", "link": "https://stackoverflow.com/users/4769416/james-durand"}, "edited": false, "score": 0, "creation_date": 1567992667, "post_id": 48051946, "comment_id": 102121006, "body": "One thing I noticed when implementing this solution but with a type alias was that you lose some of the access to existing methods on the <code>time.Duration</code> type. So one example was that when implementing <code>MarshalJSON</code> the <code>String</code> method no longer existed."}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 33, "last_activity_date": 1514829392, "creation_date": 1514829392, "answer_id": 48051946, "question_id": 48050945, "link": "https://stackoverflow.com/questions/48050945/how-to-unmarshal-json-into-durations/48051946#48051946", "title": "How to unmarshal JSON into durations?", "body": "<p>The lack of JSON marshaling and unmarshaling methods on <code>time.Duration</code> was an unfortunate oversight. This should hopefully be resolved in Go2 (<a href=\"https://github.com/golang/go/issues/10275\" rel=\"noreferrer\">see issue #10275</a>).</p>\n\n<p>You can, however, define your own type around <code>time.Duration</code> that supports marshaling to the string representation of the duration and unmarshaling from either the numeric or string representations. Here is an example of such an implementation:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"errors\"\n    \"fmt\"\n    \"time\"\n)\n\ntype Duration struct {\n    time.Duration\n}\n\nfunc (d Duration) MarshalJSON() ([]byte, error) {\n    return json.Marshal(d.String())\n}\n\nfunc (d *Duration) UnmarshalJSON(b []byte) error {\n    var v interface{}\n    if err := json.Unmarshal(b, &amp;v); err != nil {\n        return err\n    }\n    switch value := v.(type) {\n    case float64:\n        d.Duration = time.Duration(value)\n        return nil\n    case string:\n        var err error\n        d.Duration, err = time.ParseDuration(value)\n        if err != nil {\n            return err\n        }\n        return nil\n    default:\n        return errors.New(\"invalid duration\")\n    }\n}\n\ntype Message struct {\n    Elapsed Duration `json:\"elapsed\"`\n}\n\nfunc main() {\n    msgEnc, err := json.Marshal(&amp;Message{\n        Elapsed: Duration{time.Second * 5},\n    })\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"%s\\n\", msgEnc)\n\n    var msg Message\n    if err := json.Unmarshal([]byte(`{\"elapsed\": \"1h\"}`), &amp;msg); err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"%#v\\n\", msg)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Zm6hpNR-ZJ2\" rel=\"noreferrer\">https://play.golang.org/p/Zm6hpNR-ZJ2</a></p>\n"}, {"tags": [], "owner": {"reputation": 151, "user_id": 9822864, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Alexander Polyakov", "link": "https://stackoverflow.com/users/9822864/alexander-polyakov"}, "is_accepted": false, "score": 14, "last_activity_date": 1573705137, "last_edit_date": 1573705137, "creation_date": 1549536528, "answer_id": 54571600, "question_id": 48050945, "link": "https://stackoverflow.com/questions/48050945/how-to-unmarshal-json-into-durations/54571600#54571600", "title": "How to unmarshal JSON into durations?", "body": "<p>Just to extend the previous answer. There is another way (very close to Tim's)</p>\n\n<pre><code>type Duration time.Duration \n\nfunc (d Duration) MarshalJSON() ([]byte, error) {\n    return json.Marshal(time.Duration(d).String())\n}\n\nfunc (d *Duration) UnmarshalJSON(b []byte) error {\n    var v interface{}\n    if err := json.Unmarshal(b, &amp;v); err != nil {\n        return err\n    }\n    switch value := v.(type) {\n    case float64:\n        *d = Duration(time.Duration(value))\n        return nil\n    case string:\n        tmp, err := time.ParseDuration(value)\n        if err != nil {\n            return err\n        }\n        *d = Duration(tmp)\n        return nil\n    default:\n        return errors.New(\"invalid duration\")\n    }\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6216224"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9967, "favorite_count": 3, "accepted_answer_id": 48051946, "answer_count": 2, "score": 22, "last_activity_date": 1573705137, "creation_date": 1514821055, "last_edit_date": 1514829407, "question_id": 48050945, "link": "https://stackoverflow.com/questions/48050945/how-to-unmarshal-json-into-durations", "title": "How to unmarshal JSON into durations?", "body": "<p>What is the idiomatic way to unmarshal into <code>time.Duration</code> in Go? How can I make use of <code>time.ParseDuration</code>?</p>\n"}, {"tags": ["windows", "go"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 5, "last_activity_date": 1514819392, "last_edit_date": 1592644375, "creation_date": 1514819392, "answer_id": 48050736, "question_id": 48050724, "link": "https://stackoverflow.com/questions/48050724/how-to-get-correct-file-base-name-on-windows-using-golang/48050736#48050736", "title": "How to get correct file base name on Windows using golang", "body": "<p>Platform-specific path manipulation should be performed with the <a href=\"https://golang.org/pkg/path/filepath/\" rel=\"noreferrer\"><code>path/filepath</code></a> package instead of <a href=\"https://golang.org/pkg/path\" rel=\"noreferrer\"><code>path</code></a>.  From the documentation:</p>\n<blockquote>\n<p>Package filepath implements utility routines for manipulating filename paths in a way compatible with the target operating system-defined file paths.</p>\n<p>The filepath package uses either forward slashes or backslashes, depending on the operating system. To process paths such as URLs that always use forward slashes regardless of the operating system, see the path package.</p>\n</blockquote>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;path/filepath&quot;\n)\n\nfunc main() {\n    p := &quot;./p/p&quot;\n    q := &quot;.\\\\q\\\\q&quot;\n    fmt.Println(filepath.Base(p))\n    fmt.Println(filepath.Base(q))\n}\n</code></pre>\n"}], "owner": {"reputation": 957, "user_id": 3358215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7b541b809ba78476a25b4c086428add?s=128&d=identicon&r=PG", "display_name": "qin", "link": "https://stackoverflow.com/users/3358215/qin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1534, "favorite_count": 0, "accepted_answer_id": 48050736, "answer_count": 1, "score": 2, "last_activity_date": 1514819392, "creation_date": 1514819316, "question_id": 48050724, "link": "https://stackoverflow.com/questions/48050724/how-to-get-correct-file-base-name-on-windows-using-golang", "title": "How to get correct file base name on Windows using golang", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"path\"\n)\n\nfunc main() {\n    p := \"./p/p\"\n    q := \".\\\\q\\\\q\"\n    fmt.Println(path.Base(p))\n    fmt.Println(path.Base(q))\n}\n</code></pre>\n\n<p>I run it on Windows, and output is:</p>\n\n<pre><code>p\n.\\q\\q\n</code></pre>\n\n<p>I think path.Base return incorrect answer.\nSo how can I get correct file base name.</p>\n"}, {"tags": ["sockets", "go", "tcp", "netstat", "lsof"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1514819968, "post_id": 48050709, "comment_id": 83073334, "body": "What is the question exactly? Are you wondering why you have so many connections still open? We can&#39;t answer that without some code. For a server, you may also want to dump the list of goroutines (<a href=\"https://golang.org/pkg/net/http/pprof/\" rel=\"nofollow noreferrer\">net/http/pprof</a> would help)."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1514820829, "post_id": 48050709, "comment_id": 83073513, "body": "This type of error can occur when your program is making http requests without closing the body on the returned responses. Read the docs here: <a href=\"https://golang.org/pkg/net/http/#Response.Body\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#Response.Body</a>. Specifically this sentence: &quot;It is the caller&#39;s responsibility to close Body.&quot;"}, {"owner": {"reputation": 3069, "user_id": 2693045, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/q4XJz.jpg?s=128&g=1", "display_name": "lutaoact", "link": "https://stackoverflow.com/users/2693045/lutaoact"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514958629, "post_id": 48050709, "comment_id": 83117294, "body": "@mkopriva I restart the process and all the open fds disappeared. Let me watch it this week to confirm it can occur again."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1515006366, "post_id": 48050709, "comment_id": 83141904, "body": "@lutaoact: yes, when a process exits all FDs are closed. Open socket are often tied to a goroutine, have you tried looking at a stack trace to see what&#39;s blocked in Read or Write?"}, {"owner": {"reputation": 3069, "user_id": 2693045, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/q4XJz.jpg?s=128&g=1", "display_name": "lutaoact", "link": "https://stackoverflow.com/users/2693045/lutaoact"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1515034073, "post_id": 48050709, "comment_id": 83150831, "body": "@JimB how to see the stack trace? I am newbie in golang."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1515163796, "post_id": 48050709, "comment_id": 83207973, "body": "@lutaoact: send the process a SIGQUIT."}], "answers": [{"tags": [], "owner": {"reputation": 16, "user_id": 7222659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af7406aa00e758a8c3258c06f19293e3?s=128&d=identicon&r=PG&f=1", "display_name": "Daan Willems", "link": "https://stackoverflow.com/users/7222659/daan-willems"}, "is_accepted": false, "score": 0, "last_activity_date": 1514887806, "creation_date": 1514887806, "answer_id": 48058981, "question_id": 48050709, "link": "https://stackoverflow.com/questions/48050709/http-accept-error-accept-tcp-9000-accept4-too-many-open-files-retrying/48058981#48058981", "title": "http: Accept error: accept tcp [::]:9000: accept4: too many open files; retrying in 1s", "body": "<p>For each socket on your machine there is a file descriptor. When you have too many open connections there will be too many files open and it will crash. </p>\n\n<p>You can try to prevent this by limiting your amount of open connections at the same time or by properly closing the fd's by closing the body of your returned responses. Quickly recycling sockets may also help.</p>\n\n<p>Another hacky approach would be to up the limit of open files with:</p>\n\n<pre><code>ulimit -n [new limit]\n</code></pre>\n"}], "owner": {"reputation": 3069, "user_id": 2693045, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/q4XJz.jpg?s=128&g=1", "display_name": "lutaoact", "link": "https://stackoverflow.com/users/2693045/lutaoact"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2839, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1514904624, "creation_date": 1514819177, "last_edit_date": 1514904624, "question_id": 48050709, "link": "https://stackoverflow.com/questions/48050709/http-accept-error-accept-tcp-9000-accept4-too-many-open-files-retrying", "title": "http: Accept error: accept tcp [::]:9000: accept4: too many open files; retrying in 1s", "body": "<p>the pid of the process is 1996291.</p>\n\n<p>there are 65534 fds in <code>/proc/1996291/fd</code>, most of the fds are sockets, like this:</p>\n\n<pre><code>lrwx------ 1 root root 64 Dec 30 13:59 10000 -&gt; socket:[952574733]\nlrwx------ 1 root root 64 Dec 30 13:59 10001 -&gt; socket:[952566188]\n</code></pre>\n\n<p>I know that the number in bracket is inode of the socket. There should be one same inode in <code>/proc/net/tcp</code> for every socket. However, some inode can be found, but some can't:</p>\n\n<pre><code>cat /proc/net/tcp | grep 952574733\n</code></pre>\n\n<p>If I found the inode, the output like follows:</p>\n\n<pre><code>  sl  local_address rem_address   st tx_queue rx_queue tr tm-&gt;when retrnsmt   uid  timeout inode\n 336: 4114C80A:271A 1914C80A:0CEA 01 00000000:00000000 02:0000BE1B 00000000     0        0 962759319 2 ffff88035a20cb00 20 4 30 10 16\n</code></pre>\n\n<p>This is a real connection. </p>\n\n<p>I use <code>netstat -tnp</code> to show connections and get a great many <code>TIME_WAIT</code> connections. I don't know whether they have relationship with my problem.</p>\n\n<p>I use <code>lsof -p 1996291</code>, the output is like this, a great many sockets:</p>\n\n<pre><code>app    1996291 root *520u     sock       0,8      0t0 953021420 protocol: TCP\napp    1996291 root *521u     sock       0,8      0t0 953027193 protocol: TCP\napp    1996291 root *522u     sock       0,8      0t0 953021422 protocol: TCP\napp    1996291 root *523u     sock       0,8      0t0 953038715 protocol: TCP\n</code></pre>\n\n<p>There three kernal options have been set to 1:</p>\n\n<pre><code>net.ipv4.tcp_tw_reuse\nnet.ipv4.tcp_tw_recycle\nnet.ipv4.tcp_syncookies\n</code></pre>\n\n<p>I can't solve these problem for several days, anyone can help me?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1514817526, "post_id": 48050522, "comment_id": 83072802, "body": "This is too vague for us to be able to help you. Is the goal to minimize memory used for each instance, or is the goal just to have arbitrary combinations of capabilities? Are the capabilities known in advance or dynamic? If you insist on using something similar to bitset, take a look at <a href=\"https://stackoverflow.com/questions/2311373/how-to-implement-bitset-with-go\" title=\"how to implement bitset with go\">stackoverflow.com/questions/2311373/&hellip;</a>"}, {"owner": {"reputation": 26894, "user_id": 19020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/VpVEj.jpg?s=128&g=1", "display_name": "Dan Esparza", "link": "https://stackoverflow.com/users/19020/dan-esparza"}, "edited": false, "score": 0, "creation_date": 1514818308, "post_id": 48050522, "comment_id": 83072994, "body": "You should also understand that trying to replicate another language&#39;s features in Go is generally regarded as a bad idea.  There is a &#39;go&#39; way of doing things.  You might want to consider <code>iota</code> and bitmask operations like <a href=\"https://play.golang.org/p/Dm3X-akr31\" rel=\"nofollow noreferrer\">this example</a>.  This approach <a href=\"https://golang.org/pkg/go/build/#ImportMode\" rel=\"nofollow noreferrer\">is commonly used in the standard library</a>."}, {"owner": {"reputation": 3758, "user_id": 826938, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/1f5fa15f4142e9ec9ade8ea8142a030a?s=128&d=identicon&r=PG", "display_name": "BigONotation", "link": "https://stackoverflow.com/users/826938/bigonotation"}, "edited": false, "score": 0, "creation_date": 1514818440, "post_id": 48050522, "comment_id": 83073024, "body": "Yes I agree. I am new to go so trying to figure things out. Hence the question :). I have added iota consts to the sample"}, {"owner": {"reputation": 3758, "user_id": 826938, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/1f5fa15f4142e9ec9ade8ea8142a030a?s=128&d=identicon&r=PG", "display_name": "BigONotation", "link": "https://stackoverflow.com/users/826938/bigonotation"}, "reply_to_user": {"reputation": 26894, "user_id": 19020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/VpVEj.jpg?s=128&g=1", "display_name": "Dan Esparza", "link": "https://stackoverflow.com/users/19020/dan-esparza"}, "edited": false, "score": 0, "creation_date": 1514818566, "post_id": 48050522, "comment_id": 83073044, "body": "@DanEsparza Actually you have pretty much given me the answer. So if you want to put your comment as an answer I will accept it"}, {"owner": {"reputation": 26894, "user_id": 19020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/VpVEj.jpg?s=128&g=1", "display_name": "Dan Esparza", "link": "https://stackoverflow.com/users/19020/dan-esparza"}, "edited": false, "score": 0, "creation_date": 1514821886, "post_id": 48050522, "comment_id": 83073766, "body": "@BigONotation glad to hear it!  Done."}], "answers": [{"tags": [], "owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "is_accepted": false, "score": 3, "last_activity_date": 1514821670, "creation_date": 1514821670, "answer_id": 48051024, "question_id": 48050522, "link": "https://stackoverflow.com/questions/48050522/using-bitsets-in-golang-to-represent-capabilities/48051024#48051024", "title": "Using bitsets in golang to represent capabilities", "body": "<p>Define the capabilities using <code>= 1 &lt;&lt; iota</code>:</p>\n\n<pre><code>const (\n  Light Capability = 1 &lt;&lt; iota\n  Mass\n  ElectricalCurrent\n  Energy\n)\n</code></pre>\n\n<p>Notice that the expression is only needed on the first constant. The same expression (but with an updated value of <code>iota</code>) will be used on the consecutive lines in the same group.</p>\n\n<p>Here's a complete working example:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"strings\"\n)\n\ntype Capability int\n\nconst (\n  // Light can be measured in the form of luminosity\n  Light Capability = 1 &lt;&lt; iota\n  Mass\n  ElectricalCurrent\n  Energy\n)\n\nfunc (c Capability) String() string {\n  var caps []string\n  if c&amp;Light &gt; 0 {\n    caps = append(caps, \"Light\")\n  }\n  if c&amp;Mass &gt; 0 {\n    caps = append(caps, \"Mass\")\n  }\n  if c&amp;ElectricalCurrent &gt; 0 {\n    caps = append(caps, \"ElectricalCurrent\")\n  }\n  if c&amp;Energy &gt; 0 {\n    caps = append(caps, \"Energy\")\n  }\n  return strings.Join(caps, \"|\")\n}\n\ntype PhysicalDevice struct {\n  Owner       string\n  ID          string\n  Description string\n  Capability  Capability\n}\n\nfunc (pd PhysicalDevice) String() string {\n  return \"Owner: \" + pd.Owner + \"\\n\" +\n    \"ID: \" + pd.ID + \"\\n\" +\n    \"Description: \" + pd.Description + \"\\n\" +\n    \"Capability: \" + pd.Capability.String() + \"\\n\"\n}\n\nfunc main() {\n  dev := PhysicalDevice{\n    Owner:       \"Albert Einstein\",\n    ID:          \"E=mc^2\",\n    Description: \"My well-known formula as a device\",\n    Capability:  Energy | Mass | Light,\n  }\n  fmt.Println(dev)\n}\n</code></pre>\n\n<p>The code can be found on <a href=\"https://play.golang.org/p/p0D7OukxZ2j\" rel=\"nofollow noreferrer\">The Go Playground</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 159, "user_id": 3573024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d560ff0aeb4ce52219a166547fdb09?s=128&d=identicon&r=PG&f=1", "display_name": "mgagnon", "link": "https://stackoverflow.com/users/3573024/mgagnon"}, "edited": false, "score": 0, "creation_date": 1514901785, "post_id": 48051052, "comment_id": 83097252, "body": "I think there\u2019s a little mistake in TestAddFlag() function: it should be: if mainFlag&amp;TESTFLAG_THREE == 0 { ... Since TESTFLAG_THREE is already a bitmask."}], "tags": [], "owner": {"reputation": 26894, "user_id": 19020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/VpVEj.jpg?s=128&g=1", "display_name": "Dan Esparza", "link": "https://stackoverflow.com/users/19020/dan-esparza"}, "is_accepted": true, "score": 4, "last_activity_date": 1514821871, "creation_date": 1514821871, "answer_id": 48051052, "question_id": 48050522, "link": "https://stackoverflow.com/questions/48050522/using-bitsets-in-golang-to-represent-capabilities/48051052#48051052", "title": "Using bitsets in golang to represent capabilities", "body": "<p>You should understand that trying to replicate another language's features in Go is generally regarded as a bad idea. There is a 'go' way of doing things. </p>\n\n<p>You might want to consider <code>iota</code> and bitmask operations like <a href=\"https://play.golang.org/p/Dm3X-akr31\" rel=\"nofollow noreferrer\">this example on the Go playground</a>.  I have included the code here as well (in all its plagiarized glory): </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    TestAddFlag()\n    TestHasFlag()\n    TestClearFlag()\n    TestToggleFlag()\n\n    fmt.Println(\"all tests passed\")\n}\n\ntype Bitmask uint32\n\nfunc (f Bitmask) HasFlag(flag Bitmask) bool { return f&amp;flag != 0 }\nfunc (f *Bitmask) AddFlag(flag Bitmask)     { *f |= flag }\nfunc (f *Bitmask) ClearFlag(flag Bitmask)   { *f &amp;= ^flag }\nfunc (f *Bitmask) ToggleFlag(flag Bitmask)  { *f ^= flag }\n\nconst (\n    TESTFLAG_ONE Bitmask = 1 &lt;&lt; iota\n    TESTFLAG_TWO\n    TESTFLAG_THREE\n)\n\nfunc TestAddFlag() {\n\n    var mainFlag Bitmask = TESTFLAG_TWO\n\n    mainFlag.AddFlag(TESTFLAG_THREE)\n\n    if mainFlag&amp;(1&lt;&lt;TESTFLAG_THREE) != 0 {\n        panic(\"failed\")\n    }\n\n}\n\nfunc TestClearFlag() {\n\n    var mainFlag Bitmask = TESTFLAG_ONE | TESTFLAG_THREE\n\n    mainFlag.ClearFlag(TESTFLAG_THREE)\n\n    if mainFlag&amp;(1&lt;&lt;TESTFLAG_ONE) != 0 {\n        panic(\"failed\")\n    }\n\n}\n\nfunc TestHasFlag() {\n\n    var mainFlag Bitmask = TESTFLAG_ONE | TESTFLAG_THREE\n\n    if !mainFlag.HasFlag(TESTFLAG_THREE) {\n        panic(\"failed\")\n    }\n\n}\n\nfunc TestToggleFlag() {\n    flag := TESTFLAG_ONE | TESTFLAG_THREE\n\n    flag.ToggleFlag(TESTFLAG_ONE)\n    if flag.HasFlag(TESTFLAG_ONE) {\n        panic(\"failed\")\n    }\n    flag.ToggleFlag(TESTFLAG_ONE)\n    if !flag.HasFlag(TESTFLAG_ONE) {\n        panic(\"failed\")\n    }\n}\n</code></pre>\n\n<p>This approach is <a href=\"https://golang.org/pkg/go/build/#ImportMode\" rel=\"nofollow noreferrer\">commonly used in the standard library</a>.</p>\n"}], "owner": {"reputation": 3758, "user_id": 826938, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/1f5fa15f4142e9ec9ade8ea8142a030a?s=128&d=identicon&r=PG", "display_name": "BigONotation", "link": "https://stackoverflow.com/users/826938/bigonotation"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2099, "favorite_count": 1, "accepted_answer_id": 48051052, "answer_count": 2, "score": 3, "last_activity_date": 1514831453, "creation_date": 1514817299, "last_edit_date": 1514831453, "question_id": 48050522, "link": "https://stackoverflow.com/questions/48050522/using-bitsets-in-golang-to-represent-capabilities", "title": "Using bitsets in golang to represent capabilities", "body": "<p>I am new to Golang and would like to model physical devices for measuring quantities such as light intensity, mass, electric current and so forth. So as a starting point I will define a device struct as follows:</p>\n\n<pre><code>const (\n    // Light can be measured in the form of luminosity\n    Light             = 1&lt;&lt; iota\n    Mass             \n    ElectricalCurrent \n)\n\ntype PhysicalDevice struct{\n   Owner       string\n   ID          string\n   Description string\n}\n</code></pre>\n\n<p>I am a confused now on how to express the device's capabilities (what it can measure) and the units of measurement. For example I would like to express that a physical device can measure electrical currents in amperes. However, I also want to express that a PhysicalDevice can measure more than one quantity. For example it could measure electrical current and temperature.</p>\n\n<p>The PhysicalDevice's capabilities are not known in advance and can contain an arbitrary combination of capabilities.</p>\n\n<p>I was thinking of using something equivalent to a C++ bitset for expressing the physical quantities a device can measure (would this be the right approach in the first place?).  </p>\n\n<p>I did not find the Go bitset type and not sure how to express that. I also need to map the measured physical quantity to a corresponding unit.   </p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1514807457, "post_id": 48049356, "comment_id": 83070344, "body": "Did you try using <b>raw</b> strings, e.g. <code>`foo bar`</code> instead of <code>&quot;foo bar&quot;</code>? (<a href=\"https://play.golang.org/p/HnKl1blnOMK\" rel=\"nofollow noreferrer\">play.golang.org/p/HnKl1blnOMK</a>) More here: <a href=\"https://golang.org/ref/spec#String_literals\" rel=\"nofollow noreferrer\">golang.org/ref/spec#String_literals</a>"}, {"owner": {"reputation": 1272, "user_id": 4309716, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/PWKIs.jpg?s=128&g=1", "display_name": "TheDevWay", "link": "https://stackoverflow.com/users/4309716/thedevway"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514807702, "post_id": 48049356, "comment_id": 83070411, "body": "@mkopriva I didn&#39;t know about ``. I&#39;m pretty new to golang. thanks anyway"}], "owner": {"reputation": 1272, "user_id": 4309716, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/PWKIs.jpg?s=128&g=1", "display_name": "TheDevWay", "link": "https://stackoverflow.com/users/4309716/thedevway"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 326, "favorite_count": 0, "closed_date": 1514807998, "answer_count": 0, "score": 0, "last_activity_date": 1514835136, "creation_date": 1514806934, "last_edit_date": 1514835136, "question_id": 48049356, "link": "https://stackoverflow.com/questions/48049356/golang-escape-regex-special-characters-to-create-a-valid-string-for-regexp-mus", "closed_reason": "Duplicate", "title": "Golang | Escape regex special characters to create a valid string for regexp.MustCompile() method", "body": "<p>When I try to pass this regex as a string between <code>'</code> or <code>\"</code> it throws errors because of invalid string.\nI am pretty confused, how can I escape special characters to create a valid regex string for input of <code>regexp.MustCompile()</code> method.</p>\n\n<p>here is my regex (which is not a valid string input for this method):</p>\n\n<pre><code>re := regexp.MustCompile(\"^(Yii::t\\()(\\'|\\\")(.*?)(\\'|\\\")\\,(\\'|\\\")(.*?)(\\'|\\\")\\)$\")\n</code></pre>\n"}, {"tags": ["go", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514803437, "post_id": 48048923, "comment_id": 83069488, "body": "Do not use a global context, that&#39;s not what it&#39;s meant for. Contexts are <i>request-scoped</i>. Each <a href=\"https://golang.org/pkg/net/http/#Request.Context\" rel=\"nofollow noreferrer\">request</a> carries it&#39;s own context and these contexts should not be shared between requests. If you have a single, global context and two concurrent requests use that context, there is a high probability of a data race."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1514925734, "post_id": 48048923, "comment_id": 83108603, "body": "@mkopriva contexts are already mutex-protected, and the package is naturally not really susceptible to races anyway, simply because of how it functions.  A context is a reverse linked list, ultimately pointing to the Background/TODO emptyCtx globals in the package.  Whenever you do something with a context, you&#39;re actually creating a child that points back to that parent context, not modifying the parent context itself.  The only &quot;race&quot; happen if you cancel the context, and that&#39;s not actually a race.  Contexts are designed to be able to be canceled by other goroutines."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1514925839, "post_id": 48048923, "comment_id": 83108647, "body": "Doesn&#39;t change the fact that global contexts are questionable, but I&#39;ve used a similar style before, where we had a global program-scoped context, which was then forked into a session-scoped context for each user session, and that was further forked into a call-scoped context for each RPC call the user made.  Contexts are scoped bags of stuff.  That scope doesn&#39;t always have to be a single request, and it&#39;s a perfectly valid use to have broader scopes for them."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1514928334, "post_id": 48048923, "comment_id": 83109656, "body": "Fair enough @Kaedys, thanks for your input."}], "answers": [{"tags": [], "owner": {"reputation": 799, "user_id": 2980967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ecQ8D.jpg?s=128&g=1", "display_name": "dustinevan", "link": "https://stackoverflow.com/users/2980967/dustinevan"}, "is_accepted": true, "score": 2, "last_activity_date": 1516058795, "last_edit_date": 1516058795, "creation_date": 1514876013, "answer_id": 48056730, "question_id": 48048923, "link": "https://stackoverflow.com/questions/48048923/how-to-use-the-context-properly-in-golang-google-datastore-package/48056730#48056730", "title": "How to use the context properly in Golang Google Datastore package?", "body": "<p>context.Background is the global context--so no need for you global variable. Most of the time you'll want to use a child of that context, with a cancel or a timeout. </p>\n\n<pre><code>ctx, cancel := context.WithCancel(context.Background)\n//or\nctx, cancel := context.WithTimeout(context.Background, time.Second * 30) \n</code></pre>\n\n<p>Then you can use the cancel function to close down your application nicely, or cancel and retry if a request is hanging. If you never plan on canceling or timing out operations, then using context.Background is fine. </p>\n\n<p>Also context.Context is an interface so it's always passed by reference, so all uses of a certain instance point to the same context.    </p>\n"}], "owner": {"reputation": 503, "user_id": 3098902, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/EQSV3.jpg?s=128&g=1", "display_name": "she7ata", "link": "https://stackoverflow.com/users/3098902/she7ata"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 929, "favorite_count": 0, "accepted_answer_id": 48056730, "answer_count": 1, "score": 1, "last_activity_date": 1529780878, "creation_date": 1514802738, "last_edit_date": 1529780878, "question_id": 48048923, "link": "https://stackoverflow.com/questions/48048923/how-to-use-the-context-properly-in-golang-google-datastore-package", "title": "How to use the context properly in Golang Google Datastore package?", "body": "<p>I've started using Google Cloud Datastore in one of the project in the company I currently work in.</p>\n\n<p><a href=\"https://godoc.org/cloud.google.com/go/datastore\" rel=\"nofollow noreferrer\">https://godoc.org/cloud.google.com/go/datastore</a></p>\n\n<p>In the provided example, they use a context and pass it to the connection instance</p>\n\n<pre><code>ctx := context.Background()\ndsClient, err := datastore.NewClient(ctx, \"my-project\")\n</code></pre>\n\n<p>Through the documentation you will see that they pass a context to all the functions that makes operations on the database, I am not sure if they are passing the same pointer or create a new pointer for each operation.</p>\n\n<p>The current setup that I have is a global variable for the context in a package called \"store\" which I keep all the structs functions that communicate with the db, and I use that global variable each time. I don't know what is the effect of that, I am not sure why the context is used, Should I get reference of <code>context.Background()</code> each time I make operations on the database ?</p>\n"}, {"tags": ["session", "go", "go-echo"], "answers": [{"comments": [{"owner": {"reputation": 504, "user_id": 2725353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8743e994aaa7936b7d63f97ed5ed3f91?s=128&d=identicon&r=PG", "display_name": "Yrineu Rodrigues", "link": "https://stackoverflow.com/users/2725353/yrineu-rodrigues"}, "edited": false, "score": 0, "creation_date": 1605753560, "post_id": 48070831, "comment_id": 114751035, "body": "I think this answer doesn&#39;t help that much, what you can do is set the expiration of the cookie with a negative value."}, {"owner": {"reputation": 2634, "user_id": 2566671, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/sIAd4.jpg?s=128&g=1", "display_name": "pyprism", "link": "https://stackoverflow.com/users/2566671/pyprism"}, "reply_to_user": {"reputation": 504, "user_id": 2725353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8743e994aaa7936b7d63f97ed5ed3f91?s=128&d=identicon&r=PG", "display_name": "Yrineu Rodrigues", "link": "https://stackoverflow.com/users/2725353/yrineu-rodrigues"}, "edited": false, "score": 0, "creation_date": 1605769855, "post_id": 48070831, "comment_id": 114754755, "body": "@YrineuRodrigues Maybe my case is different, so that answer was OK for me."}, {"owner": {"reputation": 504, "user_id": 2725353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8743e994aaa7936b7d63f97ed5ed3f91?s=128&d=identicon&r=PG", "display_name": "Yrineu Rodrigues", "link": "https://stackoverflow.com/users/2725353/yrineu-rodrigues"}, "edited": false, "score": 0, "creation_date": 1605841061, "post_id": 48070831, "comment_id": 114782427, "body": "Oh, just saw... you asked the question and then you answer and approved your own question."}], "tags": [], "owner": {"reputation": 2634, "user_id": 2566671, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/sIAd4.jpg?s=128&g=1", "display_name": "pyprism", "link": "https://stackoverflow.com/users/2566671/pyprism"}, "is_accepted": true, "score": -1, "last_activity_date": 1514950740, "creation_date": 1514950740, "answer_id": 48070831, "question_id": 48047373, "link": "https://stackoverflow.com/questions/48047373/echo-is-not-clearing-the-session/48070831#48070831", "title": "Echo is not clearing the session", "body": "<p>The problem is in the client side . Browsers are ignoring Set-Cookie in redirect response when domain of the cookie is localhost.  So I have to use 127.0.0.1 instead of localhost.</p>\n"}], "owner": {"reputation": 2634, "user_id": 2566671, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/sIAd4.jpg?s=128&g=1", "display_name": "pyprism", "link": "https://stackoverflow.com/users/2566671/pyprism"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 606, "favorite_count": 0, "accepted_answer_id": 48070831, "answer_count": 1, "score": 1, "last_activity_date": 1521026924, "creation_date": 1514784864, "last_edit_date": 1521026924, "question_id": 48047373, "link": "https://stackoverflow.com/questions/48047373/echo-is-not-clearing-the-session", "title": "Echo is not clearing the session", "body": "<p>I am using <a href=\"https://github.com/labstack/echo\" rel=\"nofollow noreferrer\">Echo</a> for my web application. I tried to implement Login and Logout. When I tried to logout, its not clearing the session.  Here is my code:</p>\n\n<pre><code>func Logout(c echo.Context) error {\n    sess, _ := session.Get(\"session\", c)\n    sess.Options = &amp;sessions.Options{\n        Path:     \"/\",\n        MaxAge:   -1,\n        HttpOnly: true,\n    }\n    sess.Values[\"username\"] = \"\"\n    sess.Values[\"authenticated\"] = \"\"\n    sess.Save(c.Request(), c.Response())\n    return c.Redirect(http.StatusSeeOther, \"/\")\n}\n</code></pre>\n\n<p>After logout I checked the session values, its not changing or clearing anything. I am using these packages for session management:</p>\n\n<pre><code>\"github.com/labstack/echo-contrib/session\"\n\"github.com/gorilla/sessions\"\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 6434, "user_id": 4443226, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/C3vUB.png?s=128&g=1", "display_name": "Nevermore", "link": "https://stackoverflow.com/users/4443226/nevermore"}, "is_accepted": false, "score": 0, "last_activity_date": 1514762995, "creation_date": 1514762995, "answer_id": 48046275, "question_id": 48046203, "link": "https://stackoverflow.com/questions/48046203/golang-initializing-struct-with-embedded-template-too-few-values-in-struct-init/48046275#48046275", "title": "golang initializing struct with embedded template: too few values in struct initializer", "body": "<p>It looks like (as far as general concepts go) you're confusing <strong>interface</strong>s with <strong>composition</strong> (which is kind of how Go approaches the whole <code>inheritance</code> question.</p>\n\n<p>This post might be helpful for you: <a href=\"https://medium.com/@gianbiondi/interfaces-in-go-59c3dc9c2d98\" rel=\"nofollow noreferrer\">https://medium.com/@gianbiondi/interfaces-in-go-59c3dc9c2d98</a></p>\n\n<p>So <code>TestTemplate</code> is an interface.</p>\n\n<p>That means that the <code>struct</code> <code>TestBase</code> will <em>implement</em> the methods (whose signature is) defined in the interface. </p>\n\n<p>You should implement <code>Print</code> for <code>TestBase</code>.</p>\n\n<p>But in anycase the error you're getting is because when you initialize a struct with no field names specified, it expects all the field names to be entered, see</p>\n\n<p><a href=\"https://gobyexample.com/structs\" rel=\"nofollow noreferrer\">https://gobyexample.com/structs</a></p>\n\n<p>So remove the <code>composition</code> <code>TestTemplate</code> from the struct (and implement the method defined in the interface instead), and it should work.</p>\n\n<p>Also, FYI, the <code>Stringer</code> interface with <code>String</code> method is what <code>fmt.Println</code> expects to print an arbitrary struct (not a <code>Print</code> method) see: <a href=\"https://tour.golang.org/methods/17\" rel=\"nofollow noreferrer\">https://tour.golang.org/methods/17</a></p>\n"}, {"comments": [{"owner": {"reputation": 33, "user_id": 9159397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0e2691794bbb595bef529caadfe4f3e?s=128&d=identicon&r=PG&f=1", "display_name": "Spellchaser", "link": "https://stackoverflow.com/users/9159397/spellchaser"}, "edited": false, "score": 0, "creation_date": 1514826449, "post_id": 48046375, "comment_id": 83075003, "body": "Ahh, I meant to define the template to have Name() rather than Print() but that&#39;s not too relevant to the problem. Thank you, I was thinking that the template wasn&#39;t a field and just told the compiler that this object should implement these functions."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 33, "user_id": 9159397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0e2691794bbb595bef529caadfe4f3e?s=128&d=identicon&r=PG&f=1", "display_name": "Spellchaser", "link": "https://stackoverflow.com/users/9159397/spellchaser"}, "edited": false, "score": 0, "creation_date": 1514828138, "post_id": 48046375, "comment_id": 83075466, "body": "Be careful when trying to fit traditional OOP concepts into Go. The Go language wasn&#39;t build for that. Embedding just tells the compiler that the <code>Print&#47;Name</code> method can be <i>accessed directly</i> from <code>TestBase</code> without specifying the field to which it belongs, but the embedded type and it&#39;s method have no knowledge about the type inside which they are embedded, so the <code>Name&#47;Print</code> method will not have access to the <code>TestBase.name</code> field."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 3, "last_activity_date": 1514764763, "creation_date": 1514764763, "answer_id": 48046375, "question_id": 48046203, "link": "https://stackoverflow.com/questions/48046203/golang-initializing-struct-with-embedded-template-too-few-values-in-struct-init/48046375#48046375", "title": "golang initializing struct with embedded template: too few values in struct initializer", "body": "<p><a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Struct_types</a></p>\n\n<p>An <em>embedded field</em> is still a <em>field</em>, the name of which is derived from its type, therefore <code>TestBase</code> has actually <em>two fields</em> and not one, namely <code>name</code> and <code>TestTemplate</code>.</p>\n\n<p>This compiles just fine:</p>\n\n<pre><code>var t *TestBase\nt.TestTemplate.Print()\n</code></pre>\n\n<p>So when initializing <code>TestBase</code> you either specify the field names or you initialize all fields.</p>\n\n<p>These all compile:</p>\n\n<pre><code>_ = &amp;TestBase{name, nil}\n_ = &amp;TestBase{name: name}\n_ = &amp;TestBase{name: name, TestTemplate: nil}\n_ = &amp;TestBase{TestTemplate: nil}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 9159397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0e2691794bbb595bef529caadfe4f3e?s=128&d=identicon&r=PG&f=1", "display_name": "Spellchaser", "link": "https://stackoverflow.com/users/9159397/spellchaser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5287, "favorite_count": 1, "accepted_answer_id": 48046375, "answer_count": 2, "score": 3, "last_activity_date": 1514827043, "creation_date": 1514761805, "last_edit_date": 1514827043, "question_id": 48046203, "link": "https://stackoverflow.com/questions/48046203/golang-initializing-struct-with-embedded-template-too-few-values-in-struct-init", "title": "golang initializing struct with embedded template: too few values in struct initializer", "body": "<p>I'm trying to initialize a golang struct with an embedded template. Since templates have no fields, I would expect that assigning the correct number of variables to a constructor would work, but instead the compiler complains that </p>\n\n<pre><code>main.go:17:19: too few values in struct initializer\n\npackage main\n\nimport \"fmt\"\n\ntype TestTemplate interface {\n    Name() string\n}\n\ntype TestBase struct {\n    name       string\n\n    TestTemplate\n}\n\nfunc New(name string) *TestBase {\n    return &amp;TestBase{name} // This fails\n    //return &amp;TestBase{name: name} // This works\n}\n\nfunc (v *TestBase) Name() string {\n    return v.name\n}\n\nfunc main() {\n    fmt.Println(New(\"Hello\"))\n}\n</code></pre>\n"}, {"tags": ["ssl", "go", "lets-encrypt"], "answers": [{"tags": [], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "is_accepted": true, "score": 1, "last_activity_date": 1535817646, "creation_date": 1535817646, "answer_id": 52129859, "question_id": 48046133, "link": "https://stackoverflow.com/questions/48046133/is-there-any-danger-in-omitting-the-hostpolicy-in-an-autocert-manager/52129859#52129859", "title": "Is there any danger in omitting the HostPolicy in an autocert.Manager?", "body": "<p>If you don't have a HostPolicy, this means anyone can make a request to your application and as a result your server will then try and create a SSL certificate for that domain.</p>\n\n<p>A hacker could then make multiple requests to your server and cause you to reach rate limits, so when you service actually makes a renewal request for real domains they will get rejected because you reached the rate limit.</p>\n\n<p>So in the end you won't be able to create certificates that you really need, and your customers will complain and you will cry.</p>\n"}], "owner": {"reputation": 2810, "user_id": 5808504, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/821bb6654d488185345d86bde0a586ef?s=128&d=identicon&r=PG&f=1", "display_name": "twharmon", "link": "https://stackoverflow.com/users/5808504/twharmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 237, "favorite_count": 0, "accepted_answer_id": 52129859, "answer_count": 1, "score": 0, "last_activity_date": 1535817646, "creation_date": 1514760534, "last_edit_date": 1514763281, "question_id": 48046133, "link": "https://stackoverflow.com/questions/48046133/is-there-any-danger-in-omitting-the-hostpolicy-in-an-autocert-manager", "title": "Is there any danger in omitting the HostPolicy in an autocert.Manager?", "body": "<p>I want to set up TLS with Let's Encrypt in Golang with <code>golang.org/x/crypto/acme/autocert</code>. Why should I set the HostPolicy in the Manager? It seems that everything works fine without the default <code>autocert.HostWhitelist</code>.</p>\n\n<pre><code>http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"test\"))\n})\n\nm := autocert.Manager{\n    Prompt: autocert.AcceptTOS,\n    //HostPolicy: autocert.HostWhitelist(\"example.com\"),\n    Cache: autocert.DirCache(\"certs\"),\n}\n\ns := &amp;http.Server{\n    Addr: \":443\",\n    TLSConfig: &amp;tls.Config{\n        GetCertificate: m.GetCertificate,\n    },\n}\n\nlog.Fatal(s.ListenAndServeTLS(\"\", \"\"))\n</code></pre>\n\n<p>I'm setting up a simple CMS, and I want SSL to be automatic for new hosts. I could make my own host policy function that looks up host names in a datastore, but it would be nice to skip that.</p>\n\n<p>EDIT</p>\n\n<p>I found this in their <a href=\"https://github.com/golang/crypto/blob/5a033cc77e57eca05bdb50522851d29e03569cbe/acme/autocert/autocert.go#L104\" rel=\"nofollow noreferrer\">code</a>:</p>\n\n<blockquote>\n  <p>HostPolicy controls which domains the Manager will attempt to retrieve\n  new certificates for. It does not affect cached certs.</p>\n  \n  <p>If non-nil, HostPolicy is called before requesting a new cert. If nil,\n  all hosts are currently allowed. This is not recommended, as it opens\n  a potential attack where clients connect to a server by IP address and\n  pretend to be asking for an incorrect host name. Manager will attempt\n  to obtain a certificate for that host, incorrectly, eventually\n  reaching the CA's rate limit for certificate requests and making it\n  impossible to obtain actual certificates.</p>\n</blockquote>\n\n<p>I still don't understand it completely. What could the attacker do and how would it affect my app?</p>\n"}, {"tags": ["go", "slice", "bigint"], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 3, "last_activity_date": 1514738402, "last_edit_date": 1514738402, "creation_date": 1514738062, "answer_id": 48044135, "question_id": 48044036, "link": "https://stackoverflow.com/questions/48044036/big-int-slice-rewriting-itself-on-append/48044135#48044135", "title": "big.Int slice rewriting itself on append()", "body": "<p>You have a slice of <code>*big.Int</code> in which you store the same pointer over and over again.</p>\n\n<p>Instead, you need to store a copy of <code>n</code> on each iteration.</p>\n\n<p>Replace:</p>\n\n<pre><code>divisorsOfPrime = append(divisorsOfPrime, n)\n</code></pre>\n\n<p>With:</p>\n\n<pre><code>nCopy := new(big.Int).Set(n)\ndivisorsOfPrime = append(divisorsOfPrime, nCopy)\n</code></pre>\n\n<p>By the way, this is not specific to <code>*big.Int</code>; as long as you're handling pointers you need to create new objects and store pointers to those new objects, not the original one. Notice that <code>n</code> is assigned exactly once.</p>\n"}], "owner": {"reputation": 318, "user_id": 4015297, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/827cf44882f40849d3b6f2540915a901?s=128&d=identicon&r=PG", "display_name": "MaxCodes", "link": "https://stackoverflow.com/users/4015297/maxcodes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 2, "accepted_answer_id": 48044135, "answer_count": 1, "score": 1, "last_activity_date": 1514738402, "creation_date": 1514737045, "question_id": 48044036, "link": "https://stackoverflow.com/questions/48044036/big-int-slice-rewriting-itself-on-append", "title": "big.Int slice rewriting itself on append()", "body": "<p>I am trying to get a slice of <code>big.Ints</code> of the odd numbers between 3 and the square root of <code>i</code>.</p>\n\n<p>When I run the following code:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"math/big\"\n)\n\nfunc main() {\n    i := big.NewInt(101)\n    var divisorsOfPrime []*big.Int\n    squareRoot := big.NewInt(0).Sqrt(i)\n    for n := big.NewInt(3); n.Cmp(squareRoot) == -1; n.Add(n, big.NewInt(2)) {\n        divisorsOfPrime = append(divisorsOfPrime, n)\n    }\n    fmt.Println(divisorsOfPrime)\n}\n</code></pre>\n\n<p>I get the output:</p>\n\n<pre><code>[11 11 11 11]\n</code></pre>\n\n<p>But I expect the output:</p>\n\n<pre><code>[3 5 7 9 11]\n</code></pre>\n\n<p>What can I do to fix this?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "web-crawler"], "comments": [{"owner": {"reputation": 3262, "user_id": 1964707, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/at9Qr.jpg?s=128&g=1", "display_name": "Mindaugas Bernatavi\u010dius", "link": "https://stackoverflow.com/users/1964707/mindaugas-bernatavi%c4%8dius"}, "edited": false, "score": 0, "creation_date": 1514728728, "post_id": 48042992, "comment_id": 83056812, "body": "How frequent is the deadlock? 1 in 10? I&#39;m trying to reproduce it."}, {"owner": {"reputation": 208, "user_id": 4038792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b11cd875604977cda21c19fd98bdf175?s=128&d=identicon&r=PG&f=1", "display_name": "Konstantinos Daskalopoulos", "link": "https://stackoverflow.com/users/4038792/konstantinos-daskalopoulos"}, "reply_to_user": {"reputation": 3262, "user_id": 1964707, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/at9Qr.jpg?s=128&g=1", "display_name": "Mindaugas Bernatavi\u010dius", "link": "https://stackoverflow.com/users/1964707/mindaugas-bernatavi%c4%8dius"}, "edited": false, "score": 0, "creation_date": 1514728831, "post_id": 48042992, "comment_id": 83056838, "body": "It&#39;s quite inconsistent. Sometimes 1 in 3 sometimes 1 in 10 then two in a row"}, {"owner": {"reputation": 3262, "user_id": 1964707, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/at9Qr.jpg?s=128&g=1", "display_name": "Mindaugas Bernatavi\u010dius", "link": "https://stackoverflow.com/users/1964707/mindaugas-bernatavi%c4%8dius"}, "edited": false, "score": 0, "creation_date": 1514729447, "post_id": 48042992, "comment_id": 83057014, "body": "Most common cause of this specific issue is channels not being closed. For example here: <a href=\"https://stackoverflow.com/questions/12398359/throw-all-goroutines-are-asleep-deadlock\" title=\"throw all goroutines are asleep deadlock\">stackoverflow.com/questions/12398359/&hellip;</a> - I&#39;m trying to measure the frequency and maybe will propose a solution. Not a go expert, so no guarantees."}, {"owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "edited": false, "score": 0, "creation_date": 1514731971, "post_id": 48042992, "comment_id": 83057688, "body": "can you show the <code>link</code> for the tutorial which you follow ?"}, {"owner": {"reputation": 208, "user_id": 4038792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b11cd875604977cda21c19fd98bdf175?s=128&d=identicon&r=PG&f=1", "display_name": "Konstantinos Daskalopoulos", "link": "https://stackoverflow.com/users/4038792/konstantinos-daskalopoulos"}, "edited": false, "score": 0, "creation_date": 1514732042, "post_id": 48042992, "comment_id": 83057703, "body": "<a href=\"https://tour.golang.org/concurrency/10\" rel=\"nofollow noreferrer\">tour.golang.org/concurrency/10</a> I have an update, will post soon"}], "answers": [{"comments": [{"owner": {"reputation": 208, "user_id": 4038792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b11cd875604977cda21c19fd98bdf175?s=128&d=identicon&r=PG&f=1", "display_name": "Konstantinos Daskalopoulos", "link": "https://stackoverflow.com/users/4038792/konstantinos-daskalopoulos"}, "edited": false, "score": 0, "creation_date": 1514734557, "post_id": 48043548, "comment_id": 83058387, "body": "That is correct, how would you go on about fixing this? I&#39;m fairly new to the elements of concurrency and go so I&#39;m struggling to change my way of thinking"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 208, "user_id": 4038792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b11cd875604977cda21c19fd98bdf175?s=128&d=identicon&r=PG&f=1", "display_name": "Konstantinos Daskalopoulos", "link": "https://stackoverflow.com/users/4038792/konstantinos-daskalopoulos"}, "edited": false, "score": 0, "creation_date": 1514738200, "post_id": 48043548, "comment_id": 83059214, "body": "I tried to write some thoughts on it and edited it into the answer. I hope it help."}, {"owner": {"reputation": 208, "user_id": 4038792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b11cd875604977cda21c19fd98bdf175?s=128&d=identicon&r=PG&f=1", "display_name": "Konstantinos Daskalopoulos", "link": "https://stackoverflow.com/users/4038792/konstantinos-daskalopoulos"}, "edited": false, "score": 0, "creation_date": 1514741258, "post_id": 48043548, "comment_id": 83059982, "body": "Thanks for the answer and the tips, will have a look tomorrow and accept the answer once i figure it out and spend some time. happy new year"}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 2, "last_activity_date": 1514738158, "last_edit_date": 1514738158, "creation_date": 1514733001, "answer_id": 48043548, "question_id": 48042992, "link": "https://stackoverflow.com/questions/48042992/web-crawler-go-tour-different-output-same-code/48043548#48043548", "title": "Web Crawler go tour different output same code", "body": "<p>I think the case is quite clear. Your channels are messing. Multiple goroutines are recieving from a same channel, and golang just randomly pick one.</p>\n\n<p>As you send a zero through <code>quit</code>, you never know which goroutine quits: it is randomly picked by the go sheduler. It is possible that a newly generated Crawl recieved from <code>quit</code> before recieving from <code>c</code> (even if both channel are ready).</p>\n\n<p>And due to that, the <code>depth</code> is a mess and it makes numbers of <code>safeVisit</code> being called unstable, resulting <code>quit</code> issuing different (randomly) signal. Sometimes it is just not enough to quit all goroutines generated, and it is a deadlock.</p>\n\n<p>Edit:</p>\n\n<p>First you should understand what your task is. The <code>Crawl</code> function takes in an url, a dep and a fetcher, and it:</p>\n\n<ol>\n<li>Fetch the url</li>\n<li>Print the fetched body</li>\n<li>Make new <code>Crawl</code> queue generated from the fetched url with <code>dep-1</code></li>\n</ol>\n\n<p>Though the tour ask you to \"fetch\" url in parellel, it is clear that step 2 and step 3 must happen after step 1, meaning it is normal for a single Crawl to wait for the fetch. That means, no need for a new goroutine to call <code>Fetch</code>.</p>\n\n<p>And on step 3 each new <code>Crawl</code> call has no need to wait the previous to finish, so these calls should be parellel.</p>\n\n<p>With these analysis, one can come to these code:</p>\n\n<pre><code>func Crawl(url string, depth int, fetcher Fetcher) {\n    // TODO: Fetch URLs in parallel.\n    // TODO: Don't fetch the same URL twice.\n    // This implementation doesn't do either:\n    if depth &lt;= 0 {\n        return\n    }\n    body, urls, err := fetcher.Fetch(url)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Printf(\"found: %s %q\\n\", url, body)\n    for _, u := range urls {\n        go Crawl(u, depth-1, fetcher)\n    }\n    return\n}\n</code></pre>\n\n<p>There is one more problem: dealing with a visited url. You have done it well, instead of sending a <code>quit</code>, just make it <code>func(string) bool</code> and call it directly: <code>if Visited(Url) { return }</code> and it is done.</p>\n\n<p>A side note: the tour is really not good at teaching concurency. You may want to look go blog articles, like golang concurency patterns or share memory by communicating.</p>\n"}], "owner": {"reputation": 208, "user_id": 4038792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b11cd875604977cda21c19fd98bdf175?s=128&d=identicon&r=PG&f=1", "display_name": "Konstantinos Daskalopoulos", "link": "https://stackoverflow.com/users/4038792/konstantinos-daskalopoulos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1514738158, "creation_date": 1514728066, "last_edit_date": 1514732217, "question_id": 48042992, "link": "https://stackoverflow.com/questions/48042992/web-crawler-go-tour-different-output-same-code", "title": "Web Crawler go tour different output same code", "body": "<p>I've been trying to do all the tour of go tutorials and I'm stuck at the web crawler. I thought I finished it, but the output is inconsistent and I don't have enough concurrency experience to figure out why.</p>\n\n<p>Here's my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype Fetcher interface {\n    // Fetch returns the body of URL and\n    // a slice of URLs found on that page.\n    Fetch(url string) (body string, urls []string, err error)\n}\nvar cache = struct {\n    fetched map[string]bool\n    sync.Mutex\n}{fetched: make(map[string]bool)}\n\n// Crawl uses fetcher to recursively crawl\n// pages starting with url, to a maximum of depth.\nfunc Crawl(url string, depth int, fetcher Fetcher, c chan []string, quit chan int) {\n    if depth &lt;= 0 {\n        return\n    }\n    go safeVisit(url, c, quit, fetcher)\n    for {\n        select {\n        case &lt;- quit:\n            return\n        case u:= &lt;-c:\n            for _, v:= range u {\n                go Crawl(v, depth -1, fetcher, c, quit)\n            }\n        }\n    }\n}\nfunc main() {\n    c := make(chan []string)\n    quit := make(chan int)\n    Crawl(\"http://golang.org/\", 4, fetcher, c, quit)\n}\n\nfunc safeVisit(url string, c chan []string, quit chan int, fetcher Fetcher) {\n    cache.Lock()\n    defer cache.Unlock()\n    if _, ok := cache.fetched[url] ; ok {\n        quit &lt;- 0\n        return\n    }\n    body, urls, err := fetcher.Fetch(url)\n    cache.fetched[url] = true\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Printf(\"Visited : %s, %q \\n\", url, body)\n    c &lt;- urls\n\n}\n\n// fakeFetcher is Fetcher that returns canned results.\ntype fakeFetcher map[string]*fakeResult\n\ntype fakeResult struct {\n    body string\n    urls []string\n}\n\nfunc (f fakeFetcher) Fetch(url string) (string, []string, error) {\n    if res, ok := f[url]; ok {\n        return res.body, res.urls, nil\n    }\n    return \"\", nil, fmt.Errorf(\"not found: %s\", url)\n}\n\n// fetcher is a populated fakeFetcher.\nvar fetcher = fakeFetcher{\n    \"http://golang.org/\": &amp;fakeResult{\n        \"The Go Programming Language\",\n        []string{\n            \"http://golang.org/pkg/\",\n            \"http://golang.org/cmd/\",\n        },\n    },\n    \"http://golang.org/pkg/\": &amp;fakeResult{\n        \"Packages\",\n        []string{\n            \"http://golang.org/\",\n            \"http://golang.org/cmd/\",\n            \"http://golang.org/pkg/fmt/\",\n            \"http://golang.org/pkg/os/\",\n        },\n    },\n    \"http://golang.org/pkg/fmt/\": &amp;fakeResult{\n        \"Package fmt\",\n        []string{\n            \"http://golang.org/\",\n            \"http://golang.org/pkg/\",\n        },\n    },\n    \"http://golang.org/pkg/os/\": &amp;fakeResult{\n        \"Package os\",\n        []string{\n            \"http://golang.org/\",\n            \"http://golang.org/pkg/\",\n        },\n    },\n}\n</code></pre>\n\n<p>Here's some sample output</p>\n\n<pre><code>Visited : http://golang.org/, \"The Go Programming Language\" \nnot found: http://golang.org/cmd/\nVisited : http://golang.org/pkg/, \"Packages\" \nVisited : http://golang.org/pkg/os/, \"Package os\" \n**Visited : http://golang.org/pkg/fmt/, \"Package fmt\"** \n\nProcess finished with exit code 0\n</code></pre>\n\n<p>Different than the first the last package is missing (deliberately  in asterisks above)</p>\n\n<pre><code>Visited : http://golang.org/, \"The Go Programming Language\" \nnot found: http://golang.org/cmd/\nVisited : http://golang.org/pkg/, \"Packages\" \nVisited : http://golang.org/pkg/os/, \"Package os\"\n</code></pre>\n\n<p>And finally, even a deadlock in some runs:</p>\n\n<pre><code>Visited : http://golang.org/, \"The Go Programming Language\" \nnot found: http://golang.org/cmd/\nVisited : http://golang.org/pkg/, \"Packages\" \nVisited : http://golang.org/pkg/os/, \"Package os\" \nVisited : http://golang.org/pkg/fmt/, \"Package fmt\" \nfatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [select]:\nmain.Crawl(0x4bfdf9, 0x12, 0x4, 0x524220, 0xc420088120, 0xc420092000, 0xc420092060)\n    /home/kostas/development/challenges/go/helloWorld.go:26 +0x201\nmain.main()\n    /home/kostas/development/challenges/go/helloWorld.go:39 +0xab\n\ngoroutine 23 [select]:\nmain.Crawl(0x4bfdf9, 0x12, 0x3, 0x524220, 0xc420088120, 0xc420092000, 0xc420092060)\n    /home/kostas/development/challenges/go/helloWorld.go:26 +0x201\ncreated by main.Crawl\n    /home/kostas/development/challenges/go/helloWorld.go:31 +0x123\n\ngoroutine 24 [select]:\nmain.Crawl(0x4c09f9, 0x16, 0x3, 0x524220, 0xc420088120, 0xc420092000, 0xc420092060)\n    /home/kostas/development/challenges/go/helloWorld.go:26 +0x201\ncreated by main.Crawl\n    /home/kostas/development/challenges/go/helloWorld.go:31 +0x123\n\ngoroutine 5 [select]:\nmain.Crawl(0x4bfdf9, 0x12, 0x3, 0x524220, 0xc420088120, 0xc420092000, 0xc420092060)\n    /home/kostas/development/challenges/go/helloWorld.go:26 +0x201\ncreated by main.Crawl\n    /home/kostas/development/challenges/go/helloWorld.go:31 +0x123\n\ngoroutine 6 [select]:\nmain.Crawl(0x4c0a0f, 0x16, 0x3, 0x524220, 0xc420088120, 0xc420092000, 0xc420092060)\n    /home/kostas/development/challenges/go/helloWorld.go:26 +0x201\ncreated by main.Crawl\n    /home/kostas/development/challenges/go/helloWorld.go:31 +0x123\n</code></pre>\n\n<p>I assume it has something to do with concurrency and recursion. I've seen other solutions in git hub that use waiting group and such, but it's not used at the tutorials - tour of go so far so i'd rather not use it yet.</p>\n\n<p><strong><em>UPDATE</em></strong></p>\n\n<p>I figured out what is going on and working on the issue. Basically sometimes the select statement gets stuck in an endless loop because the channels quit and c don't always execute in the expected order. I added a default case that prints(\"nothing to do\") and the program sometimes looped forever, sometimes executed by luck in a correct manner. My exit condition is not right</p>\n"}, {"tags": ["go", "jsonschema"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1514726620, "post_id": 48042754, "comment_id": 83056277, "body": "jsonReferenceLoader implements the interface <a href=\"https://godoc.org/github.com/xeipuuv/gojsonschema#JSONLoader\" rel=\"nofollow noreferrer\">JSONLoader</a>, that should be all you need to interact with it."}, {"owner": {"reputation": 11294, "user_id": 1239122, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/8cf239e31df87733c835e53851283548?s=128&d=identicon&r=PG", "display_name": "Gravy", "link": "https://stackoverflow.com/users/1239122/gravy"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1514741730, "post_id": 48042754, "comment_id": 83060073, "body": "@Marc - Could you provide example in an answer and I can accept that as answer please?"}], "answers": [{"tags": [], "owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "is_accepted": true, "score": 1, "last_activity_date": 1514743154, "creation_date": 1514743154, "answer_id": 48044698, "question_id": 48042754, "link": "https://stackoverflow.com/questions/48042754/load-multiple-gojsonschemas-for-later-use/48044698#48044698", "title": "load multiple gojsonschemas for later use", "body": "<p>From @marc's response, you would just use the <code>JSONLoader</code> interface instead:</p>\n\n<pre><code>var files = make(map[string]gojsonschema.JSONLoader)\n</code></pre>\n\n<p>In Go, any variable/type/function/etc. that starts with a lowercase letter is \"private\", and therefore not visible outside of that package. Since your code is not part of the <code>gojsonschema</code> package, you can't access that type.</p>\n\n<p>Here's an example in the Go Tour:\n<a href=\"https://tour.golang.org/basics/3\" rel=\"nofollow noreferrer\">https://tour.golang.org/basics/3</a></p>\n"}], "owner": {"reputation": 11294, "user_id": 1239122, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/8cf239e31df87733c835e53851283548?s=128&d=identicon&r=PG", "display_name": "Gravy", "link": "https://stackoverflow.com/users/1239122/gravy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 336, "favorite_count": 0, "accepted_answer_id": 48044698, "answer_count": 1, "score": 0, "last_activity_date": 1514743154, "creation_date": 1514725880, "question_id": 48042754, "link": "https://stackoverflow.com/questions/48042754/load-multiple-gojsonschemas-for-later-use", "title": "load multiple gojsonschemas for later use", "body": "<p>I am trying to manage json validation for my rest API. I have decided to implement using <code>github.com/xeipuuv/gojsonschema</code> package.</p>\n\n<pre><code>func (a Auth) Login(w http.ResponseWriter, r *http.Request) {\n\n    bodyBytes, err := ioutil.ReadAll(r.Body)\n    if err != nil {\n        w.WriteHeader(http.StatusBadRequest)\n        return\n    }\n\n    cwd, _ := os.Getwd()\n    src := \"file://\" + cwd + \"/schemas/auth.json\"\n\n    schemaLoader := gojsonschema.NewReferenceLoader(src)\n    ...\n</code></pre>\n\n<p>Above works fine, but I am not happy, because for every API request, The schema needs to be loaded.</p>\n\n<p>So in my app setup, I want to load ALL schemas into a map of schemas for later use.</p>\n\n<pre><code>package schemas\n\nimport (\n    \"os\"\n    \"path/filepath\"\n    \"strings\"\n\n    \"github.com/xeipuuv/gojsonschema\"\n)\n\nconst ext = \".json\"\n\nfunc LoadSchemas() error {\n    pathS, err := os.Getwd()\n    if err != nil {\n        return err\n    }\n\n    var files = make(map[string]*gojsonschema.jsonReferenceLoader) // This is where I am stuck...\n    filepath.Walk(pathS+\"/schemas\", func(path string, f os.FileInfo, _ error) error {\n        if !f.IsDir() {\n            if filepath.Ext(path) == ext {\n                key := strings.TrimRight(f.Name(), ext)\n                files[key] = gojsonschema.NewReferenceLoader(\"file://\" + path)\n            }\n        }\n        return nil\n    })\n\n    return nil\n}\n</code></pre>\n\n<p><code>gojsonschema.NewReferenceLoader(\"file://\" + path)</code> returns <code>*jsonReferenceLoader</code> - jsonReferenceLoader is not exported outside the package.</p>\n\n<pre><code>// NewReferenceLoader returns a JSON reference loader using the given source and the local OS file system.\nfunc NewReferenceLoader(source string) *jsonReferenceLoader {\n    return &amp;jsonReferenceLoader{\n        fs:     osFS,\n        source: source,\n    }\n}\n</code></pre>\n\n<p>Any hints / tips on how to solve the above problem?</p>\n"}, {"tags": ["python", "go", "tensorflow"], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user7036306"}, "is_accepted": true, "score": 1, "last_activity_date": 1514723885, "creation_date": 1514723885, "answer_id": 48042489, "question_id": 48041508, "link": "https://stackoverflow.com/questions/48041508/working-with-tf-retrained-model/48042489#48042489", "title": "Working with TF Retrained Model", "body": "<p>I think I found the issue. I've modified the sizes to correspond to the newly trained model. however the scaling remained as 1 instead of 128.\nnow the results are reasonably well.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7036306"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 48042489, "answer_count": 1, "score": 1, "last_activity_date": 1514723885, "creation_date": 1514714035, "question_id": 48041508, "link": "https://stackoverflow.com/questions/48041508/working-with-tf-retrained-model", "title": "Working with TF Retrained Model", "body": "<p>I'm trying to understand how to properly use a re-trained model that was generated using <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/image_retraining/retrain.py\" rel=\"nofollow noreferrer\">TensorFlow Retrain</a>\nIn <a href=\"https://outcrawl.com/image-recognition-api-go-tensorflow/\" rel=\"nofollow noreferrer\">Golang classifier</a>.</p>\n\n<p>I'm getting different results when I use the different models (extremely different and <strong>wrong results</strong> when using the Golang classifier)</p>\n\n<p>After iterating the graph's operations I made some modifications to the Go app for it to work:</p>\n\n<pre><code>session.Run(\nmap[tf.Output]*tf.Tensor{\n    graph.Operation(\"Mul\").Output(0): tensor, // was \"input\"\n},\n[]tf.Output{\n    graph.Operation(\"final_result\").Output(0), // was \"output\"\n},\nnil)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>const (\n    H, W= 299, 299 // was 224,224\n    Mean= float32(128) // was 117\n    Scale= float32(1)\n)\n</code></pre>\n\n<p>Am I loading the graph properly? is it wrong for the Mul operation to be first?\nperhaps the resizing</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "edited": false, "score": 0, "creation_date": 1514710082, "post_id": 48041140, "comment_id": 83052653, "body": "Please post <code>dateValue</code> and <code>timeValue</code> too."}, {"owner": {"reputation": 133, "user_id": 2225393, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/99ecc0f27896b0cac269ffc3ef284605?s=128&d=identicon&r=PG", "display_name": "ray", "link": "https://stackoverflow.com/users/2225393/ray"}, "reply_to_user": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "edited": false, "score": 0, "creation_date": 1514710864, "post_id": 48041140, "comment_id": 83052818, "body": "These 2 values I read from a CSV file. I printed them out, there are \u201c2012-4-9\u201d and \u201c174031\u201d. Looks correct."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1514711368, "post_id": 48041140, "comment_id": 83052933, "body": "Try print them into a file and use a decent file editor or a hex viewer and see if there are unwanted leading chars."}, {"owner": {"reputation": 133, "user_id": 2225393, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/99ecc0f27896b0cac269ffc3ef284605?s=128&d=identicon&r=PG", "display_name": "ray", "link": "https://stackoverflow.com/users/2225393/ray"}, "edited": false, "score": 0, "creation_date": 1514711451, "post_id": 48041140, "comment_id": 83052947, "body": "This makes sense! Will try it. Thanks."}, {"owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "edited": false, "score": 0, "creation_date": 1514715879, "post_id": 48041140, "comment_id": 83053858, "body": "@ray Try comparing them <code>fmt.Sprintf(&quot;%s %s CST&quot;, dateValue, timeValue) == &quot;2012-4-9 174031 CST&quot;</code> and post the result."}, {"owner": {"reputation": 133, "user_id": 2225393, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/99ecc0f27896b0cac269ffc3ef284605?s=128&d=identicon&r=PG", "display_name": "ray", "link": "https://stackoverflow.com/users/2225393/ray"}, "reply_to_user": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "edited": false, "score": 0, "creation_date": 1514728102, "post_id": 48041140, "comment_id": 83056694, "body": "@ArmanOrdookhani it returns false. Looks like the problem is here."}, {"owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "edited": false, "score": 0, "creation_date": 1514728429, "post_id": 48041140, "comment_id": 83056757, "body": "@ray range over both strings and print their runes to find the difference. Maybe it&#39;s a non-printable character or some kind of whitespace."}], "answers": [{"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1514711312, "post_id": 48041219, "comment_id": 83052914, "body": "Instead of white space, I would suggest special characters like <code>\\x0</code> which will not be printed to screen. Try print the string into a file for more details."}, {"owner": {"reputation": 133, "user_id": 2225393, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/99ecc0f27896b0cac269ffc3ef284605?s=128&d=identicon&r=PG", "display_name": "ray", "link": "https://stackoverflow.com/users/2225393/ray"}, "edited": false, "score": 0, "creation_date": 1514711317, "post_id": 48041219, "comment_id": 83052917, "body": "Thanks for your reply. From the error message, it looks the string is correct (I tried to copy the string in error message and parse it directly without any error). The values are actually read from a csv file, I have difficulty to reproduce it in play.golang.org."}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1514726952, "post_id": 48041219, "comment_id": 83056370, "body": "Can you post what you get with printf for those values? Can you check the csv file for the right encoding and for non printable characters or white space  in a text editor? If you can isolate to one line of a csv it should be simpler."}, {"owner": {"reputation": 133, "user_id": 2225393, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/99ecc0f27896b0cac269ffc3ef284605?s=128&d=identicon&r=PG", "display_name": "ray", "link": "https://stackoverflow.com/users/2225393/ray"}, "edited": false, "score": 1, "creation_date": 1514728738, "post_id": 48041219, "comment_id": 83056815, "body": "@KennyGrant Thanks! Looks like it&#39;s the encoding issue. I copy and paste the same line to a new empty csv file, the error is gone."}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 1, "last_activity_date": 1514726740, "last_edit_date": 1514726740, "creation_date": 1514710594, "answer_id": 48041219, "question_id": 48041140, "link": "https://stackoverflow.com/questions/48041140/weird-error-message-while-parsing-time-in-go/48041219#48041219", "title": "Weird error message while parsing time in GO", "body": "<p>Your values are not as you expect. I suspect you have whitespace in one or more values. Here is an example to play with which produces the same error (note the leading space on dateValue): </p>\n\n<p><a href=\"https://play.golang.org/p/UwKhjQs6Nig\" rel=\"nofollow noreferrer\">https://play.golang.org/p/UwKhjQs6Nig</a></p>\n\n<pre><code>dateValue := \" 2012-4-9\"\ntimeValue := \"174031\"\ndateTime := fmt.Sprintf(\"%s %s CST\", dateValue, timeValue)\ndate, err := time.Parse(\"2006-1-2 150405 MST\", dateTime)\n</code></pre>\n\n<p>The first step if you ever hit a problem like this is to print your values before using them to verify they are exactly as you expect. If posting for help, also try to reproduce it on play.golang.org - often the process of doing this will help you finding the problem yourself. </p>\n\n<p>The error message could be better, but I suspect what it is doing is taking the first part of the format (year), attempting to find it in the string value and failing, hence the report of not finding 2006. </p>\n"}], "owner": {"reputation": 133, "user_id": 2225393, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/99ecc0f27896b0cac269ffc3ef284605?s=128&d=identicon&r=PG", "display_name": "ray", "link": "https://stackoverflow.com/users/2225393/ray"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1514726740, "creation_date": 1514709757, "question_id": 48041140, "link": "https://stackoverflow.com/questions/48041140/weird-error-message-while-parsing-time-in-go", "title": "Weird error message while parsing time in GO", "body": "<p>I tried to parsing string to time in go, here is what I've done:</p>\n\n<pre><code>dateTime := fmt.Sprintf(\"%s %s CST\", dateValue, timeValue)\ndate, err := time.Parse(\"2006-1-2 150405 MST\", dateTime)\n</code></pre>\n\n<p>I got the following error message:</p>\n\n<p><code>parsing time \"2012-4-9 174031 CST\" as \"2006-1-2 150405 MST\": cannot parse \"2012-4-9 174031 CST\" as \"2006\"</code></p>\n\n<p>From the error message, it shows the <code>dateTime</code> value I passed in is correct. I also tried to do the following, it works fine:</p>\n\n<pre><code>dateTime := \"2012-4-9 174031 CST\"\ndate, err := time.Parse(\"2006-1-2 150405 MST\", dateTime)\n</code></pre>\n\n<p>This is bothering me for a few days. Could anybody help to point out where is the mistake? Thanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8073, "user_id": 2852624, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/682806d261e4f00f77aa8633689a9558?s=128&d=identicon&r=PG&f=1", "display_name": "Matthias247", "link": "https://stackoverflow.com/users/2852624/matthias247"}, "edited": false, "score": 0, "creation_date": 1514698665, "post_id": 48039966, "comment_id": 83050952, "body": "Why don&#39;t you simply remove them if you don&#39;t need them? <code>var jsonBytes = &quot;[{\\&quot;Fld1\\&quot;:10,\\&quot;Fld2\\&quot;:\\&quot;0.2\\&quot;},{\\&quot;Fld1\\&quot;:10,\\&quot;Fld2\\&quot;:\\&quot;0.2&zwnj;&#8203;6 \\&quot;}]&quot;</code>"}, {"owner": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "edited": false, "score": 5, "creation_date": 1514699552, "post_id": 48039966, "comment_id": 83051075, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/16846553/how-to-unmarshal-an-escaped-json-string-in-go\">How to unmarshal an escaped JSON string in Go?</a>"}, {"owner": {"reputation": 6756, "user_id": 1606248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0lXId.jpg?s=128&g=1", "display_name": "Pierre Prinetti", "link": "https://stackoverflow.com/users/1606248/pierre-prinetti"}, "edited": false, "score": 0, "creation_date": 1514728600, "post_id": 48039966, "comment_id": 83056786, "body": "What is the code that you run when you &quot;Unmarshal&quot; that string?"}], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 1456110, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d97b546c3896202e2945c270d8feb750?s=128&d=identicon&r=PG", "display_name": "user1456110", "link": "https://stackoverflow.com/users/1456110/user1456110"}, "edited": false, "score": 0, "creation_date": 1514782425, "post_id": 48040705, "comment_id": 83066029, "body": "The reason I couldn&#39;t remove those leading character is because I am receiving that string from backend.."}, {"owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "reply_to_user": {"reputation": 87, "user_id": 1456110, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d97b546c3896202e2945c270d8feb750?s=128&d=identicon&r=PG", "display_name": "user1456110", "link": "https://stackoverflow.com/users/1456110/user1456110"}, "edited": false, "score": 0, "creation_date": 1514783963, "post_id": 48040705, "comment_id": 83066217, "body": "@user1456110 then modify it from the backend :). if you can&#39;t then this is one of the solutions."}], "tags": [], "owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "is_accepted": true, "score": 1, "last_activity_date": 1514704473, "creation_date": 1514704473, "answer_id": 48040705, "question_id": 48039966, "link": "https://stackoverflow.com/questions/48039966/remove-escaped-double-quotes-from-string-golang/48040705#48040705", "title": "remove escaped double quotes from string golang", "body": "<ul>\n<li>First mistake is you have enter <code>\\n</code> in your jsonBytes. remove that near <code>\"0.26</code></li>\n<li>you have <code>\\</code> in the first and the last data. I will show you to remove it below : </li>\n</ul>\n\n<p>`</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"reflect\"\n\n    \"github.com/Gujarats/logger\"\n)\n\ntype Msg struct {\n    Channel int    `json:\"Fld1\"`\n    Name    string `json:\"Fld2\"`\n    Msg     string\n}\n\nfunc main() {\n    var msg []Msg\n    var jsonBytes = \"\\\"[{\\\"Fld1\\\":10,\\\"Fld2\\\":\\\"0.2\\\"},{\\\"Fld1\\\":10,\\\"Fld2\\\":\\\"0.26\\\"}]\\\"\"\n\n    // Removing the the first and the last '\\'\n    newVal := jsonBytes[1 : len(jsonBytes)-1]\n    logger.Debug(\"newval type \", reflect.TypeOf(newVal))\n    logger.Debug(\"newval \", newVal)\n\n\n    err := json.Unmarshal([]byte(newVal), &amp;msg)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf(\"%+v\\n\", msg)\n}\n</code></pre>\n"}], "owner": {"reputation": 87, "user_id": 1456110, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d97b546c3896202e2945c270d8feb750?s=128&d=identicon&r=PG", "display_name": "user1456110", "link": "https://stackoverflow.com/users/1456110/user1456110"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4823, "favorite_count": 0, "accepted_answer_id": 48040705, "answer_count": 1, "score": 0, "last_activity_date": 1514704473, "creation_date": 1514694175, "last_edit_date": 1514696904, "question_id": 48039966, "link": "https://stackoverflow.com/questions/48039966/remove-escaped-double-quotes-from-string-golang", "title": "remove escaped double quotes from string golang", "body": "<p>This my json string</p>\n\n<pre><code>var jsonBytes = \"\\\"[{\\\"Fld1\\\":10,\\\"Fld2\\\":\\\"0.2\\\"},{\\\"Fld1\\\":10,\\\"Fld2\\\":\\\"0.26\n\\\"}]\\\"\"\n</code></pre>\n\n<p>This string has escaped double quotes. If I <strong>Unmarshal</strong> it by converting to []bytes, its not working, as the convereted []byte array still has leading and trailing double quotes.</p>\n\n<p>How do I remove those leading and trailing quotes in go?</p>\n"}, {"tags": ["go", "binary", "network-programming", "binary-data", "socks"], "comments": [{"owner": {"reputation": 8073, "user_id": 2852624, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/682806d261e4f00f77aa8633689a9558?s=128&d=identicon&r=PG&f=1", "display_name": "Matthias247", "link": "https://stackoverflow.com/users/2852624/matthias247"}, "edited": false, "score": 0, "creation_date": 1514701009, "post_id": 48039951, "comment_id": 83051268, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/16888357/convert-an-integer-to-a-byte-array\">Convert an integer to a byte array</a>"}, {"owner": {"reputation": 8073, "user_id": 2852624, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/682806d261e4f00f77aa8633689a9558?s=128&d=identicon&r=PG&f=1", "display_name": "Matthias247", "link": "https://stackoverflow.com/users/2852624/matthias247"}, "edited": false, "score": 0, "creation_date": 1514701059, "post_id": 48039951, "comment_id": 83051283, "body": "That&#39;s a duplicate of the many convert integer to binary questions here, e.g. <a href=\"https://stackoverflow.com/questions/16888357/convert-an-integer-to-a-byte-array\" title=\"convert an integer to a byte array\">stackoverflow.com/questions/16888357/&hellip;</a>. Look at the encoding/binary package, which is far more efficient then going to a string and back."}, {"owner": {"reputation": 2384, "user_id": 3553432, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fb2106952e54afdb0d370799f988ba25?s=128&d=identicon&r=PG", "display_name": "nikoss", "link": "https://stackoverflow.com/users/3553432/nikoss"}, "reply_to_user": {"reputation": 8073, "user_id": 2852624, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/682806d261e4f00f77aa8633689a9558?s=128&d=identicon&r=PG&f=1", "display_name": "Matthias247", "link": "https://stackoverflow.com/users/2852624/matthias247"}, "edited": false, "score": 0, "creation_date": 1514703271, "post_id": 48039951, "comment_id": 83051580, "body": "@Matthias247 binary.Write results something totally unusable for my case it gives me more bytes than i need"}, {"owner": {"reputation": 8073, "user_id": 2852624, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/682806d261e4f00f77aa8633689a9558?s=128&d=identicon&r=PG&f=1", "display_name": "Matthias247", "link": "https://stackoverflow.com/users/2852624/matthias247"}, "edited": false, "score": 0, "creation_date": 1514703940, "post_id": 48039951, "comment_id": 83051671, "body": "Then use only the bytes that you need. Or convert to a short before converting to binary."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1514704332, "post_id": 48039951, "comment_id": 83051720, "body": "The code in <a href=\"https://github.com/golang/net/tree/master/proxy\" rel=\"nofollow noreferrer\">github.com/golang/net/tree/master/proxy</a> may be of use to you. See the _test.go file for the server side of the protocol."}], "answers": [{"comments": [{"owner": {"reputation": 2384, "user_id": 3553432, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fb2106952e54afdb0d370799f988ba25?s=128&d=identicon&r=PG", "display_name": "nikoss", "link": "https://stackoverflow.com/users/3553432/nikoss"}, "edited": false, "score": 0, "creation_date": 1514697525, "post_id": 48040050, "comment_id": 83050806, "body": "can you please explain what is going on with all the bitwise ops and is there any resource where i can learn more about these ops i still have difficulties understanding why and how we use bitwise operations. All the resources explain what they do which i understand perfectly but none refers why we need those operations over binary.  In your example i understand the second part it moves the b[0] 8 bits left and adds b[1] which makes perfect sense but the first part im totally lost @leafBebop"}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1514698100, "post_id": 48040050, "comment_id": 83050874, "body": "You mean low and high <i>byte</i>, not &#39;bit&#39;."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514701579, "post_id": 48040050, "comment_id": 83051363, "body": "255 is basically 11111111 which is a mask of the lower bytes. It is rather a simple bit-op. To understand why you need a bit-ops you may need to learn how the machine work, what is a byte and how are ints stored. However, I did not learn all these in English, so I cannot recommend resources."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 1, "last_activity_date": 1514701904, "last_edit_date": 1514701904, "creation_date": 1514695278, "answer_id": 48040050, "question_id": 48039951, "link": "https://stackoverflow.com/questions/48039951/how-to-return-the-port-number-in-2-bytes-to-client-in-socks5-proxy/48040050#48040050", "title": "How to return the port number in 2 bytes to client in socks5 proxy?", "body": "<p>Your code has multiple problem. First :8 and 9: miss an element ([8]), see: <a href=\"https://play.golang.org/p/yuhh4ZeJFNL\" rel=\"nofollow noreferrer\">https://play.golang.org/p/yuhh4ZeJFNL</a></p>\n\n<p>And also, you should interept the second byte as lowbyte of the int and the first as highbyte, not literally cut the binary string. for example <code>4</code> should be interept as <code>[0x0,0x4]</code> instead of <code>[0x4,0x0]</code> which shoulld be 1024.</p>\n\n<p>If you want to keep using strconv you should use:</p>\n\n<pre><code>n := len(binary)\nfirst := binary[:n-8]\nlast := binary[n-8:]\n</code></pre>\n\n<p>However it is very unefficient. </p>\n\n<p>I would suggest <code>b[0],b[1] = i &gt;&gt; 8, i &amp; 255</code>, and <code>i = b[0]&lt;&lt;8 + b[1]</code> .</p>\n"}], "owner": {"reputation": 2384, "user_id": 3553432, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/fb2106952e54afdb0d370799f988ba25?s=128&d=identicon&r=PG", "display_name": "nikoss", "link": "https://stackoverflow.com/users/3553432/nikoss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 310, "favorite_count": 0, "accepted_answer_id": 48040050, "answer_count": 1, "score": 0, "last_activity_date": 1514701904, "creation_date": 1514693932, "question_id": 48039951, "link": "https://stackoverflow.com/questions/48039951/how-to-return-the-port-number-in-2-bytes-to-client-in-socks5-proxy", "title": "How to return the port number in 2 bytes to client in socks5 proxy?", "body": "<p>I am trying to implement socks5 proxy server.\nMost things are clear according to the rfc but I'm stuck interpreting client port and writing my port number in bytes.</p>\n\n<p>I made a function that tkes an int and returns 2 bytes. This function first converts number into binary then literally splits the bits as string then converts them back to byte.However this seems wrong because if the right most bits are 0 they are lost.\nHere is the function </p>\n\n<pre><code>func getBytesOfInt(i int) []byte {\n    binary := fmt.Sprintf(\"%b\", i)\n    if i &lt; 255 {\n        return []byte{byte(i)}\n    }\n    first := binary[:8]\n    last := binary[9:]\n    fmt.Println(binary, first, last)\n    i1, _ := strconv.ParseInt(first, 2, 64)\n    i2, _ := strconv.ParseInt(last, 2, 64)\n    return []byte{byte(i1), byte(i2)}\n}\n</code></pre>\n\n<p>Can you please explain me how am i supposed to parse the number and get 2 bytes and most importantly how am i going to cast it back to an integer.</p>\n\n<p>Currently if you give 1024 to this function it will return <code>[]byte{0x80, 0x0}</code> which is 128 in decimals but as you see the right bits are lost theres only one 0 which is useless.</p>\n"}, {"tags": ["rest", "go", "restful-url"], "comments": [{"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1514696594, "post_id": 48039943, "comment_id": 83050714, "body": "Client can <a href=\"https://golang.org/pkg/net/http/#Client.PostForm\" rel=\"nofollow noreferrer\">post</a> parameters for server to <a href=\"https://golang.org/pkg/net/http/#Request.ParseForm\" rel=\"nofollow noreferrer\">parse</a>"}], "answers": [{"comments": [{"owner": {"reputation": 342, "user_id": 3283051, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f28830b4cd0a70d2487b05211ab9a19f?s=128&d=identicon&r=PG&f=1", "display_name": "Prstoo", "link": "https://stackoverflow.com/users/3283051/prstoo"}, "edited": false, "score": 0, "creation_date": 1514697896, "post_id": 48040130, "comment_id": 83050844, "body": "Thanks, but what should I send as a body to NewRequest?nil?"}, {"owner": {"reputation": 342, "user_id": 3283051, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f28830b4cd0a70d2487b05211ab9a19f?s=128&d=identicon&r=PG&f=1", "display_name": "Prstoo", "link": "https://stackoverflow.com/users/3283051/prstoo"}, "edited": false, "score": 0, "creation_date": 1514698521, "post_id": 48040130, "comment_id": 83050933, "body": "And .Do, shouldn&#39;t be called on a client? <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">link</a>"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 342, "user_id": 3283051, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f28830b4cd0a70d2487b05211ab9a19f?s=128&d=identicon&r=PG&f=1", "display_name": "Prstoo", "link": "https://stackoverflow.com/users/3283051/prstoo"}, "edited": false, "score": 1, "creation_date": 1514701360, "post_id": 48040130, "comment_id": 83051325, "body": "My bad, you should use a client and use nil as body. I was on a hurry. Sorry."}, {"owner": {"reputation": 342, "user_id": 3283051, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f28830b4cd0a70d2487b05211ab9a19f?s=128&d=identicon&r=PG&f=1", "display_name": "Prstoo", "link": "https://stackoverflow.com/users/3283051/prstoo"}, "edited": false, "score": 0, "creation_date": 1514739612, "post_id": 48040130, "comment_id": 83059568, "body": "That&#39;s okay :) I updated the post but the problem still remains."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 342, "user_id": 3283051, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f28830b4cd0a70d2487b05211ab9a19f?s=128&d=identicon&r=PG&f=1", "display_name": "Prstoo", "link": "https://stackoverflow.com/users/3283051/prstoo"}, "edited": false, "score": 1, "creation_date": 1514742064, "post_id": 48040130, "comment_id": 83060141, "body": "That is because <code>myName</code> has a <code>\\n</code> trailing to it. Use <code>strings.TrimSpace</code> to get rid of it and you&#39;ll be fine. But I advice against usage of header."}, {"owner": {"reputation": 342, "user_id": 3283051, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f28830b4cd0a70d2487b05211ab9a19f?s=128&d=identicon&r=PG&f=1", "display_name": "Prstoo", "link": "https://stackoverflow.com/users/3283051/prstoo"}, "edited": false, "score": 0, "creation_date": 1514742499, "post_id": 48040130, "comment_id": 83060242, "body": "strings.TrimSpace did not help. You&#39;re right but because I didn&#39;t know how to send it to the body I used the header."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 342, "user_id": 3283051, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f28830b4cd0a70d2487b05211ab9a19f?s=128&d=identicon&r=PG&f=1", "display_name": "Prstoo", "link": "https://stackoverflow.com/users/3283051/prstoo"}, "edited": false, "score": 0, "creation_date": 1514742773, "post_id": 48040130, "comment_id": 83060294, "body": "On my laptop it solved the problem. Maybe your username contains other characters which are invalid in a header."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 0, "last_activity_date": 1514701406, "last_edit_date": 1514701406, "creation_date": 1514696351, "answer_id": 48040130, "question_id": 48039943, "link": "https://stackoverflow.com/questions/48039943/sending-data-from-client-to-server-rest-webservice/48040130#48040130", "title": "Sending data from client to server - REST webservice", "body": "<p>You may want to have a look at <code>http query string</code>. <a href=\"https://en.wikipedia.org/wiki/Query_string\" rel=\"nofollow noreferrer\">Wikipedia</a></p>\n\n<p>Sending the username.</p>\n\n<pre><code>req := http.NewRequest(\"GET\",\"localhost:8080\",nil)\nq:=req.URL.Query()\nq.Add(\"username\",myName)\nreq.URL.RawQuery = q.Encode()\nResp,err:=http. Client{}.Do(req)\n</code></pre>\n\n<p>Recieving the username:</p>\n\n<pre><code>clientName := r.URL.Query()[\"username\"][0]\n</code></pre>\n\n<p>Note that if your are going to do the same with password or any other sensitive data, please do some research on how to make it secure and DO NOT copy this code.</p>\n"}], "owner": {"reputation": 342, "user_id": 3283051, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f28830b4cd0a70d2487b05211ab9a19f?s=128&d=identicon&r=PG&f=1", "display_name": "Prstoo", "link": "https://stackoverflow.com/users/3283051/prstoo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 48040130, "answer_count": 1, "score": 0, "last_activity_date": 1514739765, "creation_date": 1514693775, "last_edit_date": 1514739765, "question_id": 48039943, "link": "https://stackoverflow.com/questions/48039943/sending-data-from-client-to-server-rest-webservice", "title": "Sending data from client to server - REST webservice", "body": "<p>I am developing a client-server application using RESTful web services. </p>\n\n<p>I want to ask for user input on the client and send it to the server and use that name in the rest of my program but I cannot send the name to the server properly.</p>\n\n<p>Below is a part of my program:</p>\n\n<p>Client:</p>\n\n<pre><code>func main() {\n       //getting input\n        fmt.Println(\"Please enter your name: \")\n        reader := bufio.NewReader(os.Stdin)\n        myName, _ := reader.ReadString('\\n')\n\n        client := &amp;http.Client{\n            CheckRedirect: nil,\n        }\n        reply, err := http.NewRequest(\"GET\", \"http://localhost:8080/\", nil)\n        reply.Header.Add(\"username\", myName)\n        client.Do(reply)\n        if err != nil {\n            fmt.Println(err)\n        }\n</code></pre>\n\n<p>Server:</p>\n\n<pre><code>func CreateClient(w http.ResponseWriter, r *http.Request) {\n\n    clientName := r.Header.Get(\"username\")\n    fmt.Println(clientName, \"---------\")//it's empty\n    cli := &amp;Client{\n        currentRoom:   nil, //starts as nil because the user is not initally in a room\n        outputChannel: make(chan string),\n        name:          clientName,\n    }\n    Members = append(Members, cli)\n\n    reply := cli.name\n\n    fmt.Fprintf(w, reply)\n}\n</code></pre>\n\n<p>on the client side, reply (<code>reply.Header.Add(\"username\", myName)</code>) has the user name in the header but on the server side clientName (<code>clientName := r.Header.Get(\"username\")</code>) is empty so the rest of my program won't run.</p>\n\n<p>My problem is that I cannot send the user input to the server and take it back on the client side.</p>\n\n<p>Can someone tell me how I can solve the problem?</p>\n"}, {"tags": ["oop", "pointers", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1514681574, "post_id": 48039061, "comment_id": 83048604, "body": "<a href=\"https://golang.org/doc/faq#methods_on_values_or_pointers\" rel=\"nofollow noreferrer\">golang.org/doc/faq#methods_on_values_or_pointers</a>"}], "answers": [{"comments": [{"owner": {"reputation": 74, "user_id": 704525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/35cc371a9d596cde389af4df8d7662e2?s=128&d=identicon&r=PG", "display_name": "Bryan", "link": "https://stackoverflow.com/users/704525/bryan"}, "edited": false, "score": 2, "creation_date": 1514685321, "post_id": 48039171, "comment_id": 83049093, "body": "Thanks for pointing me to that FAQ, that makes a lot more sense!"}, {"owner": {"reputation": 3641, "user_id": 3139595, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/r1GRx.png?s=128&g=1", "display_name": "Edwin O.", "link": "https://stackoverflow.com/users/3139595/edwin-o"}, "reply_to_user": {"reputation": 74, "user_id": 704525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/35cc371a9d596cde389af4df8d7662e2?s=128&d=identicon&r=PG", "display_name": "Bryan", "link": "https://stackoverflow.com/users/704525/bryan"}, "edited": false, "score": 0, "creation_date": 1514723835, "post_id": 48039171, "comment_id": 83055618, "body": "willkommen..glad to help!"}], "tags": [], "owner": {"reputation": 3641, "user_id": 3139595, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/r1GRx.png?s=128&g=1", "display_name": "Edwin O.", "link": "https://stackoverflow.com/users/3139595/edwin-o"}, "is_accepted": true, "score": 4, "last_activity_date": 1514682665, "creation_date": 1514682665, "answer_id": 48039171, "question_id": 48039061, "link": "https://stackoverflow.com/questions/48039061/confusion-on-how-golang-pointers-are-preserved-in-structs/48039171#48039171", "title": "Confusion on how Golang pointers are preserved in structs", "body": "<p>It didn't work in the first case, because <code>func (mo MyObject) Open(filepath string)</code>  only got a local copy of <code>MyObject</code>...and all changes made to it remained within that context.</p>\n\n<p>But after you added <code>*</code> to the receiver, i.e <code>(mo *MyObject)</code> the changes within the function affected the original MyObject.</p>\n\n<p><a href=\"https://golang.org/doc/faq#methods_on_values_or_pointers\" rel=\"nofollow noreferrer\">you can check here for more info</a></p>\n\n<p>hope this helps </p>\n"}], "owner": {"reputation": 74, "user_id": 704525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/35cc371a9d596cde389af4df8d7662e2?s=128&d=identicon&r=PG", "display_name": "Bryan", "link": "https://stackoverflow.com/users/704525/bryan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 48039171, "answer_count": 1, "score": 1, "last_activity_date": 1514682665, "creation_date": 1514680754, "question_id": 48039061, "link": "https://stackoverflow.com/questions/48039061/confusion-on-how-golang-pointers-are-preserved-in-structs", "title": "Confusion on how Golang pointers are preserved in structs", "body": "<p>I'm currently learning golang (mostly a Java/C# developer) and I hit an issue with pointers and defer.</p>\n\n<p>I'm trying to wrap the writes to a CSV file under a struct in a OO-like style. From the examples I found online, it seems that creating \"methods\" on a struct could be done like so:</p>\n\n<pre><code>type MyObject struct {\n    fp  *os.File\n    csv *csv.Writer\n}\n\nfunc (mo MyObject) Open(filepath string) {\n\n    println(&amp;mo)\n    var err error\n    mo.fp, err = os.Create(filepath)\n    if err != nil {\n        panic(err)\n    }\n\n    mo.csv = csv.NewWriter(mo.fp)\n}\n</code></pre>\n\n<p>The problem I hit was once I left the Open method, the pointers for fp and csv went back to null. Subsequent calls to this class would throw a nil error. A full example can be found <a href=\"https://play.golang.org/p/UixVUY9pbfT\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>After a lot of googling, I ended up looking at how golang implemented their <a href=\"https://github.com/golang/go/blob/master/src/log/log.go\" rel=\"nofollow noreferrer\">logger</a>. They used a pointer to the object like so:</p>\n\n<pre><code>type MyObject struct {\n    fp  *os.File\n    csv *csv.Writer\n}\n\nfunc New() *MyObject {\n    return &amp;MyObject{}\n}\n\nfunc (mo *MyObject) Open(filepath string) {\n\n    println(&amp;mo)\n    var err error\n    mo.fp, err = os.Create(filepath)\n    if err != nil {\n        panic(err)\n    }\n\n    mo.csv = csv.NewWriter(mo.fp)\n}\n</code></pre>\n\n<p>A refactoring of my code (see <a href=\"https://play.golang.org/p/HAMiycA7V1L\" rel=\"nofollow noreferrer\">here</a>) shows it works as expected. I'm still confused though why the first method didn't work. I'm guessing I'm  misunderstanding something on how structs, pointers, and/or defer work. What am I missing?</p>\n"}, {"tags": ["algorithm", "go", "data-structures", "containers"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1514689944, "post_id": 48039010, "comment_id": 83049731, "body": "Have you benchmarked a <code>map[string]struct{}</code> with an <a href=\"https://godoc.org/sync#RWMutex\" rel=\"nofollow noreferrer\"><code>RWMutex</code></a>?"}, {"owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "edited": false, "score": 1, "creation_date": 1514691946, "post_id": 48039010, "comment_id": 83050040, "body": "<a href=\"https://github.com/cornelk/hashmap\" rel=\"nofollow noreferrer\">This hasmap package</a> could fit your needs."}, {"owner": {"reputation": 121669, "user_id": 56778, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/34b152ef95a49568ce45df38cd87e54b?s=128&d=identicon&r=PG", "display_name": "Jim Mischel", "link": "https://stackoverflow.com/users/56778/jim-mischel"}, "edited": false, "score": 0, "creation_date": 1514731273, "post_id": 48039010, "comment_id": 83057517, "body": "How many lookups per second are we talking here? How many total keys? You say that removal and insertion are infrequent. How infrequent? It sounds to me like a hashmap and a reader/writer lock will be very effective for you. See <a href=\"https://stackoverflow.com/questions/19148809/how-to-use-rwmutex-in-golang\" title=\"how to use rwmutex in golang\">stackoverflow.com/questions/19148809/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "is_accepted": false, "score": 0, "last_activity_date": 1514708889, "last_edit_date": 1514708889, "creation_date": 1514708327, "answer_id": 48041020, "question_id": 48039010, "link": "https://stackoverflow.com/questions/48039010/data-structure-for-concurent-heavy-read-workload/48041020#48041020", "title": "Data-structure for concurent heavy read workload", "body": "<p><code>map</code> is safe for concurrent read. You could put your desired map inside a <code>sync/atomic.Value</code> and when you want to write to it, duplicate the map and change it, then put it back inside <code>Value</code>. From <a href=\"https://golang.org/pkg/sync/atomic/#Value\" rel=\"nofollow noreferrer\">docs</a>:</p>\n\n<blockquote>\n  <p>The following example shows how to maintain a scalable frequently\n  read, but infrequently updated data structure using copy-on-write\n  idiom.</p>\n  \n  <p>Code:</p>\n\n<pre><code>type Map map[string]string\nvar m Value\nm.Store(make(Map))\nvar mu sync.Mutex // used only by writers\n// read function can be used to read the data without further synchronization\nread := func(key string) (val string) {\n        m1 := m.Load().(Map)\n        return m1[key]\n}\n// insert function can be used to update the data without further synchronization\ninsert := func(key, val string) {\n        mu.Lock() // synchronize with other potential writers\n        defer mu.Unlock()\n        m1 := m.Load().(Map) // load current value of the data structure\n        m2 := make(Map)      // create a new value\n        for k, v := range m1 {\n                m2[k] = v // copy all data from the current object to the new one\n        }\n        m2[key] = val // do the update that we need\n        m.Store(m2)   // atomically replace the current object with the new one\n        // At this point all new readers start working with the new version.\n        // The old version will be garbage collected once the existing readers\n        // (if any) are done with it.\n}\n_, _ = read, insert\n</code></pre>\n</blockquote>\n\n<p>You could also use a pointer to you <code>map</code> instead of <code>Value</code> and store it atomically using <a href=\"https://golang.org/pkg/sync/atomic/#StorePointer\" rel=\"nofollow noreferrer\">StorePointer/LoadPointer</a> but that's not cleaner cause you should use an unsafe pointer and cast it.</p>\n"}], "owner": {"reputation": 1308, "user_id": 4709839, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh6.googleusercontent.com/-4w1KKdkUNJk/AAAAAAAAAAI/AAAAAAAAABc/Xg55afDDwjk/photo.jpg?sz=128", "display_name": "William Poussier", "link": "https://stackoverflow.com/users/4709839/william-poussier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1514708889, "creation_date": 1514680009, "last_edit_date": 1514682906, "question_id": 48039010, "link": "https://stackoverflow.com/questions/48039010/data-structure-for-concurent-heavy-read-workload", "title": "Data-structure for concurent heavy read workload", "body": "<p>I am looking for a data-structure that stores 32bytes strings and allows fast lookups with preferred O(1) or O(log N) lookup complexity (the goal is only to determine if the key exists). Removal and insertion complexity is not critical, since those operations will be infrequent.</p>\n\n<p>Not that it is relevant to the question, but i am working in Go. I could use a <em>hashmap</em> backed by a mutex, but contention would be a problem, and I prefer to avoid sharding if there is a better solution.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1267, "user_id": 1598790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11ea12f06eefbb34068f4c1090e2e0b?s=128&d=identicon&r=PG", "display_name": "ramrunner", "link": "https://stackoverflow.com/users/1598790/ramrunner"}, "is_accepted": false, "score": 5, "last_activity_date": 1514681379, "last_edit_date": 1514681379, "creation_date": 1514680988, "answer_id": 48039075, "question_id": 48038975, "link": "https://stackoverflow.com/questions/48038975/go-cannot-run-non-main-package/48039075#48039075", "title": "Go: cannot run non main package?", "body": "<p>the program that you link to doesn't contain a main function (or more properly in GO terms, a package named main, that itself contains a function called main which is the entry point of the program (well before main there can also be a function called init that is used to initialize data. take a look at the <a href=\"https://golang.org/pkg/flag/\" rel=\"noreferrer\">flag package</a> ))</p>\n\n<p>The fastrand repository that you linked to is supposed to be run as a library from other go programs that are going to use the functions it exposes. For example to get an integer from 0 to n [0, n) using this library you can use this toy program.</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"github.com/NebulousLabs/fastrand\"\n)\n\nfunc main() {\n        //prints a random int [0,10) using fastrand\n        fmt.Printf(\"random int:%d\\n\", fastrand.Intn(10))\n}\n</code></pre>\n\n<p>put that in a directory under your GOPATH, (let's say you name it foo.go) run</p>\n\n<pre><code>go get github.com/NebulousLabs/fastrand; \ngo build foo.go; \n./foo;\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 9157318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f29c0adba303d58fb1d48be6ecaa2b6?s=128&d=identicon&r=PG&f=1", "display_name": "Pushergene", "link": "https://stackoverflow.com/users/9157318/pushergene"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13307, "favorite_count": 1, "answer_count": 1, "score": -4, "last_activity_date": 1514685473, "creation_date": 1514679495, "last_edit_date": 1514685473, "question_id": 48038975, "link": "https://stackoverflow.com/questions/48038975/go-cannot-run-non-main-package", "title": "Go: cannot run non main package?", "body": "<p>I always get error </p>\n\n<blockquote>\n  <p>cannot run non-main package</p>\n</blockquote>\n\n<p>Its just a code from <a href=\"https://github.com/NebulousLabs/fastrand\" rel=\"nofollow noreferrer\">github</a>.</p>\n"}, {"tags": ["go", "concurrency", "synchronization", "goroutine"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1514663033, "post_id": 48037228, "comment_id": 83044710, "body": "The wait group is working as you expect.  The problem is that there&#39;s a data race on w, y, and z."}, {"owner": {"reputation": 1242, "user_id": 804707, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/af86b492c2772884b20791e8298595d9?s=128&d=identicon&r=PG", "display_name": "The Puma", "link": "https://stackoverflow.com/users/804707/the-puma"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1514663142, "post_id": 48037228, "comment_id": 83044747, "body": "@CeriseLim&#243;n do I need to use a mutex to increment? what is the most efficient way to achieve this?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1514664059, "post_id": 48037228, "comment_id": 83045023, "body": "Use a mutex or <a href=\"https://godoc.org/sync/atomic\" rel=\"nofollow noreferrer\">sync/atomic</a>.  It&#39;s difficult to comment on an efficient solution without seeing the actual problem you are solving."}], "answers": [{"tags": [], "owner": {"reputation": 6756, "user_id": 1606248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0lXId.jpg?s=128&g=1", "display_name": "Pierre Prinetti", "link": "https://stackoverflow.com/users/1606248/pierre-prinetti"}, "is_accepted": true, "score": 8, "last_activity_date": 1514665106, "creation_date": 1514665106, "answer_id": 48037544, "question_id": 48037228, "link": "https://stackoverflow.com/questions/48037228/how-do-you-make-sure-goroutines-finish-in-a-for-loop-using-waitgroup/48037544#48037544", "title": "How do you make sure goroutines finish in a for-loop using WaitGroup?", "body": "<p>The <code>sync.Waitgroup</code> is working as expected. <code>w</code>, <code>y</code> and <code>z</code> will not reach 10000 because multiple goroutines are incrementing them concurrently, and Go's increment is not concurrent-safe: it is implemented as a normal fetch-increment-reassign operation.</p>\n\n<p>You have two options.</p>\n\n<h3>option 1: mutex</h3>\n\n<pre><code>type incrementer struct {\n    sync.Mutex\n    i int\n}\n\nfunc (i *incrementer) Add(n int) {\n    i.Lock()\n    defer i.Unlock()\n    i.i += n\n}\n</code></pre>\n\n<p>and use this type for <code>w</code>, <code>y</code> and <code>z</code>.</p>\n\n<p>Full example: <a href=\"https://play.golang.org/p/6wWUK2xnOCW\" rel=\"noreferrer\">https://play.golang.org/p/6wWUK2xnOCW</a></p>\n\n<h3>option 2: sync.atomic</h3>\n\n<pre><code>var w int32 = 0\n\ngo func(){\n    // in the loop\n    atomic.AddInt32(&amp;w, 1)\n\n}()\n</code></pre>\n\n<p>Full example: <a href=\"https://play.golang.org/p/oUCGgKYC1-Y\" rel=\"noreferrer\">https://play.golang.org/p/oUCGgKYC1-Y</a></p>\n"}], "owner": {"reputation": 1242, "user_id": 804707, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/af86b492c2772884b20791e8298595d9?s=128&d=identicon&r=PG", "display_name": "The Puma", "link": "https://stackoverflow.com/users/804707/the-puma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1542, "favorite_count": 1, "accepted_answer_id": 48037544, "answer_count": 1, "score": 2, "last_activity_date": 1514665106, "creation_date": 1514662493, "question_id": 48037228, "link": "https://stackoverflow.com/questions/48037228/how-do-you-make-sure-goroutines-finish-in-a-for-loop-using-waitgroup", "title": "How do you make sure goroutines finish in a for-loop using WaitGroup?", "body": "<p>I'm running a function in a goroutine each time a for-loop iterates, and I'm using <code>sync.WaitGroup</code> to make sure the goroutines all finish. However, I'm getting weird behavior testing the concurrency with counters. In the example below, I attempt to keep track of the thread count using 4 different techniques (<code>w</code>, <code>x</code>, <code>y</code>, <code>z</code>), and get 4 different results. The only result I understand is <code>x</code>, since it is incremented in the for-loop itself. What am I missing here?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\nimport \"sync\"\n\nvar w = 0\n\nfunc main() {\n  x := 0\n  y := 0\n  z := 0\n  var wg sync.WaitGroup\n  for i := 0; i &lt; 10000; i++ {\n    wg.Add(1)\n    x++\n    go func() {\n      z++\n      test(&amp;y)\n      wg.Done()\n    }()\n  }\n  wg.Wait()\n  fmt.Println(w, x, y, z) // 8947 10000 8831 8816\n}\n\nfunc test(y *int) {\n  w++\n  *y++\n}\n</code></pre>\n"}, {"tags": ["go", "go-iris"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514666049, "post_id": 48037167, "comment_id": 83045500, "body": "Writing after redirect, or even before, makes little sense. Try removing the <code>...Writef...</code> line and see what happens."}, {"owner": {"reputation": 2048, "user_id": 4021603, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/d8e64d99e17d3f66885fcb190d6e7665?s=128&d=identicon&r=PG&f=1", "display_name": "Alexandre Lara", "link": "https://stackoverflow.com/users/4021603/alexandre-lara"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514700777, "post_id": 48037167, "comment_id": 83051240, "body": "@mkopriva I just tried that and it&#39;s still not working :/"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514700937, "post_id": 48037167, "comment_id": 83051261, "body": "And do you at least see the printf output in the console?"}, {"owner": {"reputation": 2048, "user_id": 4021603, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/d8e64d99e17d3f66885fcb190d6e7665?s=128&d=identicon&r=PG&f=1", "display_name": "Alexandre Lara", "link": "https://stackoverflow.com/users/4021603/alexandre-lara"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514702214, "post_id": 48037167, "comment_id": 83051451, "body": "Yes, it shows: <code>UserInner: controllers.LoginFormData{Email:&quot;teste@teste.com&quot;, Password:&quot;123&quot;}</code>"}], "answers": [{"comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1514752227, "post_id": 48044823, "comment_id": 83062136, "body": "Probably you should disclose yourself as the author, as required by site rules ;)"}, {"owner": {"reputation": 2048, "user_id": 4021603, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/d8e64d99e17d3f66885fcb190d6e7665?s=128&d=identicon&r=PG&f=1", "display_name": "Alexandre Lara", "link": "https://stackoverflow.com/users/4021603/alexandre-lara"}, "edited": false, "score": 1, "creation_date": 1514852467, "post_id": 48044823, "comment_id": 83080970, "body": "I found the problem, it was being caused by my Javascript code that was dynamically adding some classes to the button to handle a &quot;loading effect&quot; when submitting the form. I don&#39;t know exactly why, but for some reason it wasn&#39;t allowing the page to redirect."}], "tags": [], "owner": {"reputation": 769, "user_id": 2647655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qGHOi.png?s=128&g=1", "display_name": "kataras", "link": "https://stackoverflow.com/users/2647655/kataras"}, "is_accepted": false, "score": 1, "last_activity_date": 1514744519, "creation_date": 1514744519, "answer_id": 48044823, "question_id": 48037167, "link": "https://stackoverflow.com/questions/48037167/redirect-in-post-method-in-iris-framework/48044823#48044823", "title": "Redirect in POST method in Iris Framework", "body": "<p>As @mkopriva said you have to call .Redirect and return from the function body, Redirect should be the last call because it sends the status code and a header location back to the client, you don't have to write anything else, browser/client will redirect and write the content of the redirect path.</p>\n\n<p>Although <code>iris.StatusSeeOther</code> (http status code: 303) works on the mvc examples the iris repository has, you may want to try other statuses and check if that works (clear your browser's cache on each try for any case), for example <code>iris.StatusTemporaryRedirect</code> (http status code: 307) or search on google for the correct redirect status code that suits your needs better.</p>\n\n<p>Please take a look at the <a href=\"https://github.com/kataras/iris/tree/master/_examples\" rel=\"nofollow noreferrer\">https://github.com/kataras/iris/tree/master/_examples</a> as well.</p>\n"}], "owner": {"reputation": 2048, "user_id": 4021603, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/d8e64d99e17d3f66885fcb190d6e7665?s=128&d=identicon&r=PG&f=1", "display_name": "Alexandre Lara", "link": "https://stackoverflow.com/users/4021603/alexandre-lara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1250, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1514744519, "creation_date": 1514662005, "question_id": 48037167, "link": "https://stackoverflow.com/questions/48037167/redirect-in-post-method-in-iris-framework", "title": "Redirect in POST method in Iris Framework", "body": "<p>I'm trying to redirect from the login page to the home page in the POST method, but the form doesn't redirect to any page after clicking on the submit button.</p>\n\n<p>I'm using the MVC structure of Iris Framework and the <code>Ctx.Redirect</code> method to redirect to the desired page, but it's not working.</p>\n\n<pre><code>// login_controllers.go\npackage controllers\n\nimport (\n    \"github.com/kataras/iris/mvc\"\n    \"github.com/kataras/iris\"\n    \"fmt\"\n)\n\ntype LoginFormData struct {\n    Email string\n    Password string\n}\n\n\ntype LoginController struct {\n    mvc.C\n}\n\nfunc (c *LoginController) Get() mvc.Result {\n    return mvc.View{\n        Name: \"login.html\",\n    }\n}\n\nfunc (c *LoginController) Post() {\n    userLoginData := LoginFormData{}\n    err := c.Ctx.ReadForm(&amp;userLoginData)\n    if err != nil {\n        c.Ctx.StatusCode(iris.StatusInternalServerError)\n        c.Ctx.WriteString(err.Error())\n    }\n\n    if userLoginData.Email == \"teste@teste.com\" &amp;&amp; userLoginData.Password == \"123\" {\n        c.Ctx.Redirect(\"/\", iris.StatusSeeOther)\n\n        fmt.Printf(\"UserInner: %#v\", userLoginData)\n        c.Ctx.Writef(\"UserInner: %#v\", userLoginData)\n    }\n}\n</code></pre>\n\n<p>The form HTML code is:</p>\n\n<pre><code>&lt;form class=\"m-login__form m-form\" action=\"/login\" method=\"post\"&gt;\n    &lt;div class=\"form-group m-form__group\"&gt;\n        &lt;input class=\"form-control m-input\" type=\"text\" placeholder=\"Email\" name=\"Email\" autocomplete=\"off\"&gt;\n    &lt;/div&gt;\n    &lt;div class=\"form-group m-form__group\"&gt;\n        &lt;input class=\"form-control m-input m-login__form-input--last\" type=\"password\" placeholder=\"Password\" name=\"Password\"&gt;\n    &lt;/div&gt;\n    &lt;div class=\"row m-login__form-sub\"&gt;\n        &lt;div class=\"col m--align-left\"&gt;\n            &lt;label class=\"m-checkbox m-checkbox--focus\"&gt;\n            &lt;input type=\"checkbox\" name=\"remember\"&gt;\n                Remember me\n            &lt;span&gt;&lt;/span&gt;\n            &lt;/label&gt;\n        &lt;/div&gt;\n        &lt;div class=\"col m--align-right\"&gt;\n            &lt;a href=\"javascript:;\" id=\"m_login_forget_password\" class=\"m-link\"&gt;\n            Forgotten password ?\n            &lt;/a&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n    &lt;div class=\"m-login__form-action\"&gt;\n        &lt;button id=\"m_login_signin_submit\" class=\"btn btn-focus m-btn m-btn--pill m-btn--custom m-btn--air\"&gt;\n        Login\n        &lt;/button&gt;\n    &lt;/div&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>Isn't possible to redirect in a POST method in Iris Framework/Go?</p>\n"}, {"tags": ["angularjs", "html", "go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8651755"}, "edited": false, "score": 2, "creation_date": 1514658008, "post_id": 48036624, "comment_id": 83043377, "body": "If you &quot;dynamically redirect&quot;, the port will be visible in the address bar. If I&#39;m understanding what you&#39;re trying to do, you need to set up a proxy in your web server."}, {"owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "edited": false, "score": 0, "creation_date": 1514969539, "post_id": 48036624, "comment_id": 83121597, "body": "As @Blurp mentioned a better way to handle this is to use a proxy. You could use caddy server for this which is easy to understand and configure IMO. <a href=\"https://caddyserver.com/docs/proxy\" rel=\"nofollow noreferrer\">caddyserver.com/docs/proxy</a>"}], "answers": [{"tags": [], "owner": {"reputation": 218, "user_id": 6275993, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PI08D.png?s=128&g=1", "display_name": "Jeyem", "link": "https://stackoverflow.com/users/6275993/jeyem"}, "is_accepted": false, "score": 0, "last_activity_date": 1514666029, "creation_date": 1514666029, "answer_id": 48037656, "question_id": 48036624, "link": "https://stackoverflow.com/questions/48036624/how-to-redirect-a-url-to-the-same-url-with-port-number-inserted-dynamically/48037656#48037656", "title": "How to redirect a URL to the same URL with port number inserted dynamically", "body": "<p>you have <code>*http.Request</code> in your handle function and you can get your current host with <code>*http.Request.URL.Host</code> you get your domain and port that requested to your webserver.</p>\n\n<pre><code>func handler(r *http.Request, response http.Response) {\n    println(r.URL.Host)\n}\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 8160915, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-8WpwArFyFmk/AAAAAAAAAAI/AAAAAAAARNM/m15-EaTq4V0/photo.jpg?sz=128", "display_name": "Ram Charan", "link": "https://stackoverflow.com/users/8160915/ram-charan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 436, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1514666029, "creation_date": 1514657574, "question_id": 48036624, "link": "https://stackoverflow.com/questions/48036624/how-to-redirect-a-url-to-the-same-url-with-port-number-inserted-dynamically", "title": "How to redirect a URL to the same URL with port number inserted dynamically", "body": "<p>For example:</p>\n\n<p>Here the main intension is to hide the port number in the url.\nUser should see the <a href=\"http://myproject.com/home/projects\" rel=\"nofollow noreferrer\">http://myproject.com/home/projects</a> in the address bar on click of a button in webpage but it should dynamically redirect to the url <a href=\"http://myproject.com:portnumber/home/projects\" rel=\"nofollow noreferrer\">http://myproject.com:portnumber/home/projects</a></p>\n\n<p>I am using angular js and html for frontend and golang as backend.</p>\n\n<p>What are the feasible ways to achieve above redirection either in golang or angular js?</p>\n"}, {"tags": ["c#", "go", "time"], "answers": [{"comments": [{"owner": {"reputation": 464, "user_id": 5108100, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/S1Epw.png?s=128&g=1", "display_name": "NoRelect", "link": "https://stackoverflow.com/users/5108100/norelect"}, "edited": false, "score": 0, "creation_date": 1514653183, "post_id": 48035884, "comment_id": 83041977, "body": "Thank you for your very fast response!"}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 3, "last_activity_date": 1514652485, "last_edit_date": 1514652485, "creation_date": 1514652094, "answer_id": 48035884, "question_id": 48035768, "link": "https://stackoverflow.com/questions/48035768/understanding-the-time-parse-function-in-go/48035884#48035884", "title": "Understanding the time.Parse function in Go", "body": "<p>The docs around <a href=\"https://golang.org/pkg/time/#Time.Format\" rel=\"nofollow noreferrer\">time.Format</a> explain what the format means.</p>\n\n<p>Quoting:</p>\n\n<pre><code>Format returns a textual representation of the time value formatted\naccording to layout, which defines the format by showing how the \nreference time, defined to be\n\nMon Jan 2 15:04:05 -0700 MST 2006\n</code></pre>\n\n<p>The format string in your example: <code>060102150405</code> tells the time parser to look for the following:</p>\n\n<ul>\n<li>06: year</li>\n<li>01: month</li>\n<li>02: day of the month</li>\n<li>15: hour of the day</li>\n<li>04: minute</li>\n<li>05: second</li>\n</ul>\n\n<p>This is a convenient way of telling the parser how it should interpret each number. If you look carefully, you'll see that numbers are not reused so when you say <code>06</code>, the parser matches it to <code>2006</code>.</p>\n\n<p>In C#, you can use <a href=\"https://msdn.microsoft.com/en-us/library/w2sa9yss(v=vs.110).aspx\" rel=\"nofollow noreferrer\">datetime.ParseExact</a>. Something along the lines of:</p>\n\n<pre><code>DateTime.ParseExact(dateString, \"yyMMddhhmmss\", some_provider);\n</code></pre>\n\n<p>(note: I have not tried the C# snippet above. You may need to adjust it)</p>\n"}], "owner": {"reputation": 464, "user_id": 5108100, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/S1Epw.png?s=128&g=1", "display_name": "NoRelect", "link": "https://stackoverflow.com/users/5108100/norelect"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "accepted_answer_id": 48035884, "answer_count": 1, "score": 0, "last_activity_date": 1514652485, "creation_date": 1514651425, "question_id": 48035768, "link": "https://stackoverflow.com/questions/48035768/understanding-the-time-parse-function-in-go", "title": "Understanding the time.Parse function in Go", "body": "<p>I am currently porting code from go to c# and came across this (simplified) piece of code.\nI do know that it converts a given string <code>171228175744.085</code> using a given format <code>060102150405</code>.</p>\n\n<p>The official docs only have examples using common formats like <code>2017-Feb-1</code>,  not this format (a possible timestamp?)</p>\n\n<p>I do know that this will result in the time beeing <code>2017-12-28 17:57:44.085 +0000 UTC</code>, but I do not have a clue how, because I have no information what the string <code>171228175744.085</code> and layout represent. I do know that some of this information is GPS related. So, my question is: Does anyone know how to do this in c#?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    t, err := time.Parse(\"060102150405\", \"171228175744.085\")\n    if err == nil{\n        fmt.Println(t)\n    }\n\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 121, "user_id": 6866042, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8b042cbaa411bd7d6f1fbeb0ddcd0ea7?s=128&d=identicon&r=PG&f=1", "display_name": "nexequ", "link": "https://stackoverflow.com/users/6866042/nexequ"}, "edited": false, "score": 0, "creation_date": 1514635285, "post_id": 48033727, "comment_id": 83037427, "body": "Is it the only way? I&#39;ve got mega complicated query and I don&#39;t want to duplicate code."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 121, "user_id": 6866042, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8b042cbaa411bd7d6f1fbeb0ddcd0ea7?s=128&d=identicon&r=PG&f=1", "display_name": "nexequ", "link": "https://stackoverflow.com/users/6866042/nexequ"}, "edited": false, "score": 0, "creation_date": 1514643036, "post_id": 48033727, "comment_id": 83039296, "body": "@nexequ you can concatenate your query string with <code>+</code> and collect arguments into a slice with <code>append</code>, and then, at the end, execute the query like so: <code>Query(queryString, args...)</code>."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": false, "score": 1, "last_activity_date": 1514635110, "creation_date": 1514635110, "answer_id": 48033727, "question_id": 48033689, "link": "https://stackoverflow.com/questions/48033689/golang-query-string-as-part-of-query/48033727#48033727", "title": "Golang Query string as part of query", "body": "<p>Placeholders (<code>?</code>) are for variables only, not statements.</p>\n\n<p>You should instead have two separate queries:</p>\n\n<pre><code>  if id != 0 {\n    database.DB.Query(\"SELECT name FROM table WHERE id = ?\", id)\n  } else {\n    database.DB.Query(\"SELECT name FROM table\")\n  }\n</code></pre>\n\n<p>Additionally: using <code>Sprintf(\"WHERE id = %d\", id)</code> defeats the purpose of placeholders.</p>\n"}, {"comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514643278, "post_id": 48034709, "comment_id": 83039369, "body": "@mkopriva thanks for the edit, I was editing at the same time and it clashed I think."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514643309, "post_id": 48034709, "comment_id": 83039382, "body": "I saw that, no worries ;)"}, {"owner": {"reputation": 121, "user_id": 6866042, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8b042cbaa411bd7d6f1fbeb0ddcd0ea7?s=128&d=identicon&r=PG&f=1", "display_name": "nexequ", "link": "https://stackoverflow.com/users/6866042/nexequ"}, "edited": false, "score": 0, "creation_date": 1514660736, "post_id": 48034709, "comment_id": 83044082, "body": "Perfect, if you got some example of your simple query builder, I would really like to see it :)"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1514662485, "post_id": 48034709, "comment_id": 83044541, "body": "The one I wrote/use is here, it may or may not suit you or provide a useful ref <a href=\"https://github.com/fragmenta/query\" rel=\"nofollow noreferrer\">github.com/fragmenta/query</a>"}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 4, "last_activity_date": 1514831491, "last_edit_date": 1514831491, "creation_date": 1514643045, "answer_id": 48034709, "question_id": 48033689, "link": "https://stackoverflow.com/questions/48033689/golang-query-string-as-part-of-query/48034709#48034709", "title": "Golang Query string as part of query", "body": "<p>You can build your query gradually, only adding the arguments if required. </p>\n\n<pre><code>// Build a query (columns and table being strings)\nq := fmt.Sprintf(\"SELECT %s FROM %s\", columns, table)\nargs := []interface{}{}\n\n// Add conditional query/args\nif id != 0 {\n q = fmt.Sprintf(\"%s WHERE id=?\",q)\n args = append(args,id)    \n}\n\n// Perform the query\ndatabase.DB.Query(q,args...)\n</code></pre>\n\n<p>If you find yourself doing a lot of this, consider writing a small query builder which will let you easily build sql queries without so much fuss. It can be relatively simple, with slots for select, joins etc and an array for args.</p>\n"}], "owner": {"reputation": 121, "user_id": 6866042, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8b042cbaa411bd7d6f1fbeb0ddcd0ea7?s=128&d=identicon&r=PG&f=1", "display_name": "nexequ", "link": "https://stackoverflow.com/users/6866042/nexequ"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 965, "favorite_count": 2, "accepted_answer_id": 48034709, "answer_count": 2, "score": 1, "last_activity_date": 1514831491, "creation_date": 1514634792, "question_id": 48033689, "link": "https://stackoverflow.com/questions/48033689/golang-query-string-as-part-of-query", "title": "Golang Query string as part of query", "body": "<p>I would like to use string as part of query.</p>\n\n<pre><code>func GetAll(id int) {\n  var queryPart string\n  if id != 0 {\n    queryPart = fmt.Sprintf(\"WHERE id = %d\", id)\n  } else {\n    queryPart = \"\"\n  }\n\n\n  database.DB.Query(\"SELECT name FROM table ?, queryPart)\n}\n</code></pre>\n\n<p>In database.DB I've got *db.Sql instance.</p>\n\n<p>How to get it work? With that code I still get \"You have an error in your SQL syntax\".</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1514643797, "post_id": 48033366, "comment_id": 83039526, "body": "<code>printf &quot;&#47;%s&#47;%d&quot; &quot;wallet&quot; .ID</code>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1514656376, "post_id": 48033366, "comment_id": 83042883, "body": "<code>&lt;a href=&quot;&#47;wallet&#47;{{.ID}}&quot;&gt;</code>"}], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 3, "last_activity_date": 1514634434, "last_edit_date": 1514634434, "creation_date": 1514633530, "answer_id": 48033524, "question_id": 48033366, "link": "https://stackoverflow.com/questions/48033366/concat-a-predefined-string-and-variable-in-go-templates/48033524#48033524", "title": "Concat a predefined string and variable in Go templates", "body": "<p>The (escaped) <code>%!s...</code> indicates that the argument passed to <code>printf</code> is not a string. It even tells you the data type.</p>\n\n<p>For example, if I run the following:</p>\n\n<pre><code>fmt.Printf(\"%s\", int64(1006608996216725456))\n</code></pre>\n\n<p>I get:</p>\n\n<pre><code>%!s(int64=1006608996216725456)\n</code></pre>\n\n<p>You should either use <code>%d</code> in your <code>printf</code> or pass a string <code>ID</code>.</p>\n"}], "owner": {"reputation": 1591, "user_id": 7304216, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7948f2563d2a2d276561b3a05c357150?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Pocock", "link": "https://stackoverflow.com/users/7304216/nick-pocock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1015, "favorite_count": 0, "accepted_answer_id": 48033524, "answer_count": 1, "score": 0, "last_activity_date": 1514634434, "creation_date": 1514632338, "question_id": 48033366, "link": "https://stackoverflow.com/questions/48033366/concat-a-predefined-string-and-variable-in-go-templates", "title": "Concat a predefined string and variable in Go templates", "body": "<p>I am trying to build a link in my Go template. I want my objects ID to be concatenated with a word to form a dynamic url.</p>\n\n<p>When I print <code>{{.ID}}</code> on the page, I can see the correct ID printed, I am attempting to build the URL using Printf like so.</p>\n\n<pre><code>{{- $id := printf \"/%s/%s\" \"wallet/\" .ID -}}\n        &lt;a href={{$id}}&gt;&lt;h1&gt;Wallet ID {{.ID}}&lt;/h1&gt;&lt;/a&gt;\n</code></pre>\n\n<p>In my browser it comes out as </p>\n\n<blockquote>\n  <p><a href=\"http://localhost:8000/wallet//%25!s%28int=1006608996216725456%29\" rel=\"nofollow noreferrer\">http://localhost:8000/wallet//%25!s%28int=1006608996216725456%29</a></p>\n</blockquote>\n\n<p>Rather than what it should look like below. ID is of type int.</p>\n\n<blockquote>\n  <p><a href=\"http://localhost:8000/wallet/1006608996216725456\" rel=\"nofollow noreferrer\">http://localhost:8000/wallet/1006608996216725456</a></p>\n</blockquote>\n"}, {"tags": ["performance", "go"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1514631637, "post_id": 48033263, "comment_id": 83036573, "body": "It is probably building dependencies. Try <code>go install</code> first to build your package and its dependencies. After that, <code>go run</code> should be much faster."}, {"owner": {"reputation": 4197, "user_id": 7190575, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/63b85f6a33e1b032dabc877b7ff4af50?s=128&d=identicon&r=PG&f=1", "display_name": "OhMad", "link": "https://stackoverflow.com/users/7190575/ohmad"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1514632498, "post_id": 48033263, "comment_id": 83036770, "body": "Tried that, but every time I execute &#39;go run&#39; after that, it either produces the same output, no matter which changes I make to the source code or just recompiles it, which leads to the executing taking so long again."}, {"owner": {"reputation": 3294, "user_id": 4848859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Slzu.jpg?s=128&g=1", "display_name": "mayo", "link": "https://stackoverflow.com/users/4848859/mayo"}, "edited": false, "score": 0, "creation_date": 1514658958, "post_id": 48033263, "comment_id": 83043637, "body": "Do you know how much time takes the execution of that specific line ? Maybe you can add a timer to see where is the problem.. (<a href=\"https://coderwall.com/p/cp5fya/measuring-execution-time-in-go\" rel=\"nofollow noreferrer\">coderwall.com/p/cp5fya/measuring-execution-time-in-go</a>)"}], "answers": [{"comments": [{"owner": {"reputation": 4197, "user_id": 7190575, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/63b85f6a33e1b032dabc877b7ff4af50?s=128&d=identicon&r=PG&f=1", "display_name": "OhMad", "link": "https://stackoverflow.com/users/7190575/ohmad"}, "edited": false, "score": 0, "creation_date": 1514636018, "post_id": 48033613, "comment_id": 83037608, "body": "This seems to help a bit. However, I discovered that the code only runs slow on the very first execution of the build. Any reason for that?"}, {"owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "reply_to_user": {"reputation": 4197, "user_id": 7190575, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/63b85f6a33e1b032dabc877b7ff4af50?s=128&d=identicon&r=PG&f=1", "display_name": "OhMad", "link": "https://stackoverflow.com/users/7190575/ohmad"}, "edited": false, "score": 0, "creation_date": 1514670609, "post_id": 48033613, "comment_id": 83046626, "body": "with <code>go run</code> or executing the binary?"}, {"owner": {"reputation": 4197, "user_id": 7190575, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/63b85f6a33e1b032dabc877b7ff4af50?s=128&d=identicon&r=PG&f=1", "display_name": "OhMad", "link": "https://stackoverflow.com/users/7190575/ohmad"}, "edited": false, "score": 0, "creation_date": 1514714269, "post_id": 48033613, "comment_id": 83053505, "body": "with &#39;go run&#39;. After making changes to the program and running it once, if the code doesn&#39;t change &#39;go run&#39; will keep being quick. I actually tried the same with running some c code, and discovered the exact same behaviour, so &#39;go&#39; might not be the problem in this case..."}], "tags": [], "owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "is_accepted": false, "score": 3, "last_activity_date": 1514634553, "last_edit_date": 1514634553, "creation_date": 1514634251, "answer_id": 48033613, "question_id": 48033263, "link": "https://stackoverflow.com/questions/48033263/golang-go-run-takes-long-to-execute/48033613#48033613", "title": "Golang - go run takes long to execute", "body": "<p><code>$ go run</code> command always complies the code into a temporary binary file and then executes it, every time it is run.</p>\n\n<p>To go around this you could do <code>$ go build -i main.go</code> which will compile dependencies separately as <code>.a</code> files (i'm guessing this is the part that takes the longest because it takes time to build the dependencies) and then execute it with <code>$ ./main</code>, and each execution should be faster that <code>$ go run</code>. </p>\n\n<p>You could also run a <code>$ go get -u ./...</code> to update all your deps and building with the -x flag will show you if the toolchain is finding incompatible versions.</p>\n\n<p><code>$ go install</code> builds the command in a temporary directory then moves it to $GOPATH/bin so you can execute it without the path <code>$ main</code>.</p>\n\n<p>The last two commands require a rebuild/reinstall if the code has changes.</p>\n"}, {"tags": [], "owner": {"reputation": 101, "user_id": 9700898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/224373ec114c607f47d03633fe102391?s=128&d=identicon&r=PG&f=1", "display_name": "granitezero", "link": "https://stackoverflow.com/users/9700898/granitezero"}, "is_accepted": false, "score": 10, "last_activity_date": 1575744611, "creation_date": 1575744611, "answer_id": 59229195, "question_id": 48033263, "link": "https://stackoverflow.com/questions/48033263/golang-go-run-takes-long-to-execute/59229195#59229195", "title": "Golang - go run takes long to execute", "body": "<p>Found this while experiencing an identical issue with freshly-compiled golang binaries on MacOS (OSX) Catalina.</p>\n\n<p>In short, the OS now scans a new (to it) binary for malware, it usually does it on first start, but I found that it was doing it 3-5 times in a row, after which the binary got whitelisted and started as normal. Obviously, once you make changes to the code and re-compile the scans start happening again. The scan would take upwards of 20 seconds which ruined golangs fast iteration cycle.</p>\n\n<p>Solution for me was as follows:</p>\n\n<pre><code>sudo spctl developer-mode enable-terminal\n</code></pre>\n\n<p>Then go to Preferences -> Security &amp; Privacy -> Privacy</p>\n\n<p>In the list to the left you will now have \"Developer Tools\" section, which will have OSX built-in Terminal listed. Check the box to enable it, and/or add anything else you may be using to develop (iTerm, VS Code, etc)</p>\n\n<p>When running binaries from those applications the scans stop and things go back to normal.</p>\n"}], "owner": {"reputation": 4197, "user_id": 7190575, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/63b85f6a33e1b032dabc877b7ff4af50?s=128&d=identicon&r=PG&f=1", "display_name": "OhMad", "link": "https://stackoverflow.com/users/7190575/ohmad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3315, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1575744611, "creation_date": 1514631469, "question_id": 48033263, "link": "https://stackoverflow.com/questions/48033263/golang-go-run-takes-long-to-execute", "title": "Golang - go run takes long to execute", "body": "<p>I have a little problem, where every time I run 'go run >filename&lt;' after making changes to my problem, it takes many seconds to start executing.</p>\n\n<p>I tried it with a simple program like this:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"Output\")\n}\n</code></pre>\n\n<p>And it took about 18 seconds to print out the result.</p>\n\n<p>And ideas on what could cause this problem?</p>\n\n<p>I am on windows by the way.</p>\n\n<p>Thanks in Advance</p>\n"}, {"tags": ["angular", "typescript", "go", "go-gin"], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 7880714, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7AtxC.png?s=128&g=1", "display_name": "Apak", "link": "https://stackoverflow.com/users/7880714/apak"}, "edited": false, "score": 0, "creation_date": 1514637077, "post_id": 48033261, "comment_id": 83037875, "body": "how exactly can I do that?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 77, "user_id": 7880714, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7AtxC.png?s=128&g=1", "display_name": "Apak", "link": "https://stackoverflow.com/users/7880714/apak"}, "edited": false, "score": 0, "creation_date": 1514637141, "post_id": 48033261, "comment_id": 83037887, "body": "My answer includes what your code should look like. Exported names are uppercase. I recommend you take the <a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">Go tour</a> to familiarize yourself with Go."}, {"owner": {"reputation": 77, "user_id": 7880714, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7AtxC.png?s=128&g=1", "display_name": "Apak", "link": "https://stackoverflow.com/users/7880714/apak"}, "edited": false, "score": 0, "creation_date": 1514637443, "post_id": 48033261, "comment_id": 83037955, "body": "Thank you for advice I&#39;m on it"}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 1, "last_activity_date": 1514631423, "creation_date": 1514631423, "answer_id": 48033261, "question_id": 48033176, "link": "https://stackoverflow.com/questions/48033176/http-request-from-angular-to-go-status-code422-unprocessable-entity/48033261#48033261", "title": "HTTP request from Angular to GO =&gt; Status Code:422 Unprocessable Entity", "body": "<p>You need to export the fields in your data structure:</p>\n\n<pre><code>type Users struct {\n    Email string `gorm:\"not null\" form:\"email\" json:\"email\"`\n    Password  string `gorm:\"not null\" form:\"password\" json:\"password\"`\n}\n</code></pre>\n\n<p>They are currently unexported, so only visible to your package. This means that packages that marshal/unmarshal your data structure will be unable to see the fields.</p>\n"}], "owner": {"reputation": 77, "user_id": 7880714, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7AtxC.png?s=128&g=1", "display_name": "Apak", "link": "https://stackoverflow.com/users/7880714/apak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 816, "favorite_count": 0, "accepted_answer_id": 48033261, "answer_count": 1, "score": 0, "last_activity_date": 1597434732, "creation_date": 1514630781, "last_edit_date": 1597434732, "question_id": 48033176, "link": "https://stackoverflow.com/questions/48033176/http-request-from-angular-to-go-status-code422-unprocessable-entity", "title": "HTTP request from Angular to GO =&gt; Status Code:422 Unprocessable Entity", "body": "<p>I'm getting HTTP 422 response somehow:\nStatus Code:422 Unprocessable Entity</p>\n<p>Console message of fmt.Println(c) is:</p>\n<blockquote>\n<p>&amp;{{0xc04227c1c0 -1 200} 0xc0421b2100 0xc042086d10 [] [0x8fdc00 0x8fe950 0x97e310 0x97cf80] 3 0xc0421ea5a0 map[]  []}</p>\n</blockquote>\n<p>Map should be filled <code>myEmail</code> and <code>myPassword</code> but it isn't.</p>\n<p>Is there something wrong with the body or is it something related to web API?</p>\n<p>Here is my HTTP request:</p>\n<pre><code>this.http.post('http://localhost:8080/api/v1/users', {'email': 'myEmail', 'password': 'myPassword'}, httpOptions)\n          .subscribe(data =&gt; {\n          console.log('register___', data);\n      });\n</code></pre>\n<p>Here is the httpOptions:</p>\n<pre><code>const httpOptions = {\n    headers: new HttpHeaders({ 'Content-Type': 'application/json'\n        , 'Access-Control-Allow-Origin': '*'\n        , 'Access-Control-Allow-Headers': 'access-control-allow-origin, access-control-allow-headers'})\n};\n</code></pre>\n<p>Here is the go web API I'm using:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n\n    &quot;github.com/gin-gonic/gin&quot;\n    &quot;github.com/jinzhu/gorm&quot;\n    _ &quot;github.com/mattn/go-sqlite3&quot;\n)\n\ntype Users struct {\n    email string `gorm:&quot;not null&quot; form:&quot;email&quot; json:&quot;email&quot;`\n    password  string `gorm:&quot;not null&quot; form:&quot;password&quot; json:&quot;password&quot;`\n}\n\nfunc InitDb() *gorm.DB {\n    // Openning file\n    db, err := gorm.Open(&quot;sqlite3&quot;, &quot;./data.db&quot;)\n    // Display SQL queries\n    db.LogMode(true)\n\n    // Error\n    if err != nil {\n        panic(err)\n    }\n    // Creating the table\n    if !db.HasTable(&amp;Users{}) {\n        db.CreateTable(&amp;Users{})\n        db.Set(&quot;gorm:table_options&quot;, &quot;ENGINE=InnoDB&quot;).CreateTable(&amp;Users{})\n    }\n\n    return db\n}\n\nfunc Cors() gin.HandlerFunc {\n    return func(c *gin.Context) {\n        c.Writer.Header().Add(&quot;Access-Control-Allow-Origin&quot;, &quot;http://localhost:4200&quot;)\n        c.Next()\n    }\n}\n\nfunc main() {\n    r := gin.Default()\n\n    r.Use(Cors())\n\n    v1 := r.Group(&quot;api/v1&quot;)\n    {\n        v1.POST(&quot;/users&quot;, PostUser)\n        v1.OPTIONS(&quot;/users&quot;, OptionsUser)\n        v1.GET(&quot;/users&quot;, GetUsers)\n        v1.GET(&quot;/users/:id&quot;, GetUser)\n        v1.PUT(&quot;/users/:id&quot;, UpdateUser)\n        v1.DELETE(&quot;/users/:id&quot;, DeleteUser)\n    }\n\n    r.Run(&quot;:8080&quot;)\n}\n\nfunc PostUser(c *gin.Context) {\n\n    fmt.Println(&quot;___herewego___&quot;)\n    db := InitDb()\n    defer db.Close()\n\n    var user Users\n    c.Bind(&amp;user)\n    fmt.Println(c)\n    fmt.Println(&quot;_____&quot;)\n    fmt.Println(user)\n\n    if user.email != &quot;&quot; &amp;&amp; user.password != &quot;&quot; {\n        fmt.Println(&quot;geldim g\u00f6rd\u00fcm gidiyorum.....................&quot;)\n        // INSERT INTO &quot;users&quot; (name) VALUES (user.Name);\n        db.Create(&amp;user)\n\n        // Display error\n        c.JSON(201, gin.H{&quot;success&quot;: user})\n    } else {\n        // Display error\n        c.JSON(422, gin.H{&quot;error&quot;: &quot;Fields are empty&quot;})\n    }\n\n    // curl -i -X POST -H &quot;Content-Type: application/json&quot; -d &quot;{ \\&quot;email\\&quot;: \\&quot;Thea\\&quot;, \\&quot;password\\&quot;: \\&quot;Queen\\&quot; }&quot; http://localhost:8080/api/v1/users\n}\n\nfunc GetUsers(c *gin.Context) {\n    // Connection to the database\n    db := InitDb()\n    // Close connection database\n    defer db.Close()\n\n    var users []Users\n    // SELECT * FROM users\n    db.Find(&amp;users)\n\n    // Display JSON result\n    c.JSON(200, users)\n\n    // curl -i http://localhost:8080/api/v1/users\n}\n\nfunc GetUser(c *gin.Context) {\n    // Connection to the database\n    db := InitDb()\n    // Close connection database\n    defer db.Close()\n\n    email := c.Params.ByName(&quot;email&quot;)\n    var user Users\n    // SELECT * FROM users WHERE id = 1;\n    db.First(&amp;user, email)\n\n    if user.email != &quot;&quot; {\n        // Display JSON result\n        c.JSON(200, user)\n    } else {\n        // Display JSON error\n        c.JSON(404, gin.H{&quot;error&quot;: &quot;User not found&quot;})\n    }\n\n    // curl -i http://localhost:8080/api/v1/users/1\n}\n\nfunc UpdateUser(c *gin.Context) {\n    // Connection to the database\n    db := InitDb()\n    // Close connection database\n    defer db.Close()\n\n    // Get id user\n    email := c.Params.ByName(&quot;email&quot;)\n    var user Users\n    // SELECT * FROM users WHERE id = 1;\n    db.First(&amp;user, email)\n\n    if user.email != &quot;&quot; &amp;&amp; user.password != &quot;&quot; {\n\n        if user.email != &quot;&quot; {\n            var newUser Users\n            c.Bind(&amp;newUser)\n\n            result := Users{\n                email: newUser.email,\n                password:  newUser.password,\n            }\n\n            // UPDATE users SET email='newUser.email', password='newUser.password' WHERE id = user.Id;\n            db.Save(&amp;result)\n            // Display modified data in JSON message &quot;success&quot;\n            c.JSON(200, gin.H{&quot;success&quot;: result})\n        } else {\n            // Display JSON error\n            c.JSON(404, gin.H{&quot;error&quot;: &quot;User not found&quot;})\n        }\n\n    } else {\n        // Display JSON error\n        c.JSON(422, gin.H{&quot;error&quot;: &quot;Fields are empty&quot;})\n    }\n\n    // curl -i -X PUT -H &quot;Content-Type: application/json&quot; -d &quot;{ \\&quot;email\\&quot;: \\&quot;Thea\\&quot;, \\&quot;password\\&quot;: \\&quot;Merlyn\\&quot; }&quot; http://localhost:8080/api/v1/users/1\n}\n\nfunc DeleteUser(c *gin.Context) {\n    // Connection to the database\n    db := InitDb()\n    // Close connection database\n    defer db.Close()\n\n    // Get id user\n    email := c.Params.ByName(&quot;email&quot;)\n    var user Users\n    // SELECT * FROM users WHERE id = 1;\n    db.First(&amp;user, email)\n\n    if user.email != &quot;&quot; {\n        // DELETE FROM users WHERE id = user.Id\n        db.Delete(&amp;user)\n        // Display JSON result\n        c.JSON(200, gin.H{&quot;success&quot;: &quot;User #&quot; + email + &quot; deleted&quot;})\n    } else {\n        // Display JSON error\n        c.JSON(404, gin.H{&quot;error&quot;: &quot;User not found&quot;})\n    }\n\n    // curl -i -X DELETE http://localhost:8080/api/v1/users/1\n}\n\nfunc OptionsUser(c *gin.Context) {\n\n    c.Writer.Header().Set(&quot;Access-Control-Allow-Methods&quot;, &quot;DELETE,POST, PUT&quot;)\n    c.Writer.Header().Set(&quot;Access-Control-Allow-Headers&quot;,   &quot;access-control-allow-headers,access-control-allow-origin,content-type&quot;)\n    c.Next()\n}\n</code></pre>\n"}, {"tags": ["json", "go", "blockchain"], "comments": [{"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 1, "creation_date": 1514632241, "post_id": 48033055, "comment_id": 83036709, "body": "<a href=\"https://msgpack.org/\" rel=\"nofollow noreferrer\">msgpack</a> test your data with this <a href=\"https://toolslick.com/json-to-messagepack-converter\" rel=\"nofollow noreferrer\">online tool</a>, then good old <a href=\"https://golang.org/pkg/compress/\" rel=\"nofollow noreferrer\">gzip or bzip2</a>"}], "owner": {"reputation": 87, "user_id": 1456110, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/d97b546c3896202e2945c270d8feb750?s=128&d=identicon&r=PG", "display_name": "user1456110", "link": "https://stackoverflow.com/users/1456110/user1456110"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1514631889, "creation_date": 1514629803, "last_edit_date": 1514631889, "question_id": 48033055, "link": "https://stackoverflow.com/questions/48033055/put-and-get-json-in-ledger-using-go", "title": "put and get json in ledger using go", "body": "<p>I am quite new to Go programming.</p>\n\n<p>I am trying to insert a json into blockchain ledger and read it back using golang. My json looks like below:</p>\n\n<pre><code>var jsonBytes = []byte(`[{\"FLD1\":10,\"Fld2\":\"ABC\"}, {\"FLD1\":100,\"Fld2\":\"0.26\"}]`)\n</code></pre>\n\n<p>Ultimately, this json will be used as a look up table in my blockchain code.</p>\n\n<ol>\n<li><p>what is the efficient format to store it in ledger? should I convert to string or keep that as a <code>[]byte</code>, considering that this json will be sent as a parameter from a client to chaincode. any examples about the data formats should be used in this scenario.</p></li>\n<li><p>This json array would be big in size for ex., 1300 objects array. please suggest a format that is good enough to transfer this size.</p></li>\n</ol>\n"}, {"tags": ["git", "go", "govendor"], "comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1514635700, "post_id": 48031621, "comment_id": 83037523, "body": "By removing the git tag, do you mean your question has nothing to do with git?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1514672003, "post_id": 48031621, "comment_id": 83046933, "body": "OK. Git-related then. Did you test my idea of relocating the .git folder elsewhere?"}], "answers": [{"comments": [{"owner": {"reputation": 29326, "user_id": 11125, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/50d8719c41cb766282b463f4b2e06afd?s=128&d=identicon&r=PG&f=1", "display_name": "gak", "link": "https://stackoverflow.com/users/11125/gak"}, "edited": false, "score": 0, "creation_date": 1514708144, "post_id": 48032353, "comment_id": 83052332, "body": "Thanks for the suggestion. It is a novel approach, but slightly hacky in my opinion. I will continue working out a cleaner approach."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 29326, "user_id": 11125, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/50d8719c41cb766282b463f4b2e06afd?s=128&d=identicon&r=PG&f=1", "display_name": "gak", "link": "https://stackoverflow.com/users/11125/gak"}, "edited": false, "score": 0, "creation_date": 1514708222, "post_id": 48032353, "comment_id": 83052347, "body": "@GeraldKaszuba I would argue it is not &quot;hacky&quot;, and promote a clean separation of Golang dependency management on one side, and source control management on the other."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1514623742, "creation_date": 1514623742, "answer_id": 48032353, "question_id": 48031621, "link": "https://stackoverflow.com/questions/48031621/how-to-work-with-a-development-vendor-package-managed-by-dep/48032353#48032353", "title": "How to work with a development vendor package managed by dep?", "body": "<p>An alternative to \"ignoring <code>.git</code>\" is to keep the <code>.git</code> folder elsewhere! (well outside of your Go project)</p>\n\n<p>Any time you need to execute a git command in the vendored sub-project, you would need to use an alias to the git command, which would be:</p>\n\n<pre><code>alias gg='git --git-dir=/path/to/elsewhere/.git --work-tree=/path/to/vendored/subproject'\n# Windows\ndoskey gg=git --git-dir=C:\\path\\to\\elsewhere\\.git --work-tree=C:\\path\\to\\vendored\\subproject $*\n</code></pre>\n\n<p>That way, you can still benefit from version-controled operations within your vendored subproject.</p>\n"}, {"tags": [], "owner": {"reputation": 29326, "user_id": 11125, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/50d8719c41cb766282b463f4b2e06afd?s=128&d=identicon&r=PG&f=1", "display_name": "gak", "link": "https://stackoverflow.com/users/11125/gak"}, "is_accepted": false, "score": 2, "last_activity_date": 1514709782, "last_edit_date": 1514709782, "creation_date": 1514709283, "answer_id": 48041094, "question_id": 48031621, "link": "https://stackoverflow.com/questions/48031621/how-to-work-with-a-development-vendor-package-managed-by-dep/48041094#48041094", "title": "How to work with a development vendor package managed by dep?", "body": "<p>According to the <a href=\"https://github.com/golang/dep#testing-changes-to-a-dependency\" rel=\"nofollow noreferrer\"><code>dep</code> docs</a>, there is no inbuilt way of doing this as it stands.</p>\n\n<p>They also recommend not modifying packages in the <code>vendor</code> directory directly, for the reasons I discovered: it gets nuked when running <code>dep ensure</code>.</p>\n\n<p>Their main suggestion is to manually remove the package from the <code>vendor/</code> directory, modify it in the regular <code>$GOPATH</code>, and running <code>dep ensure -update &lt;pkg&gt;</code> when finished development of it.</p>\n\n<p>This is sufficiently better than pushing for each change, but still requires to manually <code>push</code>/<code>dep ensure</code> when completing the development work.</p>\n"}], "owner": {"reputation": 29326, "user_id": 11125, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/50d8719c41cb766282b463f4b2e06afd?s=128&d=identicon&r=PG&f=1", "display_name": "gak", "link": "https://stackoverflow.com/users/11125/gak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 899, "favorite_count": 2, "answer_count": 2, "score": 3, "last_activity_date": 1514709782, "creation_date": 1514615613, "last_edit_date": 1514671478, "question_id": 48031621, "link": "https://stackoverflow.com/questions/48031621/how-to-work-with-a-development-vendor-package-managed-by-dep", "title": "How to work with a development vendor package managed by dep?", "body": "<p>How can I use a development copy/clone of a package while using <code>dep</code> and a vendor directory? The vendor directory is included in the main repository.</p>\n\n<p>For example, I have forked package and replaced it with my own on github. I want to be able to edit the code and not have to <code>git push</code> + <code>dep ensure</code> for each change of the package.</p>\n\n<p>If I clone the package in the vendor directory, it I won't be able to commit that directory into the main repo because it's treated as a separate repository.</p>\n\n<p>I tried a trick to <code>.gitignore</code> the <code>.git</code> directory from outside the package. This works well until <code>dep ensure</code> is run, where the <code>.git</code> directory is nuked.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1514762950, "post_id": 48030914, "comment_id": 83063871, "body": "Please show you actual data model and describe your use cases."}], "answers": [{"comments": [{"owner": {"reputation": 795, "user_id": 3041613, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/061da320c11b785e534f4fcc2ecfc6ac?s=128&d=identicon&r=PG&f=1", "display_name": "Artorias", "link": "https://stackoverflow.com/users/3041613/artorias"}, "edited": false, "score": 0, "creation_date": 1514635725, "post_id": 48031191, "comment_id": 83037530, "body": "I have already created unique index for these fields. however, the transaction doesn&#39;t return err if the insertion fails. It will just insert the transaction to transaction collection. The record inserted to user and email will also have a txn-queue and txn-revno."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 795, "user_id": 3041613, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/061da320c11b785e534f4fcc2ecfc6ac?s=128&d=identicon&r=PG&f=1", "display_name": "Artorias", "link": "https://stackoverflow.com/users/3041613/artorias"}, "edited": false, "score": 1, "creation_date": 1514663073, "post_id": 48031191, "comment_id": 83044723, "body": "I&#39;m not to familiar with mongo and transactions.  You may be overcomplicating it. If you have unique ids in place then doing a simple insert should work. <a href=\"https://godoc.org/labix.org/v2/mgo#Collection.Insert\" rel=\"nofollow noreferrer\">godoc.org/labix.org/v2/mgo#Collection.Insert</a>  If you need to do two inserts at the same time.. Just wrap both inserts with a method. -&gt; something like -&gt; func(ids ...) insert() error"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 795, "user_id": 3041613, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/061da320c11b785e534f4fcc2ecfc6ac?s=128&d=identicon&r=PG&f=1", "display_name": "Artorias", "link": "https://stackoverflow.com/users/3041613/artorias"}, "edited": false, "score": 0, "creation_date": 1514663496, "post_id": 48031191, "comment_id": 83044862, "body": "Mongo is also not sql. You could redesign your document to contain all the necessary information. There is no point in doing two separate look ups later. <a href=\"https://groups.google.com/forum/#!topic/mongodb-user/1JszrIaZ1Nw\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/mongodb-user/1JszrIaZ1Nw</a>"}, {"owner": {"reputation": 795, "user_id": 3041613, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/061da320c11b785e534f4fcc2ecfc6ac?s=128&d=identicon&r=PG&f=1", "display_name": "Artorias", "link": "https://stackoverflow.com/users/3041613/artorias"}, "edited": false, "score": 0, "creation_date": 1514702273, "post_id": 48031191, "comment_id": 83051454, "body": "I didn&#39;t normalize my mongodb tables as you can see from above. I just follow <a href=\"https://docs.mongodb.com/manual/tutorial/unique-constraints-on-arbitrary-fields/\" rel=\"nofollow noreferrer\">docs.mongodb.com/manual/tutorial/&hellip;</a> to create multiple unique fields so I have to create an extra table just for email uniqueness. Since these two insertions are closely related, I have to use transaction to ensure both of their completion."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 795, "user_id": 3041613, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/061da320c11b785e534f4fcc2ecfc6ac?s=128&d=identicon&r=PG&f=1", "display_name": "Artorias", "link": "https://stackoverflow.com/users/3041613/artorias"}, "edited": false, "score": 0, "creation_date": 1514758421, "post_id": 48031191, "comment_id": 83063215, "body": "@wachiu Your model is flawed, then. While mgo provides transactions, I would not rely overly on it, as it is a <i>driver</i> feature. If you want atomic operations, put them values which belong together into a single document."}, {"owner": {"reputation": 795, "user_id": 3041613, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/061da320c11b785e534f4fcc2ecfc6ac?s=128&d=identicon&r=PG&f=1", "display_name": "Artorias", "link": "https://stackoverflow.com/users/3041613/artorias"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1514785799, "post_id": 48031191, "comment_id": 83066485, "body": "@MarkusWMahlberg I can see your point that we should avoid mgo/txn. I just found that I misunderstood docs.mongodb.com/manual/tutorial/unique-constraints-on-arbit&zwnj;&#8203;rary-fields/ . I can actually create two unique indexes for a collection. Thanks for all your time. I will mark this as answer."}], "tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": true, "score": 1, "last_activity_date": 1514611512, "last_edit_date": 1514611512, "creation_date": 1514610924, "answer_id": 48031191, "question_id": 48030914, "link": "https://stackoverflow.com/questions/48030914/mgo-txn-assert-uniqueness-in-collection/48031191#48031191", "title": "mgo/txn assert uniqueness in collection", "body": "<p>From the documentation</p>\n\n<pre><code>// DocExists and DocMissing may be used on an operation's\n// Assert value to assert that the document with the given\n// Id exists or does not exist, respectively.\n</code></pre>\n\n<p>...</p>\n\n<pre><code>// Insert holds the document to be inserted at the time the\n// transaction is applied. The Id field will be inserted\n// into the document automatically as its _id field. The\n// transaction will continue even if the document already\n// exists. Use Assert with txn.DocMissing if the insertion is\n// required.\n</code></pre>\n\n<p>So what it sounds like to me is if txn.DocMissing is used then the item must be inserted for the transaction to complete. If the insert fails then the transaction will rollback. I don't think it has anything to do with uniqueness. For that you may want to use unique indexes</p>\n\n<p><a href=\"https://docs.mongodb.com/manual/core/index-unique/\" rel=\"nofollow noreferrer\">https://docs.mongodb.com/manual/core/index-unique/</a></p>\n\n<p>Also more information on how Assert works\n<a href=\"https://blog.labix.org/2012/08/22/multi-doc-transactions-for-mongodb\" rel=\"nofollow noreferrer\">https://blog.labix.org/2012/08/22/multi-doc-transactions-for-mongodb</a></p>\n"}], "owner": {"reputation": 795, "user_id": 3041613, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/061da320c11b785e534f4fcc2ecfc6ac?s=128&d=identicon&r=PG&f=1", "display_name": "Artorias", "link": "https://stackoverflow.com/users/3041613/artorias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 438, "favorite_count": 0, "accepted_answer_id": 48031191, "answer_count": 1, "score": 0, "last_activity_date": 1514868041, "creation_date": 1514607625, "last_edit_date": 1514868041, "question_id": 48030914, "link": "https://stackoverflow.com/questions/48030914/mgo-txn-assert-uniqueness-in-collection", "title": "mgo/txn assert uniqueness in collection", "body": "<p>I have been trying to insert user info to my mongodb. Since I want both username and email to be unique, I created an email proxy collection for it.</p>\n\n<pre><code>userID := bson.NewObjectId()\nemailID := bson.NewObjectId()\ntc := mgoSession.DB(DBName).C(\"transaction\")\n    runner := txn.NewRunner(tc)\n    ops := []txn.Op{{\n        C:      \"email\",\n            Id:     emailID,\n            Assert: txn.DocMissing,\n            Insert: Email{ParentID: userID, Email: email},\n        }, {\n            C:      \"user\",\n            Id:     userID,\n            Assert: txn.DocMissing,\n            Insert: User{ID: userID, Username: username, Email: email, RegDate: time.Now(), HashedPw: hashedpw},\n        }}\n        err = runner.Run(ops, \"\", nil)\n        if err != nil {\n            panic(err)\n        }\n</code></pre>\n\n<p>I want to assert uniqueness of email for operation1 and uniqueness of username for operation 2 before insertion. I think I am not using the txn.DocMissing right but I can't find too much information about it on the internet.</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user7857373"}, "edited": false, "score": 0, "creation_date": 1514611342, "post_id": 48031071, "comment_id": 83032634, "body": "Hi, thanks for your answer. I tried it and it working, but when I tried to get the json file why the len function show it 0? <a href=\"https://i.imgur.com/zCK4RHi.png\" rel=\"nofollow noreferrer\">func loadData</a> I already make it the same as yours <a href=\"https://i.imgur.com/Rg3USd1.png\" rel=\"nofollow noreferrer\">func main</a> but the result is <a href=\"https://i.imgur.com/0YkayTA.png\" rel=\"nofollow noreferrer\">output</a>"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1514611663, "post_id": 48031071, "comment_id": 83032688, "body": "Did you uncomment the commented code above? I&#39;m going to edit it work with a file."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7857373"}, "edited": false, "score": 0, "creation_date": 1514611839, "post_id": 48031071, "comment_id": 83032724, "body": "yeah i uncomment the code, because i need to get the data from a file. but isn&#39;t it the same? because what inside the file is the same with the rawJson you make right?"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1514612034, "post_id": 48031071, "comment_id": 83032760, "body": "I added a cleaner version that&#39;s just for files.  Assuming your path is correct and the contents in the file exists in the same exact format your JSON example from above is then all should be well."}, {"owner": {"user_type": "does_not_exist", "display_name": "user7857373"}, "edited": false, "score": 0, "creation_date": 1514612688, "post_id": 48031071, "comment_id": 83032859, "body": "ah i see, so the <code>os.Open</code> is the wrong function I assume, but now why it gives me this error <b>json: cannot unmarshal array into Go value of type main.Data</b>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user7857373"}, "edited": false, "score": 0, "creation_date": 1514613008, "post_id": 48031071, "comment_id": 83032922, "body": "ah nvm, my mistake, i delete the part of json file, that&#39;s why it gives the error . 1 more questions, is it possible to put another struct in <code>type data struct</code>? for now it have only <b>posts</b> how about if i put another <b>users struct</b>?"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 2, "creation_date": 1514614648, "post_id": 48031071, "comment_id": 83033184, "body": "Yes it&#39;s possible and you can embed it or define a new attribute of that new type  <a href=\"https://www.goinggo.net/2014/05/methods-interfaces-and-embedded-types.html\" rel=\"nofollow noreferrer\">goinggo.net/2014/05/methods-interfaces-and-embedded-types.ht&zwnj;&#8203;ml</a>"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1514746508, "post_id": 48031071, "comment_id": 83061059, "body": "Applause for adding the missing error checks of the original code."}], "tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": true, "score": 3, "last_activity_date": 1514611959, "last_edit_date": 1514611959, "creation_date": 1514609542, "answer_id": 48031071, "question_id": 48030870, "link": "https://stackoverflow.com/questions/48030870/got-an-error-when-i-tried-to-call-the-value-with-go-lang/48031071#48031071", "title": "got an error when i tried to call the value with go lang", "body": "<p>You're loadPost method returns <code>[]Post</code>. Your definition of <code>Post</code> does not contain the <code>attribute Post</code>. Your <code>Posts</code> struct does. </p>\n\n<p>Here is a modified working example. I didn't define your other structures for brevity.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n)\n\nvar rawJson = `{\n  \"posts\": [\n    {\n      \"title\": \"sapien ut nunc\",\n      \"author\": \"Jeni\",\n      \"content\": \"jgwilt0@mapquest.com\",\n      \"publishdate\": \"26.04.2017\",\n      \"image\": \"http://dummyimage.com/188x199.png/cc0000/ffffff\"\n    },\n    {\n      \"title\": \"mus vivamus vestibulum sagittis\",\n      \"author\": \"Analise\",\n      \"content\": \"adonnellan1@biblegateway.com\",\n      \"publishdate\": \"13.03.2017\",\n      \"image\": \"http://dummyimage.com/182x113.bmp/ff4444/ffffff\"\n    }\n  ]\n}`\n\ntype Data struct {\n    Posts []struct {\n        Title       string `json:\"title\"`\n        Author      string `json:\"author\"`\n        Content     string `json:\"content\"`\n        Publishdate string `json:\"publishdate\"`\n        Image       string `json:\"image\"`\n    } `json:\"posts\"`\n}\n\nfunc loadFile(fileName string) (string, error) {\n    bytes, err := ioutil.ReadFile(fileName)\n\n    if err != nil {\n        return \"\", err\n    }\n    return string(bytes), nil\n}\n\nfunc loadData() (Data, error) {\n    var d Data\n    // this is commented out so that i can load raw bytes as an example\n    /*\n        f, err := os.Open(\"source/posts.json\")\n        if err != nil {\n            return d, err\n        }\n        defer f.Close()\n\n        bytes, _ := ioutil.ReadAll(f)\n    */\n\n    // replace rawJson with bytes in prod\n    json.Unmarshal([]byte(rawJson), &amp;d)\n    return d, nil\n}\n\nfunc main() {\n    data, err := loadData()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    for i := 0; i &lt; len(data.Posts); i++ {\n        fmt.Println(\"Title: \" + data.Posts[i].Title)\n    }\n\n    /*\n    // you can also range over the data.Posts if you are not modifying the data then using the index is not necessary. \n    for _, post := range data.Posts {\n        fmt.Println(\"Title: \" + post.Title)\n    }\n    */\n\n}\n</code></pre>\n\n<p>modified just for files</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n)\n\ntype Data struct {\n    Posts []struct {\n        Title       string `json:\"title\"`\n        Author      string `json:\"author\"`\n        Content     string `json:\"content\"`\n        Publishdate string `json:\"publishdate\"`\n        Image       string `json:\"image\"`\n    } `json:\"posts\"`\n}\n\n\nfunc loadData() (Data, error) {\n    var d Data\n    b, err := ioutil.ReadFile(\"source/posts.json\")\n    if err != nil {\n        return d, err\n    }\n\n    err = json.Unmarshal(b, &amp;d)\n    if err != nil {\n        return d, err\n    }\n\n    return d, nil\n}\n\nfunc main() {\n    data, err := loadData()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    for _, post := range data.Posts {\n        fmt.Println(\"Title: \" + post.Title)\n    }\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7857373"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 1, "accepted_answer_id": 48031071, "answer_count": 1, "score": 0, "last_activity_date": 1514611959, "creation_date": 1514607216, "last_edit_date": 1514607710, "question_id": 48030870, "link": "https://stackoverflow.com/questions/48030870/got-an-error-when-i-tried-to-call-the-value-with-go-lang", "title": "got an error when i tried to call the value with go lang", "body": "<p>I just starting learn this Go Lang programming, and now i'm stuck with the [] things, I tried to create a blog using the Go Lang and i'm using a template, there's no problem with the template, it just I want to append a data that I got from json file.</p>\n\n<p>If I just take the data and send it through the file it's already done, but the problem is when I tried to append the slug to the data (because the json file i got no slug url in it.</p>\n\n<p>That's why I want to get the title of the post then make a slug with it, then </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"github.com/gosimple/slug\"\n    \"html/template\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"os\"\n)\n\ntype Blog struct {\n    Title  string\n    Author string\n    Header string\n}\n\ntype Posts struct {\n    Posts []Post `json:\"posts\"`\n}\n\ntype Post struct {\n    Title       string `json:\"title\"`\n    Author      string `json:\"author\"`\n    Content     string `json:\"content\"`\n    PublishDate string `json:\"publishdate\"`\n    Image       string `json:\"image\"`\n}\n\ntype BlogViewModel struct {\n    Blog  Blog\n    Posts []Post\n}\n\nfunc loadFile(fileName string) (string, error) {\n    bytes, err := ioutil.ReadFile(fileName)\n\n    if err != nil {\n        return \"\", err\n    }\n\n    return string(bytes), nil\n}\n\nfunc loadPosts() []Post {\n    jsonFile, err := os.Open(\"source/posts.json\")\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    fmt.Println(\"Successfully open the json file\")\n    defer jsonFile.Close()\n\n    bytes, _ := ioutil.ReadAll(jsonFile)\n\n    var post []Post\n    json.Unmarshal(bytes, &amp;post)\n\n    return post\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    blog := Blog{Title: \"asd\", Author: \"qwe\", Header: \"zxc\"}\n    posts := loadPosts()\n\n    viewModel := BlogViewModel{Blog: blog, Posts: posts}\n\n    t, _ := template.ParseFiles(\"template/blog.html\")\n    t.Execute(w, viewModel)\n}\n</code></pre>\n\n<p>The error is show in the main function</p>\n\n<pre><code>func main() {\n\n    posts := loadPosts()\n\n    for i := 0; i &lt; len(posts.Post); i++ { // it gives me this error posts.Post undefined (type []Post has no field or method Post)\n\n        fmt.Println(\"Title: \" + posts.Post[i].Title)\n    }\n    // http.HandleFunc(\"/\", handler)\n\n    // fs := http.FileServer(http.Dir(\"template\"))\n    // http.Handle(\"/assets/css/\", fs)\n    // http.Handle(\"/assets/js/\", fs)\n    // http.Handle(\"/assets/fonts/\", fs)\n    // http.Handle(\"/assets/images/\", fs)\n    // http.Handle(\"/assets/media/\", fs)\n\n    // fmt.Println(http.ListenAndServe(\":9000\", nil))\n\n}\n</code></pre>\n\n<p>I already try to solved it a couple of hours but I hit the wall, I think it's possible but I just don't find the way, I don't know what is the good keyword to solve the problem.\nAnd I don't if I already explain good enough or not. Please help me, thank you</p>\n\n<p>This is the JSON file format</p>\n\n<pre><code>{\n  \"posts\": [\n    {\n      \"title\": \"sapien ut nunc\",\n      \"author\": \"Jeni\",\n      \"content\": \"jgwilt0@mapquest.com\",\n      \"publishdate\": \"26.04.2017\",\n      \"image\": \"http://dummyimage.com/188x199.png/cc0000/ffffff\"\n    },\n    {\n      \"title\": \"mus vivamus vestibulum sagittis\",\n      \"author\": \"Analise\",\n      \"content\": \"adonnellan1@biblegateway.com\",\n      \"publishdate\": \"13.03.2017\",\n      \"image\": \"http://dummyimage.com/182x113.bmp/ff4444/ffffff\"\n    }\n  ]\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/xhsRI.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/xhsRI.png\" alt=\"This is the directory\"></a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1514748086, "post_id": 48030347, "comment_id": 83061380, "body": "Can you describe your use case a bit more? I am asking because there might be a more elegant solution. For example, MongoDB allows auto deletion of documents based on a TTL index on a timestamp."}], "answers": [{"comments": [{"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 1, "creation_date": 1525884824, "post_id": 48030441, "comment_id": 87534780, "body": "By the way, as you said, a linked list would be better, I think you should use golang build in double linked list here, <a href=\"https://golang.org/pkg/container/list/\" rel=\"nofollow noreferrer\">golang.org/pkg/container/list</a>"}], "tags": [], "owner": {"reputation": 7503, "user_id": 1059273, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f49fd78553be0a74aef8736864937b5d?s=128&d=identicon&r=PG", "display_name": "cjds", "link": "https://stackoverflow.com/users/1059273/cjds"}, "is_accepted": false, "score": 4, "last_activity_date": 1514601982, "last_edit_date": 1514601982, "creation_date": 1514601362, "answer_id": 48030441, "question_id": 48030347, "link": "https://stackoverflow.com/questions/48030347/how-to-efficiently-call-a-func-after-x-hours/48030441#48030441", "title": "how to efficiently call a func after X hours?", "body": "<p>So I'd agree with your solution #2 than number 1. </p>\n\n<p>Traversing through a list of a million numbers is much easier than having a million separate Go Routines</p>\n\n<p>Go Routines are expensive (compared to loops) and take memory and processing time. For eg. a million Go Routines take about 4GB of RAM.</p>\n\n<p>Traversing through a list on the other hand takes very little space and is done in O(n) time.</p>\n\n<p>A good example of this exact function is Go Cache which deletes its expired elements in a Go Routine it runs periodically</p>\n\n<p><a href=\"https://github.com/patrickmn/go-cache/blob/master/cache.go#L931\" rel=\"nofollow noreferrer\">https://github.com/patrickmn/go-cache/blob/master/cache.go#L931</a></p>\n\n<p>This is a more detailed example of how they did it:</p>\n\n<pre><code>type Item struct {\n    Object     interface{}\n    Expiration int64\n}\n\n\nfunc (item Item) Expired() bool {\n    if item.Expiration == 0 {\n        return false\n    }\n   return time.Now().UnixNano() &gt; item.Expiration\n}\n\nfunc RemoveItem(s []Item, index int) []int {\n     return append(s[:index], s[index+1:]...)\n}\n\nfunc deleteExpired(items []Item){ \n    var deletedItems  []int\n    for k, v := range items {\n        if v.Expired(){\n            deletedItems = append(deletedItems, k)\n        }\n    }\n    for key, deletedIndex := range deleteditems{ \n        items = RemoveItem(items, deletedIndex)\n    }\n}\n</code></pre>\n\n<p>The above implementation could definitely be improved with a linked list instead of an array but this is the general idea</p>\n"}, {"comments": [{"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1514659007, "post_id": 48032067, "comment_id": 83043653, "body": "Really appreciate it, but looks a bit too complicated for me :p.. I&#39;ll try to study it closer. You think the performance would be better than the one in cjds&#39;s answer?"}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1514661801, "post_id": 48032067, "comment_id": 83044349, "body": "Thanks a lot &lt;3 I&#39;ll try to integrate the code if Cerise&#39;s <code>time.AfterFunc</code>doesn&#39;t work the way I hope it does (:"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1514662541, "post_id": 48032067, "comment_id": 83044562, "body": "The heap is indeed a good solution to the problem, but why not use the runtime&#39;s heap of timers?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514662732, "post_id": 48032067, "comment_id": 83044613, "body": "Well, somehow I magically gain the ability to comment :). time.AfterFunc spawns a gorountine everytime It is called and only release the gorountine after the timer stops. So basically it is the same with your orignal solution. The profermance analysis has been edited into the answer."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1514663700, "post_id": 48032067, "comment_id": 83044921, "body": "@leafbebop  time.AfterFunc does <b>not</b> spawn a goroutine when called.   <a href=\"https://github.com/golang/go/blob/acce8268b611613bef4c422a861bd4863e85b0f1/src/time/sleep.go#L171-L173\" rel=\"nofollow noreferrer\">The goroutine is started in <code>goFunc</code></a>.   The function <code>goFunc</code> is <a href=\"https://github.com/golang/go/blob/acce8268b611613bef4c422a861bd4863e85b0f1/src/runtime/time.go#L246\" rel=\"nofollow noreferrer\">called when the time elapses</a>."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514664397, "post_id": 48032067, "comment_id": 83045103, "body": "Whether a new timer start a new gorountine is unclear to me. I am going to test it. Be right back."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1514665479, "post_id": 48032067, "comment_id": 83045369, "body": "Yes, the test result confirm it that a Timer while using a channel does not spawn a goroutine (or it does but a very tiny one). The test result has been added into the answer. Thank you for the insight."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 1, "last_activity_date": 1514665381, "last_edit_date": 1514665381, "creation_date": 1514620495, "answer_id": 48032067, "question_id": 48030347, "link": "https://stackoverflow.com/questions/48030347/how-to-efficiently-call-a-func-after-x-hours/48032067#48032067", "title": "how to efficiently call a func after X hours?", "body": "<p>This is an interesting question. I come to a solution where it use a heap to maintain the queue of items to be destroyed and sleep for exactly time until the next item is up for destruction. I think it is more efficient, but the gain might be slim on some cases. Nonetheless, you can see the code here:</p>\n\n<pre><code>package main\nimport (\n    \"container/heap\"\n    \"fmt\"\n    \"time\"\n)\n\ntype Item struct {\n    Expiration time.Time\n    Object     interface{} // It would make more sence to be *interface{}, but not as convinient\n}\n\n//MINIT is the minimal interval for delete to run. In most cases, it is better to be set as 0\nconst MININT = 1 * time.Second\n\nfunc deleteExpired(addCh chan Item) (quitCh chan bool) {\n    quitCh = make(chan bool)\n    go func() {\n        h := make(ExpHeap, 0)\n        var t *time.Timer\n\n        item := &lt;-addCh\n        heap.Push(&amp;h, &amp;item)\n        t = time.NewTimer(time.Until(h[0].Expiration))\n\n        for {\n            //Check unfinished incoming first\n            for incoming := true; incoming; {\n                select {\n                case item := &lt;-addCh:\n                    heap.Push(&amp;h, &amp;item)\n                default:\n                    incoming = false\n                }\n            }\n            if delta := time.Until(h[0].Expiration); delta &gt;= MININT {\n                t.Reset(delta)\n            } else {\n                t.Reset(MININT)\n            }\n\n            select {\n            case &lt;-quitCh:\n                return\n            //New Item incoming, break the timer\n            case item := &lt;-addCh:\n                heap.Push(&amp;h, &amp;item)\n                if item.Expiration.After(h[0].Expiration) {\n                    continue\n                }\n                if delta := time.Until(item.Expiration); delta &gt;= MININT {\n                    t.Reset(delta)\n                } else {\n                    t.Reset(MININT)\n                }\n            //Wait until next item to be deleted\n            case &lt;-t.C:\n                for !h[0].Expiration.After(time.Now()) {\n                    item := heap.Pop(&amp;h).(*Item)\n                    destroy(item.Object)\n                }\n                if delta := time.Until(h[0].Expiration); delta &gt;= MININT {\n                    t.Reset(delta)\n                } else {\n                    t.Reset(MININT)\n                }\n            }\n        }\n    }()\n    return quitCh\n}\n\ntype ExpHeap []*Item\n\nfunc (h ExpHeap) Len() int {\n    return len(h)\n}\n\nfunc (h ExpHeap) Swap(i, j int) {\n    h[i], h[j] = h[j], h[i]\n}\n\nfunc (h ExpHeap) Less(i, j int) bool {\n    return h[i].Expiration.Before(h[j].Expiration)\n}\n\nfunc (h *ExpHeap) Push(x interface{}) {\n    item := x.(*Item)\n    *h = append(*h, item)\n}\n\nfunc (h *ExpHeap) Pop() interface{} {\n    old, n := *h, len(*h)\n    item := old[n-1]\n    *h = old[:n-1]\n    return item\n}\n\n//Auctural destroy code.\nfunc destroy(x interface{}) {\n    fmt.Printf(\"%v @ %v\\n\", x, time.Now())\n}\n\nfunc main() {\n    addCh := make(chan Item)\n    quitCh := deleteExpired(addCh)\n\n    for i := 30; i &gt; 0; i-- {\n        t := time.Now().Add(time.Duration(i) * time.Second / 2)\n        addCh &lt;- Item{t, t}\n    }\n    time.Sleep(7 * time.Second)\n    quitCh &lt;- true\n}\n</code></pre>\n\n<p>playground: <a href=\"https://play.golang.org/p/JNV_6VJ_yfK\" rel=\"nofollow noreferrer\">https://play.golang.org/p/JNV_6VJ_yfK</a></p>\n\n<p>By the way, there are packages like <code>cron</code> for job management, but I am not familiar with them so I cannot speak for their efficiency.</p>\n\n<p>Edit:\nStill I haven't enough reputation to comment :(\nAbout performance: this code basically has less CPU usage as it only wake it self when necessary and only traverse items that is up for destruction instead of the whole list. Based on personal (actually ACM experience), roughly a mordern CPU can process a loop of 10^9 in 1.2 seconds or so, which means on a scale of 10^6, traversing the whole list takes about over 1 millisecond excluding auctual destruction code AND data copy (which will cost a lot on average on more than thousands of runs, to a scale of 100 millisecond or so). My code's approach is O(lg N) which on 10^6 scale is at least a thousand times faster (considering constant). Please note again all these calculation is based on experience instead of benchmarks (there was but I am not able to provide them).</p>\n\n<p>Edit 2:\nWith a second thought, I think the plain solution can use a simple optimization:</p>\n\n<pre><code>func deleteExpired(items []Item){ \n    tail = len(items)\n    for index, v := range items { //better naming\n        if v.Expired(){\n            tail--\n            items[tail],items[index] = v,items[tail]\n        }\n    }\n    deleteditems := items[tail:]\n    items:=items[:tail]\n}\n</code></pre>\n\n<p>With this change, it no longer copy data unefficiently and will not allocate extra space.</p>\n\n<p>Edit 3:\nchanging code from <a href=\"https://stackoverflow.com/questions/8509152/max-number-of-goroutines\">here</a>\nI tested the memoryuse of afterfunc. On my laptop it is 250 bytes per call, while on palyground it is 69 (I am curious at the reason). With my code, A pointer + a time.Time is 28 byte. At a scale of a million, the difference is slim. Using After Func is a much better option.</p>\n"}, {"comments": [{"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1514658821, "post_id": 48036677, "comment_id": 83043603, "body": "As far as I can understand, this will spawn its own goroutine, meaning a million requests would still result in a million goroutines being created?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 1, "creation_date": 1514660840, "post_id": 48036677, "comment_id": 83044113, "body": "Yes, the runtime creates a goroutine to run the function when the timer expires.  As far as expiration of the timers is concerned, the runtime implementation is very efficient (the runtime maintains bucketed heaps of timers)."}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1514661084, "post_id": 48036677, "comment_id": 83044176, "body": "Only when the timer expires? Meaning <code>&#47;&#47; do other stuff</code> will be called long before <code>destoryObject</code> happens? And if <code>destroyObject</code> only takes a milisecond then I won&#39;t need to worry about having a million goroutines running at the same time? If that&#39;s the case it sounds almost too good to be true"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 1, "creation_date": 1514661911, "post_id": 48036677, "comment_id": 83044377, "body": "The goroutine is created after the timer expires.  The <code>do other stuff</code> will be executed long before <code>destroyOjbect</code> is called.  You don&#39;t need to worry about millions of goroutines if <code>destroyObject</code> is quick and the expirations are spread over time."}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1514662534, "post_id": 48036677, "comment_id": 83044557, "body": "It&#39;s really blowing my mind.. can&#39;t recall ever seeing something that should be so complicated become so simple.. will try to test it.. thanks again :)!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 14, "last_activity_date": 1514662076, "last_edit_date": 1514662076, "creation_date": 1514658019, "answer_id": 48036677, "question_id": 48030347, "link": "https://stackoverflow.com/questions/48030347/how-to-efficiently-call-a-func-after-x-hours/48036677#48036677", "title": "how to efficiently call a func after X hours?", "body": "<p>The <a href=\"https://godoc.org/time#AfterFunc\" rel=\"noreferrer\">time.AfterFunc</a> function is designed for this use case:</p>\n\n<pre><code>func randomFunc() {\n    // do stuff\n    time.AfterFunc(4*time.Hour, func() { destroyObject(\"idofobject\") })\n    // do other stuff\n}\n</code></pre>\n\n<p><code>time.AfterFunc</code> is efficient and simple to use.</p>\n\n<p>As the documentation states, the function is called in a goroutine after the duration elapses.  The goroutine is not created up front as in the question.</p>\n"}, {"tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 1, "last_activity_date": 1514747918, "creation_date": 1514747918, "answer_id": 48045141, "question_id": 48030347, "link": "https://stackoverflow.com/questions/48030347/how-to-efficiently-call-a-func-after-x-hours/48045141#48045141", "title": "how to efficiently call a func after X hours?", "body": "<p>If it is a one-shot, this can be easily achieved with</p>\n\n<pre><code>// Make the destruction cancelable\ncancel := make(chan bool)\n\ngo func(t time.Duration, id int){\n expired := time.NewTimer(t).C\n select {\n   // destroy the object when the timer is expired\n   case &lt;-expired:\n     destroyObject(id)\n   // or cancel the destruction in case we get a cancel signal\n   // before it is destroyed\n   case &lt;-cancel:\n     fmt.Println(\"Cancelled destruction of\",id)\n     return\n }\n}(time.Hours * 4, id)\n\nif weather == weather.SUNNY {\n  cancel &lt;- true\n}\n</code></pre>\n\n<p>If you want to do it every 4 h:</p>\n\n<pre><code>// Same as above, though since id may have already been destroyed\n// once, I name the channel different\ndone := make(chan bool)\n\ngo func(t time.Duration,id int){\n\n  // Sends to the channel every t\n  tick := time.NewTicker(t).C\n\n  // Wrap, otherwise select will only execute the first tick\n  for{\n    select {\n      // t has passed, so id can be destroyed\n      case &lt;-tick:\n        destroyObject(id)\n      // We are finished destroying stuff\n      case &lt;-done:\n        fmt.Println(\"Ok, ok, I quit destroying...\")\n        return\n    }\n  }\n}()\n\nif weather == weather.RAINY {\n  done &lt;- true\n}\n</code></pre>\n\n<p>The idea behind it is to run a single goroutine per destruction job which can be cancelled. Say, you have a session and the user did something, so you want to keep the session alive. Since goroutines are <em>extremely</em> cheap, you can simply fire off another goroutine.</p>\n"}], "owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6211, "favorite_count": 1, "accepted_answer_id": 48036677, "answer_count": 4, "score": 5, "last_activity_date": 1514747918, "creation_date": 1514600196, "question_id": 48030347, "link": "https://stackoverflow.com/questions/48030347/how-to-efficiently-call-a-func-after-x-hours", "title": "how to efficiently call a func after X hours?", "body": "<p>I know I can do like this:</p>\n\n<pre><code>func randomFunc() {\n    // do stuff\n    go destroyObjectAfterXHours(4, \"idofobject\")\n    // do other stuff\n}\n\nfunc destroyObjectAfterXHours(hours int, id string) {\n    time.Sleep(hours * time.Hour)\n    destroyObject(id)\n}\n</code></pre>\n\n<p>but if we imagine <code>destroyObjectAfterXHours</code> is called a million times within a few minutes, this solution will be very bad.</p>\n\n<p>I was hoping someone could share a more efficient solution to this problem.</p>\n\n<p>I've been thinking about a potential solution where destruction time and object id was stored somewhere, and then there would be one func that would traverse through the list every X minutes, destroy the objects that had to be destroyed and remove their id and time info from wherever that info was stored. Would this be a good solution?</p>\n\n<p>I worry it would also be bad solution since you will then have to traverse through a list with millions of items all the time, and then have to efficiently remove some of the items, etc. </p>\n"}, {"tags": ["go", "hyperledger-fabric", "blockchain", "hyperledger"], "answers": [{"comments": [{"owner": {"reputation": 38497, "user_id": 104014, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3d186f3c6ad2de59b356c1cfad9af404?s=128&d=identicon&r=PG", "display_name": "Artem Barger", "link": "https://stackoverflow.com/users/104014/artem-barger"}, "edited": false, "score": 0, "creation_date": 1514637753, "post_id": 48032059, "comment_id": 83038023, "body": "So you do not need the \u2018./\u2018 as a path prefix"}], "tags": [], "owner": {"reputation": 38497, "user_id": 104014, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3d186f3c6ad2de59b356c1cfad9af404?s=128&d=identicon&r=PG", "display_name": "Artem Barger", "link": "https://stackoverflow.com/users/104014/artem-barger"}, "is_accepted": true, "score": 2, "last_activity_date": 1514892625, "last_edit_date": 1514892625, "creation_date": 1514620349, "answer_id": 48032059, "question_id": 48030138, "link": "https://stackoverflow.com/questions/48030138/chaincode-installation-on-peer-in-hyperledger-fabric/48032059#48032059", "title": "Chaincode installation on peer in HyperLedger Fabric", "body": "<p>You need to have your chaincode available in the GOPATH, then you should be able to install it. Just either add your bitbucket folder into GOPATH or move you chaincode into <code>$GOPATH/src</code>.</p>\n\n<p><strong>Update</strong></p>\n\n<p>The following command </p>\n\n<pre><code>peer chaincode install -n mycc -v 1.0 -p ./bitbucket.org/Foldername/testBlockchain/folder_name_for_chaincode\n</code></pre>\n\n<p>need to be replaced with</p>\n\n<pre><code>peer chaincode install -n mycc -v 1.0 -p bitbucket.org/Foldername/testBlockchain/folder_name_for_chaincode\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 129, "user_id": 8222863, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7ff63e1f7fc330cff431eba170a4e7bd?s=128&d=identicon&r=PG&f=1", "display_name": "Tabz", "link": "https://stackoverflow.com/users/8222863/tabz"}, "edited": false, "score": 0, "creation_date": 1514638063, "post_id": 48034067, "comment_id": 83038094, "body": "my .sh file is in localfabricfolder and I am trying to access chaincode in chaincodefolder"}], "tags": [], "owner": {"reputation": 129, "user_id": 8222863, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7ff63e1f7fc330cff431eba170a4e7bd?s=128&d=identicon&r=PG&f=1", "display_name": "Tabz", "link": "https://stackoverflow.com/users/8222863/tabz"}, "is_accepted": false, "score": 0, "last_activity_date": 1514637981, "creation_date": 1514637981, "answer_id": 48034067, "question_id": 48030138, "link": "https://stackoverflow.com/questions/48030138/chaincode-installation-on-peer-in-hyperledger-fabric/48034067#48034067", "title": "Chaincode installation on peer in HyperLedger Fabric", "body": "<p>Thanks for your answer. My chain code is already in $GOPATH. Directory structure is as follows. Directory structure is as follows                                      </p>\n\n<pre><code>$GOPATH                                                                                                              -&gt;src       \n    ---&gt;bitbucket.org\n    ------&gt;FolderName\n    ---------&gt;chaincodefolder\n    -------------&gt;chaincodenamefolder\n    ----------------chaincode.go\n    ----------&gt;Middleware\n    ----------&gt;localfabricfolder\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 691, "user_id": 4353189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b678b320eeb1d2feb507a13f9446b14e?s=128&d=identicon&r=PG", "display_name": "nilakantha singh deo", "link": "https://stackoverflow.com/users/4353189/nilakantha-singh-deo"}, "is_accepted": false, "score": 1, "last_activity_date": 1526305885, "creation_date": 1526305885, "answer_id": 50332032, "question_id": 48030138, "link": "https://stackoverflow.com/questions/48030138/chaincode-installation-on-peer-in-hyperledger-fabric/50332032#50332032", "title": "Chaincode installation on peer in HyperLedger Fabric", "body": "<pre><code>Step a)\nget the channel name using the following\n\npeer channel list\n\nstep b)\nget the chaincode version using this \n\npeer chaincode list --installed\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/Zo8xN.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Zo8xN.jpg\" alt=\"enter image description here\"></a></p>\n\n<pre><code>step c)\ninstall the chaincode using this\n\nCORE_PEER_ADDRESS=peer0.org1.example.com:7051 peer chaincode install -n mycc -p github.com/lc/go -v v3 \n\n\n-n=name,\n-v=version,\n-p=path\n</code></pre>\n"}], "owner": {"reputation": 129, "user_id": 8222863, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/7ff63e1f7fc330cff431eba170a4e7bd?s=128&d=identicon&r=PG&f=1", "display_name": "Tabz", "link": "https://stackoverflow.com/users/8222863/tabz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2748, "favorite_count": 0, "accepted_answer_id": 48032059, "answer_count": 3, "score": 1, "last_activity_date": 1526307810, "creation_date": 1514597455, "last_edit_date": 1526307810, "question_id": 48030138, "link": "https://stackoverflow.com/questions/48030138/chaincode-installation-on-peer-in-hyperledger-fabric", "title": "Chaincode installation on peer in HyperLedger Fabric", "body": "<p>I am trying to test my chaincode locally, for this I have a script to run, but whilst installation of chaincode(code below) getting error that chaincode path does not exists?</p>\n\n<pre><code>peer chaincode install -n mycc -v 1.0 -p ./bitbucket.org/Foldername/testBlockchain/folder_name_for_chaincode\n</code></pre>\n\n<p>in all of the examples I have seen following command is used</p>\n\n<pre><code>peer chaincode -n mycc -p github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02\n</code></pre>\n\n<p>My question precisely is that how can I correct my path to point to chaincode? </p>\n"}, {"tags": ["validation", "variables", "go", "sanitization"], "comments": [{"owner": {"reputation": 7503, "user_id": 1059273, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f49fd78553be0a74aef8736864937b5d?s=128&d=identicon&r=PG", "display_name": "cjds", "link": "https://stackoverflow.com/users/1059273/cjds"}, "edited": false, "score": 0, "creation_date": 1514602966, "post_id": 48030118, "comment_id": 83031279, "body": "Do you specifically need a type conversion from string to number? Are there more examples. Could you provide more?"}], "answers": [{"tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": true, "score": 2, "last_activity_date": 1514608392, "last_edit_date": 1514608392, "creation_date": 1514606795, "answer_id": 48030828, "question_id": 48030118, "link": "https://stackoverflow.com/questions/48030118/does-go-provide-variable-sanitization/48030828#48030828", "title": "Does go provide variable sanitization?", "body": "<p>You could write your own sanitizing methods and if it becomes something you'll be using more often, I'd package it out and add other methods to cover more use cases.</p>\n\n<p>I provide two different ways to achieve the same result. One is commented out.</p>\n\n<p>I haven't run any benchmarks so i couldn't tell you for certain which is more performant, but you could write your own tests if you wanted to figure it out.  It would also expose another important aspect of Go and in my opinion one of it's more powerful tools... testing.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"regexp\"\n    \"strconv\"\n    \"strings\"\n)\n// using a regex here which simply targets all digits and ignores everything else.  I make it a global var and use MustCompile because the\n// regex doesn't need to be created every time.\nvar extractInts = regexp.MustCompile(`\\d+`)\n\nfunc SanitizeStringToInt(input string) (int, error) {\n    m := extractInts.FindAllString(input, -1)\n    s := strings.Join(m, \"\")\n    return strconv.Atoi(s)\n}\n\n\n/*\n\n// if you didn't want to use regex you could use a for loop\nfunc SanitizeStringToInt(input string) (int, error) {\n    var s string\n    for _, r := range input {\n        if !unicode.IsLetter(r) {\n            s += string(r)\n        }\n    }\n\n    return strconv.Atoi(s)\n}\n\n*/\n\n\nfunc main() {\n    a := \"2012BV352\"\n    n, err := SanitizeStringToInt(a)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(n)\n}\n</code></pre>\n"}], "owner": {"reputation": 172, "user_id": 7338886, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/shaF0.jpg?s=128&g=1", "display_name": "Hasibul Hasn", "link": "https://stackoverflow.com/users/7338886/hasibul-hasn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 486, "favorite_count": 0, "accepted_answer_id": 48030828, "answer_count": 1, "score": 1, "last_activity_date": 1525866600, "creation_date": 1514597127, "last_edit_date": 1525866600, "question_id": 48030118, "link": "https://stackoverflow.com/questions/48030118/does-go-provide-variable-sanitization", "title": "Does go provide variable sanitization?", "body": "<p>I am a beginner in Golang.\nI have a problem with variable type assigning from user input.</p>\n\n<p>When the user enters data like <code>\"2012BV352\"</code> I need to be able to ignore the <code>BV</code> and pass <code>2012352</code> to my next function.</p>\n\n<p>There has a package name <code>gopkg.in/validator.v2</code> in doc</p>\n\n<p>But what it returns is whether or not the variable is safe or not.</p>\n\n<p>I need to cut off the unusual things.</p>\n\n<p>Any idea on how to achieve this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "edited": false, "score": 0, "creation_date": 1514591150, "post_id": 48029551, "comment_id": 83029317, "body": "Have you thought through how you world expect a function signature cast like that to work?"}], "answers": [{"comments": [{"owner": {"reputation": 5, "user_id": 8886378, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qcrMR.jpg?s=128&g=1", "display_name": "Zachary C.", "link": "https://stackoverflow.com/users/8886378/zachary-c"}, "edited": false, "score": 0, "creation_date": 1514591518, "post_id": 48029615, "comment_id": 83029393, "body": "I did, but never call the Call function. Worked perfectly, thanks!"}], "tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": true, "score": 1, "last_activity_date": 1514591140, "creation_date": 1514591140, "answer_id": 48029615, "question_id": 48029551, "link": "https://stackoverflow.com/questions/48029551/run-any-function-that-is-stored-in-an-interface/48029615#48029615", "title": "Run any function that is stored in an interface{}", "body": "<p>Have you looked at the reflect package?</p>\n\n<p>Particularly <a href=\"https://golang.org/pkg/reflect/#Type\" rel=\"nofollow noreferrer\">Type</a> and <a href=\"https://golang.org/pkg/reflect/#ValueOf\" rel=\"nofollow noreferrer\">ValueOf</a> and <a href=\"https://golang.org/pkg/reflect/#Value.Call\" rel=\"nofollow noreferrer\">Value.Call</a>.</p>\n"}], "owner": {"reputation": 5, "user_id": 8886378, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qcrMR.jpg?s=128&g=1", "display_name": "Zachary C.", "link": "https://stackoverflow.com/users/8886378/zachary-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 48029615, "answer_count": 1, "score": 0, "last_activity_date": 1514591140, "creation_date": 1514590436, "question_id": 48029551, "link": "https://stackoverflow.com/questions/48029551/run-any-function-that-is-stored-in-an-interface", "title": "Run any function that is stored in an interface{}", "body": "<p>I want to store a function with <strong>any parameters</strong> in an <code>interface{}</code> and be able to run it elsewhere.</p>\n\n<p>So it could store a <code>func(string) string</code> or a <code>func(int, int) string</code> or etc, but I need to be able to call it later and be able to tell it what type of function it is. I tried to use <code>.(func(string) string)</code> and <code>.(func(int,int) string)</code>, but got nothing.</p>\n\n<p>Any help is appreciated.</p>\n"}, {"tags": ["testing", "go", "naming-conventions"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1514584956, "post_id": 48028617, "comment_id": 83027896, "body": "<code>_</code> is not in <code>[a-z]</code>, so I\u2019m not sure what the confusion is there"}, {"owner": {"reputation": 603, "user_id": 491027, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fa7d31af2c84c7717b92333910699250?s=128&d=identicon&r=PG", "display_name": "edio", "link": "https://stackoverflow.com/users/491027/edio"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1514848124, "post_id": 48028617, "comment_id": 83080303, "body": "@JimB, documentation also says, that <code>Xxx</code> part must be alphanumeric. Underscore is not alphanumeric. Hence, my question. I found it hard to believe, that many projects violate the naming guideline, yet, I failed to find any description of a defacto naming convention (seems, that there&#39;s no any)."}], "answers": [{"tags": [], "owner": {"reputation": 603, "user_id": 491027, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fa7d31af2c84c7717b92333910699250?s=128&d=identicon&r=PG", "display_name": "edio", "link": "https://stackoverflow.com/users/491027/edio"}, "is_accepted": true, "score": 0, "last_activity_date": 1514843044, "creation_date": 1514843044, "answer_id": 48053473, "question_id": 48028617, "link": "https://stackoverflow.com/questions/48028617/tests-naming-convention-for-unexported-functions-in-go/48053473#48053473", "title": "Tests naming convention for unexported functions in Go", "body": "<p>My initial confusion with this originated from 2 things:</p>\n\n<p>1) an assumption, that underscore is allowed in test funciton name. This assumption was backed by tons of major opensource projects that do this</p>\n\n<p>2) the fact, that JetBrains Idea generates tests with names containing underscores</p>\n\n<p>The response to my own question: there is a convention (I'd rather say, it's a guideline from Google), which many projects violate. Underscore should not be used in a test name.</p>\n\n<p>I've voted for closing my own question and created a bug-report in JetBrains bugtracker.\n<a href=\"https://youtrack.jetbrains.com/issue/GO-5185\" rel=\"nofollow noreferrer\">https://youtrack.jetbrains.com/issue/GO-5185</a></p>\n"}], "owner": {"reputation": 603, "user_id": 491027, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fa7d31af2c84c7717b92333910699250?s=128&d=identicon&r=PG", "display_name": "edio", "link": "https://stackoverflow.com/users/491027/edio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 764, "favorite_count": 0, "accepted_answer_id": 48053473, "answer_count": 1, "score": 0, "last_activity_date": 1514843044, "creation_date": 1514582702, "question_id": 48028617, "link": "https://stackoverflow.com/questions/48028617/tests-naming-convention-for-unexported-functions-in-go", "title": "Tests naming convention for unexported functions in Go", "body": "<p>I can't trace where I know it from, but normally if one writes a test for method <code>Foo</code>, the corresponding test is named <code>TestFoo</code>.</p>\n\n<p>If one tests an unexported function, say <code>foo</code>, what the name of the test should be then?</p>\n\n<p>My question comes from the fact, that JetBrains IDE for Go, when asked to generate a test for an unexported function, generates something like <code>Test_foo</code>.</p>\n\n<p>This behavior may have sense, because if you have <code>Foo</code> and it's unexported counterpat <code>foo</code> in the same package, you'd want to distinct tests for them somehow (at least for <em>jump to test</em> feature in IDE).</p>\n\n<p>So is there any convention on naming tests after unexported functions?</p>\n\n<p>BTW:\ndocumentation for the Go <a href=\"https://golang.org/pkg/testing/\" rel=\"nofollow noreferrer\">testing</a> package says, that a test is executed if it is: </p>\n\n<blockquote>\n  <p>any function of the form</p>\n  \n  <p><code>func TestXxx(*testing.T)</code></p>\n  \n  <p>where Xxx can be any alphanumeric string (but the first letter must not be in [a-z]) and serves to identify the test routine.</p>\n</blockquote>\n\n<p>Which means, that any test having underscore in its name shouldn't be executed by <code>go test</code>. However, we all know, that such tests work just fine.</p>\n"}, {"tags": ["php", "json", "curl", "go"], "answers": [{"comments": [{"owner": {"reputation": 1593, "user_id": 688689, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/f8b3028279d9c29a3ee4c5d0f5fe6a23?s=128&d=identicon&r=PG&f=1", "display_name": "Diego Favero", "link": "https://stackoverflow.com/users/688689/diego-favero"}, "edited": false, "score": 0, "creation_date": 1514603174, "post_id": 48028573, "comment_id": 83031321, "body": "yeap ! using lenght as integer did solve the problem ! Cant believe it was so simple !!! Thanks a lot @cerise !!!"}, {"owner": {"reputation": 1593, "user_id": 688689, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/f8b3028279d9c29a3ee4c5d0f5fe6a23?s=128&d=identicon&r=PG&f=1", "display_name": "Diego Favero", "link": "https://stackoverflow.com/users/688689/diego-favero"}, "edited": false, "score": 0, "creation_date": 1514639515, "post_id": 48028573, "comment_id": 83038405, "body": "I never realized by myself that was an error warning. I thought it could be some sort of header"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1593, "user_id": 688689, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/f8b3028279d9c29a3ee4c5d0f5fe6a23?s=128&d=identicon&r=PG&f=1", "display_name": "Diego Favero", "link": "https://stackoverflow.com/users/688689/diego-favero"}, "edited": false, "score": 0, "creation_date": 1514656263, "post_id": 48028573, "comment_id": 83042846, "body": "@DiegoFavero That&#39;s the output from <code>json.NewEncoder(w).Encode(err)</code>.  Encoding an error as JSON is rarely what one would want.  A better choice is to encode err.Error(). That&#39;s not ideal either because it leaks implementation details to the client. A generic &quot;error parsing JSON&quot; is probably the best choice here."}, {"owner": {"reputation": 1593, "user_id": 688689, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/f8b3028279d9c29a3ee4c5d0f5fe6a23?s=128&d=identicon&r=PG&f=1", "display_name": "Diego Favero", "link": "https://stackoverflow.com/users/688689/diego-favero"}, "edited": false, "score": 0, "creation_date": 1514677270, "post_id": 48028573, "comment_id": 83047944, "body": "Well, I have more than 18 yeas on PHP/javascript, but, quite newbie on go&#39;s world ! And I got caught on PHP not mandatory variable type. Silly mistake. @Cerise Lim&#243;n : really appreciate your help !"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1514582380, "creation_date": 1514582380, "answer_id": 48028573, "question_id": 48028207, "link": "https://stackoverflow.com/questions/48028207/golang-webserver-sends-description-of-params-struct-on-json-response/48028573#48028573", "title": "GoLang WebServer sends description of param&#39;s struct on Json Response", "body": "<p>There is an error parsing the incoming JSON. This error is written to the response as <code>{\"Value\":\"string\",\"Type\":{},\"Offset\":26,\"Struct\":\"CodeLocatorParams\",\"Field\":\"lenght\"}</code>.  The handler continues to execute and writes the normal response <code>{\"locator\":\"DPEWX22\"}</code>.</p>\n\n<p>Here's how what to fix:</p>\n\n<ul>\n<li>After writing error response, return from the handler. </li>\n<li>The input JSON has lenght as a string value. Either change the struct field from int to string or modify the input to pass an integer.</li>\n</ul>\n"}], "owner": {"reputation": 1593, "user_id": 688689, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/f8b3028279d9c29a3ee4c5d0f5fe6a23?s=128&d=identicon&r=PG&f=1", "display_name": "Diego Favero", "link": "https://stackoverflow.com/users/688689/diego-favero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 48028573, "answer_count": 1, "score": 0, "last_activity_date": 1514582380, "creation_date": 1514580122, "last_edit_date": 1514580577, "question_id": 48028207, "link": "https://stackoverflow.com/questions/48028207/golang-webserver-sends-description-of-params-struct-on-json-response", "title": "GoLang WebServer sends description of param&#39;s struct on Json Response", "body": "<p>So here is the deal : I have been working on a huge system (PHP) for a couple years, and now, I decided to give up part of heavy jobs for golang scripts.</p>\n\n<p>So far, I replicated a few php scripts to a go version. Then, I am able to benchmark which option is better ( ok, I know go is faster, but I need curl or sockets to comunication, so, I have to check if it is still worth ) .</p>\n\n<p>One of the scripts just generate a random code, check if this new code is already in use ( on mysql db ), if not, record the new code and return it, if is already in use, just recursive call the function again until find an exclusive code. pretty simple one.</p>\n\n<p>I already had this code generator in php, so, wrote new one in go to be called as http/post with json params. \nUsing  linux terminal, I call it as </p>\n\n<pre><code>curl -H [headers] -d [jsondata] [host]\n</code></pre>\n\n<p>and I get back a pretty simple json</p>\n\n<pre><code>{\"locator\" : \"XXXXXX\"}\n</code></pre>\n\n<p>After, I wrote a simple php script to call the scripts and check how long each took to complete, something like :</p>\n\n<pre><code>&lt;?php\npublic function indexAction()\n    {\n    $phpTime = $endPHP = $startPHP =\n    $goTime = $endGO = $startGO = 0;\n\n// my standard function already in use\n\n\n    ob_start();\n\n    $startPHP = microtime(true);\n    $MyCodeLocator =  $this-&gt;container-&gt;get('MyCodeLocator')-&gt;Generate(22, 5);\n    $endPHP = microtime(true);\n\n    ob_end_clean();\n\n\n    sleep(1);\n    // Lets call using curl\n    $data = array(\"comon\" =&gt; \"22\", \"lenght\" =&gt; \"5\");\n    $data_string = json_encode($data);\n\n    ob_start();\n    $startGO = microtime(true);\n\n\n\n    $ch = curl_init('http://localhost:8888/dev/fibootkt/MyCodeGenerator');\n    curl_setopt($ch, CURLOPT_CUSTOMREQUEST, \"POST\");\n    curl_setopt($ch, CURLOPT_POSTFIELDS, $data_string);\n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n    curl_setopt($ch, CURLOPT_HTTPHEADER, array(\n            'Content-Type: application/json',\n            'Content-Length: ' . strlen($data_string))\n    );\n\n    $result = curl_exec($ch);\n    curl_close($ch);\n    $endGO = microtime(true);\n    ob_end_clean();\n\n    $result_rr = json_decode($result);\n\n    // tst just echo the variable in a nice way, second parameter means no kill execution\n    tst($result, 1); // HERE IS MY PROBLEM, please read below\n    tst($result_rr, 1); // IT SHOW NULL\n\n    sleep(1);\n\n// just to have params for comparision, always try by shell script\n    ob_start();\n    $startShell = microtime(true);;\n\n    $exec =  \"curl -H \\\"Content-Type: application/json\\\" -d '{\\\"comon\\\":\\\"22\\\"}' http://localhost:8888/dev/fibootkt/MyCodeGenerator\";\n    $output = shell_exec($exec);\n    $endShell  = microtime(true);\n    ob_end_clean();\n\n    tst(json_decode($output),1); // here show a stdclass with correct value\n    tst($output,1); // here shows a json typed string ready to be converted\n\n    // and here it is just for show the execution time ...\n    $phpTime = $endPHP - $startPHP;\n    $goTime = $endGO - $startGO ;\n    $shellTime = $endShell - $startShell;\n\n    tst(\"php \" . $phpTime, 1);\n    tst(\"curl \". $goTime, 1);\n    tst(\"shell \" . $shellTime, 1);\n</code></pre>\n\n<p>And I get the results from GO :\nBy Shell Script :</p>\n\n<pre><code>{\"locator\" : \"DPEWX22\"} \n</code></pre>\n\n<p>So, this one is pretty and easy decode to a stdobj.</p>\n\n<p>But, using curl, the operation is faster ! So, I want to use it.\nBut, the curl request responds something like :</p>\n\n<pre><code>{\"Value\":\"string\",\"Type\":{},\"Offset\":26,\"Struct\":\"CodeLocatorParams\",\"Field\":\"lenght\"}\n{\"locator\":\"DPEWX22\"}\n</code></pre>\n\n<p>And when I try to decode it, I get a null as result !!!</p>\n\n<p>CodeLocatorParams the struct type I use in go to get the post params, as show below</p>\n\n<p>so, here is my question : Why GO is returning this ? how to avoid it.</p>\n\n<p>I have another similar go script which take no params and responds a similar json ( but in this case,  a qrcode image path ) and it works fine !</p>\n\n<p>My go function:</p>\n\n<pre><code>type CodeLocatorParams struct {\n    Comon string `json:\"comon\"`\n    Lenght int  `json:\"lenght\"`\n}\n\nfunc Generate(w http.ResponseWriter, r *http.Request) {\n\n\n    data, err := ioutil.ReadAll(io.LimitReader(r.Body, 1048576))\n    if err != nil {\n        fmt.Println(err)\n        panic(err)\n\n    }\n    if err := r.Body.Close(); err != nil {\n        panic(err)\n    }\n\n// retrieve post data  and set it to params which is CodeLocatorParams type\n    var params CodeLocatorParams\n    if err := json.Unmarshal(data, &amp;params ); err != nil {\n        w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n        w.WriteHeader(422) // unprocessable entity\n        if err := json.NewEncoder(w).Encode(err); err != nil {\n            fmt.Println(err)\n            panic(err)\n        }\n    }\n\n\n\n\n\n    var result struct{\n        Locator string `json:\"locator\"`\n    }\n// here actually comes the func that generates random code and return it as string, but for now, just set it static\n    result.Locator = \"DPEWX22\"\n\n    w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n    json.NewEncoder(w).Encode(result)\n\n\n}\n</code></pre>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 4671, "user_id": 4927751, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VwUAi.jpg?s=128&g=1", "display_name": "Kshitij Saraogi", "link": "https://stackoverflow.com/users/4927751/kshitij-saraogi"}, "edited": false, "score": 0, "creation_date": 1514579591, "post_id": 48027974, "comment_id": 83026201, "body": "From now onwards, this will be at the top of my checklist."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 3, "last_activity_date": 1514579635, "last_edit_date": 1514579635, "creation_date": 1514578459, "answer_id": 48027974, "question_id": 48027927, "link": "https://stackoverflow.com/questions/48027927/go-parsing-json/48027974#48027974", "title": "[Go]: Parsing JSON", "body": "<p>You need to make your struct fields exported, otherwise the json package cannot access them.</p>\n\n<p>Please read <a href=\"https://blog.golang.org/json-and-go\" rel=\"nofollow noreferrer\">JSON and go</a> for more details, specifically this paragraph:</p>\n\n<blockquote>\n  <p>The json package only accesses the exported fields of struct types\n  (those that begin with an uppercase letter). Therefore only the the\n  exported fields of a struct will be present in the JSON output.</p>\n</blockquote>\n\n<p>And this one for more details:</p>\n\n<blockquote>\n  <p>How does Unmarshal identify the fields in which to store the decoded\n  data? For a given JSON key \"Foo\", Unmarshal will look through the\n  destination struct's fields to find (in order of preference):</p>\n  \n  <p>An exported field with a tag of \"Foo\" (see the Go spec for more on\n  struct tags),</p>\n  \n  <p>An exported field named \"Foo\", or</p>\n  \n  <p>An exported field\n  named \"FOO\" or \"FoO\" or some other case-insensitive match of \"Foo\".</p>\n</blockquote>\n\n<p>So your struct should really be:</p>\n\n<pre><code>type Packagemeta struct {\n    Path     string `json:\"path\"`\n    Synopsis string `json:\"synopsis,omitempty\"`\n    Count    int    `json:\"import_count,omitempty`\n}\n</code></pre>\n"}], "owner": {"reputation": 4671, "user_id": 4927751, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VwUAi.jpg?s=128&g=1", "display_name": "Kshitij Saraogi", "link": "https://stackoverflow.com/users/4927751/kshitij-saraogi"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "closed_date": 1514581475, "accepted_answer_id": 48027974, "answer_count": 1, "score": -1, "last_activity_date": 1514579635, "creation_date": 1514578195, "question_id": 48027927, "link": "https://stackoverflow.com/questions/48027927/go-parsing-json", "closed_reason": "Duplicate", "title": "[Go]: Parsing JSON", "body": "<p><strong>What I am trying to do</strong><br>\nI am parsing a JSON HTTP response based on <a href=\"https://stackoverflow.com/a/45758022/4927751\">this</a> answer to a similar question. My code is able to parse the JSON without any error but is unable to read the values and store them in the provided variable. \nThis has been puzzling me for the last 2 hours and it might be due to a trivial reason that I am overlooking here.</p>\n\n<p><strong>CODE</strong></p>\n\n<pre><code>type ImporterResponse struct {\n    results []packagemeta `json:\"results\"`\n}\n\ntype packagemeta struct {\n    path     string `json:\"path\"`\n    synopsis string `json:\"synopsis,omitempty\"`\n    count    int    `json:\"import_count,omitempty`\n}\n\n\nfunc main() {\n\n    res := []byte(`{\"results\":[{\"path\":\"4d63.com/randstr/lib/randstr\",\"import_count\":0,\"synopsis\":\"Package randstr generates random strings (e.g.\"},{\"path\":\"bitbucket.org/pcas/tool/mathutil\",\"import_count\":0}]}`)\n    fmt.Println(\"Decoding the JSON\")\n\n    r := bytes.NewReader(res)\n    decoder := json.NewDecoder(r)\n\n    packageimporters := &amp;ImporterResponse{}\n    err := decoder.Decode(packageimporters)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"Packageimporters: %+v\", packageimporters)\n    fmt.Println(len(packageimporters.results))\n}\n</code></pre>\n\n<p>Link to Playground: <a href=\"https://play.golang.org/p/NzLl7Ujo2IJ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/NzLl7Ujo2IJ</a></p>\n\n<p><strong>What I want</strong>:</p>\n\n<ol>\n<li>How to fix this?</li>\n<li>Why is no error message raised if JSON is not parsed properly?</li>\n</ol>\n\n<p>P.S: I understand that this question has been asked before and there are possible solutions available but none of them work for me. Hence, I have made this post.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 7, "last_activity_date": 1514577692, "creation_date": 1514577692, "answer_id": 48027848, "question_id": 48027753, "link": "https://stackoverflow.com/questions/48027753/how-to-verify-if-string-represents-a-hex-number-in-go/48027848#48027848", "title": "How to verify if string represents a hex number in go", "body": "<p>If your goal is to parse the hex digits as a integer or unsigned integer, then call <a href=\"https://godoc.org/strconv#ParseInt\" rel=\"noreferrer\">strconv.ParseInt</a> or <a href=\"https://godoc.org/strconv#ParseUnt\" rel=\"noreferrer\">strconv.ParseUint</a>:</p>\n\n<pre><code>n, err := strconv.ParseUint(s, 16, 64)\nif err != nil {\n    // s is not a valid\n}\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 6353675, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/818bb632fef2c8d74e51aa0791234311?s=128&d=identicon&r=PG&f=1", "display_name": "Ben Lieber", "link": "https://stackoverflow.com/users/6353675/ben-lieber"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2530, "favorite_count": 0, "accepted_answer_id": 48027848, "answer_count": 1, "score": 4, "last_activity_date": 1514577692, "creation_date": 1514577167, "question_id": 48027753, "link": "https://stackoverflow.com/questions/48027753/how-to-verify-if-string-represents-a-hex-number-in-go", "title": "How to verify if string represents a hex number in go", "body": "<p>This mostly works:</p>\n\n<pre><code>import \"encoding/hex\"\n\nfunc isHexString(s string) bool {\n    _, err := hex.DecodeString(s)\n    return err == nil\n}\n</code></pre>\n\n<p>However, we also may want to support odd length hex strings. Checking against hex.ErrLength doesn't work because this error precedes whether the string contains hex characters. I guess could manipulate string to contain the appropriate number of characters and apply both checks but it seems like there should be better way.</p>\n\n<p><a href=\"https://golang.org/pkg/encoding/hex/#DecodeString\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/hex/#DecodeString</a></p>\n"}, {"tags": ["go", "concurrency", "runtime-error"], "answers": [{"comments": [{"owner": {"reputation": 3365, "user_id": 1736884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c85628cff13ad6178dee34c769fa727?s=128&d=identicon&r=PG", "display_name": "Verran", "link": "https://stackoverflow.com/users/1736884/verran"}, "edited": false, "score": 0, "creation_date": 1514576534, "post_id": 48027597, "comment_id": 83025042, "body": "This is indeed the proper way to use scan, but I&#39;d suggest creating the go routines before starting to read, otherwise you may fill up the channel and create a deadlock since nothing is draining it. Also <code>wg.Done()</code> should not be in main."}, {"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1514578537, "post_id": 48027597, "comment_id": 83025799, "body": "Will there be any issues with <code>myfunc</code> taking a byte slice channel whereas the lines channel was declared to take strings?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1514578940, "post_id": 48027597, "comment_id": 83025937, "body": "@veran it won&#39;t deadlock because the scanner is in a separate goroutine. It will sit and wait until the consumers come up. @Dan, byte slices and strings are easily convertible but it does cause an alloc. I went with string because that&#39;s what <code>Scanner.Text()</code> returns."}, {"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1514579219, "post_id": 48027597, "comment_id": 83026045, "body": "@Adrian ok that makes sense. Thank you again for all your time and help."}, {"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1514588900, "post_id": 48027597, "comment_id": 83028836, "body": "@Adrian this works for the first goroutine, but all after the first do not appear to properly iterate over lines for some reason. Not sure why"}, {"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1514589354, "post_id": 48027597, "comment_id": 83028939, "body": "It appears that every goroutine is now receiving the same param even though that loop has not changed. But instead of solving the same one multiple times it solves it the first time but then cannot find the word every time thereafter. The logic here must be wrong somehow."}, {"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "reply_to_user": {"reputation": 3365, "user_id": 1736884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c85628cff13ad6178dee34c769fa727?s=128&d=identicon&r=PG", "display_name": "Verran", "link": "https://stackoverflow.com/users/1736884/verran"}, "edited": false, "score": 0, "creation_date": 1514589412, "post_id": 48027597, "comment_id": 83028955, "body": "@Verran could this be why I&#39;m having the issues that I am? (see above)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514589620, "post_id": 48027597, "comment_id": 83028999, "body": "They&#39;re getting the same parameter because you&#39;re passing a pointer to a loop variable. It changes every iteration, so all routines will end up using the last one. Unless you&#39;re modifying the parameter in the function, there&#39;s no reason to pass a pointer anyway, just pass the value."}, {"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1514590342, "post_id": 48027597, "comment_id": 83029154, "body": "@Adrian this <i>mostly</i> works but still has problems every iteration. I have been passing it the same four paramters over and over and consistently it does not find the word for the last two every time (and which two that is changes with every execution). There is still some logic error in this code where it does not iterate over every word in lines each time or something. Could the file be getting closed prematurely somehow? Or could this be the deadlock Verran referred to above? Is is somehow removing items from lines which could be the problem? Each goroutine needs access to <i>all</i> lines."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514590796, "post_id": 48027597, "comment_id": 83029245, "body": "The deadlock mentioned does not occur with this code, and would manifest as a deadlock, not unexpected behavior. Each line is processed by a single goroutine, the same as your original implementation. If you want every line handled by every routine you&#39;ll need a different implementation."}, {"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1514591527, "post_id": 48027597, "comment_id": 83029396, "body": "Arg... looks like I&#39;m back to square one. Thank you for your help, though!"}, {"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1514593583, "post_id": 48027597, "comment_id": 83029783, "body": "But I do believe this was clear when I wanted to share the scanner by pointer: all goroutines need access to the full file contents."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514597166, "post_id": 48027597, "comment_id": 83030394, "body": "If you share the scanner, each line will go to a goroutine. It only has one internal pointer. Needing to multiplex each line to multiple goroutines is a different problem altogether. It can be done in a similar fashion, with one channel per worker, sending each line from the scanner to all the channels. Just a little more complex."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1514589663, "last_edit_date": 1514589663, "creation_date": 1514576334, "answer_id": 48027597, "question_id": 48027337, "link": "https://stackoverflow.com/questions/48027337/panic-runtime-error-slice-bounds-out-of-range-when-concurrently-running-as-gor/48027597#48027597", "title": "panic: runtime error: slice bounds out of range when concurrently running as goroutine", "body": "<p>Actually after review of the <code>Scan</code> source, it doesn't appear to be thread-safe. You can get around this by having one routine read off of the scanner, and any number of other routines consume lines and process them:</p>\n\n<pre><code>func main() {\n    // ... validate path to file stored in filePath variable\n    filePath := \"/path/to/file.txt\"\n\n    // get word list scanner to be shared between goroutines\n    scanner := getScannerPtr(&amp;filePath)\n    defer scanner.Close()\n\n    // call myfunc() for each param passed\n    var wg sync.WaitGroup\n    ch := make(chan string)\n    lines := make(chan string)\n    go func() {\n        for scanner.Scan() {\n            lines &lt;- scanner.Text()\n        }\n        close(lines)\n    }()\n    for _, param := range os.Args[1:] {\n        wg.Add(1)\n        go myfunc(param, lines, ch)\n        wg.Done()\n    }\n\n    // print results received from channel\n    for range os.Args[1:] {\n        fmt.Println(&lt;-ch)  // print data received from channel ch\n    }\n\n    // don't close scanner until all goroutines are finished\n    wg.Wait()\n}\n\nfunc myfunc(param string, lines chan []byte, ch chan&lt;-string) {\n    for line := range lines {\n        line = strings.TrimSpace(line)\n        // ... do something with line (read only)\n        // ... access shared Sizes map when doing it (read only)\n        ch &lt;- \"some string result goes here\"\n    }\n}\n</code></pre>\n\n<p>Also note that there's no point in <code>defer</code>ing the last line in a function; the whole point of <code>defer</code> is to call it somewhere in the body of the function and know it will be called after the function returns. Since you're using a <code>WaitGroup</code> to prevent the function returning until you're done with your scanner, you can safely defer the close immediately.</p>\n"}], "owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1046, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1514589663, "creation_date": 1514574917, "last_edit_date": 1514576102, "question_id": 48027337, "link": "https://stackoverflow.com/questions/48027337/panic-runtime-error-slice-bounds-out-of-range-when-concurrently-running-as-gor", "title": "panic: runtime error: slice bounds out of range when concurrently running as goroutine", "body": "<p>I'm calling a function as a goroutine and using a WaitGroup to prevent closing a shared Scanner before they all finish. The <code>myfunc()</code> function iterates over a file. I wanted to memory-map this file and share it between all of the goroutines rather than have the I/O chokepoint of reading from disk each time. I was told that this approach would work <a href=\"https://stackoverflow.com/a/48026498/868044\">in an answer to another question.</a> However, while this function worked fine standalone, it's not working concurrently. I am receiving the error:</p>\n\n<pre><code>panic: runtime error: slice bounds out of range\n</code></pre>\n\n<p>but the error is when I call the <code>Scan()</code> method (not on a slice) which is confusing.</p>\n\n<p>Here is a MWE:</p>\n\n<pre><code>// ... package declaration; imports; yada yada\n\n// the actual Sizes map is much more meaningful, this is just for the MWE\nvar Sizes = map[int]string {\n    10: \"Ten\",\n    20: \"Twenty\",\n    30: \"Thirty\",\n    40: \"Forty\",\n}\n\ntype FileScanner struct {\n    io.Closer\n    *bufio.Scanner\n}\n\nfunc main() {\n    // ... validate path to file stored in filePath variable\n    filePath := \"/path/to/file.txt\"\n\n    // get word list scanner to be shared between goroutines\n    scanner := getScannerPtr(&amp;filePath)\n\n    // call myfunc() for each param passed\n    var wg sync.WaitGroup\n    ch := make(chan string)\n    for _, param := range os.Args[1:] {\n        wg.Add(1)\n        go myfunc(&amp;param, scanner, ch)\n        wg.Done()\n    }\n\n    // print results received from channel\n    for range os.Args[1:] {\n        fmt.Println(&lt;-ch)  // print data received from channel ch\n    }\n\n    // don't close scanner until all goroutines are finished\n    wg.Wait()\n    defer scanner.Close()\n}\n\nfunc getScannerPtr(filePath *string) *FileScanner {\n    f, err := os.Open(*filePath)\n    if err != nil {\n        fmt.Fprint(os.Stderr, \"Error opening file\\n\")\n        panic(err)\n    }\n    scanner := bufio.NewScanner(f)\n    return &amp;FileScanner{f, scanner}\n}\n\nfunc myfunc(param *string, scanner *FileScanner, ch chan&lt;-string) {\n    for scanner.Scan() {\n        line := strings.TrimSpace(scanner.Text())\n        // ... do something with line (read only)\n        // ... access shared Sizes map when doing it (read only)\n        ch &lt;- \"some string result goes here\"\n    }\n}\n</code></pre>\n\n<p>I originally thought the issue was concurrent access to the shared Sizes map, but moving it inside <code>myfunc()</code> (and inefficiently redeclaring/redefining it every time) still resulted in the same error, which has to do with calling <code>Scan()</code>. I'm attempting to follow the guidance I received <a href=\"https://stackoverflow.com/a/48026498/868044\">in this answer.</a></p>\n\n<p>Here's the full stack trace of the panic:</p>\n\n<pre><code>panic: runtime error: slice bounds out of range\n\ngoroutine 6 [running]:\nbufio.(*Scanner).Scan(0xc42008a000, 0x80)\n        /usr/local/go/src/bufio/scan.go:139 +0xb3e\nmain.crack(0xc42004c280, 0xc42000a080, 0xc42001c0c0)\n        /Users/dan/go/src/crypto_ctf_challenge/main.go:113 +0x288\ncreated by main.main\n        /Users/dan/go/src/crypto_ctf_challenge/main.go:81 +0x1d8\nexit status 2\n</code></pre>\n\n<p>Line 81 is:</p>\n\n<pre><code>go myfunc(&amp;param, scanner, ch)\n</code></pre>\n\n<p>Line 113 is:</p>\n\n<pre><code>for scanner.Scan() {\n</code></pre>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514573595, "post_id": 48027084, "comment_id": 83023897, "body": "It&#39;s just a struct, try accessing the fields."}, {"owner": {"reputation": 534, "user_id": 548433, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d276aa8879f91bccdcc1bdd46ed8f1b0?s=128&d=identicon&r=PG", "display_name": "Gaurav Manchanda", "link": "https://stackoverflow.com/users/548433/gaurav-manchanda"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514573629, "post_id": 48027084, "comment_id": 83023915, "body": "Tried that, throws an error. The only method available is <code>Error</code>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514573650, "post_id": 48027084, "comment_id": 83023925, "body": "What type is <code>Error</code>? What package is it defined in?"}, {"owner": {"reputation": 534, "user_id": 548433, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d276aa8879f91bccdcc1bdd46ed8f1b0?s=128&d=identicon&r=PG", "display_name": "Gaurav Manchanda", "link": "https://stackoverflow.com/users/548433/gaurav-manchanda"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514573698, "post_id": 48027084, "comment_id": 83023945, "body": "It is an interface type."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1514573746, "post_id": 48027084, "comment_id": 83023966, "body": "If the underlying type is exported by the package that generates the error you can use type assertion."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1514573763, "post_id": 48027084, "comment_id": 83023974, "body": "Then you can use a simple type assertion to coerce it to the underlying type, and then access the fields. But you still need to figure out what the actual type is and what package it&#39;s defined in - &quot;it&#39;s an interface type&quot; doesn&#39;t answer those questions."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514573794, "post_id": 48027084, "comment_id": 83023982, "body": "And if the underlying type is unexported you can use <code>reflect</code> package to get to the <code>Detail</code> field."}, {"owner": {"reputation": 534, "user_id": 548433, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d276aa8879f91bccdcc1bdd46ed8f1b0?s=128&d=identicon&r=PG", "display_name": "Gaurav Manchanda", "link": "https://stackoverflow.com/users/548433/gaurav-manchanda"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514574377, "post_id": 48027084, "comment_id": 83024173, "body": "@Adrian The type of error is <code>*pq.Error</code>. The <code>lib&#47;pq</code> package is being used by <code>gorm</code> internally."}, {"owner": {"reputation": 534, "user_id": 548433, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d276aa8879f91bccdcc1bdd46ed8f1b0?s=128&d=identicon&r=PG", "display_name": "Gaurav Manchanda", "link": "https://stackoverflow.com/users/548433/gaurav-manchanda"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514574402, "post_id": 48027084, "comment_id": 83024182, "body": "@mkopriva Thanks for the suggestion, will try it out. :)"}], "answers": [{"comments": [{"owner": {"reputation": 534, "user_id": 548433, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d276aa8879f91bccdcc1bdd46ed8f1b0?s=128&d=identicon&r=PG", "display_name": "Gaurav Manchanda", "link": "https://stackoverflow.com/users/548433/gaurav-manchanda"}, "edited": false, "score": 0, "creation_date": 1514578031, "post_id": 48027275, "comment_id": 83025627, "body": "This works when I explicitly import the <code>github.com&#47;lib&#47;pq</code> package. The same package is imported as a side effect in the <code>gorm</code> package. Would the same type be available via <code>gorm</code>, or I will have to import the <code>lib&#47;pq</code> package?"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 2, "last_activity_date": 1514574534, "creation_date": 1514574534, "answer_id": 48027275, "question_id": 48027084, "link": "https://stackoverflow.com/questions/48027084/convert-error-to-map-or-struct/48027275#48027275", "title": "Convert error to map or struct", "body": "<p>Assert it to <code>pq.Error</code> and access the fields <a href=\"https://godoc.org/github.com/lib/pq#hdr-Errors\" rel=\"nofollow noreferrer\">as explained in the <code>pq</code> docs</a>:</p>\n\n<pre><code>if err, ok := err.(*pq.Error); ok {\n    fmt.Println(\"pq error:\", err.Code.Name())\n    // Or whatever other field(s) you need\n}\n</code></pre>\n\n<p>The <a href=\"https://godoc.org/github.com/lib/pq#Error\" rel=\"nofollow noreferrer\">full type is also documented</a>.</p>\n"}], "owner": {"reputation": 534, "user_id": 548433, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d276aa8879f91bccdcc1bdd46ed8f1b0?s=128&d=identicon&r=PG", "display_name": "Gaurav Manchanda", "link": "https://stackoverflow.com/users/548433/gaurav-manchanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 720, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1514574534, "creation_date": 1514573507, "question_id": 48027084, "link": "https://stackoverflow.com/questions/48027084/convert-error-to-map-or-struct", "title": "Convert error to map or struct", "body": "<p>Just started with Go and currently trying to create a REST API. Using <code>gorm</code> &amp; <code>gin</code> to do the same. Where am stuck is, am trying to fetch a value from the <code>error</code> object, but am not able to do that in a straight forward way.</p>\n\n<p>The <code>error</code> type, if I know correctly, just hasa an <code>Error</code> method available, which gives whatever is in the <code>Message</code> part of the object. This is the error object I have.</p>\n\n<pre><code>{\n    \"Severity\": \"ERROR\",\n    \"Code\": \"23505\",\n    \"Message\": \"duplicate key value violates unique constraint \\\"uix_users_email\\\"\",\n    \"Detail\": \"Key (email)=(johndoe@gmail.com) already exists.\",\n    \"Hint\": \"\",\n    \"Position\": \"\",\n    \"InternalPosition\": \"\",\n    \"InternalQuery\": \"\",\n    \"Where\": \"\",\n    \"Schema\": \"public\",\n    \"Table\": \"users\",\n    \"Column\": \"\",\n    \"DataTypeName\": \"\",\n    \"Constraint\": \"uix_users_email\",\n    \"File\": \"nbtinsert.c\",\n    \"Line\": \"433\",\n    \"Routine\": \"_bt_check_unique\"\n}\n</code></pre>\n\n<p>Now, what I want to do is, access the <code>Detail</code> key, and am a bit confused. This is what I have currently done to be able to achieve this:</p>\n\n<pre><code>if err := a.DB.Create(&amp;user).Error; err != nil {\n    val, _ := json.Marshal(err)\n    m := make(map[string]string)\n    json.Unmarshal(val, &amp;m)\n    context.JSON(422, gin.H{\"error\": m[\"Detail\"]})\n    return\n}\n</code></pre>\n\n<p>But this seems like an overkill. I have to <code>Marshal</code> the error, then <code>Unmarshal</code> it into a map &amp; then finally use it.</p>\n\n<p>Is there a simpler way to do this?</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-sql", "google-cloud-trace"], "answers": [{"comments": [{"owner": {"reputation": 3220, "user_id": 102940, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e342eb049bb0f2d5a21ce2408c67dd25?s=128&d=identicon&r=PG", "display_name": "Soe Moe", "link": "https://stackoverflow.com/users/102940/soe-moe"}, "edited": false, "score": 0, "creation_date": 1519109128, "post_id": 48032733, "comment_id": 84762570, "body": "As per doc, I think it is not supported in standard edition. <code>On Google App Engine standard environment, the trace package is not currently supported.</code>"}], "tags": [], "owner": {"reputation": 2933, "user_id": 3465318, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/039c44d45fc59dcd6f6624c67b9f4932?s=128&d=identicon&r=PG&f=1", "display_name": "QuestionAndAnswer", "link": "https://stackoverflow.com/users/3465318/questionandanswer"}, "is_accepted": false, "score": 2, "last_activity_date": 1514627087, "creation_date": 1514627087, "answer_id": 48032733, "question_id": 48026846, "link": "https://stackoverflow.com/questions/48026846/is-there-any-way-to-trace-cloud-sql-calls-in-app-engine-golang/48032733#48032733", "title": "Is there any way to trace Cloud SQL calls in App Engine? (Golang)", "body": "<p><a href=\"https://cloud.google.com/trace/docs/setup/go\" rel=\"nofollow noreferrer\">https://cloud.google.com/trace/docs/setup/go</a></p>\n\n<p>This is a default tracing library from google. In our app it's logging number of actions in the app, like calls to log writes, calls to Datastore and to SQL as well. Just install it and go to Trace in Cloud Console. Make an request to your endpoint, and you will see in this Trace tab information about the request and it's components. You also will be able to manually add custom tracing events (some custom logic execution time of which you want to trace).</p>\n"}], "owner": {"reputation": 3220, "user_id": 102940, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e342eb049bb0f2d5a21ce2408c67dd25?s=128&d=identicon&r=PG", "display_name": "Soe Moe", "link": "https://stackoverflow.com/users/102940/soe-moe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1523019813, "creation_date": 1514572178, "last_edit_date": 1523019813, "question_id": 48026846, "link": "https://stackoverflow.com/questions/48026846/is-there-any-way-to-trace-cloud-sql-calls-in-app-engine-golang", "title": "Is there any way to trace Cloud SQL calls in App Engine? (Golang)", "body": "<p>As title suggests, I would like to trace Cloud SQL calls in App Engine (Golang) Standard Environment.</p>\n\n<p>I found that there is <a href=\"https://stackoverflow.com/questions/40002975/is-there-any-way-to-trace-cloud-sql-calls-in-app-engine\">Java library</a> for that.  Is there anything like that for Golang?</p>\n"}, {"tags": ["go", "file-io", "goroutine"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514571104, "post_id": 48026595, "comment_id": 83022992, "body": "The output of the deadlock error should tell you exactly what line each goroutine is stuck on, which should help you to figure out why this is happening."}, {"owner": {"reputation": 4671, "user_id": 4927751, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VwUAi.jpg?s=128&g=1", "display_name": "Kshitij Saraogi", "link": "https://stackoverflow.com/users/4927751/kshitij-saraogi"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514571430, "post_id": 48026595, "comment_id": 83023088, "body": "@Adrian Thanks for replying. As of now, I have figured out that the issue is related to the complete execution of the <code>GetLine</code> goroutine while the <code>select</code> statement still expects to receive a value. Thus, this error is raised. Am I right?"}], "answers": [{"comments": [{"owner": {"reputation": 4671, "user_id": 4927751, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VwUAi.jpg?s=128&g=1", "display_name": "Kshitij Saraogi", "link": "https://stackoverflow.com/users/4927751/kshitij-saraogi"}, "edited": false, "score": 0, "creation_date": 1514572642, "post_id": 48026820, "comment_id": 83023490, "body": "Thanks a lot! TIL: <code>break</code> can be used to break out of a <code>select</code> statement in Go. Is there an alternative to using label here? Any idiomatic Go pattern?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 4671, "user_id": 4927751, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VwUAi.jpg?s=128&g=1", "display_name": "Kshitij Saraogi", "link": "https://stackoverflow.com/users/4927751/kshitij-saraogi"}, "edited": false, "score": 0, "creation_date": 1514573513, "post_id": 48026820, "comment_id": 83023858, "body": "@KshitijSaraogi You can avoid having to use labels if you put the <code>for</code> statement into a function (which may be a function literal), and use <code>return</code> instead of <code>break loop</code>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1514573594, "post_id": 48026820, "comment_id": 83023895, "body": "The label is the idiomatic way to break out of a <code>for { select { } }</code>.  The code can be restructured to avoid the <code>for { select { } }</code> and therefore avoid the label. See updated answer."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1514573633, "last_edit_date": 1514573633, "creation_date": 1514572047, "answer_id": 48026820, "question_id": 48026595, "link": "https://stackoverflow.com/questions/48026595/reading-a-file-line-by-line-with-concurrency/48026820#48026820", "title": "Reading a file line-by-line with concurrency", "body": "<p>The break statement in a select breaks out of the select. The application must break out of the for loop when done. Use a label to break out of the for loop:</p>\n\n<pre><code>loop:\n    for {\n        select {\n        case name := &lt;-names:\n            // Process each line\n            fmt.Println(name)\n\n        case err := &lt;-readerr:\n            log.Fatal(err)\n\n        case &lt;-done:\n            // close(names)\n            // close(readerr)\n            break loop\n        }\n    }\n</code></pre>\n\n<p>The code can be simplified by eliminating the done channel.</p>\n\n<pre><code>func main() {\n\n    filename := flag.String(\"filename\", \"\", \"The file to parse\")\n    flag.Parse()\n\n    if *filename == \"\" {\n        log.Fatal(\"Provide a file to parse\")\n    }\n\n    fmt.Println(\"Getting file\")\n\n    names := make(chan string)\n    readerr := make(chan error)\n\n    go GetLine(*filename, names, readerr)\n\nloop:\n    for {\n        select {\n        case name := &lt;-names:\n            // Process each line\n            fmt.Println(name)\n\n        case err := &lt;-readerr:\n            if err != nil {\n                log.Fatal(err)\n            }\n            break loop\n        }\n    }\n\n    fmt.Println(\"Processing Complete\")\n}\n\nfunc GetLine(filename string, names chan string, readerr chan error) {\n    file, err := os.Open(filename)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer file.Close()\n\n    scanner := bufio.NewScanner(file)\n    for scanner.Scan() {\n        names &lt;- scanner.Text()\n    }\n    readerr &lt;- scanner.Err()\n}\n</code></pre>\n\n<p>In this specific example, the code can be restructured to separate receiving names from receiving the error.</p>\n\n<pre><code>func main() {\n    filename := flag.String(\"filename\", \"\", \"The file to parse\")\n    flag.Parse()\n\n    if *filename == \"\" {\n        log.Fatal(\"Provide a file to parse\")\n    }\n\n    fmt.Println(\"Getting file\")\n\n    names := make(chan string)\n    readerr := make(chan error)\n\n    go GetLine(*filename, names, readerr)\n\n    for name := range names {\n        fmt.Println(name)\n    }\n    if err := &lt;-readerr; err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(\"Processing Complete\")\n}\n\nfunc GetLine(filename string, names chan string, readerr chan error) {\n    file, err := os.Open(filename)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer file.Close()\n\n    scanner := bufio.NewScanner(file)\n    for scanner.Scan() {\n        names &lt;- scanner.Text()\n    }\n    close(names) // close causes range on channel to break out of loop\n    readerr &lt;- scanner.Err()\n}\n</code></pre>\n"}], "owner": {"reputation": 4671, "user_id": 4927751, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VwUAi.jpg?s=128&g=1", "display_name": "Kshitij Saraogi", "link": "https://stackoverflow.com/users/4927751/kshitij-saraogi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1214, "favorite_count": 2, "accepted_answer_id": 48026820, "answer_count": 1, "score": 2, "last_activity_date": 1580406616, "creation_date": 1514570871, "last_edit_date": 1580406616, "question_id": 48026595, "link": "https://stackoverflow.com/questions/48026595/reading-a-file-line-by-line-with-concurrency", "title": "Reading a file line-by-line with concurrency", "body": "<p><strong>What I Want To Do</strong>  </p>\n\n<p>In <code>GetLine</code>, I am trying to parse a file line-by-line using <code>bufio.Scanner</code> and a naive attempt at concurrency.\nFollowing fetching the text in each line, I am sending it via a channel of <code>string</code> to the caller(<code>main</code> function). Along with the value, I am also sending errors and completion flag(via <code>done</code> channel). Thus, this should be able to fetch a new line to process in a separate goroutine while the current line is processed.</p>\n\n<p><strong>What I Have Actually Done</strong></p>\n\n<pre><code>var READCOMPLETE = errors.New(\"Completed Reading\")\n\nfunc main() {\n\n    filename := flag.String(\"filename\", \"\", \"The file to parse\")\n    flag.Parse()\n\n    if *filename == \"\" {\n        log.Fatal(\"Provide a file to parse\")\n    }\n\n    fmt.Println(\"Getting file\")\n\n    names := make(chan string)\n    readerr := make(chan error)\n    done := make(chan bool)\n\n    go GetLine(*filename, names, readerr, done)\n\n    for {\n        select {\n        case name := &lt;-names:\n            // Process each line\n            fmt.Println(name)\n\n        case err := &lt;-readerr:\n            log.Fatal(err)\n\n        case &lt;-done:\n            // close(names)\n            // close(readerr)\n            break\n        }\n    }\n\n    fmt.Println(\"Processing Complete\")\n}\n\nfunc GetLine(filename string, names chan string, readerr chan error, done chan bool) {\n    file, err := os.Open(filename)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer file.Close()\n\n    scanner := bufio.NewScanner(file)\n    for scanner.Scan() {\n        names &lt;- scanner.Text()\n        //fmt.Println(scanner.Text())\n    }\n\n    if err := scanner.Err(); err != nil {\n        readerr &lt;- err\n    }\n\n    done &lt;- true\n}\n</code></pre>\n\n<p><strong>What I Get on Running</strong></p>\n\n<p>Runtime Error: <code>fatal error: all goroutines are asleep - deadlock!</code></p>\n\n<p><strong>What have I Tried to Fix?</strong></p>\n\n<p>After reading <a href=\"https://stackoverflow.com/a/12400826/4927751\">this</a> answer about the error message, I tried closing the channels <code>names</code> and <code>readerr</code> in the last clause of the <code>select</code> statement as shown in the comments. However, the program still crashes with a log message. I am unable to fix it further and would appreciate any help.<br>\nResources for learning are welcome.</p>\n\n<p>P.S: I am relatively new to GoLang and still learning how to work with the CSP model of concurrency in Go. Infact, this is my first attempt at writing a synchronous concurrent program.</p>\n"}, {"tags": ["go", "concurrency", "memory-mapped-files"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514570172, "post_id": 48026422, "comment_id": 83022632, "body": "Yes it&#39;s valid. Are you absolutely certain there&#39;s data in the file at <code>filePath</code>? Also note that <code>scanner.Split(bufio.ScanLines)</code> is unnecessary, as that is the default <code>SplitFunc</code> for <code>Scanner</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514570275, "post_id": 48026422, "comment_id": 83022671, "body": "Nevermind, just saw the issue &amp; posted answer. The note on <code>SplitFunc</code> is still valid though."}], "answers": [{"comments": [{"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1514570430, "post_id": 48026498, "comment_id": 83022740, "body": "So this code actually worked before I tried passing scanner as a pointer, to include with the <code>defer f.Close()</code> statement. I was under the impression that by that time the file was already in memory? (Obviously I&#39;m confused, just trying to learn Go)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 1, "creation_date": 1514570541, "post_id": 48026498, "comment_id": 83022792, "body": "No, the file is not in memory. <code>Scanner</code> reads the file into a buffer, but only a limited amount of bytes, and not until <code>Scan</code> is called."}, {"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1514570573, "post_id": 48026498, "comment_id": 83022805, "body": "Aha, that makes sense. I&#39;ll give this a whirl then accept if it works out. Thank you!"}, {"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1514570984, "post_id": 48026498, "comment_id": 83022960, "body": "Well now it is iterating over the file so that part of this is resolved! (But unfortunately it is not working like before, arg -- on to the next bug...). Thanks!"}, {"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1514571077, "post_id": 48026498, "comment_id": 83022981, "body": "Just to clarify, though, wouldn&#39;t I not want to call close until all of the goroutines have finished? And thus I would not want it inside <code>myfunc()</code>, but rather inside <code>main()</code>? My intention is to call <code>go myfunc()</code> multiple times."}, {"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1514571390, "post_id": 48026498, "comment_id": 83023080, "body": "I moved it to after each call in <code>main()</code> and that solved it. Thanks again"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 1, "creation_date": 1514571571, "post_id": 48026498, "comment_id": 83023133, "body": "Yeah, if they&#39;re sharing a scanner, you want the <code>Close</code> outside the goroutines. Just make sure you use a <code>WaitGroup</code> so you don&#39;t close it until they&#39;re all done with it."}, {"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1514575872, "post_id": 48026498, "comment_id": 83024774, "body": "So I&#39;m actually getting a panic runtime error about <code>slice bounds out of range</code> when I try to call <code>Scan()</code> concurrently. See <a href=\"https://stackoverflow.com/q/48027337/868044\">this question</a> for more details and please let me know if I did not implement this as you had intended. I&#39;m still learning."}, {"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1514577119, "post_id": 48026498, "comment_id": 83025266, "body": "This answer still has my upvote as helpful, but I&#39;ve unmarked it as accepted because <a href=\"https://stackoverflow.com/a/48027597/868044\">the answer is not correct.</a>"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 5, "last_activity_date": 1514570238, "creation_date": 1514570238, "answer_id": 48026498, "question_id": 48026422, "link": "https://stackoverflow.com/questions/48026422/passing-a-pointer-to-bufio-scanner/48026498#48026498", "title": "Passing a pointer to bufio.Scanner()", "body": "<p>You're closing the file before you ever use the <code>Scanner</code>:</p>\n\n<pre><code>func getScannerPtr(filePath *string) *bufio.Scanner {\n    f, err := os.Open(*filePath)\n    if err != nil {\n        fmt.Fprint(os.Stderr, \"Error opening file\\n\")\n        panic(err)\n    }\n    defer f.Close() // &lt;--- Here\n    scanner := bufio.NewScanner(f)\n    scanner.Split(bufio.ScanLines)\n    return scanner // &lt;-- File gets closed, then Scanner that tries to read it is returned for further use, which won't work\n}\n</code></pre>\n\n<p>Because <code>Scanner</code> does not expose <code>Close</code>, you'll need to work around this; the quickest is probably to make a simple custom type with a couple of embedded fields:</p>\n\n<pre><code>type FileScanner struct {\n    io.Closer\n    *bufio.Scanner\n}\n\nfunc getScannerPtr(filePath *string) *FileScanner  {\n    f, err := os.Open(*filePath)\n    if err != nil {\n        fmt.Fprint(os.Stderr, \"Error opening file\\n\")\n        panic(err)\n    }\n    scanner := bufio.NewScanner(f)\n    return &amp;FileScanner{f, scanner}\n}\n\nfunc myfunc(scanner *FileScanner) {\n    defer scanner.Close()\n    for scanner.Scan() {\n        line := strings.TrimSpace(scanner.Text())\n        // ... do something with line\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 891, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1514570238, "creation_date": 1514569812, "question_id": 48026422, "link": "https://stackoverflow.com/questions/48026422/passing-a-pointer-to-bufio-scanner", "title": "Passing a pointer to bufio.Scanner()", "body": "<p>Lest I provide <a href=\"http://xyproblem.info/\" rel=\"nofollow noreferrer\">an XY problem</a>, my goal is to share a memory-mapped file between multiple goroutines <a href=\"https://softwareengineering.stackexchange.com/a/363108/47835\">as recommended</a>. Each goroutine needs to iterate over the file line by line so I had hoped to store the complete contents in memory first to speed things up. </p>\n\n<p>The method I tried is passing a pointer to a <code>bufio.Scanner</code>, but that is not working. I thought it might be related to needing to set the seek position back to the beginning of the file but it is not even working the very first time and I can find no such parameter in the documentation. My attempt was to create this function then pass the result by reference to the function I intend to run in a goroutine (<strong>for right now, I am <em>not</em> using goroutines</strong> just to make sure this works outright, which it does not).</p>\n\n<p>Here is a MWE:</p>\n\n<pre><code>// ... package declaration; imports; yada yada\n\nfunc main() {\n    // ... validate path to file stored in filePath variable\n    filePath := \"/path/to/file.txt\"\n\n    // get word list scanner to be shared between goroutines\n    scanner := getScannerPtr(&amp;filePath)\n\n    // pass to function (no goroutine for now, I try to solve one problem at a time)\n    myfunc(scanner)\n}\n\nfunc getScannerPtr(filePath *string) *bufio.Scanner {\n    f, err := os.Open(*filePath)\n    if err != nil {\n        fmt.Fprint(os.Stderr, \"Error opening file\\n\")\n        panic(err)\n    }\n    defer f.Close()\n    scanner := bufio.NewScanner(f)\n    scanner.Split(bufio.ScanLines)\n    return scanner\n}\n\nfunc myfunc(scanner *bufio.Scanner) {\n    for scanner.Scan() {\n        line := strings.TrimSpace(scanner.Text())\n        // ... do something with line\n    }\n}\n</code></pre>\n\n<p>I'm not receiving any errors, it just is not iterating over the file when I call <code>Scan()</code> so it never makes it inside that block to do anything with each line of the file. Keep in mind I am not even using concurrency yet, that is just my eventual goal which I want to point out in case that impacts the method I need to take. </p>\n\n<ul>\n<li>Why is <code>Scan()</code> not working?</li>\n<li>Is this is a viable approach if I intend to call <code>go myfunc(scanner)</code> in the future?</li>\n</ul>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1514564491, "post_id": 48025378, "comment_id": 83020245, "body": "Well, you&#39;re already encoding to JSON, which is output as a <code>[]byte</code>. You could just store that. Plus you get the added benefit of not having to decode/encode on every cache hit, just serve the data straight out of cache. You could also use the built-in <a href=\"https://golang.org/pkg/encoding/gob/\" rel=\"nofollow noreferrer\"><code>gob</code> package</a>."}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514565150, "post_id": 48025378, "comment_id": 83020545, "body": "I guess <code>response</code> should be encoded using <code>encodedJson, err := json.Marshal(response)</code>? and then <code>w.Write(encodedJson)</code>?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514565400, "post_id": 48025378, "comment_id": 83020650, "body": "Correct. Then you can write the same payload to your cache."}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514565433, "post_id": 48025378, "comment_id": 83020669, "body": "@Adrian just tested, it works :).. thanks a lot &lt;3.. I want to close thread and accept your comment as answer"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514566081, "post_id": 48025378, "comment_id": 83020931, "body": "Reposted as answer."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1514566075, "creation_date": 1514566075, "answer_id": 48025712, "question_id": 48025378, "link": "https://stackoverflow.com/questions/48025378/storing-mapstringinterface-data-in-diskv-value-field-expected-byte-for-c/48025712#48025712", "title": "storing map[string]interface{} data in diskv value field (expected []byte) for caching http requests", "body": "<p>Well, you're already encoding to JSON, which is output as a []byte. You could just store that. Plus you get the added benefit of not having to decode/encode on every cache hit, just serve the data straight out of cache:</p>\n\n<pre><code>if cached, ok := getFromCache(id); ok {\n    response.Write(cached)\n    return\n}\nresponse[\"status\"] = true\nresponse[\"token\"] = someTokenString\nresponse[\"data\"] = someStructSlice // etc\npayload, err := json.Marshall(response)\nsaveToCache(payload, id)\nresponse.Write(payload)\n</code></pre>\n\n<p>You could also use the built-in <a href=\"https://golang.org/pkg/encoding/gob/\" rel=\"nofollow noreferrer\"><code>gob</code> package</a>, which is more efficient but more prone to breaking if the data model changes.</p>\n"}], "owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 48025712, "answer_count": 1, "score": -1, "last_activity_date": 1514566075, "creation_date": 1514564336, "question_id": 48025378, "link": "https://stackoverflow.com/questions/48025378/storing-mapstringinterface-data-in-diskv-value-field-expected-byte-for-c", "title": "storing map[string]interface{} data in diskv value field (expected []byte) for caching http requests", "body": "<p>I'm trying to write my own httpcache; I suspect I'm doing it the wrong way, but this is my approach:</p>\n\n<p>My responses look like this:</p>\n\n<pre><code>response := make(map[string]interface{})\nw.WriteHeader(http.StatusOK)\nresponse[\"status\"] = true\nresponse[\"token\"] = someTokenString\nresponse[\"data\"] = someStructSlice // etc\njson.NewEncoder(w).Encode(response)\n</code></pre>\n\n<p>My plan now is to use <a href=\"https://github.com/peterbourgon/diskv\" rel=\"nofollow noreferrer\">https://github.com/peterbourgon/diskv</a> where I set key equal to URL Path (+ username/token whenever necessary). And then put the value equal to the response data.</p>\n\n<p>Problem is I'm not sure how I should store this data. dickv expects the data to be type <code>[]byte</code>, whereas my response data is type <code>map[string]interface {}</code>..</p>\n\n<p>Before I begin to try to figure out how to convert it, I figured I'd ask the experts here if I'm even using the right approach. And if I am, is there a simple way to store <code>response</code> in the dickv value (type <code>[]byte</code>)?</p>\n"}, {"tags": ["go", "hyperledger-fabric", "hyperledger"], "answers": [{"tags": [], "owner": {"reputation": 653, "user_id": 8195263, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CGJTY.png?s=128&g=1", "display_name": "jworthington", "link": "https://stackoverflow.com/users/8195263/jworthington"}, "is_accepted": true, "score": 3, "last_activity_date": 1514655935, "creation_date": 1514655935, "answer_id": 48036385, "question_id": 48025007, "link": "https://stackoverflow.com/questions/48025007/deleting-chaincode-from-peer/48036385#48036385", "title": "Deleting ChainCode from peer", "body": "<ol>\n<li><p>Depends on what you mean by mistake / debug. You should make sure it compiles first. That eliminates all typos, syntax, missing libraries, etc. But there is no way to debug functionality except to install and instantiate.</p></li>\n<li><p>Technically, no. You can delete all the storage (/var/hyperledger/production/peer, /var/hyperledger/production/orderer, the kafka/zookeeper files, and CouchDB). Not a real big deal, but you do have to restart the network and recreate the channel, join it, install and instantiate the cc, etc. But you can install as a different name. Just change the name in your app connection definition to match. You can also upgrade by changing the version number but keeping the same name. </p></li>\n</ol>\n\n<p>I just change the name until I get to a fairly settled spot and then do the deletes and restart all to clean up. A full cleanup (4 peers, 3 orderers, 4 kafka,3 zoopkeeper) takes me maybe 30 minutes. Normally, I keep a CLI open with install ccname1 and instantiate ccname1 in the buffer and can easily increment to ccname2,3,4,5. It only takes a few seconds that way. </p>\n"}, {"tags": [], "owner": {"reputation": 94, "user_id": 8970447, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PuIh_JfwAPE/AAAAAAAAAAI/AAAAAAAABdA/27GUuXt-gW8/photo.jpg?sz=128", "display_name": "Pranith Baggan", "link": "https://stackoverflow.com/users/8970447/pranith-baggan"}, "is_accepted": false, "score": 0, "last_activity_date": 1529649509, "creation_date": 1529649509, "answer_id": 50982051, "question_id": 48025007, "link": "https://stackoverflow.com/questions/48025007/deleting-chaincode-from-peer/50982051#50982051", "title": "Deleting ChainCode from peer", "body": "<p><strong>If the error is (chaincode is already present in the peers)</strong> </p>\n\n<p>You can try installing the chain code with different version number or different chain code name.</p>\n\n<p>You can initiate chaincode in the channel only once. Next time you have to follow the procedure of upgrade chaincode steps.</p>\n\n<p><strong>Note</strong> : Before installing chain code you can check the syntax errors form the machine by installing go and compile the chain code. </p>\n"}], "owner": {"reputation": 2066, "user_id": 6363050, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f9db389fc3801b8ecef05ed3074e2f03?s=128&d=identicon&r=PG&f=1", "display_name": "Samuel Dare", "link": "https://stackoverflow.com/users/6363050/samuel-dare"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1340, "favorite_count": 1, "accepted_answer_id": 48036385, "answer_count": 2, "score": 2, "last_activity_date": 1529649509, "creation_date": 1514562445, "question_id": 48025007, "link": "https://stackoverflow.com/questions/48025007/deleting-chaincode-from-peer", "title": "Deleting ChainCode from peer", "body": "<p>I made a mistake my chaincode and installed them on the peers on my network. When I tried to instantiate the chaincode in the channels, I found the error. </p>\n\n<ol>\n<li>Is there a way to debug chaincode before installing it on peers ? It seems to only get flagged when you instantiate it.</li>\n<li>Is there a way to delete the chaincode from the peers without having to restart the network?</li>\n</ol>\n"}, {"tags": ["go", "bit-manipulation", "uint16"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1514556416, "post_id": 48023473, "comment_id": 83016793, "body": "A minor nitpick: Go does not have type casting; it rather has type conversions."}], "answers": [{"comments": [{"owner": {"reputation": 393, "user_id": 5280049, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/76cd5faedffead4a624bcade23a694ce?s=128&d=identicon&r=PG&f=1", "display_name": "Devligue", "link": "https://stackoverflow.com/users/5280049/devligue"}, "edited": false, "score": 1, "creation_date": 1514555239, "post_id": 48023533, "comment_id": 83016227, "body": "I have tried it in a bit different form <code>fmt.Println(int16(uint16(0xFFFE)))</code> and it throws overflow error. Why does it work in your example then?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 393, "user_id": 5280049, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/76cd5faedffead4a624bcade23a694ce?s=128&d=identicon&r=PG&f=1", "display_name": "Devligue", "link": "https://stackoverflow.com/users/5280049/devligue"}, "edited": false, "score": 2, "creation_date": 1514555446, "post_id": 48023533, "comment_id": 83016344, "body": "@Devlige Because constant values can only be converted if the type can represent the exact value. In my example I am not converting a constant but a variable, where overflow is allowed (just like in any other language). For an explanation in great details, please check: <a href=\"https://stackoverflow.com/questions/39444852/does-go-compilers-evaluation-differ-for-constant-expression-and-other-expressio/39445372#39445372\">Does go compiler&#39;s evaluation differ for constant expression and other expression</a>"}, {"owner": {"reputation": 393, "user_id": 5280049, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/76cd5faedffead4a624bcade23a694ce?s=128&d=identicon&r=PG&f=1", "display_name": "Devligue", "link": "https://stackoverflow.com/users/5280049/devligue"}, "edited": false, "score": 0, "creation_date": 1514556323, "post_id": 48023533, "comment_id": 83016754, "body": "Perfect! In conclusion Go is nice indeed. It just requires a bit more knowledge :) Thank you"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1514556399, "post_id": 48023533, "comment_id": 83016788, "body": "@kostix Just when I wanted to post the link. That link contains the &quot;more knowledge&quot; regarding constants."}, {"owner": {"reputation": 11904, "user_id": 608395, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/624618628f058b51b353c2e0d4735733?s=128&d=identicon&r=PG", "display_name": "andig", "link": "https://stackoverflow.com/users/608395/andig"}, "edited": false, "score": 0, "creation_date": 1539089772, "post_id": 48023533, "comment_id": 92368322, "body": "Seems this is only possible with vars, if writte as one-liner it fails: constant 65534 overflows int16"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1514556316, "last_edit_date": 1514556316, "creation_date": 1514554943, "answer_id": 48023533, "question_id": 48023473, "link": "https://stackoverflow.com/questions/48023473/proper-way-for-casting-uint16-to-int16-in-go/48023533#48023533", "title": "Proper way for casting uint16 to int16 in Go", "body": "<p>But what you want works, \"Go is nice\":</p>\n\n<pre><code>ui := uint16(0xFFFE)\nfmt.Println(ui)\ni := int16(ui)\nfmt.Println(i)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/z1vFjFRUVii\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>65534\n-2\n</code></pre>\n\n<p><code>int16(0xFFFE)</code> doesn't work because <code>0xfffe</code> is an untyped integer constant which cannot be represented by a value of type <code>int16</code>, that's why the the compiler complains. But you can certainly convert any <code>uint16</code> non-constant value to <code>int16</code>.</p>\n\n<p>See possible duplicates:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/34704843/golang-on-purpose-int-overflow/34704898#34704898\">Golang: on-purpose int overflow</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/39444852/does-go-compilers-evaluation-differ-for-constant-expression-and-other-expressio/39445372#39445372\">Does go compiler&#39;s evaluation differ for constant expression and other expression</a></p>\n"}], "owner": {"reputation": 393, "user_id": 5280049, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/76cd5faedffead4a624bcade23a694ce?s=128&d=identicon&r=PG&f=1", "display_name": "Devligue", "link": "https://stackoverflow.com/users/5280049/devligue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1512, "favorite_count": 0, "accepted_answer_id": 48023533, "answer_count": 1, "score": 2, "last_activity_date": 1514714296, "creation_date": 1514554648, "last_edit_date": 1514714296, "question_id": 48023473, "link": "https://stackoverflow.com/questions/48023473/proper-way-for-casting-uint16-to-int16-in-go", "title": "Proper way for casting uint16 to int16 in Go", "body": "<p>Bitwise manipulation and Go newbie here :D I am reading some data from sensor with Go and I get it as 2 bytes - let's say <code>0xFFFE</code>. It is easy too cast it to uint16 since in Go we can just do <code>uint16(0xFFFE)</code> but what I need is to convert it to integer, because the sensor returns in fact values in range from -32768 to 32767. Now I thought <em>\"Maybe Go will be this nice and if I do <code>int16(0xFFFE)</code> it will understand what I want?\"</em>, but no. I ended up using following solution (I translated some python code from web):</p>\n\n<pre><code>x := 0xFFFE\n\nif (x &amp; (1 &lt;&lt; 15)) != 0 {\n    x = x - (1&lt;&lt;16)\n}\n</code></pre>\n\n<p>It seems to work, but A) I am not entirely sure why, and B) It looks a bit ugly to what I imagined should be a trivial solution for casting uint16 to int16. Could anyone give me a hand and clarify why this is only way to do this? Or is there any other possible way?</p>\n"}, {"tags": ["go", "facebook-opengraph"], "answers": [{"comments": [{"owner": {"reputation": 435, "user_id": 3997690, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Ru3Xg.png?s=128&g=1", "display_name": "LaX", "link": "https://stackoverflow.com/users/3997690/lax"}, "edited": false, "score": 0, "creation_date": 1514557654, "post_id": 48024021, "comment_id": 83017244, "body": "I need the file to be a direct download to avoid breaking other parts of the app where it will just open the file as a video/music/image file accordingly. I&#39;ll try giving a go at the user-agent solution."}], "tags": [], "owner": {"reputation": 639, "user_id": 896285, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eaedcd2540ecda257aff1d55b21e97fc?s=128&d=identicon&r=PG", "display_name": "Jonathan M. Hethey", "link": "https://stackoverflow.com/users/896285/jonathan-m-hethey"}, "is_accepted": true, "score": 1, "last_activity_date": 1514557314, "creation_date": 1514557314, "answer_id": 48024021, "question_id": 48023460, "link": "https://stackoverflow.com/questions/48023460/how-to-use-open-graph-on-non-html-pages/48024021#48024021", "title": "How to use Open Graph on non-html pages", "body": "<p>I suggest not linking the direct file, but having an actual download page for them, so that the file is not linked directly, but its download page.</p>\n\n<p>On the download page you could then implement the appropriate share buttons and initiate the download through a bit of JavaScript.</p>\n\n<p>Alternatively you could inspect if a bot (like facebook, telegram, skype, etc) is visiting the files location and then display the appropriate open graph or twitter headers.</p>\n\n<p>Example of a user agent parser: <a href=\"https://github.com/mssola/user_agent\" rel=\"nofollow noreferrer\">https://github.com/mssola/user_agent</a></p>\n"}], "owner": {"reputation": 435, "user_id": 3997690, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Ru3Xg.png?s=128&g=1", "display_name": "LaX", "link": "https://stackoverflow.com/users/3997690/lax"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 48024021, "answer_count": 1, "score": -1, "last_activity_date": 1514557314, "creation_date": 1514554601, "question_id": 48023460, "link": "https://stackoverflow.com/questions/48023460/how-to-use-open-graph-on-non-html-pages", "title": "How to use Open Graph on non-html pages", "body": "<p>I'm building an app where users can share download links to files. These files are served using <code>golang</code>'s <code>http.ServeContent</code>, so they are sent as is, without any HTML. However, when these files are shared on social media platforms or a messaging service, I want to be able to display an image \u00e0-la Open Graph.</p>\n\n<p>Is it possible to have Open Graph metadata tags show up for these non-HTML pages? </p>\n\n<p>If it's not, is there any way to embed this content in an HTML5 page while still triggering a download of the file (and not the HTML page) when used with something like, e.g., <code>curl</code>?</p>\n\n<p>Follow up question if none of these are possible, is there anything else I could use to have an image and a title show up when my link is shared?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1514554049, "post_id": 48022924, "comment_id": 83015765, "body": "Read the docs for the <a href=\"https://golang.org/pkg/sort/\" rel=\"nofollow noreferrer\">sort</a> package."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1514554554, "post_id": 48022924, "comment_id": 83015969, "body": "If you\u2019re comparing semver strings, use one of the many packages already created for handling versions."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9153081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e2f623e153a2132500e5e12fa3b03d1?s=128&d=identicon&r=PG&f=1", "display_name": "Panku", "link": "https://stackoverflow.com/users/9153081/panku"}, "edited": false, "score": 0, "creation_date": 1514702957, "post_id": 48023012, "comment_id": 83051542, "body": "yes Marc thank you so much. but actually i am just learning go right now. So if you could help me in making the logic for the splitting and comparing,  i would be very grateful to u \ud83d\ude0a.  thank you in advance"}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": false, "score": 1, "last_activity_date": 1514552331, "creation_date": 1514552331, "answer_id": 48023012, "question_id": 48022924, "link": "https://stackoverflow.com/questions/48022924/sorting-strings-in-go-lang/48023012#48023012", "title": "Sorting strings in go lang", "body": "<p>Strings without special handling are sorted <a href=\"https://en.wikipedia.org/wiki/Lexicographical_order\" rel=\"nofollow noreferrer\">lexicographically</a>.</p>\n\n<p>This means that \"30\" in string terms is smaller than \"4\" because the character \"3\" is lexicographically smaller than the character \"4\".</p>\n\n<p>If you want to sort these based on integer values within the string, you need to make your own sorter.</p>\n\n<p>So in your comparator function <code>func (s ByLength) Less(i, j int) bool</code>, you can do something along the lines of:</p>\n\n<ul>\n<li>split strings by <code>.</code></li>\n<li>convert each string part into an integer</li>\n<li>iterate over both integer slices (at the same time)</li>\n<li>compare the numbers</li>\n</ul>\n\n<p>This of course only works for the <code>.</code> separated strings, you would have to adapt this for other separators.\nYou also have to worry about non-integer parts and strings with different number of parts (eg: <code>4.3</code> vs <code>4.3.5</code>)</p>\n"}], "owner": {"reputation": 11, "user_id": 9153081, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e2f623e153a2132500e5e12fa3b03d1?s=128&d=identicon&r=PG&f=1", "display_name": "Panku", "link": "https://stackoverflow.com/users/9153081/panku"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1761, "favorite_count": 0, "answer_count": 1, "score": -7, "last_activity_date": 1514716878, "creation_date": 1514551953, "last_edit_date": 1514716878, "question_id": 48022924, "link": "https://stackoverflow.com/questions/48022924/sorting-strings-in-go-lang", "title": "Sorting strings in go lang", "body": "<p>How do I sort strings like 4.3.4, 4.3.30 in golang. There is a method named \"sort\" in golang? The issue is that with this method 4.3.30 prints before 4.3.4. I want 4.3.30 to print after 4.3.4. What is the logic to do this sorting? \nNote- I just need a logic weather it will be in go or java.\nThanks in advance. \nfor you reference, \"sort\" program in go:</p>\n\n<pre><code>package main\n\nimport \"sort\"\nimport \"fmt\"\n\ntype ByLength []string\n\nfunc (s ByLength) Len() int {\n    return len(s)\n}\nfunc (s ByLength) Swap(i, j int) {\n    s[i], s[j] = s[j], s[i]\n}\nfunc (s ByLength) Less(i, j int) bool {\n    return (s[i]) &lt; (s[j])\n}\nfunc main() {\n    abc := []string{\"1.5.8\", \"5.8.4\", \"4.3.30\"}\n    sort.Sort(ByLength(abc))\n    fmt.Println(abc)\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1514554190, "post_id": 48022729, "comment_id": 83015831, "body": "Please define <i>&quot;But it is not working.&quot;</i> An error is returned? Bad or no documents get updated? Also what version of MongoDB are you using?"}, {"owner": {"reputation": 63390, "user_id": 2683814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/16a4c2fb341c51388d5cdfcf0e956f6c?s=128&d=identicon&r=PG&f=1", "display_name": "s7vr", "link": "https://stackoverflow.com/users/2683814/s7vr"}, "edited": false, "score": 0, "creation_date": 1514562501, "post_id": 48022729, "comment_id": 83019362, "body": "What is your mongo server version ?"}, {"owner": {"reputation": 627, "user_id": 6443951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JJbCW.jpg?s=128&g=1", "display_name": "MKB", "link": "https://stackoverflow.com/users/6443951/mkb"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1514862910, "post_id": 48022729, "comment_id": 83082708, "body": "Hi @icza, It is throwing the error &quot;Too many positional arguments found in the path&quot;. The version of my mongodb is &quot;3.4.10&quot;."}, {"owner": {"reputation": 627, "user_id": 6443951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JJbCW.jpg?s=128&g=1", "display_name": "MKB", "link": "https://stackoverflow.com/users/6443951/mkb"}, "reply_to_user": {"reputation": 63390, "user_id": 2683814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/16a4c2fb341c51388d5cdfcf0e956f6c?s=128&d=identicon&r=PG&f=1", "display_name": "s7vr", "link": "https://stackoverflow.com/users/2683814/s7vr"}, "edited": false, "score": 0, "creation_date": 1514862934, "post_id": 48022729, "comment_id": 83082713, "body": "@Veeram, The version is &quot;3.4.10&quot;"}, {"owner": {"reputation": 63390, "user_id": 2683814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/16a4c2fb341c51388d5cdfcf0e956f6c?s=128&d=identicon&r=PG&f=1", "display_name": "s7vr", "link": "https://stackoverflow.com/users/2683814/s7vr"}, "edited": false, "score": 1, "creation_date": 1514863989, "post_id": 48022729, "comment_id": 83082882, "body": "The bug you&#39;ve referenced has been fixed in 3.6 release. Can you update to latest 3.6.1 and try <code>db.collection_name.update({&quot;status&quot;: 0, &quot;details.category&quot;:&quot;A&quot;}, {&quot;$set&quot;: &quot;details.$[d].members.$[].obj.guava&quot;:15}, {&quot;arrayFilters&quot;:[{&quot;d.category&quot;:&quot;A&quot;}]})</code>. Hopefully you can transform into go."}, {"owner": {"reputation": 627, "user_id": 6443951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JJbCW.jpg?s=128&g=1", "display_name": "MKB", "link": "https://stackoverflow.com/users/6443951/mkb"}, "reply_to_user": {"reputation": 63390, "user_id": 2683814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/16a4c2fb341c51388d5cdfcf0e956f6c?s=128&d=identicon&r=PG&f=1", "display_name": "s7vr", "link": "https://stackoverflow.com/users/2683814/s7vr"}, "edited": false, "score": 0, "creation_date": 1514867083, "post_id": 48022729, "comment_id": 83083379, "body": "@Veeram, Okay let me check. Thanks! :)"}, {"owner": {"reputation": 1901, "user_id": 78199, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/22814e3715b6a6d4724291a804a66680?s=128&d=identicon&r=PG", "display_name": "evanmcd", "link": "https://stackoverflow.com/users/78199/evanmcd"}, "edited": false, "score": 0, "creation_date": 1517717711, "post_id": 48022729, "comment_id": 84205870, "body": "I was working on an issue like this and ended up using arrayFilters. My solution is posted in this SO question: <a href=\"https://stackoverflow.com/questions/48594481/selecting-and-updating-a-nested-object-by-its-objectid-in-mongoose-js/48604602#48604602\" title=\"selecting and updating a nested object by its objectid in mongoose js\">stackoverflow.com/questions/48594481/&hellip;</a>"}], "owner": {"reputation": 627, "user_id": 6443951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JJbCW.jpg?s=128&g=1", "display_name": "MKB", "link": "https://stackoverflow.com/users/6443951/mkb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1126, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1514551013, "creation_date": 1514551013, "question_id": 48022729, "link": "https://stackoverflow.com/questions/48022729/what-is-the-solution-to-too-many-positional-i-e-elements-found-in-path", "title": "What is the solution to &quot;Too many positional (i.e. &#39;$&#39;) elements found in path&quot;?", "body": "<p>I have searched over the web for this issue, the conclusion where I have reached is that it is a bug in the latest version of mongo as told <a href=\"https://stackoverflow.com/questions/24046470/mongodb-too-many-positional-i-e-elements-found-in-path\">here</a> and <a href=\"https://jira.mongodb.org/browse/SERVER-14164\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>The problem is that the structure of the object is as following:</p>\n\n<pre><code>{\n\"_id\": 2,\n\"status\": 0,\n\"details\": [{\n    \"id\": 2,\n    \"category\": \"A\",\n    \"obj\": {\n        \"apple\": 5,\n        \"banana\": 2,\n        \"cherry\": 10\n    },\n    \"members\": [{\n            \"id\": 3,\n            \"category\": \"A\",\n            \"obj\": {\n                \"apple\": 5,\n                \"banana\": 2,\n                \"cherry\": 10\n            }\n        },\n        {\n            \"id\": 4,\n            \"category\": \"A\",\n            \"obj\": {\n                \"apple\": 5,\n                \"banana\": 2,\n                \"cherry\": 10\n            }\n        }\n    ]\n  }]\n}\n</code></pre>\n\n<p>which I am using everywhere in my project which is almost ready. But now the requirement is to update the <code>obj</code> inside the <code>members</code> object. For which I tried</p>\n\n<pre><code>cond  := bson.M{ \"$and\": []bson.M{ bson.M{\"details\":bson.M{ \"$elemMatch\": bson.M{ \"category\": \"A\"} } }, bson.M{\"status\":0} } }\nquery := bson.M{ \"$set\": bson.M{ \"details.$.members.$.obj.guava\":15 } }\n_, err := models.DbUpdateAll(Collection, cond, query)\n</code></pre>\n\n<p>But it is not working. Do I need to change the whole structure of the document by maintaining the array in different collection and passing reference to this object? It will be really a bad idea as for now where the project stands.... Isn't there any easy solution?</p>\n"}, {"tags": ["go", "nats-streaming-server"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1514549707, "post_id": 48022454, "comment_id": 83014021, "body": "Can you include the output of the race detector?"}, {"owner": {"reputation": 925, "user_id": 94416, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c6bdec5132fd3906e89001ad195df15b?s=128&d=identicon&r=PG", "display_name": "Chadit", "link": "https://stackoverflow.com/users/94416/chadit"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1514550432, "post_id": 48022454, "comment_id": 83014324, "body": "added race detection output"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1514551404, "post_id": 48022454, "comment_id": 83014737, "body": "The race involves testing code. Are you by any chance setting a global handler in your test code? If so, you&#39;ll want a mutex around it. It&#39;s hard to tell without the test code or filenames/line numbers."}, {"owner": {"reputation": 925, "user_id": 94416, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c6bdec5132fd3906e89001ad195df15b?s=128&d=identicon&r=PG", "display_name": "Chadit", "link": "https://stackoverflow.com/users/94416/chadit"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1514552623, "post_id": 48022454, "comment_id": 83015216, "body": "thanks, for the info, added a link to my test project,"}, {"owner": {"reputation": 925, "user_id": 94416, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c6bdec5132fd3906e89001ad195df15b?s=128&d=identicon&r=PG", "display_name": "Chadit", "link": "https://stackoverflow.com/users/94416/chadit"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1514555924, "post_id": 48022454, "comment_id": 83016569, "body": "@Marc thank you that was it, put  mutex around the test handler and it is now passing."}], "owner": {"reputation": 925, "user_id": 94416, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c6bdec5132fd3906e89001ad195df15b?s=128&d=identicon&r=PG", "display_name": "Chadit", "link": "https://stackoverflow.com/users/94416/chadit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 137, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1514552494, "creation_date": 1514549607, "last_edit_date": 1514552494, "question_id": 48022454, "link": "https://stackoverflow.com/questions/48022454/go-race-data-detection-when-setting-up-handlers-for-nats-streaming", "title": "go race data detection when setting up handlers for nats-streaming", "body": "<p>For a nats-streaming subscription the handler needs to look like this</p>\n\n<pre><code>handler := func(ms *stan.Msg){}\n</code></pre>\n\n<p>I created the following function in an attempt to take the their handler and then call my own to process the message returned. </p>\n\n<pre><code>func (t *T) Subscribe(sub Subscription, h ...message.Handler) (stan.Subscription, error) {\n    process := func(ms *stan.Msg) {         \n        for i := range h {\n            h[i](ms)\n        }\n    }\n\n    return t.subscribe(sub, process)\n}\n</code></pre>\n\n<p>With go test -race I get a data warning race condition around the area where I loop over/call my handlers. I am Looking for some suggestions on how I can improve this to remove that race warning.</p>\n\n<p>== race detection output</p>\n\n<pre><code>==================\nWARNING: DATA RACE\nRead at 0x00c4201f8040 by goroutine 82:\n  github.com/MyTest/nats/v3_test.TestDurability.func2()\n      /home/chadit/Projects/src/github.com/MyTest/nats/v3/nats_test.go:399 +0x4d\n  github.com/MyTest/nats/v3.(*T).Subscribe.func1()\n      /home/chadit/Projects/src/github.com/MyTest/nats/v3/nats.go:222 +0x2a0\n  github.com/nats-io/go-nats-streaming.(*conn).processMsg()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats-streaming/stan.go:464 +0x41c\n  github.com/nats-io/go-nats-streaming.(*conn).(github.com/nats-io/go-nats-streaming.processMsg)-fm()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats-streaming/sub.go:217 +0x4b\n  github.com/nats-io/go-nats.(*Conn).waitForMsgs()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats/nats.go:1564 +0x1eb\n\nPrevious write at 0x00c4201f8040 by goroutine 81:\n  github.com/MyTest/nats/v3_test.TestDurability.func1()\n      /home/chadit/Projects/src/github.com/MyTest/nats/v3/nats_test.go:383 +0xe7\n  github.com/MyTest/nats/v3.(*T).Subscribe.func1()\n      /home/chadit/Projects/src/github.com/MyTest/nats/v3/nats.go:222 +0x2a0\n  github.com/nats-io/go-nats-streaming.(*conn).processMsg()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats-streaming/stan.go:464 +0x41c\n  github.com/nats-io/go-nats-streaming.(*conn).(github.com/nats-io/go-nats-streaming.processMsg)-fm()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats-streaming/sub.go:217 +0x4b\n  github.com/nats-io/go-nats.(*Conn).waitForMsgs()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats/nats.go:1564 +0x1eb\n\nGoroutine 82 (running) created at:\n  github.com/nats-io/go-nats.(*Conn).subscribe()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats/nats.go:2238 +0x3f8\n  github.com/nats-io/go-nats.(*Conn).Subscribe()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats/nats.go:2155 +0x7e\n  github.com/nats-io/go-nats-streaming.(*conn).subscribe()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats-streaming/sub.go:217 +0x59e\n  github.com/nats-io/go-nats-streaming.(*conn).Subscribe()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats-streaming/sub.go:185 +0xb0\n  github.com/MyTest/nats/v3.(*T).subscribe()\n      /home/chadit/Projects/src/github.com/MyTest/nats/v3/nats.go:279 +0x1be\n  github.com/MyTest/nats/v3.(*T).Subscribe()\n      /home/chadit/Projects/src/github.com/MyTest/nats/v3/nats.go:226 +0x1f7\n  github.com/MyTest/nats/v3_test.TestDurability()\n      /home/chadit/Projects/src/github.com/MyTest/nats/v3/nats_test.go:398 +0xa1a\n  testing.tRunner()\n      /usr/lib64/golang/src/testing/testing.go:746 +0x16c\n\nGoroutine 81 (finished) created at:\n  github.com/nats-io/go-nats.(*Conn).subscribe()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats/nats.go:2238 +0x3f8\n  github.com/nats-io/go-nats.(*Conn).Subscribe()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats/nats.go:2155 +0x7e\n  github.com/nats-io/go-nats-streaming.(*conn).subscribe()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats-streaming/sub.go:217 +0x59e\n  github.com/nats-io/go-nats-streaming.(*conn).Subscribe()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats-streaming/sub.go:185 +0xb0\n  github.com/MyTest/nats/v3.(*T).subscribe()\n      /home/chadit/Projects/src/github.com/MyTest/nats/v3/nats.go:279 +0x1be\n  github.com/MyTest/nats/v3.(*T).Subscribe()\n      /home/chadit/Projects/src/github.com/MyTest/nats/v3/nats.go:226 +0x1f7\n  github.com/MyTest/nats/v3_test.TestDurability()\n      /home/chadit/Projects/src/github.com/MyTest/nats/v3/nats_test.go:382 +0x606\n  testing.tRunner()\n      /usr/lib64/golang/src/testing/testing.go:746 +0x16c\n==================\n==================\nWARNING: DATA RACE\nRead at 0x00c4201f0000 by goroutine 82:\n  runtime.growslice()\n      /usr/lib64/golang/src/runtime/slice.go:82 +0x0\n  github.com/MyTest/nats/v3_test.TestDurability.func2()\n      /home/chadit/Projects/src/github.com/MyTest/nats/v3/nats_test.go:399 +0x166\n  github.com/MyTest/nats/v3.(*T).Subscribe.func1()\n      /home/chadit/Projects/src/github.com/MyTest/nats/v3/nats.go:222 +0x2a0\n  github.com/nats-io/go-nats-streaming.(*conn).processMsg()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats-streaming/stan.go:464 +0x41c\n  github.com/nats-io/go-nats-streaming.(*conn).(github.com/nats-io/go-nats-streaming.processMsg)-fm()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats-streaming/sub.go:217 +0x4b\n  github.com/nats-io/go-nats.(*Conn).waitForMsgs()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats/nats.go:1564 +0x1eb\n\nPrevious write at 0x00c4201f0000 by goroutine 81:\n  github.com/MyTest/nats/v3_test.TestDurability.func1()\n      /home/chadit/Projects/src/github.com/MyTest/nats/v3/nats_test.go:383 +0xb2\n  github.com/MyTest/nats/v3.(*T).Subscribe.func1()\n      /home/chadit/Projects/src/github.com/MyTest/nats/v3/nats.go:222 +0x2a0\n  github.com/nats-io/go-nats-streaming.(*conn).processMsg()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats-streaming/stan.go:464 +0x41c\n  github.com/nats-io/go-nats-streaming.(*conn).(github.com/nats-io/go-nats-streaming.processMsg)-fm()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats-streaming/sub.go:217 +0x4b\n  github.com/nats-io/go-nats.(*Conn).waitForMsgs()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats/nats.go:1564 +0x1eb\n\nGoroutine 82 (running) created at:\n  github.com/nats-io/go-nats.(*Conn).subscribe()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats/nats.go:2238 +0x3f8\n  github.com/nats-io/go-nats.(*Conn).Subscribe()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats/nats.go:2155 +0x7e\n  github.com/nats-io/go-nats-streaming.(*conn).subscribe()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats-streaming/sub.go:217 +0x59e\n  github.com/nats-io/go-nats-streaming.(*conn).Subscribe()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats-streaming/sub.go:185 +0xb0\n  github.com/MyTest/nats/v3.(*T).subscribe()\n      /home/chadit/Projects/src/github.com/MyTest/nats/v3/nats.go:279 +0x1be\n  github.com/MyTest/nats/v3.(*T).Subscribe()\n      /home/chadit/Projects/src/github.com/MyTest/nats/v3/nats.go:226 +0x1f7\n  github.com/MyTest/nats/v3_test.TestDurability()\n      /home/chadit/Projects/src/github.com/MyTest/nats/v3/nats_test.go:398 +0xa1a\n  testing.tRunner()\n      /usr/lib64/golang/src/testing/testing.go:746 +0x16c\n\nGoroutine 81 (finished) created at:\n  github.com/nats-io/go-nats.(*Conn).subscribe()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats/nats.go:2238 +0x3f8\n  github.com/nats-io/go-nats.(*Conn).Subscribe()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats/nats.go:2155 +0x7e\n  github.com/nats-io/go-nats-streaming.(*conn).subscribe()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats-streaming/sub.go:217 +0x59e\n  github.com/nats-io/go-nats-streaming.(*conn).Subscribe()\n      /home/chadit/Projects/src/github.com/nats-io/go-nats-streaming/sub.go:185 +0xb0\n  github.com/MyTest/nats/v3.(*T).subscribe()\n      /home/chadit/Projects/src/github.com/MyTest/nats/v3/nats.go:279 +0x1be\n  github.com/MyTest/nats/v3.(*T).Subscribe()\n      /home/chadit/Projects/src/github.com/MyTest/nats/v3/nats.go:226 +0x1f7\n  github.com/MyTest/nats/v3_test.TestDurability()\n      /home/chadit/Projects/src/github.com/MyTest/nats/v3/nats_test.go:382 +0x606\n  testing.tRunner()\n      /usr/lib64/golang/src/testing/testing.go:746 +0x16c\n==================\n--- FAIL: TestDurability (1.01s)\n    testing.go:699: race detected during execution of test\nFAIL\nexit status 1\n</code></pre>\n\n<p>link to project <a href=\"https://github.com/chadit/MessageQueueExamples/tree/master/nats-streaming/nats\" rel=\"nofollow noreferrer\">https://github.com/chadit/MessageQueueExamples/tree/master/nats-streaming/nats</a></p>\n"}, {"tags": ["rest", "go", "patch", "go-gorm"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1514549622, "post_id": 48021945, "comment_id": 83013980, "body": "The only other possibility is that if you have the value you want to patch already loaded, e.g. from db, you can unmarshal into that and fields that were omitted in the json will not be overwritten on the value. <a href=\"https://play.golang.org/p/zyTtrqyRZJp\" rel=\"nofollow noreferrer\">play.golang.org/p/zyTtrqyRZJp</a>"}], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 5428760, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207875598274644/picture?type=large", "display_name": "sunny tam", "link": "https://stackoverflow.com/users/5428760/sunny-tam"}, "edited": false, "score": 0, "creation_date": 1514549484, "post_id": 48022391, "comment_id": 83013929, "body": "Thanks for your suggestion. Yes it is a possible way to do. But I would like to know any reason behind to not suggest using nullable lib? p.s I am thinking about which solution is better but don\u2019t really know which one would be better"}, {"owner": {"reputation": 6770, "user_id": 3658660, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5b40f4e2bead9eca6951da110a3c84e7?s=128&d=identicon&r=PG&f=1", "display_name": "hlscalon", "link": "https://stackoverflow.com/users/3658660/hlscalon"}, "reply_to_user": {"reputation": 77, "user_id": 5428760, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207875598274644/picture?type=large", "display_name": "sunny tam", "link": "https://stackoverflow.com/users/5428760/sunny-tam"}, "edited": false, "score": 0, "creation_date": 1514549684, "post_id": 48022391, "comment_id": 83014011, "body": "Well, it&#39;s another dependency.  I don&#39;t know whether that would be a problem for you. The way I suggested it&#39;s standard (no libs required)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514556286, "post_id": 48022391, "comment_id": 83016740, "body": "And it seems kind of silly to use a 3rd party library, considering pointers are a nullable (well, <code>nil</code>able) type built in to the language."}, {"owner": {"reputation": 77, "user_id": 5428760, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207875598274644/picture?type=large", "display_name": "sunny tam", "link": "https://stackoverflow.com/users/5428760/sunny-tam"}, "edited": false, "score": 0, "creation_date": 1514561025, "post_id": 48022391, "comment_id": 83018755, "body": "You are right, using 3rd party lib to do this kind of duty is really stupid... I should consider using pointer instead"}], "tags": [], "owner": {"reputation": 6770, "user_id": 3658660, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5b40f4e2bead9eca6951da110a3c84e7?s=128&d=identicon&r=PG&f=1", "display_name": "hlscalon", "link": "https://stackoverflow.com/users/3658660/hlscalon"}, "is_accepted": true, "score": 5, "last_activity_date": 1514549522, "last_edit_date": 1514549522, "creation_date": 1514549297, "answer_id": 48022391, "question_id": 48021945, "link": "https://stackoverflow.com/questions/48021945/how-to-handle-patch-request-with-unset-value-in-golang/48022391#48022391", "title": "How to handle patch request with unset value in golang", "body": "<p>Use a pointer along with the <code>omitempty</code> tag. This way you can differentiate between an unset value, nil, and an intentional zero value (\"\", false, 0).</p>\n\n<pre><code>type User struct {\n    Name *string `json:\"name,omitempty\"`\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/VZAEEfM6gNm\" rel=\"noreferrer\">Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 1374, "user_id": 560561, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6c5947ff77ff642f370d78017cf04fc?s=128&d=identicon&r=PG", "display_name": "fzerorubigd", "link": "https://stackoverflow.com/users/560561/fzerorubigd"}, "is_accepted": false, "score": 0, "last_activity_date": 1514554175, "creation_date": 1514554175, "answer_id": 48023368, "question_id": 48021945, "link": "https://stackoverflow.com/questions/48021945/how-to-handle-patch-request-with-unset-value-in-golang/48023368#48023368", "title": "How to handle patch request with unset value in golang", "body": "<p>Another solution is writing your own type, and implement <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\">json.Unmarshaller</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype NullString struct {\n    Data string\n    Null bool\n}\n\nfunc (ns *NullString) UnmarshalJSON(d []byte) error {\n    if string(d) == \"null\" {\n        // this is based on your need. you may add a new field here\n        ns.Null = true\n        return nil\n    }\n    return json.Unmarshal(d, &amp;ns.Data)\n}\n\ntype Test struct {\n    Data1 NullString `json:\"data1\"`\n    Data2 NullString `json:\"data2\"`\n    Data3 NullString `json:\"data3\"`\n}\n\nconst t = `{\"data1\":null, \"data2\":\"string\"}`\n\nfunc main() {\n    p := Test{}\n    json.Unmarshal([]byte(t), &amp;p)\n    fmt.Printf(\"%+v\", p)\n}\n</code></pre>\n\n<p>result is <code>{Data1:{Data: Null:true} Data2:{Data:string Null:false} Data3:{Data: Null:false}}</code> if the value is <code>null</code> then the Null field is set. also you can simply add extra fields to this struct if needed. for example a field to track if the function is called or not.  </p>\n\n<p>ps : also see the <a href=\"https://golang.org/pkg/encoding/json/#Marshaler\" rel=\"nofollow noreferrer\">json.Marshaller</a> for the reverse from struct to json. </p>\n\n<p><a href=\"https://play.golang.org/p/VYhggRGH3ai\" rel=\"nofollow noreferrer\">playground</a></p>\n"}, {"comments": [{"owner": {"reputation": 77, "user_id": 5428760, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207875598274644/picture?type=large", "display_name": "sunny tam", "link": "https://stackoverflow.com/users/5428760/sunny-tam"}, "edited": false, "score": 0, "creation_date": 1514561131, "post_id": 48023823, "comment_id": 83018799, "body": "This method really magic, does not realise we can do the job like this"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1514565009, "post_id": 48023823, "comment_id": 83020470, "body": "Don&#39;t forget to pass an address (<code>&amp;canonObj</code>) as it may not be a pointer."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1514565354, "post_id": 48023823, "comment_id": 83020631, "body": "Pass an address <i>if</i> it&#39;s not a pointer. If it&#39;s already a pointer, pass it as is."}, {"owner": {"reputation": 585, "user_id": 3473875, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1dc1668f1b206adf1e3c19e72f63892?s=128&d=identicon&r=PG", "display_name": "poWar", "link": "https://stackoverflow.com/users/3473875/powar"}, "edited": false, "score": 0, "creation_date": 1589571560, "post_id": 48023823, "comment_id": 109357469, "body": "This is a good solution provided you expect the client to update any field in <code>canonObj</code>. What if there are fields that must not be updated (say <code>id</code>). I feel @hlscalon answer above makes sense in such a case unless am missing something."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 13, "last_activity_date": 1514556432, "creation_date": 1514556432, "answer_id": 48023823, "question_id": 48021945, "link": "https://stackoverflow.com/questions/48021945/how-to-handle-patch-request-with-unset-value-in-golang/48023823#48023823", "title": "How to handle patch request with unset value in golang", "body": "<p>If you're using <code>PATCH</code> in a RESTful way, that means it's updating some existing data, and only overwriting those fields included in the request body. Which means you don't actually need to know which fields are set or not; you can just load your canonical object and unmarshal over it to replace any fields that are found in the JSON, while leaving any others untouched:</p>\n\n<pre><code>canonObj := getObjectFromDBOrSomething()\nerr := json.NewDecoder(req.Body).Decode(canonObj)\n</code></pre>\n\n<p>This will overwrite any fields in <code>canonObj</code> with fields from the request, but any fields <em>not</em> in the request won't be touched.</p>\n"}], "owner": {"reputation": 77, "user_id": 5428760, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207875598274644/picture?type=large", "display_name": "sunny tam", "link": "https://stackoverflow.com/users/5428760/sunny-tam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2752, "favorite_count": 2, "accepted_answer_id": 48022391, "answer_count": 3, "score": 4, "last_activity_date": 1527757024, "creation_date": 1514547069, "last_edit_date": 1527757024, "question_id": 48021945, "link": "https://stackoverflow.com/questions/48021945/how-to-handle-patch-request-with-unset-value-in-golang", "title": "How to handle patch request with unset value in golang", "body": "<p>I am working on a patch restful request that the body json contain some omitted value while sending to golang. Since an unset value will lead the golang struct become default value. So I would like to know if there are any solution to deal with patch request omit data?</p>\n\n<p>As I know, a basic type like string / int cannot be nullable in golang. there are different approach to deal with unset value patch request. For example:</p>\n\n<ol>\n<li><p>using pointer to deal with null problem</p>\n\n<pre><code>type User struct {\n    Name *string\n}\n</code></pre></li>\n<li><p>using nullable library</p>\n\n<pre><code>type User struct {\n    Name  sql.NullString\n}\n</code></pre></li>\n<li><p>using <code>map[string][]interface{}</code> to see if the value is set</p></li>\n</ol>\n\n<p>Is there any better solution to deal with nullable value inside struct? since this 3 should be work around to deal with the nullable value. </p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1514567208, "post_id": 48021232, "comment_id": 83021381, "body": "Related questions: <a href=\"https://stackoverflow.com/questions/27928744/an-infinite-loop-produced-by-fmt-sprinte-inside-the-error-method\" title=\"an infinite loop produced by fmt sprinte inside the error method\">stackoverflow.com/questions/27928744/&hellip;</a> <a href=\"https://stackoverflow.com/questions/27474907/error-infinite-loop\">stackoverflow.com/questions/27474907/error-infinite-loop</a>"}], "answers": [{"comments": [{"owner": {"reputation": 7789, "user_id": 2271269, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/d7CGe.jpg?s=128&g=1", "display_name": "Akshat Mahajan", "link": "https://stackoverflow.com/users/2271269/akshat-mahajan"}, "edited": false, "score": 0, "creation_date": 1514544775, "post_id": 48021386, "comment_id": 83011863, "body": "Wow, I can&#39;t believe I didn&#39;t see that. But <a href=\"https://golang.org/pkg/fmt/#hdr-Printing\" rel=\"nofollow noreferrer\">the Go docs say</a> that <code>%+v</code> only prints the field names and the values. Why would the <code>Error</code> method be called as well? Are methods fields too?"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 7789, "user_id": 2271269, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/d7CGe.jpg?s=128&g=1", "display_name": "Akshat Mahajan", "link": "https://stackoverflow.com/users/2271269/akshat-mahajan"}, "edited": false, "score": 1, "creation_date": 1514545256, "post_id": 48021386, "comment_id": 83012103, "body": "@AkshatMahajan because standard formatting <code>%v</code> checks where methods like <code>String</code> or <code>Error</code> are implemented and then call them to format. And  <code>%+v</code> is detailed formatting: it does not use those methods and constructs output  on it own. The same with <code>%#v</code>. But using them is some sort of hack - you lose ability to use standard methods and short representation."}, {"owner": {"reputation": 7789, "user_id": 2271269, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/d7CGe.jpg?s=128&g=1", "display_name": "Akshat Mahajan", "link": "https://stackoverflow.com/users/2271269/akshat-mahajan"}, "reply_to_user": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1514545462, "post_id": 48021386, "comment_id": 83012192, "body": "@EugeneLisitsky Thanks for the great explanation! Do you know if this is officially documented anywhere? Would be awesome to know where I should have looked next time."}, {"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 1, "creation_date": 1514545822, "post_id": 48021386, "comment_id": 83012361, "body": "The behaviour is documented after all verbs have been listed. The section explains special formatting considerations that apply for operants implementing certain interfaces. It is contained in the <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\">fmt</a> documentation and can be found by searching for &quot;formatting considerations&quot;. The 4th entry in the list is the one relevant to this question."}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 5, "last_activity_date": 1514544515, "creation_date": 1514544515, "answer_id": 48021386, "question_id": 48021232, "link": "https://stackoverflow.com/questions/48021232/accessing-golang-struct-that-implements-error-interface-causes-function-to-never/48021386#48021386", "title": "Accessing Golang struct that implements error interface causes function to never return", "body": "<p>The problem is with the definition of <code>Error</code> interface. The function <code>Error() string</code> on <code>Error</code> type is recursively calling itself when you try to <code>fmt.Sprintf</code> the value <code>e</code>:</p>\n\n<pre><code>func (e Error) Error() string {\n    return fmt.Sprintf(\"Error: %+v\", e) // calls e.Error again\n}\n</code></pre>\n\n<p>Try to return error by accessing <code>Error</code> type's members explicitely:</p>\n\n<pre><code>func (e Error) Error() string {\n    return fmt.Sprintf(\"Error: %+v\", e.Message)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7789, "user_id": 2271269, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/d7CGe.jpg?s=128&g=1", "display_name": "Akshat Mahajan", "link": "https://stackoverflow.com/users/2271269/akshat-mahajan"}, "edited": false, "score": 0, "creation_date": 1514545250, "post_id": 48021499, "comment_id": 83012098, "body": "Ah, this is great. Unfortunately I had to give the accepted answer to abhink because he answered first, but perhaps you can help me understand why <code>fmt</code> calls <code>Error()</code> internally. I thought <code>Sprintf(&quot;%+v&quot;, e)</code> only operates on the field names and values. Is this behaviour documented somewhere?"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 7789, "user_id": 2271269, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/d7CGe.jpg?s=128&g=1", "display_name": "Akshat Mahajan", "link": "https://stackoverflow.com/users/2271269/akshat-mahajan"}, "edited": false, "score": 0, "creation_date": 1514545371, "post_id": 48021499, "comment_id": 83012150, "body": "I&#39;ve described it above: <a href=\"https://stackoverflow.com/questions/48021232/accessing-golang-struct-that-implements-error-interface-causes-function-to-never/48021499?noredirect=1#comment83012103_48021386\" title=\"accessing golang struct that implements error interface causes function to never\">stackoverflow.com/questions/48021232/&hellip;</a>"}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 2, "last_activity_date": 1514545877, "last_edit_date": 1592644375, "creation_date": 1514545032, "answer_id": 48021499, "question_id": 48021232, "link": "https://stackoverflow.com/questions/48021232/accessing-golang-struct-that-implements-error-interface-causes-function-to-never/48021499#48021499", "title": "Accessing Golang struct that implements error interface causes function to never return", "body": "<p>The problem is recursion because <code>fmt</code> calls <code>Error()</code> what calls fmt again.</p>\n<p>Classical solutions is to convert your error type into <code>string</code> and then use standard mechanics. This way you have all the formatting tools. Like:</p>\n<pre><code>type E string\n\nfunc (e E) Error() string {\n    return fmt.Sprintf(string(e))\n}\n</code></pre>\n<p>Playground: <a href=\"https://play.golang.org/p/NI5JL3H4g7Y\" rel=\"nofollow noreferrer\">https://play.golang.org/p/NI5JL3H4g7Y</a></p>\n<p>Excerpt from <code>fmt</code> <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\">documentation</a> (unfortunatelly cannot make direct link to the paragraph):</p>\n<blockquote>\n<ol start=\"4\">\n<li><p>If an operand implements the error interface, the Error method will be invoked to convert the object to a string, which will then be formatted as required by the verb (if any).</p>\n</li>\n<li><p>If an operand implements method String() string, that method will be invoked to convert the object to a string, which will then be formatted as required by the verb (if any).</p>\n</li>\n</ol>\n<p>To avoid recursion in cases such as</p>\n<pre><code>type X string \n\nfunc (x X) String() string { return Sprintf(&quot;&lt;%s&gt;&quot;, x) }\n</code></pre>\n<p>convert the value before recurring:</p>\n<pre><code>func (x X) String() string { return Sprintf(&quot;&lt;%s&gt;&quot;, string(x)) }\n</code></pre>\n<p>Infinite recursion can also be triggered by self-referential data\nstructures, such as a slice that contains itself as an element, if\nthat type has a String method. Such pathologies are rare, however, and\nthe package does not protect against them.</p>\n<p>When printing a struct, fmt cannot and therefore does not invoke\nformatting methods such as Error or String on unexported fields.</p>\n</blockquote>\n"}], "owner": {"reputation": 7789, "user_id": 2271269, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/d7CGe.jpg?s=128&g=1", "display_name": "Akshat Mahajan", "link": "https://stackoverflow.com/users/2271269/akshat-mahajan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 531, "favorite_count": 0, "accepted_answer_id": 48021386, "answer_count": 2, "score": 1, "last_activity_date": 1514545877, "creation_date": 1514543787, "last_edit_date": 1514544120, "question_id": 48021232, "link": "https://stackoverflow.com/questions/48021232/accessing-golang-struct-that-implements-error-interface-causes-function-to-never", "title": "Accessing Golang struct that implements error interface causes function to never return", "body": "<h1>Background</h1>\n\n<p>I'm unmarshalling JSON data from an HTTP API to the following Golang structs:</p>\n\n<pre><code>type ResponseBody struct {\n    Version string `json:\"jsonrpc\"`\n    Result  Result `json:\"result\"`\n    Error   Error  `json:\"error\"`\n    Id      int    `json:\"id\"`\n}\n\ntype Result struct {\n    Random struct {\n        Data           interface{} `json:\"data\"`\n        CompletionTime string      `json:\"completionTime\"`\n    } `json:\"random\"`\n    BitsUsed      int `json:\"bitsUsed\"`\n    BitsLeft      int `json:\"bitsLeft\"`\n    RequestsLeft  int `json:\"requestsLeft\"`\n    AdvisoryDelay int `json:\"advisoryDelay\"`\n}\n\ntype Error struct {\n    Code    int    `json:\"code\"`\n    Message string `json:\"message\"`\n    Data    []int  `json:\"data,omitempty\"`\n}\n</code></pre>\n\n<p>and I've implemented the error interface for <code>Error</code> as follows:</p>\n\n<pre><code>func (e Error) Error() string {\n    return fmt.Sprintf(\"Error: %+v\", e)\n}\n</code></pre>\n\n<p>Relevant code so far:</p>\n\n<pre><code>func Request(method string, params interface{}) (Result, error) {\n    // `error` in return types is _not_ a typo\n\n    body, err := json.Marshal(RequestBody{Version: \"2.0\", Params: params, Method: method, Id: 1})\n    if err != nil {\n        return Result{}, err\n    }\n\n    resp, err := http.Post(endpoint, \"application/json-rpc\", bytes.NewReader(body))\n    if err != nil {\n        return Result{}, fmt.Errorf(\"Request failed, error was %s\", err)\n    }\n    defer resp.Body.Close()\n\n    text, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        return Result{}, fmt.Errorf(\"Failed to read response into memory, error was: %s\", err)\n    }\n\n    if resp.StatusCode != 200 {\n        var errorMessage Error\n        if err := json.Unmarshal(text, &amp;errorMessage); err != nil {\n            return Result{}, Error{\n                Code:    409,\n                Message: fmt.Sprintf(\"Client could not decode JSON error response, received %s, error was: %s\", text, err),\n                Data:    []int{},\n            }\n        }\n        return Result{}, errorMessage\n    }\n\n    response := ResponseBody{}\n    if err := json.Unmarshal(text, &amp;response); err != nil {\n        return Result{}, fmt.Errorf(\"Failed to JSON-decode response body, received %s from source, error was: %s\", text, err)\n    }\n\n    return response.Result, response.Error\n}\n</code></pre>\n\n<h1>Issue</h1>\n\n<p>The following code hangs indefinitely on a successful call without panicking:</p>\n\n<pre><code>// `body` here is just any old struct\nresult, err := Request(\"generateIntegers\", body)\nif err != nil {\n    return []int{}, err  // hangs here\n}\n</code></pre>\n\n<p>In fact, the code always hangs when I invoke <code>err</code>. No panic is raised and no error is returned - it is simply frozen[1].</p>\n\n<p>[1] Strictly speaking, it causes a stack overflow error, but that's because the function never returns and so the deferred <code>resp.Body.Close()</code> in <code>Request</code> never gets called. </p>\n\n<p>It gets weirder. Adding the following debugging lines:</p>\n\n<pre><code>response := ResponseBody{}\nif err := json.Unmarshal(text, &amp;response); err != nil {\n    return Result{}, fmt.Errorf(\"Failed to JSON-decode response body, received %s from source, error was: %s\", text, err)\n}\n\nfmt.Println(response.Result.BitsUsed)\nfmt.Println(response.Result) // this prints!\n\nreturn response.Result, response.Error\n</code></pre>\n\n<p>works, but changing these lines to just</p>\n\n<pre><code>response := ResponseBody{}\nif err := json.Unmarshal(text, &amp;response); err != nil {\n    return Result{}, fmt.Errorf(\"Failed to JSON-decode response body, received %s from source, error was: %s\", text, err)\n}\n\nfmt.Println(response.Result) // this no longer prints! :O\n\nreturn response.Result, response.Error\n</code></pre>\n\n<p>causes <code>Request</code> function itself to hang at this debug statement.</p>\n\n<h1>Things I've Tried</h1>\n\n<ul>\n<li>Running a trace with <code>go test -trace</code> to view what's being called. This fails because <code>go tool trace</code> cannot parse the generated trace file.</li>\n<li>Converting my signature to return <code>*error</code> instead of regular <code>error</code>. This did not help.</li>\n</ul>\n\n<hr>\n\n<p>Why is this code snippet hanging?</p>\n\n<p>Note: I am running Go 1.7</p>\n"}, {"tags": ["string", "go", "decode", "rune"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1514541244, "post_id": 48020373, "comment_id": 83010280, "body": "This is just a regular rune literal, but clearly that&#39;s not what you&#39;re looking for. Please show some code, including desired vs actual output."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1514541320, "post_id": 48020373, "comment_id": 83010315, "body": "@Marc OP already provided a string. For that the outcome should be <code>\u0424\u0435\u0434\u043e\u0440\u043e\u0432</code>."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1514541420, "post_id": 48020373, "comment_id": 83010365, "body": "<a href=\"https://play.golang.org/p/Xb5sOLFX1vj\" rel=\"nofollow noreferrer\">play.golang.org/p/Xb5sOLFX1vj</a> --- given <code>s</code>, one should return <code>\u0424\u0435\u0434\u043e\u0440\u043e\u0432</code>."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1514541506, "post_id": 48020373, "comment_id": 83010394, "body": "Thanks @zerkms, I get that from the comments. But the question is still unclear for anyone not going through all the comments. It should be edited for future viewers."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1514541734, "post_id": 48020373, "comment_id": 83010468, "body": "Super quick and dirty <a href=\"https://play.golang.org/p/KTvTR3NAPto\" rel=\"nofollow noreferrer\">play.golang.org/p/KTvTR3NAPto</a>"}], "answers": [{"comments": [{"owner": {"reputation": 133, "user_id": 1300751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a182974c279fa4ec56cb6513183cc29?s=128&d=identicon&r=PG", "display_name": "Anton Globa", "link": "https://stackoverflow.com/users/1300751/anton-globa"}, "edited": false, "score": 0, "creation_date": 1514540825, "post_id": 48020472, "comment_id": 83010101, "body": "The string contain characters as [&#39;\\&#39;,&#39;x&#39;,&#39;D&#39;,&#39;0&#39;... etc] and it does not recognized as runes"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 133, "user_id": 1300751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a182974c279fa4ec56cb6513183cc29?s=128&d=identicon&r=PG", "display_name": "Anton Globa", "link": "https://stackoverflow.com/users/1300751/anton-globa"}, "edited": false, "score": 0, "creation_date": 1514540865, "post_id": 48020472, "comment_id": 83010118, "body": "The code above works exactly as shown. What did you do, and what was the output?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1514541044, "post_id": 48020472, "comment_id": 83010178, "body": "@Marc they don&#39;t have a string literal <code>\\xD0</code>, they have a string <code>\\xD0</code>, effectively it would be <code>\\\\xD0</code> if used in a string literal."}, {"owner": {"reputation": 133, "user_id": 1300751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a182974c279fa4ec56cb6513183cc29?s=128&d=identicon&r=PG", "display_name": "Anton Globa", "link": "https://stackoverflow.com/users/1300751/anton-globa"}, "edited": false, "score": 0, "creation_date": 1514541044, "post_id": 48020472, "comment_id": 83010180, "body": "I read file. File contain characters \\xD0\\xA4\\xD0\\xB5\\xD0\\xB4\\xD0\\xBE\\xD1\\x80\\xD0\\xBE\\xD0\\xB2, and want convert to \u0424\u0435\u0434\u043e\u0440\u043e\u0432"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514541168, "post_id": 48020472, "comment_id": 83010237, "body": "@Flimzy they say that: &quot;I have a string which contains following text&quot;. &quot;\t That literal string is in a file&quot; --- literals exist only in code."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514541243, "post_id": 48020472, "comment_id": 83010279, "body": "@Flimzy it does not matter where that string comes from: a network, a file or <code>&#47;dev&#47;urand</code>. OP provided the exact characters in a string."}, {"owner": {"reputation": 133, "user_id": 1300751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a182974c279fa4ec56cb6513183cc29?s=128&d=identicon&r=PG", "display_name": "Anton Globa", "link": "https://stackoverflow.com/users/1300751/anton-globa"}, "edited": false, "score": 1, "creation_date": 1514541543, "post_id": 48020472, "comment_id": 83010400, "body": "I changed my question"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514543280, "post_id": 48020472, "comment_id": 83011185, "body": "Note that this will only work if the entire input string is hex-encoded. If it contains mixed hex-encoding and normal ASCII encoding (which is permitted by Go, but may not be by whatever the OP&#39;s input source is), this will fail."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1514543547, "post_id": 48020472, "comment_id": 83011310, "body": "Indeed, this is the very definition of hacky. Doing this properly would require switching on encoding prefix (if present). eg: <code>scanf</code> or regexps, but the answers should provide OP with a way to get started on more real-world scenarios."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 1, "last_activity_date": 1514543122, "last_edit_date": 1514543122, "creation_date": 1514540561, "answer_id": 48020472, "question_id": 48020373, "link": "https://stackoverflow.com/questions/48020373/golang-runes-in-string-or-how-to-convert/48020472#48020472", "title": "Golang runes in string or how to convert?", "body": "<p>Go accepts hexadecimal <a href=\"https://golang.org/ref/spec#Rune_literals\" rel=\"nofollow noreferrer\">rune literals</a>.</p>\n\n<p>So you can use your input as a regular string:</p>\n\n<pre><code>fmt.Println(\"\\xD0\\xA4\\xD0\\xB5\\xD0\\xB4\\xD0\\xBE\\xD1\\x80\\xD0\\xBE\\xD0\\xB2\")\n\u0424\u0435\u0434\u043e\u0440\u043e\u0432\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/8y6XlK5g0MZ\" rel=\"nofollow noreferrer\">Playground</a> example.</p>\n\n<p>If you start with the actual string <code>[\"\\\" \"x\" \"D\" \"0\" ...]</code>, you'll need to convert the individual 4-byte sequences to characters.\nOne dirty way is:</p>\n\n<pre><code>s := `\\xD0\\xA4\\xD0\\xB5\\xD0\\xB4\\xD0\\xBE\\xD1\\x80\\xD0\\xBE\\xD0\\xB2`\ns2, _ := hex.DecodeString(strings.Replace(s, \"\\\\x\", \"\", -1))\nfmt.Printf(\"%s\", s2)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/tyQPfhfKDCi\" rel=\"nofollow noreferrer\">Playground</a> example.</p>\n\n<p>Edited to answer edited question.</p>\n"}], "owner": {"reputation": 133, "user_id": 1300751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a182974c279fa4ec56cb6513183cc29?s=128&d=identicon&r=PG", "display_name": "Anton Globa", "link": "https://stackoverflow.com/users/1300751/anton-globa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 510, "favorite_count": 0, "accepted_answer_id": 48020472, "answer_count": 1, "score": 1, "last_activity_date": 1514546269, "creation_date": 1514540028, "last_edit_date": 1514546269, "question_id": 48020373, "link": "https://stackoverflow.com/questions/48020373/golang-runes-in-string-or-how-to-convert", "title": "Golang runes in string or how to convert?", "body": "<p>I have a string which contains following text. </p>\n\n<pre><code>\\xD0\\xA4\\xD0\\xB5\\xD0\\xB4\\xD0\\xBE\\xD1\\x80\\xD0\\xBE\\xD0\\xB2\n</code></pre>\n\n<p>It is not a literal. In string it's stored as separate characters like this <code>['\\','x','D','0','\\','x','A','4',...]</code></p>\n\n<p>How to convert this string to normal characters?</p>\n"}, {"tags": ["json", "go", "struct", "package", "marshalling"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1514540008, "post_id": 48020098, "comment_id": 83009759, "body": "Take a look at related Q&amp;A <a href=\"https://stackoverflow.com/questions/24642148/golang-type-conversion-between-slices-of-structs\">https://stackoverflow.com/questions/24642148/golang-type-con&zwnj;&#8203;version-between-slic&zwnj;&#8203;es-of-structs</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1514541311, "post_id": 48020098, "comment_id": 83010308, "body": "Note that <code>type MyFarm entity.Farm</code> is <i>not</i> a <a href=\"https://github.com/golang/proposal/blob/master/design/18130-type-alias.md\" rel=\"nofollow noreferrer\">type alias</a>."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1514542499, "post_id": 48020098, "comment_id": 83010835, "body": "Finally, all you need is a byte slice corresponding to the data in JSON format and you know the fields you need. See <a href=\"https://blog.golang.org/json-and-go\" rel=\"nofollow noreferrer\">blog.golang.org/json-and-go</a> on how <code>Message</code> structure has been used, hope it should be fairly simple to work around. Finally when you demux it, it will still fill into your <code>entity.Farm</code> structure."}], "owner": {"reputation": 185, "user_id": 4243035, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/cn7mx.png?s=128&g=1", "display_name": "tama", "link": "https://stackoverflow.com/users/4243035/tama"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1276, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1514542511, "creation_date": 1514538593, "last_edit_date": 1514541628, "question_id": 48020098, "link": "https://stackoverflow.com/questions/48020098/custom-json-marshal-from-slice-of-struct-in-different-package", "title": "Custom JSON Marshal from Slice of Struct in Different Package", "body": "<p>My goal is to create JSON marshal from a struct but with different fields.\nFor example, my struct have <code>UID, Name, and Type</code> fields, but I want to Marshal just 2 of them.</p>\n\n<p>I have something like this:</p>\n\n<pre><code>package entity\n\ntype Farm struct {\n    UID string\n    Name string\n    Type string\n}\n\n-----------------------\n\npackage server\n\nfunc(f entity.Farm) MarshalJSON() ([]byte, error) {\n    return json.Marshal(struct {\n        UID  string `json:\"uid\"`\n        Name string `json:\"name\"`\n    }{\n        UID:  f.UID,\n        Name: f.Name,\n    })    \n}\n\nfunc main() {\n    farms := []entity.Farm{}\n    farms.append(farms, Farm{\"123\", \"MyFarm1\", \"organic\"})\n    farms.append(farms, Farm{\"456\", \"MyFarm2\", \"organic\"})\n\n    json, _ = json.Marshal(farms)\n}\n</code></pre>\n\n<p>The problem is I cannot create custom method of <code>MarshalJSON()</code> from <code>entity.Farm</code> because its in the other package. Googling said that I should do custom type and make custom method of <code>MarshalJSON()</code> from that. But I still don't know how to convert from my <code>[]entity.Farm</code> to <code>[]MyFarm</code> in my <code>func main()</code></p>\n\n<p>So here if I try to use custom type:</p>\n\n<pre><code>package server\n\ntype MyFarm entity.Farm\n\nfunc(mf MyFarm) MarshalJSON() ([]byte, error) {\n    return json.Marshal(struct {\n        UID  string `json:\"uid\"`\n        Name string `json:\"name\"`\n    }{\n        UID:  mf.UID,\n        Name: mf.Name,\n    })    \n}\n\nfunc main() {\n    farms := []entity.Farm{}\n    farms.append(farms, Farm{\"123\", \"MyFarm1\", \"organic\"})\n    farms.append(farms, Farm{\"456\", \"MyFarm2\", \"organic\"})\n\n    // Here I need to convert farms slice to []MyFarm slice \n    // so that I can use my custom MarshalJSON() from MyFarm\n}\n</code></pre>\n\n<p>So how can I convert that <code>farms</code> slice to slice of <code>MyFarm</code> so that I can use my custom MarshalJSON() from MyFarm?</p>\n\n<p>And I cannot change the Farm struct's package to <code>package server</code></p>\n"}, {"tags": ["html", "forms", "go"], "comments": [{"owner": {"reputation": 18865, "user_id": 1990451, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/kffVz.jpg?s=128&g=1", "display_name": "smnbbrv", "link": "https://stackoverflow.com/users/1990451/smnbbrv"}, "edited": false, "score": 0, "creation_date": 1514536947, "post_id": 48019696, "comment_id": 83008551, "body": "sorry, but what??? beego webserver? How is it connected to the HTML form?"}, {"owner": {"reputation": 73, "user_id": 8499218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c9eb596194db6f333c1e819615b8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "user8499218", "link": "https://stackoverflow.com/users/8499218/user8499218"}, "reply_to_user": {"reputation": 18865, "user_id": 1990451, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/kffVz.jpg?s=128&g=1", "display_name": "smnbbrv", "link": "https://stackoverflow.com/users/1990451/smnbbrv"}, "edited": false, "score": 0, "creation_date": 1514537107, "post_id": 48019696, "comment_id": 83008604, "body": "i will get this html form in response from one of the http request"}, {"owner": {"reputation": 18865, "user_id": 1990451, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/kffVz.jpg?s=128&g=1", "display_name": "smnbbrv", "link": "https://stackoverflow.com/users/1990451/smnbbrv"}, "edited": false, "score": 0, "creation_date": 1514537181, "post_id": 48019696, "comment_id": 83008642, "body": "and what is your question? I still do not get it"}, {"owner": {"reputation": 73, "user_id": 8499218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c9eb596194db6f333c1e819615b8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "user8499218", "link": "https://stackoverflow.com/users/8499218/user8499218"}, "reply_to_user": {"reputation": 18865, "user_id": 1990451, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/kffVz.jpg?s=128&g=1", "display_name": "smnbbrv", "link": "https://stackoverflow.com/users/1990451/smnbbrv"}, "edited": false, "score": 0, "creation_date": 1514537524, "post_id": 48019696, "comment_id": 83008758, "body": "send this html form to url provided in action parameter in same way as it is done while submitting from a browser"}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 0, "last_activity_date": 1514539226, "creation_date": 1514539226, "answer_id": 48020221, "question_id": 48019696, "link": "https://stackoverflow.com/questions/48019696/how-to-send-an-html-form-with-values-filled/48020221#48020221", "title": "How to send an html form with values filled", "body": "<p>If I understand you correctly, you have to work with an HTML form as opposed to just the input values, and you want to send the input contained in that form to some other server for processing, and you also want to do this programmatically with Go as opposed to clicking on a button inside a browser.</p>\n\n<p>If I got that right, what you have to do is first get the input values, action url, and method from the form. You can do that by using <a href=\"https://godoc.org/golang.org/x/net/html\" rel=\"nofollow noreferrer\">golang.org/x/net/html</a> for example.</p>\n\n<p>After you have all the necessary values you'll have to encode the input values into a valid <code>application/x-www-form-urlencoded</code> string which you can do using the <a href=\"https://golang.org/pkg/net/url/\" rel=\"nofollow noreferrer\">net/url</a> package.</p>\n\n<p>Then all you have to do is to create an http request with <a href=\"https://golang.org/pkg/net/http/#NewRequest\" rel=\"nofollow noreferrer\">http.NewRequest</a> using the form method and action url as it's first two arguments and the urlencoded string as it's last <code>body</code> argument. (You can use <a href=\"https://golang.org/pkg/strings/#NewReader\" rel=\"nofollow noreferrer\">strings.NewReader</a> to turn a <code>string</code> into an <code>io.Reader</code>.)</p>\n\n<p>Finally call <a href=\"https://golang.org/pkg/net/http/#Client.Do\" rel=\"nofollow noreferrer\">http.Client.Do</a> on the <a href=\"https://golang.org/pkg/net/http/#DefaultClient\" rel=\"nofollow noreferrer\">http.DefaultClient</a> with the newly created request as it's argument.</p>\n\n<hr>\n\n<p>It's possible that there are some 3rd party packages that do most of this work for you, so if you want to avoid doing this yourself try searching through github.</p>\n"}], "owner": {"reputation": 73, "user_id": 8499218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c9eb596194db6f333c1e819615b8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "user8499218", "link": "https://stackoverflow.com/users/8499218/user8499218"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1514539226, "creation_date": 1514536217, "question_id": 48019696, "link": "https://stackoverflow.com/questions/48019696/how-to-send-an-html-form-with-values-filled", "title": "How to send an html form with values filled", "body": "<p>Basically i have a html form as string </p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;form class=\"form login_form\" action=\"https://app.box.com/api/oauth2/authorize?response_type=code&amp;amp;redirect_uri=http://localhost:8080/&amp;amp;client_id=6n8aeye40bowhwz&amp;amp;state=V8eTbbtXbsV\" method=\"post\" name=\"login_form\"&gt;\r\n\t\r\n\r\n      &lt;ul class=\"container error_container basic_list basic_list_sm hidden\"&gt;&lt;li class=\"data plm warning ram pas man\"&gt;&lt;div class=\"media pvs\"&gt;&lt;div class=\"img icon\"&gt;&lt;div class=\"sprite_signup_login_icon_error\"&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=\"bd\"&gt;&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;&lt;/ul&gt;\r\n\r\n\t&lt;div class=\"field_set login_fields fw center\"&gt;\r\n\t\t\r\n\r\n\r\n &lt;div class=\"login_user_inputs\"&gt;&lt;label for=\"login\" class=\"field_label user_login_field\"&gt;Email Address&lt;/label&gt;&lt;div class=\"user_login_field text_input_with_sprite text_input_with_sprite_16x16 mbm\"&gt;&lt;input id=\"login\" class=\"text_input login_email ram field_element \" name=\"login\" type=\"email\" title=\"Email Address\" placeholder=\"Email Address\" value=\"email@gmail.com\"&gt; &lt;label class=\"icon\" for=\"login\" title=\"Email Address\"&gt;&lt;/label&gt;&lt;/div&gt;&lt;label for=\"password\" class=\"field_label user_password_field\"&gt;Password&lt;/label&gt;&lt;div class=\"user_password_field text_input_with_sprite text_input_with_sprite_16x16 mbm\"&gt; &lt;input id=\"password\" class=\"text_input login_password ram field_element\" name=\"password\" title=\"Password\" placeholder=\"Password\" type=\"password\" autocapitalize=\"off\" autocomplete=\"off\" autocorrect=\"off\" value=\"passwordstring\"&gt; &lt;label class=\"icon\" for=\"password\" title=\"Password\"&gt;&lt;/label&gt;&lt;/div&gt; &lt;/div&gt; &lt;div class=\"login_submit_div\"&gt;&lt;input class=\"btn btn-primary mhn login_submit fw pvm ram\" title=\"Authorize\" value=\"Authorize\" type=\"submit\" name=\"login_submit\"&gt;&lt;/div&gt;   &lt;input type=\"hidden\" name=\"dologin\" value=\"1\" /&gt;  &lt;input type=\"hidden\" name=\"client_id\" value=\"99hxwc5z7wz\" /&gt;&lt;input type=\"hidden\" name=\"response_type\" value=\"code\" /&gt;&lt;input type=\"hidden\" name=\"redirect_uri\" value=\"http://localhost:8080/\" /&gt;&lt;input type=\"hidden\" name=\"scope\" value=\"root_readwrite manage_groups manage_enterprise_properties manage_app_users manage_managed_users\" /&gt;&lt;input type=\"hidden\" name=\"folder_id\" value=\"\" /&gt;&lt;input type=\"hidden\" name=\"file_id\" value=\"\" /&gt; &lt;input type=\"hidden\" name=\"state\" value=\"Licg8fhDiFyobsV\" /&gt;  &lt;input type=\"hidden\" name=\"reg_step\" value=\"\" /&gt;&lt;input type=\"hidden\" name=\"submit1\" value=\"1\" /&gt;&lt;input type=\"hidden\" name=\"folder\" value=\"\" /&gt;&lt;input type=\"hidden\" name=\"login_or_register_mode\" value=\"login\" /&gt;&lt;input type=\"hidden\" name=\"new_login_or_register_mode\" value=\"\" /&gt;&lt;input type=\"hidden\" name=\"__login\" value=\"1\"&gt;&lt;input type=\"hidden\" name=\"redirect_url\" value=\"/api/oauth2/authorize?response_type=code&amp;amp;redirect_uri=http://localhost:8080/&amp;amp;client_id=99hxwc5z7p9g3z&amp;amp;state=LichV8eTbbtXbsV\"&gt;&lt;input type=\"hidden\" name=\"request_token\" value=\"5d6b31164f15f58bebff206db0aa595eaa90f5f9b857860f8ac3e64c85a5b5f4\"&gt;     &lt;input type=\"hidden\" id=\"_pw_sql\" name=\"_pw_sql\" value=\"\"/&gt; \r\n\r\n\t&lt;/div&gt;\r\n    &lt;div class=\"sso_switch option_sso mts pvs phm hidden\"&gt;\r\n        \r\n        &lt;a href='#' class=\"sso_on\" role=\"button\" tabindex=\"0\"&gt;Use Single Sign On (SSO)&lt;/a&gt;\r\n        \r\n        &lt;a href=\"#\" class=\"sso_off\" tabindex=\"0\"&gt;Use Box account credentials&lt;/a&gt;\r\n    &lt;/div&gt;\r\n&lt;/form&gt;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>and now i want to submit this form to the url specified in action parameter of form tag. Same as it will be submitted from a browser. And condition is i should not use beego webserver for this.\nThanks in advance</p>\n"}, {"tags": ["go", "lambda"], "comments": [{"owner": {"reputation": 98, "user_id": 8862808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41b7e30f64c8992897bd2668a35ede46?s=128&d=identicon&r=PG&f=1", "display_name": "lucas alcantara", "link": "https://stackoverflow.com/users/8862808/lucas-alcantara"}, "edited": false, "score": 3, "creation_date": 1514536321, "post_id": 48019151, "comment_id": 83008311, "body": "I think this question has been answered <a href=\"https://stackoverflow.com/questions/11766320/does-go-have-lambda-expressions-or-anything-similiar\">here</a>."}], "answers": [{"tags": [], "owner": {"reputation": 1374, "user_id": 560561, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6c5947ff77ff642f370d78017cf04fc?s=128&d=identicon&r=PG", "display_name": "fzerorubigd", "link": "https://stackoverflow.com/users/560561/fzerorubigd"}, "is_accepted": false, "score": 4, "last_activity_date": 1514541906, "creation_date": 1514541906, "answer_id": 48020808, "question_id": 48019151, "link": "https://stackoverflow.com/questions/48019151/lambda-expressions-in-go-language/48020808#48020808", "title": "Lambda Expressions in GO Language", "body": "<p>try this : </p>\n\n<pre><code>func Test(n int, x string) {\n    fmt.Println(n, x)\n}\nfunc main() {\n    myFunc := func(x string) { Test(123, x) }\n    myFunc(\"hello\")\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/T6eNtGO8sWO\" rel=\"nofollow noreferrer\">playground</a></p>\n"}], "owner": {"reputation": 37, "user_id": 1509736, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/640b434ae1b7b7249f30bb58c86bb8d9?s=128&d=identicon&r=PG", "display_name": "aamir", "link": "https://stackoverflow.com/users/1509736/aamir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 776, "favorite_count": 0, "closed_date": 1514548513, "answer_count": 1, "score": -1, "last_activity_date": 1514541906, "creation_date": 1514532910, "last_edit_date": 1514540113, "question_id": 48019151, "link": "https://stackoverflow.com/questions/48019151/lambda-expressions-in-go-language", "closed_reason": "Duplicate", "title": "Lambda Expressions in GO Language", "body": "<p>In C#, we can write something like following using lambda expression, how can we achieve this in GO language? Basically, I am looking for an ability to pass some params to the function upfront and some params later when they are available.</p>\n\n<pre><code>myFunc = (x) =&gt; Test(123, x) // Method Test is declared below.\nmyFunc(\"hello\") // this calls method Test with params int 123 &amp; string \"hello\" where int was passed upfront whereas string was passed when Test is actually called on this line\n\nvoid Test(int n, string x)\n{\n    // ...\n}\n</code></pre>\n"}, {"tags": ["go", "slice", "custom-type"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1514525761, "post_id": 48017423, "comment_id": 83004790, "body": "<a href=\"https://golang.org/doc/faq#convert_slice_with_same_underlying_type\" rel=\"nofollow noreferrer\">golang.org/doc/faq#convert_slice_with_same_underlying_type</a>"}, {"owner": {"reputation": 2951, "user_id": 2736817, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/38f596a60d51c899ee86eaec38ec8efe?s=128&d=identicon&r=PG&f=1", "display_name": "tom10271", "link": "https://stackoverflow.com/users/2736817/tom10271"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1514529037, "post_id": 48017423, "comment_id": 83005719, "body": "Thank you for your link @CeriseLim&#243;n"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514542220, "post_id": 48017423, "comment_id": 83010693, "body": "Note that you can&#39;t cast <i>anything</i> in Go. Go doesn&#39;t do type casting, only type conversion."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514542308, "post_id": 48017423, "comment_id": 83010742, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/22779787/how-could-i-convert-an-interface-into-a-string-in-go\">How could I convert an &#91;&#93;interface{} into a &#91;&#93;string in Go?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1958, "user_id": 3217013, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8fe4c19ed2edcb4fe6e661a5faed0205?s=128&d=identicon&r=PG&f=1", "display_name": "Emil", "link": "https://stackoverflow.com/users/3217013/emil"}, "is_accepted": true, "score": 2, "last_activity_date": 1514523166, "creation_date": 1514523166, "answer_id": 48017567, "question_id": 48017423, "link": "https://stackoverflow.com/questions/48017423/how-to-cast-custom-type-slice-to-primitive-slice-in-golang/48017567#48017567", "title": "How to cast custom type slice to primitive slice in Golang?", "body": "<p>Yes, you have to copy it manually with a for loop.</p>\n"}], "owner": {"reputation": 2951, "user_id": 2736817, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/38f596a60d51c899ee86eaec38ec8efe?s=128&d=identicon&r=PG&f=1", "display_name": "tom10271", "link": "https://stackoverflow.com/users/2736817/tom10271"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 512, "favorite_count": 0, "accepted_answer_id": 48017567, "answer_count": 1, "score": 0, "last_activity_date": 1514523166, "creation_date": 1514521881, "question_id": 48017423, "link": "https://stackoverflow.com/questions/48017423/how-to-cast-custom-type-slice-to-primitive-slice-in-golang", "title": "How to cast custom type slice to primitive slice in Golang?", "body": "<pre><code>type TCustomIntType int\n\nfunc aFunc() {\n    var fails []TCustomIntType = []TCustomIntType([]int{})\n}\n</code></pre>\n\n<p>I got:</p>\n\n<p><code>cannot convert []int literal (type []int) to type []TCustomIntType</code></p>\n\n<p>How to fix it? Do I have to write a convert func manually?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2201, "user_id": 3359432, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5d48edbf794415b7f16c19c50d8cc524?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhin David", "link": "https://stackoverflow.com/users/3359432/nidhin-david"}, "edited": false, "score": 0, "creation_date": 1514524372, "post_id": 48016693, "comment_id": 83004464, "body": "Could you please try without printing the buffer? Somewhere I read thet buffers can be consumed only once!"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1514542922, "post_id": 48016693, "comment_id": 83011037, "body": "Don&#39;t ignore errors"}, {"owner": {"reputation": 1055, "user_id": 4205792, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0297dc684ce4aad71243b4e66d9e9f13?s=128&d=identicon&r=PG&f=1", "display_name": "dangeroushobo", "link": "https://stackoverflow.com/users/4205792/dangeroushobo"}, "edited": false, "score": 0, "creation_date": 1514552905, "post_id": 48016693, "comment_id": 83015331, "body": "I check for errors and print them."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1514554682, "post_id": 48016693, "comment_id": 83016023, "body": "Perhaps, the server expect that you set the content type correctly instead of <code>application&#47;octet-stream</code>, i.e. <code>text&#47;xml</code> or <code>application&#47;xml</code>? In this case, instead of using <code>CreateFormFile</code>, please use <code>CreatePart</code> then set the content type manually."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1514555059, "post_id": 48016693, "comment_id": 83016157, "body": "One more thing, the printed request method is <code>GET</code>, but in your code, you&#39;re using <code>POST</code>. Did you print the correct one?"}], "answers": [{"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 0, "last_activity_date": 1514516643, "creation_date": 1514516643, "answer_id": 48016921, "question_id": 48016693, "link": "https://stackoverflow.com/questions/48016693/multipart-http-request-in-go/48016921#48016921", "title": "Multipart http request in Go", "body": "<p>I highly doubt if the server really received nothing. The behavior of the printed body having a nil body is expected and documented in <code>http.Response</code></p>\n\n<pre><code>    // Request is the request that was sent to obtain this Response.\n    // Request's Body is nil (having already been consumed).\n    // This is only populated for Client requests.\n    Request *Request\n</code></pre>\n\n<p>If you want to debug the request body sented, you should either use a mock server or a proxy.</p>\n\n<p>On another note, your code's attempt to login is not going to work. It does not maintain the cookie of login info, so the later requests cannot utilize them.</p>\n"}], "owner": {"reputation": 1055, "user_id": 4205792, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0297dc684ce4aad71243b4e66d9e9f13?s=128&d=identicon&r=PG&f=1", "display_name": "dangeroushobo", "link": "https://stackoverflow.com/users/4205792/dangeroushobo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1731, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1514542896, "creation_date": 1514514597, "last_edit_date": 1514542896, "question_id": 48016693, "link": "https://stackoverflow.com/questions/48016693/multipart-http-request-in-go", "title": "Multipart http request in Go", "body": "<p>I'm attempting to use Go to write a utility that authenticates and uploads a file by making a multipart http request to our server. Everything seems to go okay, except the file is not arriving on the server. Looking at it further it appears the multipart in the request is empty. Code and request output below. What am I missing in my Go code?</p>\n\n<p>The Code: (I've changed the URL...)</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"mime/multipart\"\n    \"strings\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"io\"\n    \"os\"\n    \"bytes\"\n    \"flag\"\n    \"encoding/json\"\n)\n\nvar (\n    filename = flag.String(\"filename\", \"\", \"file to upload\")\n    name = flag.String(\"name\", \"\", \"name to give file on server\")\n    username = flag.String(\"username\", \"\", \"username for authentication\")\n    password = flag.String(\"password\", \"\", \"password for authentication\")\n)\n\nfunc main() {\n    flag.Parse()\n\n    // Create multipart\n    var b bytes.Buffer\n    w := multipart.NewWriter(&amp;b)\n    f, _ := os.Open(*filename) //open file to send\n    defer f.Close()\n    fw, err := w.CreateFormFile(\"file\", *name) //give file a name\n    if err != nil {\n        fmt.Println(err)\n    }\n    if _, err :=  io.Copy(fw, f); err != nil { //copy the file to the multipart buffer\n        fmt.Println(err)\n    }\n    w.Close()\n\n    // print the head of the multipart data\n    bs := b.Bytes()\n    fmt.Printf(\"%+v\\n\\n\", string(bs[:1000]))\n\n    // Send authentication/login\n    r, e := http.Post(\"https://mysite/login\", \"application/json\", strings.NewReader(fmt.Sprintf(\"{\\\"username\\\":\\\"%s\\\",\\\"password\\\":\\\"%s\\\"}\", *username, *password)))\n\n    if e != nil {\n        fmt.Println(e)\n    } else {\n        // Get the token from the body\n        type Body struct {\n            Token string\n        }\n        // convert json to get the token\n        body, _ := ioutil.ReadAll(r.Body)\n        bd := bytes.NewBuffer(body)\n        dec := json.NewDecoder(bd)\n        var m Body\n        dec.Decode(&amp;m)\n\n        // Upload file\n        req, err := http.NewRequest(\"POST\", \"https://mysite/api/apps\", &amp;b)\n        if err != nil {\n            fmt.Printf(\"%v\\n\", err)\n        }\n        req.Header.Set(\"Authentication\", fmt.Sprintf(\"Bearer: %s\", m.Token))\n        req.Header.Set(\"Content-Type\", w.FormDataContentType())\n        client := &amp;http.Client{}\n        res, err := client.Do(req)\n        if err != nil {\n            fmt.Printf(\"%v\\n\", err)\n        }\n        // print status and request body\n        fmt.Println(res.Status)\n        fmt.Printf(\"%+v\\n\", res.Request)\n    }\n}\n</code></pre>\n\n<p>The first thing I print is the byte buffer, b, which contains the multipart data, everything looks good from here. (it was an xml file)</p>\n\n<pre><code>--83451b003d8e5cc38c0e8f60ad318e522cad4818cf293745c84ec36d26d5\nContent-Disposition: form-data; name=\"file\"; filename=\"snapshot-162224-820-99\"\nContent-Type: application/octet-stream\n\n&lt;manifest&gt;\n  &lt;projects&gt;\n    &lt;project name=........\n</code></pre>\n\n<p>Next I print the status of the request.</p>\n\n<pre><code>200 OK\n</code></pre>\n\n<p>Then I printed out the request structure, here is where I saw the MultipartForm was empty.</p>\n\n<pre><code>&amp;{Method:GET URL:https://mysite/home/ Proto: ProtoMajor:0 ProtoMinor:0 Header:map[Authentication:[Bearer: DY0LCJL0g] Content-Type:[multipart/form-data; boundary=83451b003d8e5cc38c0e8f60ad318e522cad4818cf293745c84ec36d26d5] Referer:[http://mysite/home/]] Body:&lt;nil&gt; GetBody:&lt;nil&gt; ContentLength:0 TransferEncoding:[] Close:false Host: Form:map[] PostForm:map[] MultipartForm:&lt;nil&gt; Trailer:map[] RemoteAddr: RequestURI: TLS:&lt;nil&gt; Cancel:&lt;nil&gt; Response:0xc42018a360 ctx:&lt;nil&gt;}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1369, "user_id": 4748326, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/6kUjW.jpg?s=128&g=1", "display_name": "Alexis", "link": "https://stackoverflow.com/users/4748326/alexis"}, "edited": false, "score": 0, "creation_date": 1514515399, "post_id": 48016637, "comment_id": 83002815, "body": "No other Go-native solution ? Is this solution working with any []byte&#39;s length ? Since slice&#39;s memory map isn&#39;t contiguous, I wonder how unsafe package can handle it without altering performance by copying or... will check with benchmark."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1369, "user_id": 4748326, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/6kUjW.jpg?s=128&g=1", "display_name": "Alexis", "link": "https://stackoverflow.com/users/4748326/alexis"}, "edited": false, "score": 2, "creation_date": 1514516599, "post_id": 48016637, "comment_id": 83003032, "body": "@Alexis_FR_JP, This is Go native, and a slice is always contiguous."}, {"owner": {"reputation": 1369, "user_id": 4748326, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/6kUjW.jpg?s=128&g=1", "display_name": "Alexis", "link": "https://stackoverflow.com/users/4748326/alexis"}, "edited": false, "score": 0, "creation_date": 1514524438, "post_id": 48016637, "comment_id": 83004474, "body": "Great, I avoided using <code>unsafe</code> because of the name and because I heard Rob Pike saying we shouldn&#39;t go in production with an app that imports <code>unsafe</code>. Need to focus more on it then. Thank you!"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1514553990, "post_id": 48016637, "comment_id": 83015744, "body": "Don&#39;t do that. Just don&#39;t. In <i>this</i> case (<code>uint8</code> fields) I cannot imagine a case where it will fail, but for more complicated cases, it will fail\u2014say, due to strict alignment rules you won&#39;t be able to &quot;cast&quot; a byte slice to something like <code>type t struct { a int32; b byte; c int32 }</code> as the compiler will pad <code>b</code> with 3 bytes so that <code>c</code> ends up at an address which is evenly divisible by 4. There are also endianness issues\u2014what if your program tested on a little-endian machine tomorrow will read the same data on a big-endian machine?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1514554075, "post_id": 48016637, "comment_id": 83015777, "body": "Consider reading <a href=\"https://dave.cheney.net/2015/10/09/padding-is-hard\" rel=\"nofollow noreferrer\">this</a> and <a href=\"https://dave.cheney.net/2014/03/25/the-empty-struct\" rel=\"nofollow noreferrer\">this</a> for a start."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1514554104, "post_id": 48016637, "comment_id": 83015790, "body": "The proper approach is to use the <code>encoding&#47;binary</code> package to explicitly read your data from the slice to the struct fields."}, {"owner": {"reputation": 1369, "user_id": 4748326, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/6kUjW.jpg?s=128&g=1", "display_name": "Alexis", "link": "https://stackoverflow.com/users/4748326/alexis"}, "edited": false, "score": 0, "creation_date": 1515025873, "post_id": 48016637, "comment_id": 83149136, "body": "Happy New Year! The purpose of this is to send a pointer of a struct to a combined/PCIe driver (connected to a FPGA). I used to add the alignment/padding by myself in the structure by adding dummy field to align to 4B, I don&#39;t use 64b values."}, {"owner": {"reputation": 1369, "user_id": 4748326, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/6kUjW.jpg?s=128&g=1", "display_name": "Alexis", "link": "https://stackoverflow.com/users/4748326/alexis"}, "edited": false, "score": 0, "creation_date": 1515027563, "post_id": 48016637, "comment_id": 83149487, "body": "I will focus more on <code>encoding&#47;binary</code> library, I focused on Go rather than Nodejs for the low-level ability, hope I wont be disappointed. Thanks for your replies !"}], "tags": [], "owner": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "is_accepted": true, "score": 4, "last_activity_date": 1514514528, "last_edit_date": 1514514528, "creation_date": 1514513889, "answer_id": 48016637, "question_id": 48016550, "link": "https://stackoverflow.com/questions/48016550/how-to-cast-a-byte-with-a-pointer-of-struct/48016637#48016637", "title": "How to cast a []byte with a pointer of struct?", "body": "<p>You can cast <code>unsafe.Pointer</code> to <code>*myStruct</code> passing pointer to the first element of the bytes slice:</p>\n\n<pre><code>import \"unsafe\"\n...\nobj = (*myStruct)(unsafe.Pointer(&amp;data[0]))\n</code></pre>\n\n<p>test: <a href=\"https://play.golang.org/p/c7XO3dPKcLu\" rel=\"nofollow noreferrer\">https://play.golang.org/p/c7XO3dPKcLu</a></p>\n"}], "owner": {"reputation": 1369, "user_id": 4748326, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/6kUjW.jpg?s=128&g=1", "display_name": "Alexis", "link": "https://stackoverflow.com/users/4748326/alexis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1193, "favorite_count": 0, "accepted_answer_id": 48016637, "answer_count": 1, "score": 1, "last_activity_date": 1514514528, "creation_date": 1514513057, "question_id": 48016550, "link": "https://stackoverflow.com/questions/48016550/how-to-cast-a-byte-with-a-pointer-of-struct", "title": "How to cast a []byte with a pointer of struct?", "body": "<p>I'd like to use Go for low level project and avoid copying data.</p>\n\n<p>I have a struct of fixed size:</p>\n\n<pre><code>type myStruct struct {\n    a    uint8\n    b    uint8\n}\n</code></pre>\n\n<p>I would like to cast a <code>pointer of my struct</code> with this <code>slice of bytes</code> in order to read the value as if the slice of bytes was a struct without copying anything.</p>\n\n<pre><code>data := []byte{69,0}\n\nvar obj *myStruct\n\n//something like:\nobj = myStruct(data)\n// or\nobj = &amp;myStruct(data)\n</code></pre>\n\n<p>In C it would be: <code>obj = (struct myStruct*) data;</code></p>\n\n<ul>\n<li><strong>Is it possible ? What are the solutions to do so ? The best practice ?</strong></li>\n</ul>\n\n<p><em>I'd like to void using offset and index for the []byte.</em></p>\n\n<p><em>Since a slice is not a fixed memory, I guess it'd be possible by converting <code>[]byte</code> into a fixed array <code>byte[0:2]</code>.</em></p>\n"}, {"tags": ["file", "go"], "comments": [{"owner": {"reputation": 930, "user_id": 2945940, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bbd95bb0d1468cd30e4f0edc1c47790?s=128&d=identicon&r=PG&f=1", "display_name": "Kaizhe Huang", "link": "https://stackoverflow.com/users/2945940/kaizhe-huang"}, "edited": false, "score": 0, "creation_date": 1514510713, "post_id": 48016235, "comment_id": 83001920, "body": "I don&#39;t think <code>os.FileInfo</code> is sufficient or by checking the file extension. Unless you scan the file content to see whether the file contain non text character (ASCII or UNICODE)"}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1514511460, "post_id": 48016235, "comment_id": 83002072, "body": "I don&#39;t think the question is how to identify text files by the file name, but rather how to identify text files by looking at the content. If that&#39;s the case, the only thing you can do is inspect the contents of the file. If by &quot;text file&quot; you mean UTF-8, you can use functions in the <code>utf8</code> package to determine if the file contains valid UTF-8."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1514542971, "post_id": 48016235, "comment_id": 83011052, "body": "Write a function that checks each file, according to whatever definition of &quot;text file&quot; you find appropriate. If you have problems with that, show us your code, and explain your specific problem."}, {"owner": {"reputation": 18759, "user_id": 2226988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c6fbec3a71b2e95e4a6e41478deb379?s=128&d=identicon&r=PG", "display_name": "Tom Blodget", "link": "https://stackoverflow.com/users/2226988/tom-blodget"}, "edited": false, "score": 0, "creation_date": 1514591136, "post_id": 48016235, "comment_id": 83029314, "body": "Yes, what is this thing you call a &quot;text file?&quot; It seems like something humans know about their own files but don&#39;t bother telling their machines."}, {"owner": {"reputation": 1242, "user_id": 804707, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/af86b492c2772884b20791e8298595d9?s=128&d=identicon&r=PG", "display_name": "The Puma", "link": "https://stackoverflow.com/users/804707/the-puma"}, "edited": false, "score": 0, "creation_date": 1514648039, "post_id": 48016235, "comment_id": 83040549, "body": "I realize this is now highly subjective. I think the fastest way (although not infallible) would be to check a portion of the file for valid utf8 characters"}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 1, "last_activity_date": 1514563465, "last_edit_date": 1514563465, "creation_date": 1514562300, "answer_id": 48024982, "question_id": 48016235, "link": "https://stackoverflow.com/questions/48016235/how-do-you-find-only-text-files-using-filepath-walk/48024982#48024982", "title": "How do you find only text files using filepath.Walk()?", "body": "<p>The only way to know if a file (or any byte stream) contains only \"text\" is to read the entire contents of the stream and determine if every rune is a \"text\" character according to your definition.</p>\n\n<p>For example, one might consider a file \"ASCII text\" if all runes have integer values in <code>[0,128]</code>, are not control characters, or are whitespace:</p>\n\n<pre><code>func isASCIITextStream(rd io.Reader) (bool, error) {\n    reader := bufio.NewReader(rd)\n    for {\n        r, _, err := reader.ReadRune()\n        if err == io.EOF {\n            return true, nil // Every rune was text.\n        }\n        if err != nil {\n            return false, err // Unexpected error.\n        }\n        if !isASCIIText(r) {\n            return false, nil // At least one rune was not text.\n        }\n    }\n    return true, fmt.Errorf(\"did not find EOF\") // Unexpected state.\n}\n\nfunc isASCIIText(r rune) bool {\n    x := int64(r)\n    return (x &gt;= 0) &amp;&amp; (x &lt;= 128) &amp;&amp; (!unicode.IsControl(r) || unicode.IsSpace(r))\n}\n</code></pre>\n\n<p>Of course, most people would consider many other Unicode character classes as containing \"text\", so whatever your approach is, the <a href=\"https://golang.org/pkg/unicode/\" rel=\"nofollow noreferrer\"><code>unicode</code></a> package will likely be helpful for classifying runes.</p>\n"}], "owner": {"reputation": 1242, "user_id": 804707, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/af86b492c2772884b20791e8298595d9?s=128&d=identicon&r=PG", "display_name": "The Puma", "link": "https://stackoverflow.com/users/804707/the-puma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 48024982, "answer_count": 1, "score": -2, "last_activity_date": 1514563465, "creation_date": 1514509546, "question_id": 48016235, "link": "https://stackoverflow.com/questions/48016235/how-do-you-find-only-text-files-using-filepath-walk", "title": "How do you find only text files using filepath.Walk()?", "body": "<p>I'm using <code>filepath.Walk()</code> to search through all the files in a directory. I'm implementing a search tool, so I'm only interested in opening files with text in them. I'm wondering if there's a way to ignore stuff like binary files that I wouldn't want to search through. I'm trying to minimize os calls, so it would be great if this could be done with just <code>os.FileInfo</code>.</p>\n"}, {"tags": ["go", "ssh", "key-pair"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1514508602, "post_id": 48016118, "comment_id": 83001507, "body": "The documentation for <a href=\"https://godoc.org/golang.org/x/crypto/ssh#ParsePublicKey\" rel=\"nofollow noreferrer\"><code>ParsePublicKey</code></a> says it parses public keys in wire format, not the on disk format used by openssh."}, {"owner": {"reputation": 665, "user_id": 4411182, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-y6ywJeM9H7I/AAAAAAAAAAI/AAAAAAAAAHY/NY5Ggehfnxc/photo.jpg?sz=128", "display_name": "George Edward Shaw IV", "link": "https://stackoverflow.com/users/4411182/george-edward-shaw-iv"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1514508686, "post_id": 48016118, "comment_id": 83001524, "body": "Wasn&#39;t aware that there were multiple formats, is there a way to convert to wire format? @JimB"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1514509090, "post_id": 48016118, "comment_id": 83001598, "body": "You don\u2019t need to parse anything, id_rsa.pub <i>is</i> the authorized_keys format. Most people add them on the cli just by appending them directly to the authorized_keys file."}, {"owner": {"reputation": 665, "user_id": 4411182, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-y6ywJeM9H7I/AAAAAAAAAAI/AAAAAAAAAHY/NY5Ggehfnxc/photo.jpg?sz=128", "display_name": "George Edward Shaw IV", "link": "https://stackoverflow.com/users/4411182/george-edward-shaw-iv"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1514509408, "post_id": 48016118, "comment_id": 83001654, "body": "The reason I&#39;m trying to convert it into a <code>ssh.PublicKey</code> interface is because <a href=\"https://godoc.org/golang.org/x/crypto/ssh#MarshalAuthorizedKey\" rel=\"nofollow noreferrer\"><code>MarshalAuthorizedKey</code></a> takes in a <code>ssh.PublicKey</code> interface and returns an authorized key ready to be appended to the authorized_keys file. Do they only have this function to get the key back into the format that it was on the disk? @JimB"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1514509955, "post_id": 48016118, "comment_id": 83001759, "body": "No, they have that function for when you don\u2019t already have a .pub file."}, {"owner": {"reputation": 665, "user_id": 4411182, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-y6ywJeM9H7I/AAAAAAAAAAI/AAAAAAAAAHY/NY5Ggehfnxc/photo.jpg?sz=128", "display_name": "George Edward Shaw IV", "link": "https://stackoverflow.com/users/4411182/george-edward-shaw-iv"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1514509999, "post_id": 48016118, "comment_id": 83001766, "body": "Oh okay, thank you for your help @JimB"}], "answers": [{"tags": [], "owner": {"reputation": 1258, "user_id": 157422, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/9d2d3de9233e69e167115409fa421aa8?s=128&d=identicon&r=PG", "display_name": "royvandewater", "link": "https://stackoverflow.com/users/157422/royvandewater"}, "is_accepted": true, "score": 7, "last_activity_date": 1514990097, "creation_date": 1514990097, "answer_id": 48079454, "question_id": 48016118, "link": "https://stackoverflow.com/questions/48016118/crypto-ssh-parsepublickey-short-read-error/48079454#48079454", "title": "crypto/ssh ParsePublicKey &quot;short read&quot; error", "body": "<p>I think some of the comments to the question lead at this, but the function <code>ssh.ParseAuthorizedKey([]byte)</code> is able to read interpret the file at <code>~/.ssh/id_rsa.pub</code>.</p>\n\n<p><a href=\"https://godoc.org/golang.org/x/crypto/ssh#ParseAuthorizedKey\" rel=\"noreferrer\">https://godoc.org/golang.org/x/crypto/ssh#ParseAuthorizedKey</a></p>\n\n<p>Your example should work like this:</p>\n\n<pre><code>b, err := ioutil.ReadFile(os.Args[1])\nif err != nil {\n    log.Fatalf(\"Fatal error trying to read new public key file: %s\", err)\n}\n\nnewAuthorizedKey, _, _, _, err := ssh.ParseAuthorizedKey(b)\nif err != nil {\n    log.Fatalf(\"Fatal error trying to parse new public key: %s\", err)\n}\n</code></pre>\n"}], "owner": {"reputation": 665, "user_id": 4411182, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-y6ywJeM9H7I/AAAAAAAAAAI/AAAAAAAAAHY/NY5Ggehfnxc/photo.jpg?sz=128", "display_name": "George Edward Shaw IV", "link": "https://stackoverflow.com/users/4411182/george-edward-shaw-iv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1627, "favorite_count": 1, "accepted_answer_id": 48079454, "answer_count": 1, "score": 3, "last_activity_date": 1514990097, "creation_date": 1514508344, "question_id": 48016118, "link": "https://stackoverflow.com/questions/48016118/crypto-ssh-parsepublickey-short-read-error", "title": "crypto/ssh ParsePublicKey &quot;short read&quot; error", "body": "<p>In a program I am developing I need a way to add public keys into the authorized_keys file during development, so I am using command line arguments to do so.</p>\n\n<p>I have omitted most of the code, but if you would like to view all of the code, <a href=\"https://github.com/george-e-shaw-iv/interactive-shell\" rel=\"nofollow noreferrer\">here is the repository</a>, with the problem line being located in main.go on line 20.</p>\n\n<pre><code>b, err := ioutil.ReadFile(os.Args[1])\nif err != nil {\n    log.Fatalf(\"Fatal error trying to read new public key file: %s\", err)\n}\n\nnewAuthorizedKey, err := ssh.ParsePublicKey(b)\nif err != nil {\n    log.Fatalf(\"Fatal error trying to parse new public key: %s\", err)\n}\n</code></pre>\n\n<p>The \"short read\" error comes from the <code>ssh.ParsePublicKey</code> function. The command line argument that I am passing in is the location of a public key to add to the authorized_keys file of this program (e.g. <code>~/.ssh/id_rsa.pub</code>). I have ensured that the file is correctly being passed into the program.</p>\n\n<p>I have looked at the source code in hopes of debugging this \"short read\" error, but I can't figure out what is going on. The location for source code of the <code>ParsePublicKey</code> function in <code>crypto/ssh</code> is located <a href=\"https://github.com/golang/crypto/blob/master/ssh/keys.go#L246\" rel=\"nofollow noreferrer\">here</a>, and the location of source code of the <code>parseString</code> function, which is what the <code>ParsePublicKey</code> function is using to generate the \"short read\" error, is located <a href=\"https://github.com/golang/crypto/blob/master/ssh/messages.go#L519\" rel=\"nofollow noreferrer\">here</a>, also in <code>crypto/ssh</code>.</p>\n"}]