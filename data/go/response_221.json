[{"tags": ["go", "github", "module"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554321063, "post_id": 55503167, "comment_id": 97712680, "body": "The error isn&#39;t that it can&#39;t find it, it is <code>unknown revision v0.1.5</code> - meaning it did find it, but that git tag doesn&#39;t exist."}, {"owner": {"reputation": 585, "user_id": 497857, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/886f1df95cb2acd12d921ce12c253b0e?s=128&d=identicon&r=PG", "display_name": "Ravenwater", "link": "https://stackoverflow.com/users/497857/ravenwater"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554321247, "post_id": 55503167, "comment_id": 97712773, "body": "@adrian, the tag exists in the repo, as its existence made it to the go.mod file on computer A. Just can&#39;t get to use it on computer B, and I would like to understand why. That whole private domain (github.ibm.com) does not get created in the mod cache, which I think is the reason why the tag can&#39;t be found on computer B."}, {"owner": {"reputation": 1047, "user_id": 10443472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/051b4da9def21dd0ff5e10f383a96c94?s=128&d=identicon&r=PG", "display_name": "retgits", "link": "https://stackoverflow.com/users/10443472/retgits"}, "edited": false, "score": 1, "creation_date": 1554324994, "post_id": 55503167, "comment_id": 97714473, "body": "Not sure if it is possible with IBM&#39;s GitHub instance, but a potential solution can be found in the answer to this question on SO: <a href=\"https://stackoverflow.com/questions/53516358/golang-modules-private-repos-and-gopath\" title=\"golang modules private repos and gopath\">stackoverflow.com/questions/53516358/&hellip;</a> (using a GITHUB_TOKEN)."}, {"owner": {"reputation": 585, "user_id": 497857, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/886f1df95cb2acd12d921ce12c253b0e?s=128&d=identicon&r=PG", "display_name": "Ravenwater", "link": "https://stackoverflow.com/users/497857/ravenwater"}, "reply_to_user": {"reputation": 1047, "user_id": 10443472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/051b4da9def21dd0ff5e10f383a96c94?s=128&d=identicon&r=PG", "display_name": "retgits", "link": "https://stackoverflow.com/users/10443472/retgits"}, "edited": false, "score": 0, "creation_date": 1554326323, "post_id": 55503167, "comment_id": 97714959, "body": "@retgits it indeed has something to do with access: it is not picking up the right protocol, and I haven&#39;t found guidance how to control it inside the go build tool. There are multiple git identities on computer B and my local git config specialized for that repo doesn&#39;t seem to control the protocol, so it is using https where it needs to use the token."}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 1, "creation_date": 1554326865, "post_id": 55503167, "comment_id": 97715131, "body": "Can you clone github.ibm.com/kms/key-protect-client on computer B using git command line? If not, it sounds like it is more of a git problem than a go problem."}, {"owner": {"reputation": 585, "user_id": 497857, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/886f1df95cb2acd12d921ce12c253b0e?s=128&d=identicon&r=PG", "display_name": "Ravenwater", "link": "https://stackoverflow.com/users/497857/ravenwater"}, "reply_to_user": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1554384429, "post_id": 55503167, "comment_id": 97738952, "body": "@MadWombat I can clone the repo via ssh on computer B. However, when I look at what go build is doing, it is trying to pull via https and that fails. How do I control the go build process to use public and private repos given some particular git identity?"}, {"owner": {"reputation": 585, "user_id": 497857, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/886f1df95cb2acd12d921ce12c253b0e?s=128&d=identicon&r=PG", "display_name": "Ravenwater", "link": "https://stackoverflow.com/users/497857/ravenwater"}, "reply_to_user": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1554384761, "post_id": 55503167, "comment_id": 97739209, "body": "@MadWombat inside the private repo I am using a local .git override, so that my git credentials are correct for this tree. However, from what I can tell, go seems to pick up the global git identity. Haven&#39;t found any docs yet that explain how to specialize go mod to use a specific git identity."}, {"owner": {"reputation": 585, "user_id": 497857, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/886f1df95cb2acd12d921ce12c253b0e?s=128&d=identicon&r=PG", "display_name": "Ravenwater", "link": "https://stackoverflow.com/users/497857/ravenwater"}, "edited": false, "score": 0, "creation_date": 1554385330, "post_id": 55503167, "comment_id": 97739616, "body": "Yep, that was it. The go build tools pick up the global git identity ignoring the local override. When I set the global .gitconfig to the IBM credentials go build downloads all the private repo dependencies and succeeds."}], "answers": [{"comments": [{"owner": {"reputation": 10306, "user_id": 658497, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/AiHJI.jpg?s=128&g=1", "display_name": "Noam Manos", "link": "https://stackoverflow.com/users/658497/noam-manos"}, "edited": false, "score": 12, "creation_date": 1563432165, "post_id": 55522618, "comment_id": 100699292, "body": "This is an abstract solution - can you write the actual steps/commands for the workaround?"}, {"owner": {"reputation": 585, "user_id": 497857, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/886f1df95cb2acd12d921ce12c253b0e?s=128&d=identicon&r=PG", "display_name": "Ravenwater", "link": "https://stackoverflow.com/users/497857/ravenwater"}, "reply_to_user": {"reputation": 10306, "user_id": 658497, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/AiHJI.jpg?s=128&g=1", "display_name": "Noam Manos", "link": "https://stackoverflow.com/users/658497/noam-manos"}, "edited": false, "score": 0, "creation_date": 1569936737, "post_id": 55522618, "comment_id": 102751494, "body": "This post explains the process in more detail: <a href=\"http://www.thecodedself.com/Using-Multiple-Author-Identities-With-Git/\" rel=\"nofollow noreferrer\">thecodedself.com/Using-Multiple-Author-Identities-With-Git</a>"}], "tags": [], "owner": {"reputation": 585, "user_id": 497857, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/886f1df95cb2acd12d921ce12c253b0e?s=128&d=identicon&r=PG", "display_name": "Ravenwater", "link": "https://stackoverflow.com/users/497857/ravenwater"}, "is_accepted": true, "score": 0, "last_activity_date": 1554401989, "creation_date": 1554401989, "answer_id": 55522618, "question_id": 55503167, "link": "https://stackoverflow.com/questions/55503167/go-build-cant-find-a-revision/55522618#55522618", "title": "go build can&#39;t find a revision", "body": "<p>Problem is related to cmd/go not being aware of git identities and assuming there is only one articulated in the .gitconfig file.</p>\n\n<p>Work-around: have a set of git identities ready to replace global .gitconfig when you need to work with that git identity and are dealing with cmd/go tools that update the module file.</p>\n"}, {"tags": [], "owner": {"reputation": 10306, "user_id": 658497, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/AiHJI.jpg?s=128&g=1", "display_name": "Noam Manos", "link": "https://stackoverflow.com/users/658497/noam-manos"}, "is_accepted": false, "score": 1, "last_activity_date": 1563704064, "creation_date": 1563704064, "answer_id": 57132183, "question_id": 55503167, "link": "https://stackoverflow.com/questions/55503167/go-build-cant-find-a-revision/57132183#57132183", "title": "go build can&#39;t find a revision", "body": "<p>In case getting</p>\n\n<blockquote>\n  <p>\"Error\": \"unknown revision ...\" </p>\n</blockquote>\n\n<p>or</p>\n\n<blockquote>\n  <p>\"Error\": \"invalid version ...\"</p>\n</blockquote>\n\n<p>Make sure that you did not specify <strong>hash of PR</strong> (pull request). Even a merged PR might be wrong. </p>\n\n<p>Look for the commit hash in the github repo \nunder <code>/commits</code>, but not under <code>/pulls</code>. </p>\n\n<p>See more info here: <a href=\"https://github.com/golang/go/issues/31191\" rel=\"nofollow noreferrer\">golang/go#31191</a> explicitly filters out these kind of commits.</p>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 2603297, "user_type": "registered", "profile_image": "https://graph.facebook.com/594085084/picture?type=large", "display_name": "Steven Schkolne", "link": "https://stackoverflow.com/users/2603297/steven-schkolne"}, "is_accepted": false, "score": 0, "last_activity_date": 1568601984, "creation_date": 1568601984, "answer_id": 57949817, "question_id": 55503167, "link": "https://stackoverflow.com/questions/55503167/go-build-cant-find-a-revision/57949817#57949817", "title": "go build can&#39;t find a revision", "body": "<p>In line with some comments above -- I had this problem because my git was fried due to updating to Mojave... the highly upvoted response here (<code>xcode-select --install</code>) got me past this error message <a href=\"https://stackoverflow.com/questions/52522565/git-is-not-working-after-macos-mojave-update-xcrun-error-invalid-active-devel\">Git is not working after macOS Mojave Update (xcrun: error: invalid active developer path (/Library/Developer/CommandLineTools)</a></p>\n\n<p>if you are having this problem make sure your <code>go status</code> etc are working as expected.</p>\n"}, {"comments": [{"owner": {"reputation": 599, "user_id": 888162, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/944ea93d87f2872251a6c05a68c3d4be?s=128&d=identicon&r=PG", "display_name": "Fabio Cicerchia", "link": "https://stackoverflow.com/users/888162/fabio-cicerchia"}, "edited": false, "score": 0, "creation_date": 1594731344, "post_id": 60293104, "comment_id": 111223412, "body": "In case it fails, try forcing on SSH with this one: <code>git config --global url.&quot;ssh:&#47;&#47;yourserver&quot;.insteadOf &quot;yourserver&quot;</code>"}], "tags": [], "owner": {"reputation": 1451, "user_id": 2930836, "user_type": "registered", "accept_rate": 39, "profile_image": "https://lh4.googleusercontent.com/-hOD6KYRyIY4/AAAAAAAAAAI/AAAAAAAAfv0/9V13VHORoHk/photo.jpg?sz=128", "display_name": "igonejack", "link": "https://stackoverflow.com/users/2930836/igonejack"}, "is_accepted": false, "score": 21, "last_activity_date": 1589256005, "last_edit_date": 1589256005, "creation_date": 1582086978, "answer_id": 60293104, "question_id": 55503167, "link": "https://stackoverflow.com/questions/55503167/go-build-cant-find-a-revision/60293104#60293104", "title": "go build can&#39;t find a revision", "body": "<p>Possible solutions for golang unknown revision if you are using private repository:</p>\n\n<ol>\n<li><p><code>git config --global url.\"ssh://git@yourserver\".insteadOf \"https://yourserver\"</code></p></li>\n<li><p>Check your git repository permissions</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 14280653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53e74974d5c598f1617613f2ad909f26?s=128&d=identicon&r=PG&f=1", "display_name": "AMSantiago", "link": "https://stackoverflow.com/users/14280653/amsantiago"}, "is_accepted": false, "score": 1, "last_activity_date": 1600166129, "creation_date": 1600166129, "answer_id": 63900054, "question_id": 55503167, "link": "https://stackoverflow.com/questions/55503167/go-build-cant-find-a-revision/63900054#63900054", "title": "go build can&#39;t find a revision", "body": "<p>Just in case, did you add <code>&quot;github.ibm.com/kms&quot;</code> to your environment variable <code>GOPRIVATE</code> on computer B? I've had this error occur to me due to exactly this reason.</p>\n"}, {"tags": [], "owner": {"reputation": 239, "user_id": 5503272, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Ik-extqiOrk/AAAAAAAAAAI/AAAAAAAAAE0/Vgu82tPs2Ro/photo.jpg?sz=128", "display_name": "dixoen", "link": "https://stackoverflow.com/users/5503272/dixoen"}, "is_accepted": false, "score": 0, "last_activity_date": 1614803913, "creation_date": 1614803913, "answer_id": 66464590, "question_id": 55503167, "link": "https://stackoverflow.com/questions/55503167/go-build-cant-find-a-revision/66464590#66464590", "title": "go build can&#39;t find a revision", "body": "<p>I had the same problem, please, visit <a href=\"https://golang.cafe/blog/how-to-fix-go-mod-unknown-revision.html\" rel=\"nofollow noreferrer\">the link</a> .</p>\n<p>Make sure you have set GO111MODULES</p>\n<pre><code>go env -w GO111MODULE=on\n</code></pre>\n<p>Make sure your git configuration is appropriate for private repositories</p>\n<pre><code>git config --global url.&quot;ssh://git@github.com:acme-corporation&quot;.insteadOf &quot;https://github.com/acme-corporation&quot;\n</code></pre>\n<p>Make sure to create a personal access token if using 2FA</p>\n<pre><code>git config --global url.&quot;https://:x-oauth-basic@github.com:acme-corporation&quot;.insteadOf &quot;https://github.com/acme-corporation&quot;\n</code></pre>\n<p>in my case after setting:</p>\n<ul>\n<li>~/.gitconfig</li>\n<li>~/.bashrc</li>\n</ul>\n<p>I had to do the same with the ~ / .netrc file:</p>\n<pre><code>machine gitlab.url.com\n    login &lt;gitlab username&gt;\n    password &lt;GITLAB_TOKEN&gt;\n</code></pre>\n"}], "owner": {"reputation": 585, "user_id": 497857, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/886f1df95cb2acd12d921ce12c253b0e?s=128&d=identicon&r=PG", "display_name": "Ravenwater", "link": "https://stackoverflow.com/users/497857/ravenwater"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32391, "favorite_count": 3, "accepted_answer_id": 55522618, "answer_count": 6, "score": 12, "last_activity_date": 1614803913, "creation_date": 1554320765, "last_edit_date": 1554359036, "question_id": 55503167, "link": "https://stackoverflow.com/questions/55503167/go-build-cant-find-a-revision", "title": "go build can&#39;t find a revision", "body": "<p>I developed a repo on computer A and created a go.mod/go.sum that I checked in.</p>\n\n<p>I pull that repo with the go.mod/go.sum files on computer B, but when I try to build the program, the module constraints can't be satisfied.</p>\n\n<pre><code>$ go build\ngo: finding github.ibm.com/kms/key-protect-client v0.1.5\ngo: finding golang.org/x/tools v0.0.0-20180221164845-07fd8470d635\ngo: github.ibm.com/kms/key-protect-client@v0.1.5: unknown revision v0.1.5\ngo: error loading module requirements\n</code></pre>\n\n<p>The repo that is failing is a private repo, and for some reason it doesn't get downloaded to the module cache. On another computer, the dependencies are downloaded and the build succeeds. I am building another private repo in that same domain, so I know that my github credentials give me access to these repos. But for some reason, the go module system can't get to the dependent repo.</p>\n\n<p>I cannot find more information how to debug this.</p>\n"}, {"tags": ["go", "casting", "channel"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 3, "creation_date": 1554319933, "post_id": 55502900, "comment_id": 97712097, "body": "You cannot, composite types in Go are not covariant."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1554320125, "post_id": 55502900, "comment_id": 97712198, "body": "You can pass a <code>string</code> to a function taking an <code>interface{}</code> because <code>string</code> fulfills <code>interface{}</code>. The channel parameter&#39;s type is <code>chan interface{}</code>; that&#39;s a specific type, not an interface. No other type can &quot;fulfill&quot; <code>chan interface{}</code> because it isn&#39;t an interface, so you can <i>only</i> pass a <code>chan interface{}</code> to it, nothing else."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554359252, "post_id": 55502900, "comment_id": 97723590, "body": "Go doesn&#39;t have casting at all, so no matter what you do, you will avoid &quot;casting to chan interface{}&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 2282, "user_id": 1483903, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6c37dd8068c794e8268a332d944cd7e8?s=128&d=identicon&r=PG", "display_name": "thebiggestlebowski", "link": "https://stackoverflow.com/users/1483903/thebiggestlebowski"}, "edited": false, "score": 0, "creation_date": 1554323268, "post_id": 55503010, "comment_id": 97713733, "body": "This is probably the right answer and I&#39;m looking forward to generics being introduced (thanks for the link).  I&#39;m going to wait a few days before marking your answer accepted in the hopes that someone has a clever idea."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 2282, "user_id": 1483903, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6c37dd8068c794e8268a332d944cd7e8?s=128&d=identicon&r=PG", "display_name": "thebiggestlebowski", "link": "https://stackoverflow.com/users/1483903/thebiggestlebowski"}, "edited": false, "score": 0, "creation_date": 1554325368, "post_id": 55503010, "comment_id": 97714616, "body": "Understood. I ran into this exact issue a couple months ago writing a generic channel unmarshaler. Since I was already using reflection, it was not a big deal to ensure the user&#39;s <code>interface{}</code> input was of base-type chan - but this of course was a runtime check  - and not a compile-time check - like you are looking for."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1554359373, "post_id": 55503010, "comment_id": 97723646, "body": "This is the correct answer to the OP&#39;s specific question. However, the OP&#39;s question seems to be an XY problem (as are about 99.9% of questions answered by generics--thus my dread for the day Go supports generics). If the OP will elaborate on their actual <i>goal</i>, I&#39;m sure someone can come up with a clever solution to <i>that</i>."}], "tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": true, "score": 2, "last_activity_date": 1554425304, "last_edit_date": 1554425304, "creation_date": 1554320107, "answer_id": 55503010, "question_id": 55502900, "link": "https://stackoverflow.com/questions/55502900/invoke-function-which-accept-chan-interface/55503010#55503010", "title": "invoke function which accept &quot;chan interface{}&quot;", "body": "<p>Short answer: no.</p>\n\n<p><code>chan interface{}</code> is a different type to <code>interface{}</code>.</p>\n\n<p><code>interface{}</code> is a catch-all for all types, but <code>chan interface{}</code> is <em>NOT</em> a catch-all for all <code>chan</code> types.</p>\n\n<p>Generics will bring this capability, but they are not in the go language (<a href=\"https://go.googlesource.com/proposal/+/master/design/go2draft-generics-overview.md\" rel=\"nofollow noreferrer\">yet</a>).</p>\n\n<hr>\n\n<p>If all you need to do is check for channel capacity/length you can use the <code>reflect</code> package like so:</p>\n\n<pre><code>import \"reflect\"\n\nfunc CheckChanLen(aChan interface{}) {\n        rv := reflect.ValueOf(aChan)\n        if rk := rv.Kind(); rk != reflect.Chan {\n                panic(\"expecting type: 'chan ...'  instead got: \" + rk.String())\n        }           \n\n        chanCap := rv.Cap()\n        chanLen := rv.Len()\n        fmt.Printf(\"len:%d cap:%d\\n\", chanLen, chanCap)\n}\n</code></pre>\n"}], "owner": {"reputation": 2282, "user_id": 1483903, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6c37dd8068c794e8268a332d944cd7e8?s=128&d=identicon&r=PG", "display_name": "thebiggestlebowski", "link": "https://stackoverflow.com/users/1483903/thebiggestlebowski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 55503010, "answer_count": 1, "score": -3, "last_activity_date": 1554472620, "creation_date": 1554319697, "last_edit_date": 1554472620, "question_id": 55502900, "link": "https://stackoverflow.com/questions/55502900/invoke-function-which-accept-chan-interface", "title": "invoke function which accept &quot;chan interface{}&quot;", "body": "<p>To the people who down voted this question - it does have a legitimate answer, which is reflection (see below).  </p>\n\n<p>I want to create a generic function where I can pass any channel to it and it will tell me how much of its capacity is filled.  I'm finding it annoying that I have to cast the channel to \"chan interface{}\". </p>\n\n<p>My question is, for the function <code>foo</code> below, I can pass a string to it and that's fine.  Go accepts that as an interface{}.  Why does it not behave the same for channels?  Can I create a function which accepts a generic <code>chan interface{}</code>?</p>\n\n<pre><code>func testFoo() {\n    str := \"anything\"\n    foo(str)  //This is fine.\n    aChan := make(chan string, 10)\n\n    //This line doesn't compile.  Can I avoid casting to chan interface{}?\n    CheckChanLen(aChan) \n}\n\nfunc foo(obj interface{}) {}\n\nfunc CheckChanLen(aChan chan interface{}) {\n    chanCap := cap(aChan)\n    chanLen := len(aChan)\n    fmt.Printf(\"len:%d cap:%d\", chanLen, chanCap)\n}\n</code></pre>\n"}, {"tags": ["xml", "go", "struct"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554320179, "post_id": 55502777, "comment_id": 97712235, "body": "<i>Questions seeking debugging help (&quot;why isn&#39;t this code working?&quot;) must include the desired behavior, a specific problem or error and the shortest code necessary to reproduce it <b>in the question itself</b>.</i> (Not at an external link.)"}], "answers": [{"comments": [{"owner": {"reputation": 10308, "user_id": 1738915, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/YXjto.jpg?s=128&g=1", "display_name": "Kolban", "link": "https://stackoverflow.com/users/1738915/kolban"}, "edited": false, "score": 0, "creation_date": 1554352090, "post_id": 55502975, "comment_id": 97721116, "body": "Welcome to stackoverflow. Your answer would be improved by explaining how it addresses the question. See stackoverflow.com/help/how-to-answer"}], "tags": [], "owner": {"reputation": 19, "user_id": 8332897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff89a5ef2e2ed0758a834c09528a6956?s=128&d=identicon&r=PG&f=1", "display_name": "SergioRyan", "link": "https://stackoverflow.com/users/8332897/sergioryan"}, "is_accepted": false, "score": -1, "last_activity_date": 1554320022, "creation_date": 1554320022, "answer_id": 55502975, "question_id": 55502777, "link": "https://stackoverflow.com/questions/55502777/loop-over-xml-and-store-attributes-in-a-struct/55502975#55502975", "title": "Loop over XML and store attributes in a struct", "body": "<p>I had to add the attr to the vbcAlert struct.</p>\n"}, {"comments": [{"owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "edited": false, "score": 0, "creation_date": 1554320414, "post_id": 55503029, "comment_id": 97712354, "body": "My opinion, which is not part of the answer, is that <a href=\"https://en.wikipedia.org/wiki/XML#Criticism\" rel=\"nofollow noreferrer\">XML kind of sucks</a> and is an interchange format of last resort. Virtually all data structures in Go can be logically tagged with <i>both</i> <code>xml:&quot;&quot;</code> <i>and</i> <code>json:&quot;&quot;</code> tags, which to me pretty straightforwardly implies that JSON, which uses fewer characters, needs fewer rules, and can still be easily pretty-printed and parsed, is the superior format in nearly all cases...."}], "tags": [], "owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "is_accepted": false, "score": 1, "last_activity_date": 1554320175, "creation_date": 1554320175, "answer_id": 55503029, "question_id": 55502777, "link": "https://stackoverflow.com/questions/55502777/loop-over-xml-and-store-attributes-in-a-struct/55503029#55503029", "title": "Loop over XML and store attributes in a struct", "body": "<p>I have made corrections to your example code <a href=\"https://play.golang.org/p/UmzRjGP2my5\" rel=\"nofollow noreferrer\">on the playground</a>.</p>\n\n<ul>\n<li>Your XML example was not well-formed; the first <code>&lt;msg&gt;</code> element was missing a closing tag, so there would've been parse errors.</li>\n<li>Your outer element is not named <code>\"xml version\"</code>. Your outer element is the <code>&lt;alarmlist&gt;</code>, which contains zero or more elements named <code>&lt;msg&gt;</code>.</li>\n<li>Values contained by <code>&lt;msg&gt;</code> are not elements. They are <em>attributes</em> and must be tagged appropriately.</li>\n</ul>\n\n<p>I imagine this is not the only XML document your code will need to handle in the long run, so I recommend you read <a href=\"https://golang.org/pkg/encoding/xml/#Unmarshal\" rel=\"nofollow noreferrer\">the godoc</a> <em>very</em> carefully to understand the tag syntax. Look for <a href=\"https://www.sitepoint.com/really-good-introduction-xml/\" rel=\"nofollow noreferrer\">introductions to XML</a> on the nets if you're having trouble with some of the terminology.</p>\n"}], "owner": {"reputation": 19, "user_id": 8332897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff89a5ef2e2ed0758a834c09528a6956?s=128&d=identicon&r=PG&f=1", "display_name": "SergioRyan", "link": "https://stackoverflow.com/users/8332897/sergioryan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 28, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1554320175, "creation_date": 1554319199, "question_id": 55502777, "link": "https://stackoverflow.com/questions/55502777/loop-over-xml-and-store-attributes-in-a-struct", "title": "Loop over XML and store attributes in a struct", "body": "<p>I query a device and it returns an XML output with the number of alerts.\nI want to store each alert as a struct and store all the alerts in a slice.</p>\n\n<p>I have looked through a number of answers for a similar problem but I am having a hard time finding how to parse the attributes of each msg tag and put the attributes into the struct. </p>\n\n<p>Example Code: <a href=\"https://play.golang.org/p/XZMONjRc5q1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/XZMONjRc5q1</a></p>\n"}, {"tags": ["windows", "go"], "comments": [{"owner": {"reputation": 515, "user_id": 3417978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ded5d4a533f2bfd6204cbcfacd5d824c?s=128&d=identicon&r=PG", "display_name": "MC10", "link": "https://stackoverflow.com/users/3417978/mc10"}, "edited": false, "score": 0, "creation_date": 1554310438, "post_id": 55500857, "comment_id": 97708326, "body": "Is GoLang a requirement or do you just need to set environment variables?"}, {"owner": {"reputation": 11490, "user_id": 3317808, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6c8272382fcd9841919bc1f8709d25a0?s=128&d=identicon&r=PG&f=1", "display_name": "overexchange", "link": "https://stackoverflow.com/users/3317808/overexchange"}, "reply_to_user": {"reputation": 515, "user_id": 3417978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ded5d4a533f2bfd6204cbcfacd5d824c?s=128&d=identicon&r=PG", "display_name": "MC10", "link": "https://stackoverflow.com/users/3417978/mc10"}, "edited": false, "score": 0, "creation_date": 1554310536, "post_id": 55500857, "comment_id": 97708327, "body": "@MC10 GoLang is suppose to read the values of environment variables. This is the requirement"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 2, "creation_date": 1554312462, "post_id": 55500857, "comment_id": 97708477, "body": "If you&#39;ve set the User environment variables, Golang can read them so long as you&#39;re running it as that user. Otherwise -- any user is allowed to set per-session env vars (<code>SET key=value</code> from the command line) so you could do that before script invocation."}], "answers": [{"comments": [{"owner": {"reputation": 29355, "user_id": 205580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/460e6e299e385fd46df156c85a1dd55f?s=128&d=identicon&r=PG", "display_name": "Eryk Sun", "link": "https://stackoverflow.com/users/205580/eryk-sun"}, "edited": false, "score": 0, "creation_date": 1554329324, "post_id": 55501155, "comment_id": 97715981, "body": "The command-line shell (e.g. CMD or PowerShell) is not the console window. Its standard I/O can be directed anywhere or run without a window at all."}, {"owner": {"reputation": 29355, "user_id": 205580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/460e6e299e385fd46df156c85a1dd55f?s=128&d=identicon&r=PG", "display_name": "Eryk Sun", "link": "https://stackoverflow.com/users/205580/eryk-sun"}, "edited": false, "score": 0, "creation_date": 1554329364, "post_id": 55501155, "comment_id": 97715992, "body": "setx.exe modifies the registry and broadcasts a <code>WM_SETTINGCHANGE</code> message to top-level windows. This includes instances of the graphical shell Explorer, which in response reloads its environment from the registry. It does not include instances of CMD because it owns no windows, top-level or otherwise. New instances of CMD started from Explorer will inherit the updated environment. Instances started from other existing processes will not. It is not &quot;all future shells&quot;."}, {"owner": {"reputation": 29355, "user_id": 205580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/460e6e299e385fd46df156c85a1dd55f?s=128&d=identicon&r=PG", "display_name": "Eryk Sun", "link": "https://stackoverflow.com/users/205580/eryk-sun"}, "edited": false, "score": 0, "creation_date": 1554329647, "post_id": 55501155, "comment_id": 97716088, "body": "An important disclaimer whenever we discuss setx.exe is that it shouldn&#39;t be used to modify <code>PATH</code>. In particular not in a naive manner that extends <code>%PATH%</code> and sets it back to the system or user registry value. It&#39;s possible if we&#39;re careful to read and modify the original system or user &quot;Path&quot; value in the registry via reg.exe. There are SO answers that show how to do this, but it&#39;s difficult and should probably just be avoided."}], "tags": [], "owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "is_accepted": false, "score": 3, "last_activity_date": 1554313186, "creation_date": 1554313186, "answer_id": 55501155, "question_id": 55500857, "link": "https://stackoverflow.com/questions/55500857/how-to-set-the-environment-variable-in-windows/55501155#55501155", "title": "How to set the environment variable in windows?", "body": "<p>In Windows, environment variables can be applied in two ways.</p>\n\n<p><code>Set</code> modifies the current shell's (the window's) environment values, and the change is available immediately, but it is temporary. The change will not affect other shells that are running, and as soon as you close the shell, the new value is lost until such time as you run set again.</p>\n\n<pre><code>cmd&gt; SET ADDR=127.0.0.1\ncmd&gt; SET TOKEN=ABCD1234\ncmd&gt; SET\n</code></pre>\n\n<p><code>setx</code> modifies the value permanently, which affects all future shells, but does not modify the environment of the shells already running. You have to exit the shell and reopen it before the change will be available, but the value will remain modified until you change it again.</p>\n\n<pre><code>cmd&gt; setx ADDR \"127.0.0.1\"\ncmd&gt; setx TOKEN \"ABCD1234\"\ncmd&gt; SET\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 15107500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/396c3e75db10aeed44d80be9678f620c?s=128&d=identicon&r=PG&f=1", "display_name": "devocip", "link": "https://stackoverflow.com/users/15107500/devocip"}, "is_accepted": false, "score": 0, "last_activity_date": 1613959186, "last_edit_date": 1613959186, "creation_date": 1613944378, "answer_id": 66307539, "question_id": 55500857, "link": "https://stackoverflow.com/questions/55500857/how-to-set-the-environment-variable-in-windows/66307539#66307539", "title": "How to set the environment variable in windows?", "body": "<p>I don't know if this is the same as yours, but I use: <code>os.environ.get('environment variable')</code>.</p>\n<p>Also you can add a <code>print(environment variable)</code> and run to check if everything is fine. Let's say the environment variable is <code>SECRET_KEY</code>.\nYou add a <code>print(SECRET_KEY)</code> to your line of code and run, check your terminal for possible results.</p>\n"}, {"tags": [], "owner": {"reputation": 11502, "user_id": 4652706, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/r9ETH.jpg?s=128&g=1", "display_name": "KARTHIKEYAN.A", "link": "https://stackoverflow.com/users/4652706/karthikeyan-a"}, "is_accepted": false, "score": 0, "last_activity_date": 1616924678, "creation_date": 1616924678, "answer_id": 66840101, "question_id": 55500857, "link": "https://stackoverflow.com/questions/55500857/how-to-set-the-environment-variable-in-windows/66840101#66840101", "title": "How to set the environment variable in windows?", "body": "<p>You can try using <strong>set</strong> method on terminal in the following way</p>\n<p><a href=\"https://i.stack.imgur.com/QEkRr.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/QEkRr.png\" alt=\"enter image description here\" /></a></p>\n"}], "migrated_from": {"other_site": {"markdown_extensions": ["Prettify"], "launch_date": 1250553600, "open_beta_date": 1247529600, "site_state": "normal", "high_resolution_icon_url": "https://cdn.sstatic.net/Sites/superuser/Img/apple-touch-icon@2.png", "twitter_account": "super_user", "favicon_url": "https://cdn.sstatic.net/Sites/superuser/Img/favicon.ico", "icon_url": "https://cdn.sstatic.net/Sites/superuser/Img/apple-touch-icon.png", "audience": "computer enthusiasts and power users", "site_url": "https://superuser.com", "api_site_parameter": "superuser", "logo_url": "https://cdn.sstatic.net/Sites/superuser/Img/logo.png", "name": "Super User", "site_type": "main_site"}, "on_date": 1554312136, "question_id": 1420974}, "owner": {"reputation": 11490, "user_id": 3317808, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6c8272382fcd9841919bc1f8709d25a0?s=128&d=identicon&r=PG&f=1", "display_name": "overexchange", "link": "https://stackoverflow.com/users/3317808/overexchange"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4097, "favorite_count": 0, "answer_count": 3, "score": -1, "last_activity_date": 1616924678, "creation_date": 1554309047, "last_edit_date": 1612704344, "question_id": 55500857, "link": "https://stackoverflow.com/questions/55500857/how-to-set-the-environment-variable-in-windows", "title": "How to set the environment variable in windows?", "body": "<p>Below Go code:</p>\n<pre><code>var (\n    Address = os.Getenv(&quot;ADDR&quot;)\n    Token      = os.Getenv(&quot;TOKEN&quot;)\n)\n</code></pre>\n<p>reads the environment variables in windows</p>\n<hr />\n<p>In windows laptop, I have privilege to set user variables for my user login only. I created two variables(for above), but <code>os.Getenv()</code> cannot read the values.</p>\n<p>I do not have privilege to set system variables</p>\n<hr />\n<p>How to set environment variables in windows, with my user login?</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda", "amazon-cognito"], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 11306590, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-myYGLdvtsno/AAAAAAAAAAI/AAAAAAAAAAc/YafPKUKjqYQ/photo.jpg?sz=128", "display_name": "Claudia Rostagnol", "link": "https://stackoverflow.com/users/11306590/claudia-rostagnol"}, "is_accepted": true, "score": 1, "last_activity_date": 1555014902, "creation_date": 1555014902, "answer_id": 55640739, "question_id": 55499147, "link": "https://stackoverflow.com/questions/55499147/how-to-reject-sign-up-trigger-with-golang/55640739#55640739", "title": "How to reject sign-up trigger with GoLang", "body": "<p>Looks like something changed on AWS Cognito Lambda triggers, since today I tried the following source code and it worked as expected:</p>\n\n<pre><code>func handler(event events.CognitoEventUserPoolsPreSignup) (events.CognitoEventUserPoolsPreSignup, error) {\n    fmt.Println(event)\n    return event, fmt.Errorf(\"TESTING LAMBDA ERRORS WITH GOLANG\")\n}\n</code></pre>\n\n<p>Also, the previous source code that was not working as expected when I posted this question is currently working (with no changes on my side).</p>\n"}], "owner": {"reputation": 11, "user_id": 11306590, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-myYGLdvtsno/AAAAAAAAAAI/AAAAAAAAAAc/YafPKUKjqYQ/photo.jpg?sz=128", "display_name": "Claudia Rostagnol", "link": "https://stackoverflow.com/users/11306590/claudia-rostagnol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 333, "favorite_count": 0, "accepted_answer_id": 55640739, "answer_count": 1, "score": 0, "last_activity_date": 1555014902, "creation_date": 1554306132, "last_edit_date": 1554359116, "question_id": 55499147, "link": "https://stackoverflow.com/questions/55499147/how-to-reject-sign-up-trigger-with-golang", "title": "How to reject sign-up trigger with GoLang", "body": "<p>I've successfully created a lambda function using Go for the pre sign-up trigger of AWS Cognito.\nMy problem is that I'm not being able to deny/reject the user if a custom field is not valid (based on custom logic).</p>\n\n<p>I'm returning an error as described in AWS Cognito trigger's guide:</p>\n\n<pre><code>return event, fmt.Errorf(\"Invalid value for field 'custom:myField'\")\n</code></pre>\n\n<p>also I've tried this options:</p>\n\n<ul>\n<li><p>returning an empty event (nil is not allowed for the event):</p>\n\n<pre><code>var emptyEvent events.CognitoEventUserPoolsPreSignup\nreturn emptyEvent, fmt.Errorf(\"Invalid value for field 'custom:myField'\")\n</code></pre></li>\n<li><p>changing ValidationData in the original event:</p>\n\n<pre><code>event.Request.ValidationData = map[string]string{\"custom:myField\": \"Invalid value for field 'custom:myField.\"}\nreturn event, fmt.Errorf(\"Invalid value for field 'custom:myField'\")\n</code></pre></li>\n<li><p>changing UserAttributes in the original event</p>\n\n<pre><code>event.Request.UserAttributes[\"email\"] = \"\"\nreturn event, fmt.Errorf(\"Invalid value for field 'custom:myField'\")\n</code></pre></li>\n</ul>\n\n<p>All those methods are failing, the user is always created in the User Pool.</p>\n\n<p>What should be the correct way to reject the sign-up request using GoLang lambda function?</p>\n"}, {"tags": ["sql", "go"], "comments": [{"owner": {"reputation": 2763, "user_id": 890743, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/cdffc284f976d9d6ccdec0d839d82472?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/890743/eric"}, "edited": false, "score": 2, "creation_date": 1554306557, "post_id": 55499144, "comment_id": 97705443, "body": "Have you tried to do some research before posting this question???  I&#39;m pretty sure if you Google &quot;mysql converting float to int&quot;, there are tons of example."}, {"owner": {"reputation": 13, "user_id": 7153997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9de9040b0b72a12f4cce627185a7463c?s=128&d=identicon&r=PG&f=1", "display_name": "MrC0de", "link": "https://stackoverflow.com/users/7153997/mrc0de"}, "reply_to_user": {"reputation": 2763, "user_id": 890743, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/cdffc284f976d9d6ccdec0d839d82472?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/890743/eric"}, "edited": false, "score": 0, "creation_date": 1554308660, "post_id": 55499144, "comment_id": 97706574, "body": "Yea, that would be very useful, if that was what I was trying to do."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1554310876, "post_id": 55499144, "comment_id": 97707681, "body": "Every value is transmitted as a []uint8 (an alias for []byte) from the database, and the driver then decodes them into Go types. Types that are not natively supported by the driver have to implement <a href=\"https://golang.org/pkg/database/sql/#Scanner\" rel=\"nofollow noreferrer\">sql.Scanner</a>. If you want a concrete answer, add the code that scans the result set, including all relevant types."}, {"owner": {"reputation": 13, "user_id": 7153997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9de9040b0b72a12f4cce627185a7463c?s=128&d=identicon&r=PG&f=1", "display_name": "MrC0de", "link": "https://stackoverflow.com/users/7153997/mrc0de"}, "edited": false, "score": 0, "creation_date": 1554315364, "post_id": 55499144, "comment_id": 97709844, "body": "I&#39;ve been looking for an implementation example of sql.Scanner after reading the same, haven&#39;t found one that made any sense yet. Everyone says &quot;just implement sql.Scanner&quot; no one talks about how to do that. Anyways, thanks for your answer, I&#39;m adding my solution to the question."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 7153997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9de9040b0b72a12f4cce627185a7463c?s=128&d=identicon&r=PG&f=1", "display_name": "MrC0de", "link": "https://stackoverflow.com/users/7153997/mrc0de"}, "edited": false, "score": 0, "creation_date": 1554316377, "post_id": 55501285, "comment_id": 97710383, "body": "Thanks again, you did actually seem to hit the root of the issue, GROUP_CONCAT returns a string, and I cant avoid using it in this query.....  I expected an array/slice. The []byte slice makes sense now, I&#39;m just glad I figured out []byte was my bastard string, parsing it out from there was trivial."}], "tags": [], "owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "is_accepted": true, "score": 1, "last_activity_date": 1554313723, "creation_date": 1554313723, "answer_id": 55501285, "question_id": 55499144, "link": "https://stackoverflow.com/questions/55499144/go-application-making-sql-query-using-group-concat-on-floats-returns-uint8-ins/55501285#55501285", "title": "Go application making SQL Query using GROUP_CONCAT on FLOATS returns []uint8 instead of actual []float64", "body": "<p>GROUP_CONCAT returns a string. So in Go you get a byte array of characters, not a float. The result you posted <code>53,55,56,48,46,48,48</code> translates into a string \"5780.00\" which does look like one of your values. So you need to either fix your SQL to return floats or use strings and strconv modules in Go to parse and convert your string into floats. I think the former approach is better, but it is up to you.</p>\n"}], "owner": {"reputation": 13, "user_id": 7153997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9de9040b0b72a12f4cce627185a7463c?s=128&d=identicon&r=PG&f=1", "display_name": "MrC0de", "link": "https://stackoverflow.com/users/7153997/mrc0de"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 0, "accepted_answer_id": 55501285, "answer_count": 1, "score": 1, "last_activity_date": 1554317794, "creation_date": 1554306125, "last_edit_date": 1554317794, "question_id": 55499144, "link": "https://stackoverflow.com/questions/55499144/go-application-making-sql-query-using-group-concat-on-floats-returns-uint8-ins", "title": "Go application making SQL Query using GROUP_CONCAT on FLOATS returns []uint8 instead of actual []float64", "body": "<p>Have a problem using group_concat in a query made by my go application.</p>\n\n<p>Any idea why a group_concat of FLOATS would look like a []uint8 on the Go side?</p>\n\n<p>Cant seem to properly convert the suckers either.</p>\n\n<p>It's definitely floats, I can see it in the raw query results, but when I do the same query in go and try to .Scan the result, Go complains that it's a <code>[]uint8</code> not a <code>[]float64</code> (which it actually is) Attempts to convert to floats gives me the wrong values (and way too many of them).</p>\n\n<p>For example, at the database, I query and get 2 floats for the column in question, looks like this: </p>\n\n<pre><code>\"5650.50, 5455.00\"\n</code></pre>\n\n<p>On the go side however, go sees a <code>[]uint8</code> instead of <code>[]float64</code>. Why does this happen? How does one workaround this to get the actual results?</p>\n\n<p>My problem is that I have to use this SQL with the <code>group_concat</code>, due to  the nature of the database I am working with, this is the best way to get the information, and more importantly the query itself works great, returns the data the function needs, but now I cant read it out because of type issues. No stranger to those, but Go isn't cooperating with me today.</p>\n\n<p>I'd be more than pleased to learn WHY go is doing it this way, and delighted to learn of a way to deal with it.</p>\n\n<p>Example:</p>\n\n<pre><code>SELECT ID, getDistance(33.1543,-110.4353, Loc.Lat, Loc.Lng) as distance,\nGROUP_CONCAT(values) FROM stuff INNER JOIN device on device.ID = stuff.ID WHERE (someConditionsETC) GROUP BY ID ORDER BY ID\n</code></pre>\n\n<p>The actual result, when interfacing with the actual database (not within my application), is </p>\n\n<pre><code>\"5650.00, 5850.50\"\n</code></pre>\n\n<p>It's clearly 2 floats. </p>\n\n<p>The same result produces a slice of uint8 when queried from Go and trying to .Scan the result in. If I range through and print those values, I get way more than 2, and they are <code>uint8</code> (bytes) that look like this: </p>\n\n<pre><code>53,55,56,48,46,48,48\n</code></pre>\n\n<p>Not sure how Go expects me to handle this.</p>\n\n<p>Solution.... stupid simple and not terribly obvious:</p>\n\n<p>The solution:\u00a0</p>\n\n<pre><code>crazyBytes := []uint8(\"5760.00,5750.50\")\n    aString := string(crazyBytes)\nstrSlice := strings.Split(aString,\",\") // string representation of our array (of floats)\nvar floatz []float64\nfor _, x := range strSlice {\n    fmt.Printf(\"At last, Float: %s \\r\\n\",x)\n    f,err := strconv.ParseFloat(x,64)\n    if err != nil { fmt.Printf(\"Error: %s\",err) }\n    floatz = append(floatz, f)\n    fmt.Printf(\"as float: %s \\r\\n\", strconv.FormatFloat(f,'f',-1,64))\n}\n</code></pre>\n\n<p>Yea sure, it's obvious NOW.</p>\n"}, {"tags": ["rest", "go", "middleware", "roles"], "owner": {"reputation": 63, "user_id": 11154131, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Df9Cd5m8YbU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf3t3aLeqiZQsvHjhZOsFrB-0dzvg/mo/photo.jpg?sz=128", "display_name": "Abraham", "link": "https://stackoverflow.com/users/11154131/abraham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 340, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1571399515, "creation_date": 1554302404, "last_edit_date": 1571399515, "question_id": 55497851, "link": "https://stackoverflow.com/questions/55497851/how-to-apply-middleware-to-gorilla-mux-routes", "title": "How to apply middleware to gorilla/mux routes", "body": "<p>I have this main function in a main.go file inside the main directory</p>\n\n<pre><code>func main() {\n    log.Printf(\"Server started\")\n\n    router := sw.NewRouter()\n    manager := manage.NewDefaultManager()\n    manager.SetAuthorizeCodeTokenCfg(manage.DefaultAuthorizeCodeTokenCfg)\n\n    manager.MustTokenStorage(store.NewMemoryTokenStore())\n\n    clientStore := store.NewClientStore()\n    manager.MapClientStorage(clientStore)\n\n    srv := server.NewDefaultServer(manager)\n    srv.SetAllowGetAccessRequest(true)\n    srv.SetClientInfoHandler(server.ClientFormHandler)\n    manager.SetRefreshTokenCfg(manage.DefaultRefreshTokenCfg)\n\n    srv.SetInternalErrorHandler(func(err error) (re *errors.Response) {\n        log.Println(\"Internal Error:\", err.Error())\n        return\n    })\n\n    srv.SetResponseErrorHandler(func(re *errors.Response) {\n        log.Println(\"Response Error:\", re.Error.Error())\n    })\n\n    router.HandleFunc(\"/oauth2/token\", func(w http.ResponseWriter, r *http.Request) {\n        srv.HandleTokenRequest(w, r)\n    })\n\n    router.HandleFunc(\"/credentials\", func(w http.ResponseWriter, r *http.Request) {\n        clientId := uuid.New().String()[:8]\n        clientSecret := uuid.New().String()[:8]\n        err := clientStore.Set(clientId, &amp;models.Client{\n            ID:     clientId,\n            Secret: clientSecret,\n            Domain: \"http://localhost:9094\",\n        })\n        if err != nil {\n            fmt.Println(err.Error())\n        }\n\n        w.Header().Set(\"Content-Type\", \"application/json\")\n        json.NewEncoder(w).Encode(map[string]string{\"CLIENT_ID\": clientId, \"CLIENT_SECRET\": clientSecret})\n    })\n\n    log.Fatal(http.ListenAndServe(\":8000\", router))\n}\n</code></pre>\n\n<p>The functions below are in different files in the sub directory of the main as</p>\n\n<p>*maindir\n    *subdir</p>\n\n<p>//Funtion in handler.go in subdir</p>\n\n<pre><code>func protecteduri(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Hello, I'm protected\"))\n}\n</code></pre>\n\n<p>//This function in middleware.go in subdir</p>\n\n<pre><code>func validateToken(f http.HandlerFunc, srv *server.Server) http.HandlerFunc {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        _, err := srv.ValidationBearerToken(r)\n        if err != nil {\n            http.Error(w, err.Error(), http.StatusBadRequest)\n            return\n        }\n\n        f.ServeHTTP(w, r)\n    })\n}\n</code></pre>\n\n<p>And my routes are in the router.go in the subdir as</p>\n\n<pre><code>type Route struct {\n    Name        string\n    Method      string\n    Pattern     string\n    HandlerFunc http.HandlerFunc\n}\n\ntype Routes []Route\n\nfunc NewRouter() *mux.Router {\n    router := mux.NewRouter().StrictSlash(true)\n    for _, route := range routes {\n        var handler http.Handler\n        handler = route.HandlerFunc\n        handler = Logger(handler, route.Name)\n\n        router.\n            Methods(route.Method).\n            Path(route.Pattern).\n            Name(route.Name).\n            Handler(handler)\n    }\n\n    return router\n}\n\nfunc Index(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hello World!\")\n}\n\nvar routes = Routes{\n    {\n        \"Index\",\n        \"GET\",\n        \"/\",\n        Index,\n    },\n\n    {\n        \"protecteduri\",\n        strings.ToUpper(\"Get\"),\n        \"/protected\",\n        protecteduri,\n    },\n}\n</code></pre>\n\n<p>My question is how do i apply the \"validateToken\" function (middleware) to the routes in the router.go?\nThe function is to validate the access token in the request message before calling the handler functions.</p>\n\n<p>I have modify the middleware to the below but it only work if the handler function \"/protected\" is in the main function.\nI have many handlers and do not want to put all of them in the main.go. </p>\n\n<pre><code>func ValidateToken(srv *server.Server) func(http.Handler) http.Handler {\n    return func(next http.Handler) http.Handler {\n        return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            notAuth := []string{\"/oauth2/token\", \"/credentials\"} //List of endpoints that doesn't require auth\n            requestPath := r.URL.Path                            //current request path\n\n            //check if request does not need authentication, serve the request if it doesn't need it\n            for _, value := range notAuth {\n\n                if value == requestPath {\n                    next.ServeHTTP(w, r)\n                    return\n                }\n            }\n            _, err := srv.ValidationBearerToken(r)\n            if err != nil {\n                http.Error(w, err.Error(), http.StatusBadRequest)\n                return\n            }\n\n            next.ServeHTTP(w, r)\n        })\n    }\n}\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "amazon-dynamodb"], "comments": [{"owner": {"reputation": 1914, "user_id": 9811969, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/184e2e46b8d8b8c483c85589709b8563?s=128&d=identicon&r=PG&f=1", "display_name": "Nik", "link": "https://stackoverflow.com/users/9811969/nik"}, "edited": false, "score": 0, "creation_date": 1554300419, "post_id": 55496924, "comment_id": 97701294, "body": "Could you add your code and table structure?"}, {"owner": {"reputation": 1914, "user_id": 9811969, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/184e2e46b8d8b8c483c85589709b8563?s=128&d=identicon&r=PG&f=1", "display_name": "Nik", "link": "https://stackoverflow.com/users/9811969/nik"}, "edited": false, "score": 2, "creation_date": 1554302434, "post_id": 55496924, "comment_id": 97702630, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/53073212/aws-sdk-for-go-dynamodb-add-multiple-conditions-to-filterexpression\">AWS SDK for Go - DynamoDb - Add multiple conditions to FilterExpression</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1185, "user_id": 1520421, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/5a4e98bb784ee939598e7b93705f3eaf?s=128&d=identicon&r=PG", "display_name": "Dattatray", "link": "https://stackoverflow.com/users/1520421/dattatray"}, "is_accepted": false, "score": 0, "last_activity_date": 1554371375, "creation_date": 1554371375, "answer_id": 55512884, "question_id": 55496924, "link": "https://stackoverflow.com/questions/55496924/scan-operation-with-filterexpression-having-multiple-conditions-with-and-opera/55512884#55512884", "title": "Scan operation with FilterExpression having multiple conditions with &quot;and&quot; operator", "body": "<p>I got the problem.</p>\n\n<p>The filter condition string is correct - </p>\n\n<pre><code>(#field1 = :field1Val) and (#field2 = :field2Val)\n</code></pre>\n\n<p>I was iterating in a loop to find out which search parameters are specified by the user.</p>\n\n<p>There was a mistake in the code, I was using the same variable name for all the attribute names.</p>\n\n<pre><code>attributeName := \"field1\"\nattributeNamemap[\"#field1\"] = &amp;attributeName\n</code></pre>\n\n<p>This \"attributeName\" field was used for all the search parameters.\nThis was causing the problem, I used different variables and it started working.</p>\n"}], "owner": {"reputation": 1185, "user_id": 1520421, "user_type": "registered", "accept_rate": 15, "profile_image": "https://www.gravatar.com/avatar/5a4e98bb784ee939598e7b93705f3eaf?s=128&d=identicon&r=PG", "display_name": "Dattatray", "link": "https://stackoverflow.com/users/1520421/dattatray"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 392, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1554371375, "creation_date": 1554299815, "last_edit_date": 1554308626, "question_id": 55496924, "link": "https://stackoverflow.com/questions/55496924/scan-operation-with-filterexpression-having-multiple-conditions-with-and-opera", "title": "Scan operation with FilterExpression having multiple conditions with &quot;and&quot; operator", "body": "<p>I am writing a lambda function in Go and using DynamoDB as my database.</p>\n\n<p>I need to write a scan operation with multiple conditions (e.g. field1 = value1 and field2 = value2 and field3 = value3).</p>\n\n<p>I am creating a <code>FilterExpression</code> string based on how many parameters/conditions are supplied by the user.</p>\n\n<p>My filter expression is as below:</p>\n\n<pre><code>(#field1 = :field1Val) and (#field2 = :field2Val)\n</code></pre>\n\n<p>I am also providing the ExpressionAttributeNames and the ExpressionAttributeValues in the maps to the scan operation input. However, I am not getting any results (count = 0).</p>\n\n<p>If I specify only one condition or if I use \"or\" operator instead of \"and\" operator, I get the results.</p>\n\n<p>Looks like the second condition (#field2 = :field2Val), even if I use any field ( field3, field4, etc.)  is always resulting in \"false\".</p>\n\n<p>Any pointers? </p>\n\n<p>Where do I see the logs of this query/scan operation?</p>\n"}, {"tags": ["go", "gorp"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554304477, "post_id": 55496448, "comment_id": 97704117, "body": "That error is related to gorp, not your structs, per se. I don&#39;t know enough about gorp to help troubleshoot."}, {"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 1, "creation_date": 1554306363, "post_id": 55496448, "comment_id": 97705309, "body": "If you are calling you func like <code>f(&amp;a)</code>. Probably you should call inside <code>func f</code> just <code>dbmap.Insert(i)</code>, because your value is already a pointer."}, {"owner": {"reputation": 111, "user_id": 9669166, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-cte9-qmHONE/AAAAAAAAAAI/AAAAAAAAABQ/idw93GSzSMY/photo.jpg?sz=128", "display_name": "Markus Grunwald", "link": "https://stackoverflow.com/users/9669166/markus-grunwald"}, "reply_to_user": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 0, "creation_date": 1554379614, "post_id": 55496448, "comment_id": 97735809, "body": "Thanks @ttomalak, that solved my problem :)"}, {"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 0, "creation_date": 1554381035, "post_id": 55496448, "comment_id": 97736678, "body": "I will make that as answer then :)"}], "answers": [{"tags": [], "owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "is_accepted": true, "score": 1, "last_activity_date": 1554381038, "creation_date": 1554381038, "answer_id": 55516045, "question_id": 55496448, "link": "https://stackoverflow.com/questions/55496448/how-can-i-call-dbmap-insertinterface-from-another-function/55516045#55516045", "title": "How can I call dbmap.Insert(interface{}) from another function?", "body": "<p>If you are calling you func like <code>f(&amp;a)</code>. You should call inside <code>func f</code> just <code>dbmap.Insert(i)</code>, because your value is already a pointer. So your <code>func</code> will look like</p>\n\n<pre><code>func f(i interface{}) {\n    fmt.Printf(\"i: %v %T\\n\", i, i)\n\n    err := dbmap.Insert(i)\n    checkErr(err, \"Insert i\")\n}\n</code></pre>\n"}], "owner": {"reputation": 111, "user_id": 9669166, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-cte9-qmHONE/AAAAAAAAAAI/AAAAAAAAABQ/idw93GSzSMY/photo.jpg?sz=128", "display_name": "Markus Grunwald", "link": "https://stackoverflow.com/users/9669166/markus-grunwald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 55516045, "answer_count": 1, "score": 0, "last_activity_date": 1554381038, "creation_date": 1554298289, "last_edit_date": 1554300545, "question_id": 55496448, "link": "https://stackoverflow.com/questions/55496448/how-can-i-call-dbmap-insertinterface-from-another-function", "title": "How can I call dbmap.Insert(interface{}) from another function?", "body": "<p>I have a bunch of very similar structs (A and B in the example) whose instances I want to handle in some function ( <code>f()</code> in the example) and then insert them into my database. I figured I could handle that with the empty interface somehow, but it seems this is not the solution as I get the error:</p>\n\n<pre><code>i: &amp;{{6 2019-04-03 15:11:37.822100431 +0200 CEST m=+0.001291882} 7} *main.A\n2019/04/03 15:11:37 Insert i no table found for type: \nexit status 1\n</code></pre>\n\n<p>I tried to create some minimal but executable example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    _ \"github.com/mattn/go-sqlite3\"\n    gorp \"gopkg.in/gorp.v2\"\n    \"log\"\n    \"time\"\n)\n\ntype Meta struct {\n    Id        int\n    CreatedAt time.Time\n}\n\ntype A struct {\n    Meta\n    Value int\n}\n\ntype B struct {\n    Meta\n    Value string\n}\n\nvar dbmap *gorp.DbMap\n\nfunc f(i interface{}) {\n    fmt.Printf(\"i: %v %T\\n\", i, i)\n\n    err := dbmap.Insert(&amp;i)\n    checkErr(err, \"Insert i\")\n}\n\nfunc main() {\n    Init()\n\n    a := A{Meta: Meta{CreatedAt: time.Now()}, Value: 7}\n    b := B{Meta: Meta{CreatedAt: time.Now()}, Value: \"seven\"}\n\n    err := dbmap.Insert(&amp;a)    // works\n    checkErr(err, \"Insert a\")\n\n    err = dbmap.Insert(&amp;b)     // works\n    checkErr(err, \"Insert b\")\n\n    f(&amp;a) // fails\n}\n\nfunc Init() {\n    db, err := sql.Open(\"sqlite3\", \"/tmp/post_db.bin\")\n    checkErr(err, \"sql.Open failed\")\n    dbmap = &amp;gorp.DbMap{Db: db, Dialect: gorp.SqliteDialect{}}\n    dbmap.AddTableWithName(A{}, \"As\").SetKeys(true, \"Id\")\n    dbmap.AddTableWithName(B{}, \"Bs\").SetKeys(true, \"Id\")\n    err = dbmap.CreateTablesIfNotExists()\n    checkErr(err, \"Couldn't create tables\")\n}\n\nfunc checkErr(err error, msg string) {\n    if err != nil {\n        log.Fatalln(msg, err)\n    }\n}\n</code></pre>\n\n<p>What's the right way to do that? In C++ I'd simply use templates ;)</p>\n"}, {"tags": ["go", "arm", "cgo", "gccgo"], "comments": [{"owner": {"reputation": 5432, "user_id": 4723732, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/77fa71fdc548472c228be40043c1bc1f?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Rublev", "link": "https://stackoverflow.com/users/4723732/richard-rublev"}, "edited": false, "score": 0, "creation_date": 1554305507, "post_id": 55495681, "comment_id": 97704775, "body": "Take a look <a href=\"https://stackoverflow.com/questions/43710987/cross-compile-shared-libraries\" title=\"cross compile shared libraries\">stackoverflow.com/questions/43710987/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 427, "user_id": 6254868, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-coh80Kgp5wI/AAAAAAAAAAI/AAAAAAAAAEM/YAQYO15Emg0/photo.jpg?sz=128", "display_name": "\u041e\u043b\u0435\u0433 \u0421\u0438\u0434\u043e\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/6254868/%d0%9e%d0%bb%d0%b5%d0%b3-%d0%a1%d0%b8%d0%b4%d0%be%d1%80%d0%be%d0%b2"}, "is_accepted": false, "score": 0, "last_activity_date": 1611936301, "creation_date": 1611936301, "answer_id": 65957877, "question_id": 55495681, "link": "https://stackoverflow.com/questions/55495681/how-to-build-so-library-for-arm-architecture/65957877#65957877", "title": "How to build SO library for ARM architecture", "body": "<p>It may be different in you own *.nix system, but in common case your settings shoul de like below:</p>\n<pre><code>export CC=arm-linux-gnueabi-gcc //choose your arm compiler binary\nexport GOARCH=arm\nexport CGO_ENABLED=1\n</code></pre>\n<p>then you cab build:</p>\n<pre><code>go build -o yourLib.so -buildmode=c-shared main.go\n</code></pre>\n"}], "owner": {"reputation": 427, "user_id": 6254868, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-coh80Kgp5wI/AAAAAAAAAAI/AAAAAAAAAEM/YAQYO15Emg0/photo.jpg?sz=128", "display_name": "\u041e\u043b\u0435\u0433 \u0421\u0438\u0434\u043e\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/6254868/%d0%9e%d0%bb%d0%b5%d0%b3-%d0%a1%d0%b8%d0%b4%d0%be%d1%80%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 135, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1611936301, "creation_date": 1554295945, "last_edit_date": 1554297955, "question_id": 55495681, "link": "https://stackoverflow.com/questions/55495681/how-to-build-so-library-for-arm-architecture", "title": "How to build SO library for ARM architecture", "body": "<p>I need to build a shared library in Go. For this purpose, I used <code>CGO</code> and then built <code>SO</code> lib with options </p>\n\n<blockquote>\n  <p>go build -o libUtil.so -buildmode=c-shared main.go</p>\n</blockquote>\n\n<p>Now, I need to do the same, but for <code>ARM</code> architecture. When I do not use <code>CGO</code>, I only do <code>export GOARCH=arm</code>\nand this is enough to succeed. However, when I use <code>CGO</code>, I can not build <code>SO</code> library. </p>\n\n<p>I suspect, that I need to install <em>arm build tools</em>, but I don`t know how to do that and how to configure my GO environment to use these tools. I hope, somebody might help me. </p>\n\n<p>OS is Linux.</p>\n"}, {"tags": ["apache", "go", "cpu-usage"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1554294851, "post_id": 55495270, "comment_id": 97697659, "body": "Likely because an individual http request takes basically 0 cpu. Normally you just collect the stats in aggregate."}, {"owner": {"reputation": 19, "user_id": 11303778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4be77a652db2d857480c901b1dbbeaf?s=128&d=identicon&r=PG&f=1", "display_name": "azee", "link": "https://stackoverflow.com/users/11303778/azee"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554296080, "post_id": 55495270, "comment_id": 97698487, "body": "yeah that is why i was sending many reuests to generate some cpu usage and then divide by the no of requests, but now i cant do that ?i have to get individual  requests as well.. is theer like any hadler thatw e can wrap around a reuest and calculate?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1554296398, "post_id": 55495270, "comment_id": 97698697, "body": "There&#39;s not really a useful &#39;instantaneous&quot; CPU load, and if you&#39;re receiving lots of requests, you&#39;re going to be wasting more resources trying to measure the same thing over and over again. What wrong with normal process of recording cpu stats and http requests separately (which can be correlated on demand)?"}, {"owner": {"reputation": 19, "user_id": 11303778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4be77a652db2d857480c901b1dbbeaf?s=128&d=identicon&r=PG&f=1", "display_name": "azee", "link": "https://stackoverflow.com/users/11303778/azee"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554296634, "post_id": 55495270, "comment_id": 97698848, "body": "that wont give me the desired output, i wont be calculating it daily, ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554296885, "post_id": 55495270, "comment_id": 97698997, "body": "You already mentioned that you were planning on recording the load and dividing by number of requests. You can record the stats at whatever resolution you want, it doesn&#39;t have to be daily."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1554297054, "post_id": 55495270, "comment_id": 97699121, "body": "How does Go relate to a question about apache logs?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554297166, "post_id": 55495270, "comment_id": 97699201, "body": "You can see in the <a href=\"http://httpd.apache.org/docs/current/mod/mod_log_config.html\" rel=\"nofollow noreferrer\">documentation</a> all of the fields available for logging from Apache. CPU usage isn&#39;t an option (probably in part because there&#39;s no cross-platform way to do this, and partially because it&#39;s probably impossible to isolate a single HTTP request for profiling)."}, {"owner": {"reputation": 19, "user_id": 11303778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4be77a652db2d857480c901b1dbbeaf?s=128&d=identicon&r=PG&f=1", "display_name": "azee", "link": "https://stackoverflow.com/users/11303778/azee"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554352080, "post_id": 55495270, "comment_id": 97721114, "body": "@Flimzy yes i have checked that documentation, i know it is not there, i had an indepth research regarding this, but couldnt find anything, that is why i asked here.. if there is any way? thanks for the reply all..and why negative votes? you could have suggested some other stack website/"}], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 11303778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4be77a652db2d857480c901b1dbbeaf?s=128&d=identicon&r=PG&f=1", "display_name": "azee", "link": "https://stackoverflow.com/users/11303778/azee"}, "edited": false, "score": 0, "creation_date": 1554351915, "post_id": 55496663, "comment_id": 97721070, "body": "i do agree with that and that is exactly what i have done until now, but now i had to do the indvidual requests, and after all the research i didnot find anything, so iansked here, thinking maybe there is something that i havenot gotten my hand into.. thanks for the reply."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 19, "user_id": 11303778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4be77a652db2d857480c901b1dbbeaf?s=128&d=identicon&r=PG&f=1", "display_name": "azee", "link": "https://stackoverflow.com/users/11303778/azee"}, "edited": false, "score": 0, "creation_date": 1554383574, "post_id": 55496663, "comment_id": 97738374, "body": "You could try doing the same thing to measure the CPU time consumed by handling a single request but there&#39;s a reason why people measure by applying heavy load and dividing by the number of requests issued; there can be high variance in handling the same request, so an average is more indicative, plus there&#39;s overhead for the parent process that will add more noise relative to a single request than to many requests."}, {"owner": {"reputation": 19, "user_id": 11303778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4be77a652db2d857480c901b1dbbeaf?s=128&d=identicon&r=PG&f=1", "display_name": "azee", "link": "https://stackoverflow.com/users/11303778/azee"}, "edited": false, "score": 0, "creation_date": 1554384676, "post_id": 55496663, "comment_id": 97739158, "body": "but it is very difficult to measure using top and other command line tools, i want to check if we can write some code for the same and what direction would that be like?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 19, "user_id": 11303778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4be77a652db2d857480c901b1dbbeaf?s=128&d=identicon&r=PG&f=1", "display_name": "azee", "link": "https://stackoverflow.com/users/11303778/azee"}, "edited": false, "score": 0, "creation_date": 1554404042, "post_id": 55496663, "comment_id": 97750420, "body": "@azee: if you&#39;re on linux, do what command line tools do and read <code>&#47;proc&#47;stat</code>. Implementing that will probably give you a better understanding of what it means to &quot;calculate cpu usage&quot;"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 4, "last_activity_date": 1554383434, "last_edit_date": 1554383434, "creation_date": 1554298929, "answer_id": 55496663, "question_id": 55495270, "link": "https://stackoverflow.com/questions/55495270/how-to-calculate-cpu-usage-of-each-http-request/55496663#55496663", "title": "How to calculate CPU usage of each HTTP request", "body": "<p>The <em>percentage</em> (CPU <em>load</em>) - no matter how you collect it - will <em>always</em> be a point-in-time sample. It's useful for determining what process is using more of the CPU at a given moment, it's useful for profiling a program to see which parts use a greater proportion of CPU over the course of an execution, but it's completely useless for knowing how much CPU a request consumes; that cannot be measured in CPU% at all. Even if you managed to calculate it, \"a request uses 5% CPU\" is meaningless - does it use 5% for a nanosecond? For an hour? What you want to measure for something like this is CPU <em>time</em>: how long the CPU was actively in use by your process.</p>\n\n<p>CPU load is basically calculated as: in the last sample period (say, 1 second), how much of the time was the CPU executing instructions for this process. CPU time is the core of that metric: how much time did the CPU spend executing instructions for this process. That's a metric you can meaningfully use for finding profiling targets for optimization, capacity planning, performance benchmarking, and so on.</p>\n\n<p>The quickest way to get that info would be to restart the service, generate a known level of load (say, 100k requests), check the CPU <em>time</em> of the process (e.g. as shown in <code>top</code>) at the end, and divide that by the request count. That would tell you how much CPU time a request consumes.</p>\n"}], "owner": {"reputation": 19, "user_id": 11303778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4be77a652db2d857480c901b1dbbeaf?s=128&d=identicon&r=PG&f=1", "display_name": "azee", "link": "https://stackoverflow.com/users/11303778/azee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1371, "favorite_count": 0, "closed_date": 1554306962, "answer_count": 1, "score": -2, "last_activity_date": 1554383434, "creation_date": 1554294667, "last_edit_date": 1554297043, "question_id": 55495270, "link": "https://stackoverflow.com/questions/55495270/how-to-calculate-cpu-usage-of-each-http-request", "closed_reason": "Not suitable for this site", "title": "How to calculate CPU usage of each HTTP request", "body": "<p>I want to get the CPU usage of each individual request sent to my local Apache server. I am using top to capture the CPU usage but it is not that reliable, because most of the times it captures 0 as CPU usage. I have checked utilities like psutil etc but they did not work?</p>\n\n<p>Is there anyway (some code or package in Go) that can be helpful in this regard?\nP.S the best way for me would be if I can't get CPU usage in access.log file?</p>\n"}, {"tags": ["go", "sftp"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1554293282, "creation_date": 1554293282, "answer_id": 55494800, "question_id": 55494698, "link": "https://stackoverflow.com/questions/55494698/is-there-a-way-to-determine-if-current-step-is-a-directory/55494800#55494800", "title": "Is there a way to determine if current step is a directory?", "body": "<p>You may use <a href=\"https://godoc.org/github.com/kr/fs#Walker.Stat\" rel=\"nofollow noreferrer\"><code>Walker.Stat()</code></a> to obtain info about the most recent file or directory visited by a call to <a href=\"https://godoc.org/github.com/kr/fs#Walker.Step\" rel=\"nofollow noreferrer\"><code>Walker.Step()</code></a>. It returns you a value of type <a href=\"https://golang.org/pkg/os/#FileInfo\" rel=\"nofollow noreferrer\"><code>os.FileInfo</code></a> which has an <code>IsDir()</code> method.</p>\n\n<p>For example:</p>\n\n<pre><code>for walker.Step() {\n    if err := walker.Err(); err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        continue\n    }\n\n    if fi := walker.Stat(); fi.IsDir() {\n        continue // Skip dir\n    }\n\n    // ...\n}\n</code></pre>\n"}], "owner": {"reputation": 118, "user_id": 11027001, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YIIvc.jpg?s=128&g=1", "display_name": "Nikita Bulanakov", "link": "https://stackoverflow.com/users/11027001/nikita-bulanakov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "accepted_answer_id": 55494800, "answer_count": 1, "score": 2, "last_activity_date": 1554309477, "creation_date": 1554292958, "last_edit_date": 1554309477, "question_id": 55494698, "link": "https://stackoverflow.com/questions/55494698/is-there-a-way-to-determine-if-current-step-is-a-directory", "title": "Is there a way to determine if current step is a directory?", "body": "<p>I need to implement sftp client that connects to a host, read all available files in a specified folder, then check if a particular file matches a pattern and copy it to according local directory. Problem is that i can't find a way to.</p>\n\n<p>I tried to use client.Walk but cannot figure out a way to understand if this is a directory and skip it:</p>\n\n<pre><code>walker := client.Walk(startDir)\nfor walker.Step() {\n    if err := walker.Err(); err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        continue\n    }\n\n\n    filePath := walker.Path()\n}\n</code></pre>\n\n<p>How can I determine if the current iteration is directory?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1554284187, "post_id": 55491830, "comment_id": 97690963, "body": "It&#39;s a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a>. <code>v.(T)</code> asserts that the value <code>v</code> is of type <code>T</code>. So <code>po[&quot;TradeItems&quot;].(map[string]PRTradeItem)</code> asserts that the value associated with the <code>&quot;TradeItems&quot;</code> key in map <code>po</code> is of type <code>map[string]PRTradeItem</code>."}, {"owner": {"reputation": 1105, "user_id": 1274878, "user_type": "registered", "accept_rate": 24, "profile_image": "https://www.gravatar.com/avatar/4c03ea4489c49fabca0a0c543b96f619?s=128&d=identicon&r=PG", "display_name": "user1274878", "link": "https://stackoverflow.com/users/1274878/user1274878"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1554284375, "post_id": 55491830, "comment_id": 97691099, "body": "Sure, but why is that needed? I know the type of <code>po[&quot;TradeItems&quot;]</code> . Please explain in-depth. Why should I assert?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1554284461, "post_id": 55491830, "comment_id": 97691149, "body": "Why don&#39;t you just marshal your struct directly? Why bother with the map?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554284517, "post_id": 55491830, "comment_id": 97691204, "body": "You should type assert, because that&#39;s the only way to get to the underlying data type of an interface."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1554284527, "post_id": 55491830, "comment_id": 97691218, "body": "Because Go is a statically typed language and you defined <code>po</code>&#39;s value type as <code>interface{}</code> so the result of <code>po[somekey]</code> will always be a value of type <code>interface{}</code>."}], "answers": [{"tags": [], "owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "is_accepted": false, "score": 3, "last_activity_date": 1554284537, "creation_date": 1554284537, "answer_id": 55491982, "question_id": 55491830, "link": "https://stackoverflow.com/questions/55491830/how-to-populate-a-mapstring-interface-when-my-value-is-a-struct-type/55491982#55491982", "title": "How to populate a map[string] interface{} when my value is a struct type?", "body": "<blockquote>\n  <p>I know the type of <code>po[\"TradeItems\"]</code>. Please explain in-depth. Why should I assert?</p>\n</blockquote>\n\n<p>You do, but the compiler doesn't. Your <code>po</code> has type <code>map[string]interface{}</code>. So <code>po[\"TradeItems\"]</code> in <code>po[\"TradeItems\"][\"sku1\"]</code> returns an object of type <code>interface{}</code>, which you can't do anything useful with (not without reflection or type-assertions).</p>\n\n<p>Hence the need to hint the compiler with that type assertion.</p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 6, "last_activity_date": 1554287261, "creation_date": 1554287261, "answer_id": 55492914, "question_id": 55491830, "link": "https://stackoverflow.com/questions/55491830/how-to-populate-a-mapstring-interface-when-my-value-is-a-struct-type/55492914#55492914", "title": "How to populate a map[string] interface{} when my value is a struct type?", "body": "<blockquote>\n  <p>I am wanting to build a JSON equivalent of the PurchaseOrder struct below:</p>\n\n<pre><code>type PurchaseOrder struct {\n    State      string\n    FsmName    string\n    Supplier   string\n    Receiver   string\n    TradeItems map[string]PRTradeItem\n}\n</code></pre>\n</blockquote>\n\n<p>The easiest way is:</p>\n\n<pre><code>po := PurchaseOrder{\n    State:      \"paid\",\n    Supplier:   \"Acme, Inc.\",\n    TradeItems: map[string]PRTradeItem{\n        \"sku1\": PRTradeItem{Quantity: 100, Supplier: \"org2\", ... },\n    },\n}\npoAsBytes, err := json.Marshal(po)\n</code></pre>\n\n<p>Forget about your <code>po := make(map[string]interface{})</code> and manual manipulation of the map.</p>\n\n<p>If you need to control the JSON keys in your <code>PurchaseOrder</code> object, add the appropriate <code>json</code> tags, as you did for the <code>PRTradeItem</code> definition.</p>\n"}], "owner": {"reputation": 1105, "user_id": 1274878, "user_type": "registered", "accept_rate": 24, "profile_image": "https://www.gravatar.com/avatar/4c03ea4489c49fabca0a0c543b96f619?s=128&d=identicon&r=PG", "display_name": "user1274878", "link": "https://stackoverflow.com/users/1274878/user1274878"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 555, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1554287261, "creation_date": 1554284114, "last_edit_date": 1554286867, "question_id": 55491830, "link": "https://stackoverflow.com/questions/55491830/how-to-populate-a-mapstring-interface-when-my-value-is-a-struct-type", "title": "How to populate a map[string] interface{} when my value is a struct type?", "body": "<p>I am wanting to build a JSON equivalent of the <code>PurchaseOrder</code> struct below:</p>\n\n<pre><code>type PurchaseOrder struct {\n    State      string\n    FsmName    string\n    Supplier   string\n    Receiver   string\n    TradeItems map[string]PRTradeItem\n}\n\ntype PRTradeItem struct {\n    Quantity float64 `json:\"quantity\"`\n    Supplier string  `json:\"supplier\"`\n    Receiver string  `json:\"receiver\"`\n\n    PricePerUnit float64 `json:\"pricePerUnit\"`\n}\n</code></pre>\n\n<p>In order to do so, I did the following:</p>\n\n<pre><code>po := make(map[string]interface{})\npo[\"Sender\"] = \"org2\"\npo[\"Receiver\"] = \"org1\"\npo[\"TradeItems\"] = make(map[string]PRTradeItem)\npo[\"TradeItems\"][\"sku1\"] = PRTradeItem{Quantity: 100, Supplier: \"org2\", Receiver: \"org1\", PricePerUnit: 10.5}\npoAsBytes, _ := JSON.Marshal(po)\n</code></pre>\n\n<p>The error that I get is:</p>\n\n<blockquote>\n  <p>invalid operation: po[\"TradeItems\"][\"sku1\"] (type interface {} does not support indexing). </p>\n</blockquote>\n\n<p>After looking around a bit, I added the following lines to the code and it worked.</p>\n\n<pre><code>internalMap, ok := po[\"TradeItems\"].(map[string]PRTradeItem)\nif !ok{\n\n    panic(\"why???\")\n}\nif ok{  \n    internalMap[\"sku1\"] = PRTradeItem{Quantity:100,Supplier:\"org2\", Receiver:\"org1\", PricePerUnit:10.5}\n}\n</code></pre>\n\n<p>I don't quite understand what this line means </p>\n\n<pre><code>internalMap, ok := po[\"TradeItems\"].(map[string]PRTradeItem)\n</code></pre>\n\n<p>Can someone please explain?</p>\n"}, {"tags": ["excel", "go", "xls"], "comments": [{"owner": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "edited": false, "score": 0, "creation_date": 1554286856, "post_id": 55490786, "comment_id": 97692675, "body": "You are using <a href=\"https://github.com/extrame/xls\" rel=\"nofollow noreferrer\">extrame/xls</a>?"}, {"owner": {"reputation": 13, "user_id": 11219647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac7bbddd2616e6c18ca4d4483939425f?s=128&d=identicon&r=PG&f=1", "display_name": "Nandini", "link": "https://stackoverflow.com/users/11219647/nandini"}, "reply_to_user": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "edited": false, "score": 0, "creation_date": 1554287042, "post_id": 55490786, "comment_id": 97692802, "body": "Yes github.com/extrame/xls"}, {"owner": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "edited": false, "score": 0, "creation_date": 1554287537, "post_id": 55490786, "comment_id": 97693107, "body": "There is no issue in the code and it is printing numerical values correctly, I believe that the problem is with the xls file format. Maybe saving it again in the correct format will solve the issue. Open the xls file in Excel and then save it as  <code>File -&gt; Save as -&gt; Excel 97- 2003 (Save as type)</code>, after this try this code again."}, {"owner": {"reputation": 13, "user_id": 11219647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac7bbddd2616e6c18ca4d4483939425f?s=128&d=identicon&r=PG&f=1", "display_name": "Nandini", "link": "https://stackoverflow.com/users/11219647/nandini"}, "reply_to_user": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "edited": false, "score": 0, "creation_date": 1554288705, "post_id": 55490786, "comment_id": 97693782, "body": "My file format is Excel 97- 2003 still its not reading int value correctly"}, {"owner": {"reputation": 5432, "user_id": 4723732, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/77fa71fdc548472c228be40043c1bc1f?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Rublev", "link": "https://stackoverflow.com/users/4723732/richard-rublev"}, "edited": false, "score": 0, "creation_date": 1554292248, "post_id": 55490786, "comment_id": 97695975, "body": "@Nandini Which OS are you using?"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 11219647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac7bbddd2616e6c18ca4d4483939425f?s=128&d=identicon&r=PG&f=1", "display_name": "Nandini", "link": "https://stackoverflow.com/users/11219647/nandini"}, "edited": false, "score": 0, "creation_date": 1554299834, "post_id": 55494812, "comment_id": 97700908, "body": "But my numeric value output is @"}], "tags": [], "owner": {"reputation": 5432, "user_id": 4723732, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/77fa71fdc548472c228be40043c1bc1f?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Rublev", "link": "https://stackoverflow.com/users/4723732/richard-rublev"}, "is_accepted": false, "score": 0, "last_activity_date": 1554302528, "last_edit_date": 1554302528, "creation_date": 1554293310, "answer_id": 55494812, "question_id": 55490786, "link": "https://stackoverflow.com/questions/55490786/reading-value-from-xls-file-but-numeric-value-are-not-read-properly/55494812#55494812", "title": "Reading value from xls file but numeric value are not read properly", "body": "<p>On my Ubuntu 18.04,I can open file and print content of second column</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/extrame/xls\"\n    \"log\"\n)\n\n\nfunc main() {\nif xlFile, err := xls.Open(\"test.xls\", \"utf-8\"); err == nil {\n    for i := 0; i &lt; xlFile.NumSheets(); i++ {\n        sheet := xlFile.GetSheet(i)\n        fmt.Println(sheet.Name)\n        for r := 0; r &lt;= (int(sheet.MaxRow)); r++ {\n                row := sheet.Row(r)\n                log.Println(\"column \", row.Col(1))\n        }\n    }\n}\n</code></pre>\n\n<p>}</p>\n\n<p>Pay special attention on Col(1) indexing.</p>\n\n<p>Output</p>\n\n<pre><code>Sheet1\n2019/04/03 14:28:29 column  test\n2019/04/03 14:28:29 column  testi\n2019/04/03 14:28:29 column  testing\n</code></pre>\n\n<p>But for numerical column I got this</p>\n\n<pre><code>Sheet1\n2019/04/03 14:27:46 column  General\n2019/04/03 14:27:46 column  General\n2019/04/03 14:27:46 column  General\n</code></pre>\n\n<p>I saved the same file as xlsx. This works with tealeg/xlsx package</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"github.com/tealeg/xlsx\"\n)\n\nfunc main() {\n    excelFileName := \"test.xlsx\"\n    xlFile, err := xlsx.OpenFile(excelFileName)\n    if err != nil {\n        err = fmt.Errorf(\"can not open file!!!\", err)\n    return\n    }\n    for _, sheet := range xlFile.Sheets {\n        for _, row := range sheet.Rows {\n            for _, cell := range row.Cells {\n                text := cell.String()\n                fmt.Println(text)\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>123\ntest\n788\n456\ntesti\n999\n789\ntesting\n100\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 11219647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac7bbddd2616e6c18ca4d4483939425f?s=128&d=identicon&r=PG&f=1", "display_name": "Nandini", "link": "https://stackoverflow.com/users/11219647/nandini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 313, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1554302528, "creation_date": 1554281067, "last_edit_date": 1554281816, "question_id": 55490786, "link": "https://stackoverflow.com/questions/55490786/reading-value-from-xls-file-but-numeric-value-are-not-read-properly", "title": "Reading value from xls file but numeric value are not read properly", "body": "<p>Numeric value from xls file are not reading properly but the string values are fine</p>\n\n<pre><code>file, _ := xls.Open(\"test.xls\", \"utf-8\")\n\n    sheet := file.GetSheet(0)\n    for r := 0; r &lt;= (int(sheet.MaxRow)); r++ {\n      row := sheet.Row(r)\n      log.Println(\"column with numeric value: \", row.Col(0))\n      log.Println(\"column with string value: \", row.Col(1))\n    }\n</code></pre>\n\n<p><strong>test.xls:</strong></p>\n\n<pre><code>123 | test\n\n456 | testing\n</code></pre>\n\n<p><strong>output:</strong></p>\n\n<pre><code>column with numeric value: @\n\ncolumn with string value: test\n\ncolumn with numeric value: @\n\ncolumn with string value: testing\n</code></pre>\n\n<p>How can I get numeric value correctly?</p>\n"}, {"tags": ["mongodb", "go", "uuid"], "comments": [{"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1554283805, "post_id": 55490781, "comment_id": 97690732, "body": "Related: <a href=\"https://stackoverflow.com/a/46327297/2313887\">Performance gains to using UUID instead of its string representation as _id on MongoDB?</a> and <a href=\"https://stackoverflow.com/a/50895446/2313887\">How should I handle UUID fields using mgo?</a>. It really comes down to personal choice, but I would strongly recommend the type actually be set as <code>bson.Binary</code>. Really comes down to whether the &quot;textual&quot; representation is important to you in queries or not, but since you opted for the &quot;random&quot; type, then I&#39;m guessing an expected &quot;text pattern&quot; really isn&#39;t what you would be after."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1554284000, "post_id": 55490781, "comment_id": 97690863, "body": "Your marshaler is on a pointer, but you&#39;re using a concrete type, so the marshaler is being ignored. Either use <code>*mongoUUID</code> in your <code>mongoWrapper</code> struct, or change your marshaler to use <code>mongoUUID</code> as a receiver type."}, {"owner": {"reputation": 343, "user_id": 380599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/612a0e49e37a810fb1f5548c6c3fb446?s=128&d=identicon&r=PG", "display_name": "jlucktay", "link": "https://stackoverflow.com/users/380599/jlucktay"}, "edited": false, "score": 0, "creation_date": 1554284911, "post_id": 55490781, "comment_id": 97691426, "body": "I use concrete <code>mongoUUID</code> instead of pointers, and now I get <code>storage_test.go:38: err: too few bytes to read next component</code>"}], "answers": [{"comments": [{"owner": {"reputation": 343, "user_id": 380599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/612a0e49e37a810fb1f5548c6c3fb446?s=128&d=identicon&r=PG", "display_name": "jlucktay", "link": "https://stackoverflow.com/users/380599/jlucktay"}, "edited": false, "score": 0, "creation_date": 1554283917, "post_id": 55491139, "comment_id": 97690812, "body": "I gave this a shot and edited the code changes into my question."}, {"owner": {"reputation": 343, "user_id": 380599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/612a0e49e37a810fb1f5548c6c3fb446?s=128&d=identicon&r=PG", "display_name": "jlucktay", "link": "https://stackoverflow.com/users/380599/jlucktay"}, "edited": false, "score": 1, "creation_date": 1556793797, "post_id": 55491139, "comment_id": 98553549, "body": "I came to <a href=\"https://github.com/jlucktay/rest-api/blob/970f6e80aa17df3390abca425c4d85edabc5ea83/pkg/storage/mongo/uuid.go\" rel=\"nofollow noreferrer\">this implementation</a> as a solution for this"}, {"owner": {"reputation": 391, "user_id": 2349872, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79ca62ad8d8e26c9b541c1f236c373c1?s=128&d=identicon&r=PG", "display_name": "saniales", "link": "https://stackoverflow.com/users/2349872/saniales"}, "reply_to_user": {"reputation": 343, "user_id": 380599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/612a0e49e37a810fb1f5548c6c3fb446?s=128&d=identicon&r=PG", "display_name": "jlucktay", "link": "https://stackoverflow.com/users/380599/jlucktay"}, "edited": false, "score": 1, "creation_date": 1580057957, "post_id": 55491139, "comment_id": 105964587, "body": "Awesome @jlucktay please post this as answer. It works also for me."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 391, "user_id": 2349872, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79ca62ad8d8e26c9b541c1f236c373c1?s=128&d=identicon&r=PG", "display_name": "saniales", "link": "https://stackoverflow.com/users/2349872/saniales"}, "edited": false, "score": 0, "creation_date": 1580140814, "post_id": 55491139, "comment_id": 105991190, "body": "@saniales: Neither my solution, nor jlucktay&#39;s use a type alias at all. And your proposal is identical to mine. So I&#39;m not really sure what point you&#39;re making."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1554282094, "creation_date": 1554282094, "answer_id": 55491139, "question_id": 55490781, "link": "https://stackoverflow.com/questions/55490781/uuid-as-id-error-cant-use-an-array-for-id/55491139#55491139", "title": "UUID as _id error - can&#39;t use an array for _id", "body": "<p><a href=\"https://godoc.org/github.com/satori/go.uuid#UUID\" rel=\"nofollow noreferrer\"><code>uuid.UUID</code></a> is a <code>[16]byte</code> under the hood.</p>\n\n<p>However, this type also implements the <code>encoding.TextMarshaler</code> interface, which I would expect mongo to honor (the same way the <code>json</code> package does).</p>\n\n<p>I believe the solution is to create your own type, which embeds the <code>uuid.UUID</code> type, and provides a custom implementation of the <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/bson#Marshaler\" rel=\"nofollow noreferrer\"><code>bson.Marshaler</code> interface</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 343, "user_id": 380599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/612a0e49e37a810fb1f5548c6c3fb446?s=128&d=identicon&r=PG", "display_name": "jlucktay", "link": "https://stackoverflow.com/users/380599/jlucktay"}, "edited": false, "score": 1, "creation_date": 1580103345, "post_id": 59925583, "comment_id": 105973628, "body": "Glad it helped you out @saniales :)"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1580310860, "post_id": 59925583, "comment_id": 106056830, "body": "This is a poor approach. It&#39;s much better to embed the type, as proposed in my answer, so that the methods on the embedded type are still usable."}, {"owner": {"reputation": 343, "user_id": 380599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/612a0e49e37a810fb1f5548c6c3fb446?s=128&d=identicon&r=PG", "display_name": "jlucktay", "link": "https://stackoverflow.com/users/380599/jlucktay"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1580469754, "post_id": 59925583, "comment_id": 106116493, "body": "Thanks for the feedback @Flimzy - I&#39;ve <a href=\"https://github.com/jlucktay/rest-api/commit/caa8741b08c679115bbc7f25a5db79911cb921ff#diff-64e14639fdc8f8bdee63201031217aef\" rel=\"nofollow noreferrer\">refactored</a> to embed the UUID type, and updated the answer as well"}], "tags": [], "owner": {"reputation": 343, "user_id": 380599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/612a0e49e37a810fb1f5548c6c3fb446?s=128&d=identicon&r=PG", "display_name": "jlucktay", "link": "https://stackoverflow.com/users/380599/jlucktay"}, "is_accepted": true, "score": 0, "last_activity_date": 1580469695, "last_edit_date": 1580469695, "creation_date": 1580103299, "answer_id": 59925583, "question_id": 55490781, "link": "https://stackoverflow.com/questions/55490781/uuid-as-id-error-cant-use-an-array-for-id/59925583#59925583", "title": "UUID as _id error - can&#39;t use an array for _id", "body": "<p>I came to the below implementation as a solution for this:</p>\n\n<pre><code>type mongoUUID struct {\n    uuid.UUID\n}\n\nfunc (mu mongoUUID) MarshalBSONValue() (bsontype.Type, []byte, error) {\n    return bsontype.Binary, bsoncore.AppendBinary(nil, 4, mu.UUID[:]), nil\n}\n\nfunc (mu *mongoUUID) UnmarshalBSONValue(t bsontype.Type, raw []byte) error {\n    if t != bsontype.Binary {\n        return fmt.Errorf(\"invalid format on unmarshal bson value\")\n    }\n\n    _, data, _, ok := bsoncore.ReadBinary(raw)\n    if !ok {\n        return fmt.Errorf(\"not enough bytes to unmarshal bson value\")\n    }\n\n    copy(mu.UUID[:], data)\n\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 343, "user_id": 380599, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/612a0e49e37a810fb1f5548c6c3fb446?s=128&d=identicon&r=PG", "display_name": "jlucktay", "link": "https://stackoverflow.com/users/380599/jlucktay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 784, "favorite_count": 0, "accepted_answer_id": 59925583, "answer_count": 2, "score": 1, "last_activity_date": 1580469695, "creation_date": 1554281053, "last_edit_date": 1554283862, "question_id": 55490781, "link": "https://stackoverflow.com/questions/55490781/uuid-as-id-error-cant-use-an-array-for-id", "title": "UUID as _id error - can&#39;t use an array for _id", "body": "<p>I'm attempting to use UUIDs for my <code>_id</code> field in a MongoDB.</p>\n\n<p>I have a wrapper struct to hold my record, like so:</p>\n\n<pre><code>type mongoWrapper struct {\n    ID      uuid.UUID       `bson:\"_id\" json:\"_id\"`\n    Payment storage.Payment `bson:\"payment\" json:\"payment\"`\n}\n</code></pre>\n\n<p>This is my code around the InsertOne function from the MongoDB driver packages:</p>\n\n<pre><code>func (s *Storage) Create(newPayment storage.Payment) (uuid.UUID, error) {\n    mongoInsert := wrap(newPayment)\n    c := s.client.Database(thisDatabase).Collection(thisCollection)\n\n    insertResult, errInsert := c.InsertOne(context.TODO(), mongoInsert)\n    if errInsert != nil {\n        return uuid.Nil, errInsert\n    }\n\n    fmt.Println(\"Inserted a single document: \", insertResult.InsertedID)\n\n    return mongoInsert.ID, nil\n}\n</code></pre>\n\n<p>This is my wrap() func that wraps up the payment record data, and takes an optional UUID argument or generates its own accordingly:</p>\n\n<pre><code>func wrap(p storage.Payment, i ...uuid.UUID) *mongoWrapper {\n    mw := &amp;mongoWrapper{ID: uuid.Nil, Payment: p}\n\n    if len(i) &gt; 0 {\n        mw.ID = i[0]\n        return mw\n    }\n\n    newID, errID := uuid.NewV4()\n    if errID != nil {\n        log.Fatal(errID)\n    }\n\n    mw.ID = newID\n\n    return mw\n}\n</code></pre>\n\n<p>When one of my tests calls Create() it returns the following error:</p>\n\n<pre><code>storage_test.go:38: err: multiple write errors: [{write errors: [{can't use an array for _id}]}, {&lt;nil&gt;}]\n</code></pre>\n\n<p>I'm using the following packages for my UUIDs and MongoDB driver:</p>\n\n<pre><code>import(\n    uuid \"github.com/satori/go.uuid\"\n\n    \"go.mongodb.org/mongo-driver/mongo\"\n)\n</code></pre>\n\n<p>I'm not clear on where exactly the problem lies.</p>\n\n<p>Do I need some extra plumbing around the UUID in order for it to be handled correctly?</p>\n\n<p><strong>edit:</strong> I made some more changes, but the UUID still comes through as an array:</p>\n\n<pre><code>type mongoWrapper struct {\n    UUID    mongoUUID       `bson:\"uuid\" json:\"uuid\"`\n    Payment storage.Payment `bson:\"payment\" json:\"payment\"`\n}\n\ntype mongoUUID struct {\n    uuid.UUID\n}\n\nfunc (mu *mongoUUID) MarshalBSON() ([]byte, error) {\n    return []byte(mu.UUID.String()), nil\n}\n\nfunc (mu *mongoUUID) UnmarshalBSON(b []byte) error {\n    mu.UUID = uuid.FromStringOrNil(string(b))\n    return nil\n}\n</code></pre>\n"}, {"tags": ["go", "testing", "mocking"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1554281868, "post_id": 55490695, "comment_id": 97689585, "body": "You can omit the mock implementation of methods you don&#39;t need by embedding the interface into the mock. Just keep in mind that if anything in the code under test calls the unimplemented methods it will cause <code>panic</code>. <a href=\"https://play.golang.org/p/wSjz5SoEHyv\" rel=\"nofollow noreferrer\">play.golang.org/p/wSjz5SoEHyv</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1554281885, "post_id": 55490695, "comment_id": 97689590, "body": "What do you want to test? <code>Foo</code>? Then you don&#39;t need to mock anything, you just need to pass a value that implements <code>MyInterface</code>. If you already have an implementation like <code>MyInterfaceImplementation</code>, simply use that."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1554281959, "post_id": 55490695, "comment_id": 97689640, "body": "Also note that if <code>Foo()</code> only uses the <code>func1()</code> method, then it shouldn&#39;t expect a value that implements <code>MyInterface</code>, only an interface with the single <code>func1()</code> method, or even better: it should just expect a function value."}], "answers": [{"tags": [], "owner": {"reputation": 8680, "user_id": 80711, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/894f4423fafc44e67beaaa73f0554d5c?s=128&d=identicon&r=PG", "display_name": "Henryk Konsek", "link": "https://stackoverflow.com/users/80711/henryk-konsek"}, "is_accepted": false, "score": 2, "last_activity_date": 1554284416, "creation_date": 1554284416, "answer_id": 55491936, "question_id": 55490695, "link": "https://stackoverflow.com/questions/55490695/how-to-mock-interface-implementation/55491936#55491936", "title": "How to mock interface implementation", "body": "<p>You have to implement all the methods. Interface is a contract and you need to fulfill this contract.</p>\n\n<p>If you're sure that <code>fun2</code> and <code>fun3</code> methods will not be called, then it usually means that your interface contract is too wide. Consider extracting <code>fun1</code> into dedicated interface in such case.</p>\n"}], "owner": {"reputation": 293, "user_id": 4607015, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/lWkYD.jpg?s=128&g=1", "display_name": "esquarer", "link": "https://stackoverflow.com/users/4607015/esquarer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1554284416, "creation_date": 1554280772, "last_edit_date": 1554282879, "question_id": 55490695, "link": "https://stackoverflow.com/questions/55490695/how-to-mock-interface-implementation", "title": "How to mock interface implementation", "body": "<p>myinterface.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type MyInterface interface {\n    fun1() string\n    fun2() int\n    fun3() bool\n}\n\n\nfunc Foo(mi MyInterface) string {\n    return mi.fun1()\n}\n</code></pre>\n\n<p>myinterface_test.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type MyInterfaceImplementation struct{}\n\nfunc (mi MyInterfaceImplementation) fun1() string {\n    return \"foobar\"\n}\n\nfunc (mi MyInterfaceImplementation) fun2() int {\n    return int(100)\n}\n\nfunc (mi MyInterfaceImplementation) fun3() bool {\n    return false\n}\n\n\nfunc TestFoo(t *testing.T) {\n    mi := MyInterfaceImplementation{}\n    val := Foo(mi)\n    if val != \"foobar\" {\n        t.Errorf(\"Expected 'foobar', Got %s\", mi.fun1())\n    }\n}\n</code></pre>\n\n<p>While writing tests for <code>Foo</code>, is it necessary to do a mock implementation of the interface <code>MyInterface</code> (as it requires us to implement <code>fun2</code> and <code>fun3</code> as well which are not being used in <code>Foo</code>)? </p>\n\n<p>Is there any way in which we can write tests for <code>Foo</code> wherein we just need to write the mock implementation of <code>fun1</code> and not for <code>fun2</code> and <code>fun3</code>?</p>\n\n<p>Also, what's the ideal way to test such use of interfaces in Go?</p>\n"}, {"tags": ["go", "gpio", "orange-pi", "gobot.io"], "comments": [{"owner": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "edited": false, "score": 0, "creation_date": 1554287846, "post_id": 55490422, "comment_id": 97693275, "body": "This is not an answer. But would you consider having two programs, the python program running as a daemon with an HTTP server for example to take commands from the Go program? I think that you won&#39;t find much support for orange-pi especially in Go."}, {"owner": {"reputation": 31, "user_id": 3073921, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe8cd391808bd66d72562b353fbe2a0e?s=128&d=identicon&r=PG", "display_name": "dvanderleij", "link": "https://stackoverflow.com/users/3073921/dvanderleij"}, "reply_to_user": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "edited": false, "score": 0, "creation_date": 1554305191, "post_id": 55490422, "comment_id": 97704577, "body": "@Seaskyways, thanks for the suggestion  I have thought of that possibility, I have also thought of the possibility of using CGO and a c library as that way i won&#39;t have to start another executable. It would be nice however to have one executable that handles everything."}, {"owner": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "edited": false, "score": 0, "creation_date": 1554305448, "post_id": 55490422, "comment_id": 97704743, "body": "CGo is a great choice too ! You can , as an option, build your program with go, compile it as a C library, and use it in python."}], "owner": {"reputation": 31, "user_id": 3073921, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe8cd391808bd66d72562b353fbe2a0e?s=128&d=identicon&r=PG", "display_name": "dvanderleij", "link": "https://stackoverflow.com/users/3073921/dvanderleij"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 283, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1554279921, "creation_date": 1554279921, "question_id": 55490422, "link": "https://stackoverflow.com/questions/55490422/how-to-use-the-gpio-of-the-orange-pi-zero-in-conjunction-with-gobot", "title": "How to use the gpio of the orange-pi zero in conjunction with gobot", "body": "<p>For turning on led lights I want to access the GPIO of the orange-pi zero via <a href=\"https://gobot.io/\" rel=\"nofollow noreferrer\">gobot</a> I am using gobot since my server from which i want to do this is written in Go. However on the platforms section of gobot it does not mention the orange-pi platform. I already got the gpio working via <a href=\"https://opi-gpio.readthedocs.io/en/latest/index.html\" rel=\"nofollow noreferrer\">this</a> library but it is written in Python.</p>\n\n<p>I found an <a href=\"https://github.com/hybridgroup/gobot/issues/423\" rel=\"nofollow noreferrer\">issue</a> discussing the mapping of the device gpio but since I am new to the physical device scene i do not know how i would implement this into gobot</p>\n\n<p>I have <a href=\"http://www.orangepi.org/OrangePiZeroPlus/\" rel=\"nofollow noreferrer\">this</a> version of the orange pi with the <a href=\"http://linux-sunxi.org/Xunlong_Orange_Pi_Zero_Plus\" rel=\"nofollow noreferrer\">following</a> pin configuration.</p>\n\n<p>The sample code i found for enabling gpio on a raspberry pi is as follows:</p>\n\n<pre><code>    r := raspi.NewAdaptor()\n    led := gpio.NewLedDriver(r, \"7\")\n\n    work := func() {\n        gobot.Every(1*time.Second, func() {\n            led.Toggle()\n        })\n    }\n\n    robot := gobot.NewRobot(\"blinkBot\",\n        []gobot.Connection{r},\n        []gobot.Device{led},\n        work,\n    )\n\n    robot.Start()\n</code></pre>\n\n<p>I think the number on this line is relevant for my question\n<code>led := gpio.NewLedDriver(r, \"7\")</code></p>\n\n<p>My final question then is:</p>\n\n<p><strong>How do i use the gpio via gobot on an orange pi zero plus?</strong></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "edited": false, "score": 0, "creation_date": 1554275905, "post_id": 55489128, "comment_id": 97686199, "body": "xls.Open()&#39; return error is nil??"}, {"owner": {"reputation": 13, "user_id": 11219647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac7bbddd2616e6c18ca4d4483939425f?s=128&d=identicon&r=PG&f=1", "display_name": "Nandini", "link": "https://stackoverflow.com/users/11219647/nandini"}, "reply_to_user": {"reputation": 1059, "user_id": 1982418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbe9fddd5823aa8ae6a41ec889f0f581?s=128&d=identicon&r=PG&f=1", "display_name": "sh.seo", "link": "https://stackoverflow.com/users/1982418/sh-seo"}, "edited": false, "score": 0, "creation_date": 1554276955, "post_id": 55489128, "comment_id": 97686728, "body": "xls.Open() is working fine with less entries in file but if i upload a file with more no of entries it throw error"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1554278023, "post_id": 55489128, "comment_id": 97687325, "body": "what size file causes a 4.7GB allocation to happen?"}, {"owner": {"reputation": 13, "user_id": 11219647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac7bbddd2616e6c18ca4d4483939425f?s=128&d=identicon&r=PG&f=1", "display_name": "Nandini", "link": "https://stackoverflow.com/users/11219647/nandini"}, "edited": false, "score": 0, "creation_date": 1554278210, "post_id": 55489128, "comment_id": 97687440, "body": "my file size is 8753 KB"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554278416, "post_id": 55489128, "comment_id": 97687547, "body": "Go doesn&#39;t <i>throw</i> errors (or anything else). It returns errors."}, {"owner": {"reputation": 3818, "user_id": 1247113, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zRMFj.png?s=128&g=1", "display_name": "rob74", "link": "https://stackoverflow.com/users/1247113/rob74"}, "edited": false, "score": 1, "creation_date": 1554279442, "post_id": 55489128, "comment_id": 97688154, "body": "I suspect that the file is either too large to fit into memory (you ruled that out in your comment), or corrupt, or that it triggers a bug in the <code>xls</code> package which makes the package think that the file has this size?"}, {"owner": {"reputation": 3818, "user_id": 1247113, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zRMFj.png?s=128&g=1", "display_name": "rob74", "link": "https://stackoverflow.com/users/1247113/rob74"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554279633, "post_id": 55489128, "comment_id": 97688260, "body": "@Flimzy - it may occasionaly panic though, which to the uninitiated looks suspiciously similar to throwing ;)"}], "owner": {"reputation": 13, "user_id": 11219647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac7bbddd2616e6c18ca4d4483939425f?s=128&d=identicon&r=PG&f=1", "display_name": "Nandini", "link": "https://stackoverflow.com/users/11219647/nandini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 116, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1554278444, "creation_date": 1554275590, "last_edit_date": 1554278444, "question_id": 55489128, "link": "https://stackoverflow.com/questions/55489128/reading-xls-file-returns-error-virtualalloc-of-4710203392-bytes-failed-with-err", "title": "Reading xls file returns error &quot;VirtualAlloc of 4710203392 bytes failed with errno=1455&quot;", "body": "<p>Reading xls file in Go with package <code>github.com/extrame/xls</code> but it returns a memory error like <code>VirtualAlloc of 4710203392 bytes failed with errno=1455</code></p>\n\n<pre><code>file, _ := xls.Open(\"test.xls\", \"utf-8\")\n</code></pre>\n\n<p>How can I increase memory or any other package I can use in Go?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1554276195, "post_id": 55489071, "comment_id": 97686328, "body": "The question is cross posted on <a href=\"https://www.reddit.com/r/golang/comments/b8uqzu/how_to_set_default_selected_option_to_select_tag/\" rel=\"nofollow noreferrer\">the reddit</a>."}], "answers": [{"comments": [{"owner": {"reputation": 419, "user_id": 11296502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8969a369d6753a2caf66c8cb370dad2?s=128&d=identicon&r=PG&f=1", "display_name": "02040402", "link": "https://stackoverflow.com/users/11296502/02040402"}, "edited": false, "score": 0, "creation_date": 1554276828, "post_id": 55489159, "comment_id": 97686660, "body": "Thank you. But got this error: <code>template: posts&#47;index.tpl:20:70: executing &quot;posts&#47;index.tpl&quot; at &lt;eq $post.ID $.post...&gt;: error calling eq: incompatible types for comparison</code>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 419, "user_id": 11296502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8969a369d6753a2caf66c8cb370dad2?s=128&d=identicon&r=PG&f=1", "display_name": "02040402", "link": "https://stackoverflow.com/users/11296502/02040402"}, "edited": false, "score": 0, "creation_date": 1554276992, "post_id": 55489159, "comment_id": 97686755, "body": "@seikyo_0402 Ensure that <code>c.Data[&quot;post_id&quot;]</code> has the same type as post <code>ID</code> field.  Because the types are in code that you don&#39;t show, it&#39;s difficult to help more than this."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1554275706, "creation_date": 1554275706, "answer_id": 55489159, "question_id": 55489071, "link": "https://stackoverflow.com/questions/55489071/how-to-set-default-selected-option-to-select-tag-with-golang/55489159#55489159", "title": "How to set default selected option to select tag with Golang?", "body": "<p>The range command sets <code>.</code> to the current value. Use <code>$</code> to refer to the root value passed to the template:</p>\n\n<pre><code>{{ range $post := .posts }}\n&lt;option value=\"{{ $post.ID }}\" {{ if eq $post.ID $.post_id }}selected=\"selected\"{{ end }}&gt;{{ $post.Name }}&lt;/option&gt;\n{{ end }}\n</code></pre>\n\n<p>Because range sets <code>.</code>, the template can be simplified to:</p>\n\n<pre><code>{{ range $post := .posts }}\n&lt;option value=\"{{ .ID }}\" {{ if eq .ID $.post_id }}selected=\"selected\"{{ end }}&gt;{{ .Name }}&lt;/option&gt;\n{{ end }}\n</code></pre>\n"}], "owner": {"reputation": 419, "user_id": 11296502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8969a369d6753a2caf66c8cb370dad2?s=128&d=identicon&r=PG&f=1", "display_name": "02040402", "link": "https://stackoverflow.com/users/11296502/02040402"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 841, "favorite_count": 0, "accepted_answer_id": 55489159, "answer_count": 1, "score": 1, "last_activity_date": 1554277495, "creation_date": 1554275405, "last_edit_date": 1554277495, "question_id": 55489071, "link": "https://stackoverflow.com/questions/55489071/how-to-set-default-selected-option-to-select-tag-with-golang", "title": "How to set default selected option to select tag with Golang?", "body": "<p>First, I have found this question:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/52457724/how-can-i-set-the-default-value-for-an-html-select-element-in-golang\">How can I set the default value for an HTML &lt;select&gt; element in Golang?</a></p>\n\n<p>But in my case I don't know how to do.</p>\n\n<p>I have many posts data and render them to template.</p>\n\n<p>Controller:</p>\n\n<pre><code>c.Data[\"posts\"] = posts_data\n</code></pre>\n\n<p>View:</p>\n\n<pre><code>{{ range $post := .posts }}\n&lt;option value=\"{{ $post.ID }}\"&gt;{{ $post.Name }}&lt;/option&gt;\n{{ end }}\n</code></pre>\n\n<p>Works fine.</p>\n\n<p>But if change to:</p>\n\n<p>Controller:</p>\n\n<pre><code>c.Data[\"posts\"] = posts_data\nc.Data[\"post_id\"] = param_data\n</code></pre>\n\n<p>View:</p>\n\n<pre><code>{{ range $post := .posts }}\n&lt;option value=\"{{ $post.ID }}\" {{ if eq $post.ID .post_id }}selected=\"selected\"{{ end }}&gt;{{ $post.Name }}&lt;/option&gt;\n{{ end }}\n</code></pre>\n\n<p>Got error:</p>\n\n<pre><code>template Execute err: template: posts/index.tpl:20:70: executing \"posts/index.tpl\" at &lt;.post_id&gt;: can't evaluate field post_id in type models.Post\n</code></pre>\n\n<p>It's true that <code>post_id</code> doesn't exists in <code>models.Post</code>. But how to use it in this way?</p>\n"}, {"tags": ["regex", "apache", "parsing", "go", "logging"], "comments": [{"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1554274759, "post_id": 55488836, "comment_id": 97685668, "body": "You have <code>\\[0-9]+\\s[0-9]+\\s</code> regex, the first <code>[</code> should not be escaped. You are using <code>FindStringSubmatch</code> but your regex has no capturing groups. What is the expected result?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554277576, "post_id": 55488836, "comment_id": 97687074, "body": "Don&#39;t use a regex for this. Just split the input on whitespace. Regex is slow, cumbersome, and hard to read for such a trivial example."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1554277792, "post_id": 55488836, "comment_id": 97687189, "body": "If you need to only match lines with 2 numbers on them you may use <code>regexp.Compile(`(?m)^([0-9]+)\\s+([0-9]+)$`)</code>, see <a href=\"https://play.golang.org/p/nE0j5dwlGpR\" rel=\"nofollow noreferrer\">this demo</a>"}], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 11303778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4be77a652db2d857480c901b1dbbeaf?s=128&d=identicon&r=PG&f=1", "display_name": "azee", "link": "https://stackoverflow.com/users/11303778/azee"}, "edited": false, "score": 0, "creation_date": 1554282116, "post_id": 55489770, "comment_id": 97689731, "body": "yeah that works, actually my data might change in future and i might need to add ip aswell , there i ght not have much choice than regexp. i think"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 19, "user_id": 11303778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4be77a652db2d857480c901b1dbbeaf?s=128&d=identicon&r=PG&f=1", "display_name": "azee", "link": "https://stackoverflow.com/users/11303778/azee"}, "edited": false, "score": 0, "creation_date": 1554282186, "post_id": 55489770, "comment_id": 97689785, "body": "You should still use the <code>strings.Fields</code> method, so long as none of your fields contain whitespace."}, {"owner": {"reputation": 19, "user_id": 11303778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4be77a652db2d857480c901b1dbbeaf?s=128&d=identicon&r=PG&f=1", "display_name": "azee", "link": "https://stackoverflow.com/users/11303778/azee"}, "edited": false, "score": 0, "creation_date": 1554282322, "post_id": 55489770, "comment_id": 97689868, "body": "ok, thankyou very much for the help."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 0, "last_activity_date": 1554278039, "last_edit_date": 1554278039, "creation_date": 1554277799, "answer_id": 55489770, "question_id": 55488836, "link": "https://stackoverflow.com/questions/55488836/using-regexp-to-parse-an-apache-log-file/55489770#55489770", "title": "Using regexp to parse an Apache log file", "body": "<p>Regexp is entirely the wrong tool for this job. It will be much easier to read, and much faster to operate, to just use <code>strings.Split</code> or <code>strings.Fields</code>:</p>\n\n<pre><code>for _, line := range lines {\n    fields := strings.Fields(line)\n    ms := fields[0]\n    size := fields[1]\n    fmt.Printf(\"time: %v, size: %v\\n\", ms, size)\n}\n</code></pre>\n\n<p>If you want to convert these to numbers, you can easily do so with the <code>strconv</code> package, with the additional benefit that it will detect if you get unexpected (non-numeric) input):</p>\n\n<pre><code>for _, line := range lines {\n    fields := strings.Fields(line)\n    ms, err := strconv.Itoa(fields[0])\n    if err != nil {\n        log.Fatalf(\"time field: %s\", err)\n    }\n    size, err := strconv.Atoi(fields[1])\n    if err != nil {\n        log.Fatalf(\"size field: %s\", err)\n    }\n    fmt.Printf(\"time: %v, size: %v\\n\", ms, size)\n}\n</code></pre>\n\n<p><hr>\nIf you do insist on using a regular expression, at least compile it only once, outside of your for loop:</p>\n\n<pre><code>re, err := regexp.Compile( ... )\nif err != nil {\n    log.Fatalf(\"regexp: %s\", err)\n}\nfor _, line := range lines {\n    result := re.FindStringSubmatch(line)\n    fmt.Println(result)\n}\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 11303778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4be77a652db2d857480c901b1dbbeaf?s=128&d=identicon&r=PG&f=1", "display_name": "azee", "link": "https://stackoverflow.com/users/11303778/azee"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "closed_date": 1554278020, "accepted_answer_id": 55489770, "answer_count": 1, "score": 0, "last_activity_date": 1554278112, "creation_date": 1554274406, "last_edit_date": 1554278112, "question_id": 55488836, "link": "https://stackoverflow.com/questions/55488836/using-regexp-to-parse-an-apache-log-file", "closed_reason": "Duplicate", "title": "Using regexp to parse an Apache log file", "body": "<p>I am parsing an Apache log that I have customised to give me two values only: \"time\" and \"memory\" (the values are number of milliseconds and number of bytes) that are both are int64 or float64, but I am using regexp and Go to parse through the file, so when I am matching the contents of the files it return \"[]\" (empty braces) and is not populating the slice, my code is:</p>\n\n<pre><code>for _, line := range lines {\n    var buffer bytes.Buffer\n\n    buffer.WriteString(`\\[0-9]+\\s`)\n    buffer.WriteString(`[0-9]+\\s`)\n    re1, err := regexp.Compile(buffer.String())\n\n    if err != nil {\n        log.Fatalf(\"regexp: %s\", err)\n    }\n    result := re1.FindStringSubmatch(line)\n    fmt.Println(result)\n}\n</code></pre>\n\n<p>When I am printing result, it gives me empty braces and when I am running the whole program, it gives index out of range (which is understandable because result is empty).</p>\n\n<p>My data looks like this:</p>\n\n<pre><code>1040 3952\n2849 6832\n</code></pre>\n"}, {"tags": ["go", "ssh", "ssh-keys"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1554272679, "post_id": 55487627, "comment_id": 97684756, "body": "The error message is pretty clear about the problem. But you haven&#39;t included enough code to diagnose <i>why</i> you have a key mismatch."}, {"owner": {"reputation": 315, "user_id": 1926351, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/101a618d128a23b36b1052a52be1e8d1?s=128&d=identicon&r=PG", "display_name": "kargirwar", "link": "https://stackoverflow.com/users/1926351/kargirwar"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554286537, "post_id": 55487627, "comment_id": 97692483, "body": "@FLimzy added other code."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1554295362, "post_id": 55487627, "comment_id": 97698000, "body": "Do you have multiple entries for <code>dev.letsreap.com</code> in your <code>knownhosts</code> file?"}, {"owner": {"reputation": 315, "user_id": 1926351, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/101a618d128a23b36b1052a52be1e8d1?s=128&d=identicon&r=PG", "display_name": "kargirwar", "link": "https://stackoverflow.com/users/1926351/kargirwar"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554307046, "post_id": 55487627, "comment_id": 97705726, "body": "@JimB Nope. Just one."}], "answers": [{"tags": [], "owner": {"reputation": 315, "user_id": 1926351, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/101a618d128a23b36b1052a52be1e8d1?s=128&d=identicon&r=PG", "display_name": "kargirwar", "link": "https://stackoverflow.com/users/1926351/kargirwar"}, "is_accepted": false, "score": 0, "last_activity_date": 1554346012, "creation_date": 1554346012, "answer_id": 55507096, "question_id": 55487627, "link": "https://stackoverflow.com/questions/55487627/host-key-mismatch/55507096#55507096", "title": "Host key mismatch", "body": "<p>I figured it out eventually. There were indeed multiple entries in known_hosts file, one with the hostname and another with the IP address. That's why I did not spot it earlier. Thanks @JimB for the hint!</p>\n"}], "owner": {"reputation": 315, "user_id": 1926351, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/101a618d128a23b36b1052a52be1e8d1?s=128&d=identicon&r=PG", "display_name": "kargirwar", "link": "https://stackoverflow.com/users/1926351/kargirwar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1339, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1554346012, "creation_date": 1554269164, "last_edit_date": 1554286503, "question_id": 55487627, "link": "https://stackoverflow.com/questions/55487627/host-key-mismatch", "title": "Host key mismatch", "body": "<p>I am trying to connect to a remote server using Go. This is what I am using: (<a href=\"https://stackoverflow.com/questions/45441735/ssh-handshake-complains-about-missing-host-key\">SSH Handshake complains about missing host key</a>)</p>\n\n<pre><code>    key, err := ioutil.ReadFile(\"/Users/pankaj/.ssh/id_rsa\")                                                                \n    if err != nil {                                                                                                         \n        log.Fatalf(\"unable to read private key: %v\", err)                                                                   \n    }                                                                                                                       \n\n    // Create the Signer for this private key.                                                                              \n    signer, err := ssh.ParsePrivateKey(key)                                                                                 \n    if err != nil {                                                                                                         \n        log.Fatalf(\"unable to parse private key: %v\", err)                                                                  \n    }        \n\n    hostKeyCallback, err := knownhosts.New(\"/Users/pankaj/.ssh/known_hosts\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    sshConfig := &amp;ssh.ClientConfig{\n        User: \"pankaj\",\n        Auth: []ssh.AuthMethod{\n            ssh.PublicKeys(signer),\n        },\n        HostKeyCallback: hostKeyCallback,\n    }\n\n    conn, err := ssh.Dial(\"tcp\", \"dev.letsreap.com:22\", sshConfig) \n    if err != nil {                                                                                                         \n        log.Fatalf(\"unable to connect: %v\", err)                                                                            \n    } \n</code></pre>\n\n<p>However on ssh.Dial I am getting:</p>\n\n<pre><code>ssh: handshake failed: knownhosts: key mismatch\n</code></pre>\n\n<p>I have verified that I can connect to the remote server from the command line. Also I can connect successfully if I use ssh.InsecureIgnoreHostKey(). What am I missing?</p>\n"}, {"tags": ["go", "google-sheets-api"], "comments": [{"owner": {"reputation": 100534, "user_id": 7108653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LH2EI.png?s=128&g=1", "display_name": "Tanaike", "link": "https://stackoverflow.com/users/7108653/tanaike"}, "edited": false, "score": 0, "creation_date": 1554275509, "post_id": 55487169, "comment_id": 97686004, "body": "Can I ask you about your question? You want to retrieve the information of merge cells in a sheet using Sheets API. Is my understanding correct?"}, {"owner": {"reputation": 933, "user_id": 439142, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/ad48f5f489d036f22f94a411a218c966?s=128&d=identicon&r=PG", "display_name": "Ray Wu", "link": "https://stackoverflow.com/users/439142/ray-wu"}, "reply_to_user": {"reputation": 100534, "user_id": 7108653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LH2EI.png?s=128&g=1", "display_name": "Tanaike", "link": "https://stackoverflow.com/users/7108653/tanaike"}, "edited": false, "score": 0, "creation_date": 1554328981, "post_id": 55487169, "comment_id": 97715858, "body": "@Tanaike I want to write something to only 1 cell among all empty cells in column C. In the above case, I want to write to C3 but not to C2. However, I can&#39;t tell if C2 is a real cell by itself or a merged cell."}, {"owner": {"reputation": 100534, "user_id": 7108653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LH2EI.png?s=128&g=1", "display_name": "Tanaike", "link": "https://stackoverflow.com/users/7108653/tanaike"}, "edited": false, "score": 0, "creation_date": 1554333517, "post_id": 55487169, "comment_id": 97717148, "body": "Thank you for replying. You want to put a value to &quot;C3&quot;. But <code>Spreadsheets.Values.Get()</code> is used for retrieving values. About this situation, I&#39;m confusing. Can I ask you about what you want to do?"}, {"owner": {"reputation": 933, "user_id": 439142, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/ad48f5f489d036f22f94a411a218c966?s=128&d=identicon&r=PG", "display_name": "Ray Wu", "link": "https://stackoverflow.com/users/439142/ray-wu"}, "reply_to_user": {"reputation": 100534, "user_id": 7108653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LH2EI.png?s=128&g=1", "display_name": "Tanaike", "link": "https://stackoverflow.com/users/7108653/tanaike"}, "edited": false, "score": 0, "creation_date": 1554359380, "post_id": 55487169, "comment_id": 97723653, "body": "It&#39;s a sign-up form, I want to sign up in only 1 cell column C, but some timeslots are occupied by the same person (as merged cells). So like in the example, I want to sign up at first available empty timeslot, but I can&#39;t tell the difference between C2 and C3 from API."}, {"owner": {"reputation": 100534, "user_id": 7108653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LH2EI.png?s=128&g=1", "display_name": "Tanaike", "link": "https://stackoverflow.com/users/7108653/tanaike"}, "edited": false, "score": 0, "creation_date": 1554360783, "post_id": 55487169, "comment_id": 97724336, "body": "Thank you for replying. You want to put the values to the column &quot;C&quot;. But before putting the values, you want to retrieve the information of merged cells. I could understand like this. By this understanding, I proposed the method for retrieving the information of merged cells as an answer. Could you please confirm it? If I misunderstood your question, I apologize."}], "answers": [{"comments": [{"owner": {"reputation": 933, "user_id": 439142, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/ad48f5f489d036f22f94a411a218c966?s=128&d=identicon&r=PG", "display_name": "Ray Wu", "link": "https://stackoverflow.com/users/439142/ray-wu"}, "edited": false, "score": 0, "creation_date": 1554444378, "post_id": 55509542, "comment_id": 97761789, "body": "Cool thanks, exactly what I need to figure out merged cells"}, {"owner": {"reputation": 100534, "user_id": 7108653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LH2EI.png?s=128&g=1", "display_name": "Tanaike", "link": "https://stackoverflow.com/users/7108653/tanaike"}, "reply_to_user": {"reputation": 933, "user_id": 439142, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/ad48f5f489d036f22f94a411a218c966?s=128&d=identicon&r=PG", "display_name": "Ray Wu", "link": "https://stackoverflow.com/users/439142/ray-wu"}, "edited": false, "score": 0, "creation_date": 1554447352, "post_id": 55509542, "comment_id": 97763054, "body": "@Ray Wu I&#39;m glad your issue was resolved. Thank you, too."}], "tags": [], "owner": {"reputation": 100534, "user_id": 7108653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LH2EI.png?s=128&g=1", "display_name": "Tanaike", "link": "https://stackoverflow.com/users/7108653/tanaike"}, "is_accepted": true, "score": 1, "last_activity_date": 1554360778, "creation_date": 1554360778, "answer_id": 55509542, "question_id": 55487169, "link": "https://stackoverflow.com/questions/55487169/how-to-identify-cell-is-merged-cell-with-google-sheets-api/55509542#55509542", "title": "How to identify cell is merged cell with google sheets api", "body": "<ul>\n<li>You want to retrieve the information of merge cells in a sheet using Sheets API.</li>\n</ul>\n\n<p>From your replying, I could understand like above. If my understanding is correct, the method of spreadsheets.values.get cannot retrieve the information of merge cells. In this case, please use the method of spreadsheets.get. The modified script is as follows.</p>\n\n<h3>Modified script:</h3>\n\n<pre><code>ranges := []string{\"B1:C\"}\nresp, _ := s.srv.Spreadsheets.Get(spreadsheetId).Ranges(ranges...).Do()\nfor _, sheet := range resp.Sheets {\n    for _, merge := range sheet.Merges {\n        fmt.Printf(\"%#v\\n\", merge)\n    }\n}\n</code></pre>\n\n<h3>Note:</h3>\n\n<ul>\n<li>This modified script supposes that you have already used Sheets API.</li>\n<li>Range of <code>B1:C</code> means <code>B1:C</code> of the first tab.</li>\n<li><p>When you run above script, you can retrieve the coordinates of the merged cells as the GridRange like below.</p>\n\n<pre><code>{\n  \"sheetId\": 0,\n  \"startRowIndex\": 0,\n  \"endRowIndex\": 2,\n  \"startColumnIndex\": 2,\n  \"endColumnIndex\": 3\n}\n</code></pre>\n\n<ul>\n<li>This GridRange is <code>C1:C2</code> of sheet ID <code>0</code> as the a1Notation.\n\n<ul>\n<li>From above result, it is found that <code>C1:C2</code> is the merged cell.</li>\n<li>In this case, when the value is put in <code>C1</code>, the value is displayed. But when the value is put in <code>C2</code>, the value is not displayed. Please be careful this.</li>\n</ul></li>\n<li>If you want to put the value using the GridRange, you can use the method of spreadsheets.batchUpdate.</li>\n</ul></li>\n</ul>\n\n<h3>References:</h3>\n\n<ul>\n<li><a href=\"https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets/get\" rel=\"nofollow noreferrer\">spreadsheets.get</a></li>\n<li><a href=\"https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets/other#GridRange\" rel=\"nofollow noreferrer\">GridRange</a></li>\n<li><a href=\"https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets/batchUpdate\" rel=\"nofollow noreferrer\">spreadsheets.batchUpdate</a></li>\n</ul>\n"}], "owner": {"reputation": 933, "user_id": 439142, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/ad48f5f489d036f22f94a411a218c966?s=128&d=identicon&r=PG", "display_name": "Ray Wu", "link": "https://stackoverflow.com/users/439142/ray-wu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1209, "favorite_count": 0, "accepted_answer_id": 55509542, "answer_count": 1, "score": 1, "last_activity_date": 1554360778, "creation_date": 1554266281, "question_id": 55487169, "link": "https://stackoverflow.com/questions/55487169/how-to-identify-cell-is-merged-cell-with-google-sheets-api", "title": "How to identify cell is merged cell with google sheets api", "body": "<p>I'm using Go API <a href=\"https://developers.google.com/sheets/api/quickstart/go\" rel=\"nofollow noreferrer\">https://developers.google.com/sheets/api/quickstart/go</a></p>\n\n<p>I have a sheet looks like this and want to automate some cell filling logic</p>\n\n<pre><code>  |  B   |  C   |\n--+------+------+\n1 |  b1  |  c1  |\n--+------+      |\n2 |  b2  |      |\n--+------+------+\n3 |  b3  |      |\n--+------+------+\n</code></pre>\n\n<p>While using <code>readRange := \"B1:C\"</code> by</p>\n\n<pre><code>resp, _ := s.srv.Spreadsheets.Values.Get(spreadsheetId, readRange).Do()\nfor _, row := range resp.Values {\n   ...\n}\n</code></pre>\n\n<p>I can't tell the difference between C2 and C3. In this case, I would like to fill some values to C3 but not C2. How do I check this via API?</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3", "aws-sdk", "aws-sdk-go"], "answers": [{"tags": [], "owner": {"reputation": 351, "user_id": 1774646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e594c1d84998cb4cdfe7008014788201?s=128&d=identicon&r=PG", "display_name": "abvarun226", "link": "https://stackoverflow.com/users/1774646/abvarun226"}, "is_accepted": true, "score": 3, "last_activity_date": 1554271185, "creation_date": 1554271185, "answer_id": 55488042, "question_id": 55487019, "link": "https://stackoverflow.com/questions/55487019/aws-golang-sdk-fails-to-copy-object-when-the-key-contains-arabic-characters/55488042#55488042", "title": "AWS Golang SDK fails to copy object when the key contains arabic characters", "body": "<p>According to the documentation, CopySource must be URL-encoded.</p>\n\n<p><a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/s3/#CopyObjectInput\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/service/s3/#CopyObjectInput</a></p>\n\n<pre><code>// The name of the source bucket and key name of the source object, separated\n// by a slash (/). Must be URL-encoded.\n//\n// CopySource is a required field\nCopySource *string `location:\"header\" locationName:\"x-amz-copy-source\" type:\"string\" required:\"true\"`\n</code></pre>\n\n<p>Try this,</p>\n\n<pre><code>import \"net/url\"\n\nfunc copyObject(existingKey, key string, svc *s3.S3) {\n\n    // existingKey is source bucket and key name separated by \"/\"\n    e := url.QueryEscape(existingKey)\n\n    copyObjectInput := &amp;s3.CopyObjectInput{\n        Bucket:     aws.String(\"dummy-bucket\"),\n        CopySource: aws.String(e),\n        Key:        aws.String(key),\n    }\n\n    result, err := svc.CopyObject(copyObjectInput)\n    if err != nil {\n        log.Fatal(\"Copy failed due to: \", err) // logs the above error here\n    }\n\n    spew.Dump(result)\n}\n</code></pre>\n"}], "owner": {"reputation": 1056, "user_id": 4154706, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/b91e34f88755d8517830e1389972fb18?s=128&d=identicon&r=PG", "display_name": "aitchkhan", "link": "https://stackoverflow.com/users/4154706/aitchkhan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 953, "favorite_count": 0, "accepted_answer_id": 55488042, "answer_count": 1, "score": 0, "last_activity_date": 1554271185, "creation_date": 1554265211, "question_id": 55487019, "link": "https://stackoverflow.com/questions/55487019/aws-golang-sdk-fails-to-copy-object-when-the-key-contains-arabic-characters", "title": "AWS Golang SDK fails to copy object when the key contains arabic characters", "body": "<p>Using <a href=\"https://github.com/aws/aws-sdk-go\" rel=\"nofollow noreferrer\">aws-sdk-go</a>, I have been able to sucessfully copy the objects in my s3 bucket when the key contains normal alphanumeric and few special characters like (-,_). But when a key contains an arabic character, the golang aws-sdk throws an error.</p>\n\n<pre><code>NoSuchKey: The specified key does not exist.\n    status code: 404, request id: 438DC6xxxxxx, host id: Xp+xxxxxxxxxx\n</code></pre>\n\n<p>The key in the bucket looks like this:</p>\n\n<p><code>public/10009/img__\u0661\u0663\u0664\u0661\u0661\u0661-1600x1200.jpg</code></p>\n\n<p>The code is pretty straigh-forward as well:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func copyObject(existingKey, key string, svc *s3.S3) {\n    copyObjectInput := &amp;s3.CopyObjectInput{\n        Bucket:     aws.String(\"dummy-bucket\"),\n        CopySource: aws.String(existingKey),\n        Key:        aws.String(key),\n    }\n\n    result, err := svc.CopyObject(copyObjectInput)\n    if err != nil {\n        log.Fatal(\"Copy failed due to: \", err) // logs the above error here\n    }\n\n    spew.Dump(result)\n}\n</code></pre>\n\n<p>I am also printing out the key, just in case:\n<code>dummy-bucket/public/10009/img__\u0661\u0663\u0664\u0661\u0661\u0661-1600x1200.jpg</code></p>\n\n<p>I was also able to successfully downloaded the image using the <code>aws-sdk-go</code>, with the same key.</p>\n"}, {"tags": ["go", "kubernetes"], "answers": [{"tags": [], "owner": {"reputation": 1392, "user_id": 1692916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99337906197e33b2c5f9835584389f44?s=128&d=identicon&r=PG", "display_name": "Sylwit", "link": "https://stackoverflow.com/users/1692916/sylwit"}, "is_accepted": true, "score": 3, "last_activity_date": 1554265656, "creation_date": 1554265656, "answer_id": 55487078, "question_id": 55486969, "link": "https://stackoverflow.com/questions/55486969/install-kubernetes-go-client/55487078#55487078", "title": "Install Kubernetes Go Client", "body": "<p>You have a typo in your package name client-go</p>\n\n<p><code># GIT_TERMINAL_PROMPT=1 go get -v k8s.io/client-go/...</code></p>\n\n<p>instead of </p>\n\n<p><code># GIT_TERMINAL_PROMPT=1 go get -v k8s.io/client/go/...</code></p>\n"}], "owner": {"reputation": 2093, "user_id": 3309314, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/3683a7a05e7e97a67c262b774db00d08?s=128&d=identicon&r=PG&f=1", "display_name": "user3309314", "link": "https://stackoverflow.com/users/3309314/user3309314"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 181, "favorite_count": 0, "accepted_answer_id": 55487078, "answer_count": 1, "score": -1, "last_activity_date": 1554265656, "creation_date": 1554264814, "question_id": 55486969, "link": "https://stackoverflow.com/questions/55486969/install-kubernetes-go-client", "title": "Install Kubernetes Go Client", "body": "<p>I'm trying to install Go Client for Kubernetes. I'm following that <a href=\"https://github.com/kubernetes/client-go/blob/master/INSTALL.md\" rel=\"nofollow noreferrer\"> installation link</a>. Here is the output:</p>\n\n<pre><code>root@c085ca4b6124:/app# GIT_TERMINAL_PROMPT=1 go get -v k8s.io/client/go/...\nFetching https://k8s.io/client/go?go-get=1\nParsing meta tags from https://k8s.io/client/go?go-get=1 (status code 200)\nget \"k8s.io/client/go\": found meta tag get.metaImport{Prefix:\"k8s.io/client\", VCS:\"git\", RepoRoot:\"https://github.com/kubernetes/client\"} at https://k8s.io/client/go?go-get=1\nget \"k8s.io/client/go\": verifying non-authoritative meta tag\nFetching https://k8s.io/client?go-get=1\nParsing meta tags from https://k8s.io/client?go-get=1 (status code 200)\nk8s.io/client (download)\nUsername for 'https://github.com': ***\nPassword for 'https://***@github.com': ***\n# cd .; git clone https://github.com/kubernetes/client /go/src/k8s.io/client\nCloning into '/go/src/k8s.io/client'...\nremote: Repository not found.\nfatal: repository 'https://github.com/kubernetes/client/' not found\npackage k8s.io/client/go/...: exit status 128\nroot@c085ca4b6124:/app# \n</code></pre>\n\n<p>I can't really get what I'm doing wrong. </p>\n"}, {"tags": ["mongodb", "go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 4, "last_activity_date": 1580743619, "last_edit_date": 1580743619, "creation_date": 1554262172, "answer_id": 55486622, "question_id": 55486418, "link": "https://stackoverflow.com/questions/55486418/create-generic-function-official-mongodb-driver/55486622#55486622", "title": "Create generic function - Official MongoDB Driver", "body": "<p>Use <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo#Cursor.All\" rel=\"nofollow noreferrer\">Cursor.All</a> in version >= 1.1.0 of the driver:</p>\n\n<pre><code>var result []Example\nerr := cursor.All(&amp;result)\nif err != nil {\n    // handle error\n}\n</code></pre>\n\n<p>For earlier versions, \nuse the <a href=\"https://godoc.org/reflect\" rel=\"nofollow noreferrer\">reflect</a> package to decode all values to a slice:</p>\n\n<pre><code>// decodeAll decodes all values to the slice pointed to by result.\nfunc decodeAll(cur *mongo.Cursor, result interface{}) error {\n    rv := reflect.ValueOf(result).Elem()\n\n    // reset to beginning of the slice.\n    sv := rv.Slice(0, rv.Cap())\n\n    for cur.Next(context.Background()) {\n\n        // Allocate new element value and decode to it.\n        pev := reflect.New(sv.Type().Elem())\n        if err := cur.Decode(pev.Interface()); err != nil {\n            return err\n        }\n\n        // Append the element value.\n        sv = reflect.Append(sv, pev.Elem())\n    }\n\n    rv.Set(sv)\n    return cur.Err()\n}\n</code></pre>\n\n<p>Call it like this:</p>\n\n<pre><code>var result []Example\nerr := decodeAll(cursor, &amp;result)\nif err != nil {\n    // handle error\n}\n</code></pre>\n"}], "owner": {"reputation": 393, "user_id": 5223002, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tmBSX.jpg?s=128&g=1", "display_name": "Eduardo Hitek", "link": "https://stackoverflow.com/users/5223002/eduardo-hitek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1580743619, "creation_date": 1554260715, "last_edit_date": 1554271484, "question_id": 55486418, "link": "https://stackoverflow.com/questions/55486418/create-generic-function-official-mongodb-driver", "title": "Create generic function - Official MongoDB Driver", "body": "<p>when using the mgo driver from globalsign, i could save some time reusing a function to return all the elements from a collection, no matter what models i was using.</p>\n\n<p>But now, with the Official Driver from MongoDB, i need to specific which interface I want to decode, so in this way I can't reuse this method for other interfaces.</p>\n\n<p>Has anyone got to this point?</p>\n\n<p>Function using the mgo driver:</p>\n\n<pre><code>func ReturnAll(collection string, model interface{}, skip int, limit int) error {\n session := GetSession()\n defer session.Close()\n return session.DB(DBName).C(collection).Find(nil).Skip(skip).Limit(limit).All(modelo)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1554271838, "post_id": 55486343, "comment_id": 97684447, "body": "This is an XY Problem. Don&#39;t focus on <code>runtime.Goexit</code> (your imagined solution), instead focus on the actual problem to be solved."}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1554271808, "post_id": 55486681, "comment_id": 97684436, "body": "Although a bit snarky, this is the only technically correct answer to the XY problem posed by the OP.  For an answer to the actual situation of the OP, @colminator&#39;s answer is great."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 1, "last_activity_date": 1554262589, "creation_date": 1554262589, "answer_id": 55486681, "question_id": 55486343, "link": "https://stackoverflow.com/questions/55486343/how-do-i-execute-deferred-functions-in-testmain-for-a-test-suite/55486681#55486681", "title": "how do I execute deferred functions in TestMain for a test suite?", "body": "<blockquote>\n  <p>Is there any way I can know when the main goroutine has finished?</p>\n</blockquote>\n\n<p>Yes: When your program has stopped.</p>\n\n<p>Once the main goroutine stops your program terminates including any other goroutine. So you will have to redesign as nothing ever executes after the main goroutine exits.</p>\n"}, {"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 4, "last_activity_date": 1554300588, "last_edit_date": 1554300588, "creation_date": 1554264135, "answer_id": 55486881, "question_id": 55486343, "link": "https://stackoverflow.com/questions/55486343/how-do-i-execute-deferred-functions-in-testmain-for-a-test-suite/55486881#55486881", "title": "how do I execute deferred functions in TestMain for a test suite?", "body": "<p>If you want to ensure coordinated cleanup <em>DON'T</em> use <code>runtime.Goexit</code>. There is no reliable/deterministic mechanism to hook onto this type of exit method.</p>\n\n<p>Instead use <a href=\"https://golang.org/pkg/context/\" rel=\"nofollow noreferrer\">context.Context</a> and pass it to your relevant go-routines. You can explicitly cancel a Context and the go-routines can monitor it's state for such an event and do their cleanup.</p>\n\n<p>If there is critical tasks that need executing prior to mains exit, you can employ a <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">sync.WaitGroup</a>. Adding to the wait group for each go-routine. And performing <code>Done()</code> on the WaitGroup as each go-routine completes. The main go-routine can finally  <code>Wait()</code> on the WaitGroup and the program will exit, safe in the knowledge all cleanup tasks having been completed.</p>\n\n<hr>\n\n<p><strong>Example:</strong></p>\n\n<pre><code>func main() {\n    mainCtx, cancelFn := context.WithCancel(context.Background())\n    var wg sync.WaitGroup\n\n    wg.Add(1)\n    go func() { taskA(mainCtx, &amp;wg) }()\n    wg.Add(1)\n    go func() { manager(mainCtx, &amp;wg, cancelFn) }()\n\n    wg.Wait() // waiting for manager/task(s)\n}\n\n\nfunc taskA(ctx context.Context, wg *sync.WaitGroup) {\n    defer func() {\n        log.Println(\"defer(): taskA DONE!\")\n        wg.Done() // must be called last\n    }()\n\n    t := time.NewTicker(300 * time.Millisecond)\n\n    for {\n        select {\n        case &lt;-t.C:\n            log.Println(\"taskA is working:\", time.Now())\n        case &lt;-ctx.Done(): // are we done?\n            log.Println(\"taskA was canceled. Reason:\", ctx.Err())\n            return\n        }\n    }\n}\n\nfunc manager(ctx context.Context, wg *sync.WaitGroup, cancelFn func()) {\n    defer func() {\n        log.Println(\"defer(): Manager DONE!\")\n        wg.Done() // must be called last\n    }()\n\n    time.Sleep(time.Second) // give worker(s) some time to work...\n\n    cancelFn() // time to wrap up worker(s)!\n}\n</code></pre>\n\n<hr>\n\n<p>Working <a href=\"https://play.golang.org/p/bQ6UzI3A-Ln\" rel=\"nofollow noreferrer\">playground version</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1554271903, "post_id": 55487002, "comment_id": 97684471, "body": "Don&#39;t use finalizers. They&#39;re unreliable. They&#39;re not guaranteed to run when you expect. In your case, your finalizer <i>could</i> run before your <code>go func()</code> is executed, becuase the runtime can detect that <code>collectMe</code> is not used in the rest of the function, so it may do a pre-cleanup. If GC is ever delayed, it could also be cleaned up after you expect (this case may not matter since you&#39;re existing the program, but in any other case, it could)."}, {"owner": {"reputation": 487, "user_id": 2238785, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d4c4d93865aad4b5b0834249c0e319c5?s=128&d=identicon&r=PG", "display_name": "ashanbrown", "link": "https://stackoverflow.com/users/2238785/ashanbrown"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554298623, "post_id": 55487002, "comment_id": 97700132, "body": "@flI was wondering about this.  If I reference collectMe after I call <code>runtime.Goexit()</code> can I be guaranteed that the object won&#39;t be cleaned up before my finalizer?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1554300447, "post_id": 55487002, "comment_id": 97701310, "body": "No. The compiler and runtime are very smart about disregarding things after early exits. Even if it works in a current version of Go, it&#39;s likely to be optimized away in upcoming versions. Simply don&#39;t use finalizers for side-effects. Use them only for finalization."}], "tags": [], "owner": {"reputation": 487, "user_id": 2238785, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d4c4d93865aad4b5b0834249c0e319c5?s=128&d=identicon&r=PG", "display_name": "ashanbrown", "link": "https://stackoverflow.com/users/2238785/ashanbrown"}, "is_accepted": false, "score": -2, "last_activity_date": 1554265039, "creation_date": 1554265039, "answer_id": 55487002, "question_id": 55486343, "link": "https://stackoverflow.com/questions/55486343/how-do-i-execute-deferred-functions-in-testmain-for-a-test-suite/55487002#55487002", "title": "how do I execute deferred functions in TestMain for a test suite?", "body": "<p>Here's a solution I was able to come up with using a finalizer on a variable on the main goroutine and then triggering garbage collection:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"os\"\n  \"runtime\"\n  \"time\"\n)\n\ntype toBeCollected struct {\n  dummy bool // need to have a non-empty struct\n}\n\nfunc main() {\n  collectMe := new(toBeCollected)\n  runtime.SetFinalizer(collectMe, func(*toBeCollected) {\n    fmt.Println(\"now I'm really done\")\n    os.Exit(0)\n  })\n  go func() {\n    for range time.NewTicker(time.Millisecond).C {\n      runtime.GC()\n    }\n  }()\n  runtime.Goexit()\n}\n</code></pre>\n\n<p>Curiously while I can run it locally, it doesn't work on go playground (see  <a href=\"https://play.golang.org/p/bwf7fMu2w76\" rel=\"nofollow noreferrer\">https://play.golang.org/p/bwf7fMu2w76</a>).</p>\n"}], "owner": {"reputation": 487, "user_id": 2238785, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d4c4d93865aad4b5b0834249c0e319c5?s=128&d=identicon&r=PG", "display_name": "ashanbrown", "link": "https://stackoverflow.com/users/2238785/ashanbrown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 337, "favorite_count": 0, "answer_count": 3, "score": -2, "last_activity_date": 1554301770, "creation_date": 1554260243, "last_edit_date": 1554301770, "question_id": 55486343, "link": "https://stackoverflow.com/questions/55486343/how-do-i-execute-deferred-functions-in-testmain-for-a-test-suite", "title": "how do I execute deferred functions in TestMain for a test suite?", "body": "<p>I've updated the question to avoid being accused of posting an XY question. </p>\n\n<p>Previously the question was: </p>\n\n<blockquote>\n  <p>how can I tell when runtime.Goexit has been called on the main goroutine?</p>\n</blockquote>\n\n<p>I'm trying to write a method that finishes all deferred functions on the main goroutine by calling <code>runtime.Goexit()</code> and then calls <code>os.Exit()</code> from a goroutine a spawned before calling this exit method.  The problem I have is that I don't know when <code>runtime.Goexit()</code> has completed.  Is there any way I can know when the main goroutine has finished?</p>\n\n<p>UPDATED: Let me elaborate on my use case.  Consider this pattern for <code>TestMain</code>:</p>\n\n<pre><code>func TestMain(m *testing.M) {\n    db.Create()\n    defer db.Drop()\n    os.Exit(m.Run())\n}\n</code></pre>\n\n<p>In this case, the database is never dropped because os.Exit stops the program.  My goal was to come up with an alternate \nexit function that executes all the deferred functions in <code>TestMain</code>.  Now, I could move everything into another\nfunction like this:</p>\n\n<pre><code>func realTestMain(m *testing.M) int {\n    db.Create()\n    defer db.Drop()\n    return m.Run()\n}\n\nfunc TestMain(m *testing.M) {\n    os.Exit(realTestMain(m))\n}\n</code></pre>\n\n<p>However, this pattern would have to be enforced across our test suite and is ugly and difficult to remember.  I was exploring\nwhether I could have a helper that makes it possible to write my setup/teardown as follows:</p>\n\n<pre><code>func TestMain(m *testing.M) {\n    db.Create()\n    defer db.Drop()\n    helpers.SafeExit(m.Run())\n}\n</code></pre>\n\n<p>With a helper like this, I could write a simple check to ensure that os.Exit never appears in our test suites.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1554271985, "post_id": 55486306, "comment_id": 97684496, "body": "What doesn&#39;t work? What are you trying to do? Include your code. What problem are you encountering?"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 6343254, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49405e46c5dd60249b4532a776bb61a5?s=128&d=identicon&r=PG&f=1", "display_name": "user6343254", "link": "https://stackoverflow.com/users/6343254/user6343254"}, "edited": false, "score": 0, "creation_date": 1554262183, "post_id": 55486582, "comment_id": 97681950, "body": "Like SpringMVC Interceptor, I want to convert json in iris&#39;s Interceptor and send object to next handler, not convert json in every controller."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554304294, "post_id": 55486582, "comment_id": 97704003, "body": "Don&#39;t try to write Java/Spring in Go, it won&#39;t work. You could write a helper that takes an <code>interface{}</code> but you&#39;d still need to pass that helper an instance of a concrete type to unmarshal into."}], "tags": [], "owner": {"reputation": 40344, "user_id": 1796579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b14d3685f0765c738fd90c7ec71fa9ba?s=128&d=identicon&r=PG", "display_name": "Henry", "link": "https://stackoverflow.com/users/1796579/henry"}, "is_accepted": false, "score": 0, "last_activity_date": 1554261844, "creation_date": 1554261844, "answer_id": 55486582, "question_id": 55486306, "link": "https://stackoverflow.com/questions/55486306/how-to-convert-json-to-unknown-type-struct/55486582#55486582", "title": "How to convert json to Unknown type Struct", "body": "<p>Declare <code>a</code> as a variable of type xxStruct, not interface{}:</p>\n\n<pre><code>var a xxStruct\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 6343254, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49405e46c5dd60249b4532a776bb61a5?s=128&d=identicon&r=PG&f=1", "display_name": "user6343254", "link": "https://stackoverflow.com/users/6343254/user6343254"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1554271966, "creation_date": 1554259910, "last_edit_date": 1554271966, "question_id": 55486306, "link": "https://stackoverflow.com/questions/55486306/how-to-convert-json-to-unknown-type-struct", "title": "How to convert json to Unknown type Struct", "body": "<pre><code>var a interface{}\na = xxStruct{}\njson.Unmarshal(jsonData,&amp;a)\n</code></pre>\n\n<p>The \"a\" become to be a map, not a struct. For java, I could do it like this:</p>\n\n<pre><code>Object obj = new XXObject();\nString json = JSON.toJSONString(obj);\nobj = JSON.parse(json,obj.getClass())\n//and also I can convert obj to original object.\n//but How do this in \"go\"?\nXXObject x = (XXObject)obj;\nx.xxxSet(); //call method as normal.\n</code></pre>\n\n<p>I try using reflect.ValueOf(), reflect.TypeOf() and type convert like\nv:=a.(XXStruct) etc. \nbut it doesn't work, What should I do?</p>\n"}, {"tags": ["go", "udp", "exit", "goroutine"], "comments": [{"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1554260184, "post_id": 55486000, "comment_id": 97681551, "body": "UDP does not guarantee delivery, but it sounds like your code needs to know that messages are delivered"}, {"owner": {"reputation": 19, "user_id": 2671474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5843107fa8dc7effc94675cd7dab888b?s=128&d=identicon&r=PG", "display_name": "user2671474", "link": "https://stackoverflow.com/users/2671474/user2671474"}, "reply_to_user": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1554265456, "post_id": 55486000, "comment_id": 97682591, "body": "It tracks delivery in a state manager. The issue is that when the connection is closed, it does not generate the error (like it does 1784 x 11 other times before it), and so it leaks, or would if I didn&#39;t log and report it failed to recognize and respond to the shutdown signal."}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 1, "creation_date": 1554273101, "post_id": 55486000, "comment_id": 97684939, "body": "There is no such thing as a UDP connection, and therefore no such thing as closing a UDP connection either."}, {"owner": {"reputation": 19, "user_id": 2671474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5843107fa8dc7effc94675cd7dab888b?s=128&d=identicon&r=PG", "display_name": "user2671474", "link": "https://stackoverflow.com/users/2671474/user2671474"}, "edited": false, "score": 0, "creation_date": 1554303520, "post_id": 55486000, "comment_id": 97703474, "body": "You are missing the point. The ISSUE is that I can not reliably break out of    <code>for { if _,err:=conn.Read(buf); err !=nil {break}}</code> when I call <code>conn.Close()</code> from the sender. This works 10,000+ times as expected, but then it fails randomly and causes a go routine leak because it did not shut down/exit the for loop when the close statement was called on conn. WHY? I need a reliable and consistent way to exit the for loop. HOW? That&#39;s my question."}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1554358055, "post_id": 55486000, "comment_id": 97723062, "body": "It is you who is missing the point. There is no reason why you <i>should</i> break out of a blocking UDP read. There is no disconnect event, because there is no connection to disconnect. It&#39;s not like TCP, that delivers an end of stream when the peer disconnects. If you want a &#39;disconnect&#39; message the peer will have to send one to you, and you will have to mitigate the risk of it arriving out of order, multiple times, or not at all."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1554401623, "post_id": 55486000, "comment_id": 97749272, "body": "@user207421: what you&#39;re saying is true of blocking berkely socket reads, but Go&#39;s blocking reads are backed by its net poller; closing the Go connection should unblock the Read call. Even if that didn&#39;t work, the deadline should abort the read."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554401783, "post_id": 55486000, "comment_id": 97749338, "body": "@user2671474: are you absolutely certain you&#39;re in the blocked read call for the full duration you think? Have you inspected the stack trace while it&#39;s deadlocked to verify where and for how long it&#39;s blocked? It&#39;s more likely you have another deadlock in your logic not shown here, which is preventing the reading goroutine from returning."}, {"owner": {"reputation": 19, "user_id": 2671474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5843107fa8dc7effc94675cd7dab888b?s=128&d=identicon&r=PG", "display_name": "user2671474", "link": "https://stackoverflow.com/users/2671474/user2671474"}, "edited": false, "score": 0, "creation_date": 1554446299, "post_id": 55486000, "comment_id": 97762578, "body": "Several people are stuck on semantics. Simply put, I &quot;create&quot; a UDP connection using conn,err := net.ListenUDP(&quot;udp&quot;,nil) and use that to send/receive over. The Read(buf)  is blocking, waiting to be filled up."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554469612, "post_id": 55486000, "comment_id": 97775516, "body": "@user2671474: what I&#39;m saying is that it&#39;s not likely the <code>Read</code> that&#39;s blocking indefinitely (or blocking in the way you think it is), you need to instrument the code some more, and a stack trace will show you how long things are blocking, and where. If you have a network <code>Read</code> that doesn&#39;t honor a valid deadline, then you have a bug, which is the less likely scenario seeing how much Go networking code there is in the wild."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554462218, "post_id": 55530028, "comment_id": 97770975, "body": "Of course there\u2019s no stack trace, you have to generate one when you want it. Stopping the process with SIGQUIT is usually the easiest way."}], "tags": [], "owner": {"reputation": 19, "user_id": 2671474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5843107fa8dc7effc94675cd7dab888b?s=128&d=identicon&r=PG", "display_name": "user2671474", "link": "https://stackoverflow.com/users/2671474/user2671474"}, "is_accepted": false, "score": 0, "last_activity_date": 1554448797, "last_edit_date": 1554448797, "creation_date": 1554448296, "answer_id": 55530028, "question_id": 55486000, "link": "https://stackoverflow.com/questions/55486000/why-does-this-go-routine-randomly-fail-to-exit-when-the-blocking-read-connection/55530028#55530028", "title": "why does this go routine randomly fail to exit when the blocking read connection is closed?", "body": "<p>Thanks everyone for the responses.</p>\n\n<p>So. There wasn't ever a stack trace. In fact, I got NO errors at all, not a race detection or anything and it wasn't deadlocked, a go routine just would not shut down and exit, and it wasn't consistently reproducible. I've been running the same data for two weeks.</p>\n\n<p>When the go routine would fail to report that was exiting, it would simple spin out of control and drive the CPU to 100%, but only AFTER all the others exited and the system moved on. I never saw memory grow. CPU would gradually tick up to 200%, 300%, 400% and that's when the system had to be rebooted. </p>\n\n<p>I logged when it was a leak was happening, it was always a different one, and I'd get one leak after 380 prior successful runs (of 23 pairs of go routines running in unision), next time 1832 before one receiver leaked, next time only 23, with exact same data being chewed on at same starting point. The leaked receiver just spun out of control, but only after the group of 22 others companions had all shutdown and exited successfully and the system moved to the next batch. It would not fail consistently, other than it was guaranteed to leak at some point.</p>\n\n<p>After many days, numerous rewrites, and a million log before/after every action, this finally seems to be what the issue was, and after digging through the library I'm not sure why exactly, nor WHY it only happens randomly.</p>\n\n<p>For whatever reason, the golang.org/x/net/dns/dnsmessage library will randomly freak out if you parse and go straight to skipping questions without reading a question first. No idea why that matters, hello, skipping questions means you don't care about that header section and to mark it as processed, and it works fine for literally a million times in a row, but then doesn't, so you seem to be required to read a question BEFORE you can SkipAllQuestions, since this <strong>seems</strong> to have been the solution. I'm 18,525 batches in, and adding that turned the leaks off.</p>\n\n<pre><code>var p dnsmessage.Parser\nh, err := p.Start(buf[:n])\nif err != nil {\n    continue // what!?\n}\n\nswitch {\ncase h.RCode == dnsmessage.RCodeSuccess:\n    q, err := p.Question() // should only have one question\n    if q.Type != w.Type || err != nil {\n        continue // what!?, impossible\n    }\n    // Note: if you do NOT do the above first, you're asking for pain! (tr)\n    if err := p.SkipAllQuestions(); err != nil {\n        continue // what!?\n    }\n    // Do not count as \"received\" until we have passed above point and\n    // validated that response had a question that we could skip...\n\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 2671474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5843107fa8dc7effc94675cd7dab888b?s=128&d=identicon&r=PG", "display_name": "user2671474", "link": "https://stackoverflow.com/users/2671474/user2671474"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1554448797, "creation_date": 1554257108, "last_edit_date": 1554349519, "question_id": 55486000, "link": "https://stackoverflow.com/questions/55486000/why-does-this-go-routine-randomly-fail-to-exit-when-the-blocking-read-connection", "title": "why does this go routine randomly fail to exit when the blocking read connection is closed?", "body": "<p><strong>Why does this receiver go routine refuse to terminate when the connection is closed</strong> </p>\n\n<p>This runs as expected but then randomly, every 20-10,000x it is called, a receiver will fail to shutdown, which then causes a go routine leak, leading to 100% cpu. </p>\n\n<p>Note: If I log all errors, I will see read on a closed channel if the conn.SetReadDeadline is commented out. When used, I see i/o timeout as the error.</p>\n\n<p>This ran for 10k cycles, where the main process starts 11 pairs of these send/receivers and they process 1000 jobs before the main process sends the shutdown signal. This setup ran for > 6 hours without any issue to to 10k cycles mark overnight, but this morning I can't get it to run more than 20 cycles without getting a receiver flagged as not shutting down and exiting.</p>\n\n<pre><code>func sender(w worker, ch channel) {\n\n    var j job\n    for {\n        select {\n        case &lt;-ch.quit: // shutdown broadcast, exit\n            w.Close()\n            ch.stopped &lt;- w.id // debug, send stop confirmed\n            return\n\n        case j = &lt;-w.job: // worker designated jobs\n        case j = &lt;-ch.spawner: // FCFS jobs\n        }\n\n        ... prepare job ...\n\n        w.WriteToUDP(buf, w.addr)\n\n}\n\nfunc receiver(w worker, ch channel) {\n\n    deadline := 100 * time.Millisecond\nout:\n    for {\n        w.SetReadDeadline(time.Now().Add(deadline))\n        // blocking read, should release on close (or deadline)\n        n, err = w.c.Read(buf)\n\n        select {\n        case &lt;-ch.quit: // shutdown broadcast, exit\n            ch.stopped &lt;- w.id+100 // debug, receiver stop confirmed\n            return\n        default:\n        }\n\n        if n == 0 || err != nil {\n            continue\n        }\n        update := &amp;update{id: w.id}\n\n         ... process update logic ...\n\n        select {\n        case &lt;-ch.quit: // shutting down\n            break out\n        case ch.update &lt;- update\n        }\n\n}\n</code></pre>\n\n<p>I need a <strong>reliable</strong> way to get the receiver to shutdown when it gets either the shutdown broadcast OR the conn is closed. Functionally, closing the channel should be enough and is the preferred method according to the go package <a href=\"https://golang.org/src/net/net.go?s=6157:6199#L163\" rel=\"nofollow noreferrer\">documentation</a>, see Conn interface. </p>\n\n<p>I upgraded to the most recent go, which is 1.12.1 with no change.\nRunning on MacOS in development and CentOS in production.</p>\n\n<p>Any run into this problem?\nIf so, how did you <strong>reliably</strong> fix it?</p>\n\n<hr>\n\n<h2>Possible Solution</h2>\n\n<p>My very verbose and icky solution that seems to possibly work, as a work around, is to do this:</p>\n\n<p>1) start the sender in a go routine, like this (above, unchanged)</p>\n\n<p>2) start the receiver in a go routine, like this (below)</p>\n\n<pre><code>func receive(w worker, ch channel) {\n\n    request := make(chan []byte, 1)\n    reader := make(chan []byte, 1)\n\n    defer func() {\n        close(request) // exit signaling\n        w.c.Close()    // exit signaling\n        //close(reader)\n    }()\n\n    go func() {\n\n        // untried senario, for if we still have leaks -&gt; 100% cpu\n        // we may need to be totally reliant on closing request or ch.quit\n        // defer w.c.Close()\n\n        deadline := 100 * time.Millisecond\n        var n int\n        var err error\n\n        for buf := range request {\n            for {\n                select {\n                case &lt;-ch.quit: // shutdown signal\n                    return\n                default:\n                }\n                w.c.SetReadDeadline(time.Now().Add(deadline))\n                n, err = w.c.Read(buf)\n                if err != nil { // timeout or close\n                    continue\n                }\n                break\n            }\n            select {\n            case &lt;-ch.quit: // shutdown signal\n                return\n            case reader &lt;- buf[:n]:\n                //default:\n            }\n        }\n    }()\n\n    var buf []byte\n\nout:\n    for {\n\n        request &lt;- make([]byte, messageSize)\n\n        select {\n        case &lt;-ch.quit: // shutting down\n            break out\n        case buf = &lt;-reader:\n        }\n\n        update := &amp;update{id: w.id}\n\n      ... process update logic ...\n\n\n        select {\n        case &lt;-ch.quit: // shutting down\n            break out\n        case ch.update &lt;- update\n        }\n\n    }\n\n</code></pre>\n\n<p>My question is, why does this horrendous version 2, that spawns a new go routine to read from the blocking c.Read(buf) seem to work more reliably, meaning it does not leak when the shutdown signal is send, when the much simpler first version didn't ... and it seems to be essentially the same thing due to the blocking c.Read(buf).</p>\n\n<p>Downgrading my question is NOT helpful when this is a legitimate and verifiably repeatable issue, the question remains unanswered.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3895, "user_id": 4040931, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/705151302/picture?type=large", "display_name": "David Alsh", "link": "https://stackoverflow.com/users/4040931/david-alsh"}, "edited": false, "score": 0, "creation_date": 1554257361, "post_id": 55485741, "comment_id": 97681051, "body": "Thank you very much for your answer. I have learned a lot reading through your code."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1554255403, "last_edit_date": 1554255403, "creation_date": 1554254946, "answer_id": 55485741, "question_id": 55485351, "link": "https://stackoverflow.com/questions/55485351/how-do-i-write-a-function-proxy-which-takes-an-interface-thats-cast-to-a-fun/55485741#55485741", "title": "How do I write a function proxy, which takes an interface{} that&#39;s cast to a func(...x) ...y, binding the result to a pointer value?", "body": "<p>Use <a href=\"https://godoc.org/reflect#Value.Call\" rel=\"nofollow noreferrer\">Value.Call</a> to call the function.  Simplify the code by using methods on <code>BindFunc</code> instead of fields with functions.</p>\n\n<pre><code>type BindFunc struct {\n    params  []interface{}\n    results []interface{}\n    fn      interface{}\n}\n\nfunc (bf *BindFunc) Params(params ...interface{}) *BindFunc {\n    bf.params = params\n    return bf\n}\n\nfunc (bf *BindFunc) Results(results ...interface{}) *BindFunc {\n    bf.results = results\n    return bf\n}\n\nfunc (bf *BindFunc) Do() {\n    // Copy params to slice of reflect values.\n    var params []reflect.Value\n    for _, p := range bf.params {\n        params = append(params, reflect.ValueOf(p))\n    }\n\n    // Invoke the function.\n    results := reflect.ValueOf(bf.fn).Call(params)\n\n    // Copy the results.\n    for i, r := range results {\n        reflect.ValueOf(bf.results[i]).Elem().Set(r)\n    }\n}\n\n// NewBindFunc is a proxy function should run the function and bind the results\n// to the result\nfunc NewBindFunc(fn interface{}) *BindFunc {\n    return &amp;BindFunc{fn: fn}\n}\n</code></pre>\n\n<p>Call it like this:</p>\n\n<pre><code>var result *item\nvar err error\n\nNewBindFunc(todo).\n    Params(\"Param\").\n    Results(&amp;result, &amp;err).\n    Do()\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/mEWVSL8euTX\" rel=\"nofollow noreferrer\">Run it on the Playground</a>.</p>\n\n<p>The above code will panic if there's a mismatch in types, a mismatch in the number of arguments or a mismatch in the number of return values. The panic can be avoided by checking types using the reflect package, but I'll leave that as an exercise.</p>\n\n<p>I don't know what the full scenario is, but it may be possible to replace all of this with a closure over the arguments and results:</p>\n\n<pre><code>var result *item\nvar err error\ndo := func() { result, err = todo(\"Param\") }\ndo()\n</code></pre>\n"}], "owner": {"reputation": 3895, "user_id": 4040931, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/705151302/picture?type=large", "display_name": "David Alsh", "link": "https://stackoverflow.com/users/4040931/david-alsh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 1, "accepted_answer_id": 55485741, "answer_count": 1, "score": 0, "last_activity_date": 1554255403, "creation_date": 1554251495, "last_edit_date": 1554252409, "question_id": 55485351, "link": "https://stackoverflow.com/questions/55485351/how-do-i-write-a-function-proxy-which-takes-an-interface-thats-cast-to-a-fun", "title": "How do I write a function proxy, which takes an interface{} that&#39;s cast to a func(...x) ...y, binding the result to a pointer value?", "body": "<p>I am trying to create a function, which acts as a proxy for executing a function. </p>\n\n<p>It accepts a pointer to a value (which will be where the result is set), a func and a number of params. It executes the function and applies the result on the value.</p>\n\n<p>My first challenge is executing the function as the declared type is not a <code>func</code> (and can't be). think I can achieve this using <code>reflect.MakeFunc</code>, but I am having no success.</p>\n\n<p>An example of what I am trying to achieve below.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n// Execute the function which returns this struct\ntype item struct {\n    key        string\n    value      string\n    otherValue string\n}\n\nfunc todo(param string) (*item, error) {\n    return &amp;item{\n        key: param,\n    }, nil\n}\n\ntype BindFunc struct {\n    Params  func(params ...interface{}) *BindFunc\n    Results func(results ...interface{}) *BindFunc\n    Do      func()\n}\n\n// NewBindFunc is a proxy function should run the function and bind the results\n// to the result\nfunc NewBindFunc(fn interface{}) *BindFunc {\n    b := &amp;BindFunc{}\n\n    b.Params = func(params ...interface{}) *BindFunc {\n        return b\n    }\n\n    b.Results = func(results ...interface{}) *BindFunc {\n        return b\n    }\n\n    b.Do = func() {\n        // execute the function\n    }\n\n    return b\n}\n\nfunc main() {\n    var result item\n    var err error\n\n    NewBindFunc(todo).\n        Params(\"Param\").\n        Results(&amp;result, &amp;err).\n        Do()\n\n    fmt.Println(result.key)\n}\n</code></pre>\n"}, {"tags": ["go", "jwt"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": false, "score": 2, "last_activity_date": 1554249657, "creation_date": 1554249657, "answer_id": 55485160, "question_id": 55484731, "link": "https://stackoverflow.com/questions/55484731/mismatched-types-causing-error-when-generating-jwt-token/55485160#55485160", "title": "Mismatched types causing error when generating JWT token", "body": "<p>Change the <code>h.Write</code> line to the following:</p>\n\n<pre><code>h.Write([]byte(header))\nh.Write([]byte(\".\"))\nh.Write(body)\n</code></pre>\n\n<p>Splitting the the hash calculation into three separate calls should be (slightly) faster than concatenating the pieces together and writing that.</p>\n"}], "owner": {"reputation": 117, "user_id": 10096250, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHa1mu8bbSY/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pg9uZTR5XzQA3e2QUPjP-guqL_yA/mo/photo.jpg?sz=128", "display_name": "jmacnc", "link": "https://stackoverflow.com/users/10096250/jmacnc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1554249657, "creation_date": 1554246455, "question_id": 55484731, "link": "https://stackoverflow.com/questions/55484731/mismatched-types-causing-error-when-generating-jwt-token", "title": "Mismatched types causing error when generating JWT token", "body": "<p>I am trying to generate a JWT token but having trouble when it comes to converting everything to a byte array.</p>\n\n<pre><code>func GenerateToken(uid, cid int64) string{\n    header := `{\"alg\": \"HS256\",\"typ\": \"JWT\"}`\n    header = base64.URLEncoding.EncodeToString([]byte(header))\n    var b structs.JwtBody\n    b.UID = uid\n    b.CID = cid\n    body, _ := json.Marshal(b)\n    key := []byte(secret)\n    h := hmac.New(sha256.New, key)\n    h.Write([]byte(header + \".\" + body))\n    signature := base64.URLEncoding.EncodeToString(h.Sum(nil))\n    jwt := header + \".\" + body + \".\" + signature\n    return jwt\n}\n</code></pre>\n\n<p>I am getting an error with this line because the types do not match up.</p>\n\n<pre><code>h.Write([]byte(header + \".\" + body))\n</code></pre>\n\n<p>How do I fix this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1054, "user_id": 5225183, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-R8Nybos5LAs/AAAAAAAAAAI/AAAAAAAAETs/Oxg4jC-EzCU/photo.jpg?sz=128", "display_name": "Hernan Garcia", "link": "https://stackoverflow.com/users/5225183/hernan-garcia"}, "edited": false, "score": 1, "creation_date": 1554238581, "post_id": 55483331, "comment_id": 97676526, "body": "Try <code>go get -u golang.org&#47;x&#47;lint&#47;golint</code> from your server"}, {"owner": {"reputation": 21, "user_id": 11302066, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-HR_7A3vAJU0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfXi5hTQArNA5jJ7mfuqaiGBbqvnA/mo/photo.jpg?sz=128", "display_name": "David Murdock", "link": "https://stackoverflow.com/users/11302066/david-murdock"}, "reply_to_user": {"reputation": 1054, "user_id": 5225183, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-R8Nybos5LAs/AAAAAAAAAAI/AAAAAAAAETs/Oxg4jC-EzCU/photo.jpg?sz=128", "display_name": "Hernan Garcia", "link": "https://stackoverflow.com/users/5225183/hernan-garcia"}, "edited": false, "score": 0, "creation_date": 1554246400, "post_id": 55483331, "comment_id": 97679023, "body": "getting same error"}, {"owner": {"reputation": 1054, "user_id": 5225183, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-R8Nybos5LAs/AAAAAAAAAAI/AAAAAAAAETs/Oxg4jC-EzCU/photo.jpg?sz=128", "display_name": "Hernan Garcia", "link": "https://stackoverflow.com/users/5225183/hernan-garcia"}, "edited": false, "score": 1, "creation_date": 1554255847, "post_id": 55483331, "comment_id": 97680760, "body": "please try this workaround <code>go mod edit -replace github.com&#47;golang&#47;lint@latest=golang.org&#47;x&#47;lint@latest</code> as it&#39;s explained here: <a href=\"https://github.com/golang/go/issues/30831#issuecomment-478314143\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/30831#issuecomment-478314143</a>"}, {"owner": {"reputation": 21, "user_id": 11302066, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-HR_7A3vAJU0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfXi5hTQArNA5jJ7mfuqaiGBbqvnA/mo/photo.jpg?sz=128", "display_name": "David Murdock", "link": "https://stackoverflow.com/users/11302066/david-murdock"}, "reply_to_user": {"reputation": 1054, "user_id": 5225183, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-R8Nybos5LAs/AAAAAAAAAAI/AAAAAAAAETs/Oxg4jC-EzCU/photo.jpg?sz=128", "display_name": "Hernan Garcia", "link": "https://stackoverflow.com/users/5225183/hernan-garcia"}, "edited": false, "score": 2, "creation_date": 1554324646, "post_id": 55483331, "comment_id": 97714325, "body": "I had GO111MODULE=on on my server...turned it to off and it worked. Not sure why."}], "owner": {"reputation": 21, "user_id": 11302066, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-HR_7A3vAJU0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfXi5hTQArNA5jJ7mfuqaiGBbqvnA/mo/photo.jpg?sz=128", "display_name": "David Murdock", "link": "https://stackoverflow.com/users/11302066/david-murdock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2399, "favorite_count": 2, "answer_count": 0, "score": 2, "last_activity_date": 1554277763, "creation_date": 1554238087, "last_edit_date": 1554277763, "question_id": 55483331, "link": "https://stackoverflow.com/questions/55483331/parsing-go-mod-unexpected-module-path-golang-org-x-lint", "title": "parsing go.mod: unexpected module path &quot;golang.org/x/lint&quot;", "body": "<p>I have a package that I've uploaded to Github and am I am go getting the package on another server and keep getting the error: </p>\n\n<blockquote>\n  <p>go: github.com/golang/lint@v0.0.0-20190313153728-d0100b6bd8b3: parsing go.mod: unexpected module path \"golang.org/x/lint\"</p>\n</blockquote>\n\n<p>I've deleted <code>go.mod</code>, <code>go.sum</code> and the vendor directory and updated all packages using </p>\n\n<pre><code>go get -u ./...\n</code></pre>\n\n<p><code>golang.org/x/lint</code> is not in <code>go.mod</code> or <code>go.sum</code> or vendor directory yet I still get the error when trying to go get the package on my other server. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1554235236, "post_id": 55482588, "comment_id": 97675060, "body": "Your fields are unexported. Exported fields have first letter capitalised"}, {"owner": {"reputation": 11490, "user_id": 3317808, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6c8272382fcd9841919bc1f8709d25a0?s=128&d=identicon&r=PG&f=1", "display_name": "overexchange", "link": "https://stackoverflow.com/users/3317808/overexchange"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1554235538, "post_id": 55482588, "comment_id": 97675191, "body": "@zerkms Do I need to export(<code>data.key</code> &amp; <code>data.value</code>) for the reason that data is on wire?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1554235559, "post_id": 55482588, "comment_id": 97675203, "body": "Only exported fields are marshalled, regardless how you use that data. Your <code>myJSON</code> is an empty JSON object."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1554235654, "post_id": 55482588, "comment_id": 97675246, "body": "&quot;Struct values encode as JSON objects. Each exported struct field becomes a member of the object, using the field name as the object key, unless the field is omitted for one of the reasons given below.&quot; <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#Marshal</a>"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1554238830, "post_id": 55482588, "comment_id": 97676620, "body": "&quot;myJSON shows... len=2&quot; - that&#39;s your empty object. Exactly what&#39;s received on the other end."}], "answers": [{"tags": [], "owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "is_accepted": false, "score": 1, "last_activity_date": 1584803702, "last_edit_date": 1584803702, "creation_date": 1554238406, "answer_id": 55483405, "question_id": 55482588, "link": "https://stackoverflow.com/questions/55482588/how-to-marshal-data-and-send-on-websocket/55483405#55483405", "title": "How to marshal data and send on websocket?", "body": "<p>@zerkms is right, you have to have something like this:</p>\n\n<pre><code>type myStruct struct {\n    Key   string `json:\"key\"`\n    Value string `json:\"value\"`\n}\n\nkey, value := gen()\ndata := myStruct{Key: key, Value: value}\nmyJSON, err := json.Marshal(data)\nif err != nil {\n    // error handling\n}\nerr = conn.WriteMessage(websocket.TextMessage, myJSON)\nif err != nil {\n    // error handling\n}\n</code></pre>\n\n<p>You can find simple example <a href=\"https://github.com/cn007b/my/tree/master/ed/go/examples/websocket/src/app\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 11490, "user_id": 3317808, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6c8272382fcd9841919bc1f8709d25a0?s=128&d=identicon&r=PG&f=1", "display_name": "overexchange", "link": "https://stackoverflow.com/users/3317808/overexchange"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1584803702, "creation_date": 1554234936, "last_edit_date": 1554235244, "question_id": 55482588, "link": "https://stackoverflow.com/questions/55482588/how-to-marshal-data-and-send-on-websocket", "title": "How to marshal data and send on websocket?", "body": "<p>Upon debugging below server side code:</p>\n\n<pre><code>    type myStruct struct {\n        key   string\n        value string\n    }\n\n    key, value := gen()\n    data := myStruct{key, value}\n    myJSON, err := json.Marshal(data)\n    err = conn.WriteMessage(websocket.TextMessage, myJSON)\n</code></pre>\n\n<hr>\n\n<p><code>gen()</code> populates <code>key</code> and <code>value</code> with strings</p>\n\n<p><code>myJSON</code> shows:</p>\n\n<h2><a href=\"https://i.stack.imgur.com/i7i0Y.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/i7i0Y.png\" alt=\"enter image description here\"></a></h2>\n\n<p>After writing <code>myJSON</code> on web socket, empty json is received on client side:</p>\n\n<pre><code>            ws.onmessage = function (evt)\n            {\n                console.log(evt.data)\n\n            };\n</code></pre>\n\n<h2><a href=\"https://i.stack.imgur.com/io88o.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/io88o.png\" alt=\"enter image description here\"></a></h2>\n\n<p>Why <code>conn.WriteMessage()</code> does not transfer data(<code>myJSON</code>) to client side?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554225175, "post_id": 55480176, "comment_id": 97670427, "body": "TCP is a stream, you can&#39;t see actual packets at the application layer. You would need to make normal requests and inspect the packets at a lower layer."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554225592, "post_id": 55480176, "comment_id": 97670626, "body": "If you want to generate packets, you probably want to start by looking at <a href=\"https://godoc.org/github.com/google/gopacket\" rel=\"nofollow noreferrer\">godoc.org/github.com/google/gopacket</a>"}, {"owner": {"reputation": 134, "user_id": 10555079, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VJFG1.jpg?s=128&g=1", "display_name": "guzzijason", "link": "https://stackoverflow.com/users/10555079/guzzijason"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554225635, "post_id": 55480176, "comment_id": 97670658, "body": "Yes, I realize that. I guess what I&#39;m wondering is, do I need to do all the work at that low layer, or can I make the HTTP request using higher-level functions, but still have access to the response packets using low-level functions. The old tool I have that does this basically does a <code>curl</code>, and then immediately starts snooping packets. It works, but it&#39;s not horribly efficient. I&#39;m just investigating some ways to streamline the check at this point."}, {"owner": {"reputation": 134, "user_id": 10555079, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VJFG1.jpg?s=128&g=1", "display_name": "guzzijason", "link": "https://stackoverflow.com/users/10555079/guzzijason"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554225832, "post_id": 55480176, "comment_id": 97670737, "body": "I guess one reason I was hoping to be able to make use of the high-level request functions would be TLS, which significantly complicates things if you are generating raw packets (that are expected to work)."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1554226080, "post_id": 55480176, "comment_id": 97670865, "body": "The &quot;simple&quot; way is to do what your curl client does, and sniff the interface during the request. The Go client only needs a <code>net.Conn</code> however, so if you can somehow create an instrumented one using <code>gopacket</code>, then it could just be dropped into the client."}, {"owner": {"reputation": 134, "user_id": 10555079, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VJFG1.jpg?s=128&g=1", "display_name": "guzzijason", "link": "https://stackoverflow.com/users/10555079/guzzijason"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554226148, "post_id": 55480176, "comment_id": 97670901, "body": "I&#39;m thinking perhaps a combination of both <code>gopacket&#47;pcap</code> (to do the capture) and <code>net&#47;http</code> (to make the request) might work. It would be somewhat analogous to what I&#39;m already doing, but, all in go... and hopefully faster, if I&#39;m lucky."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1554227987, "post_id": 55480176, "comment_id": 97671817, "body": "If you manage to create the instrumented connection that JimB suggests, <a href=\"https://golang.org/pkg/net/http/#Transport\" rel=\"nofollow noreferrer\">the Transport&#39;s DialContext field</a> is what you&#39;re looking for."}], "answers": [{"tags": [], "owner": {"reputation": 134, "user_id": 10555079, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VJFG1.jpg?s=128&g=1", "display_name": "guzzijason", "link": "https://stackoverflow.com/users/10555079/guzzijason"}, "is_accepted": false, "score": 0, "last_activity_date": 1554586923, "creation_date": 1554586923, "answer_id": 55553726, "question_id": 55480176, "link": "https://stackoverflow.com/questions/55480176/possible-to-access-tcp-packet-details-with-a-go-http-client/55553726#55553726", "title": "Possible to access TCP packet details with a go HTTP client?", "body": "<p>I did end up solving this problem using <code>gopacket/pcap</code> and <code>net/http</code>.</p>\n\n<p>In a nutshell, what I ended up doing is writing a function that creates a channel, and then calls a goroutine that does the actual packet capture and parsing. The goroutine passes the captured TOS value back to the channel, and then the original function does the http request, and then reads the channel to get the TOS result. Still a bit of a work-in-progress, but so far, this solution seems to be working fairly well.</p>\n"}], "owner": {"reputation": 134, "user_id": 10555079, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VJFG1.jpg?s=128&g=1", "display_name": "guzzijason", "link": "https://stackoverflow.com/users/10555079/guzzijason"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 195, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1554586923, "creation_date": 1554224928, "question_id": 55480176, "link": "https://stackoverflow.com/questions/55480176/possible-to-access-tcp-packet-details-with-a-go-http-client", "title": "Possible to access TCP packet details with a go HTTP client?", "body": "<p>I have a need to be able to validate TOS/DSCP marks on response data from a set of HTTP servers. Would it be possible, given a list of target URLs to test, if there is a way in <code>go</code> to generate the HTTP request, and then be able to examine the response's TCP packet details in order to obtain the TOS value?</p>\n\n<p>My assumption at this point is that it may require creating a socket, and then dynamically generating a TCP packet that contains the HTTP request payload. I've been searching around to see if there were any libraries that would aid in this task, but haven't found anything specific yet.</p>\n\n<p>Note: a simple TCP connection will not provide enough data - the target servers in question will alter TOS/DSCP marks dynamically based on the HTTP server name (so essentially, a single physical server will respond with different TOS marks depending on the vHost requested), so it is important to be able to verify the TOS on actual HTTP response packets, and not something simple like a ping. The TOS values in the TCP 3-way handshake cannot be trusted either - it must be a packet containing the HTTP data.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1554225331, "post_id": 55480140, "comment_id": 97670485, "body": "<code>Package filepath implements utility routines for manipulating filename paths in a way compatible with the target operating system-defined file paths.</code> <a href=\"https://golang.org/pkg/path/filepath/\" rel=\"nofollow noreferrer\">path/filepath</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1554226330, "post_id": 55480140, "comment_id": 97670995, "body": "ParseFiles(filepath.Join(wd, filepath.FromSlash(&quot;src/html/index/html&quot;)))"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 3, "creation_date": 1554227446, "post_id": 55480140, "comment_id": 97671590, "body": "IIRC, windows can now handle <code>&#47;</code> for paths, too. I&#39;ve not used windows in years, but I&#39;ve seen it being used in the wild, so why not try that?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554232143, "post_id": 55480140, "comment_id": 97673751, "body": "You also don&#39;t need to append <code>wd</code> by hand. Any relative (not starting with a slash or drive letter) path is assumed to be rooted in the working directory."}, {"owner": {"reputation": 11490, "user_id": 3317808, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6c8272382fcd9841919bc1f8709d25a0?s=128&d=identicon&r=PG&f=1", "display_name": "overexchange", "link": "https://stackoverflow.com/users/3317808/overexchange"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554236283, "post_id": 55480140, "comment_id": 97675520, "body": "@Adrian On using <code>t, err := template.ParseFiles(&quot;html&#47;index.html&quot;)</code> I get error: <code>http: panic serving [::1]:54221: open html&#47;index.html: The system cannot find the path specified.</code>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554238177, "post_id": 55480140, "comment_id": 97676353, "body": "Based on your quoted code, shouldn&#39;t the path be <code>src&#47;html&#47;index.html</code> not just <code>html&#47;index.html</code>?"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1554254327, "post_id": 55480140, "comment_id": 97680476, "body": "@EliasVanOotegem Yes, Windows has done so since at least 95/NT4."}], "answers": [{"tags": [], "owner": {"reputation": 8680, "user_id": 80711, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/894f4423fafc44e67beaaa73f0554d5c?s=128&d=identicon&r=PG", "display_name": "Henryk Konsek", "link": "https://stackoverflow.com/users/80711/henryk-konsek"}, "is_accepted": false, "score": 1, "last_activity_date": 1554234855, "creation_date": 1554234855, "answer_id": 55482562, "question_id": 55480140, "link": "https://stackoverflow.com/questions/55480140/os-portable-code-for-referring-template-files/55482562#55482562", "title": "OS portable code for referring template files", "body": "<p>In general using <a href=\"https://golang.org/pkg/path/filepath/#Join\" rel=\"nofollow noreferrer\">filepath.Join</a> is a way to go:</p>\n\n<pre><code>path := filepath.Join(\"separate\", \"me\")\n</code></pre>\n\n<p>But <a href=\"https://golang.org/pkg/path/filepath/#FromSlash\" rel=\"nofollow noreferrer\">filepath.FromSlash</a> is much more readable in my opinion:</p>\n\n<pre><code>path := filepath.FromSlash(\"separate/me\")\n</code></pre>\n"}], "owner": {"reputation": 11490, "user_id": 3317808, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6c8272382fcd9841919bc1f8709d25a0?s=128&d=identicon&r=PG&f=1", "display_name": "overexchange", "link": "https://stackoverflow.com/users/3317808/overexchange"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1554234855, "creation_date": 1554224819, "question_id": 55480140, "link": "https://stackoverflow.com/questions/55480140/os-portable-code-for-referring-template-files", "title": "OS portable code for referring template files", "body": "<p>Below is the code, that runs in windows:</p>\n\n<pre><code>wd, err := os.Getwd()\nif err != nil {\n    log.Fatal(err)\n}\n\nt, err := template.ParseFiles(wd + \"\\\\src\\\\html\\\\index.html\")\n</code></pre>\n\n<hr>\n\n<p>which fails in Linux due to backslash(<code>\\</code>)</p>\n\n<p>How to make this code portable across OS?</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1554224977, "post_id": 55479971, "comment_id": 97670331, "body": "Comparing microbenchmarks of different things is not very easy, and without a use-case, not very useful. Pre-allocation isn&#39;t slower, but <code>buf2</code> is larger than <code>buf</code> so it should allocate more. <code>buf2</code> slice also escapes to the heap, so it&#39;s not immediately reused and you allocate the entire thing every time."}, {"owner": {"reputation": 69991, "user_id": 939557, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/3VPea.png?s=128&g=1", "display_name": "MadScientist", "link": "https://stackoverflow.com/users/939557/madscientist"}, "edited": false, "score": 0, "creation_date": 1554225930, "post_id": 55479971, "comment_id": 97670785, "body": "Why is there a <code>makefile</code> tag on this question?"}, {"owner": {"reputation": 476, "user_id": 5065312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85f77cad3f3081a18d4645f5579a9f1e?s=128&d=identicon&r=PG&f=1", "display_name": "VasileM", "link": "https://stackoverflow.com/users/5065312/vasilem"}, "edited": false, "score": 0, "creation_date": 1554226730, "post_id": 55479971, "comment_id": 97671198, "body": "Which is better for hadleClient function that is running as goroutine? (to handle tcp clients). I&#39;m reusing object instances with a channel and select."}, {"owner": {"reputation": 476, "user_id": 5065312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85f77cad3f3081a18d4645f5579a9f1e?s=128&d=identicon&r=PG&f=1", "display_name": "VasileM", "link": "https://stackoverflow.com/users/5065312/vasilem"}, "reply_to_user": {"reputation": 69991, "user_id": 939557, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/3VPea.png?s=128&g=1", "display_name": "MadScientist", "link": "https://stackoverflow.com/users/939557/madscientist"}, "edited": false, "score": 0, "creation_date": 1554226775, "post_id": 55479971, "comment_id": 97671221, "body": "@MadScientist stackoverflow changes automattically from make to makefile"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1554227131, "post_id": 55479971, "comment_id": 97671417, "body": "@VasileM: neither is better, this is an attempt at optimizing a problem you don&#39;t have. Just use a slice, as pre-allocating for your slice generally doesn&#39;t do anything you can&#39;t do with <code>make</code>."}, {"owner": {"reputation": 476, "user_id": 5065312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85f77cad3f3081a18d4645f5579a9f1e?s=128&d=identicon&r=PG&f=1", "display_name": "VasileM", "link": "https://stackoverflow.com/users/5065312/vasilem"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554227352, "post_id": 55479971, "comment_id": 97671538, "body": "@JimB: okay. Thank you. My intention was to have 100 instances of the reusable object and the others (1000, 2000, etc) that are created in the most efficient way possible."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1554227443, "post_id": 55479971, "comment_id": 97671587, "body": "If you want to test pre-allocation, you need to do it with your real use case. Guessing how the code will be optimized by the compiler, especially before you write it, isn&#39;t going to help."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1554227837, "post_id": 55479971, "comment_id": 97671752, "body": "Not to mention, if you&#39;re creating a pool of 100 of these ahead of time, the time it takes to allocate means nothing to your program. Also, look at <code>sync.Pool</code> as an efficient way to re-using objects."}, {"owner": {"reputation": 476, "user_id": 5065312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85f77cad3f3081a18d4645f5579a9f1e?s=128&d=identicon&r=PG&f=1", "display_name": "VasileM", "link": "https://stackoverflow.com/users/5065312/vasilem"}, "edited": false, "score": 0, "creation_date": 1554228491, "post_id": 55479971, "comment_id": 97672019, "body": "Okay. But it is complicated to perform bencharks or profiles of a server listening. I did it before, I have a client package to benchmark. In those things sometimes I prefer to write code according to the theory and not perform more tests for lack of time."}, {"owner": {"reputation": 476, "user_id": 5065312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85f77cad3f3081a18d4645f5579a9f1e?s=128&d=identicon&r=PG&f=1", "display_name": "VasileM", "link": "https://stackoverflow.com/users/5065312/vasilem"}, "edited": false, "score": 0, "creation_date": 1554228699, "post_id": 55479971, "comment_id": 97672123, "body": "No, sync.Pool can lose the instances. Garbage Collector clean it."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1554230792, "post_id": 55479971, "comment_id": 97673062, "body": "This realy sound like premature optimisation. Stop that."}, {"owner": {"reputation": 476, "user_id": 5065312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85f77cad3f3081a18d4645f5579a9f1e?s=128&d=identicon&r=PG&f=1", "display_name": "VasileM", "link": "https://stackoverflow.com/users/5065312/vasilem"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1554231127, "post_id": 55479971, "comment_id": 97673245, "body": "@Volker: If there are several ways to do the same, why not worry and always choose the most efficient?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1554232658, "post_id": 55479971, "comment_id": 97673971, "body": "&quot;Premature optimization is the root of all evil.&quot;"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1554232727, "post_id": 55479971, "comment_id": 97673993, "body": "You must be joking. &quot;The most efficient&quot; is not something well defined and if it is well defined: Most of the time it simply does not matter. Strangely enough this pathological focus on irrelevant details is not considered insane by lots of programmers."}, {"owner": {"reputation": 476, "user_id": 5065312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85f77cad3f3081a18d4645f5579a9f1e?s=128&d=identicon&r=PG&f=1", "display_name": "VasileM", "link": "https://stackoverflow.com/users/5065312/vasilem"}, "edited": false, "score": 0, "creation_date": 1554254805, "post_id": 55479971, "comment_id": 97680563, "body": "Nice philosophical approach but it&#39;s not my interest.  Many of the so-called programmers only care about comfort, simplicity and compatibility. Typical features of the methodology of Google.  Use the wheel, do not reinvent it. Because the wheel has a fork, microphone, flashlight, etc. and it will serve you. But nobody cares about the garbage code as a consequence of the design patterns, for example. Or the resources. Read the Stackoverflow, the good answer is the first because it works, but it is not the most efficient. This code is part of the production software."}, {"owner": {"reputation": 476, "user_id": 5065312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85f77cad3f3081a18d4645f5579a9f1e?s=128&d=identicon&r=PG&f=1", "display_name": "VasileM", "link": "https://stackoverflow.com/users/5065312/vasilem"}, "edited": false, "score": 0, "creation_date": 1554256205, "post_id": 55479971, "comment_id": 97680836, "body": "Another example would be the design principles in Java. Invoking an interface method is expensive, but I have seen them in loops. Who cares about wasted processor clock cycles? The important thing is that the algorithm is effective in order to develop a lot of software and sell it in kilograms."}], "owner": {"reputation": 476, "user_id": 5065312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85f77cad3f3081a18d4645f5579a9f1e?s=128&d=identicon&r=PG&f=1", "display_name": "VasileM", "link": "https://stackoverflow.com/users/5065312/vasilem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 141, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1554226911, "creation_date": 1554224177, "last_edit_date": 1554226911, "question_id": 55479971, "link": "https://stackoverflow.com/questions/55479971/slice-preallocation-slow-than-make", "title": "Slice preallocation slow than make", "body": "<p>Extracted from: <a href=\"https://github.com/golang/go/wiki/Performance\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/Performance</a></p>\n\n<blockquote>\n  <p>A special case of allocation combining is slice array preallocation.\n  If you know a typical size of the slice, you can preallocate a backing\n  array for it as follows:</p>\n\n<pre><code>type X struct {\n    buf      []byte\n    bufArray [16]byte // Buf usually does not grow beyond 16 bytes. }\n\nfunc MakeX() *X {\n    x := &amp;X{}\n    // Preinitialize buf with the backing array.\n    x.buf = x.bufArray[:0]\n    return x }\n</code></pre>\n</blockquote>\n\n<p>Testing the difference:</p>\n\n<pre><code>package main\n\nimport \"testing\"\n\ntype buf struct {\n        b []byte\n}\ntype buf2 struct {\n        b  []byte\n        bt [2]byte\n}\n\nfunc B() *buf2 {\n        b := &amp;buf2{}\n        b.b = b.bt[:0]\n        return b\n}\n\nfunc BenchmarkMake(b *testing.B) {\n        for i := 0; i &lt; b.N; i++ {\n                b := &amp;buf{}\n                b.b = make([]byte, 2, 2)\n        }\n}\n\nfunc BenchmarkPreallocation(b *testing.B) {\n        for i := 0; i &lt; b.N; i++ {\n                b := B()\n                _ = b\n        }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[user@SYSTEM temp]$ go test -bench . -benchmem\ngoos: linux\ngoarch: amd64\npkg: temp\nBenchmarkMake-8                 100000000               12.7 ns/op             2 B/op          1 allocs/op\nBenchmarkPreallocation-8        50000000                40.4 ns/op            32 B/op          1 allocs/op\n</code></pre>\n\n<p>Why preallocation is slow?</p>\n\n<p>Why does the slice internals (pointing operation) <code>[:0]</code> use 32 bytes to do that?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1554220460, "post_id": 55478869, "comment_id": 97667977, "body": "<code>len(row) == 0</code>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554220498, "post_id": 55478869, "comment_id": 97668004, "body": "Or, since you need index 4, better yet use <code>len(row) &lt; 5</code>."}, {"owner": {"reputation": 29, "user_id": 10238185, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-c3heLG_v7UU/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7q4dcQfSNt6rbNI0BmK6CfjjoBQnw/mo/photo.jpg?sz=128", "display_name": "tony", "link": "https://stackoverflow.com/users/10238185/tony"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554220650, "post_id": 55478869, "comment_id": 97668080, "body": "@Adrian oops :(.......write answer and i&#39;ll accept. It had crossed my mind but thought it had to be more complicated than that..."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1554220786, "post_id": 55478869, "comment_id": 97668160, "body": "Go aims to have as little as possible that has to be complicated."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1554298221, "last_edit_date": 1554298221, "creation_date": 1554220834, "answer_id": 55479082, "question_id": 55478869, "link": "https://stackoverflow.com/questions/55478869/compare-interface-to-nil/55479082#55479082", "title": "Compare interface to nil", "body": "<blockquote>\n  <p>How can I check if row is emmpty?</p>\n</blockquote>\n\n<pre><code>if len(row) == 0 { // row is empty\n</code></pre>\n\n<p>But since you need to access index 4 you might as well check for what you actually need:</p>\n\n<pre><code>if len(row) &lt; 5 { // row doesn't have an index 4\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 10238185, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-c3heLG_v7UU/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7q4dcQfSNt6rbNI0BmK6CfjjoBQnw/mo/photo.jpg?sz=128", "display_name": "tony", "link": "https://stackoverflow.com/users/10238185/tony"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 55479082, "answer_count": 1, "score": -2, "last_activity_date": 1554298221, "creation_date": 1554220260, "question_id": 55478869, "link": "https://stackoverflow.com/questions/55478869/compare-interface-to-nil", "title": "Compare interface to nil", "body": "<p>In the Google sheets <a href=\"https://developers.google.com/sheets/api/quickstart/go\" rel=\"nofollow noreferrer\">example</a> there is this piece of code  down the bottom that loops over the rows in a spreadsheet:</p>\n\n<pre><code>for _, row := range resp.Values {\n  // Print columns A and E, which correspond to indices 0 and 4.\n  fmt.Printf(\"%s, %s\\n\", row[0], row[4])\n}\n</code></pre>\n\n<p>However this code gives an error if there is an empty row in the spreadsheet due to referencing <code>row[0]</code> when <code>row</code> is an empty interface of size two <code>&lt;[]interface {}&gt; (length: 0, cap: 0)</code></p>\n\n<p>A simple if statement to check if <code>row</code> is empty doesn't work as <code>row == nil</code> shows <code>false</code>.</p>\n\n<p>How can I check if <code>row</code> is emmpty?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "edited": false, "score": 0, "creation_date": 1554222866, "post_id": 55478778, "comment_id": 97669284, "body": "Hiya!  It&#39;s a bit tough to tell what exactly you&#39;re asking here.  If it&#39;s just &quot;how do I access functions in a package that&#39;s in a subdirectory, then it&#39;d be something like making sure &quot;package protected&quot; is in your subdir&#39;s source file and doing an &quot;import nameofmainpackage.protected&quot; and then using protected.protecteduri in the Routes{}.  But it&#39;s a bit unclear."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1554223031, "post_id": 55478778, "comment_id": 97669358, "body": "&quot;but in this case it does not work.&quot; Why not?"}, {"owner": {"reputation": 2859, "user_id": 6225565, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iqBej.jpg?s=128&g=1", "display_name": "Shalauddin Ahamad Shuza", "link": "https://stackoverflow.com/users/6225565/shalauddin-ahamad-shuza"}, "edited": false, "score": 0, "creation_date": 1554226059, "post_id": 55478778, "comment_id": 97670852, "body": "Also the code is not complete. Please share complete code"}, {"owner": {"reputation": 63, "user_id": 11154131, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Df9Cd5m8YbU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf3t3aLeqiZQsvHjhZOsFrB-0dzvg/mo/photo.jpg?sz=128", "display_name": "Abraham", "link": "https://stackoverflow.com/users/11154131/abraham"}, "edited": false, "score": 0, "creation_date": 1554277779, "post_id": 55478778, "comment_id": 97687183, "body": "what i mean by it does not work means that when a request is sent to access the &quot;protecteduri&quot; function, the accesstoken is not validated as it was in the working  function main()"}], "owner": {"reputation": 63, "user_id": 11154131, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Df9Cd5m8YbU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf3t3aLeqiZQsvHjhZOsFrB-0dzvg/mo/photo.jpg?sz=128", "display_name": "Abraham", "link": "https://stackoverflow.com/users/11154131/abraham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 109, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1554277418, "creation_date": 1554219969, "last_edit_date": 1554277418, "question_id": 55478778, "link": "https://stackoverflow.com/questions/55478778/how-to-wrap-api-endpoint-with-middleware", "title": "How to wrap API Endpoint with middleware", "body": "<p>AM trying generate and appy the client credential accesstoken to wrap simple API endpoint. I got code that work well when all codes are in the main function. However, i woild like to have the API endpoint (/protected) outside the main function in a different directory together with the middleware. \nHow do I do this, so that middleware apply to every request to the server? </p>\n\n<p>my main function in the parent directory</p>\n\n<pre><code>func main() {\n    log.Printf(\"Server started\")\n\n    router := sw.NewRouter()\n    manager := manage.NewDefaultManager()\n    manager.SetAuthorizeCodeTokenCfg(manage.DefaultAuthorizeCodeTokenCfg)\n\n    manager.MustTokenStorage(store.NewMemoryTokenStore())\n\n    clientStore := store.NewClientStore()\n    manager.MapClientStorage(clientStore)\n\n    srv := server.NewDefaultServer(manager)\n    srv.SetAllowGetAccessRequest(true)\n    srv.SetClientInfoHandler(server.ClientFormHandler)\n    manager.SetRefreshTokenCfg(manage.DefaultRefreshTokenCfg)\n\n    srv.SetInternalErrorHandler(func(err error) (re *errors.Response) {\n        log.Println(\"Internal Error:\", err.Error())\n        return\n    })\n\n    srv.SetResponseErrorHandler(func(re *errors.Response) {\n        log.Println(\"Response Error:\", re.Error.Error())\n    })\n\n    router.HandleFunc(\"/oauth2/token\", func(w http.ResponseWriter, r *http.Request) {\n        srv.HandleTokenRequest(w, r)\n    })\n\n    router.HandleFunc(\"/credentials\", func(w http.ResponseWriter, r *http.Request) {\n        clientId := uuid.New().String()[:8]\n        clientSecret := uuid.New().String()[:8]\n        err := clientStore.Set(clientId, &amp;models.Client{\n            ID:     clientId,\n            Secret: clientSecret,\n            Domain: \"http://localhost:9094\",\n        })\n        if err != nil {\n            fmt.Println(err.Error())\n        }\n\n        w.Header().Set(\"Content-Type\", \"application/json\")\n        json.NewEncoder(w).Encode(map[string]string{\"CLIENT_ID\": clientId, \"CLIENT_SECRET\": clientSecret})\n    })\n\n    log.Fatal(http.ListenAndServe(\":8000\", router))\n}\n\n\nmiddleware API endpoint and router in a sub directory\n\n\nfunc protecteduri(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Hello, I'm protected\"))\n}\n\nfunc validateToken(f http.HandlerFunc, srv *server.Server) http.HandlerFunc {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        _, err := srv.ValidationBearerToken(r)\n        if err != nil {\n            http.Error(w, err.Error(), http.StatusBadRequest)\n            return\n        }\n\n        f.ServeHTTP(w, r)\n    })\n}\n\n\nrouter\n\ntype Route struct {\n    Name        string\n    Method      string\n    Pattern     string\n    HandlerFunc http.HandlerFunc\n}\n\ntype Routes []Route\n\nfunc NewRouter() *mux.Router {\n    router := mux.NewRouter().StrictSlash(true)\n    for _, route := range routes {\n        var handler http.Handler\n        handler = route.HandlerFunc\n        handler = Logger(handler, route.Name)\n\n        router.\n            Methods(route.Method).\n            Path(route.Pattern).\n            Name(route.Name).\n            Handler(handler)\n    }\n\n    return router\n}\n\nfunc Index(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hello World!\")\n}\n\nvar routes = Routes{\n    {\n        \"Index\",\n        \"GET\",\n        \"/\",\n        Index,\n    },\n\n    {\n        \"protecteduri\",\n        strings.ToUpper(\"Get\"),\n        \"/protected\",\n        protecteduri,\n    },\n\n    {\n        \"AccessTokenRequest\",\n        strings.ToUpper(\"Post\"),\n        \"/oauth2/token\",\n        AccessTokenRequest,\n    },\n}\n</code></pre>\n\n<p>Normally i add middleware in the router file as</p>\n\n<p>hadler = middleware(handler)</p>\n\n<p>and it apply to all the incoming request but in this case it does not\nwork.</p>\n\n<p>The full working code is this</p>\n\n<pre><code>func main() {\n   manager := manage.NewDefaultManager()\n   manager.SetAuthorizeCodeTokenCfg(manage.DefaultAuthorizeCodeTokenCfg)\n\n   // token memory store\n   manager.MustTokenStorage(store.NewMemoryTokenStore())\n\n   // client memory store\n   clientStore := store.NewClientStore()\n\n   manager.MapClientStorage(clientStore)\n\n   srv := server.NewDefaultServer(manager)\n   srv.SetAllowGetAccessRequest(true)\n   srv.SetClientInfoHandler(server.ClientFormHandler)\n   manager.SetRefreshTokenCfg(manage.DefaultRefreshTokenCfg)\n\n   srv.SetInternalErrorHandler(func(err error) (re *errors.Response) {\n      log.Println(\"Internal Error:\", err.Error())\n      return\n   })\n\n   srv.SetResponseErrorHandler(func(re *errors.Response) {\n      log.Println(\"Response Error:\", re.Error.Error())\n   })\n\n   http.HandleFunc(\"/oauth2/token\", func(w http.ResponseWriter, r *http.Request) {\n      srv.HandleTokenRequest(w, r)\n   })\n\n   http.HandleFunc(\"/credentials\", func(w http.ResponseWriter, r *http.Request) {\n      clientId := uuid.New().String()[:8]\n      clientSecret := uuid.New().String()[:8]\n      err := clientStore.Set(clientId, &amp;models.Client{\n         ID:     clientId,\n         Secret: clientSecret,\n         Domain: \"http://localhost:9094\",\n      })\n      if err != nil {\n         fmt.Println(err.Error())\n      }\n\n      w.Header().Set(\"Content-Type\", \"application/json\")\n      json.NewEncoder(w).Encode(map[string]string{\"CLIENT_ID\": clientId, \"CLIENT_SECRET\": clientSecret})\n   })\n\n   http.HandleFunc(\"/protected\", validateToken(func(w http.ResponseWriter, r *http.Request) {\n      w.Write([]byte(\"Hello, I'm protected\"))\n   }, srv))\n\n   log.Fatal(http.ListenAndServe(\":9096\", nil))\n}\n\n//main function end here\n//middleware function below\n\nfunc validateToken(f http.HandlerFunc, srv *server.Server) http.HandlerFunc {\n   return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n      _, err := srv.ValidationBearerToken(r)\n      if err != nil {\n         http.Error(w, err.Error(), http.StatusBadRequest)\n         return\n      }\n\n      f.ServeHTTP(w, r)\n   })\n}\n</code></pre>\n\n<p>As you can see the accesstoken to request this handle function http.HandleFunc(\"/protected\"... below is validated using the middleware function \"validateToken\".</p>\n\n<pre><code>http.HandleFunc(\"/protected\", validateToken(func(w http.ResponseWriter, r *http.Request) {\n      w.Write([]byte(\"Hello, I'm protected\"))\n   }, srv))\n\n</code></pre>\n\n<p>What i want to do is to rewrite the main function by moving the route handle function (http.HandleFunc(\"/protected\"...) outside the main function and still the the accesstoken get validated when i send request to the (http.HandleFunc(\"/protected\", validateToken(...) function using the routes defined above. In the ealier code, it works but the token to the handlefunction </p>\n\n<pre><code>func protecteduri(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Hello, I'm protected\"))\n}\n</code></pre>\n\n<p>is not validated.</p>\n\n<p>i will be adding more handle function and do not want to put all of them in the main function.  </p>\n\n<pre><code>http.HandleFunc(\"/protected\", validateToken(func(w http.ResponseWriter, r *http.Request) {\n      w.Write([]byte(\"Hello, I'm protected\"))\n   }, srv))\n\n</code></pre>\n"}, {"tags": ["go", "google-cloud-functions", "go-modules", "vendoring"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554218263, "post_id": 55477750, "comment_id": 97666621, "body": "You can absolutely use vendoring with multiple packages. Pretty much any non-throwaway project (so, anything that would be inclined to vendor dependencies) will be made up of multiple packages, so this is the typical use case."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554218464, "post_id": 55477750, "comment_id": 97666763, "body": "Are you sure you need the inner package defined as its own module?"}, {"owner": {"reputation": 6111, "user_id": 7804058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BuRRt.png?s=128&g=1", "display_name": "norbjd", "link": "https://stackoverflow.com/users/7804058/norbjd"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554218781, "post_id": 55477750, "comment_id": 97666980, "body": "@Adrian This module is used by other cloud functions, so to avoid code duplication, it should be defined in a separated module. Are you sure about your assumption <code>You can absolutely use vendoring with multiple packages</code> when applied to Google Cloud Functions? In Go (in general), I agree with you, but here it does not seem possible."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554220403, "post_id": 55477750, "comment_id": 97667936, "body": "Code re-use is a good reason to have it in a separate <i>package</i>, not a separate module. Modules can contain multiple packages. It&#39;s only necessary to declare them as separate <i>modules</i> if you need to maintain separate module versions for each: <a href=\"https://github.com/golang/go/wiki/Modules#faqs--multi-module-repositories\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/&hellip;</a> or if they are truly, completely distinct (but in that case they would typically be in separate repositories)."}, {"owner": {"reputation": 6111, "user_id": 7804058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BuRRt.png?s=128&g=1", "display_name": "norbjd", "link": "https://stackoverflow.com/users/7804058/norbjd"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554220791, "post_id": 55477750, "comment_id": 97668163, "body": "So if I understand correctly, I should have created a single <i>module</i>, and define <code>function</code> and <code>common</code> as <i>packages</i>? If this is correct, I don&#39;t think it fits Google Cloud Function deployment model (<a href=\"https://cloud.google.com/functions/docs/writing/specifying-dependencies-go\" rel=\"nofollow noreferrer\">cloud.google.com/functions/docs/writing/&hellip;</a>)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554220929, "post_id": 55477750, "comment_id": 97668240, "body": "I don&#39;t see anything on that page suggesting that you can&#39;t deploy a module containing multiple packages. I&#39;d be extremely surprised if that was a constraint, given that 99% of modules (and programs) contain multiple packages."}, {"owner": {"reputation": 6111, "user_id": 7804058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BuRRt.png?s=128&g=1", "display_name": "norbjd", "link": "https://stackoverflow.com/users/7804058/norbjd"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554278724, "post_id": 55477750, "comment_id": 97687729, "body": "There are multiple constraints concerning code structure to deploy a Cloud Function in Go (see the docs : <a href=\"https://cloud.google.com/functions/docs/writing/#functions-writing-file-structuring-go\" rel=\"nofollow noreferrer\">cloud.google.com/functions/docs/writing/&hellip;</a>). As for the usage of packages, it&#39;s stated in this doc : <code>Note: You must use Go modules, by providing a go.mod file, to use sub-packages.</code>. Packaging in the context of Cloud Functions can be somewhat different of &quot;classical&quot; packaging in Go, that&#39;s why it brings confusion."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554298327, "post_id": 55477750, "comment_id": 97699933, "body": "The second bullet on that page shows an example of a package and sub-package with only the outer package having a go.mod file."}, {"owner": {"reputation": 6111, "user_id": 7804058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BuRRt.png?s=128&g=1", "display_name": "norbjd", "link": "https://stackoverflow.com/users/7804058/norbjd"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554300989, "post_id": 55477750, "comment_id": 97701657, "body": "Yes, it&#39;s the upper part of the hierarchy shown in my question. But there is no other directory <b>at the same level</b> as <code>function&#47;</code>, like I&#39;ve presented. This topic is also covered by this link : <a href=\"https://stackoverflow.com/questions/54255485/how-can-i-use-a-sub-packages-with-go-on-google-cloud-functions\" title=\"how can i use a sub packages with go on google cloud functions\">stackoverflow.com/questions/54255485/&hellip;</a> I provided in my question. But I&#39;m afraid that is not the point I&#39;m addressing."}, {"owner": {"reputation": 6111, "user_id": 7804058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BuRRt.png?s=128&g=1", "display_name": "norbjd", "link": "https://stackoverflow.com/users/7804058/norbjd"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554301065, "post_id": 55477750, "comment_id": 97701727, "body": "If you have any experience in deploying Cloud Functions in Go, could you please write a simple example showing how to deploy a Cloud Function, based on the code structure I provided? Remembering that <code>common</code> should be separated because code inside is used by other Functions (located at the same level as <code>function&#47;</code>). That would be very helpful because I think there is a misunderstanding between us."}], "owner": {"reputation": 6111, "user_id": 7804058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BuRRt.png?s=128&g=1", "display_name": "norbjd", "link": "https://stackoverflow.com/users/7804058/norbjd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 724, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1561984368, "creation_date": 1554216849, "last_edit_date": 1554220907, "question_id": 55477750, "link": "https://stackoverflow.com/questions/55477750/deploy-google-cloud-function-using-go-modules-and-vendoring-at-the-same-time", "title": "Deploy Google Cloud Function using Go modules and vendoring at the same time", "body": "<p>I am trying to deploy a <a href=\"https://cloud.google.com/functions/docs/concepts/go-runtime\" rel=\"nofollow noreferrer\">Google Cloud Function in Go</a>, but got an error while deploying because I use, at the same time, subpackages <strong>and</strong> \"internal modules\" (only defined on my host, not deployed anywhere). I have the following structure :</p>\n\n<pre><code>.\n\u251c\u2500\u2500 function\n\u2502   \u251c\u2500\u2500 package1\n\u2502   \u2502\u00a0\u00a0 \u2514\u2500\u2500 file1.go\n\u2502   \u251c\u2500\u2500 function.go\n\u2502   \u251c\u2500\u2500 go.mod\n\u2502   \u2514\u2500\u2500 go.sum\n\u2514\u2500\u2500 common\n    \u251c\u2500\u2500 common.go\n    \u251c\u2500\u2500 go.mod\n    \u2514\u2500\u2500 go.sum\n</code></pre>\n\n<p>Contents of my <code>function.go</code> (entrypoint of my Cloud Function) :</p>\n\n<pre><code>package function\n\nimport (\n    \"github.com/.../function/package1\"\n    \"github.com/.../common\"\n)\n\n// use functions from package1 and common\n</code></pre>\n\n<p>Topics have been covered individually here :</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/54410963/error-when-trying-to-deploy-google-cloud-function-in-go-1-11-using-go-modules\">Error when trying to deploy Google cloud function in Go 1.11 using go modules</a></li>\n<li><a href=\"https://stackoverflow.com/questions/54255485/how-can-i-use-a-sub-packages-with-go-on-google-cloud-functions\">How can I use a sub-packages with Go on Google Cloud Functions?</a></li>\n</ul>\n\n<p>The first post indicates to use vendoring and exclude <code>go.mod</code> and <code>go.sum</code> from the source to be able to use <code>common</code> module, while the 2nd indicates to include <code>go.mod</code> and <code>go.sum</code> without vendoring to be able to use subpackages.</p>\n\n<p>But I am wondering : is it possible to use both at the same time? Or vendoring dependencies requires to put all <code>.go</code> source files in the same directory (no subpackages)? Likewise, using subpackages requires to not use vendoring? How can I structure my code to avoid those restrictions, or what can I do (deploy <code>common</code> module somewhere, ...)?</p>\n\n<p>Also, the <a href=\"https://cloud.google.com/functions/docs/writing/specifying-dependencies-go\" rel=\"nofollow noreferrer\">documentation on \"Specifying dependencies\" for Go Cloud Functions</a> states that :</p>\n\n<blockquote>\n  <p>Cloud Functions in Go must provide all of their dependencies via <strong>either</strong> Go modules with a go.mod file, or a vendor directory. Your function <strong>cannot specify dependencies using both</strong> Go modules and a vendor directory at the same time.</p>\n</blockquote>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1554216161, "post_id": 55477464, "comment_id": 97665312, "body": "You&#39;re just returning one of the 2 strings to compare, you need to compare them and return a bool"}, {"owner": {"reputation": 2118, "user_id": 4107823, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/SdUGT.png?s=128&g=1", "display_name": "copser", "link": "https://stackoverflow.com/users/4107823/copser"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1554216267, "post_id": 55477464, "comment_id": 97665384, "body": "so it&#39;s like this <code>sort.Slice(inspections, func(i, j int) bool { return inspections[i].CreatedDate &lt; inspections[j].CreatedDate })</code>, and yes you are right"}, {"owner": {"reputation": 2118, "user_id": 4107823, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/SdUGT.png?s=128&g=1", "display_name": "copser", "link": "https://stackoverflow.com/users/4107823/copser"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1554216303, "post_id": 55477464, "comment_id": 97665408, "body": "@JimB can you construct and answer so I can accept it"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1554216824, "post_id": 55477464, "comment_id": 97665737, "body": "that only works if the dates are in a format that is lexicographically sortable."}], "answers": [{"comments": [{"owner": {"reputation": 2118, "user_id": 4107823, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/SdUGT.png?s=128&g=1", "display_name": "copser", "link": "https://stackoverflow.com/users/4107823/copser"}, "edited": false, "score": 1, "creation_date": 1554216897, "post_id": 55477670, "comment_id": 97665784, "body": "I have, JimB helped with that hint, thanks for the example."}], "tags": [], "owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "is_accepted": true, "score": 3, "last_activity_date": 1554219116, "last_edit_date": 1554219116, "creation_date": 1554216626, "answer_id": 55477670, "question_id": 55477464, "link": "https://stackoverflow.com/questions/55477464/sort-list-by-createddate-golang/55477670#55477670", "title": "sort list by createdDate golang", "body": "<p>You have to parse the Date strings and compare them as <a href=\"https://golang.org/pkg/time/#Time\" rel=\"nofollow noreferrer\">time.Time</a> instances</p>\n\n<p>Assuming you have a valid date and they are on <a href=\"https://golang.org/src/time/format.go?s=#L69\" rel=\"nofollow noreferrer\">RFC3339</a>, you may do the following</p>\n\n<pre><code>    sort.Slice(inspections, func(i, j int) bool {\n        t1, _ := time.Parse(time.RFC3339, inspections[i].CreatedDate)\n        t2, _ := time.Parse(time.RFC3339, inspections[j].CreatedDate)\n        return t1.After(t2)\n    })\n</code></pre>\n"}], "owner": {"reputation": 2118, "user_id": 4107823, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/SdUGT.png?s=128&g=1", "display_name": "copser", "link": "https://stackoverflow.com/users/4107823/copser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 55477670, "answer_count": 1, "score": -2, "last_activity_date": 1554219116, "creation_date": 1554216009, "last_edit_date": 1554216933, "question_id": 55477464, "link": "https://stackoverflow.com/questions/55477464/sort-list-by-createddate-golang", "title": "sort list by createdDate golang", "body": "<p>I have a function which returns model instance of Inspections and I want to <code>sort</code> it by <code>CreatedDate</code> but after I compile I've got </p>\n\n<blockquote>\n  <p>cannot use inspections[i].CreatedDate (type string) as type bool in return argument</p>\n</blockquote>\n\n<p>the <code>inspection.go</code> is</p>\n\n<pre><code>type Inspection struct {\n    Id          int64               `db:\"id,omitempty\" json:\"id,omitempty\"`\n    CreatedDate string              `db:\"created,omitempty\" json:\"created_date,omitempty\"`\n    Records     []*InspectionRecord `db:\"-\" json:\"records,omitempty\"`\n    InspectionFields\n}\n</code></pre>\n\n<p>and the <code>list.go</code> is</p>\n\n<pre><code>import (\n    \"sort\"\n)\n\nfunc (s *Manager) list(fields *inspection.ItemIdField) (*inspection.InspectionHistoryResponse, error) {\n    return s.listItemInspectionHistory(fields.ItemId)\n}\n\nfunc (s *Manager) listItemInspectionHistory(itemId string) (*inspection.InspectionHistoryResponse, error) {\n    g := config.Client.Inspections()\n\n    var inspections []*models.Inspection\n\n    inspections, err := g.FindInspections(itemId)\n\n    if err != nil {\n        s.Log.Debugf(\"Can't find inspections of item with id %s\", itemId)\n        return nil, err\n    }\n    s.Log.Debugf(\"Found %d inspections for item with id %s\", len(inspections), itemId)\n\n    for _, inspection := range inspections {\n        inspection.Records, err = g.FindRecords(inspection.Id)\n        if err != nil {\n            s.Log.Debugf(\"Can't find records for inspection with id %d\", inspection.Id)\n            return nil, err\n        }\n        s.Log.Debugf(\"Found %d records for inspection with id %d\", len(inspection.Records), inspection.Id)\n    }\n\n    model := new(models.InspectionHistory)\n    model.Inspections = inspections\n    // sort by CreatedDate\n    sort.Slice(inspections, func(i, j int) bool { return inspections[i].CreatedDate })\n\n    return transform.InspectionHistoryModelToProtobufResponse(model)\n}\n</code></pre>\n\n<p>The error is obvious but I'm a bit confused on how to resolve it, can someone please explain to me how to resolve this? thanks.</p>\n"}, {"tags": ["go", "interactive-shell"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 6, "creation_date": 1554210469, "post_id": 55475588, "comment_id": 97661575, "body": "You shouldn&#39;t use os/exec for this. You should use a mongo driver, to talk to mongodb directly."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554210593, "post_id": 55475588, "comment_id": 97661651, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/q/39735171/13860\">stackoverflow.com/q/39735171/13860</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554210634, "post_id": 55475588, "comment_id": 97661678, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/q/27322722/13860\">stackoverflow.com/q/27322722/13860</a>"}, {"owner": {"reputation": 1372, "user_id": 3929917, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0b49fc1a1f89e276d98919474fb8d431?s=128&d=identicon&r=PG&f=1", "display_name": "silent-box", "link": "https://stackoverflow.com/users/3929917/silent-box"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554214230, "post_id": 55475588, "comment_id": 97664015, "body": "@Flimzy I can&#39;t use any driver, my application should not know about the provided commands. It can be mongo, mysql, postgres, whatever."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554215737, "post_id": 55475588, "comment_id": 97665016, "body": "Then you should use drivers for each of those. Your application already has to know about them, if it knows enough to know which commands to send to the os.exec invocation."}, {"owner": {"reputation": 1372, "user_id": 3929917, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0b49fc1a1f89e276d98919474fb8d431?s=128&d=identicon&r=PG&f=1", "display_name": "silent-box", "link": "https://stackoverflow.com/users/3929917/silent-box"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554216182, "post_id": 55475588, "comment_id": 97665327, "body": "I understand how strange it looks, but it is indeed what I need. My application works with arbitrary shell commands, provided in console (all kinds of stuff - <code>curl</code>, <code>date</code>, <code>cat</code>, anything). Right now I&#39;m covering the case to work with interactive shell commands - databases are just an example"}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1554216739, "post_id": 55476357, "comment_id": 97665689, "body": "Some programs don&#39;t exit until their standard input is closed, so it is usually safer to call stdin.Close before cmd.Wait. Not sure how mongo behaves, though. The explicit quit command may be enough in this case."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1554218352, "post_id": 55476357, "comment_id": 97666687, "body": "My understanding was that <code>stdin.Close</code> would only close the <code>io.Pipe</code> but not actually close the underlying stdin fd, please correct me if I&#39;m wrong though."}, {"owner": {"reputation": 1372, "user_id": 3929917, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0b49fc1a1f89e276d98919474fb8d431?s=128&d=identicon&r=PG&f=1", "display_name": "silent-box", "link": "https://stackoverflow.com/users/3929917/silent-box"}, "edited": false, "score": 0, "creation_date": 1554222286, "post_id": 55476357, "comment_id": 97668987, "body": "@Adrian Thank you very much, that&#39;s exactly what I need. As I mentioned above, my app is the console utility, and the mongo command is just a regular user input for it - that&#39;s why I can&#39;t use any particular DB driver (and the DB interaction is just an example - user can provide any type of command, I just want to cover the case with interactive shell)"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1554222557, "post_id": 55476357, "comment_id": 97669142, "body": "&quot;he pipe will be closed automatically after Wait sees the command exit. A caller need only call Close to force the pipe to close sooner. For example, if the command being run will not exit until standard input is closed, the caller must close the pipe.&quot; <a href=\"https://golang.org/pkg/os/exec/#Cmd.StdinPipe\" rel=\"nofollow noreferrer\">golang.org/pkg/os/exec/#Cmd.StdinPipe</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554223210, "post_id": 55476357, "comment_id": 97669442, "body": "I guess it just seemed kind of ambiguous to me when I read it at first but yeah you&#39;re right. I&#39;ve updated the code with your suggestion."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1554223164, "last_edit_date": 1554223164, "creation_date": 1554212655, "answer_id": 55476357, "question_id": 55475588, "link": "https://stackoverflow.com/questions/55475588/how-to-execute-multiple-commands-in-interactive-shell/55476357#55476357", "title": "How to execute multiple commands in interactive shell", "body": "<p>As Flimzy noted, you should absolutely be using a mongo driver to work with mongo, not trying to interact with it via shell exec.</p>\n\n<p>However, to answer the root question, of course you can execute multiple commands - there's no reason you can't. Every time you write to the process' stdin, it's like you're at a terminal typing into it. There's no secret limitation on that, other than processes which specifically detect if they're connected to a TTY.</p>\n\n<p>Your code has several issues, though - you should definitely review the <a href=\"https://golang.org/pkg/os/exec/\" rel=\"nofollow noreferrer\"><code>os/exec</code> package documentation</a>. You're calling <code>cmd.Run</code>, which:</p>\n\n<blockquote>\n  <p>starts the specified command and waits for it to complete.</p>\n</blockquote>\n\n<p>And then calling <code>cmd.Wait</code>, which... also waits for the command to complete. You're writing to the stdin pipe in a goroutine, even though this is a very serialized process: you want to write to the pipe to execute a command, get the result, write another command, get another result... concurrency only muddles matters and should not be used here. And you're not sending newlines to tell Mongo you're done writing a command (just like you'd do in the shell - Mongo won't just start executing as soon as you enter the closing paren, you have to hit enter).</p>\n\n<p>What you would want to do to interact with a process via stdin/stdout (again, noting that <strong>this is absolutely not the way to interact with a database</strong>, but <em>could</em> be valid for other external commands):</p>\n\n<pre><code>cmd := exec.Command(\"sh\", \"-c\", \"mongo --quiet --host=localhost blog\")\n\ncmd.Stdout = os.Stdout\ncmd.Stderr = os.Stderr\n\nstdin, _ := cmd.StdinPipe()\n\n// Start command but don't wait for it to exit (yet) so we can interact with it\ncmd.Start()\n\n// Newlines, like hitting enter in a terminal, tell Mongo you're done writing a command\nio.WriteString(stdin, \"db.getCollection('posts').find({status:'INACTIVE'}).itcount()\\n\")\nio.WriteString(stdin, \"db.getCollection('posts').find({status:'ACTIVE'}).itcount()\\n\")\n\n// Quit tells it you're done interacting with it, otherwise it won't exit\nio.WriteString(stdin, \"quit()\\n\")\n\nstdin.Close()\n\n// Lastly, wait for the process to exit\ncmd.Wait()\n</code></pre>\n"}], "owner": {"reputation": 1372, "user_id": 3929917, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0b49fc1a1f89e276d98919474fb8d431?s=128&d=identicon&r=PG&f=1", "display_name": "silent-box", "link": "https://stackoverflow.com/users/3929917/silent-box"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1040, "favorite_count": 0, "accepted_answer_id": 55476357, "answer_count": 1, "score": -3, "last_activity_date": 1554223164, "creation_date": 1554210361, "last_edit_date": 1554217918, "question_id": 55475588, "link": "https://stackoverflow.com/questions/55475588/how-to-execute-multiple-commands-in-interactive-shell", "title": "How to execute multiple commands in interactive shell", "body": "<p>My application works with all kind of shell commands, provided from the console (<code>curl</code>, <code>date</code>, <code>ping</code>, whatever). Now I'd like to cover the case with interactive shell commands (like mongo shell), using <code>os/exec</code>.</p>\n\n<ul>\n<li><p>e.g. as a first step, connect to mongodb:\n<code>mongo --quiet --host=localhost blog</code></p></li>\n<li><p>then perform <strong>arbitrary number</strong> of commands, getting the result on every step\n<code>db.getCollection('posts').find({status:'INACTIVE'})</code></p></li>\n<li><p>and then\n<code>exit</code></p></li>\n</ul>\n\n<p>I tried the following, but it allows me to perform only one command per mongo connection:</p>\n\n<pre><code>func main() {\n\n    cmd := exec.Command(\"sh\", \"-c\", \"mongo --quiet --host=localhost blog\")\n\n    cmd.Stdout = os.Stdout\n    cmd.Stderr = os.Stderr\n\n    stdin, _ := cmd.StdinPipe()\n\n    go func() {\n        defer stdin.Close()\n        io.WriteString(stdin, \"db.getCollection('posts').find({status:'INACTIVE'}).itcount()\")\n        // fails, if I'll do one more here\n    }()\n\n    cmd.Run()\n    cmd.Wait()\n}\n\n</code></pre>\n\n<p>Is there a way to run multiple commands, getting stdout result per executed command?</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 1, "creation_date": 1554206840, "post_id": 55474364, "comment_id": 97659235, "body": "You may use your pattern with <a href=\"https://golang.org/pkg/regexp/#Regexp.FindAllStringSubmatch\" rel=\"nofollow noreferrer\"><code>FindAllStringSubmatch</code></a> and grab second items in the resulting array of matches. See <a href=\"https://play.golang.org/p/NHvCPntwFPL\" rel=\"nofollow noreferrer\">play.golang.org/p/NHvCPntwFPL</a>"}, {"owner": {"reputation": 2573, "user_id": 1758285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OEpA3.jpg?s=128&g=1", "display_name": "Alexey Nakhimov", "link": "https://stackoverflow.com/users/1758285/alexey-nakhimov"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1554207452, "post_id": 55474364, "comment_id": 97659609, "body": "@WiktorStribi\u017cew thank yoy very much! It&#39;s work!"}], "owner": {"reputation": 2573, "user_id": 1758285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OEpA3.jpg?s=128&g=1", "display_name": "Alexey Nakhimov", "link": "https://stackoverflow.com/users/1758285/alexey-nakhimov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 27, "favorite_count": 0, "closed_date": 1554207486, "answer_count": 0, "score": 0, "last_activity_date": 1554206698, "creation_date": 1554206698, "question_id": 55474364, "link": "https://stackoverflow.com/questions/55474364/selecting-text-between-borders-using-regexp-in-go", "closed_reason": "Duplicate", "title": "Selecting text between borders using regexp in Go", "body": "<p>Sample of code:</p>\n\n<pre><code>proc := exec.Command(execString, arg01, arg02, arg03, arg04, arg05)\nstdout, err := proc.Output()\nres := string(stdout)\nfmt.Printeln(res)\n</code></pre>\n\n<p>Stdout of this code:</p>\n\n<pre><code>------------------------------------------------------------\nRoot project\n------------------------------------------------------------\nRoot project 'cuba'\n+--- Project ':cuba-client'\n+--- Project ':cuba-client-tests'\n+--- Project ':cuba-core'\n..........\n</code></pre>\n\n<p>I need to select ONLY projects'name, beetwen <code>':</code> and <code>'</code>, for this exaple:</p>\n\n<pre><code>cuba-client\ncuba-client-tests\ncuba-core\n...........\n</code></pre>\n\n<p>I'm trying:</p>\n\n<pre><code>re := regexp.MustCompile(`':(.*?)'`)\nreg := re.FindAllString(res, -1)\nfmt.Println(reg)\n</code></pre>\n\n<p>And output:</p>\n\n<pre><code>':cuba-client'\n':cuba-client-tests'\n':cuba-core'\n..............\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["postgresql", "go", "golang-migrate"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554201748, "post_id": 55472414, "comment_id": 97656052, "body": "There&#39;s no reason ever to do <code>log.Println(fmt.Sprintf(...))</code>. Just do <code>log.Printf()</code> instead."}, {"owner": {"reputation": 143, "user_id": 7334197, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Oku4dUDTgk8/AAAAAAAAAAI/AAAAAAAABW4/hJ6mUEk7PvQ/photo.jpg?sz=128", "display_name": "Darmawan Zulkifli", "link": "https://stackoverflow.com/users/7334197/darmawan-zulkifli"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554201980, "post_id": 55472414, "comment_id": 97656196, "body": "thanks for review my code, but you say maybe multiple migrations. how we know that ?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554201992, "post_id": 55472414, "comment_id": 97656208, "body": "The error you observe appears to occur when trying to drop the database. This suggests that it can&#39;t drop the database, because something else is using it."}, {"owner": {"reputation": 143, "user_id": 7334197, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Oku4dUDTgk8/AAAAAAAAAAI/AAAAAAAABW4/hJ6mUEk7PvQ/photo.jpg?sz=128", "display_name": "Darmawan Zulkifli", "link": "https://stackoverflow.com/users/7334197/darmawan-zulkifli"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554202287, "post_id": 55472414, "comment_id": 97656384, "body": "is there any suggestions for handling this ?"}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1554205336, "post_id": 55472414, "comment_id": 97658297, "body": "kill all other connections to the database"}, {"owner": {"reputation": 143, "user_id": 7334197, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Oku4dUDTgk8/AAAAAAAAAAI/AAAAAAAABW4/hJ6mUEk7PvQ/photo.jpg?sz=128", "display_name": "Darmawan Zulkifli", "link": "https://stackoverflow.com/users/7334197/darmawan-zulkifli"}, "edited": false, "score": 0, "creation_date": 1573443114, "post_id": 55472414, "comment_id": 103871737, "body": "solved, i am forgot i have <code>migrations.up.sql</code> and should add <code>migrations.down.sql</code>"}], "owner": {"reputation": 143, "user_id": 7334197, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Oku4dUDTgk8/AAAAAAAAAAI/AAAAAAAABW4/hJ6mUEk7PvQ/photo.jpg?sz=128", "display_name": "Darmawan Zulkifli", "link": "https://stackoverflow.com/users/7334197/darmawan-zulkifli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1037, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1573443183, "creation_date": 1554200535, "last_edit_date": 1573443183, "question_id": 55472414, "link": "https://stackoverflow.com/questions/55472414/get-error-cant-acquire-lock-when-trying-to-migrate-with-golang-migrate-to-post", "title": "Get Error: can&#39;t acquire lock when trying to migrate with golang-migrate to postgres database", "body": "<p>i am trying to migrate with golang to postgres database using library\n<code>\"github.com/golang-migrate/migrate/v4\"</code></p>\n\n<p>I got some error like code below.</p>\n\n<pre><code>base_test.go:79: Migrating postgres://db:db@localhost:65432/testdb?sslmode=disable from file:///home/user/migrations/test\nbase_test.go:88: can't acquire lock\n</code></pre>\n\n<p>here is preparedb function for migrations, this function i called in test for test migrate:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func PrepareDB() {\n    if dbConnPool != nil {\n        return\n    }\n    log.SetFlags(log.Lshortfile)\n\n    configFile := os.Getenv(\"CONFIG_FILE\")\n    if configFile == \"\" {\n        configFile = \"./configs/config.json\"\n    }\n    viper.SetConfigFile(configFile)\n    if err := viper.ReadInConfig(); err != nil {\n        panic(err)\n    }\n\n    conf := viper.Sub(\"dev\")\n    port := uint16(conf.GetInt(\"dbPort\"))\n    host := conf.GetString(\"dbHost\")\n    user := conf.GetString(\"dbUser\")\n    pass := conf.GetString(\"dbPass\")\n    dbName = conf.GetString(\"dbName\")\n    redisHost := conf.GetString(\"redisHost\")\n    redisPort := conf.GetString(\"redisPort\")\n\n    hostOvr := os.Getenv(\"_DBHOST\")\n    if hostOvr != \"\" {\n        host = hostOvr\n    }\n\n    portOvr := os.Getenv(\"_DBPORT\")\n    if portOvr != \"\" {\n        portX, err := strconv.Atoi(portOvr)\n        if err != nil {\n            log.Fatal(err)\n        }\n        port = uint16(portX)\n    }\n\n    migrationPath := \"file://\" + os.Getenv(\"MIGRATION_PATH\")\n    if migrationPath == \"file://\" {\n        log.Println(\"MIGRATION_PATH environment is not set, using default value\")\n        cwd, _ := filepath.Abs(filepath.Dir(os.Args[0]))\n        migrationPath = \"file://\" + cwd + \"/migrations/test\"\n    }\n\n    url := fmt.Sprintf(\"postgres://%s:%s@%s:%d/%s?sslmode=disable\", user, pass, host, port, dbName)\n    log.Println(fmt.Sprintf(\"Migrating %s from %s\", url, migrationPath))\n    m, err := migrate.New(\n        migrationPath,\n        url)\n    if err != nil {\n        log.Fatal(err)\n    }\n    err = m.Drop()\n    if err != nil &amp;&amp; err.Error() != \"no change\" {\n        log.Fatal(err)\n    }\n    err = m.Up()\n    if err != nil &amp;&amp; err.Error() != \"no change\" {\n        log.Fatal(err)\n    }\n\n    pgxConf := &amp;pgx.ConnConfig{\n        Port:     port,\n        Host:     host,\n        User:     user,\n        Password: pass,\n        Database: dbName,\n    }\n    pgxPoolConf := pgx.ConnPoolConfig{\n        ConnConfig:     *pgxConf,\n        MaxConnections: 5,\n    }\n    dbConnPool, err = pgx.NewConnPool(pgxPoolConf)\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>and here is my database schema, i create this from postgres cli then i export it with pg_dump for try igrating to database again:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>--\n-- PostgreSQL database dump\n--\n\n-- Dumped from database version 11.2\n-- Dumped by pg_dump version 11.2\n\nSET statement_timeout = 0;\nSET lock_timeout = 0;\nSET idle_in_transaction_session_timeout = 0;\nSET client_encoding = 'UTF8';\nSET standard_conforming_strings = on;\nSELECT pg_catalog.set_config('search_path', '', false);\nSET check_function_bodies = false;\nSET client_min_messages = warning;\nSET row_security = off;\n\n--\n-- Name: pgcrypto; Type: EXTENSION; Schema: -; Owner: \n--\n\nCREATE EXTENSION IF NOT EXISTS pgcrypto WITH SCHEMA public;\n\n\n--\n-- Name: EXTENSION pgcrypto; Type: COMMENT; Schema: -; Owner: \n--\n\nCOMMENT ON EXTENSION pgcrypto IS 'cryptographic functions';\n\n\nSET default_tablespace = '';\n\nSET default_with_oids = false;\n\n--\n-- Name: variant; Type: TABLE; Schema: public; Owner: clouds\n--\n\nCREATE TABLE public.variant (\n    id integer NOT NULL,\n    project_id character varying(255) NOT NULL,\n    variant_name character varying(255) NOT NULL,\n    variant_release_version character varying(255) NOT NULL,\n    repo_url character varying(255) NOT NULL,\n    state character varying(255) NOT NULL,\n    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP\n);\n\n\nALTER TABLE public.variant OWNER TO clouds;\n\n--\n-- Name: variant_id_seq; Type: SEQUENCE; Schema: public; Owner: clouds\n--\n\nCREATE SEQUENCE public.variant_id_seq\n    AS integer\n    START WITH 1\n    INCREMENT BY 1\n    NO MINVALUE\n    NO MAXVALUE\n    CACHE 1;\n\n\nALTER TABLE public.variant_id_seq OWNER TO clouds;\n\n--\n-- Name: variant_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: clouds\n--\n\nALTER SEQUENCE public.variant_id_seq OWNED BY public.variant.id;\n\n\n--\n-- Name: variant id; Type: DEFAULT; Schema: public; Owner: clouds\n--\n\nALTER TABLE ONLY public.variant ALTER COLUMN id SET DEFAULT nextval('public.variant_id_seq'::regclass);\n\n\n--\n-- Data for Name: variant; Type: TABLE DATA; Schema: public; Owner: clouds\n--\n\nCOPY public.variant (id, project_id, variant_name, variant_release_version, repo_url, state, created_at) FROM stdin;\n1   123 auth    stagging    https://repo.dev.citra.digital  test    2019-04-02 17:46:30.886344\n2   345 release release https://repo.dev.citra.digital  test    2019-04-02 17:47:03.258495\n\\.\n\n\n--\n-- Name: variant_id_seq; Type: SEQUENCE SET; Schema: public; Owner: clouds\n--\n\nSELECT pg_catalog.setval('public.variant_id_seq', 2, true);\n\n\n--\n-- Name: variant variant_pkey; Type: CONSTRAINT; Schema: public; Owner: clouds\n--\n\nALTER TABLE ONLY public.variant\n    ADD CONSTRAINT variant_pkey PRIMARY KEY (id);\n\n\n--\n-- PostgreSQL database dump complete\n--\n\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1554196482, "post_id": 55470972, "comment_id": 97652777, "body": "What kind of searching have you done to answer this yourself? The answer is pretty obviously &quot;no&quot; if you spend even a few seconds searching."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 8, "creation_date": 1554196845, "post_id": 55470972, "comment_id": 97653020, "body": "Of course you should read the docs of a function at least once before using it. How else would you know what it does?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1554197833, "post_id": 55470972, "comment_id": 97653615, "body": "&quot;Must I checkout docs every time I need to use a function?&quot; Is this some kind of trick question? Or are you in a time zone where it is still April 1st?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1554211639, "post_id": 55470972, "comment_id": 97662325, "body": "Yes, you absolutely need to read the documentation for the functions you use. Otherwise you&#39;ll end up opening a lot of questions that could have been answered faster by reading the docs. For example, the <a href=\"https://tour.golang.org/basics/4\" rel=\"nofollow noreferrer\">first demonstration of functions in the Tour of Go</a> shows that you don&#39;t always have to return an error."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1554215966, "post_id": 55470972, "comment_id": 97665183, "body": "<code>strconv.ParseFloat()</code> absolutely can return errors. It is not guaranteed to be successful. It depends on what input it received."}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554196615, "post_id": 55471055, "comment_id": 97652865, "body": "It&#39;s more than good practice, it&#39;s (loosely) enforced by the standard linter."}, {"owner": {"reputation": 842, "user_id": 2751683, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/3558b76b5ea55282b21df6a923f60f4a?s=128&d=identicon&r=PG&f=1", "display_name": "Cholthi Paul Ttiopic", "link": "https://stackoverflow.com/users/2751683/cholthi-paul-ttiopic"}, "edited": false, "score": 0, "creation_date": 1554196701, "post_id": 55471055, "comment_id": 97652919, "body": "what happens if incorrectly capture an <code>err</code> value from function that returns non"}, {"owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "reply_to_user": {"reputation": 842, "user_id": 2751683, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/3558b76b5ea55282b21df6a923f60f4a?s=128&d=identicon&r=PG&f=1", "display_name": "Cholthi Paul Ttiopic", "link": "https://stackoverflow.com/users/2751683/cholthi-paul-ttiopic"}, "edited": false, "score": 0, "creation_date": 1554196804, "post_id": 55471055, "comment_id": 97652989, "body": "@CholthiPaulTtiopic You&#39;ll get error <code>assignment mismatch: 2 variables but 1 values</code>, like: <a href=\"https://play.golang.org/p/VLZvceokqfJ\" rel=\"nofollow noreferrer\">play.golang.org/p/VLZvceokqfJ</a>"}], "tags": [], "owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "is_accepted": false, "score": 2, "last_activity_date": 1554211816, "last_edit_date": 1554211816, "creation_date": 1554196574, "answer_id": 55471055, "question_id": 55470972, "link": "https://stackoverflow.com/questions/55470972/do-all-go-functions-return-err-as-second-return-value/55471055#55471055", "title": "Do all Go functions return err as second return value?", "body": "<blockquote>\n  <p>must all functions be made to return err</p>\n</blockquote>\n\n<p>No.\n<br>But in case you function may return error - you have to return this error as last value.\n<br>It's good practice to return error as last value.</p>\n\n<blockquote>\n  <p>how will I know a function is or is not returning an err</p>\n</blockquote>\n\n<p>Before using some function you have to see that function and in declaration you'll see what function returns. Also it's good to read documentation to function, and check out how to use function.</p>\n"}, {"tags": [], "owner": {"reputation": 1914, "user_id": 9811969, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/184e2e46b8d8b8c483c85589709b8563?s=128&d=identicon&r=PG&f=1", "display_name": "Nik", "link": "https://stackoverflow.com/users/9811969/nik"}, "is_accepted": true, "score": 3, "last_activity_date": 1554206539, "last_edit_date": 1554206539, "creation_date": 1554201163, "answer_id": 55472614, "question_id": 55470972, "link": "https://stackoverflow.com/questions/55470972/do-all-go-functions-return-err-as-second-return-value/55472614#55472614", "title": "Do all Go functions return err as second return value?", "body": "<p><em>Answering your question:</em>\nFortunately, Go prevents certain types of programmers errors. It just won't let you compile the program if you forget one of the values that the function returns.</p>\n\n<p>It's a good practice to return errors in Go, read <strong>Errors</strong> section of <a href=\"https://golang.org/doc/effective_go.html#errors\" rel=\"nofollow noreferrer\">Effective Go</a></p>\n\n<blockquote>\n  <p>Library routines must often return some sort of error indication to the caller. As mentioned earlier, Go's multivalue return makes it easy to return a detailed error description alongside the normal return value. It is good style to use this feature to provide detailed error information. </p>\n</blockquote>\n\n<p>and <a href=\"https://blog.golang.org/error-handling-and-go\" rel=\"nofollow noreferrer\">Error handling and Go</a></p>\n\n<blockquote>\n  <p>In Go, error handling is important. The language's design and conventions encourage you to explicitly check for errors where they occur</p>\n</blockquote>\n\n<p>However there is a problem described <a href=\"https://go.googlesource.com/proposal/+/master/design/go2draft-error-handling-overview.md\" rel=\"nofollow noreferrer\">here</a> and probably will be improved in Go 2</p>\n\n<blockquote>\n  <p>In general Go programs have too much code checking errors and not enough code handling them.</p>\n</blockquote>\n\n<p>Dave Cheney writes in <a href=\"http://%3Ehttps://dave.cheney.net/2019/01/27/eliminate-error-handling-by-eliminating-errors\" rel=\"nofollow noreferrer\">the blog</a></p>\n\n<blockquote>\n  <p>I\u2019m suggesting changing your code so you don\u2019t have as many errors to handle.</p>\n</blockquote>\n"}], "owner": {"reputation": 842, "user_id": 2751683, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/3558b76b5ea55282b21df6a923f60f4a?s=128&d=identicon&r=PG&f=1", "display_name": "Cholthi Paul Ttiopic", "link": "https://stackoverflow.com/users/2751683/cholthi-paul-ttiopic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 494, "favorite_count": 0, "accepted_answer_id": 55472614, "answer_count": 2, "score": -10, "last_activity_date": 1582537767, "creation_date": 1554196324, "last_edit_date": 1582537767, "question_id": 55470972, "link": "https://stackoverflow.com/questions/55470972/do-all-go-functions-return-err-as-second-return-value", "title": "Do all Go functions return err as second return value?", "body": "<p>I see code snippets were functions return <code>err</code> as last argument a lot of time.</p>\n\n<pre><code>f, err := strconv.ParseFloat(asciiFloat, 64)\n</code></pre>\n\n<p>Question is must all functions be made to return err even if no error handling is involved in the function implementation.\nAnd how will I know a function is or is not returning an <code>err</code> value?</p>\n\n<p>Must I checkout docs every time I need to use a function?</p>\n"}, {"tags": ["go", "x509", "pkcs#11"], "comments": [{"owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "edited": false, "score": 1, "creation_date": 1554194953, "post_id": 55470311, "comment_id": 97651871, "body": "Could you post the header of your private key?"}, {"owner": {"reputation": 444, "user_id": 7918749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r9BIg.jpg?s=128&g=1", "display_name": "Black_Dreams", "link": "https://stackoverflow.com/users/7918749/black-dreams"}, "reply_to_user": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "edited": false, "score": 0, "creation_date": 1554195658, "post_id": 55470311, "comment_id": 97652284, "body": "-----BEGIN OPENSSH PRIVATE KEY-----"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 2, "creation_date": 1554204135, "post_id": 55470311, "comment_id": 97657519, "body": "Try using <a href=\"https://godoc.org/golang.org/x/crypto/ssh#ParseRawPrivateKey\" rel=\"nofollow noreferrer\">ssh.ParseRawPrivateKey</a> from <code>x&#47;crypto</code>."}, {"owner": {"reputation": 444, "user_id": 7918749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r9BIg.jpg?s=128&g=1", "display_name": "Black_Dreams", "link": "https://stackoverflow.com/users/7918749/black-dreams"}, "edited": false, "score": 0, "creation_date": 1554205085, "post_id": 55470311, "comment_id": 97658131, "body": "I try but getting ssh: no key found"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1554206494, "post_id": 55470311, "comment_id": 97659012, "body": "Is it passphrase protected? If so, you may need to use <a href=\"https://godoc.org/golang.org/x/crypto/ssh#ParseRawPrivateKeyWithPassphrase\" rel=\"nofollow noreferrer\">ssh.ParseRawPrivateKeyWithPassphrase</a>"}, {"owner": {"reputation": 444, "user_id": 7918749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r9BIg.jpg?s=128&g=1", "display_name": "Black_Dreams", "link": "https://stackoverflow.com/users/7918749/black-dreams"}, "edited": false, "score": 0, "creation_date": 1554207338, "post_id": 55470311, "comment_id": 97659535, "body": "No it&#39;s not passphrase protected."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 2, "creation_date": 1554207462, "post_id": 55470311, "comment_id": 97659617, "body": "At this point, we can&#39;t help. Please post reproducible code, including the input. You can generate a new throwaway key and use that in your example. Then we may be able to help."}, {"owner": {"reputation": 444, "user_id": 7918749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r9BIg.jpg?s=128&g=1", "display_name": "Black_Dreams", "link": "https://stackoverflow.com/users/7918749/black-dreams"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1554207683, "post_id": 55470311, "comment_id": 97659776, "body": "Thanks @Marc I&#39;ll try with the new key if not working I&#39;ll post the code and the sample private key."}, {"owner": {"reputation": 444, "user_id": 7918749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r9BIg.jpg?s=128&g=1", "display_name": "Black_Dreams", "link": "https://stackoverflow.com/users/7918749/black-dreams"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1554210999, "post_id": 55470311, "comment_id": 97661900, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/191096/discussion-between-black-dreams-and-marc\">continue this discussion in chat</a>."}, {"owner": {"reputation": 444, "user_id": 7918749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r9BIg.jpg?s=128&g=1", "display_name": "Black_Dreams", "link": "https://stackoverflow.com/users/7918749/black-dreams"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1554212189, "post_id": 55470311, "comment_id": 97662653, "body": "@Marc I add the code and the sample key below please see where I&#39;m wrong."}], "answers": [{"comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1554221009, "post_id": 55476164, "comment_id": 97668285, "body": "Please edit your original question, don&#39;t create an answer. Also <code>ssh.ParseRawPrivateKey</code> takes the raw pem-encoded bytes, you shouldn&#39;t call <code>pem.Decode</code>."}, {"owner": {"reputation": 444, "user_id": 7918749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r9BIg.jpg?s=128&g=1", "display_name": "Black_Dreams", "link": "https://stackoverflow.com/users/7918749/black-dreams"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1554268872, "post_id": 55476164, "comment_id": 97683516, "body": "ok I try with remove the pem.decode but it wouldn&#39;t give me the result !!! say&#39;s no key found."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 2, "creation_date": 1554288861, "post_id": 55476164, "comment_id": 97693900, "body": "I&#39;m not sure what you&#39;re doing, but this works: <a href=\"https://play.golang.org/p/VWs_VNzhGcK\" rel=\"nofollow noreferrer\">play.golang.org/p/VWs_VNzhGcK</a> and returns a <code>rsa.PrivateKey</code>"}, {"owner": {"reputation": 81, "user_id": 6329540, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yOBR7.jpg?s=128&g=1", "display_name": "Urko", "link": "https://stackoverflow.com/users/6329540/urko"}, "edited": false, "score": 1, "creation_date": 1608109912, "post_id": 55476164, "comment_id": 115479549, "body": "I had an issue when I pasted pem content on string and my editor add tab. This made ssh.ParseRawPrivateKey fails. I took me a while to realize tabulations"}], "tags": [], "owner": {"reputation": 444, "user_id": 7918749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r9BIg.jpg?s=128&g=1", "display_name": "Black_Dreams", "link": "https://stackoverflow.com/users/7918749/black-dreams"}, "is_accepted": false, "score": 0, "last_activity_date": 1554212118, "creation_date": 1554212118, "answer_id": 55476164, "question_id": 55470311, "link": "https://stackoverflow.com/questions/55470311/encode-private-key-getting-error-asn1-structure-error-tags-dont-match/55476164#55476164", "title": "Encode Private Key getting Error: asn1: structure error: tags don&#39;t match", "body": "<p>I post the test private key and the code which I used</p>\n\n<p>Sample private key:</p>\n\n<pre><code>-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn\nNhAAAAAwEAAQAAAQEA4if4vmEnNh2Ijlfrhsb02Exh+LXjkYySOiILtj8rg1ZGWFz1vtPe\nDiKbbWLo9xcjDp7UQ2gHnhUZno/gFxcokzTYTkexpb/s4mzU4CH0XaS7IV/xRz1Of1+dwC\n2MvsclD0NKceyNu0glocGUu6w2MMsWdevr8YqjPABZYwPmANg5wns61FoI5uQi4e6pcNkr\ngGnbf1Sh8DChuM22aLksmOW9UapEKovaUxA4DxEd58zJpmg7UN1ZduUrwCVz1tg1BF+EW5\nknMd037olDWdgZtEzMxbmSRlqF6t5dcybnp7LQsdPrbXDubY3mjqgCg25xMk4of3mdDc5b\nVcRuNSbDmwAAA+AnwUz5J8FM+QAAAAdzc2gtcnNhAAABAQDiJ/i+YSc2HYiOV+uGxvTYTG\nH4teORjJI6Igu2PyuDVkZYXPW+094OIpttYuj3FyMOntRDaAeeFRmej+AXFyiTNNhOR7Gl\nv+zibNTgIfRdpLshX/FHPU5/X53ALYy+xyUPQ0px7I27SCWhwZS7rDYwyxZ16+vxiqM8AF\nljA+YA2DnCezrUWgjm5CLh7qlw2SuAadt/VKHwMKG4zbZouSyY5b1RqkQqi9pTEDgPER3n\nzMmmaDtQ3Vl25SvAJXPW2DUEX4RbmScx3TfuiUNZ2Bm0TMzFuZJGWoXq3l1zJuenstCx0+\nttcO5tjeaOqAKDbnEyTih/eZ0NzltVxG41JsObAAAAAwEAAQAAAQBUyVuONGo49ZWOmBOq\n8cg1l11bmwV4OdVQihcN+lzb3mp9EkzngBLOBddziROCH2B7SLyXkNbaQ1rZgWMoBPynQ7\nacknBdjbjHormkVdaBjRLDDm8soCVfx38i33DWzV5tfHLahy8TuZayMBsMySF/5YPELfDF\nG47bHd5lKr7+LV3T4kvZ1g1UpDgUGlwpVMpu+ybfhMhCOO2w5Vz/Fl7ptYJQnx8rDARgYu\nGDf1yKpRCt7Rx4U+lla5HMnoxh4/g5dXDb8vBDfC/QXj+DPY2/Ju5c3zifryfkB2Cvppq2\nEULxDO41iwXgzRpmv9hv6adSp2Qqob72XDu7mWdz/u9BAAAAgFDu2TKaU71igLIMd4sheb\nwzjsB2ZW8x5CO+N95OKddkC6lkJiBFrAiF98SVs0AFbqDlw46V3xrBqCVL6ByfW4Zro3Qw\nC9GRhjfW/koyuJbplf0uiNaa1ApM7nRoRiOcE5kXkLOObxojPuur29rbI1JGozSn6YhxwA\nQ3WthgQipmAAAAgQD7RXYeHQ1P0gpdpWfMXspIbkzODWQDH3VkvQHFFl87+QpsFIWGd8zX\njMMo2bELCgr9cnzRffd8UUCzWJy/mfj+PWjsCr9EaojlnDWYEComa5PYkJKKOxmN+rLg7P\nF3Xd/KV4XVBP5wqobTU1sxLnhJkVJMCqHOdDzv9mYr75sXqwAAAIEA5mmDj/4mvkNTNZKw\naaD/8sOz7JjD90jqQCchLETVcwJ1sCgPl5qVAa/S99g9QJXuW3TlXbj4jw01s5APpKq6eY\nH91+vJcS8ZmzARXMt4jVB3oWsrhFXw5BEaKYjyKx5gYdSGETbcGz1WxQF4i5E/A43ow73n\nRftprflPg+CUU9EAAAAkc3VtaXR0aGFrdXJAU3VtaXRzLU1hY0Jvb2stQWlyLmxvY2FsAQ\nIDBAUGBw==\n-----END OPENSSH PRIVATE KEY-----\n</code></pre>\n\n<p>Signed the constructed json string with business private key</p>\n\n<pre><code>func SignatureWithPrivateKey(data string) string {\n    signer, err := loadPrivateKey(\"/Users/sumitthakur/test\")\n    log.Println(\"Signer:\", signer)\n    if err != nil {\n        fmt.Errorf(\"signer is damaged: %v\", err)\n    }\n\n    toSign := data\n\n    signed, err := signer.Sign([]byte(toSign))\n    if err != nil {\n        fmt.Errorf(\"could not sign request: %v\", err)\n    }\n    return base64.StdEncoding.EncodeToString(signed)\n\n}\n</code></pre>\n\n<p>loadPrivateKey loads an parses a PEM encoded private key file.</p>\n\n<pre><code>func loadPrivateKey(path string) (Signer, error) {\n    data, err := ioutil.ReadFile(path)\n    if err != nil {\n        return nil, err\n    }\n    log.Println(\"Data and Error pem:\", data, err)\n    return parsePrivateKey(data)\n}\n</code></pre>\n\n<p>parses an encoded private key.</p>\n\n<pre><code>func parsePrivateKey(pemBytes []byte) (Signer, error) {\n    block, err := pem.Decode(pemBytes)\n    if block == nil {\n        return nil, errors.New(\"ssh: no key found\")\n    }\n\n    log.Println(\"Block and Error: \", block, err)\n\n    var rawkey interface{}\n    switch block.Type {\n    case \"OPENSSH PRIVATE KEY\":\n        log.Println(\"Here at OPENSSH Private Key:\")\n        rsa, err := ssh.ParseRawPrivateKey(block.Bytes)\n        log.Println(\"Rsa and Error:\", rsa, err)\n        if err != nil {\n            return nil, err\n        }\n        rawkey = rsa\n    default:\n        log.Println(\"Here at default\")\n        return nil, fmt.Errorf(\"ssh: unsupported key type %q\", block.Type)\n    }\n    return newSignerFromKey(rawkey)\n}\n\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 66, "user_id": 1440596, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c22d1968271e144f54eeb3070fa4ccea?s=128&d=identicon&r=PG", "display_name": "Gabor Szabad", "link": "https://stackoverflow.com/users/1440596/gabor-szabad"}, "is_accepted": true, "score": 5, "last_activity_date": 1588763872, "creation_date": 1588763872, "answer_id": 61633814, "question_id": 55470311, "link": "https://stackoverflow.com/questions/55470311/encode-private-key-getting-error-asn1-structure-error-tags-dont-match/61633814#61633814", "title": "Encode Private Key getting Error: asn1: structure error: tags don&#39;t match", "body": "<p>The problem is the key type. <code>OPENSSH PRIVATE KEY</code> should be parsed with <code>ssh.ParseRawPrivateKey</code>, whereas <code>RSA PRIVATE KEY</code> can be parsed with both <code>ssh.ParseRawPrivateKey</code> and <code>x509.ParsePKCS1PrivateKey</code>.</p>\n\n<p>You can generate <code>RSA PRIVATE KEY</code> with e.g. <code>ssh-keygen -t rsa -f key.pem -m pem</code> (<strong>-m pem</strong> here is important) or <code>openssl genrsa -out key.pem</code>, and test it with <code>openssl rsa -check -in key.pem</code>.</p>\n\n<p>So just do a block type check and use the corresponding functions in the case clauses to parse the key.</p>\n\n<p>Also think about key encryption, which means you might need to use <code>ssh.ParseRawPrivateKeyWithPassphrase</code> or <code>x509.IsEncryptedPEMBlock</code> and <code>x509.DecryptPEMBlock</code> functions too.</p>\n"}], "owner": {"reputation": 444, "user_id": 7918749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r9BIg.jpg?s=128&g=1", "display_name": "Black_Dreams", "link": "https://stackoverflow.com/users/7918749/black-dreams"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6281, "favorite_count": 3, "accepted_answer_id": 61633814, "answer_count": 2, "score": 4, "last_activity_date": 1588763872, "creation_date": 1554194179, "last_edit_date": 1554277575, "question_id": 55470311, "link": "https://stackoverflow.com/questions/55470311/encode-private-key-getting-error-asn1-structure-error-tags-dont-match", "title": "Encode Private Key getting Error: asn1: structure error: tags don&#39;t match", "body": "<p>When i try to parses the encode private key with</p>\n\n<p>sample private key</p>\n\n<pre><code>-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn\nNhAAAAAwEAAQAAAQEA4if4vmEnNh2Ijlfrhsb02Exh+LXjkYySOiILtj8rg1ZGWFz1vtPe\nDiKbbWLo9xcjDp7UQ2gHnhUZno/gFxcokzTYTkexpb/s4mzU4CH0XaS7IV/xRz1Of1+dwC\n2MvsclD0NKceyNu0glocGUu6w2MMsWdevr8YqjPABZYwPmANg5wns61FoI5uQi4e6pcNkr\ngGnbf1Sh8DChuM22aLksmOW9UapEKovaUxA4DxEd58zJpmg7UN1ZduUrwCVz1tg1BF+EW5\nknMd037olDWdgZtEzMxbmSRlqF6t5dcybnp7LQsdPrbXDubY3mjqgCg25xMk4of3mdDc5b\nVcRuNSbDmwAAA+AnwUz5J8FM+QAAAAdzc2gtcnNhAAABAQDiJ/i+YSc2HYiOV+uGxvTYTG\nH4teORjJI6Igu2PyuDVkZYXPW+094OIpttYuj3FyMOntRDaAeeFRmej+AXFyiTNNhOR7Gl\nv+zibNTgIfRdpLshX/FHPU5/X53ALYy+xyUPQ0px7I27SCWhwZS7rDYwyxZ16+vxiqM8AF\nljA+YA2DnCezrUWgjm5CLh7qlw2SuAadt/VKHwMKG4zbZouSyY5b1RqkQqi9pTEDgPER3n\nzMmmaDtQ3Vl25SvAJXPW2DUEX4RbmScx3TfuiUNZ2Bm0TMzFuZJGWoXq3l1zJuenstCx0+\nttcO5tjeaOqAKDbnEyTih/eZ0NzltVxG41JsObAAAAAwEAAQAAAQBUyVuONGo49ZWOmBOq\n8cg1l11bmwV4OdVQihcN+lzb3mp9EkzngBLOBddziROCH2B7SLyXkNbaQ1rZgWMoBPynQ7\nacknBdjbjHormkVdaBjRLDDm8soCVfx38i33DWzV5tfHLahy8TuZayMBsMySF/5YPELfDF\nG47bHd5lKr7+LV3T4kvZ1g1UpDgUGlwpVMpu+ybfhMhCOO2w5Vz/Fl7ptYJQnx8rDARgYu\nGDf1yKpRCt7Rx4U+lla5HMnoxh4/g5dXDb8vBDfC/QXj+DPY2/Ju5c3zifryfkB2Cvppq2\nEULxDO41iwXgzRpmv9hv6adSp2Qqob72XDu7mWdz/u9BAAAAgFDu2TKaU71igLIMd4sheb\nwzjsB2ZW8x5CO+N95OKddkC6lkJiBFrAiF98SVs0AFbqDlw46V3xrBqCVL6ByfW4Zro3Qw\nC9GRhjfW/koyuJbplf0uiNaa1ApM7nRoRiOcE5kXkLOObxojPuur29rbI1JGozSn6YhxwA\nQ3WthgQipmAAAAgQD7RXYeHQ1P0gpdpWfMXspIbkzODWQDH3VkvQHFFl87+QpsFIWGd8zX\njMMo2bELCgr9cnzRffd8UUCzWJy/mfj+PWjsCr9EaojlnDWYEComa5PYkJKKOxmN+rLg7P\nF3Xd/KV4XVBP5wqobTU1sxLnhJkVJMCqHOdDzv9mYr75sXqwAAAIEA5mmDj/4mvkNTNZKw\naaD/8sOz7JjD90jqQCchLETVcwJ1sCgPl5qVAa/S99g9QJXuW3TlXbj4jw01s5APpKq6eY\nH91+vJcS8ZmzARXMt4jVB3oWsrhFXw5BEaKYjyKx5gYdSGETbcGz1WxQF4i5E/A43ow73n\nRftprflPg+CUU9EAAAAkc3VtaXR0aGFrdXJAU3VtaXRzLU1hY0Jvb2stQWlyLmxvY2FsAQ\nIDBAUGBw==\n-----END OPENSSH PRIVATE KEY-----\n</code></pre>\n\n<pre><code> x509.ParsePKCS1PrivateKey(block.Bytes)\n</code></pre>\n\n<p>it will giving me error \nExplain: </p>\n\n<pre><code>case \"OPENSSH PRIVATE KEY\":\n        log.Println(\"Here at OPENSSH Private Key:\")\n        rsa, err := x509.ParsePKCS1PrivateKey(block.Bytes)\n        log.Println(\"Rsa and Error:\", rsa, err)\n        if err != nil {\n            return nil, err\n        }\n        rawkey = rsa\n</code></pre>\n\n<p>key</p>\n\n<pre><code>-----BEGIN OPENSSH PRIVATE KEY-----\nkey\n-----END OPENSSH PRIVATE KEY-----\n</code></pre>\n\n<p>Getting Error: </p>\n\n<pre><code>asn1: structure error: tags don't match (16 vs {class:1 tag:15 length:112 isCompound:true}) {optional:false explicit:false application:false private:false defaultValue:&lt;nil&gt; tag:&lt;nil&gt; stringType:0 timeType:0 set:false omitEmpty:false} pkcs1PrivateKey @2\n2019/04/02 13:57:52 Signer: &lt;nil&gt;\n</code></pre>\n\n<p>and I will also try with </p>\n\n<pre><code> x509.ParsePKCS8PrivateKey(block.Bytes)\n</code></pre>\n\n<p>But same Error getting. </p>\n"}, {"tags": ["docker", "go"], "answers": [{"tags": [], "owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "is_accepted": true, "score": 0, "last_activity_date": 1554209032, "creation_date": 1554209032, "answer_id": 55475114, "question_id": 55469444, "link": "https://stackoverflow.com/questions/55469444/where-is-the-code-of-containerd-runc-in-docker-ce/55475114#55475114", "title": "Where is the code of containerd/runc in docker-ce?", "body": "<p>Here's my own findings from a quick scan. The <a href=\"https://github.com/docker/docker-ce/blob/1cad3b08d5e4fc6068d34e72aa10df4a78189d13/components/engine/Makefile\" rel=\"nofollow noreferrer\">Makefile for components/engine</a> includes various steps, including a docker build.</p>\n\n<p>The <a href=\"https://github.com/docker/docker-ce/blob/1cad3b08d5e4fc6068d34e72aa10df4a78189d13/components/engine/Dockerfile\" rel=\"nofollow noreferrer\">Dockerfile</a> includes sections for containerd and runc:</p>\n\n<pre><code>FROM base AS containerd\nRUN apt-get update &amp;&amp; apt-get install -y btrfs-tools\nENV INSTALL_BINARY_NAME=containerd\nCOPY hack/dockerfile/install/install.sh ./install.sh\nCOPY hack/dockerfile/install/$INSTALL_BINARY_NAME.installer ./\nRUN PREFIX=/build/ ./install.sh $INSTALL_BINARY_NAME\n\nFROM runtime-dev AS runc\nENV INSTALL_BINARY_NAME=runc\nCOPY hack/dockerfile/install/install.sh ./install.sh\nCOPY hack/dockerfile/install/$INSTALL_BINARY_NAME.installer ./\nRUN PREFIX=/build/ ./install.sh $INSTALL_BINARY_NAME\n</code></pre>\n\n<p>Then in the hack folder for the dockerfile, there are scripts to install <a href=\"https://github.com/docker/docker-ce/blob/1cad3b08d5e4fc6068d34e72aa10df4a78189d13/components/engine/hack/dockerfile/install/containerd.installer\" rel=\"nofollow noreferrer\">containerd</a> and <a href=\"https://github.com/docker/docker-ce/blob/1cad3b08d5e4fc6068d34e72aa10df4a78189d13/components/engine/hack/dockerfile/install/runc.installer\" rel=\"nofollow noreferrer\">runc</a>.</p>\n\n<p>These scripts clone the repo and checkout specific commits from <a href=\"https://github.com/containerd/containerd\" rel=\"nofollow noreferrer\">containerd</a> and <a href=\"https://github.com/opencontainers/runc\" rel=\"nofollow noreferrer\">runc</a>'s upstream repos.</p>\n"}], "owner": {"reputation": 346, "user_id": 4476748, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/9411f33f09008556e0b6b5323f78fc35?s=128&d=identicon&r=PG&f=1", "display_name": "fding", "link": "https://stackoverflow.com/users/4476748/fding"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 1, "accepted_answer_id": 55475114, "answer_count": 1, "score": 0, "last_activity_date": 1554209032, "creation_date": 1554191174, "last_edit_date": 1554191759, "question_id": 55469444, "link": "https://stackoverflow.com/questions/55469444/where-is-the-code-of-containerd-runc-in-docker-ce", "title": "Where is the code of containerd/runc in docker-ce?", "body": "<p>I am trying to debug docker (including everything, <em>docker, dockerd, containerd, runc</em>), and have cloned source code from <em>github/docker/docker-ce</em>. </p>\n\n<p>Now I can locate the source code of:</p>\n\n<ul>\n<li><strong>docker</strong> (docker-cli): at components/cli</li>\n<li><strong>dockerd</strong>: at components/engine/daemon</li>\n</ul>\n\n<p>in repo of docker-ce and successfully <code>make</code> them. </p>\n\n<p>But I cannot find the code of <em>containerd</em> and <em>runc</em> in docker-ce repo, while there are binaries of them when <code>make</code> command is triggered.</p>\n\n<p>So where the binaries come from? </p>\n\n<p>I know there are repos of <em>containerd</em> and <em>runc</em>.</p>\n"}, {"tags": ["go", "race-condition"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1554190441, "post_id": 55469160, "comment_id": 97649574, "body": "&quot;has not created an object yet&quot; --- you don&#39;t have synchronisation in your code, so there is no &quot;happens-after&quot; relationship established between different parts of your code, hence you cannot reason about temporal aspects of events in runtime."}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554191735, "post_id": 55469160, "comment_id": 97650221, "body": "@Flimzy, because <code>NewObject1()</code> is creating/returning a new fresh object and it can&#39;t be used somewhere else before is created. <code>NewObject1()</code> is only creating it at that moment, isn&#39;t it?"}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1554191760, "post_id": 55469160, "comment_id": 97650237, "body": "If you think differently - please explain more technically detailed"}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554192096, "post_id": 55469160, "comment_id": 97650402, "body": "@Flimzy, yes, but goroutine shouldn&#39;t be able to read an object which is not created yet?! Question is about race condition. Step by step workflow in my mind - 1) list is empty. 2) you start to create new object1. 3) list is still empty. 4) you have created a new object and only then add it to the list. 5) only now list has 1 element. 6) reading happens. Where you see a race condition?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1554192247, "post_id": 55469160, "comment_id": 97650469, "body": "<a href=\"https://stackoverflow.com/questions/44152988/append-not-thread-safe\" title=\"append not thread safe\">stackoverflow.com/questions/44152988/append-not-thread-safe</a>"}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554192446, "post_id": 55469160, "comment_id": 97650569, "body": "@Flimzy, write your workflow which shows a race. Step by step. <code>yet</code> is BEFORE you add an element to the list"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1554192485, "post_id": 55469160, "comment_id": 97650583, "body": "@Alexey it does not happen BEFORE, but AFTER you added an element to the slice."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1554192525, "post_id": 55469160, "comment_id": 97650601, "body": "@mkopriva even if it was thread-safe there still would be a data race."}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1554192691, "post_id": 55469160, "comment_id": 97650665, "body": "@zerkms, you mean empty struct is created first, added to the list, and only after that it&#39;s fields are being filled/written??"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1554192774, "post_id": 55469160, "comment_id": 97650697, "body": "@Alexey you don&#39;t synchronise access to memory, there are no any guarantees. It makes no sense to discuss a data race: the behaviour is undefined and cannot be reasoned about."}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1554192974, "post_id": 55469160, "comment_id": 97650798, "body": "I just wish to understand. It seems that fields writing happens AFTER the struct is added to the list. Is that possible? Because I didn&#39;t want that in my code"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1554193017, "post_id": 55469160, "comment_id": 97650823, "body": "@Alexey you cannot tell when write <b>actually happened</b>"}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1554193110, "post_id": 55469160, "comment_id": 97650861, "body": "@zerkms, by &#39;it seems&#39; I mean what race detector shows. This is a little confusing"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1554193145, "post_id": 55469160, "comment_id": 97650879, "body": "@Alexey race detector only shows you have non-synchronised read and write operations. It tells nothing about whether any data was written there by that moment or not. It only checks memory addresses, it does not care about the actual operations progress."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1554193275, "post_id": 55469160, "comment_id": 97650930, "body": "@Alexey: just as zerkms says, data race situation is undefined behaviour. Anything can happen. From corrupted data to <a href=\"https://software.intel.com/en-us/blogs/2013/01/06/benign-data-races-what-could-possibly-go-wrong\" rel=\"nofollow noreferrer\">nuclear missile launch</a>. Synchronize your reads and writes."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 3, "creation_date": 1554193439, "post_id": 55469160, "comment_id": 97651035, "body": "@zerkms I was only trying to point out that rather than focusing on <code>NewObject1</code> and the <code>temp</code> variable assignments, the issue can be fixed by synchronizing the read/write of the slice. E.g. this <a href=\"https://play.golang.org/p/60bevT89WFf\" rel=\"nofollow noreferrer\">play.golang.org/p/60bevT89WFf</a> doesn&#39;t trigger the race messages."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1554193489, "post_id": 55469160, "comment_id": 97651069, "body": "Your proper work flow is: 1. list is empty. 2. read list anywhere from 0 to infinite times. 3. Simultaneously write to the list anywhere from 0 to infinite times. &lt;-- data race 4. jump to 2"}], "answers": [{"comments": [{"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1554193402, "post_id": 55469967, "comment_id": 97651008, "body": "Even if 1 hour is between writing the variable and reading it in different goroutines - race will be detected?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1554193481, "post_id": 55469967, "comment_id": 97651061, "body": "@Alexey race detector may have false negatives: it may not detect something. But yes, it still is a data race: if you don&#39;t synchronise the second goroutine is not guaranteed to ever see the changed values. The synchronisation happens by explicit CPU instructions (memory barriers) and has nothing to do with how long it passed between the operations."}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1554193686, "post_id": 55469967, "comment_id": 97651183, "body": "Didn&#39;t expect that. So with goroutines every single variable must be synchronized?! And I thought only pointers like slices/maps are dangerous"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 2, "creation_date": 1554193695, "post_id": 55469967, "comment_id": 97651192, "body": "@Alexey The thing is, if you start 2 goroutines, one creates a value (and stores it in a variable), the other sleeps 1 hour and attempts to read the value from variable, without synchronization, there is no guarantee the creation will happen before the read. The goroutine scheduler will do its best, but only synchronization gives guarantee, &quot;nothing&quot; else."}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1554193803, "post_id": 55469967, "comment_id": 97651252, "body": "@icza, I see now. Just didn&#39;t expect. However, I&#39;m sure Go will be able to do writing in 1 hour :)"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1554193866, "post_id": 55469967, "comment_id": 97651289, "body": "@Alexey also see the update with couple useful links"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 1, "creation_date": 1554193869, "post_id": 55469967, "comment_id": 97651290, "body": "@Alexey Yes, in practice the creation will not be delayed for an hour, but only synchronization gives guarantee. And race detector detects the lack of synchronization, the lack of guarantee."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1554193896, "post_id": 55469967, "comment_id": 97651314, "body": "It&#39;s not Go though: a CPU may decide to not synchronise caches. Go should cooperate with CPU, but CPU alone is free to do a lot of weird things"}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1554194273, "post_id": 55469967, "comment_id": 97651506, "body": "Probably last question, about the lack of guarantee to confirm - does this mean, that in my demo code I can get a situation, when the list already contains an <code>Object1</code>, but it&#39;s <code>object.A</code> is still <code>0</code>?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1554194418, "post_id": 55469967, "comment_id": 97651591, "body": "@Alexey I&#39;d say any value might be there: imagine a situation when memory was already allocated but was not initialised yet."}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1554194605, "post_id": 55469967, "comment_id": 97651674, "body": "You mean it could contain any bytes from previous object which was located at the same memory space?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1554194634, "post_id": 55469967, "comment_id": 97651690, "body": "@Alexey yep, why not. Most likely operations would not be reordered SO dramatically, but theoretically - why not :shrug:"}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1554194717, "post_id": 55469967, "comment_id": 97651738, "body": "My world was changed today, at least a little, thanks!"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1554194763, "post_id": 55469967, "comment_id": 97651763, "body": "@Alexey check the Jeff Preshing&#39;s blog (#1 in the answer). A lot of articles there cover low level CPU &amp; Memory interactions, it&#39;s a very entertaining reading."}], "tags": [], "owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "is_accepted": true, "score": 5, "last_activity_date": 1554193852, "last_edit_date": 1554193852, "creation_date": 1554193060, "answer_id": 55469967, "question_id": 55469160, "link": "https://stackoverflow.com/questions/55469160/race-condition-for-not-yet-existing-object/55469967#55469967", "title": "Race condition for not yet existing object", "body": "<p>Race detector detects that you concurrently read and write the same address in memory.</p>\n\n<p>It is by definition a data race.</p>\n\n<p>It does not matter when data was actually put to that address (and whether it was put there at all). What only matters is that you access the same memory in different goroutines without synchronisation, and one of those operations is a \"write\".</p>\n\n<p>Both are not about Go, but are extremely quality resources:</p>\n\n<ol>\n<li><a href=\"https://preshing.com/20120710/memory-barriers-are-like-source-control-operations/\" rel=\"nofollow noreferrer\">https://preshing.com/20120710/memory-barriers-are-like-source-control-operations/</a> - this and basically every other article in that blog is a gem.</li>\n<li><a href=\"http://deadlockempire.github.io/\" rel=\"nofollow noreferrer\">http://deadlockempire.github.io/</a> - a puzzle-like game that reveals nuances of synchronisation and concurrency issues</li>\n</ol>\n"}], "owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 55469967, "answer_count": 1, "score": 0, "last_activity_date": 1554193852, "creation_date": 1554190159, "last_edit_date": 1554192333, "question_id": 55469160, "link": "https://stackoverflow.com/questions/55469160/race-condition-for-not-yet-existing-object", "title": "Race condition for not yet existing object", "body": "<p>I've a strange race condition. The problem is that it occurs inside an object which is not existing yet.</p>\n\n<p>Here is a demo code:</p>\n\n<pre><code>package main\n\nimport (\n    //\"fmt\"\n    \"time\"\n)\n\ntype Object1 struct {\n    A int\n    B string\n    C []int\n    D *Object2\n}\n\ntype Object2 struct {\n    A int\n}\n\nfunc NewObject1() *Object1 {\n    return &amp;Object1{\n        A: 1,\n        B: \"abc\",\n        C: []int{0, 1},\n        D: &amp;Object2{},\n    }\n}\n\nfunc main() {\n    list := []*Object1{}\n\n    tempA := 0\n    tempB := \"\"\n    tempC := []int{}\n    tempD := &amp;Object2{}\n\n    go func() {\n        for {\n            for _, object := range list {\n                tempA = object.A\n                tempB = object.B\n                tempC = object.C\n                tempD = object.D\n            }\n        }\n    }()\n\n    for {\n        list = append(list, NewObject1())\n\n        //fmt.Println(\"list\", list)\n        time.Sleep(1 * time.Second)\n    }\n}\n</code></pre>\n\n<p>If I run it with the <code>-race</code> flag - I get the warnings:</p>\n\n<pre><code>WARNING: DATA RACE\nRead at 0x00c000094040 by goroutine 5:\n  main.main.func1()\n      /tmp/race.go:39 +0x84\n\nPrevious write at 0x00c000094040 by main goroutine:\n  main.main()\n      /tmp/race.go:21 +0x2a9\n\nGoroutine 5 (running) created at:\n  main.main()\n      /tmp/race.go:36 +0x276\n==================\n==================\nWARNING: DATA RACE\nRead at 0x00c000094048 by goroutine 5:\n  main.main.func1()\n      /tmp/race.go:40 +0xbe\n\nPrevious write at 0x00c000094048 by main goroutine:\n  main.main()\n      /tmp/race.go:22 +0x2ca\n\nGoroutine 5 (running) created at:\n  main.main()\n      /tmp/race.go:36 +0x276\n==================\n==================\nWARNING: DATA RACE\nRead at 0x00c000094058 by goroutine 5:\n  main.main.func1()\n      /tmp/race.go:41 +0x118\n\nPrevious write at 0x00c000094058 by main goroutine:\n  main.main()\n      /tmp/race.go:23 +0x341\n\nGoroutine 5 (running) created at:\n  main.main()\n      /tmp/race.go:36 +0x276\n==================\n==================\nWARNING: DATA RACE\nRead at 0x00c000094070 by goroutine 5:\n  main.main.func1()\n      /tmp/race.go:42 +0x180\n\nPrevious write at 0x00c000094070 by main goroutine:\n  main.main()\n      /tmp/race.go:24 +0x3b8\n\nGoroutine 5 (running) created at:\n  main.main()\n      /tmp/race.go:36 +0x276\n==================\n</code></pre>\n\n<p>But how is that possible? Reading happens inside a goroutine and writing inside a <code>NewObject1()</code>. 4 errors for every <code>Object1</code> field. <code>NewObject1()</code> has not created an object yet to append it to the <code>list</code> slice. So <code>list</code> during the reading should be empty or filled with a normal completed objects.</p>\n\n<p>Step by step workflow in my mind:</p>\n\n<ol>\n<li>list is empty;</li>\n<li>you start to create new <code>object1</code>;</li>\n<li>list is still empty;</li>\n<li>you have created a new object and only then add it to the list;</li>\n<li>only now list has 1 element;</li>\n<li>reading happens.</li>\n</ol>\n\n<p>I don't see a race condition here. If you think differently - please show your own workflow of how things happens.</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1554183325, "post_id": 55467083, "comment_id": 97646285, "body": "Try <code>go -mod=readonly mod vendor</code>."}, {"owner": {"reputation": 2971, "user_id": 496351, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/ce4ddeab530fecaf1270a1bf5cccea90?s=128&d=identicon&r=PG", "display_name": "Tristian", "link": "https://stackoverflow.com/users/496351/tristian"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1554183394, "post_id": 55467083, "comment_id": 97646307, "body": "Thank you; will do had found this document: <a href=\"https://github.com/thepudds/go-module-knobs/blob/master/README.md\" rel=\"nofollow noreferrer\">github.com/thepudds/go-module-knobs/blob/master/README.md</a> but it only mentions that that flag applies to <code>go build</code>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1554183873, "post_id": 55467083, "comment_id": 97646476, "body": "<code>go mod</code> used to ignore the <code>-mod</code> flag. I&#39;m not sure if that changed by now."}], "answers": [{"tags": [], "owner": {"reputation": 748, "user_id": 1645024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4835a765a5fb1547008d916a5165a702?s=128&d=identicon&r=PG", "display_name": "bcmills", "link": "https://stackoverflow.com/users/1645024/bcmills"}, "is_accepted": false, "score": 1, "last_activity_date": 1564770963, "creation_date": 1564770963, "answer_id": 57331859, "question_id": 55467083, "link": "https://stackoverflow.com/questions/55467083/go-mod-vendor-without-update-to-latest/57331859#57331859", "title": "go mod vendor without update to latest", "body": "<p>Per <a href=\"https://tip.golang.org/cmd/go/#hdr-Maintaining_module_requirements\" rel=\"nofollow noreferrer\">https://tip.golang.org/cmd/go/#hdr-Maintaining_module_requirements</a>:</p>\n\n<blockquote>\n  <p>The <code>go</code> command itself automatically updates the <code>go.mod</code> file to maintain a standard formatting and the accuracy of <code>require</code> statements.</p>\n  \n  <p>Any go command that finds an unfamiliar import will look up the module containing that import and add the latest version of that module to go.mod automatically. [\u2026]</p>\n  \n  <p>Any go command can determine that a module requirement is missing and must be added [\u2026].</p>\n</blockquote>\n\n<p>The <code>go mod vendor</code> command copies in all of the transitive imports of your packages and their tests, so it will automatically update the <code>go.mod</code> file to ensure that all of the imported packages are present.</p>\n\n<p>So the problem here is likely that the <code>commit</code> you've selected for <code>package/subpackage</code> fails to provide some package that appears in the transitive imports of your program. If that is correct, you should find that <code>go list all</code>, <code>go test all</code>, and <code>go mod tidy</code> all make that same edit to your module's requirements.</p>\n"}], "owner": {"reputation": 2971, "user_id": 496351, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/ce4ddeab530fecaf1270a1bf5cccea90?s=128&d=identicon&r=PG", "display_name": "Tristian", "link": "https://stackoverflow.com/users/496351/tristian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9115, "favorite_count": 2, "answer_count": 1, "score": 4, "last_activity_date": 1564770963, "creation_date": 1554180152, "question_id": 55467083, "link": "https://stackoverflow.com/questions/55467083/go-mod-vendor-without-update-to-latest", "title": "go mod vendor without update to latest", "body": "<p>I\u2019m trying to figure out if it\u2019s possible to run go mod vendor without the go tool updating my go.mod file.</p>\n\n<p>I specifically <code>go get package/subpackage@commit</code> and commit my <code>go.mod</code> with the correct version.</p>\n\n<p>Then I run <code>go mod vendor</code> and it automatically bumps the version of the package that I just specifically set.</p>\n\n<p>I\u2019ve looked at this page to no avail: <a href=\"https://github.com/golang/go/wiki/Modules#how-do-i-use-vendoring-with-modules-is-vendoring-going-away\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/Modules#how-do-i-use-vendoring-with-modules-is-vendoring-going-away</a></p>\n\n<p>I need to use vendor because I run a script that edits some of the vendored deps., I\u2019m looking at the following build flow:</p>\n\n<pre><code>GO111MODULE=on go get package/subpackge@commit\nGO111MODULE=on go mod vendor\n./Script/patch_vendors.sh --write\nGO111MODULE=off go build\n</code></pre>\n\n<p>My other option is modifying the copied source wherever go mod vendor donwloads it to, but\nnot sure how to approach that.</p>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["go", "fips", "boringssl"], "answers": [{"tags": [], "owner": {"reputation": 61, "user_id": 1437822, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PAcDk.png?s=128&g=1", "display_name": "rharris", "link": "https://stackoverflow.com/users/1437822/rharris"}, "is_accepted": false, "score": 3, "last_activity_date": 1566402357, "creation_date": 1566402357, "answer_id": 57595241, "question_id": 55466891, "link": "https://stackoverflow.com/questions/55466891/verify-fips-mode-in-golang-boringssl/57595241#57595241", "title": "Verify FIPS mode in golang boringssl", "body": "<p>From this file:</p>\n\n<p><a href=\"https://go.googlesource.com/go/+/dev.boringcrypto/src/crypto/tls/fipsonly/fipsonly.go\" rel=\"nofollow noreferrer\">https://go.googlesource.com/go/+/dev.boringcrypto/src/crypto/tls/fipsonly/fipsonly.go</a></p>\n\n<pre><code>// Package fipsonly restricts all TLS configuration to FIPS-approved settings.\n//\n// The effect is triggered by importing the package anywhere in a program, as in:\n//\n//  import _ \"crypto/tls/fipsonly\"\n//\n// This package only exists in the dev.boringcrypto branch of Go.\n</code></pre>\n\n<p>By including that import statement in your program, it will only compile if you're  using the dev.boringcrypto branch.</p>\n\n<p>Here's a test main.go:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    _ \"crypto/tls/fipsonly\"\n)\n\nfunc main() {\n    fmt.Println(\"Hello FIPS\")\n}\n</code></pre>\n\n<p>Using the dev.boringcrypto branch of Go:</p>\n\n<pre><code>$ go version\ngo version go1.12.9b4 linux/amd64\n$ go run main.go\nHello FIPS\n</code></pre>\n\n<p>Using the normal release of Go:</p>\n\n<pre><code>$ go version\ngo version go1.12.9 darwin/amd64\n$ go run main.go\nmain.go:4:2: cannot find package \"crypto/tls/fipsonly\" in any of:\n    /Users/ray/.gimme/versions/go1.12.9.darwin.amd64/src/crypto/tls/fipsonly (from $GOROOT)\n    /Users/ray/go/src/crypto/tls/fipsonly (from $GOPATH)\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 10786697, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a0dfa7002dbefde4f89e3602b61713f?s=128&d=identicon&r=PG&f=1", "display_name": "Akshay Khurd", "link": "https://stackoverflow.com/users/10786697/akshay-khurd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1326, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566402357, "creation_date": 1554178636, "question_id": 55466891, "link": "https://stackoverflow.com/questions/55466891/verify-fips-mode-in-golang-boringssl", "title": "Verify FIPS mode in golang boringssl", "body": "<p>how to verify if fips mode is enabled for binary in golang dev boring crypto branch ?\nI dont see an easy way apart from internal golang tests</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 49, "user_id": 1807905, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/eba63caa81e3de596cb574163753d68a?s=128&d=identicon&r=PG", "display_name": "Oavatog", "link": "https://stackoverflow.com/users/1807905/oavatog"}, "reply_to_user": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 0, "creation_date": 1554179766, "post_id": 55466662, "comment_id": 97645378, "body": "No. In some cases there are many more but the format is always the same.  k:v[space]k:v[space] etc. I wouldn&#39;t rely on the order of these either."}, {"owner": {"reputation": 49, "user_id": 1807905, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/eba63caa81e3de596cb574163753d68a?s=128&d=identicon&r=PG", "display_name": "Oavatog", "link": "https://stackoverflow.com/users/1807905/oavatog"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1554282341, "post_id": 55466662, "comment_id": 97689874, "body": "Thank you @WiktorStribi\u017cew!"}], "answers": [{"comments": [{"owner": {"reputation": 49, "user_id": 1807905, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/eba63caa81e3de596cb574163753d68a?s=128&d=identicon&r=PG", "display_name": "Oavatog", "link": "https://stackoverflow.com/users/1807905/oavatog"}, "edited": false, "score": 1, "creation_date": 1554182743, "post_id": 55467303, "comment_id": 97646087, "body": "This seems to work great!  I&#39;m going to go away and test it aginst some larger datasets ."}, {"owner": {"reputation": 49, "user_id": 1807905, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/eba63caa81e3de596cb574163753d68a?s=128&d=identicon&r=PG", "display_name": "Oavatog", "link": "https://stackoverflow.com/users/1807905/oavatog"}, "edited": false, "score": 0, "creation_date": 1554183319, "post_id": 55467303, "comment_id": 97646283, "body": "Okay I have tested your solution with a larger data set and it failed to collect larger data sets that ended with string values. Ammended slightly <a href=\"https://play.golang.org/p/aF9DPBPmNsA\" rel=\"nofollow noreferrer\">here</a>.  Appends <code>|[\\\\w+$]</code> to the end."}, {"owner": {"reputation": 40086, "user_id": 499581, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1ba2cebc4582467916f2ddd6128447f4?s=128&d=identicon&r=PG", "display_name": "l&#39;L&#39;l", "link": "https://stackoverflow.com/users/499581/lll"}, "reply_to_user": {"reputation": 49, "user_id": 1807905, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/eba63caa81e3de596cb574163753d68a?s=128&d=identicon&r=PG", "display_name": "Oavatog", "link": "https://stackoverflow.com/users/1807905/oavatog"}, "edited": false, "score": 0, "creation_date": 1554183524, "post_id": 55467303, "comment_id": 97646356, "body": "So with your amendment did it work? It looked like all the keys and values were in the output."}, {"owner": {"reputation": 49, "user_id": 1807905, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/eba63caa81e3de596cb574163753d68a?s=128&d=identicon&r=PG", "display_name": "Oavatog", "link": "https://stackoverflow.com/users/1807905/oavatog"}, "edited": false, "score": 0, "creation_date": 1554188040, "post_id": 55467303, "comment_id": 97648305, "body": "Yeah. With the ammendment It works great! Thank you so much. I was in a bit of a rut."}, {"owner": {"reputation": 40086, "user_id": 499581, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1ba2cebc4582467916f2ddd6128447f4?s=128&d=identicon&r=PG", "display_name": "l&#39;L&#39;l", "link": "https://stackoverflow.com/users/499581/lll"}, "reply_to_user": {"reputation": 49, "user_id": 1807905, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/eba63caa81e3de596cb574163753d68a?s=128&d=identicon&r=PG", "display_name": "Oavatog", "link": "https://stackoverflow.com/users/1807905/oavatog"}, "edited": false, "score": 0, "creation_date": 1554188678, "post_id": 55467303, "comment_id": 97648667, "body": "You\u2019re welcome! Well, you can accept the answer, you get rep for that."}], "tags": [], "owner": {"reputation": 40086, "user_id": 499581, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1ba2cebc4582467916f2ddd6128447f4?s=128&d=identicon&r=PG", "display_name": "l&#39;L&#39;l", "link": "https://stackoverflow.com/users/499581/lll"}, "is_accepted": false, "score": 1, "last_activity_date": 1554181623, "creation_date": 1554181623, "answer_id": 55467303, "question_id": 55466662, "link": "https://stackoverflow.com/questions/55466662/golang-regex-keyvalue-issue/55467303#55467303", "title": "golang regex key:value issue", "body": "<p>Maybe try the following pattern:</p>\n\n<pre><code>(\\\\s*[^\\\\s]+)=([^=]*[\\\\w\\\\d]+\\\\s|[\\\\d.]+)\n</code></pre>\n\n<p><strong>Result</strong>:</p>\n\n<pre><code>start: Mar 26 2019 10:36:14 +00:00 \nend: Mar 26 2019 10:36:14 +00:00 \nsuser: AD.COM\\\\Username \nsrc: 10.1.0.51\n</code></pre>\n\n<p><strong>Example</strong>:</p>\n\n<p><a href=\"https://play.golang.org/p/R8rE_GGZF_W\" rel=\"nofollow noreferrer\">https://play.golang.org/p/R8rE_GGZF_W</a></p>\n"}, {"tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 3, "last_activity_date": 1554188749, "creation_date": 1554188749, "answer_id": 55468803, "question_id": 55466662, "link": "https://stackoverflow.com/questions/55466662/golang-regex-keyvalue-issue/55468803#55468803", "title": "golang regex key:value issue", "body": "<p>You may use</p>\n\n<pre><code> var rex = regexp.MustCompile(`(\\w+)=([^=]*\\w)(?:\\s|$)`)\n</code></pre>\n\n<p>See the <a href=\"https://play.golang.org/p/O3_SecvoZo3\" rel=\"nofollow noreferrer\">Go demo</a>, the <a href=\"https://regex101.com/r/dUd1B8/1\" rel=\"nofollow noreferrer\">regex demo online</a> and the <a href=\"https://jex.im/regulex/#!flags=&amp;re=(%5Cw%2B)%3D(%5B%5E%3D%5D*%5Cw)(%3F%3A%5Cs%7C%24)\" rel=\"nofollow noreferrer\">Regulex graph</a>.</p>\n\n<p><a href=\"https://i.stack.imgur.com/BgaTr.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/BgaTr.png\" alt=\"enter image description here\"></a></p>\n\n<p><strong>Regex details</strong></p>\n\n<ul>\n<li><code>(\\w+)</code> - Capturing group 1: one or more word chars</li>\n<li><code>=</code> - a <code>=</code> char</li>\n<li><code>([^=]*\\w)</code> - Capturing group 2: any 0+ chars other than <code>=</code> and then a word char</li>\n<li><code>(?:\\s|$)</code> - either a whitespace or end of string.</li>\n</ul>\n"}], "owner": {"reputation": 49, "user_id": 1807905, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/eba63caa81e3de596cb574163753d68a?s=128&d=identicon&r=PG", "display_name": "Oavatog", "link": "https://stackoverflow.com/users/1807905/oavatog"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "accepted_answer_id": 55468803, "answer_count": 2, "score": 0, "last_activity_date": 1554188749, "creation_date": 1554176604, "last_edit_date": 1554179442, "question_id": 55466662, "link": "https://stackoverflow.com/questions/55466662/golang-regex-keyvalue-issue", "title": "golang regex key:value issue", "body": "<p>I'm trying to split a syslog message into a key:value 'map[string]string', but cannot seem to get the regex right.</p>\n\n<p>The source string delimits its keys and values by an '='. However, each pair is seperated by spaces with spaces actually being within the values. I have it pretty close but as you can see from the link below, I can't get the rest of the 'start', 'end', or 'suser' values.</p>\n\n<p>Here's <a href=\"https://play.golang.org/p/7qvmTS3My58\" rel=\"nofollow noreferrer\">a link</a> to a golang playground showing my exact problem:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nvar rex = regexp.MustCompile(\"(\\\\w+)=(.+?[^\\\\\\\\s\\\\\\\\w+=]+)\")\n\nfunc main() {\n    conn := \"start=Mar 26 2019 10:36:14 +00:00 end=Mar 26 2019 10:36:14 +00:00 suser=AD.COM\\\\\\\\Username src=10.1.0.51\"\n    data := rex.FindAllStringSubmatch(conn, -1)\n\n    res := make(map[string]string)\n    for _, kv := range data {\n        k := kv[1]\n        v := kv[2]\n        res[k] = v\n    }\n    for v := range res {fmt.Printf(\"%s: %v\\n\", v, res[v])}\n\n}\n</code></pre>\n"}, {"tags": ["json", "postgresql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1554171918, "post_id": 55465794, "comment_id": 97643730, "body": "The type definition of <code>Item</code>is missing."}, {"owner": {"reputation": 127, "user_id": 6452632, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-4Fw7DAFDuxk/AAAAAAAAAAI/AAAAAAAAA_o/D8lXJ3x6YUw/photo.jpg?sz=128", "display_name": "Yasin Shuman", "link": "https://stackoverflow.com/users/6452632/yasin-shuman"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1554176542, "post_id": 55465794, "comment_id": 97644729, "body": "thanks for catching that @MarkusWMahlberg, I&#39;ve edited to add it in"}], "owner": {"reputation": 127, "user_id": 6452632, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-4Fw7DAFDuxk/AAAAAAAAAAI/AAAAAAAAA_o/D8lXJ3x6YUw/photo.jpg?sz=128", "display_name": "Yasin Shuman", "link": "https://stackoverflow.com/users/6452632/yasin-shuman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 112, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1554230654, "creation_date": 1554169428, "last_edit_date": 1554230654, "question_id": 55465794, "link": "https://stackoverflow.com/questions/55465794/how-to-prevent-an-array-from-being-embedded-into-another-array-in-my-json-respon", "title": "How to prevent an array from being embedded into another array in my json response", "body": "<p>In my api server I return a json object which has string arrays in it. I am finding that my arrays are being embedded into another array like this:</p>\n\n<pre><code>           \"Items\": [\n                \"[\\\"QQTISGXSJIS4DEV36JCBWQ4X\\\", \\\"HCOWEB7NVIQEUAINMM2KUV6J\\\", \\\"FCKP7D3H6Q7RQIRKSPVZBRHL\\\", \\\"UQLVH65PPBTVK6KMIV5KMGY6\\\", \\\"UR2XTXJFVURE5ERBLNW7ZUCR\\\", \\\"75N66F4DYGPM57V47N3IBMKD\\\", \\\"HQ2CRXQFPQM7TNNDZXZ2MQ2B\\\", \\\"3SLGKFR5GPHVZMQM4YM6KI4U\\\", \\\"UCQ3J7GYAYPZOCQKWIRGNGNY\\\", \\\"6INWDYWUFX6L5JYX2HEVMMHX\\\", \\\"ASQBRMKYSK2TINHBYQIWATS5\\\", \\\"QPCHVJ4HXYTUJNEZWQCKM5I3\\\", \\\"7JPYYH64Y3FQK6YJX5NBXMM6\\\", \\\"BI4NIBBOFBYAAS7ZROD6XEMB\\\", \\\"RGU3X36VYMXX4N3XPEZKY76K\\\", \\\"PLHVIQ7QT6TBWI5BZX6EJI74\\\", \\\"YATHGR6W6BIKFYXVZMGVBRB4\\\", \\\"ZZ5KZ5ZSBVLQRDKR2SJQ5CXW\\\", \\\"TNH56AOIMFSLOX5AW5I6WYP2\\\", \\\"VIFSURNJWJ6YYKXIWTWRNY6F\\\"]\"\n            ]\n</code></pre>\n\n<p>You can a complete JSON object here: <a href=\"https://gist.github.com/yshuman1/31b39333e2cd187707d98817171c3914\" rel=\"nofollow noreferrer\">https://gist.github.com/yshuman1/31b39333e2cd187707d98817171c3914</a></p>\n\n<p>I am using gorm and saving my array as pq.StringArray.</p>\n\n<p>Here is my function that returns that json:</p>\n\n<pre><code>func (u *Users) RetrieveItemCatModSort(w http.ResponseWriter, r *http.Request) {\n    var l model.ItemCatModSort\n    type data struct {\n        Email    string\n        Password string\n        Location string\n    }\n    var form data\n    if err := parseForm(r, &amp;form); err != nil {\n        log.Infof(\"error parsing form for logging in Kiosk %v\", err)\n        return\n    }\n    user, err := u.us.ByEmail(string(form.Email))\n    if err != nil {\n        log.Infof(\"error looking up user by email while retrieving items %v\", err)\n        return\n    }\n    bcrypt.CompareHashAndPassword([]byte(user.KioskPwHash), []byte(form.Password))\n    if err != nil {\n        log.Infof(\"invalid login credentials error: %v submitted data:\\n%#v\", err, form)\n        w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n        w.WriteHeader(422) // unprocessable entity\n        if err := json.NewEncoder(w).Encode(err); err != nil {\n            panic(err)\n        }\n    }\n\n    //lookup oauth token in DB\n    token, err := u.os.Find(user.ID, \"square\")\n    if err != nil {\n        fmt.Println(err)\n    }\n    l.LocationID = form.Location\n\n    l.Modifiers, err = pos.GetModifiers(token.AccessToken, l.LocationID)\n    if err != nil {\n        log.Infof(\"Error grabbing modifiers using GetInventory. %#v\", err)\n    }\n    l.Categories, err = pos.GetCategories(token.AccessToken)\n    if err != nil {\n        log.Infof(\"Error grabbing categories using GetInventory. %#v\", err)\n    }\n\n    l.Items, err = pos.GetItems(token.AccessToken, l.LocationID)\n    if err != nil {\n        log.Infof(\"Error grabbing items using GetInventory. %#v\", err)\n    }\n    l.ItemSort, err = u.is.FindItemSortByLocation(l.LocationID)\n    if err != nil {\n        log.Infof(\"Error grabbing item sort. %#v\", err)\n    }\n    l.CatSort, err = u.is.FindCatSortByLocation(l.LocationID)\n    if err != nil {\n        log.Infof(\"Error grabbing cat sort. %#v\", err)\n    }\n\n    lJSON, err := json.Marshal(l)\n    if err != nil {\n        log.Infof(\"error marshalling data to lJSON inside  RetrieveLocationInv %v\", err)\n        return\n    }\n\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.WriteHeader(http.StatusOK)\n    w.Write(lJSON)\n\n}\n</code></pre>\n\n<p>Here are some of the models that I use:</p>\n\n<pre><code>type Categories struct {\n    Categories []Category `json:\"objects\"`\n}\n\ntype ItemCatModSort struct {\n    LocationID string\n    Categories Categories\n    Items      []Item\n    Modifiers  []Modifier\n    ItemSort   []ItemSort\n    CatSort    CatSort\n}\n\ntype CatSort struct {\n    gorm.Model\n    LocationID string\n    Category   pq.StringArray `gorm:\"type:varchar(10485760)[]\"`\n}\n\ntype Item struct {\n    gorm.Model\n    Type                  string    `json:\"type\"`\n    ID                    string    `json:\"id\"`\n    UpdatedAt             time.Time `json:\"updated_at\"`\n    Version               int64     `json:\"version\"`\n    IsDeleted             bool      `json:\"is_deleted\"`\n    PresentAtAllLocations bool      `json:\"present_at_all_locations\"`\n    PresentAtLocationIds  []string  `json:\"present_at_location_ids\"`\n    AbsentAtLocationIds   []string  `json:\"absent_at_location_ids\"`\n    ItemData              struct {\n        Name             string `json:\"name\"`\n        Description      string `json:\"description\"`\n        Visibility       string `json:\"visibility\"`\n        CategoryID       string `json:\"category_id\"`\n        ModifierListInfo []struct {\n            ModifierListID       string `json:\"modifier_list_id\"`\n            Visibility           string `json:\"visibility\"`\n            MinSelectedModifiers int    `json:\"min_selected_modifiers\"`\n            MaxSelectedModifiers int    `json:\"max_selected_modifiers\"`\n            Enabled              bool   `json:\"enabled\"`\n        } `json:\"modifier_list_info\"`\n        ImageURL   string `json:\"image_url\"`\n        Variations []struct {\n            Type                  string    `json:\"type\"`\n            ID                    string    `json:\"id\"`\n            UpdatedAt             time.Time `json:\"updated_at\"`\n            Version               int64     `json:\"version\"`\n            IsDeleted             bool      `json:\"is_deleted\"`\n            PresentAtAllLocations bool      `json:\"present_at_all_locations\"`\n            PresentAtLocationIds  []string  `json:\"present_at_location_ids\"`\n            AbsentAtLocationIds   []string  `json:\"absent_at_location_ids\"`\n            ItemVariationData     struct {\n                ItemID      string `json:\"item_id\"`\n                Name        string `json:\"name\"`\n                Sku         string `json:\"sku\"`\n                Ordinal     int    `json:\"ordinal\"`\n                PricingType string `json:\"pricing_type\"`\n                PriceMoney  struct {\n                    Amount   int    `json:\"amount\"`\n                    Currency string `json:\"currency\"`\n                } `json:\"price_money\"`\n            } `json:\"item_variation_data\"`\n        } `json:\"variations\"`\n        ProductType        string `json:\"product_type\"`\n        SkipModifierScreen bool   `json:\"skip_modifier_screen\"`\n    } `json:\"item_data\"`\n}\n\n</code></pre>\n\n<p>basically instead of </p>\n\n<pre><code>\"Items\": [\n                \"[\\\"QQTISGXSJIS4DEV36JCBWQ4X\\\", \\\"HCOWEB7NVIQEUAINMM2KUV6J\\\",... \\\"VIFSURNJWJ6YYKXIWTWRNY6F\\\"]\" ]\n</code></pre>\n\n<p>looking like that, I'd want it to look like this:</p>\n\n<pre><code> \"Items\": [\"QQTISGXSJIS4DEV36JCBWQ4X\\\", \\\"HCOWEB7NVIQEUAINMM2KUV6J\\\",... \\\"VIFSURNJWJ6YYKXIWTWRNY6F\\\" ]\n</code></pre>\n"}, {"tags": ["performance", "go", "go-templates"], "comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 3, "creation_date": 1554173661, "post_id": 55465767, "comment_id": 97644095, "body": "Once. Attach the parsed template value to a struct type.that handles your routes - that way it&#39;s closely coupled with your API handler."}, {"owner": {"reputation": 47, "user_id": 5290694, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/88c8cdb072c6d8929d6d54542e96eb7c?s=128&d=identicon&r=PG&f=1", "display_name": "Eduardo Andr&#233;s Castillo Perera", "link": "https://stackoverflow.com/users/5290694/eduardo-andr%c3%a9s-castillo-perera"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1554173904, "post_id": 55465767, "comment_id": 97644155, "body": "@colminator so I use it as a global variable?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1554174316, "post_id": 55465767, "comment_id": 97644259, "body": "Parsing the template once reduces execution time of the handler that uses the template. A package-level variable is a fine way to hold on to the parsed template."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1554175192, "post_id": 55465767, "comment_id": 97644466, "body": "@Eduardo it&#39;s a matter of style. I generally don&#39;t like globals, but in the context of a single purpose package, there&#39;s nothing wrong with that choice."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554186348, "post_id": 55465767, "comment_id": 97647452, "body": "Note that there are no globals in Go, so you can&#39;t actually store your templates in a global variable."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1554186951, "post_id": 55465767, "comment_id": 97647720, "body": "See possible duplicate <a href=\"https://stackoverflow.com/questions/28451675/it-takes-too-much-time-when-using-template-package-to-generate-a-dynamic-web-p/28453523#28453523\">It takes too much time when using \u201ctemplate\u201d package to generate a dynamic web page to client in Golang</a>."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554212882, "post_id": 55468261, "comment_id": 97663155, "body": "Another solid option (my personal preference, but it is slightly more complicated) is to use build constraints to parse templates at startup unless e.g. a <code>dev</code> build tag is passed, in which case they&#39;re loaded on each request. That lets you do rapid iteration while working locally, and get maximum performance in production  without having to watch files or reload on a timer."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1554186660, "creation_date": 1554186660, "answer_id": 55468261, "question_id": 55465767, "link": "https://stackoverflow.com/questions/55465767/should-i-call-template-parsefiles-on-each-http-request-or-only-once-from-th/55468261#55468261", "title": "Should I call template.ParseFiles(...) on each http request or only once from the main function?", "body": "<p>As usual: It depends.</p>\n\n<p>But first some nuance:</p>\n\n<ol>\n<li><p>You should never do template parsing (or anything else interesting) in your <code>main()</code> function. Instead, your <code>main()</code> function should call methods (or a single method) that kicks off the chain of interesting things in your program.</p></li>\n<li><p>Go doesn't have globals, so it's not actually an option to store your parsed templates in a global variable in the first place. The closest Go has to global variables is package variables. You <em>could</em> store your parsed templates in a package variable in the <code>main</code> package, but this is also bad form, as your <code>main</code> package (except for tiny, trivial programs), should just be an entry point, and otherwise nearly empty.</p></li>\n</ol>\n\n<p>But now, on to the core of your question:</p>\n\n<p>Should you parse templates per request, or per run?</p>\n\n<p>And here it depends.</p>\n\n<p>If you have templates that change frequently (i.e. during development, when you're constantly editing your HTML files), once per request can be best.</p>\n\n<p>But this is far less efficient than just parsing once, so in production, you may wish to parse the templates once on startup only. Then you can store the templates in a package variable, or better, in a struct that is initialized at runtime. But I leave that to you.</p>\n\n<p>But what may be best is actually a bit of a compromise between the two approaches. It may be best to load your templates at start-up, and re-load them occasionally, either automatically (say, every 5 minutes), or watch your filesystem, and reload them whenever the on-disk representation of the templates changes.</p>\n\n<p>How to do this is left as an exercise for the reader.</p>\n"}], "owner": {"reputation": 47, "user_id": 5290694, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/88c8cdb072c6d8929d6d54542e96eb7c?s=128&d=identicon&r=PG&f=1", "display_name": "Eduardo Andr&#233;s Castillo Perera", "link": "https://stackoverflow.com/users/5290694/eduardo-andr%c3%a9s-castillo-perera"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 472, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1554186660, "creation_date": 1554169187, "question_id": 55465767, "link": "https://stackoverflow.com/questions/55465767/should-i-call-template-parsefiles-on-each-http-request-or-only-once-from-th", "title": "Should I call template.ParseFiles(...) on each http request or only once from the main function?", "body": "<p>I am doing some web develoment using the go programming language using the package <code>html/template</code>. At some point of the code, I need to call the function <code>template.ParseFiles(...)</code> so I can create a template from those files ad then execute it using <code>temp.Execute(w,data)</code>. I would like to know if it is better to create the template on each request or to do it once in the main and declare a global variable.</p>\n\n<p>Right now I do it on each request on my handle functions, like most tutorials do. However, I don't know If I'm wasting resources by doing it on each request instead of having them as global variables.</p>\n\n<p>This is how it looks on each request</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func ViewStats(w http.ResponseWriter, r *http.Request) {\n    //Get stuff from db and put them in data\n    //...\n    //return data to user\n    tmp, err := template.ParseFiles(\"views/guest-layout.html\",\n        \"views/stats.html\")\n\n    if err != nil {\n        fmt.Println(err)\n    } else {\n        tmp.Execute(w,data)\n    }\n}\n</code></pre>\n\n<p>I would like to know if this is better:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var temp1 template.Template\n\nfunc main() {\n    temp1, err = template.ParseFiles(\"file1\",\"file2\") \n    //...\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1554161375, "post_id": 55464845, "comment_id": 97641726, "body": "The code use the quote character for rune literals.  Use one of the quote characters for string instead."}], "answers": [{"comments": [{"owner": {"reputation": 126, "user_id": 5165372, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XFBqh.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/5165372/daniel"}, "edited": false, "score": 0, "creation_date": 1554161617, "post_id": 55464893, "comment_id": 97641775, "body": "Ah! <i>facepalm</i> It&#39;s backticks, not single quotes. Even after all these years I still run into the &quot;missing a semicolon&quot; type errors ..."}, {"owner": {"reputation": 1025, "user_id": 7253829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qe9lZ.jpg?s=128&g=1", "display_name": "waymobetta", "link": "https://stackoverflow.com/users/7253829/waymobetta"}, "reply_to_user": {"reputation": 126, "user_id": 5165372, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XFBqh.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/5165372/daniel"}, "edited": false, "score": 2, "creation_date": 1554161974, "post_id": 55464893, "comment_id": 97641835, "body": "A linter usually helps me catch things like this. <a href=\"https://github.com/golangci/awesome-go-linters\" rel=\"nofollow noreferrer\">Here</a> is a list of go linters for your consideration"}], "tags": [], "owner": {"reputation": 1025, "user_id": 7253829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qe9lZ.jpg?s=128&g=1", "display_name": "waymobetta", "link": "https://stackoverflow.com/users/7253829/waymobetta"}, "is_accepted": true, "score": 7, "last_activity_date": 1554161369, "last_edit_date": 1554161369, "creation_date": 1554161060, "answer_id": 55464893, "question_id": 55464845, "link": "https://stackoverflow.com/questions/55464845/go-struct-tag-throwing-error-field-tag-must-be-a-string/55464893#55464893", "title": "Go struct tag throwing error: &quot;field tag must be a string&quot;", "body": "<p>You need to encapsulate your struct tags with <em>back quotes</em> instead of using single quotes to create raw string literals which can allow for the inclusion of additional data in the tag field.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/10858787/what-are-the-uses-for-tags-in-go\">This</a> post gives a good explanation of tags, how they are constructed properly and should serve as a good reference for further explanation if needed.</p>\n\n<p>Working code here:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n)\n\ntype Version struct {\n    ID      string `json:\"id\"`\n    Version string `json:\"version, omitempty\"`\n    Sha     string `json:\"sha\"`\n}\n\nfunc main() {\n    router := mux.NewRouter()\n    router.HandleFunc(\"/demo/v1/version\", getVersion).Methods(\"GET\")\n    log.Fatal(http.ListenAndServe(\":8080\", router))\n}\n\nfunc getVersion(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.WriteHeader(http.StatusOK)\n    version := Version{ID: \"demo\", Version: \"1.0.0\", Sha: \"some hash....\"}\n    var myJSON, err = json.Marshal(version)\n    if err != nil {\n        // handle error\n    }\n    json.NewEncoder(w).Encode(myJSON)\n}\n</code></pre>\n"}], "owner": {"reputation": 126, "user_id": 5165372, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XFBqh.jpg?s=128&g=1", "display_name": "Daniel", "link": "https://stackoverflow.com/users/5165372/daniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1646, "favorite_count": 0, "accepted_answer_id": 55464893, "answer_count": 1, "score": 0, "last_activity_date": 1554161369, "creation_date": 1554160604, "question_id": 55464845, "link": "https://stackoverflow.com/questions/55464845/go-struct-tag-throwing-error-field-tag-must-be-a-string", "title": "Go struct tag throwing error: &quot;field tag must be a string&quot;", "body": "<p>I'm using GO for the first time and am setting up a little example API. In trying to return a JSON object from a struct that I made, I get this error when I add a struct tag to my fields: </p>\n\n<p>\"field tag must be a string\" and \"invalid character literal (more than one character)\".</p>\n\n<p>Here's my code breakdown. What am I missing here?</p>\n\n<pre><code>    package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n)\n\nfunc main() {\n    router := mux.NewRouter()\n    router.HandleFunc(\"/demo/v1/version\", getVersion).Methods(\"GET\")    \n    log.Fatal(http.ListenAndServe(\":8080\", router))    \n}\n\n\nfunc getVersion(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.WriteHeader(http.StatusOK)\n    version := Version{ID: \"demo\", Version: \"1.0.0\", Sha: \"some hash....\"}\n    var myJSON, err = json.Marshal(version)\n\n    json.NewEncoder(w).Encode(myJSON)\n\n}\n\ntype Version struct {\n    //ERRORS on these 3 lines:\n    ID      string 'json:\"id\"'\n    Version string 'json:\"version, omitempty\"'\n    Sha     string 'json:\"sha\"'\n}\n</code></pre>\n"}, {"tags": ["go", "kubernetes-helm", "go-templates", "sprig-template-functions"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1554160099, "post_id": 55464747, "comment_id": 97641433, "body": "The <code>and</code> function in Go templates is not short-circuit evaluated (unlike the <code>&amp;&amp;</code> operator in Go), all its arguments are evaluated always. So using 2 <code>{{if}}</code> is the right way to go here."}, {"owner": {"reputation": 411, "user_id": 1097444, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3efed5bfe48ed6f9a40cfc8b35519264?s=128&d=identicon&r=PG", "display_name": "Hem", "link": "https://stackoverflow.com/users/1097444/hem"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1554160993, "post_id": 55464747, "comment_id": 97641636, "body": "@icza, thank you. I edited my question. Could you remove the duplicate mark if you&#39;re convinced with my edit?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1554161304, "post_id": 55464747, "comment_id": 97641710, "body": "It doesn&#39;t matter if the logic is something else: both <code>or</code> and <code>and</code> in templates evaluate all arguments, so the answer is still the same."}, {"owner": {"reputation": 411, "user_id": 1097444, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3efed5bfe48ed6f9a40cfc8b35519264?s=128&d=identicon&r=PG", "display_name": "Hem", "link": "https://stackoverflow.com/users/1097444/hem"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1554214235, "post_id": 55464747, "comment_id": 97664017, "body": "I&#39;m looking for solution for my problem. The other answer does not solve my problem. As long as it is marked as duplicate, it won&#39;t get attention from others."}], "answers": [{"comments": [{"owner": {"reputation": 411, "user_id": 1097444, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3efed5bfe48ed6f9a40cfc8b35519264?s=128&d=identicon&r=PG", "display_name": "Hem", "link": "https://stackoverflow.com/users/1097444/hem"}, "edited": false, "score": 0, "creation_date": 1554221758, "post_id": 55477831, "comment_id": 97668683, "body": "For reference, just add $ to variable result: $result. Otherwise, it fails with &quot;function &quot;result&quot; not defined&quot;"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 411, "user_id": 1097444, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3efed5bfe48ed6f9a40cfc8b35519264?s=128&d=identicon&r=PG", "display_name": "Hem", "link": "https://stackoverflow.com/users/1097444/hem"}, "edited": false, "score": 1, "creation_date": 1554221834, "post_id": 55477831, "comment_id": 97668724, "body": "@Hem Yes, you&#39;re right. I didn&#39;t try the example, just wrote it from memory. Fixed. Thanks."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1554221797, "last_edit_date": 1554221797, "creation_date": 1554217070, "answer_id": 55477831, "question_id": 55464747, "link": "https://stackoverflow.com/questions/55464747/combining-two-if-conditions-into-one/55477831#55477831", "title": "Combining two if conditions into one", "body": "<p>You get an error when using the <code>and</code> function because the <code>and</code> function in Go templates is not short-circuit evaluated (unlike the <code>&amp;&amp;</code> operator in Go), all its arguments are evaluated always. Read more about it here: <a href=\"https://stackoverflow.com/questions/51165642/golang-template-and-testing-for-valid-fields/51167460#51167460\">Golang template and testing for Valid fields</a></p>\n\n<p>So you have to use embedded <code>{{if}}</code> actions so the 2nd argument is only evaluated if the first is also true.</p>\n\n<p>You edited the question and stated that your actual problem is this:</p>\n\n<pre><code>{{if or (and (condition A) (condition B)) (condition C)) }}\n    &lt;code goes here&gt;\n{{ end }}\n</code></pre>\n\n<p>This is how you can do it in templates only:</p>\n\n<pre><code>{{ $result := false }}\n{{ if (conddition A )}}\n    {{ if (condition B) }}\n        {{ $result = true }}\n    {{ end }}\n{{ end }}\n{{ if or $result (condition C) }}\n    &lt;code goes here&gt;\n{{ end }}\n</code></pre>\n\n<p>Another option is to pass the result of that logic to the template as a parameter.</p>\n\n<p>If you can't or don't know the result before calling the template, yet another option is to register a custom function, and call this custom function from the template, and you can do short-circuit evaluation in Go code. For an example, see <a href=\"https://stackoverflow.com/questions/52814840/how-to-calculate-something-in-html-template/52815110#52815110\">How to calculate something in html/template</a>.</p>\n"}], "owner": {"reputation": 411, "user_id": 1097444, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3efed5bfe48ed6f9a40cfc8b35519264?s=128&d=identicon&r=PG", "display_name": "Hem", "link": "https://stackoverflow.com/users/1097444/hem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2444, "favorite_count": 0, "accepted_answer_id": 55477831, "answer_count": 1, "score": 2, "last_activity_date": 1604965697, "creation_date": 1554159803, "last_edit_date": 1554274673, "question_id": 55464747, "link": "https://stackoverflow.com/questions/55464747/combining-two-if-conditions-into-one", "title": "Combining two if conditions into one", "body": "<p>The below works</p>\n\n<pre><code>{{- if hasKey (index $envAll.Values.policy) \"type\" }} \n{{- if has \"two-wheeler\" (index $envAll.Values.policy \"type\") }}\n&lt;code goes here&gt;\n{{- end }}\n{{- end }}\n</code></pre>\n\n<p>while the below fails with \"runtime error: invalid memory address or nil pointer dereference\"</p>\n\n<pre><code>{{- if and (hasKey (index $envAll.Values.policy) \"type\") (has \"two-wheeler\" (index $envAll.Values.policy \"type\")) }}\n&lt;code goes here&gt;\n{{- end}}\n</code></pre>\n\n<p>There is no list by name \"type\" declared under $envAll.Values.policy.</p>\n\n<p>In Go, if the right operand is evaluated conditionally, why does the last condition gets evaluated in the second code snippet? How do I solve it?</p>\n\n<p><strong>Edit</strong> (since it marked as duplicate):\nUnfortunately, I cannot use embedded {{ if }} like it is mentioned in the other post.</p>\n\n<p>I simplified my problem above. I actually have to achieve this...</p>\n\n<pre><code>{{if or (and (condition A) (condition B)) (condition C)) }}\n    &lt;code goes here&gt;\n{{ end }}\n</code></pre>\n"}, {"tags": ["api", "go", "encryption", "jwt", "aes"], "comments": [{"owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "edited": false, "score": 3, "creation_date": 1554151971, "post_id": 55463392, "comment_id": 97639083, "body": "Edit your post to include your code - we can&#39;t tell you what is wrong with it without seeing it!  Ensure it is a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 1914, "user_id": 9811969, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/184e2e46b8d8b8c483c85589709b8563?s=128&d=identicon&r=PG&f=1", "display_name": "Nik", "link": "https://stackoverflow.com/users/9811969/nik"}, "edited": false, "score": 0, "creation_date": 1554152224, "post_id": 55463392, "comment_id": 97639200, "body": "Have you tried <a href=\"https://github.com/dgrijalva/jwt-go\" rel=\"nofollow noreferrer\">github.com/dgrijalva/jwt-go</a>?"}, {"owner": {"reputation": 11100, "user_id": 2157818, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f122e6b4c044c93222b952d70aaec3ec?s=128&d=identicon&r=PG", "display_name": "Florent Morselli", "link": "https://stackoverflow.com/users/2157818/florent-morselli"}, "reply_to_user": {"reputation": 1914, "user_id": 9811969, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/184e2e46b8d8b8c483c85589709b8563?s=128&d=identicon&r=PG&f=1", "display_name": "Nik", "link": "https://stackoverflow.com/users/9811969/nik"}, "edited": false, "score": 0, "creation_date": 1554231202, "post_id": 55463392, "comment_id": 97673283, "body": "@Nik it is clearly mentioned in the doc of the library you proposed that JWE is not supported. Anyway, another library like <a href=\"https://github.com/square/go-jose/blob/master/README.md\" rel=\"nofollow noreferrer\">github.com/square/go-jose/blob/master/README.md</a> should do the job"}], "owner": {"reputation": 148, "user_id": 9090874, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vZo8E.gif?s=128&g=1", "display_name": "Sergio Guti&#233;rrez", "link": "https://stackoverflow.com/users/9090874/sergio-guti%c3%a9rrez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 724, "favorite_count": 0, "closed_date": 1554283988, "answer_count": 0, "score": 3, "last_activity_date": 1554186585, "creation_date": 1554151874, "last_edit_date": 1554186585, "question_id": 55463392, "link": "https://stackoverflow.com/questions/55463392/encrypt-decrypt-jwt-with-any-kind-of-type-encryption-aes-etc-in-golang", "closed_reason": "Not suitable for this site", "title": "Encrypt &amp; Decrypt JWT with any kind of type encryption (AES, etc...) in Golang", "body": "<p>I am searching for a library in Go that can give to me the capability of crypting for send and decrypting for reading a JWT that I send when a user is logged in my api rest made in Golang. </p>\n\n<p>I have seen a lot of examples with AES, but I have a lot of issues trying to encrypt in AES a JWT because signs like \".\" or \"-\" give me problems. </p>\n\n<p>I know that I must use a 32 bytes key, that I can change the base to 64. But only using the most simple example, making a simple hash, using the cipher, I have always the same error at crypting/decrypting. </p>\n\n<p>For instance :</p>\n\n<pre><code>crypto/aes: invalid key size X\n</code></pre>\n\n<p>I use the same code like this Stack Overflow answer :<a href=\"https://stackoverflow.com/questions/35811119/aes-encryption-golang-and-python\">AES Encryption Golang and Python</a></p>\n\n<p>I have already my token signed, I want to add a new level of security after signing.</p>\n\n<pre><code>claims := Claim{\n    User: user,\n    StandardClaims: djwt.StandardClaims{\n        ExpiresAt: time.Now().Add(time.Hour * 1).Unix(),\n        Issuer: \"App Timer\",\n    },\n}\n\ntoken := djwt.NewWithClaims(djwt.SigningMethodRS256, claims)\nresult, err := token.SignedString(privateKey)\n\nif err != nil {\n    log.Fatal(\"TokenSingingError\")\n}\n</code></pre>\n"}, {"tags": ["xml", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1554144385, "post_id": 55461422, "comment_id": 97635848, "body": "All your attributes are on the <code>module</code> element, but the fields aren&#39;t on the <code>Module</code> type that you&#39;re using to represent that element, they&#39;re on another type that&#39;s set up as if you&#39;re expecting a <code>ModuleField</code> child element, which does not exist."}], "answers": [{"comments": [{"owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "edited": false, "score": 0, "creation_date": 1554167249, "post_id": 55461678, "comment_id": 97642850, "body": "Hey, thank you, your answer really helped me understand."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1554144378, "creation_date": 1554144378, "answer_id": 55461678, "question_id": 55461422, "link": "https://stackoverflow.com/questions/55461422/go-unmarshal-xml-with-attributes/55461678#55461678", "title": "go unmarshal xml with attributes", "body": "<p>Letter case matters, so the element <code>module</code> will not be unmarshaled into a field called <code>Module</code>, you need to add the proper tag. Also you'll need to embed the <code>ModuleField</code> into <code>Module</code> so that its fields are <em>promoted</em> to <code>Module</code> and only then they will be unmarshaled. Or, alternatively, you can remove <code>ModuleField</code> and move all its fields into <code>Module</code>.</p>\n\n<p><a href=\"https://play.golang.org/p/AvaEpcKY-oh\" rel=\"nofollow noreferrer\">https://play.golang.org/p/AvaEpcKY-oh</a></p>\n"}], "owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 284, "favorite_count": 0, "accepted_answer_id": 55461678, "answer_count": 1, "score": 0, "last_activity_date": 1554144378, "creation_date": 1554143323, "question_id": 55461422, "link": "https://stackoverflow.com/questions/55461422/go-unmarshal-xml-with-attributes", "title": "go unmarshal xml with attributes", "body": "<p>Having trouble getting xml to unmarshal so I can access xml attributes. Not sure what I'm doing wrong at this point. It complies, but the struct doesn't appear to contain any data.</p>\n\n<pre><code>import (\n    \"io/ioutil\"\n    \"encoding/xml\"\n    \"fmt\"\n)\n</code></pre>\n\n<p>contents of xml:</p>\n\n<pre><code>  &lt;module id=\"Core\" description=\"Core Module\" tenantId=\"tenant1\" major=\"3\" minor=\"4\" patch=\"0\" build=\"0\"&gt;\n    &lt;probePath path=\"bin\" /&gt;\n  &lt;/module&gt;\n&lt;/metadata&gt;\n</code></pre>\n\n<pre><code>type ModuleField struct {\n    Id string `xml:\"id,attr\"`\n    Description string `xml:\"description,attr\"`\n    TenantId string `xml:\"tenantId,attr\"`\n    Major string `xml:\"major,attr\"`\n    Minor string `xml:\"minor,attr\"`\n    Patch string `xml:\"patch,attr\"`\n}\n\ntype Module struct {\n    ModuleField ModuleField\n    ProbePath string `xml:\"probePath\"`\n}\n\ntype Metadata struct {\n    XMLName xml.Name `xml:\"metadata\"`\n    Module Module\n}\n</code></pre>\n\n<pre><code>\n// read xml file\n    raw, _ := ioutil.ReadFile(XMLLoc)\n    if err != nil {\n        return\n    }\n\n\n    var XMLData Metadata \n    xml.Unmarshal(raw, &amp;XMLData)\n\n    // nothing is being printed\n    fmt.Println(\"&gt;\",XMLData.Module.ModuleField.TenantId,\"&lt;\")\n\n\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554143743, "post_id": 55461388, "comment_id": 97635601, "body": "Impossible to say what the issue might be without seeing the code causing it."}, {"owner": {"reputation": 1572, "user_id": 638488, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/mmEHj.png?s=128&g=1", "display_name": "J&#248;rgen", "link": "https://stackoverflow.com/users/638488/j%c3%b8rgen"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1554145448, "post_id": 55461388, "comment_id": 97636283, "body": "@Adrian I understand it&#39;s hard. But I can not upload the whole project. Tomorrow I will try to see if I can reproduce this in a single go file. Was hoping that the above scenario would ring a bell for someone. :-)"}], "answers": [{"tags": [], "owner": {"reputation": 1572, "user_id": 638488, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/mmEHj.png?s=128&g=1", "display_name": "J&#248;rgen", "link": "https://stackoverflow.com/users/638488/j%c3%b8rgen"}, "is_accepted": true, "score": 0, "last_activity_date": 1554374287, "creation_date": 1554374287, "answer_id": 55513832, "question_id": 55461388, "link": "https://stackoverflow.com/questions/55461388/go-sql-driver-context-cancelled-seems-to-leak-goroutines/55513832#55513832", "title": "go sql driver + context cancelled seems to &quot;leak&quot; goroutines?", "body": "<p>To answer my own question; the problem is most likely the system being overloaded. \nI rate limited the number of concurrent connections and use a lot less MySQL connections 25%. That seems to solve the problem. I have less throughput now, but a more stable system.</p>\n\n<p>It still doesn't answer why the netpoller keeps blocking even while the system calmed down again. They just never recover, which I think is not good. But probably there is a good reason for it. I saw this symptoms multiple times on Stackoverflow with network connections, like for example http.Client.</p>\n"}], "owner": {"reputation": 1572, "user_id": 638488, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/mmEHj.png?s=128&g=1", "display_name": "J&#248;rgen", "link": "https://stackoverflow.com/users/638488/j%c3%b8rgen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1036, "favorite_count": 0, "accepted_answer_id": 55513832, "answer_count": 1, "score": 0, "last_activity_date": 1554374287, "creation_date": 1554143167, "last_edit_date": 1554146087, "question_id": 55461388, "link": "https://stackoverflow.com/questions/55461388/go-sql-driver-context-cancelled-seems-to-leak-goroutines", "title": "go sql driver + context cancelled seems to &quot;leak&quot; goroutines?", "body": "<p><strong>Background</strong></p>\n\n<p>When I run a load test on the application that I'm building everything is working smoothly, until the machine almost runs out of memory and the application runs into problems. Suddenly all the contexts get cancelled (most likely by the hystrix library) because it takes too long to handle requests. So far, nothing really surprising.  </p>\n\n<p><strong>The problem</strong></p>\n\n<p>What I do find strange is that it seems to start leaking go routines when contexts get cancelled.</p>\n\n<p>In healthy conditions there are around 20 goroutines running all the time. But after this situation happens it keeps more than 20 goroutines around: 98 to be precise. This number does <strong>not</strong> drop with time. I use http.Server with read/write timeouts, go-sql-driver/mysql and hystrix with context. Below a dump of goroutines that are running after way longer than all the timeouts. Almost all of them are from or are invoked by the go-sql-driver. There are no queries left in the MySQL processlist. Curious if someone else experienced this and know how to solve it.</p>\n\n<p>The application is still runs smoothly after this and can handle over 2000r/s with 100% success rate, but after the test finishes the previous hanging goroutines are still there.</p>\n\n<p>Here is a dump of goroutines  (not all but it is more of the same). The runtime_pollWait is from the go-mysql-driver:</p>\n\n<pre><code>goroutine 1 [IO wait]:\ninternal/poll.runtime_pollWait(0x7fd0fbc007b8, 0x72, 0x0)\n\ngoroutine 18 [sleep, 43 minutes]:\nruntime.goparkunlock(...)\n\ngoroutine 19 [select, 2 minutes]:\ndatabase/sql.(*DB).connectionOpener(0xc000188240, 0xb835a0, 0xc00017b2c0)\n\ngoroutine 20 [select]:\ndatabase/sql.(*DB).connectionResetter(0xc000188240, 0xb835a0, 0xc00017b2c0)\n\ngoroutine 34 [select, 2 minutes]:\ndatabase/sql.(*DB).connectionOpener(0xc0001883c0, 0xb835a0, 0xc00016a140)\n\ngoroutine 35 [select]:\ndatabase/sql.(*DB).connectionResetter(0xc0001883c0, 0xb835a0, 0xc00016a140)\n\ngoroutine 8 [chan receive]:\ngithub.com/go-redis/redis/internal/pool.(*ConnPool).reaper(0xc0000ba370, 0xdf8475800)\n\ngoroutine 11 [chan receive]:\ngithub.com/go-redis/redis/internal/pool.(*ConnPool).reaper(0xc0000ba420, 0xdf8475800)\n\ngoroutine 14 [chan receive]:\ngithub.com/go-redis/redis/internal/pool.(*ConnPool).reaper(0xc0000ba4d0, 0xdf8475800)\n\ngoroutine 98 [sleep, 43 minutes]:\nruntime.goparkunlock(...)\n\ngoroutine 87 [chan receive]:\ngithub.com/afex/hystrix-go/hystrix.(*metricExchange).Monitor(0xc002a1b5c0)\n\ngoroutine 99 [syscall]:\nsyscall.Syscall6(0xe8, 0xd, 0xc0002b9a58, 0x64, 0x64, 0x0, 0x0, 0x42bfcf, 0x8, 0xacdd80)\n\ngoroutine 100 [sleep]:\nruntime.goparkunlock(...)\n\ngoroutine 88 [chan receive]:\ngithub.com/afex/hystrix-go/hystrix.(*poolMetrics).Monitor(0xc003ac08a0)\n\ngoroutine 91 [chan receive]:\ngithub.com/afex/hystrix-go/hystrix.(*metricExchange).Monitor(0xc002a1b680)\n\ngoroutine 92 [chan receive]:\ngithub.com/afex/hystrix-go/hystrix.(*poolMetrics).Monitor(0xc003ac0f00)\n\ngoroutine 25921733 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0fa06f298, 0x72, 0xffffffffffffffff)\n\ngoroutine 25921439 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0f983fe18, 0x72, 0xffffffffffffffff)\n\ngoroutine 25927120 [select, 3 minutes]:\ngithub.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc003aa7620, 0xc01c2ef980, 0xc01a841bc0)\n\ngoroutine 25928175 [select, 3 minutes]:\ngithub.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc012abbf80, 0xc01c2ee600, 0xc01144f8c0)\n\ngoroutine 25927727 [select, 3 minutes]:\ngithub.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc014ae4300, 0xc0166a3c80, 0xc0030e8a80)\n\ngoroutine 24567262 [select]:\ndatabase/sql.(*DB).connectionCleaner(0xc000188240, 0x2540be400)\n\ngoroutine 25927990 [select, 3 minutes]:\ngithub.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc012ababa0, 0xc0166a3ec0, 0xc01144f380)\n\ngoroutine 25921926 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0fa0702d8, 0x72, 0xffffffffffffffff)\n\ngoroutine 25921958 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0fa06eb48, 0x72, 0xffffffffffffffff)\n\ngoroutine 24567381 [select]:\ndatabase/sql.(*DB).connectionCleaner(0xc0001883c0, 0x2540be400)\n\ngoroutine 25921798 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0f9882038, 0x72, 0xffffffffffffffff)\n\ngoroutine 25921751 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0fa6b6820, 0x72, 0xffffffffffffffff)\n\ngoroutine 25921757 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0fa6b6410, 0x72, 0xffffffffffffffff)\n\ngoroutine 25927113 [select, 3 minutes]:\ngithub.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc003aa7320, 0xc01c2efbc0, 0xc01a8419e0)\n\ngoroutine 25921966 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0fa06e8d8, 0x72, 0xffffffffffffffff)\n\ngoroutine 25921964 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0fa06e9a8, 0x72, 0xffffffffffffffff)\n\ngoroutine 25921323 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0fa06f0f8, 0x72, 0xffffffffffffffff)\n\ngoroutine 25928466 [select, 3 minutes]:\ngithub.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc00e552240, 0xc01c2ef740, 0xc01144f920)\n\ngoroutine 25928011 [select, 3 minutes]:\ngithub.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc0156599e0, 0xc01c2ee3c0, 0xc01baa8fc0)\n\ngoroutine 25919812 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0fa06ea78, 0x72, 0xffffffffffffffff)\n\ngoroutine 25928014 [select, 3 minutes]:\ngithub.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc015659b00, 0xc01177e900, 0xc01baa90e0)\n\ngoroutine 25922001 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0fa070548, 0x72, 0xffffffffffffffff)\n\ngoroutine 25925675 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0fa6b8150, 0x72, 0xffffffffffffffff)\n\ngoroutine 25928529 [select, 3 minutes]:\ngithub.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc003aa7680, 0xc01c2ef8c0, 0xc01a841c20)\n\ngoroutine 25928467 [select, 3 minutes]:\ngithub.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc00e552360, 0xc01c2ef680, 0xc01144f980)\n\ngoroutine 25928468 [select, 3 minutes]:\ngithub.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc00e552480, 0xc01c2ef5c0, 0xc01144f9e0)\n\ngoroutine 25919817 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0fa06e808, 0x72, 0xffffffffffffffff)\n\ngoroutine 25925511 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0f983e4e8, 0x72, 0xffffffffffffffff)\n\ngoroutine 25920658 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0fa070208, 0x72, 0xffffffffffffffff)\n\ngoroutine 25920661 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0fa070138, 0x72, 0xffffffffffffffff)\n\ngoroutine 25920667 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0fa06e738, 0x72, 0xffffffffffffffff)\n\ngoroutine 25920860 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0fa06f368, 0x72, 0xffffffffffffffff)\n\ngoroutine 25920790 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0fa070478, 0x72, 0xffffffffffffffff)\n\ngoroutine 25920793 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0fa06fec8, 0x72, 0xffffffffffffffff)\n\ngoroutine 25928006 [select, 3 minutes]:\ngithub.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc015659800, 0xc01c1603c0, 0xc01baa8de0)\n\ngoroutine 25921085 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0fa6b7fb0, 0x72, 0xffffffffffffffff)\n\n.....\n\ngoroutine 25925779 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0fa6b7ba0, 0x72, 0xffffffffffffffff)\n\ngoroutine 25926131 [IO wait, 3 minutes]:\ninternal/poll.runtime_pollWait(0x7fd0fa6b69c0, 0x72, 0xffffffffffffffff)\n\ngoroutine 25927988 [select, 3 minutes]:\ngithub.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc012abaae0, 0xc01c2ee000, 0xc01144f2c0)\n\ngoroutine 25928470 [select, 3 minutes]:\ngithub.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc00e5526c0, 0xc01c2ef440, 0xc01144faa0)\n\ngoroutine 25928471 [select, 3 minutes]:\ngithub.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc00e5527e0, 0xc01c2ef380, 0xc01144fb00)\n\ngoroutine 25928472 [select, 3 minutes]:\ngithub.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc00e552900, 0xc01c2ef2c0, 0xc01144fb60)\n\ngoroutine 25928473 [select, 3 minutes]:\ngithub.com/go-sql-driver/mysql.(*mysqlConn).startWatcher.func1(0xc00e552a20, 0xc01c2ef200, 0xc01144fbc0)\n\ngoroutine 26252345 [IO wait]:\ninternal/poll.runtime_pollWait(0x7fd0e7054fe8, 0x72, 0xffffffffffffffff)\n</code></pre>\n"}, {"tags": ["json", "go", "unmarshalling", "bigint"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 5, "creation_date": 1554142227, "post_id": 55461131, "comment_id": 97634931, "body": "Remove the quotes around the numbers, they aren&#39;t strings. <a href=\"https://play.golang.org/p/4WURnHreYFl\" rel=\"nofollow noreferrer\">play.golang.org/p/4WURnHreYFl</a>"}, {"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1554142229, "post_id": 55461131, "comment_id": 97634935, "body": "<code>&quot;...long number...&quot;</code> is a string, integers in json aren&#39;t encapsulated in double quotes"}, {"owner": {"reputation": 402, "user_id": 8382536, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/1hpVX.jpg?s=128&g=1", "display_name": "d3t0x", "link": "https://stackoverflow.com/users/8382536/d3t0x"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554142837, "post_id": 55461131, "comment_id": 97635199, "body": "@Adrian the R and S values in the data are in this format unfortunately"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1554142907, "post_id": 55461131, "comment_id": 97635237, "body": "Then you&#39;ll have to write a custom <code>UnmarshalJSON</code>, because that&#39;s not the format expected by <code>big.Int</code>."}, {"owner": {"reputation": 1162, "user_id": 1653085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8irj8.jpg?s=128&g=1", "display_name": "Vitaly Velikodny", "link": "https://stackoverflow.com/users/1653085/vitaly-velikodny"}, "edited": false, "score": 0, "creation_date": 1554153750, "post_id": 55461131, "comment_id": 97639728, "body": "Hello, @d3t0x! Please, see my answer below!"}], "answers": [{"comments": [{"owner": {"reputation": 402, "user_id": 8382536, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/1hpVX.jpg?s=128&g=1", "display_name": "d3t0x", "link": "https://stackoverflow.com/users/8382536/d3t0x"}, "edited": false, "score": 0, "creation_date": 1554203240, "post_id": 55463609, "comment_id": 97656960, "body": "Seems to work quite well, thanks! I wonder why it was downvoted though? How does it work? How can you define UnmarshalJSON() but don&#39;t appear to call the func in main?"}, {"owner": {"reputation": 402, "user_id": 8382536, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/1hpVX.jpg?s=128&g=1", "display_name": "d3t0x", "link": "https://stackoverflow.com/users/8382536/d3t0x"}, "edited": false, "score": 0, "creation_date": 1554203524, "post_id": 55463609, "comment_id": 97657142, "body": "Ah I see, you used the BigInt struct! Still wondering why down vote though"}, {"owner": {"reputation": 1162, "user_id": 1653085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8irj8.jpg?s=128&g=1", "display_name": "Vitaly Velikodny", "link": "https://stackoverflow.com/users/1653085/vitaly-velikodny"}, "reply_to_user": {"reputation": 402, "user_id": 8382536, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/1hpVX.jpg?s=128&g=1", "display_name": "d3t0x", "link": "https://stackoverflow.com/users/8382536/d3t0x"}, "edited": false, "score": 0, "creation_date": 1554206379, "post_id": 55463609, "comment_id": 97658947, "body": "@d3t0x yes, you could rename it as you want. Without struct, but I think not clean enough solution here <a href=\"https://play.golang.org/p/YYdf85ub5-T\" rel=\"nofollow noreferrer\">play.golang.org/p/YYdf85ub5-T</a>"}, {"owner": {"reputation": 1162, "user_id": 1653085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8irj8.jpg?s=128&g=1", "display_name": "Vitaly Velikodny", "link": "https://stackoverflow.com/users/1653085/vitaly-velikodny"}, "reply_to_user": {"reputation": 402, "user_id": 8382536, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/1hpVX.jpg?s=128&g=1", "display_name": "d3t0x", "link": "https://stackoverflow.com/users/8382536/d3t0x"}, "edited": false, "score": 0, "creation_date": 1554206903, "post_id": 55463609, "comment_id": 97659265, "body": "@d3t0x don&#39;t know why downvoted, maybe because not a quite well first solution or maybe it could be a better one. Cool when people give feedback. If it works for you, accept my answer, please."}], "tags": [], "owner": {"reputation": 1162, "user_id": 1653085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8irj8.jpg?s=128&g=1", "display_name": "Vitaly Velikodny", "link": "https://stackoverflow.com/users/1653085/vitaly-velikodny"}, "is_accepted": true, "score": 0, "last_activity_date": 1554206422, "last_edit_date": 1554206422, "creation_date": 1554152928, "answer_id": 55463609, "question_id": 55461131, "link": "https://stackoverflow.com/questions/55461131/there-was-an-error-math-big-cannot-unmarshal-into-a-big-int/55463609#55463609", "title": "There was an error: math/big: cannot unmarshal into a *big.Int", "body": "<p>@d3t0x! Please, look at the </p>\n\n<p><a href=\"https://golang.org/pkg/math/big/#Int.SetString\" rel=\"nofollow noreferrer\">big#Int.SetString</a></p>\n\n<p>Possible way:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"math/big\"\n)\n\ntype Signature struct {\n    R, S BigInt\n    V, O uint8 // V is a reconstruction flag and O a multi sig order\n}\n\ntype BigInt struct {\n    big.Int\n}\n\nfunc (i *BigInt) UnmarshalJSON(b []byte) error {\n    var val string\n    err := json.Unmarshal(b, &amp;val)\n    if err != nil {\n        return err\n    }\n\n    i.SetString(val, 10)\n\n    return nil\n}\n\nfunc main() {\n    string := []byte(`{\"O\":0,\"R\":\"82794247871852158897004947856472973914188862150580220767211643167985440428259\",\"S\":\"39475619887140601172207943363731402979187092853596849493781395367115389948109\",\"V\":0}`)\n\n    var sig Signature\n\n    err2 := json.Unmarshal([]byte(string), &amp;sig)\n    if err2 != nil {\n        fmt.Println(\"There was an error:\", err2)\n    }\n\n    fmt.Printf(\"r %s s %s o %d v %d\", sig.R.String(), sig.S.String(), sig.O, sig.V)\n}\n</code></pre>\n\n<p>Playgrounds:</p>\n\n<p>1) <a href=\"https://play.golang.org/p/Qp-hiiPDfZM\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Qp-hiiPDfZM</a></p>\n\n<p>2) draft and not so clean solution here <a href=\"https://play.golang.org/p/YYdf85ub5-T\" rel=\"nofollow noreferrer\">https://play.golang.org/p/YYdf85ub5-T</a></p>\n"}], "owner": {"reputation": 402, "user_id": 8382536, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/1hpVX.jpg?s=128&g=1", "display_name": "d3t0x", "link": "https://stackoverflow.com/users/8382536/d3t0x"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 525, "favorite_count": 0, "accepted_answer_id": 55463609, "answer_count": 1, "score": 4, "last_activity_date": 1554215594, "creation_date": 1554141975, "last_edit_date": 1554215594, "question_id": 55461131, "link": "https://stackoverflow.com/questions/55461131/there-was-an-error-math-big-cannot-unmarshal-into-a-big-int", "title": "There was an error: math/big: cannot unmarshal into a *big.Int", "body": "<p>I am trying to unmarshal a json string into a big int in golang. I get the following error. Is there another way to get this to work? </p>\n\n<blockquote>\n  <p>There was an error: math/big: cannot unmarshal\n  \"\\\"82794247871852158897004947856472973914188862150580220767211643167985440428259\\\"\"\n  into a *big.Int</p>\n</blockquote>\n\n<p>Code:</p>\n\n<p>Playground: <a href=\"https://play.golang.org/p/F5RMehTau8e\" rel=\"nofollow noreferrer\">https://play.golang.org/p/F5RMehTau8e</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n    \"encoding/json\"\n)\n\n\ntype Signature struct {\n    R, S *big.Int\n    V, O uint8 // V is a reconstruction flag and O a multi sig order\n}\n\n\nfunc main() {\n\n    string := []byte(`{\"O\":0,\"R\":\"82794247871852158897004947856472973914188862150580220767211643167985440428259\",\"S\":\"39475619887140601172207943363731402979187092853596849493781395367115389948109\",\"V\":0}`)   \n\n    var sig Signature\n\n    err2 := json.Unmarshal([]byte(string), &amp;sig)\n    if err2 != nil {\n        fmt.Println(\"There was an error:\", err2)\n    }\n    fmt.Println(\"r\", sig.R, \"s\", sig.S, \"o\", sig.O, \"v\", sig.V)\n\n}\n</code></pre>\n"}, {"tags": ["go", "pongo2"], "comments": [{"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1554128700, "post_id": 55456751, "comment_id": 97627769, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/39546834/pongo2-call-golang-function-from-pongo-template\">pongo2 - call golang function from pongo template</a>"}, {"owner": {"reputation": 3, "user_id": 5231702, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7d6998b0dae572bc9bfd0618f71b05d9?s=128&d=identicon&r=PG&f=1", "display_name": "coder0110", "link": "https://stackoverflow.com/users/5231702/coder0110"}, "reply_to_user": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1554182279, "post_id": 55456751, "comment_id": 97645960, "body": "@apxp No that is about registerfilter i am asking about registerfunction"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1554184035, "post_id": 55456751, "comment_id": 97646542, "body": "&quot;it doesn&#39;t fit my exact use-case&quot; - So describe your exact use-case or should we guess what it is? Show some code. Your question is not clear for me and for others. You can edit your question to add some more information."}, {"owner": {"reputation": 3, "user_id": 5231702, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7d6998b0dae572bc9bfd0618f71b05d9?s=128&d=identicon&r=PG&f=1", "display_name": "coder0110", "link": "https://stackoverflow.com/users/5231702/coder0110"}, "reply_to_user": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1554187587, "post_id": 55456751, "comment_id": 97648050, "body": "&quot;it doesn&#39;t fit my exact use-case <b>which is to call a function to get some data and not to filter an input</b>&quot; I want to call a function not a filter that is my usecase."}], "owner": {"reputation": 3, "user_id": 5231702, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7d6998b0dae572bc9bfd0618f71b05d9?s=128&d=identicon&r=PG&f=1", "display_name": "coder0110", "link": "https://stackoverflow.com/users/5231702/coder0110"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 91, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1554127267, "creation_date": 1554126581, "last_edit_date": 1554127267, "question_id": 55456751, "link": "https://stackoverflow.com/questions/55456751/how-can-i-register-a-function-to-use-with-pongo-templates", "title": "How can I register a function to use with pongo templates?", "body": "<p>I want to be able to register a function in pongo2 to be able to use in the template. I don't want to use it as a filter. I want to call it as a function. How can I go about this? I don't see any method to RegisterFunction like I can RegisterFilter</p>\n\n<p>I have tried to use RegisterFilter but it doesn't fit my exact use-case which is to call a function to get some data and not to filter an input</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "is_accepted": true, "score": 1, "last_activity_date": 1554120266, "creation_date": 1554120266, "answer_id": 55454707, "question_id": 55454591, "link": "https://stackoverflow.com/questions/55454591/api-request-and-response/55454707#55454707", "title": "API request and response", "body": "<p>Create a struct of type <code>NssfEventSubscriptionCreatedData</code> initialise its values and return in respondWithJSON.</p>\n\n<pre><code>respData : = NssfEventSubscriptionCreatedData{}\n// init fields\n\n respondWithJson(w, http.StatusCreated, respData)\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 11154131, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Df9Cd5m8YbU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf3t3aLeqiZQsvHjhZOsFrB-0dzvg/mo/photo.jpg?sz=128", "display_name": "Abraham", "link": "https://stackoverflow.com/users/11154131/abraham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 55454707, "answer_count": 1, "score": -2, "last_activity_date": 1554120507, "creation_date": 1554119893, "last_edit_date": 1554120507, "question_id": 55454591, "link": "https://stackoverflow.com/questions/55454591/api-request-and-response", "title": "API request and response", "body": "<p>I would like to find out if it is possible for an HTTP client to POST a specific JSON object and server response with a different JSON object in Go. For a example a client send the JSON object</p>\n\n<p>request body</p>\n\n<pre><code>{\n  \"nfNssaiAvailabilityUri\": \"string\",\n  \"taiList\": [\n    {\n      \"plmnId\": {\n        \"mcc\": \"string\",\n        \"mnc\": \"string\"\n      },\n      \"tac\": \"string\"\n    }\n  ],\n  \"expiry\": \"2019-04-01T10:41:54.344Z\"\n}\n</code></pre>\n\n<p>response body as</p>\n\n<pre><code>{\n  \"subscriptionId\": \"string\",\n  \"expiry\": \"2019-04-01T10:41:54.363Z\",\n  \"authorizedNssaiAvailabilityData\": [\n    {\n      \"tai\": {\n        \"plmnId\": {\n          \"mcc\": \"string\",\n          \"mnc\": \"string\"\n        },\n        \"tac\": \"string\"\n      },\n      \"supportedSnssaiList\": [\n        {\n          \"sst\": 0,\n          \"sd\": \"string\"\n        }\n      ],\n      \"restrictedSnssaiList\": [\n        {\n          \"homePlmnId\": {\n            \"mcc\": \"string\",\n            \"mnc\": \"string\"\n          },\n          \"sNssaiList\": [\n            {\n              \"sst\": 0,\n              \"sd\": \"string\"\n            }\n          ]\n        }\n      ]\n    }\n  ]\n}\n</code></pre>\n\n<p>As you can see, the request body JSON is different from the response. I have structs for both JSONs and currently I can only POST with the request body and receive the same body as response. What am expecting is to be able to get a JSON object indicated in the above response. </p>\n\n<p>I have:</p>\n\n<pre><code>type NssfEventSubscriptionCreateData struct {\n    NfNssaiAvailabilityUri string `json:\"nfNssaiAvailabilityUri\"`\n    TaiList []Tai `json:\"taiList,omitempty\"`\n        ...\n}\n</code></pre>\n\n<pre><code>type NssfEventSubscriptionCreatedData struct {\n    SubscriptionId string `json:\"subscriptionId\"`\n    Expiry time.Time `json:\"expiry,omitempty\"`\n        ....\n}\n</code></pre>\n\n<pre><code>func (m *SliceDataAccess) InsertNssaiSubscriptionInfo(subdata NssfEventSubscriptionCreateData) error {\n    err := db.C(COLLECTION).Insert(subdata)\n    if err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<pre><code>func NSSAIAvailabilityPost(w http.ResponseWriter, r *http.Request) {\n    if r.Header.Get(\"Accept\") != \"application/json\" {\n        WriteError(w, ErrNotAcceptable)\n        return\n    }\n    if r.Method == \"POST\" {\n\n        var reqsubData NssfEventSubscriptionCreateData\n        err := json.NewDecoder(r.Body).Decode(&amp;reqsubData)\n        if err != nil {\n            respondWithError(w, http.StatusBadRequest, \"Object body not well decoded\")\n            return\n        }\n        //reqsubData.ID = bson.NewObjectId()\n        if err := da.InsertNssaiSubscriptionInfo(reqsubData); err != nil {\n            respondWithError(w, http.StatusInternalServerError, err.Error())\n        } else {\n            scheme := \"http\"\n            if r.URL.Scheme != \"\" {\n                scheme = r.URL.Scheme\n            }\n            w.Header().Set(\"Location\", scheme+\"://\"+r.Host+r.URL.Path)\n            w.Header().Set(\"Response-Code\", \"201\")\n            w.Header().Set(\"Response-Desc\", \"Success\")\n            respondWithJson(w, http.StatusCreated, reqsubData)\n        }\n\n    }\n}\n</code></pre>\n\n<p>The <code>NSSAIAvailabilityPost</code> function respond with <code>NssfEventSubscriptionCreateData</code> struct type JSON object but I would like to be able to respond with the <code>NssfEventSubscriptionCreatedData</code> struct type JSON object.</p>\n"}, {"tags": ["go", "syntax-highlighting", "rider"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1554120133, "post_id": 55454406, "comment_id": 97622705, "body": "One way is to use the Go plugin, but I don&#39;t think it&#39;ll work in Rider. You&#39;ll need Goland or IDEA Ultimate."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1554120169, "post_id": 55454406, "comment_id": 97622730, "body": "&quot;and how to install it&quot; - if such plugin exists, it&#39;ll likely be available through the plugin management UI."}, {"owner": {"reputation": 96, "user_id": 10926116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f742d2deab670e39bc1ef75f7222063?s=128&d=identicon&r=PG&f=1", "display_name": "Guy", "link": "https://stackoverflow.com/users/10926116/guy"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1554120492, "post_id": 55454406, "comment_id": 97622887, "body": "I tried to deploy the following with Rider: <a href=\"https://plugins.jetbrains.com/plugin/5047-go-language-golang-org-support-plugin\" rel=\"nofollow noreferrer\">plugins.jetbrains.com/plugin/&hellip;</a> But with no success. what am I missing?"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1554120628, "post_id": 55454406, "comment_id": 97622959, "body": "Hm, it declares that it&#39;s compatible with Rider. In this case, I have no idea. I thought it&#39;s product-locked to goland and ultimate. You have restarted the IDE after installing this plugin, yes?"}, {"owner": {"reputation": 96, "user_id": 10926116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f742d2deab670e39bc1ef75f7222063?s=128&d=identicon&r=PG&f=1", "display_name": "Guy", "link": "https://stackoverflow.com/users/10926116/guy"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1554121707, "post_id": 55454406, "comment_id": 97623556, "body": "yes - restarted"}, {"owner": {"reputation": 136418, "user_id": 783119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bbfd3e5e9f8b698abf7cd1c7aae7a10?s=128&d=identicon&r=PG", "display_name": "LazyOne", "link": "https://stackoverflow.com/users/783119/lazyone"}, "edited": false, "score": 1, "creation_date": 1554124406, "post_id": 55454406, "comment_id": 97625175, "body": "It&#39;s an OLD plugin for OLD IDE versions (before it became standalone IDE). Now it&#39;s GoLand or IntelliJ Ultimate only. New plugin is located here: <a href=\"https://plugins.jetbrains.com/plugin/9568-go\" rel=\"nofollow noreferrer\">plugins.jetbrains.com/plugin/9568-go</a>"}, {"owner": {"reputation": 136418, "user_id": 783119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bbfd3e5e9f8b698abf7cd1c7aae7a10?s=128&d=identicon&r=PG", "display_name": "LazyOne", "link": "https://stackoverflow.com/users/783119/lazyone"}, "edited": false, "score": 1, "creation_date": 1554124630, "post_id": 55454406, "comment_id": 97625318, "body": "Check this blog post as well: <a href=\"https://blog.jetbrains.com/blog/2017/12/01/clarification-on-go-support-plugin-availability-in-intellij-based-ides/\" rel=\"nofollow noreferrer\">blog.jetbrains.com/blog/2017/12/01/&hellip;</a>"}], "owner": {"reputation": 96, "user_id": 10926116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f742d2deab670e39bc1ef75f7222063?s=128&d=identicon&r=PG&f=1", "display_name": "Guy", "link": "https://stackoverflow.com/users/10926116/guy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 230, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1554143996, "creation_date": 1554119307, "last_edit_date": 1554143996, "question_id": 55454406, "link": "https://stackoverflow.com/questions/55454406/how-to-highlight-go-language-syntax-in-rider-ide", "title": "How to highlight Go language syntax in Rider IDE", "body": "<p>I have a C# project in RIDER</p>\n\n<p>I need to work with some GO code within my C# project in RIDER\nThe GO code is not running - just there because we need to show it in the UI when the program will run.</p>\n\n<p>How can I make RIDER highlight the GO language syntax while developing ?</p>\n\n<p>I have the GoLand IDE - but its not what I need.....\nI would like Rider to color the text</p>\n\n<p>What plugin is needed ?\nAnd how to install it ?</p>\n\n<p><a href=\"https://i.stack.imgur.com/skmg8.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/skmg8.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2553, "user_id": 5198756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6xLRL.png?s=128&g=1", "display_name": "ifnotak", "link": "https://stackoverflow.com/users/5198756/ifnotak"}, "edited": false, "score": 1, "creation_date": 1554112401, "post_id": 55452253, "comment_id": 97618401, "body": "is it <code>&#47;resources&#47;</code> or <code>.&#47;resources&#47;</code>?"}, {"owner": {"reputation": 1786, "user_id": 5383281, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qhNkSRFReEE/AAAAAAAAAAI/AAAAAAAAA6w/kmJaxw-_9rw/photo.jpg?sz=128", "display_name": "Mebin Joe", "link": "https://stackoverflow.com/users/5383281/mebin-joe"}, "edited": false, "score": 1, "creation_date": 1554112424, "post_id": 55452253, "comment_id": 97618412, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/21234639/golang-gorilla-mux-with-http-fileserver-returning-404\">Golang Gorilla mux with http.FileServer returning 404</a>"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 2, "creation_date": 1554119888, "post_id": 55452253, "comment_id": 97622573, "body": "How is your file structure of your project? Where is the resources folder compared to your binary or working directory?"}, {"owner": {"reputation": 65, "user_id": 6204903, "user_type": "registered", "profile_image": "https://graph.facebook.com/618084328346561/picture?type=large", "display_name": "Virtus", "link": "https://stackoverflow.com/users/6204903/virtus"}, "edited": false, "score": 0, "creation_date": 1554132063, "post_id": 55452253, "comment_id": 97629804, "body": "I use mux router handler for static file and I fixed it.  Thanks for help!"}], "owner": {"reputation": 65, "user_id": 6204903, "user_type": "registered", "profile_image": "https://graph.facebook.com/618084328346561/picture?type=large", "display_name": "Virtus", "link": "https://stackoverflow.com/users/6204903/virtus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 514, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1554113223, "creation_date": 1554112153, "last_edit_date": 1554113223, "question_id": 55452253, "link": "https://stackoverflow.com/questions/55452253/how-to-get-image-url-from-golang-api-server-folder", "title": "How to get image url from golang-api server folder", "body": "<p>I have images folder in golang-api project and I want get an image url. </p>\n\n<p>I tried by </p>\n\n<pre><code>http.Handle(\"/resources/\", http.StripPrefix(\"/resources/\", http.FileServer(http.Dir(\"resources\"))))\n</code></pre>\n\n<p>And I call url: </p>\n\n<pre><code>localhost:3000/resources/[images-name]\n</code></pre>\n\n<p>but I received <code>404</code> error when I call the url</p>\n"}, {"tags": ["authentication", "go", "google-cloud-platform", "google-cloud-ml"], "answers": [{"comments": [{"owner": {"reputation": 177, "user_id": 9022359, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-6R4yW8qwpC4/AAAAAAAAAAI/AAAAAAAAAAc/FN8-Wu-zaXY/photo.jpg?sz=128", "display_name": "being of habits", "link": "https://stackoverflow.com/users/9022359/being-of-habits"}, "edited": false, "score": 0, "creation_date": 1554186934, "post_id": 55467937, "comment_id": 97647708, "body": "Marked as an answer, but unfortunately came up with it by myself Anyway, 10q for a reply; feel more confident now"}, {"owner": {"reputation": 209, "user_id": 4159612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/249c29c9cfb8841b9720974eca56e1b0?s=128&d=identicon&r=PG&f=1", "display_name": "Bhupesh", "link": "https://stackoverflow.com/users/4159612/bhupesh"}, "reply_to_user": {"reputation": 177, "user_id": 9022359, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-6R4yW8qwpC4/AAAAAAAAAAI/AAAAAAAAAAc/FN8-Wu-zaXY/photo.jpg?sz=128", "display_name": "being of habits", "link": "https://stackoverflow.com/users/9022359/being-of-habits"}, "edited": false, "score": 0, "creation_date": 1554269385, "post_id": 55467937, "comment_id": 97683670, "body": "glad you found it!"}], "tags": [], "owner": {"reputation": 209, "user_id": 4159612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/249c29c9cfb8841b9720974eca56e1b0?s=128&d=identicon&r=PG&f=1", "display_name": "Bhupesh", "link": "https://stackoverflow.com/users/4159612/bhupesh"}, "is_accepted": true, "score": 1, "last_activity_date": 1554185148, "creation_date": 1554185148, "answer_id": 55467937, "question_id": 55451308, "link": "https://stackoverflow.com/questions/55451308/ways-to-provide-authorisation-header-to-use-google-ml-engine/55467937#55467937", "title": "Ways to provide authorisation header to use google ml-engine", "body": "<p>You might find this useful. <a href=\"https://github.com/GoogleCloudPlatform/python-docs-samples/blob/master/ml_engine/online_prediction/predict.py\" rel=\"nofollow noreferrer\">https://github.com/GoogleCloudPlatform/python-docs-samples/blob/master/ml_engine/online_prediction/predict.py</a></p>\n\n<p>Especially these lines:</p>\n\n<pre><code># Create the ML Engine service object.\n# To authenticate set the environment variable\n# GOOGLE_APPLICATION_CREDENTIALS=&lt;path_to_service_account_file&gt;\nservice = googleapiclient.discovery.build('ml', 'v1')\nname = 'projects/{}/models/{}'.format(project, model)\n\nif version is not None:\n    name += '/versions/{}'.format(version)\n\nresponse = service.projects().predict(\n    name=name,\n    body={'instances': instances}\n).execute()\n</code></pre>\n\n<p>You can create the service account file from the project IAM page and download the token onto the VM.</p>\n"}], "owner": {"reputation": 177, "user_id": 9022359, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-6R4yW8qwpC4/AAAAAAAAAAI/AAAAAAAAAAc/FN8-Wu-zaXY/photo.jpg?sz=128", "display_name": "being of habits", "link": "https://stackoverflow.com/users/9022359/being-of-habits"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 1, "accepted_answer_id": 55467937, "answer_count": 1, "score": 1, "last_activity_date": 1554185148, "creation_date": 1554108863, "question_id": 55451308, "link": "https://stackoverflow.com/questions/55451308/ways-to-provide-authorisation-header-to-use-google-ml-engine", "title": "Ways to provide authorisation header to use google ml-engine", "body": "<p>I've currently got involved in a project using GCP Ml-engine. It's already set &amp; ready so my task is to use it's predict command to leverage the API. The whole project exists in VM instance so I want to know, does it help to get access token in a more concise way? I mean, SDK or something like that, because I didn't find anything useful. If not, what are my options here? JWT?</p>\n"}, {"tags": ["go", "generate"], "comments": [{"owner": {"reputation": 34, "user_id": 4053730, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K43yr9BGrRg/AAAAAAAAAAI/AAAAAAAAAEk/B3PNv7TkDq8/photo.jpg?sz=128", "display_name": "Magestro", "link": "https://stackoverflow.com/users/4053730/magestro"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1554118999, "post_id": 55451280, "comment_id": 97622085, "body": "<code>stringer</code> generates String method and when i try to generate it to the same type in separated packages it don&#39;t work &#39;cause can&#39;t create new method String(and didn&#39;t update old)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1554120031, "post_id": 55451280, "comment_id": 97622653, "body": "You&#39;re right, that doesn&#39;t work."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1554120222, "creation_date": 1554120222, "answer_id": 55454695, "question_id": 55451280, "link": "https://stackoverflow.com/questions/55451280/how-to-gogenerate-stringer-constants-from-multiple-packages/55454695#55454695", "title": "How to go:generate stringer constants from multiple packages?", "body": "<p><a href=\"https://godoc.org/golang.org/x/tools/cmd/stringer\" rel=\"nofollow noreferrer\"><code>golang.org/x/tools/cmd/stringer</code></a> doesn't support this. Quoting from its doc:</p>\n\n<blockquote>\n  <p>With no arguments, it processes the package in the current directory. Otherwise, the arguments must name a single directory holding a Go package or a set of Go source files that represent a single Go package.</p>\n</blockquote>\n\n<p>Easiest solution would be to put all enum values in the same package. You may use separate files, but they must be in the same package.</p>\n\n<p>If you want / must use multiple packages, you can only do this with <code>stringer</code> if you use different types, each defined in the package in which you list the constants.</p>\n"}, {"tags": [], "owner": {"reputation": 677, "user_id": 7804910, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xFJHR.jpg?s=128&g=1", "display_name": "Victor Deleau", "link": "https://stackoverflow.com/users/7804910/victor-deleau"}, "is_accepted": false, "score": 0, "last_activity_date": 1611770577, "creation_date": 1611770577, "answer_id": 65924800, "question_id": 55451280, "link": "https://stackoverflow.com/questions/55451280/how-to-gogenerate-stringer-constants-from-multiple-packages/65924800#65924800", "title": "How to go:generate stringer constants from multiple packages?", "body": "<p>It is in fact possible to generate the Stringer interface on multiple packages: more specifically on <strong>all</strong> packages contained in a directory (recursively). Just use</p>\n<pre><code>$ go generate ./...\n</code></pre>\n<p>This is just like <code>go test ./...</code> which allows you to execute all tests contained in a directory recursively.</p>\n"}], "owner": {"reputation": 34, "user_id": 4053730, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K43yr9BGrRg/AAAAAAAAAAI/AAAAAAAAAEk/B3PNv7TkDq8/photo.jpg?sz=128", "display_name": "Magestro", "link": "https://stackoverflow.com/users/4053730/magestro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 747, "favorite_count": 0, "accepted_answer_id": 55454695, "answer_count": 2, "score": 2, "last_activity_date": 1611770577, "creation_date": 1554108783, "last_edit_date": 1554116692, "question_id": 55451280, "link": "https://stackoverflow.com/questions/55451280/how-to-gogenerate-stringer-constants-from-multiple-packages", "title": "How to go:generate stringer constants from multiple packages?", "body": "<p>I have a struct like this: </p>\n\n<pre><code>.foo/bar/constants.go\n.foo/constants.go\n.main.go \n</code></pre>\n\n<p>In <code>main.go</code> I declare the type:</p>\n\n<pre><code>package agepack\ntype EventType uint\n//go:generate stringer -type EventType\nconst (\n    FirstType EventType iota\n    SecondType\n    ....\n)\n</code></pre>\n\n<p>In each <code>constants.go</code> I have soimething like this: </p>\n\n<pre><code>package foo\nconst (\n   OneMoreType agepack.EventType = 100 + iota\n)\n</code></pre>\n\n<p>How can I generate stringer with values from all packages?</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 1, "creation_date": 1554106790, "post_id": 55450689, "comment_id": 97615603, "body": "Use <code>`{(\\w+)}`</code>"}, {"owner": {"reputation": 151, "user_id": 9148161, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh6.googleusercontent.com/-jv8zt6uYZ9Y/AAAAAAAAAAI/AAAAAAAAE1Y/EcmnHvHIAfY/photo.jpg?sz=128", "display_name": "Anh Vinh Hu\u1ef3nh", "link": "https://stackoverflow.com/users/9148161/anh-vinh-hu%e1%bb%b3nh"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1554107067, "post_id": 55450689, "comment_id": 97615754, "body": "It&#39;s not work, bro @WiktorStribi\u017cew. :("}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1554108296, "post_id": 55450689, "comment_id": 97616320, "body": "It does, see <a href=\"https://stackoverflow.com/a/55450851/3832970\">my answer below</a>."}], "answers": [{"tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 3, "last_activity_date": 1554107291, "creation_date": 1554107291, "answer_id": 55450851, "question_id": 55450689, "link": "https://stackoverflow.com/questions/55450689/regex-find-many-word-in-the-string/55450851#55450851", "title": "Regex find many word in the string", "body": "<p>You may use the following pattern with <a href=\"https://golang.org/pkg/regexp/#Regexp.FindAllStringSubmatch\" rel=\"nofollow noreferrer\"><code>FindAllStringSubmatch</code></a>:</p>\n\n<pre><code>{(\\w+)}\n</code></pre>\n\n<p>See the Go regexp documentation:</p>\n\n<blockquote>\n  <p><code>FindAllStringSubmatch</code> is the 'All' version of <code>FindStringSubmatch</code>; it returns a slice of all successive matches of the expression, as defined by the 'All' description in the package comment. A return value of nil indicates no match.</p>\n</blockquote>\n\n<p>and</p>\n\n<blockquote>\n  <p><code>FindStringSubmatch</code> returns a slice of strings holding the text of the leftmost match of the regular expression in <code>s</code> <strong>and the matches, if any, of its subexpressions</strong>, as defined by the 'Submatch' description in the package comment. A return value of nil indicates no match.</p>\n</blockquote>\n\n<p>See the <a href=\"https://play.golang.org/p/LeQGbV0lLKv\" rel=\"nofollow noreferrer\">Go demo</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    s := `payment://pay?id={appid}&amp;transtoken={transtoken}`\n    rex := regexp.MustCompile(`{(\\w+)}`)\n    results := rex.FindAllStringSubmatch(s,-1)\n    for _, value := range results  {\n        fmt.Printf(\"%q\\n\", value[1])\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>\"appid\"\n\"transtoken\"\n</code></pre>\n"}], "owner": {"reputation": 151, "user_id": 9148161, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh6.googleusercontent.com/-jv8zt6uYZ9Y/AAAAAAAAAAI/AAAAAAAAE1Y/EcmnHvHIAfY/photo.jpg?sz=128", "display_name": "Anh Vinh Hu\u1ef3nh", "link": "https://stackoverflow.com/users/9148161/anh-vinh-hu%e1%bb%b3nh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "accepted_answer_id": 55450851, "answer_count": 1, "score": 2, "last_activity_date": 1554108254, "creation_date": 1554106741, "last_edit_date": 1554108254, "question_id": 55450689, "link": "https://stackoverflow.com/questions/55450689/regex-find-many-word-in-the-string", "title": "Regex find many word in the string", "body": "<p>I want to get all work in string - that are between the pair of <code>{word}</code></p>\n\n<p>Example: </p>\n\n<pre><code>payment://pay?id={appid}&amp;transtoken={transtoken}\n</code></pre>\n\n<p>Result expect: </p>\n\n<pre><code>[\"appid\", \"transtoken\"]\n</code></pre>\n\n<p>With regex partern: <code>{\\w+}</code>, I only can get <code>[{appid}, {transtoken}]</code>. </p>\n\n<p>Please help me with the problem.</p>\n"}, {"tags": ["go", "build", "glibc", "dynamic-linking", "libc"], "answers": [{"tags": [], "owner": {"reputation": 552, "user_id": 3997040, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KHmE9.jpg?s=128&g=1", "display_name": "bitbyter", "link": "https://stackoverflow.com/users/3997040/bitbyter"}, "is_accepted": true, "score": 4, "last_activity_date": 1554122696, "creation_date": 1554122696, "answer_id": 55455448, "question_id": 55450061, "link": "https://stackoverflow.com/questions/55450061/go-build-with-another-glibc/55455448#55455448", "title": "Go build with another glibc", "body": "<p>Before doing <code>go build</code>\nSet </p>\n\n<blockquote>\n  <p>CGO_LDFLAGS</p>\n</blockquote>\n\n<p>Dynamic:</p>\n\n<pre><code>export CGO_LDFLAGS=\"-Xlinker -rpath=/path/to/another_glibc/lib\"\n</code></pre>\n\n<p>Static:</p>\n\n<pre><code>export CGO_LDFLAGS=\"-Xlinker -rpath=/path/to/another_glibc/lib -static\"\n</code></pre>\n\n<p>CGO_LDFLAGS lets you set GCC-like ld flags for Go.</p>\n"}, {"tags": [], "owner": {"reputation": 26934, "user_id": 8316315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44d833a8a46fea39d7bfca1540ea9c07?s=128&d=identicon&r=PG&f=1", "display_name": "Florian Weimer", "link": "https://stackoverflow.com/users/8316315/florian-weimer"}, "is_accepted": false, "score": 1, "last_activity_date": 1589518656, "creation_date": 1589518656, "answer_id": 61812048, "question_id": 55450061, "link": "https://stackoverflow.com/questions/55450061/go-build-with-another-glibc/61812048#61812048", "title": "Go build with another glibc", "body": "<p><a href=\"https://stackoverflow.com/a/55455448/8316315\">bitbyter's answer</a> is not correct for the dynamic case because it requires that the system dynamic linker is compatible with the non-system glibc, which is unlikely. You can set the dynamic linker like this:</p>\n\n<pre><code>export CGO_LDFLAGS=\"-Xlinker -rpath=/path/to/another_glibc/lib64\"\nCGO_LDFLAGS=\"$CGO_LDFLAGS -Xlinker --dynamic-linker=\"/path/to/another_glibc/lib64/ld-linux-x86-64.so.2\"\n</code></pre>\n\n<p>The dynamic linker name is specific to the architecture, so you have to research its name.</p>\n"}], "owner": {"reputation": 552, "user_id": 3997040, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KHmE9.jpg?s=128&g=1", "display_name": "bitbyter", "link": "https://stackoverflow.com/users/3997040/bitbyter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3139, "favorite_count": 2, "accepted_answer_id": 55455448, "answer_count": 2, "score": 8, "last_activity_date": 1589518656, "creation_date": 1554103915, "last_edit_date": 1554105561, "question_id": 55450061, "link": "https://stackoverflow.com/questions/55450061/go-build-with-another-glibc", "title": "Go build with another glibc", "body": "<p>I have installed another version of GLIBC and want to compile Golang code against this new GLIBC.</p>\n\n<p>I have tried the following command for dynamic compilation:</p>\n\n<pre><code>go build --ldflags '-linkmode external -L /path/to/another_glibc/\n</code></pre>\n\n<p>But when I run ldd <code>\"go_executable\"</code>, it still shows linked to default glibc.</p>\n\n<p><strong>Output:</strong></p>\n\n<pre><code>linux-vdso.so.1 =&gt;  (0x00007fff29da7000)\nlibc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f128a93c000)\n/lib64/ld-linux-x86-64.so.2 (0x00007f128ad06000)\n</code></pre>\n\n<p><strong>Expected Output:</strong></p>\n\n<pre><code>linux-vdso.so.1 =&gt;  (0x00007fff45fa7000)\nlibc.so.6 =&gt; /another_glibc/lib/libc.so.6 (0x00007f5cd2067000)\n/another_glibc/ld-2.29.so =&gt; /lib64/ld-linux-x86-64.so.2 (0x00007f5cd2420000)\n</code></pre>\n\n<p>What is missing here?</p>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 11114673, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-jVOCmzjo_v0/AAAAAAAAAAI/AAAAAAAARDE/zKnyRHt19Zg/photo.jpg?sz=128", "display_name": "slzhffktm", "link": "https://stackoverflow.com/users/11114673/slzhffktm"}, "is_accepted": false, "score": 0, "last_activity_date": 1602136023, "creation_date": 1602136023, "answer_id": 64256492, "question_id": 55449722, "link": "https://stackoverflow.com/questions/55449722/create-or-update-is-not-returning-updated-value-in-gorm/64256492#64256492", "title": "Create or Update is not returning updated value in GORM", "body": "<p>What you can do so that GORM will automatically pick it up (add <code>RETURNING</code> clause for the field) is by adding the <code>default</code> tag on the field. This is a bit hackish, but it works tho.</p>\n<pre class=\"lang-golang prettyprint-override\"><code>    LastSentMessageSeq int64 `gorm:&quot;default:0&quot;`\n</code></pre>\n"}], "owner": {"reputation": 7898, "user_id": 1382297, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/fVj5O.jpg?s=128&g=1", "display_name": "avi", "link": "https://stackoverflow.com/users/1382297/avi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1534, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1602136023, "creation_date": 1554102605, "question_id": 55449722, "link": "https://stackoverflow.com/questions/55449722/create-or-update-is-not-returning-updated-value-in-gorm", "title": "Create or Update is not returning updated value in GORM", "body": "<p>Following is my model:</p>\n\n<pre><code>type Room struct {\n    PK        string `sql:\"size:255;not null;\"gorm:\"primary_key\"`\n    CreatedAt time.Time\n    UpdatedAt time.Time\n    DeletedAt *time.Time\n\n    LastSentMessageSeq int64\n    RoomID             string `sql:\"size:255;not null;\"gorm:\"unique_index:rooms_room_id_client_id\"`\n    User               User\n    UserID             string `sql:\"size:255;not null\"`\n    Client             Client\n    ClientID           string `sql:\"size:255;not null\"gorm:\"unique_index:rooms_room_id_client_id\"`\n}\n</code></pre>\n\n<p>I am using Postgres. I am trying to do update or create operation. If row exists, increment <code>LastSentMessageSeq</code> field or else insert a new one.  Following is my code:</p>\n\n<pre><code>var room = Room{ClientID: clientID, RoomID: roomID, UserID: usedID, LastSentMessageSeq: 10}\nerr := ws.db.Set(\"gorm:insert_option\", \"ON CONFLICT (room_id, client_id) DO UPDATE SET last_sent_message_seq = rooms.last_sent_message_seq + 1\").Create(&amp;room).Error\nlog.Println(err)\nlog.Println(room)\n</code></pre>\n\n<p>However, when I print the room object, it does not have the updated value for the field <code>LastSentMessageSeq</code>. But I can see it is doing upsert operation, i.e. it creates a new row if it does not exist or updates the value of LastSentMessageSeq in the database</p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1554090946, "post_id": 55447879, "comment_id": 97610402, "body": "person is a string in your code, not a struct. If you JSON unmarshal it into a struct value, then the template code can use reflection to access the fields like id etc."}], "answers": [{"tags": [], "owner": {"reputation": 579, "user_id": 11206879, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bS2D6.png?s=128&g=1", "display_name": "Pan Ke", "link": "https://stackoverflow.com/users/11206879/pan-ke"}, "is_accepted": true, "score": 2, "last_activity_date": 1554090990, "creation_date": 1554090990, "answer_id": 55447914, "question_id": 55447879, "link": "https://stackoverflow.com/questions/55447879/cant-evaluate-field-field-in-type-string/55447914#55447914", "title": "Can&#39;t evaluate field &lt;field&gt; in type string", "body": "<p>template can't directly apply to string, you should create a struct then unmarshal your JSON string to the struct instance. <a href=\"https://play.golang.org/p/45h106YG55M\" rel=\"nofollow noreferrer\">try the code</a></p>\n"}], "owner": {"reputation": 151, "user_id": 9148161, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh6.googleusercontent.com/-jv8zt6uYZ9Y/AAAAAAAAAAI/AAAAAAAAE1Y/EcmnHvHIAfY/photo.jpg?sz=128", "display_name": "Anh Vinh Hu\u1ef3nh", "link": "https://stackoverflow.com/users/9148161/anh-vinh-hu%e1%bb%b3nh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1495, "favorite_count": 0, "accepted_answer_id": 55447914, "answer_count": 1, "score": 1, "last_activity_date": 1554098470, "creation_date": 1554090483, "last_edit_date": 1554098470, "question_id": 55447879, "link": "https://stackoverflow.com/questions/55447879/cant-evaluate-field-field-in-type-string", "title": "Can&#39;t evaluate field &lt;field&gt; in type string", "body": "<p>I'm used <code>text/template</code> in golang package to parse text with environment in json string. </p>\n\n<p>Example: <a href=\"https://play.golang.org/p/uARnrOyG4Th\" rel=\"nofollow noreferrer\">https://play.golang.org/p/uARnrOyG4Th</a></p>\n\n<p>But I have an error: <code>2009/11/10 23:00:00 Execute: template: Person template:1:19: executing \"Person template\" at &lt;.id&gt;: can't evaluate field id in type string</code> </p>\n\n<p>Please help me with problem. I couldn't find the error based on the library's documents. </p>\n"}, {"tags": ["api", "go", "beego"], "comments": [{"owner": {"reputation": 5432, "user_id": 4723732, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/77fa71fdc548472c228be40043c1bc1f?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Rublev", "link": "https://stackoverflow.com/users/4723732/richard-rublev"}, "edited": false, "score": 0, "creation_date": 1554100514, "post_id": 55447860, "comment_id": 97612841, "body": "May be you should use struct tags for array."}], "answers": [{"tags": [], "owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "is_accepted": true, "score": 1, "last_activity_date": 1554100975, "creation_date": 1554100975, "answer_id": 55449343, "question_id": 55447860, "link": "https://stackoverflow.com/questions/55447860/slice-groupby-array/55449343#55449343", "title": "slice, groupBy []array", "body": "<pre><code>for _, sg := range server {\n  if(sg.Status == \"available\" &amp;&amp; sg.Bootable == \"false\"){\n     jsons[\"Data\"] = sg\n  }\n}\n</code></pre>\n\n<p>It worked perfectly. I just found it.</p>\n"}], "owner": {"reputation": 598, "user_id": 9629581, "user_type": "registered", "profile_image": "https://graph.facebook.com/1204435359699826/picture?type=large", "display_name": "Bilguun", "link": "https://stackoverflow.com/users/9629581/bilguun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "accepted_answer_id": 55449343, "answer_count": 1, "score": 0, "last_activity_date": 1554101913, "creation_date": 1554090304, "last_edit_date": 1554101913, "question_id": 55447860, "link": "https://stackoverflow.com/questions/55447860/slice-groupby-array", "title": "slice, groupBy []array", "body": "<p>I've got all servere problems by as a []array. Problem is how to slice(groupBy) status,bootable. I just wanna take as status = available, bootable = false</p>\n\n<p><strong>Controller</strong></p>\n\n<pre><code>slicedBy := make(map[string]interface{})\n\nserver := blockstorage.ListVolumes(tenantID.(string))   &lt;----- this is array\n\nfor _, sg := range server{\n    slicedBy[sg.ID] = sg.Status                    &lt;------- slice by Status\n    slicedBy[sg.ID] = sg.Bootable                &lt;------- slice by Bootable\n}\n</code></pre>\n\n<p><strong>Json array</strong></p>\n\n<pre><code>{\n   id        123\n   status    available\n   bootable  false\n   ...\n}\n</code></pre>\n\n<p><strong>server as array</strong></p>\n\n<pre><code>[\n    {\n        \"id\": \"a8b123fc-a141-4682-b65b-d56899621959\",\n        \"status\": \"available\",\n        \"size\": 1,\n        \"availability_zone\": \"nova\",\n        \"attachments\": [],\n        \"name\": \"snapshot 1\",\n        \"description\": \"\",\n        \"bootable\": \"false\",\n    },\n    {\n        \"id\": \"ccb734d4-c098-4929-8ce5-281b6a58421d\",\n        \"status\": \"error\",\n        \"size\": 2,\n        \"availability_zone\": \"nova\",\n        \"attachments\": [],\n        \"name\": \"\",\n        \"description\": \"\",\n        \"volume_type\": \"\",\n        \"bootable\": \"false\",\n        \"volume_image_metadata\": {\n            \"signature_verified\": \"False\"\n        }\n    },\n</code></pre>\n"}, {"tags": ["javascript", "go", "vue.js", "cors", "axios"], "comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1554088542, "post_id": 55447568, "comment_id": 97609926, "body": "Not familiar with go-chi/cors, but are you sure CORS is set up correctly? You most likely have it correct for your first POST request, but not for the second GET request. The error clearly shows no Allowed Origin header on the 2nd API."}, {"owner": {"reputation": 2048, "user_id": 1116098, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/skrd5.jpg?s=128&g=1", "display_name": "Sean Francis N. Ballais", "link": "https://stackoverflow.com/users/1116098/sean-francis-n-ballais"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1554089481, "post_id": 55447568, "comment_id": 97610139, "body": "@colminator I accidentally left the details for the second request. The second request is also a <code>POST</code> request."}, {"owner": {"reputation": 1313, "user_id": 10701396, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zJEYh.jpg?s=128&g=1", "display_name": "Ben Yaakobi", "link": "https://stackoverflow.com/users/10701396/ben-yaakobi"}, "edited": false, "score": 1, "creation_date": 1554089554, "post_id": 55447568, "comment_id": 97610154, "body": "Please check the <code>OPTIONS</code> request that is being sent to the server and the response and, if you could, post them here"}, {"owner": {"reputation": 2048, "user_id": 1116098, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/skrd5.jpg?s=128&g=1", "display_name": "Sean Francis N. Ballais", "link": "https://stackoverflow.com/users/1116098/sean-francis-n-ballais"}, "reply_to_user": {"reputation": 1313, "user_id": 10701396, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zJEYh.jpg?s=128&g=1", "display_name": "Ben Yaakobi", "link": "https://stackoverflow.com/users/10701396/ben-yaakobi"}, "edited": false, "score": 0, "creation_date": 1554090011, "post_id": 55447568, "comment_id": 97610235, "body": "@BenYaakobi, I have added the <code>OPTIONS</code> request to the question."}, {"owner": {"reputation": 1313, "user_id": 10701396, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zJEYh.jpg?s=128&g=1", "display_name": "Ben Yaakobi", "link": "https://stackoverflow.com/users/10701396/ben-yaakobi"}, "edited": false, "score": 0, "creation_date": 1554090083, "post_id": 55447568, "comment_id": 97610247, "body": "Is this the only request that is sent to server? Could you attach the response too?"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1554090259, "post_id": 55447568, "comment_id": 97610287, "body": "I concur with Ben - see if the browser is issuing an OPTIONS  method (r.Method==&quot;OPTIONS&quot;) in your graphql route. Perhaps the browser has cached CORS data which does not match your current server configuration?"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1554090450, "post_id": 55447568, "comment_id": 97610320, "body": "The response header for OPTIONS does not have an Origin. So it will not honor your request - as per the browser error listed."}, {"owner": {"reputation": 2048, "user_id": 1116098, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/skrd5.jpg?s=128&g=1", "display_name": "Sean Francis N. Ballais", "link": "https://stackoverflow.com/users/1116098/sean-francis-n-ballais"}, "reply_to_user": {"reputation": 1313, "user_id": 10701396, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zJEYh.jpg?s=128&g=1", "display_name": "Ben Yaakobi", "link": "https://stackoverflow.com/users/10701396/ben-yaakobi"}, "edited": false, "score": 0, "creation_date": 1554090616, "post_id": 55447568, "comment_id": 97610350, "body": "@BenYaakobi, there are previous requests that are sent to the server, all <code>POST</code>s and <code>OPTION</code>s but they were by <code>searchBar</code> component. I have attached the additional details as well."}, {"owner": {"reputation": 2048, "user_id": 1116098, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/skrd5.jpg?s=128&g=1", "display_name": "Sean Francis N. Ballais", "link": "https://stackoverflow.com/users/1116098/sean-francis-n-ballais"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1554090986, "post_id": 55447568, "comment_id": 97610406, "body": "@colminator, that is something I find quite odd. The first request receives `&quot;Access-Control-Allow-*&quot; headers, but not the second one."}, {"owner": {"reputation": 5029, "user_id": 1256909, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/QGGko.png?s=128&g=1", "display_name": "Rejoanul Alam", "link": "https://stackoverflow.com/users/1256909/rejoanul-alam"}, "edited": false, "score": 0, "creation_date": 1554091752, "post_id": 55447568, "comment_id": 97610538, "body": "For local you can try it <a href=\"https://stackoverflow.com/questions/54545554/access-control-allow-origin-laravel-vue-cors-corb-error-on-localhost\" title=\"access control allow origin laravel vue cors corb error on localhost\">stackoverflow.com/questions/54545554/&hellip;</a>"}, {"owner": {"reputation": 2048, "user_id": 1116098, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/skrd5.jpg?s=128&g=1", "display_name": "Sean Francis N. Ballais", "link": "https://stackoverflow.com/users/1116098/sean-francis-n-ballais"}, "reply_to_user": {"reputation": 5029, "user_id": 1256909, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/QGGko.png?s=128&g=1", "display_name": "Rejoanul Alam", "link": "https://stackoverflow.com/users/1256909/rejoanul-alam"}, "edited": false, "score": 0, "creation_date": 1554092140, "post_id": 55447568, "comment_id": 97610605, "body": "@RejoanulAlam, thanks, but I find it impractical if I disable security mode in Chrome. It feels like fixing the symptom and not the root cause."}, {"owner": {"reputation": 5029, "user_id": 1256909, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/QGGko.png?s=128&g=1", "display_name": "Rejoanul Alam", "link": "https://stackoverflow.com/users/1256909/rejoanul-alam"}, "edited": false, "score": 0, "creation_date": 1554092299, "post_id": 55447568, "comment_id": 97610639, "body": "@SeanFrancisN.Ballais This will not happen in production &amp; browsers disable it for security, this is mentioned in chrome spcification"}, {"owner": {"reputation": 2048, "user_id": 1116098, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/skrd5.jpg?s=128&g=1", "display_name": "Sean Francis N. Ballais", "link": "https://stackoverflow.com/users/1116098/sean-francis-n-ballais"}, "reply_to_user": {"reputation": 5029, "user_id": 1256909, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/QGGko.png?s=128&g=1", "display_name": "Rejoanul Alam", "link": "https://stackoverflow.com/users/1256909/rejoanul-alam"}, "edited": false, "score": 0, "creation_date": 1554092558, "post_id": 55447568, "comment_id": 97610676, "body": "@RejoanulAlam, why would browsers disable web security mode if it is for security?"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1554092963, "post_id": 55447568, "comment_id": 97610747, "body": "Please update the question to include your CORS setup. That is clearly the source of the problem."}, {"owner": {"reputation": 2048, "user_id": 1116098, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/skrd5.jpg?s=128&g=1", "display_name": "Sean Francis N. Ballais", "link": "https://stackoverflow.com/users/1116098/sean-francis-n-ballais"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1554093595, "post_id": 55447568, "comment_id": 97610877, "body": "@colminator, there ya&#39; go. I updated it."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1554093893, "post_id": 55447568, "comment_id": 97610936, "body": "Again not family which chi - but is the middleware handlers order correct? Try putting CORS first instead of last in the router list."}, {"owner": {"reputation": 2048, "user_id": 1116098, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/skrd5.jpg?s=128&g=1", "display_name": "Sean Francis N. Ballais", "link": "https://stackoverflow.com/users/1116098/sean-francis-n-ballais"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1554094242, "post_id": 55447568, "comment_id": 97611008, "body": "@colminator, the call from my <code>searchResults</code> component still fails, but the call from my <code>searchBar</code> component works."}, {"owner": {"reputation": 5029, "user_id": 1256909, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/QGGko.png?s=128&g=1", "display_name": "Rejoanul Alam", "link": "https://stackoverflow.com/users/1256909/rejoanul-alam"}, "edited": false, "score": 0, "creation_date": 1554094437, "post_id": 55447568, "comment_id": 97611046, "body": "@SeanFrancisN.Ballais for local test no security required"}, {"owner": {"reputation": 2048, "user_id": 1116098, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/skrd5.jpg?s=128&g=1", "display_name": "Sean Francis N. Ballais", "link": "https://stackoverflow.com/users/1116098/sean-francis-n-ballais"}, "reply_to_user": {"reputation": 5029, "user_id": 1256909, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/QGGko.png?s=128&g=1", "display_name": "Rejoanul Alam", "link": "https://stackoverflow.com/users/1256909/rejoanul-alam"}, "edited": false, "score": 1, "creation_date": 1554094554, "post_id": 55447568, "comment_id": 97611067, "body": "@RejoanulAlam, yes, for local test no security is required. But, it is much preferable to match the dev/local with what would be in production."}], "answers": [{"comments": [{"owner": {"reputation": 2048, "user_id": 1116098, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/skrd5.jpg?s=128&g=1", "display_name": "Sean Francis N. Ballais", "link": "https://stackoverflow.com/users/1116098/sean-francis-n-ballais"}, "edited": false, "score": 0, "creation_date": 1554094654, "post_id": 55448312, "comment_id": 97611090, "body": "Double API? I must have confused you. I apologize. The requests are calling to the same single API."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 2048, "user_id": 1116098, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/skrd5.jpg?s=128&g=1", "display_name": "Sean Francis N. Ballais", "link": "https://stackoverflow.com/users/1116098/sean-francis-n-ballais"}, "edited": false, "score": 0, "creation_date": 1554094798, "post_id": 55448312, "comment_id": 97611118, "body": "I understood your code. Double in the sense you are calling it twice."}, {"owner": {"reputation": 2048, "user_id": 1116098, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/skrd5.jpg?s=128&g=1", "display_name": "Sean Francis N. Ballais", "link": "https://stackoverflow.com/users/1116098/sean-francis-n-ballais"}, "edited": false, "score": 0, "creation_date": 1554095350, "post_id": 55448312, "comment_id": 97611251, "body": "Oh. I see. I think double API setup is misleading. Anyhow, perhaps setting it manually is workable."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 2048, "user_id": 1116098, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/skrd5.jpg?s=128&g=1", "display_name": "Sean Francis N. Ballais", "link": "https://stackoverflow.com/users/1116098/sean-francis-n-ballais"}, "edited": false, "score": 0, "creation_date": 1554096471, "post_id": 55448312, "comment_id": 97611525, "body": "One final thought: In the handler of the (2nd) API call is there any possible http error reporting? If so, writing error codes out of order from header-writes can lead to headers (Origin in this case) from never being sent."}, {"owner": {"reputation": 2048, "user_id": 1116098, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/skrd5.jpg?s=128&g=1", "display_name": "Sean Francis N. Ballais", "link": "https://stackoverflow.com/users/1116098/sean-francis-n-ballais"}, "edited": false, "score": 1, "creation_date": 1554135859, "post_id": 55448312, "comment_id": 97631942, "body": "Apparently, it turns that my problem was due to my custom header not being included in the allowed headers. This was pointed out and solved by Ferrybig <a href=\"https://stackoverflow.com/a/55459139/1116098\">here</a>. Nevertheless, thank you for you effort."}], "tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 2, "last_activity_date": 1554133029, "last_edit_date": 1554133029, "creation_date": 1554094567, "answer_id": 55448312, "question_id": 55447568, "link": "https://stackoverflow.com/questions/55447568/axios-request-receiving-a-cors-error-only-when-inside-a-callback-async-function/55448312#55448312", "title": "Axios request receiving a CORS error only when inside a callback/async function", "body": "<p>I still suspect the go-chi CORS setup. I would suggest looking at setting up CORS by hand. It's not that difficult. This page will get a basic setup: <a href=\"https://flaviocopes.com/golang-enable-cors/\" rel=\"nofollow noreferrer\">https://flaviocopes.com/golang-enable-cors/</a></p>\n\n<p>If that works with your nested API setup, we can then work backwards to determine the go-chi config issue.</p>\n\n<hr>\n\n<p><strong>Update:</strong></p>\n\n<p>I would also investigate the other middleware steps - commenting out all non-essential ones.</p>\n\n<p>Middleware handlers normally inspect the <code>r *http.Request</code> or write headers to the <code>w http.ResponseWriter</code> and then the final handler will write to the response <em>body</em>. But throughout the middleware chain the following header/body write flow should look like one of these two flows:</p>\n\n<p><strong>Success:</strong></p>\n\n<pre><code>w.Header().Set(...) // headers\nw.Write(...) // body\n</code></pre>\n\n<p>Note the above flow will issue an implicit http status code write, to keep headers appearing <em>first</em> and body <em>second</em>:</p>\n\n<pre><code>w.Header().Set(...) // headers\nw.WriteHeader(http.StatusOK) // implicit success http status code\nw.Write(...) // body\n</code></pre>\n\n<p><strong>Failure:</strong></p>\n\n<p>In the event of reporting a runtime error, the flow should be:</p>\n\n<pre><code>w.Header().Set(...) // headers\nw.WriteHeader(http.StatusInternalServerError) // some unrecoverable error \nw.Write(...) // optional body\n</code></pre>\n\n<hr>\n\n<p>The reason I bring this up, I've seen 3 types of bugs which mess up this flow:</p>\n\n<ul>\n<li>bad middleware handlers write headers after the body causing client confusion</li>\n<li>calling <code>http.Error</code> thinking that stops the API dead - instead of returning immediately after the <code>http.Error</code> <em>and</em> ensuring no subsequent middleware handlers are called</li>\n<li>write the same header twice. Rewriting headers in a subsequent handler will cause the client to see the last version (thus clobbering any previous versions)</li>\n</ul>\n\n<p>So to fully trace things, I would <code>log.Println</code> all header/body writes for your API to ensure the above flow is correct and no intended values are being overwritten.</p>\n"}, {"comments": [{"owner": {"reputation": 2048, "user_id": 1116098, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/skrd5.jpg?s=128&g=1", "display_name": "Sean Francis N. Ballais", "link": "https://stackoverflow.com/users/1116098/sean-francis-n-ballais"}, "edited": false, "score": 0, "creation_date": 1554135691, "post_id": 55459139, "comment_id": 97631859, "body": "Woah! I did not think that my custom header being missing was causing my problem. I have confirmed that this is indeed the fix. Thank you very much!"}, {"owner": {"reputation": 15921, "user_id": 1542723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8a969ba62fc77da0a20654caffbe234?s=128&d=identicon&r=PG", "display_name": "Ferrybig", "link": "https://stackoverflow.com/users/1542723/ferrybig"}, "reply_to_user": {"reputation": 2048, "user_id": 1116098, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/skrd5.jpg?s=128&g=1", "display_name": "Sean Francis N. Ballais", "link": "https://stackoverflow.com/users/1116098/sean-francis-n-ballais"}, "edited": false, "score": 2, "creation_date": 1554137008, "post_id": 55459139, "comment_id": 97632434, "body": "It also shows how important it is to post all code related to your problem, if I haven&#39;t looked at your first screenshot of the request, I would have never spotted that this was your error, as that screenshot is the only place where this header is mentioned"}], "tags": [], "owner": {"reputation": 15921, "user_id": 1542723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8a969ba62fc77da0a20654caffbe234?s=128&d=identicon&r=PG", "display_name": "Ferrybig", "link": "https://stackoverflow.com/users/1542723/ferrybig"}, "is_accepted": true, "score": 2, "last_activity_date": 1554136202, "last_edit_date": 1554136202, "creation_date": 1554134148, "answer_id": 55459139, "question_id": 55447568, "link": "https://stackoverflow.com/questions/55447568/axios-request-receiving-a-cors-error-only-when-inside-a-callback-async-function/55459139#55459139", "title": "Axios request receiving a CORS error only when inside a callback/async function", "body": "<p>This CORS error is expected. The CORS plugin you are using does request filtering for you. If you look at the list of allowed headers, you can see it's missing the header called <code>snb-user-gps-location</code> that you are trying to send in your axios call.</p>\n\n<p>Either add that header to the allowed list, or don't send it from the front end.</p>\n"}], "owner": {"reputation": 2048, "user_id": 1116098, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/skrd5.jpg?s=128&g=1", "display_name": "Sean Francis N. Ballais", "link": "https://stackoverflow.com/users/1116098/sean-francis-n-ballais"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1173, "favorite_count": 0, "accepted_answer_id": 55459139, "answer_count": 2, "score": 1, "last_activity_date": 1554136202, "creation_date": 1554087509, "last_edit_date": 1554093549, "question_id": 55447568, "link": "https://stackoverflow.com/questions/55447568/axios-request-receiving-a-cors-error-only-when-inside-a-callback-async-function", "title": "Axios request receiving a CORS error only when inside a callback/async function", "body": "<p>I'm using VueJS for an app I am building. The server I have is written in Golang and has been set to accept CORS. In the app, in one of my components, <code>searchBar</code>, I have set it to fetch some data before it is created.</p>\n\n<pre><code>var searchBar = {\n    prop: [...],\n    data: function() {\n        return { ... };\n    },\n    beforeCreate: function() {\n        var searchBar = this;\n\n        axios.request({\n            url: '/graphql',\n            method: 'post',\n            data: {\n                'query': '{courses{id, name}}'\n            }\n        })\n        .then(function(response) {\n            searchBar.courses = response.data.data.courses;\n        });\n    },\n    methods: { ... },\n    template: `...`\n};\n</code></pre>\n\n<p>Axios works perfectly here. It gets the data I need. <code>searchBar</code> has a button which causes it to emit an event which is then picked up by another component, <code>searchResults</code>. Upon receiving the event, <code>searchResults</code> will fetch some data.</p>\n\n<pre><code>var searchResults = {\n    data: function() {\n        return { ... }\n    },\n    mounted: function() {\n        var sr = this;\n\n        this.$bus.$on('poll-server', function(payload) {\n            var requestData = {\n                url: '/graphql',\n                method: 'post',\n                data: { ... },\n                ...\n            };\n            ...\n\n            axios.request(requestData)\n                 .then(function(response) {\n                     console.log(response);\n                 }\n            );\n        });\n    },\n    template: `...`\n};\n</code></pre>\n\n<p>Note that my Axios request call is now inside a callback function. When this call is performed, I receive a CORS error:</p>\n\n<blockquote>\n  <p>Access to XMLHttpRequest at '<a href=\"http://127.0.0.1:9000/graphql\" rel=\"nofollow noreferrer\">http://127.0.0.1:9000/graphql</a>' from origin '<a href=\"http://127.0.0.1:8080\" rel=\"nofollow noreferrer\">http://127.0.0.1:8080</a>' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource.</p>\n</blockquote>\n\n<p>My server is located at <code>http://127.0.0.1:9000</code>, with the client in <code>http://127.0.0.1:8080</code>. Here is the content of the <code>OPTIONS</code> request of the second request call.</p>\n\n<p><a href=\"https://i.stack.imgur.com/sp8fX.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/sp8fX.png\" alt=\"Second call&#39;s OPTIONS method request headers.\"></a></p>\n\n<p>For comparison, here is the request header of the first request call (that works!).</p>\n\n<p><a href=\"https://i.stack.imgur.com/HB0I8.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/HB0I8.png\" alt=\"First call&#39;s OPTIONS method request headers.\"></a></p>\n\n<p>I have already set my Golang server to support CORS via <code>go-chi/cors</code>. This is how set it up.</p>\n\n<pre><code>router := chi.NewRouter()\n...    \n// Enable CORS.\ncors := cors.New(cors.Options{\n    AllowedOrigins:   []string{\"*\"},\n    AllowedMethods:   []string{\"POST\", \"OPTIONS\"},\n    AllowedHeaders:   []string{\"Accept\", \"Authorization\", \"Content-Type\", \"X-CSRF-Token\"},\n    ExposedHeaders:   []string{\"Link\"},\n    AllowCredentials: true,\n    MaxAge:           300,\n})\n\nrouter.Use(\n    render.SetContentType(render.ContentTypeJSON),\n    middleware.Logger,\n    middleware.DefaultCompress,\n    middleware.StripSlashes,\n    middleware.Recoverer,\n    cors.Handler,\n)\n\nrouter.Post(\"/graphql\", gqlServer.GraphQL())\n\nreturn router, db\n</code></pre>\n\n<p>What is causing the error I am having and how can it be solved?</p>\n"}, {"tags": ["go", "kubernetes-helm"], "comments": [{"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1554083293, "post_id": 55447081, "comment_id": 97609037, "body": "Does the error appear after the 30 second ConnectTimeout? Is something listening on 127.0.0.1:44134?"}, {"owner": {"reputation": 1, "user_id": 11287574, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-zDMfwc7RV0M/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reJ5cWtnZrwQJ8kZlW00YvzqSLNug/mo/photo.jpg?sz=128", "display_name": "Yunzhi Shi", "link": "https://stackoverflow.com/users/11287574/yunzhi-shi"}, "reply_to_user": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1554186950, "post_id": 55447081, "comment_id": 97647719, "body": "yes, happened after 30 sec connectTimeout"}], "owner": {"reputation": 1, "user_id": 11287574, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-zDMfwc7RV0M/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reJ5cWtnZrwQJ8kZlW00YvzqSLNug/mo/photo.jpg?sz=128", "display_name": "Yunzhi Shi", "link": "https://stackoverflow.com/users/11287574/yunzhi-shi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 533, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1554154149, "creation_date": 1554082652, "last_edit_date": 1554154149, "question_id": 55447081, "link": "https://stackoverflow.com/questions/55447081/how-to-fix-helm-go-pkg-err-context-deadline-exceeded", "title": "how to fix &quot;helm go pkg: err: context deadline exceeded&quot;", "body": "<p>I'm trying helm go pkg, below error seen when run the code:</p>\n\n<blockquote>\n  <p>2019/04/01 02:30:31 err: context deadline exceeded exit status 1</p>\n</blockquote>\n\n<p>Helm Version:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code># helm version\nClient: &amp;version.Version{SemVer:\"v2.13.0-rc.2\", GitCommit:\"b0d4c9eb82e036c52d130fcb031e788dffe5a5dd\", GitTreeState:\"clean\"}\nServer: &amp;version.Version{SemVer:\"v2.13.0-rc.2\", GitCommit:\"b0d4c9eb82e036c52d130fcb031e788dffe5a5dd\", GitTreeState:\"clean\"}\n</code></pre>\n\n<p>K8s version:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>kubectl version\nClient Version: version.Info{Major:\"1\", Minor:\"10\", GitVersion:\"v1.10.4\", GitCommit:\"5ca598b4ba5abb89bb773071ce452e33fb66339d\", GitTreeState:\"clean\", BuildDate:\"2018-06-06T08:13:03Z\", GoVersion:\"go1.9.3\", Compiler:\"gc\", Platform:\"linux/amd64\"}\nServer Version: version.Info{Major:\"1\", Minor:\"10\", GitVersion:\"v1.10.4\", GitCommit:\"5ca598b4ba5abb89bb773071ce452e33fb66339d\", GitTreeState:\"clean\", BuildDate:\"2018-06-06T08:00:59Z\", GoVersion:\"go1.9.3\", Compiler:\"gc\", Platform:\"linux/amd64\"}\n</code></pre>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"k8s.io/helm/pkg/helm\"\n)\n\nconst (\n    tillerHost = \"127.0.0.1:44134\"\n)\n\nfunc main() {\n    helmClient := helm.NewClient(helm.Host(tillerHost), helm.ConnectTimeout(30))\n    _, err := helmClient.GetVersion()\n    if err != nil {\n        log.Fatalf(\"err: %v\", err)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "struct", "reflect"], "answers": [{"tags": [], "owner": {"reputation": 56, "user_id": 7728251, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-wlNmaWB4nMw/AAAAAAAAAAI/AAAAAAAAa5o/kGW54f9EwGs/photo.jpg?sz=128", "display_name": "Johan Dahl", "link": "https://stackoverflow.com/users/7728251/johan-dahl"}, "is_accepted": true, "score": 3, "last_activity_date": 1554083244, "creation_date": 1554083244, "answer_id": 55447152, "question_id": 55446776, "link": "https://stackoverflow.com/questions/55446776/how-to-transform-any-string-in-struct-field-name-like/55447152#55447152", "title": "How to transform any string in struct field name like", "body": "<p>By the magic of regular expressions</p>\n\n<p><a href=\"https://goplay.space/#xHfxG249CsH\" rel=\"nofollow noreferrer\">https://goplay.space/#xHfxG249CsH</a></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n    \"strings\"\n)\n\nfunc ConvertFieldName(s string) string {\n    r := regexp.MustCompile(\"(\\\\b|-|_|\\\\.)[a-z]\")\n    return r.ReplaceAllStringFunc(s, func(t string) string {\n        if len(t) == 1 {\n            return strings.ToUpper(t)\n        } else {\n            return strings.ToUpper(string(t[1]))\n        }\n\n    })\n\n}\n\nfunc main() {\n    fmt.Println(ConvertFieldName(\"debug\"))\n    fmt.Println(ConvertFieldName(\"a.string\"))\n    fmt.Println(ConvertFieldName(\"a-string\"))\n    fmt.Println(ConvertFieldName(\"a_string\"))\n    fmt.Println(ConvertFieldName(\"-a.string\"))\n    fmt.Println(ConvertFieldName(\"something-more-complex\"))\n}\n</code></pre>\n\n<p>Outputs</p>\n\n<pre><code>Debug\nAString\nAString\nAString\nAString\nSomethingMoreComplex\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "is_accepted": false, "score": 1, "last_activity_date": 1554086670, "last_edit_date": 1554086670, "creation_date": 1554083616, "answer_id": 55447195, "question_id": 55446776, "link": "https://stackoverflow.com/questions/55446776/how-to-transform-any-string-in-struct-field-name-like/55447195#55447195", "title": "How to transform any string in struct field name like", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype MyStruct struct {\n    Debug   bool\n    AString bool\n}\n\nvar myStruct MyStruct\n\nfunc GetField(s string) (reflect.Value, error) {\n    t := reflect.TypeOf(myStruct)\n    v := reflect.ValueOf(myStruct)\n    for fieldIndex := 0; fieldIndex &lt; v.NumField(); fieldIndex++ {\n        if t.Field(fieldIndex).Name == s {\n            return v.Field(fieldIndex), nil\n        }\n\n    }\n    return reflect.Value{}, fmt.Errorf(\"%s not exist\", s)\n}\n\nfunc main() {\n    var v reflect.Value\n    var err error\n\n    v, err = GetField(\"Debug\")\n    fmt.Println(v, err)\n\n    v, err = GetField(\"debug\")\n    fmt.Println(v, err)\n}\n</code></pre>\n\n<p>the other way, you can try define your own field's tag, like <code>json tag</code></p>\n"}], "owner": {"reputation": 382, "user_id": 7479934, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100007344395075/picture?type=large", "display_name": "Amanda Ferrari", "link": "https://stackoverflow.com/users/7479934/amanda-ferrari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 55447152, "answer_count": 2, "score": 0, "last_activity_date": 1554086670, "creation_date": 1554079168, "question_id": 55446776, "link": "https://stackoverflow.com/questions/55446776/how-to-transform-any-string-in-struct-field-name-like", "title": "How to transform any string in struct field name like", "body": "<p>I would like to know if there is a native way to transform strings like:</p>\n\n<ul>\n<li><code>a.string</code></li>\n<li><code>a-string</code></li>\n<li><code>a_string</code></li>\n<li><code>a string</code></li>\n</ul>\n\n<p>In a string that follows the convention for public field members of structs, in Go.</p>\n\n<p>The idea is to write a function that accepts a string and try to get the value of the field, even if the passed string is not using the PascalCase convention, example:</p>\n\n<pre><code>type MyStruct struct {\n    Debug   bool\n    AString bool\n    SomethingMoreComplex\n}\n\nvar myStruct MyStruct\n\nfunc GetField(s string) reflect.Value {\n   v := reflect.ValueOf(myStruct)\n   return v.FieldByName(s)\n}\n\nfunction main() {\n    GetField(\"debug\")\n    GetField(\"a.string\")\n    GetField(\"a-string\")\n    GetField(\"a_string\")\n    GetField(\"-a.string\")\n    GetField(\"something-more-complex\")\n}\n</code></pre>\n\n<p>I was using the strcase package, but it only works for ASCII.</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1554083830, "post_id": 55446755, "comment_id": 97609108, "body": "Non-standard types require you to do the conversion from the bytes ([]uint8) to your Duration struct. It&#39;s possible, but I&#39;d suggest a simpler approach; to store the duration as a single integer number of minutes. Also, consider using Go&#39;s <a href=\"https://golang.org/pkg/time/#Duration\" rel=\"nofollow noreferrer\">time.Duration</a>"}, {"owner": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "edited": false, "score": 0, "creation_date": 1554098672, "post_id": 55446755, "comment_id": 97612202, "body": "Why do you invent your own data type? To store a duration, a column of type <a href=\"https://www.postgresql.org/docs/current/datatype-datetime.html\" rel=\"nofollow noreferrer\"><code>interval</code></a> would be a better choice. Or use a single integer column as Mark suggested. Both solutions will give you much less problems in the long run"}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1554103678, "creation_date": 1554103678, "answer_id": 55449997, "question_id": 55446755, "link": "https://stackoverflow.com/questions/55446755/scan-postgres-composite-type/55449997#55449997", "title": "Scan Postgres composite type", "body": "<p>The byte slice <code>[40 50 44 51 51 41]</code>, when converted to a string and printed to stdout looks like this <code>(2,33)</code>, <a href=\"https://play.golang.org/p/tjOopJ3vglt\" rel=\"nofollow noreferrer\">see link</a>.</p>\n\n<p>So you can see that what you're getting back from the db is a tuple with two integers separated by a comma. With that knowledge you can implement the Scanner interface that parses the custom data type values.</p>\n\n<pre><code>func (d *Duration) Scan(value interface{}) error {\n    if b, ok := value.([]byte); ok {\n        ss := strings.Split(strings.Trim(string(b), \"()\"), \",\")\n        if len(ss) != 2 {\n            return errors.New(\"unknown Duration format: \" + string(b))\n        }\n\n        h, err := strconv.Atoi(ss[0])\n        if err != nil {\n            return err\n        }\n        m, err := strconv.Atoi(ss[1])\n        if err != nil {\n            return err\n        }\n\n        d.Hours, d.Minutes = h, m\n    } else {\n        d.Hours, d.Minutes = -1, -1\n    }\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 316, "user_id": 8099543, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2dc81140ddddc4bcda4efdbdde191373?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin Shi", "link": "https://stackoverflow.com/users/8099543/kevin-shi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 384, "favorite_count": 0, "accepted_answer_id": 55449997, "answer_count": 1, "score": 1, "last_activity_date": 1554103678, "creation_date": 1554078967, "question_id": 55446755, "link": "https://stackoverflow.com/questions/55446755/scan-postgres-composite-type", "title": "Scan Postgres composite type", "body": "<p>I have a composite type defined for use in a table:</p>\n\n<pre><code>CREATE TYPE duration AS (\n    hours NUMERIC,\n    minutes NUMERIC\n);\n\nCREATE TABLE foo (\n    id SERIAL PRIMARY KEY,\n    my_duration duration\n);\n\nINSERT INTO foo (id, my_duration) VALUES\n(1, ROW(1, 30));\n</code></pre>\n\n<p>How can I scan this with <code>database/sql</code>? When I implement the scanner interface with</p>\n\n<pre><code>func (d *Duration) Scan(value interface{}) error {\n    log.Println(value)\n    if value == nil {\n        *d = Duration{\n            Hours:   -1,\n            Minutes: -1,\n        }\n        return nil\n    }\n    if duration, ok := value.(Duration); ok {\n        *d = Duration(duration)\n        return nil\n    }\n    return errors.New(\"Failed to scan duration\")\n}\n</code></pre>\n\n<p>The type of the interface comes out as <code>[]uint8</code>, and the value itself is an encoded array, something like <code>[40 50 44 51 51 41]</code>. How can I parse the composite type properly?</p>\n\n<p>edit: I have a <code>Duration</code> struct defined as</p>\n\n<pre><code>type Duration struct {\n    Hours   int\n    Minutes int\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go"], "answers": [{"comments": [{"owner": {"reputation": 1310, "user_id": 8620945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oNs64.jpg?s=128&g=1", "display_name": "Adam D", "link": "https://stackoverflow.com/users/8620945/adam-d"}, "edited": false, "score": 0, "creation_date": 1554070915, "post_id": 55445785, "comment_id": 97606928, "body": "Thanks for the suggestion but this doesn&#39;t help. Strangely enough, when I change the <code>json:&quot;_id&quot;</code> to <code>json:&quot;_id&quot; bson:&quot;_id&quot;</code> <i>the entire struct goes blank</i>. :-/"}], "tags": [], "owner": {"reputation": 489, "user_id": 2800844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a7c17de7fc00ed31b24745ca0b317e7?s=128&d=identicon&r=PG&f=1", "display_name": "pete911", "link": "https://stackoverflow.com/users/2800844/pete911"}, "is_accepted": false, "score": 3, "last_activity_date": 1554069107, "creation_date": 1554069107, "answer_id": 55445785, "question_id": 55445429, "link": "https://stackoverflow.com/questions/55445429/unable-to-decode-the-objectid-subvalue-from-mongodb-results-in-golang/55445785#55445785", "title": "Unable to Decode the ObjectId SubValue from MongoDB results in Golang", "body": "<p>looks to me that you are missing 'bson' tags. You have correctly tagged json, but not bson. The rest of the fields is fine, because they default to correct bson tags, but '_id' default to just 'id'. Try to add </p>\n\n<blockquote>\n  <p><code>json:\"_id\" bson:\"_id\"</code></p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 1993, "user_id": 2044035, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IKkGD.png?s=128&g=1", "display_name": "Matheus Felipe", "link": "https://stackoverflow.com/users/2044035/matheus-felipe"}, "edited": false, "score": 0, "creation_date": 1587513955, "post_id": 55446340, "comment_id": 108540472, "body": "Although I found the solution through your answer, what actually worked for me was adding the <code>bson</code> tag, regardless of the <code>ID</code> field type (I use <code>string</code>, but I also experimented with <code>primitive.ObjectID</code> and both would <i>not</i> work until I tried to decode it with the <code>_id</code> bson struct tag)"}], "tags": [], "owner": {"reputation": 1310, "user_id": 8620945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oNs64.jpg?s=128&g=1", "display_name": "Adam D", "link": "https://stackoverflow.com/users/8620945/adam-d"}, "is_accepted": true, "score": 13, "last_activity_date": 1554188507, "last_edit_date": 1554188507, "creation_date": 1554074441, "answer_id": 55446340, "question_id": 55445429, "link": "https://stackoverflow.com/questions/55445429/unable-to-decode-the-objectid-subvalue-from-mongodb-results-in-golang/55446340#55446340", "title": "Unable to Decode the ObjectId SubValue from MongoDB results in Golang", "body": "<p>Thanks to <a href=\"https://vkt.sh/go-mongodb-driver-cookbook/\" rel=\"noreferrer\">this excellent tutorial</a> and <a href=\"https://stackoverflow.com/a/54116108/8620945\">this anwser</a> I was able to find the answer.  </p>\n\n<p>I needed to set the <code>ID</code> in my struct as a <code>primitive.ObjectID</code>, and made sure I had imported <code>\"go.mongodb.org/mongo-driver/bson/primitive\"</code></p>\n\n<pre><code>type Contact struct {\n    ID      primitive.ObjectID  `json:\"_id\" bson:\"_id\"\n    Name    string `json:\"name\" bson:\"name\"`\n    Email   string `json:\"email\" bson:\"email\"`\n    Health  struct {\n        Weight  int `json:\"weight\" bson:\"weight\"`\n        Height  int `json:\"height\" bson:\"height\"`\n    } `json:\"health\" bson:\"health\"`    \n}\n</code></pre>\n\n<p>For those looking to use the official MongoDB Go driver, see this tutorial below provides very good explanation and examples of how to do all the CRUD operations necessary for a basic REST api etc. </p>\n\n<p><a href=\"https://vkt.sh/go-mongodb-driver-cookbook/\" rel=\"noreferrer\">Using the official MongoDB Go driver</a></p>\n"}], "owner": {"reputation": 1310, "user_id": 8620945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oNs64.jpg?s=128&g=1", "display_name": "Adam D", "link": "https://stackoverflow.com/users/8620945/adam-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4367, "favorite_count": 3, "accepted_answer_id": 55446340, "answer_count": 2, "score": 4, "last_activity_date": 1554188507, "creation_date": 1554066161, "last_edit_date": 1554074105, "question_id": 55445429, "link": "https://stackoverflow.com/questions/55445429/unable-to-decode-the-objectid-subvalue-from-mongodb-results-in-golang", "title": "Unable to Decode the ObjectId SubValue from MongoDB results in Golang", "body": "<p>I am using the <a href=\"https://github.com/mongodb/mongo-go-drive\" rel=\"nofollow noreferrer\">MongoDb Go Driver</a> and I am unable to get the ObjectId subvalue from the JSON decoded in my structs.  </p>\n\n<p><strong>Note:</strong> I am using a different library/API than <a href=\"https://stackoverflow.com/questions/47712710/cant-get-mongodb-record-by-objectid-in-golang\">this question</a>, so please don't mark this as duplicate.</p>\n\n<pre><code>import (\n    \"net/http\"\n    \"github.com/go-chi/chi\"\n    \"encoding/json\"\n    \"time\"\n    \"context\"\n    \"go.mongodb.org/mongo-driver/mongo\"\n    \"go.mongodb.org/mongo-driver/mongo/options\"\n    \"go.mongodb.org/mongo-driver/bson\"\n    \"go.mongodb.org/mongo-driver/bson/primitive\"\n    \"fmt\"\n)\n</code></pre>\n\n<p>I have a type of struct like this for processing the results  </p>\n\n<pre><code>type Contact struct {\n    Id  struct {\n        ObjId   string  `json:\"$oid\"`\n    } `json:\"_id\"`\n    Name    string `json:\"name\"`\n    Email   string `json:\"email\"`\n    Health  struct {\n        Weight  int `json:\"weight\"`\n        Height  int `json:\"height\"`\n    } `json:\"health\"`    \n}\n</code></pre>\n\n<p>And then I go to retrieve the contacts like this:  </p>\n\n<pre><code>var contacts []Contact\nctx, _ := context.WithTimeout(context.Background(), 30*time.Second)\ncursor, err := collection.Find(ctx, bson.M{})\nif err != nil {\n    panic(err)\n}\ndefer cursor.Close(ctx)\nfor cursor.Next(ctx) {\n    var contact Contact\n    fmt.Println(cursor)\n    cursor.Decode(&amp;contact)\n    contacts = append(contacts, contact)\n}\nif err := cursor.Err(); err != nil {\n    panic(err)\n}\n// I want to do more with the contacts, but .Id is empty :-(\nfmt.Println(contacts)\n</code></pre>\n\n<p><strong>The subfields for <code>\"health\"</code> appear exactly as they should, but for some reason the subfield from the <code>\"_id\"</code> part of the results is nowhere to be found.</strong> Can anyone help me with this??  </p>\n\n<p>The JSON response from the database comes out like this, and for some reason I am able to get the subfields for the <code>health</code> field, but not the <code>_id</code> field. Why not?  </p>\n\n<p>Raw JSON response of DB</p>\n\n<pre><code>[{\n    \"_id\": { \n        \"$obj\": \"5c601648ae25e40e2631c3ef\" \n    }, \n    \"name\": \"Bob Smith\", \n    \"email\": \"bob@smith.com\", \n    \"health\": { \n        \"height\": 192, \n        \"weight\": 85 \n    }\n}]\n</code></pre>\n\n<p><code>fmt.Println</code>'s output of the decoded <code>contacts</code> array:  </p>\n\n<pre><code>[{{} Bob Smith bob@smith.com {192 85}}]\n</code></pre>\n"}, {"tags": ["go", "go-modules", "go-packages"], "answers": [{"comments": [{"owner": {"reputation": 2211, "user_id": 788833, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/WJfHU.png?s=128&g=1", "display_name": "dmigo", "link": "https://stackoverflow.com/users/788833/dmigo"}, "edited": false, "score": 0, "creation_date": 1561040192, "post_id": 55442934, "comment_id": 99941430, "body": "Do you normally have your <code>go.mod</code>, <code>go.sum</code>, and <code>main.go</code> files in the root directory of your repo?"}, {"owner": {"reputation": 8750, "user_id": 1771556, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XPkeq.jpg?s=128&g=1", "display_name": "Vadim Ashikhman", "link": "https://stackoverflow.com/users/1771556/vadim-ashikhman"}, "reply_to_user": {"reputation": 2211, "user_id": 788833, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/WJfHU.png?s=128&g=1", "display_name": "dmigo", "link": "https://stackoverflow.com/users/788833/dmigo"}, "edited": false, "score": 1, "creation_date": 1561150484, "post_id": 55442934, "comment_id": 99983883, "body": "<code>go.mod</code> and <code>go.sum</code> - yes. <code>main.go</code> is entry point to your program. If you have single entry point just place it in root directory, otherwise check <code>cmd</code> directory README.md file in <a href=\"https://github.com/golang-standards/project-layout\" rel=\"nofollow noreferrer\">github.com/golang-standards/project-layout</a>"}, {"owner": {"reputation": 2211, "user_id": 788833, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/WJfHU.png?s=128&g=1", "display_name": "dmigo", "link": "https://stackoverflow.com/users/788833/dmigo"}, "edited": false, "score": 1, "creation_date": 1561479687, "post_id": 55442934, "comment_id": 100074078, "body": "Is the layout provided in the repo still way to go? Don&#39;t go modules change that?"}, {"owner": {"reputation": 8750, "user_id": 1771556, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XPkeq.jpg?s=128&g=1", "display_name": "Vadim Ashikhman", "link": "https://stackoverflow.com/users/1771556/vadim-ashikhman"}, "reply_to_user": {"reputation": 2211, "user_id": 788833, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/WJfHU.png?s=128&g=1", "display_name": "dmigo", "link": "https://stackoverflow.com/users/788833/dmigo"}, "edited": false, "score": 0, "creation_date": 1561545798, "post_id": 55442934, "comment_id": 100097271, "body": "Go modules do not define project layout structure, you can use go modules with any layout of your choice. You can read more about go modules here <a href=\"https://github.com/golang/go/wiki/Modules#modules\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/Modules#modules</a>"}, {"owner": {"reputation": 2653, "user_id": 11210494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f24d82ad87e7e92592ede8c31c52748e?s=128&d=identicon&r=PG&f=1", "display_name": "typical182", "link": "https://stackoverflow.com/users/11210494/typical182"}, "edited": false, "score": 2, "creation_date": 1564681899, "post_id": 55442934, "comment_id": 101120936, "body": "Defining your module in the <code>go.mod</code> as <code>module myprojectname</code> (instead of <code>module github.com&#47;myname&#47;myproject</code>) is a bit dangerous, and will most likely fail later in a way that surprises you. It is almost always better to use the full path including a hostname of where you intend to publish it eventually, or pick as hostname as if it will be published someday  (unless you are doing something throwaway like a quick test that starts <code>go mod init tempmod</code> and you intend to delete the module soon). Some more details in this <a href=\"https://stackoverflow.com/a/57314494/11210494\">answer</a>."}, {"owner": {"reputation": 8750, "user_id": 1771556, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XPkeq.jpg?s=128&g=1", "display_name": "Vadim Ashikhman", "link": "https://stackoverflow.com/users/1771556/vadim-ashikhman"}, "reply_to_user": {"reputation": 2653, "user_id": 11210494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f24d82ad87e7e92592ede8c31c52748e?s=128&d=identicon&r=PG&f=1", "display_name": "typical182", "link": "https://stackoverflow.com/users/11210494/typical182"}, "edited": false, "score": 0, "creation_date": 1565392719, "post_id": 55442934, "comment_id": 101353461, "body": "@typical182 agreed. I added a notice to your answer."}, {"owner": {"reputation": 981, "user_id": 2443267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea0440cab20ca78515c96d1997faed44?s=128&d=identicon&r=PG&f=1", "display_name": "Krishna Gupta", "link": "https://stackoverflow.com/users/2443267/krishna-gupta"}, "edited": false, "score": 0, "creation_date": 1608275319, "post_id": 55442934, "comment_id": 115538429, "body": "For some people (like myself), this could be the key &quot;<i>Files of package stuff should be located inside project&#39;s <code>stuff</code> directory</i>&quot;. Package import didn&#39;t work unless you put the go files related to stuff in a dir."}], "tags": [], "owner": {"reputation": 8750, "user_id": 1771556, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XPkeq.jpg?s=128&g=1", "display_name": "Vadim Ashikhman", "link": "https://stackoverflow.com/users/1771556/vadim-ashikhman"}, "is_accepted": true, "score": 46, "last_activity_date": 1598156286, "last_edit_date": 1598156286, "creation_date": 1554049267, "answer_id": 55442934, "question_id": 55442878, "link": "https://stackoverflow.com/questions/55442878/organize-local-code-in-packages-using-go-modules/55442934#55442934", "title": "Organize local code in packages using Go modules", "body": "<p>First you have to choose a name for your project and write it to go.mod file. This name belongs to root directory of the project. Each new package you create must be located inside its own subdirectory and its name should match directory name.</p>\n<p>go.mod:</p>\n<pre><code>module myprojectname\n</code></pre>\n<p>or (preferred way, see @typical182's <a href=\"https://stackoverflow.com/a/57314494/11210494\">answer below</a> for details)</p>\n<pre><code>module github.com/myname/myproject\n</code></pre>\n<p>Then import your project's packages like:</p>\n<pre><code>import myprojectname/stuff\n</code></pre>\n<p>or</p>\n<pre><code>import github.com/myname/myproject/stuff\n</code></pre>\n<p>Files of package <code>stuff</code> should be located inside project's <code>stuff</code> directory. You name these files as you like.</p>\n<p>Also it's possible to create deeper project structure. For instance, you decided to separate source code files from other ones (like app configs, docker files, static files, etc...). Let's move <code>stuff</code> directory inside <code>pkg</code>, every go file inside <code>pkg/stuff</code> still have <code>stuff</code> package name. To import stuff package just write:</p>\n<pre><code>import myprojectname/pkg/stuff\n</code></pre>\n<p>Nothing stops you from creating more levels in the hierarchy like <code>github.com/myuser/myproject/pkg/db/provider/postgresql</code>, where:</p>\n<ul>\n<li><code>github.com/myuser/myproject</code> - project name.</li>\n<li><code>postgresql</code> - package name.</li>\n<li><code>pkg/db/provider/postgresql</code> - path to the package relative to project's root.</li>\n</ul>\n<p>You can read more about go modules here: <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"noreferrer\">https://github.com/golang/go/wiki/Modules</a></p>\n<p>Check out this repository to get useful information about various patterns used in project organizing: <a href=\"https://github.com/golang-standards/project-layout\" rel=\"noreferrer\">https://github.com/golang-standards/project-layout</a> If you go inside <code>pkg</code> directory you will find out which open source projects use <code>pkg</code> directory in their structure.</p>\n"}, {"comments": [{"owner": {"reputation": 1806, "user_id": 2358035, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9829509b8c27e2b52dfc900ddcf79640?s=128&d=identicon&r=PG&f=1", "display_name": "doron aviguy", "link": "https://stackoverflow.com/users/2358035/doron-aviguy"}, "edited": false, "score": 4, "creation_date": 1577457797, "post_id": 57314494, "comment_id": 105176886, "body": "Thats the best explanation i saw on that subject,  Thanks"}, {"owner": {"reputation": 16010, "user_id": 1568658, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FPSGe.jpg?s=128&g=1", "display_name": "user218867", "link": "https://stackoverflow.com/users/1568658/user218867"}, "edited": false, "score": 0, "creation_date": 1608750086, "post_id": 57314494, "comment_id": 115676505, "body": "In case TLDR. The key point from the answer is: <code>When importing another package with modules, you always use the full path including the module path. This is true even when importing another package in the same module.</code>"}, {"owner": {"reputation": 1776, "user_id": 5442187, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/ebca55bf5db19f6d491777f5420b0dfe?s=128&d=identicon&r=PG&f=1", "display_name": "uberrebu", "link": "https://stackoverflow.com/users/5442187/uberrebu"}, "edited": false, "score": 0, "creation_date": 1619131631, "post_id": 57314494, "comment_id": 118819771, "body": "why must everyone keep using github.com??? question said local files/code...yet github.com name still appears..is github.com paying all of you???"}], "tags": [], "owner": {"reputation": 2653, "user_id": 11210494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f24d82ad87e7e92592ede8c31c52748e?s=128&d=identicon&r=PG&f=1", "display_name": "typical182", "link": "https://stackoverflow.com/users/11210494/typical182"}, "is_accepted": false, "score": 55, "last_activity_date": 1580183030, "last_edit_date": 1580183030, "creation_date": 1564681846, "answer_id": 57314494, "question_id": 55442878, "link": "https://stackoverflow.com/questions/55442878/organize-local-code-in-packages-using-go-modules/57314494#57314494", "title": "Organize local code in packages using Go modules", "body": "<h3>Module structure</h3>\n\n<p>The most common and easiest approach is:</p>\n\n<ul>\n<li>Use a single <code>go.mod</code> per repository, and</li>\n<li>Place the single <code>go.mod</code> file in the repository root, and</li>\n<li>Use the repository name as the module path declared in the <code>module</code> line in the <code>go.mod</code> \n\n<ul>\n<li>(If you are using a <a href=\"https://golang.org/cmd/go/#hdr-Remote_import_paths\" rel=\"noreferrer\">custom import path</a> such as <code>me.io/mymod</code> rather than using a VCS host based import path, then you would use the custom import path instead of the repository name in your <code>go.mod</code>).</li>\n</ul></li>\n</ul>\n\n<p>For example, if your repo is <code>github.com/my/repo</code>, then you would place a single <code>go.mod</code> in the repo root, with the first line reading <code>module github.com/my/repo</code>. That can be created by <code>cd</code>'ing to the repo root and running <code>go mod init github.com/my/repo</code>.</p>\n\n<p>Following this helps you stay on the happy path with modules, and it avoids multiple subtleties.</p>\n\n<p>Russ Cox commented in <a href=\"https://github.com/golang/go/issues/26664#issuecomment-455232444\" rel=\"noreferrer\">#26664</a>:</p>\n\n<blockquote>\n  <p>For all but power users, you probably want to adopt the usual convention that one repo = one module. It's important for long-term evolution of code storage options that a repo <em>can</em> contain multiple modules, but it's almost certainly not something you want to do by default.</p>\n</blockquote>\n\n<p>There is much more about multi-module repositories in the <a href=\"https://github.com/golang/go/wiki/Modules#faqs--multi-module-repositories\" rel=\"noreferrer\">\"Multi-module Repositories\"</a> FAQ section on the modules wiki. Those 6 or so FAQs in that section should be read in their entirety by anyone considering veering off the recommendation above.</p>\n\n<h3>Arranging packages within a module</h3>\n\n<p>Once you have set up your <code>go.mod</code>, you can arrange your packages in directories however you see fit in directories underneath the directory containing the <code>go.mod</code>, as well as in the directory with the <code>go.mod</code>. Three good articles about how to arrange your code in packages:</p>\n\n<ul>\n<li><a href=\"https://rakyll.org/style-packages/\" rel=\"noreferrer\">https://rakyll.org/style-packages/</a></li>\n<li><a href=\"https://medium.com/@benbjohnson/standard-package-layout-7cdbc8391fc1#.ds38va3pp\" rel=\"noreferrer\">https://medium.com/@benbjohnson/standard-package-layout-7cdbc8391fc1#.ds38va3pp</a></li>\n<li><a href=\"https://www.goinggo.net/2017/02/design-philosophy-on-packaging.html\" rel=\"noreferrer\">https://www.goinggo.net/2017/02/design-philosophy-on-packaging.html</a></li>\n</ul>\n\n<p>Those articles are classics that pre-date the introduction of modules, but the philosophies in them still apply to how to arrange your packages within a module.</p>\n\n<h3>Importing other packages in the same module</h3>\n\n<p>When importing another package with modules, you always use the full path including the module path. This is true even when importing another package in the same module. For example, if a module declared its identity in its <code>go.mod</code> as module <code>github.com/my/repo</code>, and you had this organization:</p>\n\n<pre><code>repo/\n\u251c\u2500\u2500 go.mod      &lt;&lt;&lt;&lt;&lt; Note go.mod is located in repo root\n\u251c\u2500\u2500 pkg1\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 pkg1.go\n\u2514\u2500\u2500 pkg2\n    \u2514\u2500\u2500 pkg1.go\n</code></pre>\n\n<p>Then <code>pkg1</code> would import its peer package as <code>import \"github.com/my/repo/pkg2\"</code>. Note that you <strong>cannot</strong> use relative import paths like <code>import \"../pkg2\"</code> or <code>import \"./subpkg\"</code>. (This is part of what OP hit above with <code>import \"./stuff\"</code>).</p>\n\n<h3>Modules vs. repositories vs. packages vs. import paths</h3>\n\n<p>A Go module is a collection of related Go packages that are versioned together as a single unit. Modules record precise dependency requirements and create reproducible builds. </p>\n\n<p>Summarizing the relationship between repositories, modules, and packages:</p>\n\n<ul>\n<li>A <em>repository</em> contains one or more Go <em>modules</em> (most often exactly one module in the repository root).</li>\n<li>Each module contains one or more Go <em>packages</em>.</li>\n<li>Each package consists of one or more Go <em>source files</em> that all reside in a <em>single directory</em>.</li>\n<li>Go source code:\n\n<ul>\n<li>declares its own package with a <code>package foo</code> statement.</li>\n<li>automatically has access to other Go source code in the same package.</li>\n<li>imports code from another package via an <em>import path</em> supplied in an import statement such as <code>import \"github.com/my/repo/pkg1\"</code>. The import path always starts with the module path of that package, regardless of whether that package is in the same module or a different module.</li>\n</ul></li>\n</ul>\n"}], "owner": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 31280, "favorite_count": 23, "accepted_answer_id": 55442934, "answer_count": 2, "score": 40, "last_activity_date": 1598156286, "creation_date": 1554048906, "question_id": 55442878, "link": "https://stackoverflow.com/questions/55442878/organize-local-code-in-packages-using-go-modules", "title": "Organize local code in packages using Go modules", "body": "<p>I can not find a way to factor out some code from <code>main.go</code> into a local package when using Go modules (go version >= 1.11) outside of <code>$GOPATH</code>.</p>\n\n<p>I am not importing any external dependencies that need to be included into <code>go.mod</code>, I am just trying to organize locally the source code of this Go module.</p>\n\n<p>The file <code>main.go</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\n// this import does not work\nimport \"./stuff\"\n\nfunc main() {\n    stuff.PrintBaz()\n}\n</code></pre>\n\n<p>The file <code>./stuff/bar.go</code> (pretending to be a local package):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package stuff\n\nimport \"log\"\n\ntype Bar struct {\n    Baz int\n}\n\nfunc PrintBaz() {\n    baz := Bar{42}\n    log.Printf(\"Bar struct: %v\", baz)\n}\n</code></pre>\n\n<p>The file <code>go.mod</code> (command <code>go mod init foo</code>):</p>\n\n<pre><code>module foo\n\ngo 1.12\n</code></pre>\n\n<p>When executing <code>go run main.go</code>:</p>\n\n<ul>\n<li>If I <code>import \"./stuff\"</code>, then I see <code>build command-line-arguments: cannot find module for path _/home/&lt;PATH_TO&gt;/fooprj/stuff</code>.</li>\n<li>If I <code>import \"stuff\"</code>, then I see <code>build command-line-arguments: cannot load stuff: cannot find module providing package stuff</code>.</li>\n<li>If I <code>import stuff \"./stuff\"</code> with a package alias, then I see again: <code>build command-line-arguments: cannot find module for path _/home/&lt;PATH_TO&gt;/fooprj/stuff</code>.</li>\n</ul>\n\n<p>I can not find a way to make local packages work with go modules.</p>\n\n<ul>\n<li>What's wrong with the code above?</li>\n<li>How can I import local packages into other Go code inside a project defined with Go modules (file <code>go.mod</code>)?</li>\n</ul>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 573, "user_id": 3102786, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/LGvyc.png?s=128&g=1", "display_name": "Kent", "link": "https://stackoverflow.com/users/3102786/kent"}, "edited": false, "score": 1, "creation_date": 1580142606, "post_id": 55442318, "comment_id": 105992209, "body": "After some experimentation, it appears that the GO111MODULE=off is unnecessary (at least, in some cases; test in your environment)."}], "tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": true, "score": 9, "last_activity_date": 1554045096, "creation_date": 1554045096, "answer_id": 55442318, "question_id": 55442155, "link": "https://stackoverflow.com/questions/55442155/why-are-go-tests-suddenly-requiring-gcc/55442318#55442318", "title": "Why are go tests suddenly requiring &quot;gcc&quot;?", "body": "<p>It looks like you're encountering this issue: <a href=\"https://github.com/golang/go/issues/26988\" rel=\"noreferrer\">https://github.com/golang/go/issues/26988</a></p>\n\n<p>The workaround suggested is to set these environment variables when building:</p>\n\n<pre><code>CGO_ENABLED=0 GO111MODULE=off\n</code></pre>\n\n<p>You might also prefer a multi-stage docker build, so that your final docker image is minimal (for example, not including the source files you've compiled from, and the go compiler). An example from the docker documentation is here: <a href=\"https://docs.docker.com/develop/develop-images/multistage-build/\" rel=\"noreferrer\">https://docs.docker.com/develop/develop-images/multistage-build/</a></p>\n"}], "owner": {"reputation": 55556, "user_id": 197606, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/14da0a77145571d61cee03ac6bb0fb35?s=128&d=identicon&r=PG", "display_name": "Webnet", "link": "https://stackoverflow.com/users/197606/webnet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3768, "favorite_count": 0, "accepted_answer_id": 55442318, "answer_count": 1, "score": 4, "last_activity_date": 1554045096, "creation_date": 1554043957, "question_id": 55442155, "link": "https://stackoverflow.com/questions/55442155/why-are-go-tests-suddenly-requiring-gcc", "title": "Why are go tests suddenly requiring &quot;gcc&quot;?", "body": "<p>I have a project that I upgraded <code>FROM golang:1.9-alpine</code> to <code>FROM golang:1.12-alpine</code> and now my test aren't running.  It's now saying:</p>\n\n<pre><code>$ docker-compose exec bot go vet       \n# runtime/cgo\nexec: \"gcc\": executable file not found in $PATH\n</code></pre>\n\n<p>According to the docs for <a href=\"https://golang.org/doc/install/gccgo\" rel=\"nofollow noreferrer\">https://golang.org/doc/install/gccgo</a> this is the compiler.  <strong>How come I can run my app without this but it won't run tests without it?</strong>  I've been looking through the change logs and must be missing where this is covered.  </p>\n\n<p>Here's my Dockerfile:</p>\n\n<pre><code>FROM golang:1.12-alpine\nRUN mkdir /app\nWORKDIR /app\nADD src/ /app\n\n# Fetch application dependencies\nRUN apk add --no-cache --update git \\\n    &amp;&amp; go get github.com/bwmarrin/discordgo \\\n    &amp;&amp; go get github.com/jonas747/dshardmanager \\\n    &amp;&amp; go get github.com/bugsnag/bugsnag-go \\\n    &amp;&amp; apk del git\n\n# Build binary\nRUN go build -o main .\n\nCMD [\"/app/main\"]\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 306, "user_id": 9156464, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-YyR0wNnIHCY/AAAAAAAAAAI/AAAAAAAALRA/5IzD2UxVAg4/photo.jpg?sz=128", "display_name": "Cornea Valentin", "link": "https://stackoverflow.com/users/9156464/cornea-valentin"}, "edited": false, "score": 0, "creation_date": 1554042547, "post_id": 55441815, "comment_id": 97599686, "body": "You can do that by read file line by line,  then count words per line"}, {"owner": {"reputation": 306, "user_id": 9156464, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-YyR0wNnIHCY/AAAAAAAAAAI/AAAAAAAALRA/5IzD2UxVAg4/photo.jpg?sz=128", "display_name": "Cornea Valentin", "link": "https://stackoverflow.com/users/9156464/cornea-valentin"}, "edited": false, "score": 0, "creation_date": 1554042708, "post_id": 55441815, "comment_id": 97599733, "body": "also take a look here <a href=\"https://stackoverflow.com/questions/21107505/word-count-from-a-txt-file-program\" title=\"word count from a txt file program\">stackoverflow.com/questions/21107505/&hellip;</a> maybe will help you"}, {"owner": {"reputation": 123, "user_id": 11261002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab42d135c9fcd15a8c1a2047b3ddc6e0?s=128&d=identicon&r=PG&f=1", "display_name": "strawberrylatte", "link": "https://stackoverflow.com/users/11261002/strawberrylatte"}, "reply_to_user": {"reputation": 306, "user_id": 9156464, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-YyR0wNnIHCY/AAAAAAAAAAI/AAAAAAAALRA/5IzD2UxVAg4/photo.jpg?sz=128", "display_name": "Cornea Valentin", "link": "https://stackoverflow.com/users/9156464/cornea-valentin"}, "edited": false, "score": 0, "creation_date": 1554042901, "post_id": 55441815, "comment_id": 97599784, "body": "@CorneaValentin the code that I provided did what the link you shared does, but I wanted the numbers of words only to know the position of the word in the file, and the program i used is Go, not Phyton"}], "answers": [{"comments": [{"owner": {"reputation": 123, "user_id": 11261002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab42d135c9fcd15a8c1a2047b3ddc6e0?s=128&d=identicon&r=PG&f=1", "display_name": "strawberrylatte", "link": "https://stackoverflow.com/users/11261002/strawberrylatte"}, "edited": false, "score": 0, "creation_date": 1554105591, "post_id": 55442534, "comment_id": 97615047, "body": "I also would like to index the position of the word, for example, if word[position]==word[position], to find out if  the word in a specific position is the same as the word in another specific position but I could not do it using any of the answers shared to me @Hermsi1337"}, {"owner": {"reputation": 156, "user_id": 8196336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9640e43ee67d98b2e369cec265c01fa0?s=128&d=identicon&r=PG", "display_name": "Hermsi1337", "link": "https://stackoverflow.com/users/8196336/hermsi1337"}, "reply_to_user": {"reputation": 123, "user_id": 11261002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab42d135c9fcd15a8c1a2047b3ddc6e0?s=128&d=identicon&r=PG&f=1", "display_name": "strawberrylatte", "link": "https://stackoverflow.com/users/11261002/strawberrylatte"}, "edited": false, "score": 0, "creation_date": 1554110357, "post_id": 55442534, "comment_id": 97617429, "body": "Hey @strawberrylatte, I&#39;ve updated my post with a working example for your usecase (:"}], "tags": [], "owner": {"reputation": 156, "user_id": 8196336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9640e43ee67d98b2e369cec265c01fa0?s=128&d=identicon&r=PG", "display_name": "Hermsi1337", "link": "https://stackoverflow.com/users/8196336/hermsi1337"}, "is_accepted": false, "score": 1, "last_activity_date": 1554110334, "last_edit_date": 1554110334, "creation_date": 1554046642, "answer_id": 55442534, "question_id": 55441815, "link": "https://stackoverflow.com/questions/55441815/how-to-count-words-in-file/55442534#55442534", "title": "How to count words in file", "body": "<p>Imagine having a <code>testfile.txt</code>:   </p>\n\n<pre><code>this is fine\n</code></pre>\n\n<p>You can use this go-script to loop over each word and print the word with it's current position:   </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    // initiate file-handle to read from\n    fileHandle, err := os.Open(\"testfile.txt\")\n\n    // check if file-handle was initiated correctly\n    if err != nil {\n        panic(err)\n    }\n\n    // make sure to close file-handle upon return\n    defer fileHandle.Close()\n\n    // initiate scanner from file handle\n    fileScanner := bufio.NewScanner(fileHandle)\n\n    // tell the scanner to split by words\n    fileScanner.Split(bufio.ScanWords)\n\n    // initiate counter\n    count := 0\n\n    // for looping through results\n    for fileScanner.Scan() {\n        fmt.Printf(\"word: '%s' - position: '%d'\\n\", fileScanner.Text(), count)\n        count++\n    }\n\n    // check if there was an error while reading words from file\n    if err := fileScanner.Err(); err != nil {\n        panic(err)\n    }\n\n    // print total word count\n    fmt.Printf(\"total word count: '%d'\", count)\n}\n</code></pre>\n\n<p>Output:   </p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ go run main.go\nword: 'this' - position: '0'\nword: 'is' - position: '1'\nword: 'fine' - position: '2'\ntotal word count: '3'\n</code></pre>\n\n<p>If you want to compare the words by index you could load them into a slice first.</p>\n\n<p>Imagine having a textfile:   </p>\n\n<pre><code>fine this is fine\n</code></pre>\n\n<p>Use this code:   </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    // initiate file-handle to read from\n    fileHandle, err := os.Open(\"testfile.txt\")\n\n    // check if file-handle was initiated correctly\n    if err != nil {\n        panic(err)\n    }\n\n    // make sure to close file-handle upon return\n    defer fileHandle.Close()\n\n    // initiate scanner from file handle\n    fileScanner := bufio.NewScanner(fileHandle)\n\n    // tell the scanner to split by words\n    fileScanner.Split(bufio.ScanWords)\n\n    // initiate wordsSlice\n    var wordSlice []string\n\n    // for looping through results\n    for fileScanner.Scan() {\n        wordSlice = append(wordSlice, fileScanner.Text())\n    }\n\n    // check if there was an error while reading words from file\n    if err := fileScanner.Err(); err != nil {\n        panic(err)\n    }\n\n    // loop through word slice and print word with index\n    for i, w := range wordSlice {\n        fmt.Printf(\"word: '%s' - position: '%d'\\n\", w, i)\n    }\n\n    // compare words by index\n    firstWordPos := 0\n    equalsWordPos := 3\n    if wordSlice[firstWordPos] == wordSlice[equalsWordPos] {\n        fmt.Printf(\"word at position '%d' and '%d' is equal: '%s'\\n\", firstWordPos, equalsWordPos, wordSlice[firstWordPos])\n    }\n\n    // print total word count\n    fmt.Printf(\"total word count: '%d'\", len(wordSlice))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ go run main.go\nword: 'fine' - position: '0'\nword: 'this' - position: '1'\nword: 'is' - position: '2'\nword: 'fine' - position: '3'\nword at position '0' and '3' is equal: 'fine'\ntotal word count: '4'\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 123, "user_id": 11261002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab42d135c9fcd15a8c1a2047b3ddc6e0?s=128&d=identicon&r=PG&f=1", "display_name": "strawberrylatte", "link": "https://stackoverflow.com/users/11261002/strawberrylatte"}, "edited": false, "score": 0, "creation_date": 1554109936, "post_id": 55442632, "comment_id": 97617218, "body": "I also would like to index the position of the word, for example, if word[position]==word[position], to find out if the word in a specific position is the same as the word in another specific position but I could not do it using any of the answers shared to me @Vadim Ashikhman"}, {"owner": {"reputation": 8750, "user_id": 1771556, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XPkeq.jpg?s=128&g=1", "display_name": "Vadim Ashikhman", "link": "https://stackoverflow.com/users/1771556/vadim-ashikhman"}, "reply_to_user": {"reputation": 123, "user_id": 11261002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab42d135c9fcd15a8c1a2047b3ddc6e0?s=128&d=identicon&r=PG&f=1", "display_name": "strawberrylatte", "link": "https://stackoverflow.com/users/11261002/strawberrylatte"}, "edited": false, "score": 0, "creation_date": 1554110858, "post_id": 55442632, "comment_id": 97617634, "body": "@strawberrylatte, you can put words in <code>map[int]string</code> where key is word position. Just try it yourself."}], "tags": [], "owner": {"reputation": 8750, "user_id": 1771556, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XPkeq.jpg?s=128&g=1", "display_name": "Vadim Ashikhman", "link": "https://stackoverflow.com/users/1771556/vadim-ashikhman"}, "is_accepted": false, "score": 1, "last_activity_date": 1554048109, "last_edit_date": 1554048109, "creation_date": 1554047264, "answer_id": 55442632, "question_id": 55441815, "link": "https://stackoverflow.com/questions/55441815/how-to-count-words-in-file/55442632#55442632", "title": "How to count words in file", "body": "<p>You can read input string one character at a time. This way you have full control on the data you need to output. In Go characters are called runes:</p>\n\n<pre><code>b, err := ioutil.ReadFile(\"test.txt\")\nif err != nil {\n    panic(err)\n}\n\nreader := bytes.NewReader(b)\n// Word is temporary word buffer that we use to collect characters for current word.\nword := strings.Builder{}\nwordPos := 0\nline := 0\npos := 0\nfor {\n    // Read next character\n    if r, _, err := reader.ReadRune(); err != nil {\n        if err == io.EOF {\n            // Output last word if this is end of file\n            fmt.Println(word.String(), \"line:\", line, \"position:\", wordPos)\n            break\n        } else {\n            panic(err)\n        }\n    } else {\n        // If current character is new line reset position counters and word buffer.\n        if r == '\\n' {\n            fmt.Println(word.String(), \"line:\", line, \"position:\", wordPos)\n            word.Reset()\n            pos = 0\n            wordPos = 0\n            line++\n        } else if r == ' ' { // Found word separator: output word, reset word buffer and set next word position.\n            fmt.Println(word.String(), \"line:\", line, \"position:\", wordPos)\n            word.Reset()\n            wordPos = pos + 1\n            pos++\n        } else { // Just a regular character: write it to word buffer.\n            word.WriteRune(r)\n            pos++\n        }\n    }\n}\n</code></pre>\n\n<p>I use <code>strings.Builder</code> to get rid of unnecessary string copying.</p>\n\n<p>Also you have to adjust this example to work for edge cases like empty line and maybe others.</p>\n"}], "owner": {"reputation": 123, "user_id": 11261002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab42d135c9fcd15a8c1a2047b3ddc6e0?s=128&d=identicon&r=PG&f=1", "display_name": "strawberrylatte", "link": "https://stackoverflow.com/users/11261002/strawberrylatte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 863, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1554110334, "creation_date": 1554041821, "last_edit_date": 1554106907, "question_id": 55441815, "link": "https://stackoverflow.com/questions/55441815/how-to-count-words-in-file", "title": "How to count words in file", "body": "<p>I wanted to make a function to count the words in a file to find the positions of each words in the file, I want the output to be,</p>\n\n<p>a, position: 0</p>\n\n<p>aah, position: 1</p>\n\n<p>aahed, position: 2</p>\n\n<p>I already tried this to count the words, but, I couldn't use it to get the positions of the words</p>\n\n<pre><code>scanner := bufio.NewScanner(strings.NewReader(input))\n\n// Set the split function for the scanning operation.\nscanner.Split(bufio.ScanWords)\n\n// Count the words.\ncount := 0\nfor scanner.Scan() {\n    count++\n}\n\nif err := scanner.Err(); err != nil {\n    fmt.Fprintln(os.Stderr, \"reading input:\", err)\n}\n\nfmt.Printf(\"%d\\n\", count)\n</code></pre>\n\n<p>Is it possible for me to use for loop to do this? Because I would like to index the position. For example word[position]==word[position+1], to find out if a word in a specific position is the same with the word in the next position.</p>\n"}, {"tags": ["for-loop", "go"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1554036637, "post_id": 55440854, "comment_id": 97598259, "body": "Well, for one, your <code>Read()</code> doesn&#39;t have a return type."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 2, "last_activity_date": 1554038343, "creation_date": 1554038343, "answer_id": 55441296, "question_id": 55440854, "link": "https://stackoverflow.com/questions/55440854/how-do-i-return-data-from-a-for-loop-in-go/55441296#55441296", "title": "How do I return Data from a For-Loop in Go?", "body": "<p>You can predeclare a <code>*Data</code> variable and then inside the loop, on each iteration add the item to its <code>ManyItems</code> field. Since <code>ItemList</code> and <code>Item</code> have the same structure, ie the same fields in the same order, you can convert directly one to the other. (<a href=\"https://golang.org/doc/go1.8#language\" rel=\"nofollow noreferrer\">As long as you are on Go 1.8 or newer</a>)</p>\n\n<pre><code>func Read() interface{} {\n    resp, err := Get()\n    if err != nil {\n        log.Println(err)\n        return nil\n    }\n\n    data := &amp;Data{ManyItems: make([]Item, len(resp))}\n    for i := range resp {\n        data.ManyItems[i] = Item(*resp[i])\n    }\n    return data\n}\n</code></pre>\n\n<p>However if possible it would be more efficient to just return the slice you already have, something like this.</p>\n\n<pre><code>type ItemList struct {\n    Id   string `datastore:\"_id\" json:\"id\"`\n    Name string `datastore:\"name\" json:\"name\"`\n}\n\ntype Data struct {\n    ManyItems []*ItemList\n}\n\nfunc Read() interface{} {\n    resp, err := Get()\n    if err != nil {\n        log.Println(err)\n        return nil\n    }\n\n    return &amp;Data{ManyItems: resp}\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1558, "user_id": 11265949, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x7xqr.png?s=128&g=1", "display_name": "filipe", "link": "https://stackoverflow.com/users/11265949/filipe"}, "is_accepted": false, "score": 2, "last_activity_date": 1554041340, "last_edit_date": 1554041340, "creation_date": 1554038405, "answer_id": 55441305, "question_id": 55440854, "link": "https://stackoverflow.com/questions/55440854/how-do-i-return-data-from-a-for-loop-in-go/55441305#55441305", "title": "How do I return Data from a For-Loop in Go?", "body": "<p>You are returning inside the for loop and this will only return the first item.</p>\n\n<p>Also I see that ManyItems is an array of Item ([]Item) and you are assigning a single Item which is wrong.</p>\n\n<p><strong>Update</strong>:\nHere you have the complete code:</p>\n\n<pre><code>// Input Json data\ntype ItemList struct {\n    Id    string    `datastore:\"_id\"`\n    Name  string    `datastore:\"name\"`\n}\n\n//Convert *ItemList to *Item\nfunc (list *ItemList) ToItem() *Item {\n    return &amp;Item {\n        Id    : list.Id,\n        Name  : list.Name,\n    }\n}\n</code></pre>\n\n<pre><code>// Output Json data\ntype Data struct {\n    ManyItems   []*Item `json:\"data\"`\n}\n\n//Output json item object\ntype Item struct {\n    Id    string    `json:\"id\"`\n    Name  string    `json:\"name\"`\n}\n</code></pre>\n\n<pre><code>// The read function\nfunc Read() (string, error) {\n   resp, err := Get()\n   if err != nil {\n      log.Println(err)\n      return \"\", err\n   }\n\n   list := make([]Item, len(resp))\n   for i, _ := range resp {\n     list[i] = resp[i].ToItem()\n   }\n\n    b, err := json.Marshal(&amp;Data{list})\n    if err != nil {\n        fmt.Println(err)\n        return \"\", err\n    }\n\n   return string(b), nil\n}\n\n</code></pre>\n\n<p>Test: <a href=\"https://play.golang.org/p/GMo1nCoN2R6\" rel=\"nofollow noreferrer\">Playground</a> </p>\n"}], "owner": {"reputation": 1, "user_id": 11284862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca5ab9bad8c0c2de54f8ae467d889e8b?s=128&d=identicon&r=PG&f=1", "display_name": "Mark C.", "link": "https://stackoverflow.com/users/11284862/mark-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2323, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1554041340, "creation_date": 1554034975, "last_edit_date": 1554037051, "question_id": 55440854, "link": "https://stackoverflow.com/questions/55440854/how-do-i-return-data-from-a-for-loop-in-go", "title": "How do I return Data from a For-Loop in Go?", "body": "<p>I'm trying to convert a <code>[]*Struct</code> to a JSON response, I'm able to get the data from the <code>[]*Struct</code> and iterate over it. The part I get stuck around is the iterating over a loop then returning the data to an <code>interface{}</code></p>\n\n<p>I've tried to putting an interface in an interface, but I just can't make ends meet. Here's what I have at the moment, I was told to turn to StackOverflow if I had any issues.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n   \"log\"\n   \"context\"\n   \"cloud.google.com/go/datastore\"\n)\n\nvar ctx = context.Background()\n\ntype ItemList struct {\n    Id    string    `datastore:\"_id\"`\n    Name  string    `datastore:\"name\"`\n}\n\ntype Data struct {\n    ManyItems   []Item\n}\n\ntype Item struct {\n    Id    string    `json:\"id\"`\n    Name  string    `json:\"name\"`\n}\n\nfunc Get() ([]*ItemList, error) {\n  client, err := datastore.NewClient(ctx, \"project-name\")\n  if err != nil {\n     log.Println(err)\n  }\n\n  var Response []*ItemList\n  query := datastore.NewQuery(\"query\")\n  _, err = client.GetAll(ctx, query, &amp;Response)\n  if err != nil {\n     log.Println(err)\n  }\n\n  return Response, error\n}\n\nfunc Read() (interface{}) {\n   resp, err := Get()\n   if err != nil {\n      log.Println(err)\n   }\n\n   for i, _ := range resp {\n     // this is where i get stuck\n     r := &amp;Data{\n               ManyItems: Item{\n                        Id: resp[i].Id,\n                        Name: resp[i].Name,\n               },\n          }\n     return r\n   }\n}\n</code></pre>\n\n<p>Thank you to anyone who reads this or can provide me some sort of guidance, I really appreciate it.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 11205228, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-fAhnUmcPRhs/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3ree-xgRzy0Ok_ZZkx6ucrF3MtD44A/mo/photo.jpg?sz=128", "display_name": "ABB", "link": "https://stackoverflow.com/users/11205228/abb"}, "is_accepted": false, "score": 0, "last_activity_date": 1554033593, "last_edit_date": 1554033593, "creation_date": 1554032158, "answer_id": 55440500, "question_id": 55440191, "link": "https://stackoverflow.com/questions/55440191/combine-multiple-maps-into-a-map-whose-value-for-a-given-key-is-the-sum-of-the-v/55440500#55440500", "title": "Combine multiple maps into a map whose value for a given key is the sum of the values of the key in the combined maps", "body": "<p>I believe you could create an array of maps each one being used for each process and then reading in each map using a list to keep track of the words you've already counted. Assuming that each word is a key to the number of times counted, that's how it looks.\n     Parallel processing here might not be the best choice considering the concurrency side since everything needs to be kept separate for a real performance increase. If you have the storage space then you most certainly can use a list and get at worst case O(N) efficiency from the integration of the maps. You will need to keep the the integration of the maps in a single thread or a single process.</p>\n"}], "owner": {"reputation": 437, "user_id": 2441615, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e22651679ce216dc2e20778a92b68a08?s=128&d=identicon&r=PG", "display_name": "K. Claesson", "link": "https://stackoverflow.com/users/2441615/k-claesson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 107, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1554033593, "creation_date": 1554029749, "question_id": 55440191, "link": "https://stackoverflow.com/questions/55440191/combine-multiple-maps-into-a-map-whose-value-for-a-given-key-is-the-sum-of-the-v", "title": "Combine multiple maps into a map whose value for a given key is the sum of the values of the key in the combined maps", "body": "<p>I have written a program that identifies all unique words in a text document and counts how many times each of the words appears. To improve the performance of my program I am trying to break up the word counting into several goroutines that can run in parallel.</p>\n\n<p>Initially, I tried using a single map that was passed by reference to each goroutine, where each goroutine would count the words in part of the document. This caused a panic because the program was trying to write to the same map from multiple goroutines simultaniously. To solve this issue, I created a mutex that would prevent multiple goroutines from writing to the map simultaniously. At this point, the program functioned as expected, but with no performance difference compared to the original sequential implementation of the <code>WordCount</code> function. At second thought, this is not surprising given that the mutex forces the other goroutines to wait before writing to the map, hence preventing parallel computation.</p>\n\n<p>Below is the code that uses a mutex to avoid the described runtime panic, but also fails to count words in parallel.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func WordCount(words []string, startWord int, endWord int, freqs map[string]int, waitGroup *sync.WaitGroup, mutex *sync.Mutex) {\n    mutex.Lock()\n    for i := startWord; i &lt; endWord; i++ {\n        word := words[i]\n        freqs[word]++\n    }\n    mutex.Unlock()\n    waitGroup.Done()\n}\n\nfunc ParallelWordCount(text string) map[string]int {\n    // Split text into string array of the words in text.\n    text = strings.ToLower(text)\n    text = strings.ReplaceAll(text, \",\", \"\")\n    text = strings.ReplaceAll(text, \".\", \"\")\n    words := strings.Fields(text)\n    length := len(words)\n\n    freqs := make(map[string]int)\n\n    var mutex sync.Mutex\n    var waitGroup sync.WaitGroup\n    waitGroup.Add(2)\n    defer waitGroup.Wait()\n\n    threads := 2\n    wordsPerThread := length / threads // always rounds down\n    wordsInLastThread := length - (threads-1)*wordsPerThread\n    startWord := -wordsPerThread\n    var endWord int\n    for i := 1; i &lt;= threads; i++ {\n        if i &lt; threads {\n            startWord += wordsPerThread * i\n            endWord += wordsPerThread * i\n        } else {\n            startWord += wordsInLastThread\n            endWord += wordsInLastThread\n        }\n        go WordCount(words, startWord, endWord, freqs, &amp;waitGroup, &amp;mutex)\n    }\n\n    return freqs\n}\n</code></pre>\n\n<p>I belive that I could achieve parallel word counting if I would create a local map of word frequencies for each goroutine and in the end combine the local frequency maps into a single map with the word counts for the entire text file. The problem I am currently facing is how to combine the local frequency maps. Concretely, I need to know how to combine multiple maps into a map whose value for a given key is the sum of the values of the key in the maps to be combined.</p>\n\n<p>To clarify the underlying logic of what I am trying to do I have included the below example. The <code>ConcurrentSum</code> function returns the sum of the elements in an array by computing the lower and upper halves of the array concurrently. In my case, I want to, in parallel, count words in different parts of my text file and, ultimately, combine the word counts into a single map of word counts representative of the entire document.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func sum(a []int, res chan&lt;- int) {\n    var sum int\n    for i := 0; i &lt; len(a); i++ {\n        sum += a[i]\n    }\n    res &lt;- sum\n}\n\n// concurrently sum the array a.\nfunc ConcurrentSum(a []int) int {\n    n := len(a)\n    ch := make(chan int)\n    go sum(a[:n/2], ch)\n    go sum(a[n/2:], ch)\n    return &lt;-ch + &lt;-ch\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1554028504, "post_id": 55440016, "comment_id": 97596477, "body": "The <code>asd</code> field is <i>unexported</i>. Change it to <code>Asd string `json:&quot;asd&quot;`</code>. Identifiers (types, functions, fields, methods, variables, constants, etc.) that start with upper case letter are exported, those that start with lower case are unexported. The json package works only for exported fields, unexported ones are ignored."}, {"owner": {"reputation": 135, "user_id": 7625511, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Lv5SUCCgIKs/AAAAAAAAAAI/AAAAAAAAAWA/odI-XN3neeA/photo.jpg?sz=128", "display_name": "howHighUR", "link": "https://stackoverflow.com/users/7625511/howhighur"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1554028692, "post_id": 55440016, "comment_id": 97596535, "body": "@mkopriva oh god thank you, it&#39;s working! Add this as answer so I could mark it as right"}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 4, "last_activity_date": 1554028950, "creation_date": 1554028950, "answer_id": 55440096, "question_id": 55440016, "link": "https://stackoverflow.com/questions/55440016/always-got-empty-body-from-post-req/55440096#55440096", "title": "Always got empty body from POST req", "body": "<p>The <code>asd</code> field is <em>unexported</em>. Change it to <code>Asd string `json:\"asd\"`</code>. Identifiers (types, functions, fields, methods, variables, constants, etc.) that start with upper case letter are exported, those that start with lower case are unexported. The json package works only with exported fields, unexported ones are ignored.</p>\n"}], "owner": {"reputation": 135, "user_id": 7625511, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Lv5SUCCgIKs/AAAAAAAAAAI/AAAAAAAAAWA/odI-XN3neeA/photo.jpg?sz=128", "display_name": "howHighUR", "link": "https://stackoverflow.com/users/7625511/howhighur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 0, "accepted_answer_id": 55440096, "answer_count": 1, "score": 0, "last_activity_date": 1554028950, "creation_date": 1554028372, "last_edit_date": 1554028564, "question_id": 55440016, "link": "https://stackoverflow.com/questions/55440016/always-got-empty-body-from-post-req", "title": "Always got empty body from POST req", "body": "<p>I'm setting up HTTP server, and want <code>/test</code> route to accept POST request, but with this code body is always empty. This is my request body:</p>\n\n<pre><code>{\n    \"asd\": \"123\"\n}\n</code></pre>\n\n<p>This is my code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    router := mux.NewRouter()\n    router.HandleFunc(\"/test\", handleData).Methods(\"POST\")\n    log.Fatal(http.ListenAndServe(\":80\", router))\n}\n\ntype test1 struct {\n    asd string\n}\n\nfunc handleData(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    var test test1\n    _ = json.NewDecoder(r.Body).Decode(&amp;test)\n    json.NewEncoder(w).Encode(test)\n}\n</code></pre>\n"}, {"tags": ["maven", "go"], "comments": [{"owner": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "edited": false, "score": 1, "creation_date": 1554020557, "post_id": 55438921, "comment_id": 97594896, "body": "Wow, that&#39;s a new level... What for?"}, {"owner": {"reputation": 143, "user_id": 8723915, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Lc3rmXgHOGc/AAAAAAAAAAI/AAAAAAAAAKc/-0JuDgpLAk4/photo.jpg?sz=128", "display_name": "Akshay chittal", "link": "https://stackoverflow.com/users/8723915/akshay-chittal"}, "reply_to_user": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "edited": false, "score": 0, "creation_date": 1554020808, "post_id": 55438921, "comment_id": 97594936, "body": "@NestorSokil To integrate open-source GO code in my JAVA application"}, {"owner": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "edited": false, "score": 1, "creation_date": 1554021341, "post_id": 55438921, "comment_id": 97595019, "body": "Are you going to call Go-code through JNI? Please add these details into your question."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1554023873, "post_id": 55438921, "comment_id": 97595486, "body": "What have you tried? What problems did you encounter?"}, {"owner": {"reputation": 143, "user_id": 8723915, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Lc3rmXgHOGc/AAAAAAAAAAI/AAAAAAAAAKc/-0JuDgpLAk4/photo.jpg?sz=128", "display_name": "Akshay chittal", "link": "https://stackoverflow.com/users/8723915/akshay-chittal"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1554121889, "post_id": 55438921, "comment_id": 97623658, "body": "@Flimzy, I used MVN GoLang Wrapper plugin during the maven build, Build got succeeded and jar file has been generated. But I&#39;m not sure, its the right way?"}, {"owner": {"reputation": 143, "user_id": 8723915, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Lc3rmXgHOGc/AAAAAAAAAAI/AAAAAAAAAKc/-0JuDgpLAk4/photo.jpg?sz=128", "display_name": "Akshay chittal", "link": "https://stackoverflow.com/users/8723915/akshay-chittal"}, "reply_to_user": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "edited": false, "score": 0, "creation_date": 1554122040, "post_id": 55438921, "comment_id": 97623736, "body": "@NestorSokil, not through JNI. I just need an executable from my go source code when ever I perform maven build."}], "answers": [{"comments": [{"owner": {"reputation": 143, "user_id": 8723915, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Lc3rmXgHOGc/AAAAAAAAAAI/AAAAAAAAAKc/-0JuDgpLAk4/photo.jpg?sz=128", "display_name": "Akshay chittal", "link": "https://stackoverflow.com/users/8723915/akshay-chittal"}, "edited": false, "score": 0, "creation_date": 1554124505, "post_id": 55455746, "comment_id": 97625239, "body": "That was really helpful. In both the cases do we need to have GO installed in local?"}, {"owner": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "reply_to_user": {"reputation": 143, "user_id": 8723915, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Lc3rmXgHOGc/AAAAAAAAAAI/AAAAAAAAAKc/-0JuDgpLAk4/photo.jpg?sz=128", "display_name": "Akshay chittal", "link": "https://stackoverflow.com/users/8723915/akshay-chittal"}, "edited": false, "score": 0, "creation_date": 1554126461, "post_id": 55455746, "comment_id": 97626485, "body": "@Akshaychittal For shell script - definitely (yet you can script it to pull GO SDK/docker image). But from the docs of the plugin, you can specify the golang version to build with and it will install it from official SDK site distribution."}], "tags": [], "owner": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "is_accepted": true, "score": 2, "last_activity_date": 1554123561, "creation_date": 1554123561, "answer_id": 55455746, "question_id": 55438921, "link": "https://stackoverflow.com/questions/55438921/how-to-build-go-executable-with-maven/55455746#55455746", "title": "How to build GO executable with maven", "body": "<p>You can just put your <code>go build</code> command into a shell script and run it with this plugin:</p>\n\n<pre><code>&lt;plugin&gt;\n  &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt;\n  &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;\n  &lt;executions&gt;\n    &lt;execution&gt;\n      &lt;id&gt;Build Go binary&lt;/id&gt;\n      &lt;phase&gt;generate-sources&lt;/phase&gt;\n      &lt;goals&gt;\n        &lt;goal&gt;exec&lt;/goal&gt;\n      &lt;/goals&gt;\n      &lt;configuration&gt;\n        &lt;executable&gt;${basedir}/build-golang-app.sh&lt;/executable&gt;\n      &lt;/configuration&gt;\n    &lt;/execution&gt;\n  &lt;/executions&gt;\n&lt;/plugin&gt;\n</code></pre>\n\n<p>Other option is this <a href=\"https://github.com/raydac/mvn-golang\" rel=\"nofollow noreferrer\">Golang plugin</a> which is more feature-rich and specific to this problem. However for simple use cases I would still go with Shell script.</p>\n"}, {"tags": [], "owner": {"reputation": 693, "user_id": 1802697, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eH3MJ.jpg?s=128&g=1", "display_name": "Igor Maznitsa", "link": "https://stackoverflow.com/users/1802697/igor-maznitsa"}, "is_accepted": false, "score": 3, "last_activity_date": 1555272369, "creation_date": 1555272369, "answer_id": 55679554, "question_id": 55438921, "link": "https://stackoverflow.com/questions/55438921/how-to-build-go-executable-with-maven/55679554#55679554", "title": "How to build GO executable with maven", "body": "<p>there is <a href=\"https://github.com/raydac/mvn-golang\" rel=\"nofollow noreferrer\">special plugin for maven to build golang projects</a>, it is called mvn-golang-wrapper, <a href=\"https://github.com/raydac/mvn-golang-example\" rel=\"nofollow noreferrer\">there is some example Hello World project to show how to make simple project</a>, <a href=\"https://github.com/raydac/mvn-golang/tree/master/mvn-golang-examples\" rel=\"nofollow noreferrer\">a lot of examples can be found in the maven plugin project repository</a> . The plugin allows work with maven central and it allows to share golang projects and their parts through maven repository, also it has special system to work with repositories and use versions through branch, tag and revision.  </p>\n"}], "owner": {"reputation": 143, "user_id": 8723915, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Lc3rmXgHOGc/AAAAAAAAAAI/AAAAAAAAAKc/-0JuDgpLAk4/photo.jpg?sz=128", "display_name": "Akshay chittal", "link": "https://stackoverflow.com/users/8723915/akshay-chittal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1891, "favorite_count": 0, "accepted_answer_id": 55455746, "answer_count": 2, "score": 2, "last_activity_date": 1555272369, "creation_date": 1554019240, "last_edit_date": 1554122083, "question_id": 55438921, "link": "https://stackoverflow.com/questions/55438921/how-to-build-go-executable-with-maven", "title": "How to build GO executable with maven", "body": "<p>I have my Go source code, after <code>go build</code>, an executable is generated, which accepts some parameters to produce the output.\nIs there any way build the executable from maven build with any plugins?</p>\n"}, {"tags": ["go", "visual-studio-code"], "comments": [{"owner": {"reputation": 680, "user_id": 7274408, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jp2HB.png?s=128&g=1", "display_name": "Brad", "link": "https://stackoverflow.com/users/7274408/brad"}, "edited": false, "score": 0, "creation_date": 1554019278, "post_id": 55438896, "comment_id": 97594720, "body": "do you have any other source code files in the <code>webdav</code> package?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1554019467, "post_id": 55438896, "comment_id": 97594749, "body": "Turn of linting/veting/whatever of 3rd party packages in vscode."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1554019538, "post_id": 55438896, "comment_id": 97594764, "body": "And please get use to build your projects with <code>go build</code>. (Using <code>go run</code> is acceptable only for single file scripts and never for actual programs.)"}, {"owner": {"reputation": 535, "user_id": 3721234, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/54b08fe35dde3d72698ba96cf84fc5be?s=128&d=identicon&r=PG&f=1", "display_name": "mR.Rian", "link": "https://stackoverflow.com/users/3721234/mr-rian"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1554021075, "post_id": 55438896, "comment_id": 97594974, "body": "@Volker where is veting ?"}], "answers": [{"comments": [{"owner": {"reputation": 535, "user_id": 3721234, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/54b08fe35dde3d72698ba96cf84fc5be?s=128&d=identicon&r=PG&f=1", "display_name": "mR.Rian", "link": "https://stackoverflow.com/users/3721234/mr-rian"}, "edited": false, "score": 0, "creation_date": 1554236322, "post_id": 55440524, "comment_id": 97675541, "body": "change  main.go directory , and put outside of /work solved my problem ."}], "tags": [], "owner": {"reputation": 3800, "user_id": 1037465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b68d0fdfc74f6a893936d043d2f545b?s=128&d=identicon&r=PG", "display_name": "a-h", "link": "https://stackoverflow.com/users/1037465/a-h"}, "is_accepted": true, "score": 2, "last_activity_date": 1554032412, "creation_date": 1554032412, "answer_id": 55440524, "question_id": 55438896, "link": "https://stackoverflow.com/questions/55438896/can-not-run-first-golang-project-in-vscode/55440524#55440524", "title": "can not run first golang project in vscode", "body": "<p>It looks to me like you've installed/unarchived Go at /work, which I assume is your home directory.</p>\n\n<p>As a result, when you try and build your program which is also in /work (rather than use <code>go run</code> from the command line), all of the code underneath the /work directory where your main.go file are also being checked by VS Code.</p>\n\n<p>The simplest solution might be to put your <code>main.go</code> file outside the <code>work</code> directory completely, or put it within the Go path at <code>/work/src/github.com/&lt;your_username&gt;/&lt;your_package&gt;</code>.</p>\n"}], "owner": {"reputation": 535, "user_id": 3721234, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/54b08fe35dde3d72698ba96cf84fc5be?s=128&d=identicon&r=PG&f=1", "display_name": "mR.Rian", "link": "https://stackoverflow.com/users/3721234/mr-rian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "accepted_answer_id": 55440524, "answer_count": 1, "score": 0, "last_activity_date": 1554032412, "creation_date": 1554018897, "question_id": 55438896, "link": "https://stackoverflow.com/questions/55438896/can-not-run-first-golang-project-in-vscode", "title": "can not run first golang project in vscode", "body": "<p>I am new in golang.</p>\n\n<p>i can not start my go file in VSCODE ,my code is simple </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"test\")\n}\n</code></pre>\n\n<p>when i run <strong>go run main.go</strong> in my terminal every thing works fine but when i save it in my vscode i get too many errors all like </p>\n\n<p><em>/work/src/golang.org/x/net/webdav/prop_test.go:217: encoding/xml.Name composite literal uses unkeyed fields</em></p>\n\n<p>my main.go file located at /work</p>\n\n<p>how can i solve the problem ? </p>\n"}, {"tags": ["http", "go", "proxy"], "comments": [{"owner": {"reputation": 1056, "user_id": 4154706, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/b91e34f88755d8517830e1389972fb18?s=128&d=identicon&r=PG", "display_name": "aitchkhan", "link": "https://stackoverflow.com/users/4154706/aitchkhan"}, "edited": false, "score": 1, "creation_date": 1554015014, "post_id": 55438278, "comment_id": 97594048, "body": "can you paste the  error?"}, {"owner": {"reputation": 579, "user_id": 11206879, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bS2D6.png?s=128&g=1", "display_name": "Pan Ke", "link": "https://stackoverflow.com/users/11206879/pan-ke"}, "edited": false, "score": 0, "creation_date": 1554022971, "post_id": 55438278, "comment_id": 97595330, "body": "did the nginx server receive request from your go client?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1554029834, "post_id": 55438278, "comment_id": 97596745, "body": "nginx is a reverse proxy. No special configuration is required in Go. Just send the request to nginx&#39;s address and port. Transport.Proxy is for forward proxies, typically used for caching and/or filtering."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 1, "creation_date": 1554033364, "post_id": 55438278, "comment_id": 97597572, "body": "Peter is correct. In your node.js example you don&#39;t actually tell it to use a HTTP proxy - you just say that a different IP address should be used to access the target than the one returned by DNS. Thus it does a normal HTTP request. Your Go code instead does a HTTP proxy request which is different from a normal HTTP request and is not expected by the reverse proxy. Thus it fails."}, {"owner": {"reputation": 5190, "user_id": 3873012, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/SLbs6.jpg?s=128&g=1", "display_name": "Selfish", "link": "https://stackoverflow.com/users/3873012/selfish"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1554109408, "post_id": 55438278, "comment_id": 97616946, "body": "@Peter was right indeed. If you want to add that as an answer I&#39;ll accept. Thank you!!"}], "answers": [{"comments": [{"owner": {"reputation": 5190, "user_id": 3873012, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/SLbs6.jpg?s=128&g=1", "display_name": "Selfish", "link": "https://stackoverflow.com/users/3873012/selfish"}, "edited": false, "score": 0, "creation_date": 1554315393, "post_id": 55480689, "comment_id": 97709859, "body": "This is gold. Thank you!"}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 1, "last_activity_date": 1554226970, "creation_date": 1554226970, "answer_id": 55480689, "question_id": 55438278, "link": "https://stackoverflow.com/questions/55438278/how-to-http-https-get-via-proxy/55480689#55480689", "title": "How to HTTP/HTTPS GET via Proxy", "body": "<p>You are confusing forward and reverse proxies. </p>\n\n<p>Conceptually it works like this:</p>\n\n<p>Reverse proxies</p>\n\n<ul>\n<li>are deployed near the server side of a connection</li>\n<li>pretend to be the origin</li>\n<li>are controlled by or on behalf of the site owner</li>\n<li>are not inherently known to the user agent</li>\n</ul>\n\n<p>Forward proxies </p>\n\n<ul>\n<li>are deployed near the client side of a connection</li>\n<li>are controlled by or on behalf of the user agent</li>\n<li>are explicitely configured in the user agent</li>\n</ul>\n\n<p>(Reality is more complicated than that, of course, but this is sufficient to highlight the differences).</p>\n\n<pre><code>                                     Internet                    ||  Invisible to\n                                         +                       ||  User Agent\n                                         |                       ||\n +------------+     +---------------+    |    +---------------+  ||  +--------+\n |            |     |               |    |    |               |  ||  |        |\n | User Agent +----&gt;+ Forward Proxy +--------&gt;+ Reverse Proxy +-----&gt;+ Origin |\n |            |     |               |    |    |               |  ||  |        |\n +------------+     +---------------+    |    +---------------+  ||  +--------+\n                                         |                       ||\n                                         +                       ||\n                                                                 ||\n</code></pre>\n\n<p>nginx is a reverse proxy, but by setting the Transport.Proxy field you treat it like a forward proxy. This is the request that nginx sees:</p>\n\n<pre><code>CONNECT example.com:443 HTTP/1.1\nHost: example.com:443\nUser-Agent: Go-http-client/1.1\n</code></pre>\n\n<p>This essentialy means, \"Establish a TCP connection to example.com:443 and then act like a dumb TCP proxy.\" Since nginx is a reverse proxy only it is rightfully confused when confronted with a CONNECT request.</p>\n\n<p>To send a request to a particular reverse proxy you simply have to modify the request URL, and possibly the Host header (that depends on whether or not nginx expects a particular <code>server_name</code>). No special client configuration is required. </p>\n\n<p>Assuming nginx runs on <code>198.51.100.1</code>:</p>\n\n<pre><code>req, _ := http.NewRequest(\"GET\", \"http://198.51.100.1\", nil)\nreq.Host = \"example.com\" // if necessary\nres, _ := http.DefaultClient.Do(req)\n</code></pre>\n\n<p>This causes the following request to be sent to 198.51.100.1:80:</p>\n\n<pre><code>GET / HTTP/1.1\nHost: example.com\nUser-Agent: Go-http-client/1.1\nAccept-Encoding: gzip\n</code></pre>\n\n<p>Note that it is entirely up to the reverse proxy if the request actually hits example.com. The client has no knowledge or control over what happens after the proxy.</p>\n\n<p>If you are not in a position to change the request, you can set the <a href=\"https://golang.org/pkg/net/http/#Transport\" rel=\"nofollow noreferrer\">Transport.DialContext</a> function such that your proxy is always dialed, independent of the request URL and Host header. This results in the same request as above and should be equivalent to your JavaScript code:</p>\n\n<pre><code>c := &amp;http.Client{\n    Transport: &amp;http.Transport{\n        DialContext: func(ctx context.Context, network, addr string) (net.Conn, error) {\n            return (&amp;net.Dialer{}).DialContext(ctx, \"tcp\", \"198.51.100.1:80\")\n\n            // Or 198.51.100.1:443 if nginx has TLS enabled, although that almost\n            // certainly causes TLS validation errors because a certificate for \n            // example.com is expected.\n        },\n    },\n}\n\nreq, _ := http.NewRequest(\"GET\", \"http://example.com\", nil)\nres, _ := c.Do(req)\n</code></pre>\n"}], "owner": {"reputation": 5190, "user_id": 3873012, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/SLbs6.jpg?s=128&g=1", "display_name": "Selfish", "link": "https://stackoverflow.com/users/3873012/selfish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 728, "favorite_count": 0, "accepted_answer_id": 55480689, "answer_count": 1, "score": -2, "last_activity_date": 1554226970, "creation_date": 1554011495, "last_edit_date": 1554023899, "question_id": 55438278, "link": "https://stackoverflow.com/questions/55438278/how-to-http-https-get-via-proxy", "title": "How to HTTP/HTTPS GET via Proxy", "body": "<p>I'm trying to issue an http/s request via a working proxy.\nI have a working example in a legacy project in node JS, where using the native Node.js <code>https</code> (<code>require('https')</code>) lib can make the request if used with the following options object:</p>\n\n<pre><code>{\n    host: \"&lt;actual target url&gt;\"\n    hostname: \"&lt;proxy ip&gt;\"\n}\n</code></pre>\n\n<p>For example, to make an https request to <code>example.com</code> via proxy <code>1.1.1.1</code>, I'll use:</p>\n\n<pre><code>{\n    host: \"http://example.com\"\n    hostname: \"1.1.1.1\"\n}\n</code></pre>\n\n<hr>\n\n<p>In Golang, I've tried several of the documented options.\nSpecifically, I'd expect:</p>\n\n<pre><code>proxyUrl, _ := url.Parse(\"&lt;proxy ip&gt;\")\nmyClient := &amp;http.Client{Transport: &amp;http.Transport{Proxy: http.ProxyURL(proxyUrl)}}\nresp, err := myClient.Get(\"https://&lt;actual target url&gt;/...\")\n</code></pre>\n\n<p>The result is the proxy rejecting the connection, indicating something incorrect in the request. (<code>err</code> exists, and resp is <code>nil</code>)</p>\n\n<hr>\n\n<p>The proxy itself is an NGINX instance configured according to this gist:</p>\n\n<p><a href=\"https://gist.github.com/selfish/6e858eb17aa82971d25b21775e9649cb#file-nginx-conf\" rel=\"nofollow noreferrer\">https://gist.github.com/selfish/6e858eb17aa82971d25b21775e9649cb#file-nginx-conf</a></p>\n\n<p>Can anyone help understand the difference in HTTP handling for Node.js and Golang?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1554008969, "post_id": 55438037, "comment_id": 97593133, "body": "What is your customTask doing. The code here shouldn&#39;t leak memory so it might be something in there. Does it exit the function when it completes?"}, {"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1554009047, "post_id": 55438037, "comment_id": 97593143, "body": "Also as an aside you can range over the channel rather than having to have a for loop with true <a href=\"https://gobyexample.com/range-over-channels\" rel=\"nofollow noreferrer\">gobyexample.com/range-over-channels</a>"}, {"owner": {"reputation": 92, "user_id": 10657167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9103e73ebed67f859497de97009b2be0?s=128&d=identicon&r=PG&f=1", "display_name": "Max2019", "link": "https://stackoverflow.com/users/10657167/max2019"}, "reply_to_user": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1554009518, "post_id": 55438037, "comment_id": 97593203, "body": "@lain Duncan For loop true is required becuase first tick should be immediate and then it should wait for 10 seconds, If i only use range then first tick is delayed by 10 seconds. Custom task code is as follows . it is just dummy since before executing in prod I need to debug that memory issue."}, {"owner": {"reputation": 92, "user_id": 10657167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9103e73ebed67f859497de97009b2be0?s=128&d=identicon&r=PG&f=1", "display_name": "Max2019", "link": "https://stackoverflow.com/users/10657167/max2019"}, "reply_to_user": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1554009572, "post_id": 55438037, "comment_id": 97593207, "body": "<code>func customTask(t time.Time) {  \tfmt.Println(&quot;Tick at &quot;, t) \tvar s []int \tfor i := 1; i &lt; 500000; i++ { \t\ts = append(s, 0) \t}  }</code>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1556389007, "post_id": 55438037, "comment_id": 98425437, "body": "A more idiomatic way to write the loop is <code>for { go customTask(time.Now()); &lt;-ticker.C }</code>"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1554052432, "post_id": 55440722, "comment_id": 97602297, "body": "You should not need to call <code>CloseIdleConnections</code> under normal circumstances. Chances are you\u2019re not properly handing responses or transports."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1554126857, "post_id": 55440722, "comment_id": 97626723, "body": "This describes a fix to code that was never given in the original question, so it is unlikely to help future users that might land on this in a search. Can you update the question and/or answer to provide enough context for this to be useful to others?"}, {"owner": {"reputation": 92, "user_id": 10657167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9103e73ebed67f859497de97009b2be0?s=128&d=identicon&r=PG&f=1", "display_name": "Max2019", "link": "https://stackoverflow.com/users/10657167/max2019"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554207255, "post_id": 55440722, "comment_id": 97659476, "body": "@Adrian Question Updated"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554211318, "post_id": 55440722, "comment_id": 97662100, "body": "The quoted code in the question doesn&#39;t show anywhere where the stated fixes could be applied."}, {"owner": {"reputation": 92, "user_id": 10657167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9103e73ebed67f859497de97009b2be0?s=128&d=identicon&r=PG&f=1", "display_name": "Max2019", "link": "https://stackoverflow.com/users/10657167/max2019"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1554355014, "post_id": 55440722, "comment_id": 97721918, "body": "@Adrian, Updated answer"}], "tags": [], "owner": {"reputation": 92, "user_id": 10657167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9103e73ebed67f859497de97009b2be0?s=128&d=identicon&r=PG&f=1", "display_name": "Max2019", "link": "https://stackoverflow.com/users/10657167/max2019"}, "is_accepted": true, "score": -2, "last_activity_date": 1554354994, "last_edit_date": 1554354994, "creation_date": 1554033900, "answer_id": 55440722, "question_id": 55438037, "link": "https://stackoverflow.com/questions/55438037/scheduling-task-without-memory-leak/55440722#55440722", "title": "Scheduling task without memory leak", "body": "<p>Leaking goroutines were culprits. used <a href=\"https://github.com/bcicen/grmon\" rel=\"nofollow noreferrer\">https://github.com/bcicen/grmon</a> and found out that number of goroutines were increasing along with scheduler ticks. They were waiting at net/http package. </p>\n\n<p><strong>response.body.close(</strong>)  and <strong>Transport.CloseIdleConnections()</strong> fixed the issue. NewTicker works fine. Thanks  </p>\n\n<p>Fix should be applied after we make http call.</p>\n\n<pre><code>if err == nil &amp;&amp; statusCode == http.StatusOK {\n            httpSuccess = true\n            //fmt.Println(\"httpSuccess\", httpSuccess)\n\n            tr.CloseIdleConnections()\n            return response, nil\n        }\n</code></pre>\n\n<pre><code>    if response.Body != nil {\n        if err := response.Body.Close(); err != nil {\n\n        }\n    }\n\n</code></pre>\n"}], "owner": {"reputation": 92, "user_id": 10657167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9103e73ebed67f859497de97009b2be0?s=128&d=identicon&r=PG&f=1", "display_name": "Max2019", "link": "https://stackoverflow.com/users/10657167/max2019"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "accepted_answer_id": 55440722, "answer_count": 1, "score": -3, "last_activity_date": 1554354994, "creation_date": 1554008622, "last_edit_date": 1554207233, "question_id": 55438037, "link": "https://stackoverflow.com/questions/55438037/scheduling-task-without-memory-leak", "title": "Scheduling task without memory leak", "body": "<p>I have created a scheduler which run every 10 seconds using golang newTicker. \nEach tick creates a new goroutine which performs some memory intensive task but finishes well before 10 seconds are completed.</p>\n\n<p>I have deployed this in kubernetes. container has both scheduler and http server. HTTP server will take a single request and run the schedule once. This is for retrying missed tasked manually. Code is as follows:</p>\n\n<pre><code>func startScheduledTask() {\n    fmt.Println(\"Task Started...\", time.Now())\n    ticker := time.NewTicker(10 * time.Second)\n    defer ticker.Stop()\n    for ; true; &lt;-ticker.C {\n        go customTask(time.Now())       \n    }\n}\n\n</code></pre>\n\n<p>I observed that this code is not releasing memory. Docker stats for container shows the memory is growing. Though it has memory limit on k8s, and k8s will restart in case of OOMKilled, one scheduled tasked is still missed and manual intervention is required. Is there a way to release this memory?</p>\n\n<p>customTask Code is making HTTP Request for each tick.</p>\n\n<p>Docker stats and container logs are as follows.</p>\n\n<p><a href=\"https://i.stack.imgur.com/2t06U.jpg\" rel=\"nofollow noreferrer\">Docker stats and container log</a></p>\n"}, {"tags": ["function", "go"], "comments": [{"owner": {"reputation": 579, "user_id": 11206879, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bS2D6.png?s=128&g=1", "display_name": "Pan Ke", "link": "https://stackoverflow.com/users/11206879/pan-ke"}, "edited": false, "score": 5, "creation_date": 1554009587, "post_id": 55437986, "comment_id": 97593209, "body": "no, you can&#39;t do this in go"}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1554023994, "post_id": 55438909, "comment_id": 97595513, "body": "Please don&#39;t do that. It&#39;s <i>far</i> less readable than the natural alternative."}], "tags": [], "owner": {"reputation": 680, "user_id": 7274408, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jp2HB.png?s=128&g=1", "display_name": "Brad", "link": "https://stackoverflow.com/users/7274408/brad"}, "is_accepted": false, "score": -1, "last_activity_date": 1554019067, "creation_date": 1554019067, "answer_id": 55438909, "question_id": 55437986, "link": "https://stackoverflow.com/questions/55437986/how-to-add-multiple-values-returned-by-a-function-directly/55438909#55438909", "title": "How to add multiple values returned by a function directly", "body": "<p>You can use a helper method which takes a variadic number of parameters and just returns the slice created from the params</p>\n\n<pre><code>func aggregator(res ...interface{}) []interface{}{\n    return res\n}\n</code></pre>\n\n<p>If you want to escape the extra type assertion you can set the type you want to work with, in your case <code>int</code>, for the input and output parameters of the helper function. But here is an example using <code>interface{}</code>:</p>\n\n<pre><code>func main() {\n    fmt.Printf(\"%d, %d\", aggregator(f())[0].(int), aggregator(f())[1].(int))\n}\n\nfunc aggregator(res ...interface{}) []interface{}{\n    return res\n}\n\nfunc f () (int, int) {\n    return 1,2 \n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/elLyBIyEdv4\" rel=\"nofollow noreferrer\">Go Playground.</a></p>\n"}], "owner": {"reputation": 2052, "user_id": 5841297, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e504d8fcbf8a9f2babac46fa5d281d7c?s=128&d=identicon&r=PG&f=1", "display_name": "Maruthi Adithya", "link": "https://stackoverflow.com/users/5841297/maruthi-adithya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1554023936, "creation_date": 1554007979, "last_edit_date": 1554023936, "question_id": 55437986, "link": "https://stackoverflow.com/questions/55437986/how-to-add-multiple-values-returned-by-a-function-directly", "title": "How to add multiple values returned by a function directly", "body": "<p>I have the following code.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    a := 0\n    b := 0\n    a, b += getValues()\n    fmt.Println(a, b)\n}\n\nfunc getValues() (a int, b int) {\n    a = 0\n    b = 5\n    return\n}\n</code></pre>\n\n<p>I want to directly add the multiple values returned by a function. I just want to if there is a provision like this in Go.</p>\n\n<p>When I run the above code, I get the following error.</p>\n\n<pre><code>syntax error: unexpected +=, expecting := or = or comma\n</code></pre>\n"}, {"tags": ["go", "dialogflow-es", "actions-on-google"], "comments": [{"owner": {"reputation": 10420, "user_id": 1491707, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/rOXkJ.png?s=128&g=1", "display_name": "Nick Felker", "link": "https://stackoverflow.com/users/1491707/nick-felker"}, "edited": false, "score": 0, "creation_date": 1554055324, "post_id": 55437979, "comment_id": 97603088, "body": "Is this for an action, or a different dialogflow integration?"}, {"owner": {"reputation": 3, "user_id": 10181256, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/227db9dc32d95231c63865bc4c5682f2?s=128&d=identicon&r=PG&f=1", "display_name": "James Kan", "link": "https://stackoverflow.com/users/10181256/james-kan"}, "reply_to_user": {"reputation": 10420, "user_id": 1491707, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/rOXkJ.png?s=128&g=1", "display_name": "Nick Felker", "link": "https://stackoverflow.com/users/1491707/nick-felker"}, "edited": false, "score": 0, "creation_date": 1554064692, "post_id": 55437979, "comment_id": 97605540, "body": "Hi Nick, this is for action."}], "answers": [{"tags": [], "owner": {"reputation": 10420, "user_id": 1491707, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/rOXkJ.png?s=128&g=1", "display_name": "Nick Felker", "link": "https://stackoverflow.com/users/1491707/nick-felker"}, "is_accepted": false, "score": 1, "last_activity_date": 1554126293, "creation_date": 1554126293, "answer_id": 55456657, "question_id": 55437979, "link": "https://stackoverflow.com/questions/55437979/terminating-dialogflow-application-from-custom-client/55456657#55456657", "title": "Terminating Dialogflow Application from Custom Client", "body": "<p>To mark the end of an Action and close it, you can return <code>false</code> for the <a href=\"https://developers.google.com/actions/build/json/dialogflow-webhook-json#dialogflow-end-conversation-example\" rel=\"nofollow noreferrer\"><code>expectUserResponse</code></a> field, like:</p>\n\n<pre><code>{\n  \"payload\": {\n  \"google\": {\n    \"expectUserResponse\": false,\n    \"richResponse\": {\n      \"items\": [\n        {\n          \"simpleResponse\": {\n            \"textToSpeech\": \"Goodbye!\"\n          }\n        }\n      ]\n    }\n  }\n }\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 10181256, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/227db9dc32d95231c63865bc4c5682f2?s=128&d=identicon&r=PG&f=1", "display_name": "James Kan", "link": "https://stackoverflow.com/users/10181256/james-kan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1554126293, "creation_date": 1554007912, "last_edit_date": 1554064882, "question_id": 55437979, "link": "https://stackoverflow.com/questions/55437979/terminating-dialogflow-application-from-custom-client", "title": "Terminating Dialogflow Application from Custom Client", "body": "<p>I created a custom Golang server to handle Dialogflow's fulfillment. I want my fulfillment server to tell Dialogflow (which would be running the compiled version on a Google home) to terminate my action after a certain period of inactivity. Is this possible in the current architecture?</p>\n"}, {"tags": ["go", "hyperledger-fabric"], "answers": [{"comments": [{"owner": {"reputation": 157, "user_id": 9443806, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CG4wm.png?s=128&g=1", "display_name": "Haardik", "link": "https://stackoverflow.com/users/9443806/haardik"}, "edited": false, "score": 0, "creation_date": 1558012782, "post_id": 56160353, "comment_id": 98965698, "body": "IBM blockchain platform doesn\u2019t give the crypto config files you get if you deploy the network yourself, that\u2019s why it\u2019s a problem"}, {"owner": {"reputation": 1, "user_id": 11501916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b7e73defd365301368c5c93b8ce876a?s=128&d=identicon&r=PG&f=1", "display_name": "Kreangkrai.sup", "link": "https://stackoverflow.com/users/11501916/kreangkrai-sup"}, "reply_to_user": {"reputation": 157, "user_id": 9443806, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CG4wm.png?s=128&g=1", "display_name": "Haardik", "link": "https://stackoverflow.com/users/9443806/haardik"}, "edited": false, "score": 0, "creation_date": 1558061401, "post_id": 56160353, "comment_id": 98984014, "body": "I agree with you. I workaround to much to solved config files. And now I try too hard with GO SDK. I can&#39;t run go test from Github and I don&#39;t know why."}], "tags": [], "owner": {"reputation": 1, "user_id": 11501916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b7e73defd365301368c5c93b8ce876a?s=128&d=identicon&r=PG&f=1", "display_name": "Kreangkrai.sup", "link": "https://stackoverflow.com/users/11501916/kreangkrai-sup"}, "is_accepted": false, "score": 0, "last_activity_date": 1557977059, "creation_date": 1557977059, "answer_id": 56160353, "question_id": 55437470, "link": "https://stackoverflow.com/questions/55437470/fabric-sdk-unable-to-initialize-cryptosuite-config/56160353#56160353", "title": "Fabric SDK unable to initialize cryptosuite config", "body": "<p>I add \"cryptoconfig\" path to the client.</p>\n\n<p>BCCSP is optional, and you can remove.</p>\n\n<p>I added the sample config, please see below.</p>\n\n<p>More detail config at Github go-SDK <a href=\"https://github.com/hyperledger/fabric-sdk-go/blob/master/pkg/core/config/testdata/template/config.yaml\" rel=\"nofollow noreferrer\">config.yaml</a></p>\n\n<pre><code>{\n\"name\": \"first-network-org1\",\n\"version\": \"1.0.0\",\n\"client\": {\n    \"organization\": \"Org1\",\n    \"logging\": {\n        \"level\": \"info\"\n    },\n    \"cryptoconfig\": {\n        \"path\": \"crypto-config\"\n    },\n    \"credentialStore\": {\n        \"path\": \"/tmp/keystore\",\n        \"cryptoStore\": {\n            \"path\": \"/tmp/msp\"\n        }\n    },\n    \"connection\": {\n        \"timeout\": {\n            \"peer\": {\n                \"endorser\": \"300\"\n            }\n        }\n    }\n},\n\"channels\": {\n    \"mychannel\": {\n        \"peers\": {\n            \"peer0.org1.example.com\": {}\n        }\n    }\n},\n\"orderers\": {\n    \"orderer.example.com\": {\n        \"url\": \"orderer.example.com:7050\",\n        \"grpcOptions\": {\n            \"ssl-target-name-override\": \"orderer.example.com\",\n            \"keep-alive-time\": \"60s\",\n            \"keep-alive-timeout\": \"60s\",\n            \"keep-alive-permit\": false,\n            \"fail-fast\": false,\n            \"allow-insecure\": false\n        },\n        \"tlsCACerts\": {\n            \"path\": \"crypto-config/ordererOrganizations/example.com/tlsca/tlsca.example.com-cert.pem\"\n        }\n    }\n},\n\"organizations\": {\n    \"Org1\": {\n        \"mspid\": \"Org1MSP\",\n        \"cryptoPath\": \"crypto-config/peerOrganizations/org1.example.com/users/User1@org1.example.com/msp\",\n        \"peers\": [\n            \"peer0.org1.example.com\",\n            \"peer1.org1.example.com\"\n        ],\n        \"certificateAuthorities\": [\n            \"ca.org1.example.com\"\n        ]\n    }\n},\n\"peers\": {\n    \"peer0.org1.example.com\": {\n        \"url\": \"grpcs://localhost:7051\",\n        \"tlsCACerts\": {\n            \"path\": \"crypto-config/peerOrganizations/org1.example.com/tlsca/tlsca.org1.example.com-cert.pem\"\n        },\n        \"grpcOptions\": {\n            \"ssl-target-name-override\": \"peer0.org1.example.com\"\n        }\n    },\n    \"peer1.org1.example.com\": {\n        \"url\": \"grpcs://localhost:8051\",\n        \"tlsCACerts\": {\n            \"path\": \"crypto-config/peerOrganizations/org1.example.com/tlsca/tlsca.org1.example.com-cert.pem\"\n        },\n        \"grpcOptions\": {\n            \"ssl-target-name-override\": \"peer1.org1.example.com\"\n        }\n    }\n},\n\"certificateAuthorities\": {\n    \"ca.org1.example.com\": {\n        \"url\": \"https://localhost:7054\",\n        \"caName\": \"ca-org1\",\n        \"tlsCACerts\": {\n            \"path\": \"crypto-config/peerOrganizations/org1.example.com/tlsca/tlsca.org1.example.com-cert.pem\"\n        },\n        \"httpOptions\": {\n            \"verify\": false\n        }\n    }\n}\n</code></pre>\n\n<p>}</p>\n"}], "owner": {"reputation": 157, "user_id": 9443806, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CG4wm.png?s=128&g=1", "display_name": "Haardik", "link": "https://stackoverflow.com/users/9443806/haardik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 158, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1557977059, "creation_date": 1554000788, "question_id": 55437470, "link": "https://stackoverflow.com/questions/55437470/fabric-sdk-unable-to-initialize-cryptosuite-config", "title": "Fabric SDK unable to initialize cryptosuite config", "body": "<p>I'm running a business network on IBM Cloud Blockchain Platform 2.0. I downloaded a connection profile from the instantiated smart contracts section on the Platform Console, and am trying to connect using the Fabric SDK for Go but I am facing an error.</p>\n\n<p>This is my current relevant code, under main</p>\n\n<pre><code>configOpts := fabricConfig.FromFile(\"./profiles/flex.json\")\nfabSDK, err := fabsdk.New(configOpts)\nif err != nil {\n    entry.WithError(err).Fatal(\"Error setting up Fabric SDK\")\n}\ndefer fabSDK.Close()\n</code></pre>\n\n<p>Expected: Connects to the business network instance</p>\n\n<p>Actual: I get an error</p>\n\n<pre><code>FATA[0000] Error setting up Fabric SDK env=DEV \nerror=\"failed to initialize configuration: unable to initialize cryptosuite using crypto suite config: \nfailed to initialize crypto suite: Unsupported BCCSP Provider: \"\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 3287, "user_id": 2898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/ancqg.jpg?s=128&g=1", "display_name": "Krzysztof Kowalczyk", "link": "https://stackoverflow.com/users/2898/krzysztof-kowalczyk"}, "is_accepted": true, "score": 4, "last_activity_date": 1554001069, "creation_date": 1554001069, "answer_id": 55437489, "question_id": 55437404, "link": "https://stackoverflow.com/questions/55437404/can-i-use-two-for-loops-on-one-function-or-is-there-a-better-way/55437489#55437489", "title": "Can I use two for loops on one function or is there a better way?", "body": "<p>There's no reason for <code>HighPriceItem</code> and <code>LowPriceItem</code> types. </p>\n\n<p>If you make it a single <code>PriceItems</code>, you'll be able to turn the 2 for loops at the end into a function over <code>PriceItems</code> and get rid of the duplicate code inside second for loop.</p>\n\n<p>Also in Go <code>var specials = seasonPrices()</code> is typically written as <code>specials := seasonPrices()</code></p>\n"}], "owner": {"reputation": 87, "user_id": 4762065, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8ccb83f272c64cc41ce6d6f6fcb403e9?s=128&d=identicon&r=PG&f=1", "display_name": "rubixkube", "link": "https://stackoverflow.com/users/4762065/rubixkube"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 55437489, "answer_count": 1, "score": 1, "last_activity_date": 1554024053, "creation_date": 1553999795, "last_edit_date": 1554024053, "question_id": 55437404, "link": "https://stackoverflow.com/questions/55437404/can-i-use-two-for-loops-on-one-function-or-is-there-a-better-way", "title": "Can I use two for loops on one function or is there a better way?", "body": "<p>I am writing out a homework problem which I may have over-engineered with too many structs. It made sense at the time. I want to loop through Seasonal Discounts (through 2 different arrays- HighPrices, and LowPrices ) and just not sure if a) the set up is good or not, b) how to add the price in a less redundant manner.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    fmt.Println(getPrice(2, \"bananas\"))\n}\n\nfunc getPrice(p float32, f string) float32 {\n\n    type HighPriceItems struct {\n        items []string\n        price float32\n    }\n    type LowPriceItems struct {\n        items []string\n        price float32\n    }\n    type seasonMatrix struct {\n        h HighPriceItems\n        l LowPriceItems\n    }\n    var seasonPrices = func() seasonMatrix {\n        var h = HighPriceItems{}\n        var l = LowPriceItems{}\n\n        var season = seasonMatrix{}\n\n        switch time.Now().Month() {\n\n        case time.March, time.April, time.May, time.June, time.July:\n\n            h := append(h.items, \"apples\", \"oranges\", \"pears\")\n            l := append(l.items, \"bananas\", \"grapes\")\n            season.h.items = h\n            season.h.price = 4\n            season.l.items = l\n            season.l.price = 2\n            return season\n        case time.August, time.September, time.October, time.November, time.December, time.January, time.February:\n\n            h := append(h.items, \"bananas\", \"grapes\")\n            l := append(l.items, \"apples\", \"oranges\", \"pears\")\n            season.h.items = h\n            season.h.price = 4\n            season.l.price = 2\n            season.l.items = l\n            return season\n        }\n        return season\n    }\n\n    const normalDiscount float32 = .75\n\n    var x = p * normalDiscount\n    var specials = seasonPrices()\n    var finalPrice float32\n\n    for _, n := range specials.h.items {\n\n        if f == n {\n            if specials.h.price &gt; x {\n                finalPrice = specials.h.price\n\n            } else {\n                finalPrice = x\n            }\n        }\n    }\n    for _, n := range specials.l.items {\n        if f == n {\n            if specials.l.price &gt; x {\n                finalPrice = specials.l.price\n            } else {\n                finalPrice = x\n            }\n        }\n    }\n    return finalPrice\n}\n</code></pre>\n"}, {"tags": ["mysql", "json", "rest", "go"], "answers": [{"tags": [], "owner": {"reputation": 3287, "user_id": 2898, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/ancqg.jpg?s=128&g=1", "display_name": "Krzysztof Kowalczyk", "link": "https://stackoverflow.com/users/2898/krzysztof-kowalczyk"}, "is_accepted": false, "score": 3, "last_activity_date": 1554011758, "last_edit_date": 1554011758, "creation_date": 1554002008, "answer_id": 55437560, "question_id": 55437279, "link": "https://stackoverflow.com/questions/55437279/sql-nullint64-to-json/55437560#55437560", "title": "sql.NullInt64 to JSON", "body": "<p><code>sql.NullInt64</code> exists because SQL's <code>null</code> cannot be represented as Go's <code>int</code>. It's a third state that cannot be represented by any <code>int</code> value.</p>\n\n<p>One solution to that would be to represent such SQL values as <code>*int</code>, but that would require an allocation for cases where the value is not <code>null</code> in the database, and allocations are bad for performance.</p>\n\n<p>Designers of SQL package came up with <code>NullInt64</code> solution that encodes the third state of null as an additional <code>Valid</code> boolean. It's not a good solution but it's the best we can get.</p>\n\n<p>I'm not sure if it's possible to write JSON marshaller for <code>NullInt64</code> that would work as you expect.</p>\n\n<p>There's still the \"third state\" problem when marshalling to JSON. With <code>,omitempty</code> a <code>0</code> int would also be omitted so how can you tell 0 from \"not exists\"/null?</p>\n\n<p>Either way they didn't write custom marshaller for <code>NullInt64</code> so it just encodes as the struct that it is.</p>\n\n<p>You can create an alias type for <code>NullInt64</code>, write a JSON marshaller to encode the way you want to JSON (you need an alias because you can't add methods to types from other packages). You would also need to cast between your <code>NullInt64</code> and <code>sql.NullInt64</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1554083054, "post_id": 55438964, "comment_id": 97608998, "body": "Why can&#39;t you just work with <code>sql.NullInt64</code> and avoid defining your own <code>NullInt64</code>? is it because it&#39;s the only way to do a custom JSON marshaller?"}, {"owner": {"reputation": 916, "user_id": 8047506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KS6Eg.jpg?s=128&g=1", "display_name": "Evgeny A. Mamonov", "link": "https://stackoverflow.com/users/8047506/evgeny-a-mamonov"}, "reply_to_user": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1554099792, "post_id": 55438964, "comment_id": 97612604, "body": "yes, json.Marshaler, fmt.Stringer, also I need a NullTime, so I decided to write all I need in one place :)"}], "tags": [], "owner": {"reputation": 916, "user_id": 8047506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KS6Eg.jpg?s=128&g=1", "display_name": "Evgeny A. Mamonov", "link": "https://stackoverflow.com/users/8047506/evgeny-a-mamonov"}, "is_accepted": false, "score": 0, "last_activity_date": 1554020040, "last_edit_date": 1554020040, "creation_date": 1554019671, "answer_id": 55438964, "question_id": 55437279, "link": "https://stackoverflow.com/questions/55437279/sql-nullint64-to-json/55438964#55438964", "title": "sql.NullInt64 to JSON", "body": "<p>You can use custom type for null int64.\nThis type works as you expected.</p>\n\n<p>Usage example:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"database/sql/driver\" \n    \"fmt\"\n    \"strconv\"\n)\n\ntype user struct {\n    ID   int             `db:\"id\"`\n    Name string          `db:\"name\"`\n    // pointer needed to omitempty work, otherwise output will be \"age\": null\n    Age  *NullInt64 `db:\"age\" json:\"age,omitempty\"`\n}\n\nfunc main() {\n    u := user{ID: 1, Name: \"John\"}\n    j, _ := json.Marshal(u)\n    fmt.Printf(\"%s\\n\", j)\n}\n\n//    Output:\n//        {\"ID\":1,\"Name\":\"John\"}\n\ntype NullInt64 struct {\n    Val     int64\n    IsValid bool\n}\n\nfunc NewNullInt64(val interface{}) NullInt64 {\n    ni := NullInt64{}\n    ni.Set(val)\n    return ni\n}\n\nfunc (ni *NullInt64) Scan(value interface{}) error {\n    ni.Val, ni.IsValid = value.(int64)\n    return nil\n}\n\nfunc (ni NullInt64) Value() (driver.Value, error) {\n    if !ni.IsValid {\n        return nil, nil\n    }\n    return ni.Val, nil\n}\n\nfunc (ni *NullInt64) Set(val interface{}) {\n    ni.Val, ni.IsValid = val.(int64)\n}\n\nfunc (ni NullInt64) MarshalJSON() ([]byte, error) {\n    if !ni.IsValid {\n        return []byte(`null`), nil\n    }\n\n    return []byte(strconv.FormatInt(ni.Val, 10)), nil\n}\n\nfunc (ni *NullInt64) UnmarshalJSON(data []byte) error {\n    if data == nil || string(data) == `null` {\n        ni.IsValid = false\n        return nil\n    }\n\n    val, err := strconv.ParseInt(string(data), 10, 64)\n    if err != nil {\n        ni.IsValid = false\n        return err\n    }\n\n    ni.Val = val\n    ni.IsValid = true\n\n    return nil\n}\n\nfunc (ni NullInt64) String() string {\n    if !ni.IsValid {\n        return `&lt;nil&gt;`\n    }\n\n    return strconv.FormatInt(ni.Val, 10)\n}\n</code></pre>\n"}], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1060, "favorite_count": 2, "answer_count": 2, "score": 0, "last_activity_date": 1554020040, "creation_date": 1553997999, "question_id": 55437279, "link": "https://stackoverflow.com/questions/55437279/sql-nullint64-to-json", "title": "sql.NullInt64 to JSON", "body": "<p>I have a database schema where Age is <strong>optional</strong>. But when in Go, via my RestFUL interface, I output the data as JSON, I get a very ugly response like <code>{\"ID\":1,\"Name\":\"John\",\"age\":{\"Int64\":0,\"Valid\":false}}\n</code> for age. I expected a null value to be omitted. What am I missing?</p>\n\n<pre><code>// CREATE TABLE users (\n//        id INT AUTO_INCREMENT PRIMARY KEY,\n//        name VARCHAR(50) NOT NULL,\n//        age INT\n// );\n\n// Age is optional\n\ntype user struct {\n    ID   int           `db:\"id\"`\n    Name string        `db:\"name\"`\n    Age  sql.NullInt64 `db:\"age\" json:\"age,omitempty\"`\n}\n\nfunc main() {\n    u := user{ID: 1, Name: \"John\"}\n    j, _ := json.Marshal(u)\n    fmt.Printf(\"%s\", j)\n}\n\n// Expected: {\"ID\":1,\"Name\":\"John\"} since age is NULL/empty\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/PS1-4Gw9h5u\" rel=\"nofollow noreferrer\">https://play.golang.org/p/PS1-4Gw9h5u</a></p>\n"}, {"tags": ["json", "go", "mariadb", "go-gorm"], "comments": [{"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1557374471, "post_id": 55437119, "comment_id": 98744929, "body": "What if you say <code>nil</code> instead of <code>null</code> in <code>[KR 0xc0001f6130 null null]</code>?"}], "owner": {"reputation": 53, "user_id": 2056891, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdec2063e7823e32460179b44c38d2ee?s=128&d=identicon&r=PG", "display_name": "jspetrak", "link": "https://stackoverflow.com/users/2056891/jspetrak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1340, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1554230004, "creation_date": 1553995866, "last_edit_date": 1554230004, "question_id": 55437119, "link": "https://stackoverflow.com/questions/55437119/insert-null-for-time-time-decoded-from-json", "title": "Insert NULL for time.Time decoded from JSON", "body": "<p>I am prototyping a REST endpoints over an existing production DB and got stuck with nullable datetime column. I have already read threads like <a href=\"https://stackoverflow.com/questions/24564619/nullable-time-time-in-golang\">Nullable time.Time in golang</a> or <a href=\"https://stackoverflow.com/questions/48899014/fetching-null-datetime-value-in-mysql-using-gorm\">Fetching NULL datetime value in MySQL using GORM</a> but can't POST a new object to REST endpoint and store unlisted datetime-typed attribute from JSON as NULL into MariaDB.</p>\n\n<p>I am submitting a HTTP request like</p>\n\n<pre><code>POST /countries\n{ \"iso_code\" : \"CZ\", \"title\" : \"Czechia\" }\n</code></pre>\n\n<p>The table has following schema</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>create table country\n(\n    iso_code   char(2)                              not null comment 'Country alpha-2 ISO code'\n        primary key,\n    title      varchar(255)                         null comment 'Country name',\n    created_on datetime default current_timestamp() not null,\n    updated_on datetime                             null on update current_timestamp()\n)\n</code></pre>\n\n<p>I have already tried mysql.NullTime type, time.Time type as pointer, specifying sql:DEFAULT:NULL in mapping, gorm:\"null\" mapping, I have also directly assigned nil into newCountry.UpdatedAt right before saving it. BeforeSave gorm hook also did not make difference.</p>\n\n<p>The mode is quite explicite</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    type Country struct {\n        IsoCode string `json:\"iso_code\" gorm:\"primary_key\" sql:\"size:2\"`\n        Title *string `json:\"title,omitempty\" gorm:\"null\" sql:\"size:255\"`\n        CreatedAt *time.Time `json:\"created_at,omitempty\" gorm:\"column:created_on\"`\n       UpdatedAt *time.Time `json:\"updated_at,omitempty\" gorm:\"column:updated_on;null\" sql:\"DEFAULT:NULL\"`\n    }\n</code></pre>\n\n<p>I am using GORM to store the object</p>\n\n<pre><code>func CreateCountry(country *m.Country) *m.Country {\n    fmt.Println(country)\n\n    existingCountry := GetCountry(country.IsoCode)\n    if existingCountry == nil {\n        err := GetDB().Create(country).Error\n        // ...\n    } \n    // ...\n}\n</code></pre>\n\n<p>Here in method the country does not have value for <code>UpdatedAt</code> but <code>Create(country)</code> is called, it stores exact value to both datetime columns.</p>\n\n<p>I am reading that from HTTP request body like this</p>\n\n<pre><code>var CreateCountry = func(w http.ResponseWriter, r *http.Request) {\n    fmt.Println(r.Body)\n\n    newCountry := &amp;m.Country{}\n    err := json.NewDecoder(r.Body).Decode(newCountry)\n    // ...\n}\n</code></pre>\n\n<p>Also here the body have nil in datetime attributes.</p>\n\n<p>Not sure what else can be done to produce insert statement like</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>INSERT  INTO `country` (`iso_code`,\n`title`,`created_on`,`updated_on`) VALUES (?,?,?,?)[KR 0xc0001f6130 null null] \n</code></pre>\n\n<p>and not</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>INSERT  INTO `country` (`iso_code`,\n`title`,`created_on`,`updated_on`) VALUES (?,?,?,?)[KR 0xc0001f6130 2019-03-31 03:16:41.5158848 +0200 CEST m=+16.4487208\n01 2019-03-31 03:16:41.5158848 +0200 CEST m=+16.448720801]\n</code></pre>\n"}, {"tags": ["http", "go"], "answers": [{"tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": false, "score": 2, "last_activity_date": 1553991929, "creation_date": 1553991929, "answer_id": 55436827, "question_id": 55436721, "link": "https://stackoverflow.com/questions/55436721/what-is-client-request/55436827#55436827", "title": "What is client request?", "body": "<p>From <a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"nofollow noreferrer\">the Request type documentation</a></p>\n\n<blockquote>\n  <p><em>A Request represents an HTTP request received by a server or to be sent by a client.</em></p>\n</blockquote>\n\n<p>And right above your comment...</p>\n\n<blockquote>\n<pre><code>// URL specifies either the URI being requested (for server\n// requests) or the URL to access (for client requests).\n</code></pre>\n</blockquote>\n\n<p>A web browser make a client request. A web server receives a server request.</p>\n"}], "owner": {"reputation": 11490, "user_id": 3317808, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6c8272382fcd9841919bc1f8709d25a0?s=128&d=identicon&r=PG&f=1", "display_name": "overexchange", "link": "https://stackoverflow.com/users/3317808/overexchange"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1553991929, "creation_date": 1553990524, "question_id": 55436721, "link": "https://stackoverflow.com/questions/55436721/what-is-client-request", "title": "What is client request?", "body": "<p>In the below code(<code>../src/net/http/request.go</code>):</p>\n\n<pre><code>// For server requests, the URL is parsed from the URI\n    // supplied on the Request-Line as stored in RequestURI.  For\n    // most requests, fields other than Path and RawQuery will be\n    // empty. (See RFC 7230, Section 5.3)\n    //\n    // For client requests, the URL's Host specifies the server to\n    // connect to, while the Request's Host field optionally\n    // specifies the Host header value to send in the HTTP\n    // request.\n    URL *url.URL\n</code></pre>\n\n<hr>\n\n<p>URL <code>protocol://hostname:port/resource_path</code> is used as part of GET/POST/.. request to server but not client</p>\n\n<hr>\n\n<p>What does client request mean, in the above comments?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "edited": false, "score": 0, "creation_date": 1553989425, "post_id": 55436628, "comment_id": 97590618, "body": "Maybe it is a uint, or int8, or another int type"}, {"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "reply_to_user": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "edited": false, "score": 0, "creation_date": 1553989551, "post_id": 55436628, "comment_id": 97590641, "body": "@SeanF I doubt that&#39;s the case. I just tried <code>c.JSON(200, gin.H{&quot;message&quot;: &quot;Login Success.&quot;, &quot;userid&quot;: int(1)})</code> and its still failing."}, {"owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "edited": false, "score": 0, "creation_date": 1553989663, "post_id": 55436628, "comment_id": 97590662, "body": "Why would that change anything?"}, {"owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "edited": false, "score": 0, "creation_date": 1553989755, "post_id": 55436628, "comment_id": 97590683, "body": "Why don&#39;t you just get the type and tell me what the type is because it is not int, that is for sure <a href=\"https://stackoverflow.com/questions/20170275/how-to-find-a-type-of-an-object-in-go\" title=\"how to find a type of an object in go\">stackoverflow.com/questions/20170275/&hellip;</a>"}, {"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "reply_to_user": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "edited": false, "score": 0, "creation_date": 1553990038, "post_id": 55436628, "comment_id": 97590732, "body": "Ok I just saw it. Its <code>float64</code> but why is it treating it as float?"}, {"owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "edited": false, "score": 0, "creation_date": 1553990162, "post_id": 55436628, "comment_id": 97590750, "body": "Call the programmer on the phone and ask him why he chose float64 instead of int"}, {"owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "edited": false, "score": 0, "creation_date": 1553990245, "post_id": 55436628, "comment_id": 97590761, "body": "Most likely he sends all numbers across as float64 because it was easy to do it that way"}, {"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "reply_to_user": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "edited": false, "score": 0, "creation_date": 1553990421, "post_id": 55436628, "comment_id": 97590787, "body": "You mean the <code>gin.H</code> ints are getting packed as floats?"}, {"owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "edited": false, "score": 0, "creation_date": 1553990700, "post_id": 55436628, "comment_id": 97590826, "body": "Maybe, who knows what gin.H does. It is the most likely scenario. Far more likely than your assertion that golang type assertion does not work with int. Also more likely than the possibility that the json encode or decode converts int to float."}, {"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "reply_to_user": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "edited": false, "score": 0, "creation_date": 1553990957, "post_id": 55436628, "comment_id": 97590852, "body": "I&#39;m pretty sure it just uses the <code>json.Marshall</code> function to encode whatever is in <code>gin.H</code> and <code>gin.H</code> is just a <code>map[string]interface{}</code> there has got to be another reason."}, {"owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "edited": false, "score": 0, "creation_date": 1553991528, "post_id": 55436628, "comment_id": 97590922, "body": "You make far too many assumptions. Nik just proved this latest one wrong."}], "answers": [{"comments": [{"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "edited": false, "score": 1, "creation_date": 1553991049, "post_id": 55436758, "comment_id": 97590863, "body": "Great! It makes sense now."}], "tags": [], "owner": {"reputation": 1914, "user_id": 9811969, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/184e2e46b8d8b8c483c85589709b8563?s=128&d=identicon&r=PG&f=1", "display_name": "Nik", "link": "https://stackoverflow.com/users/9811969/nik"}, "is_accepted": true, "score": 12, "last_activity_date": 1553990965, "creation_date": 1553990965, "answer_id": 55436758, "question_id": 55436628, "link": "https://stackoverflow.com/questions/55436628/json-decoded-value-is-treated-as-float64-instead-of-int/55436758#55436758", "title": "JSON decoded value is treated as float64 instead of int", "body": "<p>Here you can find the explanation why you are getting <code>float64</code> and not <code>int</code>:</p>\n\n<p>Check doc for <a href=\"https://golang.org/pkg/encoding/json/#Decoder.Decode\" rel=\"noreferrer\">Decode</a></p>\n\n<blockquote>\n  <p>See the documentation for Unmarshal for details about the conversion of JSON into a Go value.</p>\n</blockquote>\n\n<p>And there <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"noreferrer\">see</a></p>\n\n<blockquote>\n  <p>To unmarshal JSON into an interface value, Unmarshal stores one of these in the interface value:</p>\n</blockquote>\n\n<pre><code>float64, for JSON numbers\n</code></pre>\n"}], "owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2644, "favorite_count": 1, "accepted_answer_id": 55436758, "answer_count": 1, "score": 10, "last_activity_date": 1553991179, "creation_date": 1553989241, "last_edit_date": 1553991179, "question_id": 55436628, "link": "https://stackoverflow.com/questions/55436628/json-decoded-value-is-treated-as-float64-instead-of-int", "title": "JSON decoded value is treated as float64 instead of int", "body": "<p>I have a json response from a api as <code>map[message:Login Success. userid:1]</code></p>\n\n<p>Server:</p>\n\n<pre><code>c.JSON(200, gin.H{\"message\": \"Login Success.\", \"userid\": 1})\n</code></pre>\n\n<p>Client:</p>\n\n<pre><code>var result map[string]interface{}\njson.NewDecoder(resp.Body).Decode(&amp;result)\n\nmsg, ok := result[\"message\"].(string)\nif !ok {\n    msg = \"Something went wrong.\"\n}\nuserID, ok := result[\"userid\"].(int)\nif !ok {\n    userID = 0\n}\n</code></pre>\n\n<p>But <code>userID, ok := result[\"userid\"].(int)</code> always fails. I've even tried using:</p>\n\n<pre><code>switch v := x.(type) {\ncase nil:\n    fmt.Println(\"x is nil\")          \ncase int: \n    fmt.Println(\"x is\", v)           \ncase bool, string:\n    fmt.Println(\"x is bool or string\")\ndefault:\n    fmt.Println(\"type unknown\")      \n}\n</code></pre>\n\n<p>And it just gave me <strong>unknown</strong>. Why is the integer not being taken as integer?</p>\n\n<hr>\n\n<p>It looks like its treating the value as <code>float64</code>.</p>\n"}, {"tags": ["arrays", "templates", "go", "methods", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 1914, "user_id": 9811969, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/184e2e46b8d8b8c483c85589709b8563?s=128&d=identicon&r=PG&f=1", "display_name": "Nik", "link": "https://stackoverflow.com/users/9811969/nik"}, "is_accepted": true, "score": 0, "last_activity_date": 1553997829, "creation_date": 1553997829, "answer_id": 55437258, "question_id": 55436620, "link": "https://stackoverflow.com/questions/55436620/call-method-of-an-array-from-golang-template/55437258#55437258", "title": "Call method of an array from golang template", "body": "<p>Your <code>Test</code>struct has no exported fields/methods, i.e. fields/methods within the struct that are used within the template have to start with a capital letter.</p>\n\n<p>Update the method name to <code>CallMethod</code></p>\n\n<pre><code>func (t Test) CallMethod() float32 {\n    return t.val1 / t.val2\n}\n</code></pre>\n\n<p>and the template:</p>\n\n<pre><code>const tmpl = `\n{{range .}}\n   {{.CallMethod}}\n{{end}}\n`\n</code></pre>\n\n<p>see the code <a href=\"https://play.golang.org/p/Vud7ipJ_Vyr\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Vud7ipJ_Vyr</a></p>\n"}], "owner": {"reputation": 33, "user_id": 9323559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f74b1a1713f9ce6c772329462c5552fc?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel Bachmann", "link": "https://stackoverflow.com/users/9323559/daniel-bachmann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 55437258, "answer_count": 1, "score": 1, "last_activity_date": 1554011269, "creation_date": 1553989129, "last_edit_date": 1554011269, "question_id": 55436620, "link": "https://stackoverflow.com/questions/55436620/call-method-of-an-array-from-golang-template", "title": "Call method of an array from golang template", "body": "<p>So in my <code>main.go</code> I have a struct and a method that I can call from inside <code>main.go</code> without a problem. Imagine it being like this: </p>\n\n<pre><code>type Test struct {\n    val1 float32\n    val2 float32\n}\n\nfunc (t Test) callMethod() float32 {\n    return t.val1 / t.val2\n}\n</code></pre>\n\n<p>I am calling the template like this and as data I am giving an array of the <code>Test</code> structs, like this:</p>\n\n<pre><code>var testvar1 Test\nvar testvar2 Test\nvar teststructs [] Test\nteststructs = append(teststructs, testvar1)\nteststructs = append(teststructs, testvar2)\ntpl.ExecuteTemplate(w, \"testpage.gohtml\", teststructs)\n</code></pre>\n\n<p>Inside the template I am trying to call the <code>callMethod</code> like this</p>\n\n<pre><code>{{range .}}\n    {{ .callMethod }}\n{{end}}\n</code></pre>\n\n<p>But I am getting the following error: </p>\n\n<blockquote>\n  <p>executing \"testpage.gohtml\" at &lt;.callMethod>: can't evaluate field callMethod in type main.Test</p>\n</blockquote>\n\n<p>Has anyone an Idea what I am doing wrong and has a solution for this? I am trying to fix it since many hours and I am so frustrated at this point.</p>\n"}, {"tags": ["session", "go", "gorilla", "go-echo"], "answers": [{"tags": [], "owner": {"reputation": 4217, "user_id": 9614249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eJfci.png?s=128&g=1", "display_name": "Increasingly Idiotic", "link": "https://stackoverflow.com/users/9614249/increasingly-idiotic"}, "is_accepted": true, "score": 0, "last_activity_date": 1553997491, "creation_date": 1553997491, "answer_id": 55437239, "question_id": 55435990, "link": "https://stackoverflow.com/questions/55435990/echo-sessions-middleware-not-saving/55437239#55437239", "title": "Echo sessions middleware not saving", "body": "<p>The issue is caused by settings <code>session.Option.Secure = true</code>.</p>\n\n<p>I am testing locally and not using <code>HTTPS</code> so the cookie is not being set.</p>\n"}], "owner": {"reputation": 4217, "user_id": 9614249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eJfci.png?s=128&g=1", "display_name": "Increasingly Idiotic", "link": "https://stackoverflow.com/users/9614249/increasingly-idiotic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 707, "favorite_count": 0, "accepted_answer_id": 55437239, "answer_count": 1, "score": 1, "last_activity_date": 1553997491, "creation_date": 1553982979, "question_id": 55435990, "link": "https://stackoverflow.com/questions/55435990/echo-sessions-middleware-not-saving", "title": "Echo sessions middleware not saving", "body": "<p>I am trying to use the <a href=\"https://echo.labstack.com/middleware/session\" rel=\"nofollow noreferrer\">sessions middleware</a> for the <a href=\"https://echo.labstack.com/\" rel=\"nofollow noreferrer\">echo web framework</a>. The middleware is essentially just a wrapper around <a href=\"http://www.gorillatoolkit.org/pkg/sessions\" rel=\"nofollow noreferrer\">gorilla/sessions</a> tailored to work with echo.</p>\n\n<p>I have basically just copied the example given in the documentation and extended it slightly. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\ne := echo.New()\ne.Use(session.Middleware(sessions.NewCookieStore([]byte(\"Secret\"))))\n\n// Add the name \"Steve\" to the session\ne.GET(\"/login\", func(c echo.Context) error {\n        sess, err := session.Get(\"session\", c)\n        if err != nil {\n            return err\n        }\n        sess.Options = &amp;sessions.Options{\n            Path:     \"/\",\n            MaxAge:   0,\n            HttpOnly: false,\n            Secure:   true,\n        }\n        sess.Values[\"name\"] = \"Steve\"\n        sess.Save(c.Request(), c.Response())\n        return c.NoContent(http.StatusOK)\n    })\n\n    // Reply with the name saved in the session\n    e.GET(\"/whoami\", func(c echo.Context) error {\n        sess, err := session.Get(\"session\", c)\n        if err != nil {\n            return err\n        }\n\n        return c.JSON(http.StatusOK, sess.Values[\"name\"])\n    })\n</code></pre>\n\n<p>I expect to first visit <code>/login</code> to save the name to the session, and then visit <code>/whoami</code> and receive the name <code>\"Steve\"</code>.</p>\n\n<p><code>/login</code> returns <code>StatusOK</code> as expected, but <code>/whoami</code> always returns <code>null</code>. Why isn't the name being saved to the session?</p>\n"}, {"tags": ["firebase", "go", "kubernetes", "google-cloud-firestore", "firebase-admin"], "comments": [{"owner": {"reputation": 151, "user_id": 1933648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3768b5c1641a6efe8942efa038a9b48b?s=128&d=identicon&r=PG", "display_name": "Aman Juneja", "link": "https://stackoverflow.com/users/1933648/aman-juneja"}, "edited": false, "score": 0, "creation_date": 1554007471, "post_id": 55435462, "comment_id": 97592931, "body": "can you try mapping your app port 8080 to some other port... as I doubt that kubernetes api-server uses that port and because of that the request might be going to apiserver which might be validating the certs."}, {"owner": {"reputation": 289, "user_id": 3553597, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/o4F20.jpg?s=128&g=1", "display_name": "Diericx", "link": "https://stackoverflow.com/users/3553597/diericx"}, "reply_to_user": {"reputation": 151, "user_id": 1933648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3768b5c1641a6efe8942efa038a9b48b?s=128&d=identicon&r=PG", "display_name": "Aman Juneja", "link": "https://stackoverflow.com/users/1933648/aman-juneja"}, "edited": false, "score": 0, "creation_date": 1554045927, "post_id": 55435462, "comment_id": 97600621, "body": "@AmanJuneja just tried that and got the same error"}, {"owner": {"reputation": 151, "user_id": 1933648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3768b5c1641a6efe8942efa038a9b48b?s=128&d=identicon&r=PG", "display_name": "Aman Juneja", "link": "https://stackoverflow.com/users/1933648/aman-juneja"}, "edited": false, "score": 0, "creation_date": 1554048304, "post_id": 55435462, "comment_id": 97601258, "body": "Can you tell me what changes you made.. just curious as it seems more to me that request is going to apiserver"}, {"owner": {"reputation": 289, "user_id": 3553597, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/o4F20.jpg?s=128&g=1", "display_name": "Diericx", "link": "https://stackoverflow.com/users/3553597/diericx"}, "reply_to_user": {"reputation": 151, "user_id": 1933648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3768b5c1641a6efe8942efa038a9b48b?s=128&d=identicon&r=PG", "display_name": "Aman Juneja", "link": "https://stackoverflow.com/users/1933648/aman-juneja"}, "edited": false, "score": 0, "creation_date": 1554049812, "post_id": 55435462, "comment_id": 97601609, "body": "Sure! I just updated the post so it&#39;s easier to read. I just double checked that the port didn&#39;t some how get hard coded at some point. From what I can tell looking at the code it should be running on 9089."}, {"owner": {"reputation": 151, "user_id": 1933648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3768b5c1641a6efe8942efa038a9b48b?s=128&d=identicon&r=PG", "display_name": "Aman Juneja", "link": "https://stackoverflow.com/users/1933648/aman-juneja"}, "edited": false, "score": 0, "creation_date": 1554050751, "post_id": 55435462, "comment_id": 97601866, "body": "just add 9089 also to the expose line and then give it a try"}, {"owner": {"reputation": 289, "user_id": 3553597, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/o4F20.jpg?s=128&g=1", "display_name": "Diericx", "link": "https://stackoverflow.com/users/3553597/diericx"}, "reply_to_user": {"reputation": 151, "user_id": 1933648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3768b5c1641a6efe8942efa038a9b48b?s=128&d=identicon&r=PG", "display_name": "Aman Juneja", "link": "https://stackoverflow.com/users/1933648/aman-juneja"}, "edited": false, "score": 0, "creation_date": 1554073070, "post_id": 55435462, "comment_id": 97607368, "body": "No same error, I&#39;m connecting on 9090 to the grpc server"}, {"owner": {"reputation": 151, "user_id": 1933648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3768b5c1641a6efe8942efa038a9b48b?s=128&d=identicon&r=PG", "display_name": "Aman Juneja", "link": "https://stackoverflow.com/users/1933648/aman-juneja"}, "edited": false, "score": 0, "creation_date": 1554109745, "post_id": 55435462, "comment_id": 97617115, "body": "can you share your pod manifest file?"}, {"owner": {"reputation": 289, "user_id": 3553597, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/o4F20.jpg?s=128&g=1", "display_name": "Diericx", "link": "https://stackoverflow.com/users/3553597/diericx"}, "reply_to_user": {"reputation": 151, "user_id": 1933648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3768b5c1641a6efe8942efa038a9b48b?s=128&d=identicon&r=PG", "display_name": "Aman Juneja", "link": "https://stackoverflow.com/users/1933648/aman-juneja"}, "edited": false, "score": 0, "creation_date": 1554128631, "post_id": 55435462, "comment_id": 97627728, "body": "<a href=\"https://gist.github.com/diericx/2a4c5198be44bd8d1ade57de51231154\" rel=\"nofollow noreferrer\">gist.github.com/diericx/2a4c5198be44bd8d1ade57de51231154</a>"}, {"owner": {"reputation": 151, "user_id": 1933648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3768b5c1641a6efe8942efa038a9b48b?s=128&d=identicon&r=PG", "display_name": "Aman Juneja", "link": "https://stackoverflow.com/users/1933648/aman-juneja"}, "edited": false, "score": 0, "creation_date": 1554129666, "post_id": 55435462, "comment_id": 97628355, "body": "first thing can you add port 9090 as target port in the service spec. Then as you are using the Loadbalancer service then on minikube there will be no external IP so you will have to reach your app using the node ip and nodeport opened up by the service."}, {"owner": {"reputation": 289, "user_id": 3553597, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/o4F20.jpg?s=128&g=1", "display_name": "Diericx", "link": "https://stackoverflow.com/users/3553597/diericx"}, "reply_to_user": {"reputation": 151, "user_id": 1933648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3768b5c1641a6efe8942efa038a9b48b?s=128&d=identicon&r=PG", "display_name": "Aman Juneja", "link": "https://stackoverflow.com/users/1933648/aman-juneja"}, "edited": false, "score": 0, "creation_date": 1554136395, "post_id": 55435462, "comment_id": 97632161, "body": "Okay it looks like <a href=\"https://gist.github.com/diericx/09228d6d6214b44f03e898adcf45d62c\" rel=\"nofollow noreferrer\">this now</a> and I connect by getting the minikube ip and the port for the service (in this case it was 31552) but I&#39;m still getting the error :( I can connect it&#39;s just Firebase having issues."}], "answers": [{"comments": [{"owner": {"reputation": 289, "user_id": 3553597, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/o4F20.jpg?s=128&g=1", "display_name": "Diericx", "link": "https://stackoverflow.com/users/3553597/diericx"}, "edited": false, "score": 0, "creation_date": 1554218989, "post_id": 55467753, "comment_id": 97667115, "body": "My image is actually empty and running a single binary, you can see it in the post. Do I need an alpine based image to add certs?"}, {"owner": {"reputation": 289, "user_id": 3553597, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/o4F20.jpg?s=128&g=1", "display_name": "Diericx", "link": "https://stackoverflow.com/users/3553597/diericx"}, "edited": false, "score": 1, "creation_date": 1554219494, "post_id": 55467753, "comment_id": 97667404, "body": "Ahh nevermind! With a swift search I found <a href=\"https://medium.com/on-docker/use-multi-stage-builds-to-inject-ca-certs-ad1e8f01de1b\" rel=\"nofollow noreferrer\">an example of a multi-stage build that injects CA certs</a>. This is my <a href=\"https://gist.github.com/diericx/b833e703f0514c0b1d9402452a1d0769\" rel=\"nofollow noreferrer\">updated dockerfile</a>."}, {"owner": {"reputation": 289, "user_id": 3553597, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/o4F20.jpg?s=128&g=1", "display_name": "Diericx", "link": "https://stackoverflow.com/users/3553597/diericx"}, "edited": false, "score": 0, "creation_date": 1554229130, "post_id": 55467753, "comment_id": 97672315, "body": "Just got back from class and tested it, works perfectly! Thank you so much, just wanted to make sure it also worked in my production env (GKE)"}], "tags": [], "owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "is_accepted": true, "score": 13, "last_activity_date": 1554184146, "creation_date": 1554184146, "answer_id": 55467753, "question_id": 55435462, "link": "https://stackoverflow.com/questions/55435462/firebase-admin-go-sdk-getting-x509-certificate-error-only-when-running-inside-ku/55467753#55467753", "title": "Firebase Admin Go SDK getting x509 certificate error ONLY when running inside Kubernetes", "body": "<p>If you are using alpine based images try running <code>apk add ca-certificates</code> it looks like a tls error.<br>\nInstall ca certificates, it should resolve the issue</p>\n"}], "owner": {"reputation": 289, "user_id": 3553597, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/o4F20.jpg?s=128&g=1", "display_name": "Diericx", "link": "https://stackoverflow.com/users/3553597/diericx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 695, "favorite_count": 4, "accepted_answer_id": 55467753, "answer_count": 1, "score": 8, "last_activity_date": 1554184146, "creation_date": 1553978291, "last_edit_date": 1554049793, "question_id": 55435462, "link": "https://stackoverflow.com/questions/55435462/firebase-admin-go-sdk-getting-x509-certificate-error-only-when-running-inside-ku", "title": "Firebase Admin Go SDK getting x509 certificate error ONLY when running inside Kubernetes", "body": "<p>I'm currently working on a project using the Firebase Admin Go SDK to handle auth and to use the real time database. The project works correctly when I run it locally (by just running <code>go run main.go</code>). When I run it in Minikube via a docker image (or GKE, I've tested both) I get this error whenever I try to make any Firestore calls:  </p>\n\n<pre><code>transport: authentication handshake failed: x509: certificate signed by unknown authority\n</code></pre>\n\n<p>Here is the code I'm using on the server to make the call to the DB:  </p>\n\n<pre class=\"lang-go prettyprint-override\"><code>// Initialize the app \nopt := option.WithCredentialsFile(\"./serviceAccountKey.json\")\napp, err := firebase.NewApp(context.Background(), nil, opt)\n// This is the first call I attempt to make, and where the error is thrown\n// Create the client\nclient, err := app.Firestore(context.Background())\niter := client.Collection(\"remoteModels\").Documents(context.Background())\nsnaps, err := iter.GetAll()\nif err != nil {\n    logger.Log.Warn(\"Error getting all remoteModels\")\n    fmt.Println(err)\n    return err\n}  \n</code></pre>\n\n<p>And here is my Dockerfile that adds the service account key Firebase provided me from the console:  </p>\n\n<pre><code>FROM scratch\n\nADD main /\nADD serviceAccountKey.json /\n\nEXPOSE 9090\n\nENTRYPOINT [\"/main\", \"-grpc-port=9090\", \"-http-port=9089\", \"-env=prod\"]\n</code></pre>\n\n<p>I can't find anything in the documentation about running in Kubernetes.<br>\nIs there anything I need to do to be able to connect to Firestore from Kubernetes?</p>\n"}, {"tags": ["go", "tcp"], "comments": [{"owner": {"reputation": 8750, "user_id": 1771556, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XPkeq.jpg?s=128&g=1", "display_name": "Vadim Ashikhman", "link": "https://stackoverflow.com/users/1771556/vadim-ashikhman"}, "edited": false, "score": 1, "creation_date": 1553997207, "post_id": 55435385, "comment_id": 97591648, "body": "If error occurs you can call traceroute utility to get hops information (like this one <a href=\"https://github.com/aeden/tracerout\" rel=\"nofollow noreferrer\">github.com/aeden/tracerout</a>)"}], "owner": {"reputation": 29, "user_id": 3819949, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2a42aac303415c03e37bec3778d7ad7?s=128&d=identicon&r=PG&f=1", "display_name": "user3819949", "link": "https://stackoverflow.com/users/3819949/user3819949"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1554024098, "creation_date": 1553977549, "last_edit_date": 1554024098, "question_id": 55435385, "link": "https://stackoverflow.com/questions/55435385/is-it-possible-to-get-the-address-of-the-last-hop-of-an-unsuccessful-tcp-net-dia", "title": "Is it possible to get the address of the last hop of an unsuccessful tcp net.Dial?", "body": "<p>My goal would be to decide whether an unsuccessful TCP connection made with net.Dial (it does not have to be net.Dial) failed due to a firewall/connectivity issue or just failure in the listener.</p>\n\n<p>So essentially I would like to see something similar what I would with tcptraceroute.</p>\n\n<ol>\n<li>timeout (what was the last ip)</li>\n<li>open/closed port on dst</li>\n</ol>\n\n<p>Also it would be nice to figure out which network interface (local address) was used for an unsuccessful connection</p>\n\n<pre><code>conn, err := net.Dial(\"tcp\", hostName + \":\" + portNum)\n\nif err != nil {\n// is it possible to have socket values here\n// maybe the last succesful hop before the connection failed?\n}\n\n// on succesfull conn it is straightforward\nconn.LocalAddr()\nconn.RemoteAddr()\n\n</code></pre>\n"}, {"tags": ["go", "filepath"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1553974021, "post_id": 55434686, "comment_id": 97587284, "body": "<code>ReadString</code> returns a string including the delimiter, so <code>filePath</code> has a newline at the end."}, {"owner": {"reputation": 440, "user_id": 5308771, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VowhL.jpg?s=128&g=1", "display_name": "Ashutosh Rai", "link": "https://stackoverflow.com/users/5308771/ashutosh-rai"}, "edited": false, "score": 0, "creation_date": 1553974527, "post_id": 55434686, "comment_id": 97587380, "body": "i think this answer could help you <a href=\"https://stackoverflow.com/questions/47261719/how-can-i-resolve-a-relative-path-to-absolute-path-in-golang\" title=\"how can i resolve a relative path to absolute path in golang\">stackoverflow.com/questions/47261719/&hellip;</a> , or you if you can print the path and share here so could find if something wrong with path"}, {"owner": {"reputation": 1, "user_id": 11282550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7438439ac525768cbedd7d9fcd14f248?s=128&d=identicon&r=PG&f=1", "display_name": "007noon700", "link": "https://stackoverflow.com/users/11282550/007noon700"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1553975293, "post_id": 55434686, "comment_id": 97587558, "body": "Aha @AndySchweig that was what was causing it thank you!"}], "owner": {"reputation": 1, "user_id": 11282550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7438439ac525768cbedd7d9fcd14f248?s=128&d=identicon&r=PG&f=1", "display_name": "007noon700", "link": "https://stackoverflow.com/users/11282550/007noon700"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 30, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1553971904, "creation_date": 1553971904, "question_id": 55434686, "link": "https://stackoverflow.com/questions/55434686/setting-a-user-defined-file-in-go-with-bufio", "title": "Setting a user defined file in go with bufio", "body": "<p>I'm trying to open a csv in go from a user defined filepath (in this case just an entry in the command line).</p>\n\n<p>I've been using the bufio package and taking in a user string, and then using filepath.abs to try to convert it to a proper filepath.</p>\n\n<pre><code>    reader := bufio.NewReader(os.Stdin)\n    fmt.Println(\"What file do you want to enter?\")\n    filePath, _ := reader.ReadString('\\n')\n    filePath, _ = filepath.Abs(filePath)\n    file, err := os.Open(filePath)\n    if err != nil {\n        panic(err.Error())\n    }\n    fmt.Println(file.Name(), \"opened successfully\")\n</code></pre>\n\n<p>Unfortunately this just returns a \"no such file or directory\" error even though the file exists in the working directory. Is there some quirk in go with how strings are handled that would be keeping this from working?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "edited": false, "score": 0, "creation_date": 1553970926, "post_id": 55434498, "comment_id": 97586457, "body": "I can see that you&#39;re missing a quotation mark here <code>bson: &quot;talents,omitempty</code>"}, {"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "reply_to_user": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "edited": false, "score": 0, "creation_date": 1553971044, "post_id": 55434498, "comment_id": 97586491, "body": "Ah, that&#39;s a typo from when I pasted the code. Fixed."}, {"owner": {"reputation": 8750, "user_id": 1771556, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XPkeq.jpg?s=128&g=1", "display_name": "Vadim Ashikhman", "link": "https://stackoverflow.com/users/1771556/vadim-ashikhman"}, "edited": false, "score": 1, "creation_date": 1553971193, "post_id": 55434498, "comment_id": 97586531, "body": "Did you try to use <code>$.TalentData</code>? Possible duplicate of <a href=\"https://stackoverflow.com/questions/43263280/go-template-cant-evaluate-field-x-in-type-y-x-not-part-of-y-but-stuck-in-a\" title=\"go template cant evaluate field x in type y x not part of y but stuck in a\">stackoverflow.com/questions/43263280/&hellip;</a>"}, {"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "reply_to_user": {"reputation": 8750, "user_id": 1771556, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XPkeq.jpg?s=128&g=1", "display_name": "Vadim Ashikhman", "link": "https://stackoverflow.com/users/1771556/vadim-ashikhman"}, "edited": false, "score": 0, "creation_date": 1553971262, "post_id": 55434498, "comment_id": 97586549, "body": "@VadimAshikhman That seemed to do the trick. Why do I have to add a <code>$</code> though?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1553971303, "post_id": 55434498, "comment_id": 97586562, "body": "@P.Nick because inside range <i>&quot;dot is set to the successive elements of the array, slice, or map&quot;</i>."}, {"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "edited": false, "score": 0, "creation_date": 1553971354, "post_id": 55434498, "comment_id": 97586577, "body": "Thanks for clarifying that. Had no clue."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1553971409, "post_id": 55434498, "comment_id": 97586594, "body": "@P.Nick also <i>&quot; When execution begins, $ is set to the data argument passed to Execute, that is, to the starting value of dot. &quot;</i>. That&#39;s why <code>$.</code> works."}], "owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 436, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1553971021, "creation_date": 1553970626, "last_edit_date": 1553971021, "question_id": 55434498, "link": "https://stackoverflow.com/questions/55434498/cant-evaluate-field-in-interface", "title": "Can&#39;t evaluate field in interface", "body": "<p>I'm trying to get data from a mongo collection using data from another collection. But it refuses to work as it returns <code>http: panic serving [::1]:51494: template: display.html:27:27: executing \"builds.display\" at &lt;.TalentData&gt;: can't evaluate field TalentData in type buildcontroller.Build</code></p>\n\n<pre><code>type Build struct {\n    Id bson.ObjectId `bson:\"_id,omitempty\"`\n    Name string `bson: \"name,omitempty\"` \n    CreatedAt *time.Time `bson: \"createdAt,omitempty\"` \n    UpdatedAt *time.Time `bson: \"updatedAt,omitempty\"` \n    Author bson.ObjectId `bson: \"author,omitempty\"` \n    Class bson.ObjectId `bson: \"class,omitempty\"` \n    Talents []int64 `bson: \"talents,omitempty\"`\n}\n\ntype Talents struct {\n    Id bson.ObjectId `bson:\"_id,omitempty\"`\n    Name string `bson: \"name,omitempty\"` \n    Description string `bson: \"description,omitempty\"` \n    Class bson.ObjectId `bson: \"class,omitempty\"` \n}\n\ntype IndexData struct {\n    PageTitle       string\n    BuildData       interface{}\n    TalentData      interface{}\n}\n\nfunc Display(w http.ResponseWriter, r *http.Request) {\n    vars := mux.Vars(r)\n\n    if !bson.IsObjectIdHex(vars[\"id\"]) {\n        err := template.NotFoundTemplate.ExecuteTemplate(w, \"skeleton\", IndexData{PageTitle: \"Page Not Found\"})\n        if err != nil {\n            log.Panic(err)\n        }\n\n        return\n    }\n\n    session := database.GetMongoSession()\n    defer session.Close()\n\n    c := session.DB(config.Settings.Database.Name).C(\"builds\")\n    var result []Build\n    var class bson.ObjectId\n\n    err := c.Find(bson.M{\"_id\": bson.ObjectIdHex(vars[\"id\"])}).All(&amp;result)\n    if err != nil {\n        w.WriteHeader(http.StatusNotFound)\n    }\n\n    for _, v := range result {\n        class = v.Class\n    }\n\n    talents, err := getTalents(class)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    data := IndexData{\n        PageTitle:       \"test\",\n        BuildData:       result,\n        TalentData:      talents,\n    }\n\n    err = template.BuildDisplayTemplate.ExecuteTemplate(w, \"skeleton\", data)\n    if err != nil {\n        log.Panic(err)\n    }\n}\n\nfunc getTalents(class bson.ObjectId) (interface{}, error) {\n    session := database.GetMongoSession()\n    defer session.Close()\n\n    c := session.DB(config.Settings.Database.Name).C(\"talents\")\n    var result []Talents\n\n    err := c.Find(bson.M{\"class\": class}).All(&amp;result)\n    if err != nil {\n        return nil, err\n    }\n\n    return result, nil\n}\n</code></pre>\n\n<p>I find this weird, because <code>result</code> and <code>talents</code> should return data formatted in the same way, and <code>result</code> does work fine.</p>\n\n<pre><code>{{ range $data := .BuildData }} &lt;- This works\n    {{ $data.Name }}\n    {{ range $talent := .TalentData }} &lt;- Nope.\n        {{$talent.Description}}\n    {{ end }}\n{{ end }}\n</code></pre>\n\n<p>I have compared the output of both variables and as I said, they're practically formatted in the same way?</p>\n\n<p><code>talents</code> = <code>[{ObjectIdHex(\"5c9fa88fe86deef65491c31e\") Test Something ObjectIdHex(\"5c9fa8cfe86deef65491c31f\")} {ObjectIdHex(\"5c9faa68cb216df65405dc5b\") Hello Something ObjectIdHex(\"5c9fa8cfe86deef65491c31f\")}]</code></p>\n\n<p><code>result</code> = <code>[{ObjectIdHex(\"5c9f89bde86deef65491c31d\") Test &lt;nil&gt; &lt;nil&gt; ObjectIdHex(\"5c9faa10e86deef65491c320\") ObjectIdHex(\"5c9fa8cfe86deef65491c31f\") []}]</code></p>\n\n<p>What is it that I'm missing here?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1553980235, "post_id": 55434450, "comment_id": 97588702, "body": "No. But that is too short as an answer."}], "answers": [{"comments": [{"owner": {"reputation": 2928, "user_id": 642269, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/f639b8588fff8bf480c5967a4cfc2bc9?s=128&d=identicon&r=PG", "display_name": "Mel", "link": "https://stackoverflow.com/users/642269/mel"}, "edited": false, "score": 1, "creation_date": 1554027358, "post_id": 55434515, "comment_id": 97596263, "body": "that&#39;s what I ended up doing. I just didn&#39;t want another check in my function because its hard to read already."}], "tags": [], "owner": {"reputation": 8750, "user_id": 1771556, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XPkeq.jpg?s=128&g=1", "display_name": "Vadim Ashikhman", "link": "https://stackoverflow.com/users/1771556/vadim-ashikhman"}, "is_accepted": true, "score": 2, "last_activity_date": 1553970746, "creation_date": 1553970746, "answer_id": 55434515, "question_id": 55434450, "link": "https://stackoverflow.com/questions/55434450/how-to-create-a-function-parameter-that-wont-be-copied-and-cannot-be-null/55434515#55434515", "title": "how to create a function parameter that won&#39;t be copied and cannot be null", "body": "<p>You can create tiny struct wrapper which holds private pointer to big struct and defines <code>Get</code> method to allow acquisition of this big struct. Inside <code>Get</code> you check if pointer is nil then it panics.</p>\n\n<p>Something like:</p>\n\n<pre><code>type StructHolder struct {\n    target *BigStruct\n}\n\nfunc (s StructHolder) Get() *BigStruct {\n    if s.target == nil {\n        panic(\"target is nil\")\n    }\n\n    return s.target\n}\n</code></pre>\n\n<p>Why would you do this? I'd think its better to pass a pointer and check its value.</p>\n"}], "owner": {"reputation": 2928, "user_id": 642269, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/f639b8588fff8bf480c5967a4cfc2bc9?s=128&d=identicon&r=PG", "display_name": "Mel", "link": "https://stackoverflow.com/users/642269/mel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 25, "favorite_count": 0, "accepted_answer_id": 55434515, "answer_count": 1, "score": 1, "last_activity_date": 1553970746, "creation_date": 1553970234, "question_id": 55434450, "link": "https://stackoverflow.com/questions/55434450/how-to-create-a-function-parameter-that-wont-be-copied-and-cannot-be-null", "title": "how to create a function parameter that won&#39;t be copied and cannot be null", "body": "<p>In golang, Is it possible to create a function that takes a struct with the following constraints:</p>\n\n<ul>\n<li>the struct must not be copied (its relatively big)</li>\n<li>the caller must not be able to pass <code>nil</code></li>\n</ul>\n\n<p>EDIT:\nI tried using pointers but that can be set to null. I can't find any good articles on how to use references and it doesn't seem like I can pass by reference.</p>\n"}, {"tags": ["c++", "windows", "go", "createprocess"], "comments": [{"owner": {"reputation": 1, "user_id": 5910058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87e1ce21ce04eb150f59eaec245d4ff8?s=128&d=identicon&r=PG&f=1", "display_name": "Jesper Juhl", "link": "https://stackoverflow.com/users/5910058/jesper-juhl"}, "edited": false, "score": 0, "creation_date": 1553968155, "post_id": 55434029, "comment_id": 97585717, "body": "Beyond the programs <i>environment</i> and <i>current working directory</i> potentially being different, there should be no difference between running a program normally by typing its name in a shell or double-clicking it in some GUI environment."}, {"owner": {"reputation": 30170, "user_id": 5231607, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QzGsq.jpg?s=128&g=1", "display_name": "1201ProgramAlarm", "link": "https://stackoverflow.com/users/5231607/1201programalarm"}, "edited": false, "score": 1, "creation_date": 1553971517, "post_id": 55434029, "comment_id": 97586623, "body": "Maybe you need to set the <code>dwXSize</code> and <code>dwYSize</code> members of a <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/ns-processthreadsapi-_startupinfoa\" rel=\"nofollow noreferrer\">STARTUPINFO</a> structure?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1553972005, "post_id": 55434029, "comment_id": 97586769, "body": "I wonder whether it could be possible to use <a href=\"https://docs.microsoft.com/en-us/sysinternals/downloads/procmon\" rel=\"nofollow noreferrer\">ProcMon</a> to peer into how <code>CreateProcess[Ex]</code> gets called in both the cases."}, {"owner": {"reputation": 9551, "user_id": 9837301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9414V.png?s=128&g=1", "display_name": "JaMiT", "link": "https://stackoverflow.com/users/9837301/jamit"}, "edited": false, "score": 0, "creation_date": 1553988560, "post_id": 55434029, "comment_id": 97590488, "body": "Not sure I&#39;ve read the problem description correctly. In Windows 10, before applying the compatibility settings, the program behaved the same (small window) for all three methods of launching (the old 2003 launcher, the new golang launcher, and Explorer)? Is that right? Then setting compatibility changed Explorer and the old (32-bit?) launcher, but not golang?"}, {"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "reply_to_user": {"reputation": 9551, "user_id": 9837301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9414V.png?s=128&g=1", "display_name": "JaMiT", "link": "https://stackoverflow.com/users/9837301/jamit"}, "edited": false, "score": 0, "creation_date": 1553988768, "post_id": 55434029, "comment_id": 97590523, "body": "@JaMiT exactly. But I&#39;ve figured it out. Adding the compatibility setting to the golang launcher itself instead of the game fixed the issue for the launcher but its again small window in double click. Having the compatibility setting on both the launcher and the exe makes it work ok."}, {"owner": {"reputation": 9551, "user_id": 9837301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9414V.png?s=128&g=1", "display_name": "JaMiT", "link": "https://stackoverflow.com/users/9837301/jamit"}, "edited": false, "score": 1, "creation_date": 1553992830, "post_id": 55434029, "comment_id": 97591103, "body": "@majidarif Ah, so the issue seems to be that golang disregards its target&#39;s compatibility settings. It seems like you&#39;re in a position to answer your own question."}, {"owner": {"reputation": 29355, "user_id": 205580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/460e6e299e385fd46df156c85a1dd55f?s=128&d=identicon&r=PG", "display_name": "Eryk Sun", "link": "https://stackoverflow.com/users/205580/eryk-sun"}, "edited": false, "score": 3, "creation_date": 1554002189, "post_id": 55434029, "comment_id": 97592290, "body": "When the shim engine is initialized at process startup, it sets the current compatibility layers in the environment variable <code>__COMPAT_LAYER</code> (e.g. to the value &quot;16BitColor&quot;). This allows propagating the compatibility layer to child processes that inherit the parent&#39;s environment variables. You can of course manually add the <code>__COMPAT_LAYER</code> variable."}, {"owner": {"reputation": 29355, "user_id": 205580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/460e6e299e385fd46df156c85a1dd55f?s=128&d=identicon&r=PG", "display_name": "Eryk Sun", "link": "https://stackoverflow.com/users/205580/eryk-sun"}, "edited": false, "score": 1, "creation_date": 1554002378, "post_id": 55434029, "comment_id": 97592312, "body": "I don&#39;t know why <code>CreateProcessW</code> isn&#39;t writing this shim data in your case when it&#39;s set in the registry key &quot;[HKLM|HKCU]\\Software\\Microsoft\\Windows NT\\CurrentVersion\\AppCompatFlags\\Layers&quot;. In my test with a debugger and procmon, I can see it query the registry and write the data to the PEB <code>pShimData</code> in the child process. (It&#39;s kind of hacky that they implement this by having the parent process write directly to the PEB of the child. By now they should have migrated this to use a creation attribute that&#39;s passed to <code>NtCreateUserProcess</code>.)"}, {"owner": {"reputation": 2634, "user_id": 8985046, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oqc2A.jpg?s=128&g=1", "display_name": "GuidedHacking", "link": "https://stackoverflow.com/users/8985046/guidedhacking"}, "edited": false, "score": 0, "creation_date": 1577745452, "post_id": 55434029, "comment_id": 105245081, "body": "i just opened an app in 3 diff methods and ran procdump, they all checked AppCompatFlags correctly.  Double clicking the exe, calling CreateProcess() on it in a C++ app, and using &quot;start app.exe&quot; on the command line.  All 3 queried AppCompatFlags.  I did not test with GoLang, you should try ProcMon on your golang app and see what happens"}], "owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 645, "favorite_count": 1, "answer_count": 0, "score": 6, "last_activity_date": 1553967754, "creation_date": 1553967390, "last_edit_date": 1553967754, "question_id": 55434029, "link": "https://stackoverflow.com/questions/55434029/what-happens-when-i-double-click-an-executable-technically", "title": "What happens when I double click an executable, technically", "body": "<p><em>tl;dr</em></p>\n\n<p>I'm trying to understand the difference of running a program directly via double clicking the executable vs running it through a terminal or programatically via <code>CreateProcess</code> in windows 10.</p>\n\n<hr>\n\n<p><em>long version</em></p>\n\n<p>Because this is my problem, executing an old game (circa 2003 using D3D8) through double clicking in windows 10 works okay. Executing the game through an seconday executable (also circa 2003) using <code>CreateProcess</code> seems to sometimes work okay.</p>\n\n<p>But executing it through my new golang executable never works. I get a very tiny screen instead. So I want to understand what's the technical difference.</p>\n\n<p>For reference, my golang code goes like: (tiny screen)</p>\n\n<pre><code>cmd := exec.Command(filepath.Join(\".\", \"Game.exe\"))\nerr := cmd.Start()\n</code></pre>\n\n<p>Disassembling the secondary executable gives me this: (normal screen)</p>\n\n<pre><code>CPU Disasm\nAddress   Hex dump          Command                                  Comments\n004043AF  |.  51            PUSH ECX                                 ; /pProcessInformation = 59C7F521 -&gt; {hProcess=???,hThread=???,ProcessID=???,ThreadID=???}\n004043B0  |.  52            PUSH EDX                                 ; |pStartupInfo =&gt; OFFSET LOCAL.16\n004043B1  |.  68 28E54000   PUSH OFFSET 0040E528                     ; |CurrentDirectory = \".\"\n004043B6  |.  50            PUSH EAX                                 ; |pEnvironment =&gt; NULL\n004043B7  |.  50            PUSH EAX                                 ; |CreationFlags =&gt; 0\n004043B8  |.  6A 01         PUSH 1                                   ; |InheritHandles = TRUE\n004043BA  |.  50            PUSH EAX                                 ; |pThreadSecurity =&gt; NULL\n004043BB  |.  50            PUSH EAX                                 ; |pProcessSecurity =&gt; NULL\n004043BC  |.  68 10E54000   PUSH OFFSET 0040E510                     ; |CommandLine = \"Game.exe\"\n004043C1  |.  50            PUSH EAX                                 ; |ApplicationName =&gt; NULL\n004043C2  |.  FF15 8CB04000 CALL DWORD PTR DS:[&lt;&amp;KERNEL32.CreateProc ; \\KERNEL32.CreateProcessA\n</code></pre>\n\n<p>When I say the game is a tiny screen it shows up like this:</p>\n\n<p><a href=\"https://i.stack.imgur.com/qSSpO.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/qSSpO.png\" alt=\"enter image description here\"></a></p>\n\n<p>versus this when it is executed directly with double click: (don't mind it being black its just the normal startup)</p>\n\n<p><a href=\"https://i.stack.imgur.com/9mXM5.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/9mXM5.png\" alt=\"enter image description here\"></a></p>\n\n<hr>\n\n<p>Additional info: Actually the problem only exists in windows 10. Windows 7 is completely fine.</p>\n\n<p>For windows 10, the only way to make it normal screen is to use this setting:</p>\n\n<p><a href=\"https://i.stack.imgur.com/SwEMG.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/SwEMG.png\" alt=\"enter image description here\"></a></p>\n\n<p>When that is used, I get the normal screen when using double click or the secondary executable. But its still a tiny screen on my Golang app.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 961, "user_id": 1775688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I2f0b.png?s=128&g=1", "display_name": "Jota Santos", "link": "https://stackoverflow.com/users/1775688/jota-santos"}, "edited": false, "score": 0, "creation_date": 1553961396, "post_id": 55433127, "comment_id": 97583941, "body": "Have you tried to change the <code>WorkingDirectory</code> of the server?"}, {"owner": {"reputation": 63, "user_id": 11154131, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Df9Cd5m8YbU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf3t3aLeqiZQsvHjhZOsFrB-0dzvg/mo/photo.jpg?sz=128", "display_name": "Abraham", "link": "https://stackoverflow.com/users/11154131/abraham"}, "reply_to_user": {"reputation": 961, "user_id": 1775688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I2f0b.png?s=128&g=1", "display_name": "Jota Santos", "link": "https://stackoverflow.com/users/1775688/jota-santos"}, "edited": false, "score": 0, "creation_date": 1554120003, "post_id": 55433127, "comment_id": 97622632, "body": "Hi, yes I did and it works. Thanks!!"}], "answers": [{"tags": [], "owner": {"reputation": 8750, "user_id": 1771556, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XPkeq.jpg?s=128&g=1", "display_name": "Vadim Ashikhman", "link": "https://stackoverflow.com/users/1771556/vadim-ashikhman"}, "is_accepted": true, "score": 2, "last_activity_date": 1553962095, "last_edit_date": 1553962095, "creation_date": 1553961367, "answer_id": 55433194, "question_id": 55433127, "link": "https://stackoverflow.com/questions/55433127/deploy-golang-app-api-with-config-toml-file/55433194#55433194", "title": "deploy Golang app (api) with config.toml file", "body": "<p>If you use relative paths to files in your Go scrips then executable will look for them relative to the current working directory. To change working directory in <code>systemd</code> just add <code>WorkingDirectory</code> parameter to the <code>Service</code> section:</p>\n\n<pre><code>[Service]\nWorkingDirectory=/var/www/go\n</code></pre>\n\n<p>And place <code>config.toml</code> file inside <code>/var/www/go</code> dir.</p>\n\n<p>You can also embed static files into Go binary using this library: <a href=\"https://github.com/gobuffalo/packr\" rel=\"nofollow noreferrer\">https://github.com/gobuffalo/packr</a></p>\n"}], "owner": {"reputation": 63, "user_id": 11154131, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Df9Cd5m8YbU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf3t3aLeqiZQsvHjhZOsFrB-0dzvg/mo/photo.jpg?sz=128", "display_name": "Abraham", "link": "https://stackoverflow.com/users/11154131/abraham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 328, "favorite_count": 0, "accepted_answer_id": 55433194, "answer_count": 1, "score": 0, "last_activity_date": 1553962095, "creation_date": 1553960957, "question_id": 55433127, "link": "https://stackoverflow.com/questions/55433127/deploy-golang-app-api-with-config-toml-file", "title": "deploy Golang app (api) with config.toml file", "body": "<p>I have created a small golang API (nrfapi) which include a config.toml file. I would like to deploy the api on other ubuntu VM therefore i build the API using the \"GOOS=linux GOARCH=amd64 go build\" and then scp the build file to the VM /var/www/go diretory. I also create a unit file (nrf.service) ending in .service within the /etc/systemd/system directory. In the .service file i have the following configuration   </p>\n\n<pre><code>[Unit]\nDescription= instance to serve nrf api\nAfter=network.target\n\n[Service]\nUser=root\nGroup=www-data\n\nExecStart=/var/www/go/nrfapi)\n\n[Install]\nWantedBy=multi-user.target\n\n</code></pre>\n\n<p>ERROR</p>\n\n<pre><code>Error\n\n\u25cf nrf.service - instance to serve nrf api\n   Loaded: loaded (/etc/systemd/system/nrf.service; enabled; vendor preset: enabled)\n   Active: failed (Result: exit-code) since Sat 2019-03-30 16:44:51 EET; 11s ago\n Main PID: 4066 (code=exited, status=1/FAILURE)\n\nMar 30 16:44:51 ubuntu systemd[1]: Started instance to serve nrf api.\nMar 30 16:44:51 ubuntu nrfapi[4066]: 2019/03/30 16:44:51 open config.toml: no such file or directory\nMar 30 16:44:51 ubuntu systemd[1]: nrf.service: Main process exited, code=exited, status=1/FAILURE\nMar 30 16:44:51 ubuntu systemd[1]: nrf.service: Unit entered failed state.\nMar 30 16:44:51 ubuntu systemd[1]: nrf.service: Failed with result 'exit-code'.\n\n</code></pre>\n\n<p>However, after starting the API using the following commands</p>\n\n<p>sudo systemctl start nrfapi\nsudo systemctl enable nrfapi</p>\n\n<p>the API is not running. I realize from the error message above that the API need the config.toml file configurations.</p>\n\n<p>My problem now is that i dont know which directory to place the config.toml file so that the golang api can read the configuration parameters from there. Can anyone help me solve this? How do i go about this?</p>\n"}]