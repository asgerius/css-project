[{"tags": ["c", "go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1429742703, "post_id": 29809935, "comment_id": 47748556, "body": "Translating between languages <i>requires</i> knowing both the old and new language well as well as the thing being translated. You should usually translate/port at higher than the statement level. In any case, either you know what that C does (in which case it should be easy-ish to port) or you don&#39;t, in which case you shouldn&#39;t be trying to port it."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1429743011, "post_id": 29809935, "comment_id": 47748655, "body": "I recommend reading this Go blog post <a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">blog.golang.org/strings</a> because this is on place where Go is not very much like C imo."}, {"owner": {"reputation": 951, "user_id": 631593, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/6f0ab0bf648041c211675b2bd06313c6?s=128&d=identicon&r=PG", "display_name": "Varun", "link": "https://stackoverflow.com/users/631593/varun"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1429743026, "post_id": 29809935, "comment_id": 47748658, "body": "Thanks @DaveC, I agree with you to a certain extent, but if I don&#39;t try how do I learn. Also I have been able to port most of it and this is kind of last thing that I need to get it done. I am not a master on both c or go, but have ability to read and make sense and write something new (with go)."}, {"owner": {"reputation": 951, "user_id": 631593, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/6f0ab0bf648041c211675b2bd06313c6?s=128&d=identicon&r=PG", "display_name": "Varun", "link": "https://stackoverflow.com/users/631593/varun"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1429743201, "post_id": 29809935, "comment_id": 47748724, "body": "@evanmcdonnal thanks for the link, I have read that, I know that char * is most probably a generic raw memory pointer used in place of void *, but want to confirm my understanding."}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 3, "creation_date": 1429756125, "post_id": 29809935, "comment_id": 47752891, "body": "This is undefined behavior in C, unless the first element of the struct is an Oid (in which case there&#39;s no need for the pointer nonsense). What&#39;s the struct, and what are you trying to do? Probably there&#39;s a better way."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1429802889, "post_id": 29809935, "comment_id": 47782223, "body": "The string abstraction in Go simply doesn&#39;t allow for that. It intentionally will not allow you to take the address of an arbitrary index in a string. The reason I linked the article is because you should think about what piece of data you&#39;re trying to access and then assign it directly to a variable. Even if you find some way to arbitrarily point into a string in Go, it will be extremely questionable/hacky code."}], "answers": [{"comments": [{"owner": {"reputation": 951, "user_id": 631593, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/6f0ab0bf648041c211675b2bd06313c6?s=128&d=identicon&r=PG", "display_name": "Varun", "link": "https://stackoverflow.com/users/631593/varun"}, "edited": false, "score": 0, "creation_date": 1429750313, "post_id": 29811385, "comment_id": 47751141, "body": "Thanks @JimB, let me try that."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 0, "last_activity_date": 1429748706, "creation_date": 1429748706, "answer_id": 29811385, "question_id": 29809935, "link": "https://stackoverflow.com/questions/29809935/how-to-change-char-to-go-equivalent/29811385#29811385", "title": "how to change char * to Go equivalent", "body": "<p>The Go equivalent to a casting a C pointer is converting a pointer to an <code>unsafe.Pointer</code>, which can then be converted to a pointer of any type you wish.</p>\n\n<p>If <code>tup</code> is a pointer to a struct in C, you could convert it to a <code>*uint32</code> like so:</p>\n\n<pre><code>u := (*uint32)(unsafe.Pointer(C.tup))\n</code></pre>\n"}], "owner": {"reputation": 951, "user_id": 631593, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/6f0ab0bf648041c211675b2bd06313c6?s=128&d=identicon&r=PG", "display_name": "Varun", "link": "https://stackoverflow.com/users/631593/varun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 114, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1429748706, "creation_date": 1429741052, "question_id": 29809935, "link": "https://stackoverflow.com/questions/29809935/how-to-change-char-to-go-equivalent", "title": "how to change char * to Go equivalent", "body": "<p>I have some c code that look like this-</p>\n\n<pre><code>*((Oid *) ((char *)(tup)\n</code></pre>\n\n<p>where Oid is a uint32 type and tup is a struct. I want to convert it to go lang. I have decoded the struct but not able to figure out how to convert above line to go lang.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1429737143, "post_id": 29808720, "comment_id": 47745953, "body": "I don&#39;t quite understand what you&#39;re asking. Is there something you don&#39;t understand here in the <a href=\"http://golang.org/ref/spec#Channel_types\" rel=\"nofollow noreferrer\">channel spec</a>? Specifically the paragraph about capacity"}, {"owner": {"reputation": 1, "user_id": 4821443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3217d9d3b3d164e3213c4c8dd0273fa2?s=128&d=identicon&r=PG&f=1", "display_name": "Backhand", "link": "https://stackoverflow.com/users/4821443/backhand"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1429737480, "post_id": 29808720, "comment_id": 47746150, "body": "@JimB I dont understand the buffer part! how does that affect the output?!"}, {"owner": {"reputation": 1, "user_id": 4821443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3217d9d3b3d164e3213c4c8dd0273fa2?s=128&d=identicon&r=PG&f=1", "display_name": "Backhand", "link": "https://stackoverflow.com/users/4821443/backhand"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1429737533, "post_id": 29808720, "comment_id": 47746183, "body": "and i did visit that link before didnt really help me"}, {"owner": {"reputation": 1, "user_id": 4821443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3217d9d3b3d164e3213c4c8dd0273fa2?s=128&d=identicon&r=PG&f=1", "display_name": "Backhand", "link": "https://stackoverflow.com/users/4821443/backhand"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1429739863, "post_id": 29808720, "comment_id": 47747328, "body": "Someone identified my question as already answered somewhere  but as i said it&#39;s very brought it doesn&#39;t really help!!!"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1429741675, "post_id": 29808720, "comment_id": 47748142, "body": "@Backhand I&#39;ve written a couple of examples that should help to clarify your understanding. If it still doesn&#39;t make sense let me know and I&#39;ll try to come up with another demo."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 4821443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3217d9d3b3d164e3213c4c8dd0273fa2?s=128&d=identicon&r=PG&f=1", "display_name": "Backhand", "link": "https://stackoverflow.com/users/4821443/backhand"}, "edited": false, "score": 0, "creation_date": 1429742954, "post_id": 29809943, "comment_id": 47748628, "body": "Thank you so much i understand now!! i think what confused me the most is the time in between goroutines!! THANK YOU"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 1, "user_id": 4821443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3217d9d3b3d164e3213c4c8dd0273fa2?s=128&d=identicon&r=PG&f=1", "display_name": "Backhand", "link": "https://stackoverflow.com/users/4821443/backhand"}, "edited": false, "score": 0, "creation_date": 1429743043, "post_id": 29809943, "comment_id": 47748664, "body": "@Backhand np, glad I could help."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 2, "last_activity_date": 1429741083, "creation_date": 1429741083, "answer_id": 29809943, "question_id": 29808720, "link": "https://stackoverflow.com/questions/29808720/how-does-the-channel-buffer-work/29809943#29809943", "title": "How does the channel buffer work?", "body": "<p>If a channel does not have a buffer then only a single item can be sent on it at a time. This means code that sends on it will block until some receiver reads the item out of the channel. Here's a contrived example; <a href=\"https://play.golang.org/p/HM8jdIFqsN\" rel=\"nofollow\">https://play.golang.org/p/HM8jdIFqsN</a>\n    package main</p>\n\n<pre><code>import (\n    \"fmt\"\n)\n\n\nfunc main() {\n   blocker := make(chan bool)\n   nonBlocker := make(chan bool, 5)\n\n   for i := 0; i &lt; 5; i++ {\n        nonBlocker &lt;- true\n        fmt.Println(\"We keep going\")\n   }\n\n   go func () {\n\n    for i := 0; i &lt; 5; i++ {\n        blocker &lt;- true\n        fmt.Println(\"We block cause that channel is full\")\n   } }()\n\n}\n</code></pre>\n\n<p>There's plenty of other things I could do to demonstrate the same but the basic idea is, if you pass a channel into some goroutine and the channel is not buffered, the goroutine which sends on the channel will block until the item it sent is received. With a buffered channel you can send as long as the buffer isn't at capacity. Basically, if you spin up goroutines which are doing work and returning the results and they're moving faster than the code that spawned them, you may want to use a buffered channel to open up that bottle neck.</p>\n\n<p>EDIT: If it's still not obvious what's happening look at this; <a href=\"https://play.golang.org/p/9SXc4M1to4\" rel=\"nofollow\">https://play.golang.org/p/9SXc4M1to4</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\n\nfunc main() {\n   blocker := make(chan bool)\n   nonBlocker := make(chan bool, 5)\n\n   for i := 0; i &lt; 5; i++ {\n        nonBlocker &lt;- true\n        fmt.Println(\"We keep going\")\n   }\n\n   go func () {\n\n    for i := 0; i &lt; 5; i++ {\n        blocker &lt;- true\n        fmt.Println(\"Now we see this cause the reciever keeps opening the channel up again!\")\n   } }()\n\n   for i := 0; i &lt; 5; i++ {\n      &lt;-blocker\n   }\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 4821443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3217d9d3b3d164e3213c4c8dd0273fa2?s=128&d=identicon&r=PG&f=1", "display_name": "Backhand", "link": "https://stackoverflow.com/users/4821443/backhand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 264, "favorite_count": 1, "closed_date": 1429822502, "accepted_answer_id": 29809943, "answer_count": 1, "score": -2, "last_activity_date": 1429767150, "creation_date": 1429736442, "last_edit_date": 1429767150, "question_id": 29808720, "link": "https://stackoverflow.com/questions/29808720/how-does-the-channel-buffer-work", "closed_reason": "Duplicate", "title": "How does the channel buffer work?", "body": "<p>I went through a series of definitions to figure out how the buffer works but I just don't get it. Here is an example below, I changed the value of the buffer but I have no clue about what it does. Can some one explain it to me based on this example and provide some test cases of how/why it's working? Thanks.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc send(out, finish chan bool) {\n    for i := 0; i &lt; 5; i++ {\n        out &lt;- true\n        time.Sleep(1 * time.Second)\n        fmt.Println(\"Fin d'une \u00e9criture\")\n    }\n    finish &lt;- true\n    close(out)\n}\nfunc recv(in, finish chan bool) {\n    for _ = range in {\n        fmt.Println(\"Fin d'une lecture\")\n        time.Sleep(10 * time.Second)\n    }\n    finish &lt;- true\n}\nfunc main() {\n    chanFoo := make(chan bool, 3)\n    chanfinish := make(chan bool)\n    go send(chanFoo, chanfinish)\n    go recv(chanFoo, chanfinish)\n    &lt;-chanfinish\n    &lt;-chanfinish\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 7705, "user_id": 1076743, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/luioK.png?s=128&g=1", "display_name": "Sir", "link": "https://stackoverflow.com/users/1076743/sir"}, "edited": false, "score": 0, "creation_date": 1509681812, "post_id": 29805635, "comment_id": 81126133, "body": "I tried your second code snippet for a struct but i can&#39;t simply pass my struct in when the func takes interface{} so how do i pass a correct arguement for the func ?"}, {"owner": {"reputation": 545, "user_id": 3763112, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/bea14956d83fe906ba4bafcea761250d?s=128&d=identicon&r=PG&f=1", "display_name": "Angger", "link": "https://stackoverflow.com/users/3763112/angger"}, "edited": false, "score": 0, "creation_date": 1521081390, "post_id": 29805635, "comment_id": 85584363, "body": "can we do this without asserting? so its receive dynamic struct."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 545, "user_id": 3763112, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/bea14956d83fe906ba4bafcea761250d?s=128&d=identicon&r=PG&f=1", "display_name": "Angger", "link": "https://stackoverflow.com/users/3763112/angger"}, "edited": false, "score": 0, "creation_date": 1521143901, "post_id": 29805635, "comment_id": 85618451, "body": "@Angger you don&#39;t have to do the type assertion, if you know what methods the interface offers you can just call one. The type assertion would be used if the method set provided by incoming types differs and you need to do something specific based on which type is passed in."}, {"owner": {"reputation": 1083, "user_id": 5203655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PrTVd.jpg?s=128&g=1", "display_name": "Meghan", "link": "https://stackoverflow.com/users/5203655/meghan"}, "edited": false, "score": 0, "creation_date": 1582614579, "post_id": 29805635, "comment_id": 106828085, "body": "TIL you can grab the ok 2nd arg out of a type assertion. Thanks for this :D"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 38, "last_activity_date": 1429726028, "creation_date": 1429726028, "answer_id": 29805635, "question_id": 29805583, "link": "https://stackoverflow.com/questions/29805583/how-can-i-pass-a-struct-to-a-function-as-parameter/29805635#29805635", "title": "How can I pass a struct to a function as parameter?", "body": "<p>You're looking for;</p>\n\n<pre><code>func test(class MyClass) {\n    fmt.Println(class.Name)\n}\n</code></pre>\n\n<p>As it stands the method recognizes <code>class</code> as some object which implements the empty interface (meaning in that scope it's fields and methods are completely unknown) which is why you get the error.</p>\n\n<p>Your other option is something like this;</p>\n\n<pre><code>func test(class interface{}) {\n     if c, ok := class.(MyClass); ok { // type assert on it    \n         fmt.Println(c.Name)\n     }\n}\n</code></pre>\n\n<p>But there is no reason to in your example. It only makes sense if you're going to do a type switch or have multiple code paths that do different things based on the actual type of <code>class</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 2041, "user_id": 5824483, "user_type": "registered", "accept_rate": 40, "profile_image": "https://graph.facebook.com/1045400122183130/picture?type=large", "display_name": "Amulya Kashyap", "link": "https://stackoverflow.com/users/5824483/amulya-kashyap"}, "edited": false, "score": 0, "creation_date": 1529653664, "post_id": 29819163, "comment_id": 88961167, "body": "Now additionally I want to add interface which keeps list of all functions/Methods. How would we implement that ?"}, {"owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "reply_to_user": {"reputation": 2041, "user_id": 5824483, "user_type": "registered", "accept_rate": 40, "profile_image": "https://graph.facebook.com/1045400122183130/picture?type=large", "display_name": "Amulya Kashyap", "link": "https://stackoverflow.com/users/5824483/amulya-kashyap"}, "edited": false, "score": 0, "creation_date": 1529690568, "post_id": 29819163, "comment_id": 88981432, "body": "Can you elaborate more @AmulyaKashyap? Describe what your aiming to do."}], "tags": [], "owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "is_accepted": false, "score": 14, "last_activity_date": 1429781088, "creation_date": 1429781088, "answer_id": 29819163, "question_id": 29805583, "link": "https://stackoverflow.com/questions/29805583/how-can-i-pass-a-struct-to-a-function-as-parameter/29819163#29819163", "title": "How can I pass a struct to a function as parameter?", "body": "<p>Depending on your needs, you have (at least) two options:</p>\n\n<ol>\n<li>Method on the struct type</li>\n<li>Func that takes struct type as parameter</li>\n</ol>\n\n\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype MyClass struct {\n    Name string\n}\n\nfunc main() {\n    cls := MyClass{Name: \"Jhon\"}\n\n    // Both calls below produce same result\n    cls.StructMethod()  // \"Jhon\"\n    FuncPassStruct(cls) // \"Jhon\"\n}\n\n// Method on struct type\nfunc (class MyClass) StructMethod() {\n    fmt.Println(class.Name)\n}\n\n// Function that takes struct type as the parameter\nfunc FuncPassStruct(class MyClass) {\n    fmt.Println(class.Name)\n}\n</code></pre>\n\n<p>I'm sure others may provide some interface wizardry I'm forgetting.</p>\n"}, {"tags": [], "owner": {"reputation": 1888, "user_id": 1893096, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZrkQ.jpg?s=128&g=1", "display_name": "Petre Sosa", "link": "https://stackoverflow.com/users/1893096/petre-sosa"}, "is_accepted": false, "score": 1, "last_activity_date": 1569321563, "last_edit_date": 1569321563, "creation_date": 1480063031, "answer_id": 40800710, "question_id": 29805583, "link": "https://stackoverflow.com/questions/29805583/how-can-i-pass-a-struct-to-a-function-as-parameter/40800710#40800710", "title": "How can I pass a struct to a function as parameter?", "body": "<p>Please take a look over the <strong>Debug</strong> ,<strong>Receive</strong> methods. It uses stuct user, with its methods. <a href=\"https://play.golang.org/p/E_WkLWGdeB\" rel=\"nofollow noreferrer\">https://play.golang.org/p/E_WkLWGdeB</a></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\n// user defines a user in the program.\ntype user struct {\n    name   string\n    email  string\n    status string\n}\n\nfunc debug(u user) {\n    fmt.Printf(\"%+v\\n\", u)\n}\n\n// notify implements a method with a value receiver.\nfunc (u user) notify() {\n    fmt.Printf(\"User: Sending User Email To %s&lt;%s&gt;\\n\", u.name, u.email)\n}\n\n// changeEmail implements a method with a pointer receiver.\nfunc (u *user) changeEmail(email string) {\n    u.email = email\n}\n\nfunc (u *user) changeName(name string) {\n    u.name = name\n}\n\nfunc (u *user) Send() {\n    u.notify()\n}\n\n// main is the entry point for the application.\nfunc main() {\n    // Pointers of type user can also be used to methods\n    // declared with a value receiver.\n    john := &amp;user{\"John\", \"john@exemple.com\", \"enabled\"}\n\n    john.changeName(\"John Smith\")\n    john.changeEmail(\"john@gmail.com\")\n    john.notify()\n\n    Receive(john)\n    debug(user{\"Willy\", \"Willy@exemple.com\", \"enabled\"})\n}\n\nfunc Receive(user interface {\n    changeName(s string)\n    changeEmail(s string)\n    Send()\n}) {\n    user.changeName(\"Bill\")\n    user.changeEmail(\"bill@billy-exemple.com\")\n    user.Send()\n}\n\n\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 745, "user_id": 4547609, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/108385d869de0f7c3c4e5964d639fe5a?s=128&d=identicon&r=PG", "display_name": "Another Prog", "link": "https://stackoverflow.com/users/4547609/another-prog"}, "is_accepted": false, "score": 2, "last_activity_date": 1494117270, "creation_date": 1494117270, "answer_id": 43826694, "question_id": 29805583, "link": "https://stackoverflow.com/questions/29805583/how-can-i-pass-a-struct-to-a-function-as-parameter/43826694#43826694", "title": "How can I pass a struct to a function as parameter?", "body": "<p>If you really want to send any struct in generically like it is written in your original question (an empty interface parameter) so that AnyStruct.SomeField and AnotherStruct.SomeField, or AnyOtherStruct.AnyField can be accessed, AFAIK the reflecton features of go are the way to go. </p>\n\n<p>For example if you look at the JSON marshal function it accepts pretty much any struct as a (\"v\") parameter sent in to a function with an empty interface parameter. Then that marshal function ends up calling</p>\n\n<pre><code>e.reflectValue(reflect.ValueOf(v), opts)\n</code></pre>\n\n<p>But you are probably looking for something simple as the other answers have suggested, which would not need advanced reflection (a sort of generic way of programming)</p>\n\n<p>However I post this answer in case other readers are interested in sending structs in generally without needing to know up front what the struct fields are.</p>\n\n<p>The reason a JSON parser needs to generically access a struct is for convenience of the user defining any struct he wants, and then Go automagically figures out the struct and maps it to a JSON syntax. You could imagine 100's of different struct layouts that you just want to place into a text file, without knowing all your struct layouts upfront - the function can figure out it at run time, which is how reflection works (other languages call it run time type information, meta programming, and similar).</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 14816611, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/b688803e28653e0ed7ae0f8c009bfcd4?s=128&d=identicon&r=PG", "display_name": "Benjamin Chibuzor-orie", "link": "https://stackoverflow.com/users/14816611/benjamin-chibuzor-orie"}, "is_accepted": false, "score": 0, "last_activity_date": 1607841722, "creation_date": 1607841722, "answer_id": 65273044, "question_id": 29805583, "link": "https://stackoverflow.com/questions/29805583/how-can-i-pass-a-struct-to-a-function-as-parameter/65273044#65273044", "title": "How can I pass a struct to a function as parameter?", "body": "<p>You need to cast the parameter from an interface to the specific struct by using the <code>.()</code> syntax</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;fmt&quot;\n)\n\ntype MyClass struct {\n    Name string\n}\n\nfunc test(class interface{}) {\n    classStr := class.(MyClass)\n    fmt.Println(classStr.Name)\n}\n\nfunc main() {\n\n    test(MyClass{Name: &quot;Jhon&quot;})\n}\n</code></pre>\n"}], "owner": {"reputation": 4746, "user_id": 394572, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1572070193/picture?type=large", "display_name": "alioygur", "link": "https://stackoverflow.com/users/394572/alioygur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58196, "favorite_count": 4, "accepted_answer_id": 29805635, "answer_count": 5, "score": 17, "last_activity_date": 1608684318, "creation_date": 1429725860, "last_edit_date": 1608684318, "question_id": 29805583, "link": "https://stackoverflow.com/questions/29805583/how-can-i-pass-a-struct-to-a-function-as-parameter", "title": "How can I pass a struct to a function as parameter?", "body": "<p>How can I pass a struct to function as a parameter in golang? There is my code:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n)\n\ntype MyClass struct {\n    Name string\n}\n\nfunc test(class interface{}) {\n    fmt.Println(class.Name)\n}\n\nfunc main() {\n\n    test(MyClass{Name: &quot;Jhon&quot;})\n}\n</code></pre>\n<p>when I run it, I am getting an error like this</p>\n<pre><code># command-line-arguments\n/tmp/sandbox290239038/main.go:12: class.Name undefined (type interface {} has no field or method Name)\n</code></pre>\n<p>there is play.golang.org <a href=\"http://play.golang.org/p/do3YDFsyLD\" rel=\"nofollow noreferrer\">fiddle</a> address.</p>\n"}, {"tags": ["sql", "postgresql", "go", "martini"], "comments": [{"owner": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "edited": false, "score": 0, "creation_date": 1429721461, "post_id": 29804035, "comment_id": 47735937, "body": "When you say not working what do you mean by that? Is it not finding the row in the sql?"}, {"owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "reply_to_user": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "edited": false, "score": 0, "creation_date": 1429723943, "post_id": 29804035, "comment_id": 47737586, "body": "I always got it not working and giving error. Have tried various way. I just have no idea"}, {"owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "reply_to_user": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "edited": false, "score": 0, "creation_date": 1429724352, "post_id": 29804035, "comment_id": 47737896, "body": "I forgot something about the params."}], "answers": [{"comments": [{"owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "edited": false, "score": 0, "creation_date": 1429724646, "post_id": 29804147, "comment_id": 47738110, "body": "I forgot to add <code>params martini.Params</code>. Your codes works now. Thanks"}], "tags": [], "owner": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "is_accepted": true, "score": 1, "last_activity_date": 1429724715, "last_edit_date": 1429724715, "creation_date": 1429721624, "answer_id": 29804147, "question_id": 29804035, "link": "https://stackoverflow.com/questions/29804035/how-to-append-uri-as-string-in-sql-query/29804147#29804147", "title": "How to append URI as string in SQL query", "body": "<p>Part of your issue is that you're using the string <code>params[\"idnumber\"]</code> as part of the SQL query</p>\n\n<pre><code>db.Query(`SELECT title, author, description FROM books WHERE id = params[\"idnumber\"]`)\n</code></pre>\n\n<p>That will look for a book where the id equals <code>params[\"idnumber\"]</code> string. </p>\n\n<p>What you need to do is use placeholders and the arguments according to <a href=\"http://golang.org/pkg/database/sql/#DB.Query\" rel=\"nofollow\">http://golang.org/pkg/database/sql/#DB.Query</a></p>\n\n<p>In this case your query should be </p>\n\n<pre><code>db.Query(\"SELECT title, author, description FROM books WHERE id=$1\", params[\"idnumber\"]) \n</code></pre>\n\n<p>That should solve the issue I think you're having. However, until you actually update your question with the actual issue you're having I won't know. </p>\n\n<p><strong>Update</strong></p>\n\n<p>The error you're getting with <code>undefined: params</code> is because you don't have a params object in scope.</p>\n\n<p>I'd suggest reading how martini works in regards of getting the arguments out of the route. <a href=\"https://github.com/go-martini/martini#routing\" rel=\"nofollow\">https://github.com/go-martini/martini#routing</a></p>\n"}, {"comments": [{"owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "edited": false, "score": 0, "creation_date": 1429724171, "post_id": 29804304, "comment_id": 47737759, "body": "Also got error like Leo Correa answer. Error on line 27: undefined: params"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "edited": false, "score": 0, "creation_date": 1429724493, "post_id": 29804304, "comment_id": 47738000, "body": "@apasajja yeah, well you&#39;re just using params out of the blue without declaring it anywhere. What is <code>m</code>? You&#39;re looking for request url.Values which is a dictionary of key value pairs and you&#39;ll need to put in the desired string format prior to passing it into your Query."}, {"owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "edited": false, "score": 0, "creation_date": 1429724882, "post_id": 29804304, "comment_id": 47738285, "body": "Yes. I forgot to add <code>params martini.Params</code>. Unfortunately your codes not working after params declaration added, while Leo Correa codes works.  <code>m</code> is martini. Yes, appending the URI as part database query (SQL)."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "edited": false, "score": 0, "creation_date": 1429724993, "post_id": 29804304, "comment_id": 47738361, "body": "@apasajja I guess I have the wrong token in my query string ( the ? should be $1 ), I just followed the go docs example."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 1, "last_activity_date": 1429725014, "last_edit_date": 1429725014, "creation_date": 1429722083, "answer_id": 29804304, "question_id": 29804035, "link": "https://stackoverflow.com/questions/29804035/how-to-append-uri-as-string-in-sql-query/29804304#29804304", "title": "How to append URI as string in SQL query", "body": "<p>I think the problem is that you're using the variable name in your string literal query, you want it's value there instead.</p>\n\n<p>Try changing this;</p>\n\n<pre><code>rows, err := db.Query(`SELECT title, author, description FROM books WHERE id = params[\"idnumber\"]`)\n</code></pre>\n\n<p>to;</p>\n\n<pre><code>rows, err := db.Query(\"SELECT title, author, description FROM books WHERE id =$1\", params[\"idnumber\"])\n</code></pre>\n\n<p>You could have other issues beyond that but given you're not forming the query correctly I wouldn't expect you to get back the results you want.</p>\n"}], "owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 244, "favorite_count": 0, "accepted_answer_id": 29804147, "answer_count": 2, "score": -1, "last_activity_date": 1429725014, "creation_date": 1429721315, "question_id": 29804035, "link": "https://stackoverflow.com/questions/29804035/how-to-append-uri-as-string-in-sql-query", "title": "How to append URI as string in SQL query", "body": "<p>Looks simple but I unable to make it happen.\nWhen browsing <code>domain.com/post/1</code>, it should show data from row <code>id</code> which value <code>1</code>.</p>\n\n<p>Row <code>id</code> is integer (<code>int4</code>).</p>\n\n<p>Below the the codes, which is not working:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"github.com/go-martini/martini\"\nimport \"net/http\"\nimport \"database/sql\"\nimport _ \"github.com/lib/pq\"\n\nfunc SetupDB() *sql.DB {\n  db, err := sql.Open(\"postgres\", \"user=postgres password=apassword dbname=lesson4 sslmode=disable\")\n  PanicIf(err)\n  return db\n}\n\nfunc PanicIf(err error) {\n  if err != nil {\n    panic(err)\n  }\n}\n\nfunc main() {\n  m := martini.Classic()\n  m.Map(SetupDB())\n\n  m.Get(\"/post/:idnumber\", func(rw http.ResponseWriter, r *http.Request, db *sql.DB) {\n\n    rows, err := db.Query(`SELECT title, author, description FROM books WHERE id = params[\"idnumber\"]`)\n    PanicIf(err)\n    defer rows.Close()\n\n    var title, author, description string\n    for rows.Next() {\n      err:= rows.Scan(&amp;title, &amp;author, &amp;description)\n      PanicIf(err)\n      fmt.Fprintf(rw, \"Title: %s\\nAuthor: %s\\nDescription: %s\\n\\n\",\n        title, author, description)\n    }\n\n  })\n\n  m.Run()\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1429712215, "post_id": 29800079, "comment_id": 47728774, "body": "I misread the path, and didn&#39;t realize this was in GOROOT. Can you try to rebuild Go on both systems, or at least make certain they have the exact same Go version? (I assume this is you as well? <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/NtepDycHO9Y\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/golang-nuts/NtepDycHO9Y</a>, though no responses yet)"}, {"owner": {"reputation": 1695, "user_id": 617556, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6136180203540c5248e37d1124ac7999?s=128&d=identicon&r=PG", "display_name": "Paperback Writer", "link": "https://stackoverflow.com/users/617556/paperback-writer"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1429712527, "post_id": 29800079, "comment_id": 47729035, "body": "Yes, previously I had tried on golang nuts, but no luck, so I wrote on SO. I don&#39;t think this is problem with go version. While debugging this problem I updated version of go on remote machine from <code>1.2</code> to <code>1.4.2</code>. In both cases .a files have _.PKGDEF\\ in header, rather then __.PKGDEF."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1429715209, "post_id": 29800079, "comment_id": 47731373, "body": "The path <code>&#47;usr&#47;lib64&#47;go</code> is a little unusual. Is that where GOROOT should be on your system? (also, you shouldn&#39;t be setting the GOROOT env variable if you are)."}, {"owner": {"reputation": 1695, "user_id": 617556, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6136180203540c5248e37d1124ac7999?s=128&d=identicon&r=PG", "display_name": "Paperback Writer", "link": "https://stackoverflow.com/users/617556/paperback-writer"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1429776580, "post_id": 29800079, "comment_id": 47761692, "body": "Yes, on my test machine, GOROOT is in <code>&#47;usr&#47;lib64&#47;go</code>. This is openSUSE machine and go was installed there using rpm package. I am not an expert on openSUSE but I think that installation directory (hence GOROOT) is specified by rpm package and not by system admin. Anyway, this strange __.PKGDEF\\ header may have something to do with code being specifically compiled for/by openSUSE, because it seems that is just __.PKGDEF everywhere else."}, {"owner": {"reputation": 6730, "user_id": 297094, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/08a7e4ec1109264bc3d18a519d15146c?s=128&d=identicon&r=PG", "display_name": "Robert Zaremba", "link": "https://stackoverflow.com/users/297094/robert-zaremba"}, "edited": false, "score": 0, "creation_date": 1429778999, "post_id": 29800079, "comment_id": 47763300, "body": "Friend from the project here. The go package comes from OS distribution repository. The not working one is on openSUSE (we checked it on versions 12.3, 13.1 and 13.2), the good one is on ubuntu. Probably there is some issue in packaging. <code>go version</code>, from both OS,  gives the same output: <code>go version go1.4.2 linux&#47;amd64</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1429798401, "post_id": 29800079, "comment_id": 47778393, "body": "It looks like openSUSE is doing something different with their build of Go. Unless you want to start troubleshooting their rpm build, I would drop that in favor of the official binary releases (or build from source which is very easy)."}], "answers": [{"comments": [{"owner": {"reputation": 4282, "user_id": 165063, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MJdL7.png?s=128&g=1", "display_name": "Roman Khimov", "link": "https://stackoverflow.com/users/165063/roman-khimov"}, "edited": false, "score": 0, "creation_date": 1471031362, "post_id": 30013378, "comment_id": 65207864, "body": "There is a <a href=\"https://bugzilla.opensuse.org/show_bug.cgi?id=980048\" rel=\"nofollow noreferrer\">bug now in openSUSE bugzilla</a>, BTW."}], "tags": [], "owner": {"reputation": 1652, "user_id": 918176, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2bdb37b11c35de00bb68359342a82f38?s=128&d=identicon&r=PG", "display_name": "user918176", "link": "https://stackoverflow.com/users/918176/user918176"}, "is_accepted": true, "score": 3, "last_activity_date": 1430653097, "creation_date": 1430653097, "answer_id": 30013378, "question_id": 29800079, "link": "https://stackoverflow.com/questions/29800079/stringer-tool-complains-about-wrong-archive-header/30013378#30013378", "title": "Stringer tool complains about wrong archive header", "body": "<p>What I can see from the spec for openSUSE's packaging they are disabling reinstallation of the standard library at updates. <em>__.PKGDEF</em> is a Go specific informational section, and some linker OpenSUSE has used has simply produced incompatible output. </p>\n\n<p>There's nothing you can do except install a healthy Go from the official source.</p>\n"}], "owner": {"reputation": 1695, "user_id": 617556, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6136180203540c5248e37d1124ac7999?s=128&d=identicon&r=PG", "display_name": "Paperback Writer", "link": "https://stackoverflow.com/users/617556/paperback-writer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 317, "favorite_count": 0, "accepted_answer_id": 30013378, "answer_count": 1, "score": 4, "last_activity_date": 1430653097, "creation_date": 1429711477, "question_id": 29800079, "link": "https://stackoverflow.com/questions/29800079/stringer-tool-complains-about-wrong-archive-header", "title": "Stringer tool complains about wrong archive header", "body": "<p>I am trying to use go generate/stringer (<code>golang.org/x/tools/cmd/stringer</code>) to generate String() methods on enums. I have problems, which I believe, are because of slightly different format of .a packages on different systems. I have this file:</p>\n\n<pre><code>package main\n\nimport (\n    \"math/rand\"\n)\n\n//go:generate stringer -type=Foo\ntype Foo int;\n\nconst (\n    FooPrime Foo = iota\n    FooBis\n)\n\nfunc main() {\n    //Just use rand anywhere, otherwise we get a compiler error\n    rand.Seed(1)\n}\n</code></pre>\n\n<p>Now if I run go generate example.go on my machine everything is all right: foo_string.go is created. However, on a test machine I get:</p>\n\n<pre><code>stringer: checking package: example.go:4:2: could not import math/rand (reading export data: /usr/lib64/go/pkg/linux_amd64/math/rand.a: go archive is missing __.PKGDEF)\n</code></pre>\n\n<p>Now, after some digging in the code I think that I get this error, because on my machine rand.a has the following header:</p>\n\n<pre><code>!&lt;arch&gt;\n__.PKGDEF       0           0     0     644     2051   \n</code></pre>\n\n<p>`\nwhile on test machine it has the following header:</p>\n\n<pre><code>!&lt;arch&gt;\n__.PKGDEF/      0           399   399   100644  2051  \n\n`\n</code></pre>\n\n<p>I think that the crucial difference is slash after PKGDEFF. gcimporter refuses to process .a file, if it doesn't have __.PKGDEF header.</p>\n\n<p>To check this, I edited manually gcimporter/exportdata.go and changed one of the line from this:</p>\n\n<pre><code>if name != \"__.PKGDEF\"\n</code></pre>\n\n<p>to this:</p>\n\n<pre><code>if name != \"__.PKGDEF\" &amp;&amp; name != \"__.PKGDEF\\\"\n</code></pre>\n\n<p>After this change (and compiling and installing everything) I was able to run go generate on example.go.</p>\n\n<p>My questions are: why do I get this problem and how do I get rid of it (other then manually editing external library)? </p>\n"}, {"tags": ["go", "printf"], "answers": [{"comments": [{"owner": {"reputation": 5911, "user_id": 1870054, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/QJydN.jpg?s=128&g=1", "display_name": "wener", "link": "https://stackoverflow.com/users/1870054/wener"}, "edited": false, "score": 0, "creation_date": 1429713451, "post_id": 29800348, "comment_id": 47729910, "body": "Thanks, I noticed, this is different to c&#39;s printf"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 5911, "user_id": 1870054, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/QJydN.jpg?s=128&g=1", "display_name": "wener", "link": "https://stackoverflow.com/users/1870054/wener"}, "edited": false, "score": 0, "creation_date": 1429722477, "post_id": 29800348, "comment_id": 47736592, "body": "@wener, this is <i>not</i> different to C&#39;s printf; it&#39;s exactly the same. (The only difference is if you have multi-byte runes)."}], "tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": true, "score": 4, "last_activity_date": 1429713638, "last_edit_date": 1592644375, "creation_date": 1429712067, "answer_id": 29800348, "question_id": 29799968, "link": "https://stackoverflow.com/questions/29799968/golang-printf-float-no-leading-zero/29800348#29800348", "title": "golang printf float no leading zero", "body": "<p>The reason is that you set 6 as the precision of the string that will be printed and only 3 as the width. From the <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\">fmt package.</a></p>\n<blockquote>\n<p>Width is specified by an optional decimal number immediately following\nthe verb. If absent, the width is whatever is necessary to represent\nthe value. Precision is specified after the (optional) width by a\nperiod followed by a decimal number. If no period is present, a\ndefault precision is used.</p>\n<p>...</p>\n<p>0 pad with leading zeros rather than spaces;<br />\nfor numbers, this moves the padding after the sign</p>\n</blockquote>\n<p>Thus you get 1.234000. To get leading 0s you need to increase the width of the string past 8 (length of 1 + . + 234000). So with <code>%09.6f</code> you'll get <code>01.234000</code></p>\n"}], "owner": {"reputation": 5911, "user_id": 1870054, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/QJydN.jpg?s=128&g=1", "display_name": "wener", "link": "https://stackoverflow.com/users/1870054/wener"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4461, "favorite_count": 0, "accepted_answer_id": 29800348, "answer_count": 1, "score": 4, "last_activity_date": 1487301473, "creation_date": 1429711266, "last_edit_date": 1487301473, "question_id": 29799968, "link": "https://stackoverflow.com/questions/29799968/golang-printf-float-no-leading-zero", "title": "golang printf float no leading zero", "body": "<p><a href=\"http://play.golang.org/p/3mjFDTTOXG\" rel=\"nofollow noreferrer\">http://play.golang.org/p/3mjFDTTOXG</a></p>\n\n<p>printf int is ok, but with float, I got no leading zero.</p>\n\n<pre><code>fmt.Printf(\"%03.6f\\n\", 1.234)\n&gt;1.234000\n</code></pre>\n\n<p>Why this happen ?How to make the leading zero display ? </p>\n\n<p>golang v1.4.1</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>I figured it out </p>\n\n<pre><code>fmt.Printf(\"%010.6f\\n\", 1.234)\n</code></pre>\n\n<p>this is ok now.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>from <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/fmt/</a></p>\n\n<blockquote>\n  <p>Width and precision are measured in units of Unicode code points, that is, runes. (This differs from C's printf where the units are always measured in bytes.) Either or both of the flags may be replaced with the character '*', causing their values to be obtained from the next operand, which must be of type int.</p>\n</blockquote>\n"}, {"tags": ["concurrency", "go"], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1429710731, "post_id": 29799611, "comment_id": 47727504, "body": "The redigo package also has a <a href=\"http://godoc.org/github.com/garyburd/redigo/redis#Pool\" rel=\"nofollow noreferrer\"><code>redis.Pool</code></a> if that&#39;s one&#39;s preferred client lib."}, {"owner": {"reputation": 33, "user_id": 3683737, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8IYB8.jpg?s=128&g=1", "display_name": "charlesworth", "link": "https://stackoverflow.com/users/3683737/charlesworth"}, "edited": false, "score": 0, "creation_date": 1429715039, "post_id": 29799611, "comment_id": 47731254, "body": "@rightfold Thanks very much, this has made my day far easier :)"}], "tags": [], "owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "is_accepted": true, "score": 2, "last_activity_date": 1429711235, "last_edit_date": 1495539968, "creation_date": 1429710477, "answer_id": 29799611, "question_id": 29799517, "link": "https://stackoverflow.com/questions/29799517/goroutines-or-locks-for-concurrent-clients/29799611#29799611", "title": "Goroutines or locks for concurrent clients", "body": "<p>If you have only one client, and only simple operations to perform on it, use a mutex. It's typically simple and easy to understand, unlike a goroutine with a bunch of channels and a select statement. Be sure to encapsulate the thread-safety in order not to burden the API user with locks.</p>\n\n<p>Compare:</p>\n\n<pre><code>var (\n    mutex sync.Mutex\n    resource = 0\n)\n\nfunc Inc() int {\n    mutex.Lock()\n    defer mutex.Unlock()\n    resource++\n    return resource\n}\n</code></pre>\n\n<p>With:</p>\n\n<pre><code>var requests = make(chan chan int)\n\nfunc init() {\n    go func() {\n        resource := 0\n        for {\n            response := &lt;- requests\n            resource++\n            response &lt;- resource\n        }\n    }()\n}\n\nfunc Inc() int {\n    response := make(chan int)\n    requests &lt;- response\n    return &lt;-response\n}\n</code></pre>\n\n<p>The former is clearly more concise and maintainable. And especially if the resource isn't global, the channel approach also requires manual management of goroutines since goroutines aren't garbage-collected (see <a href=\"https://stackoverflow.com/questions/6807590/how-to-stop-a-goroutine\">how to stop a goroutine</a>).</p>\n\n<hr>\n\n<p>If you don't mind having more than one client, use a pool of clients. go-redis supports pooling out of the box. The pool itself is thread-safe and can be used to acquire one of the idle connections.</p>\n"}], "owner": {"reputation": 33, "user_id": 3683737, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8IYB8.jpg?s=128&g=1", "display_name": "charlesworth", "link": "https://stackoverflow.com/users/3683737/charlesworth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 655, "favorite_count": 1, "accepted_answer_id": 29799611, "answer_count": 1, "score": 3, "last_activity_date": 1429711235, "creation_date": 1429710277, "last_edit_date": 1429710646, "question_id": 29799517, "link": "https://stackoverflow.com/questions/29799517/goroutines-or-locks-for-concurrent-clients", "title": "Goroutines or locks for concurrent clients", "body": "<p>Often when writing concurrent programs with multiple goroutines, those goroutines require access to a client, for instance writing a REST API where each HTTP handler needs to use a single initialized Redis client to read and write to the Redis instance.</p>\n\n<p>I either have a client instance with a mutex lock so only one goroutine can use it at any one time OR have a client goroutine which the other goroutines can request a read via a channel. Both ways work but I am wondering which is more idiomatic? Thanks for your help</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "answers": [{"comments": [{"owner": {"reputation": 10946, "user_id": 1259261, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2a105607c3fd93df0d386c6d6a6b4aad?s=128&d=identicon&r=PG", "display_name": "Daniel Robinson", "link": "https://stackoverflow.com/users/1259261/daniel-robinson"}, "edited": false, "score": 0, "creation_date": 1429990982, "post_id": 29868493, "comment_id": 47864758, "body": "hmm that is interesting, I never considered it as being per request only, even though a goon is instantiated off of a request. I thought it was instantiated once, and then you used the same goon object for every request to the server, I was intending on trying to use it that way anyway. but now you mention it, that doesn&#39;t seem to be a very sensible idea after all."}], "tags": [], "owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "is_accepted": true, "score": 1, "last_activity_date": 1429984036, "last_edit_date": 1429984036, "creation_date": 1429983217, "answer_id": 29868493, "question_id": 29792001, "link": "https://stackoverflow.com/questions/29792001/golang-appengine-goon-lib-local-memory-limits/29868493#29868493", "title": "golang appengine goon lib local memory limits", "body": "<p>The documentation of goon says the local cache is per-request, meaning that it will only accumulate data for the duration of the current request.</p>\n\n<p>Actually the local cache is part of a Goon object, which is supposed to be created from an appengine context, created from the request itself (see NewGoon and FromContext functions). The corresponding cached data can be garbage collected once the request has been processed.</p>\n\n<p>So nothing actually limits the memory that can be accumulated in the local cache, but in practice it is harmless, because a single request is not supposed to deal with a massive amount of data. The pathological case of a request looping while adding many records in the cache is possible though.</p>\n\n<p>One of the drawback of this approach is it tends to generate useless garbage if the cached data are not used. But it may simplify some code. For instance, the roundtrips generated by repetitive validations based on referential data can be optimized away without additional complexity.</p>\n\n<p>Note that if the local cache spanned over several requests, it would be difficult to define a proper cache invalidation strategy while still maintaining control on the data consistency.</p>\n"}], "owner": {"reputation": 10946, "user_id": 1259261, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2a105607c3fd93df0d386c6d6a6b4aad?s=128&d=identicon&r=PG", "display_name": "Daniel Robinson", "link": "https://stackoverflow.com/users/1259261/daniel-robinson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "accepted_answer_id": 29868493, "answer_count": 1, "score": 2, "last_activity_date": 1475280686, "creation_date": 1429691859, "last_edit_date": 1475280686, "question_id": 29792001, "link": "https://stackoverflow.com/questions/29792001/golang-appengine-goon-lib-local-memory-limits", "title": "golang appengine goon lib local memory limits", "body": "<p>Are there any default limits on the <a href=\"https://github.com/mjibson/goon/\" rel=\"nofollow\">goon</a> local memory cache, so it won't fill up the memory and cause some sort of our of memory exception? I can see there's a public <a href=\"https://github.com/mjibson/goon/blob/master/goon.go#L313\" rel=\"nofollow\">FlushLocalCache</a> method but I don't see it being used anywhere within the library. If the lib doesn't auto take care of clearing out the local memory cache, what would be a good schema to use to ensure you don't over use your memory size?</p>\n"}, {"tags": ["go", "floating-point-conversion"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1429691497, "post_id": 29789610, "comment_id": 47712458, "body": "I&#39;d take go&#39;s floating point code for 32 bit and write a custom algorithm. have a look at <code>runtime&#47;softfloat64.go</code> in the go source tree (1.4)"}, {"owner": {"reputation": 2842, "user_id": 648741, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/47813cc59b0edb414b88601f1defe02a?s=128&d=identicon&r=PG", "display_name": "jochen", "link": "https://stackoverflow.com/users/648741/jochen"}, "edited": false, "score": 0, "creation_date": 1429693262, "post_id": 29789610, "comment_id": 47713729, "body": "The description says &quot;mantissa of 4096 (12th bit is assumed to be 1)&quot;.  Is this really right: since there are 11 explicit bits, I guess that &quot;12th bit&quot; is referring to &quot;0000 1000 0000 0000&quot; (right-most bit is number 1), which is 2048.  Where does the 4096 come from?"}], "answers": [{"tags": [], "owner": {"reputation": 2842, "user_id": 648741, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/47813cc59b0edb414b88601f1defe02a?s=128&d=identicon&r=PG", "display_name": "jochen", "link": "https://stackoverflow.com/users/648741/jochen"}, "is_accepted": false, "score": 2, "last_activity_date": 1429693563, "creation_date": 1429693563, "answer_id": 29792676, "question_id": 29789610, "link": "https://stackoverflow.com/questions/29789610/go-encoding-unsigned-16-bit-float-in-binary/29792676#29792676", "title": "go - encoding unsigned 16 bit float in binary", "body": "<p>I am not sure whether I understand the encoding correctly (see my comment on the original question), but here is a function which may do what you want:</p>\n\n<pre><code>func EncodeFloat(seconds float64) uint16 {\n    us := math.Floor(1e6*seconds + 0.5)\n    if us &lt; 0 {\n        panic(\"cannot encode negative value\")\n    } else if us &gt; (1&lt;&lt;30)*4095+0.5 {\n        return 0xffff\n    }\n    usInt := uint64(us)\n    expBits := uint16(0)\n    if usInt &gt;= 2048 {\n        exp := uint16(1)\n        for usInt &gt;= 4096 {\n            exp++\n            usInt &gt;&gt;= 1\n        }\n        usInt -= 2048\n        expBits = exp &lt;&lt; 11\n    }\n    return expBits | uint16(usInt)\n}\n</code></pre>\n\n<p>(code is at <a href=\"http://play.golang.org/p/G599VOBMcL\" rel=\"nofollow\">http://play.golang.org/p/G599VOBMcL</a> )</p>\n"}], "owner": {"reputation": 86, "user_id": 4722305, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-P-6_rOryewY/AAAAAAAAAAI/AAAAAAAAAGw/RRnQe7CyVig/photo.jpg?sz=128", "display_name": "Tristan Rice", "link": "https://stackoverflow.com/users/4722305/tristan-rice"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 617, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1429693563, "creation_date": 1429684698, "last_edit_date": 1495542497, "question_id": 29789610, "link": "https://stackoverflow.com/questions/29789610/go-encoding-unsigned-16-bit-float-in-binary", "title": "go - encoding unsigned 16 bit float in binary", "body": "<p>In Go, how can I encode a float into a byte array as a 16 bit unsigned float with 11 explicit bits of mantissa and 5 bits of explicit exponent?</p>\n\n<p>There doesn't seem to be a clean way to do it. The only thing I can think of is encoding it as in <a href=\"https://stackoverflow.com/questions/22491876/convert-byte-array-uint8-to-float64-in-golang\">Convert byte array &quot;[]uint8&quot; to float64 in GoLang</a> and manually truncating the bits.</p>\n\n<p>Is there a \"go\" way to do this?</p>\n\n<p>Here's the exact definition:</p>\n\n<blockquote>\n  <p>A 16 bit unsigned float with 11 explicit bits of mantissa and 5 bits of explicit exponent</p>\n  \n  <p>The bit format is loosely modeled after IEEE 754. For example, 1 microsecond is represented as 0x1, which has an exponent of zero, presented in the 5 high order bits, and mantissa of 1, presented in the 11 low order bits.  When the explicit exponent is greater than zero, an implicit high-order 12th bit of 1 is assumed in the mantissa.  For example, a floatingvalue of 0x800 has an explicit exponent of 1, as well as an explicit mantissa of 0, but then has an effective mantissa of 4096 (12th bit is assumed to be 1).  Additionally, the actual exponent is one-less than the explicit exponent, and the value represents 4096 microseconds. Any values larger than the representable range are clamped to 0xFFFF.</p>\n</blockquote>\n"}, {"tags": ["java", "go", "try-catch-finally"], "comments": [{"owner": {"reputation": 481, "user_id": 3623056, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/d12778b73dfe65165c66f2e88ce1c3bf?s=128&d=identicon&r=PG&f=1", "display_name": "mbsingh", "link": "https://stackoverflow.com/users/3623056/mbsingh"}, "edited": false, "score": 0, "creation_date": 1429680177, "post_id": 29788307, "comment_id": 47706030, "body": "Are you looking to perform cleanup?"}, {"owner": {"reputation": 35205, "user_id": 2891664, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9df9d7af70d46f8db2ecd4392bb76087?s=128&d=identicon&r=PG&f=1", "display_name": "Radiodef", "link": "https://stackoverflow.com/users/2891664/radiodef"}, "edited": false, "score": 0, "creation_date": 1429680182, "post_id": 29788307, "comment_id": 47706032, "body": "What&#39;s wrong with <code>finally</code>?"}, {"owner": {"reputation": 95, "user_id": 3114701, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000990560261/picture?type=large", "display_name": "Romeo", "link": "https://stackoverflow.com/users/3114701/romeo"}, "edited": false, "score": 0, "creation_date": 1429687080, "post_id": 29788307, "comment_id": 47709629, "body": "yeah clean-up like closing connection and to free memory.."}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 4, "creation_date": 1429692814, "post_id": 29788307, "comment_id": 47713348, "body": "There&#39;s no direct translation, and how you write go isn&#39;t how you write java."}], "answers": [{"tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": true, "score": 9, "last_activity_date": 1436923056, "last_edit_date": 1436923056, "creation_date": 1429680296, "answer_id": 29788438, "question_id": 29788307, "link": "https://stackoverflow.com/questions/29788307/what-is-the-defer-equivalent-for-java/29788438#29788438", "title": "What is the &#39;defer&#39; equivalent for Java", "body": "<p>Java 7 has a <a href=\"https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html\" rel=\"noreferrer\">try-with-resources statement</a>.</p>\n\n<blockquote>\n  <p>The try-with-resources statement is a try statement that declares one or more resources. A resource is an object that must be closed after the program is finished with it. The try-with-resources statement ensures that each resource is closed at the end of the statement. Any object that implements java.lang.AutoCloseable, which includes all objects which implement java.io.Closeable, can be used as a resource.</p>\n  \n  <p>The following example reads the first line from a file. It uses an\n  instance of BufferedReader to read data from the file. BufferedReader\n  is a resource that must be closed after the program is finished with\n  it:</p>\n\n<pre><code>static String readFirstLineFromFile(String path) throws IOException {\n    try (BufferedReader br = new BufferedReader(new FileReader(path))) {\n        return br.readLine();\n    }\n}\n</code></pre>\n  \n  <p>In this example, the resource declared in the try-with-resources\n  statement is a BufferedReader. The declaration statement appears\n  within parentheses immediately after the try keyword. The class\n  BufferedReader, in Java SE 7 and later, implements the interface\n  java.lang.AutoCloseable. Because the BufferedReader instance is\n  declared in a try-with-resource statement, it will be closed\n  regardless of whether the try statement completes normally or abruptly\n  (as a result of the method BufferedReader.readLine throwing an\n  IOException).</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 1353, "user_id": 1996296, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a27cc1729d2e914c1088f462743aafa4?s=128&d=identicon&r=PG", "display_name": "igreenfield", "link": "https://stackoverflow.com/users/1996296/igreenfield"}, "is_accepted": false, "score": 4, "last_activity_date": 1429690861, "last_edit_date": 1429690861, "creation_date": 1429680421, "answer_id": 29788462, "question_id": 29788307, "link": "https://stackoverflow.com/questions/29788307/what-is-the-defer-equivalent-for-java/29788462#29788462", "title": "What is the &#39;defer&#39; equivalent for Java", "body": "<p>In java 7 and above you can use try-with-resource:</p>\n\n<pre><code>public static String readFirstLineFromFile(String path) throws IOException {\n  try (BufferedReader br = new BufferedReader(new FileReader(path))) {\n     return br.readLine();\n  }\n}\n</code></pre>\n\n<p>when you exit the try it will close the resource\ndocs: <a href=\"https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html\" rel=\"nofollow\">link</a></p>\n"}], "owner": {"reputation": 95, "user_id": 3114701, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000990560261/picture?type=large", "display_name": "Romeo", "link": "https://stackoverflow.com/users/3114701/romeo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5625, "favorite_count": 0, "accepted_answer_id": 29788438, "answer_count": 2, "score": 8, "last_activity_date": 1436923056, "creation_date": 1429679805, "last_edit_date": 1436923028, "question_id": 29788307, "link": "https://stackoverflow.com/questions/29788307/what-is-the-defer-equivalent-for-java", "title": "What is the &#39;defer&#39; equivalent for Java", "body": "<p>This is just a short example of Go code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    defer fmt.Println(\"world\") //use of keyword 'defer'\n\n    fmt.Println(\"hello\")\n}\n</code></pre>\n\n<p>I am finding an equivalent of 'defer' in Java.</p>\n\n<p>Instead of 'defer' I can use</p>\n\n<pre><code>try {\n    //do something\n} finally {\n    //code using defer\n}\n</code></pre>\n\n<p>Is there any alternative without using try/catch/finally?</p>\n"}, {"tags": ["go", "integer-overflow"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1429677501, "last_edit_date": 1429677501, "creation_date": 1429676458, "answer_id": 29787708, "question_id": 29787422, "link": "https://stackoverflow.com/questions/29787422/whats-wrong-with-golang-constant-overflows-uint64/29787708#29787708", "title": "what&#39;s wrong with golang constant overflows uint64", "body": "<blockquote>\n  <p><a href=\"http://golang.org/ref/spec\" rel=\"nofollow\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"http://golang.org/ref/spec#Constants\" rel=\"nofollow\">Constants</a></p>\n  \n  <p>Numeric constants represent values of arbitrary precision and do not\n  overflow.</p>\n  \n  <p>Constants may be typed or untyped.</p>\n  \n  <p>A constant may be given a type explicitly by a constant declaration or\n  conversion, or implicitly when used in a variable declaration or an\n  assignment or as an operand in an expression. It is an error if the\n  constant value cannot be represented as a value of the respective\n  type.</p>\n  \n  <p>An untyped constant has a default type which is the type to which the\n  constant is implicitly converted in contexts where a typed value is\n  required, for instance, in a short variable declaration such as i := 0\n  where there is no explicit type. The default type of an untyped\n  constant is bool, rune, int, float64, complex128 or string\n  respectively, depending on whether it is a boolean, rune, integer,\n  floating-point, complex, or string constant.</p>\n  \n  <p><a href=\"http://golang.org/ref/spec#Numeric_types\" rel=\"nofollow\">Numeric types</a></p>\n  \n  <p><code>int</code> is an implementation-specific size, either 32 or 64 bits.</p>\n</blockquote>\n\n<p><code>userid</code> is of type <code>int</code>. For example, </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    userid := 12345\n    did := uint64(userid) &amp; ^uint64(0xFFFF&lt;&lt;48)\n    fmt.Println(userid, did)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>12345 12345\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": true, "score": 10, "last_activity_date": 1429677373, "creation_date": 1429677373, "answer_id": 29787847, "question_id": 29787422, "link": "https://stackoverflow.com/questions/29787422/whats-wrong-with-golang-constant-overflows-uint64/29787847#29787847", "title": "what&#39;s wrong with golang constant overflows uint64", "body": "<p><code>^(0xFFFF &lt;&lt; 48)</code> is an untyped constant, which in go is an arbitrarily large value.</p>\n\n<p><code>0xffff &lt;&lt; 48</code> is <code>0xffff000000000000</code>. When you negate it, you get <code>-0xffff000000000001</code> (since with two's complement, -x = ^x + 1, or ^x = -(x + 1)).</p>\n\n<p>When you write <code>userid := 12345</code>, <code>userid</code> gets the type <code>int</code>. Then when you try to and (<code>&amp;</code>) it with the untyped constant <code>-0xffff000000000001</code> the compiler figures that this constant needs to be an <code>int</code>. At this point, the compiler complains because the value is too large in magnitude to be an <code>int</code>.</p>\n\n<p>If you're trying to get the constant <code>0x0000ffffffffffff</code>, then you can use <code>1&lt;&lt;48 - 1</code>, which (if you've got 64-bit ints), will fit. Since your code will never work if <code>int</code> is 32-bits, then you should probably use <code>int64</code> in your code rather than <code>int</code> to make it portable.</p>\n\n<p>The blog post <a href=\"https://blog.golang.org/constants\" rel=\"noreferrer\">https://blog.golang.org/constants</a> explains how constants work, and some background on why they are the way they are.</p>\n"}], "owner": {"reputation": 45, "user_id": 4817516, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YpDG4.png?s=128&g=1", "display_name": "Jone Zhang", "link": "https://stackoverflow.com/users/4817516/jone-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6133, "favorite_count": 1, "accepted_answer_id": 29787847, "answer_count": 2, "score": 2, "last_activity_date": 1436923083, "creation_date": 1429674713, "last_edit_date": 1436923083, "question_id": 29787422, "link": "https://stackoverflow.com/questions/29787422/whats-wrong-with-golang-constant-overflows-uint64", "title": "what&#39;s wrong with golang constant overflows uint64", "body": "<pre><code>userid := 12345\ndid := (userid &amp; ^(0xFFFF &lt;&lt; 48))\n</code></pre>\n\n<p>when compiling this code, I got:</p>\n\n<blockquote>\n  <p><code>./xxxx.go:511: constant -18446462598732840961 overflows int</code></p>\n</blockquote>\n\n<p>Do you know what is the matter with this and how to solve it ?\nThanks.</p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1429688215, "post_id": 29785752, "comment_id": 47710398, "body": "try to create an app folder and move app.yaml and main.go   this is how i used to work with app engine and go"}], "answers": [{"comments": [{"owner": {"reputation": 971, "user_id": 2597718, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/451afe490759d58b0f61b2dd5b47ff8a?s=128&d=identicon&r=PG", "display_name": "Shouichi", "link": "https://stackoverflow.com/users/2597718/shouichi"}, "edited": false, "score": 0, "creation_date": 1429757030, "post_id": 29800541, "comment_id": 47753165, "body": "The problem is that putting the project inside the GOPATH and import handler with a fully qualified name causes the import conflict. The error message is <code>go-app-builder: Failed parsing input: app file handler.go conflicts with same file imported from GOPATH</code>."}, {"owner": {"reputation": 27885, "user_id": 187676, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61a0f26f59f608dcde6bf8bfdd3e421e?s=128&d=identicon&r=PG", "display_name": "Erik Aigner", "link": "https://stackoverflow.com/users/187676/erik-aigner"}, "edited": false, "score": 0, "creation_date": 1432793145, "post_id": 29800541, "comment_id": 49073528, "body": "This does not work, still complains with <code>cannot find package &quot;myproject&#47;x&quot; in any of...</code>"}, {"owner": {"reputation": 5808, "user_id": 659590, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gacpu.jpg?s=128&g=1", "display_name": "Zikes", "link": "https://stackoverflow.com/users/659590/zikes"}, "edited": false, "score": 0, "creation_date": 1432821027, "post_id": 29800541, "comment_id": 49092458, "body": "Make sure the <code>x.go</code> file has <code>package x</code> rather than <code>package main</code>."}, {"owner": {"reputation": 3365, "user_id": 1569204, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/bd0db7459f9940095b1518fa7ec32a72?s=128&d=identicon&r=PG", "display_name": "Bruce Adams", "link": "https://stackoverflow.com/users/1569204/bruce-adams"}, "edited": false, "score": 0, "creation_date": 1573148125, "post_id": 29800541, "comment_id": 103796243, "body": "go doc for the package will tell you the import path to use for it - see <a href=\"https://stackoverflow.com/a/58754175/1569204\">stackoverflow.com/a/58754175/1569204</a>"}], "tags": [], "owner": {"reputation": 5808, "user_id": 659590, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gacpu.jpg?s=128&g=1", "display_name": "Zikes", "link": "https://stackoverflow.com/users/659590/zikes"}, "is_accepted": false, "score": 1, "last_activity_date": 1429712472, "creation_date": 1429712472, "answer_id": 29800541, "question_id": 29785752, "link": "https://stackoverflow.com/questions/29785752/good-way-to-use-and-test-local-packages-in-google-app-engine-apps-written-in-gol/29800541#29800541", "title": "Good way to use and test local packages in Google App Engine apps written in golang?", "body": "<p>You need to import handler with a fully qualified name, however you don't need to move it out of the project to do so.  If your project folder looks like this:</p>\n\n<pre><code>/go\n\u2514\u2500\u2500 /myproject\n    \u251c\u2500\u2500 app.yaml\n    \u251c\u2500\u2500 main.go\n    \u2514\u2500\u2500 /handler\n        \u2514\u2500\u2500 handler.go\n</code></pre>\n\n<p>Then your handler import should look like this:</p>\n\n<pre><code>import \"myproject/handler\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4111, "user_id": 1665544, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/534605444/picture?type=large", "display_name": "Su-Au Hwang", "link": "https://stackoverflow.com/users/1665544/su-au-hwang"}, "is_accepted": true, "score": 2, "last_activity_date": 1446563887, "creation_date": 1446563887, "answer_id": 33502698, "question_id": 29785752, "link": "https://stackoverflow.com/questions/29785752/good-way-to-use-and-test-local-packages-in-google-app-engine-apps-written-in-gol/33502698#33502698", "title": "Good way to use and test local packages in Google App Engine apps written in golang?", "body": "<p>This comes late, but if anyone runs into the same issue, here is how to deal with it:</p>\n\n<ol>\n<li><p>Organize your code this way</p>\n\n<pre><code>/whereever\n\u2514\u2500\u2500 /myproject\n    \u2514\u2500\u2500/src\n       \u251c\u2500\u2500 app.yaml\n       \u251c\u2500\u2500 main.go\n       \u2514\u2500\u2500 /handler\n           \u2514\u2500\u2500 handler.go\n</code></pre></li>\n<li><p>Use unqualified imports for your project code e.g.</p>\n\n<pre><code>import handler\n</code></pre></li>\n<li><p>Run <code>goapp serve</code> and <code>goapp deploy</code> from inside the src folder. serve/deploy work relative to the app.yaml</p>\n\n<pre><code>cd /whereever/myproject/src\ngoapp serve \n</code></pre></li>\n<li><p>Set GOPATH  for <code>goapp test</code> , it work based on GOPATH</p>\n\n<pre><code>cd /whereever/myproject    #GOPATH expects a subfolder called src\nGOPATH=$GOPATH:`pwd`       #add the current folder to the GOPATH\ngoapp test ./...           #run all tests in any subfolders\n</code></pre></li>\n<li><p>Reset your GOPATH if necessary</p>\n\n<pre><code>source ~/.profile #this assumes ~/.profile is where you have permanently set your GOPATH\n</code></pre></li>\n</ol>\n\n<p>All in all, \"working as intended\", but still a pain.</p>\n"}], "owner": {"reputation": 971, "user_id": 2597718, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/451afe490759d58b0f61b2dd5b47ff8a?s=128&d=identicon&r=PG", "display_name": "Shouichi", "link": "https://stackoverflow.com/users/2597718/shouichi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 652, "favorite_count": 5, "accepted_answer_id": 33502698, "answer_count": 2, "score": 3, "last_activity_date": 1446563887, "creation_date": 1429663572, "question_id": 29785752, "link": "https://stackoverflow.com/questions/29785752/good-way-to-use-and-test-local-packages-in-google-app-engine-apps-written-in-gol", "title": "Good way to use and test local packages in Google App Engine apps written in golang?", "body": "<p>I have a problem of testing my GAE golang app uses local packages.\nThe probject looks something like this.</p>\n\n<pre><code>.\n\u251c\u2500\u2500 app.yaml\n\u251c\u2500\u2500 main.go\n\u2514\u2500\u2500 handler\n    \u2514\u2500\u2500 handler.go\n</code></pre>\n\n<p><code>handler</code> package is imported in <code>main.go</code>.</p>\n\n<pre><code>package main\n\nimport \"handler\"\n</code></pre>\n\n<p>Everything (e.g., <code>goapp serve</code>) works fine until I started writing tests.\n<code>goapp test</code> complains that <code>handler</code> package is not found. Seems like <code>GOPATH</code>\nof <code>goapp serve</code> and <code>goapp test</code> are different. One solution I found is to put\n<code>handler</code> package outside of the project path and import it with fully\nqualified name (e.g., <code>github.com/.../handler</code>) but it doesn't make sense to me\nto split the project in to separate places where they're tightly coupled. Are\nthere any good way to use and test local packages?</p>\n\n<p>Following resources are found on this topic.</p>\n\n<ul>\n<li><a href=\"https://groups.google.com/forum/#!topic/google-appengine-go/C_i5kQEi7-A\" rel=\"nofollow\">https://groups.google.com/forum/#!topic/google-appengine-go/C_i5kQEi7-A</a></li>\n<li><a href=\"https://github.com/matthewbelisle-wf/gopath-problem\" rel=\"nofollow\">https://github.com/matthewbelisle-wf/gopath-problem</a></li>\n</ul>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 3, "creation_date": 1429652986, "post_id": 29783648, "comment_id": 47697404, "body": "first of all, don&#39;t ignore errors so you can tell if something goes wrong"}, {"owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "edited": false, "score": 0, "creation_date": 1429819565, "post_id": 29783648, "comment_id": 47793168, "body": "I would like to help, but I&#39;m not sure I understand the full context and why <code>strings.Replace()</code> is necessary.  Please explain."}], "answers": [{"comments": [{"owner": {"reputation": 419, "user_id": 3040335, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/43b74dafd9ea0333ba178676bac0eb07?s=128&d=identicon&r=PG&f=1", "display_name": "vvofdcx", "link": "https://stackoverflow.com/users/3040335/vvofdcx"}, "edited": false, "score": 0, "creation_date": 1429653776, "post_id": 29783811, "comment_id": 47697765, "body": "Thanks for your help! The way to replace &quot;\\n&quot; to &quot;&quot; somehow doesn&#39;t work, but the following way works: inDir = inDir[0:len(inDir)-2]   So it&#39;s definitely the problem with \\n. Thanks again!"}, {"owner": {"reputation": 106150, "user_id": 213464, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a7ba62044bc19143ea4a38cf490b67f2?s=128&d=identicon&r=PG", "display_name": "YOU", "link": "https://stackoverflow.com/users/213464/you"}, "edited": false, "score": 1, "creation_date": 1429784984, "post_id": 29783811, "comment_id": 47767700, "body": "it mean it was <code>\\r\\n</code>"}, {"owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "edited": false, "score": 0, "creation_date": 1429796611, "post_id": 29783811, "comment_id": 47776940, "body": "I don&#39;t understand why you must use strings.Replace"}, {"owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "reply_to_user": {"reputation": 106150, "user_id": 213464, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a7ba62044bc19143ea4a38cf490b67f2?s=128&d=identicon&r=PG", "display_name": "YOU", "link": "https://stackoverflow.com/users/213464/you"}, "edited": false, "score": 0, "creation_date": 1429820719, "post_id": 29783811, "comment_id": 47793869, "body": "Answer only provides memory location. Update @YOU edit and then try this at end: <code>for _, v := range files { fmt.Println(v) &#47;&#47; or v.Name() }</code>"}], "tags": [], "owner": {"reputation": 36, "user_id": 4816808, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VYqBG.jpg?s=128&g=1", "display_name": "AC1", "link": "https://stackoverflow.com/users/4816808/ac1"}, "is_accepted": true, "score": 2, "last_activity_date": 1429653091, "creation_date": 1429653091, "answer_id": 29783811, "question_id": 29783648, "link": "https://stackoverflow.com/questions/29783648/how-to-read-file-names-from-a-directory-specified-on-stdin-with-go/29783811#29783811", "title": "How to read file names from a directory specified on stdin with Go", "body": "<p>It isn't working because you must strip the \\n from the inDir variable, otherwise it tries to list the contents of \"dirprovided\\n\". Something like this might work:</p>\n\n<pre><code>func main() {\n    fmt.Print(\"directory: \")\n    inBuf := bufio.NewReader(os.Stdin)\n    inDir, _ := inBuf.ReadString('\\n')\n    inDir = strings.Replace(inDir, \"\\n\", \"\", -1)\n    files, _ := ioutil.ReadDir(inDir)\n    fmt.Println(files)\n}\n</code></pre>\n\n<p>Edit: also as mentioned above, printing the errors instead of dropping will help. That's all I did to figure this one out.</p>\n"}, {"comments": [{"owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "edited": false, "score": 0, "creation_date": 1429784795, "post_id": 29820586, "comment_id": 47767572, "body": "Of course, ignoring errors is not best practice.  Example here ignores errors for sake of brevity."}, {"owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "edited": false, "score": 0, "creation_date": 1429817689, "post_id": 29820586, "comment_id": 47792056, "body": "I am a big believer in feedback.  When someone down-votes an answer without providing a comment, then the person who originally posted the answer has no ability to reexamine their code or their interpretation of the original question.   Friends don&#39;t let friends down-vote without comments."}], "tags": [], "owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "is_accepted": false, "score": 0, "last_activity_date": 1429784582, "creation_date": 1429784582, "answer_id": 29820586, "question_id": 29783648, "link": "https://stackoverflow.com/questions/29783648/how-to-read-file-names-from-a-directory-specified-on-stdin-with-go/29820586#29820586", "title": "How to read file names from a directory specified on stdin with Go", "body": "<p>Suggested steps:</p>\n\n<ol>\n<li>Request directory from user using <strong>bufio</strong> library</li>\n<li>Determine absolute path based on common path abbreviations using <strong>os</strong> library</li>\n<li>Read directory contents using <strong>ioutil</strong> library</li>\n<li>Print absolute path; iterate through directory contents and print name of each item</li>\n</ol>\n\n<p><br></p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n)\n\nfunc main() {\n    // STEP ONE\n    scanner := bufio.NewScanner(os.Stdin)\n    fmt.Print(\"Choose a directory: \")\n    scanner.Scan()\n    dir := scanner.Text()\n\n\n    // STEP TWO\n    if dir[:1] == \"~\" {\n        dir = os.Getenv(\"HOME\") + dir[1:]\n    } else if dir[:1] != \"/\" {\n        pwd, _ := os.Getwd()\n        dir = pwd + \"/\" + dir\n    }\n\n    // STEP THREE\n    files, _ := ioutil.ReadDir(dir)\n\n    // STEP FOUR\n    fmt.Println(\"Directory: \", dir, \"\\n\")       \n    for _, f := range files {\n        fmt.Println(f.Name())\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 419, "user_id": 3040335, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/43b74dafd9ea0333ba178676bac0eb07?s=128&d=identicon&r=PG&f=1", "display_name": "vvofdcx", "link": "https://stackoverflow.com/users/3040335/vvofdcx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 859, "favorite_count": 0, "accepted_answer_id": 29783811, "answer_count": 2, "score": 0, "last_activity_date": 1436923106, "creation_date": 1429652518, "last_edit_date": 1436923106, "question_id": 29783648, "link": "https://stackoverflow.com/questions/29783648/how-to-read-file-names-from-a-directory-specified-on-stdin-with-go", "title": "How to read file names from a directory specified on stdin with Go", "body": "<p>I would like to read all files from a given directory, and I tried this:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"strings\"\n)\n\nfunc main() {\n    fmt.Print(\"directory: \")\n    inBuf := bufio.NewReader(os.Stdin)\n    inDir, _ := inBuf.ReadString('\\n')\n    strings.Replace(inDir, \"\\\\\", \"/\", -1)\n    files, _ := ioutil.ReadDir(inDir)\n    fmt.Println(files)\n}\n</code></pre>\n\n<p>This will always return \"[]\" with or without the \"strings.Replace\" line. Could anyone point out the problem with the code, or provide a easier way to accomplish this task? Thanks!</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 4863, "user_id": 2482582, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/yQkZE.jpg?s=128&g=1", "display_name": "Moebius", "link": "https://stackoverflow.com/users/2482582/moebius"}, "edited": false, "score": 0, "creation_date": 1429655195, "post_id": 29782791, "comment_id": 47698358, "body": "Thanks a lot. This is the answer I hoped not to have, but definitely thanks for taking the time to answer ^^"}], "tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": true, "score": 8, "last_activity_date": 1429654452, "last_edit_date": 1429654452, "creation_date": 1429649150, "answer_id": 29782791, "question_id": 29782549, "link": "https://stackoverflow.com/questions/29782549/move-main-out-of-the-repository-root-in-go/29782791#29782791", "title": "Move main out of the repository root in go", "body": "<blockquote>\n  <p>I want all the source code to go in a folder src, and all the test code in a folder named test :</p>\n</blockquote>\n\n<p>Go has a way that it organizes source code. Do not fight this. It is how the system works. Organize your code the way Go wants you to. Do not try to force Go to work the way you have learned working in some other language. Every language has its own ways of doing things. None of them are \"correct.\" Like Java, Go has very specific ideas of what you're supposed to do. Do it that way. (This isn't an argument about whether Go is \"right\" or Go is \"wrong.\" Go is Go, and it does things in the Go way.)</p>\n\n<p>In particular, you should not create another \"src\" directory. There is already a \"src\" directory at the top of the \"go\" tree. If you create another, redundant, \"src\" directory, then the package name for your project is \"github.com/user/my_project/src\" which is likely not what you want.</p>\n\n<p>To make the executable be named what you want, put it in a directory named what you want (probably \"my_project\"). Put test files with the files they test. This is how go works.</p>\n\n<p>So your tree should look like:</p>\n\n<pre><code>\\go\n  \\src\n    \\github.com\n      \\user\n        \\my_project\n          main.go\n          some_func.go\n          main_test.go\n          some_func_test.go\n          \\doc\n            README.md\n</code></pre>\n\n<p>Attempts to do something other than this is going to blow up over and over again, and questions of \"how do I make the build system do this other thing\" will continually return \"put your code in the way the build system expects.\"</p>\n\n<p>For details on what Go expects, and how you should organize your code, see <a href=\"http://golang.org/cmd/go/\" rel=\"nofollow noreferrer\">GOPATH environment variable</a> in the Command Go documentation. Once you've built your system this way for a while, you will start to see where you can deviate from it (like creating other directories for test utilities, but not test cases). Don't start deviating until you've tried it the standard Go way.</p>\n"}], "owner": {"reputation": 4863, "user_id": 2482582, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/yQkZE.jpg?s=128&g=1", "display_name": "Moebius", "link": "https://stackoverflow.com/users/2482582/moebius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 29782791, "answer_count": 1, "score": 0, "last_activity_date": 1429654452, "creation_date": 1429648298, "question_id": 29782549, "link": "https://stackoverflow.com/questions/29782549/move-main-out-of-the-repository-root-in-go", "title": "Move main out of the repository root in go", "body": "<p>I am creating a project in go. Since there is already a lot of things at the root of the repository of the project (doc, README.md...), I want all the source code to go in a folder src, and all the test code in a folder named test :</p>\n\n<pre><code>\\go\n  \\src\n    \\github.com\n      \\user\n        \\my_project\n          \\src\n            main.go\n            some_func.go\n          \\test\n            test_main.go\n            test_some_func.go\n          \\doc\n          README.md\n</code></pre>\n\n<p>But I have two issues :</p>\n\n<ul>\n<li>The build command is not working while I am in the my_project folder. I have to go in the my_project/src to successfully run build. I want to do it from the my_project folder. How to inforce go to understand that the source for my_project is in the src code ?</li>\n<li>Then the executable produced by the go install command is named src. How to change the name of that executable ?</li>\n</ul>\n"}, {"tags": ["go", "server", "x509certificate", "x509", "x509certificate2"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1429651611, "post_id": 29782109, "comment_id": 47696785, "body": "Have you actually tried using the <code>tls</code> package? Note that the Go library is expecting PEM encoded certificates and keys."}, {"owner": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 0, "creation_date": 1429702447, "post_id": 29782109, "comment_id": 47720536, "body": "try <a href=\"http://godoc.org/crypto/x509\" rel=\"nofollow noreferrer\">godoc.org/crypto/x509</a> ?"}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "reply_to_user": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 0, "creation_date": 1429703729, "post_id": 29782109, "comment_id": 47721536, "body": "@holys it&#39;s even easier than that: <a href=\"http://godoc.org/crypto/tls#Certificate\" rel=\"nofollow noreferrer\">godoc.org/crypto/tls#Certificate</a>"}], "owner": {"reputation": 21, "user_id": 4489767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8af88e39ea76701bb5ad923958e75b79?s=128&d=identicon&r=PG", "display_name": "win32", "link": "https://stackoverflow.com/users/4489767/win32"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 417, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1436923149, "creation_date": 1429646912, "last_edit_date": 1436923149, "question_id": 29782109, "link": "https://stackoverflow.com/questions/29782109/x509-server-authentication-in-tcp-server", "title": "X509 server authentication in TCP server", "body": "<p>I am using the following C# code:</p>\n\n<pre><code>netStream = new SslStream(client.GetStream(), false);\nvar cert = new X509Certificate2(\"mycert.pfx\", \"123456\");\nnetStream.AuthenticateAsServer(cert);\n</code></pre>\n\n<p>What would be the equivalent of X509 server authentication (if the server is using TCP protocol) in Golang?</p>\n\n<p>This is the Golang code I'm currently using:</p>\n\n<pre><code>func main() {\n    l, err := net.Listen(\"tcp\", \":42127\")\n    if err != nil {\n        fmt.Println(\"Error listening:\", err.Error())\n        os.Exit(1)\n    }\n\n    defer l.Close()\n\n    for {\n        conn, err := l.Accept()\n        if err != nil {\n            fmt.Println(\"Error accepting: \", err.Error())\n            os.Exit(1)\n        }\n\n        go handleRequest(conn)\n    }\n}\n\nfunc handleRequest(conn net.Conn) {\n    buf := make([]byte, 1024 * 8)\n\n    reqLen, err := conn.Read(buf)\n    if err != nil {\n        fmt.Println(\"Error reading:\", err.Error())\n    }\n\n    conn.Write([]byte(\"Message received.\"))\n    conn.Close()\n}\n</code></pre>\n"}, {"tags": ["go", "routes", "versioning"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1429638719, "post_id": 29779468, "comment_id": 47689302, "body": "If you&#39;re talking about an API over HTTP(S) then something like <code>http:&#47;&#47;example.com&#47;api&#47;v1&#47;\u2026</code> is common. Or are you more asking how to implement such a pattern in a Go server?"}, {"owner": {"reputation": 703, "user_id": 1765519, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/83bbd86d8107852b4b4ac417e452092b?s=128&d=identicon&r=PG", "display_name": "Avik", "link": "https://stackoverflow.com/users/1765519/avik"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1429639559, "post_id": 29779468, "comment_id": 47689884, "body": "I&#39;m asking how to go about it in a Go Server.  I&#39;ll explain further in my question."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1429640426, "post_id": 29779468, "comment_id": 47690407, "body": "1 and 2 are basically equivalent, you&#39;re just doing the routing yourself in the first. If gorilla/mux is too slow, don&#39;t use it (even the default HandleFunc is using a &quot;router&quot;: <code>http.ServeMux</code>). 3 has nothing to do with Go, it&#39;s just whether you want to make your clients use headers or not (which shouldn&#39;t be a big deal)"}, {"owner": {"reputation": 703, "user_id": 1765519, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/83bbd86d8107852b4b4ac417e452092b?s=128&d=identicon&r=PG", "display_name": "Avik", "link": "https://stackoverflow.com/users/1765519/avik"}, "edited": false, "score": 0, "creation_date": 1429640528, "post_id": 29779468, "comment_id": 47690453, "body": "Well,  3 has to do with Go because it clearly defines the possible routes in the class, rather than in the function implementation.  I.e. where do you see the list of supported apis.  I&#39;ll make that more clear in the example."}, {"owner": {"reputation": 1908, "user_id": 1269969, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3f07b9d9aa93f0d0750ea5f462db0fed?s=128&d=identicon&r=PG", "display_name": "placeybordeaux", "link": "https://stackoverflow.com/users/1269969/placeybordeaux"}, "edited": false, "score": 1, "creation_date": 1429640906, "post_id": 29779468, "comment_id": 47690677, "body": "Many routers will allow for grouping different routes. You might want to look into that."}, {"owner": {"reputation": 703, "user_id": 1765519, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/83bbd86d8107852b4b4ac417e452092b?s=128&d=identicon&r=PG", "display_name": "Avik", "link": "https://stackoverflow.com/users/1765519/avik"}, "reply_to_user": {"reputation": 1908, "user_id": 1269969, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3f07b9d9aa93f0d0750ea5f462db0fed?s=128&d=identicon&r=PG", "display_name": "placeybordeaux", "link": "https://stackoverflow.com/users/1269969/placeybordeaux"}, "edited": false, "score": 0, "creation_date": 1429641515, "post_id": 29779468, "comment_id": 47691060, "body": "@placeybordeaux  Thanks.  That led me to this:  <a href=\"http://stackoverflow.com/questions/25298646/how-can-i-create-separate-route-groups-with-different-middleware-in-goji-golang\" title=\"how can i create separate route groups with different middleware in goji golang\">stackoverflow.com/questions/25298646/&hellip;</a>   Might be the right direction.  Do you want to turn that into a full answer?  Need to go see if goji has benchmarks."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 3, "creation_date": 1429643102, "post_id": 29779468, "comment_id": 47691995, "body": "Don&#39;t freak out about router speed. At <a href=\"https://github.com/julienschmidt/go-http-routing-benchmark\" rel=\"nofollow noreferrer\">github.com/julienschmidt/go-http-routing-benchmark</a> you see timings (for the &quot;route a single request&quot; benchmarks) in the thousands of nanoseconds, as in microseconds, as in thousandths of milliseconds. That is so small a cost compared to, say, a database write that it&#39;s hard for me to even grasp it intuitively."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 2, "creation_date": 1429643314, "post_id": 29779468, "comment_id": 47692119, "body": "(To be clear, I do think echo is a neat achievement! Cool to see a nontrivial non-allocating component. But I don&#39;t want anyone to feel like they have to use it to end up with good API performance.)"}, {"owner": {"reputation": 703, "user_id": 1765519, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/83bbd86d8107852b4b4ac417e452092b?s=128&d=identicon&r=PG", "display_name": "Avik", "link": "https://stackoverflow.com/users/1765519/avik"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1429645273, "post_id": 29779468, "comment_id": 47693302, "body": "@twotwotwo I&#39;m going to be using redis as the database, so I need to make sure that the parsing of the url, isn&#39;t the bottleneck."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1429678886, "post_id": 29779468, "comment_id": 47705621, "body": "@Avik It absolutely won&#39;t be. Talking to Redis will be an order of magnitude (single digit to tens of milliseconds) slower than your routing. Even with more than 5,000 routes, your router won&#39;t even come close to that. Also note that Echo <i>does</i> allocate - it creates a pool. Using the pool (get/put) doesn&#39;t count towards benchmark allocation output."}, {"owner": {"reputation": 703, "user_id": 1765519, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/83bbd86d8107852b4b4ac417e452092b?s=128&d=identicon&r=PG", "display_name": "Avik", "link": "https://stackoverflow.com/users/1765519/avik"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1429687715, "post_id": 29779468, "comment_id": 47710058, "body": "@elithrar I&#39;m confused now.  Redis does about 72 requests per millisecond.     Echo is benchmarked at 4.5 milliseconds per variable based request?  Am I reading the numbers wrong?"}], "answers": [{"comments": [{"owner": {"reputation": 703, "user_id": 1765519, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/83bbd86d8107852b4b4ac417e452092b?s=128&d=identicon&r=PG", "display_name": "Avik", "link": "https://stackoverflow.com/users/1765519/avik"}, "edited": false, "score": 0, "creation_date": 1429644904, "post_id": 29780629, "comment_id": 47693080, "body": "Thanks. Now I just need to find the best library for my needs , but this seems to be the most common approach to versioning in Go.  The list of libraries that support grouping and that are fast seem almost endless!"}, {"owner": {"reputation": 703, "user_id": 1765519, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/83bbd86d8107852b4b4ac417e452092b?s=128&d=identicon&r=PG", "display_name": "Avik", "link": "https://stackoverflow.com/users/1765519/avik"}, "edited": false, "score": 0, "creation_date": 1430033794, "post_id": 29780629, "comment_id": 47874571, "body": "Hi, I&#39;ve been searching the net, and having a hard time understanding if ping is the same function, and if so, how I differentiate which group called it to return different results."}, {"owner": {"reputation": 1908, "user_id": 1269969, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3f07b9d9aa93f0d0750ea5f462db0fed?s=128&d=identicon&r=PG", "display_name": "placeybordeaux", "link": "https://stackoverflow.com/users/1269969/placeybordeaux"}, "reply_to_user": {"reputation": 703, "user_id": 1765519, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/83bbd86d8107852b4b4ac417e452092b?s=128&d=identicon&r=PG", "display_name": "Avik", "link": "https://stackoverflow.com/users/1765519/avik"}, "edited": false, "score": 0, "creation_date": 1430349907, "post_id": 29780629, "comment_id": 48033452, "body": "Ping is the same function. From the context of ping you could look up the URL that was given. I was assuming that you would call different functions for different versions."}], "tags": [], "owner": {"reputation": 1908, "user_id": 1269969, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3f07b9d9aa93f0d0750ea5f462db0fed?s=128&d=identicon&r=PG", "display_name": "placeybordeaux", "link": "https://stackoverflow.com/users/1269969/placeybordeaux"}, "is_accepted": true, "score": 7, "last_activity_date": 1429645923, "last_edit_date": 1429645923, "creation_date": 1429641875, "answer_id": 29780629, "question_id": 29779468, "link": "https://stackoverflow.com/questions/29779468/what-is-the-idiomatic-way-to-handle-api-versions/29780629#29780629", "title": "What is the idiomatic way to handle api versions", "body": "<p>There are many routing frameworks that allow for grouping, for instance with echo (a very good framework if you want speed)</p>\n\n<pre><code>package main\n\nimport \"github.com/labstack/echo\"\n\nfunc ping(c *echo.Context) {\n        c.String(200, \"pong\")\n}\n\nfunc main() {\n        e := echo.New()\n\n        v1 := e.Group(\"/v1\")\n        v1.Get(\"/ping\", ping)\n\n        v2 := e.Group(\"/v2\")\n        v2.Get(\"/ping\", ping)\n\n        e.Run(\":4444\")\n}\n</code></pre>\n\n<p>I think this is quite clean.</p>\n\n<p>I am sure many other frameworks allow for this. I know for a fact martini does, but that is not an idiomatic framework...</p>\n"}], "owner": {"reputation": 703, "user_id": 1765519, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/83bbd86d8107852b4b4ac417e452092b?s=128&d=identicon&r=PG", "display_name": "Avik", "link": "https://stackoverflow.com/users/1765519/avik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5547, "favorite_count": 7, "closed_date": 1602786706, "accepted_answer_id": 29780629, "answer_count": 1, "score": 6, "last_activity_date": 1602745701, "creation_date": 1429638107, "last_edit_date": 1602745701, "question_id": 29779468, "link": "https://stackoverflow.com/questions/29779468/what-is-the-idiomatic-way-to-handle-api-versions", "closed_reason": "Opinion-based", "title": "What is the idiomatic way to handle api versions", "body": "<p>I'm creating a server in Go intended for a mobile app.  I need to be able to support multiple versions of the API for cases were users don't update the app. The main concern with the versioning, is to return data in the correct format for the version of the mobile app.</p>\n<p>I've seen that there are three basic ways to do this.<br />\nA.  One way is by having one route handler on &quot;/&quot;, and then allowing that function to parse the url for versioning.<br />\nExample:</p>\n<pre><code>func main() {\nhttp.HandleFunc(&quot;/&quot;, routes.ParseFullURI)\n}\n</code></pre>\n<p>B. Use a library such as gorilla/mux to handle patterns within the router, but I saw some <a href=\"http://www.alexedwards.net/blog/a-mux-showdown#benchmarks\" rel=\"nofollow noreferrer\">warnings that this can be too slow</a>.<br />\nExample:</p>\n<pre><code>  func main() {\n            mux.HandleFunc(&quot;{version:}/&quot;, routes.ParseVersionForHome)\n            mux.HandleFunc(&quot;{version:}/getData&quot;, routes.ParseVersionForGetDAta)\n            mux.HandleFunc(&quot;{version:}/otherCall&quot;, routes.ParseVersionForOtherCall)\n            }\n</code></pre>\n<p>C. Have individual urls that don't change, but based on the header, split into different versions.\nExample:</p>\n<pre><code>func main() {\n   http.HandleFunc(&quot;/&quot;, routes.ParseHeaderForVersionForHome)\n   http.HandleFunc(&quot;/getData&quot;, routes.ParseHeaderForVersionForGetData)\n   http.HandleFunc(&quot;/otherCall&quot;, routes.ParseHeaderForVersionForOtherCall)\n}\n</code></pre>\n<p>I'm concerned that option 1 will be too messy code wise.  I'm concerned that option 2 will be too slow performance wise, and I'm concerned that option 3 will be difficult for the client to handle, or will get confusing since the version isn't clearly labeled.</p>\n<p>Which method is the most idiomatic for Go, and will result in the greatest performance for a mobile app which will be polling often?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1429637987, "post_id": 29778778, "comment_id": 47688843, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/14867452/what-is-a-sensible-way-to-layout-a-go-project\">What is a sensible way to layout a Go project</a>"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1429638055, "post_id": 29778778, "comment_id": 47688883, "body": "In general - if it&#39;s just a small app, keep everything in one package. once you separate your server into a different package, you&#39;ll need to move common functions to a 3rd package to avoid cyclic imports."}, {"owner": {"reputation": 617, "user_id": 1938600, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5892288702862ce1bf3fe2ae54745e72?s=128&d=identicon&r=PG", "display_name": "marcantonio", "link": "https://stackoverflow.com/users/1938600/marcantonio"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1429638379, "post_id": 29778778, "comment_id": 47689093, "body": "Yeah, that&#39;s what I&#39;m finding.  I moved <code>common</code> into a separate package.  This solves the problem but doesn&#39;t <i>feel</i> right."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1429638423, "post_id": 29778778, "comment_id": 47689120, "body": "Also note that <a href=\"https://blog.golang.org/package-names\" rel=\"nofollow noreferrer\">idiomatic naming</a> would be different for things in <code>server.go</code> depending on if it was in <code>main</code> or a <code>server</code> package. In former <code>type Server \u2026</code> is fine whereas in the later it means stuttering with <code>server.Server</code> whenever used. E.g. the <code>errors</code> package has a <code>New</code> function called as <code>errors.New</code> whereas if you put something like that locally in your own package you&#39;d call it something like <code>NewError</code> or somesuch."}], "answers": [{"comments": [{"owner": {"reputation": 617, "user_id": 1938600, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5892288702862ce1bf3fe2ae54745e72?s=128&d=identicon&r=PG", "display_name": "marcantonio", "link": "https://stackoverflow.com/users/1938600/marcantonio"}, "edited": false, "score": 0, "creation_date": 1429640336, "post_id": 29779605, "comment_id": 47690349, "body": "I think this is probably the best way.  I just feels a little clunky.  I really just wanted to be sure I wasn&#39;t missing something obvious to others.  I agree with your different approaches depending on the intent of the package.  Thanks!"}], "tags": [], "owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "is_accepted": true, "score": 2, "last_activity_date": 1429638511, "creation_date": 1429638511, "answer_id": 29779605, "question_id": 29778778, "link": "https://stackoverflow.com/questions/29778778/idiomatic-go-code-organization/29779605#29779605", "title": "Idiomatic Go Code Organization", "body": "<p>I think it's fair assumption you'd like to use some common methods across your projects. The same way you separate the server, you should then separate the package with the common methods. Although it's probably better to think and organise it in some logical way, rather than calling the package <code>tools</code>, <code>misc</code> etc.</p>\n\n<p>I tend to split things into packages, so they can be used in other places, while the main package would be simply flag parsing and calling the library methods, for example <code>server.Run()</code>. Other people like to put everything into the main project, which might be all right if you think people would use your project as a command line tool, rather than a package.</p>\n\n<p>I would consider:</p>\n\n<pre><code>deamon/\n    main.go\n    server/server.go\n    somelib/somelib.go -- to be included from main and server\n</code></pre>\n\n<p>If you would like your project to be used mainly as a package, but still include some command line utility, you might consider:</p>\n\n<pre><code>deamon/\n   deamon.go -- package deamon\n   deamond/\n       main.go -- you may include the top level package as anyone else\n</code></pre>\n\n<p>We need to remember that in Go you include your packages with an absolute path, so you can keep your \"common\" stuff anywhere in the project, or if you decide is useful by itself, just release a separate, standalone project.</p>\n"}], "owner": {"reputation": 617, "user_id": 1938600, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5892288702862ce1bf3fe2ae54745e72?s=128&d=identicon&r=PG", "display_name": "marcantonio", "link": "https://stackoverflow.com/users/1938600/marcantonio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 609, "favorite_count": 0, "accepted_answer_id": 29779605, "answer_count": 1, "score": 4, "last_activity_date": 1429638511, "creation_date": 1429635942, "question_id": 29778778, "link": "https://stackoverflow.com/questions/29778778/idiomatic-go-code-organization", "title": "Idiomatic Go Code Organization", "body": "<p><strong>Note: I've seen other questions related to this topic but none that address the issue at hand.</strong></p>\n\n<p>I'm struggling to organize my Go code.  I'm writing a daemon and I would like to split the code logically between files.</p>\n\n<p>Say I have 3 files, <code>main.go</code>:</p>\n\n<pre><code>package main\n\nfunc main() {\n    GlobalFunc()\n\n    commonFunc()\n\n    var svr server.Server\n    server.OtherFunc()\n}\n</code></pre>\n\n<p><code>server.go</code>:</p>\n\n<pre><code>package main\n\ntype Server struct {\n    name string\n    ip string\n}\n\nfunc GlobalFunc() {\n\n}\n\nfunc (s *Server) OtherFunc() {\n    commonFunc()\n}\n</code></pre>\n\n<p>and <code>common.go</code>:</p>\n\n<pre><code>package main\n\nfunc commonFunc() {\n\n}\n</code></pre>\n\n<p>I would like to be able to call <code>GlobalFunc()</code> as <code>server.GlobalFunc()</code> to show it's part of the \"server module\".  That doesn't seem possible with the above example.</p>\n\n<p>I could make a subdir <code>server</code>, put <code>server.go</code> in there, and change it to <code>package server</code>.  The problem here is that I can't seem to shared <code>common.go</code> between the main and the <code>server</code> package.  I understand why, it doesn't seem like a good idea either.</p>\n\n<p>So I am missing something simple here and making this more complicated?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1429635429, "post_id": 29778461, "comment_id": 47687244, "body": "Doubt it waits &#39;cause you&#39;re supposed to be able to fetch GBs of data or hijack the connection. Try your code with a URL (full URL, not just a domain) that will take a while to download and see. Also, make it a habit to catch errors even when you don&#39;t think they&#39;ll matter; it makes me itchy just seeing the bare <code>err</code>-returning call."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1429635598, "post_id": 29778461, "comment_id": 47687358, "body": "It&#39;s &quot;Get&quot; not &quot;GET&quot;! Your code ignores the documentation of <a href=\"https://golang.org/pkg/net/http/#Get\" rel=\"nofollow noreferrer\"><code>http.Get</code></a> which states you need to close the returned body (unless <code>err != nil</code>)."}, {"owner": {"reputation": 1908, "user_id": 1269969, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3f07b9d9aa93f0d0750ea5f462db0fed?s=128&d=identicon&r=PG", "display_name": "placeybordeaux", "link": "https://stackoverflow.com/users/1269969/placeybordeaux"}, "edited": false, "score": 1, "creation_date": 1429636079, "post_id": 29778461, "comment_id": 47687673, "body": "I am very aware that the code will leak, but that shouldn&#39;t affect the timing.  I typed up this code just for the demonstration of blocking. And where I would put the timing statements. Would it make yall feel better if I checked the error and closed the response body?"}], "answers": [{"comments": [{"owner": {"reputation": 1908, "user_id": 1269969, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3f07b9d9aa93f0d0750ea5f462db0fed?s=128&d=identicon&r=PG", "display_name": "placeybordeaux", "link": "https://stackoverflow.com/users/1269969/placeybordeaux"}, "edited": false, "score": 0, "creation_date": 1429636608, "post_id": 29778942, "comment_id": 47688010, "body": "Huh I missed it in the documentation. Thanks for the info, sorry I seemed to have pissed you off."}, {"owner": {"reputation": 1908, "user_id": 1269969, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3f07b9d9aa93f0d0750ea5f462db0fed?s=128&d=identicon&r=PG", "display_name": "placeybordeaux", "link": "https://stackoverflow.com/users/1269969/placeybordeaux"}, "edited": false, "score": 0, "creation_date": 1429636700, "post_id": 29778942, "comment_id": 47688068, "body": "For posterity: fetching &quot;<a href=\"http://google.com/\" rel=\"nofollow noreferrer\">google.com</a>&quot; got 20615 bytes in 228.49943ms / 246.120056ms fetching &quot;<a href=\"http://en.wikipedia.org/\" rel=\"nofollow noreferrer\">en.wikipedia.org</a>&quot; got 64612 bytes in 163.696634ms / 189.106809ms fetching &quot;<a href=\"http://upload.wikimedia.org/wikipedia/commons/7/76/PIA02863_-_Jupiter_surface_motion_animation.gif\" rel=\"nofollow noreferrer\">upload.wikimedia.org/wikipedia/commons/7/76/&hellip;</a>&quot; got 7876075 bytes in 90.293561ms / 1.291815772s"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 1908, "user_id": 1269969, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3f07b9d9aa93f0d0750ea5f462db0fed?s=128&d=identicon&r=PG", "display_name": "placeybordeaux", "link": "https://stackoverflow.com/users/1269969/placeybordeaux"}, "edited": false, "score": 0, "creation_date": 1429636846, "post_id": 29778942, "comment_id": 47688162, "body": "@PeterMichealLacey-Bordeaux, yeah, the first two URLs I thought of were too short to show a difference, the third is the full size version of an image that happens to be on the Wikipedia front page today that was big enough to clearly show a difference. It&#39;d probably have been better if I had spent more time to come up with a better test URL that won&#39;t mind people fetching from it just to test something."}, {"owner": {"reputation": 1908, "user_id": 1269969, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3f07b9d9aa93f0d0750ea5f462db0fed?s=128&d=identicon&r=PG", "display_name": "placeybordeaux", "link": "https://stackoverflow.com/users/1269969/placeybordeaux"}, "edited": false, "score": 0, "creation_date": 1429637072, "post_id": 29778942, "comment_id": 47688301, "body": "Again thank you. However the documentation that you linked does not state anything about when the function actually returns. Nor does the code that you linked to. I made an effort to track it, but eventually got <a href=\"https://golang.org/src/net/http/transport.go#L1031\" rel=\"nofollow noreferrer\">here</a> and didn&#39;t quite understand it."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 1908, "user_id": 1269969, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3f07b9d9aa93f0d0750ea5f462db0fed?s=128&d=identicon&r=PG", "display_name": "placeybordeaux", "link": "https://stackoverflow.com/users/1269969/placeybordeaux"}, "edited": false, "score": 1, "creation_date": 1429637086, "post_id": 29778942, "comment_id": 47688314, "body": "@PeterMichealLacey-Bordeaux, and to be fair, the documentation doesn&#39;t clearly state that it returns as soon as the response headers have been read, but as soon as you get a little experience with Go almost every time you get returned an <code>io.Reader</code> (or in this case an <code>io.ReadCloser</code>) it&#39;s a streaming reader that doesn&#39;t have all the data yet."}, {"owner": {"reputation": 1908, "user_id": 1269969, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3f07b9d9aa93f0d0750ea5f462db0fed?s=128&d=identicon&r=PG", "display_name": "placeybordeaux", "link": "https://stackoverflow.com/users/1269969/placeybordeaux"}, "edited": false, "score": 0, "creation_date": 1429637161, "post_id": 29778942, "comment_id": 47688354, "body": "Thats a good rule of thumb. I will keep it in mind in the future. Have a good day!"}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": true, "score": 1, "last_activity_date": 1429638931, "last_edit_date": 1429638931, "creation_date": 1429636502, "answer_id": 29778942, "question_id": 29778461, "link": "https://stackoverflow.com/questions/29778461/does-gos-http-defaultclient-block-until-the-last-byte-of-the-body/29778942#29778942", "title": "Does Go&#39;s http.DefaultClient block until the last byte of the body?", "body": "<p>The <a href=\"https://golang.org/pkg/net/http/#Get\" rel=\"nofollow\">documentation</a> doesn't clearly state that this, but it returns as soon as the response headers have been read.</p>\n\n<p>As soon as you get a little experience with Go you'll realize that almost every time you get returned an <code>io.Reader</code> (or in this case <code>resp.Body</code> is an <code>io.ReadCloser</code>) it's a streaming reader that doesn't have all the data yet.\nJust like calling <code>os.Open</code> returns something that can be used as an <code>io.Reader</code> but doesn't read the whole file.</p>\n\n<p>In many cases with Go, if the documentation is not clear,\nyou can look at the <a href=\"https://golang.org/src/net/http/client.go\" rel=\"nofollow\">standard package code</a> for enlightenment.\nAdmittedly, in this specific case (as with <code>encoding/json</code>) the code is doing a lot so can be hard to follow at first glance.\nMost of the standard packages are much easier to follow and learn from.</p>\n\n<p>Failing that, you can just run a minor extension of the code you gave (on your own machine, the playground doesn't support making TCP connections) to make it pretty clear:</p>\n\n<p><sub>(note I just picked these URLs somewhat at random, better would be to pick some URL with a large payload that you know no one will mind you fetching for a test)</sub></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc measure(url string) (t1, t2 time.Duration, n int64, err error) {\n    start := time.Now()\n    resp, err := http.Get(url)\n    if err != nil {\n        return\n    }\n    defer resp.Body.Close()\n    t1 = time.Since(start)\n    n, err = io.Copy(ioutil.Discard, resp.Body)\n    t2 = time.Since(start)\n    return\n}\n\nfunc main() {\n    for _, url := range []string{\n        \"http://google.com/\",\n        \"http://en.wikipedia.org/\",\n        \"http://upload.wikimedia.org/wikipedia/commons/7/76/PIA02863_-_Jupiter_surface_motion_animation.gif\",\n    } {\n        fmt.Printf(\"fetching %q \", url)\n        t1, t2, n, err := measure(url)\n        if err != nil {\n            fmt.Println(\"error:\", err)\n            continue\n        }\n        fmt.Printf(\"got %d bytes in %v / %v\\n\", n, t1, t2)\n    }\n}\n</code></pre>\n\n<p>E.g.\u00a0on a somewhat slow connection the final URL measured above says:\u00a0<code>597.055907ms / 29.269763851s</code>.\n(That is, the initial <code>Get</code> call returned quickly whereas reading all the data took ~60\u00a0times longer.)</p>\n"}], "owner": {"reputation": 1908, "user_id": 1269969, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3f07b9d9aa93f0d0750ea5f462db0fed?s=128&d=identicon&r=PG", "display_name": "placeybordeaux", "link": "https://stackoverflow.com/users/1269969/placeybordeaux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 29778942, "answer_count": 1, "score": 0, "last_activity_date": 1429638931, "creation_date": 1429634919, "last_edit_date": 1429636045, "question_id": 29778461, "link": "https://stackoverflow.com/questions/29778461/does-gos-http-defaultclient-block-until-the-last-byte-of-the-body", "title": "Does Go&#39;s http.DefaultClient block until the last byte of the body?", "body": "<p>For example if I had the code</p>\n\n<pre><code>t := time.Now()\nhttp.Get(\"google.com\")\nfmt.Println(time.Now().Sub(t))\n</code></pre>\n\n<p>Would the printed duration be after the last byte of the response's body or after the last byte of the response's headers has been received?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1429628417, "post_id": 29775836, "comment_id": 47682094, "body": "can you post some code?"}, {"owner": {"reputation": 6647, "user_id": 914991, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/639555fcf960b5e80617a10f479ea476?s=128&d=identicon&r=PG", "display_name": "zmb", "link": "https://stackoverflow.com/users/914991/zmb"}, "edited": false, "score": 0, "creation_date": 1429628569, "post_id": 29775836, "comment_id": 47682215, "body": "Sounds like you just need to <code>break</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 6, "creation_date": 1429629144, "post_id": 29775836, "comment_id": 47682719, "body": "Btw your example code doesn&#39;t compile in Go, you need colons <code>:</code> after the cases, e.g. <code>case state.HasFlag(IN_ESCAPED): { ...</code>."}], "answers": [{"comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 5, "creation_date": 1429629018, "post_id": 29776033, "comment_id": 47682597, "body": "It is also a good practice to add a comment &#224; la <code>&#47;&#47; Do nothing.</code> to make it more clear that we don&#39;t need any action in this case."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 17, "last_activity_date": 1471848163, "last_edit_date": 1471848163, "creation_date": 1429628641, "answer_id": 29776033, "question_id": 29775836, "link": "https://stackoverflow.com/questions/29775836/no-op-explicitly-do-nothing-in-go/29776033#29776033", "title": "no-op/explicitly do nothing in go", "body": "<p>Unlike in other languages, in Go the control flow breaks at each <code>case</code> of a <a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"noreferrer\"><code>switch</code></a> statement, control doesn't flow into the next <code>case</code> unless it is explicitly \"asked\" for with the <a href=\"https://golang.org/ref/spec#Fallthrough_statements\" rel=\"noreferrer\"><code>fallthrough</code></a> statement.</p>\n\n<p>And also a statement is not required after the <code>case</code> (it can be empty). See this example:</p>\n\n<pre><code>i := 3\nswitch i {\ncase 3:\ncase 0:\n    fmt.Println(\"Hello, playground\")\n}\n</code></pre>\n\n<p>It will print nothing even though <code>i==3</code> and there is no statement after <code>case 3</code>.</p>\n\n<p>Same as this:</p>\n\n<pre><code>i := 3\nswitch {\ncase i == 3:\ncase i == 0:\n    fmt.Println(\"Hello, playground\")\n}\n</code></pre>\n\n<p>Try it on the <a href=\"http://play.golang.org/p/myySOENgCv\" rel=\"noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 868, "user_id": 1368008, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/76e96b1c75cbea08b7bd7911aca21490?s=128&d=identicon&r=PG", "display_name": "swizzard", "link": "https://stackoverflow.com/users/1368008/swizzard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12168, "favorite_count": 1, "accepted_answer_id": 29776033, "answer_count": 1, "score": 11, "last_activity_date": 1471848163, "creation_date": 1429628167, "last_edit_date": 1429628626, "question_id": 29775836, "link": "https://stackoverflow.com/questions/29775836/no-op-explicitly-do-nothing-in-go", "title": "no-op/explicitly do nothing in go", "body": "<p>I have a type method that mutates the type's fields. It takes no arguments and returns nothing. The bulk of the method is a <code>switch</code> block. I want to be able to \"short-circuit\" out of the <code>switch</code> block with a no-op. Before I refactored it into a type method, I would've just returned out of the function, but that's out. Removing the case would break the logic of the method--the <code>default</code> case mutates state, which I don't want to do if this case is matched. I need the equivalent of Python's <code>pass</code>, basically.</p>\n\n<p>Code:</p>\n\n<pre><code>func (parser *Parser) endSectionName () {\n    state = parser.State\n    buffer = parser.buffer\n    results = parser.results\n    switch {\n        case state.HasFlag(IN_ESCAPED) {\n            // ???\n        }\n        case !inSection(state) {\n            return state, NotInSectionError\n        }\n        case !state.HasFlag(IN_SECTION_NAME) {\n            state.Reset()\n            return state, errors.New(\"Parsing error: Not in section name\")\n        }\n        default {\n            state.RemoveFlag(IN_SECTION_NAME)\n            s := buffer.String()\n            results[s] = new(Section)\n            buffer.Reset()\n            return state, nil\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "docker", "dockerfile"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1429626147, "post_id": 29774786, "comment_id": 47680269, "body": "Did you follow the directions in the README? <code>git-go-websiteskeleton</code> isn&#39;t in your GOPATH."}, {"owner": {"reputation": 495, "user_id": 345849, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/10fac1d01265215561193d612f5c1e6a?s=128&d=identicon&r=PG", "display_name": "panchapol", "link": "https://stackoverflow.com/users/345849/panchapol"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1429628113, "post_id": 29774786, "comment_id": 47681816, "body": "@JimB if you mean in my dev machine, I can run the project just fine. Only having the problem when trying to build the docker."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1429629164, "post_id": 29774786, "comment_id": 47682734, "body": "Then how are you adding git-go-websiteskeleton to the image? Show us everything you&#39;re doing so I don&#39;t have to guess."}, {"owner": {"reputation": 495, "user_id": 345849, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/10fac1d01265215561193d612f5c1e6a?s=128&d=identicon&r=PG", "display_name": "panchapol", "link": "https://stackoverflow.com/users/345849/panchapol"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1429634808, "post_id": 29774786, "comment_id": 47686832, "body": "Thank you @JimB. My question may not clear enough. This is what I do. I clone the project to my src folder and run main.go which works okay. I can browse to localhost:8080 on my machine. Then I create a Dockerfile which has only &quot;FROM golang:onbuild EXPOSE 8080&quot; inside. Then I run the command &quot;docker build -t git-go-websitesskeleton .&quot; and then I got the errors. I&#39;m very new to docker but I assume that the I need to add more instructions into the Dockerfile. I just don&#39;t quite sure because the <a href=\"https://blog.golang.org/docker\" rel=\"nofollow noreferrer\">link</a> says I could only add this &quot;&quot;FROM golang:onbuild EXPOSE 8080&quot;."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1429635095, "post_id": 29774786, "comment_id": 47687026, "body": "You need to understand what the onbuild dockerfile is doing too. You don&#39;t need it, and It&#39;s probably better to just stop using that until you have a better grasp of what&#39;s going on."}, {"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 0, "creation_date": 1460219792, "post_id": 29774786, "comment_id": 60644411, "body": "@panchapol <code>onbuild</code> version of golang image is meant for really standard container run (meaning you don&#39;t import odd packages other than from the standards and common vcs). I recommend going for a conventional Dockerfile and trace the local steps and put them in the file."}, {"owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "edited": false, "score": 0, "creation_date": 1468469224, "post_id": 29774786, "comment_id": 64142505, "body": "GOROOT is set incorrectly, see <a href=\"http://stackoverflow.com/a/20459819/149482\">stackoverflow.com/a/20459819/149482</a> for more."}], "answers": [{"tags": [], "owner": {"reputation": 255, "user_id": 3446582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wLrPg.jpg?s=128&g=1", "display_name": "Niemi", "link": "https://stackoverflow.com/users/3446582/niemi"}, "is_accepted": false, "score": 2, "last_activity_date": 1460550482, "creation_date": 1460550482, "answer_id": 36598380, "question_id": 29774786, "link": "https://stackoverflow.com/questions/29774786/error-import-path-does-not-begin-with-hostname-when-building-docker-with-local/36598380#36598380", "title": "Error &#39;import path does not begin with hostname&#39; when building docker with local package", "body": "<p>The application is built inside the docker container and you need to have your dependencies available when building.</p>\n\n<p><code>golang:onbuild</code> gives compact Dockerfiles for simple cases but it will not fetch your dependencies.</p>\n\n<p>You can write your own Dockerfile with the steps needed to build your application. Depending on how your project looks you could use something like this:</p>\n\n<pre><code>FROM golang:1.6\nADD . /go/src/yourapplication\nRUN go get github.com/jadekler/git-go-websiteskeleton\nRUN go install yourapplication\nENTRYPOINT /go/bin/yourapplication\nEXPOSE 8080\n</code></pre>\n\n<p>This adds your source and your dependency into the container, builds your application, starts it, and exposes it under port 8080.</p>\n"}, {"tags": [], "owner": {"reputation": 715, "user_id": 9172232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65ed8ca4bd2c3adec049105413913bd4?s=128&d=identicon&r=PG&f=1", "display_name": "the4thamigo_uk", "link": "https://stackoverflow.com/users/9172232/the4thamigo-uk"}, "is_accepted": false, "score": 1, "last_activity_date": 1515095870, "creation_date": 1515095870, "answer_id": 48102649, "question_id": 29774786, "link": "https://stackoverflow.com/questions/29774786/error-import-path-does-not-begin-with-hostname-when-building-docker-with-local/48102649#48102649", "title": "Error &#39;import path does not begin with hostname&#39; when building docker with local package", "body": "<p>Try :</p>\n\n<pre><code>FROM golang:latest\nRUN mkdir /go/src/app\nWORKDIR /go/src/app\nADD ./HelloWorld.go ./\nRUN go get\nRUN go build -o main .\nCMD [\"/go/src/app/main\"]\n</code></pre>\n"}], "owner": {"reputation": 495, "user_id": 345849, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/10fac1d01265215561193d612f5c1e6a?s=128&d=identicon&r=PG", "display_name": "panchapol", "link": "https://stackoverflow.com/users/345849/panchapol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13414, "favorite_count": 1, "answer_count": 2, "score": 15, "last_activity_date": 1515095870, "creation_date": 1429625700, "last_edit_date": 1429626912, "question_id": 29774786, "link": "https://stackoverflow.com/questions/29774786/error-import-path-does-not-begin-with-hostname-when-building-docker-with-local", "title": "Error &#39;import path does not begin with hostname&#39; when building docker with local package", "body": "<p>I'm trying to build a docker with a local package but get the error 'import path does not begin with hostname'. If my understanding is correct, my Dockerfile should be just</p>\n\n<pre><code>FROM golang:onbuild\nEXPOSE 8080\n</code></pre>\n\n<p>based on this article <a href=\"https://blog.golang.org/docker\">Deploying Go servers with Docker</a></p>\n\n<p>I use this code <a href=\"https://github.com/jadekler/git-go-websiteskeleton\">git-go-websiteskeleton</a> as the source for building the docker. the full error is here.</p>\n\n<pre>\nimport \"git-go-websiteskeleton/app/common\": import path does not begin with hostname\npackage git-go-websiteskeleton/app/common: unrecognized import path \"git-go-websiteskeleton/app/common\"\nimport \"git-go-websiteskeleton/app/home\": import path does not begin with hostname\npackage git-go-websiteskeleton/app/home: unrecognized import path \"git-go-websiteskeleton/app/home\"\nimport \"git-go-websiteskeleton/app/user\": import path does not begin with hostname\npackage git-go-websiteskeleton/app/user: unrecognized import path \"git-go-websiteskeleton/app/user\"\n</pre>\n\n<p>Thank you for a help.</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 19938, "user_id": 248914, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e878ba29d544e2c1eaf24b4bf9c35157?s=128&d=identicon&r=PG", "display_name": "Betamos", "link": "https://stackoverflow.com/users/248914/betamos"}, "is_accepted": false, "score": 0, "last_activity_date": 1429612314, "last_edit_date": 1429612314, "creation_date": 1429611868, "answer_id": 29769504, "question_id": 29769234, "link": "https://stackoverflow.com/questions/29769234/how-to-customize-json-encoding-output-in-go/29769504#29769504", "title": "How to customize JSON encoding output in Go?", "body": "<p>Writing your own strings to a buffer kind of eliminates the purpose of <code>json.Marshal()</code>. Maybe something like:</p>\n\n<pre><code>type Info struct {\n    Name string `json:\"name\"` // Struct fields should have capital first letter\n                              // if you want it to be found by the marshaller.\n    Flag bool `json:\"flag\"`   // json:\"flag\" assigns the object key in json format\n}\n</code></pre>\n\n<p>And then something like:</p>\n\n<pre><code>myInfo := Info {\n    Name: \"Foo\",\n    Flag: true,\n}\nslc, _ := json.Marshal(myInfo)\nfmt.Println(string(slc))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 477, "user_id": 2169469, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4712d1bf23ea18fde09e1eb8f74ee886?s=128&d=identicon&r=PG", "display_name": "Meng", "link": "https://stackoverflow.com/users/2169469/meng"}, "edited": false, "score": 0, "creation_date": 1429623426, "post_id": 29769569, "comment_id": 47677916, "body": "Oh, I&#39;ve thought that I could Marshal out whatever I want even illegal JSON text"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 477, "user_id": 2169469, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4712d1bf23ea18fde09e1eb8f74ee886?s=128&d=identicon&r=PG", "display_name": "Meng", "link": "https://stackoverflow.com/users/2169469/meng"}, "edited": false, "score": 1, "creation_date": 1429623547, "post_id": 29769569, "comment_id": 47678022, "body": "@Meng That is not called JSON marshaling, that is called generating <i>any</i> binary/text content."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1471955190, "last_edit_date": 1471955190, "creation_date": 1429612047, "answer_id": 29769569, "question_id": 29769234, "link": "https://stackoverflow.com/questions/29769234/how-to-customize-json-encoding-output-in-go/29769569#29769569", "title": "How to customize JSON encoding output in Go?", "body": "<p>Your code produces invalid JSON text.</p>\n\n<p>You should write the names of the fields too, and for safety quote both the field names and <code>string</code> values <strong>but</strong> don't quote <code>bool</code> values (else the Go <code>json</code> package will not unmarshal it into <code>bool</code> for example). Also enclose your values in brackets <code>{}</code> like this:</p>\n\n<pre><code>b.Write([]byte(`{\"name\":\"`))       // started with {\nb.Write([]byte(i.name))\nb.Write([]byte(`\",\"flag\":`))       // note the , between values\nif i.flag {\n    b.Write([]byte(`true`))        // don't quote boolean value\n} else {\n    b.Write([]byte(`false`))       // don't quote boolean value\n}\nb.Write([]byte(`}`))               // must close with }\n</code></pre>\n\n<p><strong>Output</strong> (try the complete application on the <a href=\"http://play.golang.org/p/G6-W8ynpJr\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>[{\"name\":\"foo\",\"flag\":true},{\"name\":\"bar\",\"flag\":false}]\n</code></pre>\n\n<p>But since you're not doing anything special during marshal, just export the fields (by starting them with upper-case letters) and the <code>json</code> package will marshal/unmarshal it for you automatically:</p>\n\n<pre><code>type Info struct {\n    Name string\n    Flag bool\n}\n</code></pre>\n\n<p>Try this version on the <a href=\"http://play.golang.org/p/_cebFKFKcw\" rel=\"nofollow\">Go Playground</a>.</p>\n\n<p><strong>Output</strong> (note the upper-cased names <code>\"Name\"</code> and <code>\"Flag\"</code>):</p>\n\n<pre><code>[{\"Name\":\"foo\",\"Flag\":true},{\"Name\":\"bar\",\"Flag\":false}]\n</code></pre>\n\n<p>You can also use tags if you want to use different names in the JSON text like this:</p>\n\n<pre><code>type Info struct {\n    Name string `json:\"name\"`\n    Flag bool   `json:\"flag\"`\n}\n</code></pre>\n\n<p>This will again produce an output with lower-cased names:</p>\n\n<pre><code>[{\"name\":\"foo\",\"flag\":true},{\"name\":\"bar\",\"flag\":false}]\n</code></pre>\n\n<p>Read the documentation of the <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow\"><code>json.Marshal()</code></a> function to see what other options and customizations you can do with struct tags.</p>\n"}, {"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1429631773, "creation_date": 1429631773, "answer_id": 29777326, "question_id": 29769234, "link": "https://stackoverflow.com/questions/29769234/how-to-customize-json-encoding-output-in-go/29777326#29777326", "title": "How to customize JSON encoding output in Go?", "body": "<p>The problem is that you're expecting a lot to magically happen for you within your implementation of <code>MarshalJSON</code>. Unfortunately you need to look at it as though you're building the string entirely from scratch. Meaning this;</p>\n\n<pre><code>func (i Info) MarshalJSON() ([]byte, error) {\n    var b bytes.Buffer\n    b.Write([]byte(i.name))\n    if i.flag {\n        b.Write([]byte(`\"true\"`))\n    } else {\n        b.Write([]byte(`\"false\"`))\n    }   \n    return b.Bytes(), nil \n}\n</code></pre>\n\n<p>Needs to look more like this;</p>\n\n<pre><code>func (i Info) MarshalJSON() ([]byte, error) {\n    var b bytes.Buffer\n    b.Write([]byte(`{\"name\":\"`))       \n    b.Write([]byte(i.name))\n    b.Write([]byte(`\",\"flag\":`))        \n    if i.flag {\n        b.Write([]byte(`\"true\"`))        \n    } else {\n       b.Write([]byte(`\"false\"`))       \n    }\n    b.Write([]byte(`}`))\n}\n</code></pre>\n\n<p>Also, I'm assuming you legitimately want a string for the boolean values (otherwise why implement this method at all, right?), if not then you'll want to get rid of the if and just use <code>b.Write([]byte(i.flag))</code>.</p>\n"}], "owner": {"reputation": 477, "user_id": 2169469, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/4712d1bf23ea18fde09e1eb8f74ee886?s=128&d=identicon&r=PG", "display_name": "Meng", "link": "https://stackoverflow.com/users/2169469/meng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4844, "favorite_count": 0, "answer_count": 3, "score": 6, "last_activity_date": 1471955190, "creation_date": 1429611228, "question_id": 29769234, "link": "https://stackoverflow.com/questions/29769234/how-to-customize-json-encoding-output-in-go", "title": "How to customize JSON encoding output in Go?", "body": "<p>I want to customize encoding format of a struct but got error: \njson: error calling MarshalJSON for type main.Info: invalid character 'o' in literal false (expecting 'a')\nWhat's wrong with my code?</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\ntype Info struct {\n    name string\n    flag bool\n}\n\nfunc (i Info) MarshalJSON() ([]byte, error) {\n    var b bytes.Buffer\n    b.Write([]byte(i.name))\n    if i.flag {\n        b.Write([]byte(`\"true\"`))\n    } else {\n        b.Write([]byte(`\"false\"`))\n    }   \n    return b.Bytes(), nil \n}\n\nfunc main() {\n    a := []Info{\n        {\"foo\", true},\n        {\"bar\", false},\n    }   \n    out, err := json.Marshal(a)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(string(out))\n}\n</code></pre>\n"}, {"tags": ["multithreading", "go", "race-condition"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1429608418, "post_id": 29766680, "comment_id": 47666946, "body": "Just protect concurrent writes to <code>R.timer</code> with a <code>sync.Mutex</code> that&#39;s what they are for."}, {"owner": {"reputation": 353, "user_id": 4001057, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/iajbg.jpg?s=128&g=1", "display_name": "Sushmita Bhattacharya", "link": "https://stackoverflow.com/users/4001057/sushmita-bhattacharya"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1429610617, "post_id": 29766680, "comment_id": 47668591, "body": "even if I do this race still occurs. between write and waiting for channel. type R struct {     timer *time.Timer     //other fields     m sync.Mutex }  func f(done chan bool,r *R){ \tr.m.Lock()     r.timer =time.NewTimer(time.Millisecond * time.Duration(1000 + rand.Intn(2)))     r.m.Unlock()     //some code simultaneously accessing other fields of shared object r, cannot put a lock here          &lt;-r.timer.C      done &lt;- true }"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1429718191, "post_id": 29766680, "comment_id": 47733649, "body": "If you don&#39;t want to use Mutex/locks the idiomatic way is to share information over channels. You can just pass another channel into your method and send the values you want to update on it. After you start up the goroutines you have a select or a select in a loop where you update the your instance of <code>R</code> in the non-concurrent context."}], "answers": [{"tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": false, "score": 2, "last_activity_date": 1429611811, "creation_date": 1429611811, "answer_id": 29769478, "question_id": 29766680, "link": "https://stackoverflow.com/questions/29766680/multiple-go-routines-waiting-for-a-shared-timer-causing-race/29769478#29769478", "title": "Multiple go routines waiting for a shared Timer causing race", "body": "<p>There is a design issue here - you have one R object, and it has a shared instance, but every goroutine creates a new timer that is local. Seems to me like you need a local timer per goroutine, and not share that timer between all of them, it just doesn't make sense.</p>\n\n<p>If you rewrite your code like so:</p>\n\n<pre><code>type R struct {\n    //other fields\n    Foo string\n    Bar interface{}\n}\n\nfunc f(done chan bool, r *R) {\n    timer := time.NewTimer(time.Millisecond * time.Duration(1000+rand.Intn(2)))\n    //some code simultaneously accessing other fields of shared object r, cannot put a lock here\n    &lt;-timer.C\n\n    done &lt;- true\n}\n</code></pre>\n\n<p>the timer becomes local to the goroutine as it should be, and you have no race condition, at least for the timer access. </p>\n\n<p>Note that still, ever access to the shared object's other fields must be protected by a mutex or you'll get the same issue.</p>\n"}], "owner": {"reputation": 353, "user_id": 4001057, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/iajbg.jpg?s=128&g=1", "display_name": "Sushmita Bhattacharya", "link": "https://stackoverflow.com/users/4001057/sushmita-bhattacharya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 363, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1429611811, "creation_date": 1429604546, "last_edit_date": 1429607011, "question_id": 29766680, "link": "https://stackoverflow.com/questions/29766680/multiple-go-routines-waiting-for-a-shared-timer-causing-race", "title": "Multiple go routines waiting for a shared Timer causing race", "body": "<p>I have a requirement to update timer of a shared object in multiple go routines. But it end up with race condition. I cannot use lock for waiting on the channel because all the other routines will have to wait.</p>\n\n<pre><code>package main\nimport( \n    \"time\"\n    \"math/rand\"\n)\ntype R struct {\n    timer *time.Timer\n    //other fields\n}\n\nfunc f(done chan bool,r *R){\n    r.timer =time.NewTimer(time.Millisecond * time.Duration(1000 + rand.Intn(2)))\n    //some code simultaneously accessing other fields of shared object r, cannot put a lock here\n    &lt;-r.timer.C\n\n    done &lt;- true\n}\n\nfunc main(){\n    done := make(chan bool , 5)\n    var r *R\n    var t *time.Timer\n    r = &amp;R{timer:t}\n    for i:=0;i&lt;5;i++{\n        go f(done,r)\n    }\n    for i:=0;i&lt;5;i++{\n        &lt;-done\n    }\n}\n</code></pre>\n\n<p>when I run using </p>\n\n<pre><code> go run -race thread.go\n</code></pre>\n\n<p>it gives </p>\n\n<pre><code>==================\n\nWARNING: DATA RACE\nWrite by goroutine 5:\n  main.f()\n      usr/local/gocode/thread.go:12 +0x69\n\nPrevious write by goroutine 4:\n  main.f()\n      usr/local/gocode/thread.go:12 +0x69\n\nGoroutine 5 (running) created at:\n  main.main()\n      usr/local/gocode/thread.go:25 +0xd3\n\nGoroutine 4 (running) created at:\n  main.main()\n      usr/local/gocode/thread.go:25 +0xd3\n==================\n</code></pre>\n\n<p>and hangs</p>\n\n<p>any help would be useful</p>\n"}, {"tags": ["concurrency", "go", "parallel-processing", "goroutine"], "comments": [{"owner": {"reputation": 3140, "user_id": 700650, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a9babd166888c602545c93f15f4ce139?s=128&d=identicon&r=PG", "display_name": "Xiaotian Pei", "link": "https://stackoverflow.com/users/700650/xiaotian-pei"}, "edited": false, "score": 2, "creation_date": 1429592960, "post_id": 29763309, "comment_id": 47658382, "body": "why are you using for-loop?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4211028"}, "reply_to_user": {"reputation": 3140, "user_id": 700650, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a9babd166888c602545c93f15f4ce139?s=128&d=identicon&r=PG", "display_name": "Xiaotian Pei", "link": "https://stackoverflow.com/users/700650/xiaotian-pei"}, "edited": false, "score": 0, "creation_date": 1429593394, "post_id": 29763309, "comment_id": 47658553, "body": "just experimental. I just wanted to launch goroutines and exit the main program"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4211028"}, "edited": false, "score": 0, "creation_date": 1429593670, "post_id": 29763504, "comment_id": 47658640, "body": "Thanks, I was thinking one of the first goroutine within for-loop gets launched in the back ground and if I receive one from them, the main would exit."}, {"owner": {"reputation": 196, "user_id": 1891178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/017383de8f76e82322f70080154c7049?s=128&d=identicon&r=PG", "display_name": "Archy", "link": "https://stackoverflow.com/users/1891178/archy"}, "edited": false, "score": 0, "creation_date": 1429709809, "post_id": 29763504, "comment_id": 47726723, "body": "The read from the channel is never reached because the main routine is spinning in an infinite loop launching an infinite amount of corroutines. This program should crash with out of memory or freeze your computer after a few seconds as it allocates memory all the time."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1429598934, "last_edit_date": 1429598934, "creation_date": 1429593371, "answer_id": 29763504, "question_id": 29763309, "link": "https://stackoverflow.com/questions/29763309/goroutine-and-for-loop/29763504#29763504", "title": "Goroutine and for loop", "body": "<p>Since the <code>for</code> loop runs forever, your code runs forever. Receiving from <code>ch</code> after the <code>for</code> loop is never reached.</p>\n\n<p>If you want your code to exit sometime, you have to end the <code>for</code> loop sometime, e.g. make it run only a certain number of iterations:</p>\n\n<pre><code>for i := 0; i &lt; 5; i++ {\n    ...\n}\n</code></pre>\n\n<p>So if you only run 5 iterations (like in my example), after the <code>for</code> loop receiving from <code>ch</code> will be executed which may block (because <code>ch</code> is unbuffered) if other goroutines have not yet run, and at least one of the started goroutines will be executed which sends a value on the channel which may trigger the main goroutine to continue (because its blocking operating is no longer blocking).</p>\n\n<p>Also note that the <a href=\"http://golang.org/ref/mem\" rel=\"nofollow\"><strong>Go Memory Model</strong></a> only guarantees that certain events happen before other events, you have no guarantee how 2 concurrent goroutines are executed. You have no guarantee that the goroutines started in the <code>for</code> loop will start to execute before the main goroutine gets blocked at receiving from <code>ch</code>.</p>\n\n<p>Usually when a goroutine gets blocked (e.g. blocking channel receive operation), the runtime may schedule another goroutine to run.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4211028"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1501, "favorite_count": 0, "accepted_answer_id": 29763504, "answer_count": 1, "score": 0, "last_activity_date": 1429599061, "creation_date": 1429592550, "last_edit_date": 1429599061, "question_id": 29763309, "link": "https://stackoverflow.com/questions/29763309/goroutine-and-for-loop", "title": "Goroutine and for loop", "body": "<p>All I want to do is to send one value to the channel and return from the <code>main()</code> function and exit the program right after I receive one value from the channel <code>ch</code>.</p>\n\n<p>But this keeps running forever:</p>\n\n<pre><code>ch := make(chan int)\n\nfor {\n    go func() {\n        ch &lt;- 1\n    }()\n}\n\n&lt;-ch\n</code></pre>\n\n<p>How do I return with this <code>for</code> loop after I receive one value from the channel?</p>\n\n<p>And why does this run forever?</p>\n\n<p>Go playground link is here</p>\n\n<p><a href=\"http://play.golang.org/p/EvmT6Pw96Y\" rel=\"nofollow\">http://play.golang.org/p/EvmT6Pw96Y</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1429585877, "post_id": 29762118, "comment_id": 47656180, "body": "It&#39;s not clear what you mean. The &quot;index&quot; is an <code>int</code>. Can you show the relevant parts of the struct/slice definition that contains your data?"}], "answers": [{"comments": [{"owner": {"reputation": 3424, "user_id": 3918985, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4349dc6a41c144c486e982afb327fca7?s=128&d=identicon&r=PG&f=1", "display_name": "user3918985", "link": "https://stackoverflow.com/users/3918985/user3918985"}, "edited": false, "score": 0, "creation_date": 1429587864, "post_id": 29762487, "comment_id": 47656684, "body": "wow thank you so much! I was trying different syntax for a while but missed out on adding <code>$article :=</code>."}], "tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": true, "score": 23, "last_activity_date": 1429587544, "creation_date": 1429587544, "answer_id": 29762487, "question_id": 29762118, "link": "https://stackoverflow.com/questions/29762118/range-over-array-index-in-templates/29762487#29762487", "title": "Range over array index in templates", "body": "<p>You can use a nested loop, just as you would if you were writing code.</p>\n\n<p>Here's some code demonstrating that, <a href=\"http://play.golang.org/p/JFkGmjq8mY\" rel=\"noreferrer\">also available on the playground</a>.</p>\n\n<pre><code>package main\n\nimport (\n    \"html/template\"\n    \"os\"\n)\n\ntype a struct {\n    Title   []string\n    Article [][]string\n}\n\nvar data = &amp;a{\n    Title: []string{\"One\", \"Two\", \"Three\"},\n    Article: [][]string{\n        []string{\"a\", \"b\", \"c\"},\n        []string{\"d\", \"e\"},\n        []string{\"f\", \"g\", \"h\", \"i\"}},\n}\n\nvar tmplSrc = `\n{{range $i, $a := .Title}}\n  Title: {{$a}}\n  {{range $article := index $.Article $i}}\n    Article: {{$article}}.\n  {{end}}\n{{end}}`\n\nfunc main() {\n    tmpl := template.Must(template.New(\"test\").Parse(tmplSrc))\n    tmpl.Execute(os.Stdout, data)\n}\n</code></pre>\n"}], "owner": {"reputation": 3424, "user_id": 3918985, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4349dc6a41c144c486e982afb327fca7?s=128&d=identicon&r=PG&f=1", "display_name": "user3918985", "link": "https://stackoverflow.com/users/3918985/user3918985"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 19175, "favorite_count": 1, "accepted_answer_id": 29762487, "answer_count": 1, "score": 9, "last_activity_date": 1429587544, "creation_date": 1429585237, "last_edit_date": 1495539816, "question_id": 29762118, "link": "https://stackoverflow.com/questions/29762118/range-over-array-index-in-templates", "title": "Range over array index in templates", "body": "<p>I understand you can use index inside range: </p>\n\n<pre><code>{{range $i, $e := .First}}$e - {{index $.Second $i}}{{end}}\n</code></pre>\n\n<p>From: <a href=\"https://stackoverflow.com/questions/16141467/how-to-use-index-inside-range-in-html-template-to-iterate-through-parallel-array\">how to use index inside range in html/template to iterate through parallel arrays?</a></p>\n\n<p>How do I range over the index if it also contains an array?</p>\n\n<p>Eg.</p>\n\n<pre><code>type a struct {\n   Title []string\n   Article [][]string\n}\nIndexTmpl.ExecuteTemplate(w, \"index.html\", a)\n</code></pre>\n\n<p>index.html</p>\n\n<pre><code>{{range $i, $a := .Title}}\n  {{index $.Article $i}}  // Want to range over this.\n{{end}}\n</code></pre>\n"}, {"tags": ["go", "mgo", "elasticsearch"], "comments": [{"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1429574330, "post_id": 29760344, "comment_id": 47653125, "body": "You&#39;re missing important details in your question. What&#39;s <code>s</code>? A var of some go type representing the json mapping right? What&#39;s the type? Did the compiler produce errors? If so, what were they? Can you construct a minimal program that demonstrates the problem?"}, {"owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1429575253, "post_id": 29760344, "comment_id": 47653391, "body": "@Anonymous Was trying to be a bit too concise clearly. If I run as above, I get no errors but also the nested visits index isn&#39;t an array. I don&#39;t know how to add the map to the struct correctly so that it&#39;s indexed."}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1429578158, "post_id": 29760344, "comment_id": 47654192, "body": "I don&#39;t believe you get no errors. <code>Parent</code> doesn&#39;t have a field <code>Visits</code>, and <code>Last_Seen</code> is a <code>time.Time</code> and not an <code>int</code>."}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1429578544, "post_id": 29760344, "comment_id": 47654297, "body": "To solve your problem, I suspect you want to change <code>Visit NestedVisit</code> to <code>Visits []NestedVisit</code>."}, {"owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1429578610, "post_id": 29760344, "comment_id": 47654323, "body": "I&#39;m just asking for help, that&#39;s all. It&#39;s obvious I&#39;ve changed some of the name and removed some lines."}, {"owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1429579292, "post_id": 29760344, "comment_id": 47654500, "body": "I changed to that and it complains: &#39;cannot use m (type map[string]int) as type []NestedVisit in field value&#39;"}], "owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1080, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1429576311, "creation_date": 1429573112, "last_edit_date": 1429576311, "question_id": 29760344, "link": "https://stackoverflow.com/questions/29760344/golang-and-creating-a-nested-index-for-elasticsearch-from-a-mongo-object", "title": "Golang and creating a nested index for Elasticsearch from a Mongo object", "body": "<p>I'm learning Golang. I'm trying index a nested object from Mongo into a nested index Elasticsearch.</p>\n\n<p>For the Mongo objects I created two structs:</p>\n\n<pre><code>type Parent struct {\n    Client_Mac   string\n    Visit        NestedVisit `json:\"visits\" elastic:\"type:nested\"`\n}\n\ntype NestedVisit struct {\n    Last_Seen time.Time `json:\"last_seen\" elastic:\"type:date\"`\n}\n</code></pre>\n\n<p>I'm just need to loop through the array and index each one, including the nested index.</p>\n\n<p>For (my own) speed, I created a nested mapping outside Golang:</p>\n\n<pre><code>{\n    \"test\": {\n        \"mappings\": {\n            \"test\": {\n                \"properties\": {\n                    \"client_mac\": {\n                        \"type\": \"string\"\n                    },\n                    \"visits\": {\n                        \"type\": \"nested\",\n                        \"properties\": {\n                            \"last_seen\": {\n                                \"type\": \"date\",\n                                \"format\": \"dateOptionalTime\"\n                            },\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>I started indexing the objects as so by looping through the Mongo object. In my main function, I have this:</p>\n\n<pre><code>func main() {\n\n    db := session.DB(\"test\")\n    data := GetData(db)\n\n    for _, each := range data {\n        ReIndex(each)\n    }\n\n }\n</code></pre>\n\n<p>The ReIndex function looks as so:</p>\n\n<pre><code>func ReIndex(s Parent) {\n\n    var m map[string]int\n    m = make(map[string]int)\n\n    for _, each := range s.Visits {\n            m[\"last_seen\"] = each.Last_Seen\n    }\n\n    fmt.Printf(\"Test: %v\\n\", m)\n\n    visit1 := Parent{Client_Mac: s.Client_Mac, Visit: NestedVisit{Last_Seen: 1000}}\n    put1, err := el.Index().\n           Index(\"test\").\n           Type(\"test\").\n           Id(s.Id.Hex()).\n           BodyJson(visit1).\n           Do()\n    if err != nil {\n           panic(err)\n    }\n\n    fmt.Printf(\"Indexed test %s to index %s, type %s\\n\", put1.Id, put1.Index, put1.Type)\n}\n</code></pre>\n\n<p>Which was ok but I need the Visits to be an array of visits.</p>\n\n<p>So, within the loop, I tried looping through the Visit array and created a map:</p>\n\n<pre><code>var m map[string]int\nm = make(map[string]int)\n\nfor _, each := range s.Visits {\n        m[\"last_seen\"] = each.Last_Seen\n}\n</code></pre>\n\n<p>I then tried changing the Parent struct:</p>\n\n<pre><code>type Parent struct {\n   ... \n   Visit        interface{} `json:\"visits\" elastic:\"type:nested\"`\n}\n\nvisit1 := Parent{Client_Mac: s.Client_Mac, Visit: m}\n</code></pre>\n\n<p>But the index looks like this:</p>\n\n<pre><code>\"visits\":{\"last_seen\":1000}\n</code></pre>\n\n<p>Could someone explain what type Visits should have to facilitate an array?</p>\n\n<p>Ps. I'm using mgo and the <a href=\"https://github.com/olivere/elastic\" rel=\"nofollow\">elastic search client</a>.</p>\n"}, {"tags": ["javascript", "performance", "dictionary", "data-structures", "go"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1429567008, "post_id": 29758980, "comment_id": 47650570, "body": "I&#39;m not sure Go is not hashing the numbers, and I&#39;m not sure javascript does the same. A map of consecutive integers between 0...1M is basically an array. Initializing m as an array of 1M ints, reduces the execution time to 2ms. Now do this benchmarks with strings and it&#39;s a real comparison. I won&#39;t be surprised if v8&#39;s speed would be faster then as well."}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1429567300, "post_id": 29758980, "comment_id": 47650681, "body": "@Not_a_Golfer: ya I was kinda guessing that go might use int keys directly instead of hashing them; I suppose I could read the hashtable implementation to find out.  Funny enough - if I use string keys in both languages (using <code>s:=strconv.Itoa(i)</code> and <code>var s=&#39;&#39;+i</code>) then they perform roughly equally; though using a numeric key in js is still much faster.  Many mysteries afoot here..."}, {"owner": {"reputation": 507123, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1429567577, "post_id": 29758980, "comment_id": 47650791, "body": "&quot;<i>JavaScript will convert the integer keys to string property names.</i>&quot; - no it doesn&#39;t. Even if they are equivalent, that&#39;s not what the engine does. It soon realizes that you are abusing an object for an array, and will use an array underneath."}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "reply_to_user": {"reputation": 507123, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1429567664, "post_id": 29758980, "comment_id": 47650828, "body": "@Bergi: yes, that would explain a lot (see my comment to @Not_a_Golfer).  It looks like this silly benchmark might be flexing a well optimized part of the v8 engine..."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 507123, "user_id": 1048572, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7f2c4de95e8f4f8f5a71c3aaf0ed312a?s=128&d=identicon&r=PG", "display_name": "Bergi", "link": "https://stackoverflow.com/users/1048572/bergi"}, "edited": false, "score": 0, "creation_date": 1429567772, "post_id": 29758980, "comment_id": 47650879, "body": "@Bergi&#39;s explanation makes sense. Your Go is idiomatic, I highly doubt any scripting language can actually out perform it."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1429612050, "post_id": 29758980, "comment_id": 47669699, "body": "@maerics It doesn&#39;t surprise me at all that when we&#39;re comparing both with strings, the map implementation of both performs roughly the same. V8 is highly optimized, and you know, you&#39;re basically benchmarking two hash table implementations in compiled languages."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1429632812, "post_id": 29758980, "comment_id": 47685504, "body": "BTW, in Go it&#39;s easier and better to use the <a href=\"https://golang.org/pkg/testing/#hdr-Benchmarks\" rel=\"nofollow noreferrer\"><code>testing</code></a> package for benchmarks."}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1429633318, "post_id": 29758980, "comment_id": 47685860, "body": "Yes, looks like there&#39;s nothing to see here - please vote to close..."}], "answers": [{"comments": [{"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1429570815, "post_id": 29759876, "comment_id": 47651963, "body": "Hmm, yes, interesting.  Incrementing by other-than-one seems to defeat the v8 optimization that I suspect increment-by-one encounters (e.g. using an array implementation instead of a hash table)."}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "reply_to_user": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1429571904, "post_id": 29759876, "comment_id": 47652280, "body": "Go maps are implemented precisely as hash tables(no arrays any way) and incrementing keys by one you just trying to model Pathological Data Set with much collisions."}, {"owner": {"reputation": 830, "user_id": 1794179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/BnY2x.jpg?s=128&g=1", "display_name": "Sceptical Jule", "link": "https://stackoverflow.com/users/1794179/sceptical-jule"}, "edited": false, "score": 3, "creation_date": 1579782788, "post_id": 29759876, "comment_id": 105886654, "body": "So your suggestion is to execute <b>all</b> loop steps in JS, but let Go skip 89% of iterations and benchmark that? Very funny approach with very &quot;suprising&quot; results :D"}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 4, "last_activity_date": 1429570585, "creation_date": 1429570585, "answer_id": 29759876, "question_id": 29758980, "link": "https://stackoverflow.com/questions/29758980/golang-vs-javascript-v8-node-js-map-performance/29759876#29759876", "title": "Golang vs JavaScript (v8/node.js) map performance", "body": "<p>Your benchmark is synthetic a bit, just like any benchmarks are. Just for curious try</p>\n\n<pre><code>for i := 0; i &lt; 1000000; i += 9 {\n</code></pre>\n\n<p>in Go implementation. You may be surprised.</p>\n"}], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5674, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1429631134, "creation_date": 1429566275, "last_edit_date": 1429631134, "question_id": 29758980, "link": "https://stackoverflow.com/questions/29758980/golang-vs-javascript-v8-node-js-map-performance", "title": "Golang vs JavaScript (v8/node.js) map performance", "body": "<p>Out of curiosity I wrote some trivial benchmarks comparing the performance of golang maps to JavaScript (v8/node.js) objects used as maps and am surprised at their relative performance.  JavaScript objects appear to perform roughly twice as fast as go maps (even including some minor performance edges for go)!</p>\n\n<p>Here is the go implementation:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>// map.go\npackage main\nimport \"fmt\"\nimport \"time\"\nfunc elapsedMillis(t0, t1 time.Time) float64 {\n  n0, n1 := float64(t0.UnixNano()), float64(t1.UnixNano())\n  return (n1 - n0) / 1e6\n}\nfunc main() {\n  m := make(map[int]int, 1000000)\n  t0 := time.Now()\n  for i := 0; i &lt; 1000000; i++ {\n    m[i] = i     // Put.\n    _ = m[i] + 1 // Get, use, discard.\n  }\n  t1 := time.Now()\n  fmt.Printf(\"go: %fms\\n\", elapsedMillis(t0, t1))\n}\n</code></pre>\n\n<p>And here is the JavaScript:</p>\n\n<pre class=\"lang-javascript prettyprint-override\"><code>#!/usr/bin/env node\n// map.js\nfunction elapsedMillis(hrtime0, hrtime1) {\n  var n0 = hrtime0[0] * 1e9 + hrtime0[1];\n  var n1 = hrtime1[0] * 1e9 + hrtime1[1];\n  return (n1 - n0) / 1e6;\n}\nvar m = {};\nvar t0 = process.hrtime();\nfor (var i=0; i&lt;1000000; i++) {\n  m[i] = i; // Put.\n  var _ = m[i] + 1; // Get, use, discard.\n}\nvar t1 = process.hrtime();\nconsole.log('js: ' + elapsedMillis(t0, t1) + 'ms');\n</code></pre>\n\n<p>Note that the go implementation has a couple of minor potential performance edges in that:</p>\n\n<ol>\n<li><p>Go is mapping integers to integers directly, whereas JavaScript will convert the integer keys to string property names.</p></li>\n<li><p>Go makes its map with initial capacity equal to the benchmark size, whereas JavaScript is growing from its default capacity).</p></li>\n</ol>\n\n<p>However, despite the potential performance benefits listed above the go map usage seems to perform at about half the rate of the JavaScript object map!  For example (representative):</p>\n\n<pre><code>go: 128.318976ms\njs: 48.18517ms\n</code></pre>\n\n<p>Am I doing something obviously wrong with go maps or somehow comparing apples to oranges?</p>\n\n<p>I would have expected go maps to perform at least as well - if not better than JavaScript objects as maps.  Is this just a sign of go's immaturity (1.4 on darwin/amd64) or does it represent some fundamental difference between the two language data structures that I'm missing?</p>\n\n<p><strong>[Update]</strong></p>\n\n<p>Note that if you explicitly use string keys (e.g. via <code>s := strconv.Itoa(i)</code> and <code>var s = ''+i</code> in Go and JavaScript, respectively) then their performance is roughly equivalent.</p>\n\n<p>My guess is that the very high performance from v8 is related to a specific optimization in that runtime for objects whose keys are consecutive integers (e.g. by substituting an array implementation instead of a hashtable).</p>\n\n<p>I'm voting to close since there is likely nothing to see here...</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1429544851, "post_id": 29752462, "comment_id": 47637094, "body": "Are you looking for a way of creating a dynamic type?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 6, "creation_date": 1429545053, "post_id": 29752462, "comment_id": 47637250, "body": "I don&#39;t understand what you expect to happen. That&#39;s not valid syntax"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1429545523, "post_id": 29752462, "comment_id": 47637613, "body": "Could you try rephrasing your question? You say you want to Unmarshal JSON however you never call the Unmarshal function and your example looks more like it&#39;s trying to convert struct to string which is the other operation - marshal."}, {"owner": {"reputation": 6559, "user_id": 1011584, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/25f1fcb69cb52d5925f9141c6edd3b6f?s=128&d=identicon&r=PG", "display_name": "egidra", "link": "https://stackoverflow.com/users/1011584/egidra"}, "edited": false, "score": 0, "creation_date": 1429546601, "post_id": 29752462, "comment_id": 47638301, "body": "I changed the question so it makes more sense."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1429547907, "post_id": 29752462, "comment_id": 47639115, "body": "You might be better off to give example inputs and restrictions/requirements and desired result. E.g. something like &quot;I have JSON that might be like <code>{ &quot;type&quot;: &quot;circle&quot;, \u2026 }</code> but the text &quot;type&quot; isn&#39;t known ahead of time but must be a parameter, how can I unmarshal such JSON into a struct such as <code>type Shape { Type string, \u2026}</code>&quot; (of course I don&#39;t know if that has any actual resemblance to what you&#39;re trying to ask but at least it&#39;s an answerable question)."}], "answers": [{"comments": [{"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 2, "creation_date": 1429549142, "post_id": 29753410, "comment_id": 47639947, "body": "&quot;As far as I know nothing of the sort works in any compiled language.&quot; In D, Rust and Scala you can do it. :P"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 0, "creation_date": 1429549780, "post_id": 29753410, "comment_id": 47640328, "body": "@rightfold interesting... Only from an expression that uses a compile time constant as the value to evaluate though right? Then it&#39;s just like a fancier precompiler directive. Also, I&#39;ve never written anything in any of those languages."}, {"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 0, "creation_date": 1429550316, "post_id": 29753410, "comment_id": 47640678, "body": "Sure, all input must be known statically for obvious reasons."}, {"owner": {"reputation": 18851, "user_id": 414813, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83284c54c3fc960dcdf8844ed92227d7?s=128&d=identicon&r=PG", "display_name": "CAFxX", "link": "https://stackoverflow.com/users/414813/cafxx"}, "edited": false, "score": 2, "creation_date": 1532303284, "post_id": 29753410, "comment_id": 89908542, "body": "Even C and C++ allow it. Really, any language that has support for some sort of macros..."}, {"owner": {"reputation": 1331, "user_id": 5088125, "user_type": "registered", "accept_rate": 53, "profile_image": "https://graph.facebook.com/957806094241641/picture?type=large", "display_name": "Thomas Valadez", "link": "https://stackoverflow.com/users/5088125/thomas-valadez"}, "edited": false, "score": 0, "creation_date": 1601662610, "post_id": 29753410, "comment_id": 113485706, "body": "In typescript you would define your variable as a const <code>myObj = {...} as const</code> then you could do this where you are using variables that compile to strings, same goes for each of the keys. So other languages do this."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 7, "last_activity_date": 1429547532, "creation_date": 1429547532, "answer_id": 29753410, "question_id": 29752462, "link": "https://stackoverflow.com/questions/29752462/using-a-variable-in-the-struct-tag/29753410#29753410", "title": "Using a variable in the struct tag", "body": "<p>How would I use a variable in a Go struct tag? You wouldn't, it's not allowed by the language. You can't use a statement that evaluates at runtime in place of a compile time string literal for as an annotation to a field on a struct. As far as I know nothing of the sort works in any compiled language.</p>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1429557251, "post_id": 29755357, "comment_id": 47645113, "body": "wrt #1, the intention is that the developer runs go generate and checks in the results (just as is done by Go team) so that it <i>is</i> &quot;go gettable&quot;."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1429557324, "post_id": 29755357, "comment_id": 47645157, "body": "wrt #2, the OP hasn&#39;t been at all clear, but it&#39;s quite possible a (relatively) simple <code>UnmarshalJSON</code> method may be all they need/want."}], "tags": [], "owner": {"reputation": 111, "user_id": 4811562, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-v3Bog3Qbbnw/AAAAAAAAAAI/AAAAAAAAGCg/DjFnp4C7OpA/photo.jpg?sz=128", "display_name": "Qian Qiao", "link": "https://stackoverflow.com/users/4811562/qian-qiao"}, "is_accepted": false, "score": 3, "last_activity_date": 1429566580, "last_edit_date": 1429566580, "creation_date": 1429553648, "answer_id": 29755357, "question_id": 29752462, "link": "https://stackoverflow.com/questions/29752462/using-a-variable-in-the-struct-tag/29755357#29755357", "title": "Using a variable in the struct tag", "body": "<p>With the introduction of go generate, it is possible to do achieve this.</p>\n\n<p>However, go generate essentially makes the compilation a 2 phase process. Phase 1 generates the new code, phase 2 compiles and links etc.</p>\n\n<p>There are a few limitations with using go generate:</p>\n\n<ol>\n<li>Your library will not be 'go get'-able unless you run <code>go generate</code> every time it is needed and check in the result, since <code>go generate</code> needs to be explicitly run before <code>go build</code></li>\n<li>This is a compile time process, so you will not be able to do it at run time using run time information. If you really must do this at run time, and in your case, you are just adding JSON serialization annotations, you could consider using a map.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 395, "user_id": 3868505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e199a2eeabd37f2dec3368e7f6c091a2?s=128&d=identicon&r=PG&f=1", "display_name": "amarjeetAnand", "link": "https://stackoverflow.com/users/3868505/amarjeetanand"}, "is_accepted": false, "score": 0, "last_activity_date": 1600047119, "last_edit_date": 1600047119, "creation_date": 1599978456, "answer_id": 63867827, "question_id": 29752462, "link": "https://stackoverflow.com/questions/29752462/using-a-variable-in-the-struct-tag/63867827#63867827", "title": "Using a variable in the struct tag", "body": "<p>String const/variable is not allowed in tag value <a href=\"https://github.com/golang/go/issues/4740#issuecomment-66074233\" rel=\"nofollow noreferrer\">to keep things simple</a> and I support that. However with this limit, we need to use <strong>reflection</strong> to retrieve the tag value which is costly <strong>OR</strong> <strong>type string literals everywhere</strong> in the project, which may lead to bugs because of typos.<br></p>\n<h1>Solution</h1>\n<p>We can <strong>generate the tag values as string constant and then use this constant</strong> further in the  project. It doesn't use reflection(saves performance cost), is more maintainable and removes the possibility of any bug because of typos.</p>\n<p><code>ast</code> package is an amazing tool to analyse and generate the go code. For example -</p>\n<pre class=\"lang-golang prettyprint-override\"><code>type user struct {\n    Name string `json:&quot;name&quot;`\n    Age int `json:&quot;age&quot;`\n}\n</code></pre>\n<p>We can generated constants for <code>user</code> struct as below -</p>\n<pre class=\"lang-golang prettyprint-override\"><code>const (\n    UserNameJson = &quot;name&quot;\n    UserAgeJson  = &quot;age&quot;\n)\n</code></pre>\n<p>You may find <a href=\"https://github.com/amarjeetanandsingh/tgcon\" rel=\"nofollow noreferrer\">tgcon</a> helpful to generate the field tag value as const.</p>\n"}], "owner": {"reputation": 6559, "user_id": 1011584, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/25f1fcb69cb52d5925f9141c6edd3b6f?s=128&d=identicon&r=PG", "display_name": "egidra", "link": "https://stackoverflow.com/users/1011584/egidra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3211, "favorite_count": 1, "answer_count": 3, "score": 5, "last_activity_date": 1612384416, "creation_date": 1429544761, "last_edit_date": 1612384416, "question_id": 29752462, "link": "https://stackoverflow.com/questions/29752462/using-a-variable-in-the-struct-tag", "title": "Using a variable in the struct tag", "body": "<p>How would I use a variable in a Go struct tag?</p>\n\n<p>This works:</p>\n\n<pre><code>type Shape struct {\n    Type string `json:\"type\"`\n}\n</code></pre>\n\n<p>This does not work:</p>\n\n<pre><code>const (\n    TYPE = \"type\"\n)\n\ntype Shape struct {\n    Type string fmt.Sprintf(\"json:\\\"%s\\\"\", TYPE)\n}\n</code></pre>\n\n<p>In the first example, I am using a string literal, which works. In the second example, I am building a string using <code>fmt.Sprintf</code>, and I seem to be getting an error:\n<code>syntax error: unexpected name, expecting }</code></p>\n\n<p>Here it is on the Go playground:\n<a href=\"https://play.golang.org/p/lUmylztaFg\" rel=\"noreferrer\">https://play.golang.org/p/lUmylztaFg</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1429543819, "post_id": 29751577, "comment_id": 47636314, "body": "Don&#39;t return pointers to slices, nor a <code>*IPAddr</code> (which is just a slice) as a receiver."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1429543894, "post_id": 29751577, "comment_id": 47636377, "body": "If that&#39;s the only &quot;method&quot; you want to add, then don&#39;t. Just use a function on <code>net.IP</code>. There is nothing superior about a method compared to a simple function in this case."}, {"owner": {"reputation": 2293, "user_id": 1098584, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7ab6b6d44e367a743580c3089026b7bc?s=128&d=identicon&r=PG", "display_name": "sontags", "link": "https://stackoverflow.com/users/1098584/sontags"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1429546905, "post_id": 29751577, "comment_id": 47638496, "body": "Thanks! Actually there more methods, that was just to illustrate..."}], "answers": [{"comments": [{"owner": {"reputation": 2854, "user_id": 41292, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/939e50606775eea4b7589dd7aebbd8b3?s=128&d=identicon&r=PG", "display_name": "LenW", "link": "https://stackoverflow.com/users/41292/lenw"}, "edited": false, "score": 0, "creation_date": 1429628876, "post_id": 29751633, "comment_id": 47682477, "body": "That is such an interesting feature of golang"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 6, "last_activity_date": 1429628958, "last_edit_date": 1429628958, "creation_date": 1429542498, "answer_id": 29751633, "question_id": 29751577, "link": "https://stackoverflow.com/questions/29751577/wrap-net-ip-in-a-custom-type-and-add-methodes-in-golang/29751633#29751633", "title": "Wrap net.IP in a custom type and add methodes in golang", "body": "<p>Methods are not inherited between types (Go does not have inheritance at all).</p>\n\n<p>You may want to <a href=\"http://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow\">embed</a> the type, if promoting the methods automatically is what you're after:</p>\n\n<pre><code>type IPAddr struct {\n    net.IP\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "is_accepted": false, "score": 3, "last_activity_date": 1429542833, "last_edit_date": 1429542833, "creation_date": 1429542519, "answer_id": 29751639, "question_id": 29751577, "link": "https://stackoverflow.com/questions/29751577/wrap-net-ip-in-a-custom-type-and-add-methodes-in-golang/29751639#29751639", "title": "Wrap net.IP in a custom type and add methodes in golang", "body": "<p>Convert to <code>net.IP</code> before trying to call methods, otherwise you'll call methods on the wrapper:</p>\n\n<pre><code>func (ip *IPAddr) copy() IPAddr {\n    if x := net.IP(*ip).To4(); x != nil {\n        ip = x\n    }\n    dup := make(IPAddr, len(net.IP(*ip)))\n    copy(dup, *ip)\n    return dup\n}\n</code></pre>\n\n<p>For unmarshaling, implement the <a href=\"http://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow\"><code>json.Unmarshaler</code></a> interface.</p>\n\n<p>Another way to do it is by embedding <code>net.IP</code> in a struct, although this will inherit all methods from <code>net.IP</code>.</p>\n"}], "owner": {"reputation": 2293, "user_id": 1098584, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7ab6b6d44e367a743580c3089026b7bc?s=128&d=identicon&r=PG", "display_name": "sontags", "link": "https://stackoverflow.com/users/1098584/sontags"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 0, "accepted_answer_id": 29751633, "answer_count": 2, "score": 1, "last_activity_date": 1429628958, "creation_date": 1429542343, "question_id": 29751577, "link": "https://stackoverflow.com/questions/29751577/wrap-net-ip-in-a-custom-type-and-add-methodes-in-golang", "title": "Wrap net.IP in a custom type and add methodes in golang", "body": "<p>I try to add methodes to net.IP. Therefore I created a custom type IPAddr:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"net\"\n    \"log\"\n)\n\nfunc readNetworks(data []byte) (*[]Network, error) {\n    var networks []Network\n\n    if err := json.Unmarshal(data, &amp;networks); err != nil {\n        return &amp;networks, err\n    }\n\n    return &amp;networks, nil\n}\n\ntype IPAddr net.IP\n\ntype Network struct {\n    CIDR          string        `json:\"cidr\"`\n    Gateway       IPAddr        `json:\"gateway\"`\n}\n\nfunc (ip *IPAddr) copy() IPAddr {\n    if x := ip.To4(); x != nil {\n        ip = x\n    }\n    dup := make(IPAddr, len(ip))\n    copy(dup, ip)\n    return dup\n}\n\nfunc main() {\n    _, err := readNetworks([]byte(\"[{\\\"cidr\\\":\\\"10.100.19.0/24\\\",\\\"gateway\\\":\\\"10.100.19.1\\\"}]\"))\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>Some things that do not work here:</p>\n\n<ul>\n<li>Method To4() from net.IP is not known for IPAddr (line 27) </li>\n<li>len() does not work for IPAddr but for net.IP (line 30) </li>\n<li>string cannot be unmarshalled to IPAddr, this works for net.IP (line 12)</li>\n</ul>\n\n<p>My type definition is obviously wrong... any hints?</p>\n\n<p>See example at: \n<a href=\"http://play.golang.org/p/BT7VFnbPZW\" rel=\"nofollow\">http://play.golang.org/p/BT7VFnbPZW</a></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1286, "user_id": 1071090, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/vdLa6.jpg?s=128&g=1", "display_name": "Peter Hommel", "link": "https://stackoverflow.com/users/1071090/peter-hommel"}, "edited": false, "score": 0, "creation_date": 1429534143, "post_id": 29748178, "comment_id": 47628949, "body": "Sorry, I had originally omitted the asterisk before functiontype in my example. So the above (just edited it) would really be ok?"}, {"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "reply_to_user": {"reputation": 1286, "user_id": 1071090, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/vdLa6.jpg?s=128&g=1", "display_name": "Peter Hommel", "link": "https://stackoverflow.com/users/1071090/peter-hommel"}, "edited": false, "score": 0, "creation_date": 1429534226, "post_id": 29748178, "comment_id": 47629010, "body": "@PeterHommel There&#39;s nothing technically wrong with it, although it is hard to imagine why you would want a pointer to a function. What problem do you think requires this indirection? Note that pointers to functions in Go aren&#39;t the same as function pointers in C; they&#39;d be more similar to pointers to function pointers in C."}, {"owner": {"reputation": 1286, "user_id": 1071090, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/vdLa6.jpg?s=128&g=1", "display_name": "Peter Hommel", "link": "https://stackoverflow.com/users/1071090/peter-hommel"}, "edited": false, "score": 0, "creation_date": 1429534607, "post_id": 29748178, "comment_id": 47629292, "body": "I did use them as handler callbacks in a plugin system. Just wanted to attach some data from the outside to every instance of this callback and hence used this type of construct."}, {"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "reply_to_user": {"reputation": 1286, "user_id": 1071090, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/vdLa6.jpg?s=128&g=1", "display_name": "Peter Hommel", "link": "https://stackoverflow.com/users/1071090/peter-hommel"}, "edited": false, "score": 0, "creation_date": 1429534719, "post_id": 29748178, "comment_id": 47629379, "body": "@PeterHommel How would you acquire the pointers to look up the values in the map? Or do you merely use the map for iteration?"}, {"owner": {"reputation": 1286, "user_id": 1071090, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/vdLa6.jpg?s=128&g=1", "display_name": "Peter Hommel", "link": "https://stackoverflow.com/users/1071090/peter-hommel"}, "edited": false, "score": 0, "creation_date": 1429535032, "post_id": 29748178, "comment_id": 47629593, "body": "Yes, at the moment just that."}, {"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "reply_to_user": {"reputation": 1286, "user_id": 1071090, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/vdLa6.jpg?s=128&g=1", "display_name": "Peter Hommel", "link": "https://stackoverflow.com/users/1071090/peter-hommel"}, "edited": false, "score": 0, "creation_date": 1429535279, "post_id": 29748178, "comment_id": 47629777, "body": "@PeterHommel Then it should be fine. Note that you cannot do this: <a href=\"http://play.golang.org/p/Zb66Z_UQ1h\" rel=\"nofollow noreferrer\">play.golang.org/p/Zb66Z_UQ1h</a> as <code>&amp;f</code> takes the address of the local variable, which is never the same for different invocations of <code>Add</code> and <code>Find</code>."}, {"owner": {"reputation": 1286, "user_id": 1071090, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/vdLa6.jpg?s=128&g=1", "display_name": "Peter Hommel", "link": "https://stackoverflow.com/users/1071090/peter-hommel"}, "reply_to_user": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 0, "creation_date": 1429611377, "post_id": 29748178, "comment_id": 47669151, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/75791/discussion-between-peter-hommel-and-rightfold\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "is_accepted": true, "score": 5, "last_activity_date": 1486492206, "last_edit_date": 1486492206, "creation_date": 1429533588, "answer_id": 29748178, "question_id": 29748003, "link": "https://stackoverflow.com/questions/29748003/map-with-function-pointer-as-key-in-go/29748178#29748178", "title": "map with function pointer as key in go", "body": "<p>If the key type is a <em>pointer</em> to a function type (such as <code>*func()</code>) then it's totally fine and the semantics are as expected: equal pointers are equal keys.</p>\n\n<p>However, looking up the values in the map may not work out as you may expect: <a href=\"http://play.golang.org/p/Zb66Z_UQ1h\" rel=\"nofollow noreferrer\">example</a>. Here <code>&amp;f</code> takes the address of the local variable, which is never the same for different invocations of <code>Add</code> and <code>Find</code>. The following of course could be useful: <a href=\"http://play.golang.org/p/F9jyUxzJhz\" rel=\"nofollow noreferrer\">http://play.golang.org/p/F9jyUxzJhz</a></p>\n\n<hr>\n\n<p>If it is <em>not</em> a pointer, it's a bad idea because it's impossible from Go 1 onwards. According to the language specification (<a href=\"http://play.golang.org/p/rsT2eTpm2D\" rel=\"nofollow noreferrer\">live demo</a>):</p>\n\n<blockquote>\n  <p>The comparison operators == and != must be fully defined for operands of the key type; thus the key type must not be a function, map, or slice.</p>\n</blockquote>\n\n<p><code>==</code> and <code>!=</code> aren't defined for functions since the problem of comparing functions for equality is undecidable.</p>\n"}, {"comments": [{"owner": {"reputation": 1286, "user_id": 1071090, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/vdLa6.jpg?s=128&g=1", "display_name": "Peter Hommel", "link": "https://stackoverflow.com/users/1071090/peter-hommel"}, "edited": false, "score": 1, "creation_date": 1429538245, "post_id": 29749100, "comment_id": 47632095, "body": "Not exactly what I did mean, but a good starting point for a complete example. Just rewrote it to make id adhere to my intended question and incorporated it into my question. thx..."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 4, "last_activity_date": 1429537077, "last_edit_date": 1495541822, "creation_date": 1429536078, "answer_id": 29749100, "question_id": 29748003, "link": "https://stackoverflow.com/questions/29748003/map-with-function-pointer-as-key-in-go/29749100#29749100", "title": "map with function pointer as key in go", "body": "<p>Your question is too abstract to be meaningful. Give us code for a real example. <a href=\"https://stackoverflow.com/help/mcve\">How to create a Minimal, Complete, and Verifiable example.</a>.</p>\n\n<p>For example, do you mean something like this?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype f func(int) int\n\ntype s struct{ i int }\n\nfunc f1(i int) int { return i }\n\nfunc f2(i int) int { return i * i }\n\nfunc main() {\n    p1, p2 := f1, f2\n    fmt.Println(p1, &amp;p1, p2, &amp;p2)\n    m := make(map[*f]s)\n    m[(*f)(&amp;p1)] = s{f1(42)}\n    m[(*f)(&amp;p2)] = s{f2(42)}\n    fmt.Println(m)\n    p1, p2 = f2, f1\n    fmt.Println(m)\n    fmt.Println(p1, &amp;p1, p2, &amp;p2)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>0x20000 0x1040a120 0x20020 0x1040a128\nmap[0x1040a120:{42} 0x1040a128:{1764}]\nmap[0x1040a128:{1764} 0x1040a120:{42}]\n0x20020 0x1040a120 0x20000 0x1040a128\n</code></pre>\n"}], "owner": {"reputation": 1286, "user_id": 1071090, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/vdLa6.jpg?s=128&g=1", "display_name": "Peter Hommel", "link": "https://stackoverflow.com/users/1071090/peter-hommel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3431, "favorite_count": 3, "accepted_answer_id": 29748178, "answer_count": 2, "score": 9, "last_activity_date": 1486492206, "creation_date": 1429533174, "last_edit_date": 1429542683, "question_id": 29748003, "link": "https://stackoverflow.com/questions/29748003/map-with-function-pointer-as-key-in-go", "title": "map with function pointer as key in go", "body": "<p>I recently used a map in one of my golang projects, that had function pointers as keys like this:</p>\n\n<pre><code>map[*functiontype] somestructtype\n</code></pre>\n\n<p>One of my colleagues said this was a bad idea, so now I am unsure of this being feasible. I initially deemed it ok, because method pointers can be checked for equality and are immutable. Can someone provide some reasoning on that matter?</p>\n\n<p>Complete example:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype s struct {\n    string\n}\n\ntype f func() string\nfunc func1() string { return \"func 1\" }\nfunc func2() string { return \"func 2\" }\n\nfunc main() {\n    // make two functions and two pointers to them\n    f1, f2 := func1, func2\n    p1, p2 := (*f)(&amp;f1), (*f)(&amp;f2)\n\n    // make a map of their function pointers\n    m := make(map[*f]s)\n    m[p1] = s{\"struct 1\"}\n    m[p2] = s{\"struct 2\"}\n\n    // print out the mapping\n    printmapping(m, p1, p2)\n\n    // reverse the pointers and have that printed\n    p1, p2 = (*f)(&amp;f2), (*f)(&amp;f1)\n    printmapping(m, p1, p2)\n}\n\nfunc printmapping(m map[*f]s, p1, p2 *f) {\n    fmt.Println(\"pointer 1:\", m[(*f)(p1)])\n    fmt.Println(\"pointer 2:\", m[(*f)(p2)])\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 14973, "user_id": 128186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46c330659979615fe50c46f5f553b39f?s=128&d=identicon&r=PG", "display_name": "Arjan", "link": "https://stackoverflow.com/users/128186/arjan"}, "edited": false, "score": 3, "creation_date": 1429528405, "post_id": 29746123, "comment_id": 47624734, "body": "If I understand correctly you want the response as <code>io.Reader</code>? In that case resp.Body is already of that type."}, {"owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "edited": false, "score": 3, "creation_date": 1429528705, "post_id": 29746123, "comment_id": 47624953, "body": "<a href=\"http://golang.org/pkg/bytes/#NewReader\" rel=\"nofollow noreferrer\">golang.org/pkg/bytes/#NewReader</a> will &quot;turn&quot; a <code>[]byte</code> to an <code>io.Reader</code> (and io.ReadSeeker)"}, {"owner": {"reputation": 2213, "user_id": 2353374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff899f7c04d123f568d7e6b261377ed9?s=128&d=identicon&r=PG", "display_name": "Chan Willson", "link": "https://stackoverflow.com/users/2353374/chan-willson"}, "reply_to_user": {"reputation": 14973, "user_id": 128186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46c330659979615fe50c46f5f553b39f?s=128&d=identicon&r=PG", "display_name": "Arjan", "link": "https://stackoverflow.com/users/128186/arjan"}, "edited": false, "score": 0, "creation_date": 1429528872, "post_id": 29746123, "comment_id": 47625071, "body": "@Arjan yap~body...i want get the response as io.reader  .but in the base class when i finish the request,the response have been killed.. just save a response body as []byte in struct."}, {"owner": {"reputation": 2213, "user_id": 2353374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff899f7c04d123f568d7e6b261377ed9?s=128&d=identicon&r=PG", "display_name": "Chan Willson", "link": "https://stackoverflow.com/users/2353374/chan-willson"}, "reply_to_user": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "edited": false, "score": 0, "creation_date": 1429528909, "post_id": 29746123, "comment_id": 47625093, "body": "@ANisus  i will try....thx dude..by the way...it&#39;s look&#39;s like different type.."}, {"owner": {"reputation": 14973, "user_id": 128186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46c330659979615fe50c46f5f553b39f?s=128&d=identicon&r=PG", "display_name": "Arjan", "link": "https://stackoverflow.com/users/128186/arjan"}, "edited": false, "score": 0, "creation_date": 1429529085, "post_id": 29746123, "comment_id": 47625233, "body": "@ChanWillson: That requirement makes more sense, the body cannot be read after closing it. As suggested use <code>*bytes.Reader</code> which implements the <code>io.Reader</code> interface."}, {"owner": {"reputation": 2213, "user_id": 2353374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff899f7c04d123f568d7e6b261377ed9?s=128&d=identicon&r=PG", "display_name": "Chan Willson", "link": "https://stackoverflow.com/users/2353374/chan-willson"}, "reply_to_user": {"reputation": 14973, "user_id": 128186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46c330659979615fe50c46f5f553b39f?s=128&d=identicon&r=PG", "display_name": "Arjan", "link": "https://stackoverflow.com/users/128186/arjan"}, "edited": false, "score": 0, "creation_date": 1429529133, "post_id": 29746123, "comment_id": 47625258, "body": "thank u @Arjan i will try...."}, {"owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "edited": false, "score": 0, "creation_date": 1429531520, "post_id": 29746123, "comment_id": 47626988, "body": "@ChanWillson It is a different type. One is an interface, the other a value that implements that interface. I created an answer from my comment, trying to explain it a bit."}], "answers": [{"comments": [{"owner": {"reputation": 4649, "user_id": 5601284, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qVVND.jpg?s=128&g=1", "display_name": "byxor", "link": "https://stackoverflow.com/users/5601284/byxor"}, "edited": false, "score": 0, "creation_date": 1539372765, "post_id": 29747410, "comment_id": 92493330, "body": "Is there a similar function to turn a <code>[]byte</code> into an <code>io.Writer</code>? E.g. <code>bytes.NewWriter(destination)</code>"}, {"owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "reply_to_user": {"reputation": 4649, "user_id": 5601284, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qVVND.jpg?s=128&g=1", "display_name": "byxor", "link": "https://stackoverflow.com/users/5601284/byxor"}, "edited": false, "score": 4, "creation_date": 1539528851, "post_id": 29747410, "comment_id": 92526190, "body": "@byxor Yes, what you are looking for is <a href=\"https://golang.org/pkg/bytes/#Buffer\" rel=\"nofollow noreferrer\"><code>bytes.Buffer</code></a>. There you create a buffer that implements <code>io.Writer</code> like this: <code>w := bytes.NewBuffer(destination)</code>."}, {"owner": {"reputation": 8456, "user_id": 1879101, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/knzYU.jpg?s=128&g=1", "display_name": "Vitaly Zdanevich", "link": "https://stackoverflow.com/users/1879101/vitaly-zdanevich"}, "edited": false, "score": 0, "creation_date": 1554914831, "post_id": 29747410, "comment_id": 97928486, "body": "I do not understand this error from <code>govet</code>: <code>cannot use *bytes.NewReader(out.Bytes()) (type bytes.Reader) as type io.Reader in argument to ioutil.NopCloser</code> :("}, {"owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "reply_to_user": {"reputation": 8456, "user_id": 1879101, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/knzYU.jpg?s=128&g=1", "display_name": "Vitaly Zdanevich", "link": "https://stackoverflow.com/users/1879101/vitaly-zdanevich"}, "edited": false, "score": 1, "creation_date": 1554921963, "post_id": 29747410, "comment_id": 97931934, "body": "@VitalyZdanevich That is because <code>bytes.Reader</code> has pointer receivers, and you are turning it from a pointer type (<code>*bytes.Reader</code>) to a base type (<code>bytes.Reader</code>) . Just get rid of the asterisk (<code>*</code>) and you should be fine :)"}], "tags": [], "owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "is_accepted": false, "score": 379, "last_activity_date": 1597119504, "last_edit_date": 1597119504, "creation_date": 1429531476, "answer_id": 29747410, "question_id": 29746123, "link": "https://stackoverflow.com/questions/29746123/convert-byte-slice-to-io-reader/29747410#29747410", "title": "Convert byte slice to io.Reader", "body": "<p>To get a type that implements <code>io.Reader</code> from a <code>[]byte</code> slice, you can use <a href=\"https://golang.org/pkg/bytes/#NewReader\" rel=\"noreferrer\"><code>bytes.NewReader</code></a> in the <a href=\"https://golang.org/pkg/bytes\" rel=\"noreferrer\"><code>bytes</code></a> package:</p>\n<pre><code>r := bytes.NewReader(byteData)\n</code></pre>\n<p>This will return a value of type <a href=\"https://golang.org/pkg/bytes/#Reader\" rel=\"noreferrer\"><code>bytes.Reader</code></a> which implements the <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"noreferrer\"><code>io.Reader</code></a> (and <a href=\"https://golang.org/pkg/io/#ReadSeeker\" rel=\"noreferrer\"><code>io.ReadSeeker</code></a>) interface.</p>\n<p>Don't worry about them not being the same &quot;type&quot;. <code>io.Reader</code> is an interface and can be implemented by many different types. To learn a little bit more about interfaces in Go, read <a href=\"https://golang.org/doc/effective_go.html#interfaces_and_types\" rel=\"noreferrer\">Effective Go: Interfaces and Types</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 717, "user_id": 3586311, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pmO7J.jpg?s=128&g=1", "display_name": "jeffrey", "link": "https://stackoverflow.com/users/3586311/jeffrey"}, "edited": false, "score": 5, "creation_date": 1508534431, "post_id": 46306281, "comment_id": 80662597, "body": "Strings is a package, so I am assuming string(byteData) was meant. You can get a string from a byte slice in that manner (minus the s). String does not implement the io.Reader interface as it does not have a Read() method. <a href=\"https://play.golang.org/p/eRMmtHsscd\" rel=\"nofollow noreferrer\">play.golang.org/p/eRMmtHsscd</a> is an example that fails when Read() is called on a string."}, {"owner": {"reputation": 3706, "user_id": 4369952, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0b7dbb42e75923692e28d756ed3a207c?s=128&d=identicon&r=PG&f=1", "display_name": "Kennet Celeste", "link": "https://stackoverflow.com/users/4369952/kennet-celeste"}, "edited": false, "score": 0, "creation_date": 1596809535, "post_id": 46306281, "comment_id": 111938718, "body": "ouch ... cabbage"}], "tags": [], "owner": {"reputation": 1, "user_id": 5781786, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c344a071216a8c9228fc4c29d2cac47?s=128&d=identicon&r=PG&f=1", "display_name": "cmslotes", "link": "https://stackoverflow.com/users/5781786/cmslotes"}, "is_accepted": false, "score": -25, "last_activity_date": 1556013285, "last_edit_date": 1556013285, "creation_date": 1505841342, "answer_id": 46306281, "question_id": 29746123, "link": "https://stackoverflow.com/questions/29746123/convert-byte-slice-to-io-reader/46306281#46306281", "title": "Convert byte slice to io.Reader", "body": "<pre><code>r := strings(byteData)\n</code></pre>\n\n<p>This also works to turn <code>[]byte</code> into <code>io.Reader</code></p>\n"}], "owner": {"reputation": 2213, "user_id": 2353374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff899f7c04d123f568d7e6b261377ed9?s=128&d=identicon&r=PG", "display_name": "Chan Willson", "link": "https://stackoverflow.com/users/2353374/chan-willson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143638, "favorite_count": 29, "answer_count": 2, "score": 218, "last_activity_date": 1597119504, "creation_date": 1429527935, "last_edit_date": 1556013234, "question_id": 29746123, "link": "https://stackoverflow.com/questions/29746123/convert-byte-slice-to-io-reader", "title": "Convert byte slice to io.Reader", "body": "<p>In my project, I have a byte slice from a request's response.</p>\n\n<pre><code>defer resp.Body.Close()\nif resp.StatusCode != http.StatusOK {\n    log.Println(\"StatusCode\u4e3a\" + strconv.Itoa(resp.StatusCode))\n    return\n}\n\nrespByte, err := ioutil.ReadAll(resp.Body)\nif err != nil {\nlog.Println(\"fail to read response data\")\n    return\n}\n</code></pre>\n\n<p>This works, but if I want to get the response's body for <code>io.Reader</code>, how do I convert? I tried the newreader/writer but wasn't successful.</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 15567, "user_id": 3682599, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/j9vyk.jpg?s=128&g=1", "display_name": "Vivek S.", "link": "https://stackoverflow.com/users/3682599/vivek-s"}, "edited": false, "score": 0, "creation_date": 1429526125, "post_id": 29745460, "comment_id": 47623294, "body": "can show the exact insert script ??"}, {"owner": {"reputation": 3424, "user_id": 3918985, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4349dc6a41c144c486e982afb327fca7?s=128&d=identicon&r=PG&f=1", "display_name": "user3918985", "link": "https://stackoverflow.com/users/3918985/user3918985"}, "reply_to_user": {"reputation": 15567, "user_id": 3682599, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/j9vyk.jpg?s=128&g=1", "display_name": "Vivek S.", "link": "https://stackoverflow.com/users/3682599/vivek-s"}, "edited": false, "score": 0, "creation_date": 1429526247, "post_id": 29745460, "comment_id": 47623361, "body": "you mean the database query? I have it here."}, {"owner": {"reputation": 15567, "user_id": 3682599, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/j9vyk.jpg?s=128&g=1", "display_name": "Vivek S.", "link": "https://stackoverflow.com/users/3682599/vivek-s"}, "edited": false, "score": 0, "creation_date": 1429526375, "post_id": 29745460, "comment_id": 47623430, "body": "I meant the fully qualified insert statement  i.e <code>insert into table (col1,col2) values(1,&#39;Some_Data&#39;)</code>"}, {"owner": {"reputation": 3424, "user_id": 3918985, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4349dc6a41c144c486e982afb327fca7?s=128&d=identicon&r=PG&f=1", "display_name": "user3918985", "link": "https://stackoverflow.com/users/3918985/user3918985"}, "reply_to_user": {"reputation": 15567, "user_id": 3682599, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/j9vyk.jpg?s=128&g=1", "display_name": "Vivek S.", "link": "https://stackoverflow.com/users/3682599/vivek-s"}, "edited": false, "score": 0, "creation_date": 1429526494, "post_id": 29745460, "comment_id": 47623504, "body": "You mean this? <code>INSERT INTO articles (body, tags) VALUES (:body, :tags) RETURNING *;</code>"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1429528304, "post_id": 29745460, "comment_id": 47624680, "body": "Is not <code>tags</code> of type <code>[]string</code> rather than just <code>string</code>? If you pass a <code>[]string</code> it will appear as <code>{&quot;tag1&quot;, &quot;tag2&quot;, &quot;tag3&quot;}</code> when marshalled."}, {"owner": {"reputation": 3424, "user_id": 3918985, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4349dc6a41c144c486e982afb327fca7?s=128&d=identicon&r=PG&f=1", "display_name": "user3918985", "link": "https://stackoverflow.com/users/3918985/user3918985"}, "edited": false, "score": 0, "creation_date": 1429528969, "post_id": 29745460, "comment_id": 47625145, "body": "I get this error: <code>sql: converting Exec argument #2&#39;s type: unsupported type []string, a slice</code>"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1429531692, "post_id": 29745460, "comment_id": 47627100, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/26707553/inserting-an-array-into-a-postgresql-database-in-golang\">Inserting an array into a Postgresql database in Golang</a>"}], "answers": [{"tags": [], "owner": {"reputation": 12763, "user_id": 1097065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e26becbd681062e6da684a000c6b03ea?s=128&d=identicon&r=PG", "display_name": "andybalholm", "link": "https://stackoverflow.com/users/1097065/andybalholm"}, "is_accepted": false, "score": 0, "last_activity_date": 1429549220, "creation_date": 1429549220, "answer_id": 29753966, "question_id": 29745460, "link": "https://stackoverflow.com/questions/29745460/insert-string-array-into-postgres-text-array-field/29753966#29753966", "title": "Insert string array into postgres text array field", "body": "<p>You need to format your tags with the proper array input format, the same as your hard-coded value.</p>\n\n<p>The following code will work if the tags don't contain any special characters that need to be escaped differently from how strconv.Quote would escape them:</p>\n\n<pre><code>tags := \"apple, orange\"\ntagArray := strings.Split(tags, \", \")\nfor i, s := range tagArray {\n    tagArray[i] = strconv.Quote(s)\n}\nfinal := \"{\" + strings.Join(tagArray, \",\") + \"}\"\n</code></pre>\n"}], "owner": {"reputation": 3424, "user_id": 3918985, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4349dc6a41c144c486e982afb327fca7?s=128&d=identicon&r=PG&f=1", "display_name": "user3918985", "link": "https://stackoverflow.com/users/3918985/user3918985"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1686, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1429549220, "creation_date": 1429526032, "last_edit_date": 1429526915, "question_id": 29745460, "link": "https://stackoverflow.com/questions/29745460/insert-string-array-into-postgres-text-array-field", "title": "Insert string array into postgres text array field", "body": "<p>I'm trying to make an article taggable. </p>\n\n<p>Article table:</p>\n\n<pre><code>type Article struct {\n  ID int64\n  Body string\n  Tags string\n}\n</code></pre>\n\n<p>Preparing values:</p>\n\n<pre><code>tags := r.FormValue(\"tags\")\ntagArray := fmt.Sprintf(\"%q\", strings.Split(tags, \", \")) // How do I make use of this?\n\nt := Article{\n    Body: \"this is a post\",\n    Tags: `{\"apple\", \"orange\"}`,    // I have to hard code this for this to work.\n}\nif err := t.Insert(Db); err != nil {\n   // Error handling\n}\n</code></pre>\n\n<p>Database query:</p>\n\n<pre><code>func (t *Article) Insert(db *sqlx.DB) error {\n    nstmt, err := db.PrepareNamed(`INSERT INTO articles\n    (body, tags)\n    VALUES (:body, :tags)\n    RETURNING *;\n    `)\n    if err != nil {\n        return err\n    }\n    defer nstmt.Close()\n\n    err = nstmt.QueryRow(t).StructScan(t)\n    if err, ok := err.(*pq.Error); ok {\n        return err\n    }\n    return err\n}\n</code></pre>\n\n<p>Postgres setup for tags field:</p>\n\n<pre><code>tags character varying(255)[] DEFAULT '{}',\n</code></pre>\n\n<p>It seems like I have to hard code the value for tags for it to work. Otherwise I would get errors like these:</p>\n\n<pre><code>pq: missing dimension value\nOR\npq: array value must start with \"{\" or dimension information\n</code></pre>\n\n<p>How do I make use of <code>tagArray</code>?</p>\n\n<p>Helpful reference: <a href=\"https://gist.github.com/adharris/4163702\" rel=\"nofollow\">https://gist.github.com/adharris/4163702</a></p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1429558276, "post_id": 29745280, "comment_id": 47645710, "body": "So is this a runtime error or a compiler error?"}, {"owner": {"reputation": 83, "user_id": 3142129, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0olqR.jpg?s=128&g=1", "display_name": "William", "link": "https://stackoverflow.com/users/3142129/william"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1429582251, "post_id": 29745280, "comment_id": 47655305, "body": "runtime error, it&#39;s ok after I reinstall my mongodb server."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1430363436, "post_id": 29745280, "comment_id": 48037299, "body": "remove mgo package and get again with &#39;-tags sasl&#39; option. this fixe your current problem. you may need libsasl2-dev to make the new package.  <code>go get -tags sasl labix.org&#47;v2&#47;mgo</code> BUT!!! after it i got  <code>cannot establish SASL session: SASL(-4): no mechanism available: No worthy mechs found</code> please tell me if you find a way out."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1430364460, "post_id": 29745280, "comment_id": 48037577, "body": "after install more package to my system, new error message on client <code>because:server returned error on SASL authentication step: Authentication failed. </code> and server <code>AuthenticationFailed SCRAM-SHA-1 authentication failed, storedKey mismatch</code>"}], "answers": [{"tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": 0, "last_activity_date": 1430364661, "creation_date": 1430364661, "answer_id": 29958547, "question_id": 29745280, "link": "https://stackoverflow.com/questions/29745280/how-to-connect-mongodb-3-0-in-golang/29958547#29958547", "title": "how to connect mongodb 3.0 in golang", "body": "<p>change server configurations:</p>\n\n<p><code>&gt; var schema = db.system.version.findOne({\"_id\" : \"authSchema\"})</code>\n<br/>\n<code>&gt; schema.currentVersion = 3</code>\n<br/>\n<code>&gt; db.system.version.save(schema)</code></p>\n\n<p><a href=\"https://jira.mongodb.org/browse/SERVER-17459\" rel=\"nofollow\">https://jira.mongodb.org/browse/SERVER-17459</a></p>\n"}, {"comments": [{"owner": {"reputation": 478, "user_id": 2258656, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6068c644d1102cb2925201da8003af4d?s=128&d=identicon&r=PG", "display_name": "Gimli", "link": "https://stackoverflow.com/users/2258656/gimli"}, "edited": false, "score": 0, "creation_date": 1480230813, "post_id": 34233535, "comment_id": 68871512, "body": "This didn&#39;t help me at all. Still getting auth failed when using DialWithInfo. I have confirmed that all my info is correct as I am able to connect via another client to the DB.  NB: I am using Go1.7.1"}], "tags": [], "owner": {"reputation": 1859, "user_id": 1307985, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/971c9be683402a64b53babcb56e5c205?s=128&d=identicon&r=PG", "display_name": "Velin Georgiev", "link": "https://stackoverflow.com/users/1307985/velin-georgiev"}, "is_accepted": false, "score": 3, "last_activity_date": 1449872687, "creation_date": 1449872687, "answer_id": 34233535, "question_id": 29745280, "link": "https://stackoverflow.com/questions/29745280/how-to-connect-mongodb-3-0-in-golang/34233535#34233535", "title": "how to connect mongodb 3.0 in golang", "body": "<p>I had similar issue. Misleadingly I found around the network that has to be included the \"labix.org/v2/mgo\" package despite the fact that on the official site <a href=\"http://labix.org/mgo\" rel=\"nofollow\">http://labix.org/mgo</a> (at the time of the reading) it has newer and updated information that points to at least working for me package \"gopkg.in/mgo.v2\".</p>\n\n<p>I hope this can help since I got to the same steps as you without success and then I have changed the package reference. \nThis code worked in my case:</p>\n\n<pre><code>  package main\n\n  import (\n    \"fmt\"\n    \"time\"\n\n    \"gopkg.in/mgo.v2\"\n  )\n\n  //const MongoDb details\n  const (\n    hosts      = \"ds026491.mongolab.com:26491\"\n    database   = \"messagingdb\"\n    username   = \"admin\"\n    password   = \"youPassword\"\n    collection = \"messages\"\n  )\n\n  func main() {\n\n    info := &amp;mgo.DialInfo{\n        Addrs:    []string{hosts},\n        Timeout:  60 * time.Second,\n        Database: database,\n        Username: username,\n        Password: password,\n    }\n\n    session, err1 := mgo.DialWithInfo(info)\n    if err1 != nil {\n        panic(err1)\n    }\n\n    col := session.DB(database).C(collection)\n\n    count, err2 := col.Count()\n    if err2 != nil {\n        panic(err2)\n    }\n    fmt.Println(fmt.Sprintf(\"Messages count: %d\", count))\n  }\n</code></pre>\n\n<p>It is also on <a href=\"https://github.com/Velkata/Golang-MongoDB3.0-Example\" rel=\"nofollow\">Github</a></p>\n"}], "owner": {"reputation": 83, "user_id": 3142129, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0olqR.jpg?s=128&g=1", "display_name": "William", "link": "https://stackoverflow.com/users/3142129/william"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5234, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1449872687, "creation_date": 1429525470, "last_edit_date": 1429526792, "question_id": 29745280, "link": "https://stackoverflow.com/questions/29745280/how-to-connect-mongodb-3-0-in-golang", "title": "how to connect mongodb 3.0 in golang", "body": "<p>When I upgrade my <code>mongodb</code> server to version <code>3.0</code>  from <code>2.6</code> it can't connect from golang use mgo.</p>\n\n<p>I add <code>'authMechanism=SCRAM-SHA-1'</code> in connection string, and it still can't connect to the server. The error that I get is <code>SASL support not enabled during build (-tags sasl)</code></p>\n"}, {"tags": ["pointers", "go", "interface"], "comments": [{"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 0, "creation_date": 1429524886, "post_id": 29744216, "comment_id": 47622494, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/14116840/dynamically-call-method-on-interface-regardless-of-receiver-type\">Dynamically call method on interface{} regardless of receiver type</a>"}, {"owner": {"reputation": 3561, "user_id": 671116, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/716e3c5dc4fdff63d26a7b19d1a62420?s=128&d=identicon&r=PG", "display_name": "sharpner", "link": "https://stackoverflow.com/users/671116/sharpner"}, "reply_to_user": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 0, "creation_date": 1429527336, "post_id": 29744216, "comment_id": 47624033, "body": "well not really, since I actually want a solution without reflection. But yeah, if it isn&#39;t possible, it might be a duplicate."}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1429531142, "post_id": 29744216, "comment_id": 47626718, "body": "For me, I don&#39;t like third_party_libs which have funcs returning interface{}. To my mind it&#39;s untyped, hard to understand and use, bad practice. I&#39;d just avoid to use such a lib. I much prefer SomeThirdPartyMethod() which returns something explicitly - say SomeStruct, or SomeInterface, but not interface{}"}, {"owner": {"reputation": 3561, "user_id": 671116, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/716e3c5dc4fdff63d26a7b19d1a62420?s=128&d=identicon&r=PG", "display_name": "sharpner", "link": "https://stackoverflow.com/users/671116/sharpner"}, "edited": false, "score": 0, "creation_date": 1429695614, "post_id": 29744216, "comment_id": 47715378, "body": "it would be the same if the return type would be of an interface lets say... InterfaceA und it optionally may implemented interfaceB."}], "answers": [{"comments": [{"owner": {"reputation": 3561, "user_id": 671116, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/716e3c5dc4fdff63d26a7b19d1a62420?s=128&d=identicon&r=PG", "display_name": "sharpner", "link": "https://stackoverflow.com/users/671116/sharpner"}, "edited": false, "score": 0, "creation_date": 1429527423, "post_id": 29744696, "comment_id": 47624066, "body": "well, the third party method specifies the interface as optional. So therefore it must not be implemented, and the return value is interface{}. It&#39;s not elegant, but that&#39;s how it is."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 6, "last_activity_date": 1471848220, "last_edit_date": 1471848220, "creation_date": 1429523926, "answer_id": 29744696, "question_id": 29744216, "link": "https://stackoverflow.com/questions/29744216/how-to-get-a-pointer-of-interface-to-type-check-interface-implementation/29744696#29744696", "title": "How to get a pointer of interface{} to type check interface implementation", "body": "<p>In Go, an interface is just a set of methods (<a href=\"https://golang.org/ref/spec#Interface_types\" rel=\"nofollow\">spec: Interface types</a>).</p>\n\n<p>The interface does not specify whether receivers are pointers or not. Implementing an interface in Go is implicit: there is no declaration of intent.</p>\n\n<p>You need to read and understand <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow\"><strong>Method sets</strong></a>. Quoting an important part of it:</p>\n\n<blockquote>\n  <p>The method set of any other type <code>T</code> consists of all <a href=\"https://golang.org/ref/spec#Method_declarations\" rel=\"nofollow\">methods</a> declared with receiver type <code>T</code>. The method set of the corresponding <a href=\"https://golang.org/ref/spec#Pointer_types\" rel=\"nofollow\">pointer type</a> <code>*T</code> is the set of all methods declared with receiver <code>*T</code> or <code>T</code> (that is, it also contains the method set of <code>T</code>).</p>\n</blockquote>\n\n<p>A <em>value</em> (which may or may not be a pointer) implements an interface if the method set of its type is a superset of the interface (the methods of the interface type).</p>\n\n<p>In your example:</p>\n\n<pre><code>func (s *SomeStruct) SomeMethodWhichNeedsAPointerReceiver() string{}\n</code></pre>\n\n<p><code>SomeMethodWhichNeedsAPointerReceiver()</code> has a pointer receiver, so a value of type <code>SomeStruct</code> will not have this method, but a value of type <code>*SomeStruct</code> will.</p>\n\n<p>So as a consequence a value of type <code>SomeStruct</code> <strong>does not</strong> implement your <code>SomeInterface</code> interface (because it does not have a <code>SomeMethodWhichNeedsAPointerReceiver()</code> method), but <code>*SomeStruct</code> <strong>does implement</strong> your <code>SomeInterface</code> because its method set contains the <code>SomeMethodWhichNeedsAPointerReceiver()</code> method.</p>\n\n<p>Since you create and use a simple <code>SomeStruct</code> value (and not a pointer to it), the type assertion will fail.</p>\n\n<p>Should you have used a <code>*SomeStruct</code>, the type assertion would have succeeded.</p>\n\n<p>Modify your <code>SomeThirdPartyMethod()</code> function to create and return a <code>*SomeStruct</code> (a pointer) and it will work as you expect it:</p>\n\n<pre><code>func SomeThirdPartyMethod() interface{} {\n    return &amp;SomeStruct{}\n}\n</code></pre>\n\n<p>Or as an alternative:</p>\n\n<pre><code>func SomeThirdPartyMethod() interface{} {\n    return new(SomeStruct)\n}\n</code></pre>\n\n<p>Try it on the <a href=\"http://play.golang.org/p/BC1zbqoryc\" rel=\"nofollow\">Go Playground</a>.</p>\n\n<h3>If you can't modify <code>SomeThirdPartyMethod()</code></h3>\n\n<p>If you can't modify the <code>SomeThirdPartyMethod()</code> function: first of all, is it intended/required that it returns a value which implements <code>SomeStruct</code>? If so, then its current implementation is wrong, and you can expect it to return a value which does implement <code>SomeStruct</code> without you having to dereference it (in order to gain a value which implements <code>SomeStruct</code>).</p>\n\n<p>In this specific case you can also try type assertion for <code>SomeStruct</code> itself:</p>\n\n<pre><code>if ss, ok := s.(SomeStruct); ok {\n    fmt.Println(ss.SomeMethodWhichNeedsAPointerReceiver())\n}\n</code></pre>\n\n<p>Calling <code>ss.SomeMethodWhichNeedsAPointerReceiver()</code> will automatically dereference <code>ss</code> to take its address (which will be the pointer receiver value for calling the <code>SomeMethodWhichNeedsAPointerReceiver()</code> method).</p>\n"}, {"comments": [{"owner": {"reputation": 3561, "user_id": 671116, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/716e3c5dc4fdff63d26a7b19d1a62420?s=128&d=identicon&r=PG", "display_name": "sharpner", "link": "https://stackoverflow.com/users/671116/sharpner"}, "edited": false, "score": 0, "creation_date": 1429528019, "post_id": 29745304, "comment_id": 47624468, "body": "Yeah that is the only way we found as well. I upvoted you&#39;re answer but I will let this question open for now to find other suggestions. But thx for your response for now :D"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 4, "last_activity_date": 1429525569, "creation_date": 1429525569, "answer_id": 29745304, "question_id": 29744216, "link": "https://stackoverflow.com/questions/29744216/how-to-get-a-pointer-of-interface-to-type-check-interface-implementation/29745304#29745304", "title": "How to get a pointer of interface{} to type check interface implementation", "body": "<p>The best solution would indeed be to return a pointer from <code>SomeThirdPartyMethod</code>. But if this is not possible, you can construct a pointer to that value using <a href=\"http://golang.org/pkg/reflect/\" rel=\"nofollow\">reflection</a>:</p>\n\n<pre><code>v := reflect.Indirect(reflect.New(reflect.TypeOf(s)))\nv.Set(reflect.ValueOf(s))\nsp := v.Addr().Interface()\ncasted, ok = (sp).(SomeInterface)\nif ok {\n    fmt.Println(\"Good as well: \" + casted.SomeMethodWhichNeedsAPointerReceiver())\n    return\n}\n</code></pre>\n\n<p>Working example: <a href=\"http://play.golang.org/p/JYJT8mRxWN\" rel=\"nofollow\">http://play.golang.org/p/JYJT8mRxWN</a></p>\n"}], "owner": {"reputation": 3561, "user_id": 671116, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/716e3c5dc4fdff63d26a7b19d1a62420?s=128&d=identicon&r=PG", "display_name": "sharpner", "link": "https://stackoverflow.com/users/671116/sharpner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1071, "favorite_count": 1, "accepted_answer_id": 29745304, "answer_count": 2, "score": 3, "last_activity_date": 1527071687, "creation_date": 1429522685, "last_edit_date": 1527071687, "question_id": 29744216, "link": "https://stackoverflow.com/questions/29744216/how-to-get-a-pointer-of-interface-to-type-check-interface-implementation", "title": "How to get a pointer of interface{} to type check interface implementation", "body": "<p>So I'm basically trying to find out the best way to get to something like this:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype SomeStruct struct {\n}\n\ntype SomeInterface interface {\n  SomeMethodWhichNeedsAPointerReceiver() string\n}\n\nfunc (s *SomeStruct) SomeMethodWhichNeedsAPointerReceiver() string {\n  return \"Well, believe me, I wrote something\"\n}\n\nfunc Run(s interface{}) {\n  // how can I cast s to a pointer here?\n  casted, ok := (s).(SomeInterface)\n  if ok {\n    fmt.Println(\"Awesome: \" + casted.SomeMethodWhichNeedsAPointerReceiver())\n    return \n  }\n\n  fmt.Println(\"Fail :(\")\n}\n\nfunc SomeThirdPartyMethod() interface{} {\n  return SomeStruct{}\n}\n\nfunc main() {\n  x := SomeThirdPartyMethod()\n  Run(x)\n}\n</code></pre>\n\n<p>My problem here is, at the typecast in the Run method.\nI basically only know that it is of type interface{} and now I need\nto call an interface method, which has a pointer receiver.</p>\n\n<p>My only solution at the moment is to dynamically construct a slice with reflection, set the element into the slice, and than make it adressable. </p>\n\n<p>Is this really the only possibility to find a solution? </p>\n\n<p><a href=\"https://play.golang.org/p/4JCSmZkIxv\" rel=\"nofollow\">Play link</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3818, "user_id": 1247113, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zRMFj.png?s=128&g=1", "display_name": "rob74", "link": "https://stackoverflow.com/users/1247113/rob74"}, "edited": false, "score": 0, "creation_date": 1429521685, "post_id": 29743508, "comment_id": 47620381, "body": "shouldn&#39;t you be checking ir.Err <i>after</i> you call ir.Client.Do in Make()? Additionally, before &quot;return nil&quot; you should call log.Print(ir.Err) to get the error message."}, {"owner": {"reputation": 72977, "user_id": 95944, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/SprKq.jpg?s=128&g=1", "display_name": "Richard Knop", "link": "https://stackoverflow.com/users/95944/richard-knop"}, "edited": false, "score": 0, "creation_date": 1429523158, "post_id": 29743508, "comment_id": 47621359, "body": "Thanks guys. I figured this out. Look at my answer. The check for ir.Err is correct there as I have other methods than Make on the struct (Prepare for example, which builds the HTTP request). And in my code I want to minimise repetitive error checks so all methods just skip their body if one of previous methods of the struct failed. I then handle the error at the end. All needed to figure this out was to add few log.Print(ir.Err) into my code and it became easy to see the problem."}], "answers": [{"tags": [], "owner": {"reputation": 72977, "user_id": 95944, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/SprKq.jpg?s=128&g=1", "display_name": "Richard Knop", "link": "https://stackoverflow.com/users/95944/richard-knop"}, "is_accepted": true, "score": 0, "last_activity_date": 1429523058, "creation_date": 1429523058, "answer_id": 29744364, "question_id": 29743508, "link": "https://stackoverflow.com/questions/29743508/go-nil-dereference-error-when-testing-http-request/29744364#29744364", "title": "Go Nil Dereference Error When Testing HTTP Request", "body": "<p>Ok. I found an issue. Better logging of errors actually showed that my mistake was very simple.</p>\n\n<p>I was passing this as a URL to mocked HTTP client:</p>\n\n<pre><code>host/api/v1/tokens/\n</code></pre>\n\n<p>Which was resulting in this error:</p>\n\n<pre><code>Post host/api/v1/tokens/: unsupported protocol scheme\n</code></pre>\n\n<p>Apparently the URL must include a proper HTTP scheme (http://) even when you are using a test server.</p>\n"}], "owner": {"reputation": 72977, "user_id": 95944, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/SprKq.jpg?s=128&g=1", "display_name": "Richard Knop", "link": "https://stackoverflow.com/users/95944/richard-knop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 959, "favorite_count": 0, "accepted_answer_id": 29744364, "answer_count": 1, "score": -2, "last_activity_date": 1429523058, "creation_date": 1429520751, "question_id": 29743508, "link": "https://stackoverflow.com/questions/29743508/go-nil-dereference-error-when-testing-http-request", "title": "Go Nil Dereference Error When Testing HTTP Request", "body": "<p>I am trying to test a HTTP request in my Go library. Object which makes the call accepts a HTTP client object via dependency injection so in my test I am mocking the HTTP client like this:</p>\n\n<pre><code>func TestMyObject(t *testing.T) {\n    server := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        w.WriteHeader(200)\n        w.Header().Set(\"Content-Type\", \"application/json\")\n        fmt.Fprintln(w, mockJSONResponse)\n    }))\n    defer server.Close()\n\n    // Make a transport that reroutes all traffic to the example server\n    transport := &amp;http.Transport{\n        Proxy: func(req *http.Request) (*url.URL, error) {\n            return url.Parse(server.URL)\n        },\n    }\n\n    // Make a http.Client with the transport\n    httpClient := &amp;http.Client{Transport: transport}\n\n    // I am passing the httpClient to my object\n}\n</code></pre>\n\n<p>Here is how the HTTP request is made within my object:</p>\n\n<pre><code>// Make - makes a prepared HTTP request\nfunc (ir *MyObject) Make() *http.Response {\n    if ir.Err != nil {\n        return nil\n    }\n\n    ir.resp, ir.Err = ir.Client.Do(ir.req)\n\n    runtime.SetFinalizer(ir, func(ir *MyObject) {\n        ir.resp.Body.Close()\n    })\n\n    ir.logReqRes()\n    ir.checkErrorResponse()\n\n    return ir.resp\n}\n</code></pre>\n\n<p>I am getting nil pointer dereference error though:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference [recovered]\npanic: runtime error: invalid memory address or nil pointer dereference\n</code></pre>\n\n<p>In this function (I am trying to log the response):</p>\n\n<pre><code>// Logs request and response\nfunc (ir *MyObject) logReqRes() {\n    log.Print(\"AAAAAAA\")\n    log.Print(ir.resp)\n    log.Print(\"AAAAAAA\")\n    if reqInfo, err := httputil.DumpRequest(ir.req, true); err == nil {\n        log.Print(\"Logging request:\")\n        log.Print(string(reqInfo))\n    }\n    if respInfo, err := httputil.DumpResponse(ir.resp, true); err == nil {\n        log.Print(\"Logging response:\")\n        log.Print(string(respInfo))\n    }\n}\n</code></pre>\n\n<p>As you can see, ir.resp is nil for some reason. Any ideas?</p>\n"}, {"tags": ["arrays", "go", "struct", "escaping", "go-templates"], "answers": [{"comments": [{"owner": {"reputation": 3424, "user_id": 3918985, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4349dc6a41c144c486e982afb327fca7?s=128&d=identicon&r=PG&f=1", "display_name": "user3918985", "link": "https://stackoverflow.com/users/3918985/user3918985"}, "edited": false, "score": 0, "creation_date": 1429515444, "post_id": 29741711, "comment_id": 47616768, "body": "Thank you so much! You&#39;re a life saver!"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3424, "user_id": 3918985, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4349dc6a41c144c486e982afb327fca7?s=128&d=identicon&r=PG&f=1", "display_name": "user3918985", "link": "https://stackoverflow.com/users/3918985/user3918985"}, "edited": false, "score": 1, "creation_date": 1429518659, "post_id": 29741711, "comment_id": 47618467, "body": "@user3918985 I added 2 more alternative ways."}, {"owner": {"reputation": 3424, "user_id": 3918985, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4349dc6a41c144c486e982afb327fca7?s=128&d=identicon&r=PG&f=1", "display_name": "user3918985", "link": "https://stackoverflow.com/users/3918985/user3918985"}, "edited": false, "score": 0, "creation_date": 1429520397, "post_id": 29741711, "comment_id": 47619495, "body": "Thanks, that&#39;s really helpful. Regarding 2., I want to insert Article into a database, so I&#39;ve defined it as a string."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1471955206, "last_edit_date": 1471955206, "creation_date": 1429515074, "answer_id": 29741711, "question_id": 29741487, "link": "https://stackoverflow.com/questions/29741487/escape-html-in-array-field-in-struct/29741711#29741711", "title": "Escape HTML in array field in struct", "body": "<p>You can achieve this in several ways:</p>\n\n<h2>1. With a custom function</h2>\n\n<p>You can use a custom function. The <a href=\"http://golang.org/pkg/html/template/#Template.Funcs\" rel=\"nofollow\"><code>Template.Funcs()</code></a> method allows you to register any custom functions which can be invoked from templates.</p>\n\n<p>Create a simple function which converts a <code>string</code> to <a href=\"http://golang.org/pkg/html/template/#HTML\" rel=\"nofollow\"><code>template.HTML</code></a> like this:</p>\n\n<pre><code>func ToHtml(s string) template.HTML {\n    return template.HTML(s)\n}\n</code></pre>\n\n<p>You can register it like this:</p>\n\n<pre><code>t := template.Must(template.New(\"index.html\").\n    Funcs(map[string]interface{}{\"ToHtml\": ToHtml}).Parse(indexHtml))\n</code></pre>\n\n<p>Where just for demonstration purposes <code>indexHtml</code> is a <code>string</code> of your template:</p>\n\n<pre><code>const indexHtml = `{{with .}}\n  {{range .}}\n    &lt;a href=\"/\"&gt;{{.Title}}&lt;/a&gt;\n    {{ToHtml .BodyHTML}}\n  {{end}}\n{{end}}\n`\n</code></pre>\n\n<p>And you can refer to it and call it from the template like this:</p>\n\n<pre><code>{{ToHtml .BodyHTML}}\n</code></pre>\n\n<p>Calling this template with a parameter:</p>\n\n<pre><code>a := []struct {\n    Title    string\n    BodyHTML string\n}{{\"I'm the title\", \"I'm some &lt;b&gt;HTML&lt;/b&gt; code!\"}}\n\nerr := t.ExecuteTemplate(os.Stdout, \"index.html\", a)\n</code></pre>\n\n<p>Here's the complete, working example on the <a href=\"http://play.golang.org/p/JvPaGSutS4\" rel=\"nofollow\">Go Playground</a>.</p>\n\n<h2>2. Modifying <code>Article</code></h2>\n\n<p>If you can, it would be easier to just change the type of <code>Article.BodyHTML</code> to <code>template.HTML</code> and then it would be rendered unescaped without further ado. This would also make the intent clear (that it should/does contain safe HTML which will be rendered unescaped).</p>\n\n<h2>3. Adding a method to <code>Article</code></h2>\n\n<p>You can also add a method to the <code>Article</code> type which would return its <code>BodyHTML</code> field as a <code>template.HTML</code> (pretty much what the custom function does in proposition #1):</p>\n\n<pre><code>func (a *Article) SafeBody() template.HTML {\n    return template.HTML(a.BodyHTML)\n}\n</code></pre>\n\n<p>Having this method you can simply call it from the template:</p>\n\n<pre><code>  {{range .}}\n    &lt;a href=\"/\"&gt;{{.Title}}&lt;/a&gt;\n    {{.SafeBody}}\n  {{end}}\n</code></pre>\n\n<p>Try this variant on the <a href=\"http://play.golang.org/p/Yp-QEOatF2\" rel=\"nofollow\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 3424, "user_id": 3918985, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4349dc6a41c144c486e982afb327fca7?s=128&d=identicon&r=PG&f=1", "display_name": "user3918985", "link": "https://stackoverflow.com/users/3918985/user3918985"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "accepted_answer_id": 29741711, "answer_count": 1, "score": 2, "last_activity_date": 1475436382, "creation_date": 1429514282, "last_edit_date": 1475436382, "question_id": 29741487, "link": "https://stackoverflow.com/questions/29741487/escape-html-in-array-field-in-struct", "title": "Escape HTML in array field in struct", "body": "<p>How do I escape HTML when I have an array field in a struct?</p>\n\n<p>For a single show page, this code works:</p>\n\n<p>show.go:</p>\n\n<pre><code>err := ShowTmpl.ExecuteTemplate(w, \"show.html\", struct {\n        Title    string\n        SafeBody template.HTML\n}{\n    t.Title,\n    template.HTML(t.BodyHTML),\n})\n</code></pre>\n\n<p>For an index page:</p>\n\n<p>index.go</p>\n\n<pre><code>type as struct {\n        Articles []*Article\n    }\nvar a as\n\n// some code to give a.Articles its values\n\nerr := IndexTmpl.ExecuteTemplate(w, \"index.html\", a)\nif err != nil {\n    http.Error(w, err.Error(), http.StatusInternalServerError)\n}\n</code></pre>\n\n<p>index.html:</p>\n\n<pre><code>{{with .Articles}}\n  {{range .}}\n    &lt;a href=\"/\"&gt;{{.Title}}&lt;/a&gt;\n    {{.BodyHTML | html}} // Doesn't work\n  {{end}}\n{{end}}\n</code></pre>\n\n<p>How do I escape HTML when I'm ranging over a struct field?</p>\n"}, {"tags": ["pointers", "dictionary", "struct", "go"], "answers": [{"comments": [{"owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "edited": false, "score": 3, "creation_date": 1429498559, "post_id": 29738472, "comment_id": 47610363, "body": "This is the right answer. The behavior is very subtle, so if it&#39;s not clear in the original example <code>&amp;thing</code> returns the address of the local variable in the loop. The spec says  &quot;their scope is the block of the &quot;for&quot; statement; they are re-used in each iteration.&quot; So since <code>thing</code> is the same variable each time the address ends up being the same as well."}], "tags": [], "owner": {"reputation": 196, "user_id": 4752457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee3e44ad3132013d9ea4ed720bb5ee4a?s=128&d=identicon&r=PG", "display_name": "user4752457", "link": "https://stackoverflow.com/users/4752457/user4752457"}, "is_accepted": true, "score": 3, "last_activity_date": 1429497672, "last_edit_date": 1429497672, "creation_date": 1429497339, "answer_id": 29738472, "question_id": 29738391, "link": "https://stackoverflow.com/questions/29738391/creating-a-map-from-an-array-of-struct-pointers/29738472#29738472", "title": "Creating a map from an array of struct pointers", "body": "<p>Each map value is a pointer to the single local variable <code>thing</code>.</p>\n\n<p>One fix is to add an pointer to the slice element:</p>\n\n<pre><code>func toRegistry(things []Thing) Registry {\n\n  registry := make(Registry)\n\n  for i := range things {\n    registry[things[i].Name] = &amp;things[i]\n  }\n  return registry\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/kBBEOXMgu5\" rel=\"nofollow\">playground</a></p>\n\n<p>Another option is to store pointers to <code>Thing</code> in the slice:</p>\n\n<pre><code>func toRegistry(things []*Thing) Registry {\n  registry := make(Registry)\n  for _, thing := range things {\n    registry[thing.Name] = thing\n  }\n  return registry\n}\n\nfunc main() {\n  things := []*Thing{&amp;Thing{\"thingA\", 1}, &amp;Thing{\"thingB\", 2}}\n  registry := toRegistry(things)\n  fmt.Println(registry)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ovwC-F-997\" rel=\"nofollow\">playground</a></p>\n\n<p>I changed the function argument from a pointer to a slice to a slice. This change has no impact on the issue raised on the question, but it's generally how Go code is written. Pointers to slices are rarely used in Go.</p>\n"}, {"comments": [{"owner": {"reputation": 10154, "user_id": 2482570, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/1U8oq.jpg?s=128&g=1", "display_name": "Max Heiber", "link": "https://stackoverflow.com/users/2482570/max-heiber"}, "edited": false, "score": 0, "creation_date": 1429498084, "post_id": 29738513, "comment_id": 47610250, "body": "would @tvblah&#39;s solution be more efficient?"}, {"owner": {"reputation": 196, "user_id": 4752457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee3e44ad3132013d9ea4ed720bb5ee4a?s=128&d=identicon&r=PG", "display_name": "user4752457", "link": "https://stackoverflow.com/users/4752457/user4752457"}, "reply_to_user": {"reputation": 10154, "user_id": 2482570, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/1U8oq.jpg?s=128&g=1", "display_name": "Max Heiber", "link": "https://stackoverflow.com/users/2482570/max-heiber"}, "edited": false, "score": 2, "creation_date": 1429498514, "post_id": 29738513, "comment_id": 47610351, "body": "@mheiber The three solutions are logically different.  This one stores a pointer to a newly allocated <code>Thing</code>.  The first of my solutions stores a pointer to the slice element.  The second of my solutions stores whatever the pointer is in the slice.  The logic in your application may dictate the choice.  This solution allocates a <code>Thing</code> on each iteration through the loop. My solutions do not.  The extra allocation will have a negligible impact on performance."}, {"owner": {"reputation": 587, "user_id": 3587115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/veo3Q.jpg?s=128&g=1", "display_name": "Sundrique", "link": "https://stackoverflow.com/users/3587115/sundrique"}, "reply_to_user": {"reputation": 10154, "user_id": 2482570, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/1U8oq.jpg?s=128&g=1", "display_name": "Max Heiber", "link": "https://stackoverflow.com/users/2482570/max-heiber"}, "edited": false, "score": 2, "creation_date": 1429498693, "post_id": 29738513, "comment_id": 47610401, "body": "@mheiber, my solution is a bit less efficient due to allocation of new variable."}], "tags": [], "owner": {"reputation": 587, "user_id": 3587115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/veo3Q.jpg?s=128&g=1", "display_name": "Sundrique", "link": "https://stackoverflow.com/users/3587115/sundrique"}, "is_accepted": false, "score": 2, "last_activity_date": 1429497727, "creation_date": 1429497727, "answer_id": 29738513, "question_id": 29738391, "link": "https://stackoverflow.com/questions/29738391/creating-a-map-from-an-array-of-struct-pointers/29738513#29738513", "title": "Creating a map from an array of struct pointers", "body": "<p>You may reassign <code>thing</code> to another local variable on each iteration and store new variable in registry.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Thing struct {\n    Name  string\n    Value int\n}\n\ntype Registry map[string]*Thing\n\nfunc toRegistry(things *[]Thing) Registry {\n\n    registry := make(Registry)\n\n    for _, thing := range *things {\n        t := thing\n        registry[thing.Name] = &amp;t\n    }\n    return registry\n}\n\nfunc main() {\n\n    things := []Thing{{\"thingA\", 1}, {\"thingB\", 2}}\n    registry := toRegistry(&amp;things)\n    fmt.Println(registry)\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/cX9svslZjW\" rel=\"nofollow\">Playground</a></p>\n"}], "owner": {"reputation": 10154, "user_id": 2482570, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/1U8oq.jpg?s=128&g=1", "display_name": "Max Heiber", "link": "https://stackoverflow.com/users/2482570/max-heiber"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 29738472, "answer_count": 2, "score": 1, "last_activity_date": 1429498510, "creation_date": 1429496774, "last_edit_date": 1429498510, "question_id": 29738391, "link": "https://stackoverflow.com/questions/29738391/creating-a-map-from-an-array-of-struct-pointers", "title": "Creating a map from an array of struct pointers", "body": "<p>I have an array of pointers to structs. The structs have a <code>name</code> field. I want to create a map from names to pointers to structs. </p>\n\n<p>Why are all of the values in the <code>registry</code> map identical?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Thing struct {\n    Name  string\n    Value int\n}\n\ntype Registry map[string]*Thing\n\nfunc toRegistry(things *[]Thing) Registry {\n\n    registry := make(Registry)\n\n    for _, thing := range *things {\n        registry[thing.Name] = &amp;thing\n    }\n    return registry\n}\n\nfunc main() {\n\n    things := []Thing{{\"thingA\", 1}, {\"thingB\", 2}}\n    registry := toRegistry(&amp;things)\n    fmt.Println(registry)\n\n}\n</code></pre>\n\n<p>Sample output: <code>map[thingB:0x10436180 thingA:0x10436180]</code></p>\n\n<p><a href=\"https://play.golang.org/p/OJ0_Tfxtsf\" rel=\"nofollow\">GO</a></p>\n\n<h2>EDIT</h2>\n\n<p>Per @tvblah's suggestion, <code>things</code> was already a slice, so there's no need to point to it:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Thing struct {\n    Name  string\n    Value int\n}\n\ntype Registry map[string]*Thing\n\nfunc toRegistry(things []Thing) Registry {\n\n    registry := make(Registry)\n\n    for _, thing := range things {\n        registry[thing.Name] = &amp;thing\n    }\n    return registry\n}\n\nfunc main() {\n\n    things := []Thing{{\"thingA\", 1}, {\"thingB\", 2}}\n    registry := toRegistry(things)\n    fmt.Println(registry)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/tbZt6WWyEd\" rel=\"nofollow\">GO</a></p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 463, "user_id": 515970, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/NJ3hT.png?s=128&g=1", "display_name": "oliveromahony", "link": "https://stackoverflow.com/users/515970/oliveromahony"}, "is_accepted": true, "score": 4, "last_activity_date": 1429488993, "creation_date": 1429488993, "answer_id": 29737439, "question_id": 29737416, "link": "https://stackoverflow.com/questions/29737416/how-can-i-omit-a-field-when-importing-json/29737439#29737439", "title": "How can I omit a field when importing JSON?", "body": "<p>The space seems to matter:</p>\n\n<pre><code>Baz bool `json:\"-\"`\n</code></pre>\n\n<p>Prints:</p>\n\n<pre><code>{true false}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/U3tvJ7N9OU\" rel=\"nofollow\">Go</a></p>\n"}, {"tags": [], "owner": {"reputation": 10154, "user_id": 2482570, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/1U8oq.jpg?s=128&g=1", "display_name": "Max Heiber", "link": "https://stackoverflow.com/users/2482570/max-heiber"}, "is_accepted": false, "score": 1, "last_activity_date": 1429502036, "last_edit_date": 1429502036, "creation_date": 1429501069, "answer_id": 29738948, "question_id": 29737416, "link": "https://stackoverflow.com/questions/29737416/how-can-i-omit-a-field-when-importing-json/29738948#29738948", "title": "How can I omit a field when importing JSON?", "body": "<p>Another option is <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow\">to not export</a> the fields you want to omit. Note the lowercase <code>baz</code> in the struct definition:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nvar data = []byte(`{\"bar\": true, \"baz\": true}`)\n\ntype Foo struct {\n    Bar bool\n    baz bool\n}\n\nfunc main() {\n    var foo Foo\n    json.Unmarshal(data, &amp;foo)\n\n    fmt.Println(foo)\n}\n</code></pre>\n\n<p>Prints </p>\n\n<p><code>{true false}</code></p>\n\n<p><a href=\"http://play.golang.org/p/kGZsVBGXC9\" rel=\"nofollow\">GO</a></p>\n"}], "owner": {"reputation": 10154, "user_id": 2482570, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/1U8oq.jpg?s=128&g=1", "display_name": "Max Heiber", "link": "https://stackoverflow.com/users/2482570/max-heiber"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 29737439, "answer_count": 2, "score": 1, "last_activity_date": 1429502036, "creation_date": 1429488790, "question_id": 29737416, "link": "https://stackoverflow.com/questions/29737416/how-can-i-omit-a-field-when-importing-json", "title": "How can I omit a field when importing JSON?", "body": "<p>How can I unmarshall json into a Go struct and omit a specific field? <a href=\"http://golang.org/pkg/encoding/json/\" rel=\"nofollow\">The docs</a> say I can tag a field with <code>json: \"-\"</code> to omit it, but this doesn't appear to do anything:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nvar data = []byte(`{\"bar\": true, \"baz\": true}`)\n\ntype Foo struct {\n    Bar bool `json: \"bar\"`\n    Baz bool `json: \"-\"`\n}\n\nfunc main() {\n    var foo Foo\n    json.Unmarshal(data, &amp;foo)\n\n    fmt.Println(foo)\n}\n</code></pre>\n\n<p>prints  <code>{true, true}</code></p>\n\n<p>If tagging the <code>Baz</code> field with <code>json: \"-\"</code> worked, I would expect to <code>{true, false}</code> to print. What went wrong?</p>\n\n<p><a href=\"http://play.golang.org/p/uVjv0TR5dd\" rel=\"nofollow\">Go Playground link</a></p>\n"}, {"tags": ["go", "sudo"], "comments": [{"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1429468499, "post_id": 29733575, "comment_id": 47601283, "body": "Why do you need this functionality?"}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1429469220, "post_id": 29733575, "comment_id": 47601594, "body": "That&#39;s unconventional. If the user proved he is worthy of being root any way, why do you need to write down who that user was? It&#39;s not that <code>sudo</code> doesn&#39;t keep logs on its own."}, {"owner": {"reputation": 2731, "user_id": 74361, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/adca63afb01fa2d56850114c337476fb?s=128&d=identicon&r=PG", "display_name": "Bart Silverstrim", "link": "https://stackoverflow.com/users/74361/bart-silverstrim"}, "reply_to_user": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1429469281, "post_id": 29733575, "comment_id": 47601623, "body": "For troubleshooting the utility&#39;s use with it&#39;s own logging."}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1429469356, "post_id": 29733575, "comment_id": 47601653, "body": "Sorry, but what&#39;s the problem with looking in the sudo log (part of <code>&#47;var&#47;log&#47;auth.log</code>) like with any other application? If you want to know who invoked the application, you could consider making it suid root. In this case, one of the uids (forgot which one) is the uid of the original user."}, {"owner": {"reputation": 2731, "user_id": 74361, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/adca63afb01fa2d56850114c337476fb?s=128&d=identicon&r=PG", "display_name": "Bart Silverstrim", "link": "https://stackoverflow.com/users/74361/bart-silverstrim"}, "reply_to_user": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1429469508, "post_id": 29733575, "comment_id": 47601731, "body": "It seemed lot simpler for a small utility that someone is going to run on their system for troubleshooting to have a single log to zip up and send than for me to query their logfiles or explain to them how to do the queries through their logfiles. It helped keep the entire thing more self-contained."}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1429469598, "post_id": 29733575, "comment_id": 47601759, "body": "And why does it matter who executed the utility? <code>sudo</code> is designed to alter the user a program runs under, so it&#39;s always root who executes your program. You could try working with capabilities instead."}, {"owner": {"reputation": 2731, "user_id": 74361, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/adca63afb01fa2d56850114c337476fb?s=128&d=identicon&r=PG", "display_name": "Bart Silverstrim", "link": "https://stackoverflow.com/users/74361/bart-silverstrim"}, "reply_to_user": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 1, "creation_date": 1429469829, "post_id": 29733575, "comment_id": 47601846, "body": "Always being root who runs the program when sudo is invoked is probably related to why I asked the question in the first place."}], "answers": [{"comments": [{"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 3, "creation_date": 1429469278, "post_id": 29733790, "comment_id": 47601621, "body": "Please remember that it&#39;s possible to override or fake these variables."}], "tags": [], "owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "is_accepted": true, "score": 12, "last_activity_date": 1429466960, "last_edit_date": 1495541748, "creation_date": 1429466960, "answer_id": 29733790, "question_id": 29733575, "link": "https://stackoverflow.com/questions/29733575/how-to-find-the-user-that-executed-a-program-as-root-using-golang/29733790#29733790", "title": "How to find the user that executed a program as root using Golang?", "body": "<p>sudo creates the <code>SUDO_UID</code>/<code>SUDO_GID</code> and the <code>SUDO_USER</code> environment variables for this, which contains the user id, group id and username of the account invoking sudo. See e.g. <a href=\"https://stackoverflow.com/questions/10272784/how-do-i-get-the-users-real-uid-if-the-program-is-run-with-sudo\">here</a></p>\n\n<p>So in Go you can read those environment variables with <a href=\"http://golang.org/pkg/os/#Getenv\" rel=\"noreferrer\">os.Getenv()</a>.</p>\n\n<p>You might want to trust those variables only if running as root, i.e. if <a href=\"http://golang.org/pkg/os/#Geteuid\" rel=\"noreferrer\">os.Geteuid()</a> returns 0</p>\n"}, {"comments": [{"owner": {"reputation": 27690, "user_id": 362589, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/125a471032cdef6e8de28ff6d54c7324?s=128&d=identicon&r=PG", "display_name": "Dani", "link": "https://stackoverflow.com/users/362589/dani"}, "edited": false, "score": 0, "creation_date": 1597260983, "post_id": 63363535, "comment_id": 112078488, "body": "Is the comparison to root any better than uid == 0?"}, {"owner": {"reputation": 120, "user_id": 8741421, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52db06f50e6b5ea90bbb96d9b6fe0baf?s=128&d=identicon&r=PG", "display_name": "Nick Saccente", "link": "https://stackoverflow.com/users/8741421/nick-saccente"}, "reply_to_user": {"reputation": 27690, "user_id": 362589, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/125a471032cdef6e8de28ff6d54c7324?s=128&d=identicon&r=PG", "display_name": "Dani", "link": "https://stackoverflow.com/users/362589/dani"}, "edited": false, "score": 0, "creation_date": 1597595598, "post_id": 63363535, "comment_id": 112178225, "body": "I want to say that it doesn&#39;t matter, but I&#39;m not sure. For me, checking for the string literal root feels a lot easier to read by someone picking up my code later."}, {"owner": {"reputation": 367, "user_id": 7006343, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Fme6K.jpg?s=128&g=1", "display_name": "Ali Tahir", "link": "https://stackoverflow.com/users/7006343/ali-tahir"}, "edited": false, "score": 0, "creation_date": 1600061639, "post_id": 63363535, "comment_id": 112957802, "body": "if getProcessOwner() == &quot;root&quot; this evaluates to false because of newline character. if getProcessOwner() == &quot;root\\n&quot; evaluates to true"}, {"owner": {"reputation": 120, "user_id": 8741421, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52db06f50e6b5ea90bbb96d9b6fe0baf?s=128&d=identicon&r=PG", "display_name": "Nick Saccente", "link": "https://stackoverflow.com/users/8741421/nick-saccente"}, "edited": false, "score": 0, "creation_date": 1600394141, "post_id": 63363535, "comment_id": 113081150, "body": "The \\n wasn&#39;t needed for me, I run Fedora 31. I wonder if it varies based on distribution? I&#39;d say a partial match would be a better overall solution, but then an adversary could create a user named &quot;groot&quot; or &quot;rooty&quot; and it would technically match."}], "tags": [], "owner": {"reputation": 120, "user_id": 8741421, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52db06f50e6b5ea90bbb96d9b6fe0baf?s=128&d=identicon&r=PG", "display_name": "Nick Saccente", "link": "https://stackoverflow.com/users/8741421/nick-saccente"}, "is_accepted": false, "score": 5, "last_activity_date": 1597260798, "last_edit_date": 1597260798, "creation_date": 1597167388, "answer_id": 63363535, "question_id": 29733575, "link": "https://stackoverflow.com/questions/29733575/how-to-find-the-user-that-executed-a-program-as-root-using-golang/63363535#63363535", "title": "How to find the user that executed a program as root using Golang?", "body": "<p>Since anyone can set <code>SUDO_UID</code>, <code>SUDO_GID</code> and <code>SUDO_USER</code>, an attacker can just export those themselves and bypass the security you're trying to implement.</p>\n<p>The way that I've found, is to find the pid of the Go program you're currently running, get the name of the user that owns that pid, then check if its <code>root</code>.</p>\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    &quot;fmt&quot;\n    &quot;os&quot;\n    &quot;os/exec&quot;\n    &quot;strconv&quot;\n)\n\nfunc main() {\n    if getProcessOwner() == &quot;root&quot; {\n        fmt.Println(&quot;You're sudo!&quot;)\n    }\n}\n\nfunc getProcessOwner() string {\n    stdout, err := exec.Command(&quot;ps&quot;, &quot;-o&quot;, &quot;user=&quot;, &quot;-p&quot;, strconv.Itoa(os.Getpid())).Output()\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    return string(stdout)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 619, "user_id": 3971297, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/KyMJL.png?s=128&g=1", "display_name": "Alfonso M. Garc&#237;a Astorga", "link": "https://stackoverflow.com/users/3971297/alfonso-m-garc%c3%ada-astorga"}, "is_accepted": false, "score": 0, "last_activity_date": 1615726804, "creation_date": 1615726804, "answer_id": 66624820, "question_id": 29733575, "link": "https://stackoverflow.com/questions/29733575/how-to-find-the-user-that-executed-a-program-as-root-using-golang/66624820#66624820", "title": "How to find the user that executed a program as root using Golang?", "body": "<p>Here's how I check if the current user is <code>root</code> in the most Golang's recent version <code>go1.16.1</code>:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;log&quot;\n    &quot;os/user&quot;\n)\n\nfunc isRoot() bool {\n    currentUser, err := user.Current()\n    if err != nil {\n        log.Fatalf(&quot;[isRoot] Unable to get current user: %s&quot;, err)\n    }\n    return currentUser.Username == &quot;root&quot;\n}\n\nfunc main() {   \n    fmt.Printf(&quot;Am I root? %v&quot;, isRoot())\n\n}\n</code></pre>\n<p><a href=\"https://play.golang.org/p/tRMR5IW6GAc\" rel=\"nofollow noreferrer\">https://play.golang.org/p/tRMR5IW6GAc</a></p>\n"}], "owner": {"reputation": 2731, "user_id": 74361, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/adca63afb01fa2d56850114c337476fb?s=128&d=identicon&r=PG", "display_name": "Bart Silverstrim", "link": "https://stackoverflow.com/users/74361/bart-silverstrim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5298, "favorite_count": 3, "accepted_answer_id": 29733790, "answer_count": 3, "score": 10, "last_activity_date": 1615726804, "creation_date": 1429465851, "last_edit_date": 1614950337, "question_id": 29733575, "link": "https://stackoverflow.com/questions/29733575/how-to-find-the-user-that-executed-a-program-as-root-using-golang", "title": "How to find the user that executed a program as root using Golang?", "body": "<p>I'm creating a small program that requires privileged access to a network port below 1024, so it runs with sudo.</p>\n<p>If part of what the utility will need to do requires knowing who the user is that invoked the application, I would need a way to query who the actual user is; using the <code>OS/user</code> method of getting the user points to &quot;System Administrator&quot; or other root user because it's running in a sudo context.</p>\n<p>Is there a way in GoLang to pull the user who is running the application under sudo? (Go 1.4.2, running on OS X 10.10.3).</p>\n"}, {"tags": ["nginx", "go"], "answers": [{"tags": [], "owner": {"reputation": 1966, "user_id": 2739942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fbb10b8c7115b8c44459363fb6476cf?s=128&d=identicon&r=PG", "display_name": "divan", "link": "https://stackoverflow.com/users/2739942/divan"}, "is_accepted": true, "score": 5, "last_activity_date": 1429466619, "creation_date": 1429466619, "answer_id": 29733725, "question_id": 29733371, "link": "https://stackoverflow.com/questions/29733371/how-do-i-use-nginx-with-go-for-a-subdomain/29733725#29733725", "title": "How do I use nginx with Go for a subdomain?", "body": "<p>You can connect Nginx to your Go program directly via proxy_pass.\nGiven:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hi there, I love %s!\", r.URL.Path[1:])\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", handler)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>You just need to add to your nginx configuration the proxy_pass:</p>\n\n<pre><code>location @go {\n    proxy_pass            127.0.0.1:8080;\n}\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 1217455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82558359deb98c6ed4491015f8eaa08c?s=128&d=identicon&r=PG", "display_name": "iHuman", "link": "https://stackoverflow.com/users/1217455/ihuman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 1, "closed_date": 1429518981, "accepted_answer_id": 29733725, "answer_count": 1, "score": 3, "last_activity_date": 1429466619, "creation_date": 1429464756, "question_id": 29733371, "link": "https://stackoverflow.com/questions/29733371/how-do-i-use-nginx-with-go-for-a-subdomain", "closed_reason": "Not suitable for this site", "title": "How do I use nginx with Go for a subdomain?", "body": "<p>I have a simple go program that uses http.ListenAndServe to serve content. I use nginx to serve multiple applications on one server, and I want to use it for the go program too. I've tried looking for information on it, but all I found people using FastCGI or node.js to get it to work. Is it possible to do it with just pure Go and nginx? I understand how to use nginx with a subdomain, but not a Go program.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1429459008, "post_id": 29732128, "comment_id": 47597541, "body": "You should include relevant code in your question rather than relying on a link."}, {"owner": {"reputation": 2293, "user_id": 1098584, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7ab6b6d44e367a743580c3089026b7bc?s=128&d=identicon&r=PG", "display_name": "sontags", "link": "https://stackoverflow.com/users/1098584/sontags"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1429459467, "post_id": 29732128, "comment_id": 47597694, "body": "I included the example"}], "answers": [{"tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": true, "score": 5, "last_activity_date": 1429460502, "creation_date": 1429460502, "answer_id": 29732469, "question_id": 29732128, "link": "https://stackoverflow.com/questions/29732128/copy-net-ip-in-golang/29732469#29732469", "title": "Copy net.IP in Golang", "body": "<p>Look at the <a href=\"https://golang.org/pkg/net/#IP\" rel=\"noreferrer\">documentation for <code>net.IP</code></a>; it's just a <code>[]byte</code> so you could use the <a href=\"https://golang.org/pkg/builtin/#copy\" rel=\"noreferrer\"><code>copy</code> builtin</a>.</p>\n\n<p>E.g.:</p>\n\n<pre><code>func dupIP(ip net.IP) net.IP {\n    dup := make(net.IP, len(ip))\n    copy(dup, ip)\n    return dup\n}\n</code></pre>\n\n<p>If you care about space, you can also note from the documentation that although all the <code>net</code> routines support a <code>net.IP</code> of length 4 (e.g.\u00a0<code>ip := net.IP([]byte{1, 2, 3, 4}</code>) will work) all the ones they generate are 16\u00a0bytes. Since you make a whole bunch, if you care about a few bytes of space, or if you care what happens after 255.255.255.255, you can avoid this for IPv4 like so:</p>\n\n<pre><code>func dupIP(ip net.IP) net.IP {\n    // To save space, try and only use 4 bytes\n    if x := ip.To4(); x != nil {\n        ip = x\n    }\n    dup := make(net.IP, len(ip))\n    copy(dup, ip)\n    return dup\n}\n</code></pre>\n\n<p>You may want to do something different for IPv6 addresses, I don't think it makes sense to \"increment\" an IPv6 the way you do, I could be wrong though.</p>\n\n<p>Modified version of your original:\n<a href=\"https://play.golang.org/p/GP9vASvUgh\" rel=\"noreferrer\">https://play.golang.org/p/GP9vASvUgh</a></p>\n"}], "owner": {"reputation": 2293, "user_id": 1098584, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7ab6b6d44e367a743580c3089026b7bc?s=128&d=identicon&r=PG", "display_name": "sontags", "link": "https://stackoverflow.com/users/1098584/sontags"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3419, "favorite_count": 0, "accepted_answer_id": 29732469, "answer_count": 1, "score": 3, "last_activity_date": 1429460502, "creation_date": 1429458815, "last_edit_date": 1429459405, "question_id": 29732128, "link": "https://stackoverflow.com/questions/29732128/copy-net-ip-in-golang", "title": "Copy net.IP in Golang", "body": "<p>I try to copy the value of a net.IP instance (line 14 and 19) but obviously just pass around the pointer:</p>\n\n<p><a href=\"http://play.golang.org/p/xmYQrsf496\" rel=\"nofollow\">http://play.golang.org/p/xmYQrsf496</a></p>\n\n<p>What am I doing wrong?</p>\n\n<p>CODE as requested:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net\"\n)\n\ntype Range struct {\n    Start net.IP `json:\"start\"`\n    End   net.IP `json:\"end\"`\n}\n\nfunc (r Range) Expand() []net.IP {\n    next := r.Start // here (line 14)\n    out := []net.IP{next}\n\n    for !next.Equal(r.End) {\n        incIP(next)\n        out = append(out, next) // and here (line 19)\n    }\n\n    return out\n}\n\nfunc incIP(ip net.IP) {\n    for j := len(ip) - 1; j &gt;= 0; j-- {\n        ip[j]++\n        if ip[j] &gt; 0 {\n            break\n        }\n    }\n}\n\nfunc main() {\n    r := Range{\n        Start: net.ParseIP(\"192.100.10.4\"),\n        End:   net.ParseIP(\"192.100.13.1\"),\n    }\n    out := r.Expand()\n    log.Print(r)\n    log.Print(out)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5661, "user_id": 3179857, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/74a01200b8e1bc8b9b57ddd5633288bc?s=128&d=identicon&r=PG", "display_name": "Evan", "link": "https://stackoverflow.com/users/3179857/evan"}, "edited": false, "score": 0, "creation_date": 1429462045, "post_id": 29732049, "comment_id": 47598730, "body": "It is evaluated in the general case, although in this particular example I would not be surprised if the compiler optimized it into a constant."}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "reply_to_user": {"reputation": 5661, "user_id": 3179857, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/74a01200b8e1bc8b9b57ddd5633288bc?s=128&d=identicon&r=PG", "display_name": "Evan", "link": "https://stackoverflow.com/users/3179857/evan"}, "edited": false, "score": 0, "creation_date": 1429468404, "post_id": 29732049, "comment_id": 47601238, "body": "@Evan OP asked about whether a call to <code>cap()</code> on a channel is a constant expression as there are certain places where only constant expressions are allowed. Even if the compiler could optimize the call to <code>cap()</code> into a constant, that wouldn&#39;t make the call a constant expression."}], "answers": [{"tags": [], "owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "is_accepted": true, "score": 4, "last_activity_date": 1429459329, "creation_date": 1429459329, "answer_id": 29732223, "question_id": 29732049, "link": "https://stackoverflow.com/questions/29732049/cap-on-channel-is-not-constant/29732223#29732223", "title": "cap() on channel is not constant?", "body": "<p>Yes, <code>cap()</code> is not constant when applied to a channel, as the capacity of a channel isn't encoded in the type and thus not known at compile time.</p>\n"}, {"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 1, "last_activity_date": 1429459757, "creation_date": 1429459757, "answer_id": 29732320, "question_id": 29732049, "link": "https://stackoverflow.com/questions/29732049/cap-on-channel-is-not-constant/29732320#29732320", "title": "cap() on channel is not constant?", "body": "<p>Sure  call cap(ch) evaluated, just because of</p>\n\n<pre><code>ch := make(chan int, 10)\nfmt.Println(cap(ch))\nch = make(chan int, 9)\nfmt.Println(cap(ch))\n</code></pre>\n\n<p>Proof-link <a href=\"https://play.golang.org/p/R0TfCpC-4L\" rel=\"nofollow\">https://play.golang.org/p/R0TfCpC-4L</a></p>\n"}], "owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 673, "favorite_count": 0, "accepted_answer_id": 29732223, "answer_count": 2, "score": 2, "last_activity_date": 1429459757, "creation_date": 1429458473, "question_id": 29732049, "link": "https://stackoverflow.com/questions/29732049/cap-on-channel-is-not-constant", "title": "cap() on channel is not constant?", "body": "<pre><code>ch := make(chan int, 10)\nfmt.Println(cap(ch))\n</code></pre>\n\n<p>is function call <code>cap(ch)</code> <em>constant</em> or <em>evaluated</em>?     </p>\n\n<p>golang spec said:</p>\n\n<blockquote>\n  <p>The expression len(s) is constant if s is a string constant. The expressions len(s) and cap(s) are constants if the type of s is an array or pointer to an array and the expression s does not contain channel receives or (non-constant) function calls; in this case s is not evaluated. Otherwise, invocations of len and cap are not constant and s is evaluated.</p>\n</blockquote>\n\n<p>seems that is <em>evaluated</em>.</p>\n"}, {"tags": ["error-handling", "go"], "answers": [{"comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 10154, "user_id": 2482570, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/1U8oq.jpg?s=128&g=1", "display_name": "Max Heiber", "link": "https://stackoverflow.com/users/2482570/max-heiber"}, "edited": false, "score": 8, "creation_date": 1429384454, "post_id": 29721505, "comment_id": 47577859, "body": "If you&#39;re going to use stderr to actually log things, use a logger. Otherwise, a simple <code>os.Stderr.WriteString</code> will suffice, IMO."}, {"owner": {"reputation": 3320, "user_id": 99209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfe9b4ae69a4b4eaf0fd53c920b5708e?s=128&d=identicon&r=PG", "display_name": "Andrioid", "link": "https://stackoverflow.com/users/99209/andrioid"}, "edited": false, "score": 1, "creation_date": 1540456633, "post_id": 29721505, "comment_id": 92875320, "body": "Best answer. Although, my personal preference is using fmt.Fprintf or fmt.Fprintln. If you&#39;re doing this many places in your program, maybe wrap it in a function then you can easily change stderr to stdout or whatever writer you want."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 108, "last_activity_date": 1440073220, "last_edit_date": 1440073220, "creation_date": 1429383499, "answer_id": 29721505, "question_id": 29721449, "link": "https://stackoverflow.com/questions/29721449/how-can-i-print-to-stderr-in-go-without-using-log/29721505#29721505", "title": "How can I print to Stderr in Go without using log", "body": "<p>If you don't want timestamps, just create a new <a href=\"http://golang.org/pkg/log/#Logger\"><code>log.Logger</code></a> with <code>flag</code> set to <code>0</code>:</p>\n\n<pre><code>l := log.New(os.Stderr, \"\", 0)\nl.Println(\"log msg\")\n</code></pre>\n\n<p><strong>EDIT:</strong></p>\n\n<blockquote>\n  <p>Is the following good Go?</p>\n\n<pre><code>os.Stderr.WriteString(\"Message\")\n</code></pre>\n</blockquote>\n\n<p>This is acceptable, and you can also use <a href=\"http://golang.org/pkg/fmt/#Fprintf\"><code>fmt.Fprintf</code></a> and friends to get formatted output:</p>\n\n<pre><code>fmt.Fprintf(os.Stderr, \"number of foo: %d\", nFoo)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5422, "user_id": 495598, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b89400f35ab9d516bcedf0f0f883bb41?s=128&d=identicon&r=PG&f=1", "display_name": "Manu Manjunath", "link": "https://stackoverflow.com/users/495598/manu-manjunath"}, "edited": false, "score": 0, "creation_date": 1613985485, "post_id": 29721532, "comment_id": 117235390, "body": "This should&#39;ve been the accepted answer"}], "tags": [], "owner": {"reputation": 14981, "user_id": 2679935, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/wU0qy.jpg?s=128&g=1", "display_name": "julienc", "link": "https://stackoverflow.com/users/2679935/julienc"}, "is_accepted": false, "score": 87, "last_activity_date": 1429383619, "creation_date": 1429383619, "answer_id": 29721532, "question_id": 29721449, "link": "https://stackoverflow.com/questions/29721449/how-can-i-print-to-stderr-in-go-without-using-log/29721532#29721532", "title": "How can I print to Stderr in Go without using log", "body": "<p>Using the <code>fmt</code> package, you can choose to write to <code>stderr</code> this way:</p>\n\n<pre><code>import \"fmt\"\nimport \"os\"\n\nfunc main() {\n    fmt.Fprintln(os.Stderr, \"hello world\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "is_accepted": false, "score": 18, "last_activity_date": 1429389729, "creation_date": 1429389729, "answer_id": 29722621, "question_id": 29721449, "link": "https://stackoverflow.com/questions/29721449/how-can-i-print-to-stderr-in-go-without-using-log/29722621#29722621", "title": "How can I print to Stderr in Go without using log", "body": "<p><a href=\"http://golang.org/pkg/os/#Stderr\" rel=\"noreferrer\"><code>os.Stderr</code></a> is an <a href=\"http://golang.org/pkg/io/#Writer\" rel=\"noreferrer\"><code>io.Writer</code></a>, so you can use it in any function which accepts an <code>io.Writer</code>. Here are a few examples:</p>\n\n<pre><code>str := \"Message\"\nfmt.Fprintln(os.Stderr, str)\nio.WriteString(os.Stderr, str)\nio.Copy(os.Stderr, bytes.NewBufferString(str))\nos.Stderr.Write([]byte(str))\n</code></pre>\n\n<p>It all depends on how exactly you have the string you want to print (i.e. if you want to format it first, if you have it as an <a href=\"http://golang.org/pkg/io/#Reader\" rel=\"noreferrer\"><code>io.Reader</code></a>, if you have it as a byte slice...). And there can be a lot more ways.</p>\n"}, {"tags": [], "owner": {"reputation": 2071, "user_id": 613218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/684181648a42e890164a9582f0e73257?s=128&d=identicon&r=PG", "display_name": "Gus E", "link": "https://stackoverflow.com/users/613218/gus-e"}, "is_accepted": false, "score": 7, "last_activity_date": 1448294046, "creation_date": 1448294046, "answer_id": 33875186, "question_id": 29721449, "link": "https://stackoverflow.com/questions/29721449/how-can-i-print-to-stderr-in-go-without-using-log/33875186#33875186", "title": "How can I print to Stderr in Go without using log", "body": "<p>By default the logger flags are set to <code>Ldate | Ltime</code>. You can change the logger format to any of the following (from the <a href=\"https://golang.org/pkg/log/#pkg-constants\" rel=\"noreferrer\">golang log documentation</a>):</p>\n\n<pre><code>Ldate         = 1 &lt;&lt; iota     // the date in the local time zone: 2009/01/23\nLtime                         // the time in the local time zone: 01:23:23\nLmicroseconds                 // microsecond resolution: 01:23:23.123123.  assumes Ltime.\nLlongfile                     // full file name and line number: /a/b/c/d.go:23\nLshortfile                    // final file name element and line number: d.go:23. overrides Llongfile\nLUTC                          // if Ldate or Ltime is set, use UTC rather than the local time zone\nLstdFlags     = Ldate | Ltime // initial values for the standard logger\n</code></pre>\n\n<p>For example, flags Ldate | Ltime (or LstdFlags) produce,</p>\n\n<pre><code>2009/01/23 01:23:23 message\n</code></pre>\n\n<p>While flags Ldate | Ltime | Lmicroseconds | Llongfile produce,</p>\n\n<pre><code>2009/01/23 01:23:23.123123 /a/b/c/d.go:23: message\n</code></pre>\n\n<p>You can also set the default logger to not print anything by setting the flag to 0:</p>\n\n<pre><code>log.SetFlags(0)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 27, "user_id": 10491710, "user_type": "registered", "profile_image": "https://graph.facebook.com/10156933891493982/picture?type=large", "display_name": "Max", "link": "https://stackoverflow.com/users/10491710/max"}, "is_accepted": false, "score": -1, "last_activity_date": 1539398515, "creation_date": 1539398515, "answer_id": 52789043, "question_id": 29721449, "link": "https://stackoverflow.com/questions/29721449/how-can-i-print-to-stderr-in-go-without-using-log/52789043#52789043", "title": "How can I print to Stderr in Go without using log", "body": "<p>use SetOutput function, set output stream to os.Stdout</p>\n\n<pre><code>import (\n    \"log\"\n    \"os\"\n)\n\nfunc init() {\n    log.SetOutput(os.Stdout)\n}\n\nfunc main() {\n    log.Println(\"Gene Story SNP File Storage Server Started.\")\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1349, "user_id": 1982385, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1513f529c521607e875fdfaa18de8efd?s=128&d=identicon&r=PG", "display_name": "Daniel Gray", "link": "https://stackoverflow.com/users/1982385/daniel-gray"}, "edited": false, "score": 2, "creation_date": 1603192278, "post_id": 63465066, "comment_id": 113952538, "body": "Good tip! However, it says: &quot;Print is useful for bootstrapping and debugging; <b>it is not guaranteed to stay in the language.</b>&quot; so maybe not for long-term projects?"}, {"owner": {"reputation": 23476, "user_id": 222893, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/255b0472c4482c3ea433ab84b4e742e8?s=128&d=identicon&r=PG", "display_name": "weakish", "link": "https://stackoverflow.com/users/222893/weakish"}, "edited": false, "score": 1, "creation_date": 1607869618, "post_id": 63465066, "comment_id": 115402210, "body": "IMO, <code>print</code> and <code>println</code> are used for debugging."}], "tags": [], "owner": {"reputation": 192, "user_id": 2115349, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6362167b0eebc6eae8c49338415827f3?s=128&d=identicon&r=PG", "display_name": "Fornax", "link": "https://stackoverflow.com/users/2115349/fornax"}, "is_accepted": true, "score": 16, "last_activity_date": 1597740650, "creation_date": 1597740650, "answer_id": 63465066, "question_id": 29721449, "link": "https://stackoverflow.com/questions/29721449/how-can-i-print-to-stderr-in-go-without-using-log/63465066#63465066", "title": "How can I print to Stderr in Go without using log", "body": "<p>The Go builtin functions <code>print</code> and <code>println</code> print to stderr. So if you simply want to output some text to stderr you can do</p>\n<pre><code>package main\n\nfunc main() {\n    println(&quot;Hello stderr!&quot;)\n}\n</code></pre>\n<p>Documentation: <a href=\"https://golang.org/pkg/builtin/#print\" rel=\"noreferrer\">https://golang.org/pkg/builtin/#print</a></p>\n"}], "owner": {"reputation": 10154, "user_id": 2482570, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/1U8oq.jpg?s=128&g=1", "display_name": "Max Heiber", "link": "https://stackoverflow.com/users/2482570/max-heiber"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69583, "favorite_count": 7, "accepted_answer_id": 63465066, "answer_count": 6, "score": 82, "last_activity_date": 1597740650, "creation_date": 1429383130, "last_edit_date": 1495540987, "question_id": 29721449, "link": "https://stackoverflow.com/questions/29721449/how-can-i-print-to-stderr-in-go-without-using-log", "title": "How can I print to Stderr in Go without using log", "body": "<p>How can I write a message to Stderr without using <code>log</code>?</p>\n\n<p><a href=\"https://stackoverflow.com/questions/28934859/how-to-print-message-to-stderr-in-go\">A comment in this SO post</a> shows how to do it with <code>log</code>: <code>log.Println(\"Message\")</code>, but what if I don't want a timestamp?</p>\n\n<p>Is the following good Go?</p>\n\n<p><code>os.Stderr.WriteString(\"Message\")</code></p>\n"}, {"tags": ["algorithm", "go", "graph-algorithm"], "comments": [{"owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "edited": false, "score": 0, "creation_date": 1429379988, "post_id": 29720791, "comment_id": 47576194, "body": "I see two votes to close this question because it is too broad. May I ask what is broad about this question? I&#39;m not sure how to simplify this task any farther."}, {"owner": {"reputation": 3770, "user_id": 4731679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66a9b39bb57049590b4ba59423630ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Edward Doolittle", "link": "https://stackoverflow.com/users/4731679/edward-doolittle"}, "edited": false, "score": 8, "creation_date": 1429380437, "post_id": 29720791, "comment_id": 47576377, "body": "It&#39;s called correlation clustering. Create a graph with numbers 1 .. 5 as nodes, weight the edges by number of times a pair appears together. I&#39;m sure there are algorithms out there, but it&#39;s not such a tidy and well-defined problem."}, {"owner": {"reputation": 13138, "user_id": 3459206, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/b245689cab3de5b5596a0ba0d235c4e7?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Salauyou", "link": "https://stackoverflow.com/users/3459206/alex-salauyou"}, "edited": false, "score": 0, "creation_date": 1429556760, "post_id": 29720791, "comment_id": 47644813, "body": "Does order of elements matter?"}, {"owner": {"reputation": 9445, "user_id": 1146608, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/XLIdo.png?s=128&g=1", "display_name": "Patrick M", "link": "https://stackoverflow.com/users/1146608/patrick-m"}, "edited": false, "score": 4, "creation_date": 1429560600, "post_id": 29720791, "comment_id": 47647122, "body": "I don&#39;t follow how you arrive at the final output. You say it &#39;could produce any of the following groupings&#39;; which one is most correct and why? Do you really want an algorithm that could arbitrarily produce one of 4 conflicting results?"}, {"owner": {"reputation": 10475, "user_id": 80630, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/18cab57dc435093a99f6fb52726ddb88?s=128&d=identicon&r=PG", "display_name": "Elliot Nelson", "link": "https://stackoverflow.com/users/80630/elliot-nelson"}, "edited": false, "score": 4, "creation_date": 1429655384, "post_id": 29720791, "comment_id": 47698450, "body": "I think this is an interesting question, but it&#39;s very unclear.  Your input appears to be a series of lists of integers of varying size.  What exactly is the output you are looking for?  A number tree, another series of lists, how many times can each number appear in the output, etc.?"}, {"owner": {"reputation": 43134, "user_id": 1726343, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/55744f355c4714fd473c50e799165a70?s=128&d=identicon&r=PG", "display_name": "Asad Saeeduddin", "link": "https://stackoverflow.com/users/1726343/asad-saeeduddin"}, "edited": false, "score": 2, "creation_date": 1429655737, "post_id": 29720791, "comment_id": 47698620, "body": "You need to specify your input and desired output a bit more formally before any useful answer can be given."}, {"owner": {"reputation": 92307, "user_id": 167735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5deb8de031f80c23f19e9b6d389e5afe?s=128&d=identicon&r=PG", "display_name": "slebetman", "link": "https://stackoverflow.com/users/167735/slebetman"}, "edited": false, "score": 1, "creation_date": 1429686081, "post_id": 29720791, "comment_id": 47709006, "body": "In your last example, can you clarify what exactly do you mean by the <code>,</code> operator? You don&#39;t seem to be using it to mean what it usually mean. It looks like you&#39;re using <code>,</code> to mean OR which is usually represented by the symbol <code>|</code> or <code>+</code>"}, {"owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "edited": false, "score": 0, "creation_date": 1429713126, "post_id": 29720791, "comment_id": 47729590, "body": "I updated the example. Since I do not know which algorithm to use - I cannot know what the &quot;correct&quot; result should be so I listed several examples. I&#39;m not looking for an answer - <i>I&#39;m looking for a method</i>. I would like to find a decent cluster algorithm that could give me fuzzy grouping of any kind to help make sense of the numbers and their relations to each other."}, {"owner": {"reputation": 43134, "user_id": 1726343, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/55744f355c4714fd473c50e799165a70?s=128&d=identicon&r=PG", "display_name": "Asad Saeeduddin", "link": "https://stackoverflow.com/users/1726343/asad-saeeduddin"}, "edited": false, "score": 0, "creation_date": 1429717103, "post_id": 29720791, "comment_id": 47732826, "body": "@Xeoncross Several people have asked you to clarify what your output means, but you&#39;ve been ignoring these questions. Could you please clarify your notation? What do <code>[]</code> <code>,</code> and <code>&amp;</code> mean here? Even if you don&#39;t know what the exact metric is by which the numbers are grouped, could you at least give a concise plain English description of what property of the input you&#39;re trying to measure? &quot;Find the closest relations between them&quot; is too vague."}, {"owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "edited": false, "score": 0, "creation_date": 1429720325, "post_id": 29720791, "comment_id": 47735182, "body": "Sorry, <code>&amp;</code> means &quot;and&quot; while a <code>,</code> is a comma and is used when separating items in an array/list <code>[1,2,3]</code>. Square brackets are used to mark a group/list/array of items <code>[1....6]</code>. So when I said <code>[1,2,3] &amp; [4,5]</code> I meant <i>&quot;two groups of items, the first containing 1, 2, &amp; 3 and the second group containing 4 &amp; 5.&quot;</i>"}, {"owner": {"reputation": 43134, "user_id": 1726343, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/55744f355c4714fd473c50e799165a70?s=128&d=identicon&r=PG", "display_name": "Asad Saeeduddin", "link": "https://stackoverflow.com/users/1726343/asad-saeeduddin"}, "edited": false, "score": 0, "creation_date": 1429721322, "post_id": 29720791, "comment_id": 47735836, "body": "@Xeoncross Ok, so how did you arrive at that grouping? Put another way, what question about the input is <code>[1,2,3] &amp; [4,5]</code> an answer to?"}, {"owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "reply_to_user": {"reputation": 43134, "user_id": 1726343, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/55744f355c4714fd473c50e799165a70?s=128&d=identicon&r=PG", "display_name": "Asad Saeeduddin", "link": "https://stackoverflow.com/users/1726343/asad-saeeduddin"}, "edited": false, "score": 0, "creation_date": 1429722230, "post_id": 29720791, "comment_id": 47736439, "body": "@Asad, sure - I updated the question."}, {"owner": {"reputation": 14499, "user_id": 3589092, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7ROkk.jpg?s=128&g=1", "display_name": "kemicofa ghost", "link": "https://stackoverflow.com/users/3589092/kemicofa-ghost"}, "edited": false, "score": 0, "creation_date": 1429960464, "post_id": 29720791, "comment_id": 47853920, "body": "This could be a good question on codegolf.stackexchange.com"}], "answers": [{"comments": [{"owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "edited": false, "score": 0, "creation_date": 1429715845, "post_id": 29786675, "comment_id": 47731851, "body": "<i>&quot;In some sense we are ranking vertices according to their connectedness&quot;</i>... While this is good related research - it doesn&#39;t actually tackle the problem of grouping the input - just calculating meta-data about the input which <i>could help</i> in actual grouping/clustering. It&#39;s a great start (+1), but <a href=\"http://pastie.org/10107600\" rel=\"nofollow noreferrer\">consider the following input</a>."}], "tags": [], "owner": {"reputation": 11133, "user_id": 4275347, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CdbsN.jpg?s=128&g=1", "display_name": "Michael Laszlo", "link": "https://stackoverflow.com/users/4275347/michael-laszlo"}, "is_accepted": false, "score": 31, "last_activity_date": 1429685541, "last_edit_date": 1429685541, "creation_date": 1429669738, "answer_id": 29786675, "question_id": 29720791, "link": "https://stackoverflow.com/questions/29720791/grouping-numbers-based-on-occurrences/29786675#29786675", "title": "Grouping numbers based on occurrences?", "body": "<p>Each of your three sequences can be understood as a <a href=\"http://en.wikipedia.org/wiki/Clique_%28graph_theory%29\" rel=\"nofollow noreferrer\">clique</a> in a <a href=\"http://en.wikipedia.org/wiki/Multigraph\" rel=\"nofollow noreferrer\">multigraph</a>. Within a clique, every vertex is connected to every other vertex.</p>\n\n<p>The following graph represents your sample case with the edges in each clique colored red, blue, and green, respectively.</p>\n\n<p><img src=\"https://i.stack.imgur.com/1TUsb.png\" alt=\"Multigraph with five vertices and three cliques\"></p>\n\n<p>As you have already shown, we can classify pairs of vertices according to the number of edges between them. In the illustration, we can see that four pairs of vertices are connected by two edges each, and four other pairs of vertices are connected by one edge each.</p>\n\n<p>We can go on to classify vertices according to the number of cliques in which they appear. In some sense we are ranking vertices according to their connectedness. A vertex that appears in <code>k</code> cliques can be thought of as connected to the same degree as other vertices that appear in <code>k</code> cliques. In the image, we see three groups of vertices: vertex 3 appears in three cliques; vertices 1, 2, and 4 each appear in two cliques; vertex 5 appears in one clique.</p>\n\n<p>The Go program below computes the edge classification as well as the vertex classification. The input to the program contains, on the first line, the number of vertices <code>n</code> and the number of cliques <code>m</code>. We assume that the vertices are numbered from 1 to <code>n</code>. Each of the succeeding <code>m</code> lines of input is a space-separated list of vertices belonging to a clique. Thus, the problem instance given in the question is represented by this input:</p>\n\n\n\n<pre><code>5 3\n1 2 3 4\n4 3 5\n2 1 3\n</code></pre>\n\n<p>The corresponding output is:</p>\n\n\n\n<pre><code>Number of edges between pairs of vertices:\n    2 edges: (1, 2) (1, 3) (2, 3) (3, 4)\n    1 edge:  (1, 4) (2, 4) (3, 5) (4, 5)\n\nNumber of cliques in which a vertex appears:\n    3 cliques: 3\n    2 cliques: 1 2 4\n    1 clique:  5\n</code></pre>\n\n<p>And here is the Go program:</p>\n\n\n\n<pre><code>package main\n\nimport (\n        \"bufio\"\n        \"fmt\"\n        \"os\"\n        \"strconv\"\n        \"strings\"\n)\n\nfunc main() {\n        // Set up input and output.\n        reader := bufio.NewReader(os.Stdin)\n        writer := bufio.NewWriter(os.Stdout)\n        defer writer.Flush()\n\n        // Get the number of vertices and number of cliques from the first line.\n        line, err := reader.ReadString('\\n')\n        if err != nil {\n                fmt.Fprintf(os.Stderr, \"Error reading first line: %s\\n\", err)\n                return\n        }\n        var numVertices, numCliques int\n        numScanned, err := fmt.Sscanf(line, \"%d %d\", &amp;numVertices, &amp;numCliques)\n        if numScanned != 2 || err != nil {\n                fmt.Fprintf(os.Stderr, \"Error parsing input parameters: %s\\n\", err)   \n                return\n        }\n\n        // Initialize the edge counts and vertex counts.\n        edgeCounts := make([][]int, numVertices+1)\n        for u := 1; u &lt;= numVertices; u++ {\n                edgeCounts[u] = make([]int, numVertices+1)\n        }\n        vertexCounts := make([]int, numVertices+1)\n\n        // Read each clique and update the edge counts.\n        for c := 0; c &lt; numCliques; c++ {\n                line, err = reader.ReadString('\\n')\n                if err != nil {\n                        fmt.Fprintf(os.Stderr, \"Error reading clique: %s\\n\", err)\n                        return\n                }\n                tokens := strings.Split(strings.TrimSpace(line), \" \")\n                clique := make([]int, len(tokens))\n                for i, token := range tokens {\n                        u, err := strconv.Atoi(token)\n                        if err != nil {\n                                fmt.Fprintf(os.Stderr, \"Atoi error: %s\\n\", err)\n                                return\n                        }\n                        vertexCounts[u]++\n                        clique[i] = u\n                        for j := 0; j &lt; i; j++ {\n                                v := clique[j]\n                                edgeCounts[u][v]++\n                                edgeCounts[v][u]++\n                        }\n                }\n        }\n\n        // Compute the number of edges between each pair of vertices.\n        count2edges := make([][][]int, numCliques+1)\n        for u := 1; u &lt; numVertices; u++ {\n                for v := u + 1; v &lt;= numVertices; v++ {\n                        count := edgeCounts[u][v]\n                        count2edges[count] = append(count2edges[count],\n                                []int{u, v})\n                }\n        }\n        writer.WriteString(\"Number of edges between pairs of vertices:\\n\")\n        for count := numCliques; count &gt;= 1; count-- {\n                edges := count2edges[count]\n                if len(edges) == 0 {\n                        continue\n                }\n                label := \"edge\"\n                if count &gt; 1 {\n                        label += \"s:\"\n                } else {\n                        label += \": \"\n                }\n                writer.WriteString(fmt.Sprintf(\"%5d %s\", count, label))\n                for _, edge := range edges {\n                        writer.WriteString(fmt.Sprintf(\" (%d, %d)\",\n                                edge[0], edge[1]))\n                }\n                writer.WriteString(\"\\n\")\n        }\n\n        // Group vertices according to the number of clique memberships.\n        count2vertices := make([][]int, numCliques+1)\n        for u := 1; u &lt;= numVertices; u++ {\n                count := vertexCounts[u]\n                count2vertices[count] = append(count2vertices[count], u)\n        }\n        writer.WriteString(\"\\nNumber of cliques in which a vertex appears:\\n\")\n        for count := numCliques; count &gt;= 1; count-- {\n                vertices := count2vertices[count]\n                if len(vertices) == 0 {\n                        continue\n                }\n                label := \"clique\"\n                if count &gt; 1 {\n                        label += \"s:\"\n                } else {\n                        label += \": \"\n                }\n                writer.WriteString(fmt.Sprintf(\"%5d %s\", count, label))\n                for _, u := range vertices {\n                        writer.WriteString(fmt.Sprintf(\" %d\", u))\n                }\n                writer.WriteString(\"\\n\")\n        }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "edited": false, "score": 0, "creation_date": 1429801493, "post_id": 29811618, "comment_id": 47781077, "body": "This looks like the answer I was looking for. It&#39;s a little too inclusive perhaps (allowing <code>1&amp;2</code> to show up in 3x, 2x, and 1x clique) but it is a very nice algorithm."}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "reply_to_user": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "edited": false, "score": 1, "creation_date": 1429983196, "post_id": 29811618, "comment_id": 47861963, "body": "@Xeoncross I added kind of bloom filter to cleanup a bit <a href=\"https://play.golang.org/p/ZiJfH4Q6GJ\" rel=\"nofollow noreferrer\">play.golang.org/p/ZiJfH4Q6GJ</a> And of course you may choose your own representation of results."}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": true, "score": 10, "last_activity_date": 1429983533, "last_edit_date": 1429983533, "creation_date": 1429750253, "answer_id": 29811618, "question_id": 29720791, "link": "https://stackoverflow.com/questions/29720791/grouping-numbers-based-on-occurrences/29811618#29811618", "title": "Grouping numbers based on occurrences?", "body": "<p>As already been mentioned it's about clique. If you want exact answer you will face Maximum Clique Problem which is NP-complete. So all below make any sense only if alphabet of your symbols(numbers) has reasonable size. In this case strait-forward, not very optimised  algorithm for Maximum Clique Problem in pseudo-code would be</p>\n\n<pre><code>Function Main\n    Cm \u2190 \u2205                   // the maximum clique\n    Clique(\u2205,V)              // V vertices set\n    return Cm\nEnd function Main\n\nFunction Clique(set C, set P) // C the current clique, P candidat set\n    if (|C| &gt; |Cm|) then\n        Cm \u2190 C\n    End if\n    if (|C|+|P|&gt;|Cm|)then\n        for all p \u2208 P in predetermined order, do\n            P \u2190 P \\ {p}\n            Cp \u2190C \u222a {p}\n            Pp \u2190P \u2229 N(p)        //N(p) set of the vertices adjacent to p\n            Clique(Cp,Pp)\n        End for\n    End if\nEnd function Clique\n</code></pre>\n\n<p>Because of Go is my language of choice here is implementation</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"sort\"\n    \"strconv\"\n    \"strings\"\n)\n\nvar adjmatrix map[int]map[int]int = make(map[int]map[int]int)\nvar Cm []int = make([]int, 0)\nvar frequency int\n\n\n//For filter\ntype resoult [][]int\nvar res resoult\nvar filter map[int]bool = make(map[int]bool)\nvar bf int\n//For filter\n\n\n//That's for sorting\nfunc (r resoult) Less(i, j int) bool {\n    return len(r[i]) &gt; len(r[j])\n}\n\nfunc (r resoult) Swap(i, j int) {\n    r[i], r[j] = r[j], r[i]\n}\n\nfunc (r resoult) Len() int {\n    return len(r)\n}\n//That's for sorting\n\n\n//Work done here\nfunc Clique(C []int, P map[int]bool) {\n    if len(C) &gt;= len(Cm) {\n\n        Cm = make([]int, len(C))\n        copy(Cm, C)\n    }\n    if len(C)+len(P) &gt;= len(Cm) {\n        for k, _ := range P {\n            delete(P, k)\n            Cp := make([]int, len(C)+1)\n            copy(Cp, append(C, k))\n            Pp := make(map[int]bool)\n            for n, m := range adjmatrix[k] {\n                _, ok := P[n]\n                if ok &amp;&amp; m &gt;= frequency {\n                    Pp[n] = true\n                }\n            }\n            Clique(Cp, Pp)\n\n            res = append(res, Cp)\n            //Cleanup resoult\n            bf := 0\n            for _, v := range Cp {\n                bf += 1 &lt;&lt; uint(v)\n            }\n            _, ok := filter[bf]\n            if !ok {\n                filter[bf] = true\n                res = append(res, Cp)\n            }\n            //Cleanup resoult\n        }\n    }\n}\n//Work done here\n\nfunc main() {\n    var toks []string\n    var numbers []int\n    var number int\n\n\n//Input parsing\n    StrReader := strings.NewReader(`1,2,3\n4,3,5\n4,1,6\n4,2,7\n4,1,7\n2,1,3\n5,1,2\n3,6`)\n    scanner := bufio.NewScanner(StrReader)\n    for scanner.Scan() {\n        toks = strings.Split(scanner.Text(), \",\")\n        numbers = []int{}\n        for _, v := range toks {\n            number, _ = strconv.Atoi(v)\n            numbers = append(numbers, number)\n\n        }\n        for k, v := range numbers {\n            for _, m := range numbers[k:] {\n                _, ok := adjmatrix[v]\n                if !ok {\n                    adjmatrix[v] = make(map[int]int)\n                }\n                _, ok = adjmatrix[m]\n                if !ok {\n                    adjmatrix[m] = make(map[int]int)\n                }\n                if m != v {\n                    adjmatrix[v][m]++\n                    adjmatrix[m][v]++\n                    if adjmatrix[v][m] &gt; frequency {\n                        frequency = adjmatrix[v][m]\n                    }\n                }\n\n            }\n        }\n    }\n    //Input parsing\n\n    P1 := make(map[int]bool)\n\n\n    //Iterating for frequency of appearance in group\n    for ; frequency &gt; 0; frequency-- {\n        for k, _ := range adjmatrix {\n            P1[k] = true\n        }\n        Cm = make([]int, 0)\n        res = make(resoult, 0)\n        Clique(make([]int, 0), P1)\n        sort.Sort(res)\n        fmt.Print(frequency, \"x-times \", res, \" \")\n    }\n    //Iterating for frequency of appearing together\n}\n</code></pre>\n\n<p>And here you can see it works <a href=\"https://play.golang.org/p/ZiJfH4Q6GJ\">https://play.golang.org/p/ZiJfH4Q6GJ</a> and play with input data. But once more, this approach is for reasonable size alphabet(and input data of any size).</p>\n"}, {"tags": [], "owner": {"reputation": 2176, "user_id": 1743220, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/c4876d49de8b6051f3697e3a58a3b33d?s=128&d=identicon&r=PG", "display_name": "Thomas B.", "link": "https://stackoverflow.com/users/1743220/thomas-b"}, "is_accepted": false, "score": 3, "last_activity_date": 1429776863, "creation_date": 1429776863, "answer_id": 29817480, "question_id": 29720791, "link": "https://stackoverflow.com/questions/29720791/grouping-numbers-based-on-occurrences/29817480#29817480", "title": "Grouping numbers based on occurrences?", "body": "<p>This problem often arises in the context of rule mining when analyzing sales data. (Which items are bought together? So they can be placed next to each other in the supermarket)</p>\n\n<p>One class of algorithms I came across is <a href=\"http://en.wikipedia.org/wiki/Association_rule_learning\" rel=\"nofollow\">Association Rule Learning</a>. And one inherent step is finding <strong>frequent itemsets</strong> which matches your task. One algorithm is <a href=\"http://en.wikipedia.org/wiki/Apriori_algorithm\" rel=\"nofollow\">Apriori</a>. But you can find a lot more when searching for those keywords.</p>\n"}, {"tags": [], "owner": {"reputation": 412, "user_id": 954607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99e33f2f91ee5f0a01a41294e198c8a6?s=128&d=identicon&r=PG", "display_name": "skazska", "link": "https://stackoverflow.com/users/954607/skazska"}, "is_accepted": false, "score": 1, "last_activity_date": 1430131577, "last_edit_date": 1430131577, "creation_date": 1430128756, "answer_id": 29892569, "question_id": 29720791, "link": "https://stackoverflow.com/questions/29720791/grouping-numbers-based-on-occurrences/29892569#29892569", "title": "Grouping numbers based on occurrences?", "body": "<p>It would be better it you describe goal of such a grouping. If no i may try to suggest the simples (as i think) approach, and thow most limeted. It is not suitable if you need to count huge amount of wide spreaded (like 1, 999999, 31) or big or nonpositive numbers .\nyou can rearrange number sets in array positions like so:</p>\n\n<pre><code>  |1|2|3|4|5|6|  - numers as array positions\n==============\n*1|1|1|1|1|0|0| *1     \n*2|0|0|1|1|1|0| *2   \n*4|1|1|1|0|0|0| *4\n==============\n +|2|2|3|2|1|0  - just a counters of occurence\n *|5|5|7|3|2|0  - so for first column number 1 mask will be: 1*1+1*4 = 5 \n</code></pre>\n\n<p>here you can see in + row that most frequent combination is [3], then [1,2] and [4] and then [5], \nalso you can indicate and distinguish the cooccurence of different combinations </p>\n\n<pre><code>    function grps(a) {\n      var r = [];\n      var sum = []; var mask = [];\n      var max = 0;\n      var val;\n      for (i=0; i &lt; a.length; i++) {\n        for (j=0; j &lt; a[i].length; j++) {\n          val = a[i][j]; \n          //r[i][val] = 1;\n          sum[val] = sum[val]?sum[val]+1:1; \n          mask[val] = mask[val]?mask[val]+Math.pow(2, i):1;\n          if (val &gt; max) { max = val; }\n        }\n      }\n      for (j = 0; j &lt; max; j++){\n        for (i = 0; i &lt; max; i++){            \n          r[sum[j]][mask[j]] = j;\n        }\n      }\n      return r;\n    }\n</code></pre>\n"}], "owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 963, "favorite_count": 10, "accepted_answer_id": 29811618, "answer_count": 4, "score": 34, "last_activity_date": 1430924370, "creation_date": 1429379591, "last_edit_date": 1430924370, "question_id": 29720791, "link": "https://stackoverflow.com/questions/29720791/grouping-numbers-based-on-occurrences", "title": "Grouping numbers based on occurrences?", "body": "<p>Given the following three sequences of numbers, I would like to figure out how to group the numbers to find the closest relations between them.</p>\n\n<pre><code>1,2,3,4\n4,3,5\n2,1,3\n...\n</code></pre>\n\n<p>I'm not sure what the algorithm(s) I'm looking for are called, but we can see stronger relations with some of the numbers than with others.</p>\n\n<p>These numbers appear together twice:</p>\n\n<pre><code>1 &amp; 2\n1 &amp; 3\n2 &amp; 3\n3 &amp; 4\n</code></pre>\n\n<p>Together once:</p>\n\n<pre><code>1 &amp; 4\n2 &amp; 4\n3 &amp; 5\n4 &amp; 5\n</code></pre>\n\n<p>So for example, we can see there must be a relationship between <code>1, 2, &amp; 3</code> since they all appear together at least twice. You could also say that <code>3 &amp; 4</code> are closely related since they also appear twice. However, the algorithm might pick <code>[1,2,3]</code> (over <code>[3,4]</code>) since it's a bigger grouping (more inclusive). </p>\n\n<p>We can form any of the following groupings if we stick the numbers used most often together in a group:</p>\n\n<pre><code>[1,2,3] &amp; [4,5]\n[1,2]   &amp; [3,4]   &amp; [5]\n[1,2]   &amp; [3,4,5]\n[1,2]   &amp; [3,4]   &amp; [5]\n</code></pre>\n\n<p>If duplicates are allowed, you could even end up with the following groups:</p>\n\n<pre><code>[1,2,3,4] [1,2,3] [3,4] [5]\n</code></pre>\n\n<p>I can't say which grouping is most \"correct\", but all four of these combos all find different ways of semi-correctly grouping the numbers. I'm not looking for a specific grouping - just a general cluster algorithm that works fairly well and is easy to understand.</p>\n\n<p>I'm sure there are many other ways to use the occurrence count to group them as well. What would be a good base grouping algorithm for these? Samples in Go, Javascript, or PHP are preferred. </p>\n"}, {"tags": ["concurrency", "go", "channel"], "comments": [{"owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "edited": false, "score": 0, "creation_date": 1429374727, "post_id": 29719780, "comment_id": 47574375, "body": "On your question from the <a href=\"http://golang.org/ref/spec#Channel_types\" rel=\"nofollow noreferrer\">spec on chan type</a>: A single channel may be used in send statements, receive operations, and calls to the built-in functions cap and len by any number of goroutines without further synchronization. So nothing will be lost"}], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 5, "last_activity_date": 1429374322, "last_edit_date": 1429374322, "creation_date": 1429374147, "answer_id": 29719829, "question_id": 29719780, "link": "https://stackoverflow.com/questions/29719780/concurrent-send-receive-go-channel/29719829#29719829", "title": "Concurrent send/receive go channel", "body": "<p>You only need one <code>for</code> loop. From the <a href=\"https://golang.org/ref/spec#For_statements\" rel=\"nofollow\">spec on range expressions</a>:</p>\n\n<blockquote>\n  <p>For channels, the iteration values produced are the successive values sent on the channel until the channel is closed. If the channel is <code>nil</code>, the range expression blocks forever.</p>\n</blockquote>\n\n<p>In this case, the range loop is not acting like a regular range over, for example, a slice. Instead, when an item can be read from the channel, the loop body processes it. Therefore, your nested loops should be replaced with the following:</p>\n\n<pre><code>for data := range queue {\n    sink(data)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 1, "creation_date": 1429436634, "post_id": 29719960, "comment_id": 47590106, "body": "A fan-in process is also known as a multiplexer because the messages have to be multiplexed, i.e. interleaved into a sequential order. Because the arrival of messages into the channel is concurrent, the order they are interleaved is arbitrary and approximates first-come-first-served."}, {"owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1429451764, "post_id": 29719960, "comment_id": 47594901, "body": "Thanks. This is really the advantage of <code>Golang</code> which is awkward, or at least error prone to implement in other languages."}], "tags": [], "owner": {"reputation": 160456, "user_id": 89391, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bb5230985aa2c9ea7d022d1a16890f16?s=128&d=identicon&r=PG", "display_name": "miku", "link": "https://stackoverflow.com/users/89391/miku"}, "is_accepted": false, "score": 4, "last_activity_date": 1429374860, "last_edit_date": 1495535045, "creation_date": 1429374860, "answer_id": 29719960, "question_id": 29719780, "link": "https://stackoverflow.com/questions/29719780/concurrent-send-receive-go-channel/29719960#29719960", "title": "Concurrent send/receive go channel", "body": "<p>As <a href=\"https://stackoverflow.com/a/29719829/89391\">@Tim</a> said, you only need a single <code>for</code>, since <code>range</code> will emit values from the channel, until it is closed.</p>\n\n<p>Overall, the pattern you describe is called <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">fan-in</a>. A example for a basic producer/consumer setup can be found here: <a href=\"http://play.golang.org/p/AhQ012Qpwj\" rel=\"nofollow noreferrer\">http://play.golang.org/p/AhQ012Qpwj</a>. The range loop runs in the consumer:</p>\n\n<pre><code>// consumer acts as fan in, signals when it is done.\nfunc consumer(out chan string, done chan bool) {\n    for value := range out {\n        fmt.Println(value)\n    }\n    done &lt;- true\n}\n</code></pre>\n"}], "owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 231, "favorite_count": 3, "accepted_answer_id": 29719829, "answer_count": 2, "score": 4, "last_activity_date": 1429374860, "creation_date": 1429373880, "question_id": 29719780, "link": "https://stackoverflow.com/questions/29719780/concurrent-send-receive-go-channel", "title": "Concurrent send/receive go channel", "body": "<p>I have a go channel called <code>queue</code> with let's say 100 as the buffer size. Many go routines can send data to this channel, and another go routine is sitting there to receive data from this channel. This is a long lasting process, meaning the channel is acting like a pipeline absorbing data from many ends and sinking data to one end. I do something like this in the receiving go routine:</p>\n\n<pre><code>for {\n    for data := range queue {\n        sink(data)\n    }\n} \n</code></pre>\n\n<p>Now my question is: what if some new data were sent to the channel buffer before the range loop is finished. Will the new data be available for the next range loop? Or they will be missed if concurrency is not taken into consideration in this case?</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "answers": [{"comments": [{"owner": {"reputation": 704, "user_id": 883843, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/1bbbaa8b2afe23a70674429851327ed1?s=128&d=identicon&r=PG", "display_name": "Lubiluk", "link": "https://stackoverflow.com/users/883843/lubiluk"}, "edited": false, "score": 0, "creation_date": 1535361564, "post_id": 29719349, "comment_id": 91022328, "body": "And I guess the third option would be to have *int in my struct and use PropertyLoadSaver to conditionally save it, right? It&#39;s also worth noting that storing booleans (as I did) can use a lot of Datastore space wich may turn out to be expensive."}], "tags": [], "owner": {"reputation": 1036, "user_id": 1737204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2851ca9622b504c85b92fc3e93d87b1f?s=128&d=identicon&r=PG", "display_name": "wldsvc", "link": "https://stackoverflow.com/users/1737204/wldsvc"}, "is_accepted": true, "score": 0, "last_activity_date": 1429371829, "last_edit_date": 1429371829, "creation_date": 1429371293, "answer_id": 29719349, "question_id": 29718871, "link": "https://stackoverflow.com/questions/29718871/nilable-value-in-appengine-datastore-using-go/29719349#29719349", "title": "Nilable value in appengine/datastore using Go", "body": "<p>Either store your ints as strings (with empty string => no value) or use a composite type like:</p>\n\n<pre><code>type NillableInt struct {\n    i     int\n    isNil bool  // or isNotNil bool if you want different default semantics\n}\n</code></pre>\n\n<p>Adapt to your performance vs. memory usage requirements.</p>\n\n<p>If you want your code to deal with int pointers but persist nil values in the datastore, define your struct like this:</p>\n\n<pre><code>type NutritionFact struct {\n       Name                string  `datastore:\",noindex\" json:\"name\"`\n       DailyValuePercent   int `datastore:\"-\"`\n}\n</code></pre>\n\n<p>And implement the PropertyLoadSaver interface where you will save/load an int value and a isNil boolean.</p>\n"}], "owner": {"reputation": 704, "user_id": 883843, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/1bbbaa8b2afe23a70674429851327ed1?s=128&d=identicon&r=PG", "display_name": "Lubiluk", "link": "https://stackoverflow.com/users/883843/lubiluk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 29719349, "answer_count": 1, "score": 2, "last_activity_date": 1471905917, "creation_date": 1429368692, "last_edit_date": 1471905917, "question_id": 29718871, "link": "https://stackoverflow.com/questions/29718871/nilable-value-in-appengine-datastore-using-go", "title": "Nilable value in appengine/datastore using Go", "body": "<p>The list of supported types by datastore doesn't contain pointer types (<a href=\"https://cloud.google.com/appengine/docs/go/datastore/reference\" rel=\"nofollow\">https://cloud.google.com/appengine/docs/go/datastore/reference</a>).\nHow then can I represent a value that can and sometimes should be nil?\nFor example in the following structure I need the <code>DailyValuePercent</code> to be nilable to explicitly say that the value is missing.</p>\n\n<pre><code>type NutritionFact struct {\n    Name                string  `datastore:\",noindex\" json:\"name\"`\n    DailyValuePercent   int     `datastore:\",noindex\" json:\"dailyValuePercent\"`\n}\n</code></pre>\n\n<p>Since I can't use *int as the field type for datastore then how to represent an optional value?</p>\n"}, {"tags": ["templates", "go"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1429362387, "post_id": 29717586, "comment_id": 47569939, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/19546896/golang-template-how-to-render-templates\">golang template - how to render templates?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "is_accepted": true, "score": 3, "last_activity_date": 1429367792, "last_edit_date": 1429367792, "creation_date": 1429363178, "answer_id": 29717927, "question_id": 29717586, "link": "https://stackoverflow.com/questions/29717586/variable-not-visible-in-partial/29717927#29717927", "title": "Variable not visible in partial", "body": "<p>The <code>{{template \"header.html\"}}</code> form doesn't pass any data.</p>\n\n<p>Try <code>{{template \"header.html\" .}}</code> instead.</p>\n\n<p>See the Actions section of <a href=\"http://golang.org/pkg/text/template/\" rel=\"nofollow\"><code>text/template</code></a> for details.</p>\n"}], "owner": {"reputation": 10110, "user_id": 130024, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/2353857b3f577eb4e3840111ca9a7ecb?s=128&d=identicon&r=PG", "display_name": "astropanic", "link": "https://stackoverflow.com/users/130024/astropanic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 29717927, "answer_count": 1, "score": 0, "last_activity_date": 1429367792, "creation_date": 1429361448, "question_id": 29717586, "link": "https://stackoverflow.com/questions/29717586/variable-not-visible-in-partial", "title": "Variable not visible in partial", "body": "<p>Why is the <code>title</code> attribute of my <code>page</code> object not populated in the header template ?</p>\n\n<p>here is my small go program</p>\n\n<pre><code>package main\n\nimport (\n  \"html/template\"\n  \"os\"\n)\n\ntype Page struct {\n  Title string\n  Body  string\n}\n\nfunc main() {\n  f, _ := os.Create(\"index.html\")\n  defer f.Close()\n\n  page := Page{\"I'm the title\", \"And I'm the body\"}\n\n  t := template.New(\"post.html\")\n  t = template.Must(t.ParseGlob(\"templates/*html\"))\n  t.Execute(f, page)\n}\n</code></pre>\n\n<p>here is the templates/post.html file:</p>\n\n<pre><code>{{template \"header.html\"}}\n&lt;article&gt;\n  {{.Body}}\n&lt;/article&gt;\n{{template \"footer.html\"}}\n</code></pre>\n\n<p>and my templates/header.html file:</p>\n\n<pre><code>&lt;!doctype html&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;meta charset=\"utf-8\"&gt;\n    &lt;title&gt;{{.Title}}&lt;/title&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n</code></pre>\n\n<p>for the sake of completeness, my footer, templates/footer.html file:</p>\n\n<pre><code>&lt;footer&gt;\n&amp;copy; 2015\n&lt;/footer&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>The .Body variable in the templates/post.html template is filled, but the .Title in the templates/header.html template is empty, I think it's because it's a partial, rendered from another template...</p>\n\n<p>How to make this work ?</p>\n\n<p>I posted the complete above example as a <a href=\"https://gist.github.com/astropanic/92df9bb7995ad2151508\" rel=\"nofollow\">gist</a></p>\n"}, {"tags": ["file", "go", "io"], "comments": [{"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1429459623, "post_id": 29716874, "comment_id": 47597755, "body": "Your post lacks a question. Even if it seems clear, always specify your question."}, {"owner": {"reputation": 1801, "user_id": 4321788, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/BC8VC.jpg?s=128&g=1", "display_name": "Morteza R", "link": "https://stackoverflow.com/users/4321788/morteza-r"}, "reply_to_user": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 1, "creation_date": 1430436368, "post_id": 29716874, "comment_id": 48078439, "body": "I think you are being pedantic. The question was very clear."}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1430438511, "post_id": 29716874, "comment_id": 48079031, "body": "No, it&#39;s not. I can imagine multiple serious questions for your description, many more with some malintent."}], "answers": [{"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 5, "last_activity_date": 1429357984, "creation_date": 1429357984, "answer_id": 29716957, "question_id": 29716874, "link": "https://stackoverflow.com/questions/29716874/error-in-opening-and-writing-to-a-file/29716957#29716957", "title": "Error in opening and writing to a file", "body": "<p>Use <code>io.WriteString(f, msg)</code>, <code>f.Write([]byte(msg))</code> or <code>io.Copy(f, strings.NewReader(msg))</code>.</p>\n"}], "owner": {"reputation": 1801, "user_id": 4321788, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/BC8VC.jpg?s=128&g=1", "display_name": "Morteza R", "link": "https://stackoverflow.com/users/4321788/morteza-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 497, "favorite_count": 0, "accepted_answer_id": 29716957, "answer_count": 1, "score": -2, "last_activity_date": 1429357984, "creation_date": 1429357546, "question_id": 29716874, "link": "https://stackoverflow.com/questions/29716874/error-in-opening-and-writing-to-a-file", "title": "Error in opening and writing to a file", "body": "<p>I want to open a file and write some text to it, however I get the following error:</p>\n\n<pre><code>.\\hello.go:13: cannot use msg (type string) as type []byte in argument to f.Write\n</code></pre>\n\n<p>Here's my code so far:</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n)\n\nfunc printer(msg string) (err error) {\n    f, err := os.Create(\"helloworld.txt\")\n    if err != nil {\n        return err\n    }\n    defer f.Close()\n    f.Write(msg)\n    return err\n}\n\nfunc main() {\n    printer(\"Hello World\")\n}\n</code></pre>\n"}, {"tags": ["ssl", "go", "apple-push-notifications"], "comments": [{"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 2, "creation_date": 1429346156, "post_id": 29714397, "comment_id": 47564738, "body": "It looks like the service expects a client certificate and simply closes the connection (i.e. EOF) if it received none or not the expected one."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1429541562, "post_id": 29714397, "comment_id": 47634545, "body": "Can you also try the latest version of Go from git master (there&#39;s a been a few tls changes and cipher additions since go1.4)? You could also try connecting with <code>tls.Config.MaxVersion = tls.VersionTLS11</code>."}, {"owner": {"reputation": 3845, "user_id": 475978, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/40f04d8d5b169cee39e1ff9ce18b9cbf?s=128&d=identicon&r=PG&f=1", "display_name": "Prcela", "link": "https://stackoverflow.com/users/475978/prcela"}, "edited": false, "score": 0, "creation_date": 1450100841, "post_id": 29714397, "comment_id": 56278427, "body": "Did you found any solution for this?"}, {"owner": {"reputation": 3963, "user_id": 514344, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/bb4c1b316ed2db1970f7fa0ff08dabf6?s=128&d=identicon&r=PG", "display_name": "Manu", "link": "https://stackoverflow.com/users/514344/manu"}, "edited": false, "score": 0, "creation_date": 1450693991, "post_id": 29714397, "comment_id": 56528398, "body": "I think it was issue with the certificate. My implementation was later modified like <a href=\"https://github.com/manuks/simple-apns-server\" rel=\"nofollow noreferrer\">github.com/manuks/simple-apns-server</a>"}], "owner": {"reputation": 3963, "user_id": 514344, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/bb4c1b316ed2db1970f7fa0ff08dabf6?s=128&d=identicon&r=PG", "display_name": "Manu", "link": "https://stackoverflow.com/users/514344/manu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 809, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1429511013, "creation_date": 1429342495, "last_edit_date": 1429511013, "question_id": 29714397, "link": "https://stackoverflow.com/questions/29714397/go-tls-connection-to-apple-push-notification-server-is-not-working", "title": "go tls connection to apple push notification server is not working", "body": "<p>My code look like below</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"crypto/x509\"\n    \"log\"\n    \"io/ioutil\"\n)\n\nfunc main() {\n    c := \"pub.pem\"\n    p := \"pri.pem\"\n    cert, err := tls.LoadX509KeyPair(c, p)\n    if err != nil {\n        log.Fatalf(\"server: loadkeys: %s\", err)\n    }\n\n    pemData2, err := ioutil.ReadFile(\"entrust.pem\")\n\n    if err != nil {\n        log.Fatalf(\"cant read ca cert: %s\", err)\n    }\n\n\n    cacerts := x509.NewCertPool()\n    cacerts.AppendCertsFromPEM(pemData2) \n\n    config := tls.Config{Certificates: []tls.Certificate{cert}, RootCAs: cacerts}\n    conn, err := tls.Dial(\"tcp\", \"gateway.sandbox.push.apple.com:2195\", &amp;config)\n    if err != nil {\n        log.Fatalf(\"client: dial: %s\", err)\n    }\n    defer conn.Close()\n    log.Println(\"client: connected to: \", conn.RemoteAddr())\n\n\n}\n</code></pre>\n\n<p>It returns </p>\n\n<blockquote>\n  <p>client: dial: EOF</p>\n</blockquote>\n\n<p>Why it just shows EOF?\nAny clue?</p>\n\n<p><a href=\"https://developer.apple.com/library/ios/technotes/tn2265/_index.html\" rel=\"nofollow\">This apple link</a> asks to check the certificate with openssl command. And the output is as below. I think the certificate works. Is there any method to get more debug information in tls.Dial function?</p>\n\n<pre><code>~/go$ openssl s_client -connect gateway.sandbox.push.apple.com:2195 -cert pub.pem -key pri.pem -CAfile entrust.pem \nCONNECTED(00000003)\ndepth=2 O = Entrust.net, OU = www.entrust.net/CPS_2048 incorp. by ref. (limits liab.), OU = (c) 1999 Entrust.net Limited, CN = Entrust.net Certification Authority (2048)\nverify return:1\ndepth=1 C = US, O = \"Entrust, Inc.\", OU = www.entrust.net/rpa is incorporated by reference, OU = \"(c) 2009 Entrust, Inc.\", CN = Entrust Certification Authority - L1C\nverify return:1\ndepth=0 C = US, ST = California, L = Cupertino, O = Apple Inc., CN = gateway.sandbox.push.apple.com\nverify return:1\n140527559149216:error:140790E5:SSL routines:ssl23_write:ssl handshake failure:s23_lib.c:177:\n---\nCertificate chain\n0 s:/C=US/ST=California/L=Cupertino/O=Apple Inc./CN=gateway.sandbox.push.apple.com\n   i:/C=US/O=Entrust, Inc./OU=www.entrust.net/rpa is incorporated by reference/OU=(c) 2009 Entrust, Inc./CN=Entrust Certification Authority - L1C\n 1 s:/C=US/O=Entrust, Inc./OU=www.entrust.net/rpa is incorporated by reference/OU=(c) 2009 Entrust, Inc./CN=Entrust Certification Authority - L1C\n   i:/O=Entrust.net/OU=www.entrust.net/CPS_2048 incorp. by ref. (limits liab.)/OU=(c) 1999 Entrust.net Limited/CN=Entrust.net Certification Authority (2048)\n---\nServer certificate\n-----BEGIN CERTIFICATE-----\nMIIFMzCCBBugAwIBAgIETCMmsDANBgkqhkiG9w0BAQUFADCBsTELMAkGA1UEBhMC\n................................................................\n................................................................\n................................................................\nfwUYU5NTM3h0xi3rIlXwAKD6zLKipcQ/YXRx7oMYnAm53tfU2MxV\n-----END CERTIFICATE-----\nsubject=/C=US/ST=California/L=Cupertino/O=Apple Inc./CN=gateway.sandbox.push.apple.com\nissuer=/C=US/O=Entrust, Inc./OU=www.entrust.net/rpa is incorporated by reference/OU=(c) 2009 Entrust, Inc./CN=Entrust Certification Authority - L1C\n---\nAcceptable client certificate CA names\n/C=US/O=Apple Inc./OU=Apple Certification Authority/CN=Apple Root CA\n/C=US/O=Apple Inc./OU=Apple Worldwide Developer Relations/CN=Apple Worldwide Developer Relations Certification Authority\n/C=US/O=Apple Inc./OU=Apple Certification Authority/CN=Apple Application Integration Certification Authority\nClient Certificate Types: RSA sign, DSA sign, ECDSA sign\nRequested Signature Algorithms: RSA+SHA512:DSA+SHA512:ECDSA+SHA512:RSA+SHA384:DSA+SHA384:ECDSA+SHA384:RSA+SHA256:DSA+SHA256:ECDSA+SHA256:RSA+SHA224:DSA+SHA224:ECDSA+SHA224:RSA+SHA1:DSA+SHA1:ECDSA+SHA1\nShared Requested Signature Algorithms: RSA+SHA512:DSA+SHA512:ECDSA+SHA512:RSA+SHA384:DSA+SHA384:ECDSA+SHA384:RSA+SHA256:DSA+SHA256:ECDSA+SHA256:RSA+SHA224:DSA+SHA224:ECDSA+SHA224:RSA+SHA1:DSA+SHA1:ECDSA+SHA1\nPeer signing digest: SHA512\nServer Temp Key: ECDH, P-256, 256 bits\n---\nSSL handshake has read 3483 bytes and written 1855 bytes\n---\nNew, TLSv1/SSLv3, Cipher is ECDHE-RSA-AES256-GCM-SHA384\nServer public key is 2048 bit\nSecure Renegotiation IS supported\nCompression: NONE\nExpansion: NONE\nNo ALPN negotiated\nSSL-Session:\n    Protocol  : TLSv1.2\n    Cipher    : ECDHE-RSA-AES256-GCM-SHA384\n    Session-ID: \n    Session-ID-ctx: \n    Master-Key: B6233349C3120E27078A8DD6A0C7526CD76F69A5B2A3A4036D721A768A6585FE5899D8D31560228CB3FB0170D4354577\n    Key-Arg   : None\n    PSK identity: None\n    PSK identity hint: None\n    SRP username: None\n    Start Time: 1429509932\n    Timeout   : 300 (sec)\n    Verify return code: 0 (ok)\n---\n</code></pre>\n"}, {"tags": ["go", "polymorphism", "overriding", "proxy-classes"], "answers": [{"comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 5911, "user_id": 1870054, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/QJydN.jpg?s=128&g=1", "display_name": "wener", "link": "https://stackoverflow.com/users/1870054/wener"}, "edited": false, "score": 0, "creation_date": 1429337146, "post_id": 29713263, "comment_id": 47562326, "body": "If that is the case, then you are correct, interfaces are the way to go. Go has no <code>is-a</code> type inheritance."}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 7, "last_activity_date": 1429334507, "creation_date": 1429334507, "answer_id": 29713263, "question_id": 29712909, "link": "https://stackoverflow.com/questions/29712909/in-golang-how-can-i-override-the-embedded-structs-method/29713263#29713263", "title": "In golang, How can I override the embedded struct&#39;s method", "body": "<p>By having <code>Sub</code> embed <code>Base</code> it automatically has all of <code>Base</code>'s fields and functions made available as top level members of <code>Sub</code>. This means you can directly call <code>s.val</code>, and you <em>would</em> be able to call <code>s.Set</code> to invoke the base function <strong>except</strong> for the fact that <code>Sub</code> implemented its own <code>Set</code> method which <em>hides</em> the Base one. </p>\n\n<p>When you call <code>s.Base.Set()</code> in your example you are bypassing <code>Sub.Set()</code> and directly calling <code>Base.Set()</code>.</p>\n\n<p>To fix it in your case is as simple as calling <code>s.Set()</code> instead of <code>s.Base.Set()</code>.</p>\n\n<p>This works for me:</p>\n\n<pre><code>func (b *Sub)Set(i int) {\n    b.Base.Set(i)\n    b.changed = true\n}\nfunc t16() {\n    s := &amp;Sub{}\n    s.Set(1)\n    var b *Base = &amp;s.Base\n    fmt.Printf(\"%+v\\n\", b)\n    fmt.Printf(\"%+v\\n\", s)\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/yjIMAFXjy-\" rel=\"noreferrer\">Play link</a></p>\n\n<p>Notice that <code>Sub.Set()</code> can invoke the embedded structs method as well, which feels a lot like the <code>super()</code> type inheritance that other oo languages provide.</p>\n"}], "owner": {"reputation": 5911, "user_id": 1870054, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/QJydN.jpg?s=128&g=1", "display_name": "wener", "link": "https://stackoverflow.com/users/1870054/wener"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7150, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1493047328, "creation_date": 1429331472, "last_edit_date": 1493047328, "question_id": 29712909, "link": "https://stackoverflow.com/questions/29712909/in-golang-how-can-i-override-the-embedded-structs-method", "title": "In golang, How can I override the embedded struct&#39;s method", "body": "<p>Code <a href=\"http://play.golang.org/p/lzWKavxgzr\" rel=\"nofollow noreferrer\">here</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    t16()\n}\n\ntype Base struct {\n    val int\n}\nfunc (b *Base)Set(i int) {\n    b.val = i\n}\ntype Sub struct {\n    Base\n    changed bool\n}\n\nfunc (b *Sub)Set(i int) {\n    b.val = i\n    b.changed = true\n}\nfunc t16() {\n    s := &amp;Sub{}\n    s.Base.Set(1)\n    var b *Base = &amp;s.Base\n    fmt.Printf(\"%+v\\n\", b)\n    fmt.Printf(\"%+v\\n\", s)\n}\n</code></pre>\n\n<p>I want to make Sub act as Base, but when I call Set, for Sub it will mark the changed.I know there is no polymorphism or proxy in golang, but is there any way to do this, and not effect the Base?</p>\n\n<p><strong>UPDATED</strong></p>\n\n<p>I hope when I call Base.Set it will mark the change, for user, they don't know they actually use the Sub, so I can monitor the Base behave.</p>\n\n<pre><code>func t16() {\n    s := &amp;Sub{}\n    var b *Base = &amp;s.Base\n    b.Set(10)\n    fmt.Printf(\"%+v\\n\", b)\n    fmt.Printf(\"%+v\\n\", s)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1429334613, "post_id": 29712513, "comment_id": 47561709, "body": "Does it work if you change the function signature to accept an <code>interface{}</code> instead of <code>*Datatype</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "edited": false, "score": 0, "creation_date": 1429363865, "post_id": 29712672, "comment_id": 47570446, "body": "Very nice, elegant solution. Thank you!"}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 4, "last_activity_date": 1429329084, "last_edit_date": 1495539943, "creation_date": 1429329084, "answer_id": 29712672, "question_id": 29712513, "link": "https://stackoverflow.com/questions/29712513/get-struct-value-from-interface/29712672#29712672", "title": "Get struct value from interface", "body": "<p>It appears you are trying to use the csv unmarshalling code from <a href=\"https://stackoverflow.com/questions/20768511/unmarshal-csv-record-into-struct-in-go\">this question</a>. That is designed to work when you have a pre-allocated struct of a specific type to pass into it. You are having issues because v is statically an interface type even though the particular value passed in is a struct.</p>\n\n<p>I would recommend putting an Unmarshal method on your interface and on each subType:</p>\n\n<pre><code>func (u *User) populateFrom(reader *csv.Reader) string {\n    Unmarshal(reader, u) \n}\n</code></pre>\n\n<p>Another cool thing in go is the <a href=\"https://golang.org/doc/effective_go.html#type_switch\" rel=\"nofollow noreferrer\">type switch</a>:</p>\n\n<pre><code>var i interface{}\nswitch t := v.(type) {\n    case *User:\n       i := t // i is now a *User.\n    case *Address:\n       i := t // i is now a *Address.\n    default:\n       panic(\"unknown type\")\n}\nUnmarshal(reader,i)\n</code></pre>\n"}], "owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2950, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1429329084, "creation_date": 1429327314, "last_edit_date": 1429327669, "question_id": 29712513, "link": "https://stackoverflow.com/questions/29712513/get-struct-value-from-interface", "title": "Get struct value from interface", "body": "<p>Am am attempting to create a file parser that can parse multiple types of data (users, addresses, etc) into a struct. To do this I have created an interface called Datatype:</p>\n\n<pre><code>package main\n\ntype Datatype interface {\n  name() string\n}\n</code></pre>\n\n<p>And several structs that implement the interface:</p>\n\n<p>ex.</p>\n\n<pre>package main\n\ntype User struct {\n    Username    string `validate:\"nonzero\"`\n    FirstName   string `validate:\"nonzero\"`\n    LastName    string `validate:\"nonzero\"`\n    Email       string `validate:\"regexp=^[0-9a-zA-Z]+@[0-9a-zA-Z]+(\\\\.[0-9a-zA-Z]+)+$\"`\n    Phone       string `validate:\"min=10\"`\n    DateOfBirth string\n}\n\ntype Users []User\n\nfunc (u User) name() string {\n    return \"user\"\n}</pre> \n\n<p>I then read the filename, get the type of data it contains from the name of the file and create an instance of that struct to pass to the parser:</p>\n\n<pre>\nfunc Parsefile(file string, dtype Datatype) ([]Datatype, error) {\n   // Do stuff in here to parse the file\n</pre>\n\n<p>I did this hoping I could create a parse method that took any one of the structs, detect the type and unmarshall from the csv record. However, what I am finding is that I can't do it this was as I can't seem to get the the underlying type from the interface. Or at least not with my Unmarshall function:</p>\n\n<pre><code>func Unmarshal(reader *csv.Reader, v *Datatype) error {\n    record, err := reader.Read()\n    fmt.Println(\"Record: \", record)\n    if err != nil {\n        return err\n    }\n    s := reflect.ValueOf(v).Elem()\n    if s.NumField() != len(record) {\n        return &amp;FieldMismatch{s.NumField(), len(record)}\n    }\n    for i := 0; i &lt; s.NumField(); i++ {\n        f := s.Field(i)\n        switch f.Type().String() {\n        case \"string\":\n            f.SetString(record[i])\n        case \"int\":\n            ival, err := strconv.ParseInt(record[i], 10, 0)\n            if err != nil {\n                return err\n            }\n            f.SetInt(ival)\n        default:\n            return &amp;UnsupportedType{f.Type().String()}\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<p>In the above function I get the following error when it hits the line trying to determine the number of fields in the Datatype:</p>\n\n<pre>panic: reflect: call of reflect.Value.NumField on interface Value</pre>\n\n<p>I know I am going about this poorly and I feel there must be a way to achieve this pattern without having to write logic specific to each data type. However, for the life of my I cannot figure out how to achieve this in go.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 991, "user_id": 146446, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1d5e8e86e4c8be8cfb5cd58ff37a6a26?s=128&d=identicon&r=PG", "display_name": "Gabe", "link": "https://stackoverflow.com/users/146446/gabe"}, "edited": false, "score": 0, "creation_date": 1429366110, "post_id": 29712022, "comment_id": 47571224, "body": "Thanks Craig! So before I was blocking in ToRss() and my main thread couldn&#39;t continue in order to read the data out.  Got it!  Thanks again."}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 2, "last_activity_date": 1429328037, "last_edit_date": 1429328037, "creation_date": 1429321956, "answer_id": 29712022, "question_id": 29711898, "link": "https://stackoverflow.com/questions/29711898/wrapping-a-writer-in-a-reader-in-go/29712022#29712022", "title": "Wrapping a writer in a reader in Go?", "body": "<p>A pipe does no internal buffering. It blocks on read or write until a corresponding write or read is called. </p>\n\n<p>You should use a bytes.Buffer inside ToRss and return it as your reader:</p>\n\n<pre><code>func ToRss() io.Reader {\n    buf := &amp;bytes.Buffer{}\n    io.WriteString(buf, \"foo\")\n    return buf\n} \n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Aab3miciWF\" rel=\"nofollow\">Playground link</a></p>\n\n<p>Alternatively you could start a new goroutine to write to the pipe and return it to be read from on the main goroutine. This method will avoid unnecessary buffering, but does introduce another goroutine.</p>\n\n<pre><code>func ToRss() io.Reader {\n   reader, writer := io.Pipe()\n   go func() {\n      io.WriteString(writer, \"foo\")\n      writer.Close()\n   }()\n   return reader\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/JDrM4i0q2x\" rel=\"nofollow\">Playground Link</a></p>\n"}], "owner": {"reputation": 991, "user_id": 146446, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1d5e8e86e4c8be8cfb5cd58ff37a6a26?s=128&d=identicon&r=PG", "display_name": "Gabe", "link": "https://stackoverflow.com/users/146446/gabe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1179, "favorite_count": 0, "accepted_answer_id": 29712022, "answer_count": 1, "score": 2, "last_activity_date": 1577772069, "creation_date": 1429320709, "last_edit_date": 1577772069, "question_id": 29711898, "link": "https://stackoverflow.com/questions/29711898/wrapping-a-writer-in-a-reader-in-go", "title": "Wrapping a writer in a reader in Go?", "body": "<p>I'm trying to write a function in Go which generates XML and returns a reader for it.  However, the XML encoder seems to take a writer to write to and I'm not quite sure how to pipe the output of the writer to the reader I want to return.</p>\n\n<p>I tried this:</p>\n\n<pre><code>func (i *Item) ToRss() io.Reader {                                                     \n  reader, writer := io.Pipe()                                                             \n  enc := xml.NewEncoder(writer)                                                           \n  enc.Indent(\"  \", \"   \")                                                                 \n  enc.Encode(i)                                                                           \n  return reader                                                                           \n}\n</code></pre>\n\n<p>But when I run the following I get a fatal error:</p>\n\n<pre><code>  r := a.ToRss()\n  buf := new(bytes.Buffer)\n  buf.ReadFrom(r)\n  s := buf.String()\n  fmt.Println(s)\n</code></pre>\n\n<blockquote>\n  <p>fatal error: all goroutines are asleep - deadlock!</p>\n</blockquote>\n\n<p>Eventually I'd like to pipe the reader to the output of an HTTP request.  Should I just return a []byte?  Or is there a nice way to buffer the output so the client can use the reader?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 4, "creation_date": 1429311273, "post_id": 29710685, "comment_id": 47557052, "body": "Did you even look at the preview before posting your question?"}, {"owner": {"reputation": 13, "user_id": 4803118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34fcde7ecaa8d4309d26c14a9603869f?s=128&d=identicon&r=PG&f=1", "display_name": "Timmy Miller", "link": "https://stackoverflow.com/users/4803118/timmy-miller"}, "reply_to_user": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 0, "creation_date": 1429321035, "post_id": 29710685, "comment_id": 47559347, "body": "What&#39;s not to understand about the question though?"}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 2, "last_activity_date": 1429313593, "last_edit_date": 1429313593, "creation_date": 1429312836, "answer_id": 29710986, "question_id": 29710685, "link": "https://stackoverflow.com/questions/29710685/how-to-calculate-a-random-number-in-go/29710986#29710986", "title": "How to calculate a random number in Go?", "body": "<p>See the <a href=\"http://golang.org/pkg/math/rand/\" rel=\"nofollow\"><code>math/rand</code> package documentation</a> for how to generate random numbers.  e.g.:</p>\n\n<pre><code>package main\n\nimport \"math/rand\"\nimport \"time\"\n\nfunc main() {\n  seed := time.Now().UnixNano()\n  random := rand.New(rand.NewSource(seed))\n  println(random.Float64()) // =&gt; +8.277637e-001\n  println(random.Int())     // =&gt; 7112143871403206581\n  // etc.\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 4803118, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34fcde7ecaa8d4309d26c14a9603869f?s=128&d=identicon&r=PG&f=1", "display_name": "Timmy Miller", "link": "https://stackoverflow.com/users/4803118/timmy-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "closed_date": 1429318183, "answer_count": 1, "score": -6, "last_activity_date": 1429313593, "creation_date": 1429311054, "last_edit_date": 1429311696, "question_id": 29710685, "link": "https://stackoverflow.com/questions/29710685/how-to-calculate-a-random-number-in-go", "closed_reason": "Not suitable for this site", "title": "How to calculate a random number in Go?", "body": "<pre><code>package main\n\nimport \"fmt\"\n\nimport \"math/rand\"\n\nfunc main() {\n\n    var milesdriven float64\n    var enginerunningloud bool = true\n    var changeoil bool = true\n\n    if milesdriven &gt;= 3000.0 || enginerunningloud == false {\n\n        float64 := (milesdriven * Rand)\n        changeoil = true\n        fmt.Println(\"Change that oil duuuuuude\")\n\n    }\n\n}\n</code></pre>\n\n<p>This is what I have so far but I keep getting imported and not used \"math/rand\" and also a undefined Rand what does that mean? And what should I do?</p>\n"}, {"tags": ["ssh", "go", "command-line-interface"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1429302904, "post_id": 29708760, "comment_id": 47553355, "body": "Try printing some debug output from the <code>ssh</code> command, and comparing it the same command from the shell."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1429308672, "post_id": 29708760, "comment_id": 47556086, "body": "Also, make sure c.Address doesn&#39;t contain any extra whitespace or unprintable characters."}, {"owner": {"reputation": 1036, "user_id": 1737204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2851ca9622b504c85b92fc3e93d87b1f?s=128&d=identicon&r=PG", "display_name": "wldsvc", "link": "https://stackoverflow.com/users/1737204/wldsvc"}, "edited": false, "score": 0, "creation_date": 1429311294, "post_id": 29708760, "comment_id": 47557057, "body": "Weird one. Try localhost. Isn&#39;t c.Address a function? (being tired happens ;). Not related to address resolution, but who knows: Try with an absolute path to the ssh executable, in the unlikely event that your PATH has something to do with it. What OS are you using? That might be helpful to know."}, {"owner": {"reputation": 180, "user_id": 3790925, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/49393aac523699a780663ce523c109aa?s=128&d=identicon&r=PG&f=1", "display_name": "jisaw", "link": "https://stackoverflow.com/users/3790925/jisaw"}, "edited": false, "score": 0, "creation_date": 1429336384, "post_id": 29708760, "comment_id": 47562118, "body": "c.Address is the string field of a struct. I am running this on a Mac. I tried to split the user name and the ip up and got the following.      ssh: connect to host  port 22: Connection refused"}, {"owner": {"reputation": 1036, "user_id": 1737204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2851ca9622b504c85b92fc3e93d87b1f?s=128&d=identicon&r=PG", "display_name": "wldsvc", "link": "https://stackoverflow.com/users/1737204/wldsvc"}, "edited": false, "score": 0, "creation_date": 1429354752, "post_id": 29708760, "comment_id": 47567331, "body": "If you can connect to the same IP from the command line, then there&#39;s definitely something wrong with your ssh arguments. Have you tried to use a constant string, like <code>cmd := exec.Command(&quot;ssh&quot;, &quot;192.168.1.1&quot;) ...</code> This would eliminate any suspicions regarding <code>c.Address</code>. To check if <code>c.Adress</code> is really what you expect it to be, you can dump it with <code>fmt.Printf(&quot;%+q\\n&quot;, c.Address)</code> (guarantees ascii output)."}, {"owner": {"reputation": 1036, "user_id": 1737204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2851ca9622b504c85b92fc3e93d87b1f?s=128&d=identicon&r=PG", "display_name": "wldsvc", "link": "https://stackoverflow.com/users/1737204/wldsvc"}, "edited": false, "score": 2, "creation_date": 1429355027, "post_id": 29708760, "comment_id": 47567436, "body": "Oh, just noticed that you&#39;re converting <code>c.Address</code> to a string, is it a fixed size <code>[]byte</code> slice by any chance? Any garbage at the end of the slice like trailing 0&#39;s would be added to the string. See <a href=\"http://play.golang.org/p/oYqsjtci24\" rel=\"nofollow noreferrer\">this example</a>."}, {"owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "edited": false, "score": 1, "creation_date": 1433370133, "post_id": 29708760, "comment_id": 49329149, "body": "you could give the package golang.org/x/crypto/ssh a try \ud83d\ude09"}], "answers": [{"tags": [], "owner": {"reputation": 2854, "user_id": 41292, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/939e50606775eea4b7589dd7aebbd8b3?s=128&d=identicon&r=PG", "display_name": "LenW", "link": "https://stackoverflow.com/users/41292/lenw"}, "is_accepted": false, "score": 0, "last_activity_date": 1435303745, "creation_date": 1435303745, "answer_id": 31067451, "question_id": 29708760, "link": "https://stackoverflow.com/questions/29708760/connecting-with-ssh-through-the-shell/31067451#31067451", "title": "Connecting with ssh through the shell?", "body": "<p>If you have </p>\n\n<p><code>cmd := exec.Command(\"ssh\", string(\"root@192.168.1.1\"))</code></p>\n\n<p>it works. As per the comment above if you have </p>\n\n<p><code>cmd := exec.Command(\"ssh\", string(\"root@192.168.1.1 \"))</code> - notice the extra space</p>\n\n<p>then you will get the error you you described.</p>\n"}, {"tags": [], "owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "is_accepted": true, "score": 2, "last_activity_date": 1450422483, "creation_date": 1450422483, "answer_id": 34350172, "question_id": 29708760, "link": "https://stackoverflow.com/questions/29708760/connecting-with-ssh-through-the-shell/34350172#34350172", "title": "Connecting with ssh through the shell?", "body": "<p>Use the <code>golang.org/x/crypto/ssh</code> package.</p>\n\n<p><a href=\"https://godoc.org/golang.org/x/crypto/ssh\" rel=\"nofollow\">Package documentation.</a></p>\n\n<p><a href=\"http://golang-basic.blogspot.com/2014/06/step-by-step-guide-to-ssh-using-go.html\" rel=\"nofollow\">Nice tutorial to get you started.</a></p>\n"}], "owner": {"reputation": 180, "user_id": 3790925, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/49393aac523699a780663ce523c109aa?s=128&d=identicon&r=PG&f=1", "display_name": "jisaw", "link": "https://stackoverflow.com/users/3790925/jisaw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 34350172, "answer_count": 2, "score": 5, "last_activity_date": 1454146064, "creation_date": 1429302470, "question_id": 29708760, "link": "https://stackoverflow.com/questions/29708760/connecting-with-ssh-through-the-shell", "title": "Connecting with ssh through the shell?", "body": "<p>I am working with Go trying to automate keeping track of all of my ssh connections. I am having some issues running the command from Go. Here is my code:</p>\n\n<pre><code>cmd := exec.Command(\"ssh\", string(c.Address))\n        cmd.Stderr = os.Stderr\n        cmd.Stdin = os.Stdin\n        cmd.Stdout = os.Stdout\n        err2 := cmd.Run()\n        if err2 != nil {\n            fmt.Print(\"Disconnected\")\n        }\n</code></pre>\n\n<p>c.Address is equivalent to \"person@192.168.1.1\" not using that ip obviously but when I run this I get the following error. </p>\n\n<pre><code>ssh: Could not resolve hostname 192.168.1.1\n: nodename nor servname provided, or not known\n</code></pre>\n\n<p>I can connect just fine using ssh from my terminal. </p>\n\n<p>Thanks!</p>\n"}, {"tags": ["git", "go", "get", "package", "gitlab"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1429298758, "post_id": 29707689, "comment_id": 47551220, "body": "that&#39;s not how <code>go get</code> works, it uses import paths, not direct scm uris. Does your gitlab have https git access (like github)?"}, {"owner": {"reputation": 1772, "user_id": 2904939, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pEOFP.png?s=128&g=1", "display_name": "James Fremen", "link": "https://stackoverflow.com/users/2904939/james-fremen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1429300160, "post_id": 29707689, "comment_id": 47551993, "body": "I&#39;m not sure. It was installed via this procedure: <a href=\"https://cloud.google.com/solutions/gitlab/\" rel=\"nofollow noreferrer\">cloud.google.com/solutions/gitlab</a> . Is there a way i can tell?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1429300572, "post_id": 29707689, "comment_id": 47552203, "body": "I&#39;m not really familiar with gitlab, but I know they added support for <code>go get</code> on public projects: <a href=\"https://github.com/gitlabhq/gitlabhq/pull/5958\" rel=\"nofollow noreferrer\">github.com/gitlabhq/gitlabhq/pull/5958</a>. Worst case you can always just do the initial clone of the repo into your GOPATH manually"}, {"owner": {"reputation": 1772, "user_id": 2904939, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pEOFP.png?s=128&g=1", "display_name": "James Fremen", "link": "https://stackoverflow.com/users/2904939/james-fremen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1429300794, "post_id": 29707689, "comment_id": 47552324, "body": "regrettably i have to use a private repo for this. I am using the &#39;worst case&#39; for now :)."}, {"owner": {"reputation": 8149, "user_id": 616644, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wVwGC.png?s=128&g=1", "display_name": "Rick Smith", "link": "https://stackoverflow.com/users/616644/rick-smith"}, "edited": false, "score": 1, "creation_date": 1508795206, "post_id": 29707689, "comment_id": 80745256, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/27500861/whats-the-proper-way-to-go-get-a-private-repository\">What&#39;s the proper way to &quot;go get&quot; a private repository?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1772, "user_id": 2904939, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pEOFP.png?s=128&g=1", "display_name": "James Fremen", "link": "https://stackoverflow.com/users/2904939/james-fremen"}, "edited": false, "score": 0, "creation_date": 1429391588, "post_id": 29708395, "comment_id": 47580087, "body": "yes, i think this is the workaround i&#39;m currently using."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 7, "last_activity_date": 1429300971, "creation_date": 1429300971, "answer_id": 29708395, "question_id": 29707689, "link": "https://stackoverflow.com/questions/29707689/how-to-use-go-with-a-private-gitlab-repo/29708395#29708395", "title": "How to use Go with a private GitLab repo", "body": "<p>If <code>go get</code> can't fetch the repo, you can always do the initial clone with git directly:</p>\n\n<pre><code>git clone git@gitlab:private-developers/project.git $GOPATH/src/gitlab/private-developers/project\n</code></pre>\n\n<p>The tools will then work normally, expect for <code>go get -u</code> which will require the <code>-f</code> flag because the git remote doesn't match the canonical import path.</p>\n"}, {"comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 1, "creation_date": 1429327565, "post_id": 29711678, "comment_id": 47560518, "body": "He is talking about gitlab, not github. Gitlab is an open source project for private repository hosting."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 0, "last_activity_date": 1429318715, "creation_date": 1429318715, "answer_id": 29711678, "question_id": 29707689, "link": "https://stackoverflow.com/questions/29707689/how-to-use-go-with-a-private-gitlab-repo/29711678#29711678", "title": "How to use Go with a private GitLab repo", "body": "<p>You can setup your git credentials and Go will use them:</p>\n\n<ol>\n<li>generate a unique password on your github (somewhere in settings).</li>\n<li><code>git config credential.helper store</code></li>\n<li><code>echo https://your-github-username:your-generated-password@github.com &gt;&gt; ~/.git-credentials</code></li>\n<li>profit.</li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 1772, "user_id": 2904939, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pEOFP.png?s=128&g=1", "display_name": "James Fremen", "link": "https://stackoverflow.com/users/2904939/james-fremen"}, "edited": false, "score": 0, "creation_date": 1429396762, "post_id": 29712528, "comment_id": 47581641, "body": "I&#39;ve posted an answer as well.. it seems like a fix is in gitlab 7.9."}, {"owner": {"reputation": 1772, "user_id": 2904939, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pEOFP.png?s=128&g=1", "display_name": "James Fremen", "link": "https://stackoverflow.com/users/2904939/james-fremen"}, "edited": false, "score": 0, "creation_date": 1429397296, "post_id": 29712528, "comment_id": 47581767, "body": "thanks for all the help.. hopefully this is working smoothly in the near future"}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 3, "last_activity_date": 1429327519, "creation_date": 1429327519, "answer_id": 29712528, "question_id": 29707689, "link": "https://stackoverflow.com/questions/29707689/how-to-use-go-with-a-private-gitlab-repo/29712528#29712528", "title": "How to use Go with a private GitLab repo", "body": "<p>Gitlab does support <code>go get</code> natively. </p>\n\n<p><code>go get</code> will issue an http request to the url you provide and look for meta tags that point to the exact source control path.</p>\n\n<p>For my gitlab installation this is <code>mygitlabdomain.com/myProject/myRepo</code>. For you I assume this would be <code>1.2.3.4/private-developers/project</code>.</p>\n\n<p>Unfortunately it only appears to give the http scm path, not the ssh path, so I had to enter my credentials to clone. You can easily fiddle with the remote in your local repository after it clones if you want to update to the ssh url.</p>\n\n<p>You can test the url by poking <code>http://1.2.3.4:private-developers/project?go-get=1</code> and viewing source and looking for the meta tag.</p>\n"}, {"comments": [{"owner": {"reputation": 1772, "user_id": 2904939, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pEOFP.png?s=128&g=1", "display_name": "James Fremen", "link": "https://stackoverflow.com/users/2904939/james-fremen"}, "edited": false, "score": 0, "creation_date": 1429721529, "post_id": 29723697, "comment_id": 47735978, "body": "Just a heads up. Although the bug was closed, the issue still remains."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1450210662, "post_id": 29723697, "comment_id": 56338951, "body": "@JamesFreman I&#39;m on gitlab 8.2, and still getting http urls. Any idea what is going on?"}], "tags": [], "owner": {"reputation": 1772, "user_id": 2904939, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pEOFP.png?s=128&g=1", "display_name": "James Fremen", "link": "https://stackoverflow.com/users/2904939/james-fremen"}, "is_accepted": false, "score": 1, "last_activity_date": 1515072468, "last_edit_date": 1515072468, "creation_date": 1429396594, "answer_id": 29723697, "question_id": 29707689, "link": "https://stackoverflow.com/questions/29707689/how-to-use-go-with-a-private-gitlab-repo/29723697#29723697", "title": "How to use Go with a private GitLab repo", "body": "<p>For the record, this works outside of go using gitlab 7.3.2 and, as JimB has observed, can be used as a workaround. I find that i do get prompted for username/password, even though an SSH key is registered with gitlab: </p>\n\n<pre class=\"lang-bash prettyprint-override\"><code>git clone http://1.2.3.4/private-developers/project.git\n</code></pre>\n\n<p>Alternatively i can use the SSH equivalent which, since i have an SSH key registered with gitlab, avoids the prompts: </p>\n\n<pre class=\"lang-bash prettyprint-override\"><code>git clone git@1.2.3.4:private-developers/project.git\n</code></pre>\n\n<p>Neither works with go currently. A fix may be in 7.9 but i haven't had a chance to test it:\n<a href=\"http://github.com/gitlabhq/gitlabhq/issues/8949\" rel=\"nofollow noreferrer\">upcoming bugfix</a></p>\n"}, {"tags": [], "owner": {"reputation": 8149, "user_id": 616644, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wVwGC.png?s=128&g=1", "display_name": "Rick Smith", "link": "https://stackoverflow.com/users/616644/rick-smith"}, "is_accepted": false, "score": 39, "last_activity_date": 1521753581, "last_edit_date": 1521753581, "creation_date": 1466019245, "answer_id": 37844256, "question_id": 29707689, "link": "https://stackoverflow.com/questions/29707689/how-to-use-go-with-a-private-gitlab-repo/37844256#37844256", "title": "How to use Go with a private GitLab repo", "body": "<p>Run this command:</p>\n\n<pre><code>git config --global url.\"git@1.2.3.4:\".insteadOf \"https://1.2.3.4/\"\n</code></pre>\n\n<p>Assuming you have the correct privileges to <code>git clone</code> the repository, this will make <code>go get</code> work for <strong>all</strong> repos on server <code>1.2.3.4</code>. </p>\n\n<p>I tested this with go version 1.6.2, 1.8, and 1.9.1.</p>\n"}, {"comments": [{"owner": {"reputation": 1772, "user_id": 2904939, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pEOFP.png?s=128&g=1", "display_name": "James Fremen", "link": "https://stackoverflow.com/users/2904939/james-fremen"}, "edited": false, "score": 1, "creation_date": 1495068896, "post_id": 44036234, "comment_id": 75100471, "body": "regrettably i can&#39;t verify that this works as I&#39;m not currently using gitlab. If someone can verify this i&#39;ll mark it as the answer."}, {"owner": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "reply_to_user": {"reputation": 1772, "user_id": 2904939, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pEOFP.png?s=128&g=1", "display_name": "James Fremen", "link": "https://stackoverflow.com/users/2904939/james-fremen"}, "edited": false, "score": 0, "creation_date": 1497471890, "post_id": 44036234, "comment_id": 76098495, "body": "Thanks @JamesFremen, I don&#39;t know that anyone will jump on it but I&#39;ve had several people ask me about it and it seems to work well."}, {"owner": {"reputation": 302, "user_id": 1527037, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZMun0.png?s=128&g=1", "display_name": "dirkaholic", "link": "https://stackoverflow.com/users/1527037/dirkaholic"}, "edited": false, "score": 3, "creation_date": 1500482241, "post_id": 44036234, "comment_id": 77359956, "body": "This worked for me after I added one more line to the <code>before_script</code> section: <code>- git config --global url.&quot;git@gitlab.com:&quot;.insteadOf &quot;https:&#47;&#47;gitlab.com&#47;&quot;</code>"}], "tags": [], "owner": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "is_accepted": true, "score": 21, "last_activity_date": 1505811853, "last_edit_date": 1505811853, "creation_date": 1495063384, "answer_id": 44036234, "question_id": 29707689, "link": "https://stackoverflow.com/questions/29707689/how-to-use-go-with-a-private-gitlab-repo/44036234#44036234", "title": "How to use Go with a private GitLab repo", "body": "<p>This issue is now resolved in Gitlab 8.* but is still unintuitive. The most difficult challenge indeed is <code>go get</code> and the following steps will allow you to overcome those:</p>\n\n<ol>\n<li><p>Create an SSH key pair. Be sure to not overwrite an existing pair that is by default saved in <code>~/.ssh/</code>.</p>\n\n<pre><code>ssh-keygen -t rsa -b 4096\n</code></pre></li>\n<li><p>Create a new <em>Secret Variable</em> in your Gitlab project. Use <code>SSH_PRIVATE_KEY</code> as <em>Key</em> and the content of your <em>private</em> key as <em>Value</em>.</p></li>\n<li><p>Modify your <code>.gitlab-ci.yml</code> with a <code>before_script</code>.</p>\n\n<pre><code>before_script:\n  # install ssh-agent if not already installed\n  - 'which ssh-agent || ( apt-get update -y &amp;&amp; apt-get install openssh-client -y )'\n  # run ssh-agent\n  - eval $(ssh-agent -s)\n  # add the SSH key stored in SSH_PRIVATE_KEY\n  - ssh-add &lt;(echo \"$SSH_PRIVATE_KEY\")\n  # for Docker builds disable host key checking\n  - mkdir -p ~/.ssh\n  - '[[ -f /.dockerenv ]] &amp;&amp; echo -e \"Host *\\n\\tStrictHostKeyChecking no\\n\\n\" &gt; ~/.ssh/config'\n</code></pre></li>\n<li><p>Add the <em>public</em> key from the key pair created in step 1 as a <em>Deploy Key</em> in the project that you need to <code>go get</code>.</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 3281, "user_id": 4131775, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KDmA5SDbD84/AAAAAAAAAAI/AAAAAAAAAAA/WQxPLtYrNu4/photo.jpg?sz=128", "display_name": "Feiyu Zhou", "link": "https://stackoverflow.com/users/4131775/feiyu-zhou"}, "is_accepted": false, "score": 2, "last_activity_date": 1587607126, "last_edit_date": 1587607126, "creation_date": 1555321363, "answer_id": 55686425, "question_id": 29707689, "link": "https://stackoverflow.com/questions/29707689/how-to-use-go-with-a-private-gitlab-repo/55686425#55686425", "title": "How to use Go with a private GitLab repo", "body": "<p>For HTTPS private gitlab repo, @Rick Smith's answer is enough. Here's a compensation for HTTP repo, first run the command:</p>\n\n<pre><code>git config --global url.\"git@mygitlab.com:\".insteadOf \"http://mygitlab.com/\"\n</code></pre>\n\n<p>then use below <code>go get</code> command to get the golang project:</p>\n\n<pre><code>go get -v  -insecure  mygitlab.com/user/repo\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2485, "user_id": 3639630, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rPscq.jpg?s=128&g=1", "display_name": "Wesgur", "link": "https://stackoverflow.com/users/3639630/wesgur"}, "is_accepted": false, "score": 1, "last_activity_date": 1557375527, "creation_date": 1557375527, "answer_id": 56052142, "question_id": 29707689, "link": "https://stackoverflow.com/questions/29707689/how-to-use-go-with-a-private-gitlab-repo/56052142#56052142", "title": "How to use Go with a private GitLab repo", "body": "<p>From <a href=\"https://github.com/golang/dep\" rel=\"nofollow noreferrer\">dep</a> version 5.2, <code>dep</code> supports private repositories for Gitlab private repositories.</p>\n\n<p>On <a href=\"https://ec.haxx.se/usingcurl-netrc.html\" rel=\"nofollow noreferrer\">.netrc</a> file, you can provide your Gitlab username and access token for accessing private repositories. </p>\n\n<ol>\n<li>Create <code>.netrc</code> file in your $HOME directory</li>\n</ol>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ touch $HOME/.netrc\n</code></pre>\n\n<ol start=\"2\">\n<li>Edit your <code>.netrc</code> with your Gitlab credentials</li>\n</ol>\n\n<pre><code>machine gitlab.&lt;private&gt;.com\nlogin &lt;gitlab-username&gt;\npassword &lt;gitlab-access-token&gt;\n\n... (more private repositories if needed)\n</code></pre>\n\n<ol start=\"3\">\n<li>In your Go repository, run the <code>dep</code> command to resolve private packages. In this case,</li>\n</ol>\n\n<pre><code>$ dep ensure -v\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 104, "user_id": 6674180, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hTi2Q.jpg?s=128&g=1", "display_name": "Marlon Monroy", "link": "https://stackoverflow.com/users/6674180/marlon-monroy"}, "is_accepted": false, "score": 2, "last_activity_date": 1576220010, "creation_date": 1576220010, "answer_id": 59317516, "question_id": 29707689, "link": "https://stackoverflow.com/questions/29707689/how-to-use-go-with-a-private-gitlab-repo/59317516#59317516", "title": "How to use Go with a private GitLab repo", "body": "<p>The way I usually do it is: </p>\n\n<p>Ensure you are using SSH. </p>\n\n<p>once that's done you can configure your git to use <code>ssh</code> instead <code>https</code></p>\n\n<p>If you are using Mac OX. you can run vim ~/.gitconfig\nand add </p>\n\n<pre><code>[url \"git@gitlab.com:\"]\ninsteadOf = https://gitlab.com/\n</code></pre>\n\n<p>once configured you can run </p>\n\n<pre><code>GOPRIVATE=\"gitlab.com/your_username_or_group\" go get gitlab.com/name_or_group/repo_name\n</code></pre>\n\n<p>I hope that helps.</p>\n"}, {"tags": [], "owner": {"reputation": 53, "user_id": 1418320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d1c248bc1ed54443132615fdd543c82?s=128&d=identicon&r=PG", "display_name": "Paul Jacobus Van Staden", "link": "https://stackoverflow.com/users/1418320/paul-jacobus-van-staden"}, "is_accepted": false, "score": 4, "last_activity_date": 1584949138, "creation_date": 1584949138, "answer_id": 60809532, "question_id": 29707689, "link": "https://stackoverflow.com/questions/29707689/how-to-use-go-with-a-private-gitlab-repo/60809532#60809532", "title": "How to use Go with a private GitLab repo", "body": "<p>Easiest way with Gitlab</p>\n\n<pre><code>before_script:\n  - git config --global url.\"https://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.com/\".insteadOf https://gitlab.com/\n  - go env -w GOPRIVATE=gitlab.com/${CI_PROJECT_NAMESPACE}\n</code></pre>\n\n<p>See more details here: <a href=\"https://docs.gitlab.com/ee/user/project/new_ci_build_permissions_model.html#dependent-repositories\" rel=\"nofollow noreferrer\">https://docs.gitlab.com/ee/user/project/new_ci_build_permissions_model.html#dependent-repositories</a></p>\n"}, {"tags": [], "owner": {"reputation": 186, "user_id": 8802912, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce8e7f0f7a0b1f9c1404cce15aeeea09?s=128&d=identicon&r=PG&f=1", "display_name": "Cindy", "link": "https://stackoverflow.com/users/8802912/cindy"}, "is_accepted": false, "score": 2, "last_activity_date": 1587063283, "last_edit_date": 1587063283, "creation_date": 1587062891, "answer_id": 61257782, "question_id": 29707689, "link": "https://stackoverflow.com/questions/29707689/how-to-use-go-with-a-private-gitlab-repo/61257782#61257782", "title": "How to use Go with a private GitLab repo", "body": "<p>GitLab version 11.8+ and Go version 1.13+ will work with BASIC auth by using your GitLab personal token.\nGo to Settings -> Access Tokens in your Gitlab, add a personal access token or use your existing one.\nIn your ~/.netrc file, add following lines:</p>\n\n<pre><code>machine &lt;your GitLab domain&gt; (e.g. gitlab.com)\nlogin &lt;your GitLab id&gt;\npassword &lt;your GitLab personal access token&gt;\n</code></pre>\n\n<p>Then you should be able to do go get locally.</p>\n\n<p>If you need to build it in CI, then add following line in your .gitlab-ci.yml file:</p>\n\n<pre><code>before_script:\n    - echo -e \"machine &lt;your GitLab domain&gt;\\nlogin gitlab-ci-token\\npassword ${CI_JOB_TOKEN}\" &gt; ~/.netrc\n</code></pre>\n"}], "owner": {"reputation": 1772, "user_id": 2904939, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pEOFP.png?s=128&g=1", "display_name": "James Fremen", "link": "https://stackoverflow.com/users/2904939/james-fremen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43729, "favorite_count": 21, "accepted_answer_id": 44036234, "answer_count": 11, "score": 46, "last_activity_date": 1587607126, "creation_date": 1429298352, "last_edit_date": 1578773795, "question_id": 29707689, "link": "https://stackoverflow.com/questions/29707689/how-to-use-go-with-a-private-gitlab-repo", "title": "How to use Go with a private GitLab repo", "body": "<p>GitLab is a free, open-source way to host private <code>.git</code> repositories but it does not seem to work with Go. When you create a project it generates a URL of the form:</p>\n\n<pre><code>git@1.2.3.4:private-developers/project.git\n</code></pre>\n\n<p>where:</p>\n\n<ul>\n<li><code>1.2.3.4</code> is the IP address of the gitlab server</li>\n<li><code>private-developers</code> is a user group which has access to the private repo</li>\n</ul>\n\n<p>Golang 1.2.1 doesn't seem to understand this syntax.</p>\n\n<pre><code>go get git@1.2.3.4:private-developers/project.git\n</code></pre>\n\n<p>results in:</p>\n\n<pre><code>package git@23.251.148.129/project.git: unrecognized import path \"git@1.2.3.4/project.git\"\n</code></pre>\n\n<p>Is there a way to get this to work?</p>\n"}, {"tags": ["sql", "json", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1429297619, "post_id": 29706727, "comment_id": 47550591, "body": "Why are you using <code>json.RawMessage</code>? Why not just <code>[]byte</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1429304169, "post_id": 29708398, "comment_id": 47553985, "body": "Interesting, I only have an old PostgreSQL server running that lacks the &quot;json&quot; type you appear to be using so I substituted &quot;text&quot; \u2026 but that works going directly into a <code>json.RawMessage</code> field so I suspect the above won&#39;t help and the problem may be related to the pq driver and &quot;json&quot; fields."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1429305295, "post_id": 29708398, "comment_id": 47554565, "body": "Okay, with an updated postgresql with a json query works fine they way you had it but on insert I had to use <code>[]byte(item.Tag)</code>"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1429306887, "post_id": 29708398, "comment_id": 47555283, "body": "Answer changed due to the above testing (the revision history has my old not-so-correct answer for anyone interested)"}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": false, "score": 2, "last_activity_date": 1429307564, "last_edit_date": 1429307564, "creation_date": 1429300984, "answer_id": 29708398, "question_id": 29706727, "link": "https://stackoverflow.com/questions/29706727/how-to-avoid-scan-pair-nil-json-rawmessage-errors-on-nullable-json-columns/29708398#29708398", "title": "How to avoid Scan pair: &lt;nil&gt; *json.RawMessage errors on nullable JSON columns?", "body": "<p>TL;DR: change your struct to have <code>Tags *json.RawMessage</code> or use a temporary of that type.</p>\n\n<p>Note you can <a href=\"https://golang.org/search?q=unsupported+driver+-%3E+Scan+pair\" rel=\"nofollow\">search the Go source</a> for the error message to get a better idea of what's going on behind the scenes if you're interested (the standard packages are mostly a good source of well written Go code).</p>\n\n<p>I tested against a fresh PostgreSQL-9.4.1 server with the following table:</p>\n\n<pre><code>CREATE TABLE post (\n        \"id\"    serial          PRIMARY KEY,\n        \"title\" varchar(255)    NOT NULL,\n        \"body\"  text,\n        \"tags\"  json\n);\n</code></pre>\n\n<p>(by the way, it's probably better to give the commands to re-create, or that where used to create the table rather than the form use gave which can't directly be used. Also, when I was familiar with PostgreSQL I recall it was exceedingly rare that a <code>varchar</code> column wasn't a mistake instead of just using <code>text</code>, possibly with a length constraint.)</p>\n\n<p>Using that table with your struct type I got:</p>\n\n<pre><code>converting Exec argument #2's type: unsupported type json.RawMessage, a slice\n</code></pre>\n\n<p>On the insert. Changing to <code>[]byte(p.Tags)</code> made that go away (but see below) and then querying worked as you had it.</p>\n\n<p>I only got the same error you did on querying when I put a NULL value into the table. The solution to this was to change the struct field to <code>Tags *json.RawMessage</code>. I could then remove the cast I added on insert and and the query worked fine, either setting the field to <code>nil</code> or not as appropriate.</p>\n\n<p>If you do this, don't forget to check if <code>item.Tags</code> is <code>nil</code> before using it. Alternatively, make the database field <code>NOT NULL</code>.</p>\n\n<p>I'm not overly familiar with Go's database support to know if requiring a pointer to a slice to handle NULLs is reasonable; I'd have hoped not since Go already distinguishes between an empty slice and a nil slice.</p>\n\n<p>Alternatively, you can leave your type as-is and use a temporary like this:</p>\n\n<pre><code>    var item post\n    var tmp *json.RawMessage\n    if err := rows.Scan(&amp;item.Id, &amp;item.Title, &amp;item.Body, &amp;tmp); err != nil {\n        log.Fatal(err)\n    }\n    if tmp != nil {\n        item.Tags = *tmp\n    }\n</code></pre>\n\n<p>You'll likely experience a similar issue when you test with a NULL body. Either make the database column <code>NOT NULL</code> or use <code>sql.NullString</code>, either in your type or as a temporary as above (using the <code>Valid</code> field of <code>NullString</code> to see if you should copy the string).</p>\n\n<hr>\n\n<p>A few other minor notes:</p>\n\n<ul>\n<li><code>golint</code> suggests using <code>ID</code> instead of <code>Id</code>.</li>\n<li>You don't provide your <code>GetDB</code> implementation, I hope it's just getting a shared/global <code>*sql.DB</code>. You don't want to call <code>sql.Open</code> repeatedly.</li>\n<li>In both of your functions you could use a <a href=\"https://golang.org/pkg/database/sql/#DB.Prepare\" rel=\"nofollow\">pre-prepared</a> statement (created once outside those functions). That might help if you call those functions often.</li>\n<li>Your query tries to use the \"posts\" table/view instead of \"post\"; I'm guessing a typo while cut-n-pasting to the question? </li>\n<li>Your <code>getLatestPosts</code> function reutrns <code>*[]Post</code>; don't do that. Just return <code>[]Post</code>. You almost never want to use a pointer to a slice, and certainly not as a return type.</li>\n</ul>\n"}], "owner": {"reputation": 9320, "user_id": 199593, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/j0ESL.gif?s=128&g=1", "display_name": "edigu", "link": "https://stackoverflow.com/users/199593/edigu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1348, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1429307564, "creation_date": 1429294999, "question_id": 29706727, "link": "https://stackoverflow.com/questions/29706727/how-to-avoid-scan-pair-nil-json-rawmessage-errors-on-nullable-json-columns", "title": "How to avoid Scan pair: &lt;nil&gt; *json.RawMessage errors on nullable JSON columns?", "body": "<p>Several weeks ago I started to learn go and trying to build a simple blogging application while learning the basics.</p>\n\n<p>Currently I'm trying to fetch and persist blog posts using <code>database/sql</code> and <code>github.com/lib/pq</code> packages. I dont prefer utilizing 3rd party packages like <code>sqlx</code> or <code>gorm</code> without fully understand the native behaviours and basics of the go.</p>\n\n<p>My <code>Post</code> struct is something like this:</p>\n\n<pre><code>type Post struct {\n    Id        int\n    Title     string\n    Body      string\n    Tags      json.RawMessage\n}\n</code></pre>\n\n<p>When persisting posts, my <code>save()</code> function works without any problem:</p>\n\n<pre><code>func (p *Post) save() (int, error) {\n    const query = `INSERT INTO post (title, body, tags) VALUES($1, $2, $3) RETURNING id`\n    db := GetDB()\n    var postid int\n    err := db.QueryRow(query, p.Title, p.Body, p.Tags).Scan(&amp;postid)\n    return postid, err\n}\n</code></pre>\n\n<p>and to read the latest posts, I wrote a small function:</p>\n\n<pre><code>func getLatestPosts(page int) (*[]Post, error) {\n    const query = `SELECT id, title, body, tags FROM posts ORDER BY id DESC LIMIT 10`\n    var items []Post\n    db := GetDB()\n    rows, err := db.Query(query)\n    if err != nil {\n        return nil, err\n    }\n\n    for rows.Next() {\n        var item Post\n        if err := rows.Scan(&amp;item.Id, &amp;item.Title, &amp;item.Body, &amp;item.Tags); err != nil {        \n            log.Fatal(err)\n        }\n        items = append(items, item)\n    }\n    return &amp;items, err\n}\n</code></pre>\n\n<p>This also works until hitting a post row which tags column is null and I'm getting the following error at this point:</p>\n\n<blockquote>\n  <p>2015/04/16 21:53:04 sql: Scan error on column index 4: unsupported\n  driver -> Scan pair:  -> *json.RawMessage</p>\n</blockquote>\n\n<p>My question is, what is the proper way to handle <code>nullable json</code> columns while scanning the resultset? Is this error related with the <code>lib/pq</code>?</p>\n\n<p>My schema is:</p>\n\n<pre><code>CREATE TABLE post (\n    \"id\" int4 NOT NULL DEFAULT nextval('post_id_seq'::regclass),\n    \"title\" varchar(255) NOT NULL COLLATE \"default\",\n    \"body\" text COLLATE \"default\",\n    \"tags\" json,\n    PRIMARY KEY (\"id\") NOT DEFERRABLE INITIALLY IMMEDIATE\n);\n</code></pre>\n\n<p>and here is an already persisted (not-null) <code>tags</code> field content:</p>\n\n<pre><code> {\n     \"black-and-white\" : \"Black and White\",\n     \"the-godfather\" : \"The Godfather\"\n }\n</code></pre>\n\n<p>Any ideas?</p>\n"}, {"tags": ["http", "go", "message-queue", "nsq"], "comments": [{"owner": {"reputation": 707, "user_id": 721861, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/784046b1b72d7969ae850ea7c8b46cba?s=128&d=identicon&r=PG", "display_name": "krait", "link": "https://stackoverflow.com/users/721861/krait"}, "edited": false, "score": 0, "creation_date": 1429309611, "post_id": 29705412, "comment_id": 47556475, "body": "Please rephrase as a specific question"}, {"owner": {"reputation": 1587, "user_id": 2692578, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/422308f27d72a059a020981097da6589?s=128&d=identicon&r=PG", "display_name": "paulkon", "link": "https://stackoverflow.com/users/2692578/paulkon"}, "reply_to_user": {"reputation": 707, "user_id": 721861, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/784046b1b72d7969ae850ea7c8b46cba?s=128&d=identicon&r=PG", "display_name": "krait", "link": "https://stackoverflow.com/users/721861/krait"}, "edited": false, "score": 0, "creation_date": 1429312693, "post_id": 29705412, "comment_id": 47557461, "body": "@krait question rephrased"}], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 2, "last_activity_date": 1429329477, "creation_date": 1429329477, "answer_id": 29712708, "question_id": 29705412, "link": "https://stackoverflow.com/questions/29705412/should-all-independent-tasks-be-processed-outside-the-http-request-goroutine/29712708#29712708", "title": "Should all independent tasks be processed outside the http request goroutine?", "body": "<p>Since the <code>net/http</code> package runs each request you do not need to worry about blocking the request goroutine. The real question you should ask myself is \"Do I need to do this before I return a response to the client, or can it be deferred until later\". Generally if I need to fetch from a database to serve a response that will block the request goroutine, and that is ok. If I can return a response now and put a message on a queue to do stuff later, that can be ok too.</p>\n\n<p>Since the request goroutine has little cost to exist, and it is isolated from other requests, you really don't need to worry about it that much. Do what makes sense for the client.</p>\n"}], "owner": {"reputation": 1587, "user_id": 2692578, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/422308f27d72a059a020981097da6589?s=128&d=identicon&r=PG", "display_name": "paulkon", "link": "https://stackoverflow.com/users/2692578/paulkon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 29712708, "answer_count": 1, "score": 2, "last_activity_date": 1429568327, "creation_date": 1429290354, "last_edit_date": 1429568327, "question_id": 29705412, "link": "https://stackoverflow.com/questions/29705412/should-all-independent-tasks-be-processed-outside-the-http-request-goroutine", "title": "Should all independent tasks be processed outside the http request goroutine?", "body": "<p>Since golang handles incoming requests in separate goroutines, it's unclear to me which types of tasks should be deferred for processing by a message queue e.g. NSQ consumers and which should be handled within the http request goroutine.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "edited": false, "score": 1, "creation_date": 1429382495, "post_id": 29700197, "comment_id": 47577160, "body": "Thanks, it still only works within the same package, but not when running all tests with: ./..."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "edited": false, "score": 5, "creation_date": 1429555368, "post_id": 29700197, "comment_id": 47643833, "body": "@ChrisG. if you&#39;re testing multiple packages, any flags you provide must be valid in all of them. There&#39;s no way around that."}, {"owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "edited": false, "score": 0, "creation_date": 1430214606, "post_id": 29700197, "comment_id": 47953270, "body": "Thanks! Do you know how to ignore a test with regexp -run?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "edited": false, "score": 1, "creation_date": 1430227332, "post_id": 29700197, "comment_id": 47962760, "body": "@ChrisG.: ignoring a test won&#39;t help. You&#39;re telling go to run <code>go test</code> on the <code>.&#47;...</code> wildcard. That&#39;s not a single test run, it&#39;s testing every matching package in succession. Simply don&#39;t use <code>.&#47;...</code> and test the packages you want to test."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 26, "last_activity_date": 1429276309, "creation_date": 1429276309, "answer_id": 29700197, "question_id": 29699982, "link": "https://stackoverflow.com/questions/29699982/go-test-flag-flag-provided-but-not-defined/29700197#29700197", "title": "go test flag: flag provided but not defined", "body": "<p><code>flag.Parse()</code> is being called before your flag is defined.</p>\n\n<p>You have to make sure that all flag definitions happen before calling <code>flag.Parse()</code>, usually by defining all flags inside <code>init()</code> functions.</p>\n"}, {"comments": [{"owner": {"reputation": 63, "user_id": 1853733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95fa0e937eaadf84f06a427a5b2d8655?s=128&d=identicon&r=PG", "display_name": "hunter_tech", "link": "https://stackoverflow.com/users/1853733/hunter-tech"}, "edited": false, "score": 0, "creation_date": 1611142252, "post_id": 58192326, "comment_id": 116353679, "body": "life-saving answer!"}], "tags": [], "owner": {"reputation": 2051, "user_id": 1731801, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cqB7U.png?s=128&g=1", "display_name": "lanwen", "link": "https://stackoverflow.com/users/1731801/lanwen"}, "is_accepted": false, "score": 13, "last_activity_date": 1569964325, "creation_date": 1569964325, "answer_id": 58192326, "question_id": 29699982, "link": "https://stackoverflow.com/questions/29699982/go-test-flag-flag-provided-but-not-defined/58192326#58192326", "title": "go test flag: flag provided but not defined", "body": "<p>If you've migrated to golang 13, it changed the order of the test initializer,\nso it could lead to something like </p>\n\n<pre><code>flag provided but not defined: -test.timeout\n</code></pre>\n\n<p>as a possible workaround, you can use </p>\n\n<pre><code>var _ = func() bool {\n    testing.Init()\n    return true\n}()\n</code></pre>\n\n<p>that would call test initialization before the application one. More info can be found on the original thread:</p>\n\n<p><a href=\"https://github.com/golang/go/issues/31859#issuecomment-489889428\" rel=\"noreferrer\">https://github.com/golang/go/issues/31859#issuecomment-489889428</a></p>\n"}], "owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35236, "favorite_count": 2, "answer_count": 2, "score": 27, "last_activity_date": 1569964325, "creation_date": 1429275709, "question_id": 29699982, "link": "https://stackoverflow.com/questions/29699982/go-test-flag-flag-provided-but-not-defined", "title": "go test flag: flag provided but not defined", "body": "<p>Hi I am using a flag when testing in go:<br>\nfile_test.go\n<code>var ip = flag.String(\"ip\", \"noip\", \"test\")</code></p>\n\n<p>I am only using this in one test file. And it works fine when only testing that one test file, but when I run:\n<code>go test ./... -ip 127.0.0.1</code> alle of the other test file saying: <code>flag provided but not defined</code>.</p>\n\n<p>Have you seen this?</p>\n\n<p>Regards</p>\n"}, {"tags": ["go", "reference", "pass-by-reference"], "answers": [{"tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": false, "score": 3, "last_activity_date": 1429262334, "last_edit_date": 1495539816, "creation_date": 1429262334, "answer_id": 29695140, "question_id": 29694287, "link": "https://stackoverflow.com/questions/29694287/avoiding-go-copying-interface-data/29695140#29695140", "title": "Avoiding Go copying interface data", "body": "<p>The only way to modify the data without copying it is to use pointers.</p>\n\n<p>I'm a little confused by what you are saying as your example uses a struct and you talk about structs but then you say you need to be able to use maps. Either way, DeepReflect works with both. <a href=\"https://play.golang.org/p/MFu4m8rSaj\" rel=\"nofollow noreferrer\">Here</a> is your example modified to use pointers:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype Q interface {\n    modify()\n}\n\ntype P struct {\n    name    string\n    sibling Q\n}\n\nfunc (x *P) modify() {\n    x.name = \"a\"\n}\n\nfunc main() {\n    a := P{\"a\", nil}\n    A := P{\"?\", nil}\n\n    b := P{\"b\", &amp;a}\n    B := P{\"b\", &amp;A}\n\n    B.sibling.modify()\n\n    fmt.Println(\"a:\", a)\n    fmt.Println(\"A:\", A)\n    fmt.Println(\"b:\", b)\n    fmt.Println(\"B:\", B)\n    fmt.Println(b == B)\n    fmt.Println(reflect.DeepEqual(b, B))\n}\n</code></pre>\n\n<p>Prints:</p>\n\n<pre><code>a: {a &lt;nil&gt;}\nA: {a &lt;nil&gt;}\nb: {b 0x10436180}\nB: {b 0x10436190}\nfalse\ntrue\n</code></pre>\n\n<p>And you can see <a href=\"https://stackoverflow.com/questions/24534072/golang-how-to-compare-struct-slice-map-is-equal\">this</a> post for doing the same with maps.</p>\n"}, {"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 0, "last_activity_date": 1429276874, "creation_date": 1429276874, "answer_id": 29700428, "question_id": 29694287, "link": "https://stackoverflow.com/questions/29694287/avoiding-go-copying-interface-data/29700428#29700428", "title": "Avoiding Go copying interface data", "body": "<p>You can use value returned from modify() </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Q interface {\n    modify() Q           //See here\n}\n\ntype P struct {\n    name    string\n    sibling Q\n}\n\nfunc (x P) modify() Q{    //Here\n    x.name = \"a\"\n    return x\n}\n\nfunc main() {\n    a := P{\"a\", nil}\n    A := P{\"?\", nil}\n\n    b := P{\"b\", a}\n    B := P{\"b\", A}\n\n    B.sibling=B.sibling.modify() //And here\n\n    fmt.Println(B)\n    fmt.Println(b == B)\n}\n</code></pre>\n\n<p>It's verbose a bit, but at least works <a href=\"https://play.golang.org/p/8oM90wriN0\" rel=\"nofollow\">https://play.golang.org/p/8oM90wriN0</a></p>\n"}], "owner": {"reputation": 19, "user_id": 4800152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b65cbb0e8b8a264608dfcfa8c9f77f9b?s=128&d=identicon&r=PG&f=1", "display_name": "GoNewb", "link": "https://stackoverflow.com/users/4800152/gonewb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1429289610, "creation_date": 1429259946, "question_id": 29694287, "link": "https://stackoverflow.com/questions/29694287/avoiding-go-copying-interface-data", "title": "Avoiding Go copying interface data", "body": "<p>This is part of real world code I'm trying to write. The problem is that Go copies the interface <code>sibling</code> so I can't modify the data. However, if I change to using a pointer to an interface then the concept of equality fails. I know I can use <code>DeapEquals</code>, but not in a map.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Q interface {\n    modify()\n}\n\ntype P struct {\n    name    string\n    sibling Q\n}\n\nfunc (x P) modify() {\n    x.name = \"a\"\n}\n\nfunc main() {\n    a := P{\"a\", nil}\n    A := P{\"?\", nil}\n\n    b := P{\"b\", a}\n    B := P{\"b\", A}\n\n    B.sibling.modify()\n\n    fmt.Println(B)\n    fmt.Println(b == B)\n}\n</code></pre>\n\n<p>How do I get Go to let me modify the interface data itself without copying it and modifying the copy?</p>\n\n<p>It seems these are mutually exclusive on a struct:</p>\n\n<ul>\n<li>I need to be able to use maps</li>\n<li>I need to be able to modify the interface data with methods</li>\n</ul>\n"}, {"tags": ["sorting", "go", "key", "key-value"], "answers": [{"comments": [{"owner": {"reputation": 465, "user_id": 2567857, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/fd45347894cdd883b32af45f9cc2f3da?s=128&d=identicon&r=PG", "display_name": "user2567857", "link": "https://stackoverflow.com/users/2567857/user2567857"}, "edited": false, "score": 0, "creation_date": 1429258912, "post_id": 29693787, "comment_id": 47524219, "body": "I don&#39;t want sort key/value separately and display them, I want whole pair to be sorted together. Please see my edit."}, {"owner": {"reputation": 160456, "user_id": 89391, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bb5230985aa2c9ea7d022d1a16890f16?s=128&d=identicon&r=PG", "display_name": "miku", "link": "https://stackoverflow.com/users/89391/miku"}, "reply_to_user": {"reputation": 465, "user_id": 2567857, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/fd45347894cdd883b32af45f9cc2f3da?s=128&d=identicon&r=PG", "display_name": "user2567857", "link": "https://stackoverflow.com/users/2567857/user2567857"}, "edited": false, "score": 0, "creation_date": 1429259129, "post_id": 29693787, "comment_id": 47524372, "body": "@user2567857, I believe I understood you. I added a link to an example to my answer."}, {"owner": {"reputation": 465, "user_id": 2567857, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/fd45347894cdd883b32af45f9cc2f3da?s=128&d=identicon&r=PG", "display_name": "user2567857", "link": "https://stackoverflow.com/users/2567857/user2567857"}, "edited": false, "score": 1, "creation_date": 1429259913, "post_id": 29693787, "comment_id": 47524882, "body": "Incase, anyone wants to know how to sort according to <code>value</code>, just change <code>s[i].Key</code> and <code>s[j].Key</code> to <code>s[i].Value</code> and <code>s[i].Value</code> respectively."}], "tags": [], "owner": {"reputation": 160456, "user_id": 89391, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bb5230985aa2c9ea7d022d1a16890f16?s=128&d=identicon&r=PG", "display_name": "miku", "link": "https://stackoverflow.com/users/89391/miku"}, "is_accepted": true, "score": 3, "last_activity_date": 1429259041, "last_edit_date": 1429259041, "creation_date": 1429258398, "answer_id": 29693787, "question_id": 29693708, "link": "https://stackoverflow.com/questions/29693708/sort-pair-in-golang/29693787#29693787", "title": "Sort pair in GoLang", "body": "<p>You could implement <code>Len</code>, <code>Swap</code> and <code>Less</code> for a custom type. An example is given here: <a href=\"https://gobyexample.com/sorting-by-functions\" rel=\"nofollow\">https://gobyexample.com/sorting-by-functions</a></p>\n\n<p>Here's how you could sort by key for your example: <a href=\"http://play.golang.org/p/i6-e4I7vih\" rel=\"nofollow\">http://play.golang.org/p/i6-e4I7vih</a></p>\n\n<pre><code>import (\n    \"fmt\"\n    \"sort\"\n)\n\ntype Pair struct {\n    Key   string\n    Value int\n}\n\ntype ByKey []Pair\n\nfunc (s ByKey) Len() int {\n    return len(s)\n}\n\nfunc (s ByKey) Swap(i, j int) {\n    s[i], s[j] = s[j], s[i]\n}\n\nfunc (s ByKey) Less(i, j int) bool {\n    return s[i].Key &lt; s[j].Key\n}\n\nfunc main() {\n    pairs := []Pair{{\"a\", 1}, {\"b\", 0}, {\"c\", 2}}\n    // Sort by Key\n    sort.Sort(ByKey(pairs))\n    fmt.Println(pairs) // [{a 1} {b 0} {c 2}]\n}\n</code></pre>\n"}], "owner": {"reputation": 465, "user_id": 2567857, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/fd45347894cdd883b32af45f9cc2f3da?s=128&d=identicon&r=PG", "display_name": "user2567857", "link": "https://stackoverflow.com/users/2567857/user2567857"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1349, "favorite_count": 0, "accepted_answer_id": 29693787, "answer_count": 1, "score": 0, "last_activity_date": 1480684368, "creation_date": 1429258187, "last_edit_date": 1429258641, "question_id": 29693708, "link": "https://stackoverflow.com/questions/29693708/sort-pair-in-golang", "title": "Sort pair in GoLang", "body": "<p>I know how to sort key/value with data type:</p>\n\n<pre><code>map[1:a 2:c 0:b]\n</code></pre>\n\n<p>using <code>sort</code> package of GoLang. How can I sort a <code>Pair</code> like the following:</p>\n\n<pre><code>[{c 2} {a 1} {b 0}]\n</code></pre>\n\n<p>I want the whole pair to be sorted either according to key or value? End result:</p>\n\n<pre><code>[{a 1} {b 0} {c 2}]\n</code></pre>\n\n<p>this is sorted according to keys. Below is sorted according to values:</p>\n\n<pre><code>[{b 0} {a 1} {c 2}]\n</code></pre>\n"}, {"tags": ["html", "go"], "answers": [{"comments": [{"owner": {"reputation": 672, "user_id": 1781902, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dad8c02863eeed2fe87cc9cb358b7a91?s=128&d=identicon&r=PG", "display_name": "Smyrnian", "link": "https://stackoverflow.com/users/1781902/smyrnian"}, "edited": false, "score": 0, "creation_date": 1429249538, "post_id": 29690413, "comment_id": 47518989, "body": "Thank you for your comprehensive answer but unfortunately it doesn&#39;t resolve my issue. I&#39;ve already covered all the steps you mention. What I need is a way to access the HTTP Request object from a template helper (which is not a handler) so that I can access the user&#39;s session object."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "reply_to_user": {"reputation": 672, "user_id": 1781902, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dad8c02863eeed2fe87cc9cb358b7a91?s=128&d=identicon&r=PG", "display_name": "Smyrnian", "link": "https://stackoverflow.com/users/1781902/smyrnian"}, "edited": false, "score": 0, "creation_date": 1429251979, "post_id": 29690413, "comment_id": 47520140, "body": "You could write a template helper similar to my <code>IsAdmin</code> function and have it return a <code>User</code> object straight to the template - i.e. <code>GetUser(r *http.Request) User</code> - with the function pulling the User object out of the session (if it exists). This is very similar to what I&#39;ve shown above, but puts more work into the template (not ideal; limited error checking).  If I&#39;m still misinterpreting your question, show your existing code."}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 3, "last_activity_date": 1429252405, "last_edit_date": 1429252405, "creation_date": 1429245398, "answer_id": 29690413, "question_id": 29689426, "link": "https://stackoverflow.com/questions/29689426/conditional-rendering-of-html-in-golang-layout-tpl-by-session-variable/29690413#29690413", "title": "Conditional rendering of HTML in Golang layout.tpl by session variable", "body": "<p>There's a few things you need to do to tie this together. I'm not going to show a complete example as it would be both fairly lengthy and may not match your code (which you haven't posted). It will contain the basic building blocks though: if you get stuck, come back with a direct question and a code snippet and you'll get a more direct answer :)</p>\n\n<ol>\n<li><p>Write some middleware or logic in a [login] handler that saves the user data in the session when a user logs in. A userID, email and admin boolean value would be sufficient. e.g.</p>\n\n<pre><code>// In your login handler, once you've retrieved the user &amp;\n// matched their password hash (scrypt, of course!) from the DB.\nsession.Values[\"user\"] = &amp;youruserobject\nerr := session.Save(r, w)\nif err != nil {\n    // Throw a HTTP 500\n}\n</code></pre></li>\n</ol>\n\n<p>Note: remember that you need to <code>gob.Register(&amp;youruserobject{})</code> as per the <a href=\"http://www.gorillatoolkit.org/pkg/sessions#overview\" rel=\"nofollow\">gorilla/sessions docs</a> if you want to store your own types.</p>\n\n<ol start=\"2\">\n<li><p>Write a helper to type-assert your type when you pull it out of the session, e.g.</p>\n\n<pre><code>var ErrInvalidUser= errors.New(\"invalid user stored in session\")\n\nfunc GetUser(session *sessions.Session) (*User, error) {\n    // You can make the map key a constant to avoid typos/errors\n    user, ok := session.Values[\"user\"].(*User)\n    if !ok || user == nil {\n        return nil, ErrInvalidUser\n    }\n    return user, nil\n}\n\n\n// Use it like this in a handler that serves user content\nsession, err := store.Get(\"yoursessionname\", r)\nif err != nil {\n    // Throw a HTTP 500\n}\n\nuser, err := GetUser(session)\n   if err != nil {\n    // Re-direct back to the login page or\n    // show a HTTP 403 Forbidden, etc.\n}\n</code></pre></li>\n<li><p>Write something to check if the returned user is an admin:</p>\n\n<pre><code>func IsAdmin(user *User) bool {\n        if user.Admin == true &amp;&amp; user.ID != \"\" &amp;&amp; user.Email != \"\" {\n                return true\n        }\n\n        return false\n}\n</code></pre></li>\n<li><p>Pass that to the template:</p>\n\n<pre><code> err := template.Execute(w, \"sometemplate.html\", map[string]interface{}{\n        \"admin\": IsAdmin(user),\n        \"someotherdata\": someStructWithData,\n    }\n\n // In your template...\n {{ if .admin }}{{ template \"admin_menu\" }}{{ end }}\n</code></pre></li>\n</ol>\n\n<p>Also make sure you're setting an authentication key for your session cookies (read the gorilla docs), preferably an encryption key, and that you're serving your site over HTTPS with the Secure: true flag set as well.</p>\n\n<p>Keep in mind that the above method is also simplified: if you de-flag a user as admin in your DB, the application will continue to detect them as an administrator for as long as their session lasts. By default this can be 7 days, so if you're in a risky environment where admin churn is a real problem, it may pay to have really short sessions <em>OR</em> hit the DB inside the <code>IsAdmin</code> function just to be safe. If it's a personal blog and it's just you, not so much.</p>\n\n<hr>\n\n<p><strong>Added</strong>: If you want to pass the User object <em>directly</em> to the template, you can do that too. Note that it's more performant to do it in your handler/middleware than it is in the template logic. You also get the flexibility of more error handling, and the option of \"bailing out\" earlier - i.e. if the session contains nothing, you can fire up a HTTP 500 error rather than rendering half a template or having to put lots of logic in your template to handle <code>nil</code> data.</p>\n\n<p>You still need to store your <code>User</code> object (or equivalent) in the session, and retrieve it from <code>session.Values</code> before you can pass it to the template.</p>\n\n<pre><code> func GetUser(r *http.Request) *User {\n        session, err := store.Get(\"yoursessionname\", r)\n        if err != nil {\n            // Throw a HTTP 500\n        }\n        if user, ok := session.Values[\"user\"].(*User); ok {\n            return user\n        }\n\n        return nil\n }\n\n // In the handler itself\n err := template.Execute(w, \"sometemplate.html\", map[string]interface{}{\n        \"user\": GetUser(r),\n        \"someotherdata\": someStructWithData,\n        }\n\n\n // In your template...\n {{ if .User.admin }}{{ template \"admin_menu\" }}{{ end }}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 672, "user_id": 1781902, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dad8c02863eeed2fe87cc9cb358b7a91?s=128&d=identicon&r=PG", "display_name": "Smyrnian", "link": "https://stackoverflow.com/users/1781902/smyrnian"}, "is_accepted": false, "score": 1, "last_activity_date": 1429574858, "creation_date": 1429574858, "answer_id": 29760598, "question_id": 29689426, "link": "https://stackoverflow.com/questions/29689426/conditional-rendering-of-html-in-golang-layout-tpl-by-session-variable/29760598#29760598", "title": "Conditional rendering of HTML in Golang layout.tpl by session variable", "body": "<p>It seems you cannot access the <code>Request</code> context from a template or a template helper function afterall (so I accepted the answer above). My solution was to create a <code>Page</code> struct that I pass as the context for every template. It contains the <code>Content</code> as a generic interface, the <code>User</code> object, as well as other useful parameters:</p>\n\n<pre><code>//Page holds the model to be rendered for every HTTP handler.\ntype Page struct {\n     MetaTitle     string\n     User          User\n     HeaderStyles  string\n     HeaderScripts string\n     FooterScripts string\n     Content       interface{}\n }\n\n func (pg *Page) Init(r *http.Request) {\n\n    if pg.MetaTitle == \"\" {\n        pg.MetaTitle = \"This is the default &lt;title&gt; content for the page!\"\n    }\n\n    user, _ := GetUserFromSession(r)\n    pg.User = *user\n\n    if user.IsAdmin() {\n        pg.HeaderStyles += `&lt;link href=\"/css/libs/summernote/summernote.css\" rel=\"stylesheet\"&gt;`\n        pg.FooterScripts += `&lt;script src=\"/js/libs/summernote/summernote.min.js\"&gt;&lt;/script&gt;`\n    }\n\n}\n</code></pre>\n\n<p>The Init method allows me to set defaults and use the Page struct more easily, by specifying only the <code>Content</code> for the page, if that's all I need:</p>\n\n<pre><code>package main\n\nimport (\n    \"html/template\"\n    \"github.com/julienschmidt/httprouter\"\n)\n\nfunc HomeHandler(w http.ResponseWriter, r *http.Request, p httprouter.Params) {\n\n    var model = struct {\n        CatalogPicks   []PromotionalModelList\n        ClearanceItems []Model\n    }{\n        CatalogPicks:   GetCatalogPicks(),\n        ClearanceItems: GetClearanceItems(),\n    }\n\n    pg := &amp;Page{Content: model}\n    pg.Init(r)\n    ren.HTML(w, http.StatusOK, \"home\", pg)\n}\n</code></pre>\n"}], "owner": {"reputation": 672, "user_id": 1781902, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dad8c02863eeed2fe87cc9cb358b7a91?s=128&d=identicon&r=PG", "display_name": "Smyrnian", "link": "https://stackoverflow.com/users/1781902/smyrnian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2326, "favorite_count": 1, "accepted_answer_id": 29690413, "answer_count": 2, "score": -1, "last_activity_date": 1429574858, "creation_date": 1429239252, "last_edit_date": 1429488510, "question_id": 29689426, "link": "https://stackoverflow.com/questions/29689426/conditional-rendering-of-html-in-golang-layout-tpl-by-session-variable", "title": "Conditional rendering of HTML in Golang layout.tpl by session variable", "body": "<p>I use Gorilla sessions (via negroni-sessions) to store my <strong>user</strong> sessions in cookies. I also use <code>github.com/unrolled/render</code> for my HTML template rendering:</p>\n\n<p><strong>main.go:</strong></p>\n\n<pre><code>    package main\n\n    import (\n        ...\n        \"github.com/codegangsta/negroni\"\n        \"github.com/goincremental/negroni-sessions\"\n        \"github.com/goincremental/negroni-sessions/cookiestore\"\n        \"github.com/julienschmidt/httprouter\"\n        \"github.com/unrolled/render\"\n        ...\n    )\n\n    func init() {\n        ...\n        ren = render.New(render.Options{\n            Directory:     \"templates\",\n            Layout:        \"layout\",\n            Extensions:    []string{\".html\"},\n            Funcs:         []template.FuncMap{TemplateHelpers}, \n            IsDevelopment: false,\n        })\n        ...\n    }\n\n    func main() {\n        ...\n        router := httprouter.New()\n        router.GET(\"/\", HomeHandler)\n\n        // Add session store\n        store := cookiestore.New([]byte(\"my password\"))\n        store.Options(sessions.Options{\n            //MaxAge: 1200,\n            Domain: \"\",\n            Path:   \"/\",\n        })\n\n        n := negroni.New(\n            negroni.NewRecovery(),\n            sessions.Sessions(\"cssession\", store),\n            negroni.NewStatic(http.Dir(\"../static\")), \n        )\n\n        n.UseHandler(router)\n        n.Run(\":9000\")\n\n    }\n</code></pre>\n\n<p>As you can see above, I use a <strong>layout.html</strong> master HTML template which is included when any page renders, like my home page:</p>\n\n<pre><code>    package main\n\n    import (\n        \"html/template\"\n        \"github.com/julienschmidt/httprouter\"\n    )\n\n    func HomeHandler(w http.ResponseWriter, r *http.Request, p httprouter.Params) {\n\n        var model = struct {\n            CatalogPicks   []PromotionalModelList\n            ClearanceItems []Model\n        }{\n            CatalogPicks:   GetCatalogPicks(),\n            ClearanceItems: GetClearanceItems(),\n        }\n\n        ren.HTML(w, http.StatusOK, \"home\", model)\n    }\n</code></pre>\n\n<p>In my <strong>layout.html</strong> master HTML template, I want to render an admin menu but only if the current user is an admin:</p>\n\n<p><strong>layout.html</strong>: </p>\n\n<pre><code>&lt;!doctype html&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;meta charset=\"utf-8\"&gt;\n      &lt;title&gt;{{ template \"title\" . }}&lt;/title&gt;\n        ...\n  &lt;/head&gt;\n\n  &lt;body&gt;\n    ...\n    &lt;!--Main Menu--&gt;\n      &lt;nav class=\"menu\"&gt;\n         &lt;ul class=\"catalog\"&gt;\n             &lt;li class=\"has-submenu\"&gt;\n                {{ RenderMenuCategories }}\n             &lt;/li&gt;\n             &lt;li&gt;&lt;a href=\"javascript:void(0)\"&gt;Blog&lt;/a&gt;&lt;/li&gt;\n             &lt;li&gt;&lt;a href=\"javascript:void(0)\"&gt;Company&lt;/a&gt;&lt;/li&gt;\n\n             {{ RenderAdminMenu }}\n\n         &lt;/ul&gt;\n      &lt;/nav&gt;\n</code></pre>\n\n<p>...</p>\n\n<p>My issue is that the above template helper function <code>RenderAdminMenu()</code> doesn't have access to the HTTP Request object and therefore cannot access the <strong>User</strong> session object to determine if the user is admin. </p>\n\n<p>I can pass the User object into the template context via the Home page handler, and use an <code>if</code> statement RenderAdminMenu() function, like this</p>\n\n<pre><code>{{ if .User.IsAdmin }}\n   {{ RenderAdminMenu }}\n{{ end }}\n</code></pre>\n\n<p>...but since I am using a master template, I would have to do that from every web page on the site. Is there a more efficient way?</p>\n\n<p>I was thinking perhaps there might be a way to access some kind of global <code>Context</code> object from within <code>RenderAdminMenu()</code> (or layout.html) which contains the <code>Request</code> details (like you can in ASP.NET)</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 221, "user_id": 535924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0a573555411cf53a53dd4489b8ecb31?s=128&d=identicon&r=PG", "display_name": "justdewit", "link": "https://stackoverflow.com/users/535924/justdewit"}, "edited": false, "score": 0, "creation_date": 1429284644, "post_id": 29690175, "comment_id": 47542573, "body": "Thanks. That is cleaner than what I have in my function. I was hoping for a solution that would help with nested items, though. That is why I was using the MarshalJSON functions, since TermQuery could be the one of the Queries of the Query structure."}], "tags": [], "owner": {"reputation": 322, "user_id": 3581778, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/98948b56841bc5ded022c5c1f9288da2?s=128&d=identicon&r=PG", "display_name": "Manawasp", "link": "https://stackoverflow.com/users/3581778/manawasp"}, "is_accepted": false, "score": 6, "last_activity_date": 1429244519, "last_edit_date": 1429244519, "creation_date": 1429244138, "answer_id": 29690175, "question_id": 29689092, "link": "https://stackoverflow.com/questions/29689092/is-there-an-easier-way-to-add-a-layer-over-a-json-object-using-golang-json-encod/29690175#29690175", "title": "Is there an easier way to add a layer over a JSON object using Golang JSON Encoding?", "body": "<p>When I started to use Go &amp; Json I had the same problem. I resolved it by that</p>\n\n<pre><code>func wrapJSON(name string, item interface{}) ([]byte, error) {\n    wrapped := map[string]interface{}{\n       name: item,\n    }\n    converted, err := json.Marshal(wrapped)\n    return converted\n}\n</code></pre>\n\n<p>Ideally, rename your method <code>wrapJSON</code> to <code>wrap</code> that return an interface and after convert this interface to JSON or XML</p>\n"}, {"comments": [{"owner": {"reputation": 221, "user_id": 535924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0a573555411cf53a53dd4489b8ecb31?s=128&d=identicon&r=PG", "display_name": "justdewit", "link": "https://stackoverflow.com/users/535924/justdewit"}, "edited": false, "score": 0, "creation_date": 1429284119, "post_id": 29690419, "comment_id": 47542229, "body": "This is very close. Unfortunately I have the situations these structures being nested. So an example output is  <code>{&quot;query&quot;:{&quot;queries&quot;:[{&quot;term-query&quot;:{&quot;text&quot;:[&quot;data&quot;]}}]}}</code>. That is why I make use of the MarshalJSON functions."}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "reply_to_user": {"reputation": 221, "user_id": 535924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0a573555411cf53a53dd4489b8ecb31?s=128&d=identicon&r=PG", "display_name": "justdewit", "link": "https://stackoverflow.com/users/535924/justdewit"}, "edited": false, "score": 0, "creation_date": 1429588898, "post_id": 29690419, "comment_id": 47657001, "body": "@justdewit See revised answer.  Let me know if this addresses your original question more accurately."}, {"owner": {"reputation": 221, "user_id": 535924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0a573555411cf53a53dd4489b8ecb31?s=128&d=identicon&r=PG", "display_name": "justdewit", "link": "https://stackoverflow.com/users/535924/justdewit"}, "edited": false, "score": 0, "creation_date": 1429629838, "post_id": 29690419, "comment_id": 47683313, "body": "Thank you! Much better than what I was doing."}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 2, "last_activity_date": 1429552409, "last_edit_date": 1429552409, "creation_date": 1429245428, "answer_id": 29690419, "question_id": 29689092, "link": "https://stackoverflow.com/questions/29689092/is-there-an-easier-way-to-add-a-layer-over-a-json-object-using-golang-json-encod/29690419#29690419", "title": "Is there an easier way to add a layer over a JSON object using Golang JSON Encoding?", "body": "<p>Perhaps I am missing something, but is this what you are looking for?</p>\n\n<p>I started off with the same idea as @Manawasp (using a map[string]interface{}) but decided to try to get the name from the struct tag like you asked about... here's what I came up with (*note: there may be unhandled error cases, and this may overcomplicate something that can be handled pretty easily with the other solution)</p>\n\n<p><a href=\"http://play.golang.org/p/qO6tDZjtXA\" rel=\"nofollow\">http://play.golang.org/p/qO6tDZjtXA</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n    \"strings\"\n)\nimport (\n    \"encoding/json\"\n    \"encoding/xml\"\n    \"errors\"\n)\n\ntype Query struct {\n    XMLName xml.Name `xml:\"http://marklogic.com/appservices/search query\" json:\"-\"`\n    Field1  string\n    Field2  int64\n}\n\ntype TermQuery struct {\n    XMLName xml.Name `xml:\"http://marklogic.com/appservices/search term-query\" json:\"-\"`\n    Field3  string\n    Field4  int64\n}\n\nfunc getXmlName(d interface{}, label string) (string, bool) {\n    switch reflect.TypeOf(d).Kind() {\n    case reflect.Struct:\n        v, _ := reflect.TypeOf(d).FieldByName(label)\n        parts := strings.Split(v.Tag.Get(\"xml\"), \" \")\n        return parts[1], true\n    }\n    return \"\", false\n}\n\nfunc wrapJson(item interface{}) ([]byte, error) {\n    if n, ok := getXmlName(item, \"XMLName\"); ok {\n        b, err := json.Marshal(map[string]interface{}{n: item})\n        if err != nil {\n            return nil, err\n        }\n        return b, nil\n    }\n    return nil, errors.New(\"You failed\")\n}\n\nfunc main() {\n    // create a Query and encode it as {\"query\": {struct}}\n    q := Query{Field1: \"hello\", Field2: 42}\n    wrappedQ, err := wrapJson(q)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Println(string(wrappedQ))\n\n    // create a TermQuery and encode it as {\"term-query\": {struct}}\n    tq := TermQuery{Field3: \"world\", Field4: 99}\n    wrappedTQ, err := wrapJson(tq)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Println(string(wrappedTQ))\n\n}\n</code></pre>\n\n<p><strong>OUTPUT</strong></p>\n\n<pre><code>{\"query\":{\"Field1\":\"hello\",\"Field2\":42}}\n{\"term-query\":{\"Field3\":\"world\",\"Field4\":99}}\n</code></pre>\n\n<p><strong>EDIT</strong><br>\nOk, here is an update now that I can see what your issue is.  It might be ugly, and it might not be bullet-proof (error handling, etc)... but for my test it seems to do what you want.</p>\n\n<p><a href=\"http://play.golang.org/p/8MloLP3X4H\" rel=\"nofollow\">http://play.golang.org/p/8MloLP3X4H</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n    \"strings\"\n)\nimport (\n    //\"encoding/json\"\n    \"encoding/json\"\n    \"encoding/xml\"\n    \"errors\"\n)\n\ntype Query struct {\n    XMLName xml.Name `xml:\"http://marklogic.com/appservices/search query\" json:\"-\"`\n    Field1  string\n    Field2  int64\n    Queries []interface{} `xml:\",any\" json:\"queries\"`\n}\n\ntype TermQuery struct {\n    XMLName xml.Name `xml:\"http://marklogic.com/appservices/search term-query\" json:\"-\"`\n    Field3  string\n    Field4  int64\n}\n\nfunc getXmlName(d interface{}, label string) (string, bool) {\n    switch reflect.TypeOf(d).Kind() {\n    case reflect.Struct:\n        v, _ := reflect.TypeOf(d).FieldByName(label)\n        parts := strings.Split(v.Tag.Get(\"xml\"), \" \")\n        return parts[1], true\n    default:\n        fmt.Println(reflect.TypeOf(d).Kind())\n    }\n    return \"\", false\n}\n\nfunc wrapJson(item interface{}) (map[string]interface{}, error) {\n    if n, ok := getXmlName(item, \"XMLName\"); ok {\n\n        if k := reflect.ValueOf(item).FieldByName(\"Queries\"); k.IsValid() {\n            for i := 0; i &lt; k.Len(); i++ {\n                b, err1 := wrapJson(k.Index(i).Interface())\n                if err1 != nil {\n\n                    continue\n                }\n                k.Index(i).Set(reflect.ValueOf(b))\n\n            }\n\n        }\n        return map[string]interface{}{n: item}, nil\n    }\n    return nil, errors.New(\"You failed\")\n}\n\nfunc asJson(i interface{}) []byte {\n    b, err := json.Marshal(i)\n    if err != nil {\n        return []byte(`{\"error\": \"too bad\"}`)\n    }\n    return b\n}\n\nfunc main() {\n\n    // create a TermQuery and encode it as {\"term-query\": {struct}}\n    tq := TermQuery{Field3: \"world\", Field4: 99}\n    wrappedTQ, err := wrapJson(tq)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    fmt.Println(string(asJson(wrappedTQ)))\n\n    // create a Query and encode it as {\"query\": {struct}}\n    q := Query{\n        Field1: \"hello\", \n        Field2: 42, \n        Queries: []interface{}{\n            TermQuery{Field3: \"world\", Field4: 99},\n            TermQuery{Field3: \"yay, it works!\", Field4: 666},\n            Query{\n                Field1: \"Hi\",\n                Field2: 21,\n                Queries: []interface{}{\n                    TermQuery{\n                        Field3: \"omg\",\n                        Field4: 1,\n                    },\n                },\n            },\n        },\n    }\n    wrappedQ, err := wrapJson(q)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Println(string(asJson(wrappedQ)))\n\n}\n</code></pre>\n\n<p><strong>PRETTY-PRINTED OUTOUT</strong></p>\n\n<pre><code>{\n    \"query\": {\n        \"Field1\": \"hello\",\n        \"Field2\": 42,\n        \"queries\": [\n            {\n                \"term-query\": {\n                    \"Field3\": \"world\",\n                    \"Field4\": 99\n                }\n            },\n            {\n                \"term-query\": {\n                    \"Field3\": \"yay, it works!\",\n                    \"Field4\": 666\n                }\n            },\n            {\n                \"query\": {\n                    \"Field1\": \"Hi\",\n                    \"Field2\": 21,\n                    \"queries\": [\n                        {\n                            \"term-query\": {\n                                \"Field3\": \"omg\",\n                                \"Field4\": 1\n                            }\n                        }\n                    ]\n                }\n            }\n        ]\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 9174439, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1a6ab01c90337329ada2f9ffedbf1b1?s=128&d=identicon&r=PG", "display_name": "\u041d\u0438\u043a\u0438\u0442\u0430", "link": "https://stackoverflow.com/users/9174439/%d0%9d%d0%b8%d0%ba%d0%b8%d1%82%d0%b0"}, "is_accepted": false, "score": 0, "last_activity_date": 1611178209, "creation_date": 1611178209, "answer_id": 65817968, "question_id": 29689092, "link": "https://stackoverflow.com/questions/29689092/is-there-an-easier-way-to-add-a-layer-over-a-json-object-using-golang-json-encod/65817968#65817968", "title": "Is there an easier way to add a layer over a JSON object using Golang JSON Encoding?", "body": "<pre><code>type MultiMatch struct {\n    Query              string   `json:&quot;query&quot;`\n    Fields             []string `json:&quot;fields&quot;`\n}\n\nfunc (m *MultiMatch) MarshalJSON() ([]byte, error) {\n    w := map[string]interface{}{}\n    w[&quot;multi_match&quot;] = *m\n    return json.Marshal(w)\n}\n</code></pre>\n"}], "owner": {"reputation": 221, "user_id": 535924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0a573555411cf53a53dd4489b8ecb31?s=128&d=identicon&r=PG", "display_name": "justdewit", "link": "https://stackoverflow.com/users/535924/justdewit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1846, "favorite_count": 0, "accepted_answer_id": 29690419, "answer_count": 3, "score": 5, "last_activity_date": 1611178209, "creation_date": 1429236940, "last_edit_date": 1429284391, "question_id": 29689092, "link": "https://stackoverflow.com/questions/29689092/is-there-an-easier-way-to-add-a-layer-over-a-json-object-using-golang-json-encod", "title": "Is there an easier way to add a layer over a JSON object using Golang JSON Encoding?", "body": "<p>The out of the box JSON encoding in Go is really nice, but I need to get the output to match a certain format by adding a layer. I've figured out a way, but  was hoping that there would be an easier way than the way I'm doing it.</p>\n\n<p>Below is an example of how I'm doing it.</p>\n\n<pre><code>import (\n  \"bytes\"\n  \"encoding/json\"\n  \"encoding/xml\"\n  \"fmt\"\n)\ntype Query struct {\n    XMLName xml.Name      `xml:\"http://marklogic.com/appservices/search query\" json:\"-\"`\n    Format  int           `xml:\"-\" json:\"-\"`\n    Queries []interface{} `xml:\",any\" json:\"queries\"`\n}\ntype TermQuery struct {\n    XMLName xml.Name `xml:\"http://marklogic.com/appservices/search term-query\" json:\"-\"`\n    Terms   []string `xml:\"http://marklogic.com/appservices/search text\" json:\"text\"`\n    Weight  float64  `xml:\"http://marklogic.com/appservices/search weight,omitempty\" json:\"weight,omitempty\"`\n}\n// use fakeQuery to avoid an infinite loop\ntype fakeQuery Query\n\n//MarshalJSON for Query struct in a special way to add wraping {\"query\":...}\nfunc (q Query) MarshalJSON() ([]byte, error) {\n    return wrapJSON(`query`, fakeQuery(q))\n}\n// use fakeTermQuery to avoid an infinite loop\ntype fakeTermQuery TermQuery\n\n//MarshalJSON for TermQuery struct in a special way to add wraping {\"term-query\":...}\nfunc (q TermQuery) MarshalJSON() ([]byte, error) {\n    return wrapJSON(`term-query`, fakeTermQuery(q))\n}\n\nfunc wrapJSON(name string, item interface{}) ([]byte, error) {\n    var buffer bytes.Buffer\n    b, err := json.Marshal(item)\n    buffer.Write([]byte(`{\"`))\n    buffer.Write([]byte(name))\n    buffer.Write([]byte(`\":`))\n    buffer.Write(b)\n    buffer.Write([]byte(`}`))\n    return buffer.Bytes(), err\n}\n</code></pre>\n\n<p>I have a lot of defined structures that I would need to do this to, so I'm hoping for a better solution that won't leave me with with 100+ lines of code to just add a wrapper around the JSON object. Ideally I would like something that could peak at the XML element name defined for the XML encoder and use that to wrap the JSON.</p>\n\n<p>In my case I'm using the MarshalJSON functions because these structures can be nested. If it helps I always know that the Query structure is the root structure.</p>\n"}, {"tags": ["string", "go", "network-programming"], "answers": [{"comments": [{"owner": {"reputation": 537, "user_id": 985806, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7fa899fafa20b5b76093472799388d4?s=128&d=identicon&r=PG", "display_name": "mileusna", "link": "https://stackoverflow.com/users/985806/mileusna"}, "edited": false, "score": 5, "creation_date": 1484174886, "post_id": 29687463, "comment_id": 70406910, "body": "This will not return IP as string (only). It will also include incoming port, and the output is even more messy if the RemoteAddr() is IPv6"}, {"owner": {"reputation": 556, "user_id": 658991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e21f90478bb0721b59275798aad8b308?s=128&d=identicon&r=PG", "display_name": "user658991", "link": "https://stackoverflow.com/users/658991/user658991"}, "reply_to_user": {"reputation": 537, "user_id": 985806, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7fa899fafa20b5b76093472799388d4?s=128&d=identicon&r=PG", "display_name": "mileusna", "link": "https://stackoverflow.com/users/985806/mileusna"}, "edited": false, "score": 4, "creation_date": 1510805503, "post_id": 29687463, "comment_id": 81593823, "body": "RemoteAddr() returns interface net.Addr, depending on implementation, the String() call almost always returns more than ip, it includes the port as well. @mileusna &#39;s answer is the correct way to find the IP. if your net.Conn can be of type other than TCPAddr (e.g. UDPAddr, UnixAddr), you might want to add more checks. Not all addr contains an IP."}, {"owner": {"reputation": 149, "user_id": 7092558, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-XDf-it5K7Zg/AAAAAAAAAAI/AAAAAAAAAC4/Z-HzGLjFhFY/photo.jpg?sz=128", "display_name": "Gibezynu Nu", "link": "https://stackoverflow.com/users/7092558/gibezynu-nu"}, "reply_to_user": {"reputation": 537, "user_id": 985806, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7fa899fafa20b5b76093472799388d4?s=128&d=identicon&r=PG", "display_name": "mileusna", "link": "https://stackoverflow.com/users/985806/mileusna"}, "edited": false, "score": 0, "creation_date": 1584980536, "post_id": 29687463, "comment_id": 107602203, "body": "No need to convert to string. @mileusna &#39;s answer is the correct method. <a href=\"https://stackoverflow.com/a/41602018/7092558\">stackoverflow.com/a/41602018/7092558</a>"}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": true, "score": 15, "last_activity_date": 1429225638, "creation_date": 1429225638, "answer_id": 29687463, "question_id": 29687102, "link": "https://stackoverflow.com/questions/29687102/how-do-i-get-a-network-clients-ip-converted-to-a-string-in-golang/29687463#29687463", "title": "How do I get a network client&#39;s IP converted to a string in Golang?", "body": "<p>Seems just</p>\n\n<pre><code>strRemoteAddr = conn.RemoteAddr().String()\n</code></pre>\n\n<p>can do, net.Addr type has method String() for string representation.</p>\n"}, {"comments": [{"owner": {"reputation": 63, "user_id": 9674039, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92abd68929718eed506ed1a4bdd44ca5?s=128&d=identicon&r=PG&f=1", "display_name": "Nabil", "link": "https://stackoverflow.com/users/9674039/nabil"}, "edited": false, "score": 0, "creation_date": 1605849512, "post_id": 41602018, "comment_id": 114784026, "body": "How can I access net.Conn object from a gRPC call like the one below, <code>func (s *server) rpc_routine(ctx context.Context, arg *empty.Empty) (*pb.CmdList, error) {</code>"}], "tags": [], "owner": {"reputation": 537, "user_id": 985806, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7fa899fafa20b5b76093472799388d4?s=128&d=identicon&r=PG", "display_name": "mileusna", "link": "https://stackoverflow.com/users/985806/mileusna"}, "is_accepted": false, "score": 18, "last_activity_date": 1495480456, "last_edit_date": 1495480456, "creation_date": 1484174307, "answer_id": 41602018, "question_id": 29687102, "link": "https://stackoverflow.com/questions/29687102/how-do-i-get-a-network-clients-ip-converted-to-a-string-in-golang/41602018#41602018", "title": "How do I get a network client&#39;s IP converted to a string in Golang?", "body": "<p>Convert it to <code>*net.TCPAddr</code></p>\n\n<pre><code>if addr, ok := conn.RemoteAddr().(*net.TCPAddr); ok {\n    fmt.Println(addr.IP.String())\n}\n</code></pre>\n"}], "owner": {"reputation": 2731, "user_id": 74361, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/adca63afb01fa2d56850114c337476fb?s=128&d=identicon&r=PG", "display_name": "Bart Silverstrim", "link": "https://stackoverflow.com/users/74361/bart-silverstrim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17244, "favorite_count": 2, "accepted_answer_id": 29687463, "answer_count": 2, "score": 8, "last_activity_date": 1495480456, "creation_date": 1429223443, "last_edit_date": 1429229487, "question_id": 29687102, "link": "https://stackoverflow.com/questions/29687102/how-do-i-get-a-network-clients-ip-converted-to-a-string-in-golang", "title": "How do I get a network client&#39;s IP converted to a string in Golang?", "body": "<p>I'm trying to get a client IP when a connection is made to a server. Trying to use <code>RemoteAddr()</code> returns an addr-type, and while I can print to the console using <code>fmt.Println</code>, I'm trying to assign the value to a string variable.</p>\n\n<p>Is this possible? Or is there a better way to pull a connected client's IP address?</p>\n\n<p>Sample of the function I'm working on (the <code>strRemoteAddr</code> assignment is the problem part, but I left it in as a placeholder...):</p>\n\n<pre><code>func GrabInput(conn net.Conn, strFromListenerNumber string) {\n    var strMessage string\n    var strRemoteAddr string\n\n    bufIncoming := make([]byte, 1024)\n\n    strRemoteAddr = conn.RemoteAddr()\n\n    for {\n        bytesRead, err := conn.Read(bufIncoming)\n        if err != nil {\n            LogEvent(strFromListenerNumber, err.Error())\n            return\n        }\n\n        strMessage = string(bufIncoming[0 : bytesRead-1])\n        LogEvent(strFromListenerNumber+\": \"+strRemoteAddr, strMessage)\n    }\n}\n</code></pre>\n"}, {"tags": ["pointers", "go", "binary-tree"], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 1, "last_activity_date": 1429222637, "creation_date": 1429222637, "answer_id": 29686967, "question_id": 29686888, "link": "https://stackoverflow.com/questions/29686888/compare-binary-tree-in-golang-my-answer-is-wrong/29686967#29686967", "title": "compare Binary Tree in Golang. my answer is wrong", "body": "<p>This line has a small mistake;</p>\n\n<pre><code> if (p.val == q.val) &amp;&amp; (isSameTree(p.left,q.left)) &amp;&amp; (isSameTree(p.right ,q.left)){\n</code></pre>\n\n<p>It should be;</p>\n\n<pre><code> if (p.val == q.val) &amp;&amp; (isSameTree(p.left,q.left)) &amp;&amp; (isSameTree(p.right ,q.right)){\n</code></pre>\n\n<p>If you don't see the difference in the second call to isSameTree you're passing q.left when it is supposed to be q.right.</p>\n\n<p>Updated go play; <a href=\"https://play.golang.org/p/ul9ijG9HLc\" rel=\"nofollow\">https://play.golang.org/p/ul9ijG9HLc</a></p>\n"}], "owner": {"reputation": 6557, "user_id": 2495795, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/13606de0b736d7191e2cf2bfea1d4fda?s=128&d=identicon&r=PG", "display_name": "BufBills", "link": "https://stackoverflow.com/users/2495795/bufbills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 164, "favorite_count": 0, "accepted_answer_id": 29686967, "answer_count": 1, "score": 1, "last_activity_date": 1429222637, "creation_date": 1429222248, "question_id": 29686888, "link": "https://stackoverflow.com/questions/29686888/compare-binary-tree-in-golang-my-answer-is-wrong", "title": "compare Binary Tree in Golang. my answer is wrong", "body": "<p>I am going to compare Binary Tree in Golang.But my answer is wrong. Need the third eye to help.\nThanks.</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n)\n\ntype TreeNode struct {\n    val int\n    left *TreeNode\n    right *TreeNode\n\n}\n\nfunc isSameTree(p *TreeNode , q *TreeNode ) (bool){\n    if p == nil &amp;&amp; q == nil {\n        return true\n    } \n    if p != nil &amp;&amp; q == nil{\n        return false;\n    }\n    if p ==nil &amp;&amp; q != nil {\n        return false;\n    }\n    if (p.val == q.val) &amp;&amp; (isSameTree(p.left,q.left)) &amp;&amp; (isSameTree(p.right ,q.left)){\n        return true;\n    } else {\n        return false;\n    }\n}\nfunc main(){\n    p := &amp;TreeNode{val: 1}\n    p.left = &amp;TreeNode{val: 2}\n    p.right = &amp;TreeNode{val: 3}\n\n    q := &amp;TreeNode{val: 1}\n    q.left = &amp;TreeNode{val: 2}\n    q.right = &amp;TreeNode{val: 3}\n\n    isSame := isSameTree(p,q)\n    fmt.Println(\"is same?: \", isSame)\n}\n</code></pre>\n\n<p>Go playground link for this code:\n<a href=\"https://play.golang.org/p/mTX3aBxh6_\" rel=\"nofollow\">https://play.golang.org/p/mTX3aBxh6_</a></p>\n"}, {"tags": ["unicode", "go"], "comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 2, "creation_date": 1429221550, "post_id": 29686673, "comment_id": 47510512, "body": "Does your terminal support utf8? does it print right if you <code>cat file.txt</code>? also that might be the wrong encoding."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1429225771, "post_id": 29686673, "comment_id": 47512023, "body": "E.g. is it in UTF-16 or something? (If so see <a href=\"https://golang.org/pkg/unicode/utf16/\" rel=\"nofollow noreferrer\"><code>unicode&#47;utf16</code></a>)"}], "answers": [{"comments": [{"owner": {"reputation": 303, "user_id": 3873801, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/3626962a476e6d7b63293ada60529b65?s=128&d=identicon&r=PG&f=1", "display_name": "afboteros", "link": "https://stackoverflow.com/users/3873801/afboteros"}, "edited": false, "score": 1, "creation_date": 1429531042, "post_id": 29692025, "comment_id": 47626620, "body": "Thanks a lot for the answer, i finally use charmap this way: charconv := transform.NewReader(file, charmap.Windows1252.NewDecoder())"}], "tags": [], "owner": {"reputation": 707, "user_id": 721861, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/784046b1b72d7969ae850ea7c8b46cba?s=128&d=identicon&r=PG", "display_name": "krait", "link": "https://stackoverflow.com/users/721861/krait"}, "is_accepted": true, "score": 5, "last_activity_date": 1429252696, "creation_date": 1429252696, "answer_id": 29692025, "question_id": 29686673, "link": "https://stackoverflow.com/questions/29686673/read-unicode-characters-with-bufio-scanner-in-go/29692025#29692025", "title": "Read unicode characters with bufio scanner in Go", "body": "<p>The issue you're encountering is that your input is likely not UTF-8 (which is what bufio and most of the Go language/stdlib expect). Instead, your input probably uses some extended-ASCII codepage, which is why the unaccented characters are passing through cleanly (UTF-8 is also a superset of 7-bit ASCII), but that the '\u00d1' is not passed through intact.</p>\n\n<p>In this situation, the bit-representation of the accented character is not valid UTF-8, so the unicode replacement character (U+FFFD) is being produced. You've got a few options:</p>\n\n<ol>\n<li>Convert your input files to UTF-8 before passing them to Go. There are many utilities that can do this, and editors often have this feature.</li>\n<li>Try using <a href=\"http://golang.org/x/text/encoding/charmap\" rel=\"noreferrer\">golang.org/x/text/encoding/charmap</a> together with <a href=\"https://godoc.org/golang.org/x/text/transform#NewReader\" rel=\"noreferrer\">NewReader from golang.org/x/text/transform</a> to transform your input to UTF-8. Pass the resulting Reader to bufio.NewScanner</li>\n<li>Change the line in the loop to <code>os.Stdout.Write(scanner.Bytes()); fmt.Println();</code> This might avoid the bytes being interpreted as UTF-8 beyond newline splitting. Writing the bytes directly to <code>os.Stdout</code> will further avoid any (mis)interpretation of the contents.</li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 1017, "user_id": 3788340, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f395b8e76dda8e86df20ae339e7a70b?s=128&d=identicon&r=PG", "display_name": "QtRoS", "link": "https://stackoverflow.com/users/3788340/qtros"}, "edited": false, "score": 0, "creation_date": 1534509889, "post_id": 29756011, "comment_id": 90742034, "body": "Should I close decoder or reader, returned from <code>transform.NewReader</code>?"}], "tags": [], "owner": {"reputation": 1286, "user_id": 1071090, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/vdLa6.jpg?s=128&g=1", "display_name": "Peter Hommel", "link": "https://stackoverflow.com/users/1071090/peter-hommel"}, "is_accepted": false, "score": 6, "last_activity_date": 1429597892, "last_edit_date": 1429597892, "creation_date": 1429555731, "answer_id": 29756011, "question_id": 29686673, "link": "https://stackoverflow.com/questions/29686673/read-unicode-characters-with-bufio-scanner-in-go/29756011#29756011", "title": "Read unicode characters with bufio scanner in Go", "body": "<p>Your file is, most propably, non UTF-8. Because of that (go expects all strings to be UTF-8) your console output looks mangled. I would advise usage of the packages <code>golang.org/x/text/encoding/charmap</code> and <code>golang.org/x/text/transform</code> in your case, to convert the file's data to UTF-8. As I might presume, looking at your file path, you are on Windows. So your character encoding might be <code>Windows1252</code> (if you have edited it e.g. with notepad.exe).</p>\n\n<p>Try something like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n\n    \"golang.org/x/text/encoding/charmap\"\n    \"golang.org/x/text/transform\"\n)\n\nfunc main() {\n    file, err := os.Open(\"C:/temp/file.txt\")\n    defer file.Close()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    dec := transform.NewReader(file, charmap.Windows1252.NewDecoder()) &lt;- insert your enconding here\n\n    scanner := bufio.NewScanner(dec)\n    for scanner.Scan() {\n        fmt.Println(scanner.Text())\n    }\n}\n</code></pre>\n\n<p>You can find more encodings in the package <code>golang.org/x/text/encoding/charmap</code>, that you can insert into my example to your liking.</p>\n"}], "owner": {"reputation": 303, "user_id": 3873801, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/3626962a476e6d7b63293ada60529b65?s=128&d=identicon&r=PG&f=1", "display_name": "afboteros", "link": "https://stackoverflow.com/users/3873801/afboteros"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3731, "favorite_count": 1, "accepted_answer_id": 29692025, "answer_count": 2, "score": 6, "last_activity_date": 1429597892, "creation_date": 1429221314, "question_id": 29686673, "link": "https://stackoverflow.com/questions/29686673/read-unicode-characters-with-bufio-scanner-in-go", "title": "Read unicode characters with bufio scanner in Go", "body": "<p>I'm trying to read a plain text file that contains names like this: \"CASTA\u00d1EDA\"</p>\n\n<p>The code is basically like this:</p>\n\n<pre><code>file, err := os.Open(\"C:/Files/file.txt\")\ndefer file.Close()\nif err != nil {\n    log.Fatal(err)\n}\nscanner := bufio.NewScanner(file)\nfor scanner.Scan() {\n    fmt.Println(scanner.Text())\n}\n</code></pre>\n\n<p>Then, when \"CASTA\u00d1EDA\" is read it prints \"CASTA\ufffdEDA\"</p>\n\n<p>There's any way to handle that characters when reading with bufio?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1036, "user_id": 1737204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2851ca9622b504c85b92fc3e93d87b1f?s=128&d=identicon&r=PG", "display_name": "wldsvc", "link": "https://stackoverflow.com/users/1737204/wldsvc"}, "edited": false, "score": 1, "creation_date": 1429218575, "post_id": 29685755, "comment_id": 47509040, "body": "Your code example does not look like something one would do in go. But just to be sure, could you develop a bit about your use case? For example, why two subtypes of dbRepo?"}, {"owner": {"reputation": 1036, "user_id": 1737204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2851ca9622b504c85b92fc3e93d87b1f?s=128&d=identicon&r=PG", "display_name": "wldsvc", "link": "https://stackoverflow.com/users/1737204/wldsvc"}, "edited": false, "score": 0, "creation_date": 1429219271, "post_id": 29685755, "comment_id": 47509416, "body": "How or where is the decision to construct a type A or B made?"}, {"owner": {"reputation": 643, "user_id": 2402831, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/a2c32d36536daf6acc5634e65379b691?s=128&d=identicon&r=PG", "display_name": "user2402831", "link": "https://stackoverflow.com/users/2402831/user2402831"}, "reply_to_user": {"reputation": 1036, "user_id": 1737204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2851ca9622b504c85b92fc3e93d87b1f?s=128&d=identicon&r=PG", "display_name": "wldsvc", "link": "https://stackoverflow.com/users/1737204/wldsvc"}, "edited": false, "score": 0, "creation_date": 1429275213, "post_id": 29685755, "comment_id": 47535365, "body": "There are two subtypes because they each have different functions that will be called on them, based on the type of repo that they are. For example, making a call to a user database instead of an item database. I will have different queries and functions I&#39;m looking to do based on the repository. The creation and assignment is done in a main function elsewhere. All of this is loosely following Clean architecture in Go."}], "answers": [{"tags": [], "owner": {"reputation": 11133, "user_id": 4275347, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CdbsN.jpg?s=128&g=1", "display_name": "Michael Laszlo", "link": "https://stackoverflow.com/users/4275347/michael-laszlo"}, "is_accepted": false, "score": 2, "last_activity_date": 1429218003, "creation_date": 1429218003, "answer_id": 29685849, "question_id": 29685755, "link": "https://stackoverflow.com/questions/29685755/golang-struct-construction-generality/29685849#29685849", "title": "Golang struct construction generality", "body": "<p>You can write one function with your initializing code:</p>\n\n<pre><code>func newDbRepo(foo, bar string) dbRepo {\n        // ...\n}\n</code></pre>\n\n<p>Then you can use it with type conversion:</p>\n\n<pre><code>a := typeARepo(newDbRepo(\"foo\", \"bar\"))\nb := typeBRepo(newDbRepo(\"foo\", \"bar\"))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 643, "user_id": 2402831, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/a2c32d36536daf6acc5634e65379b691?s=128&d=identicon&r=PG", "display_name": "user2402831", "link": "https://stackoverflow.com/users/2402831/user2402831"}, "edited": false, "score": 0, "creation_date": 1429275024, "post_id": 29685873, "comment_id": 47535230, "body": "I recognize that you can&#39;t have constructors in the traditional sense of the word, but a function that builds and then returns a struct seems like a pretty constructor like function to me! I digress! I was able to do this and then use type assertion in the <code>NewTypeARepo()</code> func to achieve the desired result."}, {"owner": {"reputation": 2589, "user_id": 508459, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/deef27f7e98f18a5101168cfc5bb9732?s=128&d=identicon&r=PG", "display_name": "eshalev", "link": "https://stackoverflow.com/users/508459/eshalev"}, "edited": false, "score": 0, "creation_date": 1509018568, "post_id": 29685873, "comment_id": 80854004, "body": "A factory function like this is not a  constructor. It is a factory function (just like you have in any other languages). A constructor requires you to call it, thus protecting you from allocating an uninitiated (erroneous) zero value structure. What more the  &quot;dbRepo&quot; part of the literal  &quot;NewdbRepo&quot; is not explicitly linked to the type &quot;dbRepo&quot;. If you were to use some automatic refactoring tools to rename &quot;dbRepo&quot; to &quot;databaseRepo&quot;, they would have no way of knowing that &quot;NewdbRepo&quot; needs to be refactored as well. This can be very problematic when refactoring a large project."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 2589, "user_id": 508459, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/deef27f7e98f18a5101168cfc5bb9732?s=128&d=identicon&r=PG", "display_name": "eshalev", "link": "https://stackoverflow.com/users/508459/eshalev"}, "edited": false, "score": 0, "creation_date": 1509047652, "post_id": 29685873, "comment_id": 80873178, "body": "@eshalev if you read the answer it quite clearly explains all of this. There are no constructors in Go as stated &quot;You can&#39;t actually define a constructor as you do in most C like languages so you just gotta provide a package scoped method to do construction for you&quot; and also as stated, this pattern is what is presented in documentation regarding the language. And no, a constructor does not &#39;require you to call it&#39; that is a rule of a language and has nothing to do with &#39;constructors&#39; which are a far more loosely defined concept and behave differently from one language to the next."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1509048307, "post_id": 29685873, "comment_id": 80873530, "body": "Take C# as an example, for one you&#39;re not required to define a constructor in order to use the <code>new</code> keyword to instantiate a type. For two, you&#39;re able to use &#39;static initialization&#39; to create an instance without calling any constructor. Those patterns are in fact far more common in OO languages than a strict requirement to define and call a constructor which honestly is pretty useless in modern development as evidenced by the complete omission of the feature from Go."}, {"owner": {"reputation": 2589, "user_id": 508459, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/deef27f7e98f18a5101168cfc5bb9732?s=128&d=identicon&r=PG", "display_name": "eshalev", "link": "https://stackoverflow.com/users/508459/eshalev"}, "edited": false, "score": 0, "creation_date": 1509104951, "post_id": 29685873, "comment_id": 80896037, "body": "It is not about requiring the lib author to <i>define</i> a constructor.  It is about requiring a library user to <i>use</i> a constructor: Imagine you are using a cool new library. You want to construct a new Cow object. In c#, you immediately know if &amp; how to initialize it. In fact your IDE will suggest it to you automatically. The compiler will catch you if you don&#39;t. In Go, not only will the compiler not catch you, you will also have no way to figure out what you need to call except for reading the docs. If you don&#39;t, you will only catch your error at run time."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 2589, "user_id": 508459, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/deef27f7e98f18a5101168cfc5bb9732?s=128&d=identicon&r=PG", "display_name": "eshalev", "link": "https://stackoverflow.com/users/508459/eshalev"}, "edited": false, "score": 0, "creation_date": 1509372366, "post_id": 29685873, "comment_id": 80980827, "body": "@eshalev - yeah it&#39;s that none of that is true. The caller is not required to use a constructor because the language provides alternate ways of instantiating an object, like static initialization which I mentioned in the comment above. This problem is compounded by the fact that there is no requirement to write a constructor and if you do, it doesn&#39;t mean it works or sets the initial state for anything. It seems like you&#39;re just looking for reasons to complain about Go but what you&#39;re describing is a developer short coming and not a problem with the language."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 4, "last_activity_date": 1429218563, "last_edit_date": 1429218563, "creation_date": 1429218073, "answer_id": 29685873, "question_id": 29685755, "link": "https://stackoverflow.com/questions/29685755/golang-struct-construction-generality/29685873#29685873", "title": "Golang struct construction generality", "body": "<p>The practice I've personally observed in Go (and it's also what's recommended in the effective Go or getting started with Go tutorials) is just to define a <code>NewdbRepo</code> function and use it for all instantation. It's implementation would look something like;</p>\n\n<pre><code>func NewdbRepo(f, b string) *dbRepo {\n    return &amp;dbRepo{ foo:f, bar:b}\n}\n</code></pre>\n\n<p>You can't actually define a constructor as you do in most C like languages so you just gotta provide a package scoped method to do construction for you. Also, if you're not using composite literals (the initilization style I use in my NewdbRepo implementation) then you may find that alone concise enough for your needs. </p>\n"}, {"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 2, "last_activity_date": 1429221453, "creation_date": 1429221453, "answer_id": 29686704, "question_id": 29685755, "link": "https://stackoverflow.com/questions/29685755/golang-struct-construction-generality/29686704#29686704", "title": "Golang struct construction generality", "body": "<p>Define an unexported func on the type that does the initialization then you can create few constructors that call it, for example:</p>\n\n<pre><code>func (db *dbRepo) init(){\n    if len(db.foo) &gt; 0 {\n        //do foo init\n    }\n    if len(db.bar) &gt; 0 {\n        // do bar init\n    }\n    // do generic init\n}\n\nfunc NewRepo(foo, bar string) *dbRepo {\n    repo := &amp;dbRepo{foo: foo, bar: bar}\n    repo.init()\n    return repo\n}\n\nfunc NewFooRepo(foo string) *dbRepo {\n    repo := &amp;dbRepo{foo: foo}\n    repo.init()\n    return repo\n}\n</code></pre>\n"}], "owner": {"reputation": 643, "user_id": 2402831, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/a2c32d36536daf6acc5634e65379b691?s=128&d=identicon&r=PG", "display_name": "user2402831", "link": "https://stackoverflow.com/users/2402831/user2402831"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5187, "favorite_count": 1, "accepted_answer_id": 29685873, "answer_count": 3, "score": 3, "last_activity_date": 1429221453, "creation_date": 1429217692, "question_id": 29685755, "link": "https://stackoverflow.com/questions/29685755/golang-struct-construction-generality", "title": "Golang struct construction generality", "body": "<p>I have a struct that two other objects implement. In this case, typeA and B repo's. There's some initialization code, which are represented as ellipses here. The initialization code is completely duplicated between both constructors, and isn't a big deal while I only have two <code>dbRepo</code>'s, but as I create more I will worry a bit more about the bad practice. Is there any way to generalize this with an interface?</p>\n\n<pre><code>type dbRepo struct {\n    foo string\n    bar string\n}\n\ntype typeARepo dbRepo\ntype typeBRepo dbRepo\n\nfunc newTypeARepo(foo, bar string) {\n    ...\n}\n\nfunc newTypeBRepo(foo, bar string) {\n    ...\n}\n</code></pre>\n"}, {"tags": ["go", "go-reflect"], "answers": [{"comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 13, "creation_date": 1429215123, "post_id": 29684835, "comment_id": 47506939, "body": "I&#39;d really encourage folks to use the type assertion rather than reflect (or, better if you have no other need to name a one-method iface, an anonymous interface specified inline like uraimo suggested). Faster, shorter, no import, no strings as method names."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1429215231, "post_id": 29684835, "comment_id": 47507007, "body": "@twotwotwo agreed. I think reflect only really makes sense if you&#39;re going to do a lot of inspection that leads to runtime decisions about how to behave. If you just want to see whether or not you can invoke a method, the iface option is much simpler and if you&#39;re only using it in one place the inline anonymous declaration is better too."}, {"owner": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "edited": false, "score": 0, "creation_date": 1574672690, "post_id": 29684835, "comment_id": 104300613, "body": "Then how do i use <code>m</code>, since it is <code>reflect.Method</code> type?"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 35, "last_activity_date": 1429215676, "last_edit_date": 1429215676, "creation_date": 1429214391, "answer_id": 29684835, "question_id": 29684609, "link": "https://stackoverflow.com/questions/29684609/how-to-check-if-an-object-has-a-particular-method/29684835#29684835", "title": "How to check if an object has a particular method?", "body": "<p>A simple option is to declare an interface with just the method you want to check for and then do a type assert against your type like;</p>\n\n<pre><code> i, ok := myInstance.(InterfaceImplementingThatOneMethodIcareAbout)\n // inline iface delcataration example\n i, ok = myInstance.(interface{F()})\n</code></pre>\n\n<p>You likely want to use the <code>reflect</code> package if you plan to do anything too crazy with your type; <a href=\"http://golang.org/pkg/reflect\">http://golang.org/pkg/reflect</a></p>\n\n<pre><code>st := reflect.TypeOf(myInstance)\nm, ok := st.MethodByName(\"F\")\nif !ok {\n    // method doesn't exist\n}\n// do something like invoke m\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2014, "user_id": 324651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88e4d6dfda2bce1bbf8e3a2a9fc67a80?s=128&d=identicon&r=PG", "display_name": "chrishiestand", "link": "https://stackoverflow.com/users/324651/chrishiestand"}, "edited": false, "score": 0, "creation_date": 1544597687, "post_id": 29684836, "comment_id": 94327887, "body": "Great example answer, but could you please explain why <code>interface{methodName()}</code> works inside of a type assertion? (Why) Is <code>interface{methodName()}</code> a type match as opposed to simply <code>interface{}</code> and (why) does it work even if the interface has other methods?"}, {"owner": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "edited": false, "score": 0, "creation_date": 1574672877, "post_id": 29684836, "comment_id": 104300699, "body": "Then how do i use <code>correctobj.methodName()</code> value? <code>x:=correcorrectobj.methodName()</code> gives error <code>correctobj.methodName() used as value</code>"}], "tags": [], "owner": {"reputation": 16171, "user_id": 1155984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22074349884978092d46beac83608767?s=128&d=identicon&r=PG", "display_name": "Umberto Raimondi", "link": "https://stackoverflow.com/users/1155984/umberto-raimondi"}, "is_accepted": false, "score": 23, "last_activity_date": 1429340146, "last_edit_date": 1429340146, "creation_date": 1429214394, "answer_id": 29684836, "question_id": 29684609, "link": "https://stackoverflow.com/questions/29684609/how-to-check-if-an-object-has-a-particular-method/29684836#29684836", "title": "How to check if an object has a particular method?", "body": "<p>If obj is an <code>interface{}</code> you can use Go type assertions:</p>\n\n<pre><code>if correctobj, ok := obj.(interface{methodName()}); ok { \n  correctobj.methodName() \n} \n</code></pre>\n"}], "owner": {"reputation": 2088, "user_id": 3309046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5ce388de97238b3147f3d4ba62b17cb?s=128&d=identicon&r=PG", "display_name": "nishanthshanmugham", "link": "https://stackoverflow.com/users/3309046/nishanthshanmugham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9452, "favorite_count": 4, "accepted_answer_id": 29684835, "answer_count": 2, "score": 20, "last_activity_date": 1471843585, "creation_date": 1429213712, "last_edit_date": 1471843585, "question_id": 29684609, "link": "https://stackoverflow.com/questions/29684609/how-to-check-if-an-object-has-a-particular-method", "title": "How to check if an object has a particular method?", "body": "<p>In Go, how do you check if an object responds to a method?</p>\n\n<p>For example, in Objective-C this can be achieved by doing:</p>\n\n<pre><code>if ([obj respondsToSelector:@selector(methodName:)]) { // if method exists\n  [obj methodName:42]; // call the method\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 2, "last_activity_date": 1429209639, "last_edit_date": 1429209639, "creation_date": 1429209597, "answer_id": 29683321, "question_id": 29683047, "link": "https://stackoverflow.com/questions/29683047/why-the-field-section-does-not-get-embedded/29683321#29683321", "title": "Why the field section does not get embedded", "body": "<p>You can't refer to promoted fields in a struct literal. You have to create the embedded type, and refer to it by the type's name.</p>\n\n<pre><code>&amp;authHandler{\n    sidHandler: sidHandler{section: \"bar\"},\n    handler:    \"foo\",\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "is_accepted": true, "score": 2, "last_activity_date": 1429209618, "creation_date": 1429209618, "answer_id": 29683330, "question_id": 29683047, "link": "https://stackoverflow.com/questions/29683047/why-the-field-section-does-not-get-embedded/29683330#29683330", "title": "Why the field section does not get embedded", "body": "<p>Embedding doesn't work with literals like that.</p>\n\n<pre><code>func registerAuthHandler(handler authFuncHandler, section string) http.Handler {\n    return &amp;authHandler{\n        handler: handler,\n        sidHandler: sidHandler{section: section},\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 29683330, "answer_count": 2, "score": 1, "last_activity_date": 1429209639, "creation_date": 1429208732, "last_edit_date": 1429209588, "question_id": 29683047, "link": "https://stackoverflow.com/questions/29683047/why-the-field-section-does-not-get-embedded", "title": "Why the field section does not get embedded", "body": "<p>I have the following struct</p>\n\n<pre><code>package router\n\nimport (\n    \"io\"\n    \"net/http\"\n    \"townspeech/components/i18n\"\n    \"townspeech/components/policy\"\n    \"townspeech/components/session\"\n    \"townspeech/controllers/base\"\n    \"townspeech/types\"\n)\n\ntype sidHandler struct {\n    req     *http.Request\n    res     http.ResponseWriter\n    handler sidFuncHandler\n    section string\n    err     *types.ErrorJSON\n    sess    *session.Sid\n}\n</code></pre>\n\n<p>And I want to embed in another struct like:</p>\n\n<pre><code>package router\n\nimport (\n    \"net/http\"\n    \"townspeech/types\"\n    \"townspeech/components/session\"\n    \"townspeech/controllers/base\"\n)\n\ntype authHandler struct {\n    sidHandler\n    handler authFuncHandler\n    auth    *session.Auth\n}\n</code></pre>\n\n<p>And the function, that use the authHandler struct:</p>\n\n<pre><code>func registerAuthHandler(handler authFuncHandler, section string) http.Handler {\n    return &amp;authHandler{handler: handler, section: section}\n}\n</code></pre>\n\n<p>The compiler complain:</p>\n\n<pre><code># app/router\n../../../router/funcs.go:9: unknown authHandler field 'section' in struct literal\nFAIL    app/test/account/validation [build failed]\n</code></pre>\n\n<p>As you can see, the two structs are in the same package, field section should not appear as private.<br>\nWhat am I doing wrong?</p>\n"}, {"tags": ["concurrency", "go", "append", "slice", "goroutine"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 3, "creation_date": 1429207117, "post_id": 29682422, "comment_id": 47502024, "body": "Any goroutine you start isn&#39;t guaranteed to finish until you wait on it with a <code>sync.WaitGroup</code>, channel, or some other mechanism."}], "answers": [{"tags": [], "owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "is_accepted": true, "score": 6, "last_activity_date": 1429212354, "last_edit_date": 1495542130, "creation_date": 1429207321, "answer_id": 29682626, "question_id": 29682422, "link": "https://stackoverflow.com/questions/29682422/not-seeing-the-expected-side-effects-from-goroutines/29682626#29682626", "title": "Not seeing the expected side effects from goroutines", "body": "<p>Any goroutines you start aren't guaranteed to have finished (or even started!) until you've explicitly waited on them using a <a href=\"http://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\"><code>sync.WaitGroup</code></a>, channel, or other mechanism. <a href=\"http://play.golang.org/p/noqGy-ALP8\" rel=\"nofollow noreferrer\">This works</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"sync\"\n)\n\nvar (\n    b1 []float64\n    b2 []float64\n)\n\nfunc main() {\n    wg := new(sync.WaitGroup)\n    wg.Add(2)\n    go fill(&amp;b1, 10, wg)\n    go fill(&amp;b2, 10, wg)\n    wg.Wait()\n\n    fmt.Println(b1)\n    fmt.Println(b2)\n}\n\nfunc fill(a *[]float64, n int, wg *sync.WaitGroup) {\n    for i := 0; i &lt; n; i++ {\n        *a = append(*a, rand.Float64()*100)\n    }\n    wg.Done()\n}\n</code></pre>\n\n<p>(Just speaking of style, if it were me <a href=\"https://stackoverflow.com/questions/23542989/pointers-vs-values-in-parameters-and-return-values/23551970#23551970\">I'd make this function return the enlarged slice so it's similar to <code>append()</code> itself</a>, and Go's Code Review Comments <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#pass-values\" rel=\"nofollow noreferrer\">suggest passing values</a>, though <a href=\"http://golang.org/doc/effective_go.html#pointers_vs_values\" rel=\"nofollow noreferrer\">it's not at all unconventional to extend a slice passed as a pointer <em>receiver</em> (\"this\") parameter</a>.)</p>\n"}], "owner": {"reputation": 143, "user_id": 2063011, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3628d02a2bc3d39d7fec5150de061738?s=128&d=identicon&r=PG", "display_name": "hmnhmn", "link": "https://stackoverflow.com/users/2063011/hmnhmn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 29682626, "answer_count": 1, "score": 1, "last_activity_date": 1429424082, "creation_date": 1429206759, "last_edit_date": 1429424082, "question_id": 29682422, "link": "https://stackoverflow.com/questions/29682422/not-seeing-the-expected-side-effects-from-goroutines", "title": "Not seeing the expected side effects from goroutines", "body": "<p>I'm trying to get a grasp on goroutines. Take this code:</p>\n\n<pre><code>package main\nimport \"fmt\"\n\nvar (\n    b1 []float64\n    b2 []float64\n)\n\nfunc main() {\n    go fill(&amp;b1, 10)\n    go fill(&amp;b2, 10)\n\n    fmt.Println(b1,b2)\n\n    var s string\n    fmt.Scanln(&amp;s)\n}\n\nfunc fill(a *[]float64, n int) {\n    for i:=0; i&lt;n; i++ {\n        *a = append(*a, rand.Float64()*100)\n    }\n}\n</code></pre>\n\n<p>As you see, I'm trying to fill two slices. But when run this way (with <code>go fill()</code>), it prints two empty slices. Why is this not working?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1429199240, "post_id": 29679762, "comment_id": 47496766, "body": "Where exactly do you set it? In ~/.bashrc?"}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1429199281, "post_id": 29679762, "comment_id": 47496790, "body": "No I&#39;m not using a .bashrc - I&#39;m not sure how to do this part. Could you show me?"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1429199499, "post_id": 29679762, "comment_id": 47496964, "body": "Are you using Ubuntu?"}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1429199524, "post_id": 29679762, "comment_id": 47496978, "body": "yes i am using Ubuntu"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1429199639, "post_id": 29679762, "comment_id": 47497083, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/21001387/how-do-i-set-the-gopath-environment-variable-on-ubuntu-what-file-must-i-edit\">how do I SET the GOPATH environment variable on Ubuntu? What file must I edit?</a>"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1429199671, "post_id": 29679762, "comment_id": 47497111, "body": "see the answer in the question I&#39;ve linked above."}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1429199703, "post_id": 29679762, "comment_id": 47497141, "body": "i&#39;ve seen that - I can&#39;t see the answer - there is no accepted anwser"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1429200235, "post_id": 29679762, "comment_id": 47497523, "body": "This is a Linux/bash question and it&#39;s because export only sets the env variable for the current session..."}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1429200313, "post_id": 29679762, "comment_id": 47497573, "body": "any chance you could show me how to write it to a file then?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1429200681, "post_id": 29679762, "comment_id": 47497833, "body": "@tommyd456 I&#39;ve provided a step by step answer. Not sure what your skill level with Ubuntu is but these as I noted this is Linux/bash and nothing to do with Go so you don&#39;t want to look on SO for future reference. SuperUser or Ubuntu stackexchange for example are far more appropriate for the type of answer I&#39;ve provided."}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1429200734, "post_id": 29679762, "comment_id": 47497883, "body": "appreciate that - very low by the way (skill level) ha ha"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1429202484, "post_id": 29679762, "comment_id": 47499140, "body": "related to <a href=\"http://stackoverflow.com/questions/28006265/gopath-value-keeps-reseting-to-empty-during-new-sessions-of-the-terminal\">$GOPATH value keeps reseting to empty during new sessions of the terminal</a>"}], "answers": [{"comments": [{"owner": {"reputation": 114, "user_id": 2840601, "user_type": "registered", "profile_image": "https://graph.facebook.com/1605469080/picture?type=large", "display_name": "Felix Ribeiro", "link": "https://stackoverflow.com/users/2840601/felix-ribeiro"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1429200093, "post_id": 29680073, "comment_id": 47497422, "body": "setting GOROOT allows you to put $GOROOT/bin in your path. There&#39;s no problem in set GOROOT"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1429200427, "post_id": 29680073, "comment_id": 47497657, "body": "From many posts on the mailing list: &quot;In general, never set GOROOT.&quot; Also see: <a href=\"http://dave.cheney.net/2013/06/14/you-dont-need-to-set-goroot-really\" rel=\"nofollow noreferrer\">You don\u2019t need to set GOROOT, really</a>. Only set it if you absolutely need to, otherwise it will eventually cause problems."}, {"owner": {"reputation": 114, "user_id": 2840601, "user_type": "registered", "profile_image": "https://graph.facebook.com/1605469080/picture?type=large", "display_name": "Felix Ribeiro", "link": "https://stackoverflow.com/users/2840601/felix-ribeiro"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1429200746, "post_id": 29680073, "comment_id": 47497890, "body": "Ok, fixed. I can&#39;t really see BIG problems, but ok."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1429200894, "post_id": 29680073, "comment_id": 47497976, "body": "Maybe it&#39;s only a big problem for those of us who regularly answer questions on the ML caused by setting GOROOT (and those affected of course) ;)"}], "tags": [], "owner": {"reputation": 114, "user_id": 2840601, "user_type": "registered", "profile_image": "https://graph.facebook.com/1605469080/picture?type=large", "display_name": "Felix Ribeiro", "link": "https://stackoverflow.com/users/2840601/felix-ribeiro"}, "is_accepted": false, "score": 0, "last_activity_date": 1429200709, "last_edit_date": 1429200709, "creation_date": 1429199911, "answer_id": 29680073, "question_id": 29679762, "link": "https://stackoverflow.com/questions/29679762/gopath-variable-not-persisting/29680073#29680073", "title": "GOPATH variable not persisting", "body": "<p>Open you terminal (you can use any text editor, like: gedit, vi or vim).</p>\n\n<pre><code>   gedit ~/.bashrc\n</code></pre>\n\n<p>go to the end of file and edit with the following lines:</p>\n\n<pre><code>   export GOPATH=$HOME/go\n   export PATH=$PATH:$GOPATH/bin\n</code></pre>\n\n<p>Assuming that /usr/lib/go is your GOROOT</p>\n\n<p>to know your GOROOT you can do:</p>\n\n<pre><code>   go env\n</code></pre>\n\n<p>or</p>\n\n<pre><code>   which go\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 0, "last_activity_date": 1429200578, "creation_date": 1429200578, "answer_id": 29680340, "question_id": 29679762, "link": "https://stackoverflow.com/questions/29679762/gopath-variable-not-persisting/29680340#29680340", "title": "GOPATH variable not persisting", "body": "<p>Just so you know this should be answered in general form on SuperUser or something other than here. Regardless here's the steps to make it so this is always set in your session;</p>\n\n<pre><code>cd ~\nvi .bashrc\n//page down, end whatever to get to bottom of file if it's not new\npress i to insert, add export GOPATH=$HOME/go\npress escape\n:w\n:q\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 5421427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81adbb669be66b01974c5eb5cf07811e?s=128&d=identicon&r=PG&f=1", "display_name": "Shubham Sharma", "link": "https://stackoverflow.com/users/5421427/shubham-sharma"}, "is_accepted": false, "score": 0, "last_activity_date": 1567550368, "creation_date": 1567550368, "answer_id": 57779497, "question_id": 29679762, "link": "https://stackoverflow.com/questions/29679762/gopath-variable-not-persisting/57779497#57779497", "title": "GOPATH variable not persisting", "body": "<p>To make Felix's answer more simpler you could run the below commands while not breaking your head with <code>vim</code></p>\n\n<pre><code>echo \"export GOPATH=$HOME/go\" &gt;&gt; ~/.bash_profile\necho \"export PATH=$GOPATH/bin:$PATH\" &gt;&gt; ~/.bash_profile\nsource ~/.bash_profile\n</code></pre>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 789, "favorite_count": 0, "accepted_answer_id": 29680340, "answer_count": 3, "score": -2, "last_activity_date": 1567550368, "creation_date": 1429199151, "question_id": 29679762, "link": "https://stackoverflow.com/questions/29679762/gopath-variable-not-persisting", "title": "GOPATH variable not persisting", "body": "<p>I'm setting the $GOPATH using <code>export GOPATH=$HOME/go</code> as per GoLang's instructions and everything works fine. When I <code>echo</code> out the path it shows what I set it to.</p>\n\n<p>However, if I close my terminal and re-open it the $GOPATH is no longer what I set it to.</p>\n\n<p>I guess my question is how can I make the new $GOPATH persist?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "is_accepted": true, "score": 20, "last_activity_date": 1429194728, "creation_date": 1429194728, "answer_id": 29677870, "question_id": 29677773, "link": "https://stackoverflow.com/questions/29677773/is-main-go-required-in-a-go-project/29677870#29677870", "title": "Is main.go required in a Go project?", "body": "<p><code>main.go</code> as a file is not required.</p>\n\n<p>However, a <code>main</code> package with a <code>func main()</code> is required for executables. </p>\n\n<p>Your file name can be called whatever you want. </p>\n\n<p>E.g</p>\n\n<p><strong>myawesomeapp.go</strong></p>\n\n<pre><code>package main\n\nfunc main() {\n  fmt.Println(\"Hello World\")\n}\n</code></pre>\n\n<p>Running <code>go run myawesomeapp.go</code> will work as expected.</p>\n"}, {"tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": false, "score": 7, "last_activity_date": 1429255869, "last_edit_date": 1429255869, "creation_date": 1429195045, "answer_id": 29678026, "question_id": 29677773, "link": "https://stackoverflow.com/questions/29677773/is-main-go-required-in-a-go-project/29678026#29678026", "title": "Is main.go required in a Go project?", "body": "<p>For a web server (an executable) you need to have a <code>package main</code> with a <code>func main()</code>, but it doesn't need to be called main.go - the file name can be anything you want it to be. From the <a href=\"https://golang.org/ref/spec\" rel=\"nofollow\">language spec</a>:</p>\n\n<blockquote>\n  <p><strong>Program execution</strong></p>\n  \n  <p>A complete program is created by linking a single, unimported package\n  called the main package with all the packages it imports,\n  transitively. The main package must have package name main and declare\n  a function main that takes no arguments and returns no value.</p>\n\n<pre><code>func main() { \u2026 }\n</code></pre>\n  \n  <p>Program execution begins by initializing the main package and then\n  invoking the function main. When that function invocation returns, the\n  program exits. It does not wait for other (non-main) goroutines to\n  complete.</p>\n</blockquote>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4653, "favorite_count": 2, "accepted_answer_id": 29677870, "answer_count": 2, "score": 13, "last_activity_date": 1429255869, "creation_date": 1429194512, "question_id": 29677773, "link": "https://stackoverflow.com/questions/29677773/is-main-go-required-in-a-go-project", "title": "Is main.go required in a Go project?", "body": "<p>Without a background in C and only \"beginner\" experience in Go I'm trying to work out whether <code>main.go</code> is actually required or is just a convention.</p>\n\n<p>I'm looking to create a simple web API but could someone clarify this for me?</p>\n"}, {"tags": ["go", "maps", "hashtable"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1429196185, "post_id": 29677670, "comment_id": 47494324, "body": "Relevant, check out this page: <a href=\"https://github.com/golang/go/issues/3885\" rel=\"nofollow noreferrer\">Issue 3885: profile and tune map code</a> (<a href=\"https://code.google.com/p/go/issues/detail?id=3885\" rel=\"nofollow noreferrer\">old link</a>)"}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1429225057, "post_id": 29677670, "comment_id": 47511768, "body": "Hashing isn&#39;t O(1), eg. for strings."}], "answers": [{"comments": [{"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 9, "creation_date": 1429196978, "post_id": 29678569, "comment_id": 47494984, "body": "+1, nitpick: <a href=\"http://www.cs.cornell.edu/courses/cs3110/2011sp/lectures/lec20-amortized/amortized.htm\" rel=\"nofollow noreferrer\"><i>amortized</i></a> O(1)"}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1429197755, "post_id": 29678569, "comment_id": 47495640, "body": "Thanks for the answer!  I guess I&#39;m trying to see if we can only <i>assume</i> that we&#39;ll get amortized <code>O(1)</code> performance for map operations or if there is (or will be) any <i>documented guarantees</i>."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 7, "last_activity_date": 1429196267, "creation_date": 1429196267, "answer_id": 29678569, "question_id": 29677670, "link": "https://stackoverflow.com/questions/29677670/what-is-the-big-o-performance-of-maps-in-golang/29678569#29678569", "title": "What is the Big O performance of maps in golang?", "body": "<p>From what I can see, the <a href=\"https://golang.org/ref/spec\" rel=\"noreferrer\">Go Programming Language Specification</a> does not make any performance guarantees for map types. <a href=\"https://en.wikipedia.org/wiki/Hash_table\" rel=\"noreferrer\">Hash tables</a> in general are O(1) for inserting, looking up and deleting data; we can assume that this is also true for Go's maps.</p>\n\n<p>If you are worried about map performance, you can always <a href=\"http://golang.org/pkg/testing/#hdr-Benchmarks\" rel=\"noreferrer\">benchmark</a> your code on different loads and decide, whether to use Go's maps or some other data structure.</p>\n"}, {"comments": [{"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1429223523, "post_id": 29687000, "comment_id": 47511249, "body": "Thanks for the detailed information.  I suppose what I&#39;m looking for is documented guarantees about even general characteristics, e.g. logarithmic-time vs constant-time for various operations."}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "reply_to_user": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1429224070, "post_id": 29687000, "comment_id": 47511419, "body": "As you can read in source // When the hashtable grows, we allocate a new array // of buckets TWICE AS BIG"}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "reply_to_user": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1429224517, "post_id": 29687000, "comment_id": 47511587, "body": "So you can assume logarithmic-time when sequentially insert N items in newly map, to my mind. And then near O(1) for lookup"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1429226684, "post_id": 29687000, "comment_id": 47512305, "body": "And of course, don&#39;t forget that you can provide a sizing hint to <code>make</code> for maps to skip some/all of those re-allocations when you know the size (or approximate size)."}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 6, "last_activity_date": 1429222783, "creation_date": 1429222783, "answer_id": 29687000, "question_id": 29677670, "link": "https://stackoverflow.com/questions/29677670/what-is-the-big-o-performance-of-maps-in-golang/29687000#29687000", "title": "What is the Big O performance of maps in golang?", "body": "<p>To be precise hash tables performance is O(1 + n/k) to resolve collisions, where n/k refer to load-factor. Go spec declare maps as non-restrictive in keys quantity. So they need dynamic resizing with partly rehashing to keep load-factor when growing or shrinking. This means near O(1) can be easily achieved for lookup in constant size maps, but can't even theoretically be guaranteed for massive insertion or deletions. Such operations want  reallocation, partial rehashing and possible garbage collections to keep load-factor and reasonable memory usage.</p>\n"}, {"tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": true, "score": 30, "last_activity_date": 1429243498, "creation_date": 1429243498, "answer_id": 29690063, "question_id": 29677670, "link": "https://stackoverflow.com/questions/29677670/what-is-the-big-o-performance-of-maps-in-golang/29690063#29690063", "title": "What is the Big O performance of maps in golang?", "body": "<p>The language reference doesn't make explicit guarantees about the performance of maps. There's an implicit expectation that maps perform like you expect hash-tables to perform. I don't see how a performance guarantee would avoid being either vaguely specified or inaccurate.</p>\n\n<p>Big-O complexity is a poor way to describe run-times for maps: practically speaking the actual clock time is relevant and complexity isn't. Theoretically, maps with keys from finite domains (such as ints) are trivially O(1) in space and time, and maps with keys with infinite domains (such as strings) require hashing and the specifics of equality testing to be included in the cost, which makes inserts and lookups best case O(N log N) on average (since the keys have to be at least O(log N) in size on average to construct a hash table with N entries. Unless you get these details right in the specification it's going to be inaccurate, and the benefit of getting it right isn't clearly worth it.</p>\n\n<p>To provide guarantees about actual run-time rather than complexity it'd be also be difficult: there's a wide range of target machines, as well as the confounding problems of caching and garbage collection.</p>\n"}], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16356, "favorite_count": 2, "accepted_answer_id": 29690063, "answer_count": 3, "score": 26, "last_activity_date": 1429243498, "creation_date": 1429194275, "last_edit_date": 1429197543, "question_id": 29677670, "link": "https://stackoverflow.com/questions/29677670/what-is-the-big-o-performance-of-maps-in-golang", "title": "What is the Big O performance of maps in golang?", "body": "<p>The <a href=\"https://golang.org/ref/spec#Map_types\" rel=\"noreferrer\">\"Map types\" section of the go language specification</a> describes the interface and general usage of map types and the <a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"noreferrer\">\"Go maps in action\" post on The Go Blog</a> casually mentions hash tables and \"fast lookups, adds, and deletes\".</p>\n\n<p>The <a href=\"http://golang.org/src/runtime/hashmap.go#L9\" rel=\"noreferrer\">current <code>runtime/hashmap.go</code> source code</a> describes its implementation as a hashtable (which are typically amortized <code>O(1)</code>); however, I don't see any guarantee of performance characteristics (such as Big O performance) in the language specification or other materials.</p>\n\n<p>Does the go language make any <em>performance</em> guarantees (e.g. constant-time insertion/lookup/deletion?) for map types or only <em>interface</em> guarantees?  (Compare to the Java language where <em>interfaces</em> and <em>implementations</em> are clearly separate.)</p>\n"}, {"tags": ["xml", "go"], "answers": [{"tags": [], "owner": {"reputation": 1410, "user_id": 639674, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c90ce4a2d064caafe0de7725beac34?s=128&d=identicon&r=PG&f=1", "display_name": "Mathias", "link": "https://stackoverflow.com/users/639674/mathias"}, "is_accepted": true, "score": 2, "last_activity_date": 1429177306, "last_edit_date": 1429177306, "creation_date": 1429176756, "answer_id": 29670705, "question_id": 29670462, "link": "https://stackoverflow.com/questions/29670462/golang-extract-elements-in-xml-string/29670705#29670705", "title": "golang - extract elements in xml string", "body": "<p>It only unmarshals exported and thus Caps fields. Also <code>Loc</code> shouldn't be a struct but can be a string directly.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n)\n\ntype Query struct {\n    XMLName xml.Name `xml:\"urlset\"`\n    Locs    []Loc    `xml:\"url&gt;loc\"`\n}\n\ntype Loc string\n\nvar data = []byte(`&lt;urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\"&gt;\n&lt;url&gt;\n   &lt;loc&gt;http://www.konga.com/mobile-recharge&lt;/loc&gt;\n   &lt;lastmod&gt;2015-04-14&lt;/lastmod&gt;\n   &lt;changefreq&gt;daily&lt;/changefreq&gt;\n   &lt;priority&gt;0.5&lt;/priority&gt;\n&lt;/url&gt;\n&lt;url&gt;\n   &lt;loc&gt;http://www.konga.com/beauty-health-personal-care&lt;/loc&gt;\n   &lt;lastmod&gt;2015-04-14&lt;/lastmod&gt;\n   &lt;changefreq&gt;daily&lt;/changefreq&gt;\n   &lt;priority&gt;0.5&lt;/priority&gt;\n&lt;/url&gt;\n&lt;/urlset&gt;`)\n\nfunc main() {\n\n    var q Query\n    xml.Unmarshal(data, &amp;q)\n    fmt.Println(q.Locs)\n}\n</code></pre>\n"}], "owner": {"reputation": 1997, "user_id": 140477, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/IjFb7.png?s=128&g=1", "display_name": "Kennedy", "link": "https://stackoverflow.com/users/140477/kennedy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3757, "favorite_count": 0, "accepted_answer_id": 29670705, "answer_count": 1, "score": 3, "last_activity_date": 1429180210, "creation_date": 1429176149, "last_edit_date": 1429180210, "question_id": 29670462, "link": "https://stackoverflow.com/questions/29670462/golang-extract-elements-in-xml-string", "title": "golang - extract elements in xml string", "body": "<p>I want to extract all <code>loc</code> element value but I am getting an empty array</p>\n\n<p>My code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/xml\"\n)\n\ntype Query struct {\n    XMLName xml.Name `xml:\"urlset\"`\n    locs []Loc `xml:\"url&gt;loc\"`\n}\n\ntype Loc struct {\n    loc string \n}\n\nvar data = []byte(`&lt;urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\"&gt;\n&lt;url&gt;\n   &lt;loc&gt;http://www.konga.com/mobile-recharge&lt;/loc&gt;\n   &lt;lastmod&gt;2015-04-14&lt;/lastmod&gt;\n   &lt;changefreq&gt;daily&lt;/changefreq&gt;\n   &lt;priority&gt;0.5&lt;/priority&gt;\n&lt;/url&gt;\n&lt;url&gt;\n   &lt;loc&gt;http://www.konga.com/beauty-health-personal-care&lt;/loc&gt;\n   &lt;lastmod&gt;2015-04-14&lt;/lastmod&gt;\n   &lt;changefreq&gt;daily&lt;/changefreq&gt;\n   &lt;priority&gt;0.5&lt;/priority&gt;\n&lt;/url&gt;\n&lt;/urlset&gt;`)\n\n\nfunc main() {\n\n    var q Query\n    xml.Unmarshal(data, &amp;q)\n    fmt.Println(q.locs)\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 15285, "user_id": 113158, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/48b539a26d13f6c9e40081805d8f47ac?s=128&d=identicon&r=PG", "display_name": "Jean Hominal", "link": "https://stackoverflow.com/users/113158/jean-hominal"}, "is_accepted": false, "score": 2, "last_activity_date": 1429175407, "creation_date": 1429175407, "answer_id": 29670182, "question_id": 29670099, "link": "https://stackoverflow.com/questions/29670099/private-public-fields-in-structs-acting-differently/29670182#29670182", "title": "private/public fields in structs.. acting differently", "body": "<p>If the struct is in a different package than the <code>main</code> function, then you cannot access the struct's private fields from that main function.</p>\n\n<p>That is what \"private\" means.</p>\n"}, {"tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": false, "score": 3, "last_activity_date": 1429176546, "creation_date": 1429176546, "answer_id": 29670620, "question_id": 29670099, "link": "https://stackoverflow.com/questions/29670099/private-public-fields-in-structs-acting-differently/29670620#29670620", "title": "private/public fields in structs.. acting differently", "body": "<p>As already stated, the fields need to be exported to be accessible from another package. See the <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow\">spec</a></p>\n\n<blockquote>\n  <p><strong>Exported identifiers</strong></p>\n  \n  <p>An identifier may be exported to permit access to it from another\n  package. An identifier is exported if both:</p>\n  \n  <ul>\n  <li>the first character of the identifier's name is a Unicode upper case\n  letter (Unicode class \"Lu\"); </li>\n  <li>and the identifier is declared in the\n  package block or it is a field name or method name. All other\n  identifiers are not exported.</li>\n  </ul>\n</blockquote>\n\n<p>If you want to keep the fields private, you need to use accessor (set/get) methods which you can read about <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow\">here</a></p>\n\n<blockquote>\n  <p><strong>Getters</strong></p>\n  \n  <p>Go doesn't provide automatic support for getters and setters. There's\n  nothing wrong with providing getters and setters yourself, and it's\n  often appropriate to do so, but it's neither idiomatic nor necessary\n  to put Get into the getter's name. If you have a field called owner\n  (lower case, unexported), the getter method should be called Owner\n  (upper case, exported), not GetOwner. The use of upper-case names for\n  export provides the hook to discriminate the field from the method. A\n  setter function, if needed, will likely be called SetOwner. Both names\n  read well in practice:</p>\n\n<pre><code>owner := obj.Owner()\nif owner != user {\n    obj.SetOwner(user)\n}\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 24613, "user_id": 555222, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/dcd4c7151c0b298d4fb46001df735f6b?s=128&d=identicon&r=PG", "display_name": "clarkk", "link": "https://stackoverflow.com/users/555222/clarkk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 523, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1429176546, "creation_date": 1429175185, "question_id": 29670099, "link": "https://stackoverflow.com/questions/29670099/private-public-fields-in-structs-acting-differently", "title": "private/public fields in structs.. acting differently", "body": "<p>Why can I do this</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    c := Circle{x: 0, y: 0, r: 5}\n    fmt.Println(c.r)\n}\n\ntype Circle struct {\n    x float64\n    y float64\n    r float64\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/0ypcekVDV9\" rel=\"nofollow\">http://play.golang.org/p/0ypcekVDV9</a></p>\n\n<p>When I can't do the same with a struct in a package?</p>\n\n<p>If I would try to access a struct with a field with lowercase a compiler error is returned..</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1036, "user_id": 1737204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2851ca9622b504c85b92fc3e93d87b1f?s=128&d=identicon&r=PG", "display_name": "wldsvc", "link": "https://stackoverflow.com/users/1737204/wldsvc"}, "edited": false, "score": 0, "creation_date": 1429193332, "post_id": 29669835, "comment_id": 47491993, "body": "<code>SubexpNames()</code> is a method of the regular expression, it does not apply to the results of a Find...Match operation."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 4795752, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/9e96c6a1c13d12e9b45e0f6b87ca441f?s=128&d=identicon&r=PG", "display_name": "user4795752", "link": "https://stackoverflow.com/users/4795752/user4795752"}, "is_accepted": false, "score": 0, "last_activity_date": 1429175599, "creation_date": 1429175599, "answer_id": 29670260, "question_id": 29669835, "link": "https://stackoverflow.com/questions/29669835/regexp-get-matches-by-group/29670260#29670260", "title": "regexp get matches by group", "body": "<p>The regexp does not accept digits, <code>s/[a-z ]/[a-z0-9 ]/</code></p>\n\n<p><a href=\"http://play.golang.org/p/ov_zoxBenV\" rel=\"nofollow\">http://play.golang.org/p/ov_zoxBenV</a></p>\n"}, {"comments": [{"owner": {"reputation": 24613, "user_id": 555222, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/dcd4c7151c0b298d4fb46001df735f6b?s=128&d=identicon&r=PG", "display_name": "clarkk", "link": "https://stackoverflow.com/users/555222/clarkk"}, "edited": false, "score": 0, "creation_date": 1429192496, "post_id": 29670299, "comment_id": 47491305, "body": "Have updated my question.. I need to match each tag <code>tag1</code> <code>tag2</code> and <code>tag3</code> indeside <code>query=&quot;&quot;</code>"}, {"owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "reply_to_user": {"reputation": 24613, "user_id": 555222, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/dcd4c7151c0b298d4fb46001df735f6b?s=128&d=identicon&r=PG", "display_name": "clarkk", "link": "https://stackoverflow.com/users/555222/clarkk"}, "edited": false, "score": 0, "creation_date": 1429194482, "post_id": 29670299, "comment_id": 47492904, "body": "@clarkk Well, if you had read my answer, you&#39;d see that I recommended using <code>strings.Split</code> to handle that. Exactly what later was used in the answer you accepted."}], "tags": [], "owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "is_accepted": false, "score": 2, "last_activity_date": 1429175714, "creation_date": 1429175714, "answer_id": 29670299, "question_id": 29669835, "link": "https://stackoverflow.com/questions/29669835/regexp-get-matches-by-group/29670299#29670299", "title": "regexp get matches by group", "body": "<p>First off, the pattern will not match the digits. You might want to change it to:</p>\n\n<pre><code>var re = regexp.MustCompile(`query=\"(.*)\"`)\n</code></pre>\n\n<p>Then, in order to get the substring, you can just use <code>FindStringSubmatch</code>:</p>\n\n<pre><code>match := re.FindStringSubmatch(`query=\"tag1 tag2\"`)\nif len(match) == 2 {\n    fmt.Printf(\"Found: [%s]\\n\", match[1])\n} else {\n    fmt.Println(\"No match found\", match)\n}\n</code></pre>\n\n<p><strong>Output:</strong></p>\n\n<blockquote>\n  <p>Found: [tag1 tag2]</p>\n</blockquote>\n\n<p>Then, in order to split the string into seperate tags, I recommend using <a href=\"http://golang.org/pkg/strings/#Split\" rel=\"nofollow\"><code>strings.Split</code></a></p>\n"}, {"tags": [], "owner": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "is_accepted": true, "score": 4, "last_activity_date": 1429185871, "creation_date": 1429185871, "answer_id": 29674185, "question_id": 29669835, "link": "https://stackoverflow.com/questions/29669835/regexp-get-matches-by-group/29674185#29674185", "title": "regexp get matches by group", "body": "<p>You can extract the whole tag string and then <code>Split()</code> it.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n    \"strings\"\n)\n\nfunc main() {\n    var str string = `query=\"tag1 tag2 tag3\" foo=\"wee\"`\n    re := regexp.MustCompile(`query=\"(.+?)\"`)\n    match := re.FindStringSubmatch(str)\n\n    if len(match) == 2 {\n        fmt.Println(strings.Split(match[1], \" \"))\n    }\n}\n</code></pre>\n\n<p>Output: <code>[tag1 tag2 tag3]</code></p>\n"}], "owner": {"reputation": 24613, "user_id": 555222, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/dcd4c7151c0b298d4fb46001df735f6b?s=128&d=identicon&r=PG", "display_name": "clarkk", "link": "https://stackoverflow.com/users/555222/clarkk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 501, "favorite_count": 0, "accepted_answer_id": 29674185, "answer_count": 3, "score": 1, "last_activity_date": 1429192439, "creation_date": 1429174495, "last_edit_date": 1429192439, "question_id": 29669835, "link": "https://stackoverflow.com/questions/29669835/regexp-get-matches-by-group", "title": "regexp get matches by group", "body": "<p>I want to parse a string and get the substring inside two quotes</p>\n\n<h1>subject</h1>\n\n<pre><code>query=\"tag1 tag2\"\n</code></pre>\n\n<h1>pattern</h1>\n\n<pre><code>query=\"([a-z ]*)\"\n</code></pre>\n\n<h1>result</h1>\n\n<pre><code>tag1 tag2\n</code></pre>\n\n<h1>code</h1>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"regexp\"\n)\n\nvar re = regexp.MustCompile(`query=\"([a-z ]*)\"`)\n\nfunc main() {\n  match  := re.FindStringSubmatch(`query=\"tag1 tag2\"`)\n  result := make(map[string]string)\n  for i, name := range re.SubexpNames() {\n     result[name] = match[i]\n  }\n  fmt.Printf(\"by name: %v\\n\", result)\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/voKpOlcc8J\" rel=\"nofollow\">http://play.golang.org/p/voKpOlcc8J</a></p>\n\n<h1>update</h1>\n\n<p>string</p>\n\n<pre><code>query=\"tag1 tag2 tag3\" foo=\"wee\"\n</code></pre>\n\n<p>matches\n<code>tag1</code> <code>tag2</code> <code>tag3</code></p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"regexp\"\n\nfunc main() {\n    var str string = `query=\"tag1 tag2 tag3\" foo=\"wee\"`\n    re := regexp.MustCompile(`query=\"(([a-z0-9]+) ?)*\"`)\n    match := re.FindStringSubmatch(str)\n    if len(match) == 0 {\n        fmt.Print(\"no matches\")\n    } else {\n        result := make(map[string]string)\n        for i, name := range re.SubexpNames(){\n            result[name] = match[i]\n        }\n        fmt.Print(result)\n    }\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/8vieH4eDd1\" rel=\"nofollow\">http://play.golang.org/p/8vieH4eDd1</a></p>\n"}, {"tags": ["unix", "go", "redis", "docker"], "comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1429174578, "post_id": 29669438, "comment_id": 47477771, "body": "<code>docker run ... [PROGRAM_NAME]</code>: Is <code>[PROGRAM_NAME]</code> the name of a docker image?"}, {"owner": {"reputation": 796, "user_id": 4793737, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/TrTs9.jpg?s=128&g=1", "display_name": "Donovan", "link": "https://stackoverflow.com/users/4793737/donovan"}, "reply_to_user": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1429178362, "post_id": 29669438, "comment_id": 47480435, "body": "@VonC Yes. I used <code>docker build -t [APP_CONTAINER_NAME] .</code> to get my program&#39;s container. Then I started the Redis container and my program can&#39;t see the Redis server. After this I tried linking them with the above command."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1429179664, "post_id": 29669438, "comment_id": 47481352, "body": "<a href=\"https://docs.docker.com/reference/commandline/cli/\" rel=\"nofollow noreferrer\">docs.docker.com/reference/commandline/cli</a>: <code>The --link flag will link the container named &#47;redis into the newly created container with the alias redis. The new container can access the network and environment of the redis container via environment variables. </code> Do you see those environmentvariables set in your program container?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 1, "creation_date": 1429179726, "post_id": 29669438, "comment_id": 47481389, "body": "As in <a href=\"https://www.orchardup.com/blog/docker-08\" rel=\"nofollow noreferrer\">orchardup.com/blog/docker-08</a>: <code>$ orchard docker run --link redis:redis ubuntu env REDIS_PORT=tcp:&#47;&#47;172.17.0.3:6379 REDIS_PORT_6379_TCP=tcp:&#47;&#47;172.17.0.3:6379 REDIS_PORT_6379_TCP_ADDR=172.17.0.3 REDIS_PORT_6379_TCP_PORT=6379 REDIS_PORT_6379_TCP_PROTO=tcp</code>"}, {"owner": {"reputation": 3799, "user_id": 105282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76eb5847f0ecf87aba817ee37547c537?s=128&d=identicon&r=PG", "display_name": "booyaa", "link": "https://stackoverflow.com/users/105282/booyaa"}, "edited": false, "score": 0, "creation_date": 1429181517, "post_id": 29669438, "comment_id": 47482634, "body": "what error are you getting? connection refused?"}, {"owner": {"reputation": 796, "user_id": 4793737, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/TrTs9.jpg?s=128&g=1", "display_name": "Donovan", "link": "https://stackoverflow.com/users/4793737/donovan"}, "reply_to_user": {"reputation": 3799, "user_id": 105282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76eb5847f0ecf87aba817ee37547c537?s=128&d=identicon&r=PG", "display_name": "booyaa", "link": "https://stackoverflow.com/users/105282/booyaa"}, "edited": false, "score": 0, "creation_date": 1429193586, "post_id": 29669438, "comment_id": 47492200, "body": "@booya Yes. It can&#39;t find a server on 6379 port."}, {"owner": {"reputation": 796, "user_id": 4793737, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/TrTs9.jpg?s=128&g=1", "display_name": "Donovan", "link": "https://stackoverflow.com/users/4793737/donovan"}, "reply_to_user": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1429205513, "post_id": 29669438, "comment_id": 47500993, "body": "@VonC My environment variables are <code>REDIS_PORT=tcp:&#47;&#47;127.0.0.1:6379 REDIS_PORT_6379_TCP=tcp:&#47;&#47;127.0.0.1:6379 REDIS_PORT_6379_TCP_ADDR=127.0.0.1 REDIS_PORT_6379_TCP_PORT=6379 </code>"}], "answers": [{"tags": [], "owner": {"reputation": 4689, "user_id": 834102, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/ca94b06e32f746968f0aec970a702a0c?s=128&d=identicon&r=PG", "display_name": "Jason Waldrip", "link": "https://stackoverflow.com/users/834102/jason-waldrip"}, "is_accepted": false, "score": 0, "last_activity_date": 1430282421, "creation_date": 1430282421, "answer_id": 29934500, "question_id": 29669438, "link": "https://stackoverflow.com/questions/29669438/how-can-i-make-my-dockerized-go-program-to-use-a-dockerized-redis-on-default-por/29934500#29934500", "title": "How can I make my dockerized Go program to use a dockerized Redis on default port?", "body": "<p>I the latest versions of docker, the linked container is available via DNS. Since you are using the default redis port you should be able to connect to redis using: redis://redis:6379</p>\n"}], "owner": {"reputation": 796, "user_id": 4793737, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/TrTs9.jpg?s=128&g=1", "display_name": "Donovan", "link": "https://stackoverflow.com/users/4793737/donovan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 138, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1430282421, "creation_date": 1429173290, "last_edit_date": 1429178517, "question_id": 29669438, "link": "https://stackoverflow.com/questions/29669438/how-can-i-make-my-dockerized-go-program-to-use-a-dockerized-redis-on-default-por", "title": "How can I make my dockerized Go program to use a dockerized Redis on default port?", "body": "<p>I have a Go program that uses a Redis client on it's default port 6379. I started a container from the official Redis image and I can see that it's working because redis-cli recognizes it, but the Go container cannot connect to it.</p>\n\n<p>I also tried linking (after starting the Redis container) with </p>\n\n<pre><code>docker run --link redis:redis [APP_CONTAINER_NAME]\n</code></pre>\n\n<p>And I get the same result. The Go Redis client from my program is not able to see the Redis server.</p>\n"}, {"tags": ["json", "go", "unmarshalling"], "answers": [{"comments": [{"owner": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "edited": false, "score": 0, "creation_date": 1429168439, "post_id": 29667632, "comment_id": 47474184, "body": "Aaaahhhh I see. Thanks!"}, {"owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "reply_to_user": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "edited": false, "score": 0, "creation_date": 1429168593, "post_id": 29667632, "comment_id": 47474271, "body": "@DavidBrophy I am still trying to figure out how you can actually work around the problem. I will edit the answer if I figure it out. But, you are welcome :)"}, {"owner": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "edited": false, "score": 0, "creation_date": 1429169603, "post_id": 29667632, "comment_id": 47474871, "body": "Yeah same here! I actually just found a duplicate question that doesn&#39;t come to any conclusion: <a href=\"http://stackoverflow.com/questions/20587157/golang-having-trouble-with-nested-json-unmarshaler\" title=\"golang having trouble with nested json unmarshaler\">stackoverflow.com/questions/20587157/&hellip;</a>"}, {"owner": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "edited": false, "score": 0, "creation_date": 1429545382, "post_id": 29667632, "comment_id": 47637499, "body": "I worked around it by making a copy of the whole encoding/json package, and adding a new function &quot;UnmarshalWithoutCustomUnmarshalers&quot;. Its not ideal, but it worked perfectly... I&#39;ll push the code to github at some point."}], "tags": [], "owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "is_accepted": true, "score": 7, "last_activity_date": 1429167950, "creation_date": 1429167950, "answer_id": 29667632, "question_id": 29667379, "link": "https://stackoverflow.com/questions/29667379/json-unmarshal-fails-when-embedded-type-has-unmarshaljson/29667632#29667632", "title": "json.Unmarshal fails when embedded type has UnmarshalJSON", "body": "<p>It is expected.</p>\n\n<p>When you create the alias:</p>\n\n<pre><code>type Alias Foo\n</code></pre>\n\n<p><code>Alias</code> will not inherit the methods of <code>Foo</code> since it is a different type with a different method set, which is what you wanted to achieve to avoid an infinite recursion.</p>\n\n<p><em>However</em>, the embedded <code>EmbeddedStruct</code>'s <code>UnmarshalJSON</code> method will instead be promoted!</p>\n\n<p>So, <code>Alias</code> will have an <code>UnmarshalJSON</code> method that will only unmarshal <code>EmbeddedStruct</code>'s value, instead of using the default unmarshalling that you desired.</p>\n"}], "owner": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 552, "favorite_count": 0, "accepted_answer_id": 29667632, "answer_count": 1, "score": 5, "last_activity_date": 1429169124, "creation_date": 1429167178, "question_id": 29667379, "link": "https://stackoverflow.com/questions/29667379/json-unmarshal-fails-when-embedded-type-has-unmarshaljson", "title": "json.Unmarshal fails when embedded type has UnmarshalJSON", "body": "<p>I'm trying to unmarshal a struct that has an embedded type. When the embedded type has an UnmarshalJSON method, the unmarshaling of the outer type fails:</p>\n\n<p><a href=\"https://play.golang.org/p/Y_Tt5O8A1Q\" rel=\"noreferrer\">https://play.golang.org/p/Y_Tt5O8A1Q</a></p>\n\n<pre><code>package main\n\n\nimport (\n    \"fmt\"\n\n    \"encoding/json\"\n)\n\ntype Foo struct {\n    EmbeddedStruct\n    Field string\n}\n\nfunc (d *Foo) UnmarshalJSON(from []byte) error {\n    fmt.Printf(\"Foo.UnmarshalJSON\\n\")\n\n    type Alias Foo\n    alias := &amp;Alias{}\n    if err := json.Unmarshal(from, alias); err != nil {\n        return fmt.Errorf(\"Error in Foo.UnmarshalJSON: json.Unmarshal returned an error:\\n%v\\n\", err)\n    }\n    *d = Foo(*alias)\n\n    return nil\n}\n\ntype EmbeddedStruct struct {\n    EmbeddedField string\n}\n\nfunc (d *EmbeddedStruct) UnmarshalJSON(from []byte) error {\n    fmt.Printf(\"EmbeddedStruct.UnmarshalJSON\\n\")\n\n    type Alias EmbeddedStruct\n    alias := &amp;Alias{}\n    if err := json.Unmarshal(from, alias); err != nil {\n        return fmt.Errorf(\"Error in EmbeddedStruct.UnmarshalJSON: json.Unmarshal returned an error:\\n%v\\n\", err)\n    }\n    *d = EmbeddedStruct(*alias)\n\n    return nil\n}\n\nfunc main() {\n\n    data := `{\"EmbeddedField\":\"embeddedValue\", \"Field\": \"value\"}`\n    foo := &amp;Foo{}\n\n    json.Unmarshal([]byte(data), foo)\n\n    fmt.Printf(\"Foo: %v\\n\", foo)\n\n    if foo.EmbeddedField != \"embeddedValue\" {\n        fmt.Printf(\"Unmarshal didn't work, EmbeddedField value is %v. Should be 'embeddedValue'\\n\", foo.EmbeddedField)\n    }\n\n    if foo.Field != \"value\" {\n        fmt.Printf(\"Unmarshal didn't work, Field value is %v. Should be 'value'\\n\", foo.Field)\n    }\n\n}\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>Foo.UnmarshalJSON\nEmbeddedStruct.UnmarshalJSON\nFoo: &amp;{{embeddedValue} }\nUnmarshal didn't work, Field value is . Should be 'value'\n</code></pre>\n\n<p>... so both custom unmarshal functions ran. The value from the embedded struct is correct, but the value from the outer struct is lost.</p>\n\n<p>If we simply remove the EmbeddedStruct.UnmarshalJSON method, it works as expected.</p>\n\n<p>Am I doing something wrong? Is this expected? Or a bug? I'm sure there's a way I can tweak my UnmarshalJSON methods to get it working.</p>\n"}, {"tags": ["go", "newtons-method"], "answers": [{"comments": [{"owner": {"reputation": 5825, "user_id": 631051, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/88a9701bb32b465a3b8357a2aa092815?s=128&d=identicon&r=PG", "display_name": "Ellen Spertus", "link": "https://stackoverflow.com/users/631051/ellen-spertus"}, "edited": false, "score": 2, "creation_date": 1429165895, "post_id": 29666900, "comment_id": 47472610, "body": "Yipes!  Thanks for answering the question I should have asked (is my algorithm correct?) as well as the one that I asked."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 10, "last_activity_date": 1429167720, "last_edit_date": 1429167720, "creation_date": 1429165673, "answer_id": 29666900, "question_id": 29666295, "link": "https://stackoverflow.com/questions/29666295/is-there-a-more-elegant-go-implementation-of-newtons-method/29666900#29666900", "title": "Is there a more elegant Go implementation of Newton&#39;s method?", "body": "<p>First, you algorithm is not correct. The formula is:</p>\n\n<p><img src=\"https://i.stack.imgur.com/v7ODW.png\" alt=\"enter image description here\"></p>\n\n<p>You modelled this with:</p>\n\n<pre><code>z - (z*z - x) / 2*z\n</code></pre>\n\n<p>But it should be:</p>\n\n<pre><code>z - (z*z - x)/2/z\n</code></pre>\n\n<p>Or</p>\n\n<pre><code>z - (z*z - x)/(2*z)\n</code></pre>\n\n<p>(Your incorrect formula had to run like half a million iterations even to just get as close as <code>0.001</code>! The correct formula uses like 4 iterations to get as close as <code>1e-6</code> in case of <code>x = 2</code>.)</p>\n\n<p>Next, initial value of <code>z=1</code> is not the best for a random number (it might work well for a small number like <code>2</code>). You can kick off with <code>z = x / 2</code> which is a very simple initial value and takes you closer to the result with fewer steps.</p>\n\n<p><strong>Further options which do not necessarily make it more readable or elegant, it's subjective:</strong></p>\n\n<p>You can name the result to <code>z</code> so the return statement can be \"bare\". Also you can create a loop variable to count the iterations if you move the current \"exit\" condition into the loop which if met you print the iterations count and can simply return. You can also move the calculation to the initialization part of the <code>if</code>:</p>\n\n<pre><code>func Sqrt(x float64) (z float64) {\n    z = x / 2\n    for i, old := 1, 0.0; ; i++ {\n        if old, z = z, z-(z*z-x)/2/z; math.Abs(old-z) &lt; 1e-5 {\n            fmt.Printf(\"Ran %v iterations\\n\", i)\n            return\n        }\n    }\n}\n</code></pre>\n\n<p>You can also move the <code>z = x / 2</code> to the initialization part of the <code>for</code> but then you can't have named result (else a local variant of <code>z</code> would be created which would shadow the named return value):</p>\n\n<pre><code>func Sqrt(x float64) float64 {\n    for i, z, old := 1, x/2, 0.0; ; i++ {\n        if old, z = z, z-(z*z-x)/2/z; math.Abs(old-z) &lt; 1e-5 {\n            fmt.Printf(\"Ran %v iterations\\n\", i)\n            return z\n        }\n    }\n}\n</code></pre>\n\n<p><strong>Note:</strong> I started my iteration counter with <code>1</code> because the \"exit\" condition in my case is inside the <code>for</code> and is not the condition of <code>for</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 809, "user_id": 4843679, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153332014556457/picture?type=large", "display_name": "Soumojit Ghosh", "link": "https://stackoverflow.com/users/4843679/soumojit-ghosh"}, "is_accepted": false, "score": 0, "last_activity_date": 1532009746, "creation_date": 1532009746, "answer_id": 51424974, "question_id": 29666295, "link": "https://stackoverflow.com/questions/29666295/is-there-a-more-elegant-go-implementation-of-newtons-method/51424974#51424974", "title": "Is there a more elegant Go implementation of Newton&#39;s method?", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\nfunc Sqrt(x float64) float64 {\n    z := 1.0\n    // First guess\n    z -= (z*z - x) / (2*z)\n    // Iterate until change is very small\n    for zNew, delta := z, z; delta &gt; 0.00000001; z = zNew {\n        zNew -= (zNew * zNew - x) / (2 * zNew)\n        delta = z - zNew\n    }\n    return z\n}\n\nfunc main() {\n    fmt.Println(Sqrt(2))\n    fmt.Println(math.Sqrt(2))\n}\n</code></pre>\n"}], "owner": {"reputation": 5825, "user_id": 631051, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/88a9701bb32b465a3b8357a2aa092815?s=128&d=identicon&r=PG", "display_name": "Ellen Spertus", "link": "https://stackoverflow.com/users/631051/ellen-spertus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 913, "favorite_count": 0, "accepted_answer_id": 29666900, "answer_count": 2, "score": 4, "last_activity_date": 1532009746, "creation_date": 1429163293, "question_id": 29666295, "link": "https://stackoverflow.com/questions/29666295/is-there-a-more-elegant-go-implementation-of-newtons-method", "title": "Is there a more elegant Go implementation of Newton&#39;s method?", "body": "<p>I'm doing the Go tutorials and am wondering whether there is a more elegant way to compute a square root using Newton's method on <a href=\"https://tour.golang.org/flowcontrol/8\" rel=\"nofollow\">Exercise: Loops and Functions</a> than this:</p>\n\n<pre><code>func Sqrt(x float64) float64 {\n    count := 0\n    var old_z, z float64 = 0, 1\n    for ; math.Abs(z-old_z) &gt; .001; count++ {\n        old_z, z = z, z - (z*z - x) / 2*z\n    }\n    fmt.Printf(\"Ran %v iterations\\n\", count)\n    return z\n}\n</code></pre>\n\n<p>(Part of the specification is to provide the number of iterations.)  Here is the <a href=\"https://gist.github.com/anonymous/fccb10ae76ba39dbcc63\" rel=\"nofollow\">full program</a>, including package statement, imports, and main.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 1, "creation_date": 1429156885, "post_id": 29664830, "comment_id": 47469379, "body": "Can you clarify &quot;validate a value passed via a command-line flag against this enum&quot;?  Are you trying to see if a flag was passed on the command line?  Validate user input?  Check for non-default values in a struct?"}, {"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 1, "creation_date": 1429156912, "post_id": 29664830, "comment_id": 47469388, "body": "In addition to the above .. can you please show us this &quot;struct&quot; you&#39;re referring to? How does a struct come into play here? ... Are you sure you&#39;re not just looking for a map?"}, {"owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "edited": false, "score": 0, "creation_date": 1429193352, "post_id": 29664830, "comment_id": 47492012, "body": "I was trying to do exactly what @IanNaN answered below. Thank you maerics and Simon I apologize for the confusion."}], "answers": [{"tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": true, "score": 4, "last_activity_date": 1429159438, "creation_date": 1429159438, "answer_id": 29665497, "question_id": 29664830, "link": "https://stackoverflow.com/questions/29664830/check-if-value-exists-in-enum/29665497#29665497", "title": "Check if value exists in enum", "body": "<p>From your code sample it looks like you are trying to see if a map (rather than a struct) contains a particular key.</p>\n\n<p>If so, the answer is <a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"nofollow\">here</a></p>\n\n<blockquote>\n  <p>A two-value assignment tests for the existence of a key:</p>\n\n<pre><code>i, ok := m[\"route\"] \n</code></pre>\n  \n  <p>In this statement, the first value (i) is assigned\n  the value stored under the key \"route\". If that key doesn't exist, i\n  is the value type's zero value (0). The second value (ok) is a bool\n  that is true if the key exists in the map, and false if not.</p>\n  \n  <p>To test for a key without retrieving the value, use an underscore in\n  place of the first value:</p>\n\n<pre><code>_, ok := m[\"route\"]\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3427, "favorite_count": 0, "accepted_answer_id": 29665497, "answer_count": 1, "score": 1, "last_activity_date": 1429193224, "creation_date": 1429154963, "last_edit_date": 1429193224, "question_id": 29664830, "link": "https://stackoverflow.com/questions/29664830/check-if-value-exists-in-enum", "title": "Check if value exists in enum", "body": "<p>I have created a strict like the following in my app:</p>\n\n<pre>type Datatype int8\n\nconst (\n    user Datatype = iota\n    address\n    test\n)\n\nvar datatypes = [...]string{\"User\", \"Address\", \"Test\"}\n\nfunc (datatype Datatype) String() string {\n    return datatypes[datatype]\n}</pre>\n\n<p>I would like to be able to validate a value passed via a <em>command-line</em> flag against this enum. </p>\n\n<p>I thought I had seen something like <code>dtype == Datatype</code> being used, but I am apparently sorely mistaken. </p>\n\n<p>If this is not possible I can go the route of putting these values in an array. However, I feel the enum approach is more elegant.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 2, "creation_date": 1429154500, "post_id": 29664720, "comment_id": 47468763, "body": "When you call <code>AddReqQueue</code> in your handler, your handler returns since  you&#39;re not blocking it."}, {"owner": {"reputation": 69, "user_id": 3179074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18f06fd2216d6546f239ac22a6453f03?s=128&d=identicon&r=PG&f=1", "display_name": "Mimir", "link": "https://stackoverflow.com/users/3179074/mimir"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1429154700, "post_id": 29664720, "comment_id": 47468811, "body": "That is what I desired. When the handler returns, does it mark the ResponseWriter for GC? That would seem strange considering I still keep track of it in the map."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1429165284, "post_id": 29664720, "comment_id": 47472284, "body": "The goroutine responsible for the ResponseWriter exits. A &#39;better&#39; way would be to trigger the work, block in the handler, write the work to a buffer, and then <code>io.Copy(buf, w)</code> to write it out back in the handler. Set a timeout to prevent the HTTP connection from timing out on the client side."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1429198164, "post_id": 29664720, "comment_id": 47495973, "body": "Build with <code>-race</code> and fix the races that it will quickly find and report. (I.e. HTTP handlers run in their own goroutines, maps cannot be accessed concurrently without synchronization)."}], "answers": [{"tags": [], "owner": {"reputation": 69, "user_id": 3179074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18f06fd2216d6546f239ac22a6453f03?s=128&d=identicon&r=PG&f=1", "display_name": "Mimir", "link": "https://stackoverflow.com/users/3179074/mimir"}, "is_accepted": false, "score": 2, "last_activity_date": 1429156079, "creation_date": 1429156079, "answer_id": 29664998, "question_id": 29664720, "link": "https://stackoverflow.com/questions/29664720/golang-map-of-http-responsewriters/29664998#29664998", "title": "Golang Map of http.ResponseWriters", "body": "<p>@elithrar was correct. I wasn't aware that the http.ResponseWriter object became invalid after the handler exited. If I just force my handler to wait, it works fine.</p>\n"}], "owner": {"reputation": 69, "user_id": 3179074, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18f06fd2216d6546f239ac22a6453f03?s=128&d=identicon&r=PG&f=1", "display_name": "Mimir", "link": "https://stackoverflow.com/users/3179074/mimir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2252, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1429156079, "creation_date": 1429154092, "last_edit_date": 1429154243, "question_id": 29664720, "link": "https://stackoverflow.com/questions/29664720/golang-map-of-http-responsewriters", "title": "Golang Map of http.ResponseWriters", "body": "<p>I'm trying to create a map that stores http.ResponseWriters so that I can write to them later, after a separate thread has done the relevant computation. \nThe map is defined in my main as follow:<br>\n<code>jobs := make(map[uint32]http.ResponseWriter)</code><br>\nI then pass this map to a handle function like so:  </p>\n\n<pre><code>r.HandleFunc(\"/api/{type}/{arg1}\", func(w http.ResponseWriter, r *http.Request) {\n    typ, _ := strconv.Atoi(mux.Vars(r)[\"type\"])\n    AddReqQueue(w, ReqQueue, typ, mux.Vars(r)[\"arg1\"], jobs, ids)\n}).Methods(\"get\")\n</code></pre>\n\n<p>After that I process the reuqeuest and add it to a channel:</p>\n\n<pre><code>func AddReqQueue(w http.ResponseWriter, ReqQueue chan mssg.WorkReq, typ int, arg1 string, jobs map[uint32]http.ResponseWriter, ids []uint32) {\n    var id uint32\n    id, ids = ids[0], ids[1:] // get a free work id\n    jobs[id] = w\n    fmt.Println(\"Adding req to queue\")\n    ReqQueue &lt;- mssg.WorkReq{Type: uint8(typ), Arg1: arg1, WId: id}\n}\n</code></pre>\n\n<p>Inside this function I have tested and am able to write data to the ReponseWriter, however later when I try to use the map in:</p>\n\n<pre><code>func SendResp(RespQueue chan mssg.WorkResp, jobs map[uint32]http.ResponseWriter) {\nfor {\n    resp := &lt;-RespQueue\n    jobs[resp.WId].Header().Set(\"Content-Type\", \"text/plain\")\n    _, err := jobs[resp.WId].Write(resp.Data) // ERROR IS COMING FROM HERE\n    if err != nil {\n        fmt.Fprintf(os.Stderr, \"Fatal error: %s\", err.Error())\n    }\n}\n</code></pre>\n\n<p>}</p>\n\n<p>It doesn't work. No matter what I pre-set the header too or try to write (even just a simple string I hardcoded) I get a err of</p>\n\n<pre><code>Conn.Write wrote more than the declared Content-Length\n</code></pre>\n\n<p>I know I'm accessing the right struct in the map, it just seems as if the <code>ReponseWriter</code> has gone out of context or been corrupted, also i know that the headers shouldn't really matter since it is the first time I am calling <code>Write()</code> and therefore it should create the headers for me.</p>\n"}]