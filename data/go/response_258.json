[{"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 391, "user_id": 5760975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2f3274e487f55e0eb7139343b23b720?s=128&d=identicon&r=PG", "display_name": "Narro", "link": "https://stackoverflow.com/users/5760975/narro"}, "edited": false, "score": 5, "creation_date": 1576716983, "post_id": 59401595, "comment_id": 104992937, "body": "try this <code>gorm:&quot;type:text&quot;</code>"}, {"owner": {"reputation": 478, "user_id": 9195832, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d28f2fb00f7a922edc2423755911608?s=128&d=identicon&r=PG&f=1", "display_name": "Olu Udeh", "link": "https://stackoverflow.com/users/9195832/olu-udeh"}, "reply_to_user": {"reputation": 391, "user_id": 5760975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2f3274e487f55e0eb7139343b23b720?s=128&d=identicon&r=PG", "display_name": "Narro", "link": "https://stackoverflow.com/users/5760975/narro"}, "edited": false, "score": 0, "creation_date": 1576728836, "post_id": 59401595, "comment_id": 104995051, "body": "It worked, seems I omitted <code>type</code>. Thanks."}], "answers": [{"tags": [], "owner": {"reputation": 393, "user_id": 2151051, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c8dd4fe759cfd9d4d9cb14e00fd5f9d?s=128&d=identicon&r=PG", "display_name": "iamcmnut", "link": "https://stackoverflow.com/users/2151051/iamcmnut"}, "is_accepted": false, "score": 0, "last_activity_date": 1614758820, "creation_date": 1614758820, "answer_id": 66452974, "question_id": 59401595, "link": "https://stackoverflow.com/questions/59401595/how-do-i-create-a-text-column-with-gorm-in-golang/66452974#66452974", "title": "How do I create a TEXT column with gorm in Golang", "body": "<p>Just create with a blank tag.</p>\n<pre><code>type Post struct {\n  gorm.Model\n  Content string ``\n}\n</code></pre>\n<p>P.S. I'm using Gorm v1.20.12 with Postgres 11.8</p>\n"}], "owner": {"reputation": 478, "user_id": 9195832, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d28f2fb00f7a922edc2423755911608?s=128&d=identicon&r=PG&f=1", "display_name": "Olu Udeh", "link": "https://stackoverflow.com/users/9195832/olu-udeh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2453, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1614758820, "creation_date": 1576713453, "question_id": 59401595, "link": "https://stackoverflow.com/questions/59401595/how-do-i-create-a-text-column-with-gorm-in-golang", "title": "How do I create a TEXT column with gorm in Golang", "body": "<p>I am trying to create a TEXT column using gorm ORM but the column is still created as VARCHAR(225).\nBelow is the struct I want to migrate to a table.</p>\n\n<pre><code>type TextDump struct {\n  *gorm.Model\n  Title string `gorm:\"varchar(50)\" json:\"title\" binding:\"required\"`\n  Text string `gorm:\"text\" json:\"text\" binding:\"required\"`\n  Count int `json:\"count\"`\n  ChannelID int `json:\"channel_id\" binding:\"required\"`\n}\n</code></pre>\n\n<p>The <code>text</code> column is created as <code>VARCHAR</code> instead of <code>TEXT</code>.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1474, "user_id": 4734062, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-YxchkDUdJvo/AAAAAAAAAAI/AAAAAAAAEag/2KHY1s7qUOM/photo.jpg?sz=128", "display_name": "Santiago", "link": "https://stackoverflow.com/users/4734062/santiago"}, "edited": false, "score": 0, "creation_date": 1576708026, "post_id": 59400771, "comment_id": 104990768, "body": "First convert testID  to interface{} and use rows, _ := db.Query(&quot;SELECT * FROM table where id = ?&quot;,testIDinterface)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1576768031, "post_id": 59400771, "comment_id": 105011798, "body": "Don&#39;t discard the error from <code>db.Query</code>."}], "answers": [{"tags": [], "owner": {"reputation": 3269, "user_id": 429555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e970e0e5d130ae179f5cfa9b3079b76?s=128&d=identicon&r=PG", "display_name": "ferhat", "link": "https://stackoverflow.com/users/429555/ferhat"}, "is_accepted": true, "score": 1, "last_activity_date": 1576708140, "creation_date": 1576708140, "answer_id": 59400845, "question_id": 59400771, "link": "https://stackoverflow.com/questions/59400771/command-line-argument-for-query/59400845#59400845", "title": "Command line argument for Query", "body": "<p>Just add your parameters to <code>Query</code>:    </p>\n\n<pre><code>rows, _ := db.Query(\"SELECT * FROM table where id = ?;\", os.Args[1])\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1474, "user_id": 4734062, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-YxchkDUdJvo/AAAAAAAAAAI/AAAAAAAAEag/2KHY1s7qUOM/photo.jpg?sz=128", "display_name": "Santiago", "link": "https://stackoverflow.com/users/4734062/santiago"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1576708372, "post_id": 59400858, "comment_id": 104990868, "body": "Query accept interface{} types in arguments refer link -&gt; <a href=\"https://golang.org/pkg/database/sql/#Tx.Query\" rel=\"nofollow noreferrer\">golang.org/pkg/database/sql/#Tx.Query</a>"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1576708476, "post_id": 59400858, "comment_id": 104990895, "body": "it does, and <code>string</code> is assignable to <code>interface{}</code>. (ps: downvote is not mine)"}, {"owner": {"reputation": 1474, "user_id": 4734062, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-YxchkDUdJvo/AAAAAAAAAAI/AAAAAAAAEag/2KHY1s7qUOM/photo.jpg?sz=128", "display_name": "Santiago", "link": "https://stackoverflow.com/users/4734062/santiago"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1576708605, "post_id": 59400858, "comment_id": 104990935, "body": "So the answer is correct, you decide to use or not interface{} type"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1576709094, "post_id": 59400858, "comment_id": 104991082, "body": "The answer is misleading: everything in your code should have technical justification. What&#39;s the reason to not use the idiomatic <code>testID := os.Args[1]</code>?"}, {"owner": {"reputation": 1474, "user_id": 4734062, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-YxchkDUdJvo/AAAAAAAAAAI/AAAAAAAAEag/2KHY1s7qUOM/photo.jpg?sz=128", "display_name": "Santiago", "link": "https://stackoverflow.com/users/4734062/santiago"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1576709387, "post_id": 59400858, "comment_id": 104991172, "body": "os.Args[1] returns string type so declare and assign a variable returns a string variable. Query use interface{} type in arguments, so I declare testID like interface{} type. Declare and assign in two lines and declare and assign in one line is programmer decision. I prefer first."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1576709456, "post_id": 59400858, "comment_id": 104991201, "body": "You don&#39;t need <code>interface{}</code> anywhere in your code at all: <code>db.Query(&quot;SELECT * FROM table where id = ?;&quot;, os.Args[1])</code>. There are no 2 lines anywhere. You don&#39;t need <i>declare</i> a variable in general, there is a <code>:=</code> operator."}], "tags": [], "owner": {"reputation": 1474, "user_id": 4734062, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-YxchkDUdJvo/AAAAAAAAAAI/AAAAAAAAEag/2KHY1s7qUOM/photo.jpg?sz=128", "display_name": "Santiago", "link": "https://stackoverflow.com/users/4734062/santiago"}, "is_accepted": false, "score": -1, "last_activity_date": 1576708464, "last_edit_date": 1576708464, "creation_date": 1576708199, "answer_id": 59400858, "question_id": 59400771, "link": "https://stackoverflow.com/questions/59400771/command-line-argument-for-query/59400858#59400858", "title": "Command line argument for Query", "body": "<p>testID need to be and interface{} type and add to Query</p>\n\n<pre><code>var testID interface{}\ntestID  = os.Args[1]\n</code></pre>\n\n<p>And add to Query</p>\n\n<pre><code>rows, _ := db.Query(\"SELECT * FROM table where id = ?;\", testID)\n</code></pre>\n\n<p>Edit:\nWhy interface{}?</p>\n\n<p>Query function accept interface{} types in arguments. <a href=\"http://golang.org/pkg/database/sql/#Tx.Query\" rel=\"nofollow noreferrer\">More info</a></p>\n"}], "owner": {"reputation": 25, "user_id": 12145367, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/040c01b147377742bc4c0a072827668b?s=128&d=identicon&r=PG&f=1", "display_name": "zquee12", "link": "https://stackoverflow.com/users/12145367/zquee12"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 59400845, "answer_count": 2, "score": -1, "last_activity_date": 1576708464, "creation_date": 1576707669, "question_id": 59400771, "link": "https://stackoverflow.com/questions/59400771/command-line-argument-for-query", "title": "Command line argument for Query", "body": "<p>I'm working on some code that's meant to dump mysql data to a .csv file. I'd like to pass in a command line arg that allows the user to input what ID is run for the query, eg. go run main.go 2 would run the query</p>\n\n<pre><code>SELECT * FROM table where id = 2;\n</code></pre>\n\n<p>I know that Go has the os package where I can then pass something like:</p>\n\n<pre><code>    args := os.Args\n    if len(args) &lt; 2 {\n        fmt.Println(\"Supply ID\")\n        os.Exit(1)\n    }\n    testID := os.Args[1]\n    fmt.Println(testID)\n}\n</code></pre>\n\n<p>Here's the code Im currently working on. How can I set a command line argument for the Query?</p>\n\n<pre><code>    rows, _ := db.Query(\"SELECT * FROM table where id = ?;\")\n\n    err := sqltocsv.WriteFile(\"table.csv\",rows)\n    if err != nil {\n        panic(err)\n    }\n\n    columns, _ := rows.Columns()\n    count := len(columns)\n    values := make([]interface{}, count)\n    valuePtrs := make([]interface{}, count)\n\n    for rows.Next() {\n        for i := range columns {\n            valuePtrs[i] = &amp;values[i]\n        }\n\n        rows.Scan(valuePtrs...)\n\n        for i, col := range columns {\n            val := values[i]\n\n            b, ok := val.([]byte)\n            var v interface{}\n            if ok {\n                v = string(b)\n            } else {\n                v = val\n            }\n\n            fmt.Println(col, v)\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "is_accepted": true, "score": 4, "last_activity_date": 1576702873, "creation_date": 1576702873, "answer_id": 59399917, "question_id": 59399851, "link": "https://stackoverflow.com/questions/59399851/struggling-with-the-go-time-module/59399917#59399917", "title": "Struggling with the Go time module", "body": "<blockquote>\n  <p>From what I can gather from the time documentation though (<a href=\"https://golang.org/pkg/time/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/time/</a>), time.Hour should return \"Hour returns the hour within the day specified by t, in the range [0, 23].\"</p>\n</blockquote>\n\n<p>You\u2019re looking at <a href=\"https://golang.org/pkg/time/#Time.Hour\" rel=\"nofollow noreferrer\">the documentation for <code>time.Time.Hour</code></a>, which you\u2019d use like this:</p>\n\n<pre><code>now := time.Now()\nfmt.Println(now.Hour())\n</code></pre>\n\n<p>The documentation you\u2019re looking for is of <a href=\"https://golang.org/pkg/time/#pkg-constants\" rel=\"nofollow noreferrer\">the constant <code>time.Hour</code></a>, which is a <code>time.Duration</code> defined as <code>60 * Minute</code> \u2013 which happens to show you how to get the two minutes you\u2019re looking for.</p>\n\n<pre><code>2 * time.Minute\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1576702905, "last_edit_date": 1576702905, "creation_date": 1576702880, "answer_id": 59399920, "question_id": 59399851, "link": "https://stackoverflow.com/questions/59399851/struggling-with-the-go-time-module/59399920#59399920", "title": "Struggling with the Go time module", "body": "<p>You're confusing <a href=\"https://golang.org/pkg/time/#pkg-constants\" rel=\"nofollow noreferrer\">time.Hour</a> with <a href=\"https://golang.org/pkg/time/#Time.Hour\" rel=\"nofollow noreferrer\">Time.Hour()</a>.</p>\n\n<p><code>time.Hour</code> is a constant, that represents a duration of one hour. That's what the code in your example uses.</p>\n\n<p><code>Time.Hour()</code> is is a method on a <code>time.Time</code> value, which returns the hour within the day specified, as you quoted from documentation.</p>\n"}, {"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1576702950, "creation_date": 1576702950, "answer_id": 59399932, "question_id": 59399851, "link": "https://stackoverflow.com/questions/59399851/struggling-with-the-go-time-module/59399932#59399932", "title": "Struggling with the Go time module", "body": "<p>What the <code>Set</code> API needs is <code>time.Duration</code> type. If you need two minutes, use:</p>\n\n<pre><code>err := rdb.Set(\"key\", \"value\", 2*time.Minute).Err()\n</code></pre>\n\n<p>You're looking at the documentation for <code>Time.Hour()</code>, not <code>time.Hour</code>.</p>\n"}], "owner": {"reputation": 39, "user_id": 11274599, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Mq2qPVm6iE0/AAAAAAAAAAI/AAAAAAAAAW8/_5-E1TYpDMA/photo.jpg?sz=128", "display_name": "Hyacin", "link": "https://stackoverflow.com/users/11274599/hyacin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 59399917, "answer_count": 3, "score": -3, "last_activity_date": 1576702950, "creation_date": 1576702510, "last_edit_date": 1576702682, "question_id": 59399851, "link": "https://stackoverflow.com/questions/59399851/struggling-with-the-go-time-module", "title": "Struggling with the Go time module", "body": "<p>I'm working with go-redis and trying to put a expiration on a Set I'm doing.</p>\n\n<p>The examples in the documentation show -</p>\n\n<pre><code>func ExampleClient_Set() {\n    // Last argument is expiration. Zero means the key has no\n    // expiration time.\n    err := rdb.Set(\"key\", \"value\", 0).Err()\n    if err != nil {\n        panic(err)\n    }\n\n    // key2 will expire in an hour.\n    err = rdb.Set(\"key2\", \"value\", time.Hour).Err()\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>From what I can gather from the <code>time</code> documentation though (<a href=\"https://golang.org/pkg/time/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/time/</a>), time.Hour should return \"Hour returns the hour within the day specified by t, in the range [0, 23].\", which would make the expiration value different depending on what time of the day this code was run ... I'm sure that's not what they were going for, and as I'm sure the person who wrote the module knows Go better than me, I can't imagine that's what it actually does.</p>\n\n<p>Being quite stumped, I read the go-redis code for Set (<a href=\"https://github.com/go-redis/redis/blob/0658532833205c238a41687728cb13c294504162/commands.go#L839\" rel=\"nofollow noreferrer\">https://github.com/go-redis/redis/blob/0658532833205c238a41687728cb13c294504162/commands.go#L839</a>) and it looked like it wanted seconds, unless you had something set, then it would want msecs, so I passed it <code>120</code> and it took a crap on first run saying \"You've asked for 120ns, but the minimum is 1ms\" ... I added a pile of zeros and it expired almost as soon as I did my <code>Set</code>, so I finally gave up and just decided to ask for some help to do it properly instead of adding a bunch of zeros to every value I want and hoping it worked right.</p>\n\n<p>I've got time.Minute in there now - based on the example I assume that's giving me a minute, but I actually want two, and I have no idea after reading all this and trying all these things how to achieve that.  Help would be GREATLY appreciated!!</p>\n"}, {"tags": ["sql-server", "go", "go-gorm"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1576693935, "post_id": 59398146, "comment_id": 104985397, "body": "try <code>localhost&#47;MSSQLSERVER02</code> instead of <code>localhost\\MSSQLSERVER02</code>"}, {"owner": {"reputation": 47, "user_id": 3066530, "user_type": "registered", "profile_image": "https://graph.facebook.com/1107153199/picture?type=large", "display_name": "Teja", "link": "https://stackoverflow.com/users/3066530/teja"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1576694142, "post_id": 59398146, "comment_id": 104985484, "body": "awesome that worked thanks @Burak Serdar"}], "answers": [{"tags": [], "owner": {"reputation": 81, "user_id": 5622823, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7Yr9Z.jpg?s=128&g=1", "display_name": "MelvinLusk", "link": "https://stackoverflow.com/users/5622823/melvinlusk"}, "is_accepted": true, "score": 4, "last_activity_date": 1576694869, "creation_date": 1576694869, "answer_id": 59398375, "question_id": 59398146, "link": "https://stackoverflow.com/questions/59398146/connecting-to-sql-server-named-instance-using-gorm-erroring-out-with-invalid-cha/59398375#59398375", "title": "Connecting to sql server named instance using gorm erroring out with invalid character &quot;\\\\&quot; in host name", "body": "<p>If this is the Go MSSQL driver you're talking about, try using \" / \" for the named instance instead of a \" \\ \" backslash:</p>\n\n<p>\"sqlserver://trusted_connection=yes@localhost/MSSQLSERVER02:1443?database=operationsdb\"</p>\n\n<p><a href=\"https://github.com/denisenkom/go-mssqldb/blob/master/README.md\" rel=\"nofollow noreferrer\">https://github.com/denisenkom/go-mssqldb/blob/master/README.md</a></p>\n"}], "owner": {"reputation": 47, "user_id": 3066530, "user_type": "registered", "profile_image": "https://graph.facebook.com/1107153199/picture?type=large", "display_name": "Teja", "link": "https://stackoverflow.com/users/3066530/teja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 303, "favorite_count": 0, "closed_date": 1576733675, "accepted_answer_id": 59398375, "answer_count": 1, "score": 1, "last_activity_date": 1576695061, "creation_date": 1576693762, "last_edit_date": 1576695061, "question_id": 59398146, "link": "https://stackoverflow.com/questions/59398146/connecting-to-sql-server-named-instance-using-gorm-erroring-out-with-invalid-cha", "closed_reason": "Not suitable for this site", "title": "Connecting to sql server named instance using gorm erroring out with invalid character &quot;\\\\&quot; in host name", "body": "<p>I am trying to connect to a locally running sql server developer instance from golang using gorm library using the below connection string</p>\n\n<p>\"sqlserver://trusted_connection=yes@localhost\\MSSQLSERVER02:1443?database=operationsdb\"</p>\n\n<p>but getting the below error </p>\n\n<p>parse sqlserver://trusted_connection=yes@US71DX930J\\MSSQLSERVER02:1443?database=operationsdb: invalid character \"\\\" in host name</p>\n"}, {"tags": ["go", "function-pointers"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1576692010, "post_id": 59397705, "comment_id": 104984545, "body": "You can&#39;t. The only type that could hold both a <code>func() SomeObject</code> and a <code>func() SomeOtherObject</code> is <code>interface{}</code>. They are not assignable to <code>func() interface{}</code> because that is not their function signature."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1576692025, "post_id": 59397705, "comment_id": 104984549, "body": "The error message is pretty explicit and clear. <code>type func() SomeObject</code> and <code>type func() interface{}</code> are distinct, and therefore non-interchangeable. Either change your functions to return <code>interface{}</code>, or find another solution (another solution is probably best, since <code>interface{}</code> <a href=\"https://www.youtube.com/watch?v=PAAkCSZUG1c&amp;t=7m36s\" rel=\"nofollow noreferrer\">says nothing</a>)"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1576692053, "post_id": 59397705, "comment_id": 104984560, "body": "This smells a lot like an XY Problem. Can you explain your larger goal?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1576692083, "post_id": 59397705, "comment_id": 104984571, "body": "You also couldn&#39;t call them that way, so they&#39;d be pretty useless. I would completely rethink this approach from the ground up to avoid the whole idea of passing around functions of different types."}, {"owner": {"reputation": 1372, "user_id": 2956829, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/WW0RL.jpg?s=128&g=1", "display_name": "el n00b", "link": "https://stackoverflow.com/users/2956829/el-n00b"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1576692179, "post_id": 59397705, "comment_id": 104984618, "body": "@Flimzy I was trying to make some simplified calls to try and reduce boilerplate code that behaves similar to this but in a much larger context.  I&#39;ll edit the question and add some larger scope."}], "answers": [{"comments": [{"owner": {"reputation": 1372, "user_id": 2956829, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/WW0RL.jpg?s=128&g=1", "display_name": "el n00b", "link": "https://stackoverflow.com/users/2956829/el-n00b"}, "edited": false, "score": 0, "creation_date": 1576693495, "post_id": 59398036, "comment_id": 104985207, "body": "That&#39;s perfect.  I see what you did there - using the inline function to &quot;cast/resend&quot; the way it wants to be.  Unfortunately I do not have control over those return values due to a hesitancy on a larger refactoring on the part of the lead architect on this particular project."}, {"owner": {"reputation": 1372, "user_id": 2956829, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/WW0RL.jpg?s=128&g=1", "display_name": "el n00b", "link": "https://stackoverflow.com/users/2956829/el-n00b"}, "edited": false, "score": 0, "creation_date": 1576693575, "post_id": 59398036, "comment_id": 104985247, "body": "FYI - I also assumed I needed a type defined for that, but being able to use <code>func() interface{}</code> is much cleaner for my needs.  So I learned something else now, too."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1372, "user_id": 2956829, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/WW0RL.jpg?s=128&g=1", "display_name": "el n00b", "link": "https://stackoverflow.com/users/2956829/el-n00b"}, "edited": false, "score": 0, "creation_date": 1576694199, "post_id": 59398036, "comment_id": 104985516, "body": "Even that is probably over-complex. I&#39;ve provided a further simplification that I suspect will work just as well."}, {"owner": {"reputation": 1372, "user_id": 2956829, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/WW0RL.jpg?s=128&g=1", "display_name": "el n00b", "link": "https://stackoverflow.com/users/2956829/el-n00b"}, "edited": false, "score": 0, "creation_date": 1576695759, "post_id": 59398036, "comment_id": 104986177, "body": "I see. That will work for this, but I have another where I need to account for an error being returned as well where the more complex configuration makes sense. The smaller version is what I was <i>NOT</i> going to do, but it seems like it&#39;s really the better option."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": -1, "last_activity_date": 1576694885, "last_edit_date": 1576694885, "creation_date": 1576693304, "answer_id": 59398036, "question_id": 59397705, "link": "https://stackoverflow.com/questions/59397705/function-pointer-as-argument-with-return-interface/59398036#59398036", "title": "Function pointer as argument with &quot;return interface{}&quot;", "body": "<p>I don't know if you have control over the return values of <code>contra.Load()</code> and <code>policy.Load()</code>, for instance, so there may be a better approach, but assuming those cannot be modified, this would allow you to eliminate a lot of boilerplate, without any fancy manipulation:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func boilerplate(tram *TrapLapse, operation *TrapOperation, loader func() interface{}) {\n    loaded := loader()\n    err := trap.SnapBack(operation).send(loaded);\n\n    // default error handling\n    // logging\n    // boilerplate post-process\n}\n\nfunc resendContraDevice(trap *TrapLapse, operation *TrapOperation) {\n    boilerplate(trap, operation, func() interface{} { return contra.Load() })\n}\n\nfunc resendPolicyDevice(trap *TrapLapse, operation *TrapOperation) {\n    boilerplate(trap, operation, func() interface{} { return policy.Load() })\n}\n</code></pre>\n\n<p>If there's nothing more complex, you can also simplify this even further:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func boilerplate(tram *TrapLapse, operation *TrapOperation, loaded interface{}) {\n    err := trap.SnapBack(operation).send(loaded);\n\n    // default error handling\n    // logging\n    // boilerplate post-process\n}\n\nfunc resendContraDevice(trap *TrapLapse, operation *TrapOperation) {\n    boilerplate(trap, operation, contra.Load())\n}\n\nfunc resendPolicyDevice(trap *TrapLapse, operation *TrapOperation) {\n    boilerplate(trap, operation, policy.Load())\n}\n</code></pre>\n"}], "owner": {"reputation": 1372, "user_id": 2956829, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/WW0RL.jpg?s=128&g=1", "display_name": "el n00b", "link": "https://stackoverflow.com/users/2956829/el-n00b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 59398036, "answer_count": 1, "score": -2, "last_activity_date": 1576694885, "creation_date": 1576691837, "last_edit_date": 1592644375, "question_id": 59397705, "link": "https://stackoverflow.com/questions/59397705/function-pointer-as-argument-with-return-interface", "title": "Function pointer as argument with &quot;return interface{}&quot;", "body": "<p>I would like to pass a function pointer to a function to &quot;anything&quot;.</p>\n<p>It's easy to print something that gets passed in from just about anything (as in <a href=\"https://play.golang.org/p/gmOy6JWxGm0\" rel=\"nofollow noreferrer\">https://play.golang.org/p/gmOy6JWxGm0</a>):</p>\n<pre><code>func printStuff(stuff interface{}) {\n    fmt.Printf(&quot;Testing : %v&quot;, stuff)\n}\n</code></pre>\n<p>Let's say, though, that I want to do this:</p>\n<ol>\n<li>Have multiple structs</li>\n<li>Have data loaded from various functions</li>\n<li>Have a generic print that calls the function for me</li>\n</ol>\n<p>I tried this in a Play (<a href=\"https://play.golang.org/p/l3-OkL6tsMW\" rel=\"nofollow noreferrer\">https://play.golang.org/p/l3-OkL6tsMW</a>) and I get the following errors:</p>\n<blockquote>\n<p>./prog.go:35:12: cannot use getStuff1 (type func() SomeObject) as type FuncType in argument to printStuff</p>\n<p>./prog.go:36:12: cannot use getStuff2 (type func() SomeOtherObject) as type FuncType in argument to printStuff</p>\n</blockquote>\n<p>In case the Play stuff gets deleted, here's the code I'm trying to figure out how to get to work:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n)\n\ntype SomeObject struct {\n    Value string\n}\n\ntype SomeOtherObject struct {\n        Value string\n}\n\ntype FuncType func() interface{}\n\nfunc getStuff1() SomeObject {\n    return SomeObject{\n        Value: &quot;Hello, world!&quot;,\n    }\n}\n\nfunc getStuff2() SomeOtherObject {\n    return SomeOtherObject{\n        Value: &quot;Another, hello!&quot;,\n    }\n}\n\nfunc printStuff(toCall FuncType) {\n    stuff := toCall()\n    fmt.Printf(&quot;Testing : %v&quot;, stuff)\n}\n\nfunc main() {\n    printStuff(getStuff1)\n    printStuff(getStuff2)\n}\n</code></pre>\n<p>What is the secret sauce to get this stuff passed in properly?</p>\n<h2>Larger Goal Explanation</h2>\n<p>So what I am trying to accomplish here is reduction of boilerplate code that lives inside a gigantic file. Unfortunately I cannot refactor it further at this point due to other restrictions and I was wondering if this were possible at all considering the error messages and what I had read seemed to dictate otherwise.</p>\n<p>There's a large amount of copy-and-paste code that looks like this:</p>\n<pre><code>func resendContraDevice(trap *TrapLapse, operation *TrapOperation) {\n    loaded := contra.Load()\n    err := trap.SnapBack(operation).send(loaded);\n\n    // default error handling\n    // logging\n    // boilerplate post-process\n}\n\nfunc resendPolicyDevice(trap *TrapLapse, operation *TrapOperation) {\n    loaded := policy.Load()\n    err := trap.SnapBack(operation).send(loaded);\n\n    // default error handling\n    // logging\n    // boilerplate post-process\n}\n\n// etc.\n</code></pre>\n<p>In these, the <code>Load()</code> functions all return a different struct type and they are used elsewhere throughout the application.</p>\n<p>I want hoping to get something where I could have:</p>\n<pre><code>loaded := fn()\nerr := trap.SnapBack(operation).send(loaded);\n\n// default error handling\n// logging\n// boilerplate post-process\n</code></pre>\n<p>Signature for send is, which accepts an <code>interface{}</code> argument:</p>\n<pre><code>func (s SnapBack) send(data interface{}) error\n</code></pre>\n"}, {"tags": ["sql", "go", "clickhouse"], "answers": [{"comments": [{"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1576689336, "post_id": 59396903, "comment_id": 104983303, "body": "Thank you for your replay! I tried to test your code but it raises an error: <code>clickhouse: Code: 53, e.displayText() = DB::Exception: Type mismatch in IN or VALUES section. Expected: String. Got: Array (version 19.14.6.12 (official build))</code>. Also I notice that <code>$1</code>, <code>$2</code> and <code>$3</code> raise such error: <code>clickhouse: wrong placeholder count</code>. For thats why I change them to <code>?</code>. Do you have any ideas about that?"}, {"owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "reply_to_user": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1576690029, "post_id": 59396903, "comment_id": 104983644, "body": "@NurzhanNogerbek just updated my answer. btw can you please share the table scheme as well? wanted to ensure the columns&#39; data type are valid"}, {"owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "reply_to_user": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1576690110, "post_id": 59396903, "comment_id": 104983687, "body": "@NurzhanNogerbek regarding the <code>$n</code>, I checked on the source code, it is not valid placeholder syntax. the <code>?</code> is the one that used on the library"}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1576690520, "post_id": 59396903, "comment_id": 104983885, "body": "The data type of the <code>CITY</code> column is <code>String</code>. The data type of the <code>Gender</code> column is also <code>String</code>. The data type of the <code>HAS_FAMILY</code> column is <code>UInt8</code>."}, {"owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "reply_to_user": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1576690814, "post_id": 59396903, "comment_id": 104984009, "body": "@NurzhanNogerbek I though <code>Gender</code> and <code>HAS_FAMILY</code> was <code>Array</code>. if it is not an array then you need to join the values with separator <code>,</code>"}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1576691100, "post_id": 59396903, "comment_id": 104984163, "body": "You are right. In other words, I&#39;m trying to create such SQL query: <code>SELECT * FROM TABLE_NAME WHERE lower(CITY) = lower(&quot;London&quot;) AND GENDER IN (&quot;Female&quot;, &quot;Male&quot;) AND HAS_FAMILY IN (0, 1);</code>. Do you have any other ideas?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1576692059, "post_id": 59396903, "comment_id": 104984561, "body": "@NurzhanNogerbek instead of <code>IN ($2)</code> which takes a list of values, not an array, use <code>= ANY($2::text[])</code>. Or <code>IN</code> can be executed with a subquery, so <code>IN (SELECT unnest($2::text[]))</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1576692221, "post_id": 59396903, "comment_id": 104984637, "body": "@NurzhanNogerbek also it is &quot;reply&quot;, the word &quot;replay&quot; means something entirely different."}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1576692973, "post_id": 59396903, "comment_id": 104984979, "body": "@mkopriva sorry for the typo in the word. It was an accident. It seems like <code>ClickHouse</code> doesn&#39;t have <code>ANY</code> statement. Also <code>$n</code> is not valid placeholder syntax. Do you have any other ideas?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1576693721, "post_id": 59396903, "comment_id": 104985300, "body": "@NurzhanNogerbek then use <code>?</code>, I&#39;ve used <code>$2</code> only because that&#39;s what&#39;s in your question. If ClickHouse doesn&#39;t support <code>ANY&#47;SOME</code>, and it doesn&#39;t have an equivalent to <code>unnest</code> then you can simply build out the <code>(?, ?, ? ...)</code> string yourself, append it to the query, aggregate the individual slice elements and other parameters into a single <code>[]interface{}</code> and then pass that to the <code>Query</code> func with the three-dots suffix (e.g. <code>paramslice...</code>)."}], "tags": [], "owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "is_accepted": false, "score": 2, "last_activity_date": 1576689607, "last_edit_date": 1576689607, "creation_date": 1576688529, "answer_id": 59396903, "question_id": 59396789, "link": "https://stackoverflow.com/questions/59396789/how-to-set-arrays-as-parameters-of-the-sql-query/59396903#59396903", "title": "How to set arrays as parameters of the SQL query", "body": "<p>Try to wrap <code>requestBody.Gender</code> and <code>requestBody.HasFamily</code> with <code>clickhouse.Array()</code>. And also try to change the <code>$n</code> to <code>?</code>.</p>\n\n<p>Code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>rows, err := database.ClickHouse.Query(\n    \"SELECT * FROM TABLE_NAME WHERE lower(CITY) = lower(?) AND GENDER IN (?) AND HAS_FAMILY IN (?);\",\n    requestBody.City,\n    clickhouse.Array(requestBody.Gender),\n    clickhouse.Array(requestBody.HasFamily),\n)\n</code></pre>\n\n<p>More info: <a href=\"https://godoc.org/github.com/mailru/go-clickhouse#Array\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/mailru/go-clickhouse#Array</a></p>\n"}], "owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 592, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576691247, "creation_date": 1576688094, "last_edit_date": 1576691247, "question_id": 59396789, "link": "https://stackoverflow.com/questions/59396789/how-to-set-arrays-as-parameters-of-the-sql-query", "title": "How to set arrays as parameters of the SQL query", "body": "<p>Let's say some front end application send <code>POST</code> request with such body to the back end (Go) application:</p>\n\n<pre><code>{\n    \"city\": \"London\",\n    \"gender\": [\"Female\", \"Male\"],\n    \"has_family\": [0, 1]\n}\n</code></pre>\n\n<p>As you can see request body has two arrays. I am trying to set these arrays into the SQL query. In my case I make SQL query to the <code>ClickHouse</code> database. I use <a href=\"http://github.com/mailru/go-clickhouse\" rel=\"nofollow noreferrer\">go-clickhouse</a> package for this task.</p>\n\n<p>I tried such code but it raises an error:</p>\n\n<blockquote>\n  <p>sql: converting argument $2 type: unsupported type []string, a slice\n  of string</p>\n</blockquote>\n\n<p>Also, I tried to change the data type from <code>[]string</code> to <code>[]interface{}</code>. Unfortunately, in that case, it raises an error like:</p>\n\n<blockquote>\n  <p>sql: converting argument $2 type: unsupported type []interface {}, a\n  slice of interface</p>\n</blockquote>\n\n<p><strong>Code</strong>:</p>\n\n<pre><code>var Controller = func(responseWriter http.ResponseWriter, request *http.Request) {\n    type RequestBody struct {\n        City string `json:\"city\"`\n        Gender []string `json:\"gender\"`\n        HasFamily []int `json:\"has_family\"`\n    }\n\n    requestBody := RequestBody{}\n\n    decoder := json.NewDecoder(request.Body)\n\n    if err := decoder.Decode(&amp;requestBody); err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    rows, err := database.ClickHouse.Query(\"SELECT * FROM TABLE_NAME WHERE lower(CITY) = lower($1) AND GENDER IN ($2) AND HAS_FAMILY IN ($3);\", requestBody.City, requestBody.Gender, requestBody.HasFamily)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    // other code\n}\n</code></pre>\n"}, {"tags": ["go", "gofmt", "goimports"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576676863, "post_id": 59393309, "comment_id": 104976231, "body": "what does contains mean ? Declaration or Usage ?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1576677042, "post_id": 59393309, "comment_id": 104976321, "body": "Take a look at <a href=\"https://github.com/golang/tools/tree/master/cmd/goimports\" rel=\"nofollow noreferrer\">github.com/golang/tools/tree/master/cmd/goimports</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1576679244, "post_id": 59393309, "comment_id": 104977521, "body": "&quot;io.Reader&quot; can correspond to any path that ends with &quot;/io&quot;."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1576679690, "post_id": 59393309, "comment_id": 104977790, "body": "Use output of <code>go list -f &#39;{{.Name}} {{.ImportPath}}&#39; all</code> to build <code>map[string][]string</code> where key is package name and value is slice of import paths. Split input string on &quot;.&quot; to get package name and type name.  For each import path with package name, use <code>go&#47;build</code> to find files in package, parse with <code>go&#47;parser</code>, walk AST and find type."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576679749, "post_id": 59393309, "comment_id": 104977826, "body": "see also <a href=\"https://godoc.org/golang.org/x/tools/go/loader\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/tools/go/loader</a>"}, {"owner": {"reputation": 2273, "user_id": 171711, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/800bb2756b17bfeb6f6f4f2d91f5f673?s=128&d=identicon&r=PG", "display_name": "Coyote", "link": "https://stackoverflow.com/users/171711/coyote"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576682757, "post_id": 59393309, "comment_id": 104979609, "body": "I added more precision, @mh-cbon I am looking for all the declarations"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1577098716, "post_id": 59393309, "comment_id": 105089774, "body": "@Coyote the answer i gave you does not satisfy your need ? I don&#39;t get it.."}], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1576677538, "post_id": 59393565, "comment_id": 104976591, "body": "<code>reflect</code> package works at runtime. I believe OP wants <code>static</code> analysis, thus <code>ast</code> and other things described under the <a href=\"https://golang.org/pkg/go/\" rel=\"nofollow noreferrer\">go package</a>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576678852, "post_id": 59393565, "comment_id": 104977289, "body": "@mh-cbon do they? The question is unclear, the example code looks like they&#39;re trying to do it at runtime."}, {"owner": {"reputation": 2273, "user_id": 171711, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/800bb2756b17bfeb6f6f4f2d91f5f673?s=128&d=identicon&r=PG", "display_name": "Coyote", "link": "https://stackoverflow.com/users/171711/coyote"}, "edited": false, "score": 0, "creation_date": 1576683142, "post_id": 59393565, "comment_id": 104979837, "body": "I am unfortunately looking for static analysis of existing packages on the user&#39;s machine. I improved the question. Thank you."}], "tags": [], "owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "is_accepted": false, "score": 1, "last_activity_date": 1576677350, "creation_date": 1576677350, "answer_id": 59393565, "question_id": 59393309, "link": "https://stackoverflow.com/questions/59393309/how-to-programmatically-retrieve-the-package-path-where-a-given-type-is-declared/59393565#59393565", "title": "How to programmatically retrieve the package path where a given type is declared?", "body": "<p>You can use <code>reflect.TypeOf(any).PkgPath()</code> to get the package path of certain type. However we need to pass an object with desired type (not string like you wanted).</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"reflect\"\n    \"gopkg.in/mgo.v2/bson\"\n)\n\nfunc main() {\n    var a bytes.Buffer\n    fmt.Println(FindPackagesForType(a)) // output: bytes\n\n    var b bson.M\n    fmt.Println(FindPackagesForType(b)) // output: gopkg.in/mgo.v2/bson\n}\n\nfunc FindPackagesForType(any interface{}) string {\n    return reflect.TypeOf(any).PkgPath()\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2273, "user_id": 171711, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/800bb2756b17bfeb6f6f4f2d91f5f673?s=128&d=identicon&r=PG", "display_name": "Coyote", "link": "https://stackoverflow.com/users/171711/coyote"}, "edited": false, "score": 0, "creation_date": 1578662231, "post_id": 59399585, "comment_id": 105521797, "body": "This answer doesn&#39;t work as it requires the package to be provided. The question is how to retrieve the packages which could match a given type."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 2273, "user_id": 171711, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/800bb2756b17bfeb6f6f4f2d91f5f673?s=128&d=identicon&r=PG", "display_name": "Coyote", "link": "https://stackoverflow.com/users/171711/coyote"}, "edited": false, "score": 0, "creation_date": 1578663477, "post_id": 59399585, "comment_id": 105522456, "body": "does not make sense <code>...as it requires the package to be provided</code>."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 2273, "user_id": 171711, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/800bb2756b17bfeb6f6f4f2d91f5f673?s=128&d=identicon&r=PG", "display_name": "Coyote", "link": "https://stackoverflow.com/users/171711/coyote"}, "edited": false, "score": 0, "creation_date": 1578851344, "post_id": 59399585, "comment_id": 105565416, "body": "@Coyote this means you got to download and test for all and every packages available online. unrealistic."}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 0, "last_activity_date": 1576701088, "creation_date": 1576701088, "answer_id": 59399585, "question_id": 59393309, "link": "https://stackoverflow.com/questions/59393309/how-to-programmatically-retrieve-the-package-path-where-a-given-type-is-declared/59399585#59399585", "title": "How to programmatically retrieve the package path where a given type is declared?", "body": "<p>below program lists <code>uses</code> and <code>definitions</code> of a given query <code>type</code> and given go package.</p>\n\n<p>It is simple and straightforward to programmatically load a go program using the <a href=\"https://godoc.org/golang.org/x/tools/go/loader\" rel=\"nofollow noreferrer\">program loader package</a></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"strings\"\n\n    \"golang.org/x/tools/go/loader\"\n)\n\nfunc main() {\n\n    var query string\n    var uses bool\n    var defs bool\n    flag.StringVar(&amp;query, \"query\", \"\", \"the fully qualified type path\")\n    flag.BoolVar(&amp;uses, \"uses\", true, \"capture uses\")\n    flag.BoolVar(&amp;defs, \"definitions\", true, \"capture definitions\")\n    flag.Parse()\n\n    if query == \"\" {\n        panic(\"query must not be empty\")\n    }\n\n    var queryPkg string\n    queryType := query\n    if i := strings.LastIndex(query, \".\"); i &gt; -1 {\n        queryPkg = query[:i]\n        queryType = query[i+1:]\n    }\n\n    var conf loader.Config\n    _, err := conf.FromArgs(flag.Args(), false)\n    if err != nil {\n        panic(err)\n    }\n    prog, err := conf.Load()\n    if err != nil {\n        panic(err)\n    }\n\n    for pkgType, pkgInfo := range prog.AllPackages {\n        if queryPkg != \"\" {\n            if !strings.HasPrefix(pkgType.Path(), queryPkg) {\n                continue\n            }\n        }\n        if defs {\n            for typeInfo, ident := range pkgInfo.Defs {\n                if !strings.HasPrefix(typeInfo.Name, queryType) {\n                    continue\n                }\n                f := prog.Fset.File(ident.Pos())\n                fpos := f.Position(ident.Pos())\n                fmt.Printf(\"def: %v %v.%v\\n\", fpos, pkgType.Path(), typeInfo.Name)\n            }\n        }\n\n        if uses {\n            for ident, oInfo := range pkgInfo.Uses {\n                if !strings.Contains(oInfo.Type().String(), queryType) {\n                    continue\n                }\n                f := prog.Fset.File(ident.Pos())\n                fpos := f.Position(ident.Pos())\n                fmt.Printf(\"use: %v %v\\n\", fpos, oInfo.Type().String())\n            }\n        }\n        // -\n    }\n}\n</code></pre>\n\n<p>then you run it like this</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ go run main.go -query=\"io.Reader\" io\ndef: /home/mh-cbon/.gvm/gos/go1.12.7/src/io/io.go:170:6 io.ReaderFrom\ndef: /home/mh-cbon/.gvm/gos/go1.12.7/src/io/io.go:77:6 io.Reader\ndef: /home/mh-cbon/.gvm/gos/go1.12.7/src/io/io.go:211:6 io.ReaderAt\nuse: /home/mh-cbon/.gvm/gos/go1.12.7/src/io/multi.go:20:13 []io.Reader\nuse: /home/mh-cbon/.gvm/gos/go1.12.7/src/io/multi.go:21:16 *io.multiReader\n# a ton of output...\n[mh-cbon@Host-001 ploader] $ go run main.go -query=\"Config\" io\n[mh-cbon@Host-001 ploader] $ go run main.go -query=\"io.Reader\" -uses=false io\ndef: /home/mh-cbon/.gvm/gos/go1.12.7/src/io/io.go:170:6 io.ReaderFrom\ndef: /home/mh-cbon/.gvm/gos/go1.12.7/src/io/io.go:211:6 io.ReaderAt\ndef: /home/mh-cbon/.gvm/gos/go1.12.7/src/io/io.go:77:6 io.Reader\n</code></pre>\n\n<p>you probably got to improve the matcher engine to make it moresuitable.</p>\n"}], "owner": {"reputation": 2273, "user_id": 171711, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/800bb2756b17bfeb6f6f4f2d91f5f673?s=128&d=identicon&r=PG", "display_name": "Coyote", "link": "https://stackoverflow.com/users/171711/coyote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 337, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1578662195, "creation_date": 1576676476, "last_edit_date": 1578662195, "question_id": 59393309, "link": "https://stackoverflow.com/questions/59393309/how-to-programmatically-retrieve-the-package-path-where-a-given-type-is-declared", "title": "How to programmatically retrieve the package path where a given type is declared?", "body": "<p>I am looking for a way to retrieve the package(s) installed locally which contain the declaration for a given type and the default package name.</p>\n\n<p>ie:</p>\n\n<pre><code>// FindPackagesForType returns the list of possible packages for a given type\nfunc FindPackagesForType(typeName string) []string {\n    return []string {} // TODO: implement\n}\n\nfunc TestFindPackagesForType(t *testing.T) {\n    assert.Contains(t, FindPackagesForType(\"io.Reader\"), \"io\")\n    assert.Contains(\n        t,\n        FindPackagesForType(\"types.Timestamp\"),\n        \"github.com/gogo/protobuf/types\",\n    )\n    assert.Contains(\n        t,\n        FindPackagesForType(\"types.ContainerCreateConfig\"),\n        \"github.com/docker/docker/api/types\",\n    )\n}\n</code></pre>\n\n<p>I could try to retrieve all packages installed, and go through the AST in each looking for the declaration but if there is a solution which could do this more efficiently while also providing support for go modules I would like to use that.</p>\n\n<p>The reason for this is to improve a code generation tool. The idea is to let the user provide the name of a type and let the tool identify the most likely candidate the same way goimports adds missing imports.</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc", "proto3", "protobuf-go"], "comments": [{"owner": {"reputation": 943, "user_id": 1842487, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86836d20ba778a0f43441487d6de5fcd?s=128&d=identicon&r=PG", "display_name": "Saurav Kumar Singh", "link": "https://stackoverflow.com/users/1842487/saurav-kumar-singh"}, "edited": false, "score": 0, "creation_date": 1576762380, "post_id": 59392630, "comment_id": 105008618, "body": "Not possible as of now. Your second way of doing is the current hack for now. I too came across same issue when I used it for the first time and finally used the second approach."}], "owner": {"reputation": 843, "user_id": 1816774, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/6bee690bd3d6a8f900f7a8667f3211ce?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/1816774/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 352, "favorite_count": 0, "closed_date": 1576674875, "answer_count": 0, "score": 2, "last_activity_date": 1576673921, "creation_date": 1576673921, "question_id": 59392630, "link": "https://stackoverflow.com/questions/59392630/how-to-generate-a-map-of-string-slices-from-protobuf-file", "closed_reason": "Duplicate", "title": "How to generate a map of string slices from protobuf file?", "body": "<p>As the protocol-buffers <a href=\"https://developers.google.com/protocol-buffers/docs/reference/go-generated#map\" rel=\"nofollow noreferrer\">documentation</a> describes:</p>\n\n<blockquote>\n  <p>Each map field generates a field in the struct of type\n  <code>map[TKey]TValue</code> where <code>TKey</code> is the field's key type and <code>TValue</code> is\n  the field's value type...</p>\n</blockquote>\n\n<p>I would like to set <code>TValue</code> to be a slice of string. So that in Go it generates:</p>\n\n<pre><code>map[string][]string\n</code></pre>\n\n<p>Considering also this note on <a href=\"https://developers.google.com/protocol-buffers/docs/reference/go-generated#repeated\" rel=\"nofollow noreferrer\">repeated fields</a>:</p>\n\n<blockquote>\n  <p>Likewise, for the field definition <code>repeated bytes foo = 1;</code> the\n  compiler will generate a Go struct with a <code>[][]byte</code> field named <code>Foo</code></p>\n</blockquote>\n\n<p>I'm trying to do the following:</p>\n\n<pre><code>message CallBackUrl {\n    string base_url = 1;\n    map&lt;string, repeated string&gt; params = 2;\n}\n</code></pre>\n\n<p>But this just spits an error:</p>\n\n<pre><code>pb/authenticator.proto:57:26: Expected \"&gt;\"\n</code></pre>\n\n<p>I could do this:</p>\n\n<pre><code>message StringSlice {\n    repeated string slice = 1;\n}\n\nmessage CallBackUrl {\n    map&lt;string, StringSlice&gt; params = 1;\n}\n</code></pre>\n\n<p>Outputs:</p>\n\n<pre><code>type StringSlice struct {\n    Slice []string\n}\n\ntype CallBackUrl struct {\n     Params               map[string]*StringSlice\n}\n</code></pre>\n\n<p>However, in the implementation <code>Params</code> will need to be used as an <a href=\"https://golang.org/pkg/net/url/#Values\" rel=\"nofollow noreferrer\"><code>url.Values</code></a> to build a query string. This last solution would required an additional iteration, and copying the data into a new <code>map[string][]string</code>, which I would like to avoid.</p>\n\n<p><strong>(How) can I make protocol-buffers generate a (Go) map of string slices?</strong> I'm using the gRPC plugin.</p>\n"}, {"tags": ["go", "compiler-optimization"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1576676682, "post_id": 59392606, "comment_id": 104976133, "body": "There are several compilers and each changes constantly."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1576678961, "post_id": 59392606, "comment_id": 104977351, "body": "Write code that does  what it needs to do and makes sense when you read it. Benchmark it to see if performance is acceptable. If it isn&#39;t, profile it to see where the slowdown is. Optimize that. These kinds of micro-optimizations with no cause to think they have any meaningful impact on real-world performance are completely pointless."}], "answers": [{"comments": [{"owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "edited": false, "score": 0, "creation_date": 1576674491, "post_id": 59392672, "comment_id": 104975029, "body": "oh awesome! thanks. Was using go <code>1.13.5</code> I added an edit to show the complete code. Basically we are iterating until the condition is met, at which point we just break the loop."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1576674577, "last_edit_date": 1576674577, "creation_date": 1576674078, "answer_id": 59392672, "question_id": 59392606, "link": "https://stackoverflow.com/questions/59392606/does-the-compiler-optimize-a-variable-declaration/59392672#59392672", "title": "Does the compiler optimize a variable declaration?", "body": "<p>Whether it's optimized might depend on other code you didn't show, and also on compiler version / target architecture. Although I doubt when concurrency  and other function calls are involved, the performance bottleneck will be an <code>int</code> => <code>int64</code> conversion. Most likely you won't see any difference if you get rid of that conversion.</p>\n\n<p>Also note that if the architecture you use is 64-bit, the size (and memory representation and interpretation) of <code>int</code> and <code>int64</code> is the same, which means the conversion does not incur any cost, it just changes the type (how it's interpreted).</p>\n\n<p><strong>Edit:</strong> Since you're using sleep anyway, getting rid of the conversion would be pointless. Use whichever makes your code more readable.</p>\n"}, {"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576703120, "post_id": 59393662, "comment_id": 104989007, "body": "this answer keeps an air of mystery."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1576678131, "last_edit_date": 1576678131, "creation_date": 1576677608, "answer_id": 59393662, "question_id": 59392606, "link": "https://stackoverflow.com/questions/59392606/does-the-compiler-optimize-a-variable-declaration/59393662#59393662", "title": "Does the compiler optimize a variable declaration?", "body": "<p>The Go amd64 assembler:</p>\n\n<pre><code>0000000000457bb0 &lt;main.Equality&gt;:\n  457bb0:   48 8b 44 24 08          mov    0x8(%rsp),%rax\n  457bb5:   48 8b 4c 24 10          mov    0x10(%rsp),%rcx\n  457bba:   48 39 c8                cmp    %rcx,%rax\n  457bbd:   0f 94 44 24 18          sete   0x18(%rsp)\n  457bc2:   c3                      retq\n</code></pre>\n\n<p>As expected, it's fast.</p>\n\n<p>The compiler knows that, for amd64, <code>int</code> is the same as <code>int64</code>. No conversion is necessary.</p>\n\n<p>Reference:</p>\n\n<p><a href=\"https://software.intel.com/en-us/articles/intel-sdm\" rel=\"nofollow noreferrer\">Intel\u00ae 64 and IA-32 Architectures Software Developer Manuals</a></p>\n\n<hr>\n\n<p><code>opt.go</code>:</p>\n\n<pre><code>package main\n\n//go:noinline\nfunc Equality(a int64, b int) bool {\n    return a == int64(b)\n}\n\nfunc main() {\n    var a, b = int64(42), int(39)\n    println(Equality(a, b))\n}\n</code></pre>\n\n<p>Dump:</p>\n\n<pre><code>$ go build opt.go\n$ objdump -d opt &gt; opt.dump\n</code></pre>\n"}], "owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 1, "accepted_answer_id": 59392672, "answer_count": 2, "score": 2, "last_activity_date": 1576678131, "creation_date": 1576673874, "last_edit_date": 1576674484, "question_id": 59392606, "link": "https://stackoverflow.com/questions/59392606/does-the-compiler-optimize-a-variable-declaration", "title": "Does the compiler optimize a variable declaration?", "body": "<p>Given an iteration:</p>\n\n<pre><code> LOOP:\n for {       \n       select {\n       case &lt;-timeout:\n         t.Fatal(\"Timed out\")\n       default:\n         if Count() == int64(num) {\n            break LOOP\n         }\n         time.Sleep(5 * time.Millisecond)\n       }\n    }\n</code></pre>\n\n<p><code>Count()</code> returns an <code>int64</code>, so I need a conversion, and <code>Count</code> changes, so we are checking here until <code>Count()</code> returns an expected value - possibly thousands of iterations.</p>\n\n<p>Does the compiler optimize this conversion? \nOr is it better to convert <code>num</code>, which is used before in other places as <code>int</code> and not <code>int64</code>, beforehand before starting the loop?</p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576672247, "post_id": 59391974, "comment_id": 104973856, "body": "please show more of the output and provide a reproducible example."}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 1, "creation_date": 1576672572, "post_id": 59391974, "comment_id": 104974024, "body": "See: <a href=\"https://stackoverflow.com/a/58679714/8208215\">How go keyword works in Go</a>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1576673003, "creation_date": 1576673003, "answer_id": 59392332, "question_id": 59391974, "link": "https://stackoverflow.com/questions/59391974/goroutine-concept-direct-call-vs-call-using-function-literal/59392332#59392332", "title": "Goroutine concept: direct call vs call using function literal", "body": "<p><a href=\"https://golang.org/ref/spec#Go_statements\" rel=\"noreferrer\">Spec: Go statements:</a></p>\n\n<blockquote>\n  <p><strong>The function value and parameters are <a href=\"https://golang.org/ref/spec#Calls\" rel=\"noreferrer\">evaluated as usual</a> in the calling goroutine</strong>, but unlike with a regular call, program execution does not wait for the invoked function to complete. Instead, the function begins executing independently in a new goroutine.</p>\n</blockquote>\n\n<p>In your first example you launch an anonymous function (a function literal) with no parameters as a new goroutine. <code>Must()</code> and <code>demo_process1()</code> are called inside that, <em>concurrently</em> with <code>demo_process2()</code> (which is executed in the \"original\" goroutine).</p>\n\n<p>In your second example however:</p>\n\n<pre><code>go Must(demo_process1())\ndemo_process2()\n</code></pre>\n\n<p>The function launched as a goroutine is <code>Must()</code>, and its parameters are evaluated <strong>in the calling goroutine</strong>. Parameter of <code>Must()</code> is the return value of <code>demo_process1()</code>, which means <code>demo_process1()</code> is called and waited for first before a new goroutine is launched. Only when it returns may the new goroutine be started and <code>demo_process2()</code> be called (on the \"original\" goroutine).</p>\n\n<p>All in all, in the second example <code>demo_process1()</code> and <code>demo_process2()</code> are not running concurrently but sequentially, in the same goroutine. Only the <code>Must()</code> is executed on a new goroutine (concurrently with <code>demo_process2()</code>).</p>\n"}], "owner": {"reputation": 6258, "user_id": 11032044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bz8vL.jpg?s=128&g=1", "display_name": "Kamol Hasan", "link": "https://stackoverflow.com/users/11032044/kamol-hasan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 59392332, "answer_count": 1, "score": -3, "last_activity_date": 1585137504, "creation_date": 1576671807, "last_edit_date": 1585137504, "question_id": 59391974, "link": "https://stackoverflow.com/questions/59391974/goroutine-concept-direct-call-vs-call-using-function-literal", "title": "Goroutine concept: direct call vs call using function literal", "body": "<p>What are the basic differences between below two codes? Somehow, in the second example <code>demo_process2()</code> is never called but it works fine in the first example.</p>\n\n<ol>\n1. \n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>go func() {\n    Must(demo_process1())\n}()\n\ndemo_process2()\n</code></pre>\n\n<ol start=\"2\">\n2. \n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>go Must(demo_process1())\ndemo_process2()\n</code></pre>\n\n<p>where <code>Must()</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func Must(err error) {\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "ibm-mq", "amqp"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576668788, "post_id": 59390981, "comment_id": 104972149, "body": "you should try to enable the debug mode see <a href=\"https://github.com/vcabbage/amqp/blob/master/log_debug.go\" rel=\"nofollow noreferrer\">github.com/vcabbage/amqp/blob/master/log_debug.go</a> try <code>go run -tags debug main.go</code>"}, {"owner": {"reputation": 1616, "user_id": 2206606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e6fa9197fc6a0f1e2d1af06467def94?s=128&d=identicon&r=PG", "display_name": "Bruce Nielsen", "link": "https://stackoverflow.com/users/2206606/bruce-nielsen"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576671017, "post_id": 59390981, "comment_id": 104973246, "body": "No additional information is logged with debug mode (it looks like the library doesn&#39;t do debug logging until a session is created)."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576672160, "post_id": 59390981, "comment_id": 104973799, "body": "maybe it worth digging more and try to figure out where that EOF is coming from. Before resorting to wireshark or else, can you print the error with the <code>%+v</code> verb ? As documented at the end of <a href=\"https://github.com/vcabbage/amqp\" rel=\"nofollow noreferrer\">github.com/vcabbage/amqp</a>, it is using <a href=\"https://github.com/pkg/errors\" rel=\"nofollow noreferrer\">github.com/pkg/errors</a> which might report about stacktrace errors."}], "answers": [{"tags": [], "owner": {"reputation": 1616, "user_id": 2206606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e6fa9197fc6a0f1e2d1af06467def94?s=128&d=identicon&r=PG", "display_name": "Bruce Nielsen", "link": "https://stackoverflow.com/users/2206606/bruce-nielsen"}, "is_accepted": true, "score": 0, "last_activity_date": 1576784274, "last_edit_date": 1576784274, "creation_date": 1576672456, "answer_id": 59392165, "question_id": 59390981, "link": "https://stackoverflow.com/questions/59390981/eof-when-connecting-to-ibm-mq-with-amqp-1-0-from-golang/59392165#59392165", "title": "EOF when connecting to IBM MQ with AMQP 1.0 from golang", "body": "<p>So the solution is apparently to use SASL Anonymous mode; this allows the client to connect.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"pack.ag/amqp\"\n)\n\nfunc main() {\n    _, err := amqp.Dial(\"amqp://windows-10:5672\", amqp.ConnSASLAnonymous())\n    fmt.Println(err) // nil\n}\n</code></pre>\n\n<p>If anybody wants to try to make it work in \"normal\" mode, it appears that IBM MQ was closing the channel as soon as the initial header packet was sent. The EOF was bubbling up from the receiving goroutine in any case.</p>\n"}], "owner": {"reputation": 1616, "user_id": 2206606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e6fa9197fc6a0f1e2d1af06467def94?s=128&d=identicon&r=PG", "display_name": "Bruce Nielsen", "link": "https://stackoverflow.com/users/2206606/bruce-nielsen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 59392165, "answer_count": 1, "score": 0, "last_activity_date": 1576784274, "creation_date": 1576668232, "question_id": 59390981, "link": "https://stackoverflow.com/questions/59390981/eof-when-connecting-to-ibm-mq-with-amqp-1-0-from-golang", "title": "EOF when connecting to IBM MQ with AMQP 1.0 from golang", "body": "<p>I've installed IBM MQ (8.0.0.4) on a local Windows VM and followed the instructions in the docs to enable AMQP (<a href=\"https://www.ibm.com/support/knowledgecenter/en/SSFKSJ_8.0.0/com.ibm.mq.con.doc/tamqp_creating.htm\" rel=\"nofollow noreferrer\">https://www.ibm.com/support/knowledgecenter/en/SSFKSJ_8.0.0/com.ibm.mq.con.doc/tamqp_creating.htm</a>), and also disabled authentication since this is just a local development environment. With that done, I am able to connect from my host OS using the node.js sample in IBM's mqlight package:</p>\n\n<pre><code>&gt;npm install mqlight\n...\n&gt;node node_modules/mqlight/samples/recv.js -s amqp://windows-10:5672\nConnected to amqp://windows-10:5672 using client-id recv_126117c\nSubscribed to pattern: public\n</code></pre>\n\n<p>However, when attempting to connect from a golang app using vcabbage/amqp (version 0.12.5), it returns an EOF error on the attempt to dial the host. Minimal example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"pack.ag/amqp\"\n)\n\nfunc main() {\n    _, err := amqp.Dial(\"amqp://windows-10:5672\")\n    fmt.Println(err) // EOF\n}\n</code></pre>\n\n<p>Nothing is appearing in the IBM MQ error logs.</p>\n\n<p>Unfortunately Google does not turn up any relevant results for connecting to IBM MQ via AMQP 1.0 in golang, so I'm stuck. Does anyone have any ideas?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 57, "user_id": 12557094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f17f9d19695be36e4c0c5ac07be4d1c?s=128&d=identicon&r=PG&f=1", "display_name": "goofinator", "link": "https://stackoverflow.com/users/12557094/goofinator"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1576661779, "post_id": 59388478, "comment_id": 104968631, "body": "So, you think, it&#39;s just an error in documentation?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1576662162, "post_id": 59388478, "comment_id": 104968818, "body": "It&#39;s just a very poorly conceived example."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1576662614, "post_id": 59388478, "comment_id": 104969042, "body": "@Flimzy aren&#39;t they completely separate though? <code>c</code> is returned by <code>f</code> whose implementation we don&#39;t have and which could be doing pretty much anything <i>after</i> <code>http.DefaultClient.Do(req)</code> returned, successfully or not. <code>ctx</code> signals the result of <code>http.DefaultClient.Do(req)</code> while <code>c</code> signals the result of <code>f(...)</code>. <code>f</code> could fail while <code>Do</code> could pass just fine, no?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1576662759, "post_id": 59388478, "comment_id": 104969114, "body": "@mkopriva: I guess you&#39;re right. <code>f</code> could be doing something interesting."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1576664158, "post_id": 59388478, "comment_id": 104969792, "body": "I think the writer was a bit lazy in the end, a few lines up he says ` It accepts a Context parameter ctx and returns immediately if ctx.Done is closed while the request is in flight.` =&gt; <b>returns immediately if ctx.Done is closed</b>. But in the final block of code you presented, that happens ONLY because we know that client.Do will return immediately, it is not hold strongly, pass it a dummy function that does not listen its context and the scheme falls. unclear."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1576664160, "post_id": 59388478, "comment_id": 104969795, "body": "@Flimzy although I do see now that in the article the closure that&#39;s passed in as <code>f</code> returns immediately if <code>Do</code> returns an error, which makes my previous comment less relevant. However what about the case where the context is cancelled, by the caller of the <code>Search</code> function, <i>after</i> <code>Do</code> successfully returned, if we don&#39;t listen to <code>ctx.Done</code> and <code>f</code> does it&#39;s job without error we would hit the <code>case err := &lt;-c:</code> and <code>httpDo</code> would return <code>nil</code> instead of the <code>ctx.Err()</code> that would tell us why the <i>caller</i> cancelled the context."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1576664712, "post_id": 59388478, "comment_id": 104970121, "body": "@mkopriva: A good <code>f()</code> implementation would handle <code>ctx.Done()</code> even after <code>Do</code> returns, of course... but that&#39;s a bit of a tangent, and you have an otherwise valid point.  All in all: Bad example, IMO."}, {"owner": {"reputation": 57, "user_id": 12557094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f17f9d19695be36e4c0c5ac07be4d1c?s=128&d=identicon&r=PG&f=1", "display_name": "goofinator", "link": "https://stackoverflow.com/users/12557094/goofinator"}, "edited": false, "score": 0, "creation_date": 1576665359, "post_id": 59388478, "comment_id": 104970486, "body": "Yes, if f() will process ctx - all clear. But in current implementation, which is WithTimeout() illustration, it&#39;s unclear. The timeout is not a timeout."}, {"owner": {"reputation": 57, "user_id": 12557094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f17f9d19695be36e4c0c5ac07be4d1c?s=128&d=identicon&r=PG&f=1", "display_name": "goofinator", "link": "https://stackoverflow.com/users/12557094/goofinator"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1576676566, "post_id": 59388478, "comment_id": 104976075, "body": "@mkopriva I found it. It&#39;s handle it in the line  req = req.WithContext(ctx)"}], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576661910, "post_id": 59389133, "comment_id": 104968698, "body": "yeah, could be the correct explanation. But the example is confusing as client.Do will, i believe, return context cancelled error."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576663087, "post_id": 59389133, "comment_id": 104969253, "body": "@mh-cbon: Yes, exactly. It will. See <a href=\"https://play.golang.org/p/NYqHNzylxoF\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 57, "user_id": 12557094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f17f9d19695be36e4c0c5ac07be4d1c?s=128&d=identicon&r=PG&f=1", "display_name": "goofinator", "link": "https://stackoverflow.com/users/12557094/goofinator"}, "edited": false, "score": 0, "creation_date": 1576663670, "post_id": 59389133, "comment_id": 104969524, "body": "In that sense, yes. But if we consider this in terms of runtime? It turns out that the procedure will finish when it finishes and not earlier, what would timeouts not require? In addition, you can return ctx.Err () without waiting for &lt;-c"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1576663693, "post_id": 59389133, "comment_id": 104969540, "body": "@Flimzy thanks, added some more for new comers <a href=\"https://play.golang.org/p/KuNA_6GZ3z5\" rel=\"nofollow noreferrer\">play.golang.org/p/KuNA_6GZ3z5</a>"}], "tags": [], "owner": {"reputation": 447, "user_id": 9466501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/132d2cd9be94fd6b7280a98845b91f8f?s=128&d=identicon&r=PG", "display_name": "Lars Christian Jensen", "link": "https://stackoverflow.com/users/9466501/lars-christian-jensen"}, "is_accepted": false, "score": 1, "last_activity_date": 1576661833, "creation_date": 1576661833, "answer_id": 59389133, "question_id": 59388478, "link": "https://stackoverflow.com/questions/59388478/wait-of-function-result-after-context-cancellation/59389133#59389133", "title": "Wait of function result after context cancellation", "body": "<p>It is not equivalent to awaiting <code>&lt;-c</code> only. The example returns a different value (<code>ctx.Err()</code>) when the context is closed.</p>\n"}, {"comments": [{"owner": {"reputation": 57, "user_id": 12557094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f17f9d19695be36e4c0c5ac07be4d1c?s=128&d=identicon&r=PG&f=1", "display_name": "goofinator", "link": "https://stackoverflow.com/users/12557094/goofinator"}, "edited": false, "score": 0, "creation_date": 1576664362, "post_id": 59389712, "comment_id": 104969914, "body": "Ok, but what if &lt;-ctx.Done () is generated by a timeout or deadline, and f ends in a long time?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 57, "user_id": 12557094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f17f9d19695be36e4c0c5ac07be4d1c?s=128&d=identicon&r=PG&f=1", "display_name": "goofinator", "link": "https://stackoverflow.com/users/12557094/goofinator"}, "edited": false, "score": 0, "creation_date": 1576664455, "post_id": 59389712, "comment_id": 104969954, "body": "@goofinator with current code, client.Do will return asap. in some theoretical examples you might think about, this will hold the execution until a value can be popped out of c."}, {"owner": {"reputation": 57, "user_id": 12557094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f17f9d19695be36e4c0c5ac07be4d1c?s=128&d=identicon&r=PG&f=1", "display_name": "goofinator", "link": "https://stackoverflow.com/users/12557094/goofinator"}, "edited": false, "score": 0, "creation_date": 1576667570, "post_id": 59389712, "comment_id": 104971561, "body": "yes. That&#39;s what i mean. I think, that in example of WithTimeout usage, the f() should handle ctx too, so awaiting of it&#39;s result make sense. It is not necessary in current code, but makes example unclear. IMHO"}, {"owner": {"reputation": 57, "user_id": 12557094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f17f9d19695be36e4c0c5ac07be4d1c?s=128&d=identicon&r=PG&f=1", "display_name": "goofinator", "link": "https://stackoverflow.com/users/12557094/goofinator"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576676383, "post_id": 59389712, "comment_id": 104975972, "body": "@mh-cbon I get it. This is not obvious, but f () is called in the context of ctx. This is because the f function itself is fast, but it waits http.DefaultClient.Do () to complete, which is called using req, which was previously modified using req = req.WithContext (ctx). Thus, a long call can process Done () internally and immediately write something to channel &quot;c&quot;. So, the client\u2019s expectations regarding the timeout are fulfilled."}], "tags": [], "owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "is_accepted": false, "score": 3, "last_activity_date": 1576663920, "creation_date": 1576663920, "answer_id": 59389712, "question_id": 59388478, "link": "https://stackoverflow.com/questions/59388478/wait-of-function-result-after-context-cancellation/59389712#59389712", "title": "Wait of function result after context cancellation", "body": "<p>The context may cancel the <code>Do</code> call. The <code>case &lt;-ctx.Done()</code> unambiguously identify that this happened. </p>\n\n<p>Indeed, we may assume that the <code>Do</code> call would then return a <code>nil</code> <code>http.Response</code>, and that the function <code>f</code> would then return an error when this happens. But we wouldn\u2019t know why <code>f</code> received a <code>nil</code> <code>http.Response</code> as input argument.</p>\n\n<p>The instruction <code>case err := &lt;-c:</code> handles the case when the error is produced inside <code>f</code>. </p>\n"}], "owner": {"reputation": 57, "user_id": 12557094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f17f9d19695be36e4c0c5ac07be4d1c?s=128&d=identicon&r=PG&f=1", "display_name": "goofinator", "link": "https://stackoverflow.com/users/12557094/goofinator"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 462, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1576663920, "creation_date": 1576659293, "last_edit_date": 1576659470, "question_id": 59388478, "link": "https://stackoverflow.com/questions/59388478/wait-of-function-result-after-context-cancellation", "title": "Wait of function result after context cancellation", "body": "<p>I can't understand the logic of this example in <a href=\"https://blog.golang.org/context\" rel=\"noreferrer\">Go Concurrency Patterns: Context</a></p>\n\n<pre><code>func httpDo(ctx context.Context, req *http.Request, f func(*http.Response, error) error) error {\n    // Run the HTTP request in a goroutine and pass the response to f.\n    c := make(chan error, 1)\n    req = req.WithContext(ctx)\n    go func() { c &lt;- f(http.DefaultClient.Do(req)) }()\n    select {\n    case &lt;-ctx.Done():\n        &lt;-c // Wait for f to return.\n        return ctx.Err()\n    case err := &lt;-c:\n        return err\n    }\n}\n</code></pre>\n\n<p>Before that it is said that:</p>\n\n<blockquote>\n  <p>The <code>Done</code> method returns a channel that acts as a cancellation signal\n  to functions running on behalf of the <code>Context</code>: when the channel is\n  closed, the functions should abandon their work and return.</p>\n</blockquote>\n\n<p>It looks like the equivalent of awaiting of <code>&lt;-c</code> only, without <code>case &lt;-ctx.Done()</code> at all. So, what is the point?</p>\n"}, {"tags": ["json", "templates", "go"], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1576659708, "post_id": 59388461, "comment_id": 104967574, "body": "Actually there is a builtin <a href=\"https://golang.org/pkg/text/template/#hdr-Functions\" rel=\"nofollow noreferrer\"><code>slice</code> template function</a>, was added in Go 1.13."}, {"owner": {"reputation": 504, "user_id": 7419457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9292b6e2accc6c214a8e1dd2e17e7950?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul", "link": "https://stackoverflow.com/users/7419457/rahul"}, "edited": false, "score": 0, "creation_date": 1576660325, "post_id": 59388461, "comment_id": 104967862, "body": "this is realy cool it worked out, can you suggest some resource where i can read more about the keywords like lt and genral coding patterns in go template."}, {"owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1576660339, "post_id": 59388461, "comment_id": 104967869, "body": "@icza thank you. just know about that. I&#39;ve updated my answer."}, {"owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "reply_to_user": {"reputation": 504, "user_id": 7419457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9292b6e2accc6c214a8e1dd2e17e7950?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul", "link": "https://stackoverflow.com/users/7419457/rahul"}, "edited": false, "score": 0, "creation_date": 1576660521, "post_id": 59388461, "comment_id": 104967970, "body": "@Rahulroy you can go to <a href=\"https://golang.org/pkg/text/template\" rel=\"nofollow noreferrer\">text/template doc</a> for more about template function, there are also some examples there."}, {"owner": {"reputation": 504, "user_id": 7419457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9292b6e2accc6c214a8e1dd2e17e7950?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul", "link": "https://stackoverflow.com/users/7419457/rahul"}, "edited": false, "score": 0, "creation_date": 1576667117, "post_id": 59388461, "comment_id": 104971331, "body": "sure, will do it @mrka"}], "tags": [], "owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "is_accepted": true, "score": 2, "last_activity_date": 1576660463, "last_edit_date": 1576660463, "creation_date": 1576659214, "answer_id": 59388461, "question_id": 59388288, "link": "https://stackoverflow.com/questions/59388288/first-two-values-from-json-object-using-std-template-package/59388461#59388461", "title": "First two values from json object using std template package", "body": "<p>If your go version is at least go1.13, then you can use the <code>slice</code> template function to take the first two elements. Example:</p>\n\n<pre><code>{{$dataSliced := slice .data 0 2}}\n{{range $element := $dataSliced}}\n    {{$element}}\n{{end}}\n</code></pre>\n\n<p>For older version of go, the same result can be achieved by utilizing <code>range</code> and <code>if lt</code> keywords. Example:</p>\n\n<pre><code>{{range $index, $element := .data}}\n    {{if lt $index 2}}\n        {{$element}}\n    {{end}}\n{{end}}\n</code></pre>\n\n<p>Or you can also create custom template function for the slicing.</p>\n\n<p>More about template function: <a href=\"https://golang.org/pkg/text/template\" rel=\"nofollow noreferrer\">https://golang.org/pkg/text/template</a>.</p>\n"}], "owner": {"reputation": 504, "user_id": 7419457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9292b6e2accc6c214a8e1dd2e17e7950?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul", "link": "https://stackoverflow.com/users/7419457/rahul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 59388461, "answer_count": 1, "score": 0, "last_activity_date": 1576661832, "creation_date": 1576658444, "last_edit_date": 1576661832, "question_id": 59388288, "link": "https://stackoverflow.com/questions/59388288/first-two-values-from-json-object-using-std-template-package", "title": "First two values from json object using std template package", "body": "<p>The json response from api is like this </p>\n\n<pre><code>{\n  \"ResponseCode\": \"1\",\n  \"Response\": \"Data Found\",\n  \"data\": [\n    {\n      \"Season\": \"KHARIF\",\n      \"Sector\": \"AGRICULTURE\",\n      \"Category\": \"Cereals\",\n      \"Crop\": \"Paddy (Dhan)\",\n      \"QueryType\": \"\\tField Preparation\\t\",\n      \"QueryText\": \"top dressing for paddy\",\n      \"KccAns\": \"top dressing for paddy : apply urea 25kg+SSP 15kg +  neem cake 5kg+MN mixture 5kg mixed with 40kg of sand\",\n      \"StateName\": \"PUDUCHERRY\",\n      \"DistrictName\": \"KARAIKAL\",\n      \"BlockName\": \"KARAIKAL\",\n      \"CreatedOn\": \"1/5/2014 6:48:09 PM\"\n    },\n    {\n      \"Season\": \"KHARIF\",\n      \"Sector\": \"AGRICULTURE\",\n      \"Category\": \"Others\",\n      \"Crop\": \"Others\",\n      \"QueryType\": \"Weather\",\n      \"QueryText\": \"weather forecasting details\",\n      \"KccAns\": \"today no rain\",\n      \"StateName\": \"PUDUCHERRY\",\n      \"DistrictName\": \"KARAIKAL\",\n      \"BlockName\": \"KARAIKAL\",\n      \"CreatedOn\": \"1/5/2014 9:04:50 PM\"\n    },\n    {\n      \"Season\": \"KHARIF\",\n      \"Sector\": \"AGRICULTURE\",\n      \"Category\": \"Others\",\n      \"Crop\": \"Others\",\n      \"QueryType\": \"0\",\n      \"QueryText\": \"details about soil testing\",\n      \"KccAns\": \"contact to agricultural department\",\n      \"StateName\": \"PUDUCHERRY\",\n      \"DistrictName\": \"KARAIKAL\",\n      \"BlockName\": \"KARAIKAL\",\n      \"CreatedOn\": \"1/8/2014 10:21:18 AM\"\n    },\n    {\n      \"Season\": \"KHARIF\",\n      \"Sector\": \"AGRICULTURE\",\n      \"Category\": \"Cereals\",\n      \"Crop\": \"Paddy (Dhan)\",\n      \"QueryType\": \"Fertilizer Use and Availability\",\n      \"QueryText\": \"paddy top dressing fertilizer\",\n      \"KccAns\": \"apply urea 25 kg + potash 15 kg + neem cake 5 kg + microfood 5 kg / ac\",\n      \"StateName\": \"PUDUCHERRY\",\n      \"DistrictName\": \"KARAIKAL\",\n      \"BlockName\": \"KARAIKAL\",\n      \"CreatedOn\": \"1/12/2014 8:01:45 AM\"\n    }\n  ]\n}\n</code></pre>\n\n<p>I am trying to write a golang template which returns only the first two data points in data section of the response object. This is the template <code>{{range $element := .data}} {{$element}} {{end}}</code> i am using at the moment but this returns all the sub data in .data feild. How can i make this workout.</p>\n"}, {"tags": ["go", "pdf"], "answers": [{"tags": [], "owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "is_accepted": true, "score": 0, "last_activity_date": 1576654426, "creation_date": 1576654426, "answer_id": 59387363, "question_id": 59387335, "link": "https://stackoverflow.com/questions/59387335/password-protect-a-pdf-file-in-go-language/59387363#59387363", "title": "Password protect a PDF file in Go-language", "body": "<p>You can use <a href=\"https://github.com/unidoc/unipdf\" rel=\"nofollow noreferrer\">unipdf</a> See <a href=\"https://github.com/unidoc/unipdf-examples/blob/v3/security/pdf_protect.go\" rel=\"nofollow noreferrer\">this example</a>.</p>\n"}], "owner": {"reputation": 31, "user_id": 12406091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/htFPd.jpg?s=128&g=1", "display_name": "gitrust", "link": "https://stackoverflow.com/users/12406091/gitrust"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 416, "favorite_count": 0, "closed_date": 1576655071, "accepted_answer_id": 59387363, "answer_count": 1, "score": -1, "last_activity_date": 1576683056, "creation_date": 1576654294, "last_edit_date": 1576683056, "question_id": 59387335, "link": "https://stackoverflow.com/questions/59387335/password-protect-a-pdf-file-in-go-language", "closed_reason": "Not suitable for this site", "title": "Password protect a PDF file in Go-language", "body": "<p>I have got a task to password protect <strong>PDF</strong> documents (PDF v4) afterwards. I know how to achieve this using Java language, Python or PHP.</p>\n\n<p>But since I've learned some <strong>Go-language</strong> basics I am looking for a way to do this in Go. Any suggestions or maybe a code snippet?</p>\n"}, {"tags": ["go", "flutter", "dart", "in-app-purchase", "flutter-layout"], "comments": [{"owner": {"reputation": 71, "user_id": 7748308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cef7ac1a9059a75a8f42f21f1f6fbe1b?s=128&d=identicon&r=PG&f=1", "display_name": "Ania", "link": "https://stackoverflow.com/users/7748308/ania"}, "edited": false, "score": 0, "creation_date": 1610435640, "post_id": 59386986, "comment_id": 116124410, "body": "You need to add yourself to the testers account. Send the download link from Google Play to your email. Install the application from the link and only then in app purchases will be available"}], "owner": {"reputation": 21, "user_id": 5161265, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-rFHcKu6cXjk/AAAAAAAAAAI/AAAAAAAAAN8/XaPAv-UT2aI/photo.jpg?sz=128", "display_name": "programyazar", "link": "https://stackoverflow.com/users/5161265/programyazar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1576654417, "creation_date": 1576652738, "last_edit_date": 1576654417, "question_id": 59386986, "link": "https://stackoverflow.com/questions/59386986/flutter-iap-payment-verify-and-consumable-items", "title": "Flutter IAP payment verify and consumable items", "body": "<p>I have 2 questions about IAP methods on flutter framework:</p>\n\n<p>I) On the flutter side, I used in_app package: </p>\n\n<blockquote>\n  <p>in_app_purchase: ^0.2.2+3</p>\n</blockquote>\n\n<p>on the server-side I used Go-lang. How can i make server side verification after payment purchased?</p>\n\n<p>II) I have already created alpha and beta release  (<strong>on Android</strong>); I can see my consumable items (as available) but when I try to buy, it says an item is not available.</p>\n\n<p>All questions are about Android, not for ios. I've searched for a lot of tutorials on the internet but I couldn't find a solution.</p>\n"}, {"tags": ["go", "goland"], "comments": [{"owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "edited": false, "score": 0, "creation_date": 1576651214, "post_id": 59386297, "comment_id": 104964209, "body": "probably try to run the GoLand as administrator"}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1576652435, "post_id": 59386297, "comment_id": 104964630, "body": "There is no need to run GoLand as an administrator. Even if the compiled application would require administrative rights, then you can enable the <code>Run with elevated priviledges</code> checkbox in the Run Configuration settings."}], "answers": [{"comments": [{"owner": {"reputation": 111, "user_id": 10197773, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eh7Re-n_QgI/AAAAAAAAAAI/AAAAAAAAAAs/0RFpfCWcZjc/photo.jpg?sz=128", "display_name": "Simon Hu", "link": "https://stackoverflow.com/users/10197773/simon-hu"}, "edited": false, "score": 1, "creation_date": 1576652463, "post_id": 59386789, "comment_id": 104964645, "body": "Awesome. Thank you very much!"}], "tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 1, "last_activity_date": 1576651702, "creation_date": 1576651702, "answer_id": 59386789, "question_id": 59386297, "link": "https://stackoverflow.com/questions/59386297/how-can-i-change-the-default-output-folder-path-of-the-go-file/59386789#59386789", "title": "How can I change the default output folder path of the GO file?", "body": "<p>You can edit the run configuration via <code>Run | Edit Configurations...</code> and set the <code>Output directory</code> to whatever location you'd like to, see the screenshot below.</p>\n\n<p><a href=\"https://i.stack.imgur.com/OIa0c.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/OIa0c.png\" alt=\"outpud directory in a run configuration\"></a></p>\n\n<p>If you wish to set this for all new run configurations of the project, then go to <code>Run | Edit Configurations... | Templates | Go Build</code> and then configure the <code>Output directory</code> setting there. All new <code>Go Build</code> configurations will then use that setting.</p>\n"}], "owner": {"reputation": 111, "user_id": 10197773, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eh7Re-n_QgI/AAAAAAAAAAI/AAAAAAAAAAs/0RFpfCWcZjc/photo.jpg?sz=128", "display_name": "Simon Hu", "link": "https://stackoverflow.com/users/10197773/simon-hu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 453, "favorite_count": 0, "accepted_answer_id": 59386789, "answer_count": 1, "score": 0, "last_activity_date": 1576651702, "creation_date": 1576649069, "last_edit_date": 1576650260, "question_id": 59386297, "link": "https://stackoverflow.com/questions/59386297/how-can-i-change-the-default-output-folder-path-of-the-go-file", "title": "How can I change the default output folder path of the GO file?", "body": "<p>Because I had installed the Avira in my computer, once I run my go file in <a href=\"https://www.jetbrains.com/go/\" rel=\"nofollow noreferrer\">GoLand</a>, Avira will prompt me a security alert that  \"BLOCK HEUR/APC(could) .........\"</p>\n\n<p>Meanwhile, GoLand also shows that </p>\n\n<blockquote>\n  <p>Error running 'go build test.go': Cannot run program \"C:\\Users\\Simon\\AppData\\Local\\Temp___2go_build_test_go.exe\" (in directory \"E:\\Application software\\GO\\awesomeProject\"): CreateProcess error=5, ACCESS DENIED.</p>\n</blockquote>\n\n<p>I want to know how can I change the default output path (i.e., build -o \"path\") to another path; after all, I don't want to close the realtime protection of Avira in each time, and \u2018C\u2019 disk is also a sensitive area. Should I configure the settings of the GO source or just change some settings in GoLand? B.T.W, unless necessary, I don't want to change the settings of Avira :)</p>\n\n<p>Thanks in advance, I am a beginner of Go language.</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1576645682, "post_id": 59385531, "comment_id": 104962780, "body": "Have you tried running <code>go get the&#47;package@v1.1.0</code>? See <a href=\"https://github.com/golang/go/wiki/Modules#how-to-upgrade-and-downgrade-dependencies\" rel=\"nofollow noreferrer\">Go Wiki: Modules: How to Upgrade and Downgrade Dependencies</a>"}, {"owner": {"reputation": 163, "user_id": 9561825, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "ecwdw 23e3e23e", "link": "https://stackoverflow.com/users/9561825/ecwdw-23e3e23e"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1576646470, "post_id": 59385531, "comment_id": 104962947, "body": "Thanks for suggestion ... And Yes I have ... Sure enough go.mod reads v1.1.0. but go build puts back 1.3.0. I&#39;m beginning to think maybe an env var is wrong b/c what you wrote really should done the trick."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1576652361, "post_id": 59385531, "comment_id": 104964605, "body": "Is this an indirect dependency?"}], "answers": [{"comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1576647020, "post_id": 59385865, "comment_id": 104963079, "body": "Why do you have <code>go mod vendor</code> there?"}, {"owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1576647573, "post_id": 59385865, "comment_id": 104963199, "body": "@zerkms if the vendor folder is there, then dependencies inside will be updated"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1576650631, "post_id": 59385865, "comment_id": 104964010, "body": "Sure, but it&#39;s not obvious whether OP uses vendoring (or more correctly: there are signs they don&#39;t)"}], "tags": [], "owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "is_accepted": false, "score": 4, "last_activity_date": 1576651144, "last_edit_date": 1576651144, "creation_date": 1576646012, "answer_id": 59385865, "question_id": 59385531, "link": "https://stackoverflow.com/questions/59385531/modules-how-to-force-version-of-dependent-lib/59385865#59385865", "title": "modules: how to force version of dependent lib", "body": "<blockquote>\n  <p>No matter what I do (hand edit go.mod, go get -u) ...</p>\n</blockquote>\n\n<p>After you modify the version of the dependency in the <code>go.mod</code> file, then what you need to do is perform <code>go mod tidy</code> command (from your explanation I assume you haven't done it).</p>\n\n<p>Example:</p>\n\n<pre><code># modify the dependency version on go.mod, then\ngo mod tidy\n</code></pre>\n\n<p>If you use vendoring then you also need to run the <code>go mod vendor</code> command to update the downloaded dependencies inside <code>vendor/</code> folder. </p>\n\n<pre><code># modify the dependency version on go.mod, then\ngo mod tidy\ngo mod vendor\n</code></pre>\n"}], "owner": {"reputation": 163, "user_id": 9561825, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "ecwdw 23e3e23e", "link": "https://stackoverflow.com/users/9561825/ecwdw-23e3e23e"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1576661800, "creation_date": 1576643862, "last_edit_date": 1576661800, "question_id": 59385531, "link": "https://stackoverflow.com/questions/59385531/modules-how-to-force-version-of-dependent-lib", "title": "modules: how to force version of dependent lib", "body": "<p>Overall go modules works just like the docs say. But, in one case, a dependent lib's latest tag is v1.3.0 which go mod tidy finds. However I need v1.1.0. No matter what I do (hand edit go.mod, go get -u) 'go build' merely reverts the version right back to v1.3.0 which breaks the build. Indeed, the whole point of modules is setting the dependencies: so how? Go get should set it permanently but it doesn't stay set. Using go1.13.5</p>\n"}, {"tags": ["go", "time"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1576642415, "post_id": 59385310, "comment_id": 104962125, "body": "<code>GetTimeTables(c echo.Context)</code> is not a valid function call, you have to pass a value of type <code>echo.Context</code>, it is used to interact with an HTTP request which you won&#39;t have after <code>x</code> hours. Who do you want to send an HTTP response to? If no one, <code>GetTables()</code> shouldn&#39;t require an <code>echo.Context</code> in the first place."}, {"owner": {"reputation": 146, "user_id": 11900571, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3127066989e308d523b778000254c7cb?s=128&d=identicon&r=PG", "display_name": "Dat Ngo", "link": "https://stackoverflow.com/users/11900571/dat-ngo"}, "edited": false, "score": 0, "creation_date": 1576683797, "post_id": 59385310, "comment_id": 104980208, "body": "It&#39;s not gonna work that way. You will need to do the <code>GetTimeTables</code> in a background/cron job"}], "answers": [{"tags": [], "owner": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "is_accepted": false, "score": 1, "last_activity_date": 1576645280, "creation_date": 1576645280, "answer_id": 59385762, "question_id": 59385310, "link": "https://stackoverflow.com/questions/59385310/how-to-call-a-function-x-after-n-hours/59385762#59385762", "title": "How to call a function X after N hours", "body": "<p>Your program needs to block, otherwise, it will exit before the <code>AfterFunc</code> is triggered.</p>\n\n<p>Try removing the sleep from this example <a href=\"https://play.golang.org/p/_25RffWDyPV\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_25RffWDyPV</a> to see.</p>\n\n<p><code>GetTimeTables</code> is not a function that can be called directly, you need to call it as a method of the timeTables object.  Also as mentioned by @icza, you should be passing a value to the function.</p>\n\n<p>Something like this should work:</p>\n\n<pre><code>func (t timeTables) CallFunc(c echo.Context) {\n    time.AfterFunc(4*time.Hour, func() {\n        t.GetTimeTables(c)\n    })\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "is_accepted": false, "score": 1, "last_activity_date": 1576648508, "creation_date": 1576648508, "answer_id": 59386208, "question_id": 59385310, "link": "https://stackoverflow.com/questions/59385310/how-to-call-a-function-x-after-n-hours/59386208#59386208", "title": "How to call a function X after N hours", "body": "<p>I see <code>c.JSON(http.StatusOK, \"\")</code> there, so I assume the code is a route handler (with echo framework used).</p>\n\n<p>If what you wanted to try is this: for every incoming http request, wait for 4 hours then run the <code>GetTimeTables()</code>; then you http request will fail because of timeout.</p>\n\n<p>Also <code>time.AfterFunc</code> will be executed asynchronously (as goroutine), so the http request will be finished before the callback executed.</p>\n\n<p>Probably please tell use in details what you are trying to achieve.</p>\n"}, {"tags": [], "owner": {"reputation": 23, "user_id": 11727168, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-53NTedcDv04/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfl9ihMNEQ6xBHS45NgnZietr1aZA/photo.jpg?sz=128", "display_name": "Doctor Strange", "link": "https://stackoverflow.com/users/11727168/doctor-strange"}, "is_accepted": false, "score": 0, "last_activity_date": 1576650457, "creation_date": 1576650457, "answer_id": 59386549, "question_id": 59385310, "link": "https://stackoverflow.com/questions/59385310/how-to-call-a-function-x-after-n-hours/59386549#59386549", "title": "How to call a function X after N hours", "body": "<p>I do myAPI with echo framework , myAPI will call to orther API by func GetTimeTables . Your mean is :</p>\n\n<pre><code>func (t timeTables) CallFunc(c echo.Context) {\n    time.AfterFunc(4*time.Hour, func() {\n        t.GetTimeTables(\"myAPI\")\n    })\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 11727168, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-53NTedcDv04/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfl9ihMNEQ6xBHS45NgnZietr1aZA/photo.jpg?sz=128", "display_name": "Doctor Strange", "link": "https://stackoverflow.com/users/11727168/doctor-strange"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1576662910, "creation_date": 1576641820, "last_edit_date": 1576662910, "question_id": 59385310, "link": "https://stackoverflow.com/questions/59385310/how-to-call-a-function-x-after-n-hours", "title": "How to call a function X after N hours", "body": "<pre><code>func (timeTables) GetTimeTables(c echo.Context) error {\n\n    resp, err := http.Get(\"url\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    body, err := ioutil.ReadAll(resp.Body)\n\n    test := &amp;models.MultiModel{}\n    json.Unmarshal(body, &amp;test)\n    return c.JSON(http.StatusOK,\"\")\n}\n</code></pre>\n\n<p>how to call func GetTimeTables after 1 hour , i use AferFunc , What am I missing ?</p>\n\n<pre><code>func (timeTables) CallFunc() {\n    time.AfterFunc(4*time.Hour, func() {\n        GetTimeTables(c echo.Context)\n    })\n}\n</code></pre>\n"}, {"tags": ["go", "gomock"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 4364586, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-h0-OaiEwX1s/AAAAAAAAAAI/AAAAAAAAATY/zVTG-eVJ3SU/photo.jpg?sz=128", "display_name": "hotsnow", "link": "https://stackoverflow.com/users/4364586/hotsnow"}, "edited": false, "score": 0, "creation_date": 1576642605, "post_id": 59385281, "comment_id": 104962152, "body": "Thanks for you answer. this works for here. But in real word, we need to implement all the methods for this interface. and will lost the flexibility of gomock, eg: Matcher"}, {"owner": {"reputation": 26911, "user_id": 225262, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/10f7602ff38f6486cb1580052746fc05?s=128&d=identicon&r=PG", "display_name": "satoru", "link": "https://stackoverflow.com/users/225262/satoru"}, "reply_to_user": {"reputation": 1, "user_id": 4364586, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-h0-OaiEwX1s/AAAAAAAAAAI/AAAAAAAAATY/zVTG-eVJ3SU/photo.jpg?sz=128", "display_name": "hotsnow", "link": "https://stackoverflow.com/users/4364586/hotsnow"}, "edited": false, "score": 0, "creation_date": 1576719995, "post_id": 59385281, "comment_id": 104993498, "body": "I don&#39;t think so. Most of the time you only needs dummy implementation of one of the methods, by embedding the interface in the <code>dummy</code> struct, you only have to implement the methods you care."}, {"owner": {"reputation": 1, "user_id": 4364586, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-h0-OaiEwX1s/AAAAAAAAAAI/AAAAAAAAATY/zVTG-eVJ3SU/photo.jpg?sz=128", "display_name": "hotsnow", "link": "https://stackoverflow.com/users/4364586/hotsnow"}, "edited": false, "score": 0, "creation_date": 1578183738, "post_id": 59385281, "comment_id": 105356954, "body": "I got your point after some learning and testing. But I still want to know if gomock can change the pointer parameter or not. Thanks."}], "tags": [], "owner": {"reputation": 26911, "user_id": 225262, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/10f7602ff38f6486cb1580052746fc05?s=128&d=identicon&r=PG", "display_name": "satoru", "link": "https://stackoverflow.com/users/225262/satoru"}, "is_accepted": false, "score": 0, "last_activity_date": 1576641483, "creation_date": 1576641483, "answer_id": 59385281, "question_id": 59385184, "link": "https://stackoverflow.com/questions/59385184/can-i-mock-a-function-with-pointer-parameter-which-need-to-be-used/59385281#59385281", "title": "Can I mock a function with pointer parameter which need to be used", "body": "<p>It seems you don't have to use <code>gomock</code> to test the <code>task</code> method.</p>\n\n<p>Since you have an interface, why not just create a mock implementation of the interface, for example:</p>\n\n<pre><code>type dummy struct{\n    callCount int\n}\n\nfunc (d *dummy) Double(i *int) error {\n    d.callCount++\n    return nil\n}\n\nd := dummy{}\nj := job{a: &amp;d}\ngot := j.task(3)\nif d.callCount != 1 {\n    // XXX\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 7116477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0ccddeb37084876bc00339d2e12f873?s=128&d=identicon&r=PG&f=1", "display_name": "PhantomX7", "link": "https://stackoverflow.com/users/7116477/phantomx7"}, "is_accepted": false, "score": 0, "last_activity_date": 1599209372, "creation_date": 1599209372, "answer_id": 63737861, "question_id": 59385184, "link": "https://stackoverflow.com/questions/59385184/can-i-mock-a-function-with-pointer-parameter-which-need-to-be-used/63737861#63737861", "title": "Can I mock a function with pointer parameter which need to be used", "body": "<p>you can use gomock <a href=\"https://godoc.org/github.com/golang/mock/gomock#Call.SetArg\" rel=\"nofollow noreferrer\">setarg</a> function for this</p>\n<pre><code>yourPackage.EXPECT().insert(&amp;pointer).SetArg(0, newPointer)\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 4364586, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-h0-OaiEwX1s/AAAAAAAAAAI/AAAAAAAAATY/zVTG-eVJ3SU/photo.jpg?sz=128", "display_name": "hotsnow", "link": "https://stackoverflow.com/users/4364586/hotsnow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1495, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1599209372, "creation_date": 1576640530, "last_edit_date": 1576661747, "question_id": 59385184, "link": "https://stackoverflow.com/questions/59385184/can-i-mock-a-function-with-pointer-parameter-which-need-to-be-used", "title": "Can I mock a function with pointer parameter which need to be used", "body": "<p>Let's say we have a library provide a function Double to double the integer, we use pointer i to get the result value not by return:</p>\n\n<pre><code>package api\n\ntype Action interface {\n    Double(i *int) error\n}\n\ntype NUM struct{}\n\nfunc (n NUM) Double(i *int) error {\n    *i *= 2\n\n    return nil\n}\n</code></pre>\n\n<p>in our main function we use this library to do our task. like this:</p>\n\n<pre><code>package app\n\nimport (\n    \"fmt\"\n    \"github.com/hotsnow/api\"\n)\n\nfunc main() {\n    j := job{a: &amp;api.NUM{}}\n    d := j.task(3)\n    fmt.Println(3, d)\n}\n\ntype job struct {\n    a api.Action\n}\n\n// double me\nfunc (j job) task(i int) int {\n    j.a.Double(&amp;i)\n\n    return i\n}\n</code></pre>\n\n<p>Now we need to test the task() function, how can we get the pointer return bye mock the Double function?</p>\n\n<p>Here is the test:</p>\n\n<pre><code>package app\n\nimport (\n    \"github.com/golang/mock/gomock\"\n    \"github.com/hotsnow/mocks\"\n    \"testing\"\n)\n\nfunc TestReq(t *testing.T) {\n    ctrl := gomock.NewController(t)\n    defer ctrl.Finish()\n\n    m := mocks.NewMockAction(ctrl)\n    m.EXPECT().Double(gomock.Any()).Return(nil)\n\n    j := job{a: m}\n    got := j.task(3)\n    if got != 6 {\n        t.Errorf(\"got = %#v; want 6\", got)\n    }\n}\n</code></pre>\n\n<p>The code here: <a href=\"https://github.com/hotsnow/mock.git\" rel=\"nofollow noreferrer\">https://github.com/hotsnow/mock.git</a> (stackoverflow branch)</p>\n"}, {"tags": ["python", "go"], "comments": [{"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 2, "creation_date": 1576638933, "post_id": 59384835, "comment_id": 104961447, "body": "In Go, you don&#39;t need a function since if you have a pointer, you can compare it directly. And if you don&#39;t have a pointer, then two names always refer to two objects in different memory."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 1, "creation_date": 1576639018, "post_id": 59384835, "comment_id": 104961461, "body": "Which is to say, Python&#39;s <code>id</code> doesn&#39;t even make sense in Go."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 1, "creation_date": 1576639086, "post_id": 59384835, "comment_id": 104961478, "body": "(<code>id</code> can be used got identity comparison, but not equality comparison; cases where you&#39;ll get incorrect results misusing it for the latter are not rare in any respect whatsoever)."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 3, "creation_date": 1576639149, "post_id": 59384835, "comment_id": 104961489, "body": "... And actually, if you want to do identity comparison in Python, you don&#39;t need <code>id</code> for that either; you get more accurate results from the <code>is</code> operator. <code>id</code> will sometimes return the same result twice for things that aren&#39;t actually identical if an address is reused, making its use for identity comparison not just prone to false negatives, but false positives as well."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1576645356, "post_id": 59384835, "comment_id": 104962699, "body": "Python&#39;s id does not map neatly to all Go types, but there are some cases where it does.  What types are you trying to compare?"}], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1576665123, "post_id": 59385006, "comment_id": 104970347, "body": "bad idea, really pointers are the domain of the runtime and it can do unexpected things. see peter&#39;s answer"}], "tags": [], "owner": {"reputation": 26911, "user_id": 225262, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/10f7602ff38f6486cb1580052746fc05?s=128&d=identicon&r=PG", "display_name": "satoru", "link": "https://stackoverflow.com/users/225262/satoru"}, "is_accepted": false, "score": 0, "last_activity_date": 1576639051, "creation_date": 1576639051, "answer_id": 59385006, "question_id": 59384835, "link": "https://stackoverflow.com/questions/59384835/what-is-the-equivalent-of-id-function-of-python-in-golang/59385006#59385006", "title": "What is the equivalent of &quot;id&quot; function of Python in Golang?", "body": "<p>With CPython, <code>id</code> returns the address of the object in memory. In Go, you get the pointer to objects with an ampersand:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    i := 32\n    j := 32\n    fmt.Printf(\"%p is %p\\n\", &amp;i, &amp;i)\n    fmt.Printf(\"%p is not %p\\n\", &amp;i, &amp;j)\n}\n</code></pre>\n\n<p>The output of the example above looks like this on my machine:</p>\n\n<pre><code>0xc000016100 is 0xc000016100\n0xc000016100 is not 0xc000016108\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1576639111, "creation_date": 1576639111, "answer_id": 59385017, "question_id": 59384835, "link": "https://stackoverflow.com/questions/59384835/what-is-the-equivalent-of-id-function-of-python-in-golang/59385017#59385017", "title": "What is the equivalent of &quot;id&quot; function of Python in Golang?", "body": "<p>You can use <code>DeepEqual</code> to compare the contents of two objects. However, I don't think that's what python <code>id</code> does. From the definition of <code>id</code> in python, it looks like pointer equivalence is what you're after, not <code>DeepEqual</code>. The function definition for <code>id</code> states </p>\n\n<blockquote>\n  <p>This is an integer which is guaranteed to be unique and constant for this object during its lifetime. </p>\n</blockquote>\n\n<p>If you're comparing two pointer values, you can simply use <code>==</code>: if two pointers point to the same thing, then they're equal. If two pointer values are not equal, they may still be pointing to objects with the same content though, so <code>p1==p2</code> may be false, but <code>DeepEqual(*p1,*p2)</code> may be true.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 5, "last_activity_date": 1576642849, "creation_date": 1576642849, "answer_id": 59385411, "question_id": 59384835, "link": "https://stackoverflow.com/questions/59384835/what-is-the-equivalent-of-id-function-of-python-in-golang/59385411#59385411", "title": "What is the equivalent of &quot;id&quot; function of Python in Golang?", "body": "<p><a href=\"https://stackoverflow.com/a/59385006/221700\">@satoru posted:</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    i := 32\n    j := 32\n    fmt.Printf(\"%p is %p\\n\", &amp;i, &amp;i)\n    fmt.Printf(\"%p is not %p\\n\", &amp;i, &amp;j)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>0xc000016100 is 0xc000016100\n0xc000016100 is not 0xc000016108\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/nXAEJeImeXa\" rel=\"noreferrer\">https://play.golang.org/p/nXAEJeImeXa</a></p>\n\n<hr>\n\n<p>However,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    i := 32\n    j := 32\n    fmt.Printf(\"i %p is i %p; i == i %t\\n\", &amp;i, &amp;i, &amp;i == &amp;i)\n    fmt.Printf(\"i %p is not j %p; i == j %t\\n\", &amp;i, &amp;j, &amp;i == &amp;j)\n\n    fmt.Println()\n\n    var v struct {\n        i struct{}\n        j struct{}\n    }\n    fmt.Printf(\"i %p is i %p; i == i %t\\n\", &amp;v.i, &amp;v.i, &amp;v.i == &amp;v.i)\n    fmt.Printf(\"i %p is not j %p; i == j %t\\n\", &amp;v.i, &amp;v.j, &amp;v.i == &amp;v.j)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>i 0x40e020 is i 0x40e020; i == i true\ni 0x40e020 is not j 0x40e024; i == j false\n\ni 0x1e52bc is i 0x1e52bc; i == i true\ni 0x1e52bc is not j 0x1e52bc; i == j true\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/Wv814ZgPCul\" rel=\"noreferrer\">https://play.golang.org/p/Wv814ZgPCul</a></p>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://godoc.org/github.com/google/go-cmp/cmp\" rel=\"noreferrer\">package cmp</a></p>\n\n<pre><code>import \"github.com/google/go-cmp/cmp\"\n</code></pre>\n  \n  <p>Package cmp determines equality of values.</p>\n  \n  <p>This package is intended to be a more powerful and safer alternative\n  to reflect.DeepEqual for comparing whether two values are semantically\n  equal.</p>\n</blockquote>\n"}], "owner": {"reputation": 156, "user_id": 9652400, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89cd8b30c323400b11551c887d506e88?s=128&d=identicon&r=PG", "display_name": "Ambareesh", "link": "https://stackoverflow.com/users/9652400/ambareesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 334, "favorite_count": 2, "accepted_answer_id": 59385411, "answer_count": 3, "score": 1, "last_activity_date": 1576642849, "creation_date": 1576637739, "question_id": 59384835, "link": "https://stackoverflow.com/questions/59384835/what-is-the-equivalent-of-id-function-of-python-in-golang", "title": "What is the equivalent of &quot;id&quot; function of Python in Golang?", "body": "<p>What is the equivalent of \"id\" function of Python in Golang?</p>\n\n<p>id is what I normally use to compare if two objects are identical in Python (by crosschecking if their \"id\"s are the same. There are exceptions of course - like in PyTorch tensors sometimes, but mostly this works). </p>\n\n<p>For the same in Golang I found that you can use the function mentioned in <a href=\"https://stackoverflow.com/questions/24534072/how-to-compare-if-two-structs-slices-or-maps-are-equal\">this answer</a> which is <a href=\"https://golang.org/pkg/reflect/#DeepEqual\" rel=\"nofollow noreferrer\">DeepEqual</a>. But was wondering if there's an equivalent of id in Python, which tbh is quite a convenient function to have. </p>\n"}, {"tags": ["go", "certificate", "x509", "pki"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1576630966, "post_id": 59383823, "comment_id": 104960063, "body": "Maybe some of those certificates are intermediate certificates. The validation options want roots and intermediates separately."}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 5, "last_activity_date": 1576671068, "last_edit_date": 1576671068, "creation_date": 1576670693, "answer_id": 59391673, "question_id": 59383823, "link": "https://stackoverflow.com/questions/59383823/how-to-verify-a-certificate-against-an-issuing-chain-in-go/59391673#59391673", "title": "How to verify a certificate against an issuing chain in Go?", "body": "<p>Your leaf certificate is for client authentication only. </p>\n\n<pre><code>$ openssl x509 -noout -text -in leaf.pem  | grep -A1 'Key Usage'\n            X509v3 Key Usage: critical\n                Digital Signature, Key Encipherment\n            X509v3 Extended Key Usage: \n                TLS Web Client Authentication\n</code></pre>\n\n<p>If this is intentional, you must specify the KeyUsages option because <a href=\"https://golang.org/pkg/crypto/x509/#VerifyOptions.KeyUsages\" rel=\"nofollow noreferrer\">\"an empty list means ExtKeyUsageServerAuth\"</a>. You also have to go back to your version of the code that provides the intermediate certs separately:</p>\n\n<pre><code>chain, err := cert.Verify(x509.VerifyOptions{\n    Roots:         roots,\n    Intermediates: inters,\n    KeyUsages:     []x509.ExtKeyUsage{x509.ExtKeyUsageClientAuth},\n})\n</code></pre>\n\n<p>Try it on the playground: <a href=\"https://play.golang.org/p/1BNLthzu5Tz\" rel=\"nofollow noreferrer\">https://play.golang.org/p/1BNLthzu5Tz</a>. Note that the playground requires the CurrentTime option to verify correctly. Remove this when copying elsewhere!</p>\n"}], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1435, "favorite_count": 1, "accepted_answer_id": 59391673, "answer_count": 1, "score": 3, "last_activity_date": 1576671068, "creation_date": 1576627526, "last_edit_date": 1576670766, "question_id": 59383823, "link": "https://stackoverflow.com/questions/59383823/how-to-verify-a-certificate-against-an-issuing-chain-in-go", "title": "How to verify a certificate against an issuing chain in Go?", "body": "<p>I'd like to verify a PEM certificate against an issuing chain which is also a <code>.pem</code> file with several certificates separated by newline characters as shown in this gist, <a href=\"https://gist.github.com/kurtpeek/8bf3282e344c781a20c5deadac75059f\" rel=\"nofollow noreferrer\">https://gist.github.com/kurtpeek/8bf3282e344c781a20c5deadac75059f</a>. I've tried this with <code>Certpool.AppendCertsFromPEM</code> as follows:</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/x509\"\n    \"encoding/pem\"\n    \"io/ioutil\"\n\n    \"github.com/sirupsen/logrus\"\n)\n\nfunc main() {\n    caCertPEM, err := ioutil.ReadFile(\"issuing_chain.pem\")\n    if err != nil {\n        logrus.WithError(err).Fatal(\"read CA PEM file\")\n    }\n\n    certPEM, err := ioutil.ReadFile(\"3007e750-e769-440b-9075-41dc2b5b1787.pem\")\n    if err != nil {\n        logrus.WithError(err).Fatal(\"read cert PEM file\")\n    }\n\n    block, rest := pem.Decode(certPEM)\n    if block == nil {\n        logrus.WithField(\"rest\", rest).Fatal(\"Decode CA PEM\")\n    }\n\n    cert, err := x509.ParseCertificate(block.Bytes)\n    if err != nil {\n        logrus.WithError(err).Fatal(\"parse certificate\")\n    }\n\n    roots := x509.NewCertPool()\n    roots.AppendCertsFromPEM(caCertPEM)\n\n    chain, err := cert.Verify(x509.VerifyOptions{Roots: roots})\n    if err != nil {\n        logrus.WithError(err).Fatal(\"failed to verify cert\")\n    }\n\n    logrus.Infof(\"issuing chain: %+v\", chain)\n}\n</code></pre>\n\n<p>However, if I run this I get the following error:</p>\n\n<pre><code>FATA[0000] failed to verify cert                         error=\"x509: certificate specifies an incompatible key usage\"\nexit status 1\n</code></pre>\n\n<p>I believe this error is returned on line 790 of <a href=\"https://golang.org/src/crypto/x509/verify.go\" rel=\"nofollow noreferrer\">https://golang.org/src/crypto/x509/verify.go</a>:</p>\n\n<pre><code>if len(chains) == 0 {\n    return nil, CertificateInvalidError{c, IncompatibleUsage, \"\"}\n}\n</code></pre>\n\n<p>In other words, the <code>Verify()</code> method is unable to build any <code>chains</code> from the options provided. I've tried splitting out the intermediates (the top two in the <code>issuing_chain.pem</code> shown in the gist) into a separate PEM file and adding those as <code>Intermediates</code> to the <code>x509.VerifyOptions</code>, but I still get the same error.</p>\n\n<p>What is the correct way to verify a certificate against an issuing chain in Go?</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1576627024, "post_id": 59383539, "comment_id": 104959274, "body": "Use <code>strconv.Itoa</code> to convert an integer to string."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1576627136, "post_id": 59383539, "comment_id": 104959295, "body": "... <a href=\"https://play.golang.com/p/3gZ9el8x5Fa\" rel=\"nofollow noreferrer\">play.golang.com/p/3gZ9el8x5Fa</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1576627312, "post_id": 59383539, "comment_id": 104959336, "body": "<a href=\"https://golang.org/ref/spec#Conversions_to_and_from_a_string_type\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Conversions_to_and_from_a_string_type</a> <i>&quot;Converting a signed or unsigned integer value to a string type <b>yields a string containing the UTF-8 representation of the integer</b>. &quot;</i> (not the integer)"}, {"owner": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1576627712, "post_id": 59383539, "comment_id": 104959428, "body": "Ah... I&#39;ll answer my own question then."}], "answers": [{"tags": [], "owner": {"reputation": 2186, "user_id": 1647656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0a27a80f0a9800a2fc5935ecf7071eca?s=128&d=identicon&r=PG", "display_name": "Alex Guerra", "link": "https://stackoverflow.com/users/1647656/alex-guerra"}, "is_accepted": true, "score": 2, "last_activity_date": 1576627356, "creation_date": 1576627356, "answer_id": 59383802, "question_id": 59383539, "link": "https://stackoverflow.com/questions/59383539/database-sql-exec-function-fail-with-concatenating-string/59383802#59383802", "title": "database/sql Exec() function fail with concatenating string", "body": "<p>You can't convert an integer to a string like that. The result of <code>string(0)</code> is <code>\"\\x00\"</code>, aka a null byte, instead of <code>\"0\"</code> which is probably you want. You should use <a href=\"https://golang.org/pkg/strconv/#Itoa\" rel=\"nofollow noreferrer\"><code>strconv.Itoa</code></a> for the conversion instead.</p>\n"}], "owner": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "accepted_answer_id": 59383802, "answer_count": 1, "score": 0, "last_activity_date": 1576627356, "creation_date": 1576625292, "last_edit_date": 1576625656, "question_id": 59383539, "link": "https://stackoverflow.com/questions/59383539/database-sql-exec-function-fail-with-concatenating-string", "title": "database/sql Exec() function fail with concatenating string", "body": "<p>A peculiar error occurred today when was manipulating data in <code>Postgres</code> using <code>database/sql</code> and driver <code>github.com/lib/pq</code>. I have the following SQL schema created in <code>Postgres</code>:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>CREATE TABLE IF NOT EXISTS bench_bytea (\n    id INT PRIMARY KEY,\n    name VARCHAR,\n    data BYTEA\n);\n</code></pre>\n\n<p>A very basic table containing a data blob of type <code>BYTEA</code>.</p>\n\n<p>I then tried to execute simple <code>INSERT</code> statement using the <code>Exec()</code> function provided by <code>database/sql</code>. Here it is:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>psqlInfo := fmt.Sprintf(\"host=%s port=%d user=%s \"+\n    \"password=%s dbname=%s sslmode=disable\",\n    host, port, user, password, dbname)\n\ndb, err := sql.Open(\"postgres\", psqlInfo)\nif err != nil {\n    panic(err)\n}\ndefer db.Close()\n\nstmt := `INSERT INTO bench_bytea (id, name, data) VALUES ($1, $2, $3) ON CONFLICT (id) DO NOTHING`\ndata := `{\"title\": \"Sleeping Beauties\", \"genres\": [\"Fiction\", \"Thriller\", \"Horror\"], \"published\": false}`\ni := 0\n\n_, err = db.Exec(stmt, i, \"testing \"+string(i), []byte(data))\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>The key highlight happens on the <code>db.Exec()</code> line where I execute a SQL INSERT statement <em>(in practicality <code>i</code> is an index of an array where I stored different testing <code>data</code>. I didn't want to include the other pieces of data here since it's really long and irrelevant)</em>. The error I received is:</p>\n\n<pre><code>pq: invalid byte sequence for encoding \"UTF8\": 0x00\n</code></pre>\n\n<p>Now if I change <code>\"testing \"+string(i)</code> into <code>\"testing\"</code>, the error is gone. That is, if I didn't insert a concatenating strings into the <code>name</code> column, there's no error. What is going on here?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 5, "creation_date": 1576617517, "post_id": 59382168, "comment_id": 104956380, "body": "The playground example declares a function named <code>print</code> at package scope.  The example does not alter the builtin <code>print</code> function declared in the universe scope."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1576618578, "post_id": 59382168, "comment_id": 104956843, "body": "What do you mean by &quot;on-the-fly&quot;?   The playground example declares a function at package scope.  If a compile time declaration works for you, then import some different package with name &quot;fmt&quot; and implement whatever functions you need in that package.  Something like <a href=\"https://play.golang.org/p/AryQ8cykFrG\" rel=\"nofollow noreferrer\">play.golang.org/p/AryQ8cykFrG</a>"}, {"owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1576619657, "post_id": 59382168, "comment_id": 104957229, "body": "@CeriseLim&#243;n, yes - your 2nd comment would work for me. thanks! I&#39;d gladly mark that as the accepted answer if you can reply below."}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 2857501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dcccfbf6d24da59fc6ceafcf2c74e3ae?s=128&d=identicon&r=PG&f=1", "display_name": "Shane Howearth", "link": "https://stackoverflow.com/users/2857501/shane-howearth"}, "is_accepted": false, "score": 2, "last_activity_date": 1576617739, "creation_date": 1576617739, "answer_id": 59382283, "question_id": 59382168, "link": "https://stackoverflow.com/questions/59382168/modifying-imported-functions-in-go/59382283#59382283", "title": "modifying imported functions in go", "body": "<p>If you want to 'alter' a builtin function, look at the very fine monkey patch utility <a href=\"https://github.com/bouk/monkey\" rel=\"nofollow noreferrer\">https://github.com/bouk/monkey</a> (And pay attention to the warnings, it's only really useful in test functions, and I for one reject any prod code that imports that package)</p>\n"}, {"comments": [{"owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "edited": false, "score": 1, "creation_date": 1576621353, "post_id": 59382687, "comment_id": 104957843, "body": "also, TIL: Go playground has support for multiple files!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1576627386, "last_edit_date": 1576627386, "creation_date": 1576619838, "answer_id": 59382687, "question_id": 59382168, "link": "https://stackoverflow.com/questions/59382168/modifying-imported-functions-in-go/59382687#59382687", "title": "modifying imported functions in go", "body": "<p>Import a different package with name \"fmt\" and implement whatever functions you need in that package. Here's an example:</p>\n\n<p>File go.mod:</p>\n\n<pre><code>module test\n</code></pre>\n\n<p>File main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"test/fmt\"\n)\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n}\n</code></pre>\n\n<p>File fmt/fmt.go:</p>\n\n<pre><code>package fmt\n\nimport (\n    \"fmt\"\n    \"log\"\n)\n\nfunc Println(format string, args ...interface{}) {\n    msg := fmt.Sprintf(format, args...)\n    log.Printf(msg)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/AryQ8cykFrG\" rel=\"nofollow noreferrer\">Run it on the playground</a>.</p>\n\n<p>The code in this answer does not modify the imported function as asked in the question.</p>\n"}], "owner": {"reputation": 972, "user_id": 9488865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d560f151faf6a0565f7cebd93958acf?s=128&d=identicon&r=PG&f=1", "display_name": "struggling_learner", "link": "https://stackoverflow.com/users/9488865/struggling-learner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 0, "accepted_answer_id": 59382687, "answer_count": 2, "score": -1, "last_activity_date": 1576627386, "creation_date": 1576617292, "last_edit_date": 1576618374, "question_id": 59382168, "link": "https://stackoverflow.com/questions/59382168/modifying-imported-functions-in-go", "title": "modifying imported functions in go", "body": "<p>I could override the builtin <code>print()</code> function's behavior by defining another <code>print()</code>  in scope, as in <a href=\"https://play.golang.org/p/Y2ly31oXU67\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Y2ly31oXU67</a> </p>\n\n<p>Is it possible in go to alter the behavior on-the-fly of an imported function, say <code>fmt.Println()</code>?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1576605096, "post_id": 59379292, "comment_id": 104951202, "body": "Either you call <a href=\"https://pkg.go.dev/os#Chtimes\" rel=\"nofollow noreferrer\"><code>os.Chtimes</code></a> or you find a package that does it for you. Either way there&#39;s no way to create files with a certain timestamps without setting those timestamps."}, {"owner": {"reputation": 63555, "user_id": 1094597, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/d42a80b4c1210d697031449b8f86df38?s=128&d=identicon&r=PG", "display_name": "kosa", "link": "https://stackoverflow.com/users/1094597/kosa"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1576607888, "post_id": 59379292, "comment_id": 104952460, "body": "@CeriseLim&#243;n Thanks. I got the date part working fine by using chtimes and modtime, but the &quot;time&quot; part is not correct. Seems UTC to EST messing up. Need to find out a way to get those corrected."}, {"owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "edited": false, "score": 0, "creation_date": 1576615750, "post_id": 59379292, "comment_id": 104955670, "body": "Use <a href=\"https://godoc.org/archive/zip#FileHeader.Modified\" rel=\"nofollow noreferrer\">Modified</a> instead of <a href=\"https://godoc.org/archive/zip#FileHeader.ModTime\" rel=\"nofollow noreferrer\">ModTime</a>."}, {"owner": {"reputation": 63555, "user_id": 1094597, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/d42a80b4c1210d697031449b8f86df38?s=128&d=identicon&r=PG", "display_name": "kosa", "link": "https://stackoverflow.com/users/1094597/kosa"}, "reply_to_user": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "edited": false, "score": 0, "creation_date": 1576616214, "post_id": 59379292, "comment_id": 104955865, "body": "@iLoveReflection I am using Modified, see the documentation describing ModTime is deprecated. Thanks!"}], "owner": {"reputation": 63555, "user_id": 1094597, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/d42a80b4c1210d697031449b8f86df38?s=128&d=identicon&r=PG", "display_name": "kosa", "link": "https://stackoverflow.com/users/1094597/kosa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 157, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1576603739, "creation_date": 1576603739, "question_id": 59379292, "link": "https://stackoverflow.com/questions/59379292/golang-unzip-retain-the-original-file-timestamp", "title": "Golang unzip retain the original file timestamp", "body": "<p>I am using approach described in <a href=\"https://stackoverflow.com/questions/20357223/easy-way-to-unzip-file-with-golang\">this answer</a> to unzip a zip file into destination directory. </p>\n\n<p>The problem I am having is, the files in destination folder (which are results of unzip) having the unzipped timestamp instead of the original \"zipped\" version file timestamp.</p>\n\n<p>Any idea how can I retain the original timestamp?</p>\n\n<p>Based on my research it seems, I might need to use something like os.Chtimes(...) function to reset the timestamp after file copy, which seems little bit cumbersome. Any suggestions?</p>\n"}, {"tags": ["go", "redis"], "comments": [{"owner": {"reputation": 3982, "user_id": 7017466, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-PZM5FgO8kcI/AAAAAAAAAAI/AAAAAAAABBc/kZTISfjStgY/photo.jpg?sz=128", "display_name": "LeoMurillo", "link": "https://stackoverflow.com/users/7017466/leomurillo"}, "edited": false, "score": 1, "creation_date": 1576600484, "post_id": 59378018, "comment_id": 104949071, "body": "You cannot evaluate if a returned score is less than max capacity in the middle of a transaction. You will need a Lua script to do that conditional incrememt. Other than that, watching some keys should work just fine. What issues are you having?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1576603146, "post_id": 59378018, "comment_id": 104950337, "body": "&quot;provide advice&quot; is pretty vague - can you narrow down your problem/question?"}, {"owner": {"reputation": 1, "user_id": 5635421, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/393e3940d367dfa1cdefeb82c5998c51?s=128&d=identicon&r=PG&f=1", "display_name": "cabdou", "link": "https://stackoverflow.com/users/5635421/cabdou"}, "edited": false, "score": 0, "creation_date": 1576606316, "post_id": 59378018, "comment_id": 104951786, "body": "See my reply in the EDIT part in the main question"}], "owner": {"reputation": 1, "user_id": 5635421, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/393e3940d367dfa1cdefeb82c5998c51?s=128&d=identicon&r=PG&f=1", "display_name": "cabdou", "link": "https://stackoverflow.com/users/5635421/cabdou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 263, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1576607274, "creation_date": 1576598818, "last_edit_date": 1576607274, "question_id": 59378018, "link": "https://stackoverflow.com/questions/59378018/multi-watch-in-golang-using-go-redis-redis", "title": "Multi WATCH in Golang using go-redis/redis", "body": "<p>I am trying to do this 4 redis calls in one transaction using <a href=\"https://github.com/go-redis/redis\" rel=\"nofollow noreferrer\">https://github.com/go-redis/redis</a> :</p>\n\n<pre><code>func getHost(key) host, score, error{\nnumberOfHosts, err := rdb.ZCard(key).Result()\nif err != nil {\nreturn nil, 0, err\n}\n\nhost, err := rdb.ZRangeByScoreWithScores(key, redis.ZRangeBy{\n    Min:    \"0\",\n    Max:    strconv.Itoa(maxScore),\n    Offset: numberOfHosts - 1,\n    Count:  1,\n}).Result()\nif err != nil {\n    return nil, 0, err\n}\n\nscore := host[0].Score\nmember, err := json.Marshal(host[0].Member)\nif err != nil {\n    return nil, 0, err\n}\n\nif int(score) &lt; maxCapacity {\n    rdb.ZIncrBy(key, score+1, string(member))\n}\n\nhost, err := rdb.GetHost(string(member))\nif err != nil {\n    return nil, 0, err\n}\nreturn host, int(score), nil\n}\n</code></pre>\n\n<p>I found this <a href=\"https://godoc.org/github.com/go-redis/redis#Client.Watch\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/go-redis/redis#Client.Watch</a> in the doc and I am trying to do something with it but it is a bit difficult at the moment.</p>\n\n<p>Is anybody already done this and can provide advice ?</p>\n\n<p>EDIT : \nI tried to do this : </p>\n\n<pre><code>count := func(key string) error {\n        txf := func(tx *redis.Tx) error {\n            numberOfHosts, err := tx.ZCard(key).Result()\n            if err != nil {\n                return err\n            }\n            numberOfHosts--\n            _, err = tx.Pipelined(func(pipe redis.Pipeliner) error {\n                getHostKey := func(key string, numberOfHosts int) error {\n                    txf := func(tx *redis.Tx) error {\n                        host, err := tx.ZRangeByScoreWithScores(key, redis.ZRangeBy{\n                            Min:    \"0\",\n                            Max:    strconv.Itoa(maxCapacity),\n                            Offset: numberOfHosts,\n                            Count:  1,\n                        }).Result()\n                        if err != nil {\n                            return err\n                        }\n                        if len(host) == 0 {\n                            return fmt.Errorf(\"Get Host did not return a host for the key: %v\", key)\n                        }\n                        score := host[0].Score\n                        member, err := json.Marshal(host[0].Member)\n                        if err != nil {\n                            return err\n                        }\n                        score++\n                        _, err = tx.Pipelined(func(pipe redis.Pipeliner) error {\n                            if int(score) &lt; maxCapacity {\n                                incScore := func(key string, score int, member string) (*Host, int, error) {\n                                    txf := func(tx *redis.Tx) error {\n                                        tx.ZIncrBy(key, score, string(member))\n                                            host, err := rc.GetHost(string(member))\n                                            if err != nil {\n                                                return nil, 0, err\n                                            }\n                                            return host, int(score), nil\n                                        }\n                                    }\n                                    err := rc.Client.Watch(txf, key)\n                                    if err != redis.TxFailedErr {\n                                        return err\n                                    }\n                                }\n                            }\n                        })\n                    }\n                    err := rc.Client.Watch(txf, key)\n                    if err != redis.TxFailedErr {\n                        return err\n                    }\n                }\n                if err := getHostKey(key, numberOfHosts); err != nil {\n                    return err\n                }\n            })\n        }\n        err := rc.Client.Watch(txf, key)\n        if err != redis.TxFailedErr {\n            return err\n        }\n    }\n\n    if err := count(key); err != nil {\n        return nil, 0, err\n</code></pre>\n\n<p>But the compiler is not happy with all the variable coming from the previous watch. </p>\n\n<p>I will look into LUA script</p>\n"}, {"tags": ["go", "locking", "buffer", "channel"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576599471, "post_id": 59374447, "comment_id": 104948569, "body": "the usual conventions is to talk about <code>buffered</code> or <code>unbuffered</code> channels. Where a <code>buffered</code> channel has a <code>buffer length &gt; 1</code>, which allows to <code>push</code> without waiting for a <code>pop</code> operation. On the other hand, as an <code>unbuffered</code> channel  has an empty buffer, every <code>push</code> operation requires a <code>pop</code> from another routine."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1576586703, "creation_date": 1576586703, "answer_id": 59374548, "question_id": 59374447, "link": "https://stackoverflow.com/questions/59374447/does-unbuffered-channel-wait-for-data/59374548#59374548", "title": "does unbuffered channel wait for data?", "body": "<p>Both <code>f1()</code> and <code>f2()</code> have receive operations. These are <em>blocking</em> operations: as long as there is nobody sending anything on the channel, they <em>wait</em>.</p>\n\n<p>So you launch <code>f1()</code> and <code>f2()</code> as new goroutines, and <code>main()</code> sleeps. Meanwhile <code>f1()</code> and <code>f2()</code> are waiting for data from <code>ch1</code> and <code>ch2</code>.</p>\n\n<p>Then <code>main()</code> wakes up, and tries to send a value on <code>ch1</code>. This is OK because there is a goroutine ready to receive from it (<code>f1()</code>). Then <code>main()</code> tries to send on <code>ch2</code>, this is also OK, there is <code>f2()</code> ready to receive from it.</p>\n\n<p>Then <code>main()</code> returns, and app ends (it does not wait for the other goroutines to print).</p>\n\n<p>If you don't launch <code>f1()</code> and <code>f2()</code> as new goroutines, when <code>main()</code> reaches the send statements, there will be nobody ready to receive from the channels, and since it is unbuffered, it will block. And since there won't be any more goroutines running, this is a deadlock.</p>\n"}], "owner": {"reputation": 5623, "user_id": 6164172, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/cfe3f1dd56fc9c05a01393d3c618d727?s=128&d=identicon&r=PG&f=1", "display_name": "Troskyvs", "link": "https://stackoverflow.com/users/6164172/troskyvs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 59374548, "answer_count": 1, "score": -1, "last_activity_date": 1576599609, "creation_date": 1576586355, "last_edit_date": 1576599609, "question_id": 59374447, "link": "https://stackoverflow.com/questions/59374447/does-unbuffered-channel-wait-for-data", "title": "does unbuffered channel wait for data?", "body": "<p>I have this program:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nvar ch1 = make(chan int)\nvar ch2 = make(chan int)\n\nfunc f1() {\n    select {\n    case &lt;-ch1:\n        fmt.Println(\"ch1\")\n    }\n}\nfunc f2() {\n    select {\n    case &lt;-ch2:\n        fmt.Println(\"ch2\")\n    }\n}\nfunc main() {\n    go f1()\n    go f2()\n    time.Sleep(2 * time.Second)\n    fmt.Println(\"no buffered channel will wait?\")\n    ch1 &lt;- 1\n    ch2 &lt;- 2\n    fmt.Println(\"main exits\")\n}\n</code></pre>\n\n<p>I expect that, as long as f1 and f2 doesn't print anything, it means ch1 and ch2 has nothing inside, so <code>ch1&lt;-1</code> and <code>ch2&lt;-2</code> should block?</p>\n\n<p>But when run, it prints:</p>\n\n<pre><code>no buffered channel will wait?\nmain exits\n</code></pre>\n\n<p>Why those unbuffered channels <code>ch1</code> and <code>ch2</code> were not blocked within main? </p>\n\n<p>If I don't call <code>f1</code>/<code>f2</code> in <code>main</code>, it will report a <code>dead lock</code> error. </p>\n\n<p>I don't understand what f1/f2 have done to ch1/ch2.</p>\n\n<p>Would you kindly help to explain their behavior?</p>\n"}, {"tags": ["go", "protocol-buffers", "go-modules", "grpc-go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1576579932, "post_id": 59372407, "comment_id": 104937971, "body": "<a href=\"https://stackoverflow.com/questions/38517593/relative-imports-in-go\">Don&#39;t use relative imports</a>"}], "answers": [{"comments": [{"owner": {"reputation": 574, "user_id": 2760976, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/0787d5de9826a64d71b2cdcedbbefe8b?s=128&d=identicon&r=PG&f=1", "display_name": "Tibin", "link": "https://stackoverflow.com/users/2760976/tibin"}, "edited": false, "score": 0, "creation_date": 1576579948, "post_id": 59372596, "comment_id": 104937979, "body": "Kewl, it woks , could you give some info where i went wrong, @Flimzy mentioned not use relative imports."}], "tags": [], "owner": {"reputation": 3269, "user_id": 429555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e970e0e5d130ae179f5cfa9b3079b76?s=128&d=identicon&r=PG", "display_name": "ferhat", "link": "https://stackoverflow.com/users/429555/ferhat"}, "is_accepted": true, "score": 2, "last_activity_date": 1576580808, "last_edit_date": 1576580808, "creation_date": 1576579750, "answer_id": 59372596, "question_id": 59372407, "link": "https://stackoverflow.com/questions/59372407/relative-import-in-go-for-protobuf-cannot-find-module-path/59372596#59372596", "title": "Relative import in Go for protobuf , cannot find module path", "body": "<p>Move your <code>go.mod</code> to the root and update import to <code>github.com/zycon/cart-service/pb</code>?</p>\n\n<p>There is no relative import in Go. You can see this answer for an extended explanation: <a href=\"https://stackoverflow.com/questions/38517593/relative-imports-in-go\">Relative imports in Go</a></p>\n\n<p>There is a proposal: <a href=\"https://github.com/golang/go/issues/20883\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/20883</a></p>\n"}], "owner": {"reputation": 574, "user_id": 2760976, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/0787d5de9826a64d71b2cdcedbbefe8b?s=128&d=identicon&r=PG&f=1", "display_name": "Tibin", "link": "https://stackoverflow.com/users/2760976/tibin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 873, "favorite_count": 0, "accepted_answer_id": 59372596, "answer_count": 1, "score": -3, "last_activity_date": 1596090315, "creation_date": 1576579063, "question_id": 59372407, "link": "https://stackoverflow.com/questions/59372407/relative-import-in-go-for-protobuf-cannot-find-module-path", "title": "Relative import in Go for protobuf , cannot find module path", "body": "<p>I'm trying to write a service in go with gRPC, and when i import the protobuff file , getting an error. i tried removing all the modules in my go path and reinitialising the go modules</p>\n\n<pre><code>build _/Users/tibinlukose/cart-service/pb: cannot find module for path _/Users/tibinlukose/cart-service/pb\n</code></pre>\n\n<p>Code</p>\n\n<pre><code>package main\n\nimport (\n    pbcart \"../pb/\"\n    \"log\"\n    \"fmt\"\n    \"google.golang.org/grpc\"\n    \"net\"\n)\n\nvar (\n    port = 1000;\n)\n\ntype CartServiceServer struct {\n}\n\nfunc main() {\n    log.SetFlags(log.LstdFlags | log.Lshortfile)\n    fmt.Println(\"Server Starting ..\")\n    lis, err := net.Listen(\"tcp\", fmt.Sprintf(\"localhost:%d\", 10000))\n    if err != nil {\n        log.Fatal(\"unable to listen on the port\")\n    }\n    serverOptions := []grpc.ServerOption{}\n    grpcServer := grpc.NewServer(serverOptions...)\n    srv := &amp;CartServiceServer{}\n    pbcart.RegisterCartServiceServer(grpcServer, srv)\n}\n</code></pre>\n\n<p>env</p>\n\n<pre><code>GOCACHE=\"/Users/tibinlukose/Library/Caches/go-build\"\nGOENV=\"/Users/tibinlukose/Library/Application Support/go/env\"\nGOPATH=\"/Users/tibinlukose/go\"\nGOROOT=\"/usr/local/Cellar/go/1.13.4/libexec\"\nGOTOOLDIR=\"/usr/local/Cellar/go/1.13.4/libexec/pkg/tool/darwin_amd64\"\nGOMOD=\"/Users/tibinlukose/cart-service/server/go.mod\"\n</code></pre>\n\n<p>repo <a href=\"https://github.com/zycon/cart-service\" rel=\"nofollow noreferrer\">https://github.com/zycon/cart-service</a></p>\n"}, {"tags": ["go", "gorp"], "comments": [{"owner": {"reputation": 2672, "user_id": 1288818, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7CfkE.jpg?s=128&g=1", "display_name": "Oleg Butuzov", "link": "https://stackoverflow.com/users/1288818/oleg-butuzov"}, "edited": false, "score": 1, "creation_date": 1576576558, "post_id": 59371476, "comment_id": 104936037, "body": "Did you check <code>err</code>?, Can you check generated SQL and confirm its working? Are that a same data you can identify row (Where clause)?"}, {"owner": {"reputation": 23, "user_id": 11727168, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-53NTedcDv04/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfl9ihMNEQ6xBHS45NgnZietr1aZA/photo.jpg?sz=128", "display_name": "Doctor Strange", "link": "https://stackoverflow.com/users/11727168/doctor-strange"}, "reply_to_user": {"reputation": 2672, "user_id": 1288818, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7CfkE.jpg?s=128&g=1", "display_name": "Oleg Butuzov", "link": "https://stackoverflow.com/users/1288818/oleg-butuzov"}, "edited": false, "score": 0, "creation_date": 1576576999, "post_id": 59371476, "comment_id": 104936295, "body": "first run <b>err</b> is nil . second run , same data but <b>err</b> is nil .   how to check ???"}], "owner": {"reputation": 23, "user_id": 11727168, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-53NTedcDv04/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfl9ihMNEQ6xBHS45NgnZietr1aZA/photo.jpg?sz=128", "display_name": "Doctor Strange", "link": "https://stackoverflow.com/users/11727168/doctor-strange"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 47, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1576576610, "creation_date": 1576575952, "last_edit_date": 1576576610, "question_id": 59371476, "link": "https://stackoverflow.com/questions/59371476/update-by-exec-with-gorp", "title": "Update by Exec with gorp", "body": "<p>I working with gorp , i used Exec to UPDATE and INSERT . </p>\n\n<pre><code>updateDataQuery = \" UPDATE time_tables SET line_code = ? , direction = ? , station_code = ? , \" +\n        \"train_number = ? , train_type = ? , dept_station_code = ? ,\" +\n        \"arrv_station_code = ? , arrv_time = ? , dept_time = ? , time_table = ? \" +\n        \"WHERE line_code = ? AND station_code = ? AND train_number = ? AND time_table = ? \"\n\nresult, err := db.Exec(updateDataQuery,Model.LineCode, Model.Direction, Model.StationCode,\n        Model.TrainNumber, Model.TrainType, Model.DeptStationCode,\n        Model.ArrvStationCode, Model.ArrvTime, Model.DeptTime, Model.TimeTable,\n        Model.LineCode, Model.StationCode, Model.TrainNumber, Model.TimeTable) \nrow, _ := result.RowsAffected()\nif row == 0 {\n// insert\n}\n</code></pre>\n\n<p>first run : row = 0 => insert</p>\n\n<p>second run : Model not change row = 0 => insert  </p>\n\n<p>how to replace data first run by data second run ? </p>\n"}, {"tags": ["go", "locking", "channel"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1576571590, "post_id": 59370232, "comment_id": 104933439, "body": "What is it you want to achieve (besides getting rid of deadlock)?"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1576580342, "last_edit_date": 1576580342, "creation_date": 1576571905, "answer_id": 59370353, "question_id": 59370232, "link": "https://stackoverflow.com/questions/59370232/how-to-fix-2-channels-dead-lock-each-other/59370353#59370353", "title": "How to fix 2 channels dead lock each other", "body": "<p>Your <code>main()</code> function tries to send on all channels, and there is only a one-time attempt to read from those channels in separate, concurrent goroutines. It's up to the goroutine scheduler if this will succeed. If the non-blocking receive in <code>f2()</code> is scheduled earlier than the send in <code>main()</code>, then the later send in <code>main()</code> will block forever (no one will attempt to receive from <code>ch2</code> again).</p>\n\n<p>One way to get rid of the deadlock is to use receive operation instead of the non-blocking receive (try it on the <a href=\"https://play.golang.org/p/X6yM0j5HOfU\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>func f1() {\n    &lt;-ch1\n    fmt.Println(\"ch1\")\n}\nfunc f2() {\n    &lt;-ch2\n    fmt.Println(\"ch2\")\n}\n</code></pre>\n\n<p>So no matter when <code>main()</code> gets to the point to send values on these channels, there will always be a receiver ready to proceed, so the <code>main()</code> won't get stuck.</p>\n\n<p>Note that when <code>main()</code> returns, the app ends, it does not wait for non-main goroutines to finish. So you might not see <code>ch1</code> and <code>ch2</code> printed on your console. For details, see <a href=\"https://stackoverflow.com/questions/28958192/no-output-from-goroutine-in-go/28958240#28958240\">No output from goroutine in Go</a>.</p>\n\n<p>If your intent is to wait for all goroutines to finish their work before your app exists, use <code>sync.WaitGroup</code> for that (try it on the <a href=\"https://play.golang.org/p/PE7kqAjM1Wy\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>var ch1 = make(chan int)\nvar ch2 = make(chan int)\n\nvar wg sync.WaitGroup\n\nfunc f1() {\n    defer wg.Done()\n    &lt;-ch1\n    fmt.Println(\"ch1\")\n}\n\nfunc f2() {\n    defer wg.Done()\n    &lt;-ch2\n    fmt.Println(\"ch2\")\n}\n\nfunc main() {\n    wg.Add(1)\n    go f1()\n    wg.Add(1)\n    go f2()\n\n    ch1 &lt;- 1\n    ch2 &lt;- 2\n    wg.Wait()\n}\n</code></pre>\n\n<p>See more examples here: <a href=\"https://stackoverflow.com/questions/48865561/solving-goroutines-deadlock/48866810#48866810\">Solving goroutines deadlock</a>; and <a href=\"https://stackoverflow.com/questions/42752705/prevent-the-main-function-from-terminating-before-goroutines-finish-in-golang/42753005#42753005\">Prevent the main() function from terminating before goroutines finish in Golang</a>.</p>\n\n<p>Another option is to give a buffer of 1 to the channels, so the <code>main()</code> can send 1 value on them without a receiver ready to receive from the channels (try this one on the <a href=\"https://play.golang.org/p/LE8L2m9kbPR\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>var ch1 = make(chan int, 1)\nvar ch2 = make(chan int, 1)\n</code></pre>\n\n<p>With this the <code>main()</code> can proceed without <code>f1()</code> and <code>f2()</code>, so again, there is no guarantee you will see anything printed.</p>\n"}, {"tags": [], "owner": {"reputation": 98, "user_id": 10993848, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hEwPt.jpg?s=128&g=1", "display_name": "Shivang Goswami", "link": "https://stackoverflow.com/users/10993848/shivang-goswami"}, "is_accepted": false, "score": 3, "last_activity_date": 1576573216, "creation_date": 1576573216, "answer_id": 59370710, "question_id": 59370232, "link": "https://stackoverflow.com/questions/59370232/how-to-fix-2-channels-dead-lock-each-other/59370710#59370710", "title": "How to fix 2 channels dead lock each other", "body": "<blockquote>\n  <p>Channels used here are unbuffered channels.<br></p>\n</blockquote>\n\n<ul>\n<li>when main goroutines starts it creates two new goroutine f1 and f2.</li>\n<li>when f1 or f2 is executed it will check whether we have value in the channel else it will print the default message and exit.</li>\n<li>In ideal situation,channels will be published with value first and then it's is received via the goroutine</li>\n<li>Actual situation is that goroutines are exiting by printing the default case but main goroutine is trying to publish value in a channel but since no receiver is there it faces a deadlock situation.</li>\n</ul>\n\n<blockquote>\n  <p>Removed deadlock from first example,\n  Refer the link:<a href=\"https://play.golang.org/p/6RuQQwC9JkA\" rel=\"nofollow noreferrer\">https://play.golang.org/p/6RuQQwC9JkA</a><br></p>\n</blockquote>\n\n<p>However,if main routine exits all the associated goroutines will be killed automatically.\nThat's why we can see that value is printed arbitrarily.</p>\n\n<blockquote>\n  <p>Removed deadlock from Second example,\n  Refer the link:<a href=\"https://play.golang.org/p/yUmc_jjZMgV\" rel=\"nofollow noreferrer\">https://play.golang.org/p/yUmc_jjZMgV</a><br></p>\n</blockquote>\n\n<p>sync.WaitGroup is making main goroutine wait that's why we can observe the output everytime our program executes.</p>\n"}], "owner": {"reputation": 5623, "user_id": 6164172, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/cfe3f1dd56fc9c05a01393d3c618d727?s=128&d=identicon&r=PG&f=1", "display_name": "Troskyvs", "link": "https://stackoverflow.com/users/6164172/troskyvs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 1, "accepted_answer_id": 59370353, "answer_count": 2, "score": 2, "last_activity_date": 1576580342, "creation_date": 1576571414, "last_edit_date": 1576579187, "question_id": 59370232, "link": "https://stackoverflow.com/questions/59370232/how-to-fix-2-channels-dead-lock-each-other", "title": "How to fix 2 channels dead lock each other", "body": "<p>I have this piece of Go code. I need to have this ability: write into channels in one place, and read them out in another place(or vice versa):</p>\n\n<pre><code>package main\nimport \"fmt\"\nvar ch1=make(chan int)\nvar ch2=make(chan int)\n\nfunc f1() {\n    select {\n    case &lt;- ch1:fmt.Println(\"ch1\")\n    default: fmt.Println(\"default\")\n    }\n}\nfunc f2() {\n    select {\n    case &lt;- ch2:fmt.Println(\"ch2\")\n    default: fmt.Println(\"default\")\n    }\n}\nfunc main() {\n    go f1()\n    go f2()\n    ch1&lt;-1\n    ch2&lt;-2\n}\n</code></pre>\n\n<p>It always prints sth like this:</p>\n\n<pre><code>default\nch1\nfatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan send]:\nmain.main()\n    /tmp/sandbox970110849/prog.go:22 +0xa0\n</code></pre>\n\n<p>Further more I tried this:</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"sync\"\n)\nvar ch1=make(chan int)\nvar ch2=make(chan int)\n\nfunc f1() {\n    select {\n    case &lt;- ch1:fmt.Println(\"ch1\")\n    default: fmt.Println(\"default\")\n    }\n}\nfunc f2() {\n    select {\n    case &lt;- ch2:fmt.Println(\"ch2\")\n    default: fmt.Println(\"default\")\n    }\n}\n\nfunc w1() {\n    ch1 &lt;-1\n}\n\nfunc w2() {\n    ch2 &lt;-1\n}\nfunc main() {\n    var wg sync.WaitGroup\n    wg.Add(4)\n    go f1()\n    go f2()\n    go w1()\n    go w2()\n    wg.Wait()\n}\n</code></pre>\n\n<p>Even more errors this time:</p>\n\n<pre><code>default\nch2\nfatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [semacquire]:\nsync.runtime_Semacquire(0x40e028, 0x0)\n    /usr/local/go/src/runtime/sema.go:56 +0x40\nsync.(*WaitGroup).Wait(0x40e020, 0x14b720)\n    /usr/local/go/src/sync/waitgroup.go:130 +0x60\nmain.main()\n    /tmp/sandbox916639182/prog.go:36 +0x100\n\ngoroutine 8 [chan send]:\nmain.w1()\n    /tmp/sandbox916639182/prog.go:23 +0x40\ncreated by main.main\n    /tmp/sandbox916639182/prog.go:34 +0xc0\n</code></pre>\n\n<p>Where did I go wrong and how to fix it?</p>\n"}, {"tags": ["go", "go-cobra"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 3, "creation_date": 1576569993, "post_id": 59369883, "comment_id": 104932686, "body": "<code>go run main.go write -d 1 -a mock -e int -- 0 2 -1</code> ?"}], "answers": [{"tags": [], "owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "is_accepted": true, "score": 3, "last_activity_date": 1576570198, "creation_date": 1576570198, "answer_id": 59369966, "question_id": 59369883, "link": "https://stackoverflow.com/questions/59369883/how-to-prevent-negative-integer-treated-as-shorthand-flag/59369966#59369966", "title": "How to prevent negative integer treated as shorthand flag", "body": "<p>It works as expected: it's impossible to distinguish between arguments and flags.</p>\n\n<p>It's the caller responsibility to make it unambiguous using <code>--</code>:</p>\n\n<pre><code>go run main.go write -d 1 -a mock -e int -- 0 2 -1 \n</code></pre>\n\n<p><code>--</code> means \"whatever comes after these dashes are arguments\"</p>\n\n<p>References:</p>\n\n<ul>\n<li><a href=\"https://github.com/spf13/cobra/issues/124\" rel=\"nofollow noreferrer\">https://github.com/spf13/cobra/issues/124</a></li>\n</ul>\n"}], "owner": {"reputation": 11904, "user_id": 608395, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/624618628f058b51b353c2e0d4735733?s=128&d=identicon&r=PG", "display_name": "andig", "link": "https://stackoverflow.com/users/608395/andig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 256, "favorite_count": 0, "accepted_answer_id": 59369966, "answer_count": 1, "score": 1, "last_activity_date": 1576570198, "creation_date": 1576569810, "last_edit_date": 1576570076, "question_id": 59369883, "link": "https://stackoverflow.com/questions/59369883/how-to-prevent-negative-integer-treated-as-shorthand-flag", "title": "How to prevent negative integer treated as shorthand flag", "body": "<p>I need to parse command line args containing negative ints, spf13/cobra is the library of choice:</p>\n\n<pre><code>go run main.go write -d 1 -a mock -e int 0 2 -1 \n</code></pre>\n\n<p>Unfortunately cobra thinks that <code>-1</code> is a shorthand flag which is of course not defined:</p>\n\n<pre><code>Error: unknown shorthand flag: '1' in -1\n</code></pre>\n\n<p>I've tried single and double quotest around <code>-1</code> with same result. How can I have cobra leave negative ints as args instead of flags?</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc"], "answers": [{"comments": [{"owner": {"reputation": 1150, "user_id": 387808, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d3375579bd368cac06f52aec517a7ca9?s=128&d=identicon&r=PG", "display_name": "littlechad", "link": "https://stackoverflow.com/users/387808/littlechad"}, "edited": false, "score": 0, "creation_date": 1576558762, "post_id": 59367808, "comment_id": 104929023, "body": "ok let me try your first solution real quick. i have tried <code>go_package=&lt;full path to proto&gt;</code> approach before  but apparently its creating the full path folders inside my <code>proto-gen</code> folder, i might have missed something along the way, but that solution doesnt seem to work"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 1150, "user_id": 387808, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d3375579bd368cac06f52aec517a7ca9?s=128&d=identicon&r=PG", "display_name": "littlechad", "link": "https://stackoverflow.com/users/387808/littlechad"}, "edited": false, "score": 0, "creation_date": 1576558872, "post_id": 59367808, "comment_id": 104929044, "body": "There was a reason I settled into this solution. I do not remember the reason. That might be it."}, {"owner": {"reputation": 1150, "user_id": 387808, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d3375579bd368cac06f52aec517a7ca9?s=128&d=identicon&r=PG", "display_name": "littlechad", "link": "https://stackoverflow.com/users/387808/littlechad"}, "edited": false, "score": 0, "creation_date": 1576558999, "post_id": 59367808, "comment_id": 104929079, "body": "i am on bitbucket, can i use bitbucket instead of github?"}, {"owner": {"reputation": 1150, "user_id": 387808, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d3375579bd368cac06f52aec517a7ca9?s=128&d=identicon&r=PG", "display_name": "littlechad", "link": "https://stackoverflow.com/users/387808/littlechad"}, "edited": false, "score": 0, "creation_date": 1576559079, "post_id": 59367808, "comment_id": 104929100, "body": "ok is it like this <code>ls proto | awk &#39;{print &quot;protoc --proto_path=bitbucket.org&#47;myapp&#47;proto bitbucket.org&#47;myapp&#47;proto&#47;&quot;$1&quot;&#47;*.proto --go_out=plugins=grpc:.&quot;}&#39; | sh</code> ?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 1150, "user_id": 387808, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d3375579bd368cac06f52aec517a7ca9?s=128&d=identicon&r=PG", "display_name": "littlechad", "link": "https://stackoverflow.com/users/387808/littlechad"}, "edited": false, "score": 0, "creation_date": 1576559137, "post_id": 59367808, "comment_id": 104929110, "body": "Use the fullpath you use to import the go package."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 1150, "user_id": 387808, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d3375579bd368cac06f52aec517a7ca9?s=128&d=identicon&r=PG", "display_name": "littlechad", "link": "https://stackoverflow.com/users/387808/littlechad"}, "edited": false, "score": 0, "creation_date": 1576559269, "post_id": 59367808, "comment_id": 104929136, "body": "What I meant is, -proto_path should point to the root of the tree, that is, if you&#39;re running protoc under bitbucket.org/myapp/proto, then --proto_path=../../.."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1576558479, "creation_date": 1576558479, "answer_id": 59367808, "question_id": 59367508, "link": "https://stackoverflow.com/questions/59367508/golang-proto-file-management-and-importing/59367808#59367808", "title": "Golang proto file management and importing", "body": "<p>The reason you got that error about <code>model</code> is because the generated files use the <code>go_package</code> of the imported file, and <code>model</code> is not a valid import path. You have to convince the generated file to use the full import path of the package.</p>\n\n<p>This is how I did it for my source tree: I have a similar tree of proto files importing each other. If your module is named, say <code>github.com/myapp</code>, then run <code>protoc</code> with <code>--proto-path=&lt;directory containing github.com&gt;</code>, import other proto files using full path, that is <code>github.com/myapp/proto/service1/service1.proto</code>, and in service1.proto, define <code>go_package = service1</code>. This setup writes the import paths correctly in my case.</p>\n\n<p>Before settling into this solution, I was using <code>go_package=&lt;full path to proto&gt;</code>, so you might give that a try as well.</p>\n"}, {"tags": [], "owner": {"reputation": 13, "user_id": 10808509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LRUOF.jpg?s=128&g=1", "display_name": "AlphaKilo", "link": "https://stackoverflow.com/users/10808509/alphakilo"}, "is_accepted": false, "score": 1, "last_activity_date": 1576607059, "creation_date": 1576607059, "answer_id": 59380047, "question_id": 59367508, "link": "https://stackoverflow.com/questions/59367508/golang-proto-file-management-and-importing/59380047#59380047", "title": "Golang proto file management and importing", "body": "<p>Building on Burak Serdar, I want to provide my implementation.</p>\n\n<p>Set the package on the proto you want to import similar to this where the location is your full path. My path is generally <code>github.com/AllenKaplan/[project]/[package]/proto/</code></p>\n\n<p><code>option go_package = [path];</code></p>\n\n<p>In the file you wish to import to add an import. My path is generally <code>[package]/proto/[package].proto</code></p>\n\n<p><code>import = [path from protoc proto path]</code></p>\n\n<p>The last part is the protoc command where <em>you must define the protopath in a way that connects the import path and option go_package path</em></p>\n\n<p>if executing from the <code>github.com/AllenKaplan/[project]</code> directory, I would call</p>\n\n<p><code>protoc -I. --go_out=./[package]/proto [package]/proto/[package].proto</code></p>\n\n<p><code>-I. === --proto_path.</code></p>\n\n<p>the <code>-I.</code> sets the protopath to the entire project</p>\n\n<hr>\n\n<p>One note, when calling <code>protoc</code> on your <code>.proto</code> files that you are importing, you will want to add <code>source_relative:</code> to the output will ensure the output is from the root with a set package. </p>\n\n<p>My implementation of the imported protoc when called from <code>github.com/AllenKaplan/[project]/[package]</code></p>\n\n<pre><code>protoc -I./proto --go_out=paths=source_relative:./proto [package].proto\n</code></pre>\n"}], "owner": {"reputation": 1150, "user_id": 387808, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d3375579bd368cac06f52aec517a7ca9?s=128&d=identicon&r=PG", "display_name": "littlechad", "link": "https://stackoverflow.com/users/387808/littlechad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3376, "favorite_count": 2, "answer_count": 2, "score": 2, "last_activity_date": 1576607059, "creation_date": 1576555730, "question_id": 59367508, "link": "https://stackoverflow.com/questions/59367508/golang-proto-file-management-and-importing", "title": "Golang proto file management and importing", "body": "<p>I have 2 grpc services (<code>service1</code> and <code>service2</code>) that interact with each other and on some cases the rpc response of <code>service1</code> will consists of a struct defined in <code>service2</code>, after going to several situations where duplication is inevitable, i figure that as the services grow these will be hard to manage, so i restructure the proto files into something like this for now</p>\n\n<pre><code>.\n\u251c\u2500\u2500 app\n...\n\u251c\u2500\u2500 proto\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 service1\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 service1.access.proto \n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 service1.proto\n\u2502   \u251c\u2500\u2500 service2\n\u2502   \u2502\u00a0\u00a0 \u251c\u2500\u2500 service2.access.proto\n\u2502   \u2502\u00a0\u00a0 \u2514\u2500\u2500 service2.proto\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 model\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 model.service1.proto\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 model.service2.proto\n\u2514\u2500\u2500 proto-gen // the protoc generated files \n \u00a0\u00a0 \u251c\u2500\u2500 service1\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 service1.access.pb.go\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 service1.pb.go\n    \u251c\u2500\u2500 service2\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 service2.access.pb.go\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 service2.pb.go\n \u00a0\u00a0 \u2514\u2500\u2500 model\n \u00a0\u00a0     \u251c\u2500\u2500 model.service1.pb.go\n \u00a0\u00a0     \u2514\u2500\u2500 model.service2.pb.go\n</code></pre>\n\n<p><code>service1</code> needs to import the model definition on <code>model/model.service2.proto</code>, so i am importing it like this</p>\n\n<pre><code>import \"model/model.service2.proto\";\n\noption go_package = \"proto-gen/service1\"; \n</code></pre>\n\n<p>and i generate the <code>.pb.go</code> files, using this <code>protoc</code> command</p>\n\n<pre><code>ls proto | awk '{print \"protoc --proto_path=proto proto/\"$1\"/*.proto --go_out=plugins=grpc:.\"}' | sh\n</code></pre>\n\n<p>the command generates the <code>.pb.go</code> files just fine, but the code on <code>service1.access.pb.go</code> doesn't seem to import the model correctly, and i don't know if it related or not but when i run the app, it throws this error</p>\n\n<pre><code>cannot load model: malformed module path \"model\": missing dot in first path element\n</code></pre>\n\n<p>i spent a few hours now googling on how can i properly import another proto file, i can't seem to find any solution</p>\n"}, {"tags": ["postgresql", "go", "prepared-statement", "heroku-postgres"], "answers": [{"tags": [], "owner": {"reputation": 357, "user_id": 4794247, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/43ea7318d308e90846522cd2b65f1ceb?s=128&d=identicon&r=PG&f=1", "display_name": "RockAndaHardPlace", "link": "https://stackoverflow.com/users/4794247/rockandahardplace"}, "is_accepted": true, "score": 0, "last_activity_date": 1576533202, "creation_date": 1576533202, "answer_id": 59364787, "question_id": 59364592, "link": "https://stackoverflow.com/questions/59364592/sql-prepare-statement-returning-syntax-error/59364787#59364787", "title": "SQL Prepare statement returning syntax error", "body": "<p>The right way of doing this is to replace the ? with $N where N is the index of the argument that is passed in as extra arguments to db.Exec()</p>\n\n<p>This new statement does not cause an error: </p>\n\n<pre><code>insForm, err := db.Prepare(\"INSERT INTO al(name, asslia, balance) VALUES( $1 , $2 , $3 )\")\n</code></pre>\n"}], "owner": {"reputation": 357, "user_id": 4794247, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/43ea7318d308e90846522cd2b65f1ceb?s=128&d=identicon&r=PG&f=1", "display_name": "RockAndaHardPlace", "link": "https://stackoverflow.com/users/4794247/rockandahardplace"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "closed_date": 1576551696, "accepted_answer_id": 59364787, "answer_count": 1, "score": 1, "last_activity_date": 1576551640, "creation_date": 1576532059, "last_edit_date": 1576551640, "question_id": 59364592, "link": "https://stackoverflow.com/questions/59364592/sql-prepare-statement-returning-syntax-error", "closed_reason": "Duplicate", "title": "SQL Prepare statement returning syntax error", "body": "<p>I am trying to insert incoming form values into my PostgreSQL database table on Heroku. This is the Go function being used: </p>\n\n<pre><code>func Insert(w http.ResponseWriter, r *http.Request) {\n    db := dbConn()\n    if r.Method == \"POST\" {\n        nameo := r.FormValue(\"name\")\n        typeo := r.FormValue(\"asslia\")\n        balanceo := r.FormValue(\"balance\")\n        insForm, err := db.Prepare(\"INSERT INTO al(name, asslia, balance) VALUES( ? , ? , ? )\")\n        if err != nil {\n            panic(err.Error())\n        }\n        insForm.Exec(nameo, typeo, balanceo)\n        log.Println(\"INSERT: Name: \" + nameo + \" | Type: \" + typeo)\n    }\n    defer db.Close()\n    http.Redirect(w, r, \"/\", 301)\n}\n</code></pre>\n\n<p>I keep getting the error <code>pq: syntax error at or near \",\"</code> at the line <code>insForm, err := db.Prepare(\"INSERT INTO al(name, asslia, balance) VALUES( ? , ? , ? )\")</code></p>\n\n<p>The table was previously created as such: </p>\n\n<pre><code>CREATE TYPE types AS ENUM ('asset', 'liability');\n\nCREATE TABLE IF NOT EXISTS al \n(id SERIAL, \nasslia TYPES, \nbalance MONEY, \nname VARCHAR(64) NOT NULL UNIQUE, \nCHECK (CHAR_LENGTH(TRIM(name)) &gt; 0));\n</code></pre>\n\n<p>What am I doing wrong? </p>\n"}, {"tags": ["sql", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 6, "creation_date": 1576526390, "post_id": 59363473, "comment_id": 104920771, "body": "Might want to add the time zones to your debugging print statements. My guess would be those times aren&#39;t all in the same TZ."}, {"owner": {"reputation": 148, "user_id": 12096585, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mChCc7Hxh4bqY4DZYrIFAlZGSiaNAjESoOHZOWV=k-s128", "display_name": "anna", "link": "https://stackoverflow.com/users/12096585/anna"}, "edited": false, "score": 1, "creation_date": 1576606495, "post_id": 59363473, "comment_id": 104951871, "body": "Can you log out the full dates w/out the formatting? I have a hunch that the other commenter is correct about the time zones thing."}], "answers": [{"tags": [], "owner": {"reputation": 1630, "user_id": 12134095, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K1trV.jpg?s=128&g=1", "display_name": "DDiamond", "link": "https://stackoverflow.com/users/12134095/ddiamond"}, "is_accepted": true, "score": 0, "last_activity_date": 1576656337, "creation_date": 1576656337, "answer_id": 59387779, "question_id": 59363473, "link": "https://stackoverflow.com/questions/59363473/golang-time-comparison-not-working-correctly/59387779#59387779", "title": "Golang time comparison not working correctly", "body": "<p>Adrian had the answer: </p>\n\n<blockquote>\n  <p>Might want to add the time zones to your debugging print statements. My guess would be those times aren't all in the same TZ. \u2013 Adrian</p>\n</blockquote>\n\n<p>SQL Server was defaulting the timezone to UTC and the rest of the times was <code>+0200</code>. I ended up making some large changes to SQL Server to set all the dates at <code>+0200</code> and all new dates entered in the correct time zone.</p>\n"}], "owner": {"reputation": 1630, "user_id": 12134095, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K1trV.jpg?s=128&g=1", "display_name": "DDiamond", "link": "https://stackoverflow.com/users/12134095/ddiamond"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 59387779, "answer_count": 1, "score": -2, "last_activity_date": 1576656337, "creation_date": 1576526271, "question_id": 59363473, "link": "https://stackoverflow.com/questions/59363473/golang-time-comparison-not-working-correctly", "title": "Golang time comparison not working correctly", "body": "<p>I am having issues with a date comparison.</p>\n\n<p><strong>Code:</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func inTimeSpan(start, end, check time.Time) bool {\n    return check.After(start) &amp;&amp; check.Before(end)\n}\n\nfunc checkTime(date string) { //Note that the date passed here is from SQL Server\n\n    formattedDate, err := time.Parse(\"2006-01-02 15:04:05\", date)\n    if err != nil {\n        log.Print(err)\n        return\n    }\n\n    now := time.Now()\n    later := now.Add(1 * time.Hour)  // 1 hour later than now\n\n    log.Print(\"Now   : \", now.Format(\"2006-01-02 15:04:05\"))\n    log.Print(\"Given : \", formattedDate.Format(\"2006-01-02 15:04:05\"))\n    log.Print(\"Later : \", later.Format(\"2006-01-02 15:04:05\"))\n\n    if inTimeSpan(now, later, formattedDate) {\n        log.Print(\"Date is in the range.\")\n    } else if formattedDate.After(later) {\n        log.Print(\"Date is not in the range. Later than 1 hour after now.\")\n    } else {\n        log.Print(\"Date is not in the range. Before now\")\n    }\n\n    return\n}\n</code></pre>\n\n<p><strong>Expected output:</strong></p>\n\n<pre><code>2019/12/15 19:31:02 Now   : 2019-12-15 19:31:02\n2019/12/15 19:31:02 Given : 2019-12-15 19:45:00\n2019/12/15 19:31:02 Later : 2019-12-15 20:31:02\n2019/12/15 19:31:02 Date is in the range.\n</code></pre>\n\n<p><strong>Actual output:</strong></p>\n\n<pre><code>2019/12/15 19:31:02 Now   : 2019-12-15 19:31:02\n2019/12/15 19:31:02 Given : 2019-12-15 19:45:00\n2019/12/15 19:31:02 Later : 2019-12-15 20:31:02\n2019/12/15 19:31:02 Date is not in the range. Later than 1 hour after now.\n</code></pre>\n\n<p>For some reason the date comparison is working as expected. Is there something I am missing?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1576528596, "post_id": 59362379, "comment_id": 104921658, "body": "What is your expected output?"}, {"owner": {"reputation": 9276, "user_id": 2409793, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/QDLY9.png?s=128&g=1", "display_name": "pkaramol", "link": "https://stackoverflow.com/users/2409793/pkaramol"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1576530569, "post_id": 59362379, "comment_id": 104922401, "body": "I have updated the question accordingly"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1576532253, "last_edit_date": 1576532253, "creation_date": 1576531901, "answer_id": 59364558, "question_id": 59362379, "link": "https://stackoverflow.com/questions/59362379/golang-tabwriter-does-not-format-appropriately/59364558#59364558", "title": "golang tabwriter does not format appropriately", "body": "<p>The problem is that you initialize the tabwriter like this:</p>\n\n<pre><code>w := tabwriter.NewWriter(os.Stdout, 20, 30, 1, '\\t', tabwriter.AlignRight)\n</code></pre>\n\n<p>2nd argument is the min cell width: <code>20</code>, 3rd is the tab width: <code>30</code>. This should correspond to a value of a printed tab width. Most systems use 4 or 8 width for a printed tab. And next argument tells to use tabs for alignment. And in this case the tabwriter assumes that 1 printed tab occupies 30 spaces (that's what the previous argument tells), which results in inaccurate calculations.<br>\nThis problem can simply be eliminated by using spaces instead of tabs for padding.</p>\n\n<p>Next: you have to use tabs after the last cell, else the tabwriter won't know it's the end of the cell and could not make them properly right-aligned.</p>\n\n<p>Going forward: inside the cluster loop you should use newline characters, because although in your example there is only a single cluster for each project, but if you'd have more, they would be printed in a single line.</p>\n\n<p>And a tip: you may use <code>tabwriter.Debug</code> flag to have cell borders printed.</p>\n\n<p>Ok, let's see your example, changed to be runnable on the Go Playground. I'm gonna use the following test data:</p>\n\n<pre><code>type Cluster struct {\n    Name             string\n    CurrentNodeCount int\n}\n\ntype Project struct {\n    ProjectId string\n    Clusters  []Cluster\n}\n\nprojects := []Project{\n    {\n        ProjectId: \"p1\",\n        Clusters: []Cluster{\n            {Name: \"p1c1\", CurrentNodeCount: 2},\n            {Name: \"p1c2\", CurrentNodeCount: 3},\n        },\n    },\n    {\n        ProjectId: \"p2\",\n        Clusters: []Cluster{\n            {Name: \"p2c1\", CurrentNodeCount: 4},\n            {Name: \"p2c2\", CurrentNodeCount: 5},\n        },\n    },\n}\n</code></pre>\n\n<p>And the processing / formatting code:</p>\n\n<pre><code>w := tabwriter.NewWriter(os.Stdout, 20, 8, 1, ' ',\n    tabwriter.Debug|tabwriter.AlignRight)\n\nfor _, v := range projects {\n    if len(v.Clusters) == 0 {\n        continue\n    }\n    fmt.Println(\"---------------------------------------------------------\")\n    fmt.Printf(\"Project\\t%s\\n\", v.ProjectId)\n    fmt.Println(\"---------------------------------------------------------\")\n    fmt.Fprintf(w, \"Cluster\\tNode Count\\t\\n\")\n    for _, p := range v.Clusters {\n        fmt.Fprintf(w, \"%s\\t%d\\t\\n\", p.Name, p.CurrentNodeCount)\n    }\n    w.Flush()\n    fmt.Printf(\"\\n\")\n}\n</code></pre>\n\n<p>Which then outputs (try it on the <a href=\"https://play.golang.org/p/ezrS5dmrdoO\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>---------------------------------------------------------\nProject p1\n---------------------------------------------------------\n             Cluster|          Node Count|\n                p1c1|                   2|\n                p1c2|                   3|\n\n---------------------------------------------------------\nProject p2\n---------------------------------------------------------\n             Cluster|          Node Count|\n                p2c1|                   4|\n                p2c2|                   5|\n</code></pre>\n\n<p>It might not be a good idea to mix \"regular\" <code>fmt</code> calls and tabwriter, both printing to the standard output.</p>\n\n<p>Also note that tabwriter can easily be substituted with just simple <code>fmt</code> formatted printing:</p>\n\n<pre><code>for _, v := range projects {\n    if len(v.Clusters) == 0 {\n        continue\n    }\n    fmt.Println(\"---------------------------------------------------------\")\n    fmt.Printf(\"Project\\t%s\\n\", v.ProjectId)\n    fmt.Println(\"---------------------------------------------------------\")\n    fmt.Printf(\"%20s|%20s|\\n\", \"Cluster\", \"Node Count\")\n    for _, p := range v.Clusters {\n        fmt.Printf(\"%20s|%20d|\\n\", p.Name, p.CurrentNodeCount)\n    }\n    fmt.Printf(\"\\n\")\n}\n</code></pre>\n\n<p>The above code will print the same without using tabwriter (try it on the <a href=\"https://play.golang.org/p/3xRuKgoQXsZ\" rel=\"nofollow noreferrer\">Go Playground</a>).</p>\n"}], "owner": {"reputation": 9276, "user_id": 2409793, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/QDLY9.png?s=128&g=1", "display_name": "pkaramol", "link": "https://stackoverflow.com/users/2409793/pkaramol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 710, "favorite_count": 0, "accepted_answer_id": 59364558, "answer_count": 1, "score": 1, "last_activity_date": 1576532253, "creation_date": 1576520973, "last_edit_date": 1576531068, "question_id": 59362379, "link": "https://stackoverflow.com/questions/59362379/golang-tabwriter-does-not-format-appropriately", "title": "golang tabwriter does not format appropriately", "body": "<p>I am following the common <a href=\"https://blog.el-chavez.me/2019/05/05/golang-tabwriter-aligned-text/\" rel=\"nofollow noreferrer\">pattern</a> about <code>go</code>'s <a href=\"https://golang.org/pkg/text/tabwriter/\" rel=\"nofollow noreferrer\"><code>tabwriter</code></a></p>\n\n<p>where the relevant writer is initialized and used to print formatted output to stdout.</p>\n\n<p>Here is my code snippet:</p>\n\n<pre><code>w := tabwriter.NewWriter(os.Stdout, 20, 30, 1, '\\t', tabwriter.AlignRight)\n\n\nfor _, v := range listProjectsResponse.Projects {\n    parent := fmt.Sprintf(\"projects/%s/locations/-\", v.ProjectId)\n    resp, err := containerService.Projects.Locations.Clusters.List(parent).Do()\n    if err != nil {\n        log.Fatalf(err.Error())\n    }\n    if len(resp.Clusters) &gt; 0 {\n        fmt.Println(\"---------------------------------------------------------\")\n        fmt.Printf(\"Project\\t%s\\n\", v.ProjectId)\n        fmt.Println(\"---------------------------------------------------------\")\n        fmt.Fprintf(w, \"Cluster\\t\\tNode Count\\n\")\n        //w.Flush()\n        for _, p := range resp.Clusters {\n            fmt.Fprintf(w, \"%s\\t%d\\t\", p.Name, p.CurrentNodeCount)\n            //w.Flush()\n        }\n        w.Flush()\n        fmt.Printf(\"\\n\")\n    }\n}\n</code></pre>\n\n<p>However it seems that the common distance between column is not being respected, as shown in the following output:</p>\n\n<pre><code>Project my-project-1\n---------------------------------------------------------\nCluster         Node Count\nmy-cluster-1  3\n---------------------------------------------------------\nProject my-project-2\n---------------------------------------------------------\nCluster         Node Count\nmy-newest-project-1       2\n---------------------------------------------------------\nProject my-project-3\n---------------------------------------------------------\nCluster         Node Count\nanothercluster 1\n</code></pre>\n\n<p>Why isn't each column keeping a fixed width (which I assume based on the initialization of the relevant writer should be 30 chars long?).\nWhere is the misconfiguration in the above code?</p>\n\n<p><strong>edit</strong>:</p>\n\n<p>What I would expect, is that each column has a fixed with, i.e. the second column (the node count) always appears in the same position (column)  as in</p>\n\n<pre><code>Project my-project-1\n---------------------------------------------------------\nCluster         Node Count\nmy-cluster-1              3\n---------------------------------------------------------\nProject my-project-2\n---------------------------------------------------------\nCluster          Node Count\nmy-newest-project-1       2\n---------------------------------------------------------\nProject my-project-3\n---------------------------------------------------------\nCluster         Node Count\nanothercluster           1\n</code></pre>\n"}, {"tags": ["go", "binary", "switch-statement", "byte", "reflect"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1576517069, "post_id": 59361310, "comment_id": 104916907, "body": "unworthy in my opinion because if you declare ret as an interface{], you got to fill it with pointer to int16/32, which later need to be dereferenced to int16/int32, thus type asserted, before it is returned."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576516825, "post_id": 59361419, "comment_id": 104916792, "body": "No, it was returning <code>interface{}</code>."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576516886, "post_id": 59361419, "comment_id": 104916820, "body": "OK.... It was returning wrapped int16/int32 within interface, you are returning wrapped pointers to int16/int32."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576516929, "post_id": 59361419, "comment_id": 104916840, "body": "Yes, that&#39;s true."}, {"owner": {"reputation": 1, "user_id": 8677187, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4oLGftYAZ9o/AAAAAAAAAAI/AAAAAAAADkw/QDAEaqydNHE/photo.jpg?sz=128", "display_name": "Matt Chapman", "link": "https://stackoverflow.com/users/8677187/matt-chapman"}, "edited": false, "score": 0, "creation_date": 1576520551, "post_id": 59361419, "comment_id": 104918406, "body": "I like the second approach. Makes me a little sad I didn&#39;t think of that. Thanks a ton."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 5, "last_activity_date": 1576520205, "last_edit_date": 1576520205, "creation_date": 1576516680, "answer_id": 59361419, "question_id": 59361310, "link": "https://stackoverflow.com/questions/59361310/how-to-simplify-switch-statement/59361419#59361419", "title": "How to simplify switch statement", "body": "<p>Sure:</p>\n\n<pre><code>var ret interface{}\nswitch t {\ncase reflect.Int16:\n    var i int16\n    ret = &amp;i\ncase reflect.Int32:\n    var i int32\n    ret = &amp;i\n}\nbuf := bytes.NewReader(byteValue)\n// NOT &amp;ret since ret is already an interface value containing a pointer\nerr := binary.Read(buf, binary.BigEndian, ret)\nif err != nil {\n    return ret, err\n}\nreturn ret, nil\n</code></pre>\n\n<p>This is always going to be a painful solution to use though, because returning <code>interface{}</code> is pretty useless - callers will always have to do assertion or type switch or reflection. What I would do in that scenario is take the value to fill instead of a <code>reflect.Kind</code> - i.e., just what <code>binary.Read</code> does:</p>\n\n<pre><code>func decoder(byteValue []byte, val interface{}) error {\n    return binary.Read(bytes.NewReader(byteValue), binary.BigEndian, val)\n}\n</code></pre>\n\n<p>Of course, that doesn't save you much repeated code, which tells you that <code>binary.Read</code> is already a pretty clean API that doesn't really need a wrapper.</p>\n"}], "owner": {"reputation": 1, "user_id": 8677187, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4oLGftYAZ9o/AAAAAAAAAAI/AAAAAAAADkw/QDAEaqydNHE/photo.jpg?sz=128", "display_name": "Matt Chapman", "link": "https://stackoverflow.com/users/8677187/matt-chapman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1576552298, "creation_date": 1576516304, "last_edit_date": 1576552298, "question_id": 59361310, "link": "https://stackoverflow.com/questions/59361310/how-to-simplify-switch-statement", "title": "How to simplify switch statement", "body": "<p>I have a decoder function that takes a byte slice and <code>reflect.Kind</code> and returns an interface and an error. The interface will be asserted when it is used in other parts of the code. Is there a way to simplify my switch statement so I don't have to repeat the NewReader, Read, and error handling in each case?</p>\n\n<p>What I have now:</p>\n\n<pre><code>func decoder(byteValue []byte, t reflect.Kind) (interface{}, error) {\n    switch t {\n    case reflect.Int16:\n        var ret int16\n        buf := bytes.NewReader(byteValue)\n        err := binary.Read(buf, binary.BigEndian, &amp;ret)\n        if err != nil {\n            return 0, err\n        }\n        return ret, nil\n    case reflect.Int32:\n        var ret int32\n        buf := bytes.NewReader(byteValue)\n        err := binary.Read(buf, binary.BigEndian, &amp;ret)\n        if err != nil {\n            return 0, err\n        }\n        return ret, nil\n    }\n}\n</code></pre>\n\n<p>What I'm looking for:</p>\n\n<pre><code>func decoder(byteValue []byte, t reflect.Kind) (interface{}, error) {\n    switch t {\n    case reflect.Int16:\n        var ret int16\n    case reflect.Int32:\n        var ret int32\n    }\n    buf := bytes.NewReader(byteValue)\n    err := binary.Read(buf, binary.BigEndian, &amp;ret)\n    if err != nil {\n        return ret, err\n    }\n    return ret, nil\n}\n</code></pre>\n\n<p>I know this wont work because <code>ret</code> is only defined in the scope of the switch case and is lost outside of it.</p>\n"}, {"tags": ["go", "tcpclient"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576515718, "post_id": 59361121, "comment_id": 104916258, "body": "just use a <code>for</code> ever loop which connects at beginning. Let Read block and timeout, adjust them, when it returns a connection lost error, just return at the beginning of the loop. You can also add a flag to detect first run, thus determine it reconnects. If the server sends a quit command, unclear, simply break out the loop."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1576515853, "post_id": 59361121, "comment_id": 104916324, "body": "in any cases, you cannot quit until read has returned."}, {"owner": {"reputation": 208, "user_id": 3143562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/y9Op3.jpg?s=128&g=1", "display_name": "mkmayank", "link": "https://stackoverflow.com/users/3143562/mkmayank"}, "edited": false, "score": 0, "creation_date": 1576515862, "post_id": 59361121, "comment_id": 104916328, "body": "reading blocks for timeout period and I won&#39;t be able to disconnect in that time interval"}, {"owner": {"reputation": 208, "user_id": 3143562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/y9Op3.jpg?s=128&g=1", "display_name": "mkmayank", "link": "https://stackoverflow.com/users/3143562/mkmayank"}, "edited": false, "score": 0, "creation_date": 1576516194, "post_id": 59361121, "comment_id": 104916466, "body": "how nc detects, is timeout is very low in case of netcat command ?"}, {"owner": {"reputation": 208, "user_id": 3143562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/y9Op3.jpg?s=128&g=1", "display_name": "mkmayank", "link": "https://stackoverflow.com/users/3143562/mkmayank"}, "edited": false, "score": 0, "creation_date": 1576517553, "post_id": 59361121, "comment_id": 104917145, "body": "I set connection time out to 1 second, so that every second there is an opportunity to quit, but still I will be available to know only after WaitInterval + PingAmount * RetryInterval , Can&#39;t I know as soon as it disconnects"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1576518748, "post_id": 59361121, "comment_id": 104917674, "body": "There is no such thing as a &quot;disconnect&quot; message in TCP. You read from a connection until it is closed. That&#39;s all there is."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1576523068, "post_id": 59361121, "comment_id": 104919480, "body": "Setup keep alive using <a href=\"https://godoc.org/net#TCPConn.SetKeepAlive\" rel=\"nofollow noreferrer\">SetKeepAlive</a> and <a href=\"https://godoc.org/net#TCPConn.SetKeepAlivePeriod\" rel=\"nofollow noreferrer\">SetKeepAlivePeriod</a>.  Read the connection until read returns an error.  That&#39;s all there is to it."}], "answers": [{"tags": [], "owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "is_accepted": false, "score": 1, "last_activity_date": 1576523958, "creation_date": 1576523958, "answer_id": 59363012, "question_id": 59361121, "link": "https://stackoverflow.com/questions/59361121/detect-tcp-connection-disconnection/59363012#59363012", "title": "Detect TCP Connection Disconnection", "body": "<p>Here is a suggested code. </p>\n\n<p>The <code>for !done</code> loop is to reconnect when the connection has been closed as long as quit wasn\u2019t closed.</p>\n\n<p>The <code>for conn != nil</code> loop is to execute the select repeatedly. </p>\n\n<p>The <code>SetDeadLine</code> is put before the <code>Read</code>. We do get a Timeout() error when the dead line kicks in. Note that I beleive that we may also get a timeout when the keep alive fails. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (s *State) spawnCtrlConnection() (quit chan struct{}) {\n    quit = make(chan struct{})\n\n    go func() {\n        var done bool\n        for !done {\n\n            // ... open connection ...\n\n            for conn != nil {\n                var buf [1]byte\n                select {\n                case &lt;-quit:\n                    conn.Close()\n                    conn = nil\n                    done = true\n                    continue\n                default:\n                    conn.SetDeadline(time.Now().Add(time.Duration(s.WaitInterval)*time.Second))\n                    _, err = conn.Read(buf[:])\n                    if err != nil {\n                        if err == io.EOF {\n                            conn.Close()\n                            conn = nil\n                            continue\n                        }\n                        if err, ok := err.(net.Error); ok &amp;&amp; err.Timeout() {\n                            continue\n                        } else {\n                            fmt.Println(\"I am here\", err.Error())\n                        }\n                    }\n                }\n            }\n        }\n    }()\n\n    return quit\n}\n</code></pre>\n"}], "owner": {"reputation": 208, "user_id": 3143562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/y9Op3.jpg?s=128&g=1", "display_name": "mkmayank", "link": "https://stackoverflow.com/users/3143562/mkmayank"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1062, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1576523958, "creation_date": 1576515494, "question_id": 59361121, "link": "https://stackoverflow.com/questions/59361121/detect-tcp-connection-disconnection", "title": "Detect TCP Connection Disconnection", "body": "<p>Problem : Client need to create tcp connection, and reconnect if for some reason connection drops, also it can be asked to disconnect anytime.</p>\n\n<p>Server is not in my hands, no data is sent on the connection, only connection establishment is required.</p>\n\n<p>My implementation using TCP keep alive, I followed <a href=\"https://thenotexpert.com/golang-tcp-keepalive/\" rel=\"nofollow noreferrer\">https://thenotexpert.com/golang-tcp-keepalive/</a></p>\n\n<pre><code>func (s *State) spawnCtrlConnection() (quit chan struct{}) {\n    quit = make(chan struct{}, 1)\n\n    go func(addr string) {\n\n        tcpAddr, err := net.ResolveTCPAddr(\"tcp\", s.addr())\n        if err != nil {\n            s.HandleError(err)\n            return\n        }\n\n        conn, err := net.DialTCP(\"tcp\", nil, tcpAddr)\n        if err != nil {\n            s.HandleError(err)\n            return\n        }\n\n        defer func() {\n            conn.Close()\n        }()\n\n        conn.SetKeepAlive(true)\n        conn.SetKeepAlivePeriod(time.Second * time.Duration(s.WaitInterval))\n\n        rawConn, err := conn.SyscallConn()\n        if err != nil {\n            s.HandleError(err)\n            return\n        }\n\n        rawConn.Control(\n            func(fdPtr uintptr) {\n                fd := int(fdPtr)\n\n                // Ping amount\n                err = syscall.SetsockoptInt(fd, syscall.IPPROTO_TCP, syscall.TCP_KEEPCNT, s.PingAmount)\n                if err != nil {\n                    s.HandleError(err)\n                    return\n                }\n                // Retry interval\n                err = syscall.SetsockoptInt(fd, syscall.IPPROTO_TCP, syscall.TCP_KEEPINTVL, s.RetryInterval)\n                if err != nil {\n                    s.HandleError(err)\n                    return\n                }\n            })\n\n        for {\n            select {\n            case &lt;-quit:\n                return\n            default:\n\n                data := make([]byte, 1)\n                _, err = conn.Read(data)\n                // it blocks here forever and (&lt;- quit will never receive anything)\n\n                // setting explicit timeout doesn't help either, as it will timeout for obvious reason\n                //  conn.SetDeadline(time.Now().Add(time.Second * time.Duration(s.WaitInterval)))\n\n                //  if err != nil {\n                //      if err, ok := err.(net.Error); ok &amp;&amp; err.Timeout() {\n                //          fmt.Println(\"timeout\", err.Error())\n                //      } else {\n                //          fmt.Println(\"I am here\", err.Error())\n                //      }\n                //  }\n\n                // WHAT SHOULD I CODE\n\n\n            }\n        }\n    }()\n    return\n}\n</code></pre>\n\n<p>I don't understand, what should I code that detect disconnection.</p>\n\n<p>May be I misunderstood the concept of tcp keep-alive.</p>\n\n<p>Please help.</p>\n"}, {"tags": ["go", "channel", "deferred", "goroutine"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576515170, "post_id": 59360995, "comment_id": 104915994, "body": "you must synchronize the program exit sequence."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1576515679, "post_id": 59360995, "comment_id": 104916241, "body": "When main exits the channel is gone, so closing it during exit is superfluous."}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1576516472, "post_id": 59360995, "comment_id": 104916605, "body": "<code>defer</code> statements in not main go routines are not executed when main terminates. When main terminates, all other running go routines are interrupted and terminated on the stop. They don\u2019t execute <code>defer</code> instructions. Note that it\u2019s not needed to close channels when main terminates."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1576527149, "post_id": 59360995, "comment_id": 104921061, "body": "First thing to understand: <i>goroutines never run defer()</i> <code>defer()</code> is run when a function exits, which is not at all the same as when an goroutine exits."}, {"owner": {"reputation": 27, "user_id": 12521135, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBJaUqVOhdv2mBfMlhnIemiSUhjml8sfVd2mOW1NA=k-s128", "display_name": "Dallin M.", "link": "https://stackoverflow.com/users/12521135/dallin-m"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1576542733, "post_id": 59360995, "comment_id": 104925978, "body": "@Flimzy, but when you start a goroutine, go explicitly requires it be a function call. Even if you use <code>go func</code>  you have to end it with parentheses <code>go func {...}()</code>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1576551476, "post_id": 59360995, "comment_id": 104927662, "body": "@DallinM.: Yes, but that goroutine could then run any number of functions, up to and including an infinite number. And each of those functions could have its own <code>defer</code>.  <code>defer</code> is a function-scoped feature. It has absolutely nothing to do with goroutines."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1576515711, "post_id": 59361145, "comment_id": 104916252, "body": "They&#39;re talking about closing on exit, so no, they won&#39;t be garbage collected. They&#39;ll just disappear, like everything else in memory when the application exits."}, {"owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1576515772, "post_id": 59361145, "comment_id": 104916285, "body": "@Adrian, sure, I addressed a broader scope just to clarify <code>chan</code>&#39;s nature."}], "tags": [], "owner": {"reputation": 2976, "user_id": 7493840, "user_type": "registered", "accept_rate": 79, "profile_image": "https://graph.facebook.com/227486944377608/picture?type=large", "display_name": "Sereja Bogolubov", "link": "https://stackoverflow.com/users/7493840/sereja-bogolubov"}, "is_accepted": true, "score": 2, "last_activity_date": 1576515870, "last_edit_date": 1576515870, "creation_date": 1576515612, "answer_id": 59361145, "question_id": 59360995, "link": "https://stackoverflow.com/questions/59360995/when-main-exits-do-goroutines-run-defer/59361145#59361145", "title": "When main exits, do goroutines run defer()?", "body": "<p>Nope, you can't. Once <code>main</code> done, the whole program is terminated. So you have to manually synchronize graceful termination, if you do need one. There are neat patterns, but that's another story.</p>\n\n<p>And yet it seems that you don't need closing at all. It is fine to keep chanels open, they are totally managed resources and will eventually be garbage-collected. Closing is more a design/intention act rather then a necessary cleanup.  </p>\n\n<p>P.S. If you <code>defer something()</code> at the <code>main</code>'s level, then indeed <code>something</code> will get executed after <code>main</code> returned. You may rely on this behavior.</p>\n"}], "owner": {"reputation": 27, "user_id": 12521135, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBJaUqVOhdv2mBfMlhnIemiSUhjml8sfVd2mOW1NA=k-s128", "display_name": "Dallin M.", "link": "https://stackoverflow.com/users/12521135/dallin-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 0, "accepted_answer_id": 59361145, "answer_count": 1, "score": 2, "last_activity_date": 1576515870, "creation_date": 1576515067, "question_id": 59360995, "link": "https://stackoverflow.com/questions/59360995/when-main-exits-do-goroutines-run-defer", "title": "When main exits, do goroutines run defer()?", "body": "<p>If I have a goroutine, can I close a channel I have open on that goroutine using something like this?</p>\n\n<p><code>defer(close())</code></p>\n\n<p>Or are defer statements not run for goroutines when main exits?</p>\n"}, {"tags": ["go", "plugins"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1576508112, "post_id": 59357609, "comment_id": 104912355, "body": "Seems cross-compilation may not work for plugins: <a href=\"https://www.reddit.com/r/golang/comments/b6h8qq/is_anyone_actually_using_go_plugins/ejkxd2k/\" rel=\"nofollow noreferrer\">reddit.com/r/golang/comments/b6h8qq/&hellip;</a>"}, {"owner": {"reputation": 1498, "user_id": 2650481, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/s3CqA.jpg?s=128&g=1", "display_name": "Adam Boczek", "link": "https://stackoverflow.com/users/2650481/adam-boczek"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1576584866, "post_id": 59357609, "comment_id": 104940481, "body": "The workaround (or better, the right way to do it) was to build and use a simplified image (only for golang 1.13) created based on this project: <a href=\"https://github.com/aws/aws-codebuild-docker-images\" rel=\"nofollow noreferrer\">github.com/aws/aws-codebuild-docker-images</a>"}], "owner": {"reputation": 1498, "user_id": 2650481, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/s3CqA.jpg?s=128&g=1", "display_name": "Adam Boczek", "link": "https://stackoverflow.com/users/2650481/adam-boczek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 425, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1576527179, "creation_date": 1576502896, "last_edit_date": 1576527179, "question_id": 59357609, "link": "https://stackoverflow.com/questions/59357609/linker-command-failed-when-building-plugin", "title": "linker command failed when building plugin", "body": "<p>When I try to build a golang plugin on macOS Catalina using go 1.13.4, the build process breaks with the following error:</p>\n\n<pre><code>$ make buildPlugin\nenv GOOS=linux go build -buildmode=plugin -o bin/common common/*.go\n# command-line-arguments\n/usr/local/Cellar/go/1.13.4/libexec/pkg/tool/darwin_amd64/link: running clang failed: exit status 1\nld: unknown option: -z\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\n\nmake: *** [buildPlugin] Error 2\n\u2718 $ go tool cgo -V\ncgo version go1.13.4\n</code></pre>\n\n<p>Removing <code>env GOOS=linux</code> helps but it is not a solution. Any ideas about the reason for this problem?</p>\n"}, {"tags": ["string", "csv", "go", "slice"], "comments": [{"owner": {"reputation": 26908, "user_id": 1192728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/481baa815383ed3970e726842195f73f?s=128&d=identicon&r=PG", "display_name": "hqt", "link": "https://stackoverflow.com/users/1192728/hqt"}, "edited": false, "score": 2, "creation_date": 1576498043, "post_id": 59356269, "comment_id": 104907187, "body": "No. it&#39;s not. There is no official definition of &quot;array&quot; in CSV. So I think there aren&#39;t any libraries support this converting."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1576503972, "last_edit_date": 1576503972, "creation_date": 1576498060, "answer_id": 59356349, "question_id": 59356269, "link": "https://stackoverflow.com/questions/59356269/parse-variable-length-array-from-csv-to-struct/59356349#59356349", "title": "Parse variable length array from csv to struct", "body": "<p><a href=\"https://en.wikipedia.org/wiki/Comma-separated_values\" rel=\"nofollow noreferrer\">CSV</a> does not have a notion of \"variable length arrays\", it is just a comma separated list of values. The format is described in <a href=\"https://tools.ietf.org/html/rfc4180\" rel=\"nofollow noreferrer\">RFC 4180</a>, and that is exactly what the <a href=\"https://golang.org/pkg/encoding/csv/\" rel=\"nofollow noreferrer\"><code>encoding/csv</code></a> package implements.</p>\n\n<p>You can only get a string slice out of a CSV line. How you interpret the values is up to you. You have to post process your data if you want to split it further.</p>\n\n<p>What you have may be simply processed with the <a href=\"https://golang.org/pkg/regexp/\" rel=\"nofollow noreferrer\"><code>regexp</code></a> package, e.g.</p>\n\n<pre><code>var r = regexp.MustCompile(`'[^']*'`)\n\nfunc split(s string) []string {\n    parts := r.FindAllString(s, -1)\n    for i, part := range parts {\n        parts[i] = part[1 : len(part)-1]\n    }\n    return parts\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>s := `['one', 'two', 'three']`\nfmt.Printf(\"%q\\n\", split(s))\ns = `[]`\nfmt.Printf(\"%q\\n\", split(s))\ns = `['o,ne', 't,w,o', 't,,hree']`\nfmt.Printf(\"%q\\n\", split(s))\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/QDxwR0xMSck\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[\"one\" \"two\" \"three\"]\n[]\n[\"o,ne\" \"t,w,o\" \"t,,hree\"]\n</code></pre>\n\n<p>Using this <code>split()</code> function, this is how processing may look like:</p>\n\n<pre><code>for _, line := range lines {\n    data := CsvLine{\n        Id:     line[0],\n        Array1: split(line[1]),\n        Array2: split(line[2]),\n    }\n    fmt.Printf(\"%+v\\n\", data)\n}\n</code></pre>\n\n<p>This outputs (try it on the <a href=\"https://play.golang.org/p/927XCna4A-x\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>{Id:594385903dss Array1:[fhjdsk dfjdskl fkdsjgooiertio] Array2:[jflkdsjfl fkjdlsfjdslkfjldks]}\n{Id:87764385903dss Array1:[cxxc wqeewr opi iy qw] Array2:[cvbvc gf mnb ewr]}\n</code></pre>\n"}], "owner": {"reputation": 1294, "user_id": 3939059, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ede6e5871a5dbaa20848216bb42554a?s=128&d=identicon&r=PG&f=1", "display_name": "user3939059", "link": "https://stackoverflow.com/users/3939059/user3939059"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 59356349, "answer_count": 1, "score": 0, "last_activity_date": 1576503972, "creation_date": 1576497799, "last_edit_date": 1576498522, "question_id": 59356269, "link": "https://stackoverflow.com/questions/59356269/parse-variable-length-array-from-csv-to-struct", "title": "Parse variable length array from csv to struct", "body": "<p>I have the following setup to parse a csv file:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"encoding/csv\"\n)\n\ntype CsvLine struct {\n    Id string\n    Array1 [] string\n    Array2 [] string\n}\n\n\nfunc ReadCsv(filename string) ([][]string, error) {\n\n    f, err := os.Open(filename)\n    if err != nil {\n        return [][]string{}, err\n    }\n    defer f.Close()\n\n    lines, err := csv.NewReader(f).ReadAll()\n    if err != nil {\n        return [][]string{}, err\n    }\n    return lines, nil\n}\n\n\nfunc main() {\n\n    lines, err := ReadCsv(\"./data/sample-0.3.csv\")\n    if err != nil {\n        panic(err)\n    }\n\n    for _, line := range lines {\n                fmt.Println(line)\n        data := CsvLine{\n            Id: line[0],\n            Array1: line[1],\n            Array2: line[2],\n        }\n        fmt.Println(data.Id)\n        fmt.Println(data.Array1)\n        fmt.Println(data.Array2)\n    }\n}\n</code></pre>\n\n<p>And the following setup in my csv file:</p>\n\n<pre><code>594385903dss,\"['fhjdsk', 'dfjdskl', 'fkdsjgooiertio']\",\"['jflkdsjfl', 'fkjdlsfjdslkfjldks']\"\n87764385903dss,\"['cxxc', 'wqeewr', 'opi', 'iy', 'qw']\",\"['cvbvc', 'gf', 'mnb', 'ewr']\"\n\n</code></pre>\n\n<p>My understanding is that variable length lists should be parsed into a slice, is it possible to do this directly via a csv reader? (The csv output was generated via a python project.)</p>\n\n<p>Help/suggestions appreciated. </p>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 4, "creation_date": 1576492660, "post_id": 59354616, "comment_id": 104904501, "body": "1. you cannot send <code>true</code> through <code>ch</code> which is <code>chan string</code>. please edit the code. 2. order matters. Your code that tries to receive must receive <code>folderName</code> first, since you send through <code>folderName</code> first, otherwise both gorotine will block. 3. Instead of using multiple channels, you can pack your data into a struct and have a single channel, which usually reduce confusion."}, {"owner": {"reputation": 1815, "user_id": 4155956, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/0ea0d3923ae412e2e921df82b6108ed9?s=128&d=identicon&r=PG", "display_name": "samix73", "link": "https://stackoverflow.com/users/4155956/samix73"}, "edited": false, "score": 0, "creation_date": 1576532217, "post_id": 59354616, "comment_id": 104922990, "body": "I would also appreciate it if you would accept the answer if it has served the purpose :)"}], "answers": [{"comments": [{"owner": {"reputation": 2105, "user_id": 5821408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0f6ca899d084f02ac63e71e9e8711046?s=128&d=identicon&r=PG&f=1", "display_name": "shmsr", "link": "https://stackoverflow.com/users/5821408/shmsr"}, "edited": false, "score": 2, "creation_date": 1576511561, "post_id": 59355465, "comment_id": 104914124, "body": "Hey, you never hit the <code>if &quot;Some text&quot; == &quot;closed&quot;</code> block. As soon as <code>ch</code> and <code>folderName</code>  channels get their value, the other goroutine resume and prints the value.  I just thought to give you guys some heads up. The motive of the answer is surely served; if we modify the code so that if block works, but then again a problem will arise that we are closing the channel <code>close(folderName)</code> but inside the other goroutine we are (receiving) <code>&lt;-folderName</code> it, which might result in deadlock. So, be careful."}], "tags": [], "owner": {"reputation": 1815, "user_id": 4155956, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/0ea0d3923ae412e2e921df82b6108ed9?s=128&d=identicon&r=PG", "display_name": "samix73", "link": "https://stackoverflow.com/users/4155956/samix73"}, "is_accepted": false, "score": 3, "last_activity_date": 1576532134, "last_edit_date": 1576532134, "creation_date": 1576494672, "answer_id": 59355465, "question_id": 59354616, "link": "https://stackoverflow.com/questions/59354616/cannot-get-the-multiple-channel-values-in-go-routines/59355465#59355465", "title": "Cannot get the multiple channel values in go routines", "body": "<p>In your case since your reading a single message from the <code>websocket.Connection</code> you need to change the sequence in which you read from the channels since your channels are unbuffered your writes will be blocked as longs as there are no consumers and vice versa.\nIn your case, you write to the <code>folderName</code> channel in the first goroutine and then read from the other channel <code>ch</code> so both of your goroutines will be blocked.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    ch := make(chan bool)\n    folderName := make(chan string)\n\n    go func() {\n        ch &lt;- true\n        folderName &lt;- \"Some text\"\n\n        .\n                .\n                .\n    }()\n\n    go func() {\n        value := &lt;-ch\n        fldr := &lt;-folderName\n\n        fmt.Println(fldr, value)\n    }()\n\n    time.Sleep(time.Second)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/rQr5Y2rnXUL\" rel=\"nofollow noreferrer\">Playground example</a></p>\n"}], "owner": {"reputation": 233, "user_id": 8198255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/397363516ab15fee72d9cee5fec024b9?s=128&d=identicon&r=PG&f=1", "display_name": "az rnd", "link": "https://stackoverflow.com/users/8198255/az-rnd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1576532134, "creation_date": 1576491709, "last_edit_date": 1576509351, "question_id": 59354616, "link": "https://stackoverflow.com/questions/59354616/cannot-get-the-multiple-channel-values-in-go-routines", "title": "Cannot get the multiple channel values in go routines", "body": "<p>I have written 2 goroutines for web socket read and write the message. For Example, </p>\n\n<pre><code>ch := make(chan bool)\nfolderName := make(chan string)\n\ngo func(co *websocket.Conn) {\n    m, d, err := co.ReadMessage()\n    fmt.Println(m, string(d), err)\n\n    folderName &lt;- string(d)\n    ch &lt;- true\n\n    if string(d) == \"closed\" {\n        ch &lt;- true\n        co.Close()\n    }\n}(conn)\n</code></pre>\n\n<p>This goroutine is used to read the message from the socket and update the channels.</p>\n\n<pre><code>go func(co *websocket.Conn) {\n    value := &lt;-ch\n    fldr := &lt;-folderName\n\n    fmt.Println(fldr, value)\n}(conn)\n</code></pre>\n\n<p>This goroutine is for writing the message. But I couldn't get folderName and ch channel values. I don't know how to find the issues.</p>\n\n<p>If I pass the single channel, I can get a message from the channel. But I need to get 2 values in that goroutine.</p>\n\n<p>Could anyone help to resolve the issues? Thanks in advance.</p>\n"}, {"tags": ["go", "arangodb"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 4764670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e237b9d23940c1445069836a33b5b7ab?s=128&d=identicon&r=PG&f=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/4764670/victor"}, "edited": false, "score": 0, "creation_date": 1576597478, "post_id": 59367041, "comment_id": 104947493, "body": "I will call those executables from Go. Thank you for your help"}], "tags": [], "owner": {"reputation": 1886, "user_id": 364157, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LZ6oI.jpg?s=128&g=1", "display_name": "David Thomas", "link": "https://stackoverflow.com/users/364157/david-thomas"}, "is_accepted": false, "score": 0, "last_activity_date": 1576551642, "creation_date": 1576551642, "answer_id": 59367041, "question_id": 59354307, "link": "https://stackoverflow.com/questions/59354307/dump-arangodb-database-with-go/59367041#59367041", "title": "Dump Arangodb database with Go", "body": "<p>The best way is to use the arangodump and arangorestore tools provided by ArangoDB to dump and restore a database.</p>\n\n<p>If needed, call those executables from Go.</p>\n\n<p>ArangoDump: <a href=\"https://www.arangodb.com/docs/stable/programs-arangodump.html\" rel=\"nofollow noreferrer\">https://www.arangodb.com/docs/stable/programs-arangodump.html</a></p>\n\n<p>ArangoRestore: <a href=\"https://www.arangodb.com/docs/stable/programs-arangorestore.html\" rel=\"nofollow noreferrer\">https://www.arangodb.com/docs/stable/programs-arangorestore.html</a></p>\n"}], "owner": {"reputation": 21, "user_id": 4764670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e237b9d23940c1445069836a33b5b7ab?s=128&d=identicon&r=PG&f=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/4764670/victor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576551642, "creation_date": 1576490590, "last_edit_date": 1576491699, "question_id": 59354307, "link": "https://stackoverflow.com/questions/59354307/dump-arangodb-database-with-go", "title": "Dump Arangodb database with Go", "body": "<p>I would like to know if I can dump an ArangoDB with Go.\nI know how to use ArangoDB Go driver but there is no example which show how to dump the db.</p>\n\n<p>I also aware about how to download the database on the command line.</p>\n"}, {"tags": ["docker", "go", "docker-compose"], "comments": [{"owner": {"reputation": 4438, "user_id": 1287899, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9626e5ccaaecaa83f3600427f271bfc8?s=128&d=identicon&r=PG", "display_name": "Ahmed Hashem", "link": "https://stackoverflow.com/users/1287899/ahmed-hashem"}, "edited": false, "score": 1, "creation_date": 1576491496, "post_id": 59353840, "comment_id": 104903942, "body": "i think you need to checkout the specific tag <code>v2.0.0</code>"}, {"owner": {"reputation": 1294, "user_id": 3939059, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ede6e5871a5dbaa20848216bb42554a?s=128&d=identicon&r=PG&f=1", "display_name": "user3939059", "link": "https://stackoverflow.com/users/3939059/user3939059"}, "reply_to_user": {"reputation": 4438, "user_id": 1287899, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9626e5ccaaecaa83f3600427f271bfc8?s=128&d=identicon&r=PG", "display_name": "Ahmed Hashem", "link": "https://stackoverflow.com/users/1287899/ahmed-hashem"}, "edited": false, "score": 0, "creation_date": 1576492131, "post_id": 59353840, "comment_id": 104904248, "body": "<code>package github.com&#47;gocolly&#47;colly@[v2.0.0]: invalid github.com&#47; import path &quot;github.com&#47;gocolly&#47;colly@[v2.0.0]&quot;</code>"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1576680038, "post_id": 59353840, "comment_id": 104977999, "body": "May I ask if there is a specific reason why you use Go 1.7, and do not use go modules?"}], "answers": [{"comments": [{"owner": {"reputation": 1294, "user_id": 3939059, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ede6e5871a5dbaa20848216bb42554a?s=128&d=identicon&r=PG&f=1", "display_name": "user3939059", "link": "https://stackoverflow.com/users/3939059/user3939059"}, "edited": false, "score": 0, "creation_date": 1579442981, "post_id": 59396047, "comment_id": 105760375, "body": "thanks for this, do I need to run <code>go get github.com&#47;gocolly&#47;colly</code> on the host machine first? Im not quite grasping where the package gets pulled into the container. (I am running this with docker-compose)"}], "tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 0, "last_activity_date": 1576685595, "creation_date": 1576685595, "answer_id": 59396047, "question_id": 59353840, "link": "https://stackoverflow.com/questions/59353840/installing-package-with-docker-compose/59396047#59396047", "title": "Installing package with docker-compose", "body": "<p>Basically your problem is that you are referencing a module path (the <code>v2</code> gives it away), which <a href=\"https://github.com/gocolly/colly/issues/417\" rel=\"nofollow noreferrer\">seems to be broken</a> as of the time of this writing.</p>\n\n<p>However, with a few tweaks and corrections, your project runs:</p>\n\n<h2><code>main.go</code></h2>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    // Note the version suffix \"/v2\" is gone\n    // This installs the v1.2.0 version, but apparently, this works, too\n    \"github.com/gocolly/colly\"\n    \"github.com/golang/example/stringutil\"\n)\n\nfunc main() {\n    fmt.Println(stringutil.Reverse(\"!selpmaxe oG ,olleH\"))\n\n    // Limit the domains for the sake of the example\n    c := colly.NewCollector(colly.AllowedDomains(\"go-colly.org\"))\n\n    // Find and visit all links\n    c.OnHTML(\"a[href]\", func(e *colly.HTMLElement) {\n        e.Request.Visit(e.Attr(\"href\"))\n    })\n\n    c.OnRequest(func(r *colly.Request) {\n        fmt.Println(\"Visiting\", r.URL)\n    })\n\n    c.Visit(\"http://go-colly.org/\")\n\n}\n</code></pre>\n\n<p>Now simply call</p>\n\n<pre><code>go mod init stackoverflow.com/user3939059/crawler\n</code></pre>\n\n<p>(of course, you should adjust the names of the domain and the user)</p>\n\n<h2><code>Dockerfile</code></h2>\n\n<p>While you <em>can</em> do a <code>go run main.go</code> in a Docker image based on a \"golang\" image, this is simply inefficient. It is better to statically compile your application and you can even use the empty scratch image as a base to run your application:</p>\n\n<pre><code>FROM golang:alpine as builder\n\nADD . /go/src/crawler\nWORKDIR /go/src/crawler\nRUN \\\n       apk add --no-cache tzdata &amp;&amp; \\\n       adduser -D -g '' appuser\n\n# Statically compile our application\nRUN GOOS=linux GOARCH=amd64 CGO_ENABLED=0 go build -ldflags=\"-w -s\" -a -installsuffix cgo -o /crawler\n\n\nFROM scratch\n# Import the files required by the standard library from builder.\nCOPY --from=builder /usr/share/zoneinfo /usr/share/zoneinfo\nCOPY --from=builder /etc/ssl/certs/ca-certificates.crt  /etc/ssl/certs/\n\n# Make sure the user can be identified by the docker daemon\nCOPY --from=builder /etc/passwd /etc/passwd\n# Copy our static executable\nCOPY --from=builder /crawler /bin/crawler\n# Use an unprivileged user.\nUSER appuser\n# Run the binary.\nCMD [\"/bin/crawler\"]\n</code></pre>\n\n<p>With the above changes and after a <code>docker build -t user3939059/crawler:latest .</code> you can run the image:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ docker run --rm user3939059/crawler\nHello, Go examples!\nVisiting http://go-colly.org/\nVisiting http://go-colly.org/docs/\nVisiting http://go-colly.org/articles/\nVisiting http://go-colly.org/services/\nVisiting http://go-colly.org/datasets/\nVisiting http://go-colly.org/data/factbase_transcripts.tar.bz2\nVisiting http://go-colly.org/docs/examples/factbase/\nVisiting http://go-colly.org/docs/introduction/install/\nVisiting http://go-colly.org/docs/introduction/start/\nVisiting http://go-colly.org/docs/introduction/configuration/\nVisiting http://go-colly.org/docs/best_practices/debugging/\nVisiting http://go-colly.org/docs/best_practices/distributed/\nVisiting http://go-colly.org/docs/best_practices/storage/\nVisiting http://go-colly.org/docs/best_practices/multi_collector/\nVisiting http://go-colly.org/docs/best_practices/crawling/\nVisiting http://go-colly.org/docs/best_practices/extensions/\nVisiting http://go-colly.org/docs/examples/basic/\nVisiting http://go-colly.org/docs/examples/error_handling/\nVisiting http://go-colly.org/docs/examples/login/\nVisiting http://go-colly.org/docs/examples/max_depth/\nVisiting http://go-colly.org/docs/examples/multipart/\nVisiting http://go-colly.org/docs/examples/parallel/\nVisiting http://go-colly.org/docs/examples/proxy_switcher/\nVisiting http://go-colly.org/docs/examples/queue/\nVisiting http://go-colly.org/docs/examples/random_delay/\nVisiting http://go-colly.org/docs/examples/rate_limit/\nVisiting http://go-colly.org/docs/examples/redis_backend/\nVisiting http://go-colly.org/docs/examples/request_context/\nVisiting http://go-colly.org/docs/examples/scraper_server/\nVisiting http://go-colly.org/docs/examples/url_filter/\nVisiting http://go-colly.org/docs/examples/cryptocoinmarketcap/\nVisiting http://go-colly.org/docs/examples/coursera_courses/\nVisiting http://go-colly.org/docs/examples/google_groups/\nVisiting http://go-colly.org/docs/examples/hackernews_comments/\nVisiting http://go-colly.org/docs/examples/instagram/\nVisiting http://go-colly.org/docs/examples/openedx_courses/\nVisiting http://go-colly.org/docs/examples/reddit/\nVisiting http://go-colly.org/docs/examples/shopify_sitemap/\nVisiting http://go-colly.org/docs/examples/xkcd_store/\nVisiting http://go-colly.org/contact/\nVisiting http://go-colly.org/sitemap.xml\nVisiting http://go-colly.org/docs/examples/coursera_courses\nVisiting http://go-colly.org/docs/examples/redis_backend\nVisiting http://go-colly.org/docs/best_practices/storage\nVisiting http://go-colly.org/docs/examples/scraper_server\nVisiting http://go-colly.org/data/cryptocoin_market_cap.csv\nVisiting http://go-colly.org/data/coursera_courses.json\nVisiting http://go-colly.org/data/xkcd_store_items.csv\nVisiting http://go-colly.org/contact\nVisiting http://go-colly.org/articles/first_release/\nVisiting http://go-colly.org/articles/scraping_related_http_headers/\nVisiting http://go-colly.org/articles/nonprofit/\nVisiting http://go-colly.org/articles/how_to_scrape_instagram/\nVisiting http://go-colly.org/articles/scraping_tips/\n</code></pre>\n"}], "owner": {"reputation": 1294, "user_id": 3939059, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/1ede6e5871a5dbaa20848216bb42554a?s=128&d=identicon&r=PG&f=1", "display_name": "user3939059", "link": "https://stackoverflow.com/users/3939059/user3939059"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 375, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1576685595, "creation_date": 1576488816, "last_edit_date": 1576488845, "question_id": 59353840, "link": "https://stackoverflow.com/questions/59353840/installing-package-with-docker-compose", "title": "Installing package with docker-compose", "body": "<p>Looking for some help installing Go packages during the build process in docker-compose. Specifically Go Colly. </p>\n\n<p>The setup:</p>\n\n<p><code>docker-compose.yml</code></p>\n\n<pre><code>services:\n  crawler:\n    container_name: crawler\n    build: ./crawler/\n    working_dir: /go/src/crawler\n    volumes:\n      - ./data:/go/src/crawler/data\n      - ./crawler:/go/src/crawler\n</code></pre>\n\n<p><code>Dockerfile</code></p>\n\n<pre><code>FROM golang:1.7-alpine\n\nADD . /go/src/crawler\nWORKDIR /go/src/crawler\n\nRUN \\\n       apk add --no-cache bash git openssh &amp;&amp; \\\n       go get github.com/golang/example/stringutil/... &amp;&amp; \\\n       go get github.com/gocolly/colly/... &amp;&amp; \\\n       go install\n\nCMD [\"go\",\"run\",\"collect.go\"]\n</code></pre>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/golang/example/stringutil\"\n        \"github.com/gocolly/colly/v2\"\n)\n\nfunc main() {\n    fmt.Println(stringutil.Reverse(\"!selpmaxe oG ,olleH\"))\n    c := colly.NewCollector()\n\n    // Find and visit all links\n    c.OnHTML(\"a[href]\", func(e *colly.HTMLElement) {\n        e.Request.Visit(e.Attr(\"href\"))\n    })\n\n    c.OnRequest(func(r *colly.Request) {\n        fmt.Println(\"Visiting\", r.URL)\n    })\n\n    c.Visit(\"http://go-colly.org/\")\n\n}\n</code></pre>\n\n<p>If I run the project without Colly, ie. just <code>\"github.com/golang/example/stringutil\"</code> then the project installs the package and runs correctly, however with Colly I get:</p>\n\n<pre><code>OK: 34 MiB in 25 packages\npackage github.com/gocolly/colly\n    imports github.com/gocolly/colly/v2/debug: cannot find package \"github.com/gocolly/colly/v2/debug\" in any of:\n    /usr/local/go/src/github.com/gocolly/colly/v2/debug (from $GOROOT)\n    /go/src/github.com/gocolly/colly/v2/debug (from $GOPATH)\npackage github.com/gocolly/colly\n    imports github.com/gocolly/colly/v2/storage: cannot find package \"github.com/gocolly/colly/v2/storage\" in any of:\n    /usr/local/go/src/github.com/gocolly/colly/v2/storage (from $GOROOT)\n    /go/src/github.com/gocolly/colly/v2/storage (from $GOPATH)\npackage github.com/gocolly/colly/extensions\n    imports github.com/gocolly/colly/v2: cannot find package \"github.com/gocolly/colly/v2\" in any of:\n    /usr/local/go/src/github.com/gocolly/colly/v2 (from $GOROOT)\n    /go/src/github.com/gocolly/colly/v2 (from $GOPATH)\nERROR: Service 'crawler' failed to build: The command '/bin/sh -c apk add --no-cache bash git openssh &amp;&amp;        go get github.com/golang/example/stringutil/... &amp;&amp;        go get github.com/gocolly/colly/... &amp;&amp;        go install' returned a non-zero code: 1\n</code></pre>\n\n<p>My initial thoughts are that mounting <code>- ./crawler:/go/src/crawler</code> is overwriting the packages, but then I am confused as to why <code>github.com/golang/example/stringutil</code> works fine.</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 18287, "user_id": 1029453, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/x570w.jpg?s=128&g=1", "display_name": "Richard Huxton", "link": "https://stackoverflow.com/users/1029453/richard-huxton"}, "edited": false, "score": 0, "creation_date": 1576491957, "post_id": 59353838, "comment_id": 104904167, "body": "You will need to tell people what database library you are using. If it supports PostgreSQL&#39;s more sophisticated data types then it will probably need you to explicitly define a mapping."}, {"owner": {"reputation": 3221, "user_id": 2245634, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/OHoy2.jpg?s=128&g=1", "display_name": "Amit\u0101bha", "link": "https://stackoverflow.com/users/2245634/amit%c4%81bha"}, "reply_to_user": {"reputation": 18287, "user_id": 1029453, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/x570w.jpg?s=128&g=1", "display_name": "Richard Huxton", "link": "https://stackoverflow.com/users/1029453/richard-huxton"}, "edited": false, "score": 0, "creation_date": 1576492178, "post_id": 59353838, "comment_id": 104904266, "body": "@RichardHuxton thanks,i added the library description"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1576506718, "post_id": 59353838, "comment_id": 104911591, "body": "You have a struct with multiple un-exported fields. How is that supposed to be serialized into the query?"}], "answers": [{"comments": [{"owner": {"reputation": 18287, "user_id": 1029453, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/x570w.jpg?s=128&g=1", "display_name": "Richard Huxton", "link": "https://stackoverflow.com/users/1029453/richard-huxton"}, "edited": false, "score": 0, "creation_date": 1576532789, "post_id": 59360216, "comment_id": 104923233, "body": "I&#39;m not really a go user, and it has been a year or so since I looked at the state of the PostgreSQL drivers. I must admit I was disappointed at the different weaknesses of all the options at the time. Particularly since go seemed so clumsy when it came to writing your own parsers."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1576534140, "last_edit_date": 1576534140, "creation_date": 1576512291, "answer_id": 59360216, "question_id": 59353838, "link": "https://stackoverflow.com/questions/59353838/go-insert-composite-type-array-unsupported-type/59360216#59360216", "title": "go insert composite type array unsupported type", "body": "<p>Note that custom composite types are not <em>fully</em> supported by <code>lib/pq</code>.</p>\n\n<p>If all you want is to be able to store the urls then the simplest approach would be to implement the <code>driver.Valuer</code> interface on the <code>url</code> type and then use it as you do with <code>pq.Array</code>:</p>\n\n<pre><code>func (u url) Value() (driver.Value, error) {\n    return fmt.Sprintf(\"(%s,%d)\", u.url, u.status), nil\n}\n\n// ...\nr, err := db.Exec(update, pq.Array(urls), href)\n</code></pre>\n\n<p>more info on that can be found here: <a href=\"https://github.com/lib/pq/issues/544\" rel=\"nofollow noreferrer\">https://github.com/lib/pq/issues/544</a></p>\n\n<p>Note that I haven't tried this with arrays, only with slices, so you may have to switch from using an array to using a slice, i.e. instead of <code>var urls [1]url</code> you would use <code>var urls = make([]url, 1)</code>.</p>\n\n<hr>\n\n<p>If you also want to be able to retrieve the array of urls back from the db, then you'll have to implement the <code>sql.Scanner</code> interface, however here the <code>pq.Array</code> is not very reliable and you'll have to implement the scanner on the slice type and do all the parsing yourself.</p>\n\n<p>The general format of composite types is <code>(val1, val2, ...)</code> note that you have to put double quotes around values that contain commas or parentheses. For example to construct a value of the url type you would use the literal expression: <code>(http://example.com,4)</code>. More info in the <a href=\"https://www.postgresql.org/docs/9.6/rowtypes.html#AEN8147\" rel=\"nofollow noreferrer\">docs</a>.</p>\n\n<p>The format for an <em>array</em> of composite types is <code>{\"(val1, val2, ...)\" [, ...]}</code>, note that in this case if you need to put double quotes around the values you need to escape them. For example <code>{\"(http://example.com,4)\",\"(\\\"http://example.com/?list=foo,bar,baz\\\",3)\"}</code></p>\n\n<p>So as you can see the more complex the data in the composite type the more complex will be the parsing as well.</p>\n\n<p>Here's a crude example (does not handle quoted values):</p>\n\n<pre><code>type urlslice []url\n\nfunc (s *urlslice) Scan(src interface{}) error {\n    var a []byte // the pq array as bytes\n    switch v := src.(type) {\n    case []byte:\n        a = v\n    case string:\n        a = []byte(v)\n    case nil:\n        *s = nil\n        return nil\n    default:\n        return fmt.Errorf(\"urlslice.Scan unexpected src type %T\", src)\n    }\n\n    a = a[1 : len(a)-1] // drop curly braces\n    for i := 0; i &lt; len(a); i++ {\n        if a[i] == '\"' &amp;&amp; (len(a) &gt; (i+1) &amp;&amp; a[i+1] == '(') { // element start?\n            i += 2 // move past `\"(`\n            j := i // start of url.url\n            u := url{}\n\n            for ; i &lt; len(a) &amp;&amp; a[i] != ','; i++ {\n            }\n            u.url = string(a[j:i])\n\n            i += 1 // move past `,`\n            j = i  // start of url.status\n            for ; i &lt; len(a) &amp;&amp; a[i] != ')'; i++ {\n            }\n            i64, err := strconv.ParseInt(string(a[j:i]), 10, 64)\n            if err != nil {\n                return err\n            }\n            u.status = int(i64)\n            *s = append(*s, u)\n\n            i += 2 // move past `)\",`\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<p>for completeness, here's the Valuer interface implemented by the slice type, again not handling proper quoting of values that may require it:</p>\n\n<pre><code>func (s urlslice) Value() (driver.Value, error) {\n    data := []byte{'{'}\n    for _, url := range s {\n        data = append(data, '\"', '(')\n        data = append(data, []byte(url.url)...)\n        data = append(data, ',')\n        data = strconv.AppendInt(data, int64(url.status), 10)\n        data = append(data, ')', '\"', ',')\n    }\n    data[len(data)-1] = '}' // replace last ',' with '}' to close the array\n    return data, nil\n}\n</code></pre>\n\n<p>With the <code>urlslice</code> implementing the two interfaces directly you can stop using <code>pq.Array</code>.</p>\n\n<pre><code>var urls = urlslice{{\n    url:    \"http://example.com\",\n    status: 4,\n}}\nupdate := `UPDATE \"public\".\"tiantang_page\" SET \"urls\"=$1 where \"href\"=$2`\nr, err := db.Exec(update, urls, href)\nif err != nil {\n    log.Fatal(err)\n}\n\nvar urls2 urlslice\nselurls := `SELECT \"urls\" FROM \"public\".\"tiantang_page\" where \"href\" = $1`\nif err := db.QueryRow(selurls, href).Scan(&amp;urls2); err != nil {\n     log.Fatal(err)\n}\n</code></pre>\n\n<hr>\n\n<p>Please keep in mind that both of the above examples should be considered only as <em>hints</em> of the direction to take in solving this problem. Not only are the two examples incomplete in that they don't handle quoted values, but they are also not very elegant implementations.</p>\n"}, {"tags": [], "owner": {"reputation": 331, "user_id": 3723882, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3826116f4f4c6be6c12c29248e570cad?s=128&d=identicon&r=PG&f=1", "display_name": "flamingcow", "link": "https://stackoverflow.com/users/3723882/flamingcow"}, "is_accepted": false, "score": 0, "last_activity_date": 1587598695, "creation_date": 1587598695, "answer_id": 61376909, "question_id": 59353838, "link": "https://stackoverflow.com/questions/59353838/go-insert-composite-type-array-unsupported-type/61376909#61376909", "title": "go insert composite type array unsupported type", "body": "<p>Reasonably complete composite literal parser:</p>\n\n<pre><code>type parseState int     \n\nconst ( \n        state_initial     parseState = iota // start\n        state_value_start                   // no bytes read from value yet\n        state_value                         // unquoted value\n        state_quoted                        // inside quote\n        state_value_end                     // after a close quote\n        state_end                           // after close paren\n)\n\nfunc parseComposite(in []byte) ([]string, error) {\n        state := state_initial   \n        ret := []string{}\n        val := []byte{}      \n\n        for _, b := range in {\n                switch state {                       \n\n                case state_initial:               \n                        if b != '(' {\n                                return nil, fmt.Errorf(\"initial character not ')': %v\", in)\n                        } else {\n                                state = state_value_start\n                        }\n\n                case state_value_start:\n                        if b == '\"' {\n                                state = state_quoted       \n                                continue\n                        } \n                        fallthrough\n\n                case state_value:\n                        if b == ',' {       \n                                ret = append(ret, string(val))\n                                val = nil\n                                state = state_value_start    \n                        } else if b == ')' {\n                                ret = append(ret, string(val))\n                                val = nil\n                                state = state_end       \n                        } else {                                                                                                                      \n                                val = append(val, b) \n                        }\n\n                case state_quoted:\n                        if b == '\"' {      \n                                ret = append(ret, string(val))\n                                val = nil\n                                state = state_value_end\n                        } else {  \n                                val = append(val, b)          \n                        }   \n\n                case state_value_end:\n                        if b == ',' {\n                                state = state_value_start\n                        } else if b == ')' {    \n                                state = state_end\n                        } else {          \n                                return nil, fmt.Errorf(\"invalid delimiter after closing quote: %v\", in)\n                        }\n\n                case state_end:\n                        return nil, fmt.Errorf(\"trailing bytes: %v\", in)\n                }        \n        }                                             \n\n        if state != state_end {                \n                return nil, fmt.Errorf(\"unterminated value: %v\", in)\n        }                                   \n\n        return ret, nil                \n}    \n</code></pre>\n"}], "owner": {"reputation": 3221, "user_id": 2245634, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/OHoy2.jpg?s=128&g=1", "display_name": "Amit\u0101bha", "link": "https://stackoverflow.com/users/2245634/amit%c4%81bha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1156, "favorite_count": 0, "accepted_answer_id": 59360216, "answer_count": 2, "score": 2, "last_activity_date": 1587598695, "creation_date": 1576488810, "last_edit_date": 1576492146, "question_id": 59353838, "link": "https://stackoverflow.com/questions/59353838/go-insert-composite-type-array-unsupported-type", "title": "go insert composite type array unsupported type", "body": "<p>sql</p>\n\n<pre><code>CREATE TABLE public.tiantang_page (\n    href varchar NOT NULL,\n    status int4 NOT NULL,\n    description varchar NOT NULL,\n    urls url[] NULL\n);\n\nCREATE TYPE url AS (\n    url varchar,\n    status int4);\n</code></pre>\n\n<p>insert composite type array</p>\n\n<pre><code>type url  struct {\n    url string\n    status int \n}\n    var urls [1]url\n    urls[0] = url{\n        url:    \"\",\n        status: 0,\n    }\n    update := \"UPDATE \\\"public\\\".\\\"tiantang_page\\\" SET \\\"urls\\\"=$1 where \\\"href\\\"=$2;\"\n    r, err := db.Exec(update, pq.Array(urls),href)\n    if err != nil {\n        log.Fatal(err)\n    }\n</code></pre>\n\n<p>error</p>\n\n<blockquote>\n  <p>sql: converting argument $1 type: unsupported type parsetest.url, a struct</p>\n</blockquote>\n\n<p>library</p>\n\n<pre><code>https://godoc.org/github.com/lib/pq\n</code></pre>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1576520271, "post_id": 59353668, "comment_id": 104918310, "body": "Don&#39;t use anonymous <code>struct</code> types in C: instead of <code>typedef struct &#47;*anonymous*&#47; { ... } typename_list</code>, always use <code>struct struct_name { ... }</code>. (Typedefs in C are kind of botched and I recommend avoiding them but it is OK to use them if you really like them. The presence or absence of the typedef here is not really relevant; the crucial thing is to use a struct tag.)"}, {"owner": {"reputation": 12040, "user_id": 510036, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/b7c510641e6526d19abc93e866e75ac8?s=128&d=identicon&r=PG", "display_name": "Qix - MONICA WAS MISTREATED", "link": "https://stackoverflow.com/users/510036/qix-monica-was-mistreated"}, "edited": false, "score": 1, "creation_date": 1576603468, "post_id": 59353668, "comment_id": 104950487, "body": "&quot;Typedefs in C are kind of botched&quot; how? That&#39;s a baseless claim."}], "answers": [{"comments": [{"owner": {"reputation": 107, "user_id": 3306341, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/COXTN.jpg?s=128&g=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/3306341/joe"}, "edited": false, "score": 0, "creation_date": 1576578262, "post_id": 59363634, "comment_id": 104937026, "body": "I update the question, Clould u do me a favor? thanks :)"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 107, "user_id": 3306341, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/COXTN.jpg?s=128&g=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/3306341/joe"}, "edited": false, "score": 0, "creation_date": 1576605410, "post_id": 59363634, "comment_id": 104951365, "body": "@Joe: I updated my answer. See the first two examples."}, {"owner": {"reputation": 107, "user_id": 3306341, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/COXTN.jpg?s=128&g=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/3306341/joe"}, "edited": false, "score": 0, "creation_date": 1576629623, "post_id": 59363634, "comment_id": 104959804, "body": "It&#39;s amazing,it work, but still throw the error like the question:  arcsoft_face_sdk.h:104:9: note: expected \u2018LPASF_ActiveFileInfo\u2019 but argument is of type \u2018struct &lt;anonymous&gt; *"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 107, "user_id": 3306341, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/COXTN.jpg?s=128&g=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/3306341/joe"}, "edited": false, "score": 0, "creation_date": 1576635586, "post_id": 59363634, "comment_id": 104960857, "body": "@Joe: Did you run my answer to your posted ASFGetActiveFileInfo example code?  What was your output? The <code>#cgo CFLAGS: -Wno-incompatible-pointer-types</code> line suppresses the expected GCC C compiler \u2018struct &lt;anonymous&gt; *\u2019 warning messages. In your unposted example code did you follow my example and include a <code>#cgo CFLAGS: -Wno-incompatible-pointer-types</code> line? Post the code for an example that generates your error message. See <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">How to create a Minimal, Reproducible Example</a>. Without that, we can only guess."}, {"owner": {"reputation": 107, "user_id": 3306341, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/COXTN.jpg?s=128&g=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/3306341/joe"}, "edited": false, "score": 0, "creation_date": 1576686647, "post_id": 59363634, "comment_id": 104981901, "body": "Thanks, I update the question add a demo in github: <a href=\"https://github.com/JoeZing/stackdemo\" rel=\"nofollow noreferrer\">github.com/JoeZing/stackdemo</a>"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1576607552, "last_edit_date": 1576607552, "creation_date": 1576527073, "answer_id": 59363634, "question_id": 59353668, "link": "https://stackoverflow.com/questions/59353668/get-the-struct-from-c-to-golang/59363634#59363634", "title": "Get the struct from C to Golang", "body": "<p>Go doesn't match all the abstruse C <code>typedef</code> rules in cgo. Keep it simple. </p>\n\n<hr>\n\n<p>Using your no <code>struct</code> tag example, here are some ways you can pass C <code>struct</code> variable and pointer arguments from Go to a C <code>Add</code> function. It is unsafe, bypassing both Go and C (GCC C compiler) checks.</p>\n\n<pre><code>package main\n\n/*\n// GNU Compiler Collection (GCC): Warning Options\n// https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#Warning-Options\n#cgo CFLAGS: -Wno-incompatible-pointer-types\n\ntypedef signed int i32_t;\n\n// anonymous (no tag) struct\ntypedef struct {\n    i32_t i;\n} sv_t, *sp_t;\n\nint Add(sv_t v, sp_t p);\n\nint Add(sv_t v, sp_t p) {\n    int sum = v.i;\n    if (p) {\n        sum += p-&gt;i;\n    }\n    return sum;\n}\n*/\nimport \"C\"\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\nfunc main() {\n    var svar C.sv_t\n    svar.i = 42\n    fmt.Printf(\"svar: %v  svar.i: %v\\n\", svar, svar.i)\n\n    var sptr C.sp_t\n    sptr = (C.sp_t)(unsafe.Pointer(new(C.sv_t)))\n    sptr.i = 39\n    fmt.Printf(\"sptr: %v  sptr.i: %v\\n\", sptr, sptr.i)\n\n    sum := C.Add(svar, sptr)\n    fmt.Print(\"Add(\", svar.i, \", \", sptr.i, \") = \", sum, \"\\n\")\n\n    fmt.Printf(\"svar: %T\\nsptr: %T\\n\", svar, sptr)\n}\n\n/*\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run so.go\nsvar: {42}  svar.i: 42\nsptr: &amp;{39}  sptr.i: 39\nAdd(42, 39) = 81\nsvar: main._Ctype_struct___0\nsptr: main._Ctype_sp_t\n$ \n</code></pre>\n\n<hr>\n\n<p>For your specific example, perhaps something like this:</p>\n\n<pre><code>package main\n\n/*\n// GNU Compiler Collection (GCC): Warning Options\n// https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html#Warning-Options\n#cgo CFLAGS: -Wno-incompatible-pointer-types\n\ntypedef long    MLong;\ntypedef char*   MPChar;\ntypedef MLong   MRESULT;\n\ntypedef struct {\n    MPChar startTime;\n    MPChar endTime;\n    MPChar platform;\n    MPChar sdkType;\n    MPChar appId;\n    MPChar sdkKey;\n    MPChar sdkVersion;\n    MPChar fileVersion;\n} ASF_ActiveFileInfo, *LPASF_ActiveFileInfo;\n\n\nMRESULT ASFGetActiveFileInfo(\n    LPASF_ActiveFileInfo  activeFileInfo\n);\n\nMRESULT ASFGetActiveFileInfo(\n    LPASF_ActiveFileInfo  activeFileInfo\n)\n{\n    activeFileInfo-&gt;appId = \"Go\";\n    return 42;\n}\n*/\nimport \"C\"\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\nfunc main() {\n    asfPtr := (C.LPASF_ActiveFileInfo)(unsafe.Pointer(new(C.ASF_ActiveFileInfo)))\n    r := C.ASFGetActiveFileInfo(asfPtr)\n    fmt.Println(r, C.GoString(asfPtr.appId))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run so.go\n42 Go\n$ \n</code></pre>\n\n<hr>\n\n<p>Using your example (with a <code>struct</code> tag), here are various ways you can pass C <code>struct</code> arguments from Go to a C <code>Add</code> function: variable, pointer, and unsafe pointer. In Go, we prefer safe types.</p>\n\n<pre><code>package main\n\n/*\ntypedef signed int i32_t;\n\ntypedef struct s_t {\n    i32_t i;\n} sv_t, *sp_t;\n\nint Add(sv_t v, sp_t p);\n\nint Add(sv_t v, sp_t p) {\n    int sum = v.i;\n    if (p) {\n        sum += p-&gt;i;\n    }\n    return sum;\n}\n*/\nimport \"C\"\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\nfunc main() {\n    svar := C.struct_s_t{i: 42}\n\n    sptr := &amp;C.struct_s_t{i: 39}\n    sum := C.Add(svar, sptr)\n    fmt.Print(\"Add(\", svar.i, \", \", sptr.i, \") = \", sum, \"\\n\")\n\n    uptr := unsafe.Pointer(&amp;C.struct_s_t{i: 7})\n    sum = C.Add(svar, (C.sp_t)(uptr))\n    fmt.Print(\"Add(\", svar.i, \", \", (C.sp_t)(uptr).i, \") = \", sum, \"\\n\")\n    sum = C.Add(svar, (*C.struct_s_t)(uptr))\n    fmt.Print(\"Add(\", svar.i, \", \", (*C.struct_s_t)(uptr).i, \") = \", sum, \"\\n\")\n\n    fmt.Printf(\"svar: %T\\nsptr: %T\\nuptr: %T\\n\", svar, sptr, uptr)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run so.go\nAdd(42, 39) = 81\nAdd(42, 7) = 49\nAdd(42, 7) = 49\nsvar: main._Ctype_struct_s_t\nsptr: *main._Ctype_struct_s_t\nuptr: unsafe.Pointer\n$\n</code></pre>\n"}], "owner": {"reputation": 107, "user_id": 3306341, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/COXTN.jpg?s=128&g=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/3306341/joe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 669, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1576686598, "creation_date": 1576488203, "last_edit_date": 1576686598, "question_id": 59353668, "link": "https://stackoverflow.com/questions/59353668/get-the-struct-from-c-to-golang", "title": "Get the struct from C to Golang", "body": "<p>c.h</p>\n\n<pre><code>typedef signed int VarInt32;\n\ntypedef struct {\n    VarInt32   VI32\n} VAR_A, *VAR_B\n\nint Add(VAR_B v_b) //the argument is a pointer\n\n</code></pre>\n\n<pre><code>var mvar unsafe.Pointer\n\nC.Add((*C.VAR_B)(&amp;mvar))\n\nfmt.Println(mvar)\n\n</code></pre>\n\n<p>get the result like this: </p>\n\n<pre><code>warning: passing argument 1 of \u2018add\u2019 from incompatible pointer type [enabled by default]\nnote: expected \u2018MVAR\u2019 but argument is of type \u2018struct &lt;anonymous&gt; *\u2019\n</code></pre>\n\n<p>It seems incorrect, </p>\n\n<p>I am looking for something like this in golang: mvar.VI32</p>\n\n<p>Thanks</p>\n\n<hr>\n\n<p>My head hurts a lot, not good at C/C++,</p>\n\n<p>here is my scene, to call a SDK(with .so libs)</p>\n\n<p>c.h</p>\n\n<pre><code>typedef char*   MPChar;\ntypedef MLong   MRESULT;\n\ntypedef struct{\n    MPChar startTime;       \n    MPChar endTime;         \n    MPChar platform;        \n    MPChar sdkType;         \n    MPChar appId;           \n    MPChar sdkKey;          \n    MPChar sdkVersion;      \n    MPChar fileVersion;     \n}ASF_ActiveFileInfo, *LPASF_ActiveFileInfo;\n\n\nMRESULT ASFGetActiveFileInfo(\n    LPASF_ActiveFileInfo  activeFileInfo \n);\n\n</code></pre>\n\n<p>I try to call the function ASFGetActiveFileInfo in golang like these:</p>\n\n<pre><code>var c_afInfo C.ASF_ActiveFileInfo\n\nC.ASFGetActiveFileInfo(&amp;c_afInfo)\n\n//get the same error\n//C.ASFGetActiveFileInfo((C.LPASF_ActiveFileInfo)(unsafe.Pointer(&amp;c_afInfo)))\n\n</code></pre>\n\n<p>get this error:</p>\n\n<pre><code># command-line-arguments\ncgo-gcc-prolog: In function \u2018_cgo_8c613494cf5f_Cfunc_ASFGetActiveFileInfo\u2019:\ncgo-gcc-prolog:52:2: warning: passing argument 1 of \u2018ASFGetActiveFileInfo\u2019 from incompatible pointer type [enabled by default]\nIn file included from ./main.go:7:0:\n./inc/arcsoft_face_sdk.h:104:9: note: expected \u2018LPASF_ActiveFileInfo\u2019 but argument is of type \u2018struct &lt;anonymous&gt; *\u2019\n MRESULT ASFGetActiveFileInfo(\n         ^\n# command-line-arguments\n./main.go:134:139: cannot use _cgo0 (type *_Ctype_LPASF_ActiveFileInfo) as type *_Ctype_struct___0 in argument to _Cfunc_ASFGetActiveFileInfo\n</code></pre>\n\n<p>try:</p>\n\n<pre><code>var c_afInfo C.LPASF_ActiveFileInfo\n\nC.ASFGetActiveFileInfo((C.LPASF_ActiveFileInfo)&amp;c_afInfo)\n\n</code></pre>\n\n<p>get this error</p>\n\n<pre><code># command-line-arguments\ncgo-gcc-prolog: In function \u2018_cgo_061c0167bf6c_Cfunc_ASFGetActiveFileInfo\u2019:\ncgo-gcc-prolog:52:2: warning: passing argument 1 of \u2018ASFGetActiveFileInfo\u2019 from incompatible pointer type [enabled by default]\nIn file included from ./main.go:7:0:\n./inc/arcsoft_face_sdk.h:104:9: note: expected \u2018LPASF_ActiveFileInfo\u2019 but argument is of type \u2018struct &lt;anonymous&gt; *\u2019\n MRESULT ASFGetActiveFileInfo(\n         ^\n# command-line-arguments\n./main.go:134:25: type _Ctype_LPASF_ActiveFileInfo is not an expression\n\n</code></pre>\n\n<p>Is there any solution for this problem?</p>\n\n<hr>\n\n<p>Thanks for @peterSO 's answer, it work, bu still show the error:</p>\n\n<pre><code>cgo-gcc-prolog: In function \u2018_cgo_73061f0a5639_Cfunc_ASFGetActiveFileInfo\u2019:\ncgo-gcc-prolog:98:2: warning: passing argument 1 of \u2018ASFGetActiveFileInfo\u2019 from incompatible pointer type [enabled by default]\nIn file included from ./main.go:7:0:\n./inc/arcsoft_face_sdk.h:104:9: note: expected \u2018LPASF_ActiveFileInfo\u2019 but argument is of type \u2018struct &lt;anonymous&gt; *\u2019\n MRESULT ASFGetActiveFileInfo(\n         ^\n0 linux\n\n\n</code></pre>\n\n<p>The truth is very closely</p>\n\n<hr>\n\n<p>Demo\uff1a<a href=\"https://github.com/JoeZing/stackdemo\" rel=\"nofollow noreferrer\">https://github.com/JoeZing/stackdemo</a></p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 2672, "user_id": 1288818, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7CfkE.jpg?s=128&g=1", "display_name": "Oleg Butuzov", "link": "https://stackoverflow.com/users/1288818/oleg-butuzov"}, "is_accepted": false, "score": 2, "last_activity_date": 1576487880, "creation_date": 1576487880, "answer_id": 59353571, "question_id": 59353417, "link": "https://stackoverflow.com/questions/59353417/problem-with-https-github-com-seehuhn-fortuna-or-maybe-i-misunderstand-golang/59353571#59353571", "title": "problem with https://github.com/seehuhn/fortuna or maybe i misunderstand Golang", "body": "<p>So you defering call</p>\n\n<pre><code>acc.Close()\n</code></pre>\n\n<p>witch effectivly killing RNG. </p>\n"}], "owner": {"reputation": 3, "user_id": 10751840, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d24cb9fde53821ddc34343a6021259f1?s=128&d=identicon&r=PG&f=1", "display_name": "TonyDMorris", "link": "https://stackoverflow.com/users/10751840/tonydmorris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1576487880, "creation_date": 1576487295, "question_id": 59353417, "link": "https://stackoverflow.com/questions/59353417/problem-with-https-github-com-seehuhn-fortuna-or-maybe-i-misunderstand-golang", "title": "problem with https://github.com/seehuhn/fortuna or maybe i misunderstand Golang", "body": "<p>I am trying to use the <a href=\"https://github.com/seehuhn/fortuna\" rel=\"nofollow noreferrer\">https://github.com/seehuhn/fortuna</a> for Golang and implement it into an API.</p>\n\n<p>the problem i am having is when i assign *fortuna.Accumulator and assign it to my App struct i cannot use it outside of the function body it was created in.</p>\n\n<p>see example below.</p>\n\n<pre><code>type App struct {\n    Config config.Config\n    RNG    *fortuna.Accumulator\n    Sink   chan&lt;- time.Time\n}\n\n\nfunc New(cfg config.Config) *App {\n    var acc, err = fortuna.NewRNG(cfg.SeedFileName)\n    if err != nil {\n        panic(\"cannot initialise the RNG: \" + err.Error())\n    }\n    defer acc.Close()\n\napp := App{Config: cfg, RNG: acc, Sink: sink}\n/// if i use app.RNG.Uint64() &lt;---  using this here works correctly\n\n    return &amp;app\n\n</code></pre>\n\n<pre><code>package main\n\nimport (\n\n    \"******/*******/app\"\n\n)\n\nfunc main() {\n\n    app := app.New(cfg)\n    app.RNG.Uint64() &lt;--- this causes Generator not seeded yet error\n\n}\n</code></pre>\n"}, {"tags": ["go", "grpc", "grpc-go"], "answers": [{"tags": [], "owner": {"reputation": 572, "user_id": 2047138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6705951d37d1fdb4f62215934fdf8a1?s=128&d=identicon&r=PG", "display_name": "rubens21", "link": "https://stackoverflow.com/users/2047138/rubens21"}, "is_accepted": true, "score": 0, "last_activity_date": 1576684279, "creation_date": 1576684279, "answer_id": 59395675, "question_id": 59352845, "link": "https://stackoverflow.com/questions/59352845/how-to-implement-go-grpc-go-health-check/59395675#59395675", "title": "How to implement go grpc-go health check?", "body": "<p>One of the links you posted has a link to this read me:\n<a href=\"https://github.com/grpc/grpc/blob/master/doc/health-checking.md\" rel=\"nofollow noreferrer\">https://github.com/grpc/grpc/blob/master/doc/health-checking.md</a></p>\n\n<p>You now should implement that logic, and register that service in you set of services.</p>\n\n<p>The readme suggest to manually register the services into the health check service, so you could pass the list of services as an argument to create the health check service. </p>\n\n<p>I would recommend to define an interface for yours services, so the health check service could handle all of them in the same way:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type HealthMeter interface {\n    GetHealth() mysample.HealthCheckResponse_ServingStatus\n    WatchHealth() &lt;- chan mysample.HealthCheckResponse_ServingStatus\n}\n\n// implement service \"A\" and \"B\" as both interfaces (gRPC server AND HealthMeter)\n\ngrpcServer := grpc.NewServer()\nsrvA := servers.NewServiceA()\nsrvB := servers.NewServiceB()\nhealthSrv := servers.NewHealthCheckServer(map[string]servers.HealthMeter{\n    \"serviceA\": srvA,\n    \"serviceB\": srvB,\n})\n\nmysample.RegisterServiceAServer(grpcServer, srvA)\nmysample.RegisterServiceBServer(grpcServer, srvB)\nmysample.RegisterHealthServer(grpcServer, healthSrv)\n</code></pre>\n\n<p>I hope it could help you.</p>\n"}, {"tags": [], "owner": {"reputation": 478, "user_id": 2317248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b1df05ff6a1868824ebd2a9eced3e67?s=128&d=identicon&r=PG", "display_name": "Alexsandro Souza", "link": "https://stackoverflow.com/users/2317248/alexsandro-souza"}, "is_accepted": false, "score": 4, "last_activity_date": 1596648657, "creation_date": 1596648657, "answer_id": 63270533, "question_id": 59352845, "link": "https://stackoverflow.com/questions/59352845/how-to-implement-go-grpc-go-health-check/63270533#63270533", "title": "How to implement go grpc-go health check?", "body": "<p>I recommend you to have a look at this <a href=\"https://github.com/apssouza22/grpc-production-go\" rel=\"nofollow noreferrer\">Github project</a> to learn how to build a gRPC service prepared for production which includes the health check and much more.</p>\n<p>Specific to health check you can check how it is done <a href=\"https://github.com/apssouza22/grpc-production-go/blob/master/server/server.go#L85\" rel=\"nofollow noreferrer\">here</a></p>\n<p>The library leverage from this more focused <a href=\"https://github.com/grpc-ecosystem/grpc-health-probe\" rel=\"nofollow noreferrer\">project</a></p>\n<p>If you don't want to use the lib you could implement the health check like this:</p>\n<pre><code>import (\n    &quot;google.golang.org/grpc/health&quot;\n    &quot;google.golang.org/grpc/health/grpc_health_v1&quot;\n)\ngrpcServer := grpc.NewServer()\ngrpc_health_v1.RegisterHealthServer(grpcServer, health.NewServer())\n</code></pre>\n"}], "owner": {"reputation": 143, "user_id": 7334197, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Oku4dUDTgk8/AAAAAAAAAAI/AAAAAAAABW4/hJ6mUEk7PvQ/photo.jpg?sz=128", "display_name": "Darmawan Zulkifli", "link": "https://stackoverflow.com/users/7334197/darmawan-zulkifli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1315, "favorite_count": 0, "accepted_answer_id": 59395675, "answer_count": 2, "score": 0, "last_activity_date": 1608137210, "creation_date": 1576484850, "last_edit_date": 1576702559, "question_id": 59352845, "link": "https://stackoverflow.com/questions/59352845/how-to-implement-go-grpc-go-health-check", "title": "How to implement go grpc-go health check?", "body": "<p>I have looking for documentation and code samples of <code>grpc-go</code> health check.</p>\n\n<p>Looking for issues in</p>\n\n<ul>\n<li><a href=\"https://github.com/grpc/grpc-go/issues/448\" rel=\"nofollow noreferrer\">https://github.com/grpc/grpc-go/issues/448</a></li>\n<li><a href=\"https://github.com/grpc/grpc-go/issues/2770\" rel=\"nofollow noreferrer\">https://github.com/grpc/grpc-go/issues/2770</a></li>\n</ul>\n\n<p>there is no clear answer I can re use to implement health checking in my program.</p>\n"}, {"tags": ["go", "google-cloud-platform", "sdk", "gcloud"], "answers": [{"tags": [], "owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "is_accepted": true, "score": 1, "last_activity_date": 1576486133, "creation_date": 1576486133, "answer_id": 59353143, "question_id": 59352764, "link": "https://stackoverflow.com/questions/59352764/difference-between-projectslocation-and-projectszone-functions-types-in-go-sdk-o/59353143#59353143", "title": "Difference between projectslocation and projectszone functions/types in go sdk of google cloud", "body": "<p>The <code>container/v1</code> Go APIs are generated from the underlying Google Kubernetes Engine (GKE) REST APIs (<a href=\"https://cloud.google.com/kubernetes-engine/docs/reference/rest/\" rel=\"nofollow noreferrer\">public documentation</a>), which provide support for querying clusters either by <em>zone</em> or by <em>location</em>. Inspecting those docs, you will find most recommendations are to use the locations API. Although the zone-specific APIs remain available for backwards compatibility, any filtering by zone, for example, is deprecated:</p>\n\n<p><a href=\"https://i.stack.imgur.com/oRiJS.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/oRiJS.png\" alt=\"Screenshot of Google Kubernetes Engine REST API v1 projects.zones.clusters.list endpoint docs, showing the zone parameter is deprecated.\"></a></p>\n\n<p>From memory, I believe the ability to search for clusters by <em>location</em> was added when support for <em>regional</em> GKE clusters was announced; the control plane for such clusters is shared across multiple zones for high availability purposes and an API was provided which generalises over both zonal and regional clusters.</p>\n\n<hr>\n\n<p>In order to obtain all clusters in a project via an API call, as per your request, you can use the <code>location</code> field of the <code>(*container.ProjectsLocationsClustersService).List</code> method to make such a call of the underlying APIs:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>projectID := \"my-project-id\" // TODO fill in project ID\nsvc, err := container.NewService(context.TODO())\n// TODO: handle err\nparent := fmt.Sprintf(\"projects/%s/locations/-\", projectID) // Location \"-\" matches all zones and regions\nresp, err := svc.Projects.Locations.Clusters.List(parent).Do()\n// TODO do something with response and error\n</code></pre>\n\n<p>More details of the structure of the <code>parent</code> parameter and the behaviour of the List call is <a href=\"https://cloud.google.com/kubernetes-engine/docs/reference/rest/v1/projects.locations.clusters/list\" rel=\"nofollow noreferrer\">available in the API docs</a>.</p>\n\n<p>The zonal API will provide support for listing regional clusters when queried for all zones (setting the <code>zone</code> parameter to <code>-</code>). However, as it only accepts zone arguments as filters in its List method, it offers no functionality for filtering regional clusters in a specific region. Other endpoints of the same API have a similar limitation.</p>\n"}], "owner": {"reputation": 9276, "user_id": 2409793, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/QDLY9.png?s=128&g=1", "display_name": "pkaramol", "link": "https://stackoverflow.com/users/2409793/pkaramol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 59353143, "answer_count": 1, "score": 0, "last_activity_date": 1576486133, "creation_date": 1576484458, "question_id": 59352764, "link": "https://stackoverflow.com/questions/59352764/difference-between-projectslocation-and-projectszone-functions-types-in-go-sdk-o", "title": "Difference between projectslocation and projectszone functions/types in go sdk of google cloud", "body": "<p>Going through the container <a href=\"https://godoc.org/google.golang.org/api/container/v1\" rel=\"nofollow noreferrer\">package</a> for the go cloud sdk, one sees that there are mainly 2 distinct type of types and methods when it comes to available resources:</p>\n\n<ul>\n<li><p>projectslocation, e.g. <a href=\"https://godoc.org/google.golang.org/api/container/v1#ProjectsLocationsClustersCreateCall\" rel=\"nofollow noreferrer\">ProjectsLocationsClustersCreateCall</a> </p></li>\n<li><p>projectszone e.g.  <a href=\"https://godoc.org/google.golang.org/api/container/v1#ProjectsZonesClustersAddonsCall\" rel=\"nofollow noreferrer\">ProjectsZonesClustersAddonsCall</a></p></li>\n</ul>\n\n<p>What is their difference?</p>\n\n<p>just for the record, I am looking for the pattern that one has to follow so that </p>\n\n<p>a) it passes (in some method?) the project id</p>\n\n<p>b) it retrieves all the available GKE clusters belonging to that project</p>\n"}, {"tags": ["java", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1576485555, "creation_date": 1576485555, "answer_id": 59352999, "question_id": 59352014, "link": "https://stackoverflow.com/questions/59352014/run-java-class-file-with-external-library-jar-in-golang-os-exec/59352999#59352999", "title": "run java .class file with external library .jar in golang os/exec", "body": "<p>You have to break the arguments you wish to pass to the executable, and list each individually.</p>\n\n<p>Try it like this:</p>\n\n<pre><code>out, err := exec.Command(\n    \"C:/Program Files/Java/jdk-13.0.1/bin/javaw.exe\",\n    \"-cp\", \".;lib/calc.jar\", \"Hello\", arg[0],\n).Output()\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 12543818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae6d3ce00adb975d77e833d2cb634a81?s=128&d=identicon&r=PG&f=1", "display_name": "M Emara", "link": "https://stackoverflow.com/users/12543818/m-emara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 333, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1576485555, "creation_date": 1576480354, "question_id": 59352014, "link": "https://stackoverflow.com/questions/59352014/run-java-class-file-with-external-library-jar-in-golang-os-exec", "title": "run java .class file with external library .jar in golang os/exec", "body": "<p>With go version is go1.13.4 windows/amd64</p>\n\n<p>Is their any way I could run such command <code>java -cp .;\"lib/calc.jar\" Hello</code> \nUsing exec.Command() golang package \u201cos/exec\u201d ?</p>\n\n<p>this command is working fine with cmd or bash </p>\n\n<p>Using windows 10 64bit </p>\n\n<p>This where I got exit status 1</p>\n\n<pre><code>out, err := exec.Command(\"C:/Program Files/Java/jdk-13.0.1/bin/javaw.exe\", \"-cp .;\\\"lib/calc.jar\\\" Hello\", arg[0]).Output()\n</code></pre>\n\n<p>This line is working fine but without including external library in java code</p>\n\n<pre><code>out, err := exec.Command(\"C:/Program Files/Java/jdk-13.0.1/bin/javaw.exe\", \"Hello\", arg[0]).Output()\n</code></pre>\n"}, {"tags": ["string", "go"], "comments": [{"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 2, "creation_date": 1576480375, "post_id": 59351969, "comment_id": 104899232, "body": "Please add a comment on the line you&#39;re wondering about, and try to describe your thought about the line and what problems you have about it. Also, the title should be a short summary of your question or problem, and the main question should be inside the question body. Please also refresh <a href=\"http://stackoverflow.com/help/how-to-ask\">how to ask good questions</a>, as well as <a href=\"https://codeblog.jonskeet.uk/2012/11/24/stack-overflow-question-checklist/\" rel=\"nofollow noreferrer\">this question checklist</a>."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1576487533, "post_id": 59351969, "comment_id": 104901913, "body": "Please take the Tour of Go."}], "answers": [{"tags": [], "owner": {"reputation": 2485, "user_id": 3639630, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rPscq.jpg?s=128&g=1", "display_name": "Wesgur", "link": "https://stackoverflow.com/users/3639630/wesgur"}, "is_accepted": false, "score": 2, "last_activity_date": 1576480410, "creation_date": 1576480410, "answer_id": 59352019, "question_id": 59351969, "link": "https://stackoverflow.com/questions/59351969/why-commas-and-underscore-is-using-in-golang-explain-the-line-12-in-the-below-c/59352019#59352019", "title": "Why commas and underscore is using in Golang. Explain the line 12 in the below code?", "body": "<p>Golang can return multiple values that is why there is a comma. There are two variables being returned by <code>scanner.ReadString</code>.</p>\n\n<p>The reason for the underscore is because the variable isn't being used. This is also known as the <strong>blank identifier</strong>. </p>\n\n<p>I suggest you to take a look at <a href=\"https://gobyexample.com/multiple-return-values\" rel=\"nofollow noreferrer\">https://gobyexample.com/multiple-return-values</a></p>\n"}, {"tags": [], "owner": {"reputation": 14464, "user_id": 50419, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/S1nop.jpg?s=128&g=1", "display_name": "Navaneeth K N", "link": "https://stackoverflow.com/users/50419/navaneeth-k-n"}, "is_accepted": false, "score": 2, "last_activity_date": 1576480619, "creation_date": 1576480619, "answer_id": 59352064, "question_id": 59351969, "link": "https://stackoverflow.com/questions/59351969/why-commas-and-underscore-is-using-in-golang-explain-the-line-12-in-the-below-c/59352064#59352064", "title": "Why commas and underscore is using in Golang. Explain the line 12 in the below code?", "body": "<p><code>ReadString</code> returns <code>string</code> and <code>error</code>. An underscore is used when you don't care about some return values. In the above example, error is ignored using <code>_</code>. This is required because in Go, every variable declared should have a usage or else the compilation will fail. <code>_</code> is a trick to ignore some return values.  </p>\n"}], "owner": {"reputation": 21, "user_id": 11063590, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-t7ltGSqGZAA/AAAAAAAAAAI/AAAAAAAAADE/YFwXx3WguvA/photo.jpg?sz=128", "display_name": "Lakshmanan", "link": "https://stackoverflow.com/users/11063590/lakshmanan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1576480619, "creation_date": 1576480144, "last_edit_date": 1576480402, "question_id": 59351969, "link": "https://stackoverflow.com/questions/59351969/why-commas-and-underscore-is-using-in-golang-explain-the-line-12-in-the-below-c", "title": "Why commas and underscore is using in Golang. Explain the line 12 in the below code?", "body": "<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    scanner := bufio.NewReader(os.Stdin)\n    text, _ := scanner.ReadString('\\n')\n    fmt.Println(\"Hello, World.\")\n    fmt.Println(text)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1576473768, "post_id": 59350825, "comment_id": 104897442, "body": "How did you install Go?"}, {"owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "edited": false, "score": 3, "creation_date": 1576473819, "post_id": 59350825, "comment_id": 104897450, "body": "Install Go with the official installer from golang.org.  The brew installer is broken."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1576474029, "post_id": 59350825, "comment_id": 104897499, "body": "What&#39;s the output of <code>where go</code>?"}, {"owner": {"reputation": 2672, "user_id": 1288818, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7CfkE.jpg?s=128&g=1", "display_name": "Oleg Butuzov", "link": "https://stackoverflow.com/users/1288818/oleg-butuzov"}, "edited": false, "score": 0, "creation_date": 1576476121, "post_id": 59350825, "comment_id": 104897984, "body": "Can you check <a href=\"https://stackoverflow.com/q/59095179\">stackoverflow.com/q/59095179</a>  and <a href=\"https://stackoverflow.com/q/58473656\">stackoverflow.com/q/58473656</a> ?"}, {"owner": {"reputation": 345, "user_id": 553473, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/71e96d147a038bf87123624ec59730f4?s=128&d=identicon&r=PG", "display_name": "Bill.Caffery", "link": "https://stackoverflow.com/users/553473/bill-caffery"}, "edited": false, "score": 0, "creation_date": 1577405638, "post_id": 59350825, "comment_id": 105163348, "body": "I installed go via apt on ubuntu |   Not brew |   <code>$which go</code> = <code>&#47;usr&#47;bin&#47;go</code> |  I checked both of those before posting this question. The solution to both of those was to edit the enclosing app&#39;s structure or go.mod config. Neither are an option for built in packages like <code>net&#47;http</code>"}, {"owner": {"reputation": 345, "user_id": 553473, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/71e96d147a038bf87123624ec59730f4?s=128&d=identicon&r=PG", "display_name": "Bill.Caffery", "link": "https://stackoverflow.com/users/553473/bill-caffery"}, "reply_to_user": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "edited": false, "score": 0, "creation_date": 1577408893, "post_id": 59350825, "comment_id": 105163803, "body": "@iLoveReflection Thanks for the lead. After some digging i installed direct from tarball. Problem solved. snap and apt packages are no good right now."}], "answers": [{"tags": [], "owner": {"reputation": 345, "user_id": 553473, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/71e96d147a038bf87123624ec59730f4?s=128&d=identicon&r=PG", "display_name": "Bill.Caffery", "link": "https://stackoverflow.com/users/553473/bill-caffery"}, "is_accepted": true, "score": 0, "last_activity_date": 1577408982, "creation_date": 1577408982, "answer_id": 59494963, "question_id": 59350825, "link": "https://stackoverflow.com/questions/59350825/net-http-imports-missing-dot-in-first-path-element/59494963#59494963", "title": "net/http imports missing dot in first path element", "body": "<p>@iLoveReflection Thanks for the lead. </p>\n\n<p>After some digging I installed <a href=\"https://golang.org/doc/install?download=go1.13.5.linux-amd64.tar.gz#install\" rel=\"nofollow noreferrer\">direct from tarball</a>. Problem solved. snap and apt packages are no good right now it seems.   </p>\n"}], "owner": {"reputation": 345, "user_id": 553473, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/71e96d147a038bf87123624ec59730f4?s=128&d=identicon&r=PG", "display_name": "Bill.Caffery", "link": "https://stackoverflow.com/users/553473/bill-caffery"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1895, "favorite_count": 0, "accepted_answer_id": 59494963, "answer_count": 1, "score": 2, "last_activity_date": 1577408982, "creation_date": 1576472912, "last_edit_date": 1576473397, "question_id": 59350825, "link": "https://stackoverflow.com/questions/59350825/net-http-imports-missing-dot-in-first-path-element", "title": "net/http imports missing dot in first path element", "body": "<p>When I run <code>go mod tidy</code> in the root of my project I get this message.</p>\n\n<pre><code>go-dispatch imports\n        net/http imports\n        golang_org/x/net/http/httpguts: malformed module path \"golang_org/x/net/http/httpguts\": missing dot in first path element\ngo-dispatch imports\n        net/http imports\n        golang_org/x/net/http/httpproxy: malformed module path \"golang_org/x/net/http/httpproxy\": missing dot in first path element\ngo-dispatch imports\n        net/http imports\n        golang_org/x/net/http2/hpack: malformed module path \"golang_org/x/net/http2/hpack\": missing dot in first path element\ngo-dispatch imports\n        net/http imports\n        golang_org/x/net/idna: malformed module path \"golang_org/x/net/idna\": missing dot in first path element\ngo-dispatch imports\n        net/http imports\n        crypto/tls imports\n        golang_org/x/crypto/chacha20poly1305: malformed module path \"golang_org/x/crypto/chacha20poly1305\": missing dot in first path element\ngo-dispatch imports\n        net/http imports\n        crypto/tls imports\n        golang_org/x/crypto/curve25519: malformed module path \"golang_org/x/crypto/curve25519\": missing dot in first path element\ngo-dispatch imports\n        net/http imports\n        net imports\n        golang_org/x/net/dns/dnsmessage: malformed module path \"golang_org/x/net/dns/dnsmessage\": missing dot in first path element\ngo-dispatch imports\n        net/http imports\n        net imports\n        golang_org/x/net/lif: malformed module path \"golang_org/x/net/lif\": missing dot in first path element\ngo-dispatch imports\n        net/http imports\n        net imports\n        golang_org/x/net/route: malformed module path \"golang_org/x/net/route\": missing dot in first path element\ngo-dispatch imports\n        github.com/jinzhu/gorm/dialects/postgres imports\n        github.com/lib/pq imports\n        crypto/x509 imports\n        golang_org/x/crypto/cryptobyte: malformed module path \"golang_org/x/crypto/cryptobyte\": missing dot in first path element\ngo-dispatch imports\n        github.com/jinzhu/gorm/dialects/postgres imports\n        github.com/lib/pq imports\n        crypto/x509 imports\n        golang_org/x/crypto/cryptobyte/asn1: malformed module path \"golang_org/x/crypto/cryptobyte/asn1\": missing dot in first path element\ngo-dispatch imports\n        net/http imports\n        net tested by\n        net.test imports\n        golang_org/x/net/nettest: malformed module path \"golang_org/x/net/nettest\": missing dot in first path element\n</code></pre>\n\n<p>I have tried everything from installing different versions of golang (1.11 - 1.13) and removed each as well. I have no idea what this issue means, but it seems to be a problem in the net/http package.</p>\n\n<p><code>go env</code> output:</p>\n\n<pre><code>GO111MODULE=\"\"\nGOARCH=\"amd64\"\nGOBIN=\"\"\nGOCACHE=\"/home/thakidd/.cache/go-build\"\nGOENV=\"/home/thakidd/.config/go/env\"\nGOEXE=\"\"\nGOFLAGS=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGONOPROXY=\"xxx\"\nGONOSUMDB=\"xxx\"\nGOOS=\"linux\"\nGOPATH=\"/home/thakidd/go\"\nGOPRIVATE=\"xxx\"\nGOPROXY=\"https://proxy.golang.org,direct\"\nGOROOT=\"/usr/local/go\"\nGOSUMDB=\"sum.golang.org\"\nGOTMPDIR=\"\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/linux_amd64\"\nGCCGO=\"gccgo\"\nAR=\"ar\"\nCC=\"gcc\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\nGOMOD=\"/home/thakidd/workspace/go-dispatch/go.mod\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\nPKG_CONFIG=\"pkg-config\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build783029481=/tmp/go-build -gno-record-gcc-switches\"\n</code></pre>\n\n<p>I've also tried changing my GOROOT but that's set correctly as far as I can tell. I'm at a total loss as this is happening across several different projects. All have the same errors.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 268, "user_id": 6540087, "user_type": "registered", "profile_image": "https://graph.facebook.com/588133574681732/picture?type=large", "display_name": "Latif Uluman", "link": "https://stackoverflow.com/users/6540087/latif-uluman"}, "is_accepted": false, "score": 1, "last_activity_date": 1576465101, "creation_date": 1576465101, "answer_id": 59350043, "question_id": 59349879, "link": "https://stackoverflow.com/questions/59349879/whats-the-difference-between-int-and-int-in-go/59350043#59350043", "title": "what&#39;s the difference between []int{} and []int in go?", "body": "<p>It is the difference between nil and empty slice. In golang, if you declare a variable without a value, it\u2019s value becomes the zero value of the variable type. The zero value of the array is nil. Not empty slice. Empty slice can be generated with make function or shorty the second method that you have used for test2</p>\n"}, {"comments": [{"owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "edited": false, "score": 0, "creation_date": 1576466985, "post_id": 59350089, "comment_id": 104896267, "body": "Regarding note 2)  There is a supported way to get a pointer to a slice&#39;s backing array: <code>reflect.ValueOf(slice).Pointer()</code>.  It turns out that all slices allocated with zero capacity share the same pointer (<a href=\"https://play.golang.org/p/z46X3cpQufu\" rel=\"nofollow noreferrer\">example program</a>).   It follows that allocating a slice with zero capacity does not allocate memory.  In fact, a zero size allocation in the runtime uses the address of <a href=\"https://github.com/golang/go/blob/a3dc6da6d6d25666d24bab293c0990d1b07bb798/src/runtime/malloc.go#L825\" rel=\"nofollow noreferrer\">this variable</a>."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "edited": false, "score": 0, "creation_date": 1576484209, "post_id": 59350089, "comment_id": 104900475, "body": "@iLoveReflection: Technically, that gives you a pointer to an <i>element</i> in the backing array. For instance, if the slice has backing array <code>var backing [4]T</code>, but was adjusted forward 2 steps by reslicing, you get the address of backing[2] instead of backing[0]. (I was experimenting with this yesterday.) We&#39;re also told that we cannot take the address one past the last element of an array. If an array A has size 1, we can get &amp;A[0] but not &amp;A[1]. So if the backing array has size <i>zero</i>, we can&#39;t even inspect &amp;A[0], at least not officially. But ..."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "edited": false, "score": 0, "creation_date": 1576484243, "post_id": 59350089, "comment_id": 104900489, "body": "... all that said, if we&#39;re unsafe enough, or just look at the source, we find: Yes, the current implementation <a href=\"https://github.com/golang/go/blob/a3dc6da6d6d25666d24bab293c0990d1b07bb798/src/runtime/malloc.go#L895\" rel=\"nofollow noreferrer\">does just what you said</a>. :-) (BTW, the reason I was experimenting was to see if there was an efficient way to write a test: &quot;do slices S1 and S2 potentially overlap?&quot; The answer is that there is, if we&#39;re allowed to be unsafe, but it&#39;s not as useful as we might like.)"}], "tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 10, "last_activity_date": 1576466376, "last_edit_date": 1576466376, "creation_date": 1576465665, "answer_id": 59350089, "question_id": 59349879, "link": "https://stackoverflow.com/questions/59349879/whats-the-difference-between-int-and-int-in-go/59350089#59350089", "title": "what&#39;s the difference between []int{} and []int in go?", "body": "<p>By itself, <code>[]int</code> is a spelling for the type <em>slice of <code>int</code></em>.</p>\n\n<p>In:</p>\n\n<pre><code>var test1 []int\n</code></pre>\n\n<p>the <code>[]int</code> supplies the type for the variable <code>test1</code>.  The line as a whole supplies <em>no</em> value, so <code>test1</code> is initialized to the <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"noreferrer\"><em>zero value</em></a> of type <code>[]int</code>.  The zero value of this is <code>[]int(nil)</code>, or informally, just nil.<sup>1</sup></p>\n\n<p>In:</p>\n\n<pre><code>test2 := []int{}\n</code></pre>\n\n<p>the <code>[]int</code> supplies the type for the brace-enclosed initializer list.  That is, <code>{}</code> is a <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"noreferrer\">composite literal</a>: an open brace, followed by a list of elements\u2014in this case empty\u2014followed by a close brace.  The remainder of the line\u2014the <code>:=</code> and the variable name on the left\u2014represent a <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"noreferrer\"><em>short variable declaration</em></a>.  This gives variable <code>test2</code> the <em>type</em> <code>[]int</code>, and the <em>value</em> produced by the empty list.</p>\n\n<p>The value produced by the empty list is, in this case, an empty slice of <code>int</code>: one with an empty<sup>2</sup> backing store, a length of zero, and a capacity of zero.</p>\n\n<p>That's why <code>test1</code> is nil but <code>test2</code> is not: <code>test1</code> holds the zero value, which for any slice type, is <code>nil</code> (after <code>nil</code> gets converted to that type anyway).  Meanwhile <code>test2</code> holds the three-part slice header that covers the zero-length backing array created by the compound literal.</p>\n\n<p>A nil slice\u2014which is a bit of sloppy phrasing: it means <em>a value of type slice-of-<code>T</code> whose actual value is <code>[]T(nil)</code> instead of some three-part slice header</em>\u2014can often be <em>used as</em> an empty (length-zero) slice of the same type.  In particular, <code>for i := range x</code> and <code>x = append(x, newElement)</code> both handle <code>x == nil</code> \"nicely\": they treat it the same way as they would an empty slice.  The <code>fmt</code> routines that print slices do this as well.<sup>3</sup></p>\n\n<hr>\n\n<p><sup>1</sup><code>nil</code> by itself is <em>untyped</em>.  See the first mention of <code>nil</code> in <a href=\"https://golang.org/ref/spec#Variables\" rel=\"noreferrer\">the Go specification, under the section <strong>Variables</strong></a>.</p>\n\n<p><sup>2</sup>It's not possible to tell, at least without using <code>unsafe.Pointer</code> or similar, whether Go actually allocated any storage for the backing array.  Any operation you do on the slice to give it some capacity, so that you can put some values into memory somewhere, will or could just allocate a <em>new</em> backing array.  There are some tricks with the <code>unsafe</code> package for peeking into the Go runtime, but in general, you don't need to do that, and should not.</p>\n\n<p><sup>3</sup>By contrast, <code>map</code> types don't play quite as nicely.  If <code>x</code> is\u2014to speak informally\u2014a slice that may be nil, and <code>m</code> is a map that may be nil, we can do:</p>\n\n<pre><code>x = append(x, newElem)\n</code></pre>\n\n<p>but we cannot do:</p>\n\n<pre><code>m[key] = newElem\n</code></pre>\n\n<p>We have to first check whether <code>m</code> is nil and if so, allocate an empty map:</p>\n\n<pre><code>if m == nil {\n    m = make(...) // put in the right type here\n}\nm[key] = newElem\n</code></pre>\n\n<p>So it's relatively common to use:</p>\n\n<pre><code>var x []T\nm := map[string]T{}\n</code></pre>\n\n<p>right next to each other, because <code>x</code> will behave well and <code>m</code> won't.</p>\n"}], "owner": {"reputation": 19, "user_id": 11988636, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAonDZyLGMGcK-Z5KPvFtsxD4ypnxS1GmXdZJ-U=k-s128", "display_name": "G3\u7684\u718a\u5148\u751f", "link": "https://stackoverflow.com/users/11988636/g3%e7%9a%84%e7%86%8a%e5%85%88%e7%94%9f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 342, "favorite_count": 0, "closed_date": 1576466695, "accepted_answer_id": 59350089, "answer_count": 2, "score": 0, "last_activity_date": 1576466376, "creation_date": 1576463508, "question_id": 59349879, "link": "https://stackoverflow.com/questions/59349879/whats-the-difference-between-int-and-int-in-go", "closed_reason": "Duplicate", "title": "what&#39;s the difference between []int{} and []int in go?", "body": "<p>here are two different definations in go, but what's the difference?\nI have tried the following:</p>\n\n<pre><code>func main() {\n    var test1 []int\n    test2 := []int{}\n\n    if test1 == nil {\n        fmt.Println(1)\n    }\n    if test2 == nil {\n        fmt.Println(2)\n    }\n    fmt.Println(\"test1:\", test1)\n    fmt.Println(\"test2:\", test2)\n}\n</code></pre>\n\n<p>and this is the output:</p>\n\n<pre><code>1\ntest1: []\ntest2: []\n</code></pre>\n\n<p>but why the test1 is nil but the other is not?</p>\n"}, {"tags": ["go", "aws-sdk", "amazon-sns"], "answers": [{"tags": [], "owner": {"reputation": 353, "user_id": 10641015, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rb6K-6eC5TI/AAAAAAAAAAI/AAAAAAAAAGw/E-daD0VOiz0/photo.jpg?sz=128", "display_name": "jadejoe", "link": "https://stackoverflow.com/users/10641015/jadejoe"}, "is_accepted": true, "score": 0, "last_activity_date": 1577026872, "creation_date": 1577026872, "answer_id": 59445352, "question_id": 59349724, "link": "https://stackoverflow.com/questions/59349724/invalidclienttokenid-the-security-token-included-in-the-request-is-invalid/59445352#59445352", "title": "InvalidClientTokenId: The security token included in the request is invalid", "body": "<p>this issue change part of session.NewSession change code</p>\n\n<pre><code>\nsess, err := session.NewSession(&amp;aws.Config{\n      Region:      aws.String(\"ap-northeast-1\"),\n      Credentials: credentials.NewStaticCredentials(AccessKey, SecretAccessKey, \"\"),\n})\n</code></pre>\n\n<p>to</p>\n\n<pre><code>\n.env\nAWS_ACCESS_KEY=access_key\nAWS_SECRET_ACCESS_KEY=secret_access_key\nAWS_REGION=ap-northeast-1\n\n\nsess, err := session.NewSession()\n\n</code></pre>\n\n<p>thanks</p>\n"}], "owner": {"reputation": 353, "user_id": 10641015, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rb6K-6eC5TI/AAAAAAAAAAI/AAAAAAAAAGw/E-daD0VOiz0/photo.jpg?sz=128", "display_name": "jadejoe", "link": "https://stackoverflow.com/users/10641015/jadejoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2382, "favorite_count": 0, "accepted_answer_id": 59445352, "answer_count": 1, "score": 0, "last_activity_date": 1577026872, "creation_date": 1576461572, "last_edit_date": 1576461972, "question_id": 59349724, "link": "https://stackoverflow.com/questions/59349724/invalidclienttokenid-the-security-token-included-in-the-request-is-invalid", "title": "InvalidClientTokenId: The security token included in the request is invalid", "body": "<p>I make project Go gin</p>\n\n<p>I make send an SMS message for user phone number </p>\n\n<p>When the implementation of the code is completed and the program is executed, the following error occurs</p>\n\n<pre><code>InvalidClientTokenId: The security token included in the request is invalid.\n</code></pre>\n\n<p>I think the error course missing token.\nbut I don`t know get how to get token</p>\n\n<p>this below my code</p>\n\n<pre><code>func PushSms(phoneNumber, code string) error {\n    fmt.Println(\"create session\")\n\n    AccessKey := os.Getenv(\"AWS_ACCESS_KEY\")\n    SecretAccessKey := os.Getenv(\"AWS_SECRET_ACCESS_KEY\")\n\n    sess, err := session.NewSession(&amp;aws.Config{\n        Region:      aws.String(\"ap-northeast-1\"),\n        Credentials: credentials.NewStaticCredentials(AccessKey, SecretAccessKey, \"\"),\n    })\n\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    svc := sns.New(sess)\n\n    input := &amp;sns.PublishInput{\n        Message:     aws.String(\"test\" + code),\n        PhoneNumber: aws.String(phoneNumber),\n    }\n\n    result, err := svc.Publish(input)\n    if err != nil {\n        log.Println(err)\n    }\n\n    fmt.Println(result)\n\n    return nil\n}\n</code></pre>\n\n<p>thanks</p>\n"}, {"tags": ["go", "networking", "raspbian", "dosbox"], "comments": [{"owner": {"reputation": 470, "user_id": 1010221, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/03dd0d81f85d0b29f6a510209837f1fd?s=128&d=identicon&r=PG", "display_name": "w0lf42", "link": "https://stackoverflow.com/users/1010221/w0lf42"}, "edited": false, "score": 0, "creation_date": 1576466350, "post_id": 59349464, "comment_id": 104896175, "body": "I&#39;m not sure what I got a down vote.  I tried to be clear on what steps I took and researched solutions before I posted this question.  Perhaps, to some, the solution was obvious.  But it wasn&#39;t to me.  Anyhow, thanks to eandersson for the quick (and correct) response."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1576469152, "post_id": 59349464, "comment_id": 104896605, "body": "Chiefly because your question is not really about <i>using</i> Go (I did not down vote, FWIW.)"}], "answers": [{"tags": [], "owner": {"reputation": 23298, "user_id": 408182, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/02jXt.jpg?s=128&g=1", "display_name": "eandersson", "link": "https://stackoverflow.com/users/408182/eandersson"}, "is_accepted": true, "score": 1, "last_activity_date": 1576458839, "creation_date": 1576458839, "answer_id": 59349492, "question_id": 59349464, "link": "https://stackoverflow.com/questions/59349464/ipx-networking-with-dos-and-dosbox-under-raspbian/59349492#59349492", "title": "IPX Networking with DOS and DOSBox (under Raspbian)", "body": "<p>You need to install the pcap development packages.</p>\n\n<blockquote>\n  <p>sudo apt-get install libpcap-dev</p>\n</blockquote>\n"}], "owner": {"reputation": 470, "user_id": 1010221, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/03dd0d81f85d0b29f6a510209837f1fd?s=128&d=identicon&r=PG", "display_name": "w0lf42", "link": "https://stackoverflow.com/users/1010221/w0lf42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 418, "favorite_count": 0, "accepted_answer_id": 59349492, "answer_count": 1, "score": -1, "last_activity_date": 1576484956, "creation_date": 1576458433, "last_edit_date": 1576484956, "question_id": 59349464, "link": "https://stackoverflow.com/questions/59349464/ipx-networking-with-dos-and-dosbox-under-raspbian", "title": "IPX Networking with DOS and DOSBox (under Raspbian)", "body": "<p>My long-term-goal is to get Doom (version 1.1) running in <a href=\"https://www.vogons.org/viewtopic.php?f=61&amp;t=58114#p643845\" rel=\"nofollow noreferrer\">3 screen mode</a> on a mix of hardware (1 x Pentium 3 under DOS 7.10 and 2 x Raspberry Pis under Raspbian).</p>\n\n<p>I have DOS running LNE100TX (I can share the configuration files if that is helpful).</p>\n\n<p>I enabled IPX in the configuration file started DOSBox under Raspbian.</p>\n\n<pre><code>[ipx]\n# ipx: Enable ipx over UDP/IP emulation.\nipx=true\n\npi@raspberrypi:~$ dosbox\nDOSBox version 0.74\nCopyright 2002-2010 DOSBox Team, published under GNU GPL.\n---\nCONFIG:Loading primary settings from config file /home/pi/.dosbox/dosbox-0.74.conf\nMIXER:No Sound Mode Selected.\nALSA:Can\u2019t subscribe to MIDI port (65:0) nor (17:0)\nMIDI:Opened device:none\n</code></pre>\n\n<p>I started the ipx server and mounted the drive in DOSBox</p>\n\n<pre><code>Z:\\&gt;ipxnet startserver 19900\nIPX Tunneling utility for DosBox\nIPX Tunneling Server started\n\nZ:\\&gt;mount c ~/dos-games\nDrive C is mounted as local directory /home/pi/dos-games/\n</code></pre>\n\n<p>I found <a href=\"https://github.com/fragglet/ipxbox\" rel=\"nofollow noreferrer\">ipxbox</a> on Github which says:</p>\n\n<blockquote>\n  <p>ipxbox is a standalone DOSBox IPX server written in Go. DOSBox clients can connect to the server and play together.</p>\n  \n  <p>A unique feature is that it is optionally able to bridge to real\n  physical networks, in a manner similar to a VPN. DOSBox clients can\n  communicate with each other on the server, but with this feature\n  enabled they can also communicate with physical IPX nodes on the\n  connected network. So emulated DOS clients should be able to play\n  games against real DOS machines connected to the same network.</p>\n</blockquote>\n\n<p>So, I installed Go:</p>\n\n<pre><code>pi@raspberrypi:~ $ sudo apt-get install libpcap-dev\npi@raspberrypi:~ $ export GOPATH=/home/pi/work\npi@raspberrypi:~ $ export PATH=$PATH:$GOPATH/bin\npi@raspberrypi:~ $ sudo apt-get install golang\n</code></pre>\n\n<p>Then I attempted to install ipxbox:</p>\n\n<pre><code>pi@raspberrypi:~ $ go get github.com/fragglet/ipxbox\npi@raspberrypi:~ $ cd work\npi@raspberrypi:~ $ go build ipxbox.go\n</code></pre>\n\n<p>This is the message that I get when I run this command:</p>\n\n<pre><code>#github.com/google/gopacket/pcap\ngo/src/github.com/google/gopacket/pcap/pcap_unix.go:34:18: fatal error: pcap.h: No such file or directory\n#include &lt;pcap.h&gt;\ncompilation terminated.\n</code></pre>\n\n<p>Perhaps this is obvious, but I'm not very familiar with Linux.  Does anyone have any suggestions for what is causing this?</p>\n"}, {"tags": ["json", "go", "struct", "amazon-dynamodb"], "answers": [{"tags": [], "owner": {"reputation": 146, "user_id": 12446707, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OGpKP.jpg?s=128&g=1", "display_name": "Patrick de Kievit", "link": "https://stackoverflow.com/users/12446707/patrick-de-kievit"}, "is_accepted": false, "score": 0, "last_activity_date": 1576592619, "creation_date": 1576592619, "answer_id": 59376294, "question_id": 59349269, "link": "https://stackoverflow.com/questions/59349269/can-one-run-a-putitem-in-dynamodb-in-golang-without-using-a-struct/59376294#59376294", "title": "Can one run a PutItem in DynamoDB in Golang without using a struct?", "body": "<p>Can you use a var of type map[string]interface{}. And Unmarshal into that? </p>\n\n<p>See: <a href=\"https://play.golang.org/p/PlaitcaPe5D\" rel=\"nofollow noreferrer\">https://play.golang.org/p/PlaitcaPe5D</a></p>\n"}], "owner": {"reputation": 51, "user_id": 4288584, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0DOTm.jpg?s=128&g=1", "display_name": "BAsh", "link": "https://stackoverflow.com/users/4288584/bash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 167, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1576592619, "creation_date": 1576455991, "question_id": 59349269, "link": "https://stackoverflow.com/questions/59349269/can-one-run-a-putitem-in-dynamodb-in-golang-without-using-a-struct", "title": "Can one run a PutItem in DynamoDB in Golang without using a struct?", "body": "<p>All of AWS' examples involve using a struct to organize and optimize your data prior to doing anything with DynamoDB. See: <a href=\"https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/dynamo-example-create-table-item.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/dynamo-example-create-table-item.html</a> </p>\n\n<p>For my project I am getting a JSON string back from a third party API. I actually want to store the entire JSON object in DynamoDB but I can't determine if it's possible without a struct. Because I'm working with a third party API, I can't guarantee what fields I will get, or if the fields will change in the future. Can this be done? In NodeJS it's quite easy, but I understand that Go is statically typed so it may just not be possible.</p>\n"}, {"tags": ["http", "go", "copy", "cancellation"], "comments": [{"owner": {"reputation": 300, "user_id": 1439390, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q1W9f.jpg?s=128&g=1", "display_name": "tclass", "link": "https://stackoverflow.com/users/1439390/tclass"}, "edited": false, "score": 0, "creation_date": 1576450220, "post_id": 59348712, "comment_id": 104893485, "body": "why not create a new context then? And just copy values or whatever you need over yourself. You can get a new context with context.Background()"}, {"owner": {"reputation": 1029, "user_id": 5394999, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/feb6c518628c4d2b0efd4eb11455e83a?s=128&d=identicon&r=PG&f=1", "display_name": "Mr. Nicky", "link": "https://stackoverflow.com/users/5394999/mr-nicky"}, "reply_to_user": {"reputation": 300, "user_id": 1439390, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q1W9f.jpg?s=128&g=1", "display_name": "tclass", "link": "https://stackoverflow.com/users/1439390/tclass"}, "edited": false, "score": 1, "creation_date": 1576450390, "post_id": 59348712, "comment_id": 104893511, "body": "How can I know which values to fetch from the context? The values will vary depending on the scenarios. I&#39;m looking for something that won&#39;t make me manually copy values from one context to another."}, {"owner": {"reputation": 300, "user_id": 1439390, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q1W9f.jpg?s=128&g=1", "display_name": "tclass", "link": "https://stackoverflow.com/users/1439390/tclass"}, "edited": false, "score": 0, "creation_date": 1576450720, "post_id": 59348712, "comment_id": 104893592, "body": "Maybe you can give the scenarios? It seems to me you try to pass around too much data in contexts rather then just constructing structs and pass them around. Maybe this also helps <a href=\"https://stackoverflow.com/questions/40379960/golang-context-withvalue-how-to-add-several-key-value-pairs\" title=\"golang context withvalue how to add several key value pairs\">stackoverflow.com/questions/40379960/&hellip;</a>"}, {"owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "edited": false, "score": 0, "creation_date": 1576459759, "post_id": 59348712, "comment_id": 104895077, "body": "What happens if request&#39;s context reaches its deadline and your context will not ? You should not create new context, use requests context copy and store your values there"}, {"owner": {"reputation": 1626, "user_id": 1397099, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ab4d68f0ef6233809b73ebdc92062ba7?s=128&d=identicon&r=PG", "display_name": "Kent Rancourt", "link": "https://stackoverflow.com/users/1397099/kent-rancourt"}, "edited": false, "score": 0, "creation_date": 1614787863, "post_id": 59348712, "comment_id": 117493109, "body": "To answer why anyone would reasonably want to do this, imagine that for some request, you don&#39;t want anything the handler does to be interruptible by the client hanging up, BUT you&#39;ve also got request-specific data, like user ID maybe, that&#39;s been poked into the context by an authentication filter. You don&#39;t want to lose the user ID and you also don&#39;t want to pass a child of your request context to the uninterruptible operations. You could copy the ID from one context to another, but this means your handlers need to know a whole lot about what the filters have done to the context."}], "answers": [{"tags": [], "owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "is_accepted": false, "score": 5, "last_activity_date": 1576728523, "last_edit_date": 1576728523, "creation_date": 1576451316, "answer_id": 59348871, "question_id": 59348712, "link": "https://stackoverflow.com/questions/59348712/how-to-copy-context-object-without-deriving/59348871#59348871", "title": "How to copy Context object without deriving", "body": "<p>Here's how to make a context that uses values from some other context, but not cancelation:</p>\n\n<pre><code>type valueOnlyContext struct{ context.Context }\nfunc (valueOnlyContext) Deadline() (deadline time.Time, ok bool) { return }\nfunc (valueOnlyContext) Done() &lt;-chan struct{} { return nil }\nfunc (valueOnlyContext) Err() error { return nil }\n</code></pre>\n\n<p>Use it like this:</p>\n\n<pre><code> ctx := valueOnlyContext{reqCtx}\n</code></pre>\n\n<p>Using the values without cancelation is probably outside the design intent of the context package. If the designers of the package thought this is a good thing, I would have expected them to bundle up the above in a context package function.</p>\n"}], "owner": {"reputation": 1029, "user_id": 5394999, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/feb6c518628c4d2b0efd4eb11455e83a?s=128&d=identicon&r=PG&f=1", "display_name": "Mr. Nicky", "link": "https://stackoverflow.com/users/5394999/mr-nicky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2952, "favorite_count": 0, "answer_count": 1, "score": 8, "last_activity_date": 1607413958, "creation_date": 1576449762, "last_edit_date": 1607413958, "question_id": 59348712, "link": "https://stackoverflow.com/questions/59348712/how-to-copy-context-object-without-deriving", "title": "How to copy Context object without deriving", "body": "<p>I want to make a copy of a context object - a request context to be exact, and make use of it later on in a separate go routine.</p>\n\n<p>Problem is if I derive the request context using <code>context.WithCancel(reqCtx)</code> once the HTTP handler for this request is finished, not only will the original request context be cancelled, but also the copy of the request context will also be canceled.</p>\n\n<p>I'd like to be able to copy the original request context and not have it canceled by the original context after the HTTP handler has finished executing.</p>\n"}, {"tags": ["arrays", "go", "infinite-loop"], "comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1576454827, "post_id": 59348682, "comment_id": 104894268, "body": "You have multiple questions in your comments (Q1, Q2, Q3, Q4); for StackOverflow purposes, you should work on breaking these up into individual questions. Doing so will help you focus on each part. tclass&#39;s answer is focused on Q1, with a bit of Q2. To answer Q4 for yourself (with too much detail! :-) ), see <a href=\"https://golang.org/ref/spec#For_statements\" rel=\"nofollow noreferrer\">the spec on <code>for</code> loops with <code>range</code> clauses</a>. The answer to Q3 requires reading the <code>validate.go</code> source (or testing)."}], "answers": [{"comments": [{"owner": {"reputation": 2913, "user_id": 3705478, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/0Rnp5.jpg?s=128&g=1", "display_name": "sofs1", "link": "https://stackoverflow.com/users/3705478/sofs1"}, "edited": false, "score": 1, "creation_date": 1576452144, "post_id": 59348775, "comment_id": 104893845, "body": "&quot;which only needs a Read([]byte) function&quot; - But isn&#39;t the Read a method here?"}, {"owner": {"reputation": 300, "user_id": 1439390, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q1W9f.jpg?s=128&g=1", "display_name": "tclass", "link": "https://stackoverflow.com/users/1439390/tclass"}, "reply_to_user": {"reputation": 2913, "user_id": 3705478, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/0Rnp5.jpg?s=128&g=1", "display_name": "sofs1", "link": "https://stackoverflow.com/users/3705478/sofs1"}, "edited": false, "score": 0, "creation_date": 1576452267, "post_id": 59348775, "comment_id": 104893868, "body": "yes and MyReader is an io.Reader because it (implizit) implements the io.Reader interface. Maybe you should read up on interfaces in go"}], "tags": [], "owner": {"reputation": 300, "user_id": 1439390, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q1W9f.jpg?s=128&g=1", "display_name": "tclass", "link": "https://stackoverflow.com/users/1439390/tclass"}, "is_accepted": true, "score": 1, "last_activity_date": 1576450435, "creation_date": 1576450435, "answer_id": 59348775, "question_id": 59348682, "link": "https://stackoverflow.com/questions/59348682/how-does-calling-reader-validatemyreader-calls-my-custom-read-method/59348775#59348775", "title": "How does calling reader.Validate(MyReader{}) calls my custom Read method?", "body": "<p>it calls Read(b []byte) look at the source here <a href=\"https://github.com/golang/tour/blob/master/reader/validate.go#L17\" rel=\"nofollow noreferrer\">https://github.com/golang/tour/blob/master/reader/validate.go#L17</a></p>\n\n<p>Validate(io.Reader) expects an io.Reader, which only needs a Read([]byte) function to fullfill the interface. That is what you're doing, so Validate can call your reader.</p>\n"}], "owner": {"reputation": 2913, "user_id": 3705478, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/0Rnp5.jpg?s=128&g=1", "display_name": "sofs1", "link": "https://stackoverflow.com/users/3705478/sofs1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 0, "accepted_answer_id": 59348775, "answer_count": 1, "score": 1, "last_activity_date": 1576450435, "creation_date": 1576449445, "question_id": 59348682, "link": "https://stackoverflow.com/questions/59348682/how-does-calling-reader-validatemyreader-calls-my-custom-read-method", "title": "How does calling reader.Validate(MyReader{}) calls my custom Read method?", "body": "<p><a href=\"https://github.com/golang/tour/blob/master/solutions/readers.go\" rel=\"nofollow noreferrer\">https://github.com/golang/tour/blob/master/solutions/readers.go</a></p>\n\n<pre><code>package main\n\nimport \"golang.org/x/tour/reader\"\n\ntype MyReader struct{}\n\nfunc (r MyReader) Read(b []byte) (int, error) { . //Q1) How is this method getting called?\n//Q2) Its no where called in this source code\n//Q3) What is the length of b ?\n    for i := range b { //Q4) Why isn't throwing an infinite loop ?\n        b[i] = 'A' \n    }\n    return len(b), nil\n}\n\nfunc main() {\n    reader.Validate(MyReader{})\n}\n</code></pre>\n"}, {"tags": ["go", "go-modules"], "answers": [{"tags": [], "owner": {"reputation": 25103, "user_id": 3199595, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TwK8q.png?s=128&g=1", "display_name": "Malt", "link": "https://stackoverflow.com/users/3199595/malt"}, "is_accepted": true, "score": 3, "last_activity_date": 1576448654, "creation_date": 1576448654, "answer_id": 59348583, "question_id": 59348582, "link": "https://stackoverflow.com/questions/59348582/project-with-local-copy-of-external-module-doesnt-build/59348583#59348583", "title": "Project with local copy of external module doesn&#39;t build", "body": "<p>The right way to do it is using the <a href=\"https://github.com/golang/go/wiki/Modules#when-should-i-use-the-replace-directive\" rel=\"nofollow noreferrer\">replace directive</a>.</p>\n\n<p>The idea is to replace the the module name of the imported dependency <strong>from the top level <code>go.mod</code> file</strong>, without changing the external dependency. </p>\n\n<p>So all I had to do was to add <code>replace example.com/example/example =&gt; ./example</code> to to <strong>top level</strong> <code>go.mod</code>.</p>\n"}], "owner": {"reputation": 25103, "user_id": 3199595, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TwK8q.png?s=128&g=1", "display_name": "Malt", "link": "https://stackoverflow.com/users/3199595/malt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 384, "favorite_count": 1, "accepted_answer_id": 59348583, "answer_count": 1, "score": 2, "last_activity_date": 1576486559, "creation_date": 1576448654, "last_edit_date": 1576486559, "question_id": 59348582, "link": "https://stackoverflow.com/questions/59348582/project-with-local-copy-of-external-module-doesnt-build", "title": "Project with local copy of external module doesn&#39;t build", "body": "<p>I have project that uses an external library which has a bug in it. To fix the bug, what I tried to do was to clone the external library, place it in a sub-directory within the project, and fix it there. So if the external library is <code>example.com/example/example/</code>, I just put it a folder named <code>example</code> within my project, delete the <code>example.com/example/example/</code> dependency from <code>go.mod</code>, and replace all <code>example.com/example/example/</code> import statements with <code>myproject/example/</code></p>\n\n<p>The problem is that the project doesn't compile. Whenever <code>go build</code> is executed, it returns an error: <code>no matching versions for query \"latest\"</code>. The only way I found to get the project to build is to delete the <code>go.mod</code> file of the cloned external library, but that just doesn't seem right. So what's the right way to build such a project?</p>\n"}, {"tags": ["go", "protocol-buffers", "marshalling", "go-gin"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1576446756, "post_id": 59347224, "comment_id": 104892730, "body": "You need to use the definition of <code>BasicAuth</code> from the generated file."}, {"owner": {"reputation": 93, "user_id": 3328373, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/43cfb6fd0715c5049eed9b57addd5ee7?s=128&d=identicon&r=PG&f=1", "display_name": "Cyril Z.", "link": "https://stackoverflow.com/users/3328373/cyril-z"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1576491056, "post_id": 59347224, "comment_id": 104903718, "body": "Thank you, but I don&#39;t get the point. How to use the structs from generated file? I thought it is automatically mapped between my own strict and the generated one. I thought I just had to call my own struct"}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 2, "creation_date": 1576518019, "post_id": 59347224, "comment_id": 104917353, "body": "You should be importing the generated file and using the definition of <code>BasicAuth</code> in there. That struct has the necessary methods defined on it for protobuf operations to work. The error that you got is saying that the version of <code>BasicAuth</code> that you passed to <code>proto.Marshal</code> doesn&#39;t have the <code>ProtoMessage</code> method defined on it. You&#39;ll notice that the generated file does define that method and others which are necessary for performing protobuf operations."}, {"owner": {"reputation": 93, "user_id": 3328373, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/43cfb6fd0715c5049eed9b57addd5ee7?s=128&d=identicon&r=PG&f=1", "display_name": "Cyril Z.", "link": "https://stackoverflow.com/users/3328373/cyril-z"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1576525172, "post_id": 59347224, "comment_id": 104920266, "body": "Oh you made my day bro ! Thank you very much !"}], "owner": {"reputation": 93, "user_id": 3328373, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/43cfb6fd0715c5049eed9b57addd5ee7?s=128&d=identicon&r=PG&f=1", "display_name": "Cyril Z.", "link": "https://stackoverflow.com/users/3328373/cyril-z"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2176, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1576439045, "creation_date": 1576437053, "last_edit_date": 1576439045, "question_id": 59347224, "link": "https://stackoverflow.com/questions/59347224/unable-to-marshal-protobuf-structs", "title": "Unable to marshal protobuf structs", "body": "<p>I have created my proto file for my structs, and I would like to Marshal them for passing it to my front.\nTwo questions then:</p>\n\n<ul>\n<li>Could/should I marshal my structs for my front end (Angular, vue, react, ...) or I am mandatory to work with JSON on API return?</li>\n<li>I tried to Marshal them but I still have an issue : <code>cannot use message (variable of type *structs.BasicAuth) as proto.Message value in argument to proto.Marshal: missing method ProtoMessage</code></li>\n</ul>\n\n<p>Here is my code for illustrating. Could you help me to fix it please?</p>\n\n<pre><code>package routes\n\nimport (\n    \"fmt\"\n\n    \"project/api/structs\"\n    \"github.com/golang/protobuf/proto\"\n\n    \"github.com/gin-gonic/gin\"\n)\n\nfunc SetupRouter() *gin.Engine {\n    r := gin.Default()\n    v1 := r.Group(\"/v1\")\n\n    auth := v1.Group(\"/auth\")\n    {\n        auth.POST(\"/basic\", computeBasicAuth).Use(checkBasicAuthParameters())\n        // Not the right place for the following Marshal code, just for PoC\n        message := &amp;structs.BasicAuth{\n            Username: \"Foo\",\n            Password: \"Bar\",\n        }\n        data, _ := proto.Marshal(message)\n    }\n    return r\n}\n</code></pre>\n\n<pre><code>package structs\n\ntype BasicAuth struct {\n    Username string\n    Password string\n}\n</code></pre>\n\n<pre><code>syntax = \"proto3\";\npackage structs;\n\nmessage BasicAuth {\n    string Username = 1;\n    string Password = 2;\n}\n</code></pre>\n\n<pre><code>// Code generated by protoc-gen-go. DO NOT EDIT.\n// source: proto/structs/structs.proto\n\npackage structs\n\nimport (\n    fmt \"fmt\"\n    proto \"github.com/golang/protobuf/proto\"\n    math \"math\"\n)\n\n// Reference imports to suppress errors if they are not otherwise used.\nvar _ = proto.Marshal\nvar _ = fmt.Errorf\nvar _ = math.Inf\n\n// This is a compile-time assertion to ensure that this generated file\n// is compatible with the proto package it is being compiled against.\n// A compilation error at this line likely means your copy of the\n// proto package needs to be updated.\nconst _ = proto.ProtoPackageIsVersion3 // please upgrade the proto package\n\ntype BasicAuth struct {\n    Username             string   `protobuf:\"bytes,1,opt,name=Username,proto3\" json:\"Username,omitempty\"`\n    Password             string   `protobuf:\"bytes,2,opt,name=Password,proto3\" json:\"Password,omitempty\"`\n    XXX_NoUnkeyedLiteral struct{} `json:\"-\"`\n    XXX_unrecognized     []byte   `json:\"-\"`\n    XXX_sizecache        int32    `json:\"-\"`\n}\n\nfunc (m *BasicAuth) Reset()         { *m = BasicAuth{} }\nfunc (m *BasicAuth) String() string { return proto.CompactTextString(m) }\nfunc (*BasicAuth) ProtoMessage()    {}\nfunc (*BasicAuth) Descriptor() ([]byte, []int) {\n    return fileDescriptor_3e35c36397ab84cd, []int{0}\n}\n\nfunc (m *BasicAuth) XXX_Unmarshal(b []byte) error {\n    return xxx_messageInfo_BasicAuth.Unmarshal(m, b)\n}\nfunc (m *BasicAuth) XXX_Marshal(b []byte, deterministic bool) ([]byte, error) {\n    return xxx_messageInfo_BasicAuth.Marshal(b, m, deterministic)\n}\nfunc (m *BasicAuth) XXX_Merge(src proto.Message) {\n    xxx_messageInfo_BasicAuth.Merge(m, src)\n}\nfunc (m *BasicAuth) XXX_Size() int {\n    return xxx_messageInfo_BasicAuth.Size(m)\n}\nfunc (m *BasicAuth) XXX_DiscardUnknown() {\n    xxx_messageInfo_BasicAuth.DiscardUnknown(m)\n}\n\nvar xxx_messageInfo_BasicAuth proto.InternalMessageInfo\n\nfunc (m *BasicAuth) GetUsername() string {\n    if m != nil {\n        return m.Username\n    }\n    return \"\"\n}\n\nfunc (m *BasicAuth) GetPassword() string {\n    if m != nil {\n        return m.Password\n    }\n    return \"\"\n}\n\nfunc init() {\n    proto.RegisterType((*BasicAuth)(nil), \"structs.BasicAuth\")\n}\n\nfunc init() { proto.RegisterFile(\"proto/structs/structs.proto\", fileDescriptor_3e35c36397ab84cd) }\n\nvar fileDescriptor_3e35c36397ab84cd = []byte{\n    // 123 bytes of a gzipped FileDescriptorProto\n    0x1f, 0x8b, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0xff, 0xe2, 0x92, 0x2e, 0x28, 0xca, 0x2f,\n    0xc9, 0xd7, 0x2f, 0x2e, 0x29, 0x2a, 0x4d, 0x2e, 0x29, 0x86, 0xd1, 0x7a, 0x60, 0x51, 0x21, 0x76,\n    0x28, 0x57, 0xc9, 0x99, 0x8b, 0xd3, 0x29, 0xb1, 0x38, 0x33, 0xd9, 0xb1, 0xb4, 0x24, 0x43, 0x48,\n    0x8a, 0x8b, 0x23, 0xb4, 0x38, 0xb5, 0x28, 0x2f, 0x31, 0x37, 0x55, 0x82, 0x51, 0x81, 0x51, 0x83,\n    0x33, 0x08, 0xce, 0x07, 0xc9, 0x05, 0x24, 0x16, 0x17, 0x97, 0xe7, 0x17, 0xa5, 0x48, 0x30, 0x41,\n    0xe4, 0x60, 0x7c, 0x25, 0x79, 0x2e, 0x76, 0xaf, 0xf0, 0x10, 0xb0, 0x11, 0x22, 0x5c, 0xac, 0x21,\n    0xf9, 0xd9, 0xa9, 0x79, 0x50, 0xfd, 0x10, 0x4e, 0x12, 0x1b, 0xd8, 0x56, 0x63, 0x40, 0x00, 0x00,\n    0x00, 0xff, 0xff, 0x5f, 0xd5, 0x4e, 0x6b, 0x94, 0x00, 0x00, 0x00,\n}\n\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "edited": false, "score": 0, "creation_date": 1576429965, "post_id": 59346063, "comment_id": 104888608, "body": "Do the lines need to be processed in order?  That will determine how far you can go with this.   Either way, adding buffering to <i>lines</i> can&#39;t hurt.   If ordering isn&#39;t important, you can add extra processors of lines.  Adding them on the input side is a bit more involved since it involves scanning for delimiters to chunk up the data; but in the abstract you could divide the file into N chunks, and put a scanner on each chunk feeding into lines; and come up with a rule to deal with lines that overlap the chunk boundaries."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1576430278, "post_id": 59346063, "comment_id": 104888695, "body": "&quot;I&#39;m worried that using a single goroutine (main) for reading the input lines will impose a bottleneck,&quot; -- Why are you worried about this? Premature optimization is the root of all evil. Have you actually observed that this is a problem in your case? It probably isn&#39;t. Your code looks like it&#39;s probably I/O bound."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1576431643, "post_id": 59346063, "comment_id": 104889057, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/58166490/how-to-implement-parallel-processing-of-line-based-file-content\">How to implement parallel processing of line-based file content</a>"}, {"owner": {"reputation": 7894, "user_id": 1020139, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e6b113d9e9ab23110a4e5b611bcaad61?s=128&d=identicon&r=PG", "display_name": "Shuzheng", "link": "https://stackoverflow.com/users/1020139/shuzheng"}, "reply_to_user": {"reputation": 8402, "user_id": 4664415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hsfxj.jpg?s=128&g=1", "display_name": "mevets", "link": "https://stackoverflow.com/users/4664415/mevets"}, "edited": false, "score": 0, "creation_date": 1576436339, "post_id": 59346063, "comment_id": 104890242, "body": "@mevets - No, lines don&#39;t need to be processed in order."}, {"owner": {"reputation": 7894, "user_id": 1020139, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e6b113d9e9ab23110a4e5b611bcaad61?s=128&d=identicon&r=PG", "display_name": "Shuzheng", "link": "https://stackoverflow.com/users/1020139/shuzheng"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1576436517, "post_id": 59346063, "comment_id": 104890277, "body": "@Flimzy - &quot;Your code looks like it&#39;s probably I/O bound.&quot; - thus, you are also saying that one goroutine reading from the file is insufficient to feed the worker goroutines processing the lines?"}], "answers": [{"comments": [{"owner": {"reputation": 7894, "user_id": 1020139, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e6b113d9e9ab23110a4e5b611bcaad61?s=128&d=identicon&r=PG", "display_name": "Shuzheng", "link": "https://stackoverflow.com/users/1020139/shuzheng"}, "edited": false, "score": 0, "creation_date": 1576435846, "post_id": 59346813, "comment_id": 104890110, "body": "Thank you! But what if the goroutine that reads lines from the file cannot read them fast enough to feed the <code>runtime.GOMAXPROCS(0)</code> worker goroutines? Then the program will become I/O-bound."}, {"owner": {"reputation": 7894, "user_id": 1020139, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e6b113d9e9ab23110a4e5b611bcaad61?s=128&d=identicon&r=PG", "display_name": "Shuzheng", "link": "https://stackoverflow.com/users/1020139/shuzheng"}, "edited": false, "score": 0, "creation_date": 1576435981, "post_id": 59346813, "comment_id": 104890150, "body": "Also, isn&#39;t it slow to use <code>sync.WaitGroup</code> as a counter? Rather, I&#39;d do <code>wg.Add(runtime.GOMAXPROCS(0))</code> and then have the worker goroutines execute <code>wg.Done()</code>, when they are about to terminate, because their input channel has been closed."}, {"owner": {"reputation": 7894, "user_id": 1020139, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e6b113d9e9ab23110a4e5b611bcaad61?s=128&d=identicon&r=PG", "display_name": "Shuzheng", "link": "https://stackoverflow.com/users/1020139/shuzheng"}, "edited": false, "score": 0, "creation_date": 1576436299, "post_id": 59346813, "comment_id": 104890230, "body": "&quot;And inside the worker function you will also add a wg.Done() at the end.&quot; - should be stated more precise: &quot;... after processing a line&quot;."}, {"owner": {"reputation": 61, "user_id": 7307482, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hdA1yOl1Z4U/AAAAAAAAAAI/AAAAAAAAAXM/8-SNpLju6IM/photo.jpg?sz=128", "display_name": "Gonzalo Molina", "link": "https://stackoverflow.com/users/7307482/gonzalo-molina"}, "reply_to_user": {"reputation": 7894, "user_id": 1020139, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e6b113d9e9ab23110a4e5b611bcaad61?s=128&d=identicon&r=PG", "display_name": "Shuzheng", "link": "https://stackoverflow.com/users/1020139/shuzheng"}, "edited": false, "score": 0, "creation_date": 1576525424, "post_id": 59346813, "comment_id": 104920361, "body": "With my answer you would follow the worker-consumer paradigm! With the GOMAXPROCS you will use efficiently the cpus of your machine, you will not have problem with your worker goroutines. You need Waitgroup to force your program to process all the lines of the file."}, {"owner": {"reputation": 7894, "user_id": 1020139, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e6b113d9e9ab23110a4e5b611bcaad61?s=128&d=identicon&r=PG", "display_name": "Shuzheng", "link": "https://stackoverflow.com/users/1020139/shuzheng"}, "edited": false, "score": 0, "creation_date": 1576575769, "post_id": 59346813, "comment_id": 104935549, "body": "But in this case there is only a single producer (or worker). What if I don&#39;t need to make complex operations on the lines, so that the bottleneck becomes the single producer (file reader). Your answer doesn&#39;t address this scenario, does it? You assume the line operations are complex, which they might not be."}], "tags": [], "owner": {"reputation": 61, "user_id": 7307482, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hdA1yOl1Z4U/AAAAAAAAAAI/AAAAAAAAAXM/8-SNpLju6IM/photo.jpg?sz=128", "display_name": "Gonzalo Molina", "link": "https://stackoverflow.com/users/7307482/gonzalo-molina"}, "is_accepted": false, "score": 2, "last_activity_date": 1576434064, "creation_date": 1576434064, "answer_id": 59346813, "question_id": 59346063, "link": "https://stackoverflow.com/questions/59346063/how-to-have-multiple-goroutines-read-the-lines-of-a-single-file/59346813#59346813", "title": "How to have multiple goroutines read the lines of a single file?", "body": "<p>First of all, it has no sense to read a file concurrently. If you need to perform complex operations on the line data, what you should do is to read the file sequentially and send the content of the lines to each goroutine. </p>\n\n<p>For optimizing this process, you should change different things. The first thing you need to change is the number of workers. This value has not be setted randomly, to achieve the max performance of your computer, use this:</p>\n\n<pre><code>for i := 0; i &lt; runtime.GOMAXPROCS(0); i++ {\n    go worker(lines)\n}\n</code></pre>\n\n<p>With this you will use the CPUs available of you computer effectively.\nAnd finally, to process all the data of each line, you have to add:</p>\n\n<pre><code>var wg sync.WaitGroup\nwg.Add(1)\ngo func() {\n    defer close(lines)\n    for scanner.Scan() {\n        wg.Add(1)\n        lines &lt;- scanner.Text()\n    }\n\n    if err := scanner.Err(); err != nil {\n        log.Fatal(err)\n    }\n    wg.Done()\n}()\nwg.Wait()\n</code></pre>\n\n<p>And inside the worker function you will also add a <code>wg.Done()</code> at the end.</p>\n\n<p>I hope this help you!</p>\n"}], "owner": {"reputation": 7894, "user_id": 1020139, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/e6b113d9e9ab23110a4e5b611bcaad61?s=128&d=identicon&r=PG", "display_name": "Shuzheng", "link": "https://stackoverflow.com/users/1020139/shuzheng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 429, "favorite_count": 1, "closed_date": 1576436430, "answer_count": 1, "score": -1, "last_activity_date": 1576434064, "creation_date": 1576428930, "question_id": 59346063, "link": "https://stackoverflow.com/questions/59346063/how-to-have-multiple-goroutines-read-the-lines-of-a-single-file", "closed_reason": "Needs more focus", "title": "How to have multiple goroutines read the lines of a single file?", "body": "<p>I want to read a huge file, say > 1 GB, and have its lines processed by multiple worker goroutines.</p>\n\n<p>I'm worried that using a single goroutine (main) for reading the input lines will impose a bottleneck, when using a huge number of worker goroutines.</p>\n\n<p>How can I safely have multiple goroutines read the lines of the file? Is it possible split the input file into several chuncks and have each goroutine operate on a separate chunk individually?</p>\n\n<p>The following is sample code of having one goroutine read input lines with several worker goroutines processing them:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n    file, err := os.Open(\"/path/to/file.txt\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer file.Close()\n\n    lines := make(chan string)\n\n    for i := 0; i &lt; 100; i++ {\n        // start 100 workers to process input lines.\n        // the workers terminate once 'lines' is closed.\n        go worker(lines)\n    }\n\n    scanner := bufio.NewScanner(file)\n    go func() {\n        defer close(lines)\n        for scanner.Scan() {\n            lines &lt;- scanner.Text()\n        }\n\n        if err := scanner.Err(); err != nil {\n            log.Fatal(err)\n        }\n    }()\n\n    ...\n}\n</code></pre>\n"}, {"tags": ["go", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1576468029, "last_edit_date": 1576468029, "creation_date": 1576440813, "answer_id": 59347677, "question_id": 59345750, "link": "https://stackoverflow.com/questions/59345750/c-references-passed-to-go-can-not-recognize-typedef-void/59347677#59347677", "title": "C references passed to Go can not recognize typedef void*?", "body": "<blockquote>\n<pre><code>cannot use _cgo5 (type *unsafe.Pointer) as type *_Ctype_MVar \nin argument to _Cfunc_C_FUNC\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p>The Go toolchain says you have a type mismatch.</p>\n\n<hr>\n\n<p>An equivalent, working example, with matching types,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\n/*\ntypedef void* pv_t;\nvoid cfunc(pv_t *p);\n\n#include &lt;stdio.h&gt;\nint i;\nvoid cfunc(pv_t *p) {\n    i = 42;\n    *p = &amp;i;\n    printf(\"%p %p %d\\n\", p, *p, *(int*)(*p));\n}\n*/\nimport \"C\"\n\nfunc main() {\n    var cptr unsafe.Pointer\n    C.cfunc((*C.pv_t)(&amp;cptr))\n\n    fmt.Println(&amp;cptr, cptr, *(*C.int)(cptr))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run so.go\n0xc000010028 0x592d18 42\n0xc000010028 0x592d18 42\n$\n</code></pre>\n"}], "owner": {"reputation": 107, "user_id": 3306341, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/COXTN.jpg?s=128&g=1", "display_name": "Joe", "link": "https://stackoverflow.com/users/3306341/joe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 1, "accepted_answer_id": 59347677, "answer_count": 1, "score": 2, "last_activity_date": 1576468029, "creation_date": 1576426886, "last_edit_date": 1576445337, "question_id": 59345750, "link": "https://stackoverflow.com/questions/59345750/c-references-passed-to-go-can-not-recognize-typedef-void", "title": "C references passed to Go can not recognize typedef void*?", "body": "<p>c.h</p>\n\n<pre><code>typedef void*       MVar;\n\nC_FUNC(\n    MVar*     myvar   //[out], return value\n)\n\n</code></pre>\n\n<p>test.go</p>\n\n<pre><code>var cvar unsafe.Pointer\n\n_ = C.C_FUNC(&amp;cvar)\n\n</code></pre>\n\n<p>when I run test.go, it tells me </p>\n\n<pre><code>cannot use _cgo5 (type *unsafe.Pointer) as type *_Ctype_MVar \nin argument to _Cfunc_C_FUNC\n</code></pre>\n\n<p>In this document <a href=\"https://golang.org/cmd/cgo/#hdr-Go_references_to_C\" rel=\"nofollow noreferrer\">Command cgo: Go references to C</a>, it says \"The C type void* is represented by Go's unsafe.Pointer.\"</p>\n"}, {"tags": ["go", "aws-lambda", "state", "aws-xray"], "answers": [{"comments": [{"owner": {"reputation": 1589, "user_id": 591935, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/88818111c4091d9916c3e4e5ea590dbb?s=128&d=identicon&r=PG", "display_name": "Daniel", "link": "https://stackoverflow.com/users/591935/daniel"}, "edited": false, "score": 0, "creation_date": 1576566674, "post_id": 59364688, "comment_id": 104931302, "body": "But if you check the second example, you can clearly see that you need a context to actually call the API"}], "tags": [], "owner": {"reputation": 86, "user_id": 1492401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aed72a9f6b7f98d2e19fc83586fc8a22?s=128&d=identicon&r=PG", "display_name": "Chan Chiem Jeffery Saeteurn", "link": "https://stackoverflow.com/users/1492401/chan-chiem-jeffery-saeteurn"}, "is_accepted": false, "score": 0, "last_activity_date": 1576532623, "creation_date": 1576532623, "answer_id": 59364688, "question_id": 59345603, "link": "https://stackoverflow.com/questions/59345603/passing-xray-context-around-in-a-lambda/59364688#59364688", "title": "Passing Xray context around in a Lambda", "body": "<p>You mention that the client is created before the handler is invoked. This is indeed the recommendation, but as long as you don't do any actual AWS SDK invocations during this initialization phase, this method will indeed work as you have seen.</p>\n\n<p>Is there a reason why you need to pass the context manually yourself? We provide an API that allows you to patch existing clients to perform the context handling internally. You can initialize your clients outside the function handler, as you are doing right now, and then patch it by calling xray.AWS(CLIENT_HERE). And then you dont need to manually pass in the context. In my opinion, this would be cleaner and easier to manage. Does your use case require having a context present?</p>\n\n<p>Here is documentation showing how to do it: <a href=\"https://docs.aws.amazon.com/xray/latest/devguide/xray-sdk-go-awssdkclients.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/xray/latest/devguide/xray-sdk-go-awssdkclients.html</a></p>\n"}], "owner": {"reputation": 1589, "user_id": 591935, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/88818111c4091d9916c3e4e5ea590dbb?s=128&d=identicon&r=PG", "display_name": "Daniel", "link": "https://stackoverflow.com/users/591935/daniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 134, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1576532623, "creation_date": 1576425953, "question_id": 59345603, "link": "https://stackoverflow.com/questions/59345603/passing-xray-context-around-in-a-lambda", "title": "Passing Xray context around in a Lambda", "body": "<p>We have an application with around 25 Lambdas where we want to implement Xray tracing for all (or most) AWS SDK client calls. We have done a PoC implementation as described here, and it's working as expected. What I'm wondering is how we can best pass around the xray context object that is needed by all the client ...WithContext() methods? </p>\n\n<p>I feel that the best way would be to pass the context along when the actual client is created, but since we create the clients BEFORE the actual handler is invoked to allow for reuse of those clients, this is not possible since we don't yet have access to the request context object. Passing the context in every single method call downstream to the clients (DynamoDB, Cognito, S3, KMS etc.) doesn't feel like a good solution either since that will clutter the code, and we're essentially passing the exact same context everywhere. </p>\n\n<p>Is there a better way to share the context?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5187, "user_id": 2759075, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/OUIOd.png?s=128&g=1", "display_name": "Yaron Schwimmer", "link": "https://stackoverflow.com/users/2759075/yaron-schwimmer"}, "edited": false, "score": 0, "creation_date": 1576425754, "post_id": 59345509, "comment_id": 104887524, "body": "can you please add the code from your repo to this question?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 5, "creation_date": 1576425924, "post_id": 59345509, "comment_id": 104887561, "body": "This is because the value of <code>id</code> overflowing <code>float64</code>&#39;s range of precision. You can marshal it as a string and parse it when receiving, or use <code>json.Decoder</code> with <code>json.Decoder.UseNumber</code> instead of <code>json.Unmarshal</code> and then parse the number."}, {"owner": {"reputation": 421, "user_id": 1117572, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3dcf68464d6ec8be46a76d4a9cab9449?s=128&d=identicon&r=PG", "display_name": "ykel", "link": "https://stackoverflow.com/users/1117572/ykel"}, "edited": false, "score": 0, "creation_date": 1576437324, "post_id": 59345509, "comment_id": 104890462, "body": "Thanks leaf, i tried the first solution earlier, however it  did not feel like the best solution because a string is not the intended type. I am searching for a more natural and elegant solution. For the second solution, I am thinking of how that would work for a uint64 field in a struct such as this : type User struct{ID uint64} as this also overflows when deserializing. ill have a look at the json.decoder package"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1576439798, "post_id": 59345509, "comment_id": 104891086, "body": "@ykel what numeric properties are you looking from the <code>ID</code> field so that you don&#39;t want it to become a string? Do you add, subtract, divide or multiply it?"}, {"owner": {"reputation": 421, "user_id": 1117572, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3dcf68464d6ec8be46a76d4a9cab9449?s=128&d=identicon&r=PG", "display_name": "ykel", "link": "https://stackoverflow.com/users/1117572/ykel"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1576443776, "post_id": 59345509, "comment_id": 104892072, "body": "@zerkms,  if nothing else better works,  i&#39;ll go with the first solution from leaf."}], "answers": [{"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": false, "score": 0, "last_activity_date": 1576453959, "last_edit_date": 1576453959, "creation_date": 1576453621, "answer_id": 59349073, "question_id": 59345509, "link": "https://stackoverflow.com/questions/59345509/integer-overflow-golang/59349073#59349073", "title": "Integer overflow - golang", "body": "<p>This is not an integer overflow.  As <a href=\"https://stackoverflow.com/questions/59345509/integer-overflow-golang#comment104887561_59345509\">leaf bebop noted in a comment</a>, the problem is actually that JSON numbers tend to get represented as floating-point, and <code>float32</code> has too few bits to hold the correct value.  Even <code>float64</code>, which Go uses by default, is not quite adequate.</p>\n\n<p>See <em>all</em> the answers to <a href=\"https://stackoverflow.com/q/13502398/1256452\">JSON integers: limit on size</a> (not just the accepted one), and <a href=\"https://stackoverflow.com/questions/13502398/json-integers-limit-on-size#comment80159722_13502497\">Tom Christie's comment here</a>.  Or, see the older question <a href=\"https://stackoverflow.com/q/15869275/1256452\">JSON Not converting long numbers appropriately</a> with its accepted answer.</p>\n\n<p>Depending on what kind of interoperability you need, you can continue to decode these as numbers but use a trickier decoder and/or custom unmarshaler, or just resort to having it encoded <em>in</em> JSON as a string.  In practice, when using JSON across Go + Python + TypeScript + various C++ libraries, we<sup>1</sup> have resorted to string encoding.  We found this to be far more reliable in the end.  (We have not had to do this for 32-bit integers, just for the 64-bit ones.)</p>\n\n<p>To use a non-default decoder, see in particular <a href=\"https://golang.org/pkg/encoding/json/#NewDecoder\" rel=\"nofollow noreferrer\"><code>json.NewDecoder</code></a> and its <a href=\"https://golang.org/pkg/encoding/json/#Decoder.UseNumber\" rel=\"nofollow noreferrer\"><code>UseNumber</code></a> option.</p>\n\n<hr>\n\n<p><sup>1</sup>\"We\" here is not the royal \"we\", but rather $job, where I have touched all of these except for TypeScript.</p>\n"}], "owner": {"reputation": 421, "user_id": 1117572, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/3dcf68464d6ec8be46a76d4a9cab9449?s=128&d=identicon&r=PG", "display_name": "ykel", "link": "https://stackoverflow.com/users/1117572/ykel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 565, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1576469949, "creation_date": 1576425205, "last_edit_date": 1576469949, "question_id": 59345509, "link": "https://stackoverflow.com/questions/59345509/integer-overflow-golang", "title": "Integer overflow - golang", "body": "<p>I am experiencing some integer overflow error.\nI have a micro service application built using golang and go-micro as micro service framework.\nAnd I am using NATS as message broker.</p>\n\n<p>my micro service payloads are in the format </p>\n\n<pre><code> map[string]interface{}\n</code></pre>\n\n<p>The problem occurs when I publish a payload which contains a uint64 such as</p>\n\n<pre><code> var id uint64 = 512281913614499841\n\n message := map[string]inteface{}\n message[\"id\"] = id\n</code></pre>\n\n<p>(this is a unique ID generated by cockroachdb), when a subscriber receives this message as byte and unmarshals this to a uint64, i realize that a overflow occurs and the value becomes</p>\n\n<pre><code>512281913614499840 //this should be 512281913614499841\n</code></pre>\n\n<p>notice the 0 at the end instead of 1</p>\n\n<p>I have created 2 functions (overFlowError and noOverflow) - see below.</p>\n\n<p>the function overFlowError simulates code that causes overflow</p>\n\n<p>and noOverflow prints the correct result because i use payload in this format map[string][struct] instead of map[string]interface</p>\n\n<pre><code>type UserType struct {\n    Email string `json:\"email\"`\n    ID    int64  `json:\"id\"`\n}\nfunc overFlowError() {\n\n        var id int64 = 512281913614499841\n\n        user := UserType{\n            Email: \"example\",\n            ID:    id,\n        }\n\n        message := map[string]interface{}{\n            \"data\": user,\n        }\n\n        //mashal to byte to simulate service payload\n        servicePayload, err := json.Marshal(message)\n\n        if err != nil {\n            log.Println(err)\n        }\n\n        var receivedMessage map[string]interface{}\n\n        json.Unmarshal(servicePayload, &amp;receivedMessage)\n\n        var myUser UserType\n\n        mapstructure.Decode(receivedMessage[\"data\"], &amp;myUser)\n\n        log.Println(\"---receivedMessage:\", myUser.ID) //prints 512281913614499840 - incorrect\n    }\n</code></pre>\n\n<p>No over flow</p>\n\n<pre><code>type UserType struct {\n    Email string `json:\"email\"`\n    ID    int64  `json:\"id\"`\n}\nfunc noOverflow() {\n\n        var id int64 = 512281913614499841\n\n        message := map[string]UserType{}\n\n        message[\"data\"] = UserType{\n            Email: \"example\",\n            ID:    id,\n        }\n\n        byteMessage, err := json.Marshal(message)\n\n        if err != nil {\n            log.Println(err)\n        }\n\n        var msgMap map[string]UserType\n\n        json.Unmarshal(byteMessage, &amp;msgMap)\n\n        log.Println(\"---myUser:\", msgMap[\"data\"].ID) // prints 512281913614499841 - correct\n    }\n</code></pre>\n\n<p>to over avoid a lot of code rewrite, I am left with the first option which i have simulated in the overFlowError function and also explained above</p>\n\n<p>is there a fix to this problem?</p>\n"}, {"tags": ["go", "travis-ci", "hugo"], "comments": [{"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1576494006, "post_id": 59345431, "comment_id": 104905194, "body": "I just executed <code>go get github.com&#47;gohugoio&#47;hugo</code> and had no problem. It installed version v0.61.0. Could you try again in case this was a transient error ?"}], "answers": [{"tags": [], "owner": {"reputation": 98, "user_id": 10993848, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hEwPt.jpg?s=128&g=1", "display_name": "Shivang Goswami", "link": "https://stackoverflow.com/users/10993848/shivang-goswami"}, "is_accepted": true, "score": 1, "last_activity_date": 1576517118, "creation_date": 1576517118, "answer_id": 59361537, "question_id": 59345431, "link": "https://stackoverflow.com/questions/59345431/the-command-go-get-github-com-gohugoio-hugo-failed-and-exited-with-2-during/59361537#59361537", "title": "The command &quot;go get github.com/gohugoio/hugo&quot; failed and exited with 2 during", "body": "<blockquote>\n  <p>Since Hugo 0.48, Hugo uses the Go Modules support built into Go 1.11 to build.</p>\n</blockquote>\n\n<ul>\n<li><p>docker run -it golang:1.10 <br><br>\nroot@2598ed7e489d: go get github.com/gohugoio/hugo <br><br>\nsrc/github.com/gohugoio/hugo/tpl/internal/go_templates/fmtsort/sort.go:58:18: mapValue.MapRange undefined (type reflect.Value has no field or method MapRange)</p></li>\n<li><p>docker run -it golang:1.11<br><br>\nroot@07e6e634656a: go get <a href=\"https://github.com/gohugoio/hugo\" rel=\"nofollow noreferrer\">https://github.com/gohugoio/hugo</a><br><br>\nwill not return any error</p></li>\n</ul>\n\n<blockquote>\n  <p>using go versions > 1.11 will not cause this issue.<br>\n  In example 1,similar error is there.<br>\n  In example 2,it is installed successfully.</p>\n</blockquote>\n"}], "owner": {"reputation": 421, "user_id": 10811334, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a59b71eb3b7dc454c05a343b71590bca?s=128&d=identicon&r=PG", "display_name": "xiaoyu2006", "link": "https://stackoverflow.com/users/10811334/xiaoyu2006"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 0, "accepted_answer_id": 59361537, "answer_count": 1, "score": 0, "last_activity_date": 1593864658, "creation_date": 1576424612, "last_edit_date": 1593864658, "question_id": 59345431, "link": "https://stackoverflow.com/questions/59345431/the-command-go-get-github-com-gohugoio-hugo-failed-and-exited-with-2-during", "title": "The command &quot;go get github.com/gohugoio/hugo&quot; failed and exited with 2 during", "body": "<p>I am building websites with <code>Hugo</code> and deploying using <code>Travis-Ci</code>. Recently (about within 3 days) an error occurred:</p>\n<pre><code>$ go get github.com/gohugoio/hugo\n# github.com/gohugoio/hugo/tpl/internal/go_templates/fmtsort\n../../gohugoio/hugo/tpl/internal/go_templates/fmtsort/sort.go:58:18: mapValue.MapRange undefined (type reflect.Value has no field or method MapRange)\nThe command &quot;go get github.com/gohugoio/hugo&quot; failed and exited with 2 during .\n</code></pre>\n<p>Since the code errored at <code>go get</code> line, I think it must be caused by some updates by <code>Hugo</code>.</p>\n<p>.travis.yml</p>\n<pre class=\"lang-yaml prettyprint-override\"><code>sudo: false\n\nlanguage: go\n\ngit:\n  depth: 1\n\ninstall: \n  - go get github.com/gohugoio/hugo\n\nscript:\n  - git submodule init\n  - git submodule update\n  - hugo\n\n  # Deploy to GitHub pages\ndeploy:\n  provider: pages\n  skip_cleanup: true\n  github_token: $GITHUB_TOKEN\n  local_dir: public\n  on:\n    branch: master\n</code></pre>\n"}, {"tags": ["json", "go", "zabbix"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1576419642, "post_id": 59344734, "comment_id": 104886135, "body": "In <code>Groups</code> both fields have same <code>json</code> tag field name, that ain&#39;t good. Just have <code>Groups</code> have one <code>Groupid</code> field and instantiate the slice with the values instead of one."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1576419768, "post_id": 59344734, "comment_id": 104886163, "body": "... example: <a href=\"https://play.golang.com/p/avniaXz4rVe\" rel=\"nofollow noreferrer\">play.golang.com/p/avniaXz4rVe</a>"}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 1, "creation_date": 1576420060, "post_id": 59344734, "comment_id": 104886217, "body": "<code>Groups</code> is an array of objects with a single integer field named <code>groupid</code>. That is not what you implemented."}, {"owner": {"reputation": 3193, "user_id": 8196244, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uTuJY.jpg?s=128&g=1", "display_name": "Mauricio Cortazar", "link": "https://stackoverflow.com/users/8196244/mauricio-cortazar"}, "edited": false, "score": 0, "creation_date": 1576426150, "post_id": 59344734, "comment_id": 104887612, "body": "<a href=\"https://play.golang.org/p/PDqAOY0lTUI\" rel=\"nofollow noreferrer\">play.golang.org/p/PDqAOY0lTUI</a> this is another way. However it&#39;s not a good practice in go the use of interface if you are sure of the model, as in this case."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 12391377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f131c0509f374ac785d42df3d639554b?s=128&d=identicon&r=PG&f=1", "display_name": "AnanthJK", "link": "https://stackoverflow.com/users/12391377/ananthjk"}, "is_accepted": false, "score": -1, "last_activity_date": 1576431014, "creation_date": 1576431014, "answer_id": 59346388, "question_id": 59344734, "link": "https://stackoverflow.com/questions/59344734/how-to-struct-array-in-nested-json-object-with-the-same-keys/59346388#59346388", "title": "How to struct array in nested json object with the same keys", "body": "<p>type Groups struct {\n    Groupid  string <code>json:\"groupid\"</code>\n    Groupid1 string <code>json:\"groupid\"</code>\n}</p>\n\n<p>groupid - Cannot be the same value for both. Change it as follows and it should work.\ntype Groups struct {\n    Groupid  string <code>json:\"groupid\"</code>\n    Groupid1 string <code>json:\"groupid1\"</code>\n}</p>\n"}, {"comments": [{"owner": {"reputation": 11, "user_id": 12538507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdd033b1f92e0e747afdb048e7e74836?s=128&d=identicon&r=PG&f=1", "display_name": "ihatemodels", "link": "https://stackoverflow.com/users/12538507/ihatemodels"}, "edited": false, "score": 0, "creation_date": 1576445708, "post_id": 59346414, "comment_id": 104892501, "body": "This is not what the achievement is. In your solution the second key is different. Which means the Zabbix api will reject the request."}], "tags": [], "owner": {"reputation": 11, "user_id": 12391377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f131c0509f374ac785d42df3d639554b?s=128&d=identicon&r=PG&f=1", "display_name": "AnanthJK", "link": "https://stackoverflow.com/users/12391377/ananthjk"}, "is_accepted": false, "score": -1, "last_activity_date": 1576431212, "creation_date": 1576431212, "answer_id": 59346414, "question_id": 59344734, "link": "https://stackoverflow.com/questions/59344734/how-to-struct-array-in-nested-json-object-with-the-same-keys/59346414#59346414", "title": "How to struct array in nested json object with the same keys", "body": "<pre><code>type Groups struct {\n    Groupid  string `json:\"groupid\"`\n    Groupid1 string `json:\"groupid\"`\n}\n</code></pre>\n\n<p>groupid - Cannot be the same value for both. Change it as follows and it should work.</p>\n\n<pre><code>type Groups struct {\n    Groupid  string `json:\"groupid\"`\n    Groupid1 string `json:\"groupid1\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 12538507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdd033b1f92e0e747afdb048e7e74836?s=128&d=identicon&r=PG&f=1", "display_name": "ihatemodels", "link": "https://stackoverflow.com/users/12538507/ihatemodels"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 305, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1576431212, "creation_date": 1576419228, "question_id": 59344734, "link": "https://stackoverflow.com/questions/59344734/how-to-struct-array-in-nested-json-object-with-the-same-keys", "title": "How to struct array in nested json object with the same keys", "body": "<p>I am creating host objects in Zabbix via microservices in Golang. I have to serve the following json to \nthe Zabbix api to create host which is part of multiple groups</p>\n\n<pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"host.create\",\n  \"params\": {\n    \"host\": \"TEST-HOST\",\n    \"interfaces\": [\n      {\n        \"type\": 2,\n        \"main\": 1,\n        \"useip\": 1,\n        \"ip\": \"0.0.0.0\",\n        \"dns\": \"\",\n        \"port\": \"10050\"\n      }\n    ],\n    \"groups\": [\n      {\n        \"groupid\": \"33\"\n      },\n      {\n        \"groupid\": \"27\"\n      }\n    ],\n    \"templates\": [\n      {\n        \"templateid\": \"12156\"\n      }\n    ],\n    \"inventory_mode\": 0\n  },\n  \"auth\": \"example_token\",\n  \"id\": 1\n}\n</code></pre>\n\n<p>This code returns the json object where the groups array is empty.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Zabbix struct {\n    Jsonrpc string `json:\"jsonrpc\"`\n    Method  string `json:\"method\"`\n    Params  Params `json:\"params\"`\n    Auth    string `json:\"auth\"`\n    ID      int    `json:\"id\"`\n}\ntype Groups struct {\n    Groupid  string `json:\"groupid\"`\n    Groupid1 string `json:\"groupid\"`\n}\ntype Templates struct {\n    Templateid string `json:\"templateid\"`\n}\ntype Inventory struct {\n    Type        string `json:\"type\"`\n    Tag         string `json:\"tag\"`\n    TypeFull    string `json:\"type_full\"`\n    MacaddressA string `json:\"macaddress_a\"`\n    MacaddressB string `json:\"macaddress_b\"`\n    SerialA     string `json:\"serialno_a\"`\n    SerialB     string `json:\"serialno_b\"`\n}\ntype Params struct {\n    Host          string       `json:\"host\"`\n    Interfaces    []Interfaces `json:\"interfaces\"`\n    Groups        []Groups     `json:\"groups\"`\n    Templates     []Templates  `json:\"templates\"`\n    InventoryMode int          `json:\"inventory_mode\"`\n    Inventory     Inventory    `json:\"inventory\"`\n}\ntype Interfaces struct {\n    Type  int    `json:\"type\"`\n    Main  int    `json:\"main\"`\n    Useip int    `json:\"useip\"`\n    IP    string `json:\"ip\"`\n    DNS   string `json:\"dns\"`\n    Port  string `json:\"port\"`\n}\n\nfunc main() {\n\n    jsonobj := &amp;Zabbix{\n        Jsonrpc: \"2.0\",\n        Method:  \"host.create\",\n        Params: Params{\n            Host: \"OBU_TEST_123\",\n            Interfaces: []Interfaces{\n                {\n                    Type:  2,\n                    Main:  1,\n                    Useip: 1,\n                    IP:    \"10.10.10.10\",\n                    DNS:   \"\",\n                    Port:  \"10050\",\n                },\n            },\n            Groups: []Groups{\n                {\n                    Groupid:  \"27\",\n                    Groupid1: \"33\",\n                },\n            },\n            Templates: []Templates{\n                {\n                    Templateid: \"12156\",\n                },\n            },\n            Inventory: Inventory{\n                Type:        \"On Board Unit\",\n                Tag:         \"test\",\n                TypeFull:    \"test\",\n                MacaddressA: \"test\",\n                MacaddressB: \"test\",\n                SerialA:     \"test\",\n                SerialB:     \"test\",\n            },\n            InventoryMode: 0,\n        },\n        Auth: \"test-token\",\n        ID:   1,\n    }\n\n    byteArray, err := json.Marshal(jsonobj)\n\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Print(bytes.NewBuffer(byteArray).String())\n\n}\n</code></pre>\n\n<p>The output:</p>\n\n<pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"host.create\",\n  \"params\": {\n    \"host\": \"OBU_TEST_123\",\n    \"interfaces\": [\n      {\n        \"type\": 2,\n        \"main\": 1,\n        \"useip\": 1,\n        \"ip\": \"10.10.10.10\",\n        \"dns\": \"\",\n        \"port\": \"10050\"\n      }\n    ],\n    \"groups\": [\n      {}\n    ],\n    \"templates\": [\n      {\n        \"templateid\": \"12156\"\n      }\n    ],\n    \"inventory_mode\": 0,\n    \"inventory\": {\n      \"type\": \"On Board Unit\",\n      \"tag\": \"test\",\n      \"type_full\": \"test\",\n      \"macaddress_a\": \"test\",\n      \"macaddress_b\": \"test\",\n      \"serialno_a\": \"test\",\n      \"serialno_b\": \"test\"\n    }\n  },\n  \"auth\": \"test-token\",\n  \"id\": 1\n}\n</code></pre>\n\n<p>What i am missing? Is there any more elegant way to create such a big json object instead of using structs? </p>\n"}, {"tags": ["go", "reverse-proxy"], "comments": [{"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1576419010, "post_id": 59344220, "comment_id": 104886013, "body": "This is weird, because <code>ReadAll</code> should never return EOF. I looked at the code and it calls <code>ReadFrom()</code> from a bytes buffer which should never return EOF."}, {"owner": {"reputation": 1172, "user_id": 922457, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/56c9ee0dd7713d48f2ad2e50594a6d0c?s=128&d=identicon&r=PG", "display_name": "Edenshaw", "link": "https://stackoverflow.com/users/922457/edenshaw"}, "reply_to_user": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1576422886, "post_id": 59344220, "comment_id": 104886835, "body": "I&#39;m using <code>go version go1.12.6 linux&#47;amd64</code>. When I check my logs I see several messages like this: <code>[ERRO] Error reading request body: [unexpected EOF]. Limit size per request&#39;s body: [9200000] bytes</code>"}, {"owner": {"reputation": 56, "user_id": 8175305, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ad21e5c78004a096ddce9e8e947a02d?s=128&d=identicon&r=PG&f=1", "display_name": "ashu82492", "link": "https://stackoverflow.com/users/8175305/ashu82492"}, "edited": false, "score": 0, "creation_date": 1604656874, "post_id": 59344220, "comment_id": 114419602, "body": "@Edenshaw I am facing the same issue. Did you find anything?"}, {"owner": {"reputation": 1172, "user_id": 922457, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/56c9ee0dd7713d48f2ad2e50594a6d0c?s=128&d=identicon&r=PG", "display_name": "Edenshaw", "link": "https://stackoverflow.com/users/922457/edenshaw"}, "reply_to_user": {"reputation": 56, "user_id": 8175305, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ad21e5c78004a096ddce9e8e947a02d?s=128&d=identicon&r=PG&f=1", "display_name": "ashu82492", "link": "https://stackoverflow.com/users/8175305/ashu82492"}, "edited": false, "score": 0, "creation_date": 1604938074, "post_id": 59344220, "comment_id": 114493187, "body": "@ashu82492, unfortunately no. It seems to be a bug in that specific version of golang. Have you tried updating the version of go? (I could not do that because it was a production deployment)"}], "owner": {"reputation": 1172, "user_id": 922457, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/56c9ee0dd7713d48f2ad2e50594a6d0c?s=128&d=identicon&r=PG", "display_name": "Edenshaw", "link": "https://stackoverflow.com/users/922457/edenshaw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 977, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1576423138, "creation_date": 1576415599, "last_edit_date": 1576423138, "question_id": 59344220, "link": "https://stackoverflow.com/questions/59344220/reverse-proxy-unexpected-eof-reading-request-body", "title": "Reverse Proxy unexpected EOF reading request body", "body": "<p>I'm using the following code to read the request body in my reverse proxy:</p>\n\n<pre><code>func (env *Env) handleRequestAndRedirect(responseWriter http.ResponseWriter, request *http.Request) {\n\n    readCloserForParams, readCloserForProxy, err := getRequestBodyCopies(responseWriter, request.Body)\n\n    if err == nil {\n        //process request and other stuff...\n        serveReverseProxy(urlValue, responseWriter, request)\n    } else {\n        responseWriter.WriteHeader(http.StatusBadRequest)\n    }\n\nfunc getRequestBodyCopies(responseWriter http.ResponseWriter, requestBody io.ReadCloser) (io.ReadCloser, io.ReadCloser, error) {\n    sizeLimit := utils.Viper.GetInt64(RequestSizeLimit) //9200000 bytes. My requests are 9836 bytes, based on the Content-Length header\n    limitedReaderBody := http.MaxBytesReader(responseWriter, requestBody, sizeLimit)\n\n    buf, err := ioutil.ReadAll(limitedReaderBody)\n    if err != nil {\n        utils.Logger.Errorf(\"Error reading request body: [%v]. Limit size per request's body: [%d] bytes\", err, sizeLimit)\n    }\n\n    rdr1 := ioutil.NopCloser(bytes.NewBuffer(buf))\n    rdr2 := ioutil.NopCloser(bytes.NewBuffer(buf))\n    return rdr1, rdr2, err\n}\n</code></pre>\n\n<p>The problem is that some percentage of the requests (less than 1%) returns an unexpected EOF in the line <code>buf, err := ioutil.ReadAll(limitedReaderBody)</code> and I don't know why. What could be the cause of this issue?</p>\n"}, {"tags": ["go", "github"], "comments": [{"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1576416442, "post_id": 59344090, "comment_id": 104885358, "body": "you an <code>git clone REPO</code> without it prompting youj?  (the ssh form)"}, {"owner": {"reputation": 179, "user_id": 7190684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50d8ec86d3e9c618582bc4905aa0cc5a?s=128&d=identicon&r=PG&f=1", "display_name": "Chanonry", "link": "https://stackoverflow.com/users/7190684/chanonry"}, "reply_to_user": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1576419754, "post_id": 59344090, "comment_id": 104886161, "body": "yup git clone REPO works, no prompt"}, {"owner": {"reputation": 179, "user_id": 7190684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50d8ec86d3e9c618582bc4905aa0cc5a?s=128&d=identicon&r=PG&f=1", "display_name": "Chanonry", "link": "https://stackoverflow.com/users/7190684/chanonry"}, "reply_to_user": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1576419899, "post_id": 59344090, "comment_id": 104886193, "body": "sorry to be complete : git clone git@github.com:Chanonry/nk-s3.git works"}], "answers": [{"tags": [], "owner": {"reputation": 179, "user_id": 7190684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50d8ec86d3e9c618582bc4905aa0cc5a?s=128&d=identicon&r=PG&f=1", "display_name": "Chanonry", "link": "https://stackoverflow.com/users/7190684/chanonry"}, "is_accepted": false, "score": 2, "last_activity_date": 1613645329, "last_edit_date": 1613645329, "creation_date": 1576425994, "answer_id": 59345610, "question_id": 59344090, "link": "https://stackoverflow.com/questions/59344090/golang-import-github-private-repo/59345610#59345610", "title": "golang import github private repo", "body": "<p>After more searching and much experimentation, the issue is with the checksum failing on download of a private repo as by definition there is no checksum defined.</p>\n<p>This was buried within a chain of responses on Github. There is an open issue to improve the documentation. Good idea.</p>\n<p>This worked for me:</p>\n<pre><code>GONOSUMDB=github.com/username/* \ngo get github.com/username/repo\n</code></pre>\n"}], "owner": {"reputation": 179, "user_id": 7190684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50d8ec86d3e9c618582bc4905aa0cc5a?s=128&d=identicon&r=PG&f=1", "display_name": "Chanonry", "link": "https://stackoverflow.com/users/7190684/chanonry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4382, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1613645329, "creation_date": 1576414458, "question_id": 59344090, "link": "https://stackoverflow.com/questions/59344090/golang-import-github-private-repo", "title": "golang import github private repo", "body": "<p>Completely confused.</p>\n\n<p>go 1.13.5 using modules</p>\n\n<p>I am trying to import a private repo from github. Searching is increasing the confusion not reducing it. I have tried a number of approaches including the keychain helper but I am going nowhere fast.</p>\n\n<p>SSH is enabled and when tested establishes a connection successfully</p>\n\n<p>My global gitconfig in C:/Users/me :</p>\n\n<pre><code>[user]\n    name = xxxxxxx\n    email = xxx.xxx@me.com\n[core]\n    autocrlf = input\n[alias]\n    st = status\n[url \"ssh://git@github.com/\"]\n    insteadOf = https://github.com/\n</code></pre>\n\n<p>go get github.com/user/repo@master produces</p>\n\n<pre><code>go: finding github.com master\ngo: finding github.com/user master\ngo: finding github.com/user/repo master\ngo: finding github.com/user/repo master\ngo: downloading github.com/user/repo v0.0.0-20191211180807-ee1bcd94c84f\nverifying github.com/user/repo@v0.0.0-20191211180807-ee1bcd94c84f: \ngithub.com/user/repo@v0.0.0-20191211180807-ee1bcd94c84f: reading \nhttps://sum.golang.org/lookup/github.com/!user/repo@v0.0.0-20191211180807-    \nee1bcd94c84f:410 Gone\n</code></pre>\n\n<p>The link yields :</p>\n\n<pre><code>not found: github.com/user/repo@v0.0.0-20191211180807-ee1bcd94c84f: invalid version: git \nfetch -f origin refs/heads/*:refs/heads/* refs/tags/*:refs/tags/* in/tmp/gopath/pkg/mod/cache/vcs/9524fc42cfd4910346f55f112665f9a51df7c4b31085d50baa5e01453e55ca58: \nexit status 128:\nfatal: could not read Username for 'https://github.com': terminal prompts disabled\n</code></pre>\n\n<p>Doesn't matter what I do I get this \"cannot read Username\" but I thought it should be using SSH not HTTPS</p>\n\n<p>What's going on??</p>\n\n<p>Not feeling the love for Modules making my life easier so far...</p>\n"}, {"tags": ["go", "struct", "types", "error-handling"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1576405763, "post_id": 59342836, "comment_id": 104883186, "body": "Q2) the infinite recursion happens because <code>fmt</code> under the hood looks at the provided value and if that value implements a specific interface it will invoke its primary method, in this case the <code>Error</code> method of the <code>error</code> interface, but also types implementing the <code>Stringer</code> interface are susceptible to this. Therefore it is important in these kinds of methods, if they want to pass the receiver to <code>fmt</code>, to convert the receiver to a type that doesn&#39;t implement those interfaces, like you see in the example with <code>float64(e)</code>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1576423649, "post_id": 59342836, "comment_id": 104887005, "body": "Your title asked about a custom struct, but your example doesn&#39;t even use a strict. It&#39;s a float64."}], "answers": [{"comments": [{"owner": {"reputation": 2913, "user_id": 3705478, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/0Rnp5.jpg?s=128&g=1", "display_name": "sofs1", "link": "https://stackoverflow.com/users/3705478/sofs1"}, "edited": false, "score": 0, "creation_date": 1576404800, "post_id": 59342867, "comment_id": 104882989, "body": "So basically when I read Go code, how can I identify that there is an interface which is being implemented here?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 2913, "user_id": 3705478, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/0Rnp5.jpg?s=128&g=1", "display_name": "sofs1", "link": "https://stackoverflow.com/users/3705478/sofs1"}, "edited": false, "score": 2, "creation_date": 1576405457, "post_id": 59342867, "comment_id": 104883128, "body": "@sofs1 Go has no implict type conversion, so if you find the required type is not the same of the provided type, then it is either an interface implemented, or in a rare case, a type alias."}, {"owner": {"reputation": 6381, "user_id": 12354911, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Sz0V.jpg?s=128&g=1", "display_name": "Eldar", "link": "https://stackoverflow.com/users/12354911/eldar"}, "reply_to_user": {"reputation": 2913, "user_id": 3705478, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/0Rnp5.jpg?s=128&g=1", "display_name": "sofs1", "link": "https://stackoverflow.com/users/3705478/sofs1"}, "edited": false, "score": 0, "creation_date": 1576405929, "post_id": 59342867, "comment_id": 104883229, "body": "@sofs1 Interface implementation checked in the compile time. But you have the option check that explicitly as mentioned <a href=\"https://stackoverflow.com/questions/27803654/explanation-of-checking-if-value-implements-interface\">here</a>"}], "tags": [], "owner": {"reputation": 6381, "user_id": 12354911, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Sz0V.jpg?s=128&g=1", "display_name": "Eldar", "link": "https://stackoverflow.com/users/12354911/eldar"}, "is_accepted": false, "score": 1, "last_activity_date": 1576404520, "creation_date": 1576404520, "answer_id": 59342867, "question_id": 59342836, "link": "https://stackoverflow.com/questions/59342836/why-is-a-custom-struct-accepted-in-place-of-an-error/59342867#59342867", "title": "Why is a custom struct accepted in place of an error?", "body": "<p>Error is an interface that defines an <code>Error() string</code> method. If your error implements that interface it is fine.</p>\n\n<pre><code>func (e ErrNegativeSqrt) Error() string { \n    return fmt.Sprintf(\"cannot Sqrt negative number: %g\", float64(e))\n}\n</code></pre>\n\n<p>And that code exactly does it. Now your <code>ErrNegativeSqrt</code> type implements error interface.</p>\n\n<pre><code>if(x &lt; 0){\n        return x, ErrNegativeSqrt(x) // totally fine.\n    }\n</code></pre>\n\n<p>Documentation for <a href=\"https://golang.org/pkg/builtin/#error\" rel=\"nofollow noreferrer\">error</a></p>\n"}, {"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1576432232, "post_id": 59345427, "comment_id": 104889231, "body": "this is a continuation to understand internal representation of an interface value <a href=\"https://www.tapirgames.com/blog/golang-interface-implementation\" rel=\"nofollow noreferrer\">tapirgames.com/blog/golang-interface-implementation</a>"}, {"owner": {"reputation": 2913, "user_id": 3705478, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/0Rnp5.jpg?s=128&g=1", "display_name": "sofs1", "link": "https://stackoverflow.com/users/3705478/sofs1"}, "edited": false, "score": 0, "creation_date": 1576445008, "post_id": 59345427, "comment_id": 104892344, "body": "@torek Thank you very much for writing a detailed answer which really helps newbies like me. Few questions 1) Are these the only 8 basic (in-built in language) types in Golang? 2) What is meant by literal? I still can&#39;t wrap my head around literals. When they say String literal, map literal what are they?"}, {"owner": {"reputation": 2913, "user_id": 3705478, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/0Rnp5.jpg?s=128&g=1", "display_name": "sofs1", "link": "https://stackoverflow.com/users/3705478/sofs1"}, "edited": false, "score": 1, "creation_date": 1576446045, "post_id": 59345427, "comment_id": 104892577, "body": "@torek That behind the scenes compiler thing e = x explanation is beyond words. How do you guys learn all these?"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1576448409, "post_id": 59345427, "comment_id": 104893103, "body": "I&#39;m not sure how you are counting 8 in-built types. The spec (<a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">golang.org/ref/spec</a>) calls out <code>bool</code> + 17 numeric types + plus <code>string</code>. Array, slice, struct, pointer, function, and interface types are built atop these, so I&#39;d perhaps count 19 of these primitive types. It&#39;s true that some of the numeric types have the same underlying type (<code>int</code> matches, underneath, <code>int32</code> or <code>int64</code> for instance) but these are still different. However, <code>byte</code> and <code>rune</code> are type <i>aliases</i> so we can subtract 2 from the 19 to get 17. But the exact number isn&#39;t all that important."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1576448612, "post_id": 59345427, "comment_id": 104893143, "body": "As for literals, Go&#39;s are pretty conventional: they&#39;re defined starting at <a href=\"https://golang.org/ref/spec#Integer_literals\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Integer_literals</a> going down through <a href=\"https://golang.org/ref/spec#String_literals\" rel=\"nofollow noreferrer\">golang.org/ref/spec#String_literals</a>. What are unusual in Go are <i>constants</i> (<a href=\"https://golang.org/ref/spec#Constants\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Constants</a>) which may be untyped."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1576449012, "post_id": 59345427, "comment_id": 104893224, "body": "To learn these, it helps to go through the Go Tour <i>more than once</i>. I&#39;ve found that doing these information-dense tutorials at least twice, and sometimes three times, is wise: you miss a lot of things on the first pass, especially if you are used to learning from Huge Books Of Everything. Then, having done that, read through the entire Go spec (probably also two or three times, over the course of a month or more). Not everything will stick, but\u2014at least for me\u2014I&#39;ll remember: <i>oh, there was something in the spec about ____</i>."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1576449128, "post_id": 59345427, "comment_id": 104893253, "body": "At this point\u2014having read the spec at least twice, or maybe even during your second pass through it\u2014you&#39;re ready to look at things like @mh-cbon&#39;s link above, which talks about how the compiler and runtime conspire to <i>look up</i> methods when using interfaces and stuff like <code>reflect</code>. This sort of thing <i>isn&#39;t</i> part of the spec, on purpose, so that the compiler and runtime people can move on to a newer and more efficient conspiracy someday, if they can think of one."}], "tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 3, "last_activity_date": 1576424579, "creation_date": 1576424579, "answer_id": 59345427, "question_id": 59342836, "link": "https://stackoverflow.com/questions/59342836/why-is-a-custom-struct-accepted-in-place-of-an-error/59345427#59345427", "title": "Why is a custom struct accepted in place of an error?", "body": "<p>Go's <code>interface</code> is tricky.  It takes some experimenting with it to get a good feel for how to use it.  That's why the tutorial you're working with has you write things using it: you have to actually use it for a while before you can get to the point where you understand how to use it. :-)</p>\n\n<p>It's worth correcting some nits here though:</p>\n\n<blockquote>\n<pre><code>type ErrNegativeSqrt float64 //This is the custom Struct\n</code></pre>\n</blockquote>\n\n<p>This is not a <code>struct</code> type.  <code>float64</code> itself is a predeclared <em>numeric type</em>, <a href=\"https://golang.org/ref/spec#Numeric_types\" rel=\"nofollow noreferrer\">as defined here in the Go reference</a>:</p>\n\n<blockquote>\n  <p>A <em>numeric type</em> represents sets of integer or floating-point values. The predeclared architecture-independent numeric types are: [various entries snipped out here]</p>\n\n<pre><code>float64     the set of all IEEE-754 64-bit floating-point numbers\n</code></pre>\n</blockquote>\n\n<p>Your <code>type</code> declaration here creates a new type named <code>ErrNegativeSqrt</code> that has <code>float64</code> as its <em>underlying type</em>; see <a href=\"https://golang.org/ref/spec#Types\" rel=\"nofollow noreferrer\">the <strong>Types</strong> section</a>.</p>\n\n<p>A type\u2014any type, whether <code>struct</code> or not\u2014either <em>implements</em> an interface type, or does not.  An interface type is, well, complicated; see <a href=\"https://golang.org/ref/spec#Interface_types\" rel=\"nofollow noreferrer\">the <strong>Interface types</strong> section</a> for the full picture.  Go's <code>error</code> is a predeclared interface type, as defined by <a href=\"https://golang.org/ref/spec#Errors\" rel=\"nofollow noreferrer\">the <strong>Errors</strong> section</a>:</p>\n\n<blockquote>\n  <p>The predeclared type <code>error</code> is defined as</p>\n\n<pre><code>type error interface {\n    Error() string\n}\n</code></pre>\n</blockquote>\n\n<p>This means that whenever you define your own type <em>UserT</em>, if you add a line like this:</p>\n\n<pre><code>func (varname UserT) Error() string {\n    // return some string here\n}\n</code></pre>\n\n<p>your defined type <em>UserT</em> now <em>implements the error interface</em>.  As such, you can <em>convert</em> any value of type <em>UserT</em> to <code>error</code> via simple assignment.  See <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">the <strong>Assignability</strong> section</a>, which includes:</p>\n\n<blockquote>\n  <p>A value <code>x</code> is <em>assignable</em> to a variable of type <code>T</code>... if one of the following conditions applies: [some bullet items snipped]</p>\n  \n  <ul>\n  <li><code>T</code> is an interface type and <code>x</code> implements <code>T</code></li>\n  </ul>\n</blockquote>\n\n<p>We just saw that <code>error</code> is an interface type.  So, if some situation calls for a variable of type <code>error</code>, and you have some existing value <code>x</code> of type <code>UserT</code> where <code>UserT</code> has a method <code>Error() string</code>, you can assign that value <code>x</code> into the variable of type <code>error</code>.  That is, given <code>ErrNegativeSqrt</code> set up as you did, and:</p>\n\n<pre><code>var x ErrNegativeSqrt\n// set `x` to some valid value\n\n// and:\nvar e error\n</code></pre>\n\n<p>then:</p>\n\n<pre><code>e = x\n</code></pre>\n\n<p>is valid and assigns <code>x</code> into <code>e</code>, though the <em>type</em> of <em><code>e</code> itself</em> is an interface type, rather than <code>ErrNegativeSqrt</code>.</p>\n\n<p>When you stuff a copy of the value of <code>x</code> <em>into</em> <code>e</code> like this, the compiler actually sets up <em>two</em> things inside <code>e</code>.  In other words, <code>e</code> acts a lot like a two-element array, or a <code>struct</code> with two fields, except that you can't access the two fields with subscripts or <code>.field</code> type spellings.</p>\n\n<p>One of these two values\u2014the first half of <code>e</code>'s value\u2014is <code>x</code>'s <em>concrete type</em>.  The other of these two values is <code>x</code>'s actual value, copied into the other half of <code>e</code>.</p>\n\n<p>In other words, the compiler turns:</p>\n\n<pre><code>e = x\n</code></pre>\n\n<p>into the rough equivalent of:</p>\n\n<pre><code>e.value = x\ne.type = ErrNegativeSqrt\n</code></pre>\n\n<p>except, again, for the fact that you can't actually <em>write</em> <code>e.type</code> and <code>e.value</code>.  The compiler does the two-part-izing <em>for</em> you, automatically.</p>\n\n<p><a href=\"https://tour.golang.org/methods/11\" rel=\"nofollow noreferrer\">You should have already seen how you can pick apart the two parts of things stored into <code>e</code> if necessary.</a>  It's often <em>not</em> necessary, especially if the interface is well designed.  But it's worth backtracking to these earlier sections of the Tour after experimenting with error returns in <a href=\"https://tour.golang.org/methods/20\" rel=\"nofollow noreferrer\">#20</a>.</p>\n"}], "owner": {"reputation": 2913, "user_id": 3705478, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/0Rnp5.jpg?s=128&g=1", "display_name": "sofs1", "link": "https://stackoverflow.com/users/3705478/sofs1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 59345427, "answer_count": 2, "score": -2, "last_activity_date": 1576424579, "creation_date": 1576404152, "last_edit_date": 1576423622, "question_id": 59342836, "link": "https://stackoverflow.com/questions/59342836/why-is-a-custom-struct-accepted-in-place-of-an-error", "title": "Why is a custom struct accepted in place of an error?", "body": "<p>Learning Go and with reference to <a href=\"https://tour.golang.org/methods/20\" rel=\"nofollow noreferrer\">https://tour.golang.org/methods/20</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\ntype ErrNegativeSqrt float64 //This is the custom Struct\n\nfunc (e ErrNegativeSqrt) Error() string { \n    return fmt.Sprintf(\"cannot Sqrt negative number: %g\", float64(e))\n}\n\nfunc Sqrt(x float64) (float64, error) {  // Is error a type ?\n    if(x &lt; 0){\n        return x, ErrNegativeSqrt(x) //Q1) If error is a type, How come  ErrNegativeSqrt(x) is of type error?\n    }       \n    z := float64(1.5)\n    val := float64(0)\n    for {\n        z = z - (z*z-x)/(2*z)\n        if math.Abs(val-z) &lt; 1e-10 {\n            break\n        }\n        val = z\n    }\n    return val, nil\n}\n\nfunc main() {\n    fmt.Println(Sqrt(2))\n    fmt.Println(Sqrt(-2))\n}\n</code></pre>\n\n<p>Q2) Why does a call to fmt.Sprint(e) inside the Error method will send the program into an infinite loop?</p>\n"}, {"tags": ["go", "go-build"], "answers": [{"comments": [{"owner": {"reputation": 328, "user_id": 6571129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49309b5a0494a8ac26fc0e9fcaa4d34e?s=128&d=identicon&r=PG&f=1", "display_name": "Tuan", "link": "https://stackoverflow.com/users/6571129/tuan"}, "edited": false, "score": 0, "creation_date": 1576406776, "post_id": 59342483, "comment_id": 104883369, "body": "Thank you for the quick reply. Since it won&#39;t be the case to move the files I want to build, from the way I understand is that I should change the GOPATH src folder such that the library becomes allowed. I hope I&#39;m right @icza."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 328, "user_id": 6571129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49309b5a0494a8ac26fc0e9fcaa4d34e?s=128&d=identicon&r=PG&f=1", "display_name": "Tuan", "link": "https://stackoverflow.com/users/6571129/tuan"}, "edited": false, "score": 1, "creation_date": 1576408088, "post_id": 59342483, "comment_id": 104883612, "body": "@Tuan Internal packages are a compiler restriction. If you want to expose them, you have to remove the <code>internal</code> folder, and then of course you have to change the imports (import paths) too."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 22, "last_activity_date": 1576408177, "last_edit_date": 1576408177, "creation_date": 1576400365, "answer_id": 59342483, "question_id": 59342373, "link": "https://stackoverflow.com/questions/59342373/use-of-internal-package-not-allowed/59342483#59342483", "title": "Use of internal package not allowed", "body": "<p><a href=\"https://docs.google.com/document/d/1e8kOo3r51b2BWtTs_1uADIA5djfXhPT36s6eHVRIvaU/edit\" rel=\"noreferrer\">Internal packages</a> (packages that are inside a folder that has an <code>internal</code> folder in their path) can only be imported from packages rooted at the parent of the <code>internal</code> folder.</p>\n\n<p>E.g. a package <code>pkg/foo/internal/bar</code> can be imported by the package <code>pkg/foo/internal/baz</code> and also from <code>pkg/foo/baz</code>, but cannot be imported by the package <code>pkg</code> nor can it be imported by <code>pkg/bar</code>. This is by design. This is so big, complex packages can be broken into smaller packages without having to expose internals.</p>\n\n<p>You have to treat internal packages as \"private\" or non-existent from the \"outside\".</p>\n\n<p>See related: <a href=\"https://stackoverflow.com/questions/45899203/can-i-develop-a-go-package-in-multiple-source-directories/45902409#45902409\">Can I develop a go package in multiple source directories?</a></p>\n\n<p>Read more about internal packages at <a href=\"https://golang.org/cmd/go/#hdr-Internal_Directories\" rel=\"noreferrer\">Command go: Internal Directories</a>.</p>\n\n<p>Internal packages are a compiler restriction. If you want to expose them (if you want to use an internal package) in your own project, you have to remove the <code>internal</code> folder, and then of course you have to change the imports (import paths) too.</p>\n"}], "owner": {"reputation": 328, "user_id": 6571129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49309b5a0494a8ac26fc0e9fcaa4d34e?s=128&d=identicon&r=PG&f=1", "display_name": "Tuan", "link": "https://stackoverflow.com/users/6571129/tuan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10208, "favorite_count": 1, "accepted_answer_id": 59342483, "answer_count": 1, "score": 8, "last_activity_date": 1576423309, "creation_date": 1576399221, "last_edit_date": 1576423309, "question_id": 59342373, "link": "https://stackoverflow.com/questions/59342373/use-of-internal-package-not-allowed", "title": "Use of internal package not allowed", "body": "<p>I'm trying to build and run a repo (<a href=\"https://github.com/hyperledger/fabric/tree/master\" rel=\"noreferrer\">https://github.com/hyperledger/fabric/tree/master</a>) but this error keeps popping up and still I haven't found a solution to this.</p>\n\n<pre><code>consensus.go:12:2: use of internal package github.com/hyperledger/fabric/internal/pkg/identity not allowed\n</code></pre>\n\n<p>This is just one of many files that give this error.\nI'm pretty sure I'm doing something wrong since this repo is suppose to be working.</p>\n\n<p>Go version :</p>\n\n<pre><code>go version go1.13.5 linux/amd64\n</code></pre>\n\n<p>OS : Linux Mint 19.2 Cinnamon</p>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 2, "creation_date": 1576381245, "post_id": 59340498, "comment_id": 104879660, "body": "What have you tried? Why do you think there is a problem to return an <code>interface{}</code> together with an <code>error</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 2042, "user_id": 11424673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26ecf0fd0aa656482af8bc20d0d22c88?s=128&d=identicon&r=PG&f=1", "display_name": "Hymns For Disco", "link": "https://stackoverflow.com/users/11424673/hymns-for-disco"}, "is_accepted": false, "score": 0, "last_activity_date": 1576375765, "creation_date": 1576375765, "answer_id": 59340711, "question_id": 59340498, "link": "https://stackoverflow.com/questions/59340498/go-return-error-along-with-interface-from-a-function/59340711#59340711", "title": "Go return error along with interface from a function", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"errors\"\n)\n\nfunc return_something() (interface{}, error) {\n    return 123, errors.New(\"this is an error\")\n}\n\nfunc main() {\n    fmt.Println(return_something())\n}\n</code></pre>\n\n<p><code>123 this is an error</code></p>\n\n<p><a href=\"https://play.golang.org/p/qqy1-Tn0yBy\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qqy1-Tn0yBy</a></p>\n\n<p>Just a note:\nOne of Go's creators Rob Pike once said that the empty interface is one of the most abused features of Go, and many SO problems are caused by it being used inappropriately. Make sure you have considered if an empty interface is really appropriate for your use case</p>\n"}, {"tags": [], "owner": {"reputation": 550, "user_id": 3518621, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf3b0c525ec4ad5c29864f230486dea2?s=128&d=identicon&r=PG&f=1", "display_name": "cslrnr", "link": "https://stackoverflow.com/users/3518621/cslrnr"}, "is_accepted": false, "score": 0, "last_activity_date": 1576391146, "creation_date": 1576391146, "answer_id": 59341680, "question_id": 59340498, "link": "https://stackoverflow.com/questions/59340498/go-return-error-along-with-interface-from-a-function/59341680#59341680", "title": "Go return error along with interface from a function", "body": "<p>Yes your callback function could take multiple inputs and multiple return values. \nTry if function closure works for you. </p>\n\n<p><a href=\"https://tour.golang.org/moretypes/25\" rel=\"nofollow noreferrer\">Closures</a></p>\n\n<p>This is one way of using callbacks, there are many ways of using it. </p>\n\n<p><a href=\"https://play.golang.org/p/_4dQwJ_jPSD\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_4dQwJ_jPSD</a></p>\n\n<p>Try to map the functions in map and use it with key</p>\n\n<p>Try to assign function to function type etc</p>\n"}], "owner": {"reputation": 729, "user_id": 840821, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/aS3yN.jpg?s=128&g=1", "display_name": "Vikas Goel", "link": "https://stackoverflow.com/users/840821/vikas-goel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1576391146, "creation_date": 1576372630, "question_id": 59340498, "link": "https://stackoverflow.com/questions/59340498/go-return-error-along-with-interface-from-a-function", "title": "Go return error along with interface from a function", "body": "<p>Is there a way to return error with an interface for a function in golang?</p>\n\n<p><code>func abc(ctx context.Context, call func() error) (interface{}, err) {</code></p>\n\n<p>Something like the above prototype? The requirement is that I pass a function which could take in multiple input data type and return that particular data type.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "unsafe-pointers"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1576372783, "post_id": 59340441, "comment_id": 104878630, "body": "The address of the <code>i</code> fields in the two struct values have distinct values, therefore <code>unsafe.Pointer(&amp;s.i)</code> has distinct values. . The reflect package is the way to go if you don&#39;t want to make assumptions on how interfaces are represented in memory (<code>reflect.ValueOf(s.i).Pointer()</code>).    Why don&#39;t you want to use the reflect package?"}, {"owner": {"reputation": 312, "user_id": 3043018, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/GJ4VU.jpg?s=128&g=1", "display_name": "Inkeliz", "link": "https://stackoverflow.com/users/3043018/inkeliz"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1576373299, "post_id": 59340441, "comment_id": 104878682, "body": "@CeriseLim&#243;n  I thought that exists an <i>easier</i> way rather than reflect and understand how <code>reflect</code> get that value. I look at <code>reflect</code> and they use <a href=\"https://github.com/golang/go/blob/7d30af8e17d62932f8a458ad96f483b9afec6171/src/reflect/value.go#L139-L152\" rel=\"nofollow noreferrer\"><code>(*emptyInterface)(unsafe.Pointer(&amp;i)).word</code></a>, but I can&#39;t make it works outside <code>reflect</code>, seems that have some <i>magic</i> inside <code>reflect</code>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1576374166, "post_id": 59340441, "comment_id": 104878782, "body": "The expression <code>(*[2]uintptr)(unsafe.Pointer(&amp;s.i))[1]</code>, works, but there&#39;s no guarantee that it will work in the future.  The <a href=\"https://godoc.org/reflect#Value.Pointer\" rel=\"nofollow noreferrer\">Value.Pointer</a> method is the supported way to solve this problem. Other solutions require that you make assumptions about the memory layout. That does not seem easier to me."}, {"owner": {"reputation": 312, "user_id": 3043018, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/GJ4VU.jpg?s=128&g=1", "display_name": "Inkeliz", "link": "https://stackoverflow.com/users/3043018/inkeliz"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1576374851, "post_id": 59340441, "comment_id": 104878857, "body": "@CeriseLim&#243;n could you explain why it works? Please, publish it as an answer, then I can mark as &quot;correct answer&quot;. :)"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1576375425, "creation_date": 1576375425, "answer_id": 59340686, "question_id": 59340441, "link": "https://stackoverflow.com/questions/59340441/how-to-get-a-pointer-of-an-interface/59340686#59340686", "title": "How to get a pointer of an interface", "body": "<p>In the current version of Go, an interface value is two words long. The concrete value or a pointer to the concrete value is stored in the second word.  Use the following code to get the second word as a <code>uintptr</code>:</p>\n\n<pre><code>  u := (*[2]uintptr)(unsafe.Pointer(&amp;s.i))[1]\n</code></pre>\n\n<p>This code is unsafe and is not guaranteed to work in future. </p>\n\n<p>The supported way to get the pointer is:</p>\n\n<pre><code>  u := reflect.ValueOf(s.i).Pointer()\n</code></pre>\n"}], "owner": {"reputation": 312, "user_id": 3043018, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/GJ4VU.jpg?s=128&g=1", "display_name": "Inkeliz", "link": "https://stackoverflow.com/users/3043018/inkeliz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "accepted_answer_id": 59340686, "answer_count": 1, "score": 1, "last_activity_date": 1576375425, "creation_date": 1576371784, "last_edit_date": 1576372271, "question_id": 59340441, "link": "https://stackoverflow.com/questions/59340441/how-to-get-a-pointer-of-an-interface", "title": "How to get a pointer of an interface", "body": "<p>It's hard to explain, but how I can get a pointer of a <em>something</em> that implements some interface?</p>\n\n<hr>\n\n<p>Consider the code below:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\ntype Interface interface {\n    Example()\n}\n\ntype StructThatImplementsInterface struct {\n}\n\nfunc (i *StructThatImplementsInterface) Example() {\n}\n\ntype StructThatHasInterface struct {\n    i Interface\n}\n\n\nfunc main() {\n    sameInterface := &amp;StructThatImplementsInterface{}\n\n    struct1 := StructThatHasInterface{i: sameInterface}\n    struct2 := StructThatHasInterface{i: sameInterface}\n\n    TheProblemIsHere(&amp;struct1)\n    TheProblemIsHere(&amp;struct2)\n\n}\n\nfunc TheProblemIsHere(s *StructThatHasInterface) {\n    fmt.Printf(\"Pointer by Printf: %p \\n\", s.i)\n    fmt.Printf(\"Pointer by Usafe: %v \\n\", unsafe.Pointer(&amp;s.i))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/HoC5_BBeswA\" rel=\"nofollow noreferrer\">https://play.golang.org/p/HoC5_BBeswA</a></p>\n\n<hr>\n\n<p>The result will be:</p>\n\n<pre><code>Pointer by Printf: 0x40c138 \nPointer by Usafe: 0x40c140 \nPointer by Printf: 0x40c138 \nPointer by Usafe: 0x40c148 \n</code></pre>\n\n<p>Notice that the <code>Printf</code> gets the same value (because both <code>StructThatHasInterface</code> uses the same <code>sameInterface</code>). However, the <code>unsafe.Pointer()</code> returns distinct values.</p>\n\n<p>How can I get the same result of <code>Printf</code> without use <code>fmt</code>, and <code>reflect</code> if possible?</p>\n"}, {"tags": ["html", "regex", "parsing", "go"], "comments": [{"owner": {"reputation": 4244, "user_id": 3348112, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab4cd9458f5debd780353a5554b718d8?s=128&d=identicon&r=PG&f=1", "display_name": "CAustin", "link": "https://stackoverflow.com/users/3348112/caustin"}, "edited": false, "score": 2, "creation_date": 1576373303, "post_id": 59340386, "comment_id": 104878683, "body": "Regex is badly suited for this. Use a DOM parser instead."}, {"owner": {"reputation": 4244, "user_id": 3348112, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab4cd9458f5debd780353a5554b718d8?s=128&d=identicon&r=PG&f=1", "display_name": "CAustin", "link": "https://stackoverflow.com/users/3348112/caustin"}, "edited": false, "score": 1, "creation_date": 1576373355, "post_id": 59340386, "comment_id": 104878696, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags\">RegEx match open tags except XHTML self-contained tags</a>"}, {"owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "reply_to_user": {"reputation": 4244, "user_id": 3348112, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab4cd9458f5debd780353a5554b718d8?s=128&d=identicon&r=PG&f=1", "display_name": "CAustin", "link": "https://stackoverflow.com/users/3348112/caustin"}, "edited": false, "score": 1, "creation_date": 1576373479, "post_id": 59340386, "comment_id": 104878711, "body": "The answer there says not to use regex"}, {"owner": {"reputation": 4244, "user_id": 3348112, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ab4cd9458f5debd780353a5554b718d8?s=128&d=identicon&r=PG&f=1", "display_name": "CAustin", "link": "https://stackoverflow.com/users/3348112/caustin"}, "edited": false, "score": 1, "creation_date": 1576373572, "post_id": 59340386, "comment_id": 104878721, "body": "Yes, exactly. It is not recommended to attempt using regex for this sort of issue."}], "answers": [{"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 2, "last_activity_date": 1576376873, "creation_date": 1576376873, "answer_id": 59340779, "question_id": 59340386, "link": "https://stackoverflow.com/questions/59340386/how-can-i-match-text-that-precedes-an-a-tag-then-return-the-a-node/59340779#59340779", "title": "How can I match text that precedes an `&lt;a&gt;` tag then return the `&lt;a&gt;` node?", "body": "<p>You're actually pretty close, because you are already using a proper parser (<code>html.Parse</code> from <code>golang.org/x/net/html</code>).</p>\n\n<p>The trick here is that the various elements of the page are bound together conveniently, so you can use your existing <code>crawler</code> code with a later filtering function, if you like.  (You could instead combine the filtering directly into the crawler.)</p>\n\n<p>Each <code>n *html.ElementNode</code> is preceded by something unless it's the initial element in a block (first of a document or first child node), and that <em>something</em> is in <code>n.PrevSibling</code>.  If its type is <code>html.TextNode</code> you have a sequence of the form:</p>\n\n<pre><code>some text&lt;a ...&gt;thing&lt;/a&gt;\n</code></pre>\n\n<p>and you can examine the \"some text\" in the previous node:</p>\n\n<pre><code>func wanted(re *regexp.Regexp, n *html.Node) bool {\n    if n.PrevSibling == nil || n.PrevSibling.Type != html.TextNode {\n        return false\n    }\n    return re.MatchString(n.PrevSibling.Data)\n}\n</code></pre>\n\n<p>This won't be perfect, because you could have, e.g.:</p>\n\n<pre><code>text &lt;font&gt;&lt;/font&gt; broken &lt;font&gt;&lt;/font&gt;up&lt;a href=\"lastlink\"&gt;last link&lt;/a&gt;\n</code></pre>\n\n<p>and the code will try to match against the string <code>up</code>, when you probably should put the text together into <code>text broken up</code> and pass that to the matcher.  See more complete example <a href=\"https://play.golang.org/p/mHTkSwlcCNA\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 1, "accepted_answer_id": 59340779, "answer_count": 1, "score": -1, "last_activity_date": 1576376873, "creation_date": 1576370990, "last_edit_date": 1576372429, "question_id": 59340386, "link": "https://stackoverflow.com/questions/59340386/how-can-i-match-text-that-precedes-an-a-tag-then-return-the-a-node", "title": "How can I match text that precedes an `&lt;a&gt;` tag then return the `&lt;a&gt;` node?", "body": "<p>I have the following, where I am trying to only capture the second case, where the text matches <code>But I want this one here</code>. Currently, it captures both cases.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"io\"\n    \"strings\"\n\n    \"golang.org/x/net/html\"\n)\n\nfunc getTag(doc *html.Node, tag string) []*html.Node {\n    var nodes []*html.Node\n    var crawler func(*html.Node)\n    crawler = func(node *html.Node) {\n        if node.Type == html.ElementNode &amp;&amp; node.Data == tag {\n            nodes = append(nodes, node)\n            return\n        }\n        for child := node.FirstChild; child != nil; child = child.NextSibling {\n            crawler(child)\n        }\n    }\n    crawler(doc)\n    return nodes\n}\n\nfunc main() {\n    doc, _ := html.Parse(strings.NewReader(testHTML))\n    nodes := getTag(doc, \"a\")\n\n    var buf bytes.Buffer\n    w := io.Writer(&amp;buf)\n    for i, node := range nodes {\n        html.Render(w, node)\n        if i &lt; (len(nodes) - 1) {\n            w.Write([]byte(\"\\n\"))\n        }\n    }\n\n    fmt.Println(buf.String())\n}\n\nvar testHTML = `&lt;html&gt;&lt;body&gt;\nI do not want this link here &lt;a href=\"blah\"&gt;link text&lt;/a&gt;\nBut I want this one here &lt;a href=\"blah blah\"&gt;more link text&lt;/a&gt;\n&lt;/body&gt;&lt;/html&gt;`\n</code></pre>\n\n<p>This outputs:</p>\n\n<p><code>&lt;a href=\"blah\"&gt;link text&lt;/a&gt;\n&lt;a href=\"blah blah\"&gt;more link text&lt;/a&gt;</code></p>\n\n<p>I would like to match specific text that precedes an <code>&lt;a&gt;</code> tag and, if it matches, return the <code>&lt;a&gt;</code> node. For instance, pass in <code>But I want this one here</code> and it returns <code>&lt;a href=\"blah blah\"&gt;more link text&lt;/a&gt;</code>. I've been told to not parse html with regex but now I am stuck. </p>\n"}, {"tags": ["go", "https", "caddy"], "answers": [{"tags": [], "owner": {"reputation": 93, "user_id": 8179850, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O4s9O.jpg?s=128&g=1", "display_name": "fall simply", "link": "https://stackoverflow.com/users/8179850/fall-simply"}, "is_accepted": true, "score": 2, "last_activity_date": 1576382048, "creation_date": 1576382048, "answer_id": 59341110, "question_id": 59340274, "link": "https://stackoverflow.com/questions/59340274/https-connection-gives-privacy-error-in-browser-caddy-server/59341110#59341110", "title": "HTTPS Connection gives Privacy error in Browser. - Caddy Server", "body": "<p>The <a href=\"https://caddyserver.com/v1/docs/tls#examples\" rel=\"nofollow noreferrer\">caddy docs</a> says the \"self-signed certificate [is stored] in memory (untrusted by browsers, but convenient for local development)\".</p>\n\n<p>You'd have to generate the self-signed certificate outside of caddy and add it like a regular certificate. </p>\n\n<p>Here's a guide to do it on <a href=\"https://devcenter.heroku.com/articles/ssl-certificate-self\" rel=\"nofollow noreferrer\">Linux and MacOS</a> or <a href=\"https://medium.com/the-new-control-plane/generating-self-signed-certificates-on-windows-7812a600c2d8\" rel=\"nofollow noreferrer\">Windows</a></p>\n\n<p>Config Example from the docs</p>\n\n<pre><code>tls ../cert.pem ../key.pem\n</code></pre>\n\n<p>This snippet assumes the keys are located one folder up</p>\n\n<p>BTW All this should work with Caddy 2</p>\n"}], "owner": {"reputation": 11, "user_id": 11213936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1999f263e0e0e3e039e59f66c97695d?s=128&d=identicon&r=PG", "display_name": "danvixent", "link": "https://stackoverflow.com/users/11213936/danvixent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 641, "favorite_count": 1, "accepted_answer_id": 59341110, "answer_count": 1, "score": 0, "last_activity_date": 1576382048, "creation_date": 1576369367, "question_id": 59340274, "link": "https://stackoverflow.com/questions/59340274/https-connection-gives-privacy-error-in-browser-caddy-server", "title": "HTTPS Connection gives Privacy error in Browser. - Caddy Server", "body": "<p>After modifying my Caddyfile to try a recommendation on this platform...i still can't get an\nHTTPS connection in my browser..Chrome keeps saying \n\"<code>Your connection is not private\nAttackers might be trying to steal your information from localhost (for example, passwords, messages, or credit cards). Learn more\nNET::ERR_CERT_AUTHORITY_INVALID</code>\"</p>\n\n<p>Here's my Caddyfile :</p>\n\n<p><code>localhost:9000 {\n    bind {$ADDRESS}\n    proxy / 197.211.58.62:9000\n    tls self_signed\n}</code></p>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["macos", "go", "keychain"], "answers": [{"tags": [], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "is_accepted": true, "score": 1, "last_activity_date": 1576371820, "creation_date": 1576371820, "answer_id": 59340443, "question_id": 59339941, "link": "https://stackoverflow.com/questions/59339941/adding-a-self-signed-certificate-as-a-trusted-root-certificate-to-an-apple-keych/59340443#59340443", "title": "Adding a self-signed certificate as a trusted root certificate to an Apple keychain", "body": "<p>Following <a href=\"https://www.jamf.com/jamf-nation/discussions/13812/problems-importing-cert-via-terminal\" rel=\"nofollow noreferrer\">https://www.jamf.com/jamf-nation/discussions/13812/problems-importing-cert-via-terminal</a>, I worked around this problem by composing a configuration profile containing the certificate and installing that with the <code>profiles</code> command line tool rather than using the <code>security</code> one directly. Here is the adapted script:</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/rand\"\n    \"crypto/rsa\"\n    \"crypto/x509\"\n    \"crypto/x509/pkix\"\n    \"encoding/pem\"\n    \"io/ioutil\"\n    \"math/big\"\n    \"os\"\n    \"os/exec\"\n    \"strings\"\n    \"time\"\n\n    uuid \"github.com/satori/go.uuid\"\n    \"github.com/sirupsen/logrus\"\n    \"howett.net/plist\"\n)\n\n// Payload represents a configuration profile's payload. (Adapted from https://github.com/micromdm/micromdm/blob/master/mdm/enroll/profile.go).\ntype Payload struct {\n    PayloadType         string      `json:\"type\"`\n    PayloadVersion      int         `json:\"version\"`\n    PayloadIdentifier   string      `json:\"identifier\"`\n    PayloadUUID         string      `json:\"uuid\"`\n    PayloadDisplayName  string      `json:\"displayname\" plist:\",omitempty\"`\n    PayloadDescription  string      `json:\"description,omitempty\" plist:\",omitempty\"`\n    PayloadOrganization string      `json:\"organization,omitempty\" plist:\",omitempty\"`\n    PayloadScope        string      `json:\"scope\" plist:\",omitempty\"`\n    PayloadContent      interface{} `json:\"content,omitempty\" plist:\"PayloadContent,omitempty\"`\n}\n\n// Profile represents a configuration profile (cf. https://developer.apple.com/business/documentation/Configuration-Profile-Reference.pdf)\ntype Profile struct {\n    PayloadContent           []interface{}     `json:\"content,omitempty\"`\n    PayloadDescription       string            `json:\"description,omitempty\" plist:\",omitempty\"`\n    PayloadDisplayName       string            `json:\"displayname,omitempty\" plist:\",omitempty\"`\n    PayloadExpirationDate    *time.Time        `json:\"expiration_date,omitempty\" plist:\",omitempty\"`\n    PayloadIdentifier        string            `json:\"identifier\"`\n    PayloadOrganization      string            `json:\"organization,omitempty\" plist:\",omitempty\"`\n    PayloadUUID              string            `json:\"uuid\"`\n    PayloadRemovalDisallowed bool              `json:\"removal_disallowed\" plist:\",omitempty\"`\n    PayloadType              string            `json:\"type\"`\n    PayloadVersion           int               `json:\"version\"`\n    PayloadScope             string            `json:\"scope\" plist:\",omitempty\"`\n    RemovalDate              *time.Time        `json:\"removal_date\" plist:\"-\" plist:\",omitempty\"`\n    DurationUntilRemoval     float32           `json:\"duration_until_removal\" plist:\",omitempty\"`\n    ConsentText              map[string]string `json:\"consent_text\" plist:\",omitempty\"`\n}\n\ntype CertificatePayload struct {\n    Payload\n    PayloadContent             []byte\n    PayloadCertificateFileName string `plist:\",omitempty\"`\n    Password                   string `plist:\",omitempty\"`\n    AllowAllAppsAccess         bool   `plist:\",omitempty\"`\n}\n\n// NewProfile creates a new configuration profile\nfunc NewProfile() *Profile {\n    payloadUUID := uuid.NewV4()\n\n    return &amp;Profile{\n        PayloadVersion: 1,\n        PayloadType:    \"Configuration\",\n        PayloadUUID:    payloadUUID.String(),\n    }\n}\n\n// NewPayload creates a new payload\nfunc NewPayload(payloadType string) *Payload {\n    payloadUUID := uuid.NewV4()\n\n    return &amp;Payload{\n        PayloadVersion: 1,\n        PayloadType:    payloadType,\n        PayloadUUID:    payloadUUID.String(),\n    }\n}\n\nfunc NewCertificateProfile(certPEM []byte) *Profile {\n    profile := NewProfile()\n    profile.PayloadDescription = \"Awesome Payload\"\n    profile.PayloadDisplayName = \"Awesome Certificate\"\n    profile.PayloadIdentifier = \"com.awesomeness.certificate\"\n    profile.PayloadScope = \"System\"\n    profile.PayloadOrganization = \"Awesomeness, Inc.\"\n\n    payload := NewPayload(\"com.apple.security.pem\")\n    payload.PayloadDescription = \"Awesome Certificate\"\n    payload.PayloadDisplayName = \"Awesome Certificate\"\n    payload.PayloadOrganization = \"Awesomeness, Inc.\"\n    payload.PayloadIdentifier = profile.PayloadIdentifier + \".\" + payload.PayloadUUID\n\n    certificatePayload := CertificatePayload{\n        Payload:        *payload,\n        PayloadContent: certPEM,\n    }\n\n    profile.PayloadContent = []interface{}{certificatePayload}\n\n    return profile\n}\n\nfunc generateSelfSignedCertificate(keyFileName, certFileName string) {\n    // Generate a self-signed certificate (adapted from https://golang.org/src/crypto/tls/generate_cert.go)\n    key, err := rsa.GenerateKey(rand.Reader, 4096)\n    if err != nil {\n        logrus.WithError(err).Fatal(\"generate key\")\n    }\n\n    keyFile, err := os.Create(keyFileName)\n    if err != nil {\n        logrus.WithError(err).Fatal(\"create key file\")\n    }\n    if err = pem.Encode(keyFile, &amp;pem.Block{\n        Type:  \"RSA PRIVATE KEY\",\n        Bytes: x509.MarshalPKCS1PrivateKey(key),\n    }); err != nil {\n        logrus.WithError(err).Fatal(\"marshal private key\")\n    }\n    keyFile.Close()\n\n    template := x509.Certificate{\n        SerialNumber: big.NewInt(42),\n        Subject: pkix.Name{\n            Country:            []string{\"US\"},\n            Organization:       []string{\"Awesomeness, Inc.\"},\n            OrganizationalUnit: []string{\"Awesomeness Dept.\"},\n            CommonName:         \"Awesomeness 4, Inc.\",\n        },\n        NotBefore:             time.Now(),\n        NotAfter:              time.Now().AddDate(10, 0, 0),\n        KeyUsage:              x509.KeyUsageKeyEncipherment | x509.KeyUsageDigitalSignature | x509.KeyUsageCertSign,\n        ExtKeyUsage:           []x509.ExtKeyUsage{x509.ExtKeyUsageServerAuth},\n        IsCA:                  true,\n        BasicConstraintsValid: true,\n    }\n\n    derBytes, err := x509.CreateCertificate(rand.Reader, &amp;template, &amp;template, &amp;key.PublicKey, key)\n    if err != nil {\n        logrus.WithError(err).Fatal(\"failed to create certificate\")\n    }\n\n    certFile, err := os.Create(certFileName)\n    if err != nil {\n        logrus.WithError(err).Fatal(\"create cert file\")\n    }\n    if err = pem.Encode(certFile, &amp;pem.Block{\n        Type:  \"CERTIFICATE\",\n        Bytes: derBytes,\n    }); err != nil {\n        logrus.WithError(err).Fatal(\"encode certificate\")\n    }\n    certFile.Close()\n}\n\nfunc main() {\n    keyFileName := \"key.pem\"\n    certFileName := \"cert.pem\"\n    profileFileName := \"certificate.mobileconfig\"\n\n    generateSelfSignedCertificate(keyFileName, certFileName)\n\n    certPEM, err := ioutil.ReadFile(certFileName)\n    if err != nil {\n        logrus.WithError(err).Fatal(\"read certificate file\")\n    }\n\n    certificateProfile := NewCertificateProfile(certPEM)\n\n    mobileconfig, err := plist.MarshalIndent(certificateProfile, plist.XMLFormat, \"\\t\")\n    if err != nil {\n        logrus.WithError(err).Fatal(\"marshal plist\")\n    }\n\n    if err := ioutil.WriteFile(profileFileName, mobileconfig, 0755); err != nil {\n        logrus.WithError(err).Fatal(\"write mobileconfig to file\")\n    }\n\n    args := []string{\"install\", \"-path\", profileFileName}\n\n    output, err := exec.Command(\"/usr/bin/profiles\", args...).CombinedOutput()\n    if err != nil {\n        logrus.Fatalf(\"%s: %v - %s\", \"/usr/bin/profiles\"+strings.Join(args, \" \"), err, output)\n    }\n}\n</code></pre>\n\n<p>Upon running this with <code>sudo -E go run add_certificate.go</code>, the certificate with common name <code>Awesomeness 4, Inc.</code> appears as a trusted cert in my keychain:</p>\n\n<p><a href=\"https://i.stack.imgur.com/EFJgv.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/EFJgv.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 589, "favorite_count": 1, "accepted_answer_id": 59340443, "answer_count": 1, "score": 1, "last_activity_date": 1576371820, "creation_date": 1576364922, "question_id": 59339941, "link": "https://stackoverflow.com/questions/59339941/adding-a-self-signed-certificate-as-a-trusted-root-certificate-to-an-apple-keych", "title": "Adding a self-signed certificate as a trusted root certificate to an Apple keychain", "body": "<p>I'm trying to add a self-signed certificate to the system keychain on a MacOS device using the following Go script:</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/rand\"\n    \"crypto/rsa\"\n    \"crypto/x509\"\n    \"crypto/x509/pkix\"\n    \"encoding/pem\"\n    \"math/big\"\n    \"os\"\n    \"os/exec\"\n    \"time\"\n\n    \"github.com/sirupsen/logrus\"\n)\n\nfunc main() {\n    keyFileName := \"key.pem\"\n    certFileName := \"cert.pem\"\n\n    // Generate a self-signed certificate (adapted from https://golang.org/src/crypto/tls/generate_cert.go)\n    key, err := rsa.GenerateKey(rand.Reader, 4096)\n    if err != nil {\n        logrus.WithError(err).Fatal(\"generate key\")\n    }\n\n    keyFile, err := os.Create(keyFileName)\n    if err != nil {\n        logrus.WithError(err).Fatal(\"create key file\")\n    }\n    if err = pem.Encode(keyFile, &amp;pem.Block{\n        Type:  \"RSA PRIVATE KEY\",\n        Bytes: x509.MarshalPKCS1PrivateKey(key),\n    }); err != nil {\n        logrus.WithError(err).Fatal(\"marshal private key\")\n    }\n    keyFile.Close()\n\n    template := x509.Certificate{\n        SerialNumber: big.NewInt(42),\n        Subject: pkix.Name{\n            Country:            []string{\"US\"},\n            Organization:       []string{\"Awesomeness, Inc.\"},\n            OrganizationalUnit: []string{\"Awesomeness Dept.\"},\n            CommonName:         \"Awesomeness, Inc.\",\n        },\n        NotBefore:             time.Now(),\n        NotAfter:              time.Now().AddDate(10, 0, 0),\n        KeyUsage:              x509.KeyUsageKeyEncipherment | x509.KeyUsageDigitalSignature | x509.KeyUsageCertSign,\n        ExtKeyUsage:           []x509.ExtKeyUsage{x509.ExtKeyUsageServerAuth},\n        IsCA:                  true,\n        BasicConstraintsValid: true,\n    }\n\n    derBytes, err := x509.CreateCertificate(rand.Reader, &amp;template, &amp;template, &amp;key.PublicKey, key)\n    if err != nil {\n        logrus.WithError(err).Fatal(\"failed to create certificate\")\n    }\n\n    certFile, err := os.Create(certFileName)\n    if err != nil {\n        logrus.WithError(err).Fatal(\"create cert file\")\n    }\n    if err = pem.Encode(certFile, &amp;pem.Block{\n        Type:  \"CERTIFICATE\",\n        Bytes: derBytes,\n    }); err != nil {\n        logrus.WithError(err).Fatal(\"encode certificate\")\n    }\n    certFile.Close()\n\n    /*\n        add-trusted-cert [-d] [-r resultType] [-p policy] [-a appPath] [-s policyString] [-e allowedError] [-u\n        keyUsage] [-k keychain] [-i settingsFileIn] [-o settingsFileOut] certFile\n            Add certificate (in DER or PEM format) from certFile to per-user or local Admin Trust Settings. When\n            modifying per-user Trust Settings, user authentication is required via an authentication dialog. When\n            modifying admin Trust Settings, the process must be running as root, or admin authentication is\n            required.\n\n            Options:\n            -d              Add to admin cert store; default is user.\n            -r resultType   resultType = trustRoot|trustAsRoot|deny|unspecified; default is trustRoot.\n            -p policy       Specify policy constraint (ssl, smime, codeSign, IPSec, basic, swUpdate, pkgSign,\n                            eap, macappstore, appleID, timestamping).\n            -a appPath      Specify application constraint.\n            -s policyString\n                            Specify policy-specific string.\n            -e allowedError\n                            Specify allowed error (an integer value, or one of: certExpired, hostnameMismatch)\n            -u keyUsage     Specify key usage, an integer.\n            -k keychain     Specify keychain to which cert is added.\n            -i settingsFileIn\n                            Input trust settings file; default is user domain.\n            -o settingsFileOut\n                            Output trust settings file; default is user domain.\n\n            Key usage codes:\n                            -1 - Any\n                            1 - Sign\n                            2 - Encrypt/Decrypt Data\n                            4 - Encrypt/Decrypt Key\n                            8 - Sign certificate\n                            16 - Sign revocation\n                            32 - Key exchange\n                            To specify more than one usage, add values together (except -1 - Any).\n    */\n\n    args := []string{\"add-trusted-cert\", \"-k\", \"/Library/Keychains/System.keychain\", \"-r\", \"trustAsRoot\", certFileName}\n\n    output, err := exec.Command(\"/usr/bin/security\", args...).CombinedOutput()\n    if err != nil {\n        logrus.Fatalf(\"add-trusted-cert: %v - %s\", err, output)\n    }\n}\n</code></pre>\n\n<p>However, when I run this script with <code>sudo</code>, I get a rather unspecific \"One or more parameters passed to a function were not valid.\" error:</p>\n\n<pre><code>&gt; sudo go run add_to_keychain_trusted.go\nPassword:\nFATA[0002] add-trusted-cert: exit status 1 - SecTrustSettingsSetTrustSettings: One or more parameters passed to a function were not valid. \nexit status 1\n</code></pre>\n\n<p>One thing I've noticed is that if I use the <code>-r trustRoot</code> option instead of <code>-r trustAsRoot</code>, the command works. Perhaps the <code>-r trustAsRoot</code> option is no longer supported (although it is documented in the <code>man security</code> page)?</p>\n"}, {"tags": ["html", "regex", "go"], "comments": [{"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 3, "creation_date": 1576361257, "post_id": 59339541, "comment_id": 104876726, "body": "<code>.</code> matches any char. Actually, you still should consider some HTML parser. If you want to use a regex, you should think of some workarounds with negated character classes, see <a href=\"https://regex101.com/r/iEXpqc/2\" rel=\"nofollow noreferrer\">an example</a>."}, {"owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1576361474, "post_id": 59339541, "comment_id": 104876771, "body": "Yeah, I&#39;m thinking the same but couldn&#39;t figure it out with Goquery. The example posted matches the wrong text, btw."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1576361541, "post_id": 59339541, "comment_id": 104876784, "body": "Yeah, it is not quite clear anyway what the criteria for a match are."}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 1, "creation_date": 1576362175, "post_id": 59339541, "comment_id": 104876911, "body": "Have you considered an XPath package? XPath can be a little horrific but it does support looking inside text nodes."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1576380977, "post_id": 59339541, "comment_id": 104879627, "body": "See: <a href=\"https://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags/1732454#1732454\" title=\"regex match open tags except xhtml self contained tags\">stackoverflow.com/questions/1732348/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 142005, "user_id": 465183, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/3b518a0ea4c992cfe9965671d0139ba4?s=128&d=identicon&r=PG", "display_name": "Gilles Quenot", "link": "https://stackoverflow.com/users/465183/gilles-quenot"}, "is_accepted": true, "score": 0, "last_activity_date": 1576366047, "creation_date": 1576366047, "answer_id": 59340037, "question_id": 59339541, "link": "https://stackoverflow.com/questions/59339541/what-is-the-best-way-to-match-html-text-that-is-outside-of-an-html-tag-in-go/59340037#59340037", "title": "What is the best way to match html text that is outside of an html tag in Go?", "body": "<p>Like this, using <a href=\"/questions/tagged/xpath\" class=\"post-tag\" title=\"show questions tagged &#39;xpath&#39;\" rel=\"tag\">xpath</a> (not <a href=\"/questions/tagged/go\" class=\"post-tag\" title=\"show questions tagged &#39;go&#39;\" rel=\"tag\">go</a>, but the logic can be re-implemented):</p>\n\n<pre><code>xmlstarlet ed -d '//a[contains(text(), \"want to match\")]' file.html\n</code></pre>\n\n<h2>\u00a0Output</h2>\n\n<pre><code>&lt;?xml version=\"1.0\"?&gt;\n&lt;html&gt;\n  &lt;body&gt;\nThis is the start.  \n\n&lt;a href=\"http://www.example.com/another/path\" style=\"font-family:Arial, Helvetica, 'sans-serif'; color:#838383;font-size:12px; line-height:14px\"/&gt; match this text.\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<h2>\u00a0Note</h2>\n\n<ul>\n<li>add <code>-L</code> switch if you want to replace <em>on the fly</em></li>\n</ul>\n"}], "owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 1, "accepted_answer_id": 59340037, "answer_count": 1, "score": 0, "last_activity_date": 1576366047, "creation_date": 1576360903, "last_edit_date": 1576361106, "question_id": 59339541, "link": "https://stackoverflow.com/questions/59339541/what-is-the-best-way-to-match-html-text-that-is-outside-of-an-html-tag-in-go", "title": "What is the best way to match html text that is outside of an html tag in Go?", "body": "<p>I have a bunch of html I am parsing and I need to remove certain <code>&lt;a&gt;</code> tags if they contain certain text. Normally, I'd use Goquery BUT the text I am searching for often falls outside the html tag itself. For instance, this html:</p>\n\n<pre><code>&lt;html&gt;&lt;body&gt;\nThis is the start.            \n&lt;a href=\"http://example.com/path\"&gt;We don't want to match this text.&lt;/a&gt;\n&lt;a href=\"http://www.example.com/another/path\" style=\"font-family:Arial, Helvetica, 'sans-serif'; color:#838383;font-size:12px; line-height:14px\"&gt;&lt;/a&gt; match this text.&lt;a href=\"blah\"&gt;We also don't want to match this text&lt;/a&gt;\n&lt;/body&gt;&lt;/html&gt;\n</code></pre>\n\n<p>I am using this regexp but it is failing and matching the text I don't want to match: </p>\n\n<pre><code>(?is)&lt;a[^&gt;]+href=[\"'](?P&lt;link&gt;.*?)[\"']*.?&gt; match this text\\.\n</code></pre>\n\n<p><a href=\"https://regex101.com/r/iEXpqc/1\" rel=\"nofollow noreferrer\">https://regex101.com/r/iEXpqc/1</a></p>\n"}, {"tags": ["go", "buffalo"], "answers": [{"tags": [], "owner": {"reputation": 316, "user_id": 4901191, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--zVehh4nWiU/AAAAAAAAAAI/AAAAAAAAAGU/8tzmW126jBM/photo.jpg?sz=128", "display_name": "Stanislas Michalak", "link": "https://stackoverflow.com/users/4901191/stanislas-michalak"}, "is_accepted": true, "score": 3, "last_activity_date": 1576400825, "creation_date": 1576400825, "answer_id": 59342516, "question_id": 59339215, "link": "https://stackoverflow.com/questions/59339215/how-to-fix-gobuffalo-buffalo-plugins-plugdeps-plugin-go1511-undefined-meta/59342516#59342516", "title": "How to fix &#39;/gobuffalo/buffalo/plugins/plugdeps/plugin.go:15:11: undefined: meta.BuildTags&#39; error after installing gobuffalo", "body": "<p>As explained <a href=\"https://github.com/gobuffalo/buffalo/issues/1723\" rel=\"nofollow noreferrer\">here</a>, GOPATH is no longer supported by Buffalo. You either need to create your project somewhere else, or explicitly set the <code>GO111MODULE</code> environment variable to <code>on</code>.</p>\n"}], "owner": {"reputation": 315, "user_id": 2118099, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/a390d5b3febaaaa60dfcfa9258c5ed1e?s=128&d=identicon&r=PG", "display_name": "rrcm", "link": "https://stackoverflow.com/users/2118099/rrcm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 352, "favorite_count": 0, "accepted_answer_id": 59342516, "answer_count": 1, "score": 2, "last_activity_date": 1576400825, "creation_date": 1576358154, "question_id": 59339215, "link": "https://stackoverflow.com/questions/59339215/how-to-fix-gobuffalo-buffalo-plugins-plugdeps-plugin-go1511-undefined-meta", "title": "How to fix &#39;/gobuffalo/buffalo/plugins/plugdeps/plugin.go:15:11: undefined: meta.BuildTags&#39; error after installing gobuffalo", "body": "<p>I am running Ubuntu 19.10 and Go 1.13.4.</p>\n\n<p>I installed gobuffalo following the instructions here: <a href=\"https://gobuffalo.io/en/docs/getting-started/installation#gnu-linux\" rel=\"nofollow noreferrer\">https://gobuffalo.io/en/docs/getting-started/installation#gnu-linux</a></p>\n\n<p>The error occurs after running the new command to start a project</p>\n\n<pre><code>buffalo new coke\nDEBU[2019-12-14T15:41:23-05:00] Step: 5b3c4d92\nDEBU[2019-12-14T15:41:23-05:00] Chdir: /home/ramon/go/src/github.com/cabral-ramon/coke\nDEBU[2019-12-14T15:41:23-05:00] File: /home/ramon/go/src/github.com/cabral-ramon/coke/.codeclimate.yml\nDEBU[2019-12-14T15:41:23-05:00] File: /home/ramon/go/src/github.com/cabral-ramon/coke/.env\nDEBU[2019-12-14T15:41:23-05:00] File: /home/ramon/go/src/github.com/cabral-ramon/coke/README.md\nDEBU[2019-12-14T15:41:23-05:00] File: /home/ramon/go/src/github.com/cabral-ramon/coke/actions/actions_test.go\nDEBU[2019-12-14T15:41:23-05:00] File: /home/ramon/go/src/github.com/cabral-ramon/coke/actions/app.go\nDEBU[2019-12-14T15:41:23-05:00] File: /home/ramon/go/src/github.com/cabral-ramon/coke/actions/home.go\nDEBU[2019-12-14T15:41:23-05:00] File: /home/ramon/go/src/github.com/cabral-ramon/coke/actions/home_test.go\nDEBU[2019-12-14T15:41:23-05:00] File: /home/ramon/go/src/github.com/cabral-ramon/coke/actions/render.go\nDEBU[2019-12-14T15:41:23-05:00] File: /home/ramon/go/src/github.com/cabral-ramon/coke/fixtures/sample.toml\nDEBU[2019-12-14T15:41:23-05:00] File: /home/ramon/go/src/github.com/cabral-ramon/coke/grifts/init.go\nDEBU[2019-12-14T15:41:23-05:00] File: /home/ramon/go/src/github.com/cabral-ramon/coke/inflections.json\nDEBU[2019-12-14T15:41:23-05:00] File: /home/ramon/go/src/github.com/cabral-ramon/coke/main.go\nDEBU[2019-12-14T15:41:23-05:00] File: /home/ramon/go/src/github.com/cabral-ramon/coke/config/buffalo-app.toml\nDEBU[2019-12-14T15:41:23-05:00] Step: 34bd4cfa\nDEBU[2019-12-14T15:41:23-05:00] Chdir: /home/ramon/go/src/github.com/cabral-ramon/coke\nDEBU[2019-12-14T15:41:23-05:00] File: /home/ramon/go/src/github.com/cabral-ramon/coke/.dockerignore\nDEBU[2019-12-14T15:41:23-05:00] File: /home/ramon/go/src/github.com/cabral-ramon/coke/Dockerfile\nDEBU[2019-12-14T15:41:23-05:00] Step: ec834ec0\nDEBU[2019-12-14T15:41:23-05:00] Chdir: /home/ramon/go/src/github.com/cabral-ramon/coke\nDEBU[2019-12-14T15:41:23-05:00] File: /home/ramon/go/src/github.com/cabral-ramon/coke/grifts/db.go\nDEBU[2019-12-14T15:41:23-05:00] File: /home/ramon/go/src/github.com/cabral-ramon/coke/models/models.go\nDEBU[2019-12-14T15:41:23-05:00] File: /home/ramon/go/src/github.com/cabral-ramon/coke/models/models_test.go\nDEBU[2019-12-14T15:41:23-05:00] Exec: go get github.com/gobuffalo/pop\nDEBU[2019-12-14T15:41:23-05:00] Step: 85ff7f10\nDEBU[2019-12-14T15:41:23-05:00] Chdir: /home/ramon/go/src/github.com/cabral-ramon/coke\nDEBU[2019-12-14T15:41:23-05:00] File: /home/ramon/go/src/github.com/cabral-ramon/coke/database.yml\nDEBU[2019-12-14T15:41:23-05:00] Step: 5aad8342\nDEBU[2019-12-14T15:41:23-05:00] Chdir: /home/ramon/go/src/github.com/cabral-ramon/coke\nDEBU[2019-12-14T15:41:23-05:00] File: /home/ramon/go/src/github.com/cabral-ramon/coke/.buffalo.dev.yml\nDEBU[2019-12-14T15:41:23-05:00] Step: 95eb8142\nDEBU[2019-12-14T15:41:23-05:00] Chdir: /home/ramon/go/src/github.com/cabral-ramon/coke\nDEBU[2019-12-14T15:41:23-05:00] Exec: go get github.com/gobuffalo/buffalo-pop\n# github.com/gobuffalo/buffalo/plugins/plugdeps\n../../gobuffalo/buffalo/plugins/plugdeps/plugin.go:15:11: undefined: meta.BuildTags\nUsage:\n  buffalo new [name] [flags]\n\nFlags:\n      --api                  skip all front-end code and configure for an API server\n      --ci-provider string   specify the type of ci file you would like buffalo to generate [none, travis, gitlab-ci] (default \"none\")\n      --config string        config file (default is $HOME/.buffalo.yaml)\n      --db-type string       specify the type of database you want to use [cockroach, mysql, postgres] (default \"postgres\")\n      --docker string        specify the type of Docker file to generate [none, multi, standard] (default \"multi\")\n  -d, --dry-run              dry run\n  -f, --force                delete and remake if the app already exists\n  -h, --help                 help for new\n      --module string        specify the root module (package) name. [defaults to 'automatic']\n      --skip-config          skips using the config file\n      --skip-pop             skips adding pop/soda to your app\n      --skip-webpack         skips adding Webpack to your app\n      --skip-yarn            use npm instead of yarn for frontend dependencies management\n      --vcs string           specify the Version control system you would like to use [none, git, bzr] (default \"git\")\n  -v, --verbose              verbosely print out the go get commands\n\nERRO[0000] Error: exit status 2   \n</code></pre>\n\n<p>I have tried uninstalling and reinstalling buffalo as well as removing my go directory and recreating everything. I have also confirmed that my $GOPATH is set properly and it is included in my $PATH.</p>\n"}, {"tags": ["variables", "go", "types", "declaration"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1576357189, "post_id": 59339060, "comment_id": 104875856, "body": "Your question needs further elaboration."}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1576358308, "creation_date": 1576358308, "answer_id": 59339230, "question_id": 59339060, "link": "https://stackoverflow.com/questions/59339060/short-variabledeclaration-with-multiple-variables/59339230#59339230", "title": "Short variabledeclaration with multiple variables", "body": "<p>Here:</p>\n\n<pre><code>func f(num *int) {\n   num,err := function() // that returns int and error\n}\n</code></pre>\n\n<p>if <code>function</code> returns (int,error), then you are trying to assign an int to a *int, and that's the reason why you get an error. If <code>function</code> returns <code>*int</code>, everything works fine.</p>\n\n<p>If you need to redeclare num regardless, you can create a new scope:</p>\n\n<pre><code>func f(num *int) {\n   {\n      num,err:=function()\n      // Here, num is int\n      ...\n   }\n}\n\n\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 10276272, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-e1_xUt4ZDAA/AAAAAAAAAAI/AAAAAAAAAFI/9K5icV-pgD4/photo.jpg?sz=128", "display_name": "younlok", "link": "https://stackoverflow.com/users/10276272/younlok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1576397905, "creation_date": 1576356898, "last_edit_date": 1576397905, "question_id": 59339060, "link": "https://stackoverflow.com/questions/59339060/short-variabledeclaration-with-multiple-variables", "title": "Short variabledeclaration with multiple variables", "body": "<p>the problem is when you have one variable declared but the other no and you declare them with the := you will get error so what's the solution \n<strong>example</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var number *int\nfunc(num *int) {\n   num,err := function() // that returns int and error\n}\n</code></pre>\n\n<p>but here you will get error because num is already declared so what to do \ndeclare err </p>\n\n<p><strong>var err error</strong></p>\n\n<p>but what if i need to use it in another thing which i need short declaration?? </p>\n"}, {"tags": ["sql", "postgresql", "go"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1576402044, "post_id": 59338743, "comment_id": 104882509, "body": "Why would you want it to be of type <code>json</code>? I find this data type to be problematic, to say the least. If you need a flexible schema, you might want to consider <a href=\"https://www.mongodb.com/blog/post/mongodb-go-driver-tutorial\" rel=\"nofollow noreferrer\">MongoDB</a>."}], "answers": [{"comments": [{"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1576588669, "post_id": 59350351, "comment_id": 104942439, "body": "Thank you very much for your detailed answer! Sorry for the late answer. In my case, I decided to use your code with little changes. For example, I used <code>json.Marshal</code> to make the valid json from <code>[]Details</code>. Can I ask you one more question?! How to replace the last character of the string with another character? As I can see you use <code>query = strings.TrimSuffix(query, &quot;,&quot;)</code>."}, {"owner": {"reputation": 327, "user_id": 11520747, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3e1iWo-8Ukg/AAAAAAAAAAI/AAAAAAAAAMI/ja_ohm0COko/photo.jpg?sz=128", "display_name": "wijayaerick", "link": "https://stackoverflow.com/users/11520747/wijayaerick"}, "reply_to_user": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 1, "creation_date": 1576655478, "post_id": 59350351, "comment_id": 104965802, "body": "I use <code>strings.TrimSuffix</code> to remove the last <code>&quot;,&quot;</code> character that was added by <code>fmt.Sprintf(&quot;($%d, $%d, $%d),&quot;, x, x+1, x+2)</code>. If you want to change last character of string to &quot;x&quot; for example, you can do it by <code>str = str[:len(str)-1] + &quot;x&quot;</code>"}], "tags": [], "owner": {"reputation": 327, "user_id": 11520747, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3e1iWo-8Ukg/AAAAAAAAAAI/AAAAAAAAAMI/ja_ohm0COko/photo.jpg?sz=128", "display_name": "wijayaerick", "link": "https://stackoverflow.com/users/11520747/wijayaerick"}, "is_accepted": true, "score": 1, "last_activity_date": 1576468405, "creation_date": 1576468405, "answer_id": 59350351, "question_id": 59338743, "link": "https://stackoverflow.com/questions/59338743/how-to-create-sql-query-with-multiple-json-parameters-in-golang-application/59350351#59350351", "title": "How to create SQL query with multiple JSON parameters in golang application?", "body": "<p>Because I cannot comment, I assume that:</p>\n\n<ol>\n<li>You're using golang's <a href=\"https://golang.org/pkg/database/sql/\" rel=\"nofollow noreferrer\">database/sql</a> or similar package. </li>\n<li>In your database, <code>details</code> column has type <code>JSONB</code></li>\n</ol>\n\n<p>A simple approach is to loop your slice <code>layers</code> and build query string to this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\"INSERT INTO layers (id,city,details) VALUES ($1,$2,$3), ($4,$5,$6)\"\n</code></pre>\n\n<p>For <code>id</code> and <code>city</code>, you can pass the params easily, however you need to pass JSON bytes for <code>details</code>. Which means, you'll need to <strong>marshal Details struct to JSON bytes for insert/update</strong> and <strong>unmarshal 'details' result to struct when SELECT</strong></p>\n\n<p>You will need to:</p>\n\n<ol>\n<li>Define new struct that encapsulates the slice of <code>Detail</code> (we'll call it <code>Details</code>) then the <code>Details</code> should implement these interfaces. </li>\n<li>Implements <a href=\"https://golang.org/pkg/database/sql/driver/#Valuer\" rel=\"nofollow noreferrer\">driver.Valuer</a> interface to convert <code>Details</code> to JSON byte slice that can be understood by the database</li>\n<li>Implements <a href=\"https://golang.org/pkg/database/sql/#Scanner\" rel=\"nofollow noreferrer\">sql.Scanner</a> interface to unmarshal JSON byte slice from database to your struct</li>\n</ol>\n\n<p>The code should look like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Detail struct {\n    Total  int    `json:\"total\"`\n    Gender string `json:\"gender\"`\n}\n\n// this will implement driver.Valuer and sql.Scanner\ntype Details []Detail\n\n// so that the database can understand your value, useful for INSERT/UPDATE\nfunc (d Details) Value() (driver.Value, error) {\n    return json.Marshal(d)\n}\n\n// so that the database can convert db value to your struct, useful for SELECT\nfunc (d *Details) Scan(value interface{}) error {\n    b, ok := value.([]byte)\n    if !ok {\n        return errors.New(\"type assertion to []byte failed for scanning Details\")\n    }\n\n    return json.Unmarshal(b, &amp;d)\n}\n</code></pre>\n\n<p>The complete code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"database/sql\"\n    \"database/sql/driver\"\n    \"encoding/json\"\n    \"errors\"\n    \"fmt\"\n    \"log\"\n    \"strings\"\n\n    _ \"github.com/lib/pq\"\n)\n\ntype Layer struct {\n    ID      int     `json:\"id\"`\n    City    string  `json:\"city\"`\n    Details Details `json:\"details\"`\n}\n\n// this will implement driver.Valuer and sql.Scanner\ntype Details []Detail\n\n// so that the database can understand your value, useful for INSERT/UPDATE\nfunc (d Details) Value() (driver.Value, error) {\n    return json.Marshal(d)\n}\n\n// so that the database can convert db value to your struct, useful for SELECT\nfunc (d *Details) Scan(value interface{}) error {\n    b, ok := value.([]byte)\n    if !ok {\n        return errors.New(\"type assertion to []byte failed for scanning Details\")\n    }\n\n    return json.Unmarshal(b, &amp;d)\n}\n\ntype Detail struct {\n    Total  int    `json:\"total\"`\n    Gender string `json:\"gender\"`\n}\n\nfunc main() {\n    db, err := sql.Open(\"postgres\", \"postgres://user:pass@host:port/db?sslmode=disable\")\n    exitIfError(err)\n\n    query, params := prepareQuery([]Layer{\n        {\n            ID:      107509018555,\n            City:    \"London\",\n            Details: []Detail{{Total: 158, Gender: \"Male\"}, {Total: 689, Gender: \"Female\"}},\n        },\n        {\n            ID:      108509018556,\n            City:    \"New York\",\n            Details: []Detail{{Total: 756, Gender: \"Male\"}, {Total: 356, Gender: \"Female\"}},\n        },\n    })\n\n    log.Println(query) \n    // INSERT INTO layers (id, city, details) VALUES ($1, $2, $3),($4, $5, $6)\n    log.Println(params) \n    // [107509018555 London [{158 Male} {689 Female}] 108509018556 New York [{756 Male} {356 Female}]]\n\n    result, err := db.Exec(query, params...)\n    exitIfError(err)\n\n\n    rows, _ := result.RowsAffected()\n    log.Println(rows) // 2 rows inserted\n}\n\nfunc exitIfError(err error) {\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc prepareQuery(layers []Layer) (string, []interface{}) {\n    query := \"INSERT INTO layers (id, city, details) VALUES \"\n    params := []interface{}{}\n    x := 1\n\n    for _, layer := range layers {\n        query += fmt.Sprintf(\"($%d, $%d, $%d),\", x, x+1, x+2)\n        params = append(params, layer.ID, layer.City, layer.Details)\n        x += 3\n    }\n\n    query = strings.TrimSuffix(query, \",\")\n    return query, params\n}\n</code></pre>\n\n<p>Reference:</p>\n\n<p><a href=\"https://www.alexedwards.net/blog/using-postgresql-jsonb\" rel=\"nofollow noreferrer\">https://www.alexedwards.net/blog/using-postgresql-jsonb</a></p>\n\n<p><a href=\"https://golang.org/pkg/database/sql/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/database/sql/</a></p>\n"}], "owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 457, "favorite_count": 0, "accepted_answer_id": 59350351, "answer_count": 1, "score": 0, "last_activity_date": 1576468405, "creation_date": 1576354249, "question_id": 59338743, "link": "https://stackoverflow.com/questions/59338743/how-to-create-sql-query-with-multiple-json-parameters-in-golang-application", "title": "How to create SQL query with multiple JSON parameters in golang application?", "body": "<p>As you can see in my <strong>Golang</strong> application I have an array called <code>layers</code>.</p>\n\n<pre><code>type Details struct {\n    Total int `json:\"total\"`\n    Gender string `json:\"gender\"`\n}\n\ntype Layer struct {\n    ID int `json:\"id\"`\n    City string `json:\"city\"`\n    Details []Details `json:\"details\"`\n}\n\nlayers := []Layer{\n    {\n        ID: 107509018555,\n        City: \"London\",\n        Details: []Details{\n            {\n                Total: 158,\n                Gender: \"Male\",\n            },\n            {\n                Total: 689,\n                Gender: \"Female\",\n            },\n        },\n    },\n    {\n        ID: 108509018556,\n        City: \"New York\",\n        Details: []Details{\n            {\n                Total: 756,\n                Gender: \"Male\",\n            },\n            {\n                Total: 356,\n                Gender: \"Female\",\n            },\n        },\n    },\n}\n</code></pre>\n\n<p>I want to insert data of that array to the table of the <strong>PostgreSQL</strong> database. My question is how to create such SQL query in the application?</p>\n\n<p><strong>QUERY</strong>:</p>\n\n<pre><code>INSERT INTO layers (ID, CITY, DETAILS) VALUES\n(107509018555, 'London', '[{\"total\":158,\"gender\":\"Male\"},{\"total\":689,\"gender\":\"Female\"}]'::json),\n(108509018556, 'New York', '[{\"total\":756,\"gender\":\"Male\"},{\"total\":356,\"gender\":\"Female\"}]':json);\n</code></pre>\n"}, {"tags": ["go", "append", "slice"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 1, "last_activity_date": 1576358873, "creation_date": 1576358873, "answer_id": 59339298, "question_id": 59338740, "link": "https://stackoverflow.com/questions/59338740/improper-use-of-slices-causes-unintended-side-effects/59339298#59339298", "title": "Improper use of slices causes unintended side effects", "body": "<p>The problem is here:</p>\n\n<pre><code>append(newSets, append(set, n))\n</code></pre>\n\n<p>The problem is not that it is a nested append. The problem is that you're assuming <code>append(set,n)</code> will return a new slice. That is not always the case. A slice is a view on an array, and when you add new elements to the slice, if the addition did not result in reallocation of the array, the returned slice is the same slice you passed in, with <code>len</code> field incremented. So when you're going through your results array, you're modifying the elements that are already there, and at the same time, adding them again as if they are different results.</p>\n\n<p>To solve, when you get an element of the <code>result</code>, create a new slice, copy elements of the <code>result</code> to it, append the new element and then add the new slice to <code>result</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": false, "score": 1, "last_activity_date": 1576358918, "creation_date": 1576358918, "answer_id": 59339310, "question_id": 59338740, "link": "https://stackoverflow.com/questions/59338740/improper-use-of-slices-causes-unintended-side-effects/59339310#59339310", "title": "Improper use of slices causes unintended side effects", "body": "<p>The problem is simple enough: <code>append</code> takes a slice argument\u2014<code>[]T</code> for some type <em>T</em>\u2014plus of course the element(s) to append, and returns a <code>[]T</code> result.  But <code>[]T</code>, if non-nil, consists of two parts: a <em>slice header</em> that points to some backing array and carries a current length and capacity, plus the <em>backing array</em>.  When <code>append</code> does its job, it has a choice:</p>\n\n<ul>\n<li>modify the backing array in place, and return a new slice header that re-uses the existing backing array, or</li>\n<li>create a new backing array, copy the original values to the new backing array, and return a new slice header that uses the new backing array.</li>\n</ul>\n\n<p>Whenever <code>append</code> <em>copies</em> the backing array, your code works.  Whenever it <em>re-uses</em> the backing array, your code may or may not work, depending on whether some other slice header is using the same backing array.</p>\n\n<p>Suppose your backing array has length 5 for instance, and one of the existing slice headers reads \"length 1, capacity 5\" with element 0 of the backing array holding zero.  That is, the existing slice header <code>h</code> contains <code>[0]</code>.  Now you call <code>append(h, 1)</code>.  The append operation re-uses the backing array and puts <code>1</code> in the second element and returns a new slice header <code>h1</code> that contains <code>[0, 1]</code>.  Now you take <code>h</code> <em>again</em>, append <code>2</code>, and make a two-element slice <code>h2</code> holding <code>[0, 2]</code>.  But <strong>this re-uses the same backing array that <code>h1</code> re-used</strong> so now <code>h1</code> also holds <code>[0, 2]</code>.</p>\n\n<p>To solve the problem without modifying your algorithm much, you need either:</p>\n\n<ul>\n<li>a variant of <code>append</code> that always copies, or</li>\n<li>a variant of <em>append one int to a slice of ints</em> that always copies.</li>\n</ul>\n\n<p>The latter is simpler:</p>\n\n<pre><code>func setPlusInt(set []int, n int) []int {\n    return append(append([]int(nil), set...), n)\n}\n</code></pre>\n\n<p>which lets you replace one line of your existing code.</p>\n\n<p>(I made one other trivial change <a href=\"https://play.golang.org/p/YXtm-pON874\" rel=\"nofollow noreferrer\">here</a> and added enough to provide a working example in the Go Playground.)</p>\n\n<p>(An alternate solution is to set up each of your own slice headers to offer no extra capacity, so that <code>append</code> must always copy.  I have not illustrated this method.)</p>\n"}], "owner": {"reputation": 596, "user_id": 363293, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hlfV4.jpg?s=128&g=1", "display_name": "Ivaylo Novakov", "link": "https://stackoverflow.com/users/363293/ivaylo-novakov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 59339298, "answer_count": 2, "score": -2, "last_activity_date": 1576362545, "creation_date": 1576354193, "last_edit_date": 1576362545, "question_id": 59338740, "link": "https://stackoverflow.com/questions/59338740/improper-use-of-slices-causes-unintended-side-effects", "title": "Improper use of slices causes unintended side effects", "body": "<p>I have the following function that generate\u0441 all subsets of a given array. </p>\n\n<p>The idea is simple - I start with a results array that contains an empty set (slice) and for each element in the input array <code>nums</code> go over all previously generated sets, add the current element of <code>nums</code> to them and add the resulting new sets back to the results array. Nothing particularly interesting.</p>\n\n<pre><code>func subsets(nums []int) [][]int {\n  result := [][]int{{}}\n  for _, n := range nums {\n    newSets := [][]int{}\n    for _, set := range result {\n      newSets = append(newSets, append(set, n))\n    }\n    result = append(result, newSets...)\n  }\n  return result\n}\n</code></pre>\n\n<p>The problem is that using <code>append(newSets, append(set, n))</code> corrupts the <code>result</code> slice, of which <code>set</code> is a member. I modified the function a bit with some debug code (see below) and also found a workaround (the commented code) which doesn't cause the same behavior.</p>\n\n<p>I very much suspect that this is caused by something that's passed by reference instead of being copied (I am appending the elements of <code>newSets</code> to <code>result</code>). The problem is that I can't find it. :( I never change the result within a loop that iterates over it. I also work with new instances of <code>newSets</code> for each loop. So I'm not sure what's causing it. Please advise. :)</p>\n\n<pre><code>func subsets(nums []int) [][]int {\n\n  result := [][]int{{}}\n  for _, n := range nums {\n\n    newSets := [][]int{}\n    var before, after []int\n    for _, set := range result {\n\n      lastResultIdx := len(result)-1\n      if lastResultIdx &gt; 0 {\n        before = make([]int, len(result[lastResultIdx]))\n        copy(before, result[lastResultIdx])\n      }\n\n      //ns := []int{}\n      //for _,v := range set {\n      //  ns = append(ns, v)\n      //}\n      //ns = append(ns, n)\n      //newSets = append(newSets, ns)\n\n      newSets = append(newSets, append(set, n))\n\n      if lastResultIdx &gt; 0 {\n        after = result[lastResultIdx]\n        if before[len(before)-1]!=after[len(after)-1] {\n          fmt.Println(n, \"before\", before, \"after\", after)\n        }\n      }\n    }\n\n    result = append(result, newSets...)\n  }\n  return result\n}\n\nfunc main() {\n  subsets([]int{0, 1, 2, 3, 4})\n}\n</code></pre>\n"}, {"tags": ["json", "go", "struct", "unmarshalling", "kraken.com"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1576352329, "post_id": 59338416, "comment_id": 104874721, "body": "You need to implement <code>UnmarshalJSON</code> on the <code>*BitfinexOrder</code> type as a method not a function."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1576352403, "post_id": 59338416, "comment_id": 104874738, "body": "And, whenever you don&#39;t know the keys in the json beforehand use a <code>map</code>, there is just no other way apart from parsing the json yourself."}, {"owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1576352527, "post_id": 59338416, "comment_id": 104874776, "body": "@mkopriva Really? This is new for me. What change to implement the function as a method instead of implement it as a struct method? I mean: <code>func (o *BitfinexOrder) UnmarshalJSON</code> will fix?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1576352631, "post_id": 59338416, "comment_id": 104874802, "body": "When you implement it as a method it will be called automatically by <code>json.Unmarshal</code>, and with the correct part of the json."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1576353047, "post_id": 59338416, "comment_id": 104874891, "body": "<a href=\"https://play.golang.com/p/z6HWleeTvPT\" rel=\"nofollow noreferrer\">play.golang.com/p/z6HWleeTvPT</a> is this what you looking for? (I&#39;ve copied chmike&#39;s Unmarshal implementation)"}, {"owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1576353134, "post_id": 59338416, "comment_id": 104874906, "body": "This is pure magic! Please, write as a response so i can mark you as solver!"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1576353201, "post_id": 59338416, "comment_id": 104874919, "body": "You can delete this question as it is really a duplicate and i&#39;ve copied the relevant code from chmike&#39;s answer."}], "answers": [{"comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1576357066, "post_id": 59338646, "comment_id": 104875834, "body": "It might be wise to check, in <code>func (b *BitfinexOrder) UnmarshalJSON</code>, that <code>len(packedData) == 3</code>."}, {"owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1576361411, "post_id": 59338646, "comment_id": 104876758, "body": "Thank you for comment! It&#39;s a standard API from kraken.com. So, if the &quot;error&quot; is not populated, i can be sure that the data are 3."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1576369587, "post_id": 59338646, "comment_id": 104878192, "body": "An API may <i>claim</i> it always provides three items, and then actually provide 1, or 50. Always validate your input! See <a href=\"https://xkcd.com/327/\" rel=\"nofollow noreferrer\">xkcd.com/327</a>"}, {"owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1576397629, "post_id": 59338646, "comment_id": 104881764, "body": "order book have every time 3 values: <a href=\"https://www.kraken.com/en-gb/features/api#get-order-book\" rel=\"nofollow noreferrer\">kraken.com/en-gb/features/api#get-order-book</a>."}], "tags": [], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "is_accepted": true, "score": 0, "last_activity_date": 1576353366, "creation_date": 1576353366, "answer_id": 59338646, "question_id": 59338416, "link": "https://stackoverflow.com/questions/59338416/unmarshal-a-nested-json-without-a-key/59338646#59338646", "title": "Unmarshal a nested json without a key", "body": "<p>Solution found from @mkopriva and @chmike:</p>\n\n<p>Thank you guys!</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n    \"encoding/json\"\n)\n\nvar data = []byte(`{\n    \"error\": [],\n    \"result\": {\n        \"LINKUSD\": {\n            \"asks\": [\n                [\"2.049720\", \"183.556\", 1576323009],\n                [\"2.049750\", \"555.125\", 1576323009],\n                [\"2.049760\", \"393.580\", 1576323008],\n                [\"2.049980\", \"206.514\", 1576322995]\n            ],\n            \"bids\": [\n                [\"2.043800\", \"20.691\", 1576322350],\n                [\"2.039080\", \"755.396\", 1576323007],\n                [\"2.036960\", \"214.621\", 1576323006],\n                [\"2.036930\", \"700.792\", 1576322987]\n            ]\n        }\n    }\n}`)\n\ntype Response struct {\n    Error  []interface{}          `json:\"error\"`\n    Result map[string]Order `json:\"result\"`\n}\n\ntype Order struct {\n    Asks []BitfinexOrder `json:\"asks\"`\n    Bids []BitfinexOrder `json:\"bids\"`\n}\n\ntype BitfinexOrder struct {\n    Price     string\n    Volume    string\n    Timestamp time.Time\n}\n\n// UnmarshalJSON decode a BifinexOrder.\nfunc (b *BitfinexOrder) UnmarshalJSON(data []byte) error {\n    var packedData []json.Number\n    err := json.Unmarshal(data, &amp;packedData)\n    if err != nil {\n        return err\n    }\n    b.Price = packedData[0].String()\n    b.Volume = packedData[1].String()\n    t, err := packedData[2].Int64()\n    if err != nil {\n        return err\n    }\n    b.Timestamp = time.Unix(t, 0)\n    return nil\n}\n\nfunc main() {\n    res := &amp;Response{}\n    if err := json.Unmarshal(data, res); err != nil {\n        panic(err)\n    }\n\n    for key, value := range res.Result {\n        fmt.Println(key)\n        for i, ask := range value.Asks {\n            fmt.Printf(\"Asks[%d] = %#v\\n\", i, ask)\n        }\n        for i, bid := range value.Bids {\n            fmt.Printf(\"Bids[%d] = %#v\\n\", i, bid)\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1139, "favorite_count": 1, "accepted_answer_id": 59338646, "answer_count": 1, "score": 1, "last_activity_date": 1579879022, "creation_date": 1576351524, "last_edit_date": 1579879022, "question_id": 59338416, "link": "https://stackoverflow.com/questions/59338416/unmarshal-a-nested-json-without-a-key", "title": "Unmarshal a nested json without a key", "body": "<p>I am not unable to cast the following <code>json</code> in a struct in Golang, received from <code>Kraken</code> API:</p>\n\n<pre><code>{\n    \"error\": [],\n    \"result\": {\n        \"LINKUSD\": {\n            \"asks\": [\n                [\"2.049720\", \"183.556\", 1576323009],\n                [\"2.049750\", \"555.125\", 1576323009],\n                [\"2.049760\", \"393.580\", 1576323008],\n                [\"2.049980\", \"206.514\", 1576322995]\n            ],\n            \"bids\": [\n                [\"2.043800\", \"20.691\", 1576322350],\n                [\"2.039080\", \"755.396\", 1576323007],\n                [\"2.036960\", \"214.621\", 1576323006],\n                [\"2.036930\", \"700.792\", 1576322987]\n            ]\n        }\n    }\n}\n</code></pre>\n\n<p>Using <code>json-to-go</code>, he gives me the following struct:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type AutoGenerated struct {\n    Error  []interface{} `json:\"error\"`\n    Result struct {\n        LINKUSD struct {\n            Asks [][]interface{} `json:\"asks\"`\n            Bids [][]interface{} `json:\"bids\"`\n        } `json:\"LINKUSD\"`\n    } `json:\"result\"`\n}\n</code></pre>\n\n<p>Obviously, i can't hardocode the <code>LINKUSD</code> cause it will change for every currency pairs. </p>\n\n<p>I've created two structure for accomplish the task, but i'm not able to cast the result in the struct.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type BitfinexOrderBook struct {\n    Pair string          `json:\"pair\"`\n    Asks []BitfinexOrder `json:\"asks\"`\n    Bids []BitfinexOrder `json:\"bids\"`\n}\n\ntype BitfinexOrder struct {\n    Price     string\n    Volume    string\n    Timestamp time.Time\n}\n</code></pre>\n\n<p>My first attempt was to use reflection. Reading the JSON data posted above, i'm able to retrieve an interface that contains the <code>asks</code> and <code>bids</code> list.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// Just used as a divisor\nconst div string = \" ---------------------------------\"\nfunc test(data []byte) error {\n    var err error\n\n    // Creating the maps for the JSON data\n    m := map[string]interface{}{}\n\n    // Parsing/Unmarshalling the json readed from the file\n    err = json.Unmarshal(data, &amp;m)\n\n    if err != nil {\n        log.Println(\"Error unmarshalling data: \" + err.Error())\n        return err\n    }\n\n    // Extract the \"result\" only\n    a := reflect.ValueOf(m[\"result\"])\n\n    if a.Kind() == reflect.Map {\n        key := a.MapKeys()[0] // Extract the key -&gt; LINKUSD\n        log.Println(\"KEY: \", key, div)\n        strct := a.MapIndex(key) // Extract the value -&gt; asks and bids array\n        log.Println(\"MAP: \", strct, div)\n        m, _ := strct.Interface().(map[string]interface{})\n        log.Println(\"Asks: \", m[\"asks\"], div) // This will print [[value, value, value] ...] related to asks\n        log.Println(\"Bids: \", m[\"bids\"], div) // This will print [[value, value, value] ...] related to bids\n\n        // Parse the interface into a []byte\n        asks_data, err := json.Marshal(m[\"asks\"])\n        log.Println(\"OK: \", err, div)\n        log.Println(\"ASKS: \", string(asks_data), div)\n        // Tried without array to (datastructure.BitfinexOrder)\n        var asks []datastructure.BitfinexOrder\n        err = json.Unmarshal(asks_data, &amp;asks)\n        log.Println(\"ERROR: \", err, div)\n        log.Println(\"UNMARSHAL: \", asks, div)\n\n    }\n    return errors.New(\"UNABLE_PARSE_VALUE\")\n}\n</code></pre>\n\n<p>The two print below <code>m, _ := strct.Interface().(map[string]interface{})</code> will show the following similar data that i'm not able to cast due to the fact that are of <code>interface</code> type:</p>\n\n<pre><code>[[2.049720 183.556 1.576323009e+09] [2.049750 555.125 1.576323009e+09] [2.049760 393.580 1.576323008e+09] [2.049980 206.514 1.576322995e+09]]\n</code></pre>\n\n<p>But i'm not able to unmarshal the data.</p>\n\n<p>So i've tried with a different function provided by <code>@chmike</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// UnmarshalJSON decode a BifinexOrder.\nfunc UnmarshalJSON(data []byte) (datastructure.BitfinexOrder, error) {\n    var packedData []json.Number\n\n    var order datastructure.BitfinexOrder\n    err := json.Unmarshal(data, &amp;packedData)\n    if err != nil {\n        return order, err\n    }\n    order.Price = packedData[0].String()\n    order.Volume = packedData[1].String()\n    t, err := packedData[2].Int64()\n    if err != nil {\n        return order, err\n    }\n    order.Timestamp = time.Unix(t, 0)\n    return order, nil\n}\n</code></pre>\n\n<p>But i receive the following error:</p>\n\n<p><code>json: cannot unmarshal array into Go value of type json.Number</code></p>\n\n<p>Some tips?</p>\n\n<p><strong><em>NOTE</em></strong>: <em>My previous questions was closed as a duplicate of \"Unmarshal 2 different structs in a slice\". But, if you read the questions, i'm not dealing with two different structs... I'm dealing with a json that contains a key that i does not know at prior. I'm not able to marshal BitfinexOrder too</em></p>\n"}, {"tags": ["go", "visual-studio-code", "autocomplete", "intellisense"], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 10276272, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-e1_xUt4ZDAA/AAAAAAAAAAI/AAAAAAAAAFI/9K5icV-pgD4/photo.jpg?sz=128", "display_name": "younlok", "link": "https://stackoverflow.com/users/10276272/younlok"}, "edited": false, "score": 0, "creation_date": 1576352519, "post_id": 59337577, "comment_id": 104874773, "body": "i installed one but i think will have to try others"}, {"owner": {"reputation": 29, "user_id": 11821539, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ohbMe.jpg?s=128&g=1", "display_name": "BernardoPiedade", "link": "https://stackoverflow.com/users/11821539/bernardopiedade"}, "reply_to_user": {"reputation": 9, "user_id": 10276272, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-e1_xUt4ZDAA/AAAAAAAAAAI/AAAAAAAAAFI/9K5icV-pgD4/photo.jpg?sz=128", "display_name": "younlok", "link": "https://stackoverflow.com/users/10276272/younlok"}, "edited": false, "score": 0, "creation_date": 1576381949, "post_id": 59337577, "comment_id": 104879732, "body": "I did some search and apparently the one I used is no longer available :/ I tried to find a github repository with it so that you could fork but couldn&#39;t find anything"}], "tags": [], "owner": {"reputation": 29, "user_id": 11821539, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ohbMe.jpg?s=128&g=1", "display_name": "BernardoPiedade", "link": "https://stackoverflow.com/users/11821539/bernardopiedade"}, "is_accepted": false, "score": 0, "last_activity_date": 1576345132, "creation_date": 1576345132, "answer_id": 59337577, "question_id": 59337556, "link": "https://stackoverflow.com/questions/59337556/go-vs-code-no-completion-for-external-packages-intellisense/59337577#59337577", "title": "GO,VS code : no completion for external packages (intellisense)", "body": "<p>Search for a plugin which does that. I remember I had that problem with css and needed a plugin for that.</p>\n\n<p>I don't remember the plugin I used but I'll do some search and if I find it I'll let you know. But I'm 100% sure that installing a plugin for that will resolve the issue.</p>\n"}], "owner": {"reputation": 9, "user_id": 10276272, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-e1_xUt4ZDAA/AAAAAAAAAAI/AAAAAAAAAFI/9K5icV-pgD4/photo.jpg?sz=128", "display_name": "younlok", "link": "https://stackoverflow.com/users/10276272/younlok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1576397977, "creation_date": 1576344959, "last_edit_date": 1576368349, "question_id": 59337556, "link": "https://stackoverflow.com/questions/59337556/go-vs-code-no-completion-for-external-packages-intellisense", "title": "GO,VS code : no completion for external packages (intellisense)", "body": "<p>I installed VS code and go extension \nIt completes words from internal packages of the language like <code>fmt</code> but not from external packages \nfor example <code>SDL</code> \nI searched but nothing \nI use <strong>GO modules</strong>\nlast version of VS code and go\nOS : Linux (if this will help i don't know)</p>\n"}, {"tags": ["go", "sdk", "gcloud"], "answers": [{"tags": [], "owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "is_accepted": false, "score": 1, "last_activity_date": 1600033765, "last_edit_date": 1600033765, "creation_date": 1576515269, "answer_id": 59361058, "question_id": 59337064, "link": "https://stackoverflow.com/questions/59337064/gcloud-auth-account-used-by-go-sdk/59361058#59361058", "title": "Gcloud auth account used by go sdk", "body": "<p>Google's [Golang] Cloud SDKs use <a href=\"https://cloud.google.com/docs/authentication/production\" rel=\"nofollow noreferrer\">Application Default Credentials (ADCs)</a> by default to authenticate to Google Cloud Platforms services.</p>\n<p>I suspect (!) at some point, you used <a href=\"https://cloud.google.com/sdk/gcloud/reference/auth/application-default/\" rel=\"nofollow noreferrer\"><code>gcloud auth application-default</code></a> with <code>account1@gmail.com</code> and so this account is used.</p>\n<p>The best practice is to use service accounts rather than human accounts with ADCs and then reference the account using <code>GOOGLE_APPLICATION_CREDENTIALS</code> environment variable.</p>\n<p>Meantime, you may be able to switch to <code>account3@gmail.com</code> using the above command to confirm the behavior.</p>\n"}], "owner": {"reputation": 9276, "user_id": 2409793, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/QDLY9.png?s=128&g=1", "display_name": "pkaramol", "link": "https://stackoverflow.com/users/2409793/pkaramol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1600033765, "creation_date": 1576341267, "last_edit_date": 1576669506, "question_id": 59337064, "link": "https://stackoverflow.com/questions/59337064/gcloud-auth-account-used-by-go-sdk", "title": "Gcloud auth account used by go sdk", "body": "<p>My available <code>gcloud</code> auth accounts:</p>\n\n<pre><code>\u25b6 gcloud auth list                                                        \n         Credentialed Accounts\nACTIVE  ACCOUNT\n        account1@gmail.com\n        account2@gmail.com\n*       account3@gmail.com\n\nTo set the active account, run:\n    $ gcloud config set account `ACCOUNT`\n\n</code></pre>\n\n<p>When performing <code>gcloud projects list</code> I <strong>do</strong> get the list of projects corresponding to the account that above is indicated as ACTIVE (i.e. the one with the asterisk, <code>account3@gmail.com</code>)</p>\n\n<p>Nonetheless, when I use the <code>go</code> <a href=\"https://github.com/googleapis/google-cloud-go\" rel=\"nofollow noreferrer\">google cloud sdk</a> and more specifically the <a href=\"https://godoc.org/google.golang.org/api/cloudresourcemanager/v1#ProjectsListCall\" rel=\"nofollow noreferrer\"><code>cloudresourcemanager</code></a> in order to list my projects, I get the ones corresponding to <code>account1@gmail.com</code>.</p>\n\n<p>Why isn't the Go SDK using the account that <code>gcloud</code> perceives as ACTIVE and how can I instruct it to do so?</p>\n\n<p>The strange part is when I developed some tools using the Python SDK, the behaviour was straightforward and all the SDK calls were indeed using the active account without me having to do any extra configuration steps. </p>\n"}, {"tags": ["go", "struct", "unmarshalling", "go-interface", "kraken.com"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 5, "creation_date": 1576338888, "post_id": 59336520, "comment_id": 104871183, "body": "You&#39;ll need a custom <code>json.Unmarshaler</code> to convert the array to a struct."}, {"owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1576342815, "post_id": 59336520, "comment_id": 104872278, "body": "@Peter, it&#39;s quite different for my case. Thank you sir!"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1576358061, "post_id": 59336520, "comment_id": 104876085, "body": "It&#39;s not. You want to unmarshal JSON arrays with inconsistent element types. It doesn&#39;t matter if those are objects or scalar values, the same solution applies."}], "answers": [{"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1576340323, "post_id": 59336835, "comment_id": 104871615, "body": "Oh, I didn&#39;t see your answer while writing it. The problem is this might panic if the type assert fails."}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1576340515, "post_id": 59336835, "comment_id": 104871665, "body": "@leafbebop you are right. I took shortcuts."}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1576341556, "post_id": 59336835, "comment_id": 104871938, "body": "@leafbebop fixed it to avoid the type assertion."}], "tags": [], "owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "is_accepted": true, "score": 4, "last_activity_date": 1576341510, "last_edit_date": 1576341510, "creation_date": 1576339663, "answer_id": 59336835, "question_id": 59336520, "link": "https://stackoverflow.com/questions/59336520/cast-a-json-in-a-properly-struct-instead-of-use-an-interface/59336835#59336835", "title": "Cast a json in a properly struct instead of use an interface", "body": "<p>As suggested by @Flimzy, you need a custom <code>Unmarshaler</code>. Here it is. </p>\n\n<p>Note that the <code>BitfinexOrderBook</code> definition is slightly different from yours. There was an error in it.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// BitfinexOrderBook is a book of orders.\ntype BitfinexOrderBook struct {\n    Asks []BitfinexOrder `json:\"asks\"`\n    Bids []BitfinexOrder `json:\"bids\"`\n}\n\n// BitfinexOrder is a bitfinex order.\ntype BitfinexOrder struct {\n    Price     string\n    Volume    string\n    Timestamp time.Time\n}\n\n// UnmarshalJSON decode a BifinexOrder.\nfunc (b *BitfinexOrder) UnmarshalJSON(data []byte) error {\n    var packedData []json.Number\n    err := json.Unmarshal(data, &amp;packedData)\n    if err != nil {\n        return err\n    }\n    b.Price = packedData[0].String()\n    b.Volume = packedData[1].String()\n    t, err := packedData[2].Int64()\n    if err != nil {\n        return err\n    }\n    b.Timestamp = time.Unix(t, 0)\n    return nil\n}\n</code></pre>\n\n<p>Note also that this custom unmarshaler function allows you to convert the price or volume to a float, which is probably what you want.</p>\n"}, {"comments": [{"owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "edited": false, "score": 0, "creation_date": 1576397765, "post_id": 59336913, "comment_id": 104881793, "body": "Thank you! Unfortunately i did not know the LINKUSD at prior. However I&#39;ve solved!"}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 1, "last_activity_date": 1576340251, "creation_date": 1576340251, "answer_id": 59336913, "question_id": 59336520, "link": "https://stackoverflow.com/questions/59336520/cast-a-json-in-a-properly-struct-instead-of-use-an-interface/59336913#59336913", "title": "Cast a json in a properly struct instead of use an interface", "body": "<p>While you can hack your way by using reflex, or maybe even write your own parser, the most efficient way is to implement a <code>json.Unmarshaler</code>.</p>\n\n<p>There are a few problem remaining, though.</p>\n\n<ol>\n<li><p>You are transforming a <code>json array</code> to the <code>struct</code>, not just <code>interface{}</code> elements in it, so it should be: <code>Asks []BitfinexOrder</code> and <code>Bids []BitfinexOrder</code>.</p></li>\n<li><p>You need to wrap the struct <code>BitfinexOrderBook</code> to get it work with its data. It is trivial and much simpler than using reflex.</p></li>\n<li><p>By default, <code>json.Unmarshal</code> unmarshals a <code>json number</code> into a float64, which is not a good thing when parsing <code>timestamp</code>. You can use <code>json.NewDecoder</code> to get a decoder and then use <code>Decoder.UseNumber</code> to force use a string.</p></li>\n</ol>\n\n<p>For example,</p>\n\n<pre><code>func (bo *BitfinexOrder) UnmarshalJSON(data []byte) error {\n    dec := json.NewDecoder(bytes.NewReader(data))\n    dec.UseNumber()\n\n    var x []interface{}\n    err := dec.Decode(&amp;x)\n    if err != nil {\n        return errParse(err.Error())\n    }\n\n    if len(x) != 3 {\n        return errParse(\"length is not 3\")\n    }\n\n    price, ok := x[0].(string)\n    if !ok {\n        return errParse(\"price is not string\")\n    }\n\n    volume, ok := x[1].(string)\n    if !ok {\n        return errParse(\"volume is not string\")\n    }\n\n    number, ok := x[2].(json.Number)\n    if !ok {\n        return errParse(\"timestamp is not number\")\n    }\n    tint64, err := strconv.ParseInt(string(number), 10, 64)\n    if err != nil {\n        return errParse(fmt.Sprintf(\"parsing timestamp: %s\", err))\n    }\n\n    *bo = BitfinexOrder{\n        Price:     price,\n        Volume:    volume,\n        Timestamp: time.Unix(tint64, 0),\n    }\n    return nil\n}\n</code></pre>\n\n<p>and main func (wrapping the struct):</p>\n\n<pre><code>func main() {\n    x := struct {\n        Result struct{ LINKUSD BitfinexOrderBook }\n    }{}\n    err := json.Unmarshal(data, &amp;x)\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    bob := x.Result.LINKUSD\n    fmt.Println(bob)\n}\n</code></pre>\n\n<p>Playground link: <a href=\"https://play.golang.org/p/pC124F-3M_S\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pC124F-3M_S</a> .</p>\n\n<p>Note: the playground link use a helper function to create errors. Some might argue it is best to name the helper function <code>NewErrInvalidBitfinexOrder</code> or rename the error. That is not the scope of this question and I think for the sake of typing, I will keep the short name for now.</p>\n"}], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "closed_date": 1576347059, "accepted_answer_id": 59336835, "answer_count": 2, "score": 0, "last_activity_date": 1578562106, "creation_date": 1576337526, "last_edit_date": 1578562106, "question_id": 59336520, "link": "https://stackoverflow.com/questions/59336520/cast-a-json-in-a-properly-struct-instead-of-use-an-interface", "closed_reason": "Duplicate", "title": "Cast a json in a properly struct instead of use an interface", "body": "<p>i'm struggling to create a data structure for unmarshal the following json:</p>\n\n<pre><code>{\n    \"asks\": [\n        [\"2.049720\", \"183.556\", 1576323009],\n        [\"2.049750\", \"555.125\", 1576323009],\n        [\"2.049760\", \"393.580\", 1576323008],\n        [\"2.049980\", \"206.514\", 1576322995]\n    ],\n    \"bids\": [\n        [\"2.043800\", \"20.691\", 1576322350],\n        [\"2.039080\", \"755.396\", 1576323007],\n        [\"2.036960\", \"214.621\", 1576323006],\n        [\"2.036930\", \"700.792\", 1576322987]\n    ]\n}\n</code></pre>\n\n<p>If I use the following struct with interfaces, there is no problem:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type OrderBook struct {\n    Asks [][]interface{} `json:\"asks\"`\n    Bids [][]interface{} `json:\"bids\"`\n}\n</code></pre>\n\n<p>But i need a more strict typing, so i've tried with:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type BitfinexOrderBook struct {\n    Pair string            `json:\"pair\"`\n    Asks [][]BitfinexOrder `json:\"asks\"`\n    Bids [][]BitfinexOrder `json:\"bids\"`\n}\n\ntype BitfinexOrder struct {\n    Price     string\n    Volume    string\n    Timestamp time.Time\n}\n</code></pre>\n\n<p>But unfortunately i had not success.</p>\n\n<p>This is the code that I have used for parse the Kraken API for retrieve the order book:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// loadKrakenOrderBook is delegated to load the data related to pairs info\nfunc loadKrakenOrderBook(data []byte) (datastructure.BitfinexOrderBook, error) {\n    var err error\n\n    // Creating the maps for the JSON data\n    m := map[string]interface{}{}\n    var orderbook datastructure.BitfinexOrderBook\n\n    // Parsing/Unmarshalling JSON\n    err = json.Unmarshal(data, &amp;m)\n\n    if err != nil {\n        zap.S().Debugw(\"Error unmarshalling data: \" + err.Error())\n        return orderbook, err\n    }\n\n    a := reflect.ValueOf(m[\"result\"])\n\n    if a.Kind() == reflect.Map {\n        key := a.MapKeys()[0]\n        log.Println(\"KEY: \", key)\n        strct := a.MapIndex(key)\n        log.Println(\"MAP: \", strct)\n        m, _ := strct.Interface().(map[string]interface{})\n        log.Println(\"M: \", m)\n        data, err := json.Marshal(m)\n        if err != nil {\n            zap.S().Warnw(\"Panic on key: \", key.String(), \" ERR: \"+err.Error())\n            return orderbook, err\n        }\n        log.Println(\"DATA: \", string(data))\n        err = json.Unmarshal(data, &amp;orderbook)\n        if err != nil {\n            zap.S().Warnw(\"Panic on key: \", key.String(), \" during unmarshal. ERR: \"+err.Error())\n            return orderbook, err\n        }\n        return orderbook, nil\n\n    }\n    return orderbook, errors.New(\"UNABLE_PARSE_VALUE\")\n}\n</code></pre>\n\n<p>The data that i use for test are the following:</p>\n\n<pre><code>{\n    \"error\": [],\n    \"result\": {\n        \"LINKUSD\": {\n            \"asks\": [\n                [\"2.049720\", \"183.556\", 1576323009],\n                [\"2.049750\", \"555.125\", 1576323009],\n                [\"2.049760\", \"393.580\", 1576323008],\n                [\"2.049980\", \"206.514\", 1576322995]\n            ],\n            \"bids\": [\n                [\"2.043800\", \"20.691\", 1576322350],\n                [\"2.039080\", \"755.396\", 1576323007],\n                [\"2.036960\", \"214.621\", 1576323006],\n                [\"2.036930\", \"700.792\", 1576322987]\n            ]\n        }\n    }\n}\n</code></pre>\n\n<h1>EDIT</h1>\n\n<p><strong><em>NOTE</em></strong>: the data that i receive in input is the latest json that i've post, not the array of <code>bids</code> and <code>asks</code>.</p>\n\n<p>I've tried to integrate the solution proposed by @chmike. Unfortunately there is a few preprocessing to be made, cause the data is the latest json that i've post.</p>\n\n<p>So i've changed to code as following in order to extract the json data related to <code>asks</code> and <code>bids</code>.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func order(data []byte) (datastructure.BitfinexOrderBook, error) {\n    var err error\n\n    // Creating the maps for the JSON data\n    m := map[string]interface{}{}\n    var orderbook datastructure.BitfinexOrderBook\n    // var asks datastructure.BitfinexOrder\n    // var bids datastructure.BitfinexOrder\n    // Parsing/Unmarshalling JSON\n    err = json.Unmarshal(data, &amp;m)\n\n    if err != nil {\n        zap.S().Warn(\"Error unmarshalling data: \" + err.Error())\n        return orderbook, err\n    }\n\n    // Extract the \"result\" json\n    a := reflect.ValueOf(m[\"result\"])\n\n    if a.Kind() == reflect.Map {\n        key := a.MapKeys()[0]\n        log.Println(\"KEY: \", key)\n        log.Println()\n        strct := a.MapIndex(key)\n        log.Println(\"MAP: \", strct)\n        m, _ := strct.Interface().(map[string]interface{})\n        log.Println(\"M: \", m)\n        log.Println(\"Asks: \", m[\"asks\"])\n        log.Println(\"Bids: \", m[\"bids\"])\n\n        // Here i retrieve the asks array\n        asks_data, err := json.Marshal(m[\"asks\"])\n        log.Println(\"OK: \", err)\n        log.Println(\"ASKS: \", string(asks_data))\n        var asks datastructure.BitfinexOrder\n        // here i try to unmarshal the data into the struct\n        asks, err = UnmarshalJSON(asks_data)\n        log.Println(err)\n        log.Println(asks)\n\n    }\n    return orderbook, errors.New(\"UNABLE_PARSE_VALUE\")\n}\n</code></pre>\n\n<p>Unfortunately, i receive the following error:</p>\n\n<p><code>json: cannot unmarshal array into Go value of type json.Number</code></p>\n"}, {"tags": ["loops", "go", "struct"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1576334293, "post_id": 59336045, "comment_id": 104870101, "body": "You simply cannot. Go\u2018s syntax doesn\u2018t allow this."}, {"owner": {"reputation": 504, "user_id": 5282337, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/J5BT7.jpg?s=128&g=1", "display_name": "Fred", "link": "https://stackoverflow.com/users/5282337/fred"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1576334516, "post_id": 59336045, "comment_id": 104870163, "body": "I&#39;ve already looked at the Go reference for SimpleStmt but it is unclear. Can you refer or explain why you say &#39;simply cannot&#39;? Can you refer or give a list of examples? I ask this question because I want clarity on what is allowable and not allowable."}], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1576334468, "post_id": 59336099, "comment_id": 104870147, "body": "i could not find this, the for statement spec are not mentioning it (or i missed) <a href=\"https://golang.org/ref/spec#For_statements\" rel=\"nofollow noreferrer\">golang.org/ref/spec#For_statements</a>"}, {"owner": {"reputation": 504, "user_id": 5282337, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/J5BT7.jpg?s=128&g=1", "display_name": "Fred", "link": "https://stackoverflow.com/users/5282337/fred"}, "edited": false, "score": 0, "creation_date": 1576334713, "post_id": 59336099, "comment_id": 104870209, "body": "Cool! All I do is add parentheses. I knew there was a simple solution. Thank you."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 7, "last_activity_date": 1576335279, "last_edit_date": 1576335279, "creation_date": 1576334373, "answer_id": 59336099, "question_id": 59336045, "link": "https://stackoverflow.com/questions/59336045/how-to-declare-variables-based-on-a-struct-in-a-for-loop/59336099#59336099", "title": "How to declare variables based on a struct in a for-loop", "body": "<p>The <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literal section of the specification</a> says:</p>\n\n<blockquote>\n  <p>A parsing ambiguity arises when a composite literal using the TypeName form of the LiteralType appears as an operand between the keyword and the opening brace of the block of an \"if\", \"for\", or \"switch\" statement, and the composite literal is not enclosed in parentheses, square brackets, or curly braces. In this rare case, the opening brace of the literal is erroneously parsed as the one introducing the block of statements. To resolve the ambiguity, the composite literal must appear within parentheses.</p>\n</blockquote>\n\n<p>Fix the code by adding parentheses around the composite literal:</p>\n\n<pre><code>for st, p, i :=  make(stack,0), (brackets{ch: \"a\"}), 0; i &lt; 3; i++ {\n    p = brackets{ch: \"a\", pos: 1}\n    st = append(st, p) \n    fmt.Println(p)\n    fmt.Println(st)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/61wOJfDHpeh\" rel=\"nofollow noreferrer\">Run it on the playground</a>.</p>\n"}], "owner": {"reputation": 504, "user_id": 5282337, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/J5BT7.jpg?s=128&g=1", "display_name": "Fred", "link": "https://stackoverflow.com/users/5282337/fred"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "closed_date": 1576347610, "accepted_answer_id": 59336099, "answer_count": 1, "score": 1, "last_activity_date": 1576338923, "creation_date": 1576333976, "last_edit_date": 1576338923, "question_id": 59336045, "link": "https://stackoverflow.com/questions/59336045/how-to-declare-variables-based-on-a-struct-in-a-for-loop", "closed_reason": "Duplicate", "title": "How to declare variables based on a struct in a for-loop", "body": "<p>Here is a working program that declares variables prior to a for-loop.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\ntype brackets struct {\n    ch   string\n    pos  int\n}\n\ntype stack []brackets\n\nfunc main() {\n    p := brackets{ch: \"a\"}\n    st := make(stack,0)\n    for i :=  0; i &lt; 3; i++ {\n        p = brackets{ch: \"a\", pos: 1}\n        st = append(st, p) \n        fmt.Println(p)\n        fmt.Println(st)\n    }\n}\n</code></pre>\n\n<p>I want to declare the same variables as part of the for-loop. How? Here is a faulty attempt. </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype brackets struct {\n    ch   string\n    pos  int\n}\n\ntype stack []brackets\n\nfunc main() {\n//    p := brackets{ch: \"a\"}\n//    st := make(stack,0)\n    for st, p, i :=  make(stack,0), brackets{ch: \"a\"}, 0; i &lt; 3; i++ {\n        p = brackets{ch: \"a\", pos: 1}\n        st = append(st, p) \n        fmt.Println(p)\n        fmt.Println(st)\n    }\n}\n</code></pre>\n\n<p>I get the following error:\nsyntax error: st, p, i := make(stack, 0), brackets used as value</p>\n\n<p>I am puzzled, as it is very easy to declare standard types such as ints and strings. Why not my struct? </p>\n"}, {"tags": ["go", "apache-kafka"], "answers": [{"comments": [{"owner": {"reputation": 128, "user_id": 3040351, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42a955087f2c572813046770eb0a2abd?s=128&d=identicon&r=PG&f=1", "display_name": "idler1515", "link": "https://stackoverflow.com/users/3040351/idler1515"}, "edited": false, "score": 0, "creation_date": 1576479387, "post_id": 59334377, "comment_id": 104898875, "body": "Hi @cricket_007 thx for the info!  however, it seems that retention refers to logs instead of messages. The message itself wont be clean after xxx ms?"}, {"owner": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "reply_to_user": {"reputation": 128, "user_id": 3040351, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42a955087f2c572813046770eb0a2abd?s=128&d=identicon&r=PG&f=1", "display_name": "idler1515", "link": "https://stackoverflow.com/users/3040351/idler1515"}, "edited": false, "score": 0, "creation_date": 1576479462, "post_id": 59334377, "comment_id": 104898911, "body": "Messages are stored in logs. All messages older than the log retention time from which they are written will be cleaned from any closed log segments. In other words, expiration is not granular to the record level."}], "tags": [], "owner": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "is_accepted": false, "score": 2, "last_activity_date": 1576325748, "last_edit_date": 1576325748, "creation_date": 1576320364, "answer_id": 59334377, "question_id": 59334146, "link": "https://stackoverflow.com/questions/59334146/is-there-a-better-way-to-edit-kafka-topics-with-its-message-expiration-interval/59334377#59334377", "title": "Is there a better way to edit kafka topics with its message expiration interval?", "body": "<p>A <a href=\"https://godoc.org/github.com/Shopify/sarama#ClusterAdmin\" rel=\"nofollow noreferrer\"><code>ClusterAdmin</code></a> client can create topics that have <a href=\"https://godoc.org/github.com/Shopify/sarama#TopicDetail\" rel=\"nofollow noreferrer\"><code>TopicDetail</code></a>s containing a map of config entries, of which you can set the retention period</p>\n\n<p>You can later edit it with <a href=\"https://github.com/Shopify/sarama/blob/master/alter_configs_request_test.go#L79\" rel=\"nofollow noreferrer\"><code>AlterConfigsRequest</code></a></p>\n"}], "owner": {"reputation": 128, "user_id": 3040351, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42a955087f2c572813046770eb0a2abd?s=128&d=identicon&r=PG&f=1", "display_name": "idler1515", "link": "https://stackoverflow.com/users/3040351/idler1515"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1576325748, "creation_date": 1576318318, "question_id": 59334146, "link": "https://stackoverflow.com/questions/59334146/is-there-a-better-way-to-edit-kafka-topics-with-its-message-expiration-interval", "title": "Is there a better way to edit kafka topics with its message expiration interval?", "body": "<p>with the existing golang library saram, is there a way to create a topic with a specific expiration time (for messages)?</p>\n\n<p>And later that we can edit it, without deleting and recreating the topic..</p>\n"}, {"tags": ["go", "flutter-web"], "answers": [{"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": true, "score": 2, "last_activity_date": 1576324175, "creation_date": 1576324175, "answer_id": 59334845, "question_id": 59334011, "link": "https://stackoverflow.com/questions/59334011/flutter-web-with-golang-server/59334845#59334845", "title": "Flutter web with Golang Server", "body": "<p>as the friendly doc mentions it, i believe you got to build your app.</p>\n\n<p><a href=\"https://flutter.dev/docs/get-started/web#build\" rel=\"nofollow noreferrer\">https://flutter.dev/docs/get-started/web#build</a></p>\n\n<p>Run the following command to generate a release build: </p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>flutter build web\n</code></pre>\n\n<p>This populates a build/web directory with built files, including an assets directory, which need to be served together.</p>\n\n<blockquote>\n  <p>how golang code should look like?</p>\n</blockquote>\n\n<p>like any other regular HTTP golang server.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>http.Handle(\"/build/web/\", http.StripPrefix(\"/build/web/\", http.FileServer(http.Dir(\"build/web\"))))\n\nhttp.ListenAndServe(\":8080\", nil)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 430, "user_id": 1573889, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df58ff513ead62a997e1fed052f7a39c?s=128&d=identicon&r=PG&f=1", "display_name": "kokemomuke", "link": "https://stackoverflow.com/users/1573889/kokemomuke"}, "is_accepted": false, "score": 2, "last_activity_date": 1585810192, "creation_date": 1585810192, "answer_id": 60985713, "question_id": 59334011, "link": "https://stackoverflow.com/questions/59334011/flutter-web-with-golang-server/60985713#60985713", "title": "Flutter web with Golang Server", "body": "<pre><code>package main\n\nimport (\n    \"flag\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    port := flag.String(\"p\", \"8181\", \"port to serve on\")\n    directory := flag.String(\"d\", \"web\", \"the directory of static file to host\")\n    flag.Parse()\n    http.Handle(\"/\", http.FileServer(http.Dir(*directory)))\n    log.Printf(\"Serving %s on HTTP port: %s\\n\", *directory, *port)\n    log.Fatal(http.ListenAndServe(\":\"+*port, nil))\n}\n</code></pre>\n\n<p>Just copy web folder to your's go app.</p>\n"}], "owner": {"reputation": 41, "user_id": 12504966, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PnLrcPdYX0w/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfJcKLZEV2tkpYtm0FsswCABh3tzQ/photo.jpg?sz=128", "display_name": "gaurav", "link": "https://stackoverflow.com/users/12504966/gaurav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 913, "favorite_count": 2, "accepted_answer_id": 59334845, "answer_count": 2, "score": 3, "last_activity_date": 1585810192, "creation_date": 1576317151, "question_id": 59334011, "link": "https://stackoverflow.com/questions/59334011/flutter-web-with-golang-server", "title": "Flutter web with Golang Server", "body": "<p>Is it possible to run flutter web build using golang server? Golang has facility to serve html file and flutter web gives output as index.html and js files.\nif it is possible then how golang code should look like?</p>\n"}, {"tags": ["performance", "http", "go"], "comments": [{"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 2, "creation_date": 1576315222, "post_id": 59333721, "comment_id": 104865940, "body": "The way you compute the bandwidth is not optimal. A ticker is not a reliable measure of time. You should let the counter value increment and divide its value by the elapsed time to get the average ticks per seconds.   Another problem is that you are missing a <code>p.Body.Close()</code> in your client. Not sure if it may affect performances, but it certainly affects memory management."}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 1, "creation_date": 1576315554, "post_id": 59333721, "comment_id": 104865995, "body": "Starting 10000 go routines is not a good. Idea. Does your computer have 10000 cores ? They will execute in sequence and slow down their execution. You should start a small number of go routines and grow the number until you don&#39;t see a change in performance."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 3, "creation_date": 1576315711, "post_id": 59333721, "comment_id": 104866029, "body": "Try using an existing benchmark tool like <a href=\"https://github.com/wg/wrk\" rel=\"nofollow noreferrer\">wrk</a> so you only have to worry about improving the server."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1576316347, "post_id": 59333721, "comment_id": 104866125, "body": "And for gods sake, use a proper setup. &quot;Measuring&quot; the performance of a server implementation with both the server and the client running on a development machine (which does all sorts of stuff in parallel and might well run into limits such as number of open files, etc) is like measuring your body temperature by putting your <i>own</i> hand on your forehead. Put the server onto the target platform, measure the number of requests for <i>your use case</i> it can reliably fulfill. This number minus a bit is your scaling threshold for horizontal scaling. Problem solved."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1576317912, "post_id": 59333721, "comment_id": 104866397, "body": "All of above and <code>fmt.Println</code> may not happen immediately after receiving ticks."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1576318931, "post_id": 59333721, "comment_id": 104866582, "body": "Thinking of it, the no files is WAY to low: You need 2 fds per connection, to start with. Access to the port and whatnot. Remember, <b><i>everything</i></b> is a file."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576325535, "post_id": 59333721, "comment_id": 104868078, "body": "have a look to <a href=\"https://stackoverflow.com/questions/33238518/what-could-happen-if-i-dont-close-response-body-in-golang\" title=\"what could happen if i dont close response body in golang\">stackoverflow.com/questions/33238518/&hellip;</a>"}, {"owner": {"reputation": 5619, "user_id": 1723695, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/dx9jj.jpg?s=128&g=1", "display_name": "Kirill", "link": "https://stackoverflow.com/users/1723695/kirill"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1576329962, "post_id": 59333721, "comment_id": 104869052, "body": "@Ry- thanks, I replaced custom go client with <code>wrk</code>, and now it shows about <code>380000</code> requests per second"}], "answers": [{"tags": [], "owner": {"reputation": 5619, "user_id": 1723695, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/dx9jj.jpg?s=128&g=1", "display_name": "Kirill", "link": "https://stackoverflow.com/users/1723695/kirill"}, "is_accepted": false, "score": 0, "last_activity_date": 1601213973, "creation_date": 1601213973, "answer_id": 64089058, "question_id": 59333721, "link": "https://stackoverflow.com/questions/59333721/cant-overcome-4000-rps-treshold-on-localhost-http-golang-server/64089058#64089058", "title": "Can&#39;t overcome 4000 RPS treshold on localhost HTTP Golang server", "body": "<p>The problem was in testing method:</p>\n<ol>\n<li>It's not correct to run client and server on the same machine, the target server should be located at dedicated host, the network between target and client should be fast enough</li>\n<li>Custom scripts for network testing is not an option: for simple cases <a href=\"https://github.com/wg/wrk\" rel=\"nofollow noreferrer\">wrk</a> can be used, for more complex scenarios <a href=\"https://jmeter.apache.org/\" rel=\"nofollow noreferrer\">Jmetr</a> or other frameworks</li>\n</ol>\n<p>When I tested this server on dedicated host using <code>wrk</code> it shows <code>285900.73</code> RPS.</p>\n"}], "owner": {"reputation": 5619, "user_id": 1723695, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/dx9jj.jpg?s=128&g=1", "display_name": "Kirill", "link": "https://stackoverflow.com/users/1723695/kirill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 246, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1601213973, "creation_date": 1576314288, "question_id": 59333721, "link": "https://stackoverflow.com/questions/59333721/cant-overcome-4000-rps-treshold-on-localhost-http-golang-server", "title": "Can&#39;t overcome 4000 RPS treshold on localhost HTTP Golang server", "body": "<p>I tried to measure the bandwidth of Go default HTTP server implementation on my local machine. The server is just accepting any HTTP request, increments the counter using <code>sync.atomic</code> and send <code>200 OK</code> response. Also, the server collects amount of requests every second, prints it and resets counter to zero:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type hand struct {\n    cnt int32\n}\n\nfunc (h *hand) ServeHTTP(rsp http.ResponseWriter, req *http.Request) {\n    atomic.AddInt32(&amp;h.cnt, 1)\n    rsp.WriteHeader(200)\n    if req.Body != nil {\n        req.Body.Close()\n    }\n}\n\nfunc main() {\n    h := new(hand)\n    s := &amp;http.Server{\n        Addr:    \":8080\",\n        Handler: h,\n    }\n    ticker := time.NewTicker(1 * time.Second)\n    go func() {\n        for tick := range ticker.C {\n            val := atomic.SwapInt32(&amp;h.cnt, 0)\n            fmt.Printf(\"(%v) %d RPS\\n\", tick, val)\n        }\n    }()\n    log.Fatal(s.ListenAndServe())\n}\n</code></pre>\n\n<p>The target client is trying to send 100000 <code>GET</code> requests simultaneously:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>const total = 100000\n\nfunc main() {\n    var r int32\n    var rsp int32\n    r = total\n    rsp = r\n    for r &gt; 0 {\n        go func() {\n            p, err := http.Get(\"http://localhost:8080\")\n            atomic.AddInt32(&amp;rsp, -1)\n            if err != nil {\n                fmt.Printf(\"error: %s\\n\", err)\n                return\n            }\n            if p.StatusCode != 200 {\n                fmt.Printf(\"status %d\\n\", p.StatusCode)\n            }\n        }()\n        r--\n\n    }\n    for {\n        x := atomic.LoadInt32(&amp;rsp)\n        fmt.Printf(\"sent : %d\\n\", total-x)\n        if x == 0 {\n            return\n        }\n        time.Sleep(1 * time.Second)\n    }\n}\n</code></pre>\n\n<p>I'm using Linux machine with <code>5.3.2-gentoo</code> kernel. I changed <code>ulimits</code> (both <code>soft</code> and <code>hard</code>) of <code>nofile</code> to <code>100000</code>. When I run this tests, all other user applications were stopped.</p>\n\n<p>I'm not expecting to get accurate results, but just need to know the level of this threshold, something like <code>X000</code> or <code>X0000</code> or <code>X00000</code>.</p>\n\n<p>But the server can't process more than <code>4000</code> requests per second, it's looking too low:</p>\n\n<pre><code># removed timestamps\n0 RPS\n0 RPS\n0 RPS\n3953 RPS\n3302 RPS\n387 RPS\n37 RPS\n1712 RPS\n</code></pre>\n\n<p>How can I raise the bandwidth of HTTP server? Or maybe there is an issue with my testing method or local configuration? </p>\n"}, {"tags": ["arrays", "go", "error-handling"], "comments": [{"owner": {"reputation": 3039, "user_id": 2839624, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/afdae1f74dbefbbdb63d6db4d3edc782?s=128&d=identicon&r=PG&f=1", "display_name": "pratsJ", "link": "https://stackoverflow.com/users/2839624/pratsj"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1576291447, "post_id": 59331825, "comment_id": 104862753, "body": "edited. Does that mean I should return an <code>error</code> value even if there is error in processing one of the elements. Since in golang, <code>error</code> is more flexible compared to let&#39;s say exceptions, I felt there is more freedom in using it the way is most beneficial depending on use case."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1576291761, "post_id": 59331825, "comment_id": 104862793, "body": "See <a href=\"https://godoc.org/cloud.google.com/go/datastore#MultiError\" rel=\"nofollow noreferrer\">1</a> and <a href=\"https://godoc.org/github.com/hashicorp/go-multierror\" rel=\"nofollow noreferrer\">2</a> for examples of how to handle errors on batch operations."}, {"owner": {"reputation": 3039, "user_id": 2839624, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/afdae1f74dbefbbdb63d6db4d3edc782?s=128&d=identicon&r=PG&f=1", "display_name": "pratsJ", "link": "https://stackoverflow.com/users/2839624/pratsj"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1576292037, "post_id": 59331825, "comment_id": 104862823, "body": "MultiError would be even more trickier since then you have two different outputs, slice of objects and MultiError which is essentially slice of errors and you need to correlate between two (pythonic zip?). Any concurrent processing of inputs in this case becomes very difficult like @torek mentioned? Wouldn&#39;t including an <code>error</code> inside slice element struct be a better choice?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1576292516, "post_id": 59331825, "comment_id": 104862879, "body": "datastore.MultiError values have a one-to-one correspondence with the input elements.  Correlation is easy (use the same index for inputs and errors).  Concurrency does not add any complication (just pass the index around),"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1576332163, "post_id": 59331825, "comment_id": 104869587, "body": "There is no best-practice for a question like this. As you said &quot;The best way obviously depends on the particular scenario&quot;, making this question opinion-based. If you focus on a specific scenario, then an unopinionated answer can likely be provided."}, {"owner": {"reputation": 3039, "user_id": 2839624, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/afdae1f74dbefbbdb63d6db4d3edc782?s=128&d=identicon&r=PG&f=1", "display_name": "pratsJ", "link": "https://stackoverflow.com/users/2839624/pratsj"}, "edited": false, "score": 0, "creation_date": 1576365244, "post_id": 59331825, "comment_id": 104877496, "body": "Aren&#39;t best practices mass opinions?"}], "answers": [{"comments": [{"owner": {"reputation": 3039, "user_id": 2839624, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/afdae1f74dbefbbdb63d6db4d3edc782?s=128&d=identicon&r=PG&f=1", "display_name": "pratsJ", "link": "https://stackoverflow.com/users/2839624/pratsj"}, "edited": false, "score": 0, "creation_date": 1576290962, "post_id": 59331859, "comment_id": 104862703, "body": "edited. If the lengths of input and output slices are same, how would the answer differ if it&#39;s processed sequentially or concurrently?"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 3039, "user_id": 2839624, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/afdae1f74dbefbbdb63d6db4d3edc782?s=128&d=identicon&r=PG&f=1", "display_name": "pratsJ", "link": "https://stackoverflow.com/users/2839624/pratsj"}, "edited": false, "score": 0, "creation_date": 1576291044, "post_id": 59331859, "comment_id": 104862713, "body": "Well: consider if you&#39;re processing sequentially starting at index 0. You stop at the <i>first error</i> and return a slice of, say, length 10, when the input had 20 elements. You now know, in the caller, that the error occurred after processing 10 successfully, so input[0] through input[9] are good, and the error applies to input[10]."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 3039, "user_id": 2839624, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/afdae1f74dbefbbdb63d6db4d3edc782?s=128&d=identicon&r=PG&f=1", "display_name": "pratsJ", "link": "https://stackoverflow.com/users/2839624/pratsj"}, "edited": false, "score": 0, "creation_date": 1576291139, "post_id": 59331859, "comment_id": 104862717, "body": "If your function has divided up the work, though, perhaps inputs 0 through 4 are correct, 5 is bad, and 10 through 15 are correct.  The output can have ten &quot;good&quot; values (spread across 15 total &quot;returned&quot; values) and an error. There&#39;s no clear way to know that the error applies to input[5]."}, {"owner": {"reputation": 3039, "user_id": 2839624, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/afdae1f74dbefbbdb63d6db4d3edc782?s=128&d=identicon&r=PG&f=1", "display_name": "pratsJ", "link": "https://stackoverflow.com/users/2839624/pratsj"}, "edited": false, "score": 0, "creation_date": 1576291241, "post_id": 59331859, "comment_id": 104862731, "body": "Yeah right. In the cases I need to process them concurrently, I add an Index fields in the struct as well similar to Error field I proposed. However, the struct becomes too bulky with all these extra fields :("}], "tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": false, "score": 0, "last_activity_date": 1576295848, "last_edit_date": 1576295848, "creation_date": 1576290757, "answer_id": 59331859, "question_id": 59331825, "link": "https://stackoverflow.com/questions/59331825/golang-best-practices-empty-array-response-or-error/59331859#59331859", "title": "Golang best practices: empty array response or error?", "body": "<blockquote>\n  <p>... a function that accepts [slice of interface representing an] array of objects and returns another [slice of interface representing an] array of objects along with error ...</p>\n</blockquote>\n\n<p>You have not told us enough to go on.</p>\n\n<ul>\n<li>Does the returned slice actually have anything to do with the parameter slice?</li>\n<li>If so, what relationship do they have?  For instance, perhaps the returned slice should be half the size of the input slice, and an error occurs if and only if the number of input objects is odd, in which case the last input object has been ignored.</li>\n<li>Must inputs be processed in order, or will they be processed in parallel?</li>\n</ul>\n\n<blockquote>\n  <p>One more way is you don't include error as return object and instead with every array object struct, have it's own error object as a composite so you can send elementwise error as output.</p>\n</blockquote>\n\n<p>This is probably a wise approach if the outputs are one-to-one with the inputs and you intend to handle them in parallel and/or continue processing the remaining inputs upon reaching one bad one.  Equivalently, you can have the output slice include an error.</p>\n\n<p>It's really very problem-dependent.</p>\n\n<p>Edit: consider, e.g., the following (which I don't claim is <em>good</em>, mind you):</p>\n\n<pre><code>const maxWorkers = 10 // tunable\n\n// Process a slice of T's in parallel.  The results are either an\n// R for each T, or an error.  Caller provides the actual function\n// f(T), which returns R + error (an empty/zero R for error).\nfunc ProcessInParallel(input []T, f func(T) (R, error)) ([]interface{}, error) {\n    // Make one channel for sending work to workers,\n    // and one for receiving results from workers.\n    type Todo struct {\n        i    int // the index of the item\n        item T   // the item to work on\n    }\n    workChan := make(chan Todo)\n    type Done struct {\n        i int   // the index of the item worked on\n        r R     // result, if we have one\n        e error // error, if we have one\n    }\n    doneChan := make(chan Done)\n\n    // Spin off workers: maxWorkers or len(input),\n    // whichever is smaller.\n    n := len(input)\n    if n &gt; maxWorkers {\n        n = maxWorkers\n    }\n    var wg sync.WaitGroup\n    for i := 0; i &lt; n; i++ {\n        wg.Add(1)\n        go func(i int) {\n            for todo := range workChan {\n                i := todo.i\n                r, err := f(input[i])\n                doneChan &lt;- Done{i, r, err}\n            }\n            wg.Done()\n        }(i)\n    }\n\n    // Close doneChan when all workers finish.\n    go func() {\n        wg.Wait()\n        close(doneChan)\n    }()\n\n    // Hand out work to workers (then close work channel).\n    go func() {\n        for i := range input {\n            workChan &lt;- Todo{i, input[i]}\n        }\n        close(workChan)\n    }()\n\n    // Collect results.\n    var anyErr error\n    ret := make([]interface{}, len(input))\n    for done := range doneChan {\n        i := done.i\n        r, err := done.r, done.e\n        if err != nil {\n            anyErr = err\n            ret[i] = err\n        } else {\n            ret[i] = r\n        }\n    }\n    return ret, anyErr\n}\n</code></pre>\n\n<p>This has an overall error return, <em>and</em> it returns a slice of <code>interface{}</code>.  This means you can immediately tell if everything worked.  However, it's kind of annoying to use:</p>\n\n<pre><code>ret, err := ProcessInParallel(arg, f)\nif err != nil {\n    fmt.Println(\"some inputs failed\")\n    for i := range ret {\n        if e, ok := ret[i].(error); ok {\n            fmt.Printf(\"%d: failed: %v\\n\", i, e)\n        } else {\n            fmt.Printf(\"%d: %s\\n\", i, ret[i].(R))\n        }\n    }\n} else {\n    fmt.Println(\"all inputs were good\")\n    for i := range ret {\n        fmt.Printf(\"%d: %s\\n\", i, ret[i].(R))\n    }\n}\n</code></pre>\n\n<p>Why bother with the all-error summary?</p>\n\n<p>Instead, we could have <code>ProcessInParallel</code> return <code>[]R, []error</code>, for instance, or\u2014probably better\u2014use a simple <code>error</code> interface return value to store a <a href=\"https://godoc.org/cloud.google.com/go/datastore#MultiError\" rel=\"nofollow noreferrer\">MultiError</a> as <a href=\"https://stackoverflow.com/questions/59331825/golang-best-practices-empty-array-response-or-error/59331859?noredirect=1#comment104862793_59331825\">Cerise Lim\u00f3n suggested in a comment</a>:</p>\n\n<pre><code>ret, err := ProcessInParallel(arg, f)\nif err != nil {\n    if merr, ok := err.(datastore.MultiError); ok {\n        // merr[i] indicates the various failed items\n        // any ret[i] for which merr[i] is nil is OK\n    }\n} else {\n    // all ret[i] are ok\n}\n</code></pre>\n\n<p>A working example that <em>doesn't</em> use <code>MultiError</code> is <a href=\"https://play.golang.org/p/BJVvLQSWLkv\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>A working example that <em>does</em> use <code>MultiError</code> is <a href=\"https://play.golang.org/p/J8t9g-zB6rQ\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 2, "creation_date": 1576317285, "post_id": 59332138, "comment_id": 104866274, "body": "&quot;While Go supports multiple return values, when one of the return types is an error, it is meant to process either error or the other return values and not both.&quot; This is entirely false. The most noticeable examples of having both an error and a return value is any method that implements <code>io.Reader</code>, which the document says: &quot;When Read encounters an error or end-of-file condition after successfully reading n &gt; 0 bytes, it returns the number of bytes read.&quot; The same goes with <code>io.Writer</code>."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1576317470, "post_id": 59332138, "comment_id": 104866301, "body": "And aside from package <code>io</code>, <code>go&#47;types</code> has <code>*Config.Check</code> whose doc say \u201cCheck type-checks a package and returns the resulting package object and the first error if any.\u201d; <code>go&#47;parser</code> has <code>ParseDir</code> which states &quot;If a parse error occurred, a non-nil but incomplete map and the first error encountered are returned. &quot; in its doc. There are much more in and beyond the standard packages and source code of official Go."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1576317671, "post_id": 59332138, "comment_id": 104866350, "body": "Your design is clean and neat in many ways, but having to access the result one by one (i.e., impossible to re-slice and index) might be a problem for some purposes."}, {"owner": {"reputation": 413, "user_id": 4614306, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1vO71.jpg?s=128&g=1", "display_name": "Alirus", "link": "https://stackoverflow.com/users/4614306/alirus"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1576393298, "post_id": 59332138, "comment_id": 104881019, "body": "@leafbebop The most Go funcs and methods does not guarantee to return a valid value when an error occurs, however in almost all cases they&#39;d return a zero value. So I&#39;d prefer to not trust the value when err is non-nil, since this is the default behavior, unless (in rare cases) explicitly stated in the docs."}, {"owner": {"reputation": 413, "user_id": 4614306, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1vO71.jpg?s=128&g=1", "display_name": "Alirus", "link": "https://stackoverflow.com/users/4614306/alirus"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1576393448, "post_id": 59332138, "comment_id": 104881043, "body": "@leafbebop Error handling in Go is hard, and it&#39;s hard for a reason. Re-slicing the result can always occur with another helper func."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1576393954, "post_id": 59332138, "comment_id": 104881135, "body": "whether or not a function returns a valid value while there&#39;s an error is a design decision by the owner of that function, and shall be documented. Trust the document. If there is no document, it is a good reason to not use that function. Errors are just values, and values can be programmed. They are not some magic  <code>maybe</code>. They can be perfectly programmed to be returned with valid values."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1576394241, "post_id": 59332138, "comment_id": 104881177, "body": "error handling in Go is not harder, it&#39;s more explicit. Error handling is an essential part of code and logic, if it needs more logic than printing or panicking - or handling one by one, just write complex code. I think the goal here, like other Go code, is to be clean and robust, not easy or smart. But that being said, I don&#39;t think your design is bad - it might not suit for some cases and might be great for others."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1576394331, "post_id": 59332138, "comment_id": 104881197, "body": "I downvoted because of the false claim I pointed out, not because the design."}], "tags": [], "owner": {"reputation": 413, "user_id": 4614306, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1vO71.jpg?s=128&g=1", "display_name": "Alirus", "link": "https://stackoverflow.com/users/4614306/alirus"}, "is_accepted": false, "score": 0, "last_activity_date": 1576314056, "last_edit_date": 1576314056, "creation_date": 1576294980, "answer_id": 59332138, "question_id": 59331825, "link": "https://stackoverflow.com/questions/59331825/golang-best-practices-empty-array-response-or-error/59332138#59332138", "title": "Golang best practices: empty array response or error?", "body": "<p>While Go supports multiple return values, when one of the return types is an <code>error</code>, it is meant to process either <code>error</code> or the other return values and not both. It means that when <code>error</code> is not <code>nil</code>, the other return values has no specific meaning and should not be processed.</p>\n\n<p>In your case, I'd personally prefer to use an <em>iterator</em> pattern, similar to what is implemented for <a href=\"https://golang.org/pkg/database/sql/#Rows\" rel=\"nofollow noreferrer\">database/sql.Rows</a>, such that:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func X(values []interface{}) *Result\n</code></pre>\n\n<p>The <code>Result</code> would hold all processed slice elements associated with their errors. Somewhere in the code I would write something like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>result := X(values)\nfor result.Next() {\n  if err := result.Err(); err != nil {\n    // Handle the err for this specific element.\n    // Whether continue or fail the whole process.\n  }\n\n  v := result.Cur()\n  // Process current element.\n}\n</code></pre>\n"}], "owner": {"reputation": 3039, "user_id": 2839624, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/afdae1f74dbefbbdb63d6db4d3edc782?s=128&d=identicon&r=PG&f=1", "display_name": "pratsJ", "link": "https://stackoverflow.com/users/2839624/pratsj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 860, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1576314056, "creation_date": 1576290202, "last_edit_date": 1576291353, "question_id": 59331825, "link": "https://stackoverflow.com/questions/59331825/golang-best-practices-empty-array-response-or-error", "title": "Golang best practices: empty array response or error?", "body": "<p>What are best practices in terms of error handling for a function that accepts slice of objects and returns another slice of objects (ideally of same length as input array) along with error as follows:</p>\n\n<pre><code>func ([]interface{}) ([]interface{}, error)\n</code></pre>\n\n<p>One way is whenever you get an error for processing one of the objects in a slice, you return an error response, but that way at the receiving function, if you don't discard all slice elements, error response becomes of little use merely telling us that processing of one of the elements or all failed. Another way is you return an error when none of the elements get processed but again this is of little use I feel. One more way is you don't include error as return object and instead with every slice element struct, have it's own error object as a composite so you can send elementwise error as output.</p>\n\n<p>The best way obviously depends on the particular scenario, however, I want to know if there are any best practices people follow or any design patterns around this problem.</p>\n\n<p>PS: This was one of the closest questions, however since its accepting single object as input, not very relevant:\n<a href=\"https://stackoverflow.com/questions/24852784/return-empty-array-or-error\">Return empty array or error</a></p>\n"}, {"tags": ["go", "deadlock", "channel", "goroutine"], "comments": [{"owner": {"reputation": 290, "user_id": 12282360, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mD6vbmrRrzU6C5KCSblPE2eb57ryWy4kcSb5p5apg=k-s128", "display_name": "ItsLogic", "link": "https://stackoverflow.com/users/12282360/itslogic"}, "edited": false, "score": 0, "creation_date": 1576282456, "post_id": 59331267, "comment_id": 104861748, "body": "Do not link to your code, instead insert it here."}], "answers": [{"tags": [], "owner": {"reputation": 26911, "user_id": 225262, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/10f7602ff38f6486cb1580052746fc05?s=128&d=identicon&r=PG", "display_name": "satoru", "link": "https://stackoverflow.com/users/225262/satoru"}, "is_accepted": true, "score": 2, "last_activity_date": 1576283156, "creation_date": 1576283156, "answer_id": 59331318, "question_id": 59331267, "link": "https://stackoverflow.com/questions/59331267/why-is-this-deadlocked/59331318#59331318", "title": "Why is this deadlocked?", "body": "<p><code>createFakeReadData</code> is sending strings endlessly into channels like <code>rChanMap[5]</code>.\nBut in <code>log</code> you only receive from the output channel once:</p>\n\n<pre><code>func log(l &lt;-chan string) {\n    fmt.Println(&lt;-l)\n}\n</code></pre>\n\n<p>Since all the channels you created are unbuffered, if there's no goroutine receiving from the output channel <code>logChan</code>, the other goroutines would block forever trying to send to it.</p>\n\n<p>You may want to change the <code>log</code> function to be like:</p>\n\n<pre><code>func log(l &lt;-chan string) {\n    for m := range l {\n        fmt.Println(m)\n    }\n}\n</code></pre>\n\n<p>This way it would receive from the channel until it's closed.</p>\n\n<p>BTW, some free suggestions:</p>\n\n<ol>\n<li><code>string(n)</code> doesn't convert an integer into string, try to search for the correct way to do this</li>\n<li>When you create a channel, you should think about when it should be closed, in your code no channels is closed</li>\n<li>Learn more about the difference between buffered and unbuffered channels</li>\n</ol>\n"}], "owner": {"reputation": 27, "user_id": 12521135, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBJaUqVOhdv2mBfMlhnIemiSUhjml8sfVd2mOW1NA=k-s128", "display_name": "Dallin M.", "link": "https://stackoverflow.com/users/12521135/dallin-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 59331318, "answer_count": 1, "score": -1, "last_activity_date": 1576283156, "creation_date": 1576282383, "last_edit_date": 1576282569, "question_id": 59331267, "link": "https://stackoverflow.com/questions/59331267/why-is-this-deadlocked", "title": "Why is this deadlocked?", "body": "<p>I'm running this code in the Go Playground: <a href=\"https://play.golang.org/p/1gqgXZXDhsF\" rel=\"nofollow noreferrer\">https://play.golang.org/p/1gqgXZXDhsF</a> but it ends in deadlock:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc createFakeReadData(r map[int]chan string, n int) {\n    for {\n        time.Sleep(time.Duration(n - 1) * time.Second)\n        r[n] &lt;- string(n)\n    }\n}\n\nfunc log(l &lt;-chan string) {\n    fmt.Println(&lt;-l)\n}\n\nfunc main() {\n    logChan := make(chan string)\n    go log(logChan)\n\n    rChanMap := make(map[int]chan string)\n    rChanMap[5] = make(chan string)\n    rChanMap[6] = make(chan string)\n    rChanMap[7] = make(chan string)\n    rChanMap[8] = make(chan string)\n\n    go createFakeReadData(rChanMap, 5)\n    go createFakeReadData(rChanMap, 6)\n    go createFakeReadData(rChanMap, 7)\n    go createFakeReadData(rChanMap, 8)\n\n    for {\n        var f string\n        select {\n        case f = &lt;-rChanMap[5]:\n            logChan &lt;- f\n        case f = &lt;-rChanMap[6]:\n            logChan &lt;- f\n        case f = &lt;-rChanMap[7]:\n            logChan &lt;- f\n        case f = &lt;-rChanMap[8]:\n            logChan &lt;- f\n        }\n    }\n\n}\n</code></pre>\n\n<pre><code>fatal error: all goroutines are asleep - deadlock!\n</code></pre>\n\n<p>I have 5 goroutines and a select statement in main that controls 4 of them (readers). The 5th (a logger) just sits and waits for anything to be sent to it on a channel. When one of the 4 readers gets input from a channel it should trigger a \"case\" in the select statement, then try to send that data onward to the logger channel. </p>\n\n<p>I'm fairly new to go channels. I understand what deadlock is and some situations where it might occur, especially when using unbuffered channels. But this seems to me like it should work.</p>\n\n<p>Thanks in advance for your help.</p>\n"}, {"tags": ["go", "types"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1576265518, "post_id": 59328730, "comment_id": 104856907, "body": "First that&#39;s not an alias. It is what it is, which is something that&#39;s not useful."}, {"owner": {"reputation": 121, "user_id": 1550298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b8632d154e5bddf10433363de43bc3e?s=128&d=identicon&r=PG", "display_name": "Chris Pak", "link": "https://stackoverflow.com/users/1550298/chris-pak"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1576265981, "post_id": 59328730, "comment_id": 104857050, "body": "What is &#39;it&#39;? And why is it not useful? Does it have to be useful? I am just trying to understand why it works this way"}], "answers": [{"comments": [{"owner": {"reputation": 121, "user_id": 1550298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b8632d154e5bddf10433363de43bc3e?s=128&d=identicon&r=PG", "display_name": "Chris Pak", "link": "https://stackoverflow.com/users/1550298/chris-pak"}, "edited": false, "score": 1, "creation_date": 1576266309, "post_id": 59328863, "comment_id": 104857168, "body": "Ahh, that&#39;s exactly what I needed, I should have double checked the <i>actual</i> spec rather than a summary somewhere."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 121, "user_id": 1550298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b8632d154e5bddf10433363de43bc3e?s=128&d=identicon&r=PG", "display_name": "Chris Pak", "link": "https://stackoverflow.com/users/1550298/chris-pak"}, "edited": false, "score": 5, "creation_date": 1576266418, "post_id": 59328863, "comment_id": 104857203, "body": "The Go spec is fantastic. Go is the first language I&#39;ve worked with where the spec can be read in an hour or two, and it&#39;s genuinely worth doing so once you&#39;ve mastered the basics from the Tour and Effective Go."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1576266315, "last_edit_date": 1576266315, "creation_date": 1576266122, "answer_id": 59328863, "question_id": 59328730, "link": "https://stackoverflow.com/questions/59328730/when-is-a-type-alias-of-a-pointer-equivalent-to-other-types-in-go/59328863#59328863", "title": "When is a type alias of a pointer equivalent to other types in go?", "body": "<blockquote>\n  <p>x\u2019s type V and T have identical underlying types\u2026</p>\n</blockquote>\n\n<p>You quoted the spec and elided the important part. In full, <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">that part of the spec</a> reads:</p>\n\n<blockquote>\n  <p>x's type V and T have identical underlying types <strong>and at least one of V or T is not a defined type.</strong></p>\n</blockquote>\n\n<p>What you have is <em>not</em> a type alias, it is a defined type. (<a href=\"https://golang.org/ref/spec#Type_declarations\" rel=\"nofollow noreferrer\">Type aliases</a> are of the form <code>type A = B</code>.) Therefore a function that takes the <em>defined type</em> <code>B</code> cannot take the defined type <code>A</code>; it can take <code>B</code>, or it can take <code>B</code>'s underlying type.</p>\n"}], "owner": {"reputation": 121, "user_id": 1550298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b8632d154e5bddf10433363de43bc3e?s=128&d=identicon&r=PG", "display_name": "Chris Pak", "link": "https://stackoverflow.com/users/1550298/chris-pak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 59328863, "answer_count": 1, "score": -1, "last_activity_date": 1576266315, "creation_date": 1576265429, "question_id": 59328730, "link": "https://stackoverflow.com/questions/59328730/when-is-a-type-alias-of-a-pointer-equivalent-to-other-types-in-go", "title": "When is a type alias of a pointer equivalent to other types in go?", "body": "<p>I have been trying to figure out why  one particular line will compile, while another won't.. Here's a distilled version:</p>\n\n<pre><code>type A *string\ntype B *string\n\nfunc TakeStringPointer(a *string) {\n    fmt.Println(\"something: %s\\n\", *a)\n}\n\nfunc TakeA(a A) {\n    fmt.Println(\"something else: %s\\n\", *a)\n}\n\nfunc Sample() {\n    aa := \"asdf\"\n    var pA A\n    var pB B\n    var pString *string\n\n    pA = &amp;aa\n    pB = &amp;aa\n    pString = &amp;aa\n\n    TakeStringPointer(pString)\n    TakeStringPointer(pA)\n    TakeStringPointer(pB)\n    TakeA(pA)\n    TakeA(pB) // Does not compile\n    TakeA(pString) // Does compile \n}\n</code></pre>\n\n<p>as far as I understand it, <code>TakeA(pB)</code> and <code>TakeA(pString)</code> should either both work, or both not work...</p>\n\n<pre><code>A value x is assignable to a variable of type T if:\nx\u2019s type is identical to T.\nx\u2019s type V and T have identical underlying types\u2026\n</code></pre>\n\n<p>is in the go spec. For me, I would expect both to compile, as both <code>A</code> and <code>B</code> have identical underlying types. (Or, neither would, as *string is not the same thing as A, since we have a type declaration).</p>\n\n<p>What's going on here?</p>\n"}, {"tags": ["go", "go-gorm", "go-sqlmock"], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 3, "last_activity_date": 1576258750, "creation_date": 1576258750, "answer_id": 59327401, "question_id": 59327253, "link": "https://stackoverflow.com/questions/59327253/cant-get-a-test-working-for-an-insert-statement/59327401#59327401", "title": "Can&#39;t get a test working for an INSERT statement", "body": "<p>The error message is telling you that an additional insert was being executed after the one you expected:</p>\n\n<blockquote>\n  <p>INSERT  INTO \"volumes\" ( ..... )  was not expected, next expectation is: ExpectedCommit</p>\n</blockquote>\n\n<p>In your code we can see that your <code>StoragePool</code> struct has also some <code>Volumes</code> inside in a slice.</p>\n\n<p>So probably when you call <code>InsertStoragePool</code>, first a row is inserted into <code>storage_pools</code>, then the <code>volumes</code> are inserted.</p>\n\n<p>You should add a new expectation for that insert before adding the expectation for the commit.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11471017"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 511, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1576577073, "creation_date": 1576257972, "last_edit_date": 1576577073, "question_id": 59327253, "link": "https://stackoverflow.com/questions/59327253/cant-get-a-test-working-for-an-insert-statement", "title": "Can&#39;t get a test working for an INSERT statement", "body": "<p>We have spent 2 frustrating weeks trying every possible permutation of functions and approaches using sqlmock but can't get a test working for an INSERT statement. This is very basic mom and pop SQL. Just a simple insert using Gorm.</p>\n\n<p>Way too much code to post and way to many permutations of errors and approaches to list here but I'll post the latest.</p>\n\n<pre><code>type AnyTime struct{}\n\nfunc (a AnyTime) Match(v driver.Value) bool {\n    _, ok := v.(time.Time)\n    return ok\n}\n\nfunc TestInsertStoragePool(t *testing.T) {\n\n    cases := []struct {\n        givenPool    StoragePool\n        wantedError  error\n    }{\n        {\n            givenPool: StoragePool{\n                Name:   \"POOL1\",\n                PoolId: \"1\",\n                Type:   \"NetworkFilesystem\",\n                Volumes: []Volume{\n                    {\n                        Name:      \"VOL01\",\n                        StorageId: \"1\",\n                        Type:      \"ROOT\",\n                        VolumeId:  \"1\",\n                    },\n                },\n            },\n            wantedError: nil,\n        },\n    }\n\n    for _, c := range cases {\n\n        db, mock, err := sqlmock.New()\n        if err != nil {\n            t.Fatal(err)\n        }\n\n        // Every attempt we make we try \"Postgres\", \"mysql\" and \"sqlite3\" here\n        DB, err := gorm.Open(\"sqlite3\", db)\n        if err != nil {\n            t.Fatal(err)\n        }\n        DB.LogMode(true)\n\n        mock.ExpectBegin()\n        mock.ExpectExec(`INSERT INTO \"storage_pools\"`).WithArgs(\n            AnyTime{},\n            AnyTime{},\n            nil,\n            0,\n            0,\n            \"\",\n            \"\",\n            \"\",\n            0,\n            0,\n            0,\n            \"\",\n            c.givenPool.Name,\n            \"\",\n            0,\n            \"\",\n            \"\",\n            c.givenPool.PoolId,\n            \"\",\n            \"\",\n            \"\",\n            c.givenPool.Type,\n            \"\",\n            \"\").WillReturnResult(sqlmock.NewResult(1, 1))\n\n        mock.ExpectCommit()\n\n        err = InsertStoragePool(DB, &amp;c.givenPool)\n        if err != nil {\n            fmt.Fprintf(os.Stderr, \"ERROR: %s\\n\", err)\n        }\n\n        if !reflect.DeepEqual(err, c.wantedError) {\n            t.Errorf(\"expecting errror %q, got %q\", c.wantedError, err)\n        }\n\n    }\n\n}\n</code></pre>\n\n<p>The error from this attempt:</p>\n\n<pre><code>$go test ./...\n\n(/database.go:231)\n[2019-12-13 09:22:48]  [0.11ms]  INSERT  INTO \"storage_pools\" (\"created_at\",\"updated_at\",\"deleted_at\",\"allocatediops\",\"capacityiops\",\"clusterid\",\"clustername\",\"created\",\"disksizeallocated\",\"disksizetotal\",\"disksizeused\",\"ipaddress\",\"name\",\"path\",\"physicalsize\",\"podid\",\"podname\",\"poolid\",\"provider\",\"scope\",\"state\",\"type\",\"zoneid\",\"zonename\") VALUES ('2019-12-13 09:22:48','2019-12-13 09:22:48',NULL,0,0,'','','',0,0,0,'','POOL1','',0,'','','1','','','','NetworkFilesystem','','')\n[1 rows affected or returned ]\n\n(/database.go:231)\n[2019-12-13 09:22:48]  call to ExecQuery 'INSERT  INTO \"volumes\" (\"created_at\",\"updated_at\",\"deleted_at\",\"clusterid\",\"clustername\",\"domainid\",\"domain\",\"name\",\"path\",\"physicalsize\",\"podid\",\"podname\",\"size\",\"state\",\"storageid\",\"storage\",\"type\",\"virtualsize\",\"virtualmachineid\",\"vmdisplayname\",\"vmname\",\"vmstate\",\"volumeid\",\"zoneid\",\"zonename\") VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)' with args [{Name: Ordinal:1 Value:2019-12-13 09:22:48.093749 -0800 PST m=+0.004941653} {Name: Ordinal:2 Value:2019-12-13 09:22:48.093749 -0800 PST m=+0.004941653} {Name: Ordinal:3 Value:&lt;nil&gt;} {Name: Ordinal:4 Value:} {Name: Ordinal:5 Value:} {Name: Ordinal:6 Value:} {Name: Ordinal:7 Value:} {Name: Ordinal:8 Value:VOL01} {Name: Ordinal:9 Value:} {Name: Ordinal:10 Value:0} {Name: Ordinal:11 Value:} {Name: Ordinal:12 Value:} {Name: Ordinal:13 Value:0} {Name: Ordinal:14 Value:} {Name: Ordinal:15 Value:1} {Name: Ordinal:16 Value:} {Name: Ordinal:17 Value:ROOT} {Name: Ordinal:18 Value:0} {Name: Ordinal:19 Value:} {Name: Ordinal:20 Value:} {Name: Ordinal:21 Value:} {Name: Ordinal:22 Value:} {Name: Ordinal:23 Value:1} {Name: Ordinal:24 Value:} {Name: Ordinal:25 Value:}], was not expected, next expectation is: ExpectedCommit =&gt; expecting transaction Commit\n</code></pre>\n"}, {"tags": ["regex", "go", "regex-lookarounds"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1576253118, "post_id": 59326017, "comment_id": 104851410, "body": "<code>(([^\\-].*)|(-[^c].*))</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 0, "last_activity_date": 1576254272, "creation_date": 1576254272, "answer_id": 59326372, "question_id": 59326017, "link": "https://stackoverflow.com/questions/59326017/go-negative-lookahead-alternative/59326372#59326372", "title": "Go Negative LookAhead Alternative", "body": "<p>It'll never be really robust to match against option strings like this, but if you know the possible input strings (i.e. know the order of options and/or that options are never coalesced) it should be fairly straightforward. Not sure I'd bother with a regexp. You can just do this with something like:</p>\n\n<pre><code>if strings.Contains(s, \"qcc\") &amp;&amp; !strings.Contains(s, \" -c \") { do something }\n</code></pre>\n\n<p>And then you don't have to worry about the ordering of options though you do need to know that the option -c will always be presented a certain way (with spaces around for example). </p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user12097764"}, "is_accepted": false, "score": 1, "last_activity_date": 1576258577, "creation_date": 1576258577, "answer_id": 59327376, "question_id": 59326017, "link": "https://stackoverflow.com/questions/59326017/go-negative-lookahead-alternative/59327376#59327376", "title": "Go Negative LookAhead Alternative", "body": "<p>Go regex (RE2) doesn't support assertions which would have made this easy.  </p>\n\n<p>So, two regex conditions have to be handled separately :  </p>\n\n<ol>\n<li>That <code>gcc</code> exists :  <code>/\\bgcc\\b/</code>  </li>\n<li>That <code>-c</code> does not follow downstream :  <code>/\\bgcc\\b.+?\\b-c\\b/</code>  </li>\n</ol>\n\n<p>where the validation match logic is  <code>if #1 and not #2</code> then success.  </p>\n"}], "owner": {"reputation": 49, "user_id": 4864774, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a54b259d961ce66b0779cd8c2b1cad73?s=128&d=identicon&r=PG&f=1", "display_name": "user4864774", "link": "https://stackoverflow.com/users/4864774/user4864774"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1576258577, "creation_date": 1576252909, "last_edit_date": 1576253991, "question_id": 59326017, "link": "https://stackoverflow.com/questions/59326017/go-negative-lookahead-alternative", "title": "Go Negative LookAhead Alternative", "body": "<p>I was wondering if there would be any way to regex match a string that contains qcc but does not have -c following? for example the following two would match:</p>\n\n<ol>\n<li>sdfsd/sdfs/d qcc -lang-c++ -Vgcc_ntoaarch64le -shared -o /dfgdfg/dfg/dfg/d -Wl  -Wl,--gc-sections /fgdfgdfg/dfgdfgd/fdgd</li>\n<li>qcc -lang-c++ -Vgcc_ntoaarch64le -shared -o /dfgdfg/dfg/dfg/d -Wl  -Wl,--gc-sections /fgdfgdfg/dfgdfgd/fdgd</li>\n</ol>\n\n<p>But the following would not:</p>\n\n<p>/sdfsd/sdf/sd/fs/df/dsfds/ qcc -lang-c -Vgcc_ntoaarch64le -c  -o /sdfsd/dfsdfsd/sdfsd -Wall -fmessage-length=0 -Wformat-security -g -Os -D_FORTIFY_SOURCE=2 -Wno-error=format-security -DFORD_SECTION  -DFNV2LOG_DEBUG  -std=gnu11 dir.c</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1576251871, "post_id": 59325724, "comment_id": 104850792, "body": "If it changes with client timeout, that would seem to be HTTP timeout related, not concurrency related, right? You&#39;re discarding the error from <code>client.Do</code>, which would seem to be very relevant here."}, {"owner": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1576251878, "post_id": 59325724, "comment_id": 104850796, "body": "The major problem is I don&#39;t know what to look for , like what do I search on Google for this"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1576251992, "post_id": 59325724, "comment_id": 104850847, "body": "SO is for help with programming problems, not for help Googling things... if you want help with your issue, see my previous comment. If you want help with Google searches, this is not the appropriate site for that."}, {"owner": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1576252206, "post_id": 59325724, "comment_id": 104850937, "body": "THanks for pointing out that @Adrian , but if there was an issue the function would return, but that doesn&#39;t seem to be the case. Hence, I&#39;m confused. Sorry, if I was unclear with &#39;google searches&#39; but that&#39;s not what I&#39;m seeking here for."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1576252331, "post_id": 59325724, "comment_id": 104851014, "body": "If your requests weren&#39;t timing out, changing the client timeout would have no impact. Your function returns no matter what, so I&#39;m not sure how it could not be the case - it returns whether it succeeds or fails. In any case, you have an error check where you discard the error, you should be printing it so you can see what&#39;s going on when there&#39;s an error."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1576252496, "post_id": 59325724, "comment_id": 104851104, "body": "The program does not close the response body in all cases.  Move the statement <code>defer response.Body.Close()</code> to the line before the statement <code>if response.StatusCode &lt; 400 {</code>"}, {"owner": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1576252523, "post_id": 59325724, "comment_id": 104851119, "body": "yup, that seems about right. I am trying that now and getting somewhere, will update as soon as I find something here. THanks again @Adrian"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1576252567, "post_id": 59325724, "comment_id": 104851145, "body": "Add some logging to <code>MakeRequest</code> and run it with one or two urls. The behavior is consistent with creating many requests at the same time, and timing out all of them."}, {"owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "edited": false, "score": 0, "creation_date": 1576311045, "post_id": 59325724, "comment_id": 104865254, "body": "If you need to send parallel request, you can try my little library: <a href=\"https://github.com/alessiosavi/Requests\" rel=\"nofollow noreferrer\">github.com/alessiosavi/Requests</a>. In the <code>example</code> folder you will find how to send parallel request."}], "answers": [{"comments": [{"owner": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "edited": false, "score": 0, "creation_date": 1576252811, "post_id": 59325945, "comment_id": 104851271, "body": "This looks right. However what about if I put 1M requests, then total time would definitely be &gt; 1 second ( assuming timeout is 1 second ) ?"}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "edited": false, "score": 1, "creation_date": 1576253155, "post_id": 59325945, "comment_id": 104851425, "body": "My answer was assuming your 10 to 500 requests example, if you put 1M requests, depending on the resources of the machine you are using you might saturate the CPU and the memory, so it might either take a bit longer, fail with an out of memory error, etc. Assuming you don&#39;t run out of resources, with 1M requests probably the time for reading the file, and processing the results will start to play a role as well."}, {"owner": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "edited": false, "score": 0, "creation_date": 1576253460, "post_id": 59325945, "comment_id": 104851578, "body": "Thanks, I was a bit unsure about this and hence  asked. I assumed the answer would be on somewhat these lines too."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 1, "last_activity_date": 1576252575, "creation_date": 1576252575, "answer_id": 59325945, "question_id": 59325724, "link": "https://stackoverflow.com/questions/59325724/why-does-http-request-always-take-as-long-as-the-full-timeout/59325945#59325945", "title": "Why does HTTP request always take as long as the full timeout?", "body": "<p>In your code, you are reading URLs from a file, then firing requests in parallel to all those URLs, then waiting for all the parallel requests to finish.</p>\n\n<p>So this actually makes sense and would not indicate an issue:</p>\n\n<blockquote>\n  <p>If I change the http.Client timeout to 2 seconds it will finish in 2 seconds, if it's 50 seconds it will wait till 50 seconds, it doesn't matter if the input file contains 10 urls or 500 urls.</p>\n</blockquote>\n\n<p>Let's say your file has 500 URLs.</p>\n\n<p>You fire the 500 requests in parallel... then wait for all of them to finish (remember, they are all executing in parallel). How long would that take?</p>\n\n<p>In the worst case (all of the requests timeout at 50 seconds), it will just take 50 seconds in total (since they are all waiting for those 50 seconds in parallel).</p>\n\n<p>In the best case (all requests go through successfully with no timeouts) it should take a few seconds.</p>\n\n<p>In the average case you are probably seeing (a few timeout at 50 seconds) then it takes 50 seconds (you will be waiting for those few requests to wait those 50 seconds in parallel as in the worst case).</p>\n"}], "owner": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 59325945, "answer_count": 1, "score": -1, "last_activity_date": 1576262065, "creation_date": 1576251726, "last_edit_date": 1576262065, "question_id": 59325724, "link": "https://stackoverflow.com/questions/59325724/why-does-http-request-always-take-as-long-as-the-full-timeout", "title": "Why does HTTP request always take as long as the full timeout?", "body": "<p>I am making a _golang git bruteforcer. It's acting a bit weird, I guess it's got something to do with concurrency.\n<code>sync.WaitGroup</code></p>\n\n<p>Here's the code  : <a href=\"https://dpaste.org/vO7y\" rel=\"nofollow noreferrer\">https://dpaste.org/vO7y</a></p>\n\n<pre><code>package main\n\nimport { &lt;snipped for brevity&gt; }\n\n// ReadFile : Reads File and returns it's contents\nfunc ReadFile(fileName string) []string { &lt;snipped for brevity&gt; }\n\nfunc joinString(strs ...string) string { &lt;snipped for brevity&gt; }\n\n// MakeRequest : Makes requests concurrently\nfunc MakeRequest(client *http.Client, url string, useragent string, ch chan&lt;- string, wg *sync.WaitGroup) {\n    defer wg.Done()\n    // start := time.Now()\n    request, err := http.NewRequest(\"GET\", url, nil)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    request.Header.Set(\"User-Agent\", useragent)\n    response, err := client.Do(request)\n    if err != nil {\n        return\n    }\n    // secs := time.Since(start).Seconds()\n    if response.StatusCode &lt; 400 {\n        // fmt.Printf(\"Time elapsed %f\", secs)\n        bodyBytes, err := ioutil.ReadAll(response.Body)\n        if err != nil {\n            log.Fatal(err)\n        }\n        defer response.Body.Close()\n        bodyString := string(bodyBytes)\n        notGit, err := regexp.MatchString(\"&lt;html&gt;\", strings.ToLower(bodyString))\n        if !notGit &amp;&amp; len(bodyString) &gt; 0 { // empty pages and html pages shouldn't be included\n            fmt.Println(bodyString)\n            ch &lt;- fmt.Sprintf(\" %s \", Green(url))\n        }\n    }\n}\n\nfunc main() {\n    start := time.Now()\n    useragent := \"Mozilla/10.0 (Windows NT 10.0) AppleWebKit/538.36 (KHTML, like Gecko) Chrome/69.420 Safari/537.36\"\n    gitEndpoint := []string{\"/.git/\", \"/.git/HEAD\", \"/.gitignore\", \"/.git/description\", \"/.git/index\"}\n    timeout := 10 * time.Second\n    var tr = &amp;http.Transport{\n        MaxIdleConns:      30,\n        IdleConnTimeout:   time.Second,\n        DisableKeepAlives: true,\n        TLSClientConfig:   &amp;tls.Config{InsecureSkipVerify: true},\n        DialContext: (&amp;net.Dialer{\n            Timeout:   timeout,\n            KeepAlive: time.Second,\n        }).DialContext,\n    }\n    re := func(req *http.Request, via []*http.Request) error {\n        return http.ErrUseLastResponse\n    }\n    client := &amp;http.Client{\n        Transport:     tr,\n        CheckRedirect: re,\n        Timeout:       timeout,\n    }\n    output := ReadFile(os.Args[1])\n    // start := time.Now()\n    ch := make(chan string)\n    var wg sync.WaitGroup\n    for _, url := range output {\n        for _, endpoint := range gitEndpoint {\n            wg.Add(1)\n            go MakeRequest(client, \"https://\"+url+endpoint, useragent, ch, &amp;wg)\n        }\n    }\n    go func() {\n        wg.Wait()\n        close(ch)\n    }()\n    f, err := os.OpenFile(\"git_finder.txt\", os.O_APPEND|os.O_CREATE|os.O_WRONLY, 0644)\n    for val := range ch {\n        if err != nil {\n            fmt.Println(Red(err))\n        }\n        _, err = fmt.Fprintln(f, val)\n        fmt.Println(val)\n    }\n    f.Close()\n    fmt.Printf(\"Total time taken %.2fs elapsed\\n\", time.Since(start).Seconds())\n}\n</code></pre>\n\n<p><strong>Working :</strong></p>\n\n<p>It reads the urls from a file and checks for <code>/.git, /.git/HEAD, /.git/description, /.git/index</code> on the webserver.</p>\n\n<p><strong>Problem :</strong>\nIf I change the <code>http.Client</code> timeout to <code>2 seconds</code> it will finish in 2 seconds, if it's 50 seconds it will wait till 50 seconds, it doesn't matter if the input file contains 10 urls or 500 urls.\nMy Understanding is if there's more number of urls it will wait till the timeout of last URL that's passed with the goroutine.</p>\n\n<h2>Update 1 :</h2>\n\n<p>As adrian mentioned in the comments, it doesn't look like a concurrency problem, that's what one of the main issue with this is that I can't place a finger on what the exact problem is here</p>\n"}, {"tags": ["json", "go", "go-map"], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 9719917, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab159127264aeb98b3bb7e5a09eaef81?s=128&d=identicon&r=PG&f=1", "display_name": "GeekyBoy", "link": "https://stackoverflow.com/users/9719917/geekyboy"}, "edited": false, "score": 0, "creation_date": 1576486360, "post_id": 59324644, "comment_id": 104901387, "body": "How to make it generic ?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 15, "user_id": 9719917, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab159127264aeb98b3bb7e5a09eaef81?s=128&d=identicon&r=PG&f=1", "display_name": "GeekyBoy", "link": "https://stackoverflow.com/users/9719917/geekyboy"}, "edited": false, "score": 0, "creation_date": 1576508011, "post_id": 59324644, "comment_id": 104912297, "body": "I do not understand the question"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1576247725, "creation_date": 1576247725, "answer_id": 59324644, "question_id": 59324236, "link": "https://stackoverflow.com/questions/59324236/how-to-inject-data-obtained-from-resultvar-to-result1var-in-golang/59324644#59324644", "title": "How to inject data obtained from result(var) to result1(var) in golang", "body": "<p>Both <code>result</code> and <code>result1</code> have the value of the key <code>package_service</code> coming from different sources. You want to put <code>result</code> instead of <code>result1</code>. They, you have to write to that key:</p>\n\n<pre><code>m1[\"resource\"].(map[string]interface{})[\"api_packageservicelist\"].(map[string]interface{})[\"packageservicelist\"].(map[string]interface{})[\"packaged_service_list\"].(map[string]interface{})[\"package_service\"]=result\n</code></pre>\n\n<p>Then when you write <code>m1</code>, the contents of the <code>package_service</code> from the first file will be written.</p>\n"}], "owner": {"reputation": 15, "user_id": 9719917, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab159127264aeb98b3bb7e5a09eaef81?s=128&d=identicon&r=PG&f=1", "display_name": "GeekyBoy", "link": "https://stackoverflow.com/users/9719917/geekyboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576247725, "creation_date": 1576246227, "question_id": 59324236, "link": "https://stackoverflow.com/questions/59324236/how-to-inject-data-obtained-from-resultvar-to-result1var-in-golang", "title": "How to inject data obtained from result(var) to result1(var) in golang", "body": "<ol>\n<li>terraform.tfstate is the input file and packageservicelist.tf.json is the output file.</li>\n<li>Both are converted into Map Files</li>\n<li>The data which I traversed is stored in result &amp; I want to copy the data from result to result1.</li>\n<li>Will Write operations works here. If yes . How ?</li>\n</ol>\n\n<pre><code>package main\n\nimport (  \n    \"fmt\"\n    \"io/ioutil\"\n    \"encoding/json\"\n)\n\nfunc main() {  \n    //File Reading terraform.tfstate\n\n    data, err := ioutil.ReadFile(\"terraform.tfstate\")\n    if err != nil {\n        //fmt.Println(\"File reading error\", err)\n        return\n    }\n// Map is save in m\n    m := make(map[string]interface{})\n    json.Unmarshal(data, &amp;m)\n   result:= m[\"resources\"].([]interface{})[0].(map[string]interface{})[\"instances\"].([]interface{})[0].(map[string]interface{})[\"attributes\"].(map[string]interface{})[\"packaged_service_list\"].([]interface{})[0].(map[string]interface{})[\"package_service\"]\n   fmt.Println(result)\n\n//File Reading packageservicelist.tf.json\n\n    data1, err :=ioutil.ReadFile(\"./linear/packageservicelist.tf.json\")\n    if err != nil {\n        fmt.Println(\"File reading error\", err)\n        return\n    }\n\n    m1 := make(map[string]interface{})\n    json.Unmarshal(data1, &amp;m1)\n    fmt.Println(\"\\n\")\n    result1:= m1[\"resource\"].(map[string]interface{})[\"api_packageservicelist\"].(map[string]interface{})[\"packageservicelist\"].(map[string]interface{})[\"packaged_service_list\"].(map[string]interface{})[\"package_service\"]\n    fmt.Println(result1)\n\n\n\n\n\n\n\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 7, "creation_date": 1576246107, "post_id": 59324181, "comment_id": 104847832, "body": "The same way you&#39;d run any other executable. <code>.&#47;program</code> or <code>program.exe</code>."}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 3, "creation_date": 1576247771, "post_id": 59324181, "comment_id": 104848720, "body": "After you run <code>go build main.go</code>, there will be a new file with the name of the  folder containing your <code>main.go</code> file. That is the executable. If the directory containing the <code>main.go</code> file is named <code>toto</code>, on unix you have to type <code>.&#47;toto</code> to execute it. On windows. the executable will have a <code>.exe</code> extension. You should be able to execute it by typing <code>toto.exe</code> according to @tkausl comment. I\u2019m a unix user. So I don\u2019t know how to do this on Windows."}], "answers": [{"tags": [], "owner": {"reputation": 188, "user_id": 12302514, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/956b7b706c4a591a746087393ff56deb?s=128&d=identicon&r=PG&f=1", "display_name": "Lucas De Angelis", "link": "https://stackoverflow.com/users/12302514/lucas-de-angelis"}, "is_accepted": true, "score": 5, "last_activity_date": 1576246688, "creation_date": 1576246688, "answer_id": 59324363, "question_id": 59324181, "link": "https://stackoverflow.com/questions/59324181/how-to-run-the-go-executable-file-generated-after-building-the-go-file/59324363#59324363", "title": "How to run the Go executable file generated after building the Go file?", "body": "<p>Running an executable is an operation handled by the operating system, not by go itself. In fact, it's the whole point of having executables in the first place.</p>\n\n<p>As tkausl said, you run it as you would run any other executable. For exemple, on Linux or Mac OS, you would use <code>./main</code>. On Windows, from the command line you can run <code>main.exe</code>. You can also simply double click it.</p>\n"}], "owner": {"reputation": 373, "user_id": 7680383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8d8f6de7301bd0b3196077b3247ae30?s=128&d=identicon&r=PG&f=1", "display_name": "rohegde7", "link": "https://stackoverflow.com/users/7680383/rohegde7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 177, "favorite_count": 0, "closed_date": 1576253298, "accepted_answer_id": 59324363, "answer_count": 1, "score": -2, "last_activity_date": 1576246688, "creation_date": 1576246024, "question_id": 59324181, "link": "https://stackoverflow.com/questions/59324181/how-to-run-the-go-executable-file-generated-after-building-the-go-file", "closed_reason": "Not suitable for this site", "title": "How to run the Go executable file generated after building the Go file?", "body": "<p>After I build the main.go file using <code>go build go.main</code>, I get the main executable file. How do I run the main file? If I do <code>go run main.go</code>, it automatically builds + runs the executable. But I want to know the command to run the already build executable file.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576246421, "post_id": 59323831, "comment_id": 104847982, "body": "have you checked for Qs like <a href=\"https://stackoverflow.com/a/34163477/4466350\">stackoverflow.com/a/34163477/4466350</a> ?"}, {"owner": {"reputation": 19, "user_id": 12531507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d667d9e473b46f04f56f0fb1a9a1527?s=128&d=identicon&r=PG&f=1", "display_name": "Zack", "link": "https://stackoverflow.com/users/12531507/zack"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576248420, "post_id": 59323831, "comment_id": 104849054, "body": "Yes, I have searched wide and deep. The usual solution is to simply type-assert before iterating, but - as I understand - this cannot be done with reflection (when you don&#39;t know in advance what type you are actually asserting). That&#39;s why I thought that providing more context about my use case might lead some of the more experienced people to some potential workarounds."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1576248746, "post_id": 59323831, "comment_id": 104849233, "body": "There are no dynamic types in Go."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1576261502, "post_id": 59323831, "comment_id": 104855333, "body": "@Zack cache or no cache, do not use unexported fields if you expect them to be accessed by a package other then the one in which they were declared. <code>reflect.MakeSlice</code> returns a value of type <code>reflect.Value</code> therefore passing <code>&amp;slice</code> to <code>GetAll</code> is <i>wrong</i> and attempting to <code>range</code> over <code>slice</code> is also <i>wrong</i>. Look into the <code>reflect</code> package&#39;s documentation to figure out how to get <code>*[]&lt;CustomType&gt;</code> (which is what you need to pass to <code>GetAll</code>) from <code>slice</code> and how to iterate over the elements of <i>any</i> slice contained by a <code>reflect.Value</code>."}], "answers": [{"tags": [], "owner": {"reputation": 19, "user_id": 12531507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d667d9e473b46f04f56f0fb1a9a1527?s=128&d=identicon&r=PG&f=1", "display_name": "Zack", "link": "https://stackoverflow.com/users/12531507/zack"}, "is_accepted": true, "score": 0, "last_activity_date": 1576275368, "last_edit_date": 1576275368, "creation_date": 1576275000, "answer_id": 59330426, "question_id": 59323831, "link": "https://stackoverflow.com/questions/59323831/how-to-range-over-slice-of-a-custom-type/59330426#59330426", "title": "How to range over slice of a custom type", "body": "<p>I have found a solution and thought it might be worth sharing in case anyone else has a similar problem. </p>\n\n<p>The easiest way is to initiate a slice of structs which the DataStore is expected to receive, and then to pass a pointer to it as an argument (interface{}) into the desired function. DataStore, similarly to a few unmarshaling functions (I have tried with JSON package) will be able to successfully append the data to it.</p>\n\n<p>Trying to dynamically create the slice within the function, given a certain Type, which would be then accepted by a function (such as DataStore client) might be quite difficult (I have not managed to find a way to do it). Similarly, passing a slice of interfaces (to allow for easy iteration) only complicates things.</p>\n\n<p>Secondly, in order to iterate over the data (e.g. to store it in cache), it is necessary to: \n(1) retrieve the underlying value of the interface (i.e. the pointer itself) - this can be achieved using <code>reflect.ValueOf(pointerInterface)</code>, \n(2) dereference the pointer so that we obtain access to the underlying, iterable slice of structs - this can be done by invoking <code>.Elem()</code>,\n(3) iterate over the underlying slice using <code>.Index(i)</code> method (<code>range</code> will not accept an interface, even if the underlying type is iterable).</p>\n\n<p>Naturally, adding a number of switch-case statements might be appropriate to ensure that any errors are caught rather than cause a runtime panic.</p>\n\n<p>Hence the following code provides a working solution to the above problem:</p>\n\n<p>In main:</p>\n\n<pre><code>var data []customEntry\nc.CacheData(\"Person\",&amp;data)\n</code></pre>\n\n<p>And the function itself:</p>\n\n<pre><code>func (cache *MyCache) CacheData(dataQuery string, data interface{}) error {\n    if keys, err := DataStoreClient.GetAll(cache.ctx, datastore.NewQuery(dataQuery), data); err != nil {\n        return err\n    } else {\n        s := reflect.ValueOf(data).Elem()\n        for i := 0; i &lt; s.Len(); i++ {\n            cache.Set(keys[i].Name, s.Index(i), 1)\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 12531507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d667d9e473b46f04f56f0fb1a9a1527?s=128&d=identicon&r=PG&f=1", "display_name": "Zack", "link": "https://stackoverflow.com/users/12531507/zack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 59330426, "answer_count": 1, "score": 0, "last_activity_date": 1576275368, "creation_date": 1576244783, "last_edit_date": 1576275305, "question_id": 59323831, "link": "https://stackoverflow.com/questions/59323831/how-to-range-over-slice-of-a-custom-type", "title": "How to range over slice of a custom type", "body": "<p>I'm trying to write in Go custom cache for Google DataStore (more precisely - a wrapper around one of existing cache libraries). At cache initialisation, it should accept any <strong>custom type of struct</strong> (with appropriately-defined datastore fields), which then would be the basis for all items stored. The idea is that cache can be created/initialised for various types which reflect the structure of a particular DataStore entry (<em>CustomEntry</em>)</p>\n\n<p><strong>Approach 1</strong> - store <em>reflect.Type</em> and use it. <strong>Problem encountered</strong> - can't iterate over a slice of a custom type</p>\n\n<pre><code>type CustomEntry struct {\n    Data struct {\n        name          string   `datastore:\"name,noindex\"`\n        address       []string `datastore:\"address,noindex\"`\n    } `datastore:\"data,noindex\"`\n}\n\nfunc (cache *MyCache) CacheData(dataQuery string, dataType reflect.Type) {\n    slice := reflect.MakeSlice(reflect.SliceOf(dataType), 10, 10)\n\n    if keys, err := DataStoreClient.GetAll(cache.ctx, datastore.NewQuery(dataQuery), &amp;slice); err != nil {\n        //handle error\n    } else {\n        for i, dataEntry:= range slice {\n        // ERROR: Cannot range over 'slice' (type Value)\n            cache.Set(keys[i].Name, dataEntry)\n        }\n}\n\n//usage: Cache.CacheData(\"Person\", reflect.TypeOf(CustomEntry{})\n</code></pre>\n\n<p><strong>Approach 2</strong> - accept an array of interfaces as arguments. <strong>Problem encountered</strong> = <em>[]CustomEntry</em> is not <em>[]interface{}</em> </p>\n\n<pre><code>func (cache *MyCache) CacheData(dataQuery string, dataType []interface{}) {\n    if keys, err := DataStoreClient.GetAll(cache.ctx, datastore.NewQuery(dataQuery), &amp;dataType); err != nil {\n        //handle error\n    } else {\n        for i, dataEntry:= range slice {\n        // this seems to work fine\n            cache.Set(keys[i].Name, dataEntry)\n        }\n}\n\n//usage: \nvar dataType []CustomEntry\nCache.CacheData(\"Person\", data)\n// ERROR: Cannot use 'data' (type []CustomEntry) as type []interface{}\n</code></pre>\n\n<p>Any suggestions would be highly appreciated. </p>\n"}, {"tags": ["regex", "go", "re2"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1576244214, "post_id": 59323606, "comment_id": 104846866, "body": "<code>strings.Split(x, &quot; and &quot;)</code>"}, {"owner": {"reputation": 316, "user_id": 9418957, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HtnXo.jpg?s=128&g=1", "display_name": "M.H. Hussaini", "link": "https://stackoverflow.com/users/9418957/m-h-hussaini"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1576246131, "post_id": 59323606, "comment_id": 104847848, "body": "For the given example your solution works, but I might not work for a value like <i>start=(&quot;a&quot;, &quot; b and a&quot;)</i>."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 3, "creation_date": 1576246190, "post_id": 59323606, "comment_id": 104847877, "body": "don t use regexp for that. Write a parser, it is super easy."}, {"owner": {"reputation": 11918, "user_id": 5527985, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CfG3C.png?s=128&g=1", "display_name": "bobble bubble", "link": "https://stackoverflow.com/users/5527985/bobble-bubble"}, "edited": false, "score": 2, "creation_date": 1576247031, "post_id": 59323606, "comment_id": 104848317, "body": "A quick <a href=\"http://www.softec.lu/site/RegularExpressions/UnrollingTheLoop\" rel=\"nofollow noreferrer\">unrolled</a> idea: <a href=\"https://regex101.com/r/Fs8nTw/1/\" rel=\"nofollow noreferrer\"><code>\\w+=\\([^)(]*(?:\\([^)(]*\\)[^)(]*)*\\)</code></a> But if it comes to arbitrary nested parenthesis and no regex recursion is available, a parser is the only solution. If it&#39;s about the escaped quote, you can also try something like <a href=\"https://regex101.com/r/Fs8nTw/2\" rel=\"nofollow noreferrer\"><code>\\w+=\\(&quot;.*?[^\\\\]&quot;\\)</code></a>"}], "answers": [{"comments": [{"owner": {"reputation": 8251, "user_id": 2912665, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XrRhd.jpg?s=128&g=1", "display_name": "CinCout", "link": "https://stackoverflow.com/users/2912665/cincout"}, "edited": false, "score": 0, "creation_date": 1576244574, "post_id": 59323720, "comment_id": 104847036, "body": "You must explain the regex a bit. It&#39;s too complicated IMO"}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 1, "creation_date": 1576244838, "post_id": 59323720, "comment_id": 104847183, "body": "But it won&#39;t match <code>between=(&quot;range(2019, max, to=\\&quot;le\\&quot;)&quot;, &quot;b&quot;)</code>, see <a href=\"https://regex101.com/r/3ytO9P/2\" rel=\"nofollow noreferrer\">regex101.com/r/3ytO9P/2</a>. <code>\\S+=(\\([^(]*(?:[^(&quot;]*&quot;(?:[^\\\\&quot;]|\\\\[&quot;\\\\])*&quot;)(\\)))</code> is a wrong pattern."}, {"owner": {"reputation": 10894, "user_id": 3150271, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/EXijl.jpg?s=128&g=1", "display_name": "Anonymous", "link": "https://stackoverflow.com/users/3150271/anonymous"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 1, "creation_date": 1576245324, "post_id": 59323720, "comment_id": 104847429, "body": "@WiktorStribi\u017cew Thanks. I didn\u2019t see that in the original regex. Updated."}, {"owner": {"reputation": 316, "user_id": 9418957, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HtnXo.jpg?s=128&g=1", "display_name": "M.H. Hussaini", "link": "https://stackoverflow.com/users/9418957/m-h-hussaini"}, "edited": false, "score": 1, "creation_date": 1576245988, "post_id": 59323720, "comment_id": 104847769, "body": "Thanks @Anonymous works perfectly :)"}, {"owner": {"reputation": 10894, "user_id": 3150271, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/EXijl.jpg?s=128&g=1", "display_name": "Anonymous", "link": "https://stackoverflow.com/users/3150271/anonymous"}, "reply_to_user": {"reputation": 316, "user_id": 9418957, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HtnXo.jpg?s=128&g=1", "display_name": "M.H. Hussaini", "link": "https://stackoverflow.com/users/9418957/m-h-hussaini"}, "edited": false, "score": 0, "creation_date": 1576246895, "post_id": 59323720, "comment_id": 104848246, "body": "@M.H.Hussaini You\u2019re welcome :)"}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 1, "creation_date": 1576249347, "post_id": 59323720, "comment_id": 104849549, "body": "It still does not support other escape sequences. The first <code>[^(&quot;]*</code> is redundant in the current pattern. It won&#39;t match <code>between=(&quot;a&quot;,,,)</code> but will match <code>between=(&quot;a&quot;,,&quot;,&quot;)</code> - this is inconsistent. The right regex will match valid double quoted string literals separated with commas and any amount of whitespace between them. The <code>\\S+=(\\([^(]*(?:[^(&quot;]*&quot;(?:[^\\\\&quot;]|\\\\[&quot;\\\\])*&quot;)(\\)))</code> is not the right pattern IMHO"}, {"owner": {"reputation": 10894, "user_id": 3150271, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/EXijl.jpg?s=128&g=1", "display_name": "Anonymous", "link": "https://stackoverflow.com/users/3150271/anonymous"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 2, "creation_date": 1576254890, "post_id": 59323720, "comment_id": 104852282, "body": "@WiktorStribi\u017cew There are definitely other changes you could make. It\u2019s not clear from the question that these are what the OP wants though, but it\u2019s good to point them out"}], "tags": [], "owner": {"reputation": 10894, "user_id": 3150271, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/EXijl.jpg?s=128&g=1", "display_name": "Anonymous", "link": "https://stackoverflow.com/users/3150271/anonymous"}, "is_accepted": true, "score": 3, "last_activity_date": 1576255599, "last_edit_date": 1576255599, "creation_date": 1576244333, "answer_id": 59323720, "question_id": 59323606, "link": "https://stackoverflow.com/questions/59323606/golang-regex-to-extract-values-inside-parantheses-and-ignore-inner-parantheses-i/59323720#59323720", "title": "Golang regex to extract values inside parantheses and ignore inner parantheses in any", "body": "<p>The problem is the escaped quotes:</p>\n\n<pre><code>\\S+=(\\([^(]*(?:[^(\"]*\"(?:[^\\\\\"]|\\\\[\"\\\\])*\")(\\)))\n</code></pre>\n\n<p><a href=\"https://regex101.com/r/3ytO9P/1\" rel=\"nofollow noreferrer\">https://regex101.com/r/3ytO9P/1</a></p>\n\n<p>I changed <code>[^\"]</code> to <code>(?:[^\\\\\"]|\\\\[\"\\\\])</code>. This makes the regex look for either a regular character or an escape. By matching the escape, it doesn\u2019t allow <code>\\\"</code> to end the match.</p>\n\n<p>Your regex has other problems though. This should work better:</p>\n\n<pre><code>\\S+=(\\([^(\"]*(?:[^(\"]*\"(?:[^\\\\\"]|\\\\[\"\\\\])*\")*(\\)))\n</code></pre>\n\n<p><a href=\"https://regex101.com/r/OuDvyX/1\" rel=\"nofollow noreferrer\">https://regex101.com/r/OuDvyX/1</a></p>\n\n<p>It changes <code>[^(]</code> to <code>[^(\"]</code> to prevent <code>\"</code> from being matched unless it\u2019s part of a complete string.</p>\n\n<hr>\n\n<p><strong>UPDATE:</strong></p>\n\n<p><strong><a href=\"https://stackoverflow.com/users/3832970/wiktor-stribi%C5%BCew\">@Wiktor Stribi\u017cew</a></strong> commented <a href=\"https://stackoverflow.com/a/59323720/3150271#comment104849549_59323720\">below</a>:</p>\n\n<blockquote>\n  <p>It still does not support other escape sequences. The first <code>[^(\"]*</code> is redundant in the current pattern. It won't match <code>between=(\"a\",,,)</code> but will match <code>between=(\"a\",,\",\")</code> - this is inconsistent. The right regex will match valid double quoted string literals separated with commas and any amount of whitespace between them. The <code>\\S+=(\\([^(]*(?:[^(\"]*\"(?:[^\\\\\"]|\\\\[\"\\\\])*\")(\\)))</code> is not the right pattern IMHO</p>\n</blockquote>\n\n<p>If you really want the regex to be that robust, you should use a parser, but you could fix those problems by using:</p>\n\n<pre><code>\\S+=(\\((?:[^(\"]*\"(?:[^\\\\\"]|\\\\.)*\"[^(\"]*)*(\\)))\n</code></pre>\n"}], "owner": {"reputation": 316, "user_id": 9418957, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HtnXo.jpg?s=128&g=1", "display_name": "M.H. Hussaini", "link": "https://stackoverflow.com/users/9418957/m-h-hussaini"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 1, "closed_date": 1576276556, "accepted_answer_id": 59323720, "answer_count": 1, "score": 5, "last_activity_date": 1576266126, "creation_date": 1576243869, "last_edit_date": 1576266126, "question_id": 59323606, "link": "https://stackoverflow.com/questions/59323606/golang-regex-to-extract-values-inside-parantheses-and-ignore-inner-parantheses-i", "closed_reason": "Duplicate", "title": "Golang regex to extract values inside parantheses and ignore inner parantheses in any", "body": "<p>I have the following example of <em>key=value</em> pairs as one line string</p>\n\n<blockquote>\n  <p><code>start=(\"a\", \"b\") and between=(\"range(2019, max, to=\\\"le\\\")\") and end=(\"a\", \"b\")</code></p>\n</blockquote>\n\n<p>Using regex in golang I want to extract the key=value pairs as below</p>\n\n<ol>\n<li><code>start=(\"a\", \"b\")</code></li>\n<li><code>between=(\"range(2019, max, to=\\\"le\\\")\")</code></li>\n<li><code>end=(\"a\", \"b\")</code></li>\n</ol>\n\n<p>There are solutions on stackoverflow but do not work with golang regex.</p>\n\n<p>There is a link to my failed attempt with golang regex: <a href=\"https://regex101.com/r/YccNOj/1\" rel=\"nofollow noreferrer\">regex101 golang flavor</a></p>\n\n<p>I would appreciate any help.</p>\n"}, {"tags": ["go", "sdk", "gcloud"], "answers": [{"tags": [], "owner": {"reputation": 1949, "user_id": 11784749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YWnrE.jpg?s=128&g=1", "display_name": "Denis T.", "link": "https://stackoverflow.com/users/11784749/denis-t"}, "is_accepted": false, "score": 0, "last_activity_date": 1576246941, "creation_date": 1576246941, "answer_id": 59324436, "question_id": 59323552, "link": "https://stackoverflow.com/questions/59323552/usage-of-context-in-gcloud-go-sdk-for-cloudresourcemanager/59324436#59324436", "title": "Usage of context in gcloud go sdk for cloudresourcemanager", "body": "<p>According to the <strong>Go</strong> <a href=\"https://blog.golang.org/context\" rel=\"nofollow noreferrer\"><strong>documentation</strong></a>:</p>\n\n<blockquote>\n  <p>In Go servers, each incoming request is handled in its own\n  <strong>goroutine</strong>. Request handlers often start additional goroutines to access backends such as databases and RPC services. </p>\n  \n  <p>The set of goroutines working on a request typically needs access to\n  <strong>request-specific values</strong> such as the identity of the end user, authorization tokens, and the request's deadline. When a request is\n  canceled or times out, all the goroutines working on that request\n  should exit quickly so the system can reclaim any resources they are\n  using.</p>\n  \n  <p>The <strong>context</strong> package makes it easy to pass request-scoped values,\n  cancelation signals, and deadlines across API boundaries to all the\n  goroutines involved in handling a request.</p>\n</blockquote>\n\n<hr>\n\n<p>The <strong>context.Background()</strong> is the root of any Context tree:</p>\n\n<blockquote>\n  <p>Background returns a non-nil empty context. It is never canceled, has\n  no deadline, and has no values. Background is typically used in main,\n  init, and tests, and as the top-level Context for incoming requests.</p>\n</blockquote>\n"}], "owner": {"reputation": 9276, "user_id": 2409793, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/QDLY9.png?s=128&g=1", "display_name": "pkaramol", "link": "https://stackoverflow.com/users/2409793/pkaramol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576246941, "creation_date": 1576243689, "last_edit_date": 1592644375, "question_id": 59323552, "link": "https://stackoverflow.com/questions/59323552/usage-of-context-in-gcloud-go-sdk-for-cloudresourcemanager", "title": "Usage of context in gcloud go sdk for cloudresourcemanager", "body": "<p>I am following the official <code>go</code> <a href=\"https://godoc.org/google.golang.org/api/cloudresourcemanager/v1\" rel=\"nofollow noreferrer\">documentation</a> for gcloud sdk.</p>\n<p>As an initial step, I am trying to instantiate a <code>cloudresourcemanager</code> service.</p>\n<p>What I cannot seem to understand (perhaps its my poor background on <code>go</code> contexts) is why a <code>context</code> is needed to instantiate such a service as indicated in the official usage example:</p>\n<pre><code>import &quot;google.golang.org/api/cloudresourcemanager/v1&quot;\n...\nctx := context.Background()\ncloudresourcemanagerService, err := cloudresourcemanager.NewService(ctx)\n\n</code></pre>\n<p>Unless I am missing sth, the docs do not go into details about this.</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-dynamodb"], "answers": [{"tags": [], "owner": {"reputation": 2901, "user_id": 729784, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/d76fae8519fd3b58c86d830b90301599?s=128&d=identicon&r=PG", "display_name": "Aliaksandr Kazlou", "link": "https://stackoverflow.com/users/729784/aliaksandr-kazlou"}, "is_accepted": false, "score": 0, "last_activity_date": 1578147363, "last_edit_date": 1578147363, "creation_date": 1578146949, "answer_id": 59591459, "question_id": 59323126, "link": "https://stackoverflow.com/questions/59323126/how-to-filter-dynamodb-in-golang-by-global-secondary-index/59591459#59591459", "title": "How to filter dynamodb in golang by global secondary index?", "body": "<p>It is easier to use <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/dynamodb/expression\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/service/dynamodb/expression</a> package which takes care of the proper setup of all <code>QueryInput</code> attributes.</p>\n\n<p>Also for the example of usage, you check this repo <a href=\"https://github.com/zshamrock/dynocsv/blob/master/aws/dynamodb/dynamodb.go#L253\" rel=\"nofollow noreferrer\">https://github.com/zshamrock/dynocsv/blob/master/aws/dynamodb/dynamodb.go#L253</a>.</p>\n\n<p>So in your case this might look like this:</p>\n\n<pre><code>hash := expression.KeyEqual(expression.Key(\"Token\"), expression.Value(token))\nexpr, _ := expression.NewBuilder().\n    WithKeyCondition(hash).\n    WithProjection(expression.NamesList(expression.Name(\"Id\"), expression.Name(\"Token\"))).\n    Build()\nqueryInput := &amp;dynamodb.QueryInput{\n    TableName:              aws.String(\"Entity\"),\n    IndexName:              aws.String(\"IdxGS\"),\n    KeyConditionExpression: expr.KeyCondition(),\n    ExpressionAttributeValues: expr.Values(),\n    ProjectionExpression: expr.Projection()}\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 12531467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8122ea7a90e35e0b86bf937db700057?s=128&d=identicon&r=PG&f=1", "display_name": "Joe Doe", "link": "https://stackoverflow.com/users/12531467/joe-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 348, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1578147363, "creation_date": 1576242029, "question_id": 59323126, "link": "https://stackoverflow.com/questions/59323126/how-to-filter-dynamodb-in-golang-by-global-secondary-index", "title": "How to filter dynamodb in golang by global secondary index?", "body": "<p>I have a problem filtering the dynamodb table using Go.</p>\n\n<p>The table has the following structure:</p>\n\n<pre><code>input := &amp;dynamodb.CreateTableInput{\n    BillingMode: aws.String(\"PAY_...\"),\n\n    AttributeDefinitions: []*dynamodb.AttributeDefinition{\n        {\n            AttributeName: aws.String(\"Id\"),\n            AttributeType: aws.String(\"N\"),\n        },\n        {\n            AttributeName: aws.String(\"Token\"),\n            AttributeType: aws.String(\"S\"),\n        },\n    },\n    KeySchema: []*dynamodb.KeySchemaElement{\n        {\n            AttributeName: aws.String(\"Id\"),\n            KeyType:       aws.String(\"HASH\"),\n        },\n    },\n    GlobalSecondaryIndexes: []*dynamodb.GlobalSecondaryIndex{\n        {\n            IndexName: aws.String(\"IdxGS\"),\n            KeySchema: []*dynamodb.KeySchemaElement{\n                {\n                    AttributeName: aws.String(\"Token\"),\n                    KeyType:       aws.String(\"HASH\"),\n                },\n            },\n            Projection: &amp;dynamodb.Projection{\n                ProjectionType: aws.String(\"ALL\"),\n            },\n        },\n    },\n    TableName: aws.String(\"Entity\"),\n}\n</code></pre>\n\n<p>I tried different ways to filter it:</p>\n\n<p>1st option:</p>\n\n<pre><code>queryInput := &amp;dynamodb.QueryInput{\n    TableName:              aws.String(\"Entity\"),\n    IndexName:              aws.String(\"IdxGS\"),\n    KeyConditionExpression: \"Token = :token\",\n    ExpressionAttributeValues: {\n        \":token\": token,\n    },\n    ProjectionExpression: \"Id, Token\"}\n\nresp, err := DynamoDbClient.Query(queryInput)\n</code></pre>\n\n<p>And this piece of ...code is not compilable, don't have a clue why.</p>\n\n<p>Also tried to use another type of the input request:\nOption 2:</p>\n\n<pre><code>var queryInput = &amp;dynamodb.QueryInput{\n        TableName: aws.String(\"Entity\"),\n        IndexName: aws.String(\"IdxGS\"),\n        KeyConditions: map[string]*dynamodb.Condition{\n            \"TokenGS\": {\n                ComparisonOperator: aws.String(\"EQ\"),\n                AttributeValueList: []*dynamodb.AttributeValue{\n                    {\n                        S: aws.String(token),\n                    },\n                },\n            },\n        },\n    }\n</code></pre>\n\n<p>And alghough it's compilable it does not pass the test.</p>\n\n<p>I checked many different examples, either they do not work or they do not use GlobalSecondaryIndex.</p>\n"}, {"tags": ["go", "pprof"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 3, "creation_date": 1576236253, "post_id": 59321464, "comment_id": 104843008, "body": "<code>Why I get 1.61GB allocation?</code> because the profiler has run many times (remember b.N ?) to collect stats and this is what he found. <code>Isn&#39;t it too much?</code> depends what you are looking to optimize, memory consumption, cpu performance. In current case, no it is not, it happens your code is such a micro benchmark that the profiler got to run many many times before it can get correct stats. <code>How can I check what is one function run memory allocation?</code> can you rephrase please ?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 3, "creation_date": 1576236338, "post_id": 59321464, "comment_id": 104843053, "body": "It supposedly isn&#39;t. What stats does that sample <code>go test</code> run printed you? I mean, what number of iterations the benchmarking engine deemed suitable to run? The next thing to consider is that <code>pprof</code> counts actual memory allocaton, and it&#39;s quite possble that <code>make([]byte, 8)</code> actually allocated more than 8 bytes, and also <code>append</code> actully grows the slice using an algorythm more tricky than you might though it is: until it hits certain memory size, it actually allocates &#215;2 the space you&#39;ve tried to append\u2014in order to try to inhibit <i>reallocations</i> on future appends."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 3, "creation_date": 1576236433, "post_id": 59321464, "comment_id": 104843101, "body": "\u2026 Also note that when that guessing fails, and it must reallocate, it allocates a <i>new</i> memory chunk which is larger than the original and copies the existing elements over there. And while the old backing array becomes garbage, the new whole array <i>is</i> an allocation. All-in-all, the runtime ends up allocating much more than what you could have calculated by applying simple-minded logic (like <code>(8 + sizeof(sliceHeader)) &#215; b.N</code>)."}, {"owner": {"reputation": 513, "user_id": 5507931, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/14d9f9a2bc7be5a6990f11f7218a625c?s=128&d=identicon&r=PG&f=1", "display_name": "Yura", "link": "https://stackoverflow.com/users/5507931/yura"}, "edited": false, "score": 0, "creation_date": 1576236731, "post_id": 59321464, "comment_id": 104843251, "body": "thnx, gentlemen. I think I understand now"}], "owner": {"reputation": 513, "user_id": 5507931, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/14d9f9a2bc7be5a6990f11f7218a625c?s=128&d=identicon&r=PG&f=1", "display_name": "Yura", "link": "https://stackoverflow.com/users/5507931/yura"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 93, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1576235846, "creation_date": 1576235748, "last_edit_date": 1576235846, "question_id": 59321464, "link": "https://stackoverflow.com/questions/59321464/understanding-go-pprof-statistics", "title": "Understanding Go pprof statistics", "body": "<p>I'm learning how Go profilig works. So I do the following example</p>\n\n<pre><code>func Func() {\n\n    var b [][]byte\n\n    for i := 0; i &lt; 8; i++ {\n        b = append(b, make([]byte, 8))\n    }\n\n}\n\nfunc BenchmarkFunc(b *testing.B) {\n\n    for i:=0; i&lt;b.N; i++ {\n        Func()\n    }\n}\n</code></pre>\n\n<p>then I run </p>\n\n<pre><code>go test -run none -bench Func -benchmem -memprofile mem.out\n</code></pre>\n\n<p>and </p>\n\n<pre><code>go tool pprof -alloc_space mem.out \n(pprof) list Func\n</code></pre>\n\n<p>What I get is </p>\n\n<pre><code>Total: 1.61GB\nROUTINE ======================== test-mem/somepkg.BenchmarkFunc in .../work/go/src/test-mem/somepkg/somepkg_test.go\n         0     1.61GB (flat, cum)   100% of Total\n         .          .     14://\n         .          .     15:\n         .          .     16:func BenchmarkFunc(b *testing.B) {\n         .          .     17:\n         .          .     18:   for i:=0; i&lt;b.N; i++ {\n         .     1.61GB     19:           Func()\n         .          .     20:   }\n         .          .     21:}\nROUTINE ======================== test-mem/somepkg.Func in .../go/src/test-mem/somepkg/somepkg.go\n    1.61GB     1.61GB (flat, cum)   100% of Total\n         .          .     42:func Func() {\n         .          .     43:\n         .          .     44:   var b [][]byte\n         .          .     45:\n         .          .     46:   for i := 0; i &lt; 8; i++ {\n    1.61GB     1.61GB     47:           b = append(b, make([]byte, 8))\n         .          .     48:   }\n         .          .     49:\n         .          .     50:}\n</code></pre>\n\n<p>Why I get <code>1.61GB</code> allocation? Isn't it too much? How can I check what is one function run memory allocation?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1576234373, "post_id": 59320654, "comment_id": 104842070, "body": "If you don&#39;t want the whole struct, don&#39;t print the whole struct. Print just s.Total."}], "answers": [{"tags": [], "owner": {"reputation": 2672, "user_id": 1288818, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7CfkE.jpg?s=128&g=1", "display_name": "Oleg Butuzov", "link": "https://stackoverflow.com/users/1288818/oleg-butuzov"}, "is_accepted": true, "score": 1, "last_activity_date": 1576238350, "last_edit_date": 1576238350, "creation_date": 1576233554, "answer_id": 59320826, "question_id": 59320654, "link": "https://stackoverflow.com/questions/59320654/remove-all-non-alphanumeric-characters-from-a-variable-which-store-a-output-of-a/59320826#59320826", "title": "Remove all Non-Alphanumeric Characters from a variable which store a output of an unmarshal function", "body": "<p>Issue you got is about formating verbs - <code>%v</code> - will show you verbose way how your variable looks like. You also can try to use <code>%+v</code> and <code>%#v</code>, but what you need is <code>%s</code> (if stringer implemented) or call a struct field, as far as I see and guess.</p>\n\n<hr>\n\n<ul>\n<li><code>&amp;{6}</code> is only pointer to struct with number 6 in it (<code>%v</code> with represent it in this way).</li>\n<li><code>&amp;{%!s(int=6)}</code> - this you will get if you will try to use <code>%s</code> on a struct that doesn't have Stringer interface implementation.</li>\n<li><code>&amp;{field:6}</code> - <code>%+v</code> will generate also field name of the struct.</li>\n<li><code>&amp;struct { v int }{v:6}</code> this shows (my example) a struct name and package and value - thats for <code>%#v</code>.</li>\n</ul>\n\n<p>I would suggest to call struct field directly.</p>\n\n<pre><code>func main() {\n    s := &amp;struct {\n        v int\n    }{6}\n    fmt.Printf(\"%d\", s.v)\n}\n</code></pre>\n\n<p>Outputs <code>6</code>, but you need to call field instead of the struct.</p>\n"}], "owner": {"reputation": 33, "user_id": 9940223, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q8aOjPa0u_g/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2bklipxfZhlKgytcKAKKsMRWdHrQ/mo/photo.jpg?sz=128", "display_name": "happenz", "link": "https://stackoverflow.com/users/9940223/happenz"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "closed_date": 1576241035, "accepted_answer_id": 59320826, "answer_count": 1, "score": -3, "last_activity_date": 1576238350, "creation_date": 1576233011, "last_edit_date": 1576234313, "question_id": 59320654, "link": "https://stackoverflow.com/questions/59320654/remove-all-non-alphanumeric-characters-from-a-variable-which-store-a-output-of-a", "closed_reason": "Not suitable for this site", "title": "Remove all Non-Alphanumeric Characters from a variable which store a output of an unmarshal function", "body": "<p>I parse and store JSON data via the package json and use the func Unmarshal to get my desired output. \nUnfortunately the output I get is:</p>\n\n<p>&amp;{6}</p>\n\n<p>and I only want </p>\n\n<p>6.</p>\n\n<p>Here some of my code:</p>\n\n<pre><code>type AutoGenerated struct {\n    Total      int    `json:\"total\"`\n}\n\nfunc getStations(body []byte) (*AutoGenerated, error) {\n    var s = new(AutoGenerated)\n    err := json.Unmarshal(body, &amp;s)\n    if(err != nil){\n                fmt.Println(\"whoops:\", err)\n    }\n    return s, err\n}\n\nfunc main() {\n    s, err := getStations([]byte(body))\n\n    fmt.Printf(\"%v, %T\", s, s)\n\n    s, err := getStations([]byte(body))\n}\n</code></pre>\n\n<p>I can't use the reg.ReplaceAllString function in the package regexp because this is no string. It seems to be a pointer or something. body stores the json.</p>\n"}]