[{"tags": ["go", "lnk"], "answers": [{"comments": [{"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1495661650, "post_id": 44168779, "comment_id": 75353660, "body": "Does <a href=\"https://golang.org/pkg/os/#Readlink\" rel=\"nofollow noreferrer\">os.Readlink(path)</a> not work on Windows?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 2, "creation_date": 1495661750, "post_id": 44168779, "comment_id": 75353698, "body": "@jrefior for symlink (<code>mklink</code> or maybe junction: <code>mklink &#47;J</code>), as seen in <a href=\"https://github.com/golang/go/issues/15978\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/15978</a>. Not for &quot;shortcut&quot; (<code>lnk</code>)"}, {"owner": {"reputation": 495, "user_id": 1950663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nBJeA.png?s=128&g=1", "display_name": "CoppolaEmilio", "link": "https://stackoverflow.com/users/1950663/coppolaemilio"}, "edited": false, "score": 0, "creation_date": 1495668580, "post_id": 44168779, "comment_id": 75355837, "body": "@VonC can you write a little example on how to get that info? I&#39;m very lost with this one :("}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 495, "user_id": 1950663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nBJeA.png?s=128&g=1", "display_name": "CoppolaEmilio", "link": "https://stackoverflow.com/users/1950663/coppolaemilio"}, "edited": false, "score": 1, "creation_date": 1495668920, "post_id": 44168779, "comment_id": 75355932, "body": "@CoppolaEmilio I will, tomorrow (a bit late here at the moment)"}, {"owner": {"reputation": 495, "user_id": 1950663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nBJeA.png?s=128&g=1", "display_name": "CoppolaEmilio", "link": "https://stackoverflow.com/users/1950663/coppolaemilio"}, "edited": false, "score": 0, "creation_date": 1495729404, "post_id": 44168779, "comment_id": 75384484, "body": "@VonC Sorry to pest you, but can you help me now? I want to accept the answer :)"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 495, "user_id": 1950663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nBJeA.png?s=128&g=1", "display_name": "CoppolaEmilio", "link": "https://stackoverflow.com/users/1950663/coppolaemilio"}, "edited": false, "score": 0, "creation_date": 1495730813, "post_id": 44168779, "comment_id": 75385277, "body": "@CoppolaEmilio I didn&#39;t get far: you can clone the repo and go build it: it will give you a <code>shortcut.exe</code> utility that you can use on your <code>.lnk</code> file: <code>shortcut -file c:\\path\\to\\ashortcut.lnk</code>. But the destination path isn&#39;t directly detected. I !suspect it needs to be interpreted and reassembled, following the Microsoft spec."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 495, "user_id": 1950663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nBJeA.png?s=128&g=1", "display_name": "CoppolaEmilio", "link": "https://stackoverflow.com/users/1950663/coppolaemilio"}, "edited": false, "score": 1, "creation_date": 1495730864, "post_id": 44168779, "comment_id": 75385311, "body": "@CoppolaEmilio In short, it helps you decoding the structure of a .lnk file, but a bit more work is required in order to retrieve the actual destination path."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 4, "last_activity_date": 1495661457, "creation_date": 1495661457, "answer_id": 44168779, "question_id": 44168401, "link": "https://stackoverflow.com/questions/44168401/read-the-target-of-a-shortcut-using-go/44168779#44168779", "title": "Read the Target of a Shortcut using Go", "body": "<p>You need to read the <a href=\"https://msdn.microsoft.com/en-us/library/dd891253.aspx\" rel=\"nofollow noreferrer\">lnk binary format as defined by Microsoft</a></p>\n\n<p>In Go, its structure would translate to (as used in the <a href=\"https://github.com/exponential-decay/shortcuts/blob/ff88771677a5e831482e1d74d023864dfe48857f/structs.go#L14-L34\" rel=\"nofollow noreferrer\"><code>exponential-decay/shortcuts</code></a>)</p>\n\n<pre><code>//structs that make up the shortcut specification [76 bytes] \ntype ShellLinkHeader struct {\n   HeaderSize  [4]byte           //HeaderSize\n   ClassID     [16]byte          //LinkCLSID\n   LinkFlags   uint32            //LinkFlags      [4]byte\n   FileAttr    uint32            //FileAttributes [4]byte\n   Creation    [8]byte           //CreationTime\n   Access      [8]byte           //AccessTime\n   Write       [8]byte           //WriteTime\n   FileSz      [4]byte           //FileSize\n   IconIndex   [4]byte           //IconIndex\n   ShowCmd     [4]byte           //ShowCommand\n\n   //[2]byte HotKey values for shortcut shortcuts\n   HotKeyLow   byte              //HotKeyLow\n   HotKeyHigh  byte              //HotKeyHigh\n\n   Reserved1   [2]byte           //Reserved1\n   Reserved2   [4]byte           //Reserved2\n   Reserved3   [4]byte           //Reserved3\n}\n</code></pre>\n\n<p>That project should give you an idea to how to decode the shortcut target.</p>\n"}], "owner": {"reputation": 495, "user_id": 1950663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/nBJeA.png?s=128&g=1", "display_name": "CoppolaEmilio", "link": "https://stackoverflow.com/users/1950663/coppolaemilio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 477, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1497478204, "creation_date": 1495659733, "question_id": 44168401, "link": "https://stackoverflow.com/questions/44168401/read-the-target-of-a-shortcut-using-go", "title": "Read the Target of a Shortcut using Go", "body": "<p>I'm trying to read the <strong>target</strong> file/directory of a shortcut (.lnk) file using Go.</p>\n\n<p>I already have a loop for all the files in a directory and I can successfully identify if it is a dir with <code>IsDir()</code> or if it is a file <code>IsRegular()</code>. Now I need a way to read if it is a link and, if it is a <code>.lnk</code>, the path of it so I can print it.</p>\n\n<p>I couldn't find any way of doing this and I've been searching on SO but nothing comes up. Any idea?</p>\n"}, {"tags": ["go", "makefile"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1495655734, "post_id": 44167230, "comment_id": 75350894, "body": "note that in go1.9 this will no longer be necessary."}, {"owner": {"reputation": 19253, "user_id": 657267, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1dcf516021abb964aecd6ae2386fd59d?s=128&d=identicon&r=PG", "display_name": "user657267", "link": "https://stackoverflow.com/users/657267/user657267"}, "edited": false, "score": 3, "creation_date": 1495656149, "post_id": 44167230, "comment_id": 75351097, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/2382764/escaping-in-makefile\">Escaping in makefile</a>"}, {"owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "edited": false, "score": 0, "creation_date": 1495656742, "post_id": 44167230, "comment_id": 75351424, "body": "FWIW: Godo is a super useful replacement for make for Go projects: <a href=\"https://github.com/go-godo/godo\" rel=\"nofollow noreferrer\">github.com/go-godo/godo</a>"}], "answers": [{"comments": [{"owner": {"reputation": 86085, "user_id": 128940, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d35101b4060dc3af0d5c1b7c42c4935?s=128&d=identicon&r=PG&f=1", "display_name": "Beta", "link": "https://stackoverflow.com/users/128940/beta"}, "edited": false, "score": 2, "creation_date": 1495656899, "post_id": 44167334, "comment_id": 75351503, "body": "That&#39;s correct, but it&#39;s not secondary expansion. It&#39;s escaping the special character."}], "tags": [], "owner": {"reputation": 10244, "user_id": 797194, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3728c41e604024f375043551a59b41df?s=128&d=identicon&r=PG", "display_name": "m90", "link": "https://stackoverflow.com/users/797194/m90"}, "is_accepted": true, "score": 10, "last_activity_date": 1619006588, "last_edit_date": 1619006588, "creation_date": 1495655488, "answer_id": 44167334, "question_id": 44167230, "link": "https://stackoverflow.com/questions/44167230/why-doesnt-my-makefile-interpolate-an-expression-in-a-command/44167334#44167334", "title": "Why doesn&#39;t my Makefile interpolate an expression in a command", "body": "<p>In a Makefile recipe section you will need to escape the <code>$</code> using a second <code>$</code>:</p>\n<pre><code>test:\n    go test $$(go list ./... | grep -v /vendor/)\n\n.PHONY: test\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3460, "user_id": 2424184, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/cbac98d5b105ae3afe5d893bbf717846?s=128&d=identicon&r=PG", "display_name": "eush77", "link": "https://stackoverflow.com/users/2424184/eush77"}, "is_accepted": false, "score": 4, "last_activity_date": 1495706119, "creation_date": 1495706119, "answer_id": 44177529, "question_id": 44167230, "link": "https://stackoverflow.com/questions/44167230/why-doesnt-my-makefile-interpolate-an-expression-in-a-command/44177529#44177529", "title": "Why doesn&#39;t my Makefile interpolate an expression in a command", "body": "<p>Depending on the circumstance, it might be more useful to evaluate the command during the expansion of the recipe using <a href=\"https://www.gnu.org/software/make/manual/make.html#Shell-Function\" rel=\"noreferrer\">shell</a> function:</p>\n\n<pre><code>test:\n    go test $(shell go list ./... | grep -v /vendor/)\n\n.PHONY: test\n</code></pre>\n\n<p>This will make the package names part of the recipe, and will normally print the result of the subcommand when executed.</p>\n"}], "owner": {"reputation": 10244, "user_id": 797194, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3728c41e604024f375043551a59b41df?s=128&d=identicon&r=PG", "display_name": "m90", "link": "https://stackoverflow.com/users/797194/m90"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1395, "favorite_count": 0, "accepted_answer_id": 44167334, "answer_count": 2, "score": 6, "last_activity_date": 1619006588, "creation_date": 1495655103, "question_id": 44167230, "link": "https://stackoverflow.com/questions/44167230/why-doesnt-my-makefile-interpolate-an-expression-in-a-command", "title": "Why doesn&#39;t my Makefile interpolate an expression in a command", "body": "<p>I'm trying to write a super simple <code>Makefile</code> to run the tests in a Go project. The project's dependencies are vendored, but I want to skip these tests. When running this from the command line I simply do</p>\n\n<pre><code>$ go test $(go list ./... | grep -v /vendor/)\n</code></pre>\n\n<p>Yet, when I put this into a <code>Makefile</code> like this:</p>\n\n<pre><code>test:\n    go test $(go list ./... | grep -v /vendor/)\n\n.PHONY: test\n</code></pre>\n\n<p>the expression will not be evaluated:</p>\n\n<pre><code>$ make\ngo test \n?       github.com/m90/some-repo    [no test files]\n</code></pre>\n\n<p>How do I get make to interpolate the expression in a shell-like manner?</p>\n"}, {"tags": ["go", "type-assertion"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1495654353, "post_id": 44166566, "comment_id": 75350246, "body": "Go has no concept of inheritance - not sure what you meant by this or I&#39;d edit the answer myself."}, {"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "edited": false, "score": 0, "creation_date": 1495654702, "post_id": 44166566, "comment_id": 75350408, "body": "Thank you. It&#39;s solved my problem, but I&#39;m sad because of the extra one function/each service."}, {"owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1495656180, "post_id": 44166566, "comment_id": 75351115, "body": "@Adrian: We&#39;re splitting hairs here, but I&#39;ll rephrase so that it is pedantically correct."}, {"owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "reply_to_user": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "edited": false, "score": 0, "creation_date": 1495656573, "post_id": 44166566, "comment_id": 75351339, "body": "@PumpkinSeed: Added an update which might make your life simpler."}], "tags": [], "owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "is_accepted": true, "score": 3, "last_activity_date": 1495656350, "last_edit_date": 1495656350, "creation_date": 1495652475, "answer_id": 44166566, "question_id": 44166470, "link": "https://stackoverflow.com/questions/44166470/type-assertion-panic/44166566#44166566", "title": "Type-assertion panic", "body": "<p>When you return a <code>BaseInterface</code> from a function, the type of the reference is actually <code>BaseInterface</code> and not <code>SetupService</code>. It is true that <code>SetupService</code> does satisfy <code>BaseInterface</code>, but that type information is lost when you cast.</p>\n\n<p>What you could do is this:</p>\n\n<pre><code>func (s SetupService) Set() SetupService {\n  s.BaseService.Set()\n  return s\n}\n</code></pre>\n\n<p>One thing to note though is that you're not using pointers, so each method call copies the object and state mutations are not preserved. You might want to replace these:</p>\n\n<pre><code>func (s SetupService) ...\n</code></pre>\n\n<p>With these:</p>\n\n<pre><code>func (s *SetupService) ...\n</code></pre>\n\n<p><strong>Update</strong>: Why not just avoid returning the result of Set here?</p>\n\n<pre><code>s := SetupService{}\ns.Set(...)\nreturn s\n</code></pre>\n"}], "owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 228, "favorite_count": 0, "accepted_answer_id": 44166566, "answer_count": 1, "score": 0, "last_activity_date": 1495656350, "creation_date": 1495652119, "question_id": 44166470, "link": "https://stackoverflow.com/questions/44166470/type-assertion-panic", "title": "Type-assertion panic", "body": "<p>I would like to apply Dependency injection on my code so I create every part of it as a service.</p>\n\n<pre><code>type BaseService struct {\n    Config config.Container\n    SQL    *gorm.DB\n    Mongo  *mgo.Session\n    Logger logger.Logger\n}\n\ntype BaseInterface interface {\n    Set(c config.Container, sq *gorm.DB, m *mgo.Session, l logger.Logger) BaseInterface\n}\n\nfunc (s BaseService) Set(c config.Container, sq *gorm.DB, m *mgo.Session, l logger.Logger) BaseInterface {\n    s.Config = c\n    s.SQL = sq\n    s.Mongo = m\n    s.Logger = l\n    return s\n}\n\nfunc NewSetupService(c config.Container, s *gorm.DB, m *mgo.Session, l logger.Logger) SetupService {\n    return SetupService{}.Set(c, s, m, l).(SetupService)\n}\n...\n...\n</code></pre>\n\n<p>There is the BaseService and every service extend it as the follow: </p>\n\n<pre><code>type SetupService struct {\n    BaseService\n}\n\ntype SetupInterface interface {\n    Do()\n}\n\nfunc (s SetupService) Do() {\n    mongo := s.Mongo.Clone()\n    defer mongo.Close()\n    mongoDB := mongo.DB(s.Config.Database.Mongo.DB)\n...\n...\n</code></pre>\n\n<p>But when I call the NewSetupService function I got a panic which is not clear for me. Basically I create a SetupService{} and call the Set function of this struct, am I right? Then why I got this panic: </p>\n\n<pre><code>panic: interface conversion: api.BaseInterface is api.BaseService, not api.SetupService [recovered]\n    panic: interface conversion: api.BaseInterface is api.BaseService, not api.SetupService\n</code></pre>\n"}, {"tags": ["go", "influxdb"], "comments": [{"owner": {"reputation": 643, "user_id": 5046220, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d6703018e7d190e03c461a2ea5c162b6?s=128&d=identicon&r=PG&f=1", "display_name": "supriya", "link": "https://stackoverflow.com/users/5046220/supriya"}, "edited": false, "score": 0, "creation_date": 1495647838, "post_id": 44165226, "comment_id": 75346891, "body": "yes I looked at it but I am not able to get the output which I want :(."}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1495649747, "post_id": 44165226, "comment_id": 75348007, "body": "What do you get when you run <code>fmt.Printf(&quot;Res: %v \\nType: %T\\n&quot;, res, res)</code> ?"}, {"owner": {"reputation": 643, "user_id": 5046220, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d6703018e7d190e03c461a2ea5c162b6?s=128&d=identicon&r=PG&f=1", "display_name": "supriya", "link": "https://stackoverflow.com/users/5046220/supriya"}, "edited": false, "score": 0, "creation_date": 1495650104, "post_id": 44165226, "comment_id": 75348172, "body": "I got this-&gt; Res: [{[{ZtpBoot map[numberOfDevices:1 step:Step1.dhcpSetupTime] [time step timeTaken] [[2017-05-16T10:09:44Z Step1.dhcpSetupTime 0.560018062592] [2017-05-16\\ T10:17:14Z Step1.dhcpSetupTime 0.893213033676] [2017-05-16T10:24:44Z Step1.dhcpSetupTime 0.476826906204] [2017-05-16T10:32:17Z Step1.dhcpSetupTime 0.80868196\\ 4874] [2017-05-16T10:42:39Z Step1.dhcpSetupTime 0.484630823135] [2017-05-23T12:14:03Z totalRunTime 4\\ 19.631438017]] false}] [] }] Type: []client.Result"}, {"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1495651546, "post_id": 44165226, "comment_id": 75348900, "body": "So if you&#39;re not using <a href=\"https://github.com/influxdata/influxdb/tree/master/client\" rel=\"nofollow noreferrer\">github.com/influxdata/influxdb/tree/master/client</a> , where is the client.Result type defined?  Are you using a different influxdb sql driver?  Did you define it yourself?  Does the client.Result type have any methods that operate on it?"}, {"owner": {"reputation": 643, "user_id": 5046220, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d6703018e7d190e03c461a2ea5c162b6?s=128&d=identicon&r=PG&f=1", "display_name": "supriya", "link": "https://stackoverflow.com/users/5046220/supriya"}, "edited": false, "score": 0, "creation_date": 1495653236, "post_id": 44165226, "comment_id": 75349677, "body": "I am using &quot;github.com/influxdata/influxdb/client/v2&quot;"}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1495679805, "post_id": 44165226, "comment_id": 75358355, "body": "Documentation looks pretty straightforward <a href=\"https://godoc.org/github.com/influxdata/influxdb/client\" rel=\"nofollow noreferrer\">godoc.org/github.com/influxdata/influxdb/client</a> you have Response and Result structs"}], "answers": [{"comments": [{"owner": {"reputation": 3984, "user_id": 4121573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kxnXk.png?s=128&g=1", "display_name": "Adonis", "link": "https://stackoverflow.com/users/4121573/adonis"}, "edited": false, "score": 0, "creation_date": 1618922242, "post_id": 44169539, "comment_id": 118744895, "body": "Funny how precision is so well documented, what can I do? &quot;1e-3&quot; ? &quot;1 s&quot; ? &quot;s&quot; ? &quot;TITI&quot;? Please stop calling this documentation, it&#39;s a hastily put out webpage that pretends to be documentation. On the other hand (and I&#39;m no fan of C), <code>man 3 printf</code> is something I&#39;d call documentation"}], "tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": true, "score": 2, "last_activity_date": 1495666517, "last_edit_date": 1495666517, "creation_date": 1495665237, "answer_id": 44169539, "question_id": 44165226, "link": "https://stackoverflow.com/questions/44165226/how-to-process-result-obtained-from-querying-influxdb-database-from-go-code/44169539#44169539", "title": "How to process result obtained from querying influxdb database from go code", "body": "<p>How to parse <code>res</code> is there in the <a href=\"https://godoc.org/github.com/influxdata/influxdb/client/v2\" rel=\"nofollow noreferrer\">driver documentation</a> if you carefully examine each of the types and understand how to work with Go types well in general.</p>\n\n<p>As you showed in your comment, <code>res</code> is type <code>[]client.Result</code>, which means it's a slice of Results.  Result is defined in the documentation.  Look at each of the fields in Result, and look up each of their types.  If they don't make sense to you right off, try to read more about what the type means in Go.  Consider taking that a step further by writing and running some code that uses the type in some way -- create a literal of it and print it, or access a portion of it, for example -- until you get used to using it and have a better understanding of it.</p>\n\n<p>Look up any parts of the documentation you don't understand, such as what symbols <code>[]</code> (slice/array) and <code>*</code> (pointer) mean in Go, or how slices and maps work in Go, if you're not already sure of those things.  The <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">language specification</a> is a great resource.  If a piece of the documentation isn't making sense and you have more specific questions about it works, you can post a question to StackOverflow about it.</p>\n\n<p>I hope this example is enough to get you started.  As you can see I initialize a few variables using literals of different types, and then run the same print command you ran in your comment.  Notice that it partially fills in the structure you posted.</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n    \"github.com/influxdata/influxdb/client/v2\"\n    \"github.com/influxdata/influxdb/models\"\n)\n\nfunc main() {\n    tags := map[string]string{\n        \"numberOfDevices\":\"1\",\n        \"step\":\"Step1.dhcpSetupTime\",\n    }\n    cols := []string{\"time\", \"step\", \"timeTaken\"}\n    row := models.Row{\n        Name: \"ZtpBoot\",\n        Tags: tags,\n        Columns: cols,\n        // add Values and Partial\n    }\n    rows := []models.Row{row}\n    res := client.Result{\n        Series: rows,\n        // Add Messages and Err\n    }\n    fmt.Printf(\"Res: %v\\nType: %T\\n\", res, res)\n}\n</code></pre>\n\n<p>The output from this program is:</p>\n\n<pre><code>Res: {[{ZtpBoot map[numberOfDevices:1 step:Step1.dhcpSetupTime] [time step timeTaken] [] false}] [] }\nType: client.Result\n</code></pre>\n\n<p>I hope that's enough to get you started in the right direction.  If you work at it, and you look at what I did and read more Go documentation, you may be able to fill in the rest, and understand how to access portions of this data structure.</p>\n"}], "owner": {"reputation": 643, "user_id": 5046220, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d6703018e7d190e03c461a2ea5c162b6?s=128&d=identicon&r=PG&f=1", "display_name": "supriya", "link": "https://stackoverflow.com/users/5046220/supriya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 969, "favorite_count": 0, "accepted_answer_id": 44169539, "answer_count": 1, "score": 1, "last_activity_date": 1495666517, "creation_date": 1495647530, "question_id": 44165226, "link": "https://stackoverflow.com/questions/44165226/how-to-process-result-obtained-from-querying-influxdb-database-from-go-code", "title": "How to process result obtained from querying influxdb database from go code", "body": "<p>I am querying an inlfluxdb databse from a go code like this.</p>\n\n<pre><code>q := fmt.Sprintf(\"select step,timeTaken from ZtpBoot where cvpVersion = \n                  2017.1.1 group by step,numberOfDevices\"\nres, _ := queryDB(clnt, q)\nResult when executing query in influxdb is like:-\nname: ZtpBoot\ntags: numberOfDevices=2, step=Step3.verifyZtpViaPost\ntime                step                   timeTaken\n----                ----                   ---------\n1495540747000000000 Step3.verifyZtpViaPost 0.108520030975\n1495541643000000000 Step3.verifyZtpViaPost 0.115226984024\n\nname: ZtpBoot\ntags: numberOfDevices=2, step=Step4.verifyZtpViaHttp\ntime                step                   timeTaken\n----                ----                   ---------\n1495540747000000000 Step4.verifyZtpViaHttp 0.100101947784\n1495541643000000000 Step4.verifyZtpViaHttp 0.103901863098\n</code></pre>\n\n<p>How can I process res obtained from res, _ := queryDB(clnt, q) to display the result as shown in table.</p>\n"}, {"tags": ["logging", "go", "stdout", "stderr"], "answers": [{"comments": [{"owner": {"reputation": 154, "user_id": 4023381, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1163f54bc7aeb2478d8bdc8be4c38bd8?s=128&d=identicon&r=PG&f=1", "display_name": "Sevag", "link": "https://stackoverflow.com/users/4023381/sevag"}, "edited": false, "score": 0, "creation_date": 1495646480, "post_id": 44164244, "comment_id": 75346198, "body": "Thanks. Since the purpose of stdcap is unit testing, it&#39;s easy enough to call <code>log.SetOutput</code> within my unit test."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1495646620, "last_edit_date": 1495646620, "creation_date": 1495644296, "answer_id": 44164244, "question_id": 44164122, "link": "https://stackoverflow.com/questions/44164122/os-pipe-not-working-as-expected-with-log-package/44164244#44164244", "title": "os.Pipe not working as expected with log package", "body": "<p>The logging package <a href=\"https://golang.org/src/log/log.go#L73\" rel=\"nofollow noreferrer\">initializes the standard logger with the value <code>os.Stderr</code> at initialization time</a>.  Modifications to the variable <code>os.Stderr</code> do not change the value in the <a href=\"https://golang.org/src/log/log.go#L54\" rel=\"nofollow noreferrer\">logger field</a>.</p>\n\n<p>Call <a href=\"https://godoc.org/log#Logger.SetOutput\" rel=\"nofollow noreferrer\">log.SetOutput</a> to change the output location for the standard logger from your capture function. Unfortunately, there's not a way to get standard logger's output so you can save and restore it in your capture function.</p>\n"}], "owner": {"reputation": 154, "user_id": 4023381, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/1163f54bc7aeb2478d8bdc8be4c38bd8?s=128&d=identicon&r=PG&f=1", "display_name": "Sevag", "link": "https://stackoverflow.com/users/4023381/sevag"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 44164244, "answer_count": 1, "score": 1, "last_activity_date": 1495646620, "creation_date": 1495643946, "question_id": 44164122, "link": "https://stackoverflow.com/questions/44164122/os-pipe-not-working-as-expected-with-log-package", "title": "os.Pipe not working as expected with log package", "body": "<p>I have a piece of code which sets up an <code>os.Pipe</code> to capture Stdout/Stderr:</p>\n\n<p><a href=\"https://github.com/sevagh/stdcap/blob/master/stdcap.go\" rel=\"nofollow noreferrer\">https://github.com/sevagh/stdcap/blob/master/stdcap.go</a></p>\n\n<pre><code>// Capture executes f() and returns the captured data\nfunc (s *stdcap) Capture(f func()) string {\n    s.mu.Lock()\n    defer s.mu.Unlock()\n\n    var old, r, w *os.File\n\n    if s.out {\n        old = os.Stdout\n        r, w, _ = os.Pipe()\n        os.Stdout = w\n    } else {\n        old = os.Stderr\n        r, w, _ = os.Pipe()\n        os.Stderr = w\n    }\n\n    f()\n\n    outC := make(chan string)\n    defer close(outC)\n\n    go func() {\n        var buf bytes.Buffer\n        io.Copy(&amp;buf, r)\n        outC &lt;- buf.String()\n    }()\n\n    w.Close()\n\n    if s.out {\n        os.Stdout = old\n    } else {\n        os.Stderr = old\n    }\n\n    return &lt;-outC\n}\n</code></pre>\n\n<p>Today I tried using this code with the <code>log</code> package and it doesn't work.</p>\n\n<p>This works:</p>\n\n<pre><code>func TestOutCapture(t *testing.T) {\n    sc := StdoutCapture()\n    out := sc.Capture(func() {\n        fmt.Printf(\"Hello world!\")\n    })\n\n    if out != \"Hello world!\" {\n        t.Errorf(\"Expected \\\"Hello world!\\\", got: %s\\n\", out)\n    }\n}\n\nfunc TestErrCapture(t *testing.T) {\n    sc := StderrCapture()\n    err := sc.Capture(func() {\n        fmt.Fprintf(os.Stderr, \"Hello world!\")\n    })\n\n    if err != \"Hello world!\" {\n        t.Errorf(\"Expected \\\"Hello world!\\\", got: %s\\n\", err)\n    }\n}\n</code></pre>\n\n<p>These don't work:</p>\n\n<pre><code>func TestLogOutCapture(t *testing.T) {\n    sc := StdoutCapture()\n\n    log.SetOutput(os.Stdout)\n    out := sc.Capture(func() {\n        log.Printf(\"Hello world!\")\n    })\n\n    if out != \"Hello world!\" {\n        t.Errorf(\"Expected \\\"Hello world!\\\", got: %s\\n\", out)\n    }\n}\n\nfunc TestLogErrCapture(t *testing.T) {\n    sc := StderrCapture()\n    log.SetOutput(os.Stderr)\n\n    err := sc.Capture(func() {\n        log.Printf(\"Hello world!\")\n    })\n\n    if err != \"Hello world!\" {\n        t.Errorf(\"Expected \\\"Hello world!\\\", got: %s\\n\", err)\n    }\n}\n</code></pre>\n\n<p>Any ideas on where I can debug this? Does the Golang <code>log</code> package not use <code>os.Stdout/os.Stderr</code>?</p>\n"}, {"tags": ["go", "redigo"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1495643658, "post_id": 44163673, "comment_id": 75344580, "body": "Print the using <code>fmt.Printf(&quot;Sending: %q %v %T\\n&quot;, notification.Type, notification.Type == &quot;sms&quot;, notification.Type)</code> to determine if notification.Type contains more than the bytes &#39;s&#39;, &#39;m&#39; and &#39;s&#39;."}, {"owner": {"reputation": 1509, "user_id": 1093694, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/4hdHu.jpg?s=128&g=1", "display_name": "Lupus", "link": "https://stackoverflow.com/users/1093694/lupus"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1497962033, "post_id": 44163673, "comment_id": 76291505, "body": "@CeriseLim&#243;n Thank you very much for pointing out. It was actually a typo in the data that adds additional breakpoint at the end of the string."}], "owner": {"reputation": 1509, "user_id": 1093694, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/4hdHu.jpg?s=128&g=1", "display_name": "Lupus", "link": "https://stackoverflow.com/users/1093694/lupus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 98, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1495642544, "creation_date": 1495642544, "question_id": 44163673, "link": "https://stackoverflow.com/questions/44163673/string-and-redis-string-redigo-type-does-not-match-in-golang", "title": "string and redis.String (redigo) type does not match in golang", "body": "<p>I got stuck on this comparision:</p>\n\n<pre><code>fmt.Println(\"Sending: \", notification.Type, notification.Type == \"sms\", reflect.TypeOf(notification.Type))\n</code></pre>\n\n<p>this out puts as:</p>\n\n<pre><code>Sending: sms false string\n</code></pre>\n\n<p>This is the <code>Notification</code>type</p>\n\n<pre><code>type Notification struct {\n    Done    bool   `redis:\"done\"`\n    Message string `redis:\"message\"`\n    Type    string `redis:\"type\"`\n    ID      string `redis:\"id\"`\n    Error   error\n}\n</code></pre>\n\n<p>And this is how I create the <code>notification</code> struct</p>\n\n<pre><code>notification := &amp;Notification{ID: notificationID}\nnotification.Type, err = redis.String(c.Do(\"GET\", \"notification:id:\"+notification.ID+\":type\"))\n</code></pre>\n\n<p>My question is why <code>notification.Type == \"sms\"</code> is <code>false</code></p>\n"}, {"tags": ["templates", "go", "view", "model"], "comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 1, "creation_date": 1495646705, "post_id": 44161983, "comment_id": 75346302, "body": "You should ask only <i>one</i> question at a time. The first question was too broad and primarily opinion based anyway, so I&#39;ve removed that part. Also see <a href=\"https://stackoverflow.com/help/dont-ask\">What types of questions should I avoid asking?</a>."}], "answers": [{"tags": [], "owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "is_accepted": true, "score": 2, "last_activity_date": 1495649158, "creation_date": 1495649158, "answer_id": 44165654, "question_id": 44161983, "link": "https://stackoverflow.com/questions/44161983/how-do-you-define-view-model-in-go/44165654#44165654", "title": "How do you define view model in Go", "body": "<p>You're almost on track. Remember that Go is not an object-oriented language, so inheritance (what you're trying to do) is not a very common pattern.</p>\n\n<p>Instead what you would do is use a template, and pass the view model into the template:</p>\n\n<pre><code>view := AdminView{}\n...\ntmpl.Exec(w, view)\n</code></pre>\n"}], "owner": {"reputation": 333, "user_id": 7352226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b7f77d9d96cfe301db80eb8265331a9?s=128&d=identicon&r=PG&f=1", "display_name": "fallaway", "link": "https://stackoverflow.com/users/7352226/fallaway"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 467, "favorite_count": 0, "accepted_answer_id": 44165654, "answer_count": 1, "score": 0, "last_activity_date": 1495649158, "creation_date": 1495637687, "last_edit_date": 1495646598, "question_id": 44161983, "link": "https://stackoverflow.com/questions/44161983/how-do-you-define-view-model-in-go", "title": "How do you define view model in Go", "body": "<p>I would like to define a structure for View model, something looks like:</p>\n\n<pre><code>type AdminView struct {\n    PageTitle string\n    UserName string\n    UserType string\n    Templates []Template\n    ...\n    OtherAttr Other\n}\n</code></pre>\n\n<p>to help me organize templates and DTO better, but haven't worked very well so far. What I want to achieve is something like this:</p>\n\n<pre><code>func adminViewHandler (w http.ResponseWriter, r *http.Request) {\n    data := processRequestData (r)  // process request form data\n    view := AdminView {}\n    // then assign values to view\n    view.render(w) // similar to tmpl.Exec(w, data)\n}\n</code></pre>\n\n<p>I'd like to know if I am on the right track to introduce more abstraction in rendering the View using the approach above. I would like to know how people render complex view with complex data in real world, too.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["mysql", "go", "unicode"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1495639688, "post_id": 44160965, "comment_id": 75341915, "body": "The incorrect value is the wrapped present emoji. See <a href=\"https://stackoverflow.com/questions/7814293/how-to-insert-utf-8-mb4-characteremoji-in-ios5-in-mysql\" title=\"how to insert utf 8 mb4 characteremoji in ios5 in mysql\">stackoverflow.com/questions/7814293/&hellip;</a> for a possible solution."}, {"owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "edited": false, "score": 2, "creation_date": 1495651115, "post_id": 44160965, "comment_id": 75348690, "body": "Is the type of the <code>data</code> column <code>utf8mb4</code>?"}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 1, "creation_date": 1495658760, "post_id": 44160965, "comment_id": 75352341, "body": "That Emoji (\ud83c\udf81) requires that the column be declared <code>CHARACTER SET utf8mb4</code>."}, {"owner": {"reputation": 364, "user_id": 297468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/776cbe4c8aea34b07ac3598cd9a56521?s=128&d=identicon&r=PG", "display_name": "Daniel", "link": "https://stackoverflow.com/users/297468/daniel"}, "edited": false, "score": 0, "creation_date": 1519421159, "post_id": 44160965, "comment_id": 84919713, "body": "I&#39;m getting this even with the column in question having an encoding of <code>utf8mb4</code>. \ud83e\udd37\u200d\u2642\ufe0f"}, {"owner": {"reputation": 364, "user_id": 297468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/776cbe4c8aea34b07ac3598cd9a56521?s=128&d=identicon&r=PG", "display_name": "Daniel", "link": "https://stackoverflow.com/users/297468/daniel"}, "edited": false, "score": 0, "creation_date": 1519421983, "post_id": 44160965, "comment_id": 84920040, "body": "The solution mentioned in the earlier comment (here: <a href=\"https://stackoverflow.com/a/8109948/297468\">stackoverflow.com/a/8109948/297468</a> ) was what I needed. The connection was not set to use <code>utf8mb4_general_ci</code>."}], "owner": {"reputation": 131, "user_id": 6868777, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vZp2t.jpg?s=128&g=1", "display_name": "Julia Kovalenko", "link": "https://stackoverflow.com/users/6868777/julia-kovalenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 879, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1495636452, "creation_date": 1495635214, "question_id": 44160965, "link": "https://stackoverflow.com/questions/44160965/golang-how-to-save-strings-with-unicode", "title": "Golang: How to save strings with Unicode?", "body": "<p>I have a structure. I encode it in a json format. </p>\n\n<p>Next, I try to write this data to MySql. Table has utf8_unicode_ci.</p>\n\n<pre><code>data_json, err := json.Marshal(data)\n\ndb, err := sql.Open(\"mysql\", ...)\n\nstmt, err := db.Prepare(\"INSERT INTO my_table (data) VALUES (?)\")\n\nres, err = stmt.Exec(data_json)\n</code></pre>\n\n<p>But I have an error:</p>\n\n<pre><code>Error 1366: Incorrect string value: '\\xF0\\x9F\\x8E\\x81 \\xD0...' for column 'data' at row 1\n</code></pre>\n\n<p>How I can remove or replace this characters in the string using Golang?</p>\n"}, {"tags": ["networking", "encryption", "go", "chat", "public-key-exchange"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1495633381, "post_id": 44159811, "comment_id": 75336648, "body": "TCP is a stream oriented protocol, it doesn&#39;t have &quot;messages&quot;. You need a different protocol to frame your messages. You can simply use a length prefix, netstrings, bencode, HTTP, there are numerous options."}, {"owner": {"reputation": 61, "user_id": 5563040, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-UT72VTk_DNM/AAAAAAAAAAI/AAAAAAAAA60/IIYyLaOpZHw/photo.jpg?sz=128", "display_name": "P&#229;dne", "link": "https://stackoverflow.com/users/5563040/p%c3%a5dne"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1495633541, "post_id": 44159811, "comment_id": 75336785, "body": "@JimB Could you give me a simple example using length prefix? This is my first project using golang and I don&#39;t have much experience with networking. Thanks."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1495634135, "post_id": 44159811, "comment_id": 75337323, "body": "Aside from the framing issue, the code <code>bufio.NewReader(conn).ReadString(&#39;\\n&#39;)</code> will be a source of issues because the buffer is discarded.  Create the bufio.Reader once per connection, not once each time the app reads from the connection."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 7, "last_activity_date": 1495635670, "last_edit_date": 1495635670, "creation_date": 1495634669, "answer_id": 44160758, "question_id": 44159811, "link": "https://stackoverflow.com/questions/44159811/read-whole-message-with-bufio-newreaderconn/44160758#44160758", "title": "Read whole message with bufio.NewReader(conn)", "body": "<p>A simple option for sending binary data is to use a length prefix. Encode the data size as a 32bit big endian integer, then read that amount of data.</p>\n\n<pre><code>// create the length prefix\nprefix := make([]byte, 4)\nbinary.BigEndian.PutUint32(prefix, uint32(len(message)))\n\n// write the prefix and the data to the stream (checking errors)\n_, err := conn.Write(prefix)\n_, err = conn.Write(message)\n</code></pre>\n\n<p>And to read the message</p>\n\n<pre><code>// read the length prefix\nprefix := make([]byte, 4)\n_, err = io.ReadFull(conn, prefix)\n\n\nlength := binary.BigEndian.Uint32(prefix)\n// verify length if there are restrictions\n\nmessage = make([]byte, int(length))\n_, err = io.ReadFull(conn, message)\n</code></pre>\n\n<p>See also <a href=\"https://stackoverflow.com/questions/25766193/golang-tcp-client-server-data-delimiter/25766313#25766313\">Golang: TCP client/server data delimiter</a></p>\n\n<p>You can also of course use an existing, well test protocol, like HTTP, IRC, etc. for your messaging needs. The go std library comes with a simple <a href=\"https://golang.org/pkg/net/textproto/\" rel=\"noreferrer\"><code>textproto</code> package</a>, or you could opt to enclose the messages in a uniform encoding, like JSON.</p>\n"}], "owner": {"reputation": 61, "user_id": 5563040, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-UT72VTk_DNM/AAAAAAAAAAI/AAAAAAAAA60/IIYyLaOpZHw/photo.jpg?sz=128", "display_name": "P&#229;dne", "link": "https://stackoverflow.com/users/5563040/p%c3%a5dne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2223, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1495635670, "creation_date": 1495632517, "question_id": 44159811, "link": "https://stackoverflow.com/questions/44159811/read-whole-message-with-bufio-newreaderconn", "title": "Read whole message with bufio.NewReader(conn)", "body": "<p>I am working on a simple chat server and client in golang. I am having some trouble with reading messages from the net.Conn. So far this is what I have been doing:</p>\n\n<pre><code>bufio.NewReader(conn).ReadString('\\n')\n</code></pre>\n\n<p>Since the user presses enter to send the message I only have to read until '\\n'. But I am now working on encryption and when sending the public keys between client and server the key sometimes contains '\\n', which makes it hard to get the whole key. I am just wondering how I can read the whole message instead of stopping at a specific character. Thanks!</p>\n"}, {"tags": ["arrays", "matrix", "go", "channel", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1495628517, "post_id": 44158142, "comment_id": 75332799, "body": "Hi thanks for the answer, would it make sense for me to create a struct called matrix and use that rather than the [n][n]int every time?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1495628583, "post_id": 44158142, "comment_id": 75332843, "body": "@benjano That wouldn&#39;t change anything, the size of a struct type cannot be less than the sum of the size of all its field types."}, {"owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1495630762, "post_id": 44158142, "comment_id": 75334496, "body": "If I wanted to perform calculations on the matrices in parallel, would I want a global variable which contains a blank matrix of the same size which can then be saved to?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1495631111, "post_id": 44158142, "comment_id": 75334781, "body": "@benjano That depends on the nature of your calculations. If calculations read/write the same elements, access must be synchronized. If calculations only read the elements, no synchronization is needed, and you don&#39;t even need channels."}, {"owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1495631282, "post_id": 44158142, "comment_id": 75334917, "body": "I&#39;m generating two random matrices, I&#39;m then adding them together. Currently my program splits the matrices in half and passes the halves into two separate goroutines which are then worked on concurrently. These two halves are then passed out and reconstructed. However due to the need for the reconstruction at the end it&#39;s a lot slower than the sequential version. I want to be able to write and save to another matrix which will give the result."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1495631585, "post_id": 44158142, "comment_id": 75335177, "body": "@benjano Generating and adding 2 small matrices, you might not even see performance improvements, as synchronization and work distribution also has its overhead. Having said that, the work of generating and adding 2 matrices can be split without actually splitting the matrices, as adding matrices simply means adding the elements at the same index (an element will have no effect in the result on elements having different indices)."}, {"owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1495631814, "post_id": 44158142, "comment_id": 75335356, "body": "Hi, I&#39;m not sure if splitting was the correct word. I&#39;m limiting the area each goroutine can work within the two matrixes so each goroutine will complete the maths for one section. I&#39;m just unsure how to save to a resultMatrix which all goroutines can write too"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1495632496, "post_id": 44158142, "comment_id": 75335937, "body": "@benjano You can have a global array for that, just make sure different goroutines are not writing the same area of it."}, {"owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1495632856, "post_id": 44158142, "comment_id": 75336251, "body": "I&#39;ve added a little more to my question relating to this, any further tips you can give appreciated."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1495633603, "post_id": 44158142, "comment_id": 75336846, "body": "@benjano See edited answer how to create a global variable."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1495633560, "last_edit_date": 1495633560, "creation_date": 1495628025, "answer_id": 44158142, "question_id": 44157929, "link": "https://stackoverflow.com/questions/44157929/channel-element-type-too-large-golang/44158142#44158142", "title": "Channel Element type too large Golang", "body": "<p>The channel being buffered or not has nothing to do with this, the error is not with the space for storing elements but with the size of a single element. The size limit of the channel's element type is an implementation detail / restriction, you can't do anything about that.</p>\n\n<p>And if you try to use an element type violating this, that signals you're doing something wrong (something you shouldn't do). Whenever you send a value on a channel, the value will be copied. So sending >64KB values on a channel is not really efficient.</p>\n\n<p>Instead choose an element type which is small. The choice requiring the least change would be to use a pointer to your type: <code>*[n][n]int</code>.</p>\n\n<pre><code>a := make(chan *[n][n]int)\n</code></pre>\n\n<p>Then of course you have to send pointers on the channel, and you'll receive pointers from it, e.g.:</p>\n\n<pre><code>const n = 132\na := make(chan *[n][n]int)\n\ngo func() {\n    var v [n][n]int\n    a &lt;- &amp;v // Sending a pointer\n}()\n\nv2 := &lt;-a\nfmt.Println(v2)  // It's a pointer\nfmt.Println(*v2) // It's an array value\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/wMs7y7vJQ0\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>You should also keep in mind that since now we're sending / receiving pointers on the channel, it will point to the same array value, and thus modifying the pointed value will modify the same array whose address we sent on the channel. If this is unwanted, make a copy before sending, and send the address of the copy:</p>\n\n<pre><code>var v [n][n]int\n// Making a copy:\nv2 := v\na &lt;- &amp;v2 // Sending address of the copy\n</code></pre>\n\n<p>You should also consider working with <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"nofollow noreferrer\">slices</a> instead of <a href=\"https://golang.org/ref/spec#Array_types\" rel=\"nofollow noreferrer\">arrays</a>.</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>Declaring a global array is as easy as this:</p>\n\n<pre><code>var result [n][n]int\n</code></pre>\n\n<p>(It must be outside of other blocks, in the file scope.)</p>\n"}], "owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1010, "favorite_count": 0, "accepted_answer_id": 44158142, "answer_count": 1, "score": 3, "last_activity_date": 1495702532, "creation_date": 1495627458, "last_edit_date": 1495702532, "question_id": 44157929, "link": "https://stackoverflow.com/questions/44157929/channel-element-type-too-large-golang", "title": "Channel Element type too large Golang", "body": "<p>I'm writing a program that works with matrixes in parallel. </p>\n\n<p>My matrixes are created using a constant <code>n</code>.</p>\n\n<pre><code>const n = 10\n</code></pre>\n\n<p>The channels are created with the following code:</p>\n\n<pre><code>a := make(chan [n][n]int)\n</code></pre>\n\n<p>This works fine for anything under a value of around <code>12</code> for <code>n</code> however anything greater and the following error is given:</p>\n\n<pre><code>channel element type too large (&gt;64kB)\n</code></pre>\n\n<p>Looking at tutorials etc, and it seem buffered channels may be the way to solve this but I tried doing this with the following code and the same error was given:</p>\n\n<pre><code>a := make(chan [n][n]int, 1000)\n</code></pre>\n\n<p>Am I using buffered channels correctly or are they not the way to solve this issue? Any tips on how I can move forward with this greatly appreciated.</p>\n\n<p>EDIT: Following on from the answer given and comments I'm now trying to create a global matrix which is blank and go routines can write to.</p>\n\n<pre><code>const n int = 1024\n\nblank [n][n]int\n</code></pre>\n\n<p>I'm unsure how it could be declared globally and have attempted the above to solve this. Does it need initialising globally? Everything I seem to try gives errors.</p>\n"}, {"tags": ["angularjs", "forms", "parsing", "go", "struct"], "comments": [{"owner": {"reputation": 1157, "user_id": 5154802, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZqLky3QxN2E/AAAAAAAAAAI/AAAAAAAAAEE/MyYiHfmqVe0/photo.jpg?sz=128", "display_name": "shivendra pratap singh", "link": "https://stackoverflow.com/users/5154802/shivendra-pratap-singh"}, "edited": false, "score": 0, "creation_date": 1495629855, "post_id": 44157149, "comment_id": 75333776, "body": "This is possible because of you are not passing the extensions in structure. Eg:-   HostCode string <code>json:&quot;host_code&quot;</code> where host_code is the exact match in json or xml."}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 1425799, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/FSkRl.png?s=128&g=1", "display_name": "aosh5", "link": "https://stackoverflow.com/users/1425799/aosh5"}, "edited": false, "score": 0, "creation_date": 1495681802, "post_id": 44162724, "comment_id": 75358770, "body": "I have added more info, including form structure above"}], "tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": false, "score": 1, "last_activity_date": 1495640786, "last_edit_date": 1495640786, "creation_date": 1495639720, "answer_id": 44162724, "question_id": 44157149, "link": "https://stackoverflow.com/questions/44157149/parse-embedded-struct-form-values-in-golang/44162724#44162724", "title": "Parse embedded Struct form values in GoLang", "body": "<p>It's possible that you don't have the right struct design for your HTML form.  You might want to post your input and/or your HTML form design.</p>\n\n<p><code>gorilla/schema</code>'s <code>decode</code> expects the values input to be passed as a variable of type <code>map[string][]string</code>, as you can see both from <a href=\"http://www.gorillatoolkit.org/pkg/schema\" rel=\"nofollow noreferrer\">the example in the documentation</a> and from the test files in the package.  Here's a simple complete script that just wraps the example from the documentation and prints the result:</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n    \"github.com/gorilla/schema\"\n)\n\ntype Person struct {\n    Name  string\n    Phone string\n}\n\nfunc main() {\n    values := map[string][]string{\n        \"Name\":  {\"John\"},\n        \"Phone\": {\"999-999-999\"},\n    }\n    person := new(Person)\n    decoder := schema.NewDecoder()\n    decoder.Decode(person, values)\n    fmt.Printf(\"Person: %v\\n\", person)\n}\n</code></pre>\n\n<p>That outputs <code>Person: &amp;{John 999-999-999}</code>.</p>\n\n<p>That is the correct form for a map literal of type <code>map[string][]string</code>, as you can demonstrate by performing a declaration followed by an assignment and running it without error:</p>\n\n<pre><code>var values map[string][]string\nvalues = map[string][]string{\n    \"Name\":  {\"John\"},\n    \"Phone\": {\"999-999-999\"},\n}\n</code></pre>\n\n<p>Now <code>map[string][]string</code> doesn't obviously support all the types that gorilla/schema supports, such as the type in your question: slices of structs.  But the HTML form is processed such that a translation makes sense: it keeps appending indices and field names with dot separators to create the desired structure.  So for the types you posted in your question, I wrote this script to decode values into the structs:</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n    \"github.com/gorilla/schema\"\n)\n\ntype Struct1 struct {\n  Value         string\n  Items         []Struct2\n}\n\ntype Struct2 struct {\n  Value         string\n}\n\nfunc main() {\n    values := map[string][]string{\n        \"Value\": {\"the thing with the items\"},\n        \"Items.0.Value\": {\"a\"},\n        \"Items.1.Value\": {\"b\"},\n        \"Items.2.Value\": {\"c\"},\n    }\n    s1 := new(Struct1)\n    decoder := schema.NewDecoder()\n    decoder.Decode(s1, values)\n    fmt.Printf(\"S1: %v\\n\", s1)\n}\n</code></pre>\n\n<p>Running that outputs:</p>\n\n<pre><code>S1: &amp;{the thing with the items [{a} {b} {c}]}\n</code></pre>\n\n<p>That demonstrates that decode can populate your struct design without error, if its input matches that design.</p>\n\n<p>So you might try to verify that your input matches that scheme -- that it has those array-like indices and field names with the dot separator in a way that conforms to your struct design.  And if it does not, that indicates that your struct design needs to be updated to fit the format of your input.</p>\n\n<p>You can see examples of decode working on this type of structure in <a href=\"https://github.com/gorilla/schema/blob/master/decoder_test.go\" rel=\"nofollow noreferrer\">the decode_test.go file in the gorilla/schema package</a>, such as these lines:</p>\n\n<pre><code>type Foo struct {\n    F01 int\n    F02 Bar\n    Bif []Baz\n}\n\ntype Bar struct {\n    F01 string\n    F02 string\n    F03 string\n    F14 string\n    S05 string\n    Str string\n}\n\ntype Baz struct {\n    F99 []string\n}\n\nfunc TestSimpleExample(t *testing.T) {\n    data := map[string][]string{\n        \"F01\":       {\"1\"},\n        \"F02.F01\":   {\"S1\"},\n        \"F02.F02\":   {\"S2\"},\n        \"F02.F03\":   {\"S3\"},\n        \"F02.F14\":   {\"S4\"},\n        \"F02.S05\":   {\"S5\"},\n        \"F02.Str\":   {\"Str\"},\n        \"Bif.0.F99\": {\"A\", \"B\", \"C\"},\n}\n</code></pre>\n\n<p>The <code>Foo</code> struct has a field named <code>Bif</code> of type <code>[]Baz</code>.  <code>Baz</code> is a struct -- so we have a slice of structs type, like in your question.  <code>Baz</code> has a field named <code>F99</code>.  You can see that the input is referenced with the string value <code>\"Bif.0.F99\"</code>.</p>\n\n<p>Use this and other examples in the test file as your guide.</p>\n"}], "owner": {"reputation": 57, "user_id": 1425799, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/FSkRl.png?s=128&g=1", "display_name": "aosh5", "link": "https://stackoverflow.com/users/1425799/aosh5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 765, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1495676651, "creation_date": 1495625507, "last_edit_date": 1495676651, "question_id": 44157149, "link": "https://stackoverflow.com/questions/44157149/parse-embedded-struct-form-values-in-golang", "title": "Parse embedded Struct form values in GoLang", "body": "<p>I have a struct that includes an array of another struct, eg</p>\n\n<pre><code>type Struct1 struct {\n  Value         string\n  Items         []Struct2\n}\ntype Struct2 struct {\n  Value         string\n}\n</code></pre>\n\n<p>I am using gorilla schema to decode my Form values into Struct 1.\nThe values for the embedded struct, Struct 2, are not coming through.</p>\n\n<p>When I look at the logs for the FormValue(\"Struct2\") it returns '[Object object], [Object object]'</p>\n\n<p>Any help would be greatly appreciated</p>\n\n<p><strong>EDIT</strong>\nAn example of the structure of the form,</p>\n\n<p>Using AngularJS,</p>\n\n<pre><code>var data = $scope.struct1;\n$http({\n      method: 'POST',\n        url:url, \n        data : data, \n        headers : {'Content-Type': 'application/x-www-form-urlencoded'},\n        transformRequest: function(obj) {\n        var str = [];\n        for(var p in obj)\n        str.push(encodeURIComponent(p) + \"=\" + encodeURIComponent(obj[p]));\n        return str.join(\"&amp;\");\n    }\n\n    })\n    .then(function successCallback(response) { \n        console.log(response);                       \n    }, function errorCallback(response) {\n\n    });\n</code></pre>\n"}, {"tags": ["mongodb", "go", "aggregation-framework", "mgo"], "comments": [{"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1495621921, "post_id": 44155465, "comment_id": 75328093, "body": "That seems to be right. What about <code>[]interface{}{&quot;$news_count&quot;, 0}</code> just for kicks? Failing that, can you show in the context of your entire pipeline reproduction. More to the point are you sure the <code>$unwind</code> is doing the correct thing?"}, {"owner": {"reputation": 1624, "user_id": 1259524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fac95f223f8faa8147d7d5daf318747?s=128&d=identicon&r=PG", "display_name": "GreyHands", "link": "https://stackoverflow.com/users/1259524/greyhands"}, "reply_to_user": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1495622069, "post_id": 44155465, "comment_id": 75328213, "body": "Same result, I had already tried that. I added $unwind cause the results without would be <code>{ &quot;_id&quot; : ObjectId(&quot;5924001e8d84961b7f34b111&quot;), &quot;username&quot; : &quot;xyz&quot;, &quot;distance&quot; : 123, &quot;news_count&quot; : [ { &quot;count&quot; : 14 } ] } { &quot;_id&quot; : ObjectId(&quot;5924001d8d84961b7f34b104&quot;), &quot;username&quot; : &quot;abc&quot;, &quot;distance&quot; : 123, &quot;news_count&quot; : [ ] }</code> And I would like to have a single field rather that an array."}, {"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1495622807, "post_id": 44155465, "comment_id": 75328699, "body": "Doh. Glad you edited the comment. Now the problem is clear. Is there only every 1 result as the result of the <code>$lookup</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1495623366, "post_id": 44155465, "comment_id": 75329046, "body": "I just checked, it works for me. You must show all your code, the error is somewhere else."}, {"owner": {"reputation": 1624, "user_id": 1259524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fac95f223f8faa8147d7d5daf318747?s=128&d=identicon&r=PG", "display_name": "GreyHands", "link": "https://stackoverflow.com/users/1259524/greyhands"}, "reply_to_user": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1495623701, "post_id": 44155465, "comment_id": 75329291, "body": "@NeilLunn I&#39;m sorry but my English is failing me I guess, I don&#39;t understand your question..."}, {"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1495624306, "post_id": 44155465, "comment_id": 75329652, "body": "Will it always be <code>news_count&quot; : [ { &quot;count&quot; : 14 } ]</code> or <code>news_count&quot; : [ ]</code> But <b>never</b> <code>news_count&quot; : [ { &quot;count&quot; : 14 }, { &quot;count&quot;: 12 } ]</code>? So &quot;users&quot; to &quot;newcounter&quot; collections relationship is <code>1:1</code> and not <code>1:many</code>"}, {"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 1, "creation_date": 1495624984, "post_id": 44155465, "comment_id": 75330121, "body": "Point is you should be able to use <code>$arrayElemAt</code> instead of doing <code>$unwind</code>. I still think you should try the pipeline simply dropping the last <code>$project</code> stage and see what happens. I&#39;m thinking if you are showing output up to <code>$unwind</code> that is okay, then that stage is the issue. And if the code is running through the shell just fine, then your Go code is the issue. I think you should post that code. So the full pipeline listing."}, {"owner": {"reputation": 1624, "user_id": 1259524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fac95f223f8faa8147d7d5daf318747?s=128&d=identicon&r=PG", "display_name": "GreyHands", "link": "https://stackoverflow.com/users/1259524/greyhands"}, "edited": false, "score": 0, "creation_date": 1495627543, "post_id": 44155465, "comment_id": 75332029, "body": "Yes, it&#39;s a <code>1:1</code> relationship, basically what I&#39;m trying to do is to use the aggregation to avoid the need to query the &#39;newscounter&#39; collection for each user returned by the geospatial query. I&#39;ll edit the question with the relevant Go code in a bit."}, {"owner": {"reputation": 1624, "user_id": 1259524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fac95f223f8faa8147d7d5daf318747?s=128&d=identicon&r=PG", "display_name": "GreyHands", "link": "https://stackoverflow.com/users/1259524/greyhands"}, "edited": false, "score": 0, "creation_date": 1495631065, "post_id": 44155465, "comment_id": 75334738, "body": "I found the issue... The <code>struct</code> I was using had the wrong type for the <code>news_count</code> field. Spent a couple of hours trying to rewrite the pipeline before asking here, and then it was a silly mistake. For the sake of completeness I have added the Go code to the question. Sorry for wasting your time, and thank you."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1495627190, "last_edit_date": 1495627190, "creation_date": 1495622871, "answer_id": 44156156, "question_id": 44155465, "link": "https://stackoverflow.com/questions/44155465/mongodb-ifnull-conditional-with-mgo/44156156#44156156", "title": "MongoDB $ifNull conditional with mgo", "body": "<p>Your <code>news_count</code> projection works, the error is somewhere else in the code which you haven't posted.</p>\n\n<p>See this full, working example:</p>\n\n<pre><code>cu := sess.DB(\"\").C(\"users\")\ncnc := sess.DB(\"\").C(\"newscounter\")\n\nhe := func(err error) {\n    if err != nil {\n        panic(err)\n    }\n}\n\nhe(cu.Insert(\n    bson.M{\n        \"_id\":      bson.ObjectIdHex(\"592400188d84961b7f34b0ce\"),\n        \"username\": \"randomuser1\",\n        \"location\": bson.M{\n            \"type\":        \"Point\",\n            \"coordinates\": []interface{}{-17.634135, 65.705665},\n        },\n    },\n    bson.M{\n        \"_id\":      bson.ObjectIdHex(\"592400188d84961b7f34b0cd\"),\n        \"username\": \"randomuser2\",\n        \"location\": bson.M{\n            \"type\":        \"Point\",\n            \"coordinates\": []interface{}{-17.282573, 63.755657},\n        },\n    },\n))\nhe(cnc.Insert(\n    bson.M{\n        \"_id\":   bson.ObjectIdHex(\"592400188d84961b7f34b0cd\"),\n        \"count\": 14,\n    },\n))\n\npipe := cu.Pipe([]bson.M{\n    {\n        \"$geoNear\": bson.M{\n            \"near\": bson.M{\n                \"type\":        \"Point\",\n                \"coordinates\": []interface{}{-21.861198, 64.120877},\n            },\n            \"distanceField\": \"distance\",\n            \"maxDistance\":   123456789,\n            \"spherical\":     true,\n        },\n    },\n    {\n        \"$sort\": bson.M{\"distance\": 1},\n    },\n    {\n        \"$lookup\": bson.M{\n            \"from\":         \"newscounter\",\n            \"localField\":   \"_id\",\n            \"foreignField\": \"_id\",\n            \"as\":           \"news_count\",\n        },\n    },\n    {\n        \"$unwind\": bson.M{\n            \"path\": \"$news_count\",\n            \"preserveNullAndEmptyArrays\": true,\n        },\n    },\n    {\n        \"$project\": bson.M{\n            \"id\":       1,\n            \"username\": 1,\n            \"distance\": 1,\n            \"news_count\": bson.M{\n                \"$ifNull\": []interface{}{\"$news_count.count\", 0},\n            },\n        },\n    },\n})\n\nit := pipe.Iter()\n\nfmt.Println()\nm := bson.M{}\nfor it.Next(&amp;m) {\n    fmt.Println(m)\n    fmt.Println()\n}\nhe(it.Err())\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>map[_id:ObjectIdHex(\"592400188d84961b7f34b0cd\") username:randomuser2 distance:227534.08191011765 news_count:14]\n\nmap[username:randomuser1 distance:266222.98643136176 news_count:0 _id:ObjectIdHex(\"592400188d84961b7f34b0ce\")]\n</code></pre>\n"}], "owner": {"reputation": 1624, "user_id": 1259524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fac95f223f8faa8147d7d5daf318747?s=128&d=identicon&r=PG", "display_name": "GreyHands", "link": "https://stackoverflow.com/users/1259524/greyhands"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1830, "favorite_count": 0, "accepted_answer_id": 44156156, "answer_count": 1, "score": 2, "last_activity_date": 1495631044, "creation_date": 1495620933, "last_edit_date": 1495631044, "question_id": 44155465, "link": "https://stackoverflow.com/questions/44155465/mongodb-ifnull-conditional-with-mgo", "title": "MongoDB $ifNull conditional with mgo", "body": "<p>I'm struggling porting a query from the mongo console to my Go code.\nI'm new to MongoDB so there might be additional mistakes I haven't taken into account.</p>\n\n<p>Sample data 'users' collection:</p>\n\n<pre><code>{ \"_id\" : ObjectId(\"592400188d84961b7f34b0cd\"), \"username\" : \"randomUser2\", \"location\" : { \"type\" : \"Point\", \"coordinates\" : [ -17.282573, 63.755657 ] } }\n{ \"_id\" : ObjectId(\"592400188d84961b7f34b0ce\"), \"username\" : \"randomUser1\", \"location\" : { \"type\" : \"Point\", \"coordinates\" : [ -17.634135, 65.705665 ] } }\n</code></pre>\n\n<p>Sample data 'newscounter' collection:</p>\n\n<pre><code>{ \"_id\" : ObjectId(\"592400188d84961b7f34b0cd\"), \"count\" : 14 }\n</code></pre>\n\n<p>The query in mongo looks like this:</p>\n\n<pre><code>db.users.aggregate([\n     { $geoNear: { \n         near: { type: \"Point\", coordinates: [-21.861198,64.120877] },\n         distanceField: \"distance\",\n         maxDistance: myDistance * 1000,\n         spherical: true }\n     },\n    {\n        $sort: { \"distance\": 1 }\n    },\n    {\n     $lookup: {\n        from: \"newscounter\",\n        localField: \"_id\",\n        foreignField: \"_id\",\n        as: \"news_count\" }\n    },\n    {\n        $unwind: { path: \"$news_count\", preserveNullAndEmptyArrays: true }\n    },\n    {\n        $project : { \n            \"id\": 1,\n            \"username\": 1,\n            \"distance\": 1,\n            \"news_count\": { $ifNull : [\"$news_count.count\", 0] }\n        }\n    }\n])\n</code></pre>\n\n<p>The output is (I used random values for the calculated distance field here):</p>\n\n<pre><code>{ \"_id\" : ObjectId(\"592400188d84961b7f34b0cd\"), \"username\" : \"randomUser2\", \"distance\" : 123, \"news_count\" : 14 }\n{ \"_id\" : ObjectId(\"592400188d84961b7f34b0ce\"), \"username\" : \"randomUser1\", \"distance\" : 456, \"news_count\" : 0 }\n</code></pre>\n\n<p>The part I've trouble with is the $ifNull in the $project stage.</p>\n\n<p>How do I build the $ifNull line in Go using the mgo package?</p>\n\n<p>I tried with:</p>\n\n<pre><code>\"news_count\": bson.M{\n    \"$ifNull\": [2]interface{}{\"$news_count.count\", 0},\n}\n</code></pre>\n\n<p>but it returns always an empty string for the news_count field.</p>\n\n<p>Any help is greatly appreciated!</p>\n\n<p>EDIT [solved]:</p>\n\n<p>The issue was silly, I had the wrong <code>type</code> for the <code>news_count</code> field in the Go <code>struct</code>.</p>\n\n<p>For the sake of completeness the pipeline in Go is:</p>\n\n<pre><code>p := []bson.M{\n        bson.M{\n            \"$geoNear\": bson.M{\n                \"near\":          bson.M{\"type\": \"Point\", \"coordinates\": center},\n                \"distanceField\": \"distance\",\n                \"maxDistance\":   maxDistance,\n                \"spherical\":     true,\n            },\n        },\n        bson.M{\n            \"$sort\": bson.M{\n                \"distance\": 1,\n            },\n        },\n        bson.M{\n            \"$lookup\": bson.M{\n                \"from\":         \"newscount\",\n                \"localField\":   \"_id\",\n                \"foreignField\": \"_id\",\n                \"as\":           \"news_count\",\n            },\n        },\n        bson.M{\n            \"$unwind\": bson.M{\n                \"path\": \"$news_count\",\n                \"preserveNullAndEmptyArrays\": true,\n            },\n        },\n        bson.M{\n            \"$project\": bson.M{\n                \"_id\":      1,\n                \"username\": 1,\n                \"distance\": 1,\n                \"news_count\": bson.M{\n                    \"$ifNull\": []interface{}{\"$news_count.count\", 0.0},\n                },\n            },\n        },\n    }\n</code></pre>\n\n<p>The result <code>struct</code>:</p>\n\n<pre><code>type Result struct {\n          ID        bson.ObjectId  `json:\"id\" bson:\"_id\"`\n          Username  string         `json:\"username\" bson:\"username\"`\n          Distance  int64          `json:\"distance\" bson:\"distance\"`\n          NewsCount int64          `json:\"news_count\" bson:\"news_count\"`\n      }\n</code></pre>\n"}, {"tags": ["go", "concurrency", "append", "slice", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 32, "last_activity_date": 1580127036, "last_edit_date": 1580127036, "creation_date": 1495614740, "answer_id": 44153078, "question_id": 44152988, "link": "https://stackoverflow.com/questions/44152988/append-not-thread-safe/44153078#44153078", "title": "Append not thread-safe?", "body": "<p>In Go no value is safe for concurrent read/write, slices (which are <a href=\"https://golang.org/pkg/reflect/#SliceHeader\" rel=\"noreferrer\">slice headers</a>) are no exception.</p>\n\n<p>Yes, your code has data races. Run with the <code>-race</code> option to verify.</p>\n\n<p>Example:</p>\n\n<pre><code>type myClass struct {\n    AttributeName string\n}\nsourceSlice := make([]myClass, 100)\n\ndestSlice := make([]myClass, 0)\n\nvar wg sync.WaitGroup\nfor _, myObject := range sourceSlice {\n    wg.Add(1)\n    go func(closureMyObject myClass) {\n        defer wg.Done()\n        var tmpObj myClass\n        tmpObj.AttributeName = closureMyObject.AttributeName\n        destSlice = append(destSlice, tmpObj)\n    }(myObject)\n}\nwg.Wait()\n</code></pre>\n\n<p>Running it with</p>\n\n<pre><code>go run -race play.go\n</code></pre>\n\n<p>Output is:</p>\n\n<pre><code>==================\nWARNING: DATA RACE\nRead at 0x00c420074000 by goroutine 6:\n  main.main.func1()\n      /home/icza/gows/src/play/play.go:20 +0x69\n\nPrevious write at 0x00c420074000 by goroutine 5:\n  main.main.func1()\n      /home/icza/gows/src/play/play.go:20 +0x106\n\nGoroutine 6 (running) created at:\n  main.main()\n      /home/icza/gows/src/play/play.go:21 +0x1cb\n\nGoroutine 5 (running) created at:\n  main.main()\n      /home/icza/gows/src/play/play.go:21 +0x1cb\n==================\n==================\nWARNING: DATA RACE\nRead at 0x00c42007e000 by goroutine 6:\n  runtime.growslice()\n      /usr/local/go/src/runtime/slice.go:82 +0x0\n  main.main.func1()\n      /home/icza/gows/src/play/play.go:20 +0x1a7\n\nPrevious write at 0x00c42007e000 by goroutine 5:\n  main.main.func1()\n      /home/icza/gows/src/play/play.go:20 +0xc4\n\nGoroutine 6 (running) created at:\n  main.main()\n      /home/icza/gows/src/play/play.go:21 +0x1cb\n\nGoroutine 5 (running) created at:\n  main.main()\n      /home/icza/gows/src/play/play.go:21 +0x1cb\n==================\n==================\nWARNING: DATA RACE\nWrite at 0x00c420098120 by goroutine 80:\n  main.main.func1()\n      /home/icza/gows/src/play/play.go:20 +0xc4\n\nPrevious write at 0x00c420098120 by goroutine 70:\n  main.main.func1()\n      /home/icza/gows/src/play/play.go:20 +0xc4\n\nGoroutine 80 (running) created at:\n  main.main()\n      /home/icza/gows/src/play/play.go:21 +0x1cb\n\nGoroutine 70 (running) created at:\n  main.main()\n      /home/icza/gows/src/play/play.go:21 +0x1cb\n==================\nFound 3 data race(s)\nexit status 66\n</code></pre>\n\n<p>Solution is simple, use a <a href=\"https://golang.org/pkg/sync/#Mutex\" rel=\"noreferrer\"><code>sync.Mutex</code></a> to protect writing the <code>destSlice</code> value:</p>\n\n<pre><code>var (\n    mu        = &amp;sync.Mutex{}\n    destSlice = make([]myClass, 0)\n)\n\nvar wg sync.WaitGroup\nfor _, myObject := range sourceSlice {\n    wg.Add(1)\n    go func(closureMyObject myClass) {\n        defer wg.Done()\n        var tmpObj myClass\n        tmpObj.AttributeName = closureMyObject.AttributeName\n        mu.Lock()\n        destSlice = append(destSlice, tmpObj)\n        mu.Unlock()\n    }(myObject)\n}\nwg.Wait()\n</code></pre>\n\n<p>You could also solve it in other ways, e.g. you could use a channel on which you'd send the value to be appended, and have a designated goroutine receiving from this channel and do the append.</p>\n"}, {"comments": [{"owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "edited": false, "score": 1, "creation_date": 1531492010, "post_id": 51307453, "comment_id": 89629986, "body": "Thanks! I&#39;ll look into it!"}], "tags": [], "owner": {"reputation": 409, "user_id": 3661748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc0e02aa0793fbb31142e13e2bfb5fc9?s=128&d=identicon&r=PG&f=1", "display_name": "cody.tv.weber", "link": "https://stackoverflow.com/users/3661748/cody-tv-weber"}, "is_accepted": false, "score": 4, "last_activity_date": 1531403554, "creation_date": 1531403554, "answer_id": 51307453, "question_id": 44152988, "link": "https://stackoverflow.com/questions/44152988/append-not-thread-safe/51307453#51307453", "title": "Append not thread-safe?", "body": "<p>To give a more recent solution to this problem, it looks like Go has released a new map for sync purposes:</p>\n\n<p><a href=\"https://godoc.org/golang.org/x/sync/syncmap\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/sync/syncmap</a></p>\n"}, {"comments": [{"owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "edited": false, "score": 0, "creation_date": 1587742983, "post_id": 61388328, "comment_id": 108638198, "body": "Indeed, this is a handy solution for when you know the size of your collections beforehand! Many thanks for sharing!"}], "tags": [], "owner": {"reputation": 390, "user_id": 1160581, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/854e6d1e630687b11b544d0355e7c970?s=128&d=identicon&r=PG", "display_name": "Mirian", "link": "https://stackoverflow.com/users/1160581/mirian"}, "is_accepted": false, "score": 6, "last_activity_date": 1587648195, "creation_date": 1587648195, "answer_id": 61388328, "question_id": 44152988, "link": "https://stackoverflow.com/questions/44152988/append-not-thread-safe/61388328#61388328", "title": "Append not thread-safe?", "body": "<p>It's quite an old question but there is another small improvement that helps to get rid of mutex. You can use index to add to array. Each go routine will use it's own index. In this case synchronization is not necessary. </p>\n\n<pre><code>destSlice := make([]myClass, len(sourceSlice))\n\nvar wg sync.WaitGroup\nfor i, myObject := range sourceSlice {\n    wg.Add(1)\n    go func(idx int, closureMyObject myClass) {\n        defer wg.Done()\n        var tmpObj myClass\n        tmpObj.AttributeName = closureMyObject.AttributeName\n\n        destSlice[idx] = tmpObj\n     }(i, myObject)\n}\nwg.Wait()\n</code></pre>\n"}], "owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16196, "favorite_count": 2, "accepted_answer_id": 44153078, "answer_count": 3, "score": 16, "last_activity_date": 1587648195, "creation_date": 1495614463, "last_edit_date": 1495615637, "question_id": 44152988, "link": "https://stackoverflow.com/questions/44152988/append-not-thread-safe", "title": "Append not thread-safe?", "body": "<p>I noticed that if I tried appending to a slice using goroutines inside a <code>for</code> loop, there would be instances where I would get missing/blank data:</p>\n\n<pre><code>destSlice := make([]myClass, 0)\n\nvar wg sync.WaitGroup\nfor _, myObject := range sourceSlice {\n    wg.Add(1)\n    go func(closureMyObject myClass) {\n        defer wg.Done()\n        var tmpObj myClass\n        tmpObj.AttributeName = closureMyObject.AttributeName\n        destSlice = append(destSlice, tmpObj)\n    }(myObject)\n}\nwg.Wait()\n</code></pre>\n\n<p>Sometimes, when I print all <code>AttributeName</code>s from <code>destSlice</code>, some elements are empty strings (<code>\"\"</code>), and other times, some elements from <code>sourceSlice</code> are not present in <code>destSlice</code>.</p>\n\n<p>Does my code have a data race, and does this mean that <code>append</code> is not thread-safe for concurrent use by multiple goroutines?</p>\n"}, {"tags": ["git", "go", "import"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1495615378, "post_id": 44152974, "comment_id": 75323415, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/34922929/how-can-i-specify-ports-using-go-remote-import-paths\">How can I specify ports using Go remote import paths?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1276, "user_id": 6237232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/557d1078fe8ace9c1e6f88d275f5f32a?s=128&d=identicon&r=PG&f=1", "display_name": "RidgeA", "link": "https://stackoverflow.com/users/6237232/ridgea"}, "edited": false, "score": 1, "creation_date": 1495637533, "post_id": 44154101, "comment_id": 75340179, "body": "Yes, it helps, but I don&#39;t think this is a good solution. My project could be have another dependencies from internal repository (currently not), and I will have load it manualy, using &quot;git clone&quot;"}], "tags": [], "owner": {"reputation": 1468, "user_id": 2931765, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/eiU4j.jpg?s=128&g=1", "display_name": "Arun G", "link": "https://stackoverflow.com/users/2931765/arun-g"}, "is_accepted": true, "score": 2, "last_activity_date": 1495617442, "creation_date": 1495617442, "answer_id": 44154101, "question_id": 44152974, "link": "https://stackoverflow.com/questions/44152974/import-path-with-colons-in-golang/44154101#44154101", "title": "Import path with colons in Golang", "body": "<p>As the suggestion in comment,</p>\n\n<p>do</p>\n\n<pre><code>git clone git.local.com:1234/my_project/notMainPackage\n</code></pre>\n\n<p>so the git project loads on to your gopath and</p>\n\n<p>just use it like below,</p>\n\n<pre><code>// my_project/main.go\npackage main\n\nimport (\n    \"my_project/notMainPackage\"\n)\n\nfunc main() {\n    //....\n}\n</code></pre>\n\n<p>Hope this helps!!</p>\n"}], "owner": {"reputation": 1276, "user_id": 6237232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/557d1078fe8ace9c1e6f88d275f5f32a?s=128&d=identicon&r=PG&f=1", "display_name": "RidgeA", "link": "https://stackoverflow.com/users/6237232/ridgea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 343, "favorite_count": 0, "accepted_answer_id": 44154101, "answer_count": 1, "score": 1, "last_activity_date": 1495617442, "creation_date": 1495614421, "question_id": 44152974, "link": "https://stackoverflow.com/questions/44152974/import-path-with-colons-in-golang", "title": "Import path with colons in Golang", "body": "<p>I have local private repository (gitlab) with hostname <a href=\"https://git.local.com:1234/\" rel=\"nofollow noreferrer\">https://git.local.com:1234/</a></p>\n\n<p>Also I have several packages in my golang project</p>\n\n<p>Project structure looks like:</p>\n\n<pre><code>// my_project/main.go\npackage main\n\nimport (\n    \"git.local.com:1234/my_project/notMainPackage\"\n)\n\nfunc main() {\n    //....\n}\n\n// my_project/notMainPackage/notMainPackage.go\npackage notMainPackage\n\nfunc SomeFunc() {\n\n}\n</code></pre>\n\n<p>The problem is that I should use colons in my import path to be able run <code>go get</code> and <code>go build</code> comands, but, when import path contains colon, I get error </p>\n\n<p><code>invalid import path: \"git.local.com:1234/my_project/notMainPackage\"</code></p>\n\n<p>I can't change host of gitlab sever.</p>\n\n<p>How can i solve this problem?</p>\n"}, {"tags": ["go", "dockerfile"], "comments": [{"owner": {"reputation": 1510, "user_id": 2373000, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/d5753013143cad758862c5e91459bb7b?s=128&d=identicon&r=PG", "display_name": "zuluk", "link": "https://stackoverflow.com/users/2373000/zuluk"}, "edited": false, "score": 0, "creation_date": 1495608870, "post_id": 44150858, "comment_id": 75318962, "body": "Please paste your code to your question."}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 6103729, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/829073687198218/picture?type=large", "display_name": "Utkarsh Mani Tripathi", "link": "https://stackoverflow.com/users/6103729/utkarsh-mani-tripathi"}, "edited": false, "score": 0, "creation_date": 1495613377, "post_id": 44151551, "comment_id": 75322065, "body": "Thanks,it worked but can you specify why <code>docker run -it myapp http:&#47;&#47;www.com</code>shows: Error response from daemon: oci runtime error: container_linux.go:247: starting container process caused &quot;exec: \\&quot;go run\\&quot;: executable file not found in $PATH&quot;."}], "tags": [], "owner": {"reputation": 3158, "user_id": 7925197, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M21lU.png?s=128&g=1", "display_name": "papey", "link": "https://stackoverflow.com/users/7925197/papey"}, "is_accepted": false, "score": 1, "last_activity_date": 1495633812, "last_edit_date": 1495633812, "creation_date": 1495610371, "answer_id": 44151551, "question_id": 44150858, "link": "https://stackoverflow.com/questions/44150858/how-to-take-arguments-at-run-time-in-docker/44151551#44151551", "title": "How to take arguments at run time in docker?", "body": "<p>Specify the full command with all args like : </p>\n\n<pre><code>docker run myimage:latest go run fetchSource.go arg1 arg2 arg3\n</code></pre>\n\n<p>Edit : </p>\n\n<p>When you specify something at the end of you docker run command, you're overwriting the \"Entrypoint\" or \"Cmd\" section of you Dockerfile. You have to specify the full command.</p>\n"}, {"tags": [], "owner": {"reputation": 113, "user_id": 6103729, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/829073687198218/picture?type=large", "display_name": "Utkarsh Mani Tripathi", "link": "https://stackoverflow.com/users/6103729/utkarsh-mani-tripathi"}, "is_accepted": true, "score": 0, "last_activity_date": 1495711190, "creation_date": 1495711190, "answer_id": 44179301, "question_id": 44150858, "link": "https://stackoverflow.com/questions/44150858/how-to-take-arguments-at-run-time-in-docker/44179301#44179301", "title": "How to take arguments at run time in docker?", "body": "<p>I have tried with the following changes in Dockerfile and it also worked.</p>\n\n<pre><code>FROM golang:1.7-alpine\n\nADD . /home\n\nWORKDIR /home\n# This builds a binary first\nRUN [\"go\", \"build\"]\n# Now you can run the executable and pass arguments at the run time.\nENTRYPOINT [\"./home\"]\n</code></pre>\n"}], "owner": {"reputation": 113, "user_id": 6103729, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/829073687198218/picture?type=large", "display_name": "Utkarsh Mani Tripathi", "link": "https://stackoverflow.com/users/6103729/utkarsh-mani-tripathi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 639, "favorite_count": 0, "accepted_answer_id": 44179301, "answer_count": 2, "score": 1, "last_activity_date": 1495711190, "creation_date": 1495608368, "last_edit_date": 1495609753, "question_id": 44150858, "link": "https://stackoverflow.com/questions/44150858/how-to-take-arguments-at-run-time-in-docker", "title": "How to take arguments at run time in docker?", "body": "<p>I am very new to docker and i don't know how to take arguments at run time.My code looks like this:</p>\n\n<pre><code>package main\n\nimport (\n\"fmt\"\n//\"flag\"\n\"os\"\n\"net/http\"\n\"io/ioutil\"\n\"reflect\"\n)\n\nfunc main() {\n\nvar args string\n//  flag.Parse()      \n//   args := flag.Args()\nfmt.Println(\"Enter the URL : \")\nfmt.Scanf(\"%s \",&amp;args)\nfmt.Println(args)       \nif len(args) &lt; 1 {        \nfmt.Println(reflect.TypeOf(args),\"Please Enter the URL\")  \nos.Exit(1)                                \n}\nretrieve(args)        //call the retrieve function                                   \n\n}\n\nfunc retrieve(url string){          //gives the  source code as \noutput.\n\nresp, err := http.Get(url)         \nif err != nil{\n  fmt.Println(\"read error is:\", err)\n  return \n}\nbody, err := ioutil.ReadAll(resp.Body);\nif err != nil{ \n  fmt.Println(\"read error is:\", err)\n  return \n} else{\n  fmt.Println(string(body))\n\n}\n}\n</code></pre>\n\n<p><br>Dockerfile looks like this:</p>\n\n<pre><code>FROM golang:1.7-alpine\n\nADD . /home\n\nWORKDIR /home\n\nCMD [\"go\",\"run\",\"fetchSource.go\"]\n</code></pre>\n\n<p>i have commented the code where it doesn't work.i just want to take arguments at run time so that i uncomment those lines.</p>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 2052, "user_id": 639559, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3adac89e63229dfeb3c56db48502148c?s=128&d=identicon&r=PG", "display_name": "nilsmagnus", "link": "https://stackoverflow.com/users/639559/nilsmagnus"}, "edited": false, "score": 0, "creation_date": 1495609942, "post_id": 44150559, "comment_id": 75319636, "body": "This is probably a duplicate of <a href=\"https://stackoverflow.com/questions/30885098/go-local-import-in-non-local-package\" title=\"go local import in non local package\">stackoverflow.com/questions/30885098/&hellip;</a>  Use  &quot;github.com/julienschmidt/httprouter/controllers&quot; instead of &quot;./controllers&quot;"}, {"owner": {"reputation": 2052, "user_id": 639559, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3adac89e63229dfeb3c56db48502148c?s=128&d=identicon&r=PG", "display_name": "nilsmagnus", "link": "https://stackoverflow.com/users/639559/nilsmagnus"}, "edited": false, "score": 0, "creation_date": 1495610127, "post_id": 44150559, "comment_id": 75319761, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/30885098/go-local-import-in-non-local-package\">Go: local import in non-local package</a>"}, {"owner": {"reputation": 7775, "user_id": 5658350, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3vhKa.png?s=128&g=1", "display_name": "DhiaTN", "link": "https://stackoverflow.com/users/5658350/dhiatn"}, "edited": false, "score": 1, "creation_date": 1531329140, "post_id": 44150559, "comment_id": 89559648, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/51219800/golang-build-in-docker-not-finding-local-import\">Golang Build in docker not finding local import</a>"}], "answers": [{"comments": [{"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 1, "creation_date": 1495650852, "post_id": 44153158, "comment_id": 75348556, "body": "Glad you solved the issue but I would urge you to follow the advice of nilsmagnus (and all golang documentation) and avoid local imports. Set up your environment as recommended and use a fully qualified import. I promise this will make your life easier later. golinter will moan at you if you use local imports as well"}], "tags": [], "owner": {"reputation": 919, "user_id": 3544524, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/db1b08a462baf39134ade1bace3da4fa?s=128&d=identicon&r=PG", "display_name": "Marvin Caspar", "link": "https://stackoverflow.com/users/3544524/marvin-caspar"}, "is_accepted": false, "score": 3, "last_activity_date": 1495614980, "creation_date": 1495614980, "answer_id": 44153158, "question_id": 44150559, "link": "https://stackoverflow.com/questions/44150559/go-local-import-not-working/44153158#44153158", "title": "GO - Local import not working", "body": "<p>\ud83e\udd26\u200d\u2642\ufe0f </p>\n\n<p>I finally found the issue. In the <code>main.go</code> file I have to import <code>app/controllers</code> instead of <code>./controllers</code> because in the <code>Dockerfile</code> the path is <code>/go/src/app</code>.</p>\n"}], "owner": {"reputation": 919, "user_id": 3544524, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/db1b08a462baf39134ade1bace3da4fa?s=128&d=identicon&r=PG", "display_name": "Marvin Caspar", "link": "https://stackoverflow.com/users/3544524/marvin-caspar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3155, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1495614980, "creation_date": 1495607362, "question_id": 44150559, "link": "https://stackoverflow.com/questions/44150559/go-local-import-not-working", "title": "GO - Local import not working", "body": "<p>I'm new with golang and I want to build my first simple web application. Every time I want to build my source, I get an error <code>locale import \"./controllers\" in non-local package\"</code>.</p>\n\n<p>Here is my folder structure:</p>\n\n<pre><code>goTest\n\u251c\u2500\u2500 Dockerfile\n\u251c\u2500\u2500 controllers\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 IndexController.go\n\u2514\u2500\u2500 main.go\n</code></pre>\n\n<p>The <code>main.go</code> file:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/julienschmidt/httprouter\"\n    \"net/http\"\n    \"log\"\n    \"./controllers\"\n)\n\nfunc main() {\n    router := httprouter.New()\n    router.GET(\"/\", IndexController)\n\n    log.Fatal(http.ListenAndServe(\":8080\", router))\n}\n</code></pre>\n\n<p>The <code>IndexController.go</code> file:</p>\n\n<pre><code>package controllers\n\nimport (\n  \"fmt\"\n)\n\nfunc IndexController(w http.ResponseWriter, r *http.Request, ps httprouter.Params) error {\n    fmt.Fprintf(w, \"Hi %s!\", r.URL.Path[1:])\n}\n</code></pre>\n\n<p>My <code>Dockerfile</code> file (copied from <a href=\"https://hub.docker.com/_/golang/\" rel=\"nofollow noreferrer\">https://hub.docker.com/_/golang/</a>):</p>\n\n<pre><code>FROM golang:1.8\n\nWORKDIR /go/src/app\nCOPY . .\n\nRUN go-wrapper download   # \"go get -d -v ./...\"\nRUN go-wrapper install    # \"go install -v ./...\"\n\nEXPOSE 8080\n\nCMD [\"app\"]\n</code></pre>\n\n<p>The docker and go build command:</p>\n\n<p><code>docker build -t my-golang-app .</code></p>\n\n<p>And at least the console output:</p>\n\n<pre><code>Sending build context to Docker daemon  4.608kB\nStep 1/7 : FROM golang:1.8\n ---&gt; b2063493320d\nStep 2/7 : WORKDIR /go/src/app\n ---&gt; Using cache\n ---&gt; 86d4df9fceaa\nStep 3/7 : COPY . .\n ---&gt; 282286e66939\nRemoving intermediate container fe3c0686729a\nStep 4/7 : RUN go-wrapper download   # \"go get -d -v ./...\"\n ---&gt; Running in f34b5a5ef0de\n+ exec go get -v -d\ngithub.com/julienschmidt/httprouter (download)\nmain.go:7:5: local import \"./controllers\" in non-local package\nThe command '/bin/sh -c go-wrapper download   # \"go get -d -v ./...\"' returned a non-zero code: 1\n</code></pre>\n"}, {"tags": ["c++", "qt", "go", "raspberry-pi"], "comments": [{"owner": {"reputation": 2854, "user_id": 3607748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6c935a2dd26bb6b6f51c00ab4e2d96f?s=128&d=identicon&r=PG&f=1", "display_name": "Beck Yang", "link": "https://stackoverflow.com/users/3607748/beck-yang"}, "edited": false, "score": 0, "creation_date": 1495618460, "post_id": 44150235, "comment_id": 75325565, "body": "The error is the same as <a href=\"https://stackoverflow.com/q/42433946\">stackoverflow.com/q/42433946</a> But it has no answer now.."}, {"owner": {"reputation": 197, "user_id": 7995484, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bc8536b73ceadb9415a083decb90ce09?s=128&d=identicon&r=PG&f=1", "display_name": "JosephCenk", "link": "https://stackoverflow.com/users/7995484/josephcenk"}, "reply_to_user": {"reputation": 2854, "user_id": 3607748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6c935a2dd26bb6b6f51c00ab4e2d96f?s=128&d=identicon&r=PG&f=1", "display_name": "Beck Yang", "link": "https://stackoverflow.com/users/3607748/beck-yang"}, "edited": false, "score": 0, "creation_date": 1495618652, "post_id": 44150235, "comment_id": 75325720, "body": "May be no one knows the answer :)"}, {"owner": {"reputation": 265, "user_id": 3604851, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/4EmZK.png?s=128&g=1", "display_name": "Martin Spasov", "link": "https://stackoverflow.com/users/3604851/martin-spasov"}, "edited": false, "score": 0, "creation_date": 1499817356, "post_id": 44150235, "comment_id": 77066598, "body": "I installed the QT package without Android support and when i run go main i get the same error. OP, did you solve the problem ?"}, {"owner": {"reputation": 197, "user_id": 7995484, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bc8536b73ceadb9415a083decb90ce09?s=128&d=identicon&r=PG&f=1", "display_name": "JosephCenk", "link": "https://stackoverflow.com/users/7995484/josephcenk"}, "reply_to_user": {"reputation": 265, "user_id": 3604851, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/4EmZK.png?s=128&g=1", "display_name": "Martin Spasov", "link": "https://stackoverflow.com/users/3604851/martin-spasov"}, "edited": false, "score": 0, "creation_date": 1499923656, "post_id": 44150235, "comment_id": 77116662, "body": "@SuburbanFilth, I moved to Go-GTK and built my application on that..."}], "owner": {"reputation": 197, "user_id": 7995484, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bc8536b73ceadb9415a083decb90ce09?s=128&d=identicon&r=PG&f=1", "display_name": "JosephCenk", "link": "https://stackoverflow.com/users/7995484/josephcenk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 318, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1495606111, "creation_date": 1495606111, "question_id": 44150235, "link": "https://stackoverflow.com/questions/44150235/go-qt-binding-qabstractanimation-no-such-file-or-directory", "title": "Go-QT Binding: QAbstractAnimation No such file or directory", "body": "<p>I am using go-QT binding(<a href=\"https://github.com/therecipe/qt\" rel=\"nofollow noreferrer\">https://github.com/therecipe/qt</a>). My code is compiling &amp; working good for amd64 but when I try to cross compile it for arm devices (Raspberrypi), it gives below error. Please advise how to solve this issue</p>\n\n<pre><code>**src/github.com/therecipe/qt/core/core.cpp:9:30: fatal error: \nQAbstractAnimation: No such file or directory\ncompilation terminated.**\n\nEnvironment Variables\n\nGOARCH=\"arm\"\nGOBIN=\"\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/minhaj/GoLang\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/linux_amd64\"\nGCCGO=\"gccgo\"\nGOARM=\"\"\nCC=\"arm-linux-gnueabi-gcc\"\nGOGCCFLAGS=\"-fPIC -marm -pthread -fmessage-length=0 -fdebug-prefix-\nmap=/tmp/go-build728594690=/tmp/go-build -gno-record-gcc-switches\"\nCXX=\"arm-linux-gnueabi-g++\"\nCGO_ENABLED=\"1\"\nPKG_CONFIG=\"pkg-config\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\n\nCompilation Result\ngo build -v IndoorMass/\ncrypto\nencoding\nencoding/base64\ncrypto/sha256\nunicode/utf16\nflag\nencoding/json\ngolang.org/x/image/math/fixed\ngithub.com/golang/freetype/raster\ngolang.org/x/image/font\ngithub.com/icza/mjpeg\ngithub.com/golang/freetype/truetype\ngithub.com/skip2/go-qrcode/bitset\ngithub.com/skip2/go-qrcode/reedsolomon\npath/filepath\nio/ioutil\ngithub.com/skip2/go-qrcode\ncontainer/list\ngolang.org/x/net/context\ngithub.com/mattn/go-sqlite3\nIndoorMass/General\ngithub.com/tidwall/match\ngithub.com/tidwall/gjson\ncompress/gzip\ncrypto/subtle\ncrypto/cipher\ncrypto/aes\ninternal/syscall/unix\nmath/rand\nmath/big\ncrypto/rand\ncrypto/des\ncrypto/elliptic\ncrypto/sha512\nencoding/asn1\ncrypto/ecdsa\ncrypto/hmac\ncrypto/internal/cipherhw\ncrypto/md5\ncrypto/rc4\ncrypto/rsa\ncrypto/sha1\ncrypto/dsa\ncrypto/x509/pkix\nencoding/hex\nencoding/pem\ninternal/nettrace\ninternal/singleflight\nnet\ncrypto/x509\nvendor/golang_org/x/crypto/chacha20poly1305/internal/chacha20\nvendor/golang_org/x/crypto/poly1305\nvendor/golang_org/x/crypto/chacha20poly1305\nvendor/golang_org/x/crypto/curve25519\ncrypto/tls\nvendor/golang_org/x/net/http2/hpack\nvendor/golang_org/x/net/idna\nvendor/golang_org/x/net/lex/httplex\nvendor/golang_org/x/text/transform\nvendor/golang_org/x/text/unicode/norm\nvendor/golang_org/x/text/width\nmime\nmime/quotedprintable\nnet/textproto\nmime/multipart\nnet/http/httptrace\nnet/http/internal\npath\nnet/http\nIndoorMass/Server\ngithub.com/kaey/framebuffer\nos/exec\ngithub.com/mrmorphic/hwio\ngithub.com/DexterInd/GrovePi/Software/Go/grovepi\nIndoorMass/Sensor\ngithub.com/therecipe/qt\ngithub.com/therecipe/qt/core\n# github.com/therecipe/qt/core\nsrc/github.com/therecipe/qt/core/core.cpp:9:30: fatal error: \nQAbstractAnimation: No such file or directory\ncompilation terminated.\nIndoorMass/DB\nIndoorMass/Manager\n</code></pre>\n"}, {"tags": ["email", "go", "gmail"], "comments": [{"owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "edited": false, "score": 0, "creation_date": 1495611818, "post_id": 44150003, "comment_id": 75320983, "body": "do you know your <code>smpt</code> configuration at your local server? such as port? etc. My suggestion is read the library code try setup or change the <code>net&#47;smpt</code> to your local config"}, {"owner": {"reputation": 627, "user_id": 6443951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JJbCW.jpg?s=128&g=1", "display_name": "MKB", "link": "https://stackoverflow.com/users/6443951/mkb"}, "reply_to_user": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "edited": false, "score": 0, "creation_date": 1495612106, "post_id": 44150003, "comment_id": 75321215, "body": "what do you mean by local config of smtp?"}, {"owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "edited": false, "score": 0, "creation_date": 1495657143, "post_id": 44150003, "comment_id": 75351609, "body": "Check the Sent folder for the account you&#39;re sending from to see if it has gone out. Also try checking the Spam folder."}], "owner": {"reputation": 627, "user_id": 6443951, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JJbCW.jpg?s=128&g=1", "display_name": "MKB", "link": "https://stackoverflow.com/users/6443951/mkb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 212, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1495605117, "creation_date": 1495605117, "question_id": 44150003, "link": "https://stackoverflow.com/questions/44150003/not-able-to-send-mail-in-golang", "title": "Not able to send mail in Golang", "body": "<p>I am trying to send mail on my local system using <code>gmail</code> package of <code>golang</code>. For which I tried the following:</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n    \"github.com/SlyMarbo/gmail\"\n)\n\nfunc main() {\n    email := gmail.Compose(\"Email subject\", \"Email body\")\n    email.From = \"account@gmail.com\"\n    email.Password = \"password\"\n\n    // Defaults to \"text/plain; charset=utf-8\" if unset.\n    email.ContentType = \"text/html; charset=utf-8\"\n\n    // Normally you'll only need one of these, but I thought I'd show both.\n    email.AddRecipient(\"recepient@domain.com\")\n\n    err := email.Send()\n    if err != nil {\n        fmt.Println(err)\n        // handle error.\n    }\n}\n</code></pre>\n\n<p>I am neither getting any error nor mail. Not sure if it is not sent due to local server. Can anyone please guide me what am I missing? I took reference from <a href=\"https://github.com/SlyMarbo/gmail\" rel=\"nofollow noreferrer\">this</a> page.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1495604715, "post_id": 44149732, "comment_id": 75316799, "body": "Name resolution or firewalls are the likely causes of the problem.  Print the output of <a href=\"https://godoc.org/net#LookupHost\" rel=\"nofollow noreferrer\">net.LookupHost(&quot;example.com&quot;)</a> to determine if name resolution is working as intended."}, {"owner": {"reputation": 1014, "user_id": 2447860, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/ce99f307eeddec0a6912d7b9b73e91e2?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Zheng", "link": "https://stackoverflow.com/users/2447860/eric-zheng"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1495606588, "post_id": 44149732, "comment_id": 75317708, "body": "@CeriseLim&#243;n I have already tried that. The output is correct. Besides, curl and nodejs should fail too if name resolution or firewalls are making trouble."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1495627028, "post_id": 44149732, "comment_id": 75331672, "body": "There is no Windows specific code in the http client code itself.  When the application is blocked forever (or not forever because it times out?), dump the gorotuine stacks to determine where the application is blocked.  One way to dump the stack is to send the process a SIGQUIT."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 2, "creation_date": 1495629578, "post_id": 44149732, "comment_id": 75333572, "body": "@EricZheng: Your Go code works on Windows. The usual problem in these cases is an anti-malware/virus program. Try disabling it."}], "owner": {"reputation": 1014, "user_id": 2447860, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/ce99f307eeddec0a6912d7b9b73e91e2?s=128&d=identicon&r=PG&f=1", "display_name": "Eric Zheng", "link": "https://stackoverflow.com/users/2447860/eric-zheng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1495603957, "creation_date": 1495603957, "question_id": 44149732, "link": "https://stackoverflow.com/questions/44149732/golang-why-do-the-behaviors-of-http-get-differ-between-windows-and-linux", "title": "Golang - Why do the behaviors of `http.Get` differ between Windows and Linux?", "body": "<p>I am trying to call <code>http.Get</code> over <code>http://example.com/path/to/index</code>, and I have resolved <code>example.com</code> to one of my inner IP address.</p>\n\n<p>My Go code:</p>\n\n<pre><code>resp, err := http.Get(\"http://example.com/path/to/index\")\n</code></pre>\n\n<p>On Windows, this blocks forever until connection timeouts.\nHowever, on Linux, it works totally fine.</p>\n\n<p>What is wielder is that I have tried both <code>curl http://example.com/path/to/index</code> and translated the Go code to Nodejs one, they all work fine on Windows, which make me sure that domain resolving is ok on my Windows.</p>\n\n<p>So I wonder why the behaviors of <code>http.Get</code> differ on Windows and Linux.</p>\n"}, {"tags": ["go", "nsq"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 7760015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/327f925ab80bdc7c90a9d28b4e358785?s=128&d=identicon&r=PG&f=1", "display_name": "\u5173\u529b\u5b81", "link": "https://stackoverflow.com/users/7760015/%e5%85%b3%e5%8a%9b%e5%ae%81"}, "edited": false, "score": 0, "creation_date": 1501741460, "post_id": 44207184, "comment_id": 77913085, "body": "Cool\uff01Thanks very much for your help\uff01"}], "tags": [], "owner": {"reputation": 2297, "user_id": 400125, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dSj0M.png?s=128&g=1", "display_name": "vtorhonen", "link": "https://stackoverflow.com/users/400125/vtorhonen"}, "is_accepted": false, "score": 0, "last_activity_date": 1495819894, "creation_date": 1495819894, "answer_id": 44207184, "question_id": 44149044, "link": "https://stackoverflow.com/questions/44149044/why-nsqlookupd-package-use-context/44207184#44207184", "title": "why nsqlookupd package use Context?", "body": "<p>Because future-proofing.</p>\n\n<p><code>Context</code> struct provides a way to wrap context-specific data into a single structure. At this point the context contains a only a pointer to an <code>NSQLookupd</code> struct. However, in case <code>Context</code> would need to be extended somehow then all you'd have to do would be to just add more fields to the struct. You could implement struct methods as well.</p>\n\n<p>All this would require no changes to the internal APIs in the program, since all those new fields and methods are wrapped into the struct and that is already being passed around in the program. You would most likely have to change the way that struct is initialized.</p>\n"}], "owner": {"reputation": 1, "user_id": 7760015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/327f925ab80bdc7c90a9d28b4e358785?s=128&d=identicon&r=PG&f=1", "display_name": "\u5173\u529b\u5b81", "link": "https://stackoverflow.com/users/7760015/%e5%85%b3%e5%8a%9b%e5%ae%81"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 36, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1495819894, "creation_date": 1495600403, "question_id": 44149044, "link": "https://stackoverflow.com/questions/44149044/why-nsqlookupd-package-use-context", "title": "why nsqlookupd package use Context?", "body": "<p>When I read the nsqlookupd part of nsq source code, I found that the author used a Context truct to wrap a NSQLookupd struct and no other funcs for Context.I don't know why we use it this way, what benefits we can get by this way? The source code below here. Thank you!</p>\n\n<p>context.go</p>\n\n<pre><code>type Context struct {\n    nsqlookupd *NSQLookupd\n}\n</code></pre>\n\n<p>nsqlookupd.go</p>\n\n<pre><code>func (l *NSQLookupd) Main() {\nctx := &amp;Context{l}\n\ntcpListener, err := net.Listen(\"tcp\", l.opts.TCPAddress)\nif err != nil {\n    l.logf(LOG_FATAL, \"listen (%s) failed - %s\", l.opts.TCPAddress, err)\n    os.Exit(1)\n}\nl.Lock()\nl.tcpListener = tcpListener\nl.Unlock()\ntcpServer := &amp;tcpServer{ctx: ctx}\nl.waitGroup.Wrap(func() {\n    protocol.TCPServer(tcpListener, tcpServer, l.opts.Logger)\n})\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24922, "user_id": 4001, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/3b2c4583cd2eee64afe2ff888d590cf9?s=128&d=identicon&r=PG", "display_name": "abbot", "link": "https://stackoverflow.com/users/4001/abbot"}, "edited": false, "score": 0, "creation_date": 1495664160, "post_id": 44148449, "comment_id": 75354528, "body": "Why do you care?"}], "answers": [{"tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": true, "score": 8, "last_activity_date": 1495662028, "creation_date": 1495662028, "answer_id": 44168916, "question_id": 44148449, "link": "https://stackoverflow.com/questions/44148449/how-to-check-whether-golang-binary-is-compiled-with-ldflags-s-w/44168916#44168916", "title": "how to check whether golang binary is compiled with --ldflags=&quot;-s -w&quot;", "body": "<p>Disclaimer first: I'm no expert of compilation toolchains and executable file formats. I'll try not to say stupid things, but correct me if you see any mistake !</p>\n\n<p>I ran those tests on an ArchLinux laptop, with x86_64 architecture. Go version is 1.8.1.</p>\n\n<p>First, we need to know where those flags are actually used:</p>\n\n<pre><code>$ go help build\n...\n-ldflags 'flag list'\n    arguments to pass on each go tool link invocation\n...\n</code></pre>\n\n<p>Apparently, flags are merely passed to the <code>go tool link</code> invocation. Looking at the help, we have a bit more information:</p>\n\n<pre><code>$ go tool link\n...\n-s  disable symbol table\n...\n-w  disable DWARF generation\n...\n</code></pre>\n\n<p>Taken from the short introduction to ELF that I found <a href=\"http://flint.cs.yale.edu/cs422/doc/ELF_Format.pdf\" rel=\"noreferrer\">here</a>, here is the header text concerning the Symbol Table:</p>\n\n<blockquote>\n  <p>An object file\u2019s symbol table holds information needed to locate and\n  relocate a program\u2019s symbolic definitions and references.</p>\n</blockquote>\n\n<p>As for DWARF, this is a format for debugging data.</p>\n\n<p>From there, how do we know if a binary has a symbol table, or DWARF enabled ? The answer lies in ELF sections. There are probably other ways, but it is the one I found and is easy to check for. Here are the rules that I've used to determine if a Golang binary has been compiled with <code>-ldflags='-s'</code> or <code>-ldflags='-w'</code>:</p>\n\n<ul>\n<li>If a Go binary has a symbol table, the section <code>.symtab</code> is present</li>\n<li>If a Go binary has DWARF debug, the section <code>.debug_info</code> is present. This section is not the only one to be present, but serves as an indicator.</li>\n</ul>\n\n<p>On Linux, there are some tools which can read section names to extract those informations. <code>readelf</code> and <code>nm</code> are examples, yet probably more exist.</p>\n\n<p>It also turns out that Go provide a <code>debug/elf</code> package which can be used to get those informations. Here is a sample program that does this job:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"os\"\nimport \"debug/elf\"\n\nfunc main() {\n    fileName := \"path/to/main\"\n    fp, err := elf.Open(fileName)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n\n    symtab := fp.Section(\".symtab\")\n    if symtab == nil {\n        fmt.Println(\"No Symbol Table : compiled with -ldflags='-s'\")\n    }\n\n    debugInfo := fp.Section(\".debug_info\")\n    if debugInfo == nil {\n        fmt.Println(\"No DWARF data : compiled with -ldflags='-w'\")\n    }\n}\n</code></pre>\n\n<p>I tested this program against the basic Golang Hello World, using no flags, only the <code>-s</code> flag, only the <code>-w</code> flag and both <code>-s -w</code> flags. I noted that while compiling with <code>-s</code> only, it also removed DWARF data, but I did not search why. Aside from that, the results were as expected.</p>\n\n<p>Though ELF was the focus format, the same method can be applied for Windows executables (there is a <code>debug/pe</code> package in Golang).</p>\n"}], "owner": {"reputation": 63, "user_id": 4519572, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5ctlk.jpg?s=128&g=1", "display_name": "BruceAuyeung", "link": "https://stackoverflow.com/users/4519572/bruceauyeung"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2078, "favorite_count": 1, "accepted_answer_id": 44168916, "answer_count": 1, "score": 5, "last_activity_date": 1495662028, "creation_date": 1495596496, "question_id": 44148449, "link": "https://stackoverflow.com/questions/44148449/how-to-check-whether-golang-binary-is-compiled-with-ldflags-s-w", "title": "how to check whether golang binary is compiled with --ldflags=&quot;-s -w&quot;", "body": "<p>i know <code>--ldflags=\"-s -w\"</code> will make Go binary size smaller, but without comparing to the one without ldflags, how do we know whether Go binary compiled with or without <code>ldflags=\"-s -w\"</code> ?</p>\n"}, {"tags": ["c++", "performance", "go", "concurrency", "tbb"], "comments": [{"owner": {"reputation": 16907, "user_id": 4832499, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/76532994f6efa8d7dc8a3bb5b7b262a8?s=128&d=identicon&r=PG&f=1", "display_name": "Passer By", "link": "https://stackoverflow.com/users/4832499/passer-by"}, "edited": false, "score": 0, "creation_date": 1495595920, "post_id": 44148184, "comment_id": 75313981, "body": "I would suggest you to first use a real benchmarking tool, such as the one built into go."}, {"owner": {"reputation": 16907, "user_id": 4832499, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/76532994f6efa8d7dc8a3bb5b7b262a8?s=128&d=identicon&r=PG&f=1", "display_name": "Passer By", "link": "https://stackoverflow.com/users/4832499/passer-by"}, "edited": false, "score": 0, "creation_date": 1495596695, "post_id": 44148184, "comment_id": 75314151, "body": "Upon inspection, you are not doing the same things in both programs. To name a few, the c++ version has integer divisions and whatnot from the duration cast, and the variables does not have the same level of indirection. These may ultimately prove to be irrelevant, but until you actually benchmark them, we won&#39;t know"}, {"owner": {"reputation": 5833, "user_id": 2527797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83539ee8bca535eca6c4be5c856a738d?s=128&d=identicon&r=PG&f=1", "display_name": "Anton", "link": "https://stackoverflow.com/users/2527797/anton"}, "edited": false, "score": 0, "creation_date": 1495599795, "post_id": 44148184, "comment_id": 75315008, "body": "Try also adding real/simulated compute work into producers/consumer. It might happen that because of goroutines, it is executed in a single thread, thus real synchronization does not take place for Go version. Also, TBB&#39;s queue is MPMC, while Go might optimize it for MPSC model significantly."}, {"owner": {"reputation": 16907, "user_id": 4832499, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/76532994f6efa8d7dc8a3bb5b7b262a8?s=128&d=identicon&r=PG&f=1", "display_name": "Passer By", "link": "https://stackoverflow.com/users/4832499/passer-by"}, "reply_to_user": {"reputation": 5833, "user_id": 2527797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83539ee8bca535eca6c4be5c856a738d?s=128&d=identicon&r=PG&f=1", "display_name": "Anton", "link": "https://stackoverflow.com/users/2527797/anton"}, "edited": false, "score": 0, "creation_date": 1495601137, "post_id": 44148184, "comment_id": 75315407, "body": "@Anton check the documentation on <a href=\"https://golang.org/pkg/runtime/#LockOSThread\" rel=\"nofollow noreferrer\"><code>runtime.LockOSThread</code></a>"}, {"owner": {"reputation": 5833, "user_id": 2527797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83539ee8bca535eca6c4be5c856a738d?s=128&d=identicon&r=PG&f=1", "display_name": "Anton", "link": "https://stackoverflow.com/users/2527797/anton"}, "edited": false, "score": 0, "creation_date": 1495637465, "post_id": 44148184, "comment_id": 75340111, "body": "There is no <code>min</code> statistics for Go, and no declaration of g_queue with the size of the queue. Assuming they are equal for both versions and seeing min time of 3 microseconds for TBB, I assume that queues are always full and block on push. Thus, the benches are rather about blocking synchronization comparison between TBB and Go, not about the shared memory protocol of the queue itself."}, {"owner": {"reputation": 5833, "user_id": 2527797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83539ee8bca535eca6c4be5c856a738d?s=128&d=identicon&r=PG&f=1", "display_name": "Anton", "link": "https://stackoverflow.com/users/2527797/anton"}, "edited": false, "score": 0, "creation_date": 1495637619, "post_id": 44148184, "comment_id": 75340262, "body": "Other issues include false sharing on pvec and that reader is not locked to thread."}, {"owner": {"reputation": 329, "user_id": 317183, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/2826d5a4936756c28d93c400f3d7f15e?s=128&d=identicon&r=PG", "display_name": "jon", "link": "https://stackoverflow.com/users/317183/jon"}, "edited": false, "score": 0, "creation_date": 1495711111, "post_id": 44148184, "comment_id": 75372449, "body": "I edit the original post. The test it did has some minor differences but it can&#39;t explain this big difference, with intel vtune I see the CPU time is quite different, which suggests some blocking functions implementation might impact the result. e.g. mutex, goroutine, go scheduler?"}], "answers": [{"tags": [], "owner": {"reputation": 5833, "user_id": 2527797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83539ee8bca535eca6c4be5c856a738d?s=128&d=identicon&r=PG&f=1", "display_name": "Anton", "link": "https://stackoverflow.com/users/2527797/anton"}, "is_accepted": true, "score": 6, "last_activity_date": 1496198793, "last_edit_date": 1496198793, "creation_date": 1496198103, "answer_id": 44274727, "question_id": 44148184, "link": "https://stackoverflow.com/questions/44148184/why-golang-channel-is-much-faster-than-intel-tbb-concurrent-queue-when-test-with/44274727#44274727", "title": "why golang channel is much faster than intel tbb concurrent_queue when test with 8 producer 1 consumer", "body": "<p>From the VTune traces I can conclude that TBB queue does not sleep, spending a lot time spinning, while Go version has light green areas indicating threads sleeping on OS synchronization. Why is it better? Usually, it indicates that you have oversubscription on your machine, thus communication through OS pays off.\nSo, do you oversubscribe it? If yes, I'd say this is rather expected behavior which fits into philosophy of corresponding libraries. TBB is designed for compute parallelism, it does not handle IO tasks well while playing against oversubscription. Go is designed exactly for IO tasks, thus built-in concurrency with FIFO policy of the scheduler that is unfriendly to parallel number crunching. Oversubscription is rather recommend for IO tasks while it affects or even kills computational parallelism.</p>\n"}], "owner": {"reputation": 329, "user_id": 317183, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/2826d5a4936756c28d93c400f3d7f15e?s=128&d=identicon&r=PG", "display_name": "jon", "link": "https://stackoverflow.com/users/317183/jon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 901, "favorite_count": 0, "accepted_answer_id": 44274727, "answer_count": 1, "score": 2, "last_activity_date": 1496198793, "creation_date": 1495594511, "last_edit_date": 1496111712, "question_id": 44148184, "link": "https://stackoverflow.com/questions/44148184/why-golang-channel-is-much-faster-than-intel-tbb-concurrent-queue-when-test-with", "title": "why golang channel is much faster than intel tbb concurrent_queue when test with 8 producer 1 consumer", "body": "<p>I did a test to compare golang channel and C++ tbb concurrent queue performance, I setup 8 writer and 1 reader which are in different threads.the result shows golang is much faster than C++ version(whatever latency and overall send/recv speed), is it true? or any mistake in my code?</p>\n\n<p>golang result, unit is microsecond</p>\n\n<p>latency max:1505,avg:1073\nsend begin:1495593677683232,recv end:1495593677901854, time:218622</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"time\"\n    \"fmt\"\n    \"sync\"\n    \"runtime\"\n)\n\nvar (\n    producer = flag.Int(\"producer\", 8, \"producer\")\n    consumer = flag.Int(\"consumer\", 1, \"consumer\")\n    start_signal sync.WaitGroup\n)\n\nconst (\n    TEST_NUM = 1000000\n)\n\ntype Item struct  {\n    id int\n    sendtime int64\n    recvtime int64\n}\n\nvar g_vec[TEST_NUM] Item\n\nfunc sender(out chan int, begin int, end int) {\n    start_signal.Wait()\n    runtime.LockOSThread()\n    println(\"i am in sender\", begin, end)\n    for i:=begin; i &lt; end; i++ {\n        item := &amp;g_vec[i]\n        item.id = i\n        item.sendtime = time.Now().UnixNano()/1000\n        out&lt;- i\n    }\n    println(\"sender finish\")\n}\n\nfunc reader(out chan int, total int) {\n    //runtime.LockOSThread()\n    start_signal.Done()\n    for i:=0; i&lt;total;i++ {\n        tmp :=&lt;- out\n        item := &amp;g_vec[tmp]\n        item.recvtime = time.Now().UnixNano()/1000\n    }\n    var lsum int64 = 0\n    var lavg int64 = 0\n    var lmax int64 = 0\n    var lstart int64 = 0\n    var lend int64 = 0\n    for _, item:= range g_vec {\n        if lstart &gt; item.sendtime || lstart == 0 {\n           lstart = item.sendtime\n        }\n        if lend &lt; item.recvtime {\n            lend = item.recvtime\n        }\n\n        ltmp := item.recvtime - item.sendtime\n        lsum += ltmp\n        if  ltmp &gt; lmax {\n            lmax = ltmp\n        }\n    }\n    lavg = lsum /  TEST_NUM\n    fmt.Printf(\"latency max:%v,avg:%v\\n\", lmax, lavg)\n    fmt.Printf(\"send begin:%v,recv end:%v, time:%v\", lstart, lend, lend-lstart)\n}\n\nfunc main() {\n    runtime.GOMAXPROCS(10)\n    out := make (chan int,5000)\n\n    start_signal.Add(1)\n    for i:=0 ;i&lt;*producer;i++ {\n        go sender(out,i*TEST_NUM/(*producer), (i+1)*TEST_NUM/(*producer))\n    }\n    reader(out, TEST_NUM)\n}\n</code></pre>\n\n<p>C++, only main part</p>\n\n<p>concurrent_bounded_queue g_queue;\nmax:558301,min:3,avg:403741  (unit is microsecond)\nstart:1495594232068580,end:1495594233497618,length:1429038</p>\n\n<pre><code>static void sender(int start, int end)\n{   \n    for (int i=start; i &lt; end; i++)\n    {\n        using namespace std::chrono;\n        auto now = system_clock::now();\n        auto now_ms = time_point_cast&lt;microseconds&gt;(now);\n        auto value = now_ms.time_since_epoch();\n        int64_t duration = value.count();\n\n        Item &amp;item = g_pvec-&gt;at(i);\n        item.id = i;\n        item.sendTime = duration;\n        //std::cout &lt;&lt; \"sending \" &lt;&lt; i &lt;&lt; \"\\n\";\n        g_queue.push(i);\n    }\n}\n\n\nstatic void reader(int num)\n{\n    barrier.set_value();    \n    for (int i=0;i&lt;num;i++)\n    {\n        int v;\n        g_queue.pop(v);\n        Item &amp;el = g_pvec-&gt;at(v);\n\n        using namespace std::chrono;\n        auto now = system_clock::now();\n        auto now_ms = time_point_cast&lt;microseconds&gt;(now);\n        auto value = now_ms.time_since_epoch();\n        int64_t duration = value.count();\n\n        el.recvTime = duration;\n        //std::cout &lt;&lt; \"recv \" &lt;&lt; item.id &lt;&lt; \":\" &lt;&lt; duration &lt;&lt; \"\\n\";\n    }\n    // caculate the result.\n    int64_t lmax = 0;\n    int64_t lmin = 100000000;\n    int64_t lavg = 0;\n    int64_t lsum = 0;\n    int64_t lbegin = 0;\n    int64_t lend = 0;\n    for (auto &amp;item : *g_pvec)\n    {\n        if (item.sendTime&lt;lbegin || lbegin==0)\n        {\n            lbegin = item.sendTime;\n        }\n        if (item.recvTime&gt;lend )\n        {\n            lend = item.recvTime;\n        }\n\n        lsum += item.recvTime - item.sendTime;\n        lmax = max(item.recvTime - item.sendTime, lmax);\n        lmin = min(item.recvTime - item.sendTime, lmin);\n    }\n    lavg = lsum / num;\n    std::cout &lt;&lt; \"max:\" &lt;&lt; lmax &lt;&lt; \",min:\" &lt;&lt; lmin &lt;&lt; \",avg:\" &lt;&lt; lavg &lt;&lt; \"\\n\";\n    std::cout &lt;&lt; \"start:\" &lt;&lt; lbegin &lt;&lt; \",end:\" &lt;&lt; lend &lt;&lt; \",length:\" &lt;&lt; lend-lbegin &lt;&lt; \"\\n\";\n}\n\nDEFINE_CODE_TEST(plain_queue_test)\n{\n    g_pvec = new std::vector&lt;Item&gt;();\n    g_pvec-&gt;resize(TEST_NUM);    \n\n    auto sf = barrier.get_future().share();\n\n    std::vector&lt;std::thread&gt; vt;\n    for (int i = 0; i &lt; SENDER_NUM; i++)\n    {\n        vt.emplace_back([sf, i]{    \n            sf.wait();\n            sender(i*TEST_NUM / SENDER_NUM, (i + 1)*TEST_NUM / SENDER_NUM);\n        });\n    }\n\n\n    std::cout &lt;&lt; \"create reader\\n\";\n    std::thread rt(bind(reader, TEST_NUM));\n    for (auto&amp; t : vt)\n    {\n        t.join();\n    }    \n    rt.join();\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/gjzbW.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/gjzbW.jpg\" alt=\"golang cpu usage\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/G9So9.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/G9So9.jpg\" alt=\"cpp cpu usage\"></a></p>\n\n<p>(red color means cpu spin/overhead, green is idle) from the vtune cpu graph I felt golang channel has a more efficient mutex(e.g. does it need a system call to sleep a goroutine vs C++ mutex?)\n<a href=\"https://i.stack.imgur.com/5jUYJ.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/5jUYJ.jpg\" alt=\"enter image description here\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/6XA7A.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/6XA7A.jpg\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["json", "go", "marshalling", "unmarshalling"], "answers": [{"comments": [{"owner": {"reputation": 3851, "user_id": 84762, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/03f58429e8709df581bedd42f576f649?s=128&d=identicon&r=PG", "display_name": "KOGI", "link": "https://stackoverflow.com/users/84762/kogi"}, "edited": false, "score": 0, "creation_date": 1495582809, "post_id": 44146230, "comment_id": 75310976, "body": "Thank you, this is definitely better than what I had! However, the problem I see with this is when manually instantiating a new <code>UnsafeUser</code>... <code>myUser := UnsafeUser{Id: &quot;1&quot;, Username: &quot;foo&quot;, Password: &quot;bar&quot;}</code> doesn&#39;t work, which means now my code has to use <code>myUser := UnsafeUser{SafeUser: SafeUser{Id: &quot;1&quot;, Username: &quot;foo&quot;}, Password: &quot;bar&quot;}</code> which is just... terrible. Is there any way around that? Ideally, I&#39;d like 1 of those classes to be entirely transparent."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "reply_to_user": {"reputation": 3851, "user_id": 84762, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/03f58429e8709df581bedd42f576f649?s=128&d=identicon&r=PG", "display_name": "KOGI", "link": "https://stackoverflow.com/users/84762/kogi"}, "edited": false, "score": 1, "creation_date": 1495583267, "post_id": 44146230, "comment_id": 75311092, "body": "@KOGI Yup, <a href=\"https://stackoverflow.com/questions/44123399/how-do-i-initialize-a-composed-struct-in-go/44123416?noredirect=1#comment75266036_44123416\">I hit that problem myself yesterday</a>."}], "tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": false, "score": 6, "last_activity_date": 1495579514, "creation_date": 1495579514, "answer_id": 44146230, "question_id": 44146114, "link": "https://stackoverflow.com/questions/44146114/how-do-i-omit-a-struct-field-only-when-marshalling-but-keep-it-when-unmarshal/44146230#44146230", "title": "How do I omit a struct field *only* when marshalling, but keep it when unmarshalling?", "body": "<p>Take advantage of <a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"noreferrer\">embedded structs</a>. Define a User, and embed that in an UnsafeUser which adds the password field (and anything else, like payment info).</p>\n\n<pre><code>type User struct {\n    Id       string `json:\"id\"`\n    Username string `json:\"username\"`\n}\n\ntype UnsafeUser struct {\n    User\n    Password string `json:\"pwd\"`\n}\n</code></pre>\n\n<p>(It's better to make things safe by default and declare what is unsafe, like <a href=\"https://golang.org/pkg/unsafe/\" rel=\"noreferrer\">Go's unsafe pacakge</a>.)</p>\n\n<p>Then you can extract the User from within the UnsafeUser without having to know and copy all the fields.</p>\n\n<pre><code>func (uu UnsafeUser) MarshalJSON() ([]byte, error) {\n    return json.Marshal(uu.User)\n}\n\n$ go run ~/tmp/test.go\nOriginal:     {\"id\":\"1\",\"username\":\"Chad\",\"pwd\":\"sillypants\"}\nUnmarshalled: {User:{Id:1 Username:Chad} Password:sillypants}\nReMarshalled: {\"id\":\"1\",\"username\":\"Chad\"}\n</code></pre>\n\n<p>Note how you can see the User struct embedded within the unmarshalled UnsafeUser.</p>\n"}, {"comments": [{"owner": {"reputation": 3851, "user_id": 84762, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/03f58429e8709df581bedd42f576f649?s=128&d=identicon&r=PG", "display_name": "KOGI", "link": "https://stackoverflow.com/users/84762/kogi"}, "edited": false, "score": 0, "creation_date": 1495640823, "post_id": 44149396, "comment_id": 75342762, "body": "Oh, this is perfect! And the alias is locally scoped inside the marshalling function, so it&#39;s not seen or accessible anywhere else, making it totally transparent. Nice work!"}], "tags": [], "owner": {"reputation": 794, "user_id": 1500646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dc08a3decfb01425d436e4b3161b3ff?s=128&d=identicon&r=PG", "display_name": "klvmungai", "link": "https://stackoverflow.com/users/1500646/klvmungai"}, "is_accepted": true, "score": 5, "last_activity_date": 1495603120, "last_edit_date": 1495603120, "creation_date": 1495602387, "answer_id": 44149396, "question_id": 44146114, "link": "https://stackoverflow.com/questions/44146114/how-do-i-omit-a-struct-field-only-when-marshalling-but-keep-it-when-unmarshal/44149396#44149396", "title": "How do I omit a struct field *only* when marshalling, but keep it when unmarshalling?", "body": "<p>I had the same issue but came across <a href=\"http://choly.ca/post/go-json-marshalling/\" rel=\"noreferrer\">this article</a>.</p>\n\n<p>The idea is to use embedding and an anonymous struct to override fields.</p>\n\n<pre><code>func (u User) MarshalJSON() ([]byte, error) {\n    type Alias User\n    safeUser := struct {\n        Password string `json:\"pwd,omitempty\"`\n        Alias\n    }{\n        // Leave out the password so that it is empty\n        Alias: Alias(u),\n    }\n\n    return json.Marshal(safeUser)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/RfZ_Svnwov\" rel=\"noreferrer\">Try it</a></p>\n\n<p>The Alias helps prevent an infinite loop while marshalling.</p>\n\n<p>Please note that you have to maintain the same JSON field name for the override to work.</p>\n"}], "owner": {"reputation": 3851, "user_id": 84762, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/03f58429e8709df581bedd42f576f649?s=128&d=identicon&r=PG", "display_name": "KOGI", "link": "https://stackoverflow.com/users/84762/kogi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 637, "favorite_count": 1, "accepted_answer_id": 44149396, "answer_count": 2, "score": 5, "last_activity_date": 1495603120, "creation_date": 1495578822, "question_id": 44146114, "link": "https://stackoverflow.com/questions/44146114/how-do-i-omit-a-struct-field-only-when-marshalling-but-keep-it-when-unmarshal", "title": "How do I omit a struct field *only* when marshalling, but keep it when unmarshalling?", "body": "<p>I have a User struct with a password field. When I'm creating a user (or udpating with a new password) via POSTed JSON, I want to accept/unmarshal the password field into my object, but whenever I <em>return</em> a user, I want to omit the password field. Below is the best I've been able to come up with so far. It works, but it requires a <em>lot</em> of duplication around the field names that I'd like to eliminate (right now, if I add a new field like <code>FirstName</code>, I have to add that in 3 separate places).</p>\n\n<p><strong>How do I do this better <em>while still honoring the <code>json</code> tags on the struct</em>?</strong></p>\n\n<pre><code>func main() {\n    origJson := []byte(`{\"id\":\"1\",\"username\":\"Chad\",\"pwd\":\"sillypants\"}`)\n    fmt.Println(\"Original:     \" + string(origJson))\n\n    var unmarshalled User\n    json.Unmarshal(origJson, &amp;unmarshalled)\n    fmt.Printf(\"Unmarshalled: %+v\\n\", unmarshalled)\n\n    marshalled, _ := json.Marshal(unmarshalled)\n    fmt.Println(\"ReMarshalled: \" + string(marshalled))\n}\n\ntype User struct {\n    Id       string `json:\"id\"`\n    Username string `json:\"username\"`\n    Password string `json:\"pwd\"`\n}\n\ntype SafeUser struct {\n    Id       string `json:\"id\"`\n    Username string `json:\"username\"`\n}\n\nfunc (u User) MarshalJSON() ([]byte, error) {\n    safeUser := SafeUser{\n        Id      : u.Id,\n        Username: u.Username,\n    }\n\n    return json.Marshal(safeUser)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/cENnVHqZe8\" rel=\"noreferrer\">Try it</a> on the Go Playground</p>\n"}, {"tags": ["string", "go"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1495572709, "post_id": 44144641, "comment_id": 75307249, "body": "Do you always know there will be two?"}], "answers": [{"tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": false, "score": 3, "last_activity_date": 1495572848, "creation_date": 1495572848, "answer_id": 44144817, "question_id": 44144641, "link": "https://stackoverflow.com/questions/44144641/replace-nth-occurrence-of-string-in-golang/44144817#44144817", "title": "Replace Nth occurrence of string in golang", "body": "<p>If you always know there will be two, you could use <a href=\"https://godoc.org/strings#Index\" rel=\"nofollow noreferrer\">https://godoc.org/strings#Index</a> to find the index of the first, then do the replace on everything after, finally combining them together.</p>\n\n<p><a href=\"https://play.golang.org/p/CeJFViNjgH\" rel=\"nofollow noreferrer\">https://play.golang.org/p/CeJFViNjgH</a></p>\n\n<pre><code>func main() {\n    search := \"optimism\"\n    mystring := \"optimismo from optimism\"\n\n    // find index of the first and add the length to get the end of the word\n    ind := strings.Index(mystring, search)\n    if ind == -1 {\n        fmt.Println(\"doesn't exist\")\n        return // error case\n    }\n    ind += len(search)\n\n    excludingSecond := mystring[:ind]\n\n    // run replace on everything after the first one\n    excludingSecond += strings.Replace(mystring[ind:], search, \"\", 1)\n    fmt.Println(excludingSecond)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 5, "last_activity_date": 1495579051, "creation_date": 1495579051, "answer_id": 44146149, "question_id": 44144641, "link": "https://stackoverflow.com/questions/44144641/replace-nth-occurrence-of-string-in-golang/44146149#44146149", "title": "Replace Nth occurrence of string in golang", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\n// Replace the nth occurrence of old in s by new.\nfunc replaceNth(s, old, new string, n int) string {\n    i := 0\n    for m := 1; m &lt;= n; m++ {\n        x := strings.Index(s[i:], old)\n        if x &lt; 0 {\n            break\n        }\n        i += x\n        if m == n {\n            return s[:i] + new + s[i+len(old):]\n        }\n        i += len(old)\n    }\n    return s\n}\n\nfunc main() {\n    s := \"optimismo from optimism\"\n    fmt.Printf(\"%q\\n\", s)\n    t := replaceNth(s, \"optimism\", \"\", 2)\n    fmt.Printf(\"%q\\n\", t)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>\"optimismo from optimism\"\n\"optimismo from \"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 727, "user_id": 4582045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eec80e0c8aba555ebfb1ace1f29fb84b?s=128&d=identicon&r=PG&f=1", "display_name": "Akshar", "link": "https://stackoverflow.com/users/4582045/akshar"}, "is_accepted": false, "score": 6, "last_activity_date": 1551731709, "creation_date": 1551731709, "answer_id": 54991129, "question_id": 44144641, "link": "https://stackoverflow.com/questions/44144641/replace-nth-occurrence-of-string-in-golang/54991129#54991129", "title": "Replace Nth occurrence of string in golang", "body": "<p>For anyone stumbling on this post and is looking to replace the LAST occurrence</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    mystring := \"optimismo from optimism\"\n\n    i := strings.LastIndex(mystring, \"optimism\")\n    excludingLast := mystring[:i] + strings.Replace(mystring[i:], \"optimism\", \"\", 1)\n    fmt.Println(excludingLast)\n}\n</code></pre>\n"}], "owner": {"reputation": 415, "user_id": 5319281, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/22148896d125fa2c7357852622e2911d?s=128&d=identicon&r=PG&f=1", "display_name": "AppTest", "link": "https://stackoverflow.com/users/5319281/apptest"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5152, "favorite_count": 1, "accepted_answer_id": 44146149, "answer_count": 3, "score": 4, "last_activity_date": 1551731709, "creation_date": 1495572197, "last_edit_date": 1495584445, "question_id": 44144641, "link": "https://stackoverflow.com/questions/44144641/replace-nth-occurrence-of-string-in-golang", "title": "Replace Nth occurrence of string in golang", "body": "<p>How do I replace the nth (in this case second) occurrence of a string in golang? The following code replaces the example string <code>optimismo from optimism</code> with <code>o from optimism</code> when I want it to be <code>optimismo from</code> </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    mystring := \"optimismo from optimism\"\n    excludingSecond := strings.Replace(mystring, \"optimism\", \"\", 1)\n    fmt.Println(excludingSecond)\n}\n</code></pre>\n"}, {"tags": ["post", "go"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 2, "creation_date": 1495570587, "post_id": 44144181, "comment_id": 75306125, "body": "So go to line 62 and you are calling a function that doesn&#39;t return anything, but you are doing <code>x = func()</code> or <code>x := func()</code>"}, {"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 0, "creation_date": 1495571474, "post_id": 44144181, "comment_id": 75306612, "body": "Apart from @Adrian&#39;s correct answer, you are using <code>&quot;url&quot;</code> inside <code>NewRequest</code>. I don&#39;t know if that&#39;s intentional or not. Another thing, you should check if the status of your request is <code>200</code> by adding before <code>bodyText, err . . .</code> something like <code>if resp != 200 { fmt.Println(&quot;Received invalid response ...&quot;) } </code>."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1495571257, "creation_date": 1495571257, "answer_id": 44144414, "question_id": 44144181, "link": "https://stackoverflow.com/questions/44144181/http-post-leads-to-too-many-arguments-to-return/44144414#44144414", "title": "Http POST leads to : Too many arguments to return", "body": "<p>The error is exactly right. Your function signature is:</p>\n\n<pre><code>func Postfunc(w http.ResponseWriter , rep *http.Request)\n</code></pre>\n\n<p>It has no return values. Therefore, your last line:</p>\n\n<pre><code>return  p\n</code></pre>\n\n<p>Has too many arguments, which would be any arguments at all. If you want to write text to the HTTP response, use the <code>ResponseWriter</code>:</p>\n\n<pre><code>w.Write(bodyText)\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 6136399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53d7cdedcda794264accdb53099821b9?s=128&d=identicon&r=PG&f=1", "display_name": "Reddy", "link": "https://stackoverflow.com/users/6136399/reddy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 651, "favorite_count": 0, "accepted_answer_id": 44144414, "answer_count": 1, "score": 0, "last_activity_date": 1495593259, "creation_date": 1495570365, "last_edit_date": 1495593259, "question_id": 44144181, "link": "https://stackoverflow.com/questions/44144181/http-post-leads-to-too-many-arguments-to-return", "title": "Http POST leads to : Too many arguments to return", "body": "<p>I'm having some troubles trying to execute a <code>POST</code> using <code>Golang</code>. With the code below</p>\n\n<pre><code>func Postfunc(w http.ResponseWriter , rep *http.Request) {\n     var jsonStr = []byte(`{\"id\":\"10012\"}`)\n     req, err := http.NewRequest(\"POST\", \"url\", bytes.NewBuffer(jsonStr))\n     req.Header.Set(\"Content-Type\", \"application/Text\")\n     client := &amp;http.Client{}\n     resp, err := client.Do(req)\n     if err != nil {\n         panic(err)\n     }\n     fmt.Println(\"responce Status:\", resp.Status)\n     fmt.Println(\"responce Headers:\", resp.Header)\n     defer resp.Body.Close()\n     bodyText, err := ioutil.ReadAll(resp.Body)\n     fmt.Println(\"responce Body:\", string(bodyText))\n     p := string(bodyText)\n     return  p\n}\n</code></pre>\n\n<p>I get the following error:</p>\n\n<p><code>too many arguments to return, have (string), want ()</code></p>\n\n<p><strong>What does this error mean? How can I fix this?</strong> </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1495567100, "post_id": 44143265, "comment_id": 75304405, "body": "Go is not object oriented. You would use interfaces as in your second piece of code depending on how you wanted to implement it and what you need it to do."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1495567142, "post_id": 44143265, "comment_id": 75304429, "body": "Go is not an object-oriented language, and does not support strict polymorphism. The only form of polymorphism supported by Go is interfaces."}, {"owner": {"reputation": 2005, "user_id": 1871890, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4359cdd9f14bbbe17c56f2fb2d2de25d?s=128&d=identicon&r=PG", "display_name": "Mathieu Nls", "link": "https://stackoverflow.com/users/1871890/mathieu-nls"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1495567255, "post_id": 44143265, "comment_id": 75304481, "body": "@Adrian: I understand that. So, my interface would be the correct way to achieve my needs in Go ?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1495567432, "post_id": 44143265, "comment_id": 75304561, "body": "It&#39;s hard to say, because your question doesn&#39;t really say what you&#39;re trying to accomplish, just the way that you&#39;re trying to accomplish it (see <a href=\"https://meta.stackexchange.com/questions/66377/what-is-the-xy-problem\">XY Problem</a>). More than likely, if you&#39;re thinking in OOP terms, you need to rethink your design from the ground up in Go terms, as was my experience going from Java/C# to Go."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1495567575, "post_id": 44143265, "comment_id": 75304618, "body": "<code>&quot;inheritance is done via composition&quot;</code>, no that is not inheritance. Starting off by structuring your code as if there is inheritance is always going to lead you in the wrong direction."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1495567639, "post_id": 44143265, "comment_id": 75304656, "body": "As a side note, a method on a struct should always take a pointer to a struct, not a value e.g. <code>func (a *A) getOne() int{}</code> instead of <code>func (a A) getOne() int{}</code>. If you don&#39;t use a pointer, a copy is passed, so any changes will not be reflected in the variable you called it on."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1495568289, "post_id": 44143265, "comment_id": 75305005, "body": "@RayfenWindspear that may be a good rule of thumb for new developers who might get confused by pointer semantics, but it is absolutely not the universal truth that saying &quot;should always&quot; implies."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1495568450, "post_id": 44143265, "comment_id": 75305091, "body": "@Adrian true enough, but based on my own experience, I&#39;ve not encountered any circumstance to make me even think twice about which to use. I suppose if you really did want to operate on a copy instead of the original, but that&#39;s all I can think of, but I&#39;ve never had the need."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1495568466, "post_id": 44143265, "comment_id": 75305100, "body": "@JimB is absolutely right on all counts (as usual!). Inheritance isn&#39;t &quot;done via composition&quot;; <a href=\"https://en.wikipedia.org/wiki/Composition_over_inheritance\" rel=\"nofollow noreferrer\">composition is done <i>instead of</i> inheritance</a>."}], "answers": [{"tags": [], "owner": {"reputation": 24922, "user_id": 4001, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/3b2c4583cd2eee64afe2ff888d590cf9?s=128&d=identicon&r=PG", "display_name": "abbot", "link": "https://stackoverflow.com/users/4001/abbot"}, "is_accepted": true, "score": 5, "last_activity_date": 1495575453, "creation_date": 1495575453, "answer_id": 44145472, "question_id": 44143265, "link": "https://stackoverflow.com/questions/44143265/polymorphism-in-golang/44145472#44145472", "title": "Polymorphism in Golang?", "body": "<p>There is no inheritance in Go. Composition doesn't give you dynamic dispatch (which is usually implied when 'polymorphism' and 'inheritance' are used in the same paragraph): the embedded method call always happens on the embedded field as a receiver, not on the container type it is embedded into.</p>\n"}], "owner": {"reputation": 2005, "user_id": 1871890, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4359cdd9f14bbbe17c56f2fb2d2de25d?s=128&d=identicon&r=PG", "display_name": "Mathieu Nls", "link": "https://stackoverflow.com/users/1871890/mathieu-nls"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 487, "favorite_count": 0, "accepted_answer_id": 44145472, "answer_count": 1, "score": 0, "last_activity_date": 1495575453, "creation_date": 1495566941, "question_id": 44143265, "link": "https://stackoverflow.com/questions/44143265/polymorphism-in-golang", "title": "Polymorphism in Golang?", "body": "<p>I am fairly new to Go and I have been doing OOP for a long time. Now, I understand that inheritance is done via composition but ... I'd like to send a specialization in a function expecting a generalization as such:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype A struct {\n    ONE int\n}\n\ntype B struct {\n    A\n    ANOTHER int\n}\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n\n    a := A{1}\n    b := B{a, 2}\n\n    fmt.Println(a.ONE)\n    fmt.Println(b.ANOTHER)\n\n    takeA(&amp;b)\n}\n\nfunc takeA(a *A) {\n\n    fmt.Println(a.ONE)\n}\n</code></pre>\n\n<p>Sure, I can do <code>takeA(&amp;b.A)</code> but it defeats the hierarchy I am trying to set up as some A fields/method could be shadowed in B.</p>\n\n<p>Is there a way around this? Or should I create a dumb interface such as:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype A struct {\n    ONE int\n}\n\nfunc (a A) getOne() int{\n    return a.ONE\n}\n\ntype B struct {\n    A\n    ANOTHER int\n}\n\ntype HasOne interface {\n    getOne() int\n}\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n\n    a := A{1}\n    b := B{a, 2}\n\n    fmt.Println(a.ONE)\n    fmt.Println(b.ANOTHER)\n\n    takeA(b)\n}\n\nfunc takeA(a HasOne) {\n\n    fmt.Println(a.getOne())\n}\n</code></pre>\n"}, {"tags": ["node.js", "go", "codenvy", "eclipse-che"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1495566737, "post_id": 44142732, "comment_id": 75304228, "body": "That error means that gdb is either not installed, or not in your <code>PATH</code>. Have you looked at <a href=\"https://github.com/derekparker/delve\" rel=\"nofollow noreferrer\">Delve</a> at all?"}, {"owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1495566815, "post_id": 44142732, "comment_id": 75304268, "body": "Thanks, I did look at delve: <a href=\"https://stackoverflow.com/questions/43987476/unable-to-run-delve-in-eclipse-che-could-not-launch-process-operation-not-per\" title=\"unable to run delve in eclipse che could not launch process operation not per\">stackoverflow.com/questions/43987476/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 470, "user_id": 2331089, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/758cee5a720d8e644a7a047386e4b998?s=128&d=identicon&r=PG&f=1", "display_name": "bianchi", "link": "https://stackoverflow.com/users/2331089/bianchi"}, "is_accepted": false, "score": 1, "last_activity_date": 1495641437, "last_edit_date": 1495641437, "creation_date": 1495639932, "answer_id": 44162795, "question_id": 44142732, "link": "https://stackoverflow.com/questions/44142732/eclipse-che-bash-gdb-command-not-found/44162795#44162795", "title": "Eclipse Che: bash: gdb: command not found", "body": "<p>Correct, neither gdb nor gdbserver are installed in go or nodejs stacks. You can easily build a custom stack using the following recipe:</p>\n\n<pre><code>FROM eclipse/node\nRUN sudo apt-get update &amp;&amp; sudo apt-get install gdb\n</code></pre>\n\n<p>You can also install gdb and gdbserver right in a running workspace, using the same package manager commands. These stacks are based on Ubuntu 16.04</p>\n"}], "owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 509, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1495641437, "creation_date": 1495565105, "last_edit_date": 1495569545, "question_id": 44142732, "link": "https://stackoverflow.com/questions/44142732/eclipse-che-bash-gdb-command-not-found", "title": "Eclipse Che: bash: gdb: command not found", "body": "<p>Che seems promising but is anyone using it or does it work for anyone at all?</p>\n\n<p>Once in a while I try to make Che debugger work with golang or nodejs. I do belive Che is the way for devs using docker, I just need a workflow.</p>\n\n<p>I run Che in docker described here: <a href=\"https://eclipse.org/che/docs/setup/getting-started/index.html#syntax\" rel=\"nofollow noreferrer\">https://eclipse.org/che/docs/setup/getting-started/index.html#syntax</a></p>\n\n<p>I am unable to get delve <a href=\"https://stackoverflow.com/questions/43987476/unable-to-run-delve-in-eclipse-che-could-not-launch-process-operation-not-per\">debugger</a> to work so today I tried gdb.</p>\n\n<p>Just using the go stack(web-go-simple) and edited the debug command:</p>\n\n<pre><code>go build -gcflags \"-N -l\" -o gdb_sandbox main.go\n\ngdb gdb_sandbox\n</code></pre>\n\n<p>It gives <code>bash: gdb: command not found</code></p>\n\n<p>If I edit the run / Debug Configuration it complains about <code>cannot connect to localhost:8080</code>. I set the port to 8080 and binary path to:</p>\n\n<pre><code>${current.project.path}/web-go-simple/gdb_sandbox\n</code></pre>\n\n<p>I just want to debug go - anyone done this?</p>\n\n<p>I also tried using nodejs: <a href=\"https://eclipse.org/che/docs/ide/debug/#nodejs\" rel=\"nofollow noreferrer\">https://eclipse.org/che/docs/ide/debug/#nodejs</a>\nThis also can not connect.</p>\n"}, {"tags": ["go", "godeps"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1495563923, "post_id": 44142289, "comment_id": 75302752, "body": "please read <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2251, "user_id": 5238892, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b27ed4cd2a119f7efeaad687f11403cb?s=128&d=identicon&r=PG&f=1", "display_name": "Simin Jie", "link": "https://stackoverflow.com/users/5238892/simin-jie"}, "edited": false, "score": 0, "creation_date": 1525163840, "post_id": 44142345, "comment_id": 87244107, "body": "Such as for <code>GOPATH=&#47;Users&#47;user&#47;go</code>, you need to under <code>&#47;Users&#47;user&#47;go&#47;src&#47;*</code>."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 7, "last_activity_date": 1495563788, "creation_date": 1495563788, "answer_id": 44142345, "question_id": 44142289, "link": "https://stackoverflow.com/questions/44142289/not-in-any-gopath-while-using-dep-init/44142345#44142345", "title": "Not in any GOPATH while using dep init", "body": "<p>Your <code>GOPATH</code> points to a root directory containing <code>bin</code>, <code>pkg</code>, and <code>src</code> subdirectories, with project source under <code>src</code>. Tools like <code>godep</code> and <code>go install</code> expect to operate on source, not on your entire <code>GOPATH</code>, so must be run on some path under <code>$GOPATH/src</code>.</p>\n"}], "owner": {"reputation": 7503, "user_id": 1059273, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/f49fd78553be0a74aef8736864937b5d?s=128&d=identicon&r=PG", "display_name": "cjds", "link": "https://stackoverflow.com/users/1059273/cjds"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8978, "favorite_count": 0, "accepted_answer_id": 44142345, "answer_count": 1, "score": 4, "last_activity_date": 1495563788, "creation_date": 1495563638, "question_id": 44142289, "link": "https://stackoverflow.com/questions/44142289/not-in-any-gopath-while-using-dep-init", "title": "Not in any GOPATH while using dep init", "body": "<p>I'm trying to use <code>godep</code> to install my dependencies but I can't seem to get it to work. When I run GODEP init, I get the following error</p>\n\n<blockquote>\n  <p>determineProjectRoot: /home/cjds/development/core/data-service not in any $GOPATH</p>\n</blockquote>\n\n<p>But my GOPATH definitely contains that path. This is my whole go path</p>\n\n<blockquote>\n  <p>/home/cjds/development/core/data-service</p>\n</blockquote>\n\n<p><code>go install</code> causes the following error, which may be the root of the problem:</p>\n\n<blockquote>\n  <p>no buildable Go source files in /home/cjds/development/core/data-service</p>\n</blockquote>\n\n<p>The folder structure however has a <code>src</code> folder, and then a <code>main</code> folder and then my whole Go project</p>\n\n<blockquote>\n  <p>-/home/cjds/development/core/data-service/src/main/my-go-files.go</p>\n</blockquote>\n"}, {"tags": ["string", "go", "random"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1495563624, "post_id": 44142182, "comment_id": 75302593, "body": "You need to use the <code>strconv</code> package to convert the <code>rand.Intn(9)</code> to the actual string value."}, {"owner": {"reputation": 442, "user_id": 7074136, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RDvnf.jpg?s=128&g=1", "display_name": "David Barranco", "link": "https://stackoverflow.com/users/7074136/david-barranco"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1495563816, "post_id": 44142182, "comment_id": 75302696, "body": "Done. How couldn&#39;t I remember that? :facepalm:"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1495563935, "post_id": 44142182, "comment_id": 75302759, "body": "Remember that behind the scenes, a <code>string</code> is just a <code>[]byte</code>. When you tried to cast the <code>int</code> to a <code>string</code>, it just took the raw number <code>2</code> (which isn&#39;t a character) and tried to display it as unicode."}, {"owner": {"reputation": 442, "user_id": 7074136, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RDvnf.jpg?s=128&g=1", "display_name": "David Barranco", "link": "https://stackoverflow.com/users/7074136/david-barranco"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1495564053, "post_id": 44142182, "comment_id": 75302827, "body": "true, need to work more with the unicode package of go to understand that better, thanks for the fast help :)"}], "answers": [{"comments": [{"owner": {"reputation": 442, "user_id": 7074136, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RDvnf.jpg?s=128&g=1", "display_name": "David Barranco", "link": "https://stackoverflow.com/users/7074136/david-barranco"}, "edited": false, "score": 0, "creation_date": 1495563904, "post_id": 44142306, "comment_id": 75302741, "body": "Thanks for the answer! not sure which is fast if using Itoa or this!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 442, "user_id": 7074136, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RDvnf.jpg?s=128&g=1", "display_name": "David Barranco", "link": "https://stackoverflow.com/users/7074136/david-barranco"}, "edited": false, "score": 1, "creation_date": 1495564069, "post_id": 44142306, "comment_id": 75302846, "body": "@DavidBarranco: Itoa does more work so this is inherently going to be faster, not that it really matters much in the context of string manipulations."}, {"owner": {"reputation": 442, "user_id": 7074136, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RDvnf.jpg?s=128&g=1", "display_name": "David Barranco", "link": "https://stackoverflow.com/users/7074136/david-barranco"}, "edited": false, "score": 0, "creation_date": 1495565781, "post_id": 44142306, "comment_id": 75303746, "body": "Thanks for the tips, finally added using this way. Best regards!"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1495563679, "creation_date": 1495563679, "answer_id": 44142306, "question_id": 44142182, "link": "https://stackoverflow.com/questions/44142182/golang-replacing-string-characters-by-numbers-golang/44142306#44142306", "title": "golang - Replacing string characters by numbers golang", "body": "<p>There are no printable characters in the range <code>[0, 9)</code>. If you want an ascii value, start at 48 (<code>'0'</code>). You probably want to include 9 too, so use <code>rand.Intn(10)</code></p>\n\n<pre><code>string('0' + rand.Intn(10))\n</code></pre>\n"}], "owner": {"reputation": 442, "user_id": 7074136, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RDvnf.jpg?s=128&g=1", "display_name": "David Barranco", "link": "https://stackoverflow.com/users/7074136/david-barranco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "accepted_answer_id": 44142306, "answer_count": 1, "score": 0, "last_activity_date": 1495563851, "creation_date": 1495563284, "question_id": 44142182, "link": "https://stackoverflow.com/questions/44142182/golang-replacing-string-characters-by-numbers-golang", "title": "golang - Replacing string characters by numbers golang", "body": "<p>I'm trying to run this piece of code to replace a character of a string by a random number:</p>\n\n<pre><code>//Get the position between 0 and the length of the string-1  to insert a random number\n    position := rand.Intn(count - 1)\n    strings.Replace(RandomString,)\n\n    fmt.Println(\"Going to change the position number: \", position)\n    //Insert a random number between [0-9] in the position\n    RandomString = RandomString[:position] + string(rand.Intn(9)) + RandomString[position+1:]\n</code></pre>\n\n<p>When this is executed, the output is:</p>\n\n<pre><code>I was going to generate..  ljFsrPaUvmxZFFw\nGoing to change the position number:  2\nRandom string:  lsrPaUvmxZFFw\n</code></pre>\n\n<p>Could anyone help me about inserting that number inside the desired string position? I didn't find any duplicate case of this.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1495553613, "post_id": 44139161, "comment_id": 75296723, "body": "For playground internals, see: <a href=\"https://blog.golang.org/playground\" rel=\"nofollow noreferrer\">blog.golang.org/playground</a>. Otherwise, if you want to run Go code, compile and run the Go code."}], "answers": [{"tags": [], "owner": {"reputation": 18452, "user_id": 72443, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/Nu3zC.jpg?s=128&g=1", "display_name": "Hannoun Yassir", "link": "https://stackoverflow.com/users/72443/hannoun-yassir"}, "is_accepted": false, "score": 4, "last_activity_date": 1495554742, "last_edit_date": 1495554742, "creation_date": 1495553650, "answer_id": 44139228, "question_id": 44139161, "link": "https://stackoverflow.com/questions/44139161/how-to-run-function-dynamically-in-golang/44139228#44139228", "title": "How to run function dynamically in golang?", "body": "<p>The code is sent to a server to be compiled and executed then the output is sent back to the client (the browser).</p>\n\n<p>There is an article on how it works : <a href=\"https://blog.golang.org/playground\" rel=\"nofollow noreferrer\">https://blog.golang.org/playground</a></p>\n"}, {"comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1495573014, "post_id": 44140818, "comment_id": 75307395, "body": "Incidentally, for an example of how to do this, check out the mockgen portion of Gomock: <a href=\"https://github.com/golang/mock/tree/master/mockgen\" rel=\"nofollow noreferrer\">github.com/golang/mock/tree/master/mockgen</a>.  That&#39;s exactly how that library generates mocks, it creates a new go program using templates, then compiles and executes it to generate the actual mock code."}, {"owner": {"reputation": 309, "user_id": 4517341, "user_type": "registered", "accept_rate": 36, "profile_image": "https://graph.facebook.com/100000867481103/picture?type=large", "display_name": "Kumar Siva", "link": "https://stackoverflow.com/users/4517341/kumar-siva"}, "edited": false, "score": 0, "creation_date": 1495661073, "post_id": 44140818, "comment_id": 75353420, "body": "Which one is faster in execution? Whether scripting language or create, compile and run the golang?"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1495663667, "post_id": 44140818, "comment_id": 75354390, "body": "Without details of your use case, it is hard to say. The compiling option is going to have a longer time to start up, but may run faster. If it matters, benchmark it."}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 1, "last_activity_date": 1495558452, "creation_date": 1495558452, "answer_id": 44140818, "question_id": 44139161, "link": "https://stackoverflow.com/questions/44139161/how-to-run-function-dynamically-in-golang/44140818#44140818", "title": "How to run function dynamically in golang?", "body": "<p>Go code is a bit hard to run dynamically. You can \"check\" the syntax with the <a href=\"https://golang.org/pkg/go/parser/\" rel=\"nofollow noreferrer\">parser</a> package, although using those packages under <code>go</code> can be a bit tricky. To actually run it, you would likely need to:</p>\n\n<ol>\n<li>Save the function to a temporary directory, possibly generating a <code>main</code> to invoke it.</li>\n<li>exec the go compiler to generate an executable</li>\n<li>Run the compiled binary, possibly piping stdin and stdout to the parent process.</li>\n<li>Communicate with it over stdin/stdout until it exits</li>\n</ol>\n\n<p>This is obviously a big runaround and quite a pain.</p>\n\n<p>If go is not strictly required there are multiple <a href=\"https://github.com/avelino/awesome-go#embeddable-scripting-languages\" rel=\"nofollow noreferrer\">scripting languages</a> with go implementations. If you supply javascript or lua or whatever code, you can run that dynamically.</p>\n"}], "owner": {"reputation": 309, "user_id": 4517341, "user_type": "registered", "accept_rate": 36, "profile_image": "https://graph.facebook.com/100000867481103/picture?type=large", "display_name": "Kumar Siva", "link": "https://stackoverflow.com/users/4517341/kumar-siva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1299, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1495558452, "creation_date": 1495553455, "question_id": 44139161, "link": "https://stackoverflow.com/questions/44139161/how-to-run-function-dynamically-in-golang", "title": "How to run function dynamically in golang?", "body": "<p>How internally play.golang.org compiles and run the go code? </p>\n\n<p>I have a function as string. I need to check the syntax and run the code inside golang main function.</p>\n"}, {"tags": ["qt", "go", "raspberry-pi"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1495551766, "post_id": 44138443, "comment_id": 75295394, "body": "Have you tried setting <code>CC_FOR_TARGET</code> or <code>CXX_FOR_TARGET</code>? See <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">golang.org/cmd/cgo</a>"}, {"owner": {"reputation": 197, "user_id": 7995484, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bc8536b73ceadb9415a083decb90ce09?s=128&d=identicon&r=PG&f=1", "display_name": "JosephCenk", "link": "https://stackoverflow.com/users/7995484/josephcenk"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1495552109, "post_id": 44138443, "comment_id": 75295710, "body": "@JimB No, I did not try these variables CC_FOR_TARGET or CXX_FOR_TARGET... CC_FOR_TARGET is equal to CC and CXX_FOR_TARGET is equal to CXX"}], "owner": {"reputation": 197, "user_id": 7995484, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bc8536b73ceadb9415a083decb90ce09?s=128&d=identicon&r=PG&f=1", "display_name": "JosephCenk", "link": "https://stackoverflow.com/users/7995484/josephcenk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 251, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1495551624, "creation_date": 1495551624, "question_id": 44138443, "link": "https://stackoverflow.com/questions/44138443/go-qt-binding-g-error-unrecognized-command-line-option-marm", "title": "GO-QT Binding g++: error: unrecognized command line option \u2018-marm\u2019", "body": "<p>I am using QT Binding/Wrapper for Go in my project. Project is compiling fine for amd64 but when I try to compile project for arm devices, it gives me below error </p>\n\n<pre><code> github.com/therecipe/qt/core\n# github.com/therecipe/qt/core\n g++: error: unrecognized command line option \u2018-marm\u2019\n</code></pre>\n\n<hr>\n\n<p>Please find below my go environment variables setup</p>\n\n<pre><code>GOARCH=\"arm\"\nGOBIN=\"\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/minhaj/GoLang\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/linux_amd64\"\nGCCGO=\"gccgo\"\nGOARM=\"\"\nCC=\"arm-linux-gnueabi-gcc\"\nGOGCCFLAGS=\"-fPIC -marm -pthread -fmessage-length=0 -fdebug-prefix-\n map=/tmp/go-build277718108=/tmp/go-build -gno-record-gcc-switches\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\nPKG_CONFIG=\"pkg-config\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\n</code></pre>\n"}, {"tags": ["sockets", "go", "tcp", "byte"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1495549984, "post_id": 44137432, "comment_id": 75293915, "body": "Are you checking the error from <code>Dial</code> on the client side? I am assuming the client is connecting if things are running the ReceiveSnapshot parts."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1495550058, "post_id": 44137432, "comment_id": 75293967, "body": "Receiving another snapshot on error feels odd as well, but probably isn&#39;t your issue."}, {"owner": {"reputation": 251, "user_id": 7923990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ad61ca14b98f6cde3a7109b252c544c?s=128&d=identicon&r=PG&f=1", "display_name": "icarbajo", "link": "https://stackoverflow.com/users/7923990/icarbajo"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1495550223, "post_id": 44137432, "comment_id": 75294109, "body": "@OliviaRuth Yes, <code>Dial</code> works fine. If err != nil, conn.Write([]byte) returns the &quot;1&quot;, the client receives it and close the connection. The problem is when err == &lt;nil&gt;, the client receive anything..."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1495550322, "post_id": 44137432, "comment_id": 75294196, "body": "Why is buf of size 1024 on the client side? Does it change at all if you make it size 1?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1495550326, "post_id": 44137432, "comment_id": 75294200, "body": "If there&#39;s a connection error in <code>ReceiveSnapshot</code>, you&#39;re still trying to write to the connection, which isn&#39;t going to get sent anywhere."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1495550597, "post_id": 44137928, "comment_id": 75294414, "body": "Whenever you <code>Read</code> you always need to check <code>n</code>, because you can read into buff and get EOF in the same operation."}, {"owner": {"reputation": 251, "user_id": 7923990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ad61ca14b98f6cde3a7109b252c544c?s=128&d=identicon&r=PG&f=1", "display_name": "icarbajo", "link": "https://stackoverflow.com/users/7923990/icarbajo"}, "edited": false, "score": 0, "creation_date": 1495550689, "post_id": 44137928, "comment_id": 75294492, "body": "If the first function <code>ReceiveSnapshot</code> returns an error, conn.Write([]byte(&quot;1&quot;)) works fine and the client receive the &quot;1&quot; and continue with the if n != 0 {... zfs.SendSnapshotIncremental...}. But, if the first <code>ReceiveSnapshot</code> does not return an error, (conn.Write[]byte(&quot;0&quot;)) does not work and the client receive anything..."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 251, "user_id": 7923990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ad61ca14b98f6cde3a7109b252c544c?s=128&d=identicon&r=PG&f=1", "display_name": "icarbajo", "link": "https://stackoverflow.com/users/7923990/icarbajo"}, "edited": false, "score": 0, "creation_date": 1495550829, "post_id": 44137928, "comment_id": 75294619, "body": "That seems completely backwards from what you would normally want to do, @icvallejo. On an error condition, you continue writing data to sockets that may be in closed/error states."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1495550831, "post_id": 44137928, "comment_id": 75294620, "body": "@OliviaRuth: that&#39;s still going to skip <code>n &gt; 0 &amp;&amp; err == io.EOF</code>, just process <code>buff[:n]</code> (or check <code>n &gt; 0</code>) then check <code>err</code>."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1495550918, "post_id": 44137928, "comment_id": 75294685, "body": "Oh, I see what you mean now. I don&#39;t like that behavior at all."}, {"owner": {"reputation": 251, "user_id": 7923990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ad61ca14b98f6cde3a7109b252c544c?s=128&d=identicon&r=PG&f=1", "display_name": "icarbajo", "link": "https://stackoverflow.com/users/7923990/icarbajo"}, "edited": false, "score": 0, "creation_date": 1495550997, "post_id": 44137928, "comment_id": 75294744, "body": "@OliviaRuth If <code>ReceiveSnapshot</code> returns an error it&#39;s not a problem. It&#39;s only to verify if the Snapshot that it has received exist or not."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1495551045, "post_id": 44137928, "comment_id": 75294772, "body": "But it could be a connectivity problem as well. How are you so sure &quot;The client receives nothing&quot;? How are you running/debugging this?"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1495551671, "post_id": 44137928, "comment_id": 75295305, "body": "ok, this answer is not the issue then. I want to blame something like <code>SetNoDelay</code>, but the default should not be causing this."}, {"owner": {"reputation": 251, "user_id": 7923990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ad61ca14b98f6cde3a7109b252c544c?s=128&d=identicon&r=PG&f=1", "display_name": "icarbajo", "link": "https://stackoverflow.com/users/7923990/icarbajo"}, "edited": false, "score": 0, "creation_date": 1495551703, "post_id": 44137928, "comment_id": 75295328, "body": "@OliviaRuth I edited the original post to explain the problem better"}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 1, "last_activity_date": 1495550962, "last_edit_date": 1495550962, "creation_date": 1495550454, "answer_id": 44137928, "question_id": 44137432, "link": "https://stackoverflow.com/questions/44137432/conn-net-conn-does-not-write-always-on-socket/44137928#44137928", "title": "conn (net.Conn) does not write always on socket", "body": "<p>I believe the problem is in these lines:</p>\n\n<pre><code>buff := make([]byte, 1024)\nn, _ := conn.Read(buff)\n</code></pre>\n\n<p>n in this case is the <strong>number</strong> of bytes read, not the value of any of them.</p>\n\n<p>I'd do:</p>\n\n<pre><code>buff := make([]byte, 1)\nn,err := conn.Read(buff)\nbuff = buff[:n]\nif len(buff) == 0 {\n   //error\n}\n\nif(buff[0] != 0){...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 251, "user_id": 7923990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ad61ca14b98f6cde3a7109b252c544c?s=128&d=identicon&r=PG&f=1", "display_name": "icarbajo", "link": "https://stackoverflow.com/users/7923990/icarbajo"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1495632903, "post_id": 44155554, "comment_id": 75336286, "body": "@JimB But under that premise, we can&#39;t use a socket TCP to send data because it exists the possibility that the tunnel will break. I dont&#39;t really understand what you want to say :S"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1495633146, "post_id": 44155554, "comment_id": 75336464, "body": "No, it just means that messages aren&#39;t read as atomic units, because there&#39;s no such thing as a &quot;message&quot; in TCP. You need a framing protocol of some sort to delimit the messages so that you know you&#39;ve read only the part of the message you intended, and part or more than 1 message. Your protocol could simply be &quot;send one byte&quot; and you could read and compare that byte instead of throwing it away."}, {"owner": {"reputation": 251, "user_id": 7923990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ad61ca14b98f6cde3a7109b252c544c?s=128&d=identicon&r=PG&f=1", "display_name": "icarbajo", "link": "https://stackoverflow.com/users/7923990/icarbajo"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1495633441, "post_id": 44155554, "comment_id": 75336707, "body": "So you say, read the buffer and the extract the information to know if I received all message that I want receive. That is, I should change the conn.Write to &quot;1&quot; and &quot;22&quot; and read if I have received all of thats messages. That will be right @JimB?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1495633564, "post_id": 44155554, "comment_id": 75336805, "body": "Instead of adding extra logic to determine how much to read  for a simple binary message, just use 1 byte. Write <code>0</code> or <code>1</code>, then read a single byte and compare it to <code>0</code> or <code>1</code>."}], "tags": [], "owner": {"reputation": 251, "user_id": 7923990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ad61ca14b98f6cde3a7109b252c544c?s=128&d=identicon&r=PG&f=1", "display_name": "icarbajo", "link": "https://stackoverflow.com/users/7923990/icarbajo"}, "is_accepted": true, "score": 0, "last_activity_date": 1495637315, "last_edit_date": 1495637315, "creation_date": 1495621176, "answer_id": 44155554, "question_id": 44137432, "link": "https://stackoverflow.com/questions/44137432/conn-net-conn-does-not-write-always-on-socket/44155554#44155554", "title": "conn (net.Conn) does not write always on socket", "body": "<p>[Edit &amp; Solved]</p>\n\n<p>Several modifications to solve this...</p>\n\n<p><strong>Server:</strong></p>\n\n<pre><code>func handleRequest(conn net.Conn) {\n    // Number of snapshots in server side\n    take, _ := zfs.Snapshots(\"tank/replication\")\n    count := len(take)\n    if count &lt; 1 {\n        conn.Write([]byte(\"0\"))\n    } else {\n        conn.Write([]byte(\"1\"))\n    }\n\n    // Receive snapshot\n    zfs.ReceiveSnapshot(conn, \"tank/replication\")\n}\n</code></pre>\n\n<p><code>count</code> returns the number of snapshots that server has, so if there are nothing, the client will execute the case, in other case the default.</p>\n\n<p><strong>Client:</strong></p>\n\n<pre><code>func main() {\n    // Get the last two snapshots\n    take, _ := zfs.Snapshots(\"tank/test\")\n    snap := take[0].Name\n    ds1, _ := zfs.GetDataset(snap)\n    snap = take[1].Name\n    ds2, _ := zfs.GetDataset(snap)\n\n    // New server connection\n    conn, _ := net.Dial(\"tcp\", \"192.168.99.5:7766\")\n\n    // Read data of server side\n    buff := bufio.NewReader(conn)\n    n, _ := buff.ReadByte()\n\n    // Execute the correct case\n    switch string(n) {\n    case \"0\":\n        ds1.SendSnapshot(conn)\n        conn.Close()\n    default :\n        zfs.SendSnapshotIncremental(conn, ds1, ds2, zfs.IncrementalStream)\n        conn.Close()\n    }\n}\n</code></pre>\n\n<p>I don't know if it's so good this solution but it works!</p>\n"}], "owner": {"reputation": 251, "user_id": 7923990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ad61ca14b98f6cde3a7109b252c544c?s=128&d=identicon&r=PG&f=1", "display_name": "icarbajo", "link": "https://stackoverflow.com/users/7923990/icarbajo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1346, "favorite_count": 0, "accepted_answer_id": 44155554, "answer_count": 2, "score": 0, "last_activity_date": 1495637315, "creation_date": 1495549246, "last_edit_date": 1495551600, "question_id": 44137432, "link": "https://stackoverflow.com/questions/44137432/conn-net-conn-does-not-write-always-on-socket", "title": "conn (net.Conn) does not write always on socket", "body": "<p>I have done an application with a server and client to send information with a socket TCP</p>\n\n<p>The problem is, if the function zfs.ReceiveSnapshot (in server side) does not return an error (err == nil), <code>conn.Write([]byte(\"0\"))</code> does not work and the client does not receive any byte to continue and it cannot close the connection...</p>\n\n<p>I show you the code of server and client</p>\n\n<p><strong>Server:</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"net\"\n    \"github.com/mistifyio/go-zfs\"\n)\n\nfunc main() {\n    // Listen for incoming connections\n    l, _ := net.Listen(\"tcp\", \":7766\")\n\n    // Close the listener when the application closes\n    defer l.Close()\n    fmt.Println(\"Listening on port 7766...\")\n    for {\n        // Listen for an incoming connection.\n        conn, _ := l.Accept()\n        // Handle connections in a new goroutine.\n        go handleRequest(conn)\n    }\n}\n\n// Handles incoming requests\nfunc handleRequest(conn net.Conn) {\n    // Receive snapshot\n    _, err := zfs.ReceiveSnapshot(conn, \"tank/replication\")\n    if err != nil {\n        conn.Write([]byte(\"1\"))\n        zfs.ReceiveSnapshot(conn, \"tank/replication\")\n        conn.Close()\n    } else {\n        conn.Write([]byte(\"0\"))\n        conn.Close()\n    }\n}\n</code></pre>\n\n<p><strong>Client:</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"net\"\n    \"github.com/mistifyio/go-zfs\"\n)\n\nfunc main() {\n    conn, _ := net.Dial(\"tcp\", \"192.168.99.5:7766\")\n\n    for i := 0; i &lt; 1; i++ {\n        // Get all snapshots in tank/test\n        take, _ := zfs.Snapshots(\"tank/test\")\n\n        // Select snapshots\n        snap := take[0].Name\n        ds1, _ := zfs.GetDataset(snap)\n\n        // Send first snapshot\n        ds1.SendSnapshot(conn)\n        defer conn.Close()\n\n        buff := make([]byte, 1024)\n        n, _ := conn.Read(buff)\n\n        if n != 0 {\n            snap = take[1].Name\n            ds2, _ := zfs.GetDataset(snap)\n            zfs.SendSnapshotIncremental(conn, ds1, ds2, zfs.IncrementalStream)\n            conn.Close()\n        }\n    }\n}\n</code></pre>\n\n<p>[EDIT]:\nIf <code>ReceiveSnapshots</code> returns an error, conn.Write([]byte ) writes \"1\", the cliente receives it, execute SendSnapshotIncremental (it does if n != 0) and close the connection in client side... But, if <code>ReceiveSnapshot</code> does not return an error, conn.Write([]byte ) does not write \"0\" just only I close the connection in server side with ctrl+C</p>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1495548481, "post_id": 44137001, "comment_id": 75292830, "body": "In Logout you&#39;re printing a <code>**QNAP</code>, so the address is always going to be different. The stack trace will tell you exactly where you&#39;re dereferencing a nil pointer."}], "answers": [{"comments": [{"owner": {"reputation": 1501, "user_id": 6414477, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6a2c251e715864f098ebf4b4057848b1?s=128&d=identicon&r=PG&f=1", "display_name": "rhillhouse", "link": "https://stackoverflow.com/users/6414477/rhillhouse"}, "edited": false, "score": 0, "creation_date": 1495548851, "post_id": 44137125, "comment_id": 75293103, "body": "If I only print <code>qnap</code>, I get <code>&amp;{http:&#47;&#47;redacted.myqnapcloud.com:8080 MyUserName MyPassword u64nb1cr 0xc04205e990 {&#47;cgi-bin&#47;authLogin.cgi &#47;cgi-bin&#47;authLogout.cgi &#47;cgi-bin&#47;sys&#47;sysRequest.cgi &#47;cgi-bin&#47;misc&#47;misc_action.cgi &#47;cgi-bin&#47;my_cloud&#47;cloudRequest.cgi}}</code>, and not the memory address. How do I solve the nil pointer dereference, I have no idea where to even start looking."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1501, "user_id": 6414477, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6a2c251e715864f098ebf4b4057848b1?s=128&d=identicon&r=PG&f=1", "display_name": "rhillhouse", "link": "https://stackoverflow.com/users/6414477/rhillhouse"}, "edited": false, "score": 2, "creation_date": 1495548959, "post_id": 44137125, "comment_id": 75293166, "body": "@rhillhouse: if you want to print a memory address, use <code>%p</code>. Show where the nil pointer dereference is happening."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1495549628, "last_edit_date": 1495549628, "creation_date": 1495548489, "answer_id": 44137125, "question_id": 44137001, "link": "https://stackoverflow.com/questions/44137001/go-memory-address-changing/44137125#44137125", "title": "Go memory address changing", "body": "<p><code>&amp;</code> gives you the address of a variable. <code>&amp;q</code> in your <code>Logout</code> function gives you the address of <code>q</code>, which is a local variable. The <em>value</em> of that local variable is, in turn, an address, because <code>q</code> is itself a pointer (to a struct of type <code>QNAP</code>). The memory address that's printed being different is a red herring; your nil pointer dereference is the real issue. If you want the same address, you would print the value of <code>q</code>, not <code>&amp;q</code>; and in <code>main()</code> you would likewise print the value of <code>qnap</code>, not <code>&amp;qnap</code>, for the same reason.</p>\n\n<p>Here's an example that might make things clearer: <a href=\"https://play.golang.org/p/pDpL0-GYuM\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pDpL0-GYuM</a></p>\n"}], "owner": {"reputation": 1501, "user_id": 6414477, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6a2c251e715864f098ebf4b4057848b1?s=128&d=identicon&r=PG&f=1", "display_name": "rhillhouse", "link": "https://stackoverflow.com/users/6414477/rhillhouse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 553, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1495549628, "creation_date": 1495548148, "question_id": 44137001, "link": "https://stackoverflow.com/questions/44137001/go-memory-address-changing", "title": "Go memory address changing", "body": "<p>I am very new to go, so please bear with me here. I am trying to interact with my QNAP NAS through go. So far I can log in, but not back out. It seems like the memory address of <code>qnap</code> changes:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/url\"\n    \"fmt\"\n    \"net/http\"\n    \"encoding/base64\"\n    \"io/ioutil\"\n    \"encoding/xml\"\n    \"errors\"\n)\n\n// QNAP REST API\ntype QNAPAPI struct {\n    Login,\n    Logout,\n    SysReq,\n    MiscAct,\n    MyCloud string\n}\n\n// QNAP NAS info\ntype QNAP struct {\n    URI, Username, Password, SID string\n    Client *http.Client\n    API QNAPAPI\n}\n\n// Assign API endpoints to struct\nfunc initializeQNAPApi(API *QNAPAPI) QNAPAPI {\n    API.Login = \"/cgi-bin/authLogin.cgi\"\n    API.Logout = \"/cgi-bin/authLogout.cgi\"\n    API.SysReq = \"/cgi-bin/sys/sysRequest.cgi\"\n    API.MiscAct = \"/cgi-bin/misc/misc_action.cgi\"\n    API.MyCloud = \"/cgi-bin/my_cloud/cloudRequest.cgi\"\n    return *API\n}\n\n// Login to NAS\nfunc (q *QNAP) Login() (string, error) {\n    // Match fields in XML\n    type LoginResponse struct {\n        AuthPassed int `xml:\"authPassed\"`\n        SID        string `xml:\"authSid\"`\n    }\n    // Create data structure to bind XML to\n    loginResponse := LoginResponse{}\n\n    // Prepare POST headers\n    postData := url.Values{\n        \"user\": {q.Username},\n        \"serviceKey\": {\"1\"},\n        \"pwd\": {base64.StdEncoding.EncodeToString([]byte(q.Password))},\n    }\n\n    res, err := q.Client.PostForm(q.URI + q.API.Login, postData)\n    if err != nil {\n        return \"\", err\n    }\n    defer res.Body.Close()\n\n    responseData, err := ioutil.ReadAll(res.Body)\n    if err != nil {\n        return \"\", err\n    }\n\n    xml.Unmarshal(responseData, &amp;loginResponse)\n    if loginResponse.AuthPassed == 1 {\n        q.SID = loginResponse.SID\n        return loginResponse.SID, nil\n    }\n    return \"\", errors.New(\"Unable to login!\")\n}\n\n// Logout from NAS\nfunc (q *QNAP) Logout() (string, error) {\n    fmt.Println(&amp;q)\n    postData := url.Values{\n        \"logout\": {\"1\"},\n        \"sid\": {q.SID},\n    }\n\n    // PROBLEM HERE???\n    res, err := q.Client.PostForm(q.URI + q.API.Logout, postData)\n    defer res.Body.Close()\n\n\n    fmt.Println(err)\n    fmt.Println(res)\n    responseData, err := ioutil.ReadAll(res.Body)\n    fmt.Println(err)\n    fmt.Println(string(responseData))\n    return \"x\", nil\n}\n\n\n\nfunc main() {\n    httpClient := &amp;http.Client{}\n\n    qnap := &amp;QNAP{\n        URI: \"http://redacted.myqnapcloud.com:8080\",\n        Username: \"MyUserName\",\n        Password: \"MyPassword\",\n        Client: httpClient,\n        API: initializeQNAPApi(&amp;QNAPAPI{}),\n    }\n    fmt.Println(&amp;qnap)\n    sid, err := qnap.Login()\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Printf(\"Logged in with SID: %s\\n\", sid)\n    // MEMORY ADDRESS CHANGES - WHY???\n    fmt.Println(&amp;qnap)\n    qnap.Logout()\n\n}\n</code></pre>\n\n<p>This code prints the following:</p>\n\n<pre><code>0xc042060020\nLogged in with SID: jli2wt7t\n0xc042060020\n0xc042004028\n</code></pre>\n\n<p>I am not sure why the address changes right before the <code>Logout</code> method.</p>\n\n<p>I get the following error:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xc0000005 code=0x0 addr=0x40 pc=0x5ed063]\n\ngoroutine 1 [running]:\nmain.(*QNAP).Logout(0xc04204a780, 0x0, 0x0, 0x0, 0x0)\n    C:/Users/redacted/test.go:85 +0x303\nmain.main()\n    C:/Users/redacted/test.go:115 +0x44e\nexit status 2\n</code></pre>\n"}, {"tags": ["xml", "go", "protocol-buffers"], "owner": {"reputation": 1865, "user_id": 2670926, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/525181988/picture?type=large", "display_name": "Helge Talvik S&#246;derstr&#246;m", "link": "https://stackoverflow.com/users/2670926/helge-talvik-s%c3%b6derstr%c3%b6m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 188, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1495543673, "creation_date": 1495543673, "question_id": 44135302, "link": "https://stackoverflow.com/questions/44135302/parsing-xml-into-existing-objects-in-golang", "title": "Parsing XML into existing objects in golang", "body": "<p>I'm using <code>protobuf</code> in Go to send data between microservices, and I have a question about an adapter I'm currently building.</p>\n\n<p>I have <code>protobuf</code> objects created using <code>protoc</code> in the target system. Now I have XML files provided by an external party that I want to translate into those <code>protobuf</code> objects and send them in.</p>\n\n<p>In general when parsing XML in Go, you would obviously do something like:</p>\n\n<pre><code>type MyType struct {\n    MyValue string `xml:\"my_value,attr\"`\n}\n</code></pre>\n\n<p>However, since I already gave the objects, I would like to avoid having to duplicate them all just to have to do something like:</p>\n\n<pre><code>func main() {\n    mt := mt.Parse()\n\n    pbobj.MyValue      = mt.MyValue\n    pbobj.MyOtherValue = mt.MyOtherValue\n    // and on and on and on\n}\n</code></pre>\n\n<p>What is the best way to handle this? Should I create duplicate objects and map them, or can I just apply some kind of XML-tag mapper to the already-existing objects created from <code>protoc</code>?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 1884, "user_id": 1520097, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/03c7c836f89cac7b06dbbcd4aa08ee4c?s=128&d=identicon&r=PG", "display_name": "Alex Voskresenskiy", "link": "https://stackoverflow.com/users/1520097/alex-voskresenskiy"}, "edited": false, "score": 0, "creation_date": 1495551840, "post_id": 44136395, "comment_id": 75295463, "body": "thanks for your reply! Well, that&#39;s quity similar to what i wanted to implement. The question is the same: how do i retrieve history for, say, some period of time? I&#39;ll have to search in 3 array properties and that&#39;ll be not so fast as searching in one, won&#39;t it? That&#39;s why i moved from RDBMS to NoSQL."}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "reply_to_user": {"reputation": 1884, "user_id": 1520097, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/03c7c836f89cac7b06dbbcd4aa08ee4c?s=128&d=identicon&r=PG", "display_name": "Alex Voskresenskiy", "link": "https://stackoverflow.com/users/1520097/alex-voskresenskiy"}, "edited": false, "score": 0, "creation_date": 1495552156, "post_id": 44136395, "comment_id": 75295753, "body": "You could store those objects separately then, but you should be doing it in a different collection for each object. The approach you have in your questions more resembles a RDBMS than a document-based store. Can you explain further why you felt you needed to make that transition?"}, {"owner": {"reputation": 1884, "user_id": 1520097, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/03c7c836f89cac7b06dbbcd4aa08ee4c?s=128&d=identicon&r=PG", "display_name": "Alex Voskresenskiy", "link": "https://stackoverflow.com/users/1520097/alex-voskresenskiy"}, "edited": false, "score": 0, "creation_date": 1495552599, "post_id": 44136395, "comment_id": 75296061, "body": "Main problem with RDBMS for me was write (insert) efficiency. I plan to implement new versions of microservices using Go+Mongo and most of them must handle 10k+ inserts per second, where most of inserts are these events, stored as history of changes of some objects, which then are included in some reports (most of them are weekly/daily, but users also can make a report for period of time). Based on my experience, RDBMS are quite slow here and they don&#39;t give these schema-less freedom. So, my main idea was to store this differently-typed objects in single collection with, maybe, epoch-based id."}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "reply_to_user": {"reputation": 1884, "user_id": 1520097, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/03c7c836f89cac7b06dbbcd4aa08ee4c?s=128&d=identicon&r=PG", "display_name": "Alex Voskresenskiy", "link": "https://stackoverflow.com/users/1520097/alex-voskresenskiy"}, "edited": false, "score": 0, "creation_date": 1495552911, "post_id": 44136395, "comment_id": 75296265, "body": "Just keep in mind that collections should only hold one type of object. What if you did two collections, one for <code>Users</code> and one for <code>Events</code>? The <code>User</code> will have the structure I proposed in my answer, and then <code>Event</code> could have all the fields you need among the three different types + a <code>Type</code> field to let you know why kind of event it is. This way you always get the events for a user, and you can search among the events for certain ones quickly."}, {"owner": {"reputation": 1884, "user_id": 1520097, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/03c7c836f89cac7b06dbbcd4aa08ee4c?s=128&d=identicon&r=PG", "display_name": "Alex Voskresenskiy", "link": "https://stackoverflow.com/users/1520097/alex-voskresenskiy"}, "edited": false, "score": 0, "creation_date": 1495553052, "post_id": 44136395, "comment_id": 75296349, "body": "That&#39;s exactly what i wanted to do! But i don&#39;t understand, how can i put struct type into Type field in mongo (using mgo or some other go-way). Do i need to manually fill these Type field in go struct?"}], "tags": [], "owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "is_accepted": true, "score": 0, "last_activity_date": 1495553497, "last_edit_date": 1495553497, "creation_date": 1495546516, "answer_id": 44136395, "question_id": 44134844, "link": "https://stackoverflow.com/questions/44134844/how-to-work-with-multiple-types-in-single-collection-with-mgo/44136395#44136395", "title": "How to work with multiple types in single collection with mgo", "body": "<p>What's nice about a non-relational database is that a little redundancy is OK and is faster for retrieval since you're not joining things together. You could just add your bottom three objects as properties on your <code>User</code> in whatever fashion makes sense for you and your data. Then you wouldn't need to store the <code>UserId</code> on those objects either.</p>\n\n<p>If you need to search over the <code>Events</code> quickly, you could create another collection to hold them. You'd be inserting to two collections, but retrieval times/logic should be pretty good/easy to write.</p>\n\n<p>Your new <code>Event</code> would be something like:</p>\n\n<pre><code>type UserEventType int\n\nconst (\n    Created UserEventType = iota\n    Deleted\n    Updated\n)\n\ntype UserEvent struct {\n    UserId               bson.ObjectId `json:\"id\" bson:\"_id\"`\n    CreatedEpoch         time.Time     `json:\"created_epoch\" bson:\"created_epoch\"`\n    //id of user that made a change\n    IssuedByUserId       bson.ObjectId `json:\"issuedby_userid\" bson:\"issuedby_userid\"`\n    ChangedFieldName     string        `json:\"changed_field_name,omitempty\" bson:\"changed_field_name,omitempty\"`\n    NewChangedFieldValue string     `json:\"new_changed_field_value,omitempty\" bson:\"new_changed_field_value,omitempty\"`\n    EventType            UserEventType `json:\"user_event_type\" bson:\"user_event_type\"`\n}\n</code></pre>\n\n<p>Notice the <code>omitempty</code> on the fields that are optional depending on the type of event.</p>\n\n<p>You really aren't supposed to store different objects in the same collection. Here's a line from the Mongo documentation:</p>\n\n<blockquote>\n  <p>MongoDB stores documents in collections. Collections are analogous to tables in relational databases.</p>\n</blockquote>\n\n<p>In case you aren't familiar with relational databases, a table would essentially represent one type of object.</p>\n"}], "owner": {"reputation": 1884, "user_id": 1520097, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/03c7c836f89cac7b06dbbcd4aa08ee4c?s=128&d=identicon&r=PG", "display_name": "Alex Voskresenskiy", "link": "https://stackoverflow.com/users/1520097/alex-voskresenskiy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 580, "favorite_count": 0, "accepted_answer_id": 44136395, "answer_count": 1, "score": 1, "last_activity_date": 1495553497, "creation_date": 1495542505, "question_id": 44134844, "link": "https://stackoverflow.com/questions/44134844/how-to-work-with-multiple-types-in-single-collection-with-mgo", "title": "How to work with multiple types in single collection with mgo", "body": "<p>I'm very new to golang and try to write a simple event-sourcing user-management webapi using mongodb as backing database. Now i have User, which looks something like this: </p>\n\n<pre><code>type User struct {\nId       bson.ObjectId `json:\"id\" bson:\"_id\"`\nUserName string        `json:\"username\" bson:\"username\"`\nEmail    string        `json:\"email\" bson:\"email\"`\nPwdHash  string        `json:\"pwd_hash\" bson:\"pwd_hash\"`\nFullName string        `json:\"fullname\" bson:\"fullname\"`\n}\n</code></pre>\n\n<p>and three events, happening to user, when somebody uses api:</p>\n\n<pre><code>type UserCreatedEvent struct {\n    UserId         bson.ObjectId `json:\"id\" bson:\"_id\"`\n    //time when event was issued\n    CreatedEpoch   time.Time     `json:\"created_epoch\" bson:\"created_epoch\"`\n    //id of user that made a change\n    IssuedByUserId bson.ObjectId `json:\"issuedby_userid\" bson:\"issuedby_userid\"`\n}\n\ntype UserDeletedEvent struct {\n    UserId         bson.ObjectId `json:\"id\" bson:\"_id\"`\n    CreatedEpoch   time.Time     `json:\"created_epoch\" bson:\"created_epoch\"`\n    //id of user that made a change\n    IssuedByUserId bson.ObjectId `json:\"issuedby_userid\" bson:\"issuedby_userid\"`\n}\n\ntype UserUpdatedEvent struct {\n    UserId         bson.ObjectId `json:\"id\" bson:\"_id\"`\n    CreatedEpoch   time.Time     `json:\"created_epoch\" bson:\"created_epoch\"`\n    //id of user that made a change\n    IssuedByUserId bson.ObjectId `json:\"issuedby_userid\" bson:\"issuedby_userid\"`\n    ChangedFieldName     string  `json:\"changed_field_name\" bson:\"changed_field_name\"`\n    NewChangedFieldValue string  `json:\"new_changed_field_value\" bson:\"new_changed_field_value\"`\n}\n</code></pre>\n\n<p>Now i'm stuck on saving and retrieving events from db. The problem is i want to store them in a single collection, so that i have a full plain history of user modifications. But i can't find how to correctly store event type name as a mongo document field and then use it in searches. What is the idiomatic go-way to do this?</p>\n\n<p>I'll be gratefull for any help.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 1, "creation_date": 1495535625, "post_id": 44131158, "comment_id": 75283084, "body": "What you want can be done by using copy: <a href=\"https://play.golang.org/p/XPiDvJtRFe\" rel=\"nofollow noreferrer\">play.golang.org/p/XPiDvJtRFe</a>"}, {"owner": {"reputation": 1362, "user_id": 5699570, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-fRpOyxCifSQ/AAAAAAAAAAI/AAAAAAAAAWA/NtmKw1pR05c/photo.jpg?sz=128", "display_name": "kien bui", "link": "https://stackoverflow.com/users/5699570/kien-bui"}, "edited": false, "score": 0, "creation_date": 1495536849, "post_id": 44131158, "comment_id": 75283983, "body": "b := append(a[:i], a[i+1:]...), sure, this code will change a"}], "answers": [{"tags": [], "owner": {"reputation": 109, "user_id": 2585537, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/45c821c7954c157acdfddaa50653d464?s=128&d=identicon&r=PG", "display_name": "Chen", "link": "https://stackoverflow.com/users/2585537/chen"}, "is_accepted": false, "score": 0, "last_activity_date": 1495532923, "creation_date": 1495532923, "answer_id": 44131361, "question_id": 44131158, "link": "https://stackoverflow.com/questions/44131158/delete-a-element-in-slice-lead-the-changed-for-origin-slice/44131361#44131361", "title": "delete a element in slice lead the changed for origin slice?", "body": "<p>I think I know why.</p>\n\n<p>the slice a[:i] will return a slice which's capacity size is 6(as the origin slice), so the append will not realloc a new slice but use the origin one.</p>\n"}, {"tags": [], "owner": {"reputation": 1362, "user_id": 5699570, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-fRpOyxCifSQ/AAAAAAAAAAI/AAAAAAAAAWA/NtmKw1pR05c/photo.jpg?sz=128", "display_name": "kien bui", "link": "https://stackoverflow.com/users/5699570/kien-bui"}, "is_accepted": false, "score": 0, "last_activity_date": 1495606290, "last_edit_date": 1495606290, "creation_date": 1495536469, "answer_id": 44132666, "question_id": 44131158, "link": "https://stackoverflow.com/questions/44131158/delete-a-element-in-slice-lead-the-changed-for-origin-slice/44132666#44132666", "title": "delete a element in slice lead the changed for origin slice?", "body": "<pre><code> b := append(a[:i], a[i+1:]...)\n</code></pre>\n\n<p>this code will change a Slice.\nMy code:</p>\n\n<pre><code>func main() {\n    a := []int{1, 2, 3, 4, 5, 6}\n    for i := 0; i &lt; len(a); i++ {\n        a1 := make([]int,6)\n        copy(a1, a)\n        b := make([]int,5)\n        b = a1[:i]\n        b = append(b, a1[i+1:]...)\n        fmt.Println(b)\n    }\n    fmt.Println(a)\n}\n</code></pre>\n"}], "owner": {"reputation": 109, "user_id": 2585537, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/45c821c7954c157acdfddaa50653d464?s=128&d=identicon&r=PG", "display_name": "Chen", "link": "https://stackoverflow.com/users/2585537/chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1495606290, "creation_date": 1495532440, "question_id": 44131158, "link": "https://stackoverflow.com/questions/44131158/delete-a-element-in-slice-lead-the-changed-for-origin-slice", "title": "delete a element in slice lead the changed for origin slice?", "body": "<p>I just show the code, it is pretty simple, <a href=\"https://play.golang.org/p/TwMh1b3DoK\" rel=\"nofollow noreferrer\">go play</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    a := []int{1,2,3,4,5,6}\n    for i:=0 ; i &lt; len(a); i++ {\n        b := append(a[:i], a[i+1:]...)\n        fmt.Println(b)\n    }\n    fmt.Println(a)\n}\n</code></pre>\n\n<p>In the code above, I have a slice, and I wanted to delete it's element in a loop.</p>\n\n<p>What I hope the output is:</p>\n\n<pre><code>23456\n13456\n12356\n12346\n12345\n</code></pre>\n\n<p>but I got:</p>\n\n<pre><code>[2 3 4 5 6]\n[2 4 5 6 6]\n[2 4 6 6 6]\n[2 4 6 6 6]\n[2 4 6 6 6]\n[2 4 6 6 6]\n</code></pre>\n\n<p>why? the go's <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">document</a> say that if slice's capacity is not enough it will make a realloc for the element, and I even changed anything in origin slice...</p>\n\n<p>can somebody explain me how this happen?</p>\n"}, {"tags": ["json", "go", "reflection", "marshalling", "slice"], "answers": [{"comments": [{"owner": {"reputation": 8200, "user_id": 79202, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/397f829eea921e02e35c37c22f9e6d3b?s=128&d=identicon&r=PG", "display_name": "theory", "link": "https://stackoverflow.com/users/79202/theory"}, "edited": false, "score": 1, "creation_date": 1495515973, "post_id": 44125734, "comment_id": 75271107, "body": "Well I&#39;ll be damned. It hadn&#39;t occurred to me to use a pointer *just for <code>UnmarshalJSON</code>, but that does in fact work! Only change I made was for the <code>null</code> case to set it to <code>nil</code> instead of an empty byte slice. Works great, thanks!"}, {"owner": {"reputation": 8200, "user_id": 79202, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/397f829eea921e02e35c37c22f9e6d3b?s=128&d=identicon&r=PG", "display_name": "theory", "link": "https://stackoverflow.com/users/79202/theory"}, "edited": false, "score": 0, "creation_date": 1495575400, "post_id": 44125734, "comment_id": 75308556, "body": "Hrm, now trying to get it to work as a JSON object key, but it doesn&#39;t like my <code>UnmarshalText</code>. It&#39;s just like <code>UnmarshalJSON</code> (except for the quotation marks), but when I try to unmarshal into a <code>map[*Thing]string</code>, <code>Unmarshal</code> says <code>json: cannot unmarshal object into Go value of type map[*Thing]string</code>.  <a href=\"https://play.golang.org/p/rxmvOVa8MW\" rel=\"nofollow noreferrer\">Playground example</a>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 8200, "user_id": 79202, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/397f829eea921e02e35c37c22f9e6d3b?s=128&d=identicon&r=PG", "display_name": "theory", "link": "https://stackoverflow.com/users/79202/theory"}, "edited": false, "score": 1, "creation_date": 1495581595, "post_id": 44125734, "comment_id": 75310678, "body": "@theory A <code>*Thing</code> is not a useful map key in this scenario (you get a new *Thing for every decoded value).  Declare <code>Thing</code> as a <code>string</code> type to use it as a map key.   See <a href=\"https://play.golang.org/p/P94GfU2jr3\" rel=\"nofollow noreferrer\">play.golang.org/p/P94GfU2jr3</a>"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1495535381, "last_edit_date": 1495535381, "creation_date": 1495513120, "answer_id": 44125734, "question_id": 44125690, "link": "https://stackoverflow.com/questions/44125690/how-do-i-convince-unmarshaljson-to-work-with-a-slice-subtype/44125734#44125734", "title": "How do I convince UnmarshalJSON to work with a slice subtype?", "body": "<p>Use this code to unmarshal the value:</p>\n\n<pre><code>func (thing *Thing) UnmarshalJSON(data []byte) error {\n  if len(data) == 0 || data[0] == 'n' { // copied from the Q, can be improved\n    *thing = nil\n    return nil\n  }\n  data = data[1 : len(data)-1]\n  dst := make([]byte, base64.RawURLEncoding.DecodedLen(len(data)))\n  n, err := base64.RawURLEncoding.Decode(dst, data)\n  if err != nil {\n    return err\n  }\n  *thing = dst[:n]\n  return nil\n}\n</code></pre>\n\n<p>The key points:</p>\n\n<ul>\n<li>Use a pointer receiver.</li>\n<li>Reflection is not needed to assign a []byte to a Thing.</li>\n</ul>\n\n<p><a href=\"https://play.golang.org/p/7Hmk5VOVyq\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 8200, "user_id": 79202, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/397f829eea921e02e35c37c22f9e6d3b?s=128&d=identicon&r=PG", "display_name": "theory", "link": "https://stackoverflow.com/users/79202/theory"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 549, "favorite_count": 0, "accepted_answer_id": 44125734, "answer_count": 1, "score": 0, "last_activity_date": 1495535381, "creation_date": 1495512800, "question_id": 44125690, "link": "https://stackoverflow.com/questions/44125690/how-do-i-convince-unmarshaljson-to-work-with-a-slice-subtype", "title": "How do I convince UnmarshalJSON to work with a slice subtype?", "body": "<p>I want byte slices that marshal and unmarshal in JSON using <a href=\"https://golang.org/pkg/encoding/base64/#pkg-constants\" rel=\"nofollow noreferrer\">base64</a> <code>RawURLEncoding</code> instead of <code>StdEncoding</code>. There's no obvious way to do this through the <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">encoding/json package</a>, which is sensible, so I thought I'd create a subtype to do it.</p>\n\n<pre><code>type Thing []byte\n</code></pre>\n\n<p>Marshaling support is easy:</p>\n\n<pre><code>func (thing Thing) MarshalJSON() ([]byte, error) {\n    if thing == nil {\n        return []byte(\"null\"), nil\n    }\n    return []byte(`\"` + base64.RawURLEncoding.EncodeToString(thing) + `\"`), nil\n}\n</code></pre>\n\n<p>But Unmarshal not so much. I traced the <a href=\"https://golang.org/src/encoding/json/decode.go#L911\" rel=\"nofollow noreferrer\">encoding/json source</a>, and came up with:</p>\n\n<pre><code>func (thing Thing) UnmarshalJSON(data []byte) error {\n    v := reflect.ValueOf(&amp;thing)\n    if len(data) == 0 || data[0] == 'n' { // null\n        v.SetBytes([]byte{})\n        return nil\n    }\n    data = data[1 : len(data)-1]\n    dst := make([]byte, base64.RawURLEncoding.DecodedLen(len(data)))\n    n, err := base64.RawURLEncoding.Decode(dst, data)\n    if err != nil {\n        return err\n    }\n    v.SetBytes(Thing(dst[:n]))\n    return nil\n}\n</code></pre>\n\n<p>But yields a panic in the call to <code>SetBytes()</code>:</p>\n\n<pre><code>panic: reflect: reflect.Value.SetBytes using unaddressable value [recovered]\n    panic: reflect: reflect.Value.SetBytes using unaddressable value\n</code></pre>\n\n<p>I tried using a pointer to a slice, instead, which works (and doesn't require reflection), but causes other challenges elsewhere in my code that wants to work with slices instead of pointers.</p>\n\n<p>So two questions, I guess:</p>\n\n<ol>\n<li>Is this the best way to go about getting byte slices to marshal using <code>RawURLEncoding</code>?</li>\n<li>If so, how can I convince my byte slice subtype to reference the data decoded from the <code>RawURLEncoding</code> format?</li>\n</ol>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3851, "user_id": 84762, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/03f58429e8709df581bedd42f576f649?s=128&d=identicon&r=PG", "display_name": "KOGI", "link": "https://stackoverflow.com/users/84762/kogi"}, "edited": false, "score": 0, "creation_date": 1509639020, "post_id": 44123399, "comment_id": 81108609, "body": "I really feel like there should be github issue for this. I feel like the syntactic sugar on getters (mentioned in <a href=\"https://stackoverflow.com/questions/44123399/how-do-i-initialize-a-composed-struct-in-go/44123416?noredirect=1#comment75266036_44123416\">@CeriseLim&#243;n&#39;s answer below</a>) <i>really</i> should also be applied to the setters as well. The way it is now not only makes the code ugly, but requires the user of a class to be far to intimately familiar with the inheritance/hierarchy of the class in order to use it."}], "answers": [{"comments": [{"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 9, "creation_date": 1495494910, "post_id": 44123416, "comment_id": 75266014, "body": "While <code>child.ID</code> hides that <code>ID</code> is embedded, the initializer does not? What an odd oversight. If I want initialization encapsulation I need to write my own <code>New</code> functions?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 4, "creation_date": 1495494981, "post_id": 44123416, "comment_id": 75266036, "body": "Field promotion on embedded fields is syntactic sugar. The feature does not provide encapsulation."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1495574186, "post_id": 44123416, "comment_id": 75307976, "body": "Why do you say it doesn&#39;t provide encapsulation?"}, {"owner": {"reputation": 3851, "user_id": 84762, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/03f58429e8709df581bedd42f576f649?s=128&d=identicon&r=PG", "display_name": "KOGI", "link": "https://stackoverflow.com/users/84762/kogi"}, "edited": false, "score": 8, "creation_date": 1495583568, "post_id": 44123416, "comment_id": 75311160, "body": "@CeriseLim&#243;n, I think Schwern&#39;s point was that the syntactic sugar exists on the &quot;getter&quot;, but not on the initializer. It&#39;s inconsistent."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 41, "last_activity_date": 1583295083, "last_edit_date": 1583295083, "creation_date": 1495494649, "answer_id": 44123416, "question_id": 44123399, "link": "https://stackoverflow.com/questions/44123399/how-do-i-initialize-a-composed-struct-in-go/44123416#44123416", "title": "How do I initialize a composed struct in Go?", "body": "<p><a href=\"https://github.com/golang/go/issues/9859\" rel=\"noreferrer\">Go issue 9859</a> proposes a change the the language to support the <code>Child{ ID: id, a: a, b: b }</code> syntax from the question.</p>\n\n<p>Use nested composite literals to initialize a value in a single expression:</p>\n\n<pre><code>child := Child{Base: Base{ID: id}, a: a, b: b}\n</code></pre>\n\n<p>It is not possible to hide the fact that a field is promoted from an embedded struct. </p>\n"}], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7848, "favorite_count": 4, "answer_count": 1, "score": 26, "last_activity_date": 1583295083, "creation_date": 1495494530, "question_id": 44123399, "link": "https://stackoverflow.com/questions/44123399/how-do-i-initialize-a-composed-struct-in-go", "title": "How do I initialize a composed struct in Go?", "body": "<p>Let's say I have a struct with another struct embedded in it.</p>\n\n<pre><code>type Base struct {\n    ID string\n}\n\ntype Child struct {\n    Base\n    a int\n    b int\n}\n</code></pre>\n\n<p>When I go to initialize <code>Child</code>, I can't initialize the <code>ID</code> field directly.</p>\n\n<pre><code>// unknown field 'ID' in struct literal of type Child\nchild := Child{ ID: id, a: a, b: b }\n</code></pre>\n\n<p>I instead have to initialize the ID field separately.</p>\n\n<pre><code>child := Child{ a: 23, b: 42 }\nchild.ID = \"foo\"\n</code></pre>\n\n<p>This would seem to violate encapsulation. The user of Child has to know there's something different about the ID field. If I later moved a public field into an embedded struct, that might break initialization.</p>\n\n<p>I could write a <code>NewFoo()</code> method for every struct and hope everyone uses that, but <strong><em>is there a way to use the struct literal safely with embedded structs that doesn't reveal some of the fields are embedded?</em></strong> Or am I applying the wrong pattern here?</p>\n"}, {"tags": ["mysql", "go"], "answers": [{"comments": [{"owner": {"reputation": 511, "user_id": 5663677, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/393fc806d8e3e14f0bc14a56ba7aae0d?s=128&d=identicon&r=PG&f=1", "display_name": "Laila", "link": "https://stackoverflow.com/users/5663677/laila"}, "edited": false, "score": 0, "creation_date": 1609848884, "post_id": 44123398, "comment_id": 115944690, "body": "I have a similar case in which the primary key of my table is varchar(36) which contains a uuid values generated by trigger with the each new insertion . I am updating an already existing code so the primary key was auto increament int value which used with LastInsertedRow , now i need to edit this so i added an additional column id_tracker which is an autoincreament column but not a primary key . is it possible to use it ?"}], "tags": [], "owner": {"reputation": 725, "user_id": 1340135, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/19c77ec6e88f9ee85488d72fbeef0b64?s=128&d=identicon&r=PG", "display_name": "Kaah", "link": "https://stackoverflow.com/users/1340135/kaah"}, "is_accepted": true, "score": 22, "last_activity_date": 1495636757, "last_edit_date": 1495636757, "creation_date": 1495494528, "answer_id": 44123398, "question_id": 44123276, "link": "https://stackoverflow.com/questions/44123276/how-to-get-id-of-the-last-inserted-row-in-mysql-and-go/44123398#44123398", "title": "How to get ID of the last inserted row in MySQL and Go?", "body": "<p>Working solution. It is as simple as that. I hope someone else will find this useful:</p>\n\n<pre><code>stmt, err := db.Prepare(\"INSERT table SET unique_id=? ON DUPLICATE KEY UPDATE id=LAST_INSERT_ID(id)\")\n\nres, err := stmt.Exec(unique_id)\n\nlid, err := res.LastInsertId()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1801, "user_id": 4482269, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/00fe165b96c14b609710b822674239c4?s=128&d=identicon&r=PG&f=1", "display_name": "Wolfack", "link": "https://stackoverflow.com/users/4482269/wolfack"}, "is_accepted": false, "score": 1, "last_activity_date": 1511438186, "creation_date": 1511438186, "answer_id": 47455001, "question_id": 44123276, "link": "https://stackoverflow.com/questions/44123276/how-to-get-id-of-the-last-inserted-row-in-mysql-and-go/47455001#47455001", "title": "How to get ID of the last inserted row in MySQL and Go?", "body": "<p>Try following:</p>\n\n<pre><code>UPDATE items\nSET qwe = 'qwe',\n    item_id=LAST_INSERT_ID(item_id)\nWHERE asd = 'asd';\nSELECT LAST_INSERT_ID();\n</code></pre>\n"}], "owner": {"reputation": 725, "user_id": 1340135, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/19c77ec6e88f9ee85488d72fbeef0b64?s=128&d=identicon&r=PG", "display_name": "Kaah", "link": "https://stackoverflow.com/users/1340135/kaah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7711, "favorite_count": 5, "accepted_answer_id": 44123398, "answer_count": 2, "score": 16, "last_activity_date": 1531285231, "creation_date": 1495493560, "last_edit_date": 1531285231, "question_id": 44123276, "link": "https://stackoverflow.com/questions/44123276/how-to-get-id-of-the-last-inserted-row-in-mysql-and-go", "title": "How to get ID of the last inserted row in MySQL and Go?", "body": "<p>How can I use this trick: <a href=\"https://stackoverflow.com/questions/1388025/how-to-get-id-of-the-last-updated-row-in-mysql\">How to get ID of the last updated row in MySQL?</a> in Go (golang)?</p>\n\n<p>I am using the go-sql-driver. It should work with these two queries but how can I do it in Go?</p>\n\n<pre><code>INSERT INTO table (unique_id) VALUES (\"test\")\nON DUPLICATE KEY UPDATE id=LAST_INSERT_ID(id);\n\nSELECT LAST_INSERT_ID();\n</code></pre>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 1, "creation_date": 1495493736, "post_id": 44123122, "comment_id": 75265752, "body": "What if you make the fields <code>*string</code> instead of <code>string</code>? If a field is <code>nil</code> does it do what you want?"}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1495494126, "post_id": 44123122, "comment_id": 75265846, "body": "@AndySchweig if a field is nil yes, because then it will try to insert in the DB a null value and it&#39;s ok, but I cannot save &quot;&quot; in a json column"}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1495497413, "post_id": 44123122, "comment_id": 75266596, "body": "This smells like <a href=\"https://meta.stackexchange.com/questions/66377/what-is-the-xy-problem\">an XY problem</a>. I&#39;d suggest asking a question about how to redesign that struct with 500 fields, that&#39;ll cause all sorts of problems. I&#39;m gonna guess it&#39;s a result of poor table design leading to the <a href=\"http://antipatterns.com/lavaflow.htm\" rel=\"nofollow noreferrer\">Lava Flow anti-pattern</a>."}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1495498537, "post_id": 44123122, "comment_id": 75266875, "body": "@Schwern I cannot do that, because I download that information of various external servers, and I don&#39;t really need to make a mapping of the fields. That DB design is an stablished standart"}, {"owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1495498773, "post_id": 44123122, "comment_id": 75266927, "body": "@AndySchweig it worked pretty nice. Now am wondering, which implications come across doing it in that way?"}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1495499400, "post_id": 44123122, "comment_id": 75267058, "body": "@SrednyMCasanova <a href=\"https://dhdersch.github.io/golang/2016/01/23/golang-when-to-use-string-pointers.html\" rel=\"nofollow noreferrer\">dhdersch.github.io/golang/2016/01/23/&hellip;</a> might be of help. Also take note of <a href=\"https://dhdersch.github.io/golang/2016/01/23/golang-when-to-use-string-pointers.html#comment-2614169576\" rel=\"nofollow noreferrer\">this comment about using <code>json: &quot;omitempty&quot;</code></a>."}], "owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 898, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1495492526, "creation_date": 1495492526, "question_id": 44123122, "link": "https://stackoverflow.com/questions/44123122/set-default-value-to-strings-in-golang-struct", "title": "set default value to strings in Golang Struct", "body": "<p>I'm developing a program using Go, I have a Struct that contains 500 fields (it's strange but it's allright, I know)... So, some of that fields are saved in the database (Postgres) as JSON, so for example that fields are defined as:</p>\n\n<pre><code>MyField string `sql:\"type:JSON DEFAULT '{}'\"` \n</code></pre>\n\n<p>My problem is, that not all the fields are filled, when I create an object of that struct the sting are zero valued to \"\", so then when I try to register that in the database it gives me error. \nThe only thing that I need is to set as default to some of that values null or \"{}\" to avoid problems in the insert.\nHow can I do that? Is some way using tags that I can set the default value?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1495486747, "post_id": 44122034, "comment_id": 75263378, "body": "No there is not."}], "answers": [{"comments": [{"owner": {"reputation": 135, "user_id": 2364057, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/QEHBJ.jpg?s=128&g=1", "display_name": "sgg", "link": "https://stackoverflow.com/users/2364057/sgg"}, "edited": false, "score": 0, "creation_date": 1498004913, "post_id": 44122656, "comment_id": 76315413, "body": "Thanks, this seems cumbersome though."}], "tags": [], "owner": {"reputation": 24922, "user_id": 4001, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/3b2c4583cd2eee64afe2ff888d590cf9?s=128&d=identicon&r=PG", "display_name": "abbot", "link": "https://stackoverflow.com/users/4001/abbot"}, "is_accepted": true, "score": 5, "last_activity_date": 1495489786, "creation_date": 1495489786, "answer_id": 44122656, "question_id": 44122034, "link": "https://stackoverflow.com/questions/44122034/is-there-a-way-to-propagate-the-nilness-of-a-variable-in-a-chained-call/44122656#44122656", "title": "Is there a way to propagate the &quot;nilness&quot; of a variable in a chained call?", "body": "<p>You can handle this nicely if you code some getters. Go method receivers are just regular function arguments, so it's totally ok to call something on a nil receiver:</p>\n\n<pre><code>type Foo struct {\n    Name string\n}\n\nfunc (f *Foo) GetName() string {\n    if f == nil {\n        return \"default name\" // or \"\", whatever\n    }\n    return f.Name\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Q20lSo65Kx\" rel=\"noreferrer\">https://play.golang.org/p/Q20lSo65Kx</a></p>\n\n<p>This trick is used e.g. by Go protobuf implementation.</p>\n"}], "owner": {"reputation": 135, "user_id": 2364057, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/QEHBJ.jpg?s=128&g=1", "display_name": "sgg", "link": "https://stackoverflow.com/users/2364057/sgg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 44122656, "answer_count": 1, "score": 2, "last_activity_date": 1495489786, "creation_date": 1495486628, "question_id": 44122034, "link": "https://stackoverflow.com/questions/44122034/is-there-a-way-to-propagate-the-nilness-of-a-variable-in-a-chained-call", "title": "Is there a way to propagate the &quot;nilness&quot; of a variable in a chained call?", "body": "<p>I have the following in Go:</p>\n\n<pre><code>checkItemState := action.Data.CheckItem.State\nif checkItemState != \"\" {\n            fmt.Printf(\"checklist item state: %s\", action.Data.CheckItem.State)\n}\n</code></pre>\n\n<p>Now if any of the items in the chain <code>action.Data.CheckItem</code> are nil/empty, I get a nil pointer dereference error, which makes sense.</p>\n\n<p>But is there a language level way to get <code>checkItemState</code> if not nil, or <code>\"\"</code> if any of the items in the chain are nil/empty.</p>\n\n<p>(I come from Obj-C/Swift land where the nilness propagates)</p>\n"}, {"tags": ["go", "ssh", "server"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1495482955, "post_id": 44120681, "comment_id": 75261536, "body": "Why can&#39;t you just cache the value during <code>PublicKeyCallback</code>, and then move it <code>authorizedKeys</code> if the login was successful? You also have a data race around <code>authorizedKeys</code>, and need some sort of synchronization around the map."}, {"owner": {"reputation": 1308, "user_id": 4709839, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh6.googleusercontent.com/-4w1KKdkUNJk/AAAAAAAAAAI/AAAAAAAAABc/Xg55afDDwjk/photo.jpg?sz=128", "display_name": "William Poussier", "link": "https://stackoverflow.com/users/4709839/william-poussier"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1495483308, "post_id": 44120681, "comment_id": 75261706, "body": "@JimB How would you cache it and link a successfull connection to a private key since multiples connections could be run concurently ? (temp cache by publick-key/<code>net.Addr</code> pair. could work since host:port of origin should be unique) The <code>authorizedKeys</code> map is backed by a <code>sync.Mutex</code> of course."}, {"owner": {"reputation": 1308, "user_id": 4709839, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh6.googleusercontent.com/-4w1KKdkUNJk/AAAAAAAAAAI/AAAAAAAAABc/Xg55afDDwjk/photo.jpg?sz=128", "display_name": "William Poussier", "link": "https://stackoverflow.com/users/4709839/william-poussier"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1495486284, "post_id": 44120681, "comment_id": 75263175, "body": "@JimB Okay so your idea was the good one. I cache the connection attampt details mapped to a publick key, and where I assume the connection is a success I update the last successfull attempt details with the data found in cache (matching is done with the <code>net.Addr</code> which should be unique since it has the form host:port) and write the last connection details (if any) to the client. Dunno why I have not thought about this earlier."}], "owner": {"reputation": 1308, "user_id": 4709839, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh6.googleusercontent.com/-4w1KKdkUNJk/AAAAAAAAAAI/AAAAAAAAABc/Xg55afDDwjk/photo.jpg?sz=128", "display_name": "William Poussier", "link": "https://stackoverflow.com/users/4709839/william-poussier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 97, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1495481122, "creation_date": 1495481122, "question_id": 44120681, "link": "https://stackoverflow.com/questions/44120681/ssh-server-last-login-message-implementation", "title": "SSH server last login message implementation", "body": "<p>I implemented a SSH server daemon in Go using the <code>crypto/ssh</code> library and I would like to implement the \"last login message\" functionnality that is present in OpenSSH: when a user connect to the server, he receive a message indicating the IP/Time of its last connection.</p>\n\n<p>To authenticate users, the SSH server uses the PublicKeyCallback like this.</p>\n\n<pre><code>&amp;ssh.ServerConfig{\n        NoClientAuth: false,\n        PublicKeyCallback: func(c ssh.ConnMetadata, pk ssh.PublicKey) (*ssh.Permissions, error) {\n            pkstr := string(pk.Marshal())\n\n            akmu.Lock()\n            defer akmu.Unlock()\n            if _, ok := authorizedKeys[pkstr]; ok {\n                authorizedKeys[pkstr].last = time.Now()\n                return nil, nil\n            }\n            return nil, errors.New(\"unauthorized public key\")\n        },\n    }\n</code></pre>\n\n<p>The <code>authorizedKeys</code> variable maps a marshaled publick key to a type that should store the Origin ip address and time of the last connection of a public key.</p>\n\n<pre><code>var authorizedKeys map[string]*keyHistory\n\ntype keyHistory struct {\n    Origin   net.Addr\n    Time     time.Time\n}\n</code></pre>\n\n<p>The problem is that the only place where the public key that is used to autenticate a user is available is during the <code>PublicKeyCallback</code> execution, but registering the connection event here won't guarante that the connection process won't fail later on.</p>\n\n<p>What I mean by later on is the differents steps that happen after a public key has been authorized :</p>\n\n<ul>\n<li>reject all non-session channels</li>\n<li>accept the session channel</li>\n<li>creates a new terminal with the session channel and the conn (using own wrapped implem of <code>terminal.Terminal</code>)</li>\n<li>process others requests (<code>shell</code>, <code>pty-req</code>, <code>window-change</code>)</li>\n<li>run a loop to read the inputs of the terminal with <code>terminal.ReadLine()</code></li>\n</ul>\n\n<p>Ideally the connection event ip/time would be recorded just before running the terminal loop to ensure that it correspond to a successfull login. Unfortunately, at this point, only the underlying <code>ssh.ServerConn</code> of the terminal is available and it isn't possible to link it back to a public key.</p>\n\n<p>Any leads to implement a similar functionnality ? Any example or link to a project that would have achieved the same thing would be appreciated.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["testing", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1495478555, "post_id": 44119951, "comment_id": 75259146, "body": "What didn&#39;t work about writing the log to a buffer?"}, {"owner": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1495478744, "post_id": 44119951, "comment_id": 75259280, "body": "the buffer is empty. the OUTPUT returns &quot;&quot;. I check if the log is writing and it&#39;s ok but my buffer is always empty."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1495479553, "post_id": 44119951, "comment_id": 75259738, "body": "So show how you&#39;re writing to the buffer. There&#39;s no reason that you shouldn&#39;t be able to write to a buffer and check it later."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1495480038, "post_id": 44119951, "comment_id": 75259988, "body": "What is <code>log.Print</code>? Go&#39;s stdlib <code>log</code> package?"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 38, "last_activity_date": 1495486318, "last_edit_date": 1495486318, "creation_date": 1495485924, "answer_id": 44121870, "question_id": 44119951, "link": "https://stackoverflow.com/questions/44119951/how-to-check-a-log-output-in-go-test/44121870#44121870", "title": "How to check a log/output in go test?", "body": "<p>For example,</p>\n\n<p><code>readbyte_test.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"os\"\n    \"testing\"\n)\n\nfunc readByte( /*...*/ ) {\n    // ...\n    err := io.EOF // force an error\n    if err != nil {\n        fmt.Println(\"ERROR\")\n        log.Print(\"Couldn't read first byte\")\n        return\n    }\n    // ...\n}\n\nfunc TestReadByte(t *testing.T) {\n    var buf bytes.Buffer\n    log.SetOutput(&amp;buf)\n    defer func() {\n        log.SetOutput(os.Stderr)\n    }()\n    readByte()\n    t.Log(buf.String())\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go test -v readbyte_test.go \n=== RUN   TestReadByte\nERROR\n--- PASS: TestReadByte (0.00s)\n    readbyte_test.go:30: 2017/05/22 16:41:00 Couldn't read first byte\nPASS\nok      command-line-arguments  0.004s\n$ \n</code></pre>\n"}], "owner": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 18954, "favorite_count": 3, "accepted_answer_id": 44121870, "answer_count": 1, "score": 21, "last_activity_date": 1495486318, "creation_date": 1495478448, "last_edit_date": 1495479987, "question_id": 44119951, "link": "https://stackoverflow.com/questions/44119951/how-to-check-a-log-output-in-go-test", "title": "How to check a log/output in go test?", "body": "<p>I have this function that logs the error in some cases:</p>\n\n<pre><code>func readByte(/*...*/){\n    // ...\n    if err != nil {\n        fmt.Println(\"ERROR\")\n        log.Print(\"Couldn't read first byte\")\n        return\n    }\n    // ...\n}\n</code></pre>\n\n<p>Now, in the test file, I want to check the output error from this function:</p>\n\n<pre><code>    c.Assert(OUTPUT, check.Matches, \"teste\")\n</code></pre>\n\n<p>How can I access the log? I tried to put a buffer but it didn't work. What is the right way to catch this log without change my readByte function code?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 1, "creation_date": 1495478093, "post_id": 44119793, "comment_id": 75258884, "body": "Sounds like <code>textTagRelationships</code> is <code>nil</code>."}, {"owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "reply_to_user": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 0, "creation_date": 1495478203, "post_id": 44119793, "comment_id": 75258937, "body": "well, nothing happens to it. It&#39;s just inited. And when I print it out I print out an empty array."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1495545545, "post_id": 44119793, "comment_id": 75290461, "body": "It&#39;s declared, not inited. <code>var thing []type</code> gives you <code>nil</code> of type <code>[]type</code>. <code>thing := make([]type, len)</code> gives you an slice of type <code>[]type</code> and length <code>len</code>, and <code>var thing [len]type</code> gives you a len-length array of type <code>[]type</code> filled with the zero value for <code>type</code>."}], "answers": [{"tags": [], "owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "is_accepted": false, "score": 7, "last_activity_date": 1495478448, "creation_date": 1495478448, "answer_id": 44119950, "question_id": 44119793, "link": "https://stackoverflow.com/questions/44119793/why-does-json-encoding-an-empty-array-in-code-return-null/44119950#44119950", "title": "Why does json encoding an empty array in code return null?", "body": "<p>It looks like this is a gotcha in Go.</p>\n\n<p><a href=\"https://danott.co/posts/json-marshalling-empty-slices-to-empty-arrays-in-go.html\" rel=\"noreferrer\">https://danott.co/posts/json-marshalling-empty-slices-to-empty-arrays-in-go.html</a></p>\n\n<p>The solution around this is to not rely on the default init behaviour and actually do a <code>make</code>.</p>\n\n<p><code>var textTagRelationships TextTagRelationships = make(TextTagRelationships, 0)</code></p>\n"}], "owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2393, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1594490672, "creation_date": 1495477858, "question_id": 44119793, "link": "https://stackoverflow.com/questions/44119793/why-does-json-encoding-an-empty-array-in-code-return-null", "title": "Why does json encoding an empty array in code return null?", "body": "<p>So I have a types like this</p>\n\n<pre><code>type TextTagRelationship struct {\n  Id int64 `json:\"id\"`\n  TagId int64 `json:\"tag_id\"`\n  TaggedText string `json:\"tagged_text\"`\n  TagName string `json:\"tag_name\"`\n  PageNumber int64 `json:\"page_number\"`\n  Color string `json:\"color\"`\n}\n\ntype TextTagRelationships []TextTagRelationship\n</code></pre>\n\n<p>Now, I have a handler that does something like this</p>\n\n<pre><code>func getTaggedTextForPage(w http.ResponseWriter, r *http.Request) {\n    vars := mux.Vars(r)\n    pageNumber, err := strconv.ParseInt(vars[\"pageNumber\"], 10, 64)\n    check(err)\n    defer r.Body.Close()\n    rows, err := db.Query(\"SELECT * from tagged_text WHERE page_number = ?\", pageNumber)\n    check(err)\n    var textTagRelationships []TextTagRelationship\n    var textTagRelationship TextTagRelationship\n    for rows.Next() {\n        //execute sql code here\n        textTagRelationships = append(textTagRelationships, textTagRelationship)\n    }\n\n\n    if err := json.NewEncoder(w).Encode(textTagRelationships); err != nil {\n        check(err)\n    }\n}\n</code></pre>\n\n<p>This works fine if there are actual rows, but when encoding an empty array <code>textTagRelationships</code>, in my response in the chrome console I get a <code>null</code>. Why is this happening? It looks like <code>textTagRelationships</code> is actually a <code>[]</code> and so I would have expected the encoding to encode a <code>[]</code> and my response to have a <code>[]</code>.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1495474866, "post_id": 44118967, "comment_id": 75257216, "body": "Write a constructor/function for Params which takes just Field1 as input and sets up a Params."}, {"owner": {"reputation": 297, "user_id": 7467314, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8c4715513d18c3b7c8c20346296c85da?s=128&d=identicon&r=PG&f=1", "display_name": "user7467314", "link": "https://stackoverflow.com/users/7467314/user7467314"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1495475524, "post_id": 44118967, "comment_id": 75257605, "body": "Thanks for the comment. I want to do this for every field though, not just Field1... so I guess I would need a closure of some kind? I don&#39;t want my tests to end up with too much logic too."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1495477709, "post_id": 44118967, "comment_id": 75258675, "body": "If the zero value for the struct is valid (which is idiomatic in Go), then you only need to set the one field you&#39;re testing invalid values of."}], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 2, "last_activity_date": 1495477674, "creation_date": 1495477674, "answer_id": 44119732, "question_id": 44118967, "link": "https://stackoverflow.com/questions/44118967/varying-a-struct-field-for-unit-testing/44119732#44119732", "title": "Varying a struct field for unit testing", "body": "<p>You can avoid repetitive code by creating one constructor that would set up all default values (valid).</p>\n\n<p>The constructor can also receive a function to operate over the created object before returning it.</p>\n\n<p>That way, you only need to code the logic required to invalidate the particular field you'd like to test.</p>\n\n<p>To create a <code>Params</code> object you can just do:</p>\n\n<pre><code>params1 := CreateParamsWith(func(p *Params) {\n    p.Field1 = \"invalid_0\"\n})\n</code></pre>\n\n<p>The <code>CreateParamsWith</code> might look like this:</p>\n\n<pre><code>func CreateParamsWith(modifyParams func(*Params)) (*Params) {\n    params := &amp;Params{  \n        Field1: \"valid\",\n        Field2: \"valid\",\n        Field3: \"valid\",\n        Field4: \"valid\",\n        Field5: \"valid\",\n        }\n    modifyParams(params)\n    return params\n}\n</code></pre>\n\n<p>Full working code here: <a href=\"https://play.golang.org/p/U0xhtIbQfy\" rel=\"nofollow noreferrer\">https://play.golang.org/p/U0xhtIbQfy</a></p>\n"}], "owner": {"reputation": 297, "user_id": 7467314, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8c4715513d18c3b7c8c20346296c85da?s=128&d=identicon&r=PG&f=1", "display_name": "user7467314", "link": "https://stackoverflow.com/users/7467314/user7467314"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 44119732, "answer_count": 1, "score": 2, "last_activity_date": 1495477674, "creation_date": 1495474706, "question_id": 44118967, "link": "https://stackoverflow.com/questions/44118967/varying-a-struct-field-for-unit-testing", "title": "Varying a struct field for unit testing", "body": "<p>I'm trying to unit test a constructor for a struct with many fields. I want to make sure that the constructor performs all the expected validations so I am testing single fields for multiple failure scenarios. </p>\n\n<p>I'm trying to do this programatically so I'm using table tests, however this leads to a lot of repetition and noise in the tests as I end up repeating N param fields just to test for the one field error.</p>\n\n<p>For example:</p>\n\n<pre><code>func NewSomeObject(p *Params) *SomeObject {\n  ...\n}\n\n\ntype SomeObject struct {\n  ..\n  Field1 string\n  Field2 string\n  Field3 string\n  ...\n  Field10 string\n}\n\nfunc TestNewSomeObject(t *testing.T) {\n    tcases := map[string]struct {\n        params *Params\n        err    error\n    }{\n        &amp;Params{\n          Field1: \"invalid_0\" // &lt;--- making sure that this invalid field is caught\n          Field2: \"valid\"\n          Field3: \"valid\"\n          ...\n          Field10: \"valid\"\n        },\n        &amp;Params{\n          Field1: \"invalid_1\" // &lt;--- another invalid case\n          Field2: \"valid\"\n          Field3: \"valid\"\n          ...\n          Field10: \"valid\"\n        },\n        &amp;Params{\n          Field1: \"invalid_2\"\n          Field2: \"valid\"\n          Field3: \"valid\"\n          ...\n          Field10: \"valid\"\n        },\n        &amp;Params{\n          Field1: \"invalid_3\"\n          Field2: \"valid\"\n          Field3: \"valid\"\n          ...\n          Field10: \"valid\"\n        },\n        ...\n        ...\n        ...\n    }  \n\n    for name, tc := range tcases {\n        t.Logf(\"Running test %s\", name)\n\n        s, err := NewSomeObject(tc.params)\n        if !reflect.DeepEqual(tc.err, err) {\n            t.Fatalf(\"Got '%v', Expected: '%v'\", err, tc.err)\n        }\n    }\n}\n</code></pre>\n\n<p>Is there a better way to vary a single field in the struct without having to repeat the input so many times?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 6, "creation_date": 1495471757, "post_id": 44118191, "comment_id": 75255532, "body": "You can&#39;t. Use an <code>if</code>."}, {"owner": {"reputation": 1951, "user_id": 1442219, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6398031dc321aa3c975436e11d752f6b?s=128&d=identicon&r=PG", "display_name": "Lanti", "link": "https://stackoverflow.com/users/1442219/lanti"}, "reply_to_user": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1495472422, "post_id": 44118191, "comment_id": 75255907, "body": "<code>os.Getenv</code> not returning an error, how can I check against <code>nil</code>? Or should I check against an empty string?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1495472583, "post_id": 44118191, "comment_id": 75255990, "body": "Neither <code>os.Getenv</code> nor <code>stringconv.Itoa</code> returns <code>nil</code>, but you can check against the zero value, <code>0</code>, <code>&quot;&quot;</code>, etc. Also <code>Itoa</code> takes an <code>int</code> as its argument, but <code>Getenv</code> returns a string."}], "answers": [{"tags": [], "owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "is_accepted": true, "score": 1, "last_activity_date": 1495473773, "last_edit_date": 1495473773, "creation_date": 1495473262, "answer_id": 44118597, "question_id": 44118191, "link": "https://stackoverflow.com/questions/44118191/emulate-or-operator-in-variable-declaration-from-javascript-in-go/44118597#44118597", "title": "Emulate OR operator in variable declaration from Javascript in Go", "body": "<p>You can't use <code>|</code> or <code>||</code> like this in Go.</p>\n\n<p><code>|</code> is an <a href=\"https://golang.org/ref/spec#Arithmetic_operators\" rel=\"nofollow noreferrer\">Arithmetic operator</a> and applies only to numeric values and <code>||</code> is a <a href=\"https://golang.org/ref/spec#Logical_operators\" rel=\"nofollow noreferrer\">Logical operator</a>, and applies only to boolean values.</p>\n\n<p>Go has no concept of \"truthy\" or \"falsy\" as in JavaScript; for example <code>if \"some_string\"</code> or <code>if 0</code> are invalid. You'll need to explicitly use a comparison with <code>==</code>, <code>&gt;</code>: <code>if 0 == 0</code> and <code>if \"some_string\" == \"\"</code>.</p>\n\n<hr>\n\n<p><a href=\"https://golang.org/pkg/strconv/#Itoa\" rel=\"nofollow noreferrer\"><code>Itoa</code></a> always returns a String, as does <a href=\"https://golang.org/pkg/os/#Getenv\" rel=\"nofollow noreferrer\"><code>os.GetEnv</code></a>, which is documented as returning a string and:</p>\n\n<blockquote>\n  <p>It returns the value, which will be empty if the variable is not present.</p>\n</blockquote>\n\n<p>\"Empty\" being an \"empty string\". In Go, a string is always a string; only a limited set of values such as pointers and <code>error</code> can be compared to <code>nil</code> (and primitives like strings can't).</p>\n\n<p>It will never return a number type (e.g. <code>int</code>), so passing the output of this to <code>Itoa</code> is always an error.</p>\n\n<hr>\n\n<p>What you probably want is <a href=\"https://golang.org/pkg/strconv/#Atoi\" rel=\"nofollow noreferrer\"><code>Atoi</code></a>, which returns an error as the second return value:</p>\n\n<pre><code>port, err := strconv.Atoi(os.Getenv(\"PORT\"))\nif err != nil {\n    fmt.Println(\"unable to get PORT environment variable, falling back to 8080\")\n\n    // Use =, not :=\n    // Otherwise it'll create new port variable local to this if block.\n    // Common mistake for beginners and even experienced programmers.\n    port = 8080\n}\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>port := 8080\nif os.Getenv(\"PORT\") != \"\" {\n    var err error\n    port, err = strconv.Atoi(os.Getenv(\"PORT\"))\n    if err != nil {\n        fmt.Fprintf(os.Stderr, \"error: unable to get PORT environment variable: %v\\n\", err)\n        os.Exit(1)\n    }\n}\n</code></pre>\n\n<hr>\n\n<p>If you're thinking \"gee, that's verbose compared to my JavaScript one-liner!\" then you're correct. In part this is due to the nature of static vs. dynamic languages, and in part this is due to Go's nature of being very explicit and easy-to-read.</p>\n\n<p>But you get type safety and readability in return :-)</p>\n"}], "owner": {"reputation": 1951, "user_id": 1442219, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6398031dc321aa3c975436e11d752f6b?s=128&d=identicon&r=PG", "display_name": "Lanti", "link": "https://stackoverflow.com/users/1442219/lanti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 44118597, "answer_count": 1, "score": -2, "last_activity_date": 1495473773, "creation_date": 1495471646, "question_id": 44118191, "link": "https://stackoverflow.com/questions/44118191/emulate-or-operator-in-variable-declaration-from-javascript-in-go", "title": "Emulate OR operator in variable declaration from Javascript in Go", "body": "<p>I want to emulate the OR <code>|</code> operator in Go, when I declare a variable. So return the right handside when the value is not presented:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>port := strconv.Itoa(os.Getenv(\"PORT\")) | \"8080\"\n</code></pre>\n\n<p>How can I achieve this?</p>\n"}, {"tags": ["matrix", "go", "random"], "answers": [{"tags": [], "owner": {"reputation": 309, "user_id": 4546150, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HzJYT.jpg?s=128&g=1", "display_name": "denis.lobanov", "link": "https://stackoverflow.com/users/4546150/denis-lobanov"}, "is_accepted": true, "score": 5, "last_activity_date": 1495467887, "last_edit_date": 1495467887, "creation_date": 1495465466, "answer_id": 44116317, "question_id": 44116183, "link": "https://stackoverflow.com/questions/44116183/randomly-generating-a-matrix-in-golang/44116317#44116317", "title": "Randomly generating a matrix in Golang", "body": "<p>The direct answer is the fact that <code>rand.Intn()</code> generates a random integer between 0 and <code>n</code>, where <code>n</code> is a parameter to this method. The error that you are getting is the compiler complaining that you are trying to initialize an <code>int</code> value with a function that requires two <code>int</code>s and returns one - you are trying to assign a function to an <code>int</code>.  So the correct call would be something like <code>rand.Intn(100)</code>, which will give you a random number between 0 - 100.</p>\n\n<p>However, why do it this way? Why not dynamically initialize your array with random numbers as:</p>\n\n<pre><code>m1 := [3][3]int{}\nfor i:=0; i&lt;3; i++ {\n    for j:=0; j&lt;3; j++ {\n        m1[i][j] = rand.Int()\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user5952594"}, "is_accepted": false, "score": 0, "last_activity_date": 1495474799, "last_edit_date": 1495474799, "creation_date": 1495474304, "answer_id": 44118869, "question_id": 44116183, "link": "https://stackoverflow.com/questions/44116183/randomly-generating-a-matrix-in-golang/44118869#44118869", "title": "Randomly generating a matrix in Golang", "body": "<p>Answer to your question is answered above, this is an extension,</p>\n\n<p>While <code>rand.Int(10)</code> always gives you 1, as it isn't seeded,\nyou can add this function to get random values each time you run your program,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\nfunc init() {\n    rand.Seed(time.Now().UnixNano())\n//we are seeding the rand variable with present time \n//so that we would get different output each time\n}\n\nfunc main() {\n    randMatrix := make([][]int, 3) \n// we have created a slice with length 3 \n//which can hold type []int, these can be of different length\n    for i := 0; i &lt; 3; i++ {\n        randMatrix[i] = make([]int, 3) \n// we are creating a slice which can hold type int\n    }\n    generate(randMatrix)\n    fmt.Println(randMatrix)\n}\n\nfunc generate(randMatrix [][]int) {\n    for i, innerArray := range randMatrix {\n        for j := range innerArray {\n            randMatrix[i][j] = rand.Intn(100)\n//looping over each element of array and assigning it a random variable\n        }\n    }\n}\n</code></pre>\n\n<p>This code generates random Matrix, below 100, while you can also use flags for any kind of future use and generalize the values,</p>\n\n<pre><code>import  \"flag\"\n\nvar outerDim, innerDim, limit *int\n\nfunc main() {\n    outerDim = flag.Int(\"outerDim\", 3, \"Outer dimension of the matrix\")\n    innerDim = flag.Int(\"innerDim\", 3, \"inner dimenstion of the matrix\")\n    limit = flag.Int(\"limit\", 100, \"matrix values are limited specified value\")\n    flag.Parse()\n    randMatrix := make([][]int, *outerDim)\n    for i := 0; i &lt; *outerDim; i++ {\n        randMatrix[i] = make([]int, *innerDim)\n    }\n    generate(randMatrix)\n    printMatrix(randMatrix)\n}\n\nfunc generate(randMatrix [][]int) {\n    for i, innerArray := range randMatrix {\n        for j := range innerArray {\n            randMatrix[i][j] = rand.Intn(*limit)\n        }\n    }\n}\n\nfunc printMatrix(randMatrix [][]int) {\n//looping over 2D slice and extracting 1D slice to val\n    for _, val := range randMatrix {\n        fmt.Println(val)// printing each slice\n    }\n}\n</code></pre>\n\n<p>We could modify the printMatrix function above, by looping over each integer and then formatting it well by using <code>fmt.Printf()</code>, but that would complicate things when we don't known the length of the limit...</p>\n"}], "owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4002, "favorite_count": 1, "accepted_answer_id": 44116317, "answer_count": 2, "score": 1, "last_activity_date": 1495474799, "creation_date": 1495465116, "question_id": 44116183, "link": "https://stackoverflow.com/questions/44116183/randomly-generating-a-matrix-in-golang", "title": "Randomly generating a matrix in Golang", "body": "<p>I'm currently writing a program and I want to randomly generate a matrix.</p>\n\n<p>Currently I'm pre-setting the values in it as follows:</p>\n\n<pre><code>    m1 := [3][3]int{\n    [3]int{1, 1, 1},\n    [3]int{4, 1, 7},\n    [3]int{1, 65, 1},\n}\n</code></pre>\n\n<p>However I want the values inputted to be randomly generated in a range from 1-100.</p>\n\n<pre><code>import \"math/rand\"\n</code></pre>\n\n<p>I am importing the above library and trying to utilise it.</p>\n\n<p>I have attempted to get this working however can't seem to make any headway. </p>\n\n<pre><code>    m1 := [3][3]int{\n    [3]int{rand.Intn, 1, 1},\n    [3]int{4, 1, 7},\n    [3]int{1, 65, 1},\n}\n</code></pre>\n\n<p>I have attempted to complete it with the above solution to make the first number random however I get the following error.</p>\n\n<pre><code>cannot use rand.Intn (type func(int) int) as type int in array or slice literal\n</code></pre>\n\n<p>Any help greatly appreciated.</p>\n"}, {"tags": ["testing", "go", "tdd"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1495462694, "post_id": 44115117, "comment_id": 75249788, "body": "<code>t</code> is how you interact with the testing package, you need to pass it around <i>somehow</i>. Have you looked how packages like <a href=\"https://github.com/stretchr/testify\" rel=\"nofollow noreferrer\"><code>testify</code></a> work at all?"}, {"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1495462740, "post_id": 44115117, "comment_id": 75249832, "body": "Yeah, I want to interact with <code>t</code>, but over my wrapped <code>CustomTester</code> interface to ease the burden. Going to look at it now."}, {"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1495463155, "post_id": 44115117, "comment_id": 75250163, "body": "@JimB I want to work with <code>t</code> through a receiver as I implemented. I reviewed the <code>testify</code>, however <a href=\"https://github.com/stretchr/testify/blob/master/assert/assertions.go\" rel=\"nofollow noreferrer\">it interacts with <code>t</code></a>  in a wrapped variable like: <code>assert.New(t)</code> when <code>t</code> usage as the first parameter not wanted. I also have tried this and it works of course."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1495463825, "post_id": 44115117, "comment_id": 75250620, "body": "You can do something like their <a href=\"https://godoc.org/github.com/stretchr/testify/assert#Assertions\" rel=\"nofollow noreferrer\"><code>Assertions</code></a>, or a <a href=\"https://godoc.org/github.com/stretchr/testify/suite#Suite\" rel=\"nofollow noreferrer\"><code>Suite</code></a>. I&#39;m really not sure what you&#39;re asking though -- the <code>testing</code> package is going to call the functions with the correct name and signature, and you&#39;re free to create structs, subtests, an call methods from within those functions however you choose. You can&#39;t somehow make the test package use a different function signature as an entry point."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1495463844, "post_id": 44115117, "comment_id": 75250632, "body": "If you&#39;re going to use your custom wrapper, you may not pass <code>t</code> explicitly (because your custom wrapper will), but then you will need to refer to your custom wrapper, so you gain &quot;nothing&quot;. However, it is still possible using <a href=\"https://golang.org/ref/spec#Method_values\" rel=\"nofollow noreferrer\">method values</a>: the receiver will be implicit and hidden in the method value. I&#39;ve written a library for this, check out <a href=\"https://github.com/icza/mighty\" rel=\"nofollow noreferrer\"><b>github.com/icza/mighty</b></a>."}, {"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1495470921, "post_id": 44115117, "comment_id": 75255114, "body": "@JimB What I&#39;m asking is: <b>1st:</b> By using an interface of <code>testing.T</code> which is <code>testing.TB</code> to add a receiver method for my custom tester which is: <code>assert</code> in the question. <b>2nd:</b> To be able to switch to my implementation with a receiver method."}, {"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1495471040, "post_id": 44115117, "comment_id": 75255168, "body": "@icza mighty is still using its own wrapper at the beginning of each test function and expects <code>testing.T</code>. I already solved it this way. My aim is different. <i>I&#39;m starting to see that it&#39;s not possible in Go right now.</i>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1495472070, "post_id": 44115117, "comment_id": 75255676, "body": "@inanc Yes, <code>mighty</code> also uses a wrapper, but the stress is on <b>method values</b>."}], "answers": [{"comments": [{"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 0, "creation_date": 1495478247, "post_id": 44119876, "comment_id": 75258963, "body": "Can&#39;t we create something like a catcher automatically for the <code>testing</code> package and then redirect it to my custom signature tester?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 0, "creation_date": 1495478321, "post_id": 44119876, "comment_id": 75259004, "body": "I&#39;m not sure what you mean by &quot;catcher&quot;, but it sounds like you&#39;re describing something that could be considered its own test framework, which you explicitly said you didn&#39;t want to do."}, {"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 0, "creation_date": 1495478410, "post_id": 44119876, "comment_id": 75259054, "body": "Yeah, I&#39;m looking for a trick to do that. Is it hard to do without an external framework? A few functions to write to do that maybe (<i>? no clue yet</i>), not with an external framework. Catcher will act like a proxy."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 1, "creation_date": 1495478677, "post_id": 44119876, "comment_id": 75259227, "body": "No matter what you do, if you want to use Go&#39;s test framework, the entrypoint <i>has to be</i> a <code>func(t *testing.T)</code>. From there, you can do absolutely anything you want; you could use it like a <code>main()</code> function to start some entire other handler going. However, the more you diverge, the more you&#39;ll have trouble using other tooling that&#39;s intended for use with stdlib testing."}, {"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 0, "creation_date": 1495478862, "post_id": 44119876, "comment_id": 75259360, "body": "Yeah, I understand that, and I don&#39;t want to diverge from <code>stdlib</code> either, that&#39;s why I was planning to create small helpers for <code>testing</code> package. Maybe, some hacky proxy acts before the testing framework. Or a generated code maybe, hmm, that&#39;d be too much I guess."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 0, "last_activity_date": 1495478158, "creation_date": 1495478158, "answer_id": 44119876, "question_id": 44115117, "link": "https://stackoverflow.com/questions/44115117/go-testing-customization-with-testing-tb/44119876#44119876", "title": "Go testing customization with testing.TB", "body": "<p>The Go testing framework executes test functions of a specific signature, and that signature takes a <code>*testing.T</code>. If you want to use the stdlib testing system, your test functions have to have the required signature.</p>\n\n<p>You could wrap it with one line in every test function:</p>\n\n<pre><code>func MyTest(stdt *testing.T) {\n    // This line:\n    t := &amp;CustomTester{stdt}\n    t.assert(true)\n    t.Error(\"An error done happened\")\n}\n</code></pre>\n\n<p>There are other ways to do it, but there is no way to have a testing function, run by <code>go test</code>, using the stdlib <code>testing</code> package, that takes anything other than <code>*testing.T</code> as its sole parameter.</p>\n"}], "owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1223, "favorite_count": 0, "accepted_answer_id": 44119876, "answer_count": 1, "score": 0, "last_activity_date": 1495478158, "creation_date": 1495462334, "last_edit_date": 1495471219, "question_id": 44115117, "link": "https://stackoverflow.com/questions/44115117/go-testing-customization-with-testing-tb", "title": "Go testing customization with testing.TB", "body": "<p>I'm trying to customize the testing.T with my own <code>assert</code> method to lower the number of lines I'm writing. I tried the following, ended with an error: <code>\"wrong signature for TestCustom, must be: func TestCustom(t *testing.T)\"</code>.</p>\n\n<p>How can I make <code>TestCustom</code> use <code>CustomTester</code> interface with a new method, <code>assert</code>?</p>\n\n<p><em>I don't want to use a 3rd-party framework.</em></p>\n\n<p><strong>custom_testing.go</strong></p>\n\n<pre><code>type CustomTester struct {\n        testing.TB\n}\n\nfunc (t *CustomTester) assert(exp interface{}, act interface{}) {\n        if exp != act {\n                t.Errorf(\"expected: %v. got: %v\\n\", exp, act)\n        }\n}\n\n// I want testing package inject testing.T here\n// But, by using my own wrapper: CustomTester struct with,\n// my own assert method to get rid of using t as an argument,\n// in each assert like: assert(t, exp, act)\nfunc TestCustom(t *testing.TB) {\n        t.assert(3, len(foo))\n}\n</code></pre>\n\n<hr>\n\n<p><strong>NOTE:</strong> <em>I also tried this, it works but, I don't want to pass <code>t</code> each time when I'm testing:</em></p>\n\n<p><strong>working_not_wanted.go</strong></p>\n\n<pre><code>func assert(t *testing.TB, exp interface{}, act interface{}) {\n        if exp != act {\n                t.Errorf(\"expected: %v. got: %v\\n\", exp, act)\n        }\n}\n\nfunc TestCustom(t *testing.T) {\n        assert(t, 3, len(foo))\n}\n</code></pre>\n"}, {"tags": ["java", "go", "protocol-buffers", "grpc", "grpc-java"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1495455043, "post_id": 44112495, "comment_id": 75244244, "body": "As an exception?"}], "answers": [{"tags": [], "owner": {"reputation": 3410, "user_id": 3570517, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/9n356.jpg?s=128&g=1", "display_name": "Abdul Wasae", "link": "https://stackoverflow.com/users/3570517/abdul-wasae"}, "is_accepted": false, "score": 0, "last_activity_date": 1495463084, "last_edit_date": 1495463084, "creation_date": 1495456670, "answer_id": 44113071, "question_id": 44112495, "link": "https://stackoverflow.com/questions/44112495/grpc-how-to-get-multiple-return-values-in-java-client-with-go-server/44113071#44113071", "title": "gRPC: How to get multiple return values in Java client with Go server", "body": "<p>Since Java does not support multiple return values, when a protoBuf is generated into a java code, the errors are communicated by throwing exceptions. Make your gRPC call in a <code>try-catch</code> block and catch any <code>StatusRuntimeException</code> that the call may throw.</p>\n"}, {"tags": [], "owner": {"reputation": 4055, "user_id": 2598037, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWCTo.jpg?s=128&g=1", "display_name": "Carl Mastrangelo", "link": "https://stackoverflow.com/users/2598037/carl-mastrangelo"}, "is_accepted": true, "score": 2, "last_activity_date": 1495483057, "creation_date": 1495483057, "answer_id": 44121143, "question_id": 44112495, "link": "https://stackoverflow.com/questions/44112495/grpc-how-to-get-multiple-return-values-in-java-client-with-go-server/44121143#44121143", "title": "gRPC: How to get multiple return values in Java client with Go server", "body": "<p>In Go, the error returned by your <code>Login</code> method will get converted into the wire format status <code>code</code> and <code>message</code> used by gRPC.  In your case, if you return a  <a href=\"https://godoc.org/google.golang.org/grpc/status\" rel=\"nofollow noreferrer\">status.Status</a>, the Code and message will be sent and show up on the Java side as a <a href=\"http://www.grpc.io/grpc-java/javadoc/io/grpc/StatusRuntimeException.html\" rel=\"nofollow noreferrer\">StatusRuntimeException</a>.  If you return a non <code>Status</code> error, gRPC will convert it to the <code>UNKNOWN</code> code, but preserve the message.</p>\n\n<p>This is the reason there are two return values for Go, vs. just one for Java.  Java can \"return\" a secondary value by throwing an exception in its place.</p>\n"}], "owner": {"reputation": 3410, "user_id": 3570517, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/9n356.jpg?s=128&g=1", "display_name": "Abdul Wasae", "link": "https://stackoverflow.com/users/3570517/abdul-wasae"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1730, "favorite_count": 0, "accepted_answer_id": 44121143, "answer_count": 2, "score": 0, "last_activity_date": 1495483057, "creation_date": 1495454914, "question_id": 44112495, "link": "https://stackoverflow.com/questions/44112495/grpc-how-to-get-multiple-return-values-in-java-client-with-go-server", "title": "gRPC: How to get multiple return values in Java client with Go server", "body": "<p>I have a <code>protocol buffer</code> file:</p>\n\n<pre><code>syntax = \"proto3\";\npackage v1api;\noption java_multiple_files = true;\noption java_package = \"myApp.v1\";\noption java_outer_classname = \"V1\";\n\nservice API {\n    rpc Login(LoginRequest) returns (LoginResponse)\n}\n\nmessage LoginRequest {\n    int pin = 1\n}\n\nmessage LoginResponse {\n    string token = 1\n}\n</code></pre>\n\n<p>I have my server written in Go (a language that can return multiple values), and my client being an Android application.</p>\n\n<p>When I use this protoBuf to generate Go code for server, it is something like:</p>\n\n<pre><code>...\nfunc (c *aPIClient) Login(ctx context.Context, in *LoginRequest, opts ...grpc.CallOption) (*LoginResponse, error) {\n    out := new(LoginResponse)\n    err := grpc.Invoke(ctx, \"/v1api.API/Login\", in, out, c.cc, opts...)\n    if err != nil {\n        return nil, err\n    }\n    return out, nil\n}\n...\n</code></pre>\n\n<p>Notice that there are <strong>two</strong> return values, <code>(*LoginResponse, error)</code>.</p>\n\n<p>Now, when I use this protoBuf to generate Java code for my Android side, I get something like:</p>\n\n<pre><code>public myApp.v1.LoginResponse login(myApp.v1.LoginRequest request) {\n    return blockingUnaryCall(getChannel(), METHOD_LOGIN, getCallOptions(), request);\n}\n</code></pre>\n\n<p>Notice that, here, there is just <strong>one</strong> return value like Java allows, <code>myApp.v1.LoginResponse</code>.</p>\n\n<p>My question is, in case of an error returned by the server (something like: <code>return nil, err</code>), how will I get that second return value in my Android side.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1495453297, "post_id": 44111752, "comment_id": 75243085, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/12907653/what-is-difference-between-string-and-string-in-golang\">what is difference between &#91;&#93;string and ...string in golang?</a>"}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1495453323, "post_id": 44111752, "comment_id": 75243097, "body": "<a href=\"http://stackoverflow.com/questions/23669720/dot-dot-dot-in-golang-interface-with-empty-braces\" title=\"dot dot dot in golang interface with empty braces\">stackoverflow.com/questions/23669720/&hellip;</a>"}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1495453409, "post_id": 44111752, "comment_id": 75243147, "body": "This is an ellipsis parameter that has discussed extensively before. <a href=\"http://stackoverflow.com/questions/19238143/does-golang-support-variadic-function\" title=\"does golang support variadic function\">stackoverflow.com/questions/19238143/&hellip;</a>"}], "owner": {"reputation": 43, "user_id": 7745115, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/59c5807161cec3bf19e78df19155d92b?s=128&d=identicon&r=PG&f=1", "display_name": "12344343243", "link": "https://stackoverflow.com/users/7745115/12344343243"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 556, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1495454579, "creation_date": 1495452590, "last_edit_date": 1495454579, "question_id": 44111752, "link": "https://stackoverflow.com/questions/44111752/golang-search-in-mysql-db", "title": "golang search in mysql DB", "body": "<p>I'm currently working on implementing a new search function, and I've encountered some problems regarding the prewritten golang code. </p>\n\n<p>The search function is really simple, I want to search for Id's of a certain year. </p>\n\n<p>Now I can prepare my mysql statement, but at some point it has to be fed through this function:</p>\n\n<pre><code>func (papers *PapersEnv) StatementBegin(sql string, params ...interface{}) *mysql.Statement {\n    papers.db.Lock()\n    stmt, err := papers.db.Prepare(sql)\n    if err != nil {\n        fmt.Println(\"MySQL statement error;\", err)\n        return nil\n    }\n    err = stmt.BindParams(params...)\n    if err != nil {\n        fmt.Println(\"MySQL statement error;\", err)\n        return nil\n    }\n    err = stmt.Execute()\n    if err != nil {\n        fmt.Println(\"MySQL statement error;\", err)\n        return nil\n    }\n    return stmt\n}\n</code></pre>\n\n<p>The second function parameter is what causes my problems. As far as I can understand this is a controle parameter, which limits the possibilities of the search function, so a user can't for instance input a command which deletes the database.</p>\n\n<p>Anyone knows what's going on?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1495459391, "post_id": 44110834, "comment_id": 75247344, "body": "<a href=\"https://medium.com/@matryer/the-http-handler-wrapper-technique-in-golang-updated-bc7fbcffa702\" rel=\"nofollow noreferrer\">medium.com/@matryer/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 186, "user_id": 1148744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e92dff716fefa6d7bb7397cf34d4529?s=128&d=identicon&r=PG", "display_name": "Lym", "link": "https://stackoverflow.com/users/1148744/lym"}, "is_accepted": false, "score": 2, "last_activity_date": 1495461009, "creation_date": 1495461009, "answer_id": 44114628, "question_id": 44110834, "link": "https://stackoverflow.com/questions/44110834/golang-middleware-with-just-the-standard-library/44114628#44114628", "title": "Golang middleware with just the standard library", "body": "<p>According to what I've seen from the Go documentation examples:</p>\n\n<ul>\n<li><p>A <em>Handler</em> is a type created to respond to an HTTP request. To make a type a Handler all one has to do is implement a <code>ServeHTTP()</code> method. The ServeHTTP() method does the actual request processing.</p></li>\n<li><p><code>Handle()</code> takes the route and a Handler, the type that has an instance method named <code>ServeHttp()</code>. Note that it just takes the type, there's no need for one to point at the actual method/function that handles the request explicitly.</p></li>\n<li><p><code>HandlerFunc</code> is a type that internally implements a <code>ServeHTTP()</code> method. <code>HandlerFunc</code> is used to cast any Go function, with the right signature, to a <code>HandlerFunc</code>. The newly minted <code>HandlerFunc</code> is then passed to the <code>Handle()</code> method together with the route it processes.\nNote that the <code>HandlerFunc</code> lets one implement request handlers by just writing functions without the need for a dedicated handler type.</p></li>\n<li><p><code>HandleFunc()</code> takes a route and any function that has the right signature. <code>HandleFunc</code> is shorthand for first of all doing the type casting and then passing the function to the <code>Handle()</code> method.</p></li>\n</ul>\n\n<p>The signature for a request handling function is:</p>\n\n<pre><code>  func handlerName(wr http.ResponseWriter, req *http.Request)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 13954, "user_id": 3422652, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/sQ3DW.jpg?s=128&g=1", "display_name": "Chris Drew", "link": "https://stackoverflow.com/users/3422652/chris-drew"}, "is_accepted": true, "score": 2, "last_activity_date": 1495474981, "last_edit_date": 1495474981, "creation_date": 1495461146, "answer_id": 44114678, "question_id": 44110834, "link": "https://stackoverflow.com/questions/44110834/golang-middleware-with-just-the-standard-library/44114678#44114678", "title": "Golang middleware with just the standard library", "body": "<blockquote>\n  <p>I would like ... simple understanding of the Handle, Handler, HandleFunc, HandlerFunc.</p>\n</blockquote>\n\n<ul>\n<li><code>Handler</code> is an interface that can respond to an HTTP request and has a <code>ServeHTTP(ResponseWriter, *Request)</code> method.</li>\n<li><code>http.Handle</code> registers a <code>Handler</code> to handle HTTP requests matching a given <code>pattern</code>.</li>\n<li><code>http.HandleFunc</code> registers a handler function to handle HTTP requests matching a given <code>pattern</code>. The handler function should be of the form <code>func(ResponseWriter, *Request)</code>.</li>\n<li><code>HandlerFunc</code> is an explicit function type of the form <code>func(ResponseWriter, *Request)</code>. <code>HandlerFunc</code> has a method <code>ServeHTTP</code> that calls itself . This allows you to cast a function to a <code>HandlerFunc</code> and use it as a <code>Handler</code>.</li>\n</ul>\n\n<blockquote>\n  <p>I would to know the difference between the two calls</p>\n</blockquote>\n\n<pre><code>http.Handle(\"/profile\", Logger(profilefunc))\nhttp.HandleFunc(\"/\", HomeFunc)\n</code></pre>\n\n<p><code>Logger</code> is an example of a <a href=\"http://www.alexedwards.net/blog/making-and-using-middleware\" rel=\"nofollow noreferrer\">middleware</a>, which is a function that takes an <code>http.Handler</code> and it returns another <code>http.Handler</code> that wraps the original handler. When called this handler may (or may not) call the nested <code>http.Handler</code> before and/or after performing some operation. So the first line is saying register the <code>profileFunc</code> <code>Handler</code> wrapped in the <code>Logger</code> middleware with the pattern \"/profile\". The second line is saying register the <code>HomeFunc</code> function with the \"/\" pattern.</p>\n"}], "owner": {"reputation": 73, "user_id": 8047568, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Uo2L3.jpg?s=128&g=1", "display_name": "Imran Pochi", "link": "https://stackoverflow.com/users/8047568/imran-pochi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 739, "favorite_count": 2, "accepted_answer_id": 44114678, "answer_count": 2, "score": 4, "last_activity_date": 1495474981, "creation_date": 1495449728, "last_edit_date": 1495450833, "question_id": 44110834, "link": "https://stackoverflow.com/questions/44110834/golang-middleware-with-just-the-standard-library", "title": "Golang middleware with just the standard library", "body": "<p>My first stackoverflow question, so please go easy on my naivety about stackoverflow and the question asked, beginner in golang.</p>\n\n<p>I would like to know the difference between the two calls and also simple understanding of the <code>Handle</code>, <code>Handler</code>, <code>HandleFunc</code>, <code>HandlerFunc</code>.</p>\n\n<blockquote>\n  <p>http.Handle(\"/profile\", Logger(profilefunc))<br>\n  http.HandleFunc(\"/\", HomeFunc)</p>\n</blockquote>\n\n<pre><code>func main() {            \n   fmt.Println(\"Starting the server.\")\n\n   profilefunc := http.HandlerFunc(ProfileFunc)\n\n   http.Handle(\"/profile\", Logger(profilefunc))\n   http.HandleFunc(\"/\", HomeFunc)\n\n   http.ListenAndServe(\"0.0.0.0:8081\", nil)\n}\n\nfunc Logger(h http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request){\n        log.Println(\"Before serving request\")\n        h.ServeHTTP(w, r)\n        log.Println(\"After serving request\")\n    })\n}\n\nfunc ProfileFunc(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, \"You are on the profile page.\")\n}\n\nfunc HomeFunc(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hello Imran Pochi\")\n}\n</code></pre>\n"}, {"tags": ["docker", "go", "visual-studio-code", "delve"], "answers": [{"comments": [{"owner": {"reputation": 2996, "user_id": 2733115, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/asgs0.jpg?s=128&g=1", "display_name": "Daniel Andrei Minc\u0103", "link": "https://stackoverflow.com/users/2733115/daniel-andrei-minc%c4%83"}, "edited": false, "score": 0, "creation_date": 1563201601, "post_id": 46736584, "comment_id": 100611835, "body": "If the port is exposed &amp; mapped, it can be accessed via <code>localhost:&lt;exposed-port&gt;</code>, you don&#39;t need to point to the container IP as that&#39;ll change each time you launch the container."}], "tags": [], "owner": {"reputation": 122, "user_id": 1117653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50135c665d3417c500d84a0c25f135cc?s=128&d=identicon&r=PG", "display_name": "MrMobileMan", "link": "https://stackoverflow.com/users/1117653/mrmobileman"}, "is_accepted": false, "score": 0, "last_activity_date": 1507921801, "creation_date": 1507921801, "answer_id": 46736584, "question_id": 44109289, "link": "https://stackoverflow.com/questions/44109289/how-to-debug-golang-application-in-docker-with-vscode/46736584#46736584", "title": "How to debug Golang application in Docker with VSCode?", "body": "<p>I think the main thing you need to fix is changing the host from \"127.0.0.1\" (localhost) to the IP for your container (line 11 of your launch.json file above).  Here's an article that may help: </p>\n\n<p><a href=\"https://blog.intelligentbee.com/2016/12/15/debugging-golang-apps-in-docker-with-visual-studio-code/\" rel=\"nofollow noreferrer\">https://blog.intelligentbee.com/2016/12/15/debugging-golang-apps-in-docker-with-visual-studio-code/</a></p>\n\n<p>According to this, \"You might have to change the host IP  to what your docker-machine ip output is.\"  Or, if you are using kubernetes, you may need to use \"kubectl describe pod \" instead, then look for \"IP:\"</p>\n"}], "owner": {"reputation": 31, "user_id": 5672279, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7ZPcvHLXBPY/AAAAAAAAAAI/AAAAAAAAF74/TuWN_5YGXJA/photo.jpg?sz=128", "display_name": "YesQ", "link": "https://stackoverflow.com/users/5672279/yesq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3669, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1595452362, "creation_date": 1495445052, "question_id": 44109289, "link": "https://stackoverflow.com/questions/44109289/how-to-debug-golang-application-in-docker-with-vscode", "title": "How to debug Golang application in Docker with VSCode?", "body": "<p>I'm learning debug Golang application in Docker. I have success with <code>dlv connect</code> in shell. I could add breakpoint, continue, next... I can do noting in VSCode, but waitting for <code>halting</code>. </p>\n\n<p>I click left on function main, until a red point. Then click the green button, which like 'play'. Program in container run, but can not stop on function main.</p>\n\n<p>Did I use VSCode in wrong way? I need your help. Thank you. </p>\n\n<h2>This is my delve image:</h2>\n\n<pre><code>#Dockerfile\nFROM supinf/go:1.8-builder\n\nRUN apk --no-cache add tini \\\n&amp;&amp; apk --no-cache add --virtual build-dependencies git \\\n\n# Compile delve\n&amp;&amp; go get github.com/derekparker/delve/cmd/dlv \\\n&amp;&amp; cd $GOPATH/src/github.com/derekparker/delve \\\n&amp;&amp; go install github.com/derekparker/delve/cmd/dlv \\\n\n# Clean up\n&amp;&amp; apk del --purge -r build-dependencies \\\n&amp;&amp; rm -rf /go/src/*\n\nENTRYPOINT [\"/sbin/tini\", \"--\"]\nCMD [\"dlv\", \"-h\"]\n</code></pre>\n\n<p><code>docker build -t mydelve .</code></p>\n\n<h2>This is my golang code:</h2>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nfunc dostuff(wg *sync.WaitGroup, i int) {\n    fmt.Printf(\"goroutine id %d\\n\", i)\n    time.Sleep(60 * time.Second)\n    fmt.Printf(\"end goroutine id %d\\n\", i)\n    wg.Done()\n}\n\nfunc main() {\n    var wg sync.WaitGroup\n    workers := 10\n\n    wg.Add(workers)\n    for i := 0; i &lt; workers; i++ {\n            go dostuff(&amp;wg, i)\n    }\n    wg.Wait()\n}\n</code></pre>\n\n<h2>This is cmd to run container:</h2>\n\n<pre><code>docker run --rm -p 2345:2345 \n           -v $GOPATH/src:/go/src \n           -w /go/src/test/dlv \n           --security-opt seccomp=unconfined \n           mydelve \n               dlv debug --headless --listen=:2345 --log`\n</code></pre>\n\n<h2>connect to container</h2>\n\n<p><code>dlv connect 127.0.0.1:2345 --wd . --log</code></p>\n\n<p>It works.</p>\n\n<h2>VSCode</h2>\n\n<p>launch.json</p>\n\n<pre><code>{\n    \"version\": \"0.2.0\",\n    \"configurations\": [\n       {\n            \"name\": \"Remote\",\n            \"type\": \"go\",\n            \"request\": \"launch\",\n            \"mode\": \"remote\",\n            \"program\": \"${fileDirname}\",\n            \"port\": 2345,\n            \"host\": \"127.0.0.1\",\n            \"env\": {},\n            \"args\": []\n        }\n    ]\n}\n</code></pre>\n\n<p>Logs in container</p>\n\n<pre><code>$ docker run --rm -p 2345:2345 -v $GOPATH/src:/go/src -w /go/src/test/dlv --security-opt seccomp=unconfined mydelve dlv debug --headless --listen=:2345 --log\n2017/05/22 09:07:56 server.go:73: Using API v1\n2017/05/22 09:07:56 debugger.go:97: launching process with args: [/go/src/test/dlv/debug]\nAPI server listening at: [::]:2345\n2017/05/22 09:08:00 debugger.go:505: continuing\ngoroutine id 3\ngoroutine id 9\ngoroutine id 4\ngoroutine id 5\ngoroutine id 6\ngoroutine id 7\ngoroutine id 8\ngoroutine id 1\ngoroutine id 0\ngoroutine id 2\nend goroutine id 6\nend goroutine id 3\nend goroutine id 9\nend goroutine id 4\nend goroutine id 5\nend goroutine id 8\nend goroutine id 7\nend goroutine id 1\nend goroutine id 0\nend goroutine id 2\n2017/05/22 09:08:10 debugger.go:496: halting\n</code></pre>\n"}, {"tags": ["http", "go"], "answers": [{"tags": [], "owner": {"reputation": 3441, "user_id": 455306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/903d96c91eb06237d765695845d51e72?s=128&d=identicon&r=PG", "display_name": "Brad Fitzpatrick", "link": "https://stackoverflow.com/users/455306/brad-fitzpatrick"}, "is_accepted": true, "score": 21, "last_activity_date": 1495582153, "creation_date": 1495582153, "answer_id": 44146619, "question_id": 44107868, "link": "https://stackoverflow.com/questions/44107868/is-http-closenotify-entirely-replaced-by-http-request-context-done/44146619#44146619", "title": "Is http.CloseNotify entirely replaced by http.Request.Context().Done()?", "body": "<p>Yes, but only in Go 1.8+. The APIs existed in Go 1.7 but it wasn't until Go 1.8 that the client's disconnection caused the Request's Context to be Done, so in Go 1.7 there was still a valid use of CloseNotifier.</p>\n\n<p>(Source: I added \"context\" to the standard library and am the author of the net/http package.)</p>\n"}], "owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1179, "favorite_count": 0, "accepted_answer_id": 44146619, "answer_count": 1, "score": 9, "last_activity_date": 1495582153, "creation_date": 1495440954, "question_id": 44107868, "link": "https://stackoverflow.com/questions/44107868/is-http-closenotify-entirely-replaced-by-http-request-context-done", "title": "Is http.CloseNotify entirely replaced by http.Request.Context().Done()?", "body": "<p>Go 1.7 added Context to the http.Request. Does it completely replace http.CloseNotify? Should I prefer that now, and not bother with CloseNotify?</p>\n"}, {"tags": ["image", "go", "alpha"], "answers": [{"comments": [{"owner": {"reputation": 85, "user_id": 4590927, "user_type": "registered", "profile_image": "https://graph.facebook.com/968527113165799/picture?type=large", "display_name": "Yurina Shirahane", "link": "https://stackoverflow.com/users/4590927/yurina-shirahane"}, "edited": false, "score": 0, "creation_date": 1495441710, "post_id": 44105659, "comment_id": 75235659, "body": "Opaque() method means all pixels alpha are 0xff return true, But use Opaque() to choose the image have alpha channel or not may have exception. If I have a png that have alpha channel and all the pixels are opaque. Or do not worry about this?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 85, "user_id": 4590927, "user_type": "registered", "profile_image": "https://graph.facebook.com/968527113165799/picture?type=large", "display_name": "Yurina Shirahane", "link": "https://stackoverflow.com/users/4590927/yurina-shirahane"}, "edited": false, "score": 0, "creation_date": 1495442112, "post_id": 44105659, "comment_id": 75235857, "body": "@YurinaShirahane The above <code>Opaque()</code> will return <code>true</code> if the image does not have an alpha channel, or it has but all pixels are opaque. It returns false if and only if the image has alpha channel and there is at least 1 pixel that is not (fully) opaque."}, {"owner": {"reputation": 85, "user_id": 4590927, "user_type": "registered", "profile_image": "https://graph.facebook.com/968527113165799/picture?type=large", "display_name": "Yurina Shirahane", "link": "https://stackoverflow.com/users/4590927/yurina-shirahane"}, "edited": false, "score": 0, "creation_date": 1495444888, "post_id": 44105659, "comment_id": 75237665, "body": "So Opaque() is: true == &quot;image does not have an alpha channel&quot; or &quot;image has an alpha channel but all pixels are opaque&quot;, false == &quot;image has an alpha channel and at least 1 pixel that is not (fully) opaque&quot;. But I want to make a HaveAlpha(), that is: true == image has an alpha channel no matter all pixels are opaque not, false ==  image does not have an alpha channel."}, {"owner": {"reputation": 85, "user_id": 4590927, "user_type": "registered", "profile_image": "https://graph.facebook.com/968527113165799/picture?type=large", "display_name": "Yurina Shirahane", "link": "https://stackoverflow.com/users/4590927/yurina-shirahane"}, "edited": false, "score": 0, "creation_date": 1495445070, "post_id": 44105659, "comment_id": 75237774, "body": "!Opaque() can be used in HaveAlpha() that I want to make on &quot;image does not have an alpha channel&quot; and &quot;image has an alpha channel and at least 1 pixel that is not (fully) opaque&quot;. But when &quot;image has an alpha channel but all pixels are opaque&quot;, !Opaque() can not be used in HaveAlpha()."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 85, "user_id": 4590927, "user_type": "registered", "profile_image": "https://graph.facebook.com/968527113165799/picture?type=large", "display_name": "Yurina Shirahane", "link": "https://stackoverflow.com/users/4590927/yurina-shirahane"}, "edited": false, "score": 0, "creation_date": 1495445417, "post_id": 44105659, "comment_id": 75238008, "body": "@YurinaShirahane The <code>image.Image</code> interface <b>does not enforce</b> all pixels to have the same <code>color.Color</code> concrete type. An <code>Image</code> implementation <i>may</i> return <code>color.RGBA</code> for a pixel, and <code>color.Gray16</code> for another (since both implement <code>color.Color</code>)."}, {"owner": {"reputation": 85, "user_id": 4590927, "user_type": "registered", "profile_image": "https://graph.facebook.com/968527113165799/picture?type=large", "display_name": "Yurina Shirahane", "link": "https://stackoverflow.com/users/4590927/yurina-shirahane"}, "edited": false, "score": 0, "creation_date": 1495448337, "post_id": 44105659, "comment_id": 75239989, "body": "I konw that. But now I only want to know is that how do I judge &quot;a image that has an alpha channel and all pixels are opaque&quot; that has an alpha channel or not. In this case, alpha channel of all pixels are 255 and Opaque() is true, this result is the same as a image that does not have an alpha channel."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 85, "user_id": 4590927, "user_type": "registered", "profile_image": "https://graph.facebook.com/968527113165799/picture?type=large", "display_name": "Yurina Shirahane", "link": "https://stackoverflow.com/users/4590927/yurina-shirahane"}, "edited": false, "score": 0, "creation_date": 1495448508, "post_id": 44105659, "comment_id": 75240103, "body": "@YurinaShirahane I&#39;m not sure I understand you completely, but this is what my <code>Opaque()</code> function does."}, {"owner": {"reputation": 85, "user_id": 4590927, "user_type": "registered", "profile_image": "https://graph.facebook.com/968527113165799/picture?type=large", "display_name": "Yurina Shirahane", "link": "https://stackoverflow.com/users/4590927/yurina-shirahane"}, "edited": false, "score": 0, "creation_date": 1495449118, "post_id": 44105659, "comment_id": 75240450, "body": "I just tried if a png is 32bit, image.Image would *image.NRGBA, and 24bit and 8bit would be *image.RGBA, I think I could use both this and Opaque() to complete my  HaveAlpha() function. Thinks a lot on part &quot;type assertion&quot; and tell me what Opaque() does in all case. Or use NRGBA and RGBA to judge png-32bit (have alpha channel) and png-others-bit have any exception that I need to be careful?"}, {"owner": {"reputation": 326, "user_id": 4241695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29508bab236e6635078f43391a96c5e2?s=128&d=identicon&r=PG&f=1", "display_name": "Richard Artoul", "link": "https://stackoverflow.com/users/4241695/richard-artoul"}, "edited": false, "score": 0, "creation_date": 1496771196, "post_id": 44105659, "comment_id": 75792877, "body": "Possible bug in the code above:  <code>for x := rect.Min.X; y &lt; rect.Max.X; x++</code>  should be:  <code>for x := rect.Min.X; x &lt; rect.Max.X; x++</code>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1496771859, "last_edit_date": 1496771859, "creation_date": 1495433089, "answer_id": 44105659, "question_id": 44105499, "link": "https://stackoverflow.com/questions/44105499/what-is-the-best-way-to-decide-if-an-image-has-alpha-channel/44105659#44105659", "title": "What is the best way to decide if an image has alpha channel?", "body": "<p>You may use <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a> to check if the concrete value stored in the <a href=\"https://golang.org/pkg/image/#Image\" rel=\"nofollow noreferrer\"><code>image.Image</code></a> interface type has an <code>Opaque() bool</code> method, and if so, simply call that and return its result. Note that all concrete image types in the <a href=\"https://golang.org/pkg/image/\" rel=\"nofollow noreferrer\"><code>image</code></a> package do have an <code>Opaque()</code> method, so this will cover most cases.</p>\n\n<p>If the image does not have such an <code>Opaque()</code> method, loop over all pixels of the image and check if any of the pixel has an alpha value other than <code>0xff</code>, which means it's non-opaque.</p>\n\n<p>Note that <code>Image.At()</code> has a return type of the general <a href=\"https://golang.org/pkg/image/color/#Color\" rel=\"nofollow noreferrer\"><code>color.Color</code></a> interface type, which only guarantees a single method: <code>Color.RGBA()</code>. This <code>RGBA()</code> method returns the <em>alpha-premultiplied</em> red, green, blue and alpha components, so if a pixel has <code>0xff</code> alpha value, that equals to <code>0xffff</code> when \"alpha-premultiplied\", so that's what we need to compare to.</p>\n\n<pre><code>func Opaque(im image.Image) bool {\n    // Check if image has Opaque() method:\n    if oim, ok := im.(interface {\n        Opaque() bool\n    }); ok {\n        return oim.Opaque() // It does, call it and return its result!\n    }\n\n    // No Opaque() method, we need to loop through all pixels and check manually:\n    rect := im.Bounds()\n    for y := rect.Min.Y; y &lt; rect.Max.Y; y++ {\n        for x := rect.Min.X; x &lt; rect.Max.X; x++ {\n            if _, _, _, a := im.At(x, y).RGBA(); a != 0xffff {\n                return false // Found a non-opaque pixel: image is non-opaque\n            }\n        }\n\n    }\n    return true // All pixels are opaque, so is the image\n}\n</code></pre>\n\n<p>The above <code>Opaque()</code> function will return <code>true</code> if the image does not have an alpha channel, or it has but all pixels are opaque. It returns <code>false</code> if and only if the image has alpha channel and there is at least 1 pixel that is not (fully) opaque.</p>\n\n<p><strong>Note:</strong> If an image does have an <code>Opaque()</code> method, you can be sure that it takes existing pixels and their alpha values into consideration, so for example <a href=\"https://golang.org/pkg/image/#RGBA.Opaque\" rel=\"nofollow noreferrer\"><code>image.RGBA.Opaque()</code></a> also scans the entire image similarly to what we did above; but we had to do it in a general way, and <code>Opaque()</code> implementations of concrete images may be much more efficient (so it is highly recommended to use the \"shipped\" <code>Opaque()</code> method if it is available). As an example, implementation of <a href=\"https://golang.org/pkg/image/#RGBA.Opaque\" rel=\"nofollow noreferrer\"><code>image.YCbCr.Opaque()</code></a> is a simple <code>return true</code> statement because <code>YCbCr</code> images do not have alpha channel.</p>\n"}], "owner": {"reputation": 85, "user_id": 4590927, "user_type": "registered", "profile_image": "https://graph.facebook.com/968527113165799/picture?type=large", "display_name": "Yurina Shirahane", "link": "https://stackoverflow.com/users/4590927/yurina-shirahane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 873, "favorite_count": 0, "accepted_answer_id": 44105659, "answer_count": 1, "score": 1, "last_activity_date": 1496771859, "creation_date": 1495432356, "last_edit_date": 1495434785, "question_id": 44105499, "link": "https://stackoverflow.com/questions/44105499/what-is-the-best-way-to-decide-if-an-image-has-alpha-channel", "title": "What is the best way to decide if an image has alpha channel?", "body": "<p>I need to decide if an image has alpha channel or not, so I write the code like this.</p>\n\n<pre><code>var HaveAlpha = func(Image image.Image) bool {\n    switch Image.ColorModel() {\n    case color.YCbCrModel, color.CMYKModel:\n        return false\n    case color.RGBAModel:\n        return !Image.(*image.RGBA).Opaque()\n    }\n    // ...\n    return false\n}\n</code></pre>\n\n<p>So I need to list all the <code>ColorModel</code> types and use <code>Opaque()</code> to decide if the image has alpha channel or not (because I cannot use <code>Opaque()</code> method in type <code>image.Image</code> directly). And if an image has alpha channel but all pixels are opaque in the image (all RGBA of pixels in that image are like <code>(*,*,*,255)</code>), this code may return wrong answer.</p>\n\n<p>Is there a right or better way to decide if an image has alpha channel or not in Golang?</p>\n"}, {"tags": ["java", "node.js", "go", "ipc", "grpc"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1495453767, "post_id": 44104991, "comment_id": 75243369, "body": "First things first: does node have a grpc/protobuf client lib? If not the question is moot."}], "answers": [{"comments": [{"owner": {"reputation": 175, "user_id": 6450986, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/db52faf550592f28a2e9bc370ba8d4c5?s=128&d=identicon&r=PG&f=1", "display_name": "YafimK", "link": "https://stackoverflow.com/users/6450986/yafimk"}, "edited": false, "score": 0, "creation_date": 1495439919, "post_id": 44105821, "comment_id": 75234711, "body": "Thanks for the clarification - I guess i need to rephrase."}], "tags": [], "owner": {"reputation": 752, "user_id": 7496656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zMGuk.jpg?s=128&g=1", "display_name": "Jan Zerebecki", "link": "https://stackoverflow.com/users/7496656/jan-zerebecki"}, "is_accepted": false, "score": 0, "last_activity_date": 1495433828, "creation_date": 1495433828, "answer_id": 44105821, "question_id": 44104991, "link": "https://stackoverflow.com/questions/44104991/why-should-i-use-grpc-instead-of-ipc-simple-websocket/44105821#44105821", "title": "Why should I use gRPC instead of IPC / Simple websocket?", "body": "<p>These are on different abstraction levels and have different uses, as such the 'or' in the question is wrong. <strong>You will need both</strong> types (transport and encoding), even if you reimplement one of them.</p>\n\n<p>IPC like an anonymous or named pipe is usually called a transport, they have no way to encode multiple instructions or results (though they encode a stream of bytes).</p>\n\n<p>gRPC and protobuf need a transport, support multiple transports and add more fine grained encoding (how to represent an integer, a list, etc) and possibly more on top. Technologies that support encoding something can often be nested with a transport or encoding, this is common with technologies that are used together with HTTP, this may make sense but may only add a layer without having a use.</p>\n"}], "owner": {"reputation": 175, "user_id": 6450986, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/db52faf550592f28a2e9bc370ba8d4c5?s=128&d=identicon&r=PG&f=1", "display_name": "YafimK", "link": "https://stackoverflow.com/users/6450986/yafimk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2392, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1495433828, "creation_date": 1495429485, "question_id": 44104991, "link": "https://stackoverflow.com/questions/44104991/why-should-i-use-grpc-instead-of-ipc-simple-websocket", "title": "Why should I use gRPC instead of IPC / Simple websocket?", "body": "<p>I'm sketching an architecture for a micro services system, planned to run currently on one machine (maybe distribution in the future).\nThe system will be composed of services written in both Node.js, GO and might be Java.\nBoth node.js and Java will need to pass instructions and receive results from the GO server.</p>\n\n<p>Now, I'm trying to decide should I use IPC pipe or ramp up on gRPC and protobuff and use them.</p>\n"}, {"tags": ["logging", "go", "systemd"], "comments": [{"owner": {"reputation": 3158, "user_id": 7925197, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M21lU.png?s=128&g=1", "display_name": "papey", "link": "https://stackoverflow.com/users/7925197/papey"}, "edited": false, "score": 1, "creation_date": 1495437879, "post_id": 44104928, "comment_id": 75233538, "body": "Systemd logging is about capturing standard outpout. Systemd handles log rotation with journald. In order to get logging stuff in systemd journal, just write information on stdout, then view logs with <code>journalctl -u myservice</code>"}], "answers": [{"tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 0, "last_activity_date": 1495442141, "creation_date": 1495442141, "answer_id": 44108234, "question_id": 44104928, "link": "https://stackoverflow.com/questions/44104928/rotate-log-file-in-golang-with-systemd/44108234#44108234", "title": "Rotate log file in golang with systemd", "body": "<p><strong>lumberjack</strong>\nIt's hard to know what's wrong here without knowing the values of <code>property.AppProperties.Logging.Path</code> and <code>logFile</code>. Also, you are opening the file as WRONLY (write only) and RDWR (read-write).</p>\n\n<p>try <code>os.OpenFile(logFile, os.O_WRONLY|os.O_CREATE|os.O_APPEND, 0666)</code></p>\n\n<p><strong>log4go</strong> appears to be unmaintained. But this is probably where the error is coming from:\n<a href=\"https://github.com/alecthomas/log4go/blob/master/filelog.go#L169\" rel=\"nofollow noreferrer\">https://github.com/alecthomas/log4go/blob/master/filelog.go#L169</a></p>\n\n<p>Maybe you still have another logging implementation in your app that could still be using that file? <code>filelog.go</code> seems to close the file before attempting the rename.</p>\n\n<p><strong>12factor way</strong> it might also be useful to consider this.\n<a href=\"https://12factor.net/logs\" rel=\"nofollow noreferrer\">https://12factor.net/logs</a></p>\n\n<blockquote>\n  <p>A twelve-factor app never concerns itself with routing or storage of\n  its output stream.</p>\n</blockquote>\n\n<p>And offload the rotation of logs to another process that reads from stdout, e.g. systemd, docker, logstash</p>\n"}, {"tags": [], "owner": {"reputation": 11251, "user_id": 254318, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fqtBB.jpg?s=128&g=1", "display_name": "Mark Stosberg", "link": "https://stackoverflow.com/users/254318/mark-stosberg"}, "is_accepted": false, "score": 1, "last_activity_date": 1495464547, "creation_date": 1495464547, "answer_id": 44115973, "question_id": 44104928, "link": "https://stackoverflow.com/questions/44104928/rotate-log-file-in-golang-with-systemd/44115973#44115973", "title": "Rotate log file in golang with systemd", "body": "<p>The recommendation with <code>systemd</code> is to log to STDOUT, which <code>systemd</code> automatically captures and stores in the journal for you, accessible by <code>journalctl -u yourproject.service</code>. It also handles log rotation for you. </p>\n\n<p>For more information, you can review <code>man journalctl</code> or <code>man journald.conf</code></p>\n"}], "owner": {"reputation": 637, "user_id": 1334598, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/8bc4b7637f167a4ab4221851adf3dddf?s=128&d=identicon&r=PG", "display_name": "greenthunder", "link": "https://stackoverflow.com/users/1334598/greenthunder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2463, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1495464580, "creation_date": 1495429119, "last_edit_date": 1495464580, "question_id": 44104928, "link": "https://stackoverflow.com/questions/44104928/rotate-log-file-in-golang-with-systemd", "title": "Rotate log file in golang with systemd", "body": "<p>Was using default log from go but found two issues, which are log rotation and log wasn't being printed when run the program using systemd. \nSo I tried using libraries as follows:</p>\n\n<pre><code>https://github.com/alecthomas/log4go\nhttps://github.com/natefinch/lumberjack\n</code></pre>\n\n<p><strong>log4go</strong></p>\n\n<p>Seems a perfect library for logging because provides max size and line for rotation. However when set rotate to true, it did create new log file but with error then the app terminated.</p>\n\n<blockquote>\n  <p>FileLogWriter(\"logs/app.log\"): Rotate: rename logs/stream.log\n  logs/app.log.2017-05-21.001: The process cannot access the file\n  because it is being used by another process.</p>\n</blockquote>\n\n<p>Configurations:</p>\n\n<pre><code>logger:=log4go.NewDefaultLogger(log4go.DEBUG)\nlogger.AddFilter(\"log\", log4go.FINE,  log4go.NewFileLogWriter(\"/log/app.log\", true))\nlogger.Info(\"success\")\n</code></pre>\n\n<p>Also modified existing library and set daily to true so when rotate it shows date on the file</p>\n\n<p><strong>lumberjack</strong></p>\n\n<p>Next I tried this library. Was happy to find because there's nothing much to do but add struct log configuration. Worked well as the log file didn't go any bigger that the param specify, but there's no sign of new file created. Configuration</p>\n\n<pre><code>var PrintLog *log.Logger\n\nfunc main() {\n    _ = os.Mkdir(property.AppProperties.Logging.Path, os.ModePerm)\n    f, e := os.OpenFile(logFile, os.O_WRONLY|os.O_APPEND|os.O_CREATE|os.O_RDWR, 0666)\n    if e != nil {\n        fmt.Printf(\"error opening file: %v\", e)\n    }\n    PrintLog = log.New(f, \"\", log.Ldate|log.Ltime)\n    l:= &amp;lumberjack.Logger{\n        Filename:   logFile,\n        MaxSize:    2, // megabytes\n        MaxBackups: 3,\n        MaxAge:     20, //days\n    }\n    log.SetOutput(l)\n\n}\n</code></pre>\n\n<p>Where am I missing?</p>\n"}, {"tags": ["go", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 4611, "user_id": 7511971, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Byz18.jpg?s=128&g=1", "display_name": "Ricardo Branco", "link": "https://stackoverflow.com/users/7511971/ricardo-branco"}, "is_accepted": true, "score": 2, "last_activity_date": 1495418702, "last_edit_date": 1495418702, "creation_date": 1495416365, "answer_id": 44103397, "question_id": 44102971, "link": "https://stackoverflow.com/questions/44102971/how-to-let-go-find-library-headers/44103397#44103397", "title": "How to let Go find library headers?", "body": "<p>If you're using Cgo, you must use something like this:</p>\n\n<pre><code>/*\n#cgo CFLAGS: -I/usr/local/ssl/include\n#cgo LDFLAGS: -lcrypto -L/usr/local/ssl/lib\n*/\nimport \"C\"\n</code></pre>\n\n<p>In this case I'm using it to compile against the latest OpenSSL.  Edit to suit your needs.</p>\n"}], "owner": {"reputation": 13, "user_id": 8045506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/673fea8f07e47f096152734aec166801?s=128&d=identicon&r=PG&f=1", "display_name": "LSD", "link": "https://stackoverflow.com/users/8045506/lsd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 0, "accepted_answer_id": 44103397, "answer_count": 1, "score": 0, "last_activity_date": 1495451090, "creation_date": 1495411658, "last_edit_date": 1495451090, "question_id": 44102971, "link": "https://stackoverflow.com/questions/44102971/how-to-let-go-find-library-headers", "title": "How to let Go find library headers?", "body": "<p>I've been searching for a while but cannot find a solution to this issue.</p>\n\n<p>Because libraries like SDL2 are not part of the OpenBSD operating system, they are stored in <code>/usr/local</code>. Go seems to be looking for headers in <code>/usr/include</code> and not <code>/usr/local/include</code>. I see flags in <code>go env</code>  but I'm unable to edit them.</p>\n\n<p>Is there a way to resolve this issue without symlinks? Perhaps a Go equivalent of the <code>-I</code> flag common in C compilers?</p>\n"}, {"tags": ["google-app-engine", "go", "cors", "polymer"], "answers": [{"tags": [], "owner": {"reputation": 147, "user_id": 5728873, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/R37ba.jpg?s=128&g=1", "display_name": "Dheeraj Sarwaiya", "link": "https://stackoverflow.com/users/5728873/dheeraj-sarwaiya"}, "is_accepted": true, "score": 2, "last_activity_date": 1495415019, "creation_date": 1495415019, "answer_id": 44103269, "question_id": 44102754, "link": "https://stackoverflow.com/questions/44102754/cors-authorization-polymer-and-goapp-golang/44103269#44103269", "title": "CORS Authorization polymer and goapp golang", "body": "<p>Resolved the issue  ..</p>\n\n<p>created new route for options</p>\n\n<pre><code>r.OPTIONS(\"/ephomenotes\", optionsheader)\nr.GET(\"/ephomenotes\", env.EPHomePage)\n</code></pre>\n\n<p>This is the new function. </p>\n\n<pre><code>func optionsheader(w http.ResponseWriter, r *http.Request, ps httprouter.Params) {\n\n    w.Header().Set(\"Access-Control-Allow-Credentials\", \"true\")\n    if origin := r.Header.Get(\"Origin\"); origin != \"\" {\n        w.Header().Set(\"Access-Control-Allow-Origin\", origin)\n    }\n    w.Header().Set(\"Access-Control-Allow-Headers\", \"Accept, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization\")\n    // w.Header().Set(\"Access-Control-Allow-Methods\", \"POST, GET, OPTIONS, PUT, DELETE\")\n\n}\n</code></pre>\n\n<p>However I am not sure, why this one worked?</p>\n"}], "owner": {"reputation": 147, "user_id": 5728873, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/R37ba.jpg?s=128&g=1", "display_name": "Dheeraj Sarwaiya", "link": "https://stackoverflow.com/users/5728873/dheeraj-sarwaiya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 530, "favorite_count": 0, "accepted_answer_id": 44103269, "answer_count": 1, "score": 2, "last_activity_date": 1495415019, "creation_date": 1495409282, "question_id": 44102754, "link": "https://stackoverflow.com/questions/44102754/cors-authorization-polymer-and-goapp-golang", "title": "CORS Authorization polymer and goapp golang", "body": "<p>I have polymer frontend which interact with goapp server. Everything works fine as long as I do not pass authorization token in header. Here is the code at Polymer side</p>\n\n<pre><code>&lt;iron-ajax\n      auto\n        url=\"http://localhost:8080/ephomenotes\"\n        handle-as=\"json\"\n        last-response=\"{{response}}\"\n        headers=\"[[_computeHeader()]]\"\n        debounce-duration=\"300\"&gt;&lt;/iron-ajax&gt;\n\n_computeHeader() {\n        var token = localStorage.getItem(\"savedToken\");\n         var obj = {};\n         obj.Authorization = \"Bearer \" + token;\n         return obj;\n        //return {\"Authorization\": \"Bearer \" + token};\n      }\n</code></pre>\n\n<p>At golang server side</p>\n\n<pre><code>w.Header().Set(\"Access-Control-Allow-Credentials\", \"true\")\nif origin := r.Header.Get(\"Origin\"); origin != \"\" {\n    w.Header().Set(\"Access-Control-Allow-Origin\", origin)\n}\nw.Header().Set(\"Access-Control-Allow-Headers\", \"Accept, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization\")\n\nif r.Method == \"OPTIONS\" {\n    return\n}\n</code></pre>\n\n<p>Please note is I remove headers=\"[[_computeHeader()]]\" from polymer code then it works..However with Authorization token it throws following error.</p>\n\n<blockquote>\n  <p>XMLHttpRequest cannot load <a href=\"http://localhost:8080/ephomenotes\" rel=\"nofollow noreferrer\">http://localhost:8080/ephomenotes</a>. Response\n  to preflight request doesn't pass access control check: No\n  'Access-Control-Allow-Origin' header is present on the requested\n  resource. Origin '<a href=\"http://localhost:8081\" rel=\"nofollow noreferrer\">http://localhost:8081</a>' is therefore not allowed\n  access.</p>\n</blockquote>\n\n<p>Please help</p>\n"}, {"tags": ["go", "cassandra", "connection-timeout", "gocql"], "comments": [{"owner": {"reputation": 54248, "user_id": 95190, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a58c0b44762885ca46ecee7f5b379f3d?s=128&d=identicon&r=PG", "display_name": "WiredPrairie", "link": "https://stackoverflow.com/users/95190/wiredprairie"}, "edited": false, "score": 0, "creation_date": 1495449927, "post_id": 44102700, "comment_id": 75240952, "body": "What does <code>getAllTableNames</code> return? Your code isn&#39;t identical in both cases."}, {"owner": {"reputation": 926, "user_id": 3083825, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a0acf64bb8976dcf3dc0a2a1e3994ca8?s=128&d=identicon&r=PG", "display_name": "SomeGuyFortune", "link": "https://stackoverflow.com/users/3083825/someguyfortune"}, "reply_to_user": {"reputation": 54248, "user_id": 95190, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a58c0b44762885ca46ecee7f5b379f3d?s=128&d=identicon&r=PG", "display_name": "WiredPrairie", "link": "https://stackoverflow.com/users/95190/wiredprairie"}, "edited": false, "score": 0, "creation_date": 1495465033, "post_id": 44102700, "comment_id": 75251487, "body": "getAlltables just returns a slice of all my table names. I tested it out and it works. In the second case, I just hard coded the table name"}, {"owner": {"reputation": 54248, "user_id": 95190, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a58c0b44762885ca46ecee7f5b379f3d?s=128&d=identicon&r=PG", "display_name": "WiredPrairie", "link": "https://stackoverflow.com/users/95190/wiredprairie"}, "edited": false, "score": 0, "creation_date": 1495477999, "post_id": 44102700, "comment_id": 75258832, "body": "How would someone reproduce this? Have <code>getAllTableNames</code> return just <code>cliques</code>. Does that work?"}, {"owner": {"reputation": 926, "user_id": 3083825, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a0acf64bb8976dcf3dc0a2a1e3994ca8?s=128&d=identicon&r=PG", "display_name": "SomeGuyFortune", "link": "https://stackoverflow.com/users/3083825/someguyfortune"}, "reply_to_user": {"reputation": 54248, "user_id": 95190, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a58c0b44762885ca46ecee7f5b379f3d?s=128&d=identicon&r=PG", "display_name": "WiredPrairie", "link": "https://stackoverflow.com/users/95190/wiredprairie"}, "edited": false, "score": 0, "creation_date": 1495478718, "post_id": 44102700, "comment_id": 75259258, "body": "I have removed the <code>getAllTableNames</code> method call. Could the problem be from the Cassandra cluster running on port 127.0.0.1? When i debug my test, it prints this on the console.. <code>API server listening at:127.0.0.1:28132</code>. does some internal code use the cassandra port already?"}], "owner": {"reputation": 926, "user_id": 3083825, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a0acf64bb8976dcf3dc0a2a1e3994ca8?s=128&d=identicon&r=PG", "display_name": "SomeGuyFortune", "link": "https://stackoverflow.com/users/3083825/someguyfortune"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 699, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1495478504, "creation_date": 1495408577, "last_edit_date": 1495478504, "question_id": 44102700, "link": "https://stackoverflow.com/questions/44102700/go-test-returns-error-gocql-no-response-received-from-cassandra-within-timeo", "title": "&#39;go test&#39; returns error &quot;gocql: no response received from cassandra within timeout period.&quot;", "body": "<p>So i want to test out an API that interacts with Cassandra on my local machine. In my <code>func TestMain(m *testing.M)</code> function, i want to clear the tables before running the tests. The <code>TestMain</code> function looks like this...</p>\n\n<pre><code>func TestMain(m *testing.M) {\n    keyspace = \"staging\"\n    cassandra.SetKeyspace(keyspace)\n\n    client = http.DefaultClient\n\n    // Ensure all tables are empty before tests run\n    err := ClearAllTables()\n    if err != nil {\n        logrus.Errorf(\"Failed to clear all tables: %v.\", err)\n        os.Exit(1)\n    }\n\n    // Run tests\n    statusCode := m.Run()\n\n    os.Exit(statusCode)\n}\n</code></pre>\n\n<p>The <code>ClearAllTables</code> function looks like this...</p>\n\n<pre><code>func ClearAllTables() (err error) {\n\n    // Create a DB session\n    session := cassandra.CreateSession()\n    defer session.Close()\n\n    // Get names of all existing tables\n    tableNameList := []string{\"cliques\", \"users\"}\n\n    // Remove all rows from each table\n    var count int\n    for _, tableName := range tableNameList {\n\n        if err := session.Query(`TRUNCATE TABLE ` + tableName).Exec(); err != nil {\n            return err\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<p>For some reason when i try to TRUNCATE the table, Cassandra times out, and i get the error...</p>\n\n<pre><code>level=error msg=\"Failed to clear all tables: gocql: no response received from cassandra within timeout period.\"\n</code></pre>\n\n<p>This only seems to happen when i test the program. I wrote a snippet of code in the main function that works fine.</p>\n\n<pre><code>func main () {\n    session := cassandra.CreateSession()\n    defer session.Close()\n\n    if err := session.Query(`TRUNCATE TABLE cliques`).Exec(); err != nil {\n        return\n    }\n    fmt.Println(\"Table truncated\") //works\n}\n</code></pre>\n\n<p>I also wrote a snippet of code that returns some rows from the database, and that also works fine in the main function. </p>\n\n<p>Here is how i create my cassandra session...</p>\n\n<pre><code>// CreateSession connect to a cassandra instance\nfunc CreateSession() *gocql.Session {\n    // Connect to the cluster\n    cluster := gocql.NewCluster(\"127.0.0.1\")\n    cluster.Keyspace = \"staging\"\n    cluster.ProtoVersion = 4\n    cluster.CQLVersion = \"3.0.0\"\n    cluster.Consistency = gocql.One\n\n    session, err := cluster.CreateSession()\n    if err != nil {\n        logrus.Errorf(\"Failed to connect to Cassandra: %v.\", err)\n    }\n    return session\n}\n</code></pre>\n\n<p>I'm i missing anything, Why would Cassandra work fine with <code>go run main.go</code> but doesn't work with <code>go test</code>?</p>\n"}, {"tags": ["go", "mux"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1495408394, "post_id": 44102625, "comment_id": 75225487, "body": "pass <b>router</b> variable as second parameter to <code>http.ListenAndServe</code> instead of <b>nil</b>"}, {"owner": {"reputation": 2555, "user_id": 1016765, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0c41d2ac3e142358f77f6905f23001ed?s=128&d=identicon&r=PG", "display_name": "user1016765", "link": "https://stackoverflow.com/users/1016765/user1016765"}, "reply_to_user": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1495410016, "post_id": 44102625, "comment_id": 75225754, "body": "Arg - knew it had to be something simple. Thanks"}], "answers": [{"tags": [], "owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "is_accepted": true, "score": 2, "last_activity_date": 1495410489, "creation_date": 1495410489, "answer_id": 44102854, "question_id": 44102625, "link": "https://stackoverflow.com/questions/44102625/go-mux-controller-returns-404/44102854#44102854", "title": "Go MUX controller returns 404", "body": "<p>Just pass <strong>router</strong> variable as second parameter to <a href=\"https://golang.org/pkg/net/http/#ListenAndServe\" rel=\"nofollow noreferrer\">http.ListenAndServe()</a> instead of <strong>nil</strong></p>\n"}], "owner": {"reputation": 2555, "user_id": 1016765, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0c41d2ac3e142358f77f6905f23001ed?s=128&d=identicon&r=PG", "display_name": "user1016765", "link": "https://stackoverflow.com/users/1016765/user1016765"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 0, "accepted_answer_id": 44102854, "answer_count": 1, "score": 1, "last_activity_date": 1495410489, "creation_date": 1495407733, "question_id": 44102625, "link": "https://stackoverflow.com/questions/44102625/go-mux-controller-returns-404", "title": "Go MUX controller returns 404", "body": "<p>I must be missing something really obvious, but I've created a MUX routed controller and the server returns 404.  Running the following:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"github.com/gorilla/mux\"\n)\n\nfunc main() {\n    router := mux.NewRouter()\n    router.HandleFunc(\"/hi\", SayHi)\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n\nfunc SayHi(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintln(w, \"Hi\")\n}\n</code></pre>\n\n<p>Visit : <a href=\"http://localhost:8080/hi\" rel=\"nofollow noreferrer\">http://localhost:8080/hi</a>  and I get a 404.</p>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["regex", "string", "go"], "answers": [{"tags": [], "owner": {"reputation": 4128, "user_id": 4607733, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cc604aa16e5409668cc4fd1f2f0c01e2?s=128&d=identicon&r=PG&f=1", "display_name": "horcrux", "link": "https://stackoverflow.com/users/4607733/horcrux"}, "is_accepted": true, "score": 4, "last_activity_date": 1495408294, "creation_date": 1495408294, "answer_id": 44102672, "question_id": 44102135, "link": "https://stackoverflow.com/questions/44102135/golang-regex-extract-text-between-2-delimiters-including-delimiters/44102672#44102672", "title": "Golang Regex extract text between 2 delimiters - including delimiters", "body": "<p>The regex is:</p>\n\n<pre><code>(?s)PATTERN BEGINS HERE.*?\\);\n</code></pre>\n\n<p>where <code>(?s)</code> is a flag to let <code>.*</code> match multiple lines (see <a href=\"https://golang.org/pkg/regexp/syntax/\" rel=\"nofollow noreferrer\">Go regex syntax</a>).</p>\n\n<p>See <a href=\"https://regex101.com/r/3nZ3qe/1\" rel=\"nofollow noreferrer\">demo</a></p>\n"}, {"tags": [], "owner": {"reputation": 874, "user_id": 3785017, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iMaLP.jpg?s=128&g=1", "display_name": "Andre Romano", "link": "https://stackoverflow.com/users/3785017/andre-romano"}, "is_accepted": false, "score": 2, "last_activity_date": 1498562340, "last_edit_date": 1498562340, "creation_date": 1498561554, "answer_id": 44778731, "question_id": 44102135, "link": "https://stackoverflow.com/questions/44102135/golang-regex-extract-text-between-2-delimiters-including-delimiters/44778731#44778731", "title": "Golang Regex extract text between 2 delimiters - including delimiters", "body": "<p>Not regex, but works</p>\n\n<pre><code>func findInString(str, start, end string) ([]byte, error) {\n    var match []byte\n    index := strings.Index(str, start)\n\n    if index == -1 {\n        return match, errors.New(\"Not found\")\n    }\n\n    index += len(start)\n\n    for {\n        char := str[index]\n\n        if strings.HasPrefix(str[index:index+len(match)], end) {\n            break\n        }\n\n        match = append(match, char)\n        index++\n    }\n\n    return match, nil\n}\n</code></pre>\n\n<p><strong>EDIT:</strong> Best to handle individual character as bytes and return a byte array</p>\n"}], "owner": {"reputation": 729, "user_id": 2737876, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/4ed49a00e66b2cbd39e55212cb2d70f2?s=128&d=identicon&r=PG&f=1", "display_name": "user2737876", "link": "https://stackoverflow.com/users/2737876/user2737876"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3363, "favorite_count": 1, "accepted_answer_id": 44102672, "answer_count": 2, "score": 2, "last_activity_date": 1498562340, "creation_date": 1495403349, "question_id": 44102135, "link": "https://stackoverflow.com/questions/44102135/golang-regex-extract-text-between-2-delimiters-including-delimiters", "title": "Golang Regex extract text between 2 delimiters - including delimiters", "body": "<p>As stated in the title I have an program in golang where I have a string with a reoccurring pattern. I have a beginning and end delimiters for this pattern, and I would like to extract them from the string. The following is pseudo code:</p>\n\n<pre><code>string := \"... This is preceding text\nPATTERN BEGINS HERE (\npattern can continue for any number of lines...\n);\nthis is trailing text that is not part of the pattern\"\n</code></pre>\n\n<p>In short what I am attempting to do is from the example above is extract all occurrences of of the pattern that begins with \"PATTERN BEGINS HERE\" and ends with \");\" And I need help in figuring out what the regex for this looks like. </p>\n\n<p>Please let me know if any additional info or context is needed. </p>\n"}, {"tags": ["go", "protocol-buffers", "grpc"], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 7371580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09ab3ab0c27346e99bc2005fbbc5a0bc?s=128&d=identicon&r=PG&f=1", "display_name": "BlakeMScurr", "link": "https://stackoverflow.com/users/7371580/blakemscurr"}, "edited": false, "score": 0, "creation_date": 1495431272, "post_id": 44103437, "comment_id": 75230377, "body": "Looks like you&#39;re right according to this <a href=\"https://developers.google.com/protocol-buffers/docs/proto3#default\" rel=\"nofollow noreferrer\">developers.google.com/protocol-buffers/docs/proto3#default</a>, thanks!"}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 0, "last_activity_date": 1495416822, "creation_date": 1495416822, "answer_id": 44103437, "question_id": 44102055, "link": "https://stackoverflow.com/questions/44102055/error-types-in-grpc-streaming/44103437#44103437", "title": "Error types in gRPC streaming", "body": "<p>It's likely that it isn't really more efficient to split it up as protobuf doesn't send empty (default) fields.</p>\n\n<p>so, in the case where you set error=\"foo\"\nbasically only foo is sent on the wire.</p>\n"}], "owner": {"reputation": 15, "user_id": 7371580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09ab3ab0c27346e99bc2005fbbc5a0bc?s=128&d=identicon&r=PG&f=1", "display_name": "BlakeMScurr", "link": "https://stackoverflow.com/users/7371580/blakemscurr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 766, "favorite_count": 0, "accepted_answer_id": 44103437, "answer_count": 1, "score": 0, "last_activity_date": 1495416822, "creation_date": 1495402690, "question_id": 44102055, "link": "https://stackoverflow.com/questions/44102055/error-types-in-grpc-streaming", "title": "Error types in gRPC streaming", "body": "<p>I have a gRPC endpoint that streams queries and results back and forth, and there will frequently be errors on the server side that I want to send back. My current approach to error handling is just including an an error message to the reply.</p>\n\n<pre><code>service MyService {\n        rpc Query (stream QueryRequest) returns (stream QueryReply) {}\n}\n\nmessage QueryReply {\n        string id = 1;\n        repeated string kind = 2;\n        message DataList {\n                repeated string data = 1;\n        }\n        map&lt;string, DataList&gt; data = 3;\n        string error = 4;\n}\n</code></pre>\n\n<p>I suspect it would be more efficient to create a separate messages, so that an erroring message doesn't have to contain all that other data. I am hesitant to make and sync multiple messages because I don't want to add too much complexity. What efficiency can be gained from splitting up the message? Is there a canonical way of doing this (in go in particular)?</p>\n"}, {"tags": ["mysql", "go"], "answers": [{"tags": [], "owner": {"reputation": 19042, "user_id": 920295, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b553a6dbceb13f2b0fb2a7d50614df29?s=128&d=identicon&r=PG", "display_name": "g3rv4", "link": "https://stackoverflow.com/users/920295/g3rv4"}, "is_accepted": true, "score": 0, "last_activity_date": 1495399406, "creation_date": 1495399406, "answer_id": 44101597, "question_id": 44101462, "link": "https://stackoverflow.com/questions/44101462/using-registerreaderhandler-to-insert-rows-in-mysql/44101597#44101597", "title": "Using RegisterReaderHandler to insert rows in mysql", "body": "<p>Obviously, 3 minutes after posting the question I figured out the answer.</p>\n\n<p>I was replacing the output buffer in <code>MyReader</code>. So changing the line</p>\n\n<pre><code>p = buf.Bytes()\n</code></pre>\n\n<p>With</p>\n\n<pre><code>out = buf.Bytes()\ncopy(p, out)\n</code></pre>\n\n<p>did the trick</p>\n"}], "owner": {"reputation": 19042, "user_id": 920295, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/b553a6dbceb13f2b0fb2a7d50614df29?s=128&d=identicon&r=PG", "display_name": "g3rv4", "link": "https://stackoverflow.com/users/920295/g3rv4"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 0, "accepted_answer_id": 44101597, "answer_count": 1, "score": 0, "last_activity_date": 1495399406, "creation_date": 1495398417, "question_id": 44101462, "link": "https://stackoverflow.com/questions/44101462/using-registerreaderhandler-to-insert-rows-in-mysql", "title": "Using RegisterReaderHandler to insert rows in mysql", "body": "<p>I'm using <code>go-sql-driver</code> to connect to <code>mysql</code> from <code>go</code>, and I'd love to use a reader to insert a big number of rows (34M+).</p>\n\n<p>I'm having a hard time using an <code>io.Reader</code> to load the data <a href=\"https://github.com/go-sql-driver/mysql/blob/master/infile.go#L70\" rel=\"nofollow noreferrer\">as shown on the RegisterReaderHandler documentation</a>.</p>\n\n<p>I have a table defined like this</p>\n\n<pre><code>CREATE TABLE `test` (\n  `Id` int(11) NOT NULL,\n  `One` varchar(45) DEFAULT NULL,\n  `Two` varchar(45) DEFAULT NULL,\n  `Three` varchar(45) DEFAULT NULL,\n  PRIMARY KEY (`Id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8\n</code></pre>\n\n<p>And I'm trying to insert a row by doing</p>\n\n<pre><code>func (r MyReader) Read(p []byte) (n int, err error){\n    buf := new(bytes.Buffer)\n    wr := csv.NewWriter(buf)\n\n    // just generate a csv line to see if this works\n    // I've verified that the size of the result is lower than p's capacity\n    wr.Write([]string{\"1\", \"Something\", \"NULL\", \"Something\"})\n    wr.Flush()\n\n    p = buf.Bytes()    \n    return len(p), io.EOF\n}\n\nfunc main() {\n    mysql.RegisterReaderHandler(\"data\", func() io.Reader {\n        // pass my reader\n        return MyReader{}\n    })\n\n    db, err := sql.Open(\"mysql\", \"user:pass@/db\")\n    checkErr(err)\n\n    _, err = db.Exec(\"LOAD DATA LOCAL INFILE 'Reader::data' INTO TABLE test FIELDS TERMINATED BY ','\")\n    checkErr(err)\n}\n</code></pre>\n\n<p>I see that my <code>Read</code> operation is called, and after running this a new element is created. However, it has <code>Id</code> 0 and all the other elements are <code>NULL</code>, so it's not processing the data correctly.</p>\n\n<p>FWIW, I run the <code>LOAD DATA LOCAL</code> command in <code>mysql</code> (with the same contents the reader generates) and the row is successfully inserted.</p>\n\n<p>What am I missing?</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3", "google-cloud-storage", "aws-sdk-go"], "comments": [{"owner": {"reputation": 15463, "user_id": 1549165, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GHeLx.png?s=128&g=1", "display_name": "Ashan", "link": "https://stackoverflow.com/users/1549165/ashan"}, "edited": false, "score": 1, "creation_date": 1495389203, "post_id": 44099341, "comment_id": 75220416, "body": "Did you look at CloudFront? Which allows to stream s3 content?"}, {"owner": {"reputation": 13, "user_id": 6917799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37a2638667dd0a3631140abcfc6cb32a?s=128&d=identicon&r=PG&f=1", "display_name": "S. Drazic", "link": "https://stackoverflow.com/users/6917799/s-drazic"}, "reply_to_user": {"reputation": 15463, "user_id": 1549165, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GHeLx.png?s=128&g=1", "display_name": "Ashan", "link": "https://stackoverflow.com/users/1549165/ashan"}, "edited": false, "score": 0, "creation_date": 1495394258, "post_id": 44099341, "comment_id": 75221949, "body": "It seems to me that CloudFront is mostly used for media files, I need a way to stream text to simple text files. Is CloudFront appropriate for that?"}, {"owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 1, "creation_date": 1495403700, "post_id": 44099341, "comment_id": 75224475, "body": "You are correct, @S.Drazic.  The other commenter assumes you&#39;re talking about downloads, rather than uploads."}, {"owner": {"reputation": 13, "user_id": 6917799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37a2638667dd0a3631140abcfc6cb32a?s=128&d=identicon&r=PG&f=1", "display_name": "S. Drazic", "link": "https://stackoverflow.com/users/6917799/s-drazic"}, "edited": false, "score": 0, "creation_date": 1495475312, "post_id": 44099341, "comment_id": 75257463, "body": "Thanks for clearing that up."}], "answers": [{"comments": [{"owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 1, "creation_date": 1495404187, "post_id": 44101387, "comment_id": 75224597, "body": "This is essentially <i>the</i> solution. I&#39;ve used it with success in the past, for streaming backups into S3 as in a pattern like <code>tar -c | bzip2 -9 | pipe2s3 [options]</code> where I didn&#39;t have the available temp space to save the backups locally.  I abandonded developing the <code>pipe2s3</code> project and never released it because there was no way to store metadata about the length of the object, final sha256, etc., because the multipart upload API requires all metadata be specified at start. (Now, of course, with object tagging, this could be done.) But this method does work and is essentially the only way."}, {"owner": {"reputation": 13, "user_id": 6917799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37a2638667dd0a3631140abcfc6cb32a?s=128&d=identicon&r=PG&f=1", "display_name": "S. Drazic", "link": "https://stackoverflow.com/users/6917799/s-drazic"}, "edited": false, "score": 1, "creation_date": 1495475157, "post_id": 44101387, "comment_id": 75257364, "body": "Thanks for such a detailed answer! This seems to be the solution to my problem, I&#39;ll try it out and report back here."}, {"owner": {"reputation": 5182, "user_id": 1366533, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cqijr.png?s=128&g=1", "display_name": "johlo", "link": "https://stackoverflow.com/users/1366533/johlo"}, "reply_to_user": {"reputation": 13, "user_id": 6917799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37a2638667dd0a3631140abcfc6cb32a?s=128&d=identicon&r=PG&f=1", "display_name": "S. Drazic", "link": "https://stackoverflow.com/users/6917799/s-drazic"}, "edited": false, "score": 0, "creation_date": 1495687012, "post_id": 44101387, "comment_id": 75360116, "body": "@S.Drazic I added a note on lifecycle management for the bucket"}], "tags": [], "owner": {"reputation": 5182, "user_id": 1366533, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cqijr.png?s=128&g=1", "display_name": "johlo", "link": "https://stackoverflow.com/users/1366533/johlo"}, "is_accepted": true, "score": 4, "last_activity_date": 1495686895, "last_edit_date": 1495686895, "creation_date": 1495397927, "answer_id": 44101387, "question_id": 44099341, "link": "https://stackoverflow.com/questions/44099341/is-there-a-way-to-stream-data-to-amazon-s3-files-using-aws-sdk-go-that-is-simila/44101387#44101387", "title": "Is there a way to stream data to amazon s3 files using aws-sdk-go that is similar to google storage Write() method?", "body": "<p>The S3 HTTP API doesn't have any <code>append</code>-like write method, instead it uses <a href=\"http://docs.aws.amazon.com/AmazonS3/latest/dev/mpuoverview.html\" rel=\"nofollow noreferrer\">multipart uploads</a>. You basically upload fixed size chunks with an index number and S3 will store them internally as separate files and automatically concatenate them when the last chunks is received. Default chunk size is 5MB (can be changed) and you can have atmost 10,000 chunks (can't be changed).</p>\n\n<p>Unfortunately it doesn't look like the <code>aws-sdk-go</code> API provides any convenient interface for working with chunks to achieve the streaming behaviour. </p>\n\n<p>You would have to work with the chunks manually (called <code>parts</code> in <code>aws-sdk-go</code>) directly using <a href=\"http://docs.aws.amazon.com/sdk-for-go/api/service/s3/#S3.CreateMultipartUpload\" rel=\"nofollow noreferrer\">CreateMultipartUpload</a> to initialize the transfers, create <a href=\"http://docs.aws.amazon.com/sdk-for-go/api/service/s3/#S3.UploadPartInput\" rel=\"nofollow noreferrer\">UploadPartInput</a> instances for the data you want to send and send it with <a href=\"http://docs.aws.amazon.com/sdk-for-go/api/service/s3/#S3.UploadPart\" rel=\"nofollow noreferrer\">UploadPart</a>. When the final chunk has been sent you need to close the transaction with <a href=\"http://docs.aws.amazon.com/sdk-for-go/api/service/s3/#S3.CompleteMultipartUpload\" rel=\"nofollow noreferrer\">CompleteMultipartUpload</a>.</p>\n\n<p>Regarding the question on how to stream directly from e.g. <code>[]byte</code> data instead of a file: the <code>Body</code> field of the <a href=\"http://docs.aws.amazon.com/sdk-for-go/api/service/s3/#S3.UploadPartInput\" rel=\"nofollow noreferrer\">UploadPartInput</a> struct is where you put your content you want to send to S3, note that <code>Body</code> is of type <code>io.readseeker</code>. This means you can create a <code>io.readseeker</code> from e.g. your <code>[]byte</code> content with something like <a href=\"https://golang.org/pkg/bytes/#NewReader\" rel=\"nofollow noreferrer\">bytes.NewReader([]byte)</a> and set <code>UploadPartInput.Body</code> to that.</p>\n\n<p>The <a href=\"https://github.com/aws/aws-sdk-go/blob/master/service/s3/s3manager/upload.go\" rel=\"nofollow noreferrer\">s3manager</a> upload utility of uploads could be a good starting point to see how the multipart functions are used, it uses the multipart API to upload a single large file as smaller chunks concurrently. </p>\n\n<p>Keep in mind that you should set a <a href=\"http://docs.aws.amazon.com/AmazonS3/latest/dev/mpuoverview.html#mpu-abort-incomplete-mpu-lifecycle-config\" rel=\"nofollow noreferrer\">lifecycle policy</a> that removes unfinished multipart uploads. If you don't send the final <code>CompleteMultipartUpload</code> all the chunks that have been uploaded will stay in S3 and incur costs. The policy can be set through AWS console/CLI or programmatically with <code>aws-sdk-go</code>.</p>\n"}], "owner": {"reputation": 13, "user_id": 6917799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37a2638667dd0a3631140abcfc6cb32a?s=128&d=identicon&r=PG&f=1", "display_name": "S. Drazic", "link": "https://stackoverflow.com/users/6917799/s-drazic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3610, "favorite_count": 1, "accepted_answer_id": 44101387, "answer_count": 1, "score": 1, "last_activity_date": 1541816435, "creation_date": 1495385063, "last_edit_date": 1495392968, "question_id": 44099341, "link": "https://stackoverflow.com/questions/44099341/is-there-a-way-to-stream-data-to-amazon-s3-files-using-aws-sdk-go-that-is-simila", "title": "Is there a way to stream data to amazon s3 files using aws-sdk-go that is similar to google storage Write() method?", "body": "<p>We're currently doing a transition from Google Storage to Amazon S3 storage. </p>\n\n<p>On  Google Storage I've used this function <a href=\"https://godoc.org/cloud.google.com/go/storage#Writer.Write\" rel=\"nofollow noreferrer\">https://godoc.org/cloud.google.com/go/storage#Writer.Write</a> to write to files. It basically streams bytes of data into file using io.Writer interface and saves file when Close() is called on writer. That allows us to stream data into a file all day long and finalize it on the end of the day without ever creating a local copy of the file.</p>\n\n<p>I've examined aws-sdk-go s3 documentation on godoc and can't seem to find a similar function that would allow us to just stream data to file without creating a file locally first. All I've found are functions that stream data from already existing local files like PutObject().</p>\n\n<p>So my question is: Is there a way to stream data to amazon s3 files using aws-sdk-go that is similar to google storage Write() method?</p>\n"}, {"tags": ["redirect", "go", "timeout", "httprequest"], "comments": [{"owner": {"reputation": 14998, "user_id": 212378, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/185aae2d842026d2eefa7528b00b394b?s=128&d=identicon&r=PG", "display_name": "Alexis Wilke", "link": "https://stackoverflow.com/users/212378/alexis-wilke"}, "edited": false, "score": 0, "creation_date": 1591207688, "post_id": 44098526, "comment_id": 109971428, "body": "In the docs they say you need to call the cancel function no matter what. They have an example showing a <code>defer cancel()</code> to make sure of that."}], "answers": [{"comments": [{"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 6434, "user_id": 4443226, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/C3vUB.png?s=128&g=1", "display_name": "Nevermore", "link": "https://stackoverflow.com/users/4443226/nevermore"}, "edited": false, "score": 1, "creation_date": 1495381601, "post_id": 44098609, "comment_id": 75217924, "body": "It seems it work work as well, see this related question for an example and further explanation: <a href=\"http://stackoverflow.com/questions/43321894/context-timeout-implementation-on-every-request-using-golang\" title=\"context timeout implementation on every request using golang\">stackoverflow.com/questions/43321894/&hellip;</a>"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 1, "last_activity_date": 1495380601, "creation_date": 1495380601, "answer_id": 44098609, "question_id": 44098526, "link": "https://stackoverflow.com/questions/44098526/context-timeout-for-redirects-rather-than-using-client-timeouts/44098609#44098609", "title": "Context Timeout for Redirects rather than using Client Timeouts?", "body": "<p>It does not look like each redirect will reset the <code>http.Client</code> time out.</p>\n\n<p>From the net/http documentation:</p>\n\n<pre><code>// Timeout specifies a time limit for requests made by this\n// Client. The timeout includes connection time, any\n// redirects, and reading the response body.\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/</a></p>\n"}], "owner": {"reputation": 6434, "user_id": 4443226, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/C3vUB.png?s=128&g=1", "display_name": "Nevermore", "link": "https://stackoverflow.com/users/4443226/nevermore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "accepted_answer_id": 44098609, "answer_count": 1, "score": 0, "last_activity_date": 1495380601, "creation_date": 1495380136, "question_id": 44098526, "link": "https://stackoverflow.com/questions/44098526/context-timeout-for-redirects-rather-than-using-client-timeouts", "title": "Context Timeout for Redirects rather than using Client Timeouts?", "body": "<p>I perform an HTTP request from a client with an explicit <code>http.Client.Timeout</code></p>\n\n<pre><code>client := http.Client{\n    Timeout: timeout, // 5 seconds\n}\n\nhttpResponse, err := client.Do(httpRequest)\n</code></pre>\n\n<p>But this client will perform a series of redirects (I'm not sure how many).</p>\n\n<p>From what I understand, each redirect will restart the timeout, so the timeout of 5 seconds will be <code>five-seconds * num-of-redirects</code>.</p>\n\n<p>Is it possible to <strong>rather pass in the timeout inside a <code>context.Context</code></strong>?</p>\n\n<pre><code>ctx, _ := context.WithTimeout(context.Background(), 5*time.Second)\n// do I need cancel?\nhttpRequest.WithContext(ctx)\nhttpResponse, err := client.Do(httpRequest)\n</code></pre>\n\n<p>Would this encompass the request <strong>and all redirects</strong> in the same timeout? Or do I misunderstand redirects/timeouts/contexts?</p>\n"}, {"tags": ["go", "goland"], "answers": [{"comments": [{"owner": {"reputation": 99, "user_id": 6457941, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/GNHE3.jpg?s=128&g=1", "display_name": "flynn", "link": "https://stackoverflow.com/users/6457941/flynn"}, "edited": false, "score": 0, "creation_date": 1495417084, "post_id": 44100174, "comment_id": 75227033, "body": "The error above is the IDE logs.The problem is I can not open the IDE.When I click Gogland icon,it will generate an error log like above."}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "reply_to_user": {"reputation": 99, "user_id": 6457941, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/GNHE3.jpg?s=128&g=1", "display_name": "flynn", "link": "https://stackoverflow.com/users/6457941/flynn"}, "edited": false, "score": 0, "creation_date": 1495435593, "post_id": 44100174, "comment_id": 75232345, "body": "Please understand that this cannot be solved otherwise. That is not the full error nor the dump it generates nor the place to ask for help in this case. Why do you not want to open an issue on the tracker? What is the problem with that?"}], "tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": false, "score": 0, "last_activity_date": 1495390168, "creation_date": 1495390168, "answer_id": 44100174, "question_id": 44097984, "link": "https://stackoverflow.com/questions/44097984/jetbrains-gogland-a-fatal-error-has-been-detected-by-the-java-runtime-environme/44100174#44100174", "title": "JetBrains Gogland :A fatal error has been detected by the Java Runtime Environment:A fatal error has been detected by the Java Runtime Environment:", "body": "<p>This cannot be solved by just that information.</p>\n\n<p>Please open an issue on the <a href=\"https://youtrack.jetbrains.com/issues/Go\" rel=\"nofollow noreferrer\">official tracker</a> and provide the <a href=\"https://intellij-support.jetbrains.com/hc/en-us/articles/207241085-Locating-IDE-log-files\" rel=\"nofollow noreferrer\">IDE logs</a>.</p>\n\n<p>Thank you.</p>\n"}], "owner": {"reputation": 99, "user_id": 6457941, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/GNHE3.jpg?s=128&g=1", "display_name": "flynn", "link": "https://stackoverflow.com/users/6457941/flynn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 268, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1495390168, "creation_date": 1495376531, "question_id": 44097984, "link": "https://stackoverflow.com/questions/44097984/jetbrains-gogland-a-fatal-error-has-been-detected-by-the-java-runtime-environme", "title": "JetBrains Gogland :A fatal error has been detected by the Java Runtime Environment:A fatal error has been detected by the Java Runtime Environment:", "body": "<p>I use the Gogland tool by JetBrains to study the go language.My installation was successful, but it could not be opened.Now I list the errors it reported as following.Has anyone ever encountered this problem? I would appreciate it if it could be solved.</p>\n\n<p><strong>Errors:</strong></p>\n\n<p><strong>A fatal error has been detected by the Java Runtime Environment:EXCEPTION_ACCESS_VIOLATION</strong> (0xc0000005) at pc=0x0000000000000000, pid=149904, tid=0x00000000000245cc</p>\n\n<p>JRE version:  (8.0_112-b21) (build )</p>\n\n<p>Java VM: OpenJDK 64-Bit Server VM (25.112-b21 mixed mode windows-amd64 compressed oops)\nProblematic frame:\nC  0x0000000000000000</p>\n\n<p><strong>Failed to write core dump. Minidumps are not enabled by default on client versions of Windows</strong>\n If you would like to submit a bug report, please visit:\n <a href=\"http://bugreport.java.com/bugreport/crash.jsp\" rel=\"nofollow noreferrer\">http://bugreport.java.com/bugreport/crash.jsp</a></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 4700, "user_id": 1470961, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/28216f158ce772dd67fcee384406b2c9?s=128&d=identicon&r=PG", "display_name": "Elliot Chance", "link": "https://stackoverflow.com/users/1470961/elliot-chance"}, "edited": false, "score": 0, "creation_date": 1495377829, "post_id": 44098161, "comment_id": 75216866, "body": "Perfect! Thanks"}, {"owner": {"reputation": 4946, "user_id": 2656614, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/rJz0Z.png?s=128&g=1", "display_name": "Addison", "link": "https://stackoverflow.com/users/2656614/addison"}, "edited": false, "score": 0, "creation_date": 1495415619, "post_id": 44098161, "comment_id": 75226795, "body": "As the name suggests, this is <b>most unsafe indeed</b>. I can&#39;t find nor think of an elegant way to do this - nor should anyone be doing this except in very niche situations (such as in the question). Even so, it seems to be the only solution."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 0, "last_activity_date": 1495377753, "creation_date": 1495377753, "answer_id": 44098161, "question_id": 44097977, "link": "https://stackoverflow.com/questions/44097977/is-it-possible-to-create-a-slice-from-an-existing-reference/44098161#44098161", "title": "Is it possible to create a slice from an existing reference?", "body": "<p>You can cast any types you want through an <code>unsafe.Pointer</code>.</p>\n\n<p>First convert the <code>*int</code> to a pointer to an array, then slice it:</p>\n\n<pre><code>(*[1]int)(unsafe.Pointer(&amp;a))[:]\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/bmKcMIj3pb\" rel=\"nofollow noreferrer\">https://play.golang.org/p/bmKcMIj3pb</a></p>\n"}], "owner": {"reputation": 4700, "user_id": 1470961, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/28216f158ce772dd67fcee384406b2c9?s=128&d=identicon&r=PG", "display_name": "Elliot Chance", "link": "https://stackoverflow.com/users/1470961/elliot-chance"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "accepted_answer_id": 44098161, "answer_count": 1, "score": 1, "last_activity_date": 1495377753, "creation_date": 1495376492, "question_id": 44097977, "link": "https://stackoverflow.com/questions/44097977/is-it-possible-to-create-a-slice-from-an-existing-reference", "title": "Is it possible to create a slice from an existing reference?", "body": "<p>Let's say I have the following function:</p>\n\n<pre><code>func foo(bar []int) {\n    bar[0] = 456\n}\n</code></pre>\n\n<p>I want to create an <code>[]int</code> with one element that references <code>a</code>, such that when I:</p>\n\n<pre><code>var a int = 10\n// mySlice := ... crazy hackery?\nfoo(mySlice)\n</code></pre>\n\n<p>The value of <code>a</code> will be 456.</p>\n\n<hr>\n\n<p>I know this is crazy and stupid and not at all the right thing to do. I'm not looking for the \"correct\" way. The function prototype for <code>foo</code> must remain the same.</p>\n\n<p>I can guarantee that while the underlying <code>int</code> will change, the slice that points to it is immutable.</p>\n\n<p>The reason for the strange requirement is because this is for the <a href=\"https://github.com/elliotchance/c2go\" rel=\"nofollow noreferrer\">c2go project</a>.</p>\n"}, {"tags": ["go", "struct", "interface"], "comments": [{"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1495352403, "post_id": 44094325, "comment_id": 75209918, "body": "This is not working. A <code>map[string]interface{}</code> implements the empty interface but you want to use a empty interface as a map. That way it is not working."}], "answers": [{"comments": [{"owner": {"reputation": 554, "user_id": 7778299, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/7IFHF.png?s=128&g=1", "display_name": "Elsa", "link": "https://stackoverflow.com/users/7778299/elsa"}, "edited": false, "score": 0, "creation_date": 1495353983, "post_id": 44094382, "comment_id": 75210249, "body": "Thank you for your advices. But I&#39;m sorry. I know when uses <code>data map[string]interface{}</code>, <code>s.data[&quot;foo2&quot;] = &quot;bar2&quot;</code> can be used. My question is looking for how to solve for below <code>&#47;&#47; Here, I want to add {&quot;foo2&quot;: &quot;bar2&quot;} to s.data</code>. So <code>data interface{}</code> is also a condition. I&#39;m sorry for my poor explanation."}], "tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 0, "last_activity_date": 1495352564, "creation_date": 1495352564, "answer_id": 44094382, "question_id": 44094325, "link": "https://stackoverflow.com/questions/44094325/add-data-to-interface-in-struct/44094382#44094382", "title": "Add data to interface{} in struct", "body": "<p>If you change the definition of your struct to:</p>\n\n<pre><code>type sample struct {\n    data map[string]interface{}\n}\n</code></pre>\n\n<p>it should work.</p>\n\n<p>So why? Because you are defining data as <code>interface{}</code>. But you this is not a map it is an empty interface. Why it is not a map? Because it could be also an int, string or another struct. So you can not use that type like other types.</p>\n\n<p>In your examples you are using <code>data</code> always as a map, so the solution would be to define data as the type <code>map[string]interface{}</code></p>\n"}, {"comments": [{"owner": {"reputation": 554, "user_id": 7778299, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/7IFHF.png?s=128&g=1", "display_name": "Elsa", "link": "https://stackoverflow.com/users/7778299/elsa"}, "edited": false, "score": 0, "creation_date": 1495409843, "post_id": 44094839, "comment_id": 75225729, "body": "Thank you for your advices. I could get a solution for me. And I&#39;m sorry for my poor skill."}], "tags": [], "owner": {"reputation": 493, "user_id": 5532956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/147ed2cc994f32b17fe76739de0d09c9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Brocklehurst", "link": "https://stackoverflow.com/users/5532956/adam-brocklehurst"}, "is_accepted": true, "score": 0, "last_activity_date": 1495355905, "creation_date": 1495355905, "answer_id": 44094839, "question_id": 44094325, "link": "https://stackoverflow.com/questions/44094325/add-data-to-interface-in-struct/44094839#44094839", "title": "Add data to interface{} in struct", "body": "<p>I don't know for what reason you want to have an empty interface type instead of the map[string]interface{} type, but it can be done.</p>\n\n<pre><code>type sample struct {\n    data interface{}\n}\n\nfunc (s *sample) func1() {\n    obj := map[string]interface{}{}\n    obj[\"foo1\"] = \"bar1\"\n    s.data = obj\n}\n\nfunc (s *sample) addField(key, value string) {\n    v, _ := s.data.(map[string]interface{})\n    v[key] = value\n    s.data = v\n}\n\nfunc main() {\n    s := &amp;sample{}\n    s.func1()\n    fmt.Println(s)\n\n    s.addField(\"foo2\", \"bar2\")\n    fmt.Println(s)\n\n}\n</code></pre>\n\n<p>You have to cast the interface into a map[string]interface{} each time you want to add a value. This can also be done to retrieve a value, I'm sure you can add another method using what I provided to do that.</p>\n\n<p>I would advise against doing this. Either you'll always have a map[string]interface{}, so you should make that the type of data, or you'll have to be careful as there is no guarantee that you have a map[string]interface{} so you'll have to handle this accordingly. </p>\n"}], "owner": {"reputation": 554, "user_id": 7778299, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/7IFHF.png?s=128&g=1", "display_name": "Elsa", "link": "https://stackoverflow.com/users/7778299/elsa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2471, "favorite_count": 0, "accepted_answer_id": 44094839, "answer_count": 2, "score": 2, "last_activity_date": 1495355905, "creation_date": 1495352119, "last_edit_date": 1495354190, "question_id": 44094325, "link": "https://stackoverflow.com/questions/44094325/add-data-to-interface-in-struct", "title": "Add data to interface{} in struct", "body": "<p>I want to add a data <code>{\"foo2\": \"bar2\"}</code> to <code>data</code> in struct <code>sample</code> at below <code>fmt.Println(s)</code> in <code>main()</code>.</p>\n\n<h2>Script</h2>\n\n<pre><code>type sample struct {\n    data interface{}\n}\n\nfunc (s *sample) func1() {\n    obj := map[string]interface{}{}\n    obj[\"foo1\"] = \"bar1\"\n    s.data = obj\n}\n\nfunc main() {\n    s := &amp;sample{}\n    s.func1()\n    fmt.Println(s)\n\n    // Above here is fixed as a condition of this question.\n    // Here, I want to add {\"foo2\": \"bar2\"} to s.data\n\n}\n</code></pre>\n\n<h2>My tests</h2>\n\n<p>I tried below.</p>\n\n<h3>Test 1:</h3>\n\n<pre><code>s.data[\"foo2\"] = \"bar2\"\n</code></pre>\n\n<p>Error occurs. It's <code>type interface {} does not support indexing</code>.</p>\n\n<h3>Test 2:</h3>\n\n<pre><code>obj := map[string]interface{}{}\nt, _ := json.Marshal(s.data)\njson.Unmarshal(t, &amp;obj)\nobj[\"foo2\"] = \"bar2\"\nfmt.Println(obj)\n</code></pre>\n\n<p>There are no errors. <code>{\"foo2\": \"bar2\"}</code> can be added.</p>\n\n<p>Is this 2nd test effective or general method? If there are how to directly add data or other methods, will you please teach me.\nThank you so much for your time. And I'm sorry for my immature question.</p>\n"}, {"tags": ["windows", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1495346126, "post_id": 44093551, "comment_id": 75208706, "body": "If reading from a file being appended to, you could start reading after the last processed line: <a href=\"http://stackoverflow.com/questions/34654514/how-to-read-a-file-starting-from-a-specific-line-number-using-scanner/34661512#34661512\">How to read a file starting from a specific line number using Scanner?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 6632110, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gg0Fn.jpg?s=128&g=1", "display_name": "TheLinuxGuy", "link": "https://stackoverflow.com/users/6632110/thelinuxguy"}, "edited": false, "score": 0, "creation_date": 1495381696, "post_id": 44093608, "comment_id": 75217959, "body": "Thanks, this is an old school serve log (classic) file that seems to append data to the end of file with a specific date next to it, so your suggestion would totally work and I could check the line number and matching timestamp for the last entry. (ex: 2017/05/20 16:38:19.133)"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 55, "user_id": 6632110, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gg0Fn.jpg?s=128&g=1", "display_name": "TheLinuxGuy", "link": "https://stackoverflow.com/users/6632110/thelinuxguy"}, "edited": false, "score": 1, "creation_date": 1495381832, "post_id": 44093608, "comment_id": 75218006, "body": "@TheLinuxGuy Great! Don&#39;t for get to read <a href=\"http://stackoverflow.com/help/accepted-answer\">stackoverflow.com/help/accepted-answer</a> (for this question or your other questions without accepted answers)"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1495345671, "creation_date": 1495345671, "answer_id": 44093608, "question_id": 44093551, "link": "https://stackoverflow.com/questions/44093551/parse-a-log-file-remembering-last-run/44093608#44093608", "title": "Parse a log file remembering last run", "body": "<p>It depends on the nature of the <a href=\"https://en.wikipedia.org/wiki/Logfile\" rel=\"nofollow noreferrer\">log file</a>: <a href=\"https://en.wikipedia.org/wiki/Server_log\" rel=\"nofollow noreferrer\">server log</a> (classic) or <a href=\"https://en.wikipedia.org/wiki/Transaction_log\" rel=\"nofollow noreferrer\">transation log</a>.<br>\nEven assuming the former, it depends on its <a href=\"https://en.wikipedia.org/wiki/Log_management\" rel=\"nofollow noreferrer\">Log Management</a> (long term retention, rotation, ...)</p>\n\n<p>Assuming a classic log files whose data are appended (not overwritten), a simple approach would be to generate in a file the line where the alert is found.<br>\nAt the next run, if that line matches one stored in that special \"flag\" file, the alert would not be sent again.</p>\n"}], "owner": {"reputation": 55, "user_id": 6632110, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Gg0Fn.jpg?s=128&g=1", "display_name": "TheLinuxGuy", "link": "https://stackoverflow.com/users/6632110/thelinuxguy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1495345710, "creation_date": 1495344954, "last_edit_date": 1495345710, "question_id": 44093551, "link": "https://stackoverflow.com/questions/44093551/parse-a-log-file-remembering-last-run", "title": "Parse a log file remembering last run", "body": "<p>I have a simple script that opens a file (log file), parses through it looking for specific log entries/keywords and for each entry that matches it triggers an alert.</p>\n\n<p>The problem that I am trying to solve is that I would like to modify the script to remember the alarms that were already sent when it was last run, so that if the script re-runs it won't keep sending an alert for previously sent alerts.</p>\n\n<p>The coding language is Golang, what are the a valid approach to do this? A database sounds like overkill, but I don't know what other alternatives are out there?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 260120, "user_id": 103167, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "Ben Voigt", "link": "https://stackoverflow.com/users/103167/ben-voigt"}, "edited": false, "score": 2, "creation_date": 1495337631, "post_id": 44092875, "comment_id": 75207269, "body": "What do you expect to happen when you set a field on a copy of the object?"}, {"owner": {"reputation": 5167, "user_id": 797225, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/7c3cf615bd7121d5f037b43da57bd664?s=128&d=identicon&r=PG", "display_name": "HanXu", "link": "https://stackoverflow.com/users/797225/hanxu"}, "reply_to_user": {"reputation": 260120, "user_id": 103167, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "Ben Voigt", "link": "https://stackoverflow.com/users/103167/ben-voigt"}, "edited": false, "score": 1, "creation_date": 1495337990, "post_id": 44092875, "comment_id": 75207335, "body": "@BenVoigt are you saying in the first approach calling SetValue on cat is calling on a copy of it?"}, {"owner": {"reputation": 260120, "user_id": 103167, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "Ben Voigt", "link": "https://stackoverflow.com/users/103167/ben-voigt"}, "edited": false, "score": 2, "creation_date": 1495338172, "post_id": 44092875, "comment_id": 75207358, "body": "<a href=\"https://golang.org/doc/faq#methods_on_values_or_pointers\" rel=\"nofollow noreferrer\">golang.org/doc/faq#methods_on_values_or_pointers</a>  &quot;called with a copy of the caller&#39;s argument (that&#39;s the definition of passing a value), so changes it makes will be invisible to the caller&quot;"}, {"owner": {"reputation": 5167, "user_id": 797225, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/7c3cf615bd7121d5f037b43da57bd664?s=128&d=identicon&r=PG", "display_name": "HanXu", "link": "https://stackoverflow.com/users/797225/hanxu"}, "reply_to_user": {"reputation": 260120, "user_id": 103167, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "Ben Voigt", "link": "https://stackoverflow.com/users/103167/ben-voigt"}, "edited": false, "score": 0, "creation_date": 1495338444, "post_id": 44092875, "comment_id": 75207389, "body": "@BenVoigt, i see, thanks!"}], "owner": {"reputation": 5167, "user_id": 797225, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/7c3cf615bd7121d5f037b43da57bd664?s=128&d=identicon&r=PG", "display_name": "HanXu", "link": "https://stackoverflow.com/users/797225/hanxu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 38, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1495337361, "creation_date": 1495337361, "question_id": 44092875, "link": "https://stackoverflow.com/questions/44092875/golang-defining-methods-on-object-receiver-behaves-wrong-but-pointer-receiver", "title": "GoLang defining methods on object receiver behaves wrong, but pointer receiver", "body": "<p>I have an interface named <code>Being</code>, which requires two methods <code>SetValue(v int)</code> and <code>GetValue() int</code>. Then I have a base class <code>Animal</code> implementing it, and further a subclass <code>Cat</code> inherited from <code>Animal</code>.</p>\n\n<p>Following is the code (<a href=\"https://play.golang.org/p/AT3Gp9UCTI\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Being interface {\n    SetValue(v int)\n    GetValue() int\n}\n\ntype Animal struct {\n    value int\n}\n\ntype Cat struct {\n    Animal\n}\n\nfunc (a Animal) SetValue(v int) {\n    a.value = v\n}\n\nfunc (a Animal) GetValue() int {\n    return a.value\n}\n\nfunc MakeCat() Being {\n    return Cat{}\n}\n\nfunc main() {\n    cat := MakeCat()\n    cat.SetValue(1)\n    fmt.Println(cat.GetValue()) \n}\n</code></pre>\n\n<p>However, the output is <code>0</code>, rather than <code>1</code>.</p>\n\n<p>If I slightly modify the code to this (<a href=\"https://play.golang.org/p/90_Q8Pmb8D\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Being interface {\n    SetValue(v int)\n    GetValue() int\n}\n\ntype Animal struct {\n    value int\n}\n\ntype Cat struct {\n    Animal\n}\n\n//Change the receiver to a pointer\nfunc (a *Animal) SetValue(v int) {\n    a.value = v\n}\n\nfunc (a Animal) GetValue() int {\n    return a.value\n}\n\n//Return the pointer\nfunc MakeCat() Being {\n    cat := Cat{}\n    return &amp;cat\n}\n\nfunc main() {\n    cat := MakeCat()\n    cat.SetValue(1)\n    fmt.Println(cat.GetValue()) \n}\n</code></pre>\n\n<p>where the modifications are marked by comments, the code behaves correctly, and output <code>1</code>.</p>\n\n<p>I cannot think of the reason of such phenomena, could anyone help?</p>\n"}, {"tags": ["go", "type-conversion"], "comments": [{"owner": {"reputation": 725, "user_id": 1340135, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/19c77ec6e88f9ee85488d72fbeef0b64?s=128&d=identicon&r=PG", "display_name": "Kaah", "link": "https://stackoverflow.com/users/1340135/kaah"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1495319746, "post_id": 44091338, "comment_id": 75204462, "body": "@CeriseLim&#243;n I updated the question with a working solution. It can probably use some improvement though. Any suggestions are welcome."}, {"owner": {"reputation": 577, "user_id": 2839410, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/wyRs5.jpg?s=128&g=1", "display_name": "Aaron", "link": "https://stackoverflow.com/users/2839410/aaron"}, "edited": false, "score": 0, "creation_date": 1495320503, "post_id": 44091338, "comment_id": 75204617, "body": "I&#39;m not familiar with Go, but depending on the order of operations it follows, remember that ((heightfeet*30.48) + (heightinch*2.54)) IS NOT the same as (heightfeet*30.48+heightinch*2.54).  In fact, I believe your code will output 392.XX cm, which is about 12 feet."}, {"owner": {"reputation": 725, "user_id": 1340135, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/19c77ec6e88f9ee85488d72fbeef0b64?s=128&d=identicon&r=PG", "display_name": "Kaah", "link": "https://stackoverflow.com/users/1340135/kaah"}, "reply_to_user": {"reputation": 577, "user_id": 2839410, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/wyRs5.jpg?s=128&g=1", "display_name": "Aaron", "link": "https://stackoverflow.com/users/2839410/aaron"}, "edited": false, "score": 0, "creation_date": 1495320819, "post_id": 44091338, "comment_id": 75204672, "body": "@Astor139 The output is actually 157,48 so I think its OK like that. multiplication is calculated before addition?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1495321866, "post_id": 44091338, "comment_id": 75204865, "body": "@Kaah: A test case: <code>&quot;2&#39;&#39;&quot;</code> or two inches."}, {"owner": {"reputation": 725, "user_id": 1340135, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/19c77ec6e88f9ee85488d72fbeef0b64?s=128&d=identicon&r=PG", "display_name": "Kaah", "link": "https://stackoverflow.com/users/1340135/kaah"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1495322210, "post_id": 44091338, "comment_id": 75204937, "body": "@peterSO Yeah, that would ruin it. It would ruin AndreaM16 too it looks like. Maybe its abit outside the scope of my particular issue since the input is human heights. I will make that clear in the question. But I agree that it would be good practice to take care of such a case as well."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1495324404, "post_id": 44091338, "comment_id": 75205349, "body": "@Kaah: An obvious test case for you: <code>69.3&#39;&#39;</code>. For statistical purposes, heights are measured in centimeters or inches. For example, the <a href=\"https://www.cdc.gov/nchs/fastats/body-measurements.htm\" rel=\"nofollow noreferrer\">US CDC says the average height</a> for men is 69.3&#39;&#39; and for women 63.8&#39;&#39;."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1495325014, "post_id": 44091338, "comment_id": 75205444, "body": "@Kaah: Floating point is an approximation. Minimize floating-point errors. For example, write <code>heightcm := (heightfeet*12 + heightinch) * 2.54</code>."}], "answers": [{"comments": [{"owner": {"reputation": 725, "user_id": 1340135, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/19c77ec6e88f9ee85488d72fbeef0b64?s=128&d=identicon&r=PG", "display_name": "Kaah", "link": "https://stackoverflow.com/users/1340135/kaah"}, "edited": false, "score": 0, "creation_date": 1495321612, "post_id": 44091587, "comment_id": 75204818, "body": "Thanks for showing another way to do this. I agree with you, if that input format would change some day it could ruin my script."}], "tags": [], "owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "is_accepted": true, "score": 2, "last_activity_date": 1495321342, "creation_date": 1495321342, "answer_id": 44091587, "question_id": 44091338, "link": "https://stackoverflow.com/questions/44091338/convert-feet-and-inches-to-centimeters-in-go/44091587#44091587", "title": "Convert feet and inches to centimeters in Go?", "body": "<p>I feel like your approach is fine, but, if you actually want to be sure to extract only the integers and using constants take a look at this <a href=\"https://play.golang.org/p/jdKHcZsLyh\" rel=\"nofollow noreferrer\">Go Playground</a> I set up.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n    \"strconv\"\n)\n\nfunc main() {\n\n    //Defining our constants     \n    const cm1 = 30.48       \n    const cm2 =  2.54 \n\n    //Slice to contain parsed ints\n    var parsedTokens []float64\n\n    feet := \"5'2''\"\n\n    //Regex to extract only integers\n    reg := regexp.MustCompile(\"[0-9]+\")\n    filtered:= reg.FindAllString(feet, -1)\n\n    //Parse each value v in filtered and append it into parsedTokens\n    for _, v := range filtered {\n        k, _ := strconv.ParseFloat(v, 64)\n        parsedTokens = append(parsedTokens, k)\n    }\n\n    //157.48000000000002\n    fmt.Println(parsedTokens[0]*cm1 + parsedTokens[1]*cm2)\n}\n</code></pre>\n"}], "owner": {"reputation": 725, "user_id": 1340135, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/19c77ec6e88f9ee85488d72fbeef0b64?s=128&d=identicon&r=PG", "display_name": "Kaah", "link": "https://stackoverflow.com/users/1340135/kaah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 867, "favorite_count": 0, "accepted_answer_id": 44091587, "answer_count": 1, "score": 0, "last_activity_date": 1495322223, "creation_date": 1495318765, "last_edit_date": 1495322223, "question_id": 44091338, "link": "https://stackoverflow.com/questions/44091338/convert-feet-and-inches-to-centimeters-in-go", "title": "Convert feet and inches to centimeters in Go?", "body": "<p>I am new to Go and I am a bit stuck on a problem regarding human height conversion from feet/inches to cm.</p>\n\n<p>How can I convert, in an efficient way, a string that looks like this <code>5'2''</code> to an centimeter int?</p>\n\n<p>Edit: \nAfter some more testing I ended up with this solution. How can it be improved?</p>\n\n<pre><code>height := strings.Split(\"5'2''\", \"'\")\nheightfeet,err :=strconv.ParseFloat(height[0],10)\nheightinch,err :=strconv.ParseFloat(height[1],10)\nheightcm :=heightfeet*30.48+heightinch*2.54\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1495329127, "post_id": 44089111, "comment_id": 75206049, "body": "May be its related to transport protocol being used by net/http package (HTTP/1.1 or HTTP/2) an nginx issue. <a href=\"https://github.com/square/okhttp/issues/2506\" rel=\"nofollow noreferrer\">This discussion</a> may related to your problem. Set <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\"><code>GODEBUG</code></a> to appropriate value for further mitigation."}], "answers": [{"tags": [], "owner": {"reputation": 2866, "user_id": 5535550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/571c344652249fb589492f90fa277fa9?s=128&d=identicon&r=PG", "display_name": "mkrufky", "link": "https://stackoverflow.com/users/5535550/mkrufky"}, "is_accepted": true, "score": 2, "last_activity_date": 1503351740, "last_edit_date": 1503351740, "creation_date": 1501607726, "answer_id": 45444023, "question_id": 44089111, "link": "https://stackoverflow.com/questions/44089111/random-refused-stream-making-a-post-multipart-form-request/45444023#45444023", "title": "Random REFUSED_STREAM making a POST multipart form request", "body": "<p>There is a bug in the golang standard library <code>net/http</code> that fails to handle the <code>REFUSED_STREAM</code> http/2 error properly.  This is what is likely going on:</p>\n\n<ol>\n<li><p>golang client opens a TCP connection to the HTTP/2 www server, sets the maximum number of HTTP streams in the connection to 1000 and starts uploading immediately.</p></li>\n<li><p>The HTTP/2 www server tells the golang client to only use a given number of streams, but the golang client has already started more than that amount of streams.</p></li>\n<li><p>The HTTP/2 www server reacts to this by resetting the excess streams.</p></li>\n<li><p>The lack of proper support for a retry in the golang <code>net/http</code> code causes the stream to fail after being reset by the server, and eventually the upload fails as well.</p></li>\n</ol>\n\n<p>There is a ticket open about this issue on github: <a href=\"https://github.com/golang/go/issues/20985/\" rel=\"nofollow noreferrer\" title=\"x/net/http2: retry requests rejected with REFUSED_STREAM\">x/net/http2: retry requests rejected with REFUSED_STREAM - golang/go/issues/20985</a></p>\n\n<p>**This issue has been closed in the master branch, the fix will be included in future Golang version 1.10</p>\n"}], "owner": {"reputation": 4557, "user_id": 2561007, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/d4ed28d0a70ddcb94b65d3be173aa329?s=128&d=identicon&r=PG", "display_name": "darklord", "link": "https://stackoverflow.com/users/2561007/darklord"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1314, "favorite_count": 0, "accepted_answer_id": 45444023, "answer_count": 1, "score": 1, "last_activity_date": 1503351740, "creation_date": 1495302641, "question_id": 44089111, "link": "https://stackoverflow.com/questions/44089111/random-refused-stream-making-a-post-multipart-form-request", "title": "Random REFUSED_STREAM making a POST multipart form request", "body": "<p>This is the code to upload an apk file (several MB) to appetize.io using golang:</p>\n\n<pre><code>func uploadToAppetize(file multipart.File, branchName string, displayName string) (result *AppetizeRes, ok bool) {\n    file.Seek(0, 0)\n    url, _ := getUrl()\n    var buffer bytes.Buffer\n    writer := multipart.NewWriter(&amp;buffer)\n    fileName := displayName + \"/\" + branchName\n    part, err := writer.CreateFormFile(\"file\", fileName)\n    if err != nil {\n        fmt.Fprintf(os.Stderr, \"Error creating form file %v: %v\\n\", fileName, err)\n        return nil, false\n    }\n\n    size, err := io.Copy(part, file)\n    if err != nil {\n        fmt.Fprintf(os.Stderr, \"Error copying apk file data: %v\\n\", err)\n        return nil, false\n    }\n    fmt.Fprintf(os.Stdout, \"Copied %v bytes for uploading to appetize...\\n\", size)\n    writer.Close()\n    response, err := http.Post(url, writer.FormDataContentType(), &amp;buffer) // Random error on this line\n    if err != nil || response == nil {\n        fmt.Fprintf(os.Stderr, \"Error occurred uploading apk data to appetize.io: %v %v\\n\", err, response)\n        return nil, false\n    }\n    defer response.Body.Close()\n    if response.StatusCode != http.StatusOK {\n        return nil, false\n    }\n\n    var appetizeRes AppetizeRes\n    if err := json.NewDecoder(response.Body).Decode(&amp;appetizeRes); err != nil {\n        return nil, false\n    }\n    return &amp;appetizeRes, true\n}\n</code></pre>\n\n<p>However I am receiving an random error on the line http.Post(...). It returns a nil response and an error. The error is \"stream error: stream ID 1; REFUSED_STREAM\". It happens randomly but will surely happen the first time the go program make the request after launching.</p>\n\n<p>This is the go version:</p>\n\n<pre><code>go version go1.8.1 darwin/amd64\n</code></pre>\n\n<p>This is the response header from the server if it doesn't fail:\n<a href=\"https://i.stack.imgur.com/i6mmG.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/i6mmG.png\" alt=\"enter image description here\"></a></p>\n\n<p>I also run this program on another mac running go 1.6.*, I didn't remember I ever run into this issue on that mac.</p>\n\n<p>Any idea what's going on?</p>\n"}, {"tags": ["go", "gomobile"], "comments": [{"owner": {"reputation": 459, "user_id": 832169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4796962174e609c97d50ad2f705b394?s=128&d=identicon&r=PG", "display_name": "Steve101", "link": "https://stackoverflow.com/users/832169/steve101"}, "edited": false, "score": 0, "creation_date": 1496589787, "post_id": 44088858, "comment_id": 75713239, "body": "I am writing this integration myself, will update ticket answer when it is in any reasonable shape."}, {"owner": {"reputation": 1765, "user_id": 332798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d47656e20ff5e42f125fc5ea0fd636c6?s=128&d=identicon&r=PG", "display_name": "tmm1", "link": "https://stackoverflow.com/users/332798/tmm1"}, "edited": false, "score": 1, "creation_date": 1514875718, "post_id": 44088858, "comment_id": 83085483, "body": "did you end up writing something for this?"}, {"owner": {"reputation": 459, "user_id": 832169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4796962174e609c97d50ad2f705b394?s=128&d=identicon&r=PG", "display_name": "Steve101", "link": "https://stackoverflow.com/users/832169/steve101"}, "reply_to_user": {"reputation": 1765, "user_id": 332798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d47656e20ff5e42f125fc5ea0fd636c6?s=128&d=identicon&r=PG", "display_name": "tmm1", "link": "https://stackoverflow.com/users/332798/tmm1"}, "edited": false, "score": 0, "creation_date": 1551689998, "post_id": 44088858, "comment_id": 96717570, "body": "Apologies. Yes I did start to"}], "owner": {"reputation": 459, "user_id": 832169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4796962174e609c97d50ad2f705b394?s=128&d=identicon&r=PG", "display_name": "Steve101", "link": "https://stackoverflow.com/users/832169/steve101"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 107, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1495301088, "creation_date": 1495301088, "question_id": 44088858, "link": "https://stackoverflow.com/questions/44088858/write-to-keychain-sharedpreferences-with-gomobile", "title": "Write to Keychain/SharedPreferences with GoMobile", "body": "<p>I am looking to write to keychain(iOS)/sharedprefs(Android) from GoMobile. Does anyone have any experience or packages to support this?</p>\n\n<p>My preference is to avoid writing the custom integration as I assume it would be fairly common functionality.</p>\n\n<p>Thanks,</p>\n"}, {"tags": ["pointers", "go", "variable-assignment", "biginteger"], "comments": [{"owner": {"reputation": 493, "user_id": 5532956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/147ed2cc994f32b17fe76739de0d09c9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Brocklehurst", "link": "https://stackoverflow.com/users/5532956/adam-brocklehurst"}, "edited": false, "score": 0, "creation_date": 1495296043, "post_id": 44087509, "comment_id": 75197839, "body": "For your last question, you&#39;ve ended up with a pointer to a pointer. new() returns a pointer to something and inside new you&#39;ve made it a pointer to a big.Int. So <code>diff := new(*big.Int)</code> makes diff a pointer to a pointer. This means it can&#39;t be used where you&#39;re trying to use it as it&#39;s expecting just a pointer to a big.Int."}], "answers": [{"comments": [{"owner": {"reputation": 83, "user_id": 7975221, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/1701896196493929/picture?type=large", "display_name": "Stephen Adams", "link": "https://stackoverflow.com/users/7975221/stephen-adams"}, "edited": false, "score": 0, "creation_date": 1495299784, "post_id": 44087995, "comment_id": 75199019, "body": "Thank you for the response; it is very helpful. I run into problems every time I use the math/big package. It will result in many minutes of stamping out type errors until I finally have code that results in the expected output but leaves me feeling, and my coding looking, like I went around the block three times to get to the corner. Is there an accepted and simple way to consistently use these methods that will result in a variable with a unique memory address?"}, {"owner": {"reputation": 83, "user_id": 7975221, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/1701896196493929/picture?type=large", "display_name": "Stephen Adams", "link": "https://stackoverflow.com/users/7975221/stephen-adams"}, "edited": false, "score": 0, "creation_date": 1495299811, "post_id": 44087995, "comment_id": 75199028, "body": "Moving the initialization of diff, diff := new(big.Int) , inside the loop works beautifully with diff.Sub(powers[i+1], v). I assume this is because this creates a variable diff at a unique memory address for every iteration?"}, {"owner": {"reputation": 1890, "user_id": 1694885, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G1T2T.png?s=128&g=1", "display_name": "syllabix", "link": "https://stackoverflow.com/users/1694885/syllabix"}, "reply_to_user": {"reputation": 83, "user_id": 7975221, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/1701896196493929/picture?type=large", "display_name": "Stephen Adams", "link": "https://stackoverflow.com/users/7975221/stephen-adams"}, "edited": false, "score": 0, "creation_date": 1495299991, "post_id": 44087995, "comment_id": 75199082, "body": "@StephenAdams - glad to be of help - moving <code>diff</code> inside the loop is a good solution to your problem"}], "tags": [], "owner": {"reputation": 1890, "user_id": 1694885, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G1T2T.png?s=128&g=1", "display_name": "syllabix", "link": "https://stackoverflow.com/users/1694885/syllabix"}, "is_accepted": true, "score": 2, "last_activity_date": 1495297684, "last_edit_date": 1495297684, "creation_date": 1495295988, "answer_id": 44087995, "question_id": 44087509, "link": "https://stackoverflow.com/questions/44087509/golang-help-understanding-pointers-assignment-and-unexpected-behavior/44087995#44087995", "title": "Golang: help understanding pointers, assignment, and unexpected behavior", "body": "<p>When debugging issues with pointers in Go, one way to understand what is going on is use <code>fmt.Printf</code> using <code>%p</code> to print the memory address of variables of interest. </p>\n\n<p>In regards to your first question as to why when appending the results of <code>diff.Sub(powers[i+1], v)</code> to your slice of <code>*big.Int</code> results in a slice where every index is the same value - you are updating the value at the memory address <code>diff</code> is assigned to and appending a copy of that pointer to the slice. Thus all values in the slice are pointers to the same value. </p>\n\n<p>Printing the memory address of <code>diff</code> will show this to be the case. After populating your slice - doing something like the following:</p>\n\n<pre><code>for _, val := range seqDiffs {\n    fmt.Printf(\"%p\\n\", val) // when i ran this - it printed 0xc4200b7d40 every iteration\n}\n</code></pre>\n\n<p>In your second example, the the value <code>v</code> is pointer to a <code>big.Int</code> at a different address. You are assigning the the result of <code>v.Sub(..)</code> to <code>diff</code>, which updates the underlying address diff is pointing to. So when you append <code>diff</code> to your slice, you are appending a copy of of a pointer at a unique address. Using <code>fmt.Printf</code> you can see this like so - </p>\n\n<pre><code>var seqDiffs []*big.Int\ndiff := new(big.Int)\nfor i, v := range powers {\n    if i == len(powers)-2 {\n        break\n    }\n    diff = v.Sub(powers[i+1], v)\n    fmt.Printf(\"%p\\n\", diff) // 1st iteration 0xc4200109e0, 2nd 0xc420010a00, 3rd 0xc420010a20, etc\n    seqDiffs = append(seqDiffs, diff)\n} \n</code></pre>\n\n<p>Regarding your second question - using the <code>new</code> keyword in Go allocates memory of the specified type but does not initialize it (<a href=\"https://golang.org/doc/effective_go.html#allocation_new\" rel=\"nofollow noreferrer\">check the docs</a>). A call to <code>new</code> in your case allocates a type of pointer to a pointer to a <code>big.Int</code> (<code>**big.Int</code>), thus the compiler error saying you cannot use this type in your call to <code>append</code>.</p>\n\n<p>To explicitly dereference <code>diff</code> in order to call the <code>Sub</code> on it, you would have to modify your code to the following:</p>\n\n<pre><code>(*diff).Sub(powers[i+1], v)\n</code></pre>\n\n<p>In Go, a selector expression dereferences pointers to structs for you, but in this case you are calling a method on a pointer to a pointer, thus you have to <em>explicitly</em> dereference it.  </p>\n\n<p>A very informative read on calling methods on structs (selector expressions) in Go can be found <a href=\"https://golang.org/ref/spec#Selectors\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>And to add it to the slice </p>\n\n<pre><code>seqDiffs = append(seqDiffs, *diff)\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 7975221, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/1701896196493929/picture?type=large", "display_name": "Stephen Adams", "link": "https://stackoverflow.com/users/7975221/stephen-adams"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 403, "favorite_count": 0, "accepted_answer_id": 44087995, "answer_count": 1, "score": 0, "last_activity_date": 1495297684, "creation_date": 1495293195, "last_edit_date": 1495293777, "question_id": 44087509, "link": "https://stackoverflow.com/questions/44087509/golang-help-understanding-pointers-assignment-and-unexpected-behavior", "title": "Golang: help understanding pointers, assignment, and unexpected behavior", "body": "<p>So I am back with more beginner questions that I can not seem to wrap my head around. \nI was experimenting with the following code.</p>\n\n<pre><code>func main() {\nstart := time.Now()\nvar powers []*big.Int\nfor i := 1; i &lt; 1000; i++ {\n    I := big.NewInt(int64(i))\n    I.Mul(I, I)\n    powers = append(powers, I)\n}\nfmt.Println(powers)\nfmt.Println(time.Since(start))\nstart = time.Now()\nvar seqDiffs []*big.Int\ndiff := new(big.Int)\nfor i, v := range powers {\n    if i == len(powers)-2 {\n        break\n    }\n    diff = v.Sub(powers[i+1], v)\n    seqDiffs = append(seqDiffs, diff)\n}\nfmt.Println(seqDiffs)\nfmt.Println(time.Since(start))\n}\n</code></pre>\n\n<p>my intention was to assign the result of Sub() to diff in the following way</p>\n\n<pre><code>diff.Sub(powers[i+1], v)\n</code></pre>\n\n<p>however this results in seqDiffs's value being 1995 (the correct last value) repeated over and over. I know that this is likely because seqDiffs is just a list of pointers to the same memory address but what I dont understand is why the following works just fine</p>\n\n<pre><code>v.Sub(powers[i+1], v)\nseqDiffs = append(seqDiffs, v)\n</code></pre>\n\n<p>this results in seqDiffs being a list of all the odd numbers from 3 to 1995 which is correct but isn't this essentially still a list of pointers to the same memory address as well? \nAlso why is the following correct when it should also result in seqDiffs being a list of pointers to the same memory address as well?</p>\n\n<pre><code>diff = v.Sub(powers[i+1], v)\nseqDiffs = append(seqDiffs, diff)\n</code></pre>\n\n<p>also I tried to do it the following way</p>\n\n<pre><code>diff := new(*big.Int)\nfor i, v := range powers {\nif i == len(powers)-2 {\n    break\n}\ndiff.Sub(powers[i+1], v)\nseqDiffs = append(seqDiffs, diff)\n}\n</code></pre>\n\n<p>but received these errors from the ide:</p>\n\n<pre><code>*./sequentialPowers.go:26: calling method Sub with receiver diff (type **big.Int) requires explicit dereference\n./sequentialPowers.go:27: cannot use diff (type **big.Int) as type *big.Int in append*\n</code></pre>\n\n<p>How would I make an \"explicit\" dereference?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 281, "user_id": 1214905, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f724bfca6eaee6dad2256bce642ae0c3?s=128&d=identicon&r=PG&f=1", "display_name": "danielp", "link": "https://stackoverflow.com/users/1214905/danielp"}, "edited": false, "score": 0, "creation_date": 1559488485, "post_id": 44087062, "comment_id": 99428415, "body": "When you do []rune(str) does it allocate a new rune for each occurrence?"}], "tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": true, "score": 5, "last_activity_date": 1495290492, "creation_date": 1495290492, "answer_id": 44087062, "question_id": 44086087, "link": "https://stackoverflow.com/questions/44086087/how-to-convert-a-string-slice-to-rune-slice/44087062#44087062", "title": "how to convert a string slice to rune slice", "body": "<p>I would prefer not to use <code>strings.Join(array,\"\")</code> for this purpose because it builds one big new string I don't need.  Making a big string I don't need is not space-efficient, and depending on input and hardware it may not be time-efficient.</p>\n\n<p>So instead I would iterate through the array of string values and convert each string to a rune slice, and use the built-in variadic append function to grow my slice of all rune values:</p>\n\n<pre><code>var allRunes []rune\nfor _, str := range array {\n    allRunes = append(allRunes, []rune(str)...)\n}\n</code></pre>\n"}], "owner": {"reputation": 139, "user_id": 7903682, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2bb447d483be033ad6bf17197bd6c7ae?s=128&d=identicon&r=PG&f=1", "display_name": "user7903682", "link": "https://stackoverflow.com/users/7903682/user7903682"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1079, "favorite_count": 0, "accepted_answer_id": 44087062, "answer_count": 1, "score": 4, "last_activity_date": 1495290492, "creation_date": 1495284687, "question_id": 44086087, "link": "https://stackoverflow.com/questions/44086087/how-to-convert-a-string-slice-to-rune-slice", "title": "how to convert a string slice to rune slice", "body": "<p>how can I convert type <code>[]string</code> to <code>[]rune</code>?</p>\n\n<p>I know you can do it like this:<br>\n<code>[]rune(strings.Join(array,\"\"))</code><br>\n but is there a better way?</p>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"reputation": 1731, "user_id": 852052, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/eb9db177fd5cf088f1c7c4b2cea6871e?s=128&d=identicon&r=PG", "display_name": "PMat", "link": "https://stackoverflow.com/users/852052/pmat"}, "edited": false, "score": 0, "creation_date": 1536868412, "post_id": 44085092, "comment_id": 91589264, "body": "did you find a solution"}, {"owner": {"reputation": 20389, "user_id": 1620210, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/8f130b2fa9903fca10a10b31ed3f7b94?s=128&d=identicon&r=PG", "display_name": "Kokizzu", "link": "https://stackoverflow.com/users/1620210/kokizzu"}, "reply_to_user": {"reputation": 1731, "user_id": 852052, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/eb9db177fd5cf088f1c7c4b2cea6871e?s=128&d=identicon&r=PG", "display_name": "PMat", "link": "https://stackoverflow.com/users/852052/pmat"}, "edited": false, "score": 0, "creation_date": 1536899577, "post_id": 44085092, "comment_id": 91596935, "body": "yes, just now, here&#39;s the hint: <a href=\"https://gist.github.com/tkrajina/880eb4b9a10aee28707e2aa764257503\" rel=\"nofollow noreferrer\">gist.github.com/tkrajina/880eb4b9a10aee28707e2aa764257503</a>"}, {"owner": {"reputation": 1731, "user_id": 852052, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/eb9db177fd5cf088f1c7c4b2cea6871e?s=128&d=identicon&r=PG", "display_name": "PMat", "link": "https://stackoverflow.com/users/852052/pmat"}, "edited": false, "score": 0, "creation_date": 1537223925, "post_id": 44085092, "comment_id": 91697806, "body": "how would you get the args that are passed to a method, in your example objects map"}, {"owner": {"reputation": 20389, "user_id": 1620210, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/8f130b2fa9903fca10a10b31ed3f7b94?s=128&d=identicon&r=PG", "display_name": "Kokizzu", "link": "https://stackoverflow.com/users/1620210/kokizzu"}, "reply_to_user": {"reputation": 1731, "user_id": 852052, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/eb9db177fd5cf088f1c7c4b2cea6871e?s=128&d=identicon&r=PG", "display_name": "PMat", "link": "https://stackoverflow.com/users/852052/pmat"}, "edited": false, "score": 0, "creation_date": 1537243453, "post_id": 44085092, "comment_id": 91701868, "body": "oh, for non object method (a normal function), it&#39;s still impossible i think.. <a href=\"https://github.com/golang/go/issues/12384\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/12384</a>"}], "answers": [{"comments": [{"owner": {"reputation": 20389, "user_id": 1620210, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/8f130b2fa9903fca10a10b31ed3f7b94?s=128&d=identicon&r=PG", "display_name": "Kokizzu", "link": "https://stackoverflow.com/users/1620210/kokizzu"}, "edited": false, "score": 0, "creation_date": 1536899342, "post_id": 44087213, "comment_id": 91596891, "body": "hi, i give bad example, what i meant was, getting the caller&#39;s argument (Test) from Trace function."}], "tags": [], "owner": {"reputation": 19, "user_id": 6812954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ec25e365963a310ddc02aa72f9bf4bf?s=128&d=identicon&r=PG", "display_name": "Kotaro Yoshimatsu", "link": "https://stackoverflow.com/users/6812954/kotaro-yoshimatsu"}, "is_accepted": false, "score": 0, "last_activity_date": 1495291463, "creation_date": 1495291463, "answer_id": 44087213, "question_id": 44085092, "link": "https://stackoverflow.com/questions/44085092/can-we-get-callers-function-argument-parameter-values-using-go/44087213#44087213", "title": "Can we get caller&#39;s function argument/parameter values using Go", "body": "<p>It may be better to use variable arguments. How about that?</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"runtime\"\n)\n\nfunc main() {\n  str := trace(`demo`, 123, \"me\")\n  fmt.Println(str)\n}\n\nfunc trace(str string, args ...interface{}) string {\n  pc := make([]uintptr, 10) // at least 1 entry needed\n  runtime.Callers(2, pc)\n  f := runtime.FuncForPC(pc[0])\n  file, line := f.FileLine(pc[0])\n  // str = Replace(str, \"\\n\", ` `)\n  return `-- ` + fmt.Sprintf(\"%s:%d %s:%s (%v)\", file, line, f.Name(), str, args)\n}\n</code></pre>\n"}], "owner": {"reputation": 20389, "user_id": 1620210, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/8f130b2fa9903fca10a10b31ed3f7b94?s=128&d=identicon&r=PG", "display_name": "Kokizzu", "link": "https://stackoverflow.com/users/1620210/kokizzu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 937, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1536899273, "creation_date": 1495278070, "last_edit_date": 1536899273, "question_id": 44085092, "link": "https://stackoverflow.com/questions/44085092/can-we-get-callers-function-argument-parameter-values-using-go", "title": "Can we get caller&#39;s function argument/parameter values using Go", "body": "<p>I already know how to get function name and function location:</p>\n\n<pre><code>func Trace(str string) string {\n    pc := make([]uintptr, 10)  // at least 1 entry needed\n    runtime.Callers(2, pc)\n    f := runtime.FuncForPC(pc[0])\n    file, line := f.FileLine(pc[0])\n    str = Replace(str, \"\\n\", ` `)\n    return `-- ` + fmt.Sprintf(\"%s:%d %s:%s\", file, line, f.Name() + str)\n}\n</code></pre>\n\n<p>But how to get function argument values? For example, if I call that <code>Trace</code> function within:</p>\n\n<pre><code>func Test1(a string, b int) {\n  Trace(`demo`) \n}\nfunc main() {\n  Test1(`aaaa`,123)\n}\n</code></pre>\n\n<p>I want to get the value <code>aaaa</code> and <code>123</code> inside <code>Trace</code> function, without have to pass them manually from <code>Test1</code> to <code>Trace</code> function</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1951, "user_id": 1442219, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6398031dc321aa3c975436e11d752f6b?s=128&d=identicon&r=PG", "display_name": "Lanti", "link": "https://stackoverflow.com/users/1442219/lanti"}, "is_accepted": false, "score": 0, "last_activity_date": 1495281817, "creation_date": 1495281817, "answer_id": 44085635, "question_id": 44084718, "link": "https://stackoverflow.com/questions/44084718/deep-matching-template-files-in-subfolders/44085635#44085635", "title": "Deep matching template files in subfolders", "body": "<p>I found a solution <a href=\"https://github.com/siongui/userpages/blob/master/content/articles/2017/02/13/go-template-parse-all-files-in-directory%25en.rst\" rel=\"nofollow noreferrer\">here</a>. If anyone have a better idea than this, I highly welcome!</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package controllers\n\n// github.com/djviolin/lanti-mvc-gtpl/src/controllers/index.go\n\nimport (\n    \"fmt\"\n    \"html/template\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"path/filepath\"\n)\n\n// GetAllFilePathsInDirectory : Recursively get all file paths in directory, including sub-directories.\nfunc GetAllFilePathsInDirectory(dirpath string) ([]string, error) {\n    var paths []string\n    err := filepath.Walk(dirpath, func(path string, info os.FileInfo, err error) error {\n        if err != nil {\n            return err\n        }\n        if !info.IsDir() {\n            paths = append(paths, path)\n        }\n        return nil\n    })\n    if err != nil {\n        return nil, err\n    }\n    return paths, nil\n}\n\n// ParseDirectory : Recursively parse all files in directory, including sub-directories.\nfunc ParseDirectory(dirpath string, filename string) (*template.Template, error) {\n    paths, err := GetAllFilePathsInDirectory(dirpath)\n    if err != nil {\n        return nil, err\n    }\n    fmt.Println(paths) // logging\n    t := template.New(filename)\n    return t.ParseFiles(paths...)\n}\n\n// Index : is the index handler\nfunc Index(w http.ResponseWriter, r *http.Request) {\n    render, err := ParseDirectory(\"./views\", \"index\")\n    if err != nil {\n        log.Fatal(\"Parse: \", err)\n        return\n    }\n    render.Execute(w, map[string]string{\"Title\": \"My title\", \"Body\": \"This is the body\"})\n}\n</code></pre>\n"}], "owner": {"reputation": 1951, "user_id": 1442219, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6398031dc321aa3c975436e11d752f6b?s=128&d=identicon&r=PG", "display_name": "Lanti", "link": "https://stackoverflow.com/users/1442219/lanti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 224, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1495281817, "creation_date": 1495275766, "last_edit_date": 1495278911, "question_id": 44084718, "link": "https://stackoverflow.com/questions/44084718/deep-matching-template-files-in-subfolders", "title": "Deep matching template files in subfolders", "body": "<p>I have this structure:</p>\n\n<p><code>./src/main.go</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n  \"log\"\n  \"net/http\"\n\n  \"github.com/djviolin/lanti-mvc-gtpl/src/controllers\"\n)\n\nfunc main() {\n  http.HandleFunc(\"/\", controllers.Index)\n\n  err := http.ListenAndServe(\":8080\", nil)\n  if err != nil {\n    log.Fatal(\"ListenAndServe: \", err)\n  }\n}\n</code></pre>\n\n<p><code>./src/controllers/index.go</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package controllers\n\nimport (\n  \"html/template\"\n  \"log\"\n  \"net/http\"\n)\n\n// Index : frontpage handler\nfunc Index(w http.ResponseWriter, r *http.Request) {\n  t := template.New(\"index\")\n  render, err := t.ParseGlob(\"./views/*.html\")\n  if err != nil {\n    log.Fatal(\"Parse: \", err)\n    return\n  }\n  render.Execute(w, map[string]string{\"Title\": \"My title\", \"Body\": \"This is the body\"})\n}\n</code></pre>\n\n<p>And I have the following template file's structure:</p>\n\n<pre><code>\u2502   index.html\n\u2514\u2500\u2500\u2500partials\n        footer.html\n        header.html\n</code></pre>\n\n<p>How can I deep match the partials in the subfolder? <code>ParseGlob</code> not supporting the <code>**</code> operator as far as I know. Is there a way to achieve this with the standard library templates?</p>\n\n<p><strong>Update:</strong></p>\n\n<p>I tried to use <code>github.com/mattn/go-zglob</code> (recommended under <a href=\"https://github.com/golang/go/issues/11862#issuecomment-181904656\" rel=\"nofollow noreferrer\">this</a> github issue) for recursively list all template files in the <code>views</code> folder:</p>\n\n<pre><code>matches, err := zglob.Glob(`./views/**/*.html`)\nif err != nil {\n    log.Fatal(\"Parse: \", err)\n    return\n}\nfmt.Println(matches)\n// RETURNS: [views/index.html views/partials/footer.html views/partials/header.html]\n</code></pre>\n\n<p>Which is returning a string array, however <code>ParseFiles</code> function needs <code>string</code> input separated with <code>,</code> commas, and because of that, the following code throwing this error:</p>\n\n<pre><code>message: 'cannot use matches (type []string) as type string in argument to t.ParseFiles'\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 7441, "user_id": 100466, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/20b986aecf495c7a1d9b1910bd5f2cd2?s=128&d=identicon&r=PG", "display_name": "Waseem", "link": "https://stackoverflow.com/users/100466/waseem"}, "edited": false, "score": 0, "creation_date": 1495271905, "post_id": 44082643, "comment_id": 75190924, "body": "I think I have a beef with &quot;has no field&quot; field part in the error message. Even though compiler knows that printer.ResourcePrinter is an interface, it says that IsGeneric could also be a field. AFAIK there is no way in Go one can define fields, like structs, for interfaces."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 8, "last_activity_date": 1495275580, "last_edit_date": 1495541443, "creation_date": 1495261461, "answer_id": 44082643, "question_id": 44082536, "link": "https://stackoverflow.com/questions/44082536/interface-has-no-field-or-method-for-an-exported-field-in-a-struct/44082643#44082643", "title": "Interface has no field or method for an exported field in a struct", "body": "<p><code>printer.ResourcePrinter</code> is an interface, not the actual instance JSONPrinter, which does have access to IsGeneric</p>\n\n<p>You would need to add a method <code>IsGeneric()</code> to your interface (and implement it in <code>JSONPrinter</code>) in order to be able to use that interface as you want. </p>\n\n<p>See \"<a href=\"https://stackoverflow.com/a/21796240/6309\">golang how to access interface fields</a>\": you could also extract the dynamic value held by the interface variable through a type assertion:</p>\n\n<pre><code>dynamic_value := printer.(JSONPrinter)\n</code></pre>\n\n<p>Then <code>dynamic_value</code> would have access to the <code>IsGeneric</code> attribute. </p>\n\n<p>See more at \"<a href=\"https://stackoverflow.com/a/30356759/6309\">How to access attribute of interface</a>\".</p>\n\n<hr>\n\n<blockquote>\n  <p>Even though compiler knows that <code>printer.ResourcePrinter</code> is an interface, it says that <code>IsGeneric</code> could also be a field. </p>\n</blockquote>\n\n<p>The dynamic value of the interface can have field (see \"<a href=\"https://stackoverflow.com/a/39866671/6309\">Get all fields from an interface</a>\")</p>\n\n<p>The no field part, when applied to <a href=\"https://golang.org/ref/spec#Interface_types\" rel=\"noreferrer\">an interface</a>, can refer to an embedded type, the unqualified type\u2019s name acts as the field name.</p>\n\n<pre><code>type ReadWriter interface {\n    Read(b Buffer) bool\n    Write(b Buffer) bool\n}\n\ntype File interface {\n    ReadWriter  // same as adding the methods of ReadWriter\n    Locker      // same as adding the methods of Locker\n    Close()\n}\n</code></pre>\n\n<p>You also see that kind of error message when using a <em>pointer</em> to an interface (when the interface itself includes a pointer of sorts: \"<a href=\"https://stackoverflow.com/a/23148998/6309\">Go: What's the meaning of <code>interface{}</code>?</a>\" and \"<a href=\"https://stackoverflow.com/a/27178682/6309\">Cast a struct pointer to interface pointer in Golang</a>\")</p>\n\n<p>See <a href=\"https://github.com/golang/go/issues/10700\" rel=\"noreferrer\">issue 10700</a></p>\n\n<blockquote>\n  <p>When using a new, unfamiliar package, programmers occasionally make the error of using a pointer to an interface type instead of the interface type directly.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "is_accepted": false, "score": 0, "last_activity_date": 1495266806, "creation_date": 1495266806, "answer_id": 44083343, "question_id": 44082536, "link": "https://stackoverflow.com/questions/44082536/interface-has-no-field-or-method-for-an-exported-field-in-a-struct/44083343#44083343", "title": "Interface has no field or method for an exported field in a struct", "body": "<p>Simple, your interface has no method <code>IsGeneric</code>:</p>\n\n<pre><code>type ResourcePrinter interface {\n    PrintSomething()\n}\n</code></pre>\n"}], "owner": {"reputation": 7441, "user_id": 100466, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/20b986aecf495c7a1d9b1910bd5f2cd2?s=128&d=identicon&r=PG", "display_name": "Waseem", "link": "https://stackoverflow.com/users/100466/waseem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5659, "favorite_count": 1, "accepted_answer_id": 44082643, "answer_count": 2, "score": 2, "last_activity_date": 1495294526, "creation_date": 1495260538, "last_edit_date": 1495294526, "question_id": 44082536, "link": "https://stackoverflow.com/questions/44082536/interface-has-no-field-or-method-for-an-exported-field-in-a-struct", "title": "Interface has no field or method for an exported field in a struct", "body": "<p>I have code that has following structure:</p>\n\n<pre><code>// $GOPATH/experiments/interfaceexport/printer/printer.go\npackage printer\n\nimport \"fmt\"\n\ntype ResourcePrinter interface {\n    PrintSomething()\n}\n\ntype JSONPrinter struct {\n    IsGeneric bool\n}\n\nfunc (printer *JSONPrinter) PrintSomething() {\n    fmt.Println(\"JSON\")\n}\n\n// $GOPATH/experiments/interfaceexporter/printerretriever/printerretriever.go\npackage printer\n\nimport \"experiments/interfaceexporter/printer\"\n\nfunc GetPrinter() printer.ResourcePrinter {\n  return &amp;printer.JSONPrinter{IsGeneric: true}\n}\n\n\n// $GOPATH/experiments/interfaceexport/main.go\nimport \"experiments/intefaceexport/printerretriever\"\n\nfunc main() {\n  printer := printerretriever.GetPrinter()\n\n  printer.PrintSomething() // \"JSON\"\n  // interfaceexport/main.go:13: printer.IsGeneric undefined (type printer.ResourcePrinter has no field or method IsGeneric)\n  if printer.IsGeneric {\n    printer.PrintSomething()\n  }\n}\n</code></pre>\n\n<p>When I do <code>go run main.go</code> I get following error:</p>\n\n<p><code>interfaceexport/main.go:13: printer.IsGeneric undefined (type printer.ResourcePrinter has no field or method IsGeneric)</code></p>\n\n<p>Why do I get above error even though <code>IsGeneric</code> is exported?</p>\n"}, {"tags": ["java", "encryption", "go", "cryptography"], "answers": [{"comments": [{"owner": {"reputation": 2927, "user_id": 368957, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/661cf3ed7f2311020cd7054cad120419?s=128&d=identicon&r=PG", "display_name": "Rakesh Goyal", "link": "https://stackoverflow.com/users/368957/rakesh-goyal"}, "edited": false, "score": 0, "creation_date": 1495254845, "post_id": 44081638, "comment_id": 75187231, "body": "Thanks a lot!. I modified my golang code <a href=\"https://play.golang.org/p/FRqIf-_gFt\" rel=\"nofollow noreferrer\">play.golang.org/p/FRqIf-_gFt</a>. Not extracting IV from ciphertext."}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 2927, "user_id": 368957, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/661cf3ed7f2311020cd7054cad120419?s=128&d=identicon&r=PG", "display_name": "Rakesh Goyal", "link": "https://stackoverflow.com/users/368957/rakesh-goyal"}, "edited": false, "score": 0, "creation_date": 1495287597, "post_id": 44081638, "comment_id": 75195221, "body": "Right, that was the other option :)"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 2, "last_activity_date": 1495251216, "creation_date": 1495251216, "answer_id": 44081638, "question_id": 44081175, "link": "https://stackoverflow.com/questions/44081175/first-16-characters-missing-java-aes-cbc-encryption-and-golang-decryption/44081638#44081638", "title": "First 16 characters missing - Java AES CBC encryption and golang decryption", "body": "<p>From the Go code you shared in your playground:</p>\n\n<pre><code>// The IV needs to be unique, but not secure. Therefore it's common to\n// include it at the beginning of the ciphertext.\n...\niv := ciphertext[:aes.BlockSize]\nciphertext = ciphertext[aes.BlockSize:]\n</code></pre>\n\n<p>So as you can see, this code is expecting the first 16 bytes of the <code>ciphertext</code> to be the IV.</p>\n\n<p>However, in your Java code, you do just:</p>\n\n<pre><code>encryptedStr = DatatypeConverter.printBase64Binary(cipher.doFinal(strToEncrypt.getBytes(\"UTF-8\")));\n</code></pre>\n\n<p>So you encrypt the string, and that's all you are returning (and then using in the Go program).</p>\n\n<p>As we saw, the Go code is removing 16 bytes from the ciphertext and that's why you are missing data.</p>\n\n<p>I'd suggest you change your Java code to include the IV at the beginning of the string to match what your Go code expects.</p>\n\n<p>You can change your <code>encryptWithIVandKey</code> method in Java to read:</p>\n\n<pre><code>        Cipher cipher = Cipher.getInstance(\"AES/CBC/PKCS5Padding\");\n        SecretKey key = generateKey(passphrase);\n        byte[] ivBytes = DatatypeConverter.parseBase64Binary(iv);\n        cipher.init(Cipher.ENCRYPT_MODE, key, new IvParameterSpec(ivBytes));\n        byte[] encBytes = cipher.doFinal(strToEncrypt.getBytes(\"UTF-8\"));\n        // concat iv + encripted bytes\n        byte[] concat = new byte[ivBytes.length + encBytes.length];\n        System.arraycopy(ivBytes, 0, concat, 0, ivBytes.length);\n        System.arraycopy(encBytes, 0, concat, ivBytes.length, encBytes.length);\n        encryptedStr = DatatypeConverter.printBase64Binary(concat);\n</code></pre>\n\n<p>The change here is that we are concatenating the IV + the encrypted string before encoding to Base64.</p>\n\n<p>The resulting Base64 is then:</p>\n\n<pre><code>adAz5d5J3PAOuxntOe/9uMJgFHwIcdKobhRSKXwspmnxFlSlF40dtBYf9VSY34fU\n</code></pre>\n\n<p>And if you try that String in your Go code it will produce the output you expect.</p>\n"}], "owner": {"reputation": 2927, "user_id": 368957, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/661cf3ed7f2311020cd7054cad120419?s=128&d=identicon&r=PG", "display_name": "Rakesh Goyal", "link": "https://stackoverflow.com/users/368957/rakesh-goyal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1020, "favorite_count": 3, "accepted_answer_id": 44081638, "answer_count": 1, "score": 1, "last_activity_date": 1495251216, "creation_date": 1495245459, "question_id": 44081175, "link": "https://stackoverflow.com/questions/44081175/first-16-characters-missing-java-aes-cbc-encryption-and-golang-decryption", "title": "First 16 characters missing - Java AES CBC encryption and golang decryption", "body": "<p>I have used following code to encrypt and decrypt data in Java. Encryption and Decryption is working fine.</p>\n\n<pre><code>import javax.crypto.Cipher;\nimport javax.crypto.SecretKey;\nimport javax.crypto.spec.IvParameterSpec;\nimport javax.crypto.spec.SecretKeySpec;\nimport javax.xml.bind.DatatypeConverter;\nimport java.security.SecureRandom;\n\npublic class MainNew {\n\n    public static void main(String[] args) throws Exception{\n        String iv = getEncryptionIV();\n        System.out.println(\" iv = \"+iv);\n\n        String encryptedData= encryptWithIVandKey(iv,encryptionKey,\"hello world! golang is awesome!\");\n        System.out.println(encryptedData);\n        String decryptedData = decrypt (iv,encryptionKey,encryptedData);\n        System.out.println(decryptedData);\n    }\n\n\n    static final String encryptionKey = \"rakesh1@n1111112\";\n\n\n    static byte[] doFinal(int encryptMode, SecretKey key, String iv, byte[] bytes) {\n\n        try {\n            Cipher cipher = Cipher.getInstance(\"AES/CBC/PKCS5Padding\");\n            cipher.init(encryptMode, key, new IvParameterSpec(DatatypeConverter.parseBase64Binary(iv)));\n            byte[] data = cipher.doFinal(bytes);\n\n            return data;\n\n        } catch (Exception e) {\n            e.printStackTrace();\n            System.out.println(e);\n        }\n        return null;\n\n    }\n\n\n\n    static SecretKey generateKey(String passphrase) {\n\n        SecretKey key = null;\n\n        try {\n\n            key = new SecretKeySpec(passphrase.getBytes(\"UTF-8\"), \"AES\");\n\n\n        } catch (Exception e) {\n            e.printStackTrace();\n            System.out.println(e);\n        }\n\n        return key;\n    }\n\n\n\n\n    static String getEncryptionIV() {\n        SecureRandom random = new SecureRandom();\n        byte[] ivBytes = new byte[16];\n        random.nextBytes(ivBytes);\n        return DatatypeConverter.printBase64Binary(ivBytes);\n    }\n\n    static String encryptWithIVandKey( String iv, String passphrase, final String strToEncrypt) {\n        String encryptedStr = \"\";\n\n        try {\n            Cipher cipher = Cipher.getInstance(\"AES/CBC/PKCS5Padding\");\n            SecretKey key = generateKey(passphrase);\n            cipher.init(Cipher.ENCRYPT_MODE, key, new IvParameterSpec(DatatypeConverter.parseBase64Binary(iv)));\n\n            encryptedStr = DatatypeConverter.printBase64Binary(cipher.doFinal(strToEncrypt.getBytes(\"UTF-8\")));\n\n        } catch (Exception e) {\n            e.printStackTrace();\n            System.out.println(e);\n        }\n\n\n        return encryptedStr;\n    }\n\n    static String decrypt(String iv, String passphrase, String ciphertext) {\n        try {\n            SecretKey key = generateKey(passphrase);\n            byte[] decrypted = doFinal(Cipher.DECRYPT_MODE, key, iv, DatatypeConverter.parseBase64Binary(ciphertext));\n            return new String(decrypted, \"UTF-8\");\n        } catch (Exception e) {\n            e.printStackTrace();\n            System.out.println(e);\n        }\n        return \"\";\n    }\n\n}\n</code></pre>\n\n<p>But if I decrypt in golang using <a href=\"https://play.golang.org/p/u4fip_ZW6a\" rel=\"nofollow noreferrer\">https://play.golang.org/p/u4fip_ZW6a</a> code. First 16 characters are missing in the decrypted value.</p>\n"}, {"tags": ["arrays", "go", "slice"], "comments": [{"owner": {"reputation": 601, "user_id": 1653236, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/814f14350de9f7f66ab664489e483d7f?s=128&d=identicon&r=PG", "display_name": "CodeFinity", "link": "https://stackoverflow.com/users/1653236/codefinity"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1495239859, "post_id": 44080412, "comment_id": 75185019, "body": "Right. I was just reviewing about concept of &#39;slice header.&#39; Tx."}], "answers": [{"comments": [{"owner": {"reputation": 601, "user_id": 1653236, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/814f14350de9f7f66ab664489e483d7f?s=128&d=identicon&r=PG", "display_name": "CodeFinity", "link": "https://stackoverflow.com/users/1653236/codefinity"}, "edited": false, "score": 0, "creation_date": 1495239891, "post_id": 44080426, "comment_id": 75185022, "body": "Yes, that makes it more clear about it pointing to AN element in array. Ok."}], "tags": [], "owner": {"reputation": 16210, "user_id": 819340, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-NJ0q8ZFwD6s/AAAAAAAAAAI/AAAAAAAAACI/Wy1G-7NtYCU/photo.jpg?sz=128", "display_name": "Paulo Mattos", "link": "https://stackoverflow.com/users/819340/paulo-mattos"}, "is_accepted": true, "score": 1, "last_activity_date": 1495237478, "creation_date": 1495237478, "answer_id": 44080426, "question_id": 44080412, "link": "https://stackoverflow.com/questions/44080412/a-go-slice-holds-a-reference-to-a-subsection-of-an-array-or-just-a-single-elemen/44080426#44080426", "title": "A Go slice holds a reference to a subsection of an array or just a single element?", "body": "<p>Yes, a pointer to the <em>first</em> slice element in the backing array. I bet this wording comes from Go language C background :)</p>\n"}], "owner": {"reputation": 601, "user_id": 1653236, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/814f14350de9f7f66ab664489e483d7f?s=128&d=identicon&r=PG", "display_name": "CodeFinity", "link": "https://stackoverflow.com/users/1653236/codefinity"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 44080426, "answer_count": 1, "score": 0, "last_activity_date": 1495237950, "creation_date": 1495237325, "last_edit_date": 1495237950, "question_id": 44080412, "link": "https://stackoverflow.com/questions/44080412/a-go-slice-holds-a-reference-to-a-subsection-of-an-array-or-just-a-single-elemen", "title": "A Go slice holds a reference to a subsection of an array or just a single element?", "body": "<p><a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">Golang blog about slices and arrays</a></p>\n\n<blockquote>\n  <p>think of a slice as a little data structure with two elements: a length and a pointer to an element of an array.</p>\n</blockquote>\n\n<p>Little bewildered by verbiage saying: '...pointer to an ELEMENT of an array.' That would only be the case if it was a slice with len() of 1, right?</p>\n\n<p>I believe the blog post may have meant to say that it was a pointer to a 'subsection' of an array, right?</p>\n"}, {"tags": ["windows", "iis", "go", "system-calls"], "owner": {"reputation": 1256, "user_id": 4949938, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7586b74526dc4ef59eb6f8b6d4cb6a94?s=128&d=identicon&r=PG", "display_name": "mxplusb", "link": "https://stackoverflow.com/users/4949938/mxplusb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 320, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1543351643, "creation_date": 1495230148, "question_id": 44079418, "link": "https://stackoverflow.com/questions/44079418/golang-set-syscall-user-context-in-windows", "title": "Golang - Set syscall user context in Windows", "body": "<p>I am making two syscalls to the <a href=\"https://msdn.microsoft.com/en-us/library/ms693832(v=vs.90).aspx\" rel=\"nofollow noreferrer\">IIS Hosted Web Core (HWC)</a> <code>WebCoreActivate</code> and <code>WebCoreShutdown</code> APIs. I would like to add a user context, so when the syscalls are made in Windows, they are run underneath a specific user's context - i.e., that user's permissions.</p>\n\n<pre><code>type WebCore struct {\n    activated bool\n    Handle    syscall.Handle\n    Credentials syscall.Credential\n}\n\nfunc New() (error, *WebCore) {\n    hwebcore, err := syscall.LoadLibrary(os.ExpandEnv(`${windir}\\system32\\inetsrv\\hwebcore.dll`))\n    if err != nil {\n        return err, nil\n    }\n\n    return nil, &amp;WebCore{\n        activated: false,\n        Handle:    hwebcore,\n    }\n}\n\nfunc (w *WebCore) Activate(appHostConfigPath, rootWebConfigPath, instanceName string) error {\n    if !w.activated {\n        webCoreActivate, err := syscall.GetProcAddress(w.Handle, \"WebCoreActivate\")\n        if err != nil {\n            return err\n        }\n\n        var nargs uintptr = 3\n        _, _, exitCode := syscall.Syscall(uintptr(webCoreActivate),\n            nargs,\n            uintptr(unsafe.Pointer(syscall.StringToUTF16Ptr(appHostConfigPath))),\n            uintptr(unsafe.Pointer(syscall.StringToUTF16Ptr(rootWebConfigPath))),\n            uintptr(unsafe.Pointer(syscall.StringToUTF16Ptr(instanceName))))\n        if exitCode != 0 {\n            return fmt.Errorf(\"WebCoreActivate returned exit code: %d\", exitCode)\n        }\n\n        fmt.Printf(\"Server Started for %+v\\n\", instanceName)\n        w.activated = true\n    }\n\n    return nil\n}\n\nfunc (w *WebCore) Shutdown(immediate int, instanceName string) error {\n    if w.activated {\n        webCoreShutdown, err := syscall.GetProcAddress(w.Handle, \"WebCoreShutdown\")\n        if err != nil {\n            return err\n        }\n\n        var nargs uintptr = 1\n        _, _, exitCode := syscall.Syscall(uintptr(webCoreShutdown),\n            nargs, uintptr(unsafe.Pointer(&amp;immediate)), 0, 0)\n        if exitCode != 0 {\n            return fmt.Errorf(\"WebCoreShutdown returned exit code: %d\", exitCode)\n        }\n        fmt.Printf(\"Server Shutdown for %+v\\n\", instanceName)\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>I've been reading about the <code>exec.Command().SysProcAttr</code> structure, and how you can attach specific user credentials via the <code>syscall.Credentials{}</code> structure. However, that seems limited to executing commands via <code>os.exec</code>. If I wanted to tie a specific user's context to a native syscall in Windows, how would I do that?</p>\n"}, {"tags": ["go", "dll", "shared-libraries", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 141, "user_id": 5241934, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/691bfe7b8c1908b4fa18349c82ced390?s=128&d=identicon&r=PG&f=1", "display_name": "\u6d77\u7259\u5ba2\u79fb\u5e93", "link": "https://stackoverflow.com/users/5241934/%e6%b5%b7%e7%89%99%e5%ae%a2%e7%a7%bb%e5%ba%93"}, "is_accepted": false, "score": 2, "last_activity_date": 1503651557, "creation_date": 1503651557, "answer_id": 45877843, "question_id": 44079364, "link": "https://stackoverflow.com/questions/44079364/how-to-use-a-go-callback-for-a-dll-with-minimal-cgo/45877843#45877843", "title": "How to use a Go callback for a DLL with minimal Cgo?", "body": "<p>There is some way to avoid the cast and simplify callback code.  </p>\n\n<pre><code>// cgo.h in dll  \ntypedef void (*Callback)(int kind,void* arg);\nvoid SetCallback(Callback func);\n\n// cgo.c in dll\nCallback Gfunc;\nvoid SetCallback(Callback func){\n    Gfunc=func;\n}\n\n// cgocb.h in go project\nvoid InitCallback();\nextern void goCallbackFunction(int kind,void* arg);\n\n// cgocb.c in go project\nvoid InitCallback(){\n    SetCallback(goCallbackFunction);\n}\n\n// cgocb.go in go project\n// export goCallbackFunction\nfunc goCallbackFunction(kind C.int,arg unsafe.Pointer){\n    switch kind{\n    case C.AKind:\n        arg:=(*C.AKind)(arg)\n        AkindCallback(arg)\n    }\n}\n</code></pre>\n\n<ol>\n<li>The <code>C.InitCallback</code> function is similar to <code>C.SomeDLLFunc</code>.But it references <code>goCallbackFunction</code> directly without cast,since I move the code from .go to .c.  </li>\n<li>This is a solution about callback to go from c dll. We need to register only one go function to the dll. We write one <code>C.InitCallback</code>. Note that if we use the <code>C.SomeDLLFunc</code> solution, we must write (gocallback,dllfunc) pairs.  </li>\n<li>Keeping an export go function pointer in c dll is ok.  </li>\n</ol>\n"}], "owner": {"reputation": 745, "user_id": 4547609, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/108385d869de0f7c3c4e5964d639fe5a?s=128&d=identicon&r=PG", "display_name": "Another Prog", "link": "https://stackoverflow.com/users/4547609/another-prog"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1659, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1503651557, "creation_date": 1495229846, "question_id": 44079364, "link": "https://stackoverflow.com/questions/44079364/how-to-use-a-go-callback-for-a-dll-with-minimal-cgo", "title": "How to use a Go callback for a DLL with minimal Cgo?", "body": "<p>One way to setup a callback function to be passed in to a parameter to a DLL function is to use CGO...</p>\n\n<pre><code>package main\n\n/*\n#cgo LDFLAGS: -L${SRCDIR} -lsomelib\n\n#include \"somelib.h\"\n\nextern void CallbackString(char* s);\n*/\nimport \"C\"\n\nimport (\n    \"unsafe\"\n    \"fmt\"\n)\n\n//export CallbackString\nfunc CallbackString(s *C.char) {\n    gostr := C.GoString(s)  // convert to golang string\n    fmt.Println(\"Got string from dll (or dso): \", gostr)\n}\n\nfunc Example() {\n    // setup a callback by calling a function in\n    // the DLL requiring callback param\n    C.SomeDLLFunc(x,y,\n        (C.TCallbackString)(unsafe.Pointer(C.CallbackString)),\n        other,\n        params)\n}\n\n\nfunc main() {\n    Example()\n}\n</code></pre>\n\n<p>where the callback is defined as</p>\n\n<pre><code>typedef void (*TCallbackString)(char*);\n</code></pre>\n\n<p>But I am wondering if there is a way to avoid using CGO and just pass the go function in as a parameter without requiring needless C code bindings.. i.e.</p>\n\n<pre><code>C.SomeDLLFunc(x,y,\n    CallbackString, // how to send the go function in as a callback?\n    other,\n    params)\n</code></pre>\n\n<p>Does it always require writing C bindings or whatever you call them, C links to the go code, C exports/externs, in order to send a callback as a param?</p>\n\n<p>There is no way to just make a go function a callback without making it C-ish first?</p>\n\n<pre><code>C.SomeDLLFunc(x,y,\n    WhatCastIsNeeded(CallbackString), // regular go function as a callback?\n    other,\n    params)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1495224592, "post_id": 44078189, "comment_id": 75180480, "body": "see <a href=\"https://stackoverflow.com/questions/39320025/go-how-to-stop-http-listenandserve/42533360#42533360\" title=\"go how to stop http listenandserve\">stackoverflow.com/questions/39320025/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 8038540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/349ff8951d3d876550737d484f1f5d4d?s=128&d=identicon&r=PG&f=1", "display_name": "P. Mow", "link": "https://stackoverflow.com/users/8038540/p-mow"}, "edited": false, "score": 0, "creation_date": 1495224724, "post_id": 44078268, "comment_id": 75180534, "body": "How do I create my own http.Server instance, like a package level variable? @Adrian"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 13, "user_id": 8038540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/349ff8951d3d876550737d484f1f5d4d?s=128&d=identicon&r=PG&f=1", "display_name": "P. Mow", "link": "https://stackoverflow.com/users/8038540/p-mow"}, "edited": false, "score": 0, "creation_date": 1495224991, "post_id": 44078268, "comment_id": 75180646, "body": "Added a code example displaying immediate shutdown. For graceful shutdown, see <a href=\"https://stackoverflow.com/questions/39320025/go-how-to-stop-http-listenandserve/42533360#42533360\" title=\"go how to stop http listenandserve\">stackoverflow.com/questions/39320025/&hellip;</a> or <a href=\"https://gist.github.com/peterhellberg/38117e546c217960747aacf689af3dc2\" rel=\"nofollow noreferrer\">gist.github.com/peterhellberg/38117e546c217960747aacf689af3d&zwnj;&#8203;c2</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 13, "user_id": 8038540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/349ff8951d3d876550737d484f1f5d4d?s=128&d=identicon&r=PG&f=1", "display_name": "P. Mow", "link": "https://stackoverflow.com/users/8038540/p-mow"}, "edited": false, "score": 0, "creation_date": 1495225233, "post_id": 44078268, "comment_id": 75180759, "body": "Note also that the given code is the minimum change to do what you&#39;re asking; I would advise against using the default mux or default server (or any package-level variables in the stdlib like flags or log) for anything but a throwaway project."}, {"owner": {"reputation": 13, "user_id": 8038540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/349ff8951d3d876550737d484f1f5d4d?s=128&d=identicon&r=PG&f=1", "display_name": "P. Mow", "link": "https://stackoverflow.com/users/8038540/p-mow"}, "edited": false, "score": 0, "creation_date": 1495226538, "post_id": 44078268, "comment_id": 75181356, "body": "Why does shutdown and close kill the my whole program? @Adrian"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 13, "user_id": 8038540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/349ff8951d3d876550737d484f1f5d4d?s=128&d=identicon&r=PG&f=1", "display_name": "P. Mow", "link": "https://stackoverflow.com/users/8038540/p-mow"}, "edited": false, "score": 0, "creation_date": 1495226579, "post_id": 44078268, "comment_id": 75181383, "body": "Because your main() returns after kill_server(). When main returns, the program exits."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1495224935, "last_edit_date": 1495224935, "creation_date": 1495224500, "answer_id": 44078268, "question_id": 44078189, "link": "https://stackoverflow.com/questions/44078189/how-do-i-kill-a-http-server-from-another-function/44078268#44078268", "title": "How do I kill a http server from another function", "body": "<p>Unfortunately not. <code>http.ListenAndServe</code> generates a local <code>http.Server</code> instance, which you cannot gain access to, which is what you would need to be able to stop it. You'll need to create your own <code>http.Server</code> instance, and register your handlers with that instead of using <code>http.HandleFunc</code>. Then you can shut down the server using <code>Close()</code> to shut down immediately, or <code>Shutdown()</code> to do a graceful stop (letting requests in flight complete before shutting down).</p>\n\n<pre><code>var server *http.Server\n//...\nfunc PleaseStart() {\n    http.HandleFunc(\"/\", handlerfunc)\n    server = &amp;http.Server{\n        Addr:    \":80\",\n        Handler: http.DefaultServeMux,\n    }\n    log.Fatal(server.ListenAndServe())\n}\n\nfunc kill_server() {\n    server.Close()\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 8038540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/349ff8951d3d876550737d484f1f5d4d?s=128&d=identicon&r=PG&f=1", "display_name": "P. Mow", "link": "https://stackoverflow.com/users/8038540/p-mow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1127, "favorite_count": 0, "accepted_answer_id": 44078268, "answer_count": 1, "score": 1, "last_activity_date": 1495224935, "creation_date": 1495224081, "question_id": 44078189, "link": "https://stackoverflow.com/questions/44078189/how-do-i-kill-a-http-server-from-another-function", "title": "How do I kill a http server from another function", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n)\n\n\nfunc handlerfunc(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hello World\" )\n    }\n\n    http.ServeContent(w, r, str , time.Now(), f)\n}\n\nfunc PleaseStart(){\n    http.HandleFunc(\"/\" , handlerfunc )\n    log.Fatal(http.ListenAndServe(\":80\", nil))\n}\n\nfunc kill_server() {\n    //How do I kill server from here\n}\n\n\nfunc main() {\n    go PleaseStart()\n\n    kill_server()\n}\n</code></pre>\n\n<p>I start a http.server that responds with hello world, how do I kill it from kill_server function\nIs this possible without rewritting everything?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 7569421, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b1ad45f420f7bcf232fd163c06697c85?s=128&d=identicon&r=PG&f=1", "display_name": "ahmed nader", "link": "https://stackoverflow.com/users/7569421/ahmed-nader"}, "edited": false, "score": 0, "creation_date": 1495215631, "post_id": 44075957, "comment_id": 75176033, "body": "you mean main have handlers to modules and inside each modules i can go deeper and add handlers that navigate deeper ?"}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 71, "user_id": 7569421, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b1ad45f420f7bcf232fd163c06697c85?s=128&d=identicon&r=PG&f=1", "display_name": "ahmed nader", "link": "https://stackoverflow.com/users/7569421/ahmed-nader"}, "edited": false, "score": 0, "creation_date": 1495216046, "post_id": 44075957, "comment_id": 75176258, "body": "yes, I updated my answer with a more concrete example"}, {"owner": {"reputation": 71, "user_id": 7569421, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b1ad45f420f7bcf232fd163c06697c85?s=128&d=identicon&r=PG&f=1", "display_name": "ahmed nader", "link": "https://stackoverflow.com/users/7569421/ahmed-nader"}, "edited": false, "score": 0, "creation_date": 1495217921, "post_id": 44075957, "comment_id": 75177241, "body": "can i make different folders and handlers navigate to a certain function in them like django in python for example ? or it is not good approach ? as i dont want to use chis i wantto use my own logic"}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 71, "user_id": 7569421, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b1ad45f420f7bcf232fd163c06697c85?s=128&d=identicon&r=PG&f=1", "display_name": "ahmed nader", "link": "https://stackoverflow.com/users/7569421/ahmed-nader"}, "edited": false, "score": 1, "creation_date": 1495218880, "post_id": 44075957, "comment_id": 75177727, "body": "take a look at the linked answer for a basic example of how to implement your own router. you can end up implementing something similar to how django works but it will be quite an effort. also, even if you don&#39;t use a framework, you can take a look at their source code to see how they go about nesting the routers"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 0, "last_activity_date": 1495216022, "last_edit_date": 1495540507, "creation_date": 1495215433, "answer_id": 44075957, "question_id": 44075681, "link": "https://stackoverflow.com/questions/44075681/how-to-oragnize-handlers-in-go-as-project-gets-bigger/44075957#44075957", "title": "how to oragnize handlers in go as project gets bigger?", "body": "<p>You definitely should not put 500+ <code>HandleFunc</code> in your main.</p>\n\n<p>To begin with, as the project goes bigger you'll probably create modules and types.</p>\n\n<p>You can then delegate to these modules or types from your <code>main</code> so that then each module or type would then register handles themselves.</p>\n\n<p>Also, probably many of your URLs will follow patterns, such as:</p>\n\n<pre><code>\"/articles/{id}\"\n</code></pre>\n\n<p>If that's the case, you should just register that pattern once, and then the function handling the request can operate based on the parameter <code>{id}</code>.</p>\n\n<p>There are several libraries out there that can help manage the routing if using patterns, or you can also code your own routing logic.</p>\n\n<p>Take a look at this question for some alternatives on that matter:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/6564558/wildcards-in-the-pattern-for-http-handlefunc\">Wildcards in the pattern for http.HandleFunc</a></p>\n\n<p>For example, if you where using <code>Chi</code> (<a href=\"https://github.com/pressly/chi\" rel=\"nofollow noreferrer\">https://github.com/pressly/chi</a>) to manage the routing, in your main you can do:</p>\n\n<pre><code>r := chi.NewRouter()\nr.Mount(\"/admin\", adminRouter())\n</code></pre>\n\n<p>And then inside that <code>adminRouter()</code> function you keep creating handlers that will be served under <code>/admin</code>:</p>\n\n<pre><code>func adminRouter() http.Handler {\n    r := chi.NewRouter()\n    r.Use(AdminOnly)\n    r.Get(\"/\", adminIndex)\n    r.Get(\"/accounts\", adminListAccounts)\n    return r\n}\n</code></pre>\n\n<p>(all this is taken from Chi's documentation)</p>\n\n<p>This is just an example, you can implement similar logic using a different way.</p>\n"}], "owner": {"reputation": 71, "user_id": 7569421, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b1ad45f420f7bcf232fd163c06697c85?s=128&d=identicon&r=PG&f=1", "display_name": "ahmed nader", "link": "https://stackoverflow.com/users/7569421/ahmed-nader"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 399, "favorite_count": 0, "accepted_answer_id": 44075957, "answer_count": 1, "score": 3, "last_activity_date": 1495216022, "creation_date": 1495214360, "question_id": 44075681, "link": "https://stackoverflow.com/questions/44075681/how-to-oragnize-handlers-in-go-as-project-gets-bigger", "title": "how to oragnize handlers in go as project gets bigger?", "body": "<p>I am building a website with <code>Go</code> and I know how it works and how to handle routes with <code>handlefunc()</code>. however, my website is getting bigger and I will probably have alot of urls. the question is how to handle all this ? I cannot just add for example 100+ or 500+ <code>handelfunc()</code> in my <code>main()</code> to match each possible route or url for example. so how to manage it ? thanks in advance.</p>\n\n<p><strong>NOTE ::</strong> </p>\n\n<p>my question doesn't require any code.</p>\n"}, {"tags": ["python", "http", "go", "httprequest", "swagger"], "comments": [{"owner": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "edited": false, "score": 1, "creation_date": 1495207727, "post_id": 44073801, "comment_id": 75171689, "body": "The client and server need to negotiate between HTTP 1.1 and 1.0, because the server is using HTTP 1.0; if you have control of the server, just add the property <code>protocol_version = &quot;HTTP&#47;1.1&quot;</code> to your BaseHTTPRequestHandler subclass (see <a href=\"https://github.com/mineralsprings/json-api-host/blob/master/server.py#L26\" rel=\"nofollow noreferrer\">github.com/mineralsprings/json-api-host/blob/master/&hellip;</a>)"}, {"owner": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "edited": false, "score": 0, "creation_date": 1495207759, "post_id": 44073801, "comment_id": 75171714, "body": "<code>&quot;detail&quot;: &quot;Missing formdata parameter &#39;file&#39;&quot;</code> seems to want it to be <code>file=&quot;name&quot;</code> not <code>name=&quot;file&quot;</code>"}, {"owner": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "reply_to_user": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "edited": false, "score": 0, "creation_date": 1495208338, "post_id": 44073801, "comment_id": 75172078, "body": "name=&quot;file&quot; is correct, I think, because that is the name of the form parameter.  I&#39;ve missed that HTTP version mismatch. I run the test server with <code>python -m swagger_server</code> can I add some parameter to run the <code>BaseHTTPServer</code> with <code>HTTP&#47;1.1</code>? Or somehow configure the flask framework?"}, {"owner": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "edited": false, "score": 0, "creation_date": 1495208691, "post_id": 44073801, "comment_id": 75172293, "body": "Well, we need the source of the server to know why it thinks that&#39;s a bad request, because I think it&#39;s well formed."}, {"owner": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "edited": false, "score": 0, "creation_date": 1495208724, "post_id": 44073801, "comment_id": 75172311, "body": "If you&#39;re using flask, the flask documentation surely talks about setting the server version, but it may not be overly important"}, {"owner": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "reply_to_user": {"reputation": 3392, "user_id": 4532996, "user_type": "registered", "accept_rate": 99, "profile_image": "https://i.stack.imgur.com/uXkl2.png?s=128&g=1", "display_name": "cat", "link": "https://stackoverflow.com/users/4532996/cat"}, "edited": false, "score": 0, "creation_date": 1495208847, "post_id": 44073801, "comment_id": 75172381, "body": "so I&#39;ve set <code>http.server.BaseHTTPRequestHandler.protocol_version = &quot;HTTP&#47;1.1&quot;</code> and the server now responds with <code>HTTP&#47;1.1</code> but the result is the same. The code isn&#39;t interesting, it is just <code>connexion</code> that loads the <code>swagger.yaml</code>"}, {"owner": {"reputation": 3498, "user_id": 528578, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Qgscj.png?s=128&g=1", "display_name": "Jerry Saravia", "link": "https://stackoverflow.com/users/528578/jerry-saravia"}, "edited": false, "score": 1, "creation_date": 1495209998, "post_id": 44073801, "comment_id": 75173065, "body": "Can you post the request that is being sent by the swagger-ui for comparison? Open up dev tools and look at the request. That&#39;ll probably shed some light on this."}], "answers": [{"tags": [], "owner": {"reputation": 3498, "user_id": 528578, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Qgscj.png?s=128&g=1", "display_name": "Jerry Saravia", "link": "https://stackoverflow.com/users/528578/jerry-saravia"}, "is_accepted": false, "score": 0, "last_activity_date": 1495211820, "creation_date": 1495211820, "answer_id": 44074994, "question_id": 44073801, "link": "https://stackoverflow.com/questions/44073801/is-this-http-request-valid/44074994#44074994", "title": "Is this HTTP request valid?", "body": "<p>Based on the two requests you have posted I would attempt to set the <code>Content-Length</code> on your go request first and test that. I've run into issues before with the ArangoDB HTTP API not accepting requests without a correct content length value. </p>\n\n<p>If the succeeds then yay. </p>\n\n<p>Otherwise, that <code>ff</code> in your request is the next thing I'd look at getting rid of. But I'd focus on the <code>Content-Length</code> header first.</p>\n"}, {"comments": [{"owner": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "edited": false, "score": 0, "creation_date": 1495287258, "post_id": 44077767, "comment_id": 75195121, "body": "the last 0 chunk was there, but I didn&#39;t know that the 0 is a part of the request. I must now find out how to tell to the go http client to not use http chunked transfer. thanks :)"}], "tags": [], "owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "is_accepted": false, "score": 2, "last_activity_date": 1495222386, "creation_date": 1495222386, "answer_id": 44077767, "question_id": 44073801, "link": "https://stackoverflow.com/questions/44073801/is-this-http-request-valid/44077767#44077767", "title": "Is this HTTP request valid?", "body": "<p>The first request you send is a HTTP/1.1 request using chunked transfer encoding. This means the body is consisting of multiple chunks where each chunk is prefixed by the size in hex followed by <code>\\r\\n</code> followed by the data and again <code>\\r\\n</code>. I'm not sure if the <code>ff</code> at the beginning of the body you show really specifies the size of the following data (i.e. 255 bytes). But, the last chunk with a size of 0 is missing, so this request is incomplete. But maybe you just omitted the missing part from this question only.</p>\n\n<p>Apart from that the server is responding with version HTTP/1.0. Chunked transfer encoding is only defined for HTTP/1.1 which means that this request will not be understood by a HTTP/1.0 server. And not even all HTTP/1.1 server will understand chunked transfer encoding in the request even if they should.</p>\n\n<p>The second request you show (created by Chrome) does not use chunked transfer encoding but specifies instead the length of the header using <code>Content-length</code> in the HTTP header. That's the way you should go since this works with all web  servers,  including HTTP/1.0 servers.</p>\n"}], "owner": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 375, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1495222386, "creation_date": 1495207579, "last_edit_date": 1495210702, "question_id": 44073801, "link": "https://stackoverflow.com/questions/44073801/is-this-http-request-valid", "title": "Is this HTTP request valid?", "body": "<p>I've made an python server with <code>swagger-codegen</code>. I have one endpoint that receives an file with <code>mutlipart/form-data</code></p>\n\n<p>And also created an client with <a href=\"https://github.com/go-swagger/go-swagger\" rel=\"nofollow noreferrer\">go-swagger</a> for testing.</p>\n\n<p>created an file to upload: <code>$ echo \"123file content321\" &gt; data</code></p>\n\n<p>and used the client to upload the file to the server. The resulting HTTP request looks like this:</p>\n\n<pre><code>POST /api/order/1/attachment HTTP/1.1\nHost: 127.0.0.1:8080\nUser-Agent: Go-http-client/1.1\nTransfer-Encoding: chunked\nAccept: application/json\nContent-Type: multipart/form-data; boundary=5f3f0ad86e6345b77c869cbe0a5e608f038354cf9ceab74ec2533d7555c0\nAccept-Encoding: gzip\n\nff\n--5f3f0ad86e6345b77c869cbe0a5e608f038354cf9ceab74ec2533d7555c0\nContent-Disposition: form-data; name=\"file\"; filename=\"data\"\nContent-Type: application/octet-stream\n\n123file content321\n\n--5f3f0ad86e6345b77c869cbe0a5e608f038354cf9ceab74ec2533d7555c0--\n</code></pre>\n\n<p>but the server doesn't accept it and responds:</p>\n\n<pre><code>HTTP/1.0 400 BAD REQUEST\nConnection: close\nContent-Length: 120\nContent-Type: application/problem+json\nDate: Fri, 19 May 2017 15:15:44 GMT\nServer: Werkzeug/0.12.1 Python/3.6.1\n{\n  \"type\": \"about:blank\",\n  \"title\": \"Bad Request\",\n  \"detail\": \"Missing formdata parameter 'file'\",\n  \"status\": 400\n}\n</code></pre>\n\n<p>So the request isn't parsed properly. But when I use the swagger-ui, the file is uploaded correctly. Is there problem with the client's request, or the server has a problem?</p>\n\n<p>EDIT: I think that there is missing <code>Content-Lenght</code> or the <code>ff</code> at the beginning of the BODY might not be there </p>\n\n<p>EDIT2: the swagger-ui request:</p>\n\n<pre><code>POST /api/order/1/attachment HTTP/1.1\nHost: localhost:8080\nConnection: keep-alive\nContent-Length: 211\nOrigin: http://localhost:8080\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundarypzmNwrDR7zzpZ7SJ\nAccept: application/json\nX-Requested-With: XMLHttpRequest\nDNT: 1\nAccept-Encoding: gzip, deflate, br\nAccept-Language: en-US,en;q=0.8\n\n------WebKitFormBoundarypzmNwrDR7zzpZ7SJ\nContent-Disposition: form-data; name=\"file\"; filename=\"data\"\nContent-Type: application/octet-stream\n\n123file content321\n\n------WebKitFormBoundarypzmNwrDR7zzpZ7SJ--\n</code></pre>\n"}, {"tags": ["string", "go", "substring", "slice"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 21, "last_activity_date": 1495211961, "last_edit_date": 1495211961, "creation_date": 1495207627, "answer_id": 44073825, "question_id": 44073754, "link": "https://stackoverflow.com/questions/44073754/how-to-slice-string-till-particular-character-in-go/44073825#44073825", "title": "How to slice string till particular character in Go?", "body": "<p>You may use <a href=\"https://golang.org/pkg/strings/#IndexByte\" rel=\"noreferrer\"><code>strings.IndexByte()</code></a> or <a href=\"https://golang.org/pkg/strings/#IndexRune\" rel=\"noreferrer\"><code>strings.IndexRune()</code></a> to get the position (byte-index) of the colon <code>':'</code>, then simply <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"noreferrer\">slice</a> the <code>string</code> value:</p>\n\n<pre><code>message := \"Rob: Hello everyone!\"\nuser := message[:strings.IndexByte(message, ':')]\nfmt.Println(user)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/4znXPNn_0d\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Rob\n</code></pre>\n\n<p>If you're not sure the colon is in the <code>string</code>, you have to check the index before proceeding to slice the <code>string</code>, else you get a runtime panic. This is how you can do it:</p>\n\n<pre><code>message := \"Rob: Hello everyone!\"\nif idx := strings.IndexByte(message, ':'); idx &gt;= 0 {\n    user := message[:idx]\n    fmt.Println(user)\n} else {\n    fmt.Println(\"Invalid string\")\n}\n</code></pre>\n\n<p>Output is the same.</p>\n\n<p>Changing the message to be invalid:</p>\n\n<pre><code>message := \"Rob Hello everyone!\"\n</code></pre>\n\n<p>Output this time is (try it on the <a href=\"https://play.golang.org/p/NVY4nrQMu7\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Invalid string\n</code></pre>\n\n<p>Another handy solution is to use <a href=\"https://golang.org/pkg/strings/#Split\" rel=\"noreferrer\"><code>strings.Split()</code></a>:</p>\n\n<pre><code>message := \"Rob: Hello everyone!\"\n\nparts := strings.Split(message, \":\")\nfmt.Printf(\"%q\\n\", parts)\n\nif len(parts) &gt; 1 {\n    fmt.Println(\"User:\", parts[0])\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/7CpQa0Hisb\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[\"Rob\" \" Hello everyone!\"]\nUser: Rob\n</code></pre>\n\n<p>Should there be no colon in the input <code>string</code>, <code>strings.Split()</code> returns a slice of strings containing a single <code>string</code> value being the input (the code above does not print anything in that case as length will be <code>1</code>). </p>\n"}, {"tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": false, "score": 4, "last_activity_date": 1495207647, "creation_date": 1495207647, "answer_id": 44073829, "question_id": 44073754, "link": "https://stackoverflow.com/questions/44073754/how-to-slice-string-till-particular-character-in-go/44073829#44073829", "title": "How to slice string till particular character in Go?", "body": "<p><a href=\"https://golang.org/pkg/strings/#Index\" rel=\"nofollow noreferrer\">strings.Index</a> or <a href=\"https://golang.org/pkg/strings/#IndexRune\" rel=\"nofollow noreferrer\">strings.IndexRune</a>, depending on whether you want to use unicode as the separator, will give you the index of the sought character.</p>\n\n<p>Alternatively, you can use strings.Split and just grab the first string returned.  </p>\n\n<p>Example: <code>user := strings.Split(message, \":\")[0]</code></p>\n\n<p><a href=\"https://play.golang.org/p/I1P1Liz1F6\" rel=\"nofollow noreferrer\">https://play.golang.org/p/I1P1Liz1F6</a></p>\n\n<p>Notably, this will not panic if the separator character is not in the original string, but the <code>user</code> variable will be set to the entirety of the original string instead.</p>\n"}], "owner": {"reputation": 367, "user_id": 4967943, "user_type": "registered", "accept_rate": 36, "profile_image": "https://graph.facebook.com/986719114682053/picture?type=large", "display_name": "Lakshay Kalbhor", "link": "https://stackoverflow.com/users/4967943/lakshay-kalbhor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10361, "favorite_count": 0, "accepted_answer_id": 44073825, "answer_count": 2, "score": 10, "last_activity_date": 1495211961, "creation_date": 1495207424, "last_edit_date": 1495211852, "question_id": 44073754, "link": "https://stackoverflow.com/questions/44073754/how-to-slice-string-till-particular-character-in-go", "title": "How to slice string till particular character in Go?", "body": "<p>I want to extract a string till a character is found. For example: </p>\n\n<pre><code>message := \"Rob: Hello everyone!\"\nuser := strings.Trim(message,\n</code></pre>\n\n<p>I want to be able to store <code>\"Rob\"</code> (read till <code>':'</code> is found).</p>\n"}, {"tags": ["go", "concurrency", "server"], "answers": [{"comments": [{"owner": {"reputation": 245, "user_id": 7360695, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5ba260c91ea10f26485623058a28e4fc?s=128&d=identicon&r=PG&f=1", "display_name": "Battalgazi", "link": "https://stackoverflow.com/users/7360695/battalgazi"}, "edited": false, "score": 0, "creation_date": 1495199071, "post_id": 44070394, "comment_id": 75165650, "body": "Thanks for your answer, ill work on it and come back with feedback"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 245, "user_id": 7360695, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5ba260c91ea10f26485623058a28e4fc?s=128&d=identicon&r=PG&f=1", "display_name": "Battalgazi", "link": "https://stackoverflow.com/users/7360695/battalgazi"}, "edited": false, "score": 0, "creation_date": 1495199978, "post_id": 44070394, "comment_id": 75166279, "body": "@Battalgazi I edited the code and changed <code>customData</code> pointers to be non-pointers (this might prevent further data races if you&#39;d try to modify and set back the same <code>*customData</code> value)."}, {"owner": {"reputation": 245, "user_id": 7360695, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5ba260c91ea10f26485623058a28e4fc?s=128&d=identicon&r=PG&f=1", "display_name": "Battalgazi", "link": "https://stackoverflow.com/users/7360695/battalgazi"}, "edited": false, "score": 0, "creation_date": 1495714420, "post_id": 44070394, "comment_id": 75374536, "body": "Thanks i could make it work using the map as u proposed :)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1580126391, "last_edit_date": 1580126391, "creation_date": 1495197599, "answer_id": 44070394, "question_id": 44070323, "link": "https://stackoverflow.com/questions/44070323/server-instances-with-multiple-users/44070394#44070394", "title": "Server instances with multiple users", "body": "<p>Requests are served from multiple goroutines, concurrently. This means if they read/write the same variable, access to this variable must be synchronized.</p>\n\n<p>Next, if you want a different instance of this data for each user, you may use a map, mapping from user ID or name to the data structure.</p>\n\n<p>Let's assume the data structure is a struct, e.g.:</p>\n\n<pre><code>type customData struct {\n    Field1 string\n    Field2 int\n    // Whatever fields you need\n}\n</code></pre>\n\n<p>The map holding one for each user:</p>\n\n<pre><code>var userDataMap = map[string]customData{}\n</code></pre>\n\n<p>You may use a <a href=\"https://golang.org/pkg/sync/#RWMutex\" rel=\"nofollow noreferrer\"><code>sync.RWMutex</code></a> for protecting a map while it is read / written from a goroutine:</p>\n\n<pre><code>var mu = &amp;sync.RWMutex{}\n</code></pre>\n\n<p>And synchronized access to the map, using the above mutex:</p>\n\n<pre><code>func Get(user string) customData {\n    mu.RLock()\n    defer mu.RUnlock()\n    return userDataMap[user]\n}\n\nfunc Set(user string, data customData) {\n    mu.Lock()\n    userDataMap[user] = data\n    mu.Unlock()\n}\n</code></pre>\n\n<p>Another, more sophisticated solution would be to use server side HTTP sessions. For details, see <a href=\"https://stackoverflow.com/questions/10925103/go-session-variables/35292106#35292106\">Go session variables?</a></p>\n"}], "owner": {"reputation": 245, "user_id": 7360695, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5ba260c91ea10f26485623058a28e4fc?s=128&d=identicon&r=PG&f=1", "display_name": "Battalgazi", "link": "https://stackoverflow.com/users/7360695/battalgazi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 384, "favorite_count": 0, "accepted_answer_id": 44070394, "answer_count": 1, "score": 2, "last_activity_date": 1580126391, "creation_date": 1495197400, "last_edit_date": 1495197886, "question_id": 44070323, "link": "https://stackoverflow.com/questions/44070323/server-instances-with-multiple-users", "title": "Server instances with multiple users", "body": "<p>I'm new to Go and I have the following problem. I tried to simplify it:\nI have a server which has for example a global variable <code>myvar</code>. All users can POST the endpoint <code>/step1</code> and save some data in the variable, which can be retrieved with a GET using the second endpoint <code>/step2</code>. Between these 2 calls the value of <code>myvar</code> shouldn't change for that user.</p>\n\n<p>I would like to know if there is a way to instantiate this process for every user, because I need that if one user changes the variable, it doesn't affect the other users. I don't necessarily need to use the global variable, it is just to expose what I want to do with the endpoints.</p>\n\n<p><strong>Code:</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n    \"github.com/rs/cors\"\n\n    \"fmt\"\n)\n\ntype Test struct {\n    test string `json:\"test,omitempty\"`\n}\n\nfunc main() {\n    var myvar = \"test\"\n\n    router := mux.NewRouter()\n\n    router.HandleFunc(\"/step1\", func(w http.ResponseWriter, r *http.Request) {\n        var test Test\n        _ = json.NewDecoder(r.Body).Decode(&amp;test)\n        myvar = test.test\n    })\n\n    router.HandleFunc(\"/step2\", func(w http.ResponseWriter, r *http.Request) {\n        fmt.Println(myvar)\n    })\n\n    c := cors.New(cors.Options{\n        AllowedOrigins:   []string{\"*\"},\n        AllowCredentials: true,\n        AllowedMethods:   []string{\"GET\", \"POST\", \"PUT\", \"DELETE\", \"PATCH\"},\n        AllowedHeaders:   []string{\"*\"},\n        ExposedHeaders:   []string{\"*\"},\n    })\n\n    handler := c.Handler(router)\n\n    http.ListenAndServe(\":8003\", handler)\n}\n</code></pre>\n"}, {"tags": ["go", "redis"], "comments": [{"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "edited": false, "score": 1, "creation_date": 1495209523, "post_id": 44069888, "comment_id": 75172787, "body": "I believe this line is the culprit: <a href=\"https://github.com/go-redis/redis/blob/e1263fea7be54f2d1eac6da7b4e86e623a517f4e/commands.go#L1495\" rel=\"nofollow noreferrer\">github.com/go-redis/redis/blob/&hellip;</a>. (Essentially, passing a 0 is like not passing a count at all.) I&#39;d suggest opening a task on that GitHub project if you consider this to be a bug. (In the meantime, you&#39;ll probably have to special-case 0.)"}], "owner": {"reputation": 518, "user_id": 3150716, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100002399317187/picture?type=large", "display_name": "Chirag", "link": "https://stackoverflow.com/users/3150716/chirag"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 288, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1495196205, "creation_date": 1495196205, "question_id": 44069888, "link": "https://stackoverflow.com/questions/44069888/zrevrangebyscore-function-in-golang-for-redis-giving-unexpected-result-when-coun", "title": "ZRevRangeByScore function in golang for redis giving unexpected result when count is 0", "body": "<p>I am using the following for redis client in go \n  <a href=\"https://github.com/go-redis/redis\" rel=\"nofollow noreferrer\">https://github.com/go-redis/redis</a>\nI have a problem in the below shown code snippet. </p>\n\n<pre><code>vals, err = this.Cli.ZRevRangeByScore(sortedSet, redis.ZRangeBy{\nMin:    strconv.Itoa(int(query.Since.Unix())),\nMax:    \"+inf\",\nOffset: 0,\nCount:  int64(query.maxEvents),\n}).Result()\n</code></pre>\n\n<p>Whenever my query.maxEvents is 0, instead of empty set(expected), I am getting whole set as a response(unexpected). Why is this happening ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 4, "creation_date": 1495195556, "post_id": 44069593, "comment_id": 75163167, "body": "type IP string; type Hits map[IP]uint"}, {"owner": {"reputation": 2534, "user_id": 898099, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fde4e02f49a0c28e3a287e86aec38af3?s=128&d=identicon&r=PG", "display_name": "Aleksandr Makov", "link": "https://stackoverflow.com/users/898099/aleksandr-makov"}, "reply_to_user": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1495196026, "post_id": 44069593, "comment_id": 75163482, "body": "and then <code>hits[IP{ipAddr}]++</code>? And if yes, does it allocate twice as much memory, because we create new IP each string we loop through?"}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 1, "creation_date": 1495197296, "post_id": 44069593, "comment_id": 75164360, "body": "hits[IP(&quot;127.0.0.1&quot;)]++; It&#39;s more or less idiomatic way."}, {"owner": {"reputation": 2534, "user_id": 898099, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fde4e02f49a0c28e3a287e86aec38af3?s=128&d=identicon&r=PG", "display_name": "Aleksandr Makov", "link": "https://stackoverflow.com/users/898099/aleksandr-makov"}, "reply_to_user": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1495198182, "post_id": 44069593, "comment_id": 75165000, "body": "Any ideas why it&#39;s being down-voted?"}, {"owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "edited": false, "score": 0, "creation_date": 1495198901, "post_id": 44069593, "comment_id": 75165530, "body": "welcome to stack overflow, don&#39;t take it personally if people downvote without telling you why ;-)"}, {"owner": {"reputation": 2534, "user_id": 898099, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fde4e02f49a0c28e3a287e86aec38af3?s=128&d=identicon&r=PG", "display_name": "Aleksandr Makov", "link": "https://stackoverflow.com/users/898099/aleksandr-makov"}, "reply_to_user": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "edited": false, "score": 0, "creation_date": 1495199236, "post_id": 44069593, "comment_id": 75165757, "body": "@nothingmuch thanks for the support. Yeah, it just feels like you stand there with banner &quot;help&quot; and they go and spit on you passing by.  Just because they didn&#39;t like what was on there."}, {"owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "edited": false, "score": 1, "creation_date": 1495199869, "post_id": 44069593, "comment_id": 75166211, "body": "Haters gonna hate... I personally don&#39;t think your question is lazy or somehow invalid. Arbitrary key types are mentioned in passing in the tour of go, and though defining type aliases is a common technique in go, it&#39;s not immediately obvious how these concepts connect."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1495204881, "post_id": 44069593, "comment_id": 75169744, "body": "<code>I think everything that could be written in 1 line makes you shine as professional</code>, not sure where you&#39;re coming from with that, but the Go community favors clarity over conciseness whenever possible. Saving newline characters doesn&#39;t somehow make your code better."}], "answers": [{"comments": [{"owner": {"reputation": 2534, "user_id": 898099, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fde4e02f49a0c28e3a287e86aec38af3?s=128&d=identicon&r=PG", "display_name": "Aleksandr Makov", "link": "https://stackoverflow.com/users/898099/aleksandr-makov"}, "edited": false, "score": 0, "creation_date": 1495613287, "post_id": 44073599, "comment_id": 75322011, "body": "Thank you for comprehensive answer, @Adrian. How would I go about making another grouping level? Say, first I&#39;d want to group by request date, then by request IP? Would <code>hits[Date(&quot;2017&#47;May&#47;1&quot;)][net.ParseIP(&quot;127.0.0.1&quot;)]++</code> work? Would I be able to use it without explicitly checking if <code>hits[Date(&quot;2017&#47;May&#47;1&quot;)]</code> exist first?"}, {"owner": {"reputation": 2534, "user_id": 898099, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fde4e02f49a0c28e3a287e86aec38af3?s=128&d=identicon&r=PG", "display_name": "Aleksandr Makov", "link": "https://stackoverflow.com/users/898099/aleksandr-makov"}, "edited": false, "score": 0, "creation_date": 1495613516, "post_id": 44073599, "comment_id": 75322145, "body": "Or should I define <code>type RequestGroup struct { Date string, IP net.IP }</code> and then <code>hits = make(map[ReqeustGroup]uint)</code>?"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 4, "last_activity_date": 1495206909, "creation_date": 1495206909, "answer_id": 44073599, "question_id": 44069593, "link": "https://stackoverflow.com/questions/44069593/golang-optimal-way-of-typing-associative-slices/44073599#44073599", "title": "Golang: optimal way of typing associative slices?", "body": "<p>As Uvelichitel pointed out, you can use a typed string:</p>\n\n<pre><code>type IP string\nvar hits = make(map[IP]uint)\nhits[IP(\"127.0.0.1\")]++\n</code></pre>\n\n<p>Or you could use the existing stdlib IP type:</p>\n\n<pre><code>var hits = make(map[net.IP]uint)\nhits[net.ParseIP(\"127.0.0.1\")]++\n</code></pre>\n\n<p>Either would make it clear that you're referring to IPs, without the overhead introduced by looping over a slice of structs for every increment. The latter has the advantage of giving you full stdlib support for any other IP manipulation you need to do, and a more compact representation (4 bytes for IPv4 addresses instead of a 7-15 character UTF-8 string), at the cost of parsing the strings. Which one is better will depend on your specific use case.</p>\n"}], "owner": {"reputation": 2534, "user_id": 898099, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/fde4e02f49a0c28e3a287e86aec38af3?s=128&d=identicon&r=PG", "display_name": "Aleksandr Makov", "link": "https://stackoverflow.com/users/898099/aleksandr-makov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 44073599, "answer_count": 1, "score": 1, "last_activity_date": 1495206909, "creation_date": 1495195294, "question_id": 44069593, "link": "https://stackoverflow.com/questions/44069593/golang-optimal-way-of-typing-associative-slices", "title": "Golang: optimal way of typing associative slices?", "body": "<p>I'm parsing loads of HTTP logs pursing a goal tell how many requests each IP address generated.</p>\n\n<p>The first thing I did is:</p>\n\n<pre><code>var hits = make(map[string]uint)\n\n// so I could populate it with\nhits[ipAddr]++\n</code></pre>\n\n<p>However, I would like to make it \"typed\", so that it would be immediately clear that <code>hits[string]uint</code> uses an IP address as a string identifier. I thought, well maybe a struct can help me:</p>\n\n<pre><code>type Hit struct {\n    IP    string\n    Count uint\n}\n</code></pre>\n\n<p>But that way (I think) I'm loosing the performance, because now I how to really look for specific Hit to increment it's count. I tolerate that I could be paranoid here, and could simple go for the loop:</p>\n\n<pre><code>var hits = make([]Hit)\n\n// TrackHit just damn tracks it\nfunc TrackHit(ip string) {\n    for hit, _ := range hits {\n        if hit.IP == ip {\n             hit.Count++\n             return\n        }\n    }\n\n    append(hits, Hit{\n        IP:    ip,\n        Count: 0,\n    })\n}\n</code></pre>\n\n<p>But that just looks ... suboptimal. I think everything that could be written in 1 line makes you shine as professional, and when 1 line turns into 13, I tend to feel \"whaaa? Doing something wrong here, mom?\" </p>\n\n<p>Any typed one-liners here in Go?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["google-app-engine", "go", "google-oauth", "google-admin-sdk"], "answers": [{"tags": [], "owner": {"reputation": 367, "user_id": 1075283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f0c08aacf97ba9d099e8575212681d1a?s=128&d=identicon&r=PG", "display_name": "cheeze", "link": "https://stackoverflow.com/users/1075283/cheeze"}, "is_accepted": true, "score": 0, "last_activity_date": 1496965354, "creation_date": 1496965354, "answer_id": 44447165, "question_id": 44069432, "link": "https://stackoverflow.com/questions/44069432/user-impersonation-with-service-account-using-application-default-credentials/44447165#44447165", "title": "User Impersonation with Service Account using Application Default Credentials", "body": "<p>It seems that for the Admin SDK I need to ask for the user (the administrator) permissions to access the Directory API. This is quite different from the other APIs where I simply just set the user email address to access the specified user's data.</p>\n\n<p>It's understandable I guess since the Admin SDK is a far more powerful API affecting the domain and not just the individual user.</p>\n"}, {"tags": [], "owner": {"reputation": 363, "user_id": 2656351, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2145f303214260c85edc32b3f701dd9d?s=128&d=identicon&r=PG", "display_name": "iamacarpet", "link": "https://stackoverflow.com/users/2656351/iamacarpet"}, "is_accepted": false, "score": 0, "last_activity_date": 1524841278, "creation_date": 1524841278, "answer_id": 50065197, "question_id": 44069432, "link": "https://stackoverflow.com/questions/44069432/user-impersonation-with-service-account-using-application-default-credentials/50065197#50065197", "title": "User Impersonation with Service Account using Application Default Credentials", "body": "<p>Just come across this same problem today, but using 3-pronged OAuth2 wasn't really feasible, as we didn't want to alter the directory using the API, but rather check group membership for users who signed in via the App Engine Users API.</p>\n\n<p>That led me to create this library: <a href=\"https://github.com/iamacarpet/go-gae-dwd-tokensource\" rel=\"nofollow noreferrer\">https://github.com/iamacarpet/go-gae-dwd-tokensource</a></p>\n\n<p>It creates a custom JWT that supports impersonation, signs it with the default service account using the built in functionality, then fires it across to the token endpoint to get an access_token.</p>\n\n<p>It isn't as efficient as the default function to get an access token, but in my testing, it was ~20ms latency vs ~450ms for a group membership check, so it wasn't an issue.</p>\n\n<p>I've included an example of using it in a negroni middleware on the GitHub page.</p>\n"}], "owner": {"reputation": 367, "user_id": 1075283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f0c08aacf97ba9d099e8575212681d1a?s=128&d=identicon&r=PG", "display_name": "cheeze", "link": "https://stackoverflow.com/users/1075283/cheeze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 808, "favorite_count": 0, "accepted_answer_id": 44447165, "answer_count": 2, "score": 0, "last_activity_date": 1524841278, "creation_date": 1495194811, "question_id": 44069432, "link": "https://stackoverflow.com/questions/44069432/user-impersonation-with-service-account-using-application-default-credentials", "title": "User Impersonation with Service Account using Application Default Credentials", "body": "<p>I'm trying to use a service account with domain-wide delegation (DwD) on an App Engine deployment with Go.</p>\n\n<p>I've followed the steps for using <a href=\"http://developers.google.com/identity/protocols/application-default-credentials\" rel=\"nofollow noreferrer\" title=\"Google Application Default Credentials\">Google Application Default Credentials</a> to use a service account with App Engine.</p>\n\n<p>I got the code running locally on my dev machine but I'm stuck at retrieving the actual data from my domain.</p>\n\n<p>I'm using the <a href=\"https://developers.google.com/admin-sdk/directory/v1/guides/delegation\" rel=\"nofollow noreferrer\">Admin SDK</a>. Under the section <a href=\"https://developers.google.com/admin-sdk/directory/v1/guides/delegation#delegate_domain-wide_authority_to_your_service_account\" rel=\"nofollow noreferrer\">Delegate domain-wide authority to your service account</a>, it says that my \"service account needs to impersonate one of those users to access the Admin SDK Directory API\".</p>\n\n<p>I've looked through the documentation for Go on using service account and user impersonation, AND I've also pored through the source code. Nowhere does it indicate where I can enter the user's email address/identity to impersonate.</p>\n\n<p>Here is the error that I got:</p>\n\n<pre><code>googleapi: Error 404: Domain not found., notFound\n</code></pre>\n\n<p>The source code does show some clue but I faced other obstacles when trying to use something other than the Application Default Credentials.</p>\n\n<p>Does anyone have any idea? Thanks in advance.</p>\n"}, {"tags": ["go", "proxy", "vpn", "cloud-foundry", "beego"], "comments": [{"owner": {"reputation": 1425, "user_id": 1227328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/628ba352b64ac4e6c4330af81ad71c6d?s=128&d=identicon&r=PG", "display_name": "dkoper", "link": "https://stackoverflow.com/users/1227328/dkoper"}, "edited": false, "score": 0, "creation_date": 1495199638, "post_id": 44067956, "comment_id": 75166040, "body": "When you say <code>unable to get the JSON response</code>, what response are you getting? An HTTP error code/message? Or a TLS error from the golang dialer?   Is the domain of your endpoint really <code>https:&#47;&#47;getJSONResponse</code>?"}, {"owner": {"reputation": 1425, "user_id": 1227328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/628ba352b64ac4e6c4330af81ad71c6d?s=128&d=identicon&r=PG", "display_name": "dkoper", "link": "https://stackoverflow.com/users/1227328/dkoper"}, "edited": false, "score": 0, "creation_date": 1495199736, "post_id": 44067956, "comment_id": 75166120, "body": "As you are using https, there would be validation of its certificate. Golang defaults to a platform specific truststore to look for CA certificates. Locally it could have the right CA cert, in the CF container it does not, and Beego could be skipping SSL validation?"}, {"owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "reply_to_user": {"reputation": 1425, "user_id": 1227328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/628ba352b64ac4e6c4330af81ad71c6d?s=128&d=identicon&r=PG", "display_name": "dkoper", "link": "https://stackoverflow.com/users/1227328/dkoper"}, "edited": false, "score": 0, "creation_date": 1495238934, "post_id": 44067956, "comment_id": 75184856, "body": "It is giving me a 502 Bad Gateway error message, as if I was accessing the URL outside my company&#39;s VPN. Also, <code>https:&#47;&#47;getJSONResponse</code> is just a placeholder URL because client protection and all that.  (EDIT: I also added the error message I am getting to my question.)"}, {"owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "reply_to_user": {"reputation": 1425, "user_id": 1227328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/628ba352b64ac4e6c4330af81ad71c6d?s=128&d=identicon&r=PG", "display_name": "dkoper", "link": "https://stackoverflow.com/users/1227328/dkoper"}, "edited": false, "score": 0, "creation_date": 1495246930, "post_id": 44067956, "comment_id": 75186090, "body": "I changed the placeholder URL to <code>https:&#47;&#47;mysite&#47;getJSONResponse</code> to avoid confusion. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "is_accepted": true, "score": 0, "last_activity_date": 1495419705, "last_edit_date": 1495419705, "creation_date": 1495366618, "answer_id": 44096394, "question_id": 44067956, "link": "https://stackoverflow.com/questions/44067956/golang-dialer-in-cloud-foundry/44096394#44096394", "title": "Golang Dialer in Cloud Foundry", "body": "<p>I finally managed to get it to work using only the <code>beego/httplib</code> package, so there was no need to integrate the entire Beego framework (thank goodness). Here is my code:</p>\n\n<pre><code>import (\n    \"github.com/astaxie/beego/httplib\"\n)\n\n-----------------------------------------------------\n\nreq := httplib.Post(\"https://mysite/getJSONResponse\")\nreq.Header(\"myHeader\", \"myHeaderValue\")\n\nstr, err := req.String()\n\nif err == nil {\n    strBytes := []byte(str)\n    // Do something with the JSON response.\n}\n</code></pre>\n\n<p>I do not have time to investigate what makes the <code>httplib</code> package work, although I <em>have</em> seen that it only uses the Standard Library to Dial the appropriate connections to make Requests. Could somebody help shed some light on this?</p>\n\n<p>EDIT: I see that it uses the <code>crypto/tls</code> package's <code>*tls.Config</code> to set up a connection with the appropriate Certificates. This may be how it makes Requests that connect to our VPN.</p>\n"}], "owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "accepted_answer_id": 44096394, "answer_count": 1, "score": -1, "last_activity_date": 1495419705, "creation_date": 1495190471, "last_edit_date": 1495419196, "question_id": 44067956, "link": "https://stackoverflow.com/questions/44067956/golang-dialer-in-cloud-foundry", "title": "Golang Dialer in Cloud Foundry", "body": "<p>I am trying to access a URL that gives me a JSON response, and said URL is only accessible when I am connected to my company's VPN.</p>\n\n<p>Using the Standard Golang Library, the code below is getting an error even when I am connected to my company's VPN:</p>\n\n<pre><code>myClient := &amp;http.Client{}\nreq, err := http.NewRequest(\"POST\", \"https://mysite/getJSONResponse\", nil)    \nreq.Header.Add(\"myHeader\", \"myHeaderValue\")\nresp, err := myClient.Do(req)\n</code></pre>\n\n<p>Here is the error I am getting:</p>\n\n<pre><code>502 Bad Gateway: Registered endpoint failed to handle the request.\n</code></pre>\n\n<p>However, this code (also from the Standard Library) is able to get the JSON response when I am connected to my company's VPN:</p>\n\n<pre><code>envDialer := proxy.FromEnvironment()    \nmyTransport := &amp;http.Transport{Dial: envDialer.Dial}\nmyClient := &amp;http.Client{Transport: myTransport}\nreq, err := http.NewRequest(\"POST\", \"https://mysite/getJSONResponse\", nil)\nreq.Header.Add(\"myHeader\", \"myHeaderValue\")\nresp, err := myClient.Do(req)\n</code></pre>\n\n<p>My problem is that when I push the working code to Cloud Foundry (which is also connected to my company's VPN), my code is getting the below error instead:</p>\n\n<pre><code>Post https://mysite/getJSONResponse: read tcp 10.254.2.182:45320-&gt;165.156.25.94:443:\nread: connection reset by peer\n</code></pre>\n\n<p>It is as if the code is unable to connect to my company's VPN even when it is already Pushed to Cloud Foundry, which is why the URL refused to give the JSON response.</p>\n\n<p>However, when I try to access the same URL in Cloud Foundry with a test Web Application that uses the Beego framework, it is able to get the JSON response just fine.</p>\n\n<p>I should mention that the Beego version works even when the http_proxy, https_proxy, and no_proxy environment variables are not set:</p>\n\n<pre><code>req := httplib.Post(\"https://mysite/getJSONResponse\")\nreq.Header(\"myHeader\", \"myHeaderValue\")\n\nstr, err := req.String()\nif err != nil {\n    fmt.Println(err)\n}\n\nbeego.Info(str)\nu.Data[\"json\"] = str\nu.ServeJSON()\n</code></pre>\n\n<p>My questions are:</p>\n\n<ol>\n<li><p>Why is the second Standard Library code working fine locally, but not when Pushed to Cloud Foundry?</p></li>\n<li><p>What is the Beego framework doing behind the scenes that lets it connect to my company's VPN over at Cloud Foundry, and can the same be done with the Standard Library?</p></li>\n</ol>\n\n<p>I've got a feeling Beego is doing something to its Proxy/Port settings to enable it to connect to our company's VPN.</p>\n\n<p>I really don't want to have to integrate our back-end codes with the Beego framework just to connect to our company's VPN. I must be missing something really simple which can be done with the Standard Library. Any ideas?</p>\n"}, {"tags": ["file", "go", "replace"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1495208392, "post_id": 44068892, "comment_id": 75172107, "body": "Scanner &amp; Split both good options, I&#39;d also add regexp as a potential solution, though regexp performance in Go is unfortunately poor due to UTF-8 handling."}, {"owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1495209749, "post_id": 44068892, "comment_id": 75172928, "body": "Well, regexps have the additional advantage of taking care of the substitution logic, I didn&#39;t reach for that here because it seemed to me like the data in between the delimiters would need some processing, but reading the question more carefully it doesn&#39;t actually say that =)"}, {"owner": {"reputation": 459, "user_id": 2510591, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4b15506108e1cf337adccce77602d51?s=128&d=identicon&r=PG", "display_name": "joseluisq", "link": "https://stackoverflow.com/users/2510591/joseluisq"}, "edited": false, "score": 0, "creation_date": 1495210512, "post_id": 44068892, "comment_id": 75173321, "body": "Yep, I&#39;m a beginner  in Go. In fact I thought in Regex (more &quot;easy&quot; to implement) but then I thought in its performance with large files. Although 3Mb (or 10Mb) is not a problem for Go apparently. :D"}, {"owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "edited": false, "score": 0, "creation_date": 1495211269, "post_id": 44068892, "comment_id": 75173724, "body": "Go is a really nice mix of the features from dynamic languages that really make a difference, but most of the precision and directness of C, it&#39;s a great language for this kind of task. Easy things are easy, and it&#39;s usually very easy to optimize aggressively when the need actually arises."}, {"owner": {"reputation": 459, "user_id": 2510591, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4b15506108e1cf337adccce77602d51?s=128&d=identicon&r=PG", "display_name": "joseluisq", "link": "https://stackoverflow.com/users/2510591/joseluisq"}, "edited": false, "score": 0, "creation_date": 1495213483, "post_id": 44068892, "comment_id": 75174865, "body": "Yeah, you right! I came from dynamic scripting language like javascript  (node.js) but I should say that my first experience with Go is a very comfortable experience."}, {"owner": {"reputation": 459, "user_id": 2510591, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4b15506108e1cf337adccce77602d51?s=128&d=identicon&r=PG", "display_name": "joseluisq", "link": "https://stackoverflow.com/users/2510591/joseluisq"}, "edited": false, "score": 0, "creation_date": 1495274157, "post_id": 44068892, "comment_id": 75191515, "body": "@nothingmuch I found this issue with <code>Scanner</code> <a href=\"http://stackoverflow.com/a/41741702/2510591\">stackoverflow.com/a/41741702/2510591</a> What do you think about?"}], "tags": [], "owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "is_accepted": true, "score": 5, "last_activity_date": 1495193342, "creation_date": 1495193342, "answer_id": 44068892, "question_id": 44067829, "link": "https://stackoverflow.com/questions/44067829/how-to-efficiently-replace-strings-occurrences-between-two-strings-delimiters-us/44068892#44068892", "title": "How to efficiently replace strings occurrences between two strings delimiters using Go bytes?", "body": "<p>You can use <a href=\"https://golang.org/pkg/bufio/#Scanner\" rel=\"noreferrer\"><code>bufio.Scanner</code></a> with  <a href=\"https://golang.org/pkg/bufio/#ScanWords\" rel=\"noreferrer\"><code>bufio.ScanWords</code></a>, tokenize on whitespace boundaries, and compare non-whitespace sequences to your delimiter:</p>\n\n<pre><code>scanner := bufio.NewScanner(reader)\n\nscanner.Split(bufio.ScanWords) // you can implement your own split function\n                               // but ScanWords will suffice for your example\n\nfor scanner.Scan() {\n    // scanner.Bytes() efficiently exposes the file contents\n    // as slices of a larger buffer\n    if bytes.HasPrefix(scanner.Bytes(), []byte(\"START\")) {\n        ... // keep scanning until the end delimiter\n    }\n\n    // copying unmodified inputs is quite simple:\n    _, err := writer.Write( scanner.Bytes() )\n    if err != nil {\n        return err\n    }\n}\n</code></pre>\n\n<p>This will ensure that the amount of data read in from the file remains bounded (this is controlled by <code>MaxScanTokenSize</code>)</p>\n\n<p>Note that if you want to use multiple goroutines, you'll need to copy the data first, since <code>scanner.Bytes()</code> returns a slice that is only valid until the next call to <code>.Scan()</code>, but if you choose to do that then I wouldn't bother with a scanner.</p>\n\n<p>For what it's worth, a 3MB size file is actually not such a bad idea to load on a general purpose computer nowadays, I would only think twice if it was an order of magnitude bigger. It would almost certainly be faster to use <code>bytes.Split</code> with your delimiters.</p>\n"}], "owner": {"reputation": 459, "user_id": 2510591, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4b15506108e1cf337adccce77602d51?s=128&d=identicon&r=PG", "display_name": "joseluisq", "link": "https://stackoverflow.com/users/2510591/joseluisq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 1, "accepted_answer_id": 44068892, "answer_count": 1, "score": 1, "last_activity_date": 1495193342, "creation_date": 1495190139, "question_id": 44067829, "link": "https://stackoverflow.com/questions/44067829/how-to-efficiently-replace-strings-occurrences-between-two-strings-delimiters-us", "title": "How to efficiently replace strings occurrences between two strings delimiters using Go bytes?", "body": "<p>How to efficiently replace strings occurrences between two strings delimiters using Go bytes?</p>\n\n<p>For example my flat file (3Mb) content is similar to:</p>\n\n<pre><code>Lorem START ipsum END dolor sit amet, START adipiscing END elit.\nIpsum dolor START sit END amet, START elit. END\n.....\n</code></pre>\n\n<p>I would like to replace all ocurrencies between <code>START</code> and <code>END</code> delimiters. Like my file size is 3Mb it's bad idea to load whole content in memory.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["google-chrome", "go", "testing", "chromedp"], "answers": [{"comments": [{"owner": {"reputation": 341, "user_id": 5422437, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77226afed3d2a4b15ac4400148e0f9c2?s=128&d=identicon&r=PG&f=1", "display_name": "Zhivko.Kostadinov", "link": "https://stackoverflow.com/users/5422437/zhivko-kostadinov"}, "edited": false, "score": 0, "creation_date": 1527859964, "post_id": 44073435, "comment_id": 88299551, "body": "Yes, it&#39;s works, BUT you must remove chromedp.Shutdown() and chromedp.Wait() when using headless options from your tear down step."}], "tags": [], "owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "is_accepted": true, "score": 7, "last_activity_date": 1495206406, "creation_date": 1495206406, "answer_id": 44073435, "question_id": 44067030, "link": "https://stackoverflow.com/questions/44067030/how-to-use-chrome-headless-with-chromedp/44073435#44073435", "title": "How to use Chrome headless with chromedp?", "body": "<p>Find It. I do</p>\n\n<pre><code>c, err := cdp.New(ctxt, cdp.WithRunnerOptions(\n   runner.Flag(\"headless\", true),\n   runner.Flag(\"disable-gpu\", true)))\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 142, "user_id": 2115689, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c84a084ef0c77dbcca4d7b67702d0896?s=128&d=identicon&r=PG", "display_name": "Nagendran", "link": "https://stackoverflow.com/users/2115689/nagendran"}, "is_accepted": false, "score": 6, "last_activity_date": 1572617398, "creation_date": 1572617398, "answer_id": 58660646, "question_id": 44067030, "link": "https://stackoverflow.com/questions/44067030/how-to-use-chrome-headless-with-chromedp/58660646#58660646", "title": "How to use Chrome headless with chromedp?", "body": "<p>In the latest version of chromedp, by default the headless mode is true, if you want to change then refer the below snippet</p>\n\n<pre><code>opts := append(chromedp.DefaultExecAllocatorOptions[:],\n    chromedp.Flag(\"headless\", false),\n    chromedp.Flag(\"disable-gpu\", false),\n    chromedp.Flag(\"enable-automation\", false),\n    chromedp.Flag(\"disable-extensions\", false),\n)\n\nallocCtx, cancel := chromedp.NewExecAllocator(context.Background(), opts...)\ndefer cancel()\n\n// create context\nctx, cancel := chromedp.NewContext(allocCtx, chromedp.WithLogf(log.Printf))\ndefer cancel()\n\nif err := chromedp.Run(ctx,\n    chromedp.Navigate(`https://www.google.com/`),\n); err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4761, "favorite_count": 1, "accepted_answer_id": 44073435, "answer_count": 2, "score": 2, "last_activity_date": 1572617398, "creation_date": 1495188001, "last_edit_date": 1571731541, "question_id": 44067030, "link": "https://stackoverflow.com/questions/44067030/how-to-use-chrome-headless-with-chromedp", "title": "How to use Chrome headless with chromedp?", "body": "<p>I'm using <a href=\"https://github.com/knq/chromedp\" rel=\"nofollow noreferrer\">chromedp</a>, which has features to focus on elements, fill in text, etc. Chrome 59 has cross-platform headless support. It allows running Chrome in a headless/server environment. To use via the DevTools remote debugging protocol, start a normal Chrome binary with the --headless command line flag (Linux-only for now):</p>\n\n<blockquote>\n  <p>$ google-chrome --headless --disable-gpu --remote-debugging-port=9222 <a href=\"https://www.google.fr\" rel=\"nofollow noreferrer\">https://www.google.fr</a></p>\n</blockquote>\n\n<p>How can I tell <code>chromedp</code> to send the --headless flag, along with other flags?</p>\n"}, {"tags": ["go", "io", "byte", "reader"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 5, "creation_date": 1495185387, "post_id": 44065935, "comment_id": 75156158, "body": "What is unclear about the error message? A []byte does not implement the Read method of an io.Reader, therefore it cannot be used as an io.Reader. Please work through the Methods and Interfaces chapter of the Tour of Go (starting here: <a href=\"https://tour.golang.org/methods/1\" rel=\"nofollow noreferrer\">tour.golang.org/methods/1</a>)"}, {"owner": {"reputation": 251, "user_id": 7923990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ad61ca14b98f6cde3a7109b252c544c?s=128&d=identicon&r=PG&f=1", "display_name": "icarbajo", "link": "https://stackoverflow.com/users/7923990/icarbajo"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1495186006, "post_id": 44065935, "comment_id": 75156594, "body": "I know that the message is clear but if I ask this it&#39;s because I don&#39;t understand (and I have read the tour...) the difference between <code>buff := make([]byte)</code> and the Read method <code>Read (p []byte)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 251, "user_id": 7923990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ad61ca14b98f6cde3a7109b252c544c?s=128&d=identicon&r=PG&f=1", "display_name": "icarbajo", "link": "https://stackoverflow.com/users/7923990/icarbajo"}, "edited": false, "score": 0, "creation_date": 1495200134, "post_id": 44070040, "comment_id": 75166413, "body": "Thank you so much! @eugenioy"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 15, "last_activity_date": 1495196596, "creation_date": 1495196596, "answer_id": 44070040, "question_id": 44065935, "link": "https://stackoverflow.com/questions/44065935/cannot-use-type-byte-as-type-io-reader/44070040#44070040", "title": "Cannot use (type []byte) as type io.Reader", "body": "<p>I think you are missing a step in your logic when you think that <code>[]byte</code> would be equivalent to <code>Reader</code> just because the Reader's <code>Read</code> method receives a <code>[]byte</code> as a parameter.</p>\n\n<p>Let me try to clarify:</p>\n\n<p>Your <code>ReceiveSnapshot</code> function expects a <code>Reader</code> as a parameter:</p>\n\n<pre><code>ReceiveSnapshot( input io.Reader ...\n</code></pre>\n\n<p>In order for a type to fulfil the <code>Reader</code> interface, that type should itself implement this function:</p>\n\n<pre><code>Read(p []byte) (n int, err error)\n</code></pre>\n\n<p>Note that the type should <em>implement</em> that function in order to be a <code>Reader</code>.</p>\n\n<p><code>[]byte</code> <em>does not implement</em> a <code>Read</code> function. It is just a coincidence that the argument to <code>Read</code> happens to be a <code>[]byte</code>.</p>\n\n<p>In order for this to work, you need to send <code>ReceiveSnapshot</code> a proper <code>Reader</code>.</p>\n\n<p>Luckily for you, having a <code>[]byte</code> and wanting to Read for it is a common situation so the API provides an easy way to do this:</p>\n\n<p><a href=\"https://golang.org/pkg/bytes/#NewReader\" rel=\"noreferrer\">https://golang.org/pkg/bytes/#NewReader</a></p>\n\n<p>You just need to send <code>bytes.NewReader(buff)</code> to your <code>ReceiveSnapshot</code> function instead of just <code>buff</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "is_accepted": false, "score": 3, "last_activity_date": 1566351391, "creation_date": 1566351391, "answer_id": 57583377, "question_id": 44065935, "link": "https://stackoverflow.com/questions/44065935/cannot-use-type-byte-as-type-io-reader/57583377#57583377", "title": "Cannot use (type []byte) as type io.Reader", "body": "<p><strong>Short answer</strong>: Wrap your buffer in a <a href=\"https://tour.golang.org/methods/21\" rel=\"nofollow noreferrer\">Reader</a> type by using <a href=\"https://golang.org/pkg/bytes/#NewReader\" rel=\"nofollow noreferrer\"><code>bytes.NewReader</code></a></p>\n\n<p>Alternatively, you could use <a href=\"https://golang.org/pkg/bytes/#NewBuffer\" rel=\"nofollow noreferrer\"><code>bytes.NewBuffer</code></a> with similar effect.</p>\n\n<p>If the source is a string, you can use <a href=\"https://golang.org/pkg/strings/#NewReader\" rel=\"nofollow noreferrer\"><code>strings.NewReader</code></a>.</p>\n\n<p>The list of Readers goes on and on: <a href=\"https://golang.org/search?q=Read#Global\" rel=\"nofollow noreferrer\">https://golang.org/search?q=Read#Global</a></p>\n\n<hr>\n\n<h2>Explanation of the deeper question</h2>\n\n<p><em>The deeper question being: Why doesn't an array support the <code>io.Reader</code> interface directly?</em></p>\n\n<p><code>io.Reader</code> supports the concept of reading from a general data stream for which <strong>the total size is not necessarily known in advance</strong>.  In order to support this, <code>Read</code> is called repeatedly until all input data is exhausted.  In many languages, similar read functions must be called at least twice, where the final call returns a flag indicating <em>end-of-file</em>.</p>\n\n<p>By returning two values (one of which is type <a href=\"https://golang.org/pkg/builtin/#error\" rel=\"nofollow noreferrer\"><code>error</code></a>), Go makes it possible for reading of arrays to complete in one-shot, <em>but only if the destination buffer is large enough to consume all available data</em> -- which isn't always known in advance.</p>\n\n<p>The <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\"><code>io.Reader</code></a> interface specifies the signature and behavior of the <code>Read()</code> function:</p>\n\n<pre><code>func (T) Read(b []byte) (n int, err error)\n</code></pre>\n\n<blockquote>\n  <p>Read populates the given byte slice with data and returns the number of bytes populated and an error value. It returns an io.EOF error when the stream ends.</p>\n</blockquote>\n\n<p>So due to the way the <code>io.Reader</code> interface works, a simple byte buffer is not capable of implementing it.  A wrapper structure is required in order to remember the state between subsequent calls to <code>Read()</code>.</p>\n\n<p>For the sake of interest, here's an example showing how that can be implemented...</p>\n\n<pre><code>type MyReader struct {\n    src []byte\n    pos int\n}\n\nfunc (r *MyReader) Read(dst []byte) (n int, err error) {\n    n = copy(dst, r.src[r.pos:])\n    r.pos += n\n    if r.pos == len(r.src) {\n        return n, io.EOF\n    }\n    return\n}\n\nfunc NewMyReader(b []byte) *MyReader { return &amp;MyReader{b, 0} }\n</code></pre>\n\n<p><em>Notice, also, that the <code>[]byte</code> parameter to <code>Read()</code> is the destination buffer, not the source.</em></p>\n"}], "owner": {"reputation": 251, "user_id": 7923990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ad61ca14b98f6cde3a7109b252c544c?s=128&d=identicon&r=PG&f=1", "display_name": "icarbajo", "link": "https://stackoverflow.com/users/7923990/icarbajo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16333, "favorite_count": 3, "accepted_answer_id": 44070040, "answer_count": 2, "score": 8, "last_activity_date": 1566351391, "creation_date": 1495185062, "question_id": 44065935, "link": "https://stackoverflow.com/questions/44065935/cannot-use-type-byte-as-type-io-reader", "title": "Cannot use (type []byte) as type io.Reader", "body": "<p>I don't understand the error, this is my main.go that I execute in the machine \"A\":</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"os\"\n    \"github.com/mistifyio/go-zfs\"\n)\n\nfunc main() {\n    // Listen for incoming connections.\n    l, err := net.Listen(\"tcp\", \"192.168.99.5:9977\")\n    if err != nil ...\n    // Close the listener when the application closes.\n    defer l.Close()\n    fmt.Println(\"Listening on \" + CONN_HOST + \":\" + CONN_PORT)\n    for {\n        // Listen for an incoming connection.\n        conn, err := l.Accept()\n        if err != nil ...\n\n        //Handle connections in a new goroutine.\n        go handleRequest(conn)\n    }\n}\n\n// Handles incoming requests.\nfunc handleRequest(conn net.Conn) {\n    // Make a buffer to hold incoming data.\n    buff := make([]byte, 1024)\n    // Read the incoming connection into the buffer.\n    _, err := conn.Read(buff)\n    if err != nil {\n        fmt.Printf(\"Error reading: %s.\\n\", err.Error())\n    }\n    // ReceiveSnapshot\n    ds, err := zfs.ReceiveSnapshot(buff, \"tank/replication\")\n    if err != nil {\n        fmt.Printf(\"Error receiving: %s.\\n\", err.Error())\n    }\n    fmt.Printf(\"%s... done!\\n\", ds)\n    // Send a response back to person contacting us.\n    conn.Write([]byte(\"Received!\"))\n    // Close the connection when you're done with it.\n    conn.Close()\n}\n</code></pre>\n\n<p>Now, I show you the function ReceiveSnapshot from github.com/mistifyio/go-zfs/zfs.go:</p>\n\n<pre><code>type command struct {\n    Command string\n    Stdin   io.Reader\n    Stdout  io.Writer\n}\n\nfunc ReceiveSnapshot(input io.Reader, name string) (*Dataset, error) {\n    c := command{Command: \"zfs\", Stdin: input}\n    _, err := c.Run(\"receive\", name)\n    if err != nil {\n        return nil, err\n    }\n    return GetDataset(name)\n}\n</code></pre>\n\n<p>I have seen in golang pkg the doc of io.Reader:</p>\n\n<pre><code>type Reader interface {\n        Read(p []byte) (n int, err error)\n}\n</code></pre>\n\n<p>Why do I receive the error...</p>\n\n<ul>\n<li>cannot use buff (type []byte) as type io.Reader in argument to zfs.ReceiveSnapshot:\n[]byte does not implement io.Reader (missing Read method)</li>\n</ul>\n\n<p>...when I make <code>go install</code> ?</p>\n"}, {"tags": ["go", "profiling"], "answers": [{"tags": [], "owner": {"reputation": 1012, "user_id": 1812225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f4353e2db7dca0676814e41a0582980?s=128&d=identicon&r=PG", "display_name": "let4be", "link": "https://stackoverflow.com/users/1812225/let4be"}, "is_accepted": false, "score": 1, "last_activity_date": 1495184968, "creation_date": 1495184968, "answer_id": 44065908, "question_id": 44065511, "link": "https://stackoverflow.com/questions/44065511/golang-no-debug-pprof-profile-endpoint-for-cpu-while-having-everything-else/44065908#44065908", "title": "golang no /debug/pprof/profile endpoint for cpu while having everything else", "body": "<p>Found it, I didn't register all the handlers as done in init here\n<a href=\"https://golang.org/src/net/http/pprof/pprof.go\" rel=\"nofollow noreferrer\">https://golang.org/src/net/http/pprof/pprof.go</a></p>\n"}, {"tags": [], "owner": {"reputation": 129, "user_id": 448266, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce973d04c8a663398081f5f440344518?s=128&d=identicon&r=PG", "display_name": "Bondhan Novandy", "link": "https://stackoverflow.com/users/448266/bondhan-novandy"}, "is_accepted": false, "score": 0, "last_activity_date": 1544686739, "creation_date": 1544686739, "answer_id": 53757071, "question_id": 44065511, "link": "https://stackoverflow.com/questions/44065511/golang-no-debug-pprof-profile-endpoint-for-cpu-while-having-everything-else/53757071#53757071", "title": "golang no /debug/pprof/profile endpoint for cpu while having everything else", "body": "<p>I stumbled the same error as you, I had registered all according to the documentation. In case anyone faced the same problem, it turned out that you need to add <code>http.DefaultServeMux</code>, so the complete lines should be:</p>\n\n<blockquote>\n<pre><code>  r := mux.NewRouter()\n\n  r.PathPrefix(\"/debug/\").Handler(http.DefaultServeMux)\n\n  r.HandleFunc(\"/debug/pprof/\", pprof.Index)\n  r.HandleFunc(\"/debug/pprof/cmdline\", pprof.Cmdline)\n  r.HandleFunc(\"/debug/pprof/profile\", pprof.Profile)\n  r.HandleFunc(\"/debug/pprof/symbol\", pprof.Symbol)\n  r.HandleFunc(\"/debug/pprof/trace\", pprof.Trace)\n</code></pre>\n</blockquote>\n\n<p>reference is <a href=\"https://stackoverflow.com/a/52729856/448266\">here</a></p>\n"}], "owner": {"reputation": 1012, "user_id": 1812225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f4353e2db7dca0676814e41a0582980?s=128&d=identicon&r=PG", "display_name": "let4be", "link": "https://stackoverflow.com/users/1812225/let4be"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 959, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1544686739, "creation_date": 1495183885, "last_edit_date": 1495184192, "question_id": 44065511, "link": "https://stackoverflow.com/questions/44065511/golang-no-debug-pprof-profile-endpoint-for-cpu-while-having-everything-else", "title": "golang no /debug/pprof/profile endpoint for cpu while having everything else", "body": "<p>I'm quite puzzled by a problem that I can't profile my golang program, I have all other endpoints under /debug/pprof but not /debug/pprof/profile for CPU profiling\nHave anyone ever stumbled across such issue?</p>\n\n<pre><code>go tool pprof http://localhost:7778/debug/pprof/profile\nFetching profile from http://localhost:7778/debug/pprof/profile\nPlease wait... (30s)\nserver response: 404 Not Found\n</code></pre>\n\n<p>while </p>\n\n<pre><code>/debug/pprof/\n\nprofiles:\n19  block\n31  goroutine\n10  heap\n0   mutex\n11  threadcreate\n\nfull goroutine stack dump\n</code></pre>\n\n<p>I setup profiling in this way</p>\n\n<pre><code>r := http.NewServeMux()\nr.Handle(\"/debug/pprof/\", http.HandlerFunc(pprof.Index))\n</code></pre>\n\n<p>What can be the cause?</p>\n\n<p>Updated: running </p>\n\n<pre><code>http.ListenAndServe(\"localhost:4444\", nil)\n</code></pre>\n\n<p>(i.e. starting default http server) fixes the problem for my custom endpoint</p>\n"}, {"tags": ["go", "http-headers", "httpresponse", "content-encoding"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1495208594, "post_id": 44064935, "comment_id": 75172226, "body": "It&#39;s possible that Uber&#39;s API is clever enough to only include the Content-Encoding header if the requester accepts gzip, but not actually clever enough <i>not to gzip the response</i> when they don&#39;t accept gzip. This would definitely be a defect on Uber&#39;s end if it&#39;s the case."}, {"owner": {"reputation": 3410, "user_id": 3570517, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/9n356.jpg?s=128&g=1", "display_name": "Abdul Wasae", "link": "https://stackoverflow.com/users/3570517/abdul-wasae"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1495210610, "post_id": 44064935, "comment_id": 75173379, "body": "But at same time, they are stubborn enough to give me gzip-ped response whether or not i ask them to"}], "tags": [], "owner": {"reputation": 3410, "user_id": 3570517, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/9n356.jpg?s=128&g=1", "display_name": "Abdul Wasae", "link": "https://stackoverflow.com/users/3570517/abdul-wasae"}, "is_accepted": true, "score": 0, "last_activity_date": 1495182100, "creation_date": 1495182100, "answer_id": 44064935, "question_id": 44064556, "link": "https://stackoverflow.com/questions/44064556/detect-gzip-encoding-to-manually-decompress-response-but-content-encoding-hea/44064935#44064935", "title": "Detect gzip encoding to manually decompress response, but &#39;Content-Encoding&#39; header missing", "body": "<p>I gave in to the stubbornness of the uber api and added another request header, <code>req.Header.Add(\"Accept-Encoding\", \"gzip\")</code>. </p>\n\n<p>Now i am getting the response header <code>\"Content-Encoding\": \"gzip\"</code>, although i am still getting an undecipherable response body, but that's beyond the scope of this question.</p>\n"}], "owner": {"reputation": 3410, "user_id": 3570517, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/9n356.jpg?s=128&g=1", "display_name": "Abdul Wasae", "link": "https://stackoverflow.com/users/3570517/abdul-wasae"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1254, "favorite_count": 1, "accepted_answer_id": 44064935, "answer_count": 1, "score": 1, "last_activity_date": 1577576315, "creation_date": 1495180665, "last_edit_date": 1577576315, "question_id": 44064556, "link": "https://stackoverflow.com/questions/44064556/detect-gzip-encoding-to-manually-decompress-response-but-content-encoding-hea", "title": "Detect gzip encoding to manually decompress response, but &#39;Content-Encoding&#39; header missing", "body": "<p>I am using <code>net/http</code> library in 'Go' to make an <code>HTTP GET</code> request. In the response, i get 12 headers. But when i run the exact same query through postman, i get 16 headers. One of those missing is 'Content-Encoding'. I understand this must be a <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS\" rel=\"nofollow noreferrer\">CORS</a> issue.</p>\n\n<p>But since i have not set the header <code>Accept-Encoding: gzip</code> in my request, and i am still getting the gzip encoding in response, the Go transport is not <a href=\"https://github.com/golang/go/issues/13298\" rel=\"nofollow noreferrer\">automatically decompressing the response for me</a>. So, i need to be able to manually detect the encoding and then decompress it. But, i cannot detect if the 'Content-Encoding' header is missing in the response. </p>\n\n<p>Here is my code where i try to do this:</p>\n\n<pre><code>func calcDistanceAndDurationWithUberApi(originLat float64, originLon float64, destinationLat float64, destinationLon float64) (float64, float64, error) {\n\n    endpoint := \"https://api.uber.com/v1.2/estimates/price\"\n    parameters := fmt.Sprintf(\"?start_latitude=%v&amp;start_longitude=%v&amp;end_latitude=%v&amp;end_longitude=%v\", originLat, originLon, destinationLat, destinationLon)\n\n    req, err := http.NewRequest(\"GET\", endpoint + parameters, nil)\n    if err != nil {\n        return 0, 0, err\n    }\n\n    req.Header.Add(\"Authorization\", \"Token \" + getUberApiKey())\n    req.Header.Add(\"Accept-Language\", \"en_US\")\n    req.Header.Add(\"Content-Type\", \"application/json\")\n\n    httpClient := &amp;http.Client{}\n    resp, err := httpClient.Do(req)\n    if err != nil {\n        return 0, 0, err\n    }\n    if resp.StatusCode != 200 {\n        return 0, 0, errors.NotFound(\"Response: %v\", resp.StatusCode)\n    }\n    defer resp.Body.Close()\n\n    pretty.Println(\"- REQUEST: \")\n    pretty.Println(req)\n\n    // Check if server sent gzipped response. Decompress if yes.\n    var respReader io.ReadCloser\n    switch resp.Header.Get(\"Content-Encoding\") {\n    case \"gzip\":\n        fmt.Println(\"Content-Encoding is gzip\")\n        respReader, err = gzip.NewReader(resp.Body)\n        defer respReader.Close()\n    default:\n        fmt.Println(\"Content-Encoding is Not gzip\")\n        respReader = resp.Body\n    }\n\n    pretty.Println(\"- RESPONSE HEADER: \")\n    pretty.Println(resp.Header)\n\n    pretty.Println(\"- RESPONSE BODY: \")\n    pretty.Println(respReader)\n\n    return 0, 0, nil\n}\n</code></pre>\n\n<p>The response status is '200 OK'. Here is the output (Response): </p>\n\n<pre><code>- RESPONSE HEADER: \nhttp.Header{\n    \"Content-Language\":          {\"en\"},\n    \"Cache-Control\":             {\"max-age=0\"},\n    \"X-Uber-App\":                {\"uberex-nonsandbox\", \"optimus\"},\n    \"Strict-Transport-Security\": {\"max-age=604800\", \"max-age=2592000\"},\n    \"X-Content-Type-Options\":    {\"nosniff\"},\n    \"Date\":                      {\"Fri, 19 May 2017 07:52:17 GMT\"},\n    \"Content-Geo-System\":        {\"wgs-84\"},\n    \"Connection\":                {\"keep-alive\"},\n    \"X-Frame-Options\":           {\"SAMEORIGIN\"},\n    \"X-Xss-Protection\":          {\"1; mode=block\"},\n    \"Server\":                    {\"nginx\"},\n    \"Content-Type\":              {\"application/json\"},\n}\n- RESPONSE BODY: \n&amp;http.gzipReader{\nbody: &amp;http.bodyEOFSignal{\n    body: &amp;http.body{\n        src: &amp;internal.chunkedReader{\n            r:  &amp;bufio.Reader{\n                buf: {0x48, 0x54, .......... }\n</code></pre>\n"}, {"tags": ["docker", "go", "development-environment"], "comments": [{"owner": {"reputation": 231, "user_id": 1702069, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/a93f16742c367cda43b4eaa04b5aa498?s=128&d=identicon&r=PG", "display_name": "ZeroHour", "link": "https://stackoverflow.com/users/1702069/zerohour"}, "edited": false, "score": 0, "creation_date": 1495178236, "post_id": 44061696, "comment_id": 75151851, "body": "Why is this getting downvoted?  Answer if you have one, don&#39;t be rude.  It is a legitimate question.  Not everyone knows everything about new tech."}], "answers": [{"comments": [{"owner": {"reputation": 231, "user_id": 1702069, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/a93f16742c367cda43b4eaa04b5aa498?s=128&d=identicon&r=PG", "display_name": "ZeroHour", "link": "https://stackoverflow.com/users/1702069/zerohour"}, "edited": false, "score": 0, "creation_date": 1495205887, "post_id": 44064315, "comment_id": 75170434, "body": "I like your approach, and it seems like what would be the fastest.  Building a new image on every source code change would just take up too much dev time along the way.  So it makes sense to use your host machine to dev most of it then test in Docker for milestones.  Also, the multi-stage build looks really nice"}], "tags": [], "owner": {"reputation": 3158, "user_id": 7925197, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M21lU.png?s=128&g=1", "display_name": "papey", "link": "https://stackoverflow.com/users/7925197/papey"}, "is_accepted": true, "score": 9, "last_activity_date": 1495179912, "creation_date": 1495179912, "answer_id": 44064315, "question_id": 44061696, "link": "https://stackoverflow.com/questions/44061696/best-practice-way-to-develop-golang-app-to-be-run-in-docker-container/44064315#44064315", "title": "Best practice/way to develop Golang app to be run in Docker container", "body": "<p>Not sure it's the best pratice but here is my way.</p>\n\n<ol>\n<li>Makefile is MANDATORY</li>\n<li>Use my local machine and my go tools for small iterations</li>\n<li>Use a dedicated build container based on golang:{1.X,latest}, mount code directory to build a release, mainly to ensure that my code will build correctly on the CI. (Tips, here is my standard go build command for release build : <code>CGO_ENABLED=0 GOGC=off go build -ldflags -s -w</code>)</li>\n<li>Test code</li>\n<li>Then use a <code>FROM scratch</code> to build a release container (copy the bin + entrypoint)</li>\n<li>Push you image to your registry </li>\n</ol>\n\n<p>Steps 3 to 6 are tasks for the CI.</p>\n\n<p><strong>Important note :</strong> this is changing due to the new multistage builds feature : <a href=\"https://docs.docker.com/engine/userguide/eng-image/multistage-build/\" rel=\"noreferrer\">https://docs.docker.com/engine/userguide/eng-image/multistage-build/</a>, no more build vs release containers.</p>\n\n<p>Build container and release container will be merged in one multistage build so one Dockerfile with (not sure about the correct syntax but, you will get the idea) : </p>\n\n<pre><code>FROM golang:latest as build\nWORKDIR /go/src/myrepos/myproject\nRUN go build -o mybin\n\nFROM scratch\nCOPY --from=build /go/src/myrepos/myproject/mybin /usr/local/bin/mybin\nENTRYPOINT [ \"/usr/local/bin/mybin\"\u00a0]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 231, "user_id": 1702069, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/a93f16742c367cda43b4eaa04b5aa498?s=128&d=identicon&r=PG", "display_name": "ZeroHour", "link": "https://stackoverflow.com/users/1702069/zerohour"}, "edited": false, "score": 0, "creation_date": 1495205490, "post_id": 44064661, "comment_id": 75170163, "body": "Ideally that is the gist of it.  Trying to make development similar across devs and envs, which Docker is touted for.  I have only used PHP and Docker so far, so developing with a Docker container is fairly straight forward.  I&#39;d imagine compiled languages like Go is a little more annoying, which is why I was asking.  But I might be a little confused on your answer.  Is your answer more towards having a development environment that you would do ALL work in, not just for one project?"}], "tags": [], "owner": {"reputation": 787, "user_id": 3959912, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SVNx7.jpg?s=128&g=1", "display_name": "Arif A.", "link": "https://stackoverflow.com/users/3959912/arif-a"}, "is_accepted": false, "score": 0, "last_activity_date": 1495181059, "creation_date": 1495181059, "answer_id": 44064661, "question_id": 44061696, "link": "https://stackoverflow.com/questions/44061696/best-practice-way-to-develop-golang-app-to-be-run-in-docker-container/44064661#44064661", "title": "Best practice/way to develop Golang app to be run in Docker container", "body": "<p>As far as I understood from you question, you want to have a running container to develop a golang application. The same thing can be done in your host machine also. But good thing is that if you could build such application, then that will be consider as cloud Platform-as-a-Service(PaaS).</p>\n\n<p>The basic requirement of the container will be: Ubuntu image and other packages such as editor, golang compiler and so on. </p>\n\n<p>I would suggest to look on the docker development environment. \n<a href=\"https://docs.docker.com/opensource/project/set-up-dev-env/\" rel=\"nofollow noreferrer\">https://docs.docker.com/opensource/project/set-up-dev-env/</a></p>\n\n<p>The docker development environment is running inside a container and the files are mounted from one of the host directory. The container image is build from Ubuntu scratch image and added required packages which are needed to compile docker source code.  </p>\n\n<p>I hope you almost got what you are looking for.</p>\n"}, {"tags": [], "owner": {"reputation": 803, "user_id": 3745378, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb6ba32cb964354c25937038fbccdcb9?s=128&d=identicon&r=PG", "display_name": "Curtis Allen", "link": "https://stackoverflow.com/users/3745378/curtis-allen"}, "is_accepted": false, "score": 3, "last_activity_date": 1495211316, "creation_date": 1495211316, "answer_id": 44074839, "question_id": 44061696, "link": "https://stackoverflow.com/questions/44061696/best-practice-way-to-develop-golang-app-to-be-run-in-docker-container/44074839#44074839", "title": "Best practice/way to develop Golang app to be run in Docker container", "body": "<p>Lately, I've been using \n<a href=\"https://github.com/thockin/go-build-template\" rel=\"nofollow noreferrer\">https://github.com/thockin/go-build-template</a>\nAs a base for all of my projects. The template comes with a Makefile that will build/test your application in a Docker. </p>\n"}], "owner": {"reputation": 231, "user_id": 1702069, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/a93f16742c367cda43b4eaa04b5aa498?s=128&d=identicon&r=PG", "display_name": "ZeroHour", "link": "https://stackoverflow.com/users/1702069/zerohour"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3703, "favorite_count": 3, "accepted_answer_id": 44064315, "answer_count": 3, "score": 4, "last_activity_date": 1495211316, "creation_date": 1495169442, "question_id": 44061696, "link": "https://stackoverflow.com/questions/44061696/best-practice-way-to-develop-golang-app-to-be-run-in-docker-container", "title": "Best practice/way to develop Golang app to be run in Docker container", "body": "<p>Basically what the title says... Is there a best practice or an efficient way to develop a Golang app that will be Dockerized?  I know you can mount volumes to point to your source code, and it works great for languages like PHP where you don't need to compile your code.  But for Go, it seems like it would be a pain to develop alongside Docker since you pretty much only have two options I guess.  </p>\n\n<p>First would be to have a Dockerfile that is just onbuild so it starts the go app when a container is run, thus having to build a new image on every change (whether it be small or not).  Or, you do mount your source code dir to the container dir, then attach to the container itself and do the manual go build/run yourself as if you would normally.</p>\n\n<p>Those two ways are really the only way that I see it happening unless you just don't develop your Go app in a docker container.  Just develop it as normal, then use the scratch image method where you pre build the Go into a binary then copy that into your container when you are ready to run it.  I assume that is probably the way to go, but I wanted to ask more professional people on the subject and maybe get some feedback on the topic.</p>\n"}, {"tags": ["go", "data-access-layer", "business-logic-layer"], "comments": [{"owner": {"reputation": 12242, "user_id": 5779732, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/UBIhA.jpg?s=128&g=1", "display_name": "Amit Joshi", "link": "https://stackoverflow.com/users/5779732/amit-joshi"}, "edited": false, "score": 0, "creation_date": 1495173873, "post_id": 44060222, "comment_id": 75149583, "body": "See if this helps: <a href=\"http://stackoverflow.com/q/42791536/5779732\">stackoverflow.com/q/42791536/5779732</a>, <a href=\"http://stackoverflow.com/a/42500771/5779732\">stackoverflow.com/a/42500771/5779732</a>, <a href=\"http://stackoverflow.com/a/41824700/5779732\">stackoverflow.com/a/41824700/5779732</a>"}], "answers": [{"comments": [{"owner": {"reputation": 333, "user_id": 7352226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b7f77d9d96cfe301db80eb8265331a9?s=128&d=identicon&r=PG&f=1", "display_name": "fallaway", "link": "https://stackoverflow.com/users/7352226/fallaway"}, "edited": false, "score": 0, "creation_date": 1495163911, "post_id": 44060458, "comment_id": 75146495, "body": "Much appreciated. However, according to layered design, DAL is not supposed to be dependent on BLL&#39;s model. Having DAL functions returning BLL models can also introduce dependency cycle issue (BLL calls&#39; DAL function that returns a BLL object). Would this be a problem? Or should DAO be implemented in this case?"}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 333, "user_id": 7352226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b7f77d9d96cfe301db80eb8265331a9?s=128&d=identicon&r=PG&f=1", "display_name": "fallaway", "link": "https://stackoverflow.com/users/7352226/fallaway"}, "edited": false, "score": 0, "creation_date": 1495195736, "post_id": 44060458, "comment_id": 75163293, "body": "You can have the DAL return a DAO which is separate from the BLL object. I would only do that if BLL objects are complex enough that building them from the DAL would tie DAL layer to BLL logic. Otherwise if BLL objects are simple, the mapping from DAO to BLL ends up being a trivial but unnecessary step, and in that case returning BLL objects from the DAL should not be an issue. This depends a lot on your actual use case."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 5, "last_activity_date": 1495160805, "creation_date": 1495160805, "answer_id": 44060458, "question_id": 44060222, "link": "https://stackoverflow.com/questions/44060222/is-it-necessary-to-have-dal-and-bll-in-go-web-app/44060458#44060458", "title": "Is it necessary to have DAL and BLL in Go Web App?", "body": "<p>As noted by you, this question is not Go-specific and can apply to any language.</p>\n\n<p>Here are some points I think you should consider regarding this:</p>\n\n<ul>\n<li><p>As with other design matters, there is no <em>right way</em> of doing this, but the general practice is to actually separate Business Logic from Data Access.</p></li>\n<li><p>Business Logic should not be tied to the actual Data Access implementation so that if you then decide to move away from SQL and save objects in plain files, or in a No-SQL storage you don't necessarily need to change the Business Logic layer.</p></li>\n<li><p>In your case, the <code>GetCustomerAccountInfo</code> returns <code>sql.Rows</code>. This actually couples your Business Logic to that particular implementation. The usual practice is to return actual model objects (a <code>CustomerAccount</code> for example).</p></li>\n<li><p>Also note that your example is quite simple so it's true that even by separating it you might not see a lot of benefit. But sometimes things are not that simple.</p>\n\n<ul>\n<li><p>Data Access logic might involve more complex queries joining tables, or even making separate queries inside a database transaction. By separating this you don't pollute Business Logic with these low level details. Also, you can change the underlying table structure by only making changes on the Data Access layer, without altering business logic layer.</p></li>\n<li><p>Business Logic might also in term consist on more complex calculations such as merging different objects, applying defaults and perform domain validations. Separating this logic (which is independent of the storage being used) allows you to change Business Logic without having to necessarily change Data Access logic.</p></li>\n</ul></li>\n</ul>\n\n<p>Basically, by separating this, you can develop (and also importantly: test) each of the Business and Data Access logic separately and have a more modular design.</p>\n\n<p>I hope that helps.</p>\n"}, {"tags": [], "owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "is_accepted": false, "score": 1, "last_activity_date": 1495176074, "creation_date": 1495176074, "answer_id": 44063126, "question_id": 44060222, "link": "https://stackoverflow.com/questions/44060222/is-it-necessary-to-have-dal-and-bll-in-go-web-app/44063126#44063126", "title": "Is it necessary to have DAL and BLL in Go Web App?", "body": "<p>If you are looking for practical answer here is one of my thought. </p>\n\n<p>Lets say that you wanted to get the Customer Account and then modify it accordingly to the input from the API.</p>\n\n<p>So writing the data layer or query would look something like this : </p>\n\n<pre><code>type CustomerAccount struct{\n   id string // this data type will differ depends on your database.\n   Name string\n   Address string\n   Age int\n   // and any other attribute. this is just for example.\n}\n\n\nfunc (ca *CustomerAccount)GetCustomerAccount (id int) (CustomerAccount,error) {\n  var ca CostumerAccount\n  // write your query using any databases.\n  // return an error if error happens when you do query to the database.\n\n  return ca,nil\n} \n\nfunc (ca *CustomerAccount)SaveCustomerAccount(ca CustomerAccount) error {\n  // find and update the data from given CustomerAccount\n  return nil\n}\n</code></pre>\n\n<p>Save the code above naming <code>customer_account.go</code>. </p>\n\n<p>Now lets say that you want to decouple the database query from your business logic or in this case your DAL with BLL. you can use interface for that. Creating an interface type that match witch your model query method above like this : </p>\n\n<pre><code>type CustomerAccountInterface interface {\n   GetCustomerAccount (id int) (CustomerAccount,error)\n   SaveCustomerAccount(ca CustomerAccount) error\n}\n</code></pre>\n\n<p>save it as <code>customer_account_interface.go</code>.</p>\n\n<p>And now we would like to write a business logic which will be responsible for the modifying the data and we will call the <code>CusomerAccountInterface</code> to the business Logic. Since we're creating an API so wen we used handler for this :</p>\n\n<pre><code>func EditCustomerAccount(ca CustomerAccountInterface) http.Handler {\n\n  return http.HandleFunc(func(w http.ResponseWritter, r *http.Request){\n     // get all the input from user using *http.Request like id and other input.\n\n     // get our CustomerAccount Data to modify it\n     customerAccount,err := ca.GetAccountCustomer(id)\n\n     // modify customerAccount Accordingly from the input data, for example\n      customerAccount.Name = inputName // you can change what ever you want with the data here. In this case we change the name only for example purpose.\n\n     // save your customerAccount to your database\n     err := ca.SaveCustomerAccount(customerAccount) \n\n     // send the response 200 ok resonse if no error happens\n     w.WriteHeader(http.StatusOk) \n     resp := response{} // you can create your response struct in other places.\n     resp.Message = \"success update data\"\n     json.NewEncoder(w).Encode(resp)\n\n  })\n\n}\n</code></pre>\n\n<p>From the above approach we have decoupled the handler which is the business logic with the data access or query database so that we can create a unit test for the business Logic in the handler something like this :</p>\n\n<p>Creating <code>CustomerAccountMock</code> for to mock the result query from data access : </p>\n\n<pre><code>type CustomerAccountMock struct {\n   err error\n   Data CutstomerAccount\n}\n\nfunc (ca *CustomerAccountMock)GetCustomerAccount (id int) (CustomerAccount,error) {\n  return ca.Data,nil\n} \n\nfunc (ca *CustomerAccountMock)SaveCustomerAccount(ca CustomerAccount) error {\n  return ca.err\n}\n</code></pre>\n\n<p>Now we can write out test something like this : </p>\n\n<pre><code>func TestEditCustomerAccount(t *testing.T){\n  testObjects := []struct{\n    CMock CutomerAccountMock\n  }{\n    {\n      CMock : CustomerAccountMock{\n         err : errors.New(\"Test error\")\n         Data : CustomerAccount{} // return an empty data \n      },\n    }, \n  }\n\n  for _, testObject := range testObjects {\n     actualResponse := createRequestToHandler(testObject.CMock)\n     // here you can check your response from calling your request testing to your handler.\n\n  }\n\n}\n</code></pre>\n\n<p>Above just for getting the idea how to I approach on separate the data layer and business logic layer. you can refer to my complete <a href=\"https://github.com/Gujarats/API-Golang/blob/master/controller/driver/driver.handler.UpdateDriver_test.go\" rel=\"nofollow noreferrer\">source code here</a>. The code refers to another test case like updating driver data but it is the same approach.</p>\n\n<p>But there are some cons on this approach though, for me it is like writing a thousands article when it comes to testing, you have to be patience!.</p>\n\n<p>So coming to your question </p>\n\n<blockquote>\n  <p>Is it necessary to have DAL and BLL in Go Web App?</p>\n</blockquote>\n\n<p>Yes, it does. Separating the data access with the business logic layer it's important so that we can unit test it. </p>\n\n<p>In the above example the logic is pretty simple, but imagine if you have a complex logic to manipulate the data and you are not separate the DAL and BLL. It will hurt you in the future and other developer when it comes to changes the logic or query. </p>\n\n<p>Feeling afraid to change and frustrated when something gone wrong is definitely you want to avoid to happen in your professional life.</p>\n"}], "owner": {"reputation": 333, "user_id": 7352226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b7f77d9d96cfe301db80eb8265331a9?s=128&d=identicon&r=PG&f=1", "display_name": "fallaway", "link": "https://stackoverflow.com/users/7352226/fallaway"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1055, "favorite_count": 0, "accepted_answer_id": 44060458, "answer_count": 2, "score": 1, "last_activity_date": 1495176074, "creation_date": 1495158731, "question_id": 44060222, "link": "https://stackoverflow.com/questions/44060222/is-it-necessary-to-have-dal-and-bll-in-go-web-app", "title": "Is it necessary to have DAL and BLL in Go Web App?", "body": "<p>In many Go programming books, the author usually put data access logic within the same function that handles business logic. While I understand that this may be merely for teaching purposes, but I wonder if people actually separate BLL from DAL in real world development.</p>\n\n<p>I have tried to apply layered design to my Go project but have not felt any benefits from it. For instance, my DAL functions are typically like this (in appdal package):</p>\n\n<pre><code>func GetCustomerAccountInfo (accountID int) (*sql.Rows, error) {\n    sql := `SELECT * FROM CUSTOMER_ACCOUNT WHERE ID = $1`\n    return GLOBAL_PSQL.Query(sql, accountID)\n}\n</code></pre>\n\n<p>And my typical BLL functions would be something like this:</p>\n\n<pre><code>func NewCustomerAccountBLL (accountID int) (* CustomerAccountBLL) {\n    rows, err := appdal.GetCustomerAccountInfo(accountID)\n    // create an instance of CustomerAccountBLL (bll) and scan rows....\n    return &amp;bll\n}\n</code></pre>\n\n<p>Often I found that my BLL is essentially coupled with the database schema since scanning requires that I know which column that my query has read, so I found it's not a bad idea to merge some DAL function into BLL (such as merge the query to BLL instead). In addition, having a DAL also increases the amount of code that I have to maintain as well.</p>\n\n<p>However, many software architects also encourages layered designs, and it makes sense to have BLL and DAL and assign clear responsibilities on each layer.</p>\n\n<p>While I also understand design and patterns are not necessarily dependent on programming languages, but I often found little benefit from having both BLL and DAL in my project. Am I missing something important in design or Go? Thanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1495151459, "post_id": 44059263, "comment_id": 75143822, "body": "I don&#39;t know what&#39;s causing the problem, but I did notice some issues with the code. 1) The goroutine in <code>get_data</code> is not required. Query the database directly from the handler. 2) The <code>result</code> is used as a format string. Use <code>io.WriteString(w, result)</code> instead of <code>fmt.Printf</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "is_accepted": true, "score": 2, "last_activity_date": 1495189288, "last_edit_date": 1495189288, "creation_date": 1495151478, "answer_id": 44059405, "question_id": 44059263, "link": "https://stackoverflow.com/questions/44059263/golang-http-connection-is-persisting-indefinitely/44059405#44059405", "title": "Golang http connection is persisting indefinitely", "body": "<p><a href=\"https://golang.org/pkg/net/http/#Server\" rel=\"nofollow noreferrer\"><code>ReadTimeOut</code></a> applies to the reads made by <code>net/http</code>'s server code, not to the goroutine executing the request:</p>\n\n<blockquote>\n  <p>ReadTimeout is the maximum duration for reading the entire\n  request, including the body.`</p>\n</blockquote>\n\n<p>Once the request has been read this value is no longer used, and the handler is in charge of deciding whether or not things have timed out.</p>\n\n<p>If you want to cancel the HTTP request before the database query is done, you can do this with a <a href=\"https://blog.golang.org/context\" rel=\"nofollow noreferrer\">context.Context</a>.</p>\n\n<p>Extend <a href=\"https://golang.org/pkg/net/http/#Request.Context\" rel=\"nofollow noreferrer\"><code>req.Context</code></a>, add a <a href=\"https://golang.org/pkg/context/#WithTimeout\" rel=\"nofollow noreferrer\">timeout or deadline</a>, passing this new context to <a href=\"https://golang.org/pkg/database/sql/#Stmt.QueryRowContext\" rel=\"nofollow noreferrer\"><code>sql.QueryRowContext</code></a>:</p>\n\n<pre><code>ctx, _ := context.WithTimeout( r.Context(), 20 * time.Second )\n\ndb.QueryRowContext(ctx, \"select json_build_object('Locations', array_to_json(array_agg(t))) from (SELECT latitudes,county,longitudes,\"+\n    \"statelong,thirtylatmin,thirtylatmax,thirtylonmin,thirtylonmax,city\"+\n    \" FROM zips where city='Orlando' ORDER BY city limit 5) t\").Scan(&amp;result)\n</code></pre>\n"}], "owner": {"reputation": 913, "user_id": 5551912, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4ed9452605a562b6865a5527f92173a0?s=128&d=identicon&r=PG&f=1", "display_name": "Rome Torres", "link": "https://stackoverflow.com/users/5551912/rome-torres"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 44059405, "answer_count": 1, "score": 2, "last_activity_date": 1495189288, "creation_date": 1495150277, "last_edit_date": 1495151435, "question_id": 44059263, "link": "https://stackoverflow.com/questions/44059263/golang-http-connection-is-persisting-indefinitely", "title": "Golang http connection is persisting indefinitely", "body": "<p>I have a simple code that retrieves data from the database and I am using Jmeter to perform load testing on it . What I am doing is simulating 1,000 requests sometimes I get all 1,000 successful requests and other times I get 999 requests and I have to stop it because it seems like the thread or last results keeps on going indefinitely this is how it looks, notice on how the last request takes more than 10 times the normal time . If i don't stop it then that request would keep going on and on .\n<a href=\"https://i.stack.imgur.com/GOLWv.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/GOLWv.png\" alt=\"enter image description here\"></a></p>\n\n<p>This is my code</p>\n\n<pre><code>func get_data(w http.ResponseWriter, r *http.Request) {\n    var result string\n    r.ParseForm()\n\n    wg := sync.WaitGroup{}\n\n    wg.Add(1)\n    go func() {\n\n        defer wg.Done()\n\n        db.QueryRow(\"select json_build_object('Locations', array_to_json(array_agg(t))) from (SELECT latitudes,county,longitudes,\"+\n            \"statelong,thirtylatmin,thirtylatmax,thirtylonmin,thirtylonmax,city\"+\n            \" FROM zips where city='Orlando' ORDER BY city limit 5) t\").Scan(&amp;result)\n\n    }()\n    wg.Wait()\n\n    fmt.Fprintf(w,result)\n}\n</code></pre>\n\n<p>Then I have my database connection</p>\n\n<pre><code>var db *sql.DB\n\nfunc init() {\n    var err error\n    db, err = sql.Open(\"postgres\", Postgres_Connect)\n    if err != nil {\n        log.Fatal(\"Invalid DB config:\", err)\n        println(\"Invalid DB config:\")\n        //log_errors(\"HomePage-Postgres: error opening database\",err)\n    }\n    if err = db.Ping(); err != nil {\n        log.Fatal(\"DB unreachable:\", err)\n        println()\n    }\n\n\n\n}\n</code></pre>\n\n<p>and here is my HTTP server</p>\n\n<pre><code>func main() {\n\n    runtime.GOMAXPROCS(runtime.NumCPU())\n    r := mux.NewRouter()\n\n    r.HandleFunc(\"/mydata\",Controllers.Get_Data)\n    http.Handle(\"/\",r)\n\n\n    srv := &amp;http.Server{\n        ReadTimeout: 20 * time.Second,\n        WriteTimeout: 20 * time.Second,\n        IdleTimeout:  120 * time.Second,\n        Addr: \":8000\",\n    }\n    log.Println(srv.ListenAndServe())\n}\n</code></pre>\n\n<p>I was hoping that the ReadTimeOut would kill the connection but it seems like it doesn't</p>\n"}, {"tags": ["go", "pubnub", "subscribe"], "answers": [{"comments": [{"owner": {"reputation": 318, "user_id": 2507262, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/87e60b9190b4c90084a737a7b3c4b4a4?s=128&d=identicon&r=PG", "display_name": "ozfive", "link": "https://stackoverflow.com/users/2507262/ozfive"}, "edited": false, "score": 0, "creation_date": 1495151271, "post_id": 44059244, "comment_id": 75143774, "body": "it&#39;s empty output: arr:[]"}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 318, "user_id": 2507262, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/87e60b9190b4c90084a737a7b3c4b4a4?s=128&d=identicon&r=PG", "display_name": "ozfive", "link": "https://stackoverflow.com/users/2507262/ozfive"}, "edited": false, "score": 0, "creation_date": 1495156062, "post_id": 44059244, "comment_id": 75144808, "body": "That&#39;s strange. If that&#39;s an empty array then the next line should throw an &quot;index out of range&quot; error instead of the float64 one. Are you consistently getting the float64 error even when that prints an empty array? And are the line numbers in your post consistent with the ones in your original program?"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 2, "last_activity_date": 1495150099, "creation_date": 1495150099, "answer_id": 44059244, "question_id": 44058631, "link": "https://stackoverflow.com/questions/44058631/interface-conversion-interface-is-float64-not-interface-pubnub/44059244#44059244", "title": "interface conversion: interface {} is float64 not []interface {} PubNub", "body": "<p>According to the panic message you pasted, error seems to be occurring in:</p>\n\n<pre><code>C:/Users/olmadmin/Documents/work/Go/src/DeploymentServer/main.go:43\n</code></pre>\n\n<p>Which seems to correspond to this line:</p>\n\n<pre><code>messages := arr[0].([]interface{})\n</code></pre>\n\n<p>You seem to be expecting that position to the array to hold another array, but apparently you are getting a float64 there, and thus the error:</p>\n\n<pre><code>interface conversion: interface {} is float64, not []interface {}\n</code></pre>\n\n<p>You can add some debugging to print out what you are getting in <code>arr</code> at that point, so that you can then assert the type accordingly by adding this before that line 43:</p>\n\n<pre><code>fmt.Printf(\"arr: %#v\\n\", arr)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "is_accepted": true, "score": 6, "last_activity_date": 1495465844, "last_edit_date": 1495465844, "creation_date": 1495178400, "answer_id": 44063850, "question_id": 44058631, "link": "https://stackoverflow.com/questions/44058631/interface-conversion-interface-is-float64-not-interface-pubnub/44063850#44063850", "title": "interface conversion: interface {} is float64 not []interface {} PubNub", "body": "<p>When converting incoming data to <code>[]interface{}</code>, this is going to be long <em>journey</em> to get to the original data type. Here is the working code : </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype DeployMessage struct {\n    Server string\n    Repo   string\n}\n\ntype PNMessage struct {\n    Messages []DeployMessage\n    Id       string\n    Channel  string\n}\n\n// testing to marshal this json\nfunc main() {\n    // imagine if we have receive our data here.\n    data := []byte(`[[{\"Repo\":\"images\",\"Server\":\"production\"}], \"149514560987662985\", \"channel1\"]`)\n\n    var getData []interface{}\n    err := json.Unmarshal(data, &amp;getData)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"result  getData = %+v\\n\", getData[0])\n\n    getData2 := getData[0].([]interface{})\n    fmt.Printf(\"result  getData = %+v\\n\", getData2[0])\n\n    getData3 := getData2[0].(map[string]interface{})\n\n    var deployMessages []DeployMessage\n    deployMessages = append(deployMessages, DeployMessage{Server: getData3[\"Server\"].(string), Repo: getData3[\"Repo\"].(string)})\n\n    pNMessage := PNMessage{\n        Messages: deployMessages,\n        Id:       getData[1].(string),\n        Channel:  getData[2].(string),\n    }\n\n    fmt.Printf(\"result  = %+v\\n\", pNMessage)\n\n}\n</code></pre>\n\n<p>Above code will works but I don't like it. <a href=\"https://play.golang.org/p/U6slzSgaxu\" rel=\"nofollow noreferrer\">https://play.golang.org/p/U6slzSgaxu</a></p>\n\n<p>You can shorten the code the assert your data like this : </p>\n\n<pre><code>getData2 := getData[0].([]interface{})[0].(map[string]interface{})\nrepo := getData2[\"Repo\"].(string) // this will get the value of Repo in string.\n</code></pre>\n\n<p>final output : </p>\n\n<pre><code>result  = {Messages:[{Server:production Repo:images}] Id:149514560987662985 Channel:channel1}\n</code></pre>\n"}], "owner": {"reputation": 318, "user_id": 2507262, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/87e60b9190b4c90084a737a7b3c4b4a4?s=128&d=identicon&r=PG", "display_name": "ozfive", "link": "https://stackoverflow.com/users/2507262/ozfive"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14369, "favorite_count": 0, "accepted_answer_id": 44063850, "answer_count": 2, "score": 2, "last_activity_date": 1495465844, "creation_date": 1495145867, "last_edit_date": 1495541448, "question_id": 44058631, "link": "https://stackoverflow.com/questions/44058631/interface-conversion-interface-is-float64-not-interface-pubnub", "title": "interface conversion: interface {} is float64 not []interface {} PubNub", "body": "<p>I am trying to get at the JSON values that are passed as a PubNub message on the subscribe end. the code for this is</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"flag\"\n    \"fmt\"\n    \"github.com/pubnub/go/messaging\"\n)\n\ntype DeployMessages struct {\n    Server string\n    Repo   string\n}\n\ntype PNMessage struct {\n    Messages []DeployMessages\n    Id       string\n    Channel  string\n}\n\nfunc main() {\n    publishKey := flag.String(\"pub\", \"demo\", \"publish key\")\n    subscribeKey := flag.String(\"sub\", \"demo\", \"subscribe key\")\n\n    channels := flag.String(\"channels\", \"channel1, channel2\", \"channels to subscribe to\")\n\n    pubnub := messaging.NewPubnub(*publishKey, *subscribeKey, \"\", \"\", false, \"\", nil)\n\n    successChannel := make(chan []byte)\n    errorChannel := make(chan []byte)\n\n    go pubnub.Subscribe(*channels, \"\", successChannel, false, errorChannel)\n\n    subscribeHandler(successChannel, errorChannel, \"Subscribe\")\n}\n\nfunc (pnm *PNMessage) UnmarshalJSON(bs []byte) error {\n    var arr []interface{}\n    err := json.Unmarshal(bs, &amp;arr)\n    if err != nil {\n        return err\n    }\n    messages := arr[0].([]interface{}) \n    pnm.Messages = make([]DeployMessages, len(messages))\n    for i, m := range messages {\n        pnm.Messages[i].Server = m.(map[string]interface{})[\"server\"].(string) \n        pnm.Messages[i].Repo = m.(map[string]interface{})[\"repo\"].(string)\n    }\n    pnm.Id = arr[1].(string)      \n    pnm.Channel = arr[2].(string)\n    return nil\n}\n\nfunc subscribeHandler(successChannel, errorChannel chan []byte, action string) {\n\n    for {\n        select {\n        case response, ok := &lt;-successChannel:\n            if !ok {\n                break\n            }\n            if string(response) != \"[]\" {\n                message := PNMessage{}\n                err := json.Unmarshal([]byte(response), &amp;message)\n                if err != nil {\n                    break\n                }\n                fmt.Println(fmt.Sprintf(\"%s Response: %s \", action, response))\n                fmt.Println(\"\")\n            }\n\n        case failure, ok := &lt;-errorChannel:\n            if !ok {\n                break\n            }\n            if string(failure) != \"[]\" {\n                if true {\n                    fmt.Printf(\"%s Error Response: %s \", action, failure)\n                    fmt.Println(\"\")\n                }\n            }\n\n        case &lt;-messaging.SubscribeTimeout():\n            fmt.Printf(\"Subscirbe request timeout\")\n        }\n    }\n}\n</code></pre>\n\n<p>The format of the message is this</p>\n\n<blockquote>\n  <p>[[{\"Repo\":\"images\",\"Server\":\"production\"}], \"149514560987662985\",\n  \"channel1\"]</p>\n</blockquote>\n\n<p>This throws the following panic </p>\n\n<blockquote>\n  <p>panic: interface conversion: interface {} is float64, not []interface\n  {} [recovered]\n          panic: interface conversion: interface {} is float64, not []interface {}</p>\n  \n  <p>goroutine 1 [running]:\n  encoding/json.(*decodeState).unmarshal.func1(0xc042065c20)\n          C:/Go/src/encoding/json/decode.go:170 +0xf1 panic(0x6548e0, 0xc042009440)\n          C:/Go/src/runtime/panic.go:489 +0x2dd main.(*PNMessage).UnmarshalJSON(0xc0420093c0, 0xc042009300, 0x3d,\n  0x40, 0x0, 0xb35198)\n          C:/Users/olmadmin/Documents/work/Go/src/DeploymentServer/main.go:43\n  +0x499 encoding/json.(*decodeState).array(0xc04205b320, 0x64e6a0, 0xc0420093c0, 0x16)\n          C:/Go/src/encoding/json/decode.go:489 +0xbe4 encoding/json.(*decodeState).value(0xc04205b320, 0x64e6a0,\n  0xc0420093c0, 0x16)\n          C:/Go/src/encoding/json/decode.go:399 +0x28e encoding/json.(*decodeState).unmarshal(0xc04205b320, 0x64e6a0,\n  0xc0420093c0, 0x0, 0x0)\n          C:/Go/src/encoding/json/decode.go:184 +0x221 encoding/json.Unmarshal(0xc042009300, 0x3d, 0x40, 0x64e6a0,\n  0xc0420093c0, 0xc042065c98, 0x5f82de)\n          C:/Go/src/encoding/json/decode.go:104 +0x14f main.subscribeHandler(0xc042030c00, 0xc042030c60, 0x69c4a4, 0x9)\n          C:/Users/olmadmin/Documents/work/Go/src/DeploymentServer/main.go:64\n  +0x222 main.main()\n          C:/Users/olmadmin/Documents/work/Go/src/DeploymentServer/main.go:34\n  +0x27e</p>\n</blockquote>\n\n<p>I was referencing the answer to this question \n<a href=\"https://stackoverflow.com/questions/29348262/decoding-pubnub-messages-with-golang-json\" title=\"Decoding PubNub messages with golang JSON\">https://stackoverflow.com/questions/29348262/decoding-pubnub-messages-with-golang-json</a>\nPlease point me in the right direction...?</p>\n"}]