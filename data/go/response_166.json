[{"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 7193, "user_id": 363663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c59cd40f0edcd3feea80c7ca09bc8e76?s=128&d=identicon&r=PG", "display_name": "sof", "link": "https://stackoverflow.com/users/363663/sof"}, "edited": false, "score": 0, "creation_date": 1521069784, "post_id": 49289067, "comment_id": 85581490, "body": "It says <code>user  0m0.999s</code> via <code>time</code> command to run the original code snippet, so the <code>for</code> loop definitely keeps busy."}, {"owner": {"reputation": 8235, "user_id": 1284760, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/2f0d151197270b75a2c5e5bf6a2a6583?s=128&d=identicon&r=PG", "display_name": "see sharper", "link": "https://stackoverflow.com/users/1284760/see-sharper"}, "edited": false, "score": 0, "creation_date": 1521070053, "post_id": 49289067, "comment_id": 85581574, "body": "@Tarion I disagree with your first sentence. i is not &quot;randomly&quot; updated. OP allows a second to elapse, during which time i will be set to 1. It&#39;s not good design, but a second is a long time to allow a variable to be updated!"}], "tags": [], "owner": {"reputation": 13903, "user_id": 86388, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/cPl84.jpg?s=128&g=1", "display_name": "Tarion", "link": "https://stackoverflow.com/users/86388/tarion"}, "is_accepted": false, "score": 0, "last_activity_date": 1521069512, "last_edit_date": 1521069512, "creation_date": 1521069106, "answer_id": 49289067, "question_id": 49289025, "link": "https://stackoverflow.com/questions/49289025/why-the-shared-variable-between-go-routines-wont-updated/49289067#49289067", "title": "Why the shared variable between Go routines won&#39;t updated", "body": "<p>It's not \"correctly\" updated without the for loop, it's just randomly updated before you print it.</p>\n\n<p>In go playgorund this ends with:</p>\n\n<pre><code>process took too long \nProgram exited.\n</code></pre>\n\n<p>See: <a href=\"https://play.golang.org/p/qKd-CdLt3uK\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qKd-CdLt3uK</a></p>\n\n<p>When starting the go routine the scheduler will decide when to switch the context between the execution of the go routine and the main function. In addition the go-routine is stopped when the main function ends.</p>\n\n<p>What you want to do is some Synchronisation between your go routine and your main loop, since both are accessing a shared variable <code>i</code>.</p>\n\n<p>Best practice here would be to use channels, sync.Mutex or sync.WaitGroup.</p>\n\n<p>You can add some delay to your for loop, to give up some CPU for the main function:</p>\n\n<pre><code>go func() {\n    for {\n        i++\n        time.Sleep(1 * time.Millisecond)\n    }\n}()\n</code></pre>\n\n<p>This will pint some value around 1000, but it's still not reliable.</p>\n"}, {"tags": [], "owner": {"reputation": 8235, "user_id": 1284760, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/2f0d151197270b75a2c5e5bf6a2a6583?s=128&d=identicon&r=PG", "display_name": "see sharper", "link": "https://stackoverflow.com/users/1284760/see-sharper"}, "is_accepted": false, "score": 1, "last_activity_date": 1521069908, "creation_date": 1521069908, "answer_id": 49289162, "question_id": 49289025, "link": "https://stackoverflow.com/questions/49289025/why-the-shared-variable-between-go-routines-wont-updated/49289162#49289162", "title": "Why the shared variable between Go routines won&#39;t updated", "body": "<p>Running this in the go playground, it times out, which slightly surprises me because, as Tarion says, the infinite for loop should be terminated upon exit from <code>main</code>. It seems that the go playground waits for all goroutines to complete before exiting. I imagine the reason you see 0 is to do with bad multithreading here. The for loop is continually updating <code>i</code> at the same time as <code>i</code> is read by main, and the results are unpredictable. I'm not sure what you are trying to demonstrate, but you would need a mutex here or a channel to read and update <code>i</code> safely on different threads.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1521072022, "last_edit_date": 1521072022, "creation_date": 1521070992, "answer_id": 49289342, "question_id": 49289025, "link": "https://stackoverflow.com/questions/49289025/why-the-shared-variable-between-go-routines-wont-updated/49289342#49289342", "title": "Why the shared variable between Go routines won&#39;t updated", "body": "<p>You have a race condition. The results are undefined.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n\n    var i uint64\n    go func() {\n        for {\n            i++\n        }\n    }()\n\n    time.Sleep(time.Second)\n    fmt.Println(i)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run -race racer.go\n==================\nWARNING: DATA RACE\nRead at 0x00c0000a2010 by main goroutine:\n  main.main()\n      /home/peter/src/racer.go:18 +0x95\n\nPrevious write at 0x00c0000a2010 by goroutine 6:\n  main.main.func1()\n      /home/peter/src/racer.go:13 +0x4e\n\nGoroutine 6 (running) created at:\n  main.main()\n      /home/peter/src/racer.go:11 +0x7a\n==================\n66259553\nFound 1 data race(s)\nexit status 66\n$ \n</code></pre>\n\n<hr>\n\n<p>Reference: <a href=\"https://blog.golang.org/race-detector\" rel=\"nofollow noreferrer\">Introducing the Go Race Detector</a></p>\n"}, {"tags": [], "owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "is_accepted": false, "score": 2, "last_activity_date": 1521130337, "last_edit_date": 1521130337, "creation_date": 1521129956, "answer_id": 49304174, "question_id": 49289025, "link": "https://stackoverflow.com/questions/49289025/why-the-shared-variable-between-go-routines-wont-updated/49304174#49304174", "title": "Why the shared variable between Go routines won&#39;t updated", "body": "<p>Necessary reading for understanding - <a href=\"https://golang.org/ref/mem\" rel=\"nofollow noreferrer\">The Go Memory Model</a></p>\n\n<blockquote>\n  <p>The Go memory model specifies the conditions under which reads of a variable in one goroutine can be guaranteed to observe values produced by writes to the same variable in a different goroutine. </p>\n</blockquote>\n\n<p>Whenever you have 2 or more concurrent goroutines accessing same memory and one of them modifying memory (like <code>i++</code> in your example) you need to have some sort of synchronization: <a href=\"https://golang.org/ref/mem#tmp_8\" rel=\"nofollow noreferrer\">mutex</a> or <a href=\"https://golang.org/ref/mem#tmp_7\" rel=\"nofollow noreferrer\">channel</a>.</p>\n\n<p>Something like this would be smallest modification necessary to your code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n\n    var (\n        mu sync.Mutex\n        i  uint64\n    )\n\n    go func() {\n        for {\n            mu.Lock()\n            i++\n            mu.Unlock()\n        }\n    }()\n\n    time.Sleep(time.Second)\n\n    mu.Lock()\n    fmt.Println(i)\n    mu.Unlock()\n}\n</code></pre>\n\n<p>Oh and official <a href=\"https://golang.org/ref/mem#tmp_1\" rel=\"nofollow noreferrer\">Advice</a>:</p>\n\n<blockquote>\n  <p>If you must read the rest of this document to understand the behavior of your program, you are being too clever. <strong>Don't be clever.</strong></p>\n</blockquote>\n\n<p>:) have fun</p>\n"}], "owner": {"reputation": 7193, "user_id": 363663, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c59cd40f0edcd3feea80c7ca09bc8e76?s=128&d=identicon&r=PG", "display_name": "sof", "link": "https://stackoverflow.com/users/363663/sof"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1010, "favorite_count": 2, "accepted_answer_id": 49289342, "answer_count": 4, "score": 1, "last_activity_date": 1521162200, "creation_date": 1521068757, "last_edit_date": 1521162200, "question_id": 49289025, "link": "https://stackoverflow.com/questions/49289025/why-the-shared-variable-between-go-routines-wont-updated", "title": "Why the shared variable between Go routines won&#39;t updated", "body": "<p>Why does the code snippet below print out <code>0</code>? However, <code>i</code> is correctly updated to <code>1</code> without the <code>for</code> loop.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n\n    var i uint64\n    go func() {\n        for {\n            i++\n        }\n    }()\n\n    time.Sleep(time.Second)\n    fmt.Println(i)\n}\n</code></pre>\n\n<p><strong>Solution 1</strong></p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"runtime\"\n        \"time\"\n)\n\nfunc main() {\n\n        runtime.GOMAXPROCS(1)\n\n        var i uint64\n        ch := make(chan bool)\n        go func() {\n                for {\n                        select {\n                        case &lt;-ch:\n                                return\n                        default:\n                                i++\n                        }\n                }\n        }()\n\n        time.Sleep(time.Second)\n        ch &lt;- true\n        fmt.Println(i)\n}\n</code></pre>\n\n<p><strong>Solution 2</strong></p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"runtime\"\n        \"sync\"\n        \"time\"\n)\n\nfunc main() {\n\n        runtime.GOMAXPROCS(1)\n\n        var i uint64\n        var mx sync.Mutex\n        go func() {\n                for {\n                        mx.Lock()\n                        i++\n                        mx.Unlock()\n                }\n        }()\n\n        time.Sleep(time.Second)\n        mx.Lock()\n        fmt.Println(i)\n        mx.Unlock()\n}\n</code></pre>\n\n<p><strong>Solution 3</strong></p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"runtime\"\n        \"sync/atomic\"\n        \"time\"\n)\n\nfunc main() {\n\n        runtime.GOMAXPROCS(1)\n\n        var i uint64\n        go func() {\n                for {\n                        atomic.AddUint64(&amp;i, 1)\n                        runtime.Gosched()\n                }\n        }()\n\n        time.Sleep(time.Second)\n        fmt.Println(atomic.LoadUint64(&amp;i))\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 2341, "user_id": 8391703, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JS46C.png?s=128&g=1", "display_name": "Zachscs", "link": "https://stackoverflow.com/users/8391703/zachscs"}, "edited": false, "score": 0, "creation_date": 1521069809, "post_id": 49288761, "comment_id": 85581497, "body": "I would say use a Collator but the main branch of mgo does not support this feature it would seem."}], "answers": [{"tags": [], "owner": {"reputation": 2341, "user_id": 8391703, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/JS46C.png?s=128&g=1", "display_name": "Zachscs", "link": "https://stackoverflow.com/users/8391703/zachscs"}, "is_accepted": true, "score": 0, "last_activity_date": 1521070393, "creation_date": 1521070393, "answer_id": 49289247, "question_id": 49288761, "link": "https://stackoverflow.com/questions/49288761/mgo-all-query-an-array-with-an-array-and-be-case-insensitive/49289247#49289247", "title": "mgo $all query an array with an array and be case insensitive?", "body": "<p>I was able to accomplish this using a <code>for</code> loop to build a <code>slice</code> of type <code>bson.RegEx</code>.</p>\n\n<pre><code>if qryPrms[\"ingredients\"] != nil {\n        var ingRegEx []bson.RegEx\n        for i := range qryPrms[\"ingredients\"] {\n            ingRegEx = append(ingRegEx, bson.RegEx{Pattern: qryPrms[\"ingredients\"][i], Options: \"i\"})\n        }\n        mongodQ[\"ingredients.name\"] = bson.M{\"$all\": ingRegEx}\n    }\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9494228"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 278, "favorite_count": 0, "accepted_answer_id": 49289247, "answer_count": 1, "score": 0, "last_activity_date": 1521133521, "creation_date": 1521067197, "last_edit_date": 1521133521, "question_id": 49288761, "link": "https://stackoverflow.com/questions/49288761/mgo-all-query-an-array-with-an-array-and-be-case-insensitive", "title": "mgo $all query an array with an array and be case insensitive?", "body": "<p>I have an array of ingredient names that is dynamic and provided per user. I'd like to match it to <code>mongo</code> documents where there is an <code>array</code> of objects called <code>ingredients</code> which has a property <code>name</code>. I've written a query (see below) which will take query parameters from the URL and will return all the documents that have all matching ingredient names, however this search is case sensitive and I'd like it not to be. </p>\n\n<p>I've considered using <code>bson.RegEx</code> with <code>Option: \"i\"</code>, however I'm not sure how to form this query or apply it to an array of strings.</p>\n\n<p>Here is the case sensitive query:</p>\n\n<pre><code>// Check for ingredients, return all recipes that can be made using supplied ingredients\nif qryPrms[\"ingredients\"] != nil {\n    mongodQ[\"ingredients.name\"] = bson.M{\"$all\": qryPrms[\"ingredients\"]}\n}\n</code></pre>\n\n<p><code>mongodQ</code> is the <code>bson.M</code> I use to query the collection later in the code. Ideally I could apply <code>RegEx</code> to each element in <code>qryPrms[\"ingredients\"]</code> so it would return closely matching ingredients like <code>cheese</code> would return <code>swiss cheese</code> as well. This is also a more general <code>mongodb</code> question I suppose when it comes to querying with a dynamic array.</p>\n"}, {"tags": ["json", "go", "escaping", "go-templates"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1521067154, "post_id": 49288607, "comment_id": 85580648, "body": "From the docs of <a href=\"https://golang.org/pkg/io/#Pipe\" rel=\"nofollow noreferrer\">io.Pipe()</a> <i>&quot;That is, each Write to the PipeWriter blocks until it has satisfied one or more Reads from the PipeReader that fully consume the written data.&quot;</i> Use a goroutine to allow the pipe reader and wirter to work in sync."}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1521068436, "post_id": 49288607, "comment_id": 85581093, "body": "Thanks!, but now I&#180;m getting another error when decoding, it says: &quot;invalid character &amp; looking for beginning of object key string&quot;. Should I edit my question?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1521068586, "post_id": 49288607, "comment_id": 85581132, "body": "That is a json error due to the format you are passing when hitting the api function which is getting in the body. So correct json"}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1521068858, "post_id": 49288607, "comment_id": 85581198, "body": "It&#180;s a valid json, from the client I&#180;m using &quot;JSON.stringify(data)&quot; with fetch"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1521069365, "post_id": 49288607, "comment_id": 85581357, "body": "Can you print you body here and show us the output"}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1521069949, "post_id": 49288607, "comment_id": 85581539, "body": "<a href=\"https://www.dropbox.com/s/ue136s6qwwlibqc/Screenshot_4.png?dl=0\" rel=\"nofollow noreferrer\">link</a>   <a href=\"https://www.dropbox.com/s/9itlxlwchdxdvs2/Screenshot_6.png?dl=0\" rel=\"nofollow noreferrer\">link</a>"}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1521070572, "post_id": 49288607, "comment_id": 85581723, "body": "<a href=\"https://www.dropbox.com/s/76xbqt1hskuvnsa/Screenshot_11.png?dl=0\" rel=\"nofollow noreferrer\">console in client</a>----- <a href=\"https://www.dropbox.com/s/bolrp1oa50htebt/Screenshot_12.png?dl=0\" rel=\"nofollow noreferrer\">client request code</a>   ----- <a href=\"https://www.dropbox.com/s/877d8yucggrnch3/Screenshot_5.png?dl=0\" rel=\"nofollow noreferrer\">print in terminal</a>  ------ <a href=\"https://www.dropbox.com/s/9itlxlwchdxdvs2/Screenshot_6.png?dl=0\" rel=\"nofollow noreferrer\">back end code</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1521093943, "post_id": 49288607, "comment_id": 85587606, "body": "@JohnBalvinArias Why are you passing valid json to <code>HTMLEscape</code>? You probably don&#39;t want to do that."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1521094062, "post_id": 49288607, "comment_id": 85587648, "body": "... <a href=\"https://play.golang.org/p/3NOfKbKDzpN\" rel=\"nofollow noreferrer\">play.golang.org/p/3NOfKbKDzpN</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1521094163, "post_id": 49288607, "comment_id": 85587676, "body": "@JohnBalvinArias do not link to images unless necessary, it is much better if you update your question with text containing the json data, the struct type definition into which your decoding, and the console/terminal output."}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1521101294, "post_id": 49288607, "comment_id": 85590674, "body": "@mkopriva thanks for suggestion, I can see now where I was wrong, I have to scape only the fields from json, not json itself. If you could make it as an answer I will mark it as valid answer. Thanks a lot!"}], "answers": [{"comments": [{"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1521070157, "post_id": 49289128, "comment_id": 85581604, "body": "not working <a href=\"https://www.dropbox.com/s/877d8yucggrnch3/Screenshot_5.png?dl=0\" rel=\"nofollow noreferrer\">link</a>  <a href=\"https://www.dropbox.com/s/9itlxlwchdxdvs2/Screenshot_6.png?dl=0\" rel=\"nofollow noreferrer\">link</a>"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1521070494, "post_id": 49289128, "comment_id": 85581698, "body": "then there is something wrong in the format of struct <code>[]customStruct</code> in which you are decoding the json. Match for struct fields before encoding the json"}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1521071142, "post_id": 49289128, "comment_id": 85581875, "body": "Both fields from request match the struct <a href=\"https://www.dropbox.com/s/jsel327azdrbv76/Screenshot_13.png?dl=0\" rel=\"nofollow noreferrer\">item1</a>---<a href=\"https://www.dropbox.com/s/2005eewegaxa7la/Screenshot_14.png?dl=0\" rel=\"nofollow noreferrer\">item2</a> ---- <a href=\"https://www.dropbox.com/s/76xbqt1hskuvnsa/Screenshot_11.png?dl=0\" rel=\"nofollow noreferrer\">console in client</a> ----<a href=\"https://www.dropbox.com/s/bolrp1oa50htebt/Screenshot_12.png?dl=0\" rel=\"nofollow noreferrer\">client request code</a>  ---<a href=\"https://www.dropbox.com/s/877d8yucggrnch3/Screenshot_5.png?dl=0\" rel=\"nofollow noreferrer\">print body in terminal</a>  ----<a href=\"https://www.dropbox.com/s/9itlxlwchdxdvs2/Screenshot_6.png?dl=0\" rel=\"nofollow noreferrer\">back end code</a>"}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1521069644, "creation_date": 1521069644, "answer_id": 49289128, "question_id": 49288607, "link": "https://stackoverflow.com/questions/49288607/scape-html-from-json-post-request-in-go/49289128#49289128", "title": "scape html from json post request in go", "body": "<p>According to <a href=\"https://golang.org/pkg/encoding/json/#Decoder.Decode\" rel=\"nofollow noreferrer\">GoLang json package</a></p>\n\n<blockquote>\n  <p>Decode reads the next JSON-encoded value from its input and stores it\n  in the value pointed to by v.</p>\n</blockquote>\n\n<pre><code>func (dec *Decoder) Decode(v interface{}) error\n</code></pre>\n\n<p>The error is due to decode will take the address to <code>[]customStruct</code> while you are passing the value. Change here</p>\n\n<pre><code>func anyFunction(w http.ResponseWriter, r *http.Request) {\n    body, err := ioutil.ReadAll(r.Body)\n    if err != nil {\n        log.Print(err)\n    }\n    ri, wo := io.Pipe()\n    go template.HTMLEscape(wo, body)   \n    var t []customStruct\n    json.NewDecoder(ri).Decode(&amp;t)\n    ...\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1521107485, "post_id": 49295441, "comment_id": 85594348, "body": "Thanks, but I think the json package need a method to solve this, because it makes repeating the same code with diferent structs, with such a basic problem"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 0, "last_activity_date": 1521105422, "creation_date": 1521105422, "answer_id": 49295441, "question_id": 49288607, "link": "https://stackoverflow.com/questions/49288607/scape-html-from-json-post-request-in-go/49295441#49295441", "title": "scape html from json post request in go", "body": "<p>Do not html-escape the whole valid json payload, you are inadvertently invalidating it which causes the json decoding to fail.</p>\n\n<p>If you need to sanitize values contained <em>in</em> the valid json, you can do so either after you first unmarshal it, or during the unmarshaling by implementing the <code>json.Unmarshaler</code> interface on a custom type which could then sanitize the raw bytes of the value.</p>\n"}], "owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 289, "favorite_count": 0, "accepted_answer_id": 49295441, "answer_count": 2, "score": 0, "last_activity_date": 1521105422, "creation_date": 1521066406, "last_edit_date": 1521069216, "question_id": 49288607, "link": "https://stackoverflow.com/questions/49288607/scape-html-from-json-post-request-in-go", "title": "scape html from json post request in go", "body": "<p>I want to scape to html some json in request but it doesn\u00b4t work, I get an error when decoding json</p>\n\n<pre><code>import (\n    \"html/template\" \n    \"encoding/json\"\n    \"net/http\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n)\n\nfunc anyFunction(w http.ResponseWriter, r *http.Request) {\n    body, err := ioutil.ReadAll(r.Body)\n    if err != nil {\n        log.Print(err)\n    }\n    ri, wo := io.Pipe()\n    go template.HTMLEscape(wo, body)   \n    var t []customStruct\n    json.NewDecoder(ri).Decode(t) //error: Invalid character:'&amp;' looking for beginning of object key string\n    ...\n}\n</code></pre>\n\n<p>The json coming from the client it\u00b4s valid because I\u00b4m using \"JSON.stringify(data)\"\nGo 1.9.4</p>\n"}, {"tags": ["docker", "go", "mgo"], "comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1521070297, "post_id": 49287039, "comment_id": 85581649, "body": "What is the address you are trying to connect to?"}, {"owner": {"reputation": 91, "user_id": 3688643, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bf4e42fea6baf94120905cee74a0cc9?s=128&d=identicon&r=PG&f=1", "display_name": "Bruno Novais", "link": "https://stackoverflow.com/users/3688643/bruno-novais"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1521071758, "post_id": 49287039, "comment_id": 85582069, "body": "@MichaelHampton It&#39;s a cluster on MongoDB Atlas ([cluster-shard].mongodb.net:27017. Just for testing purposes it&#39;s allowing access from anywhere (0.0.0.0/0). I&#39;m connected to it using MongoDB Compass, and there are some documents as well. My first thought was also some type of connection issue, so I tried to ping the cluster from within the machine, and also use nc -z to test the port (both tests were fine)."}], "answers": [{"tags": [], "owner": {"reputation": 91, "user_id": 3688643, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bf4e42fea6baf94120905cee74a0cc9?s=128&d=identicon&r=PG&f=1", "display_name": "Bruno Novais", "link": "https://stackoverflow.com/users/3688643/bruno-novais"}, "is_accepted": true, "score": 2, "last_activity_date": 1521131852, "creation_date": 1521131852, "answer_id": 49304794, "question_id": 49287039, "link": "https://stackoverflow.com/questions/49287039/no-reachable-servers-on-static-linked-go-binary/49304794#49304794", "title": "No reachable servers on static linked go binary", "body": "<p>Just solved the mystery. It's indeed related to the docker base image, and not to the build step.</p>\n\n<p>It'll work perfectly if I do:</p>\n\n<pre><code>FROM debian\nRUN apt-get update\nRUN apt-get install -y ca-certificates\n</code></pre>\n\n<p>As my goal is to use the alpine image, I'm using the following right now:</p>\n\n<pre><code>FROM alpine\nRUN apk --no-cache add ca-certificates\n</code></pre>\n\n<p>Hope that helps someone with the same problem. For more information, see: <a href=\"http://blog.cloud66.com/x509-error-when-using-https-inside-a-docker-container/\" rel=\"nofollow noreferrer\">http://blog.cloud66.com/x509-error-when-using-https-inside-a-docker-container/</a></p>\n\n<p>PS.: mgo (no reachable servers) error message was pointing me out in the wrong direction.</p>\n"}], "owner": {"reputation": 91, "user_id": 3688643, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bf4e42fea6baf94120905cee74a0cc9?s=128&d=identicon&r=PG&f=1", "display_name": "Bruno Novais", "link": "https://stackoverflow.com/users/3688643/bruno-novais"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 0, "accepted_answer_id": 49304794, "answer_count": 1, "score": 3, "last_activity_date": 1521131852, "creation_date": 1521059028, "last_edit_date": 1521062329, "question_id": 49287039, "link": "https://stackoverflow.com/questions/49287039/no-reachable-servers-on-static-linked-go-binary", "title": "No reachable servers on static linked go binary", "body": "<p>Depending on where my binary is being executed, I get different results on mgo Dial.</p>\n\n<p>Right now, I'm building on my machine (Fedora: uname -a: Linux localhost.localdomain 4.15.6-300.fc27.x86_64 #1 SMP Mon Feb 26 18:43:03 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux) using the following command:</p>\n\n<pre><code>$ CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -a -ldflags '-s' -o myProgram\n</code></pre>\n\n<p>So, if I build my docker image using:</p>\n\n<pre><code>FROM centos\nCOPY myProgram \"/usr/local/bin/myProgram\"\nENTRYPOINT [\"/usr/local/bin/myProgram\"]\n</code></pre>\n\n<p>It works perfectly. That means I'm connected to the database. But, if I change to:</p>\n\n<pre><code>FROM debian\nCOPY myProgram \"/usr/local/bin/myProgram\"\nENTRYPOINT [\"/usr/local/bin/myProgram\"]\n</code></pre>\n\n<p>I'm getting <strong>no reachable servers</strong>. My goal is to compile the application on gitlab-ci using the golang image, and run it on a alpine container.</p>\n\n<p>The question is: <strong>Why the same executable get different results on different base images?</strong></p>\n\n<p>Does mgo (or go) use something related to the OS? I mean, it seems that my binary will run only on red hat based distribution (just a guess, it doesn't make much sense to me right now.)</p>\n\n<p>Dial source code:</p>\n\n<pre><code>dialInfo := &amp;mgo.DialInfo{\n    Addrs:          config.Addr,\n    Database:       config.Auth,\n    Username:       config.User,\n    Password:       config.Pass,\n    ReplicaSetName: config.ReplicaSet,\n    Timeout:        time.Second * 10,\n}\ndialInfo.DialServer = func(addr *mgo.ServerAddr) (net.Conn, error) {\n    return tls.Dial(\"tcp\", addr.String(), &amp;tls.Config{})\n}\n\nsession, err := mgo.DialWithInfo(dialInfo)\nif err != nil {\n    log.Fatal(err.Error())\n}\n</code></pre>\n"}, {"tags": ["go", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 3134, "user_id": 3884750, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100003183948251/picture?type=large", "display_name": "Oleg  Sobchuk", "link": "https://stackoverflow.com/users/3884750/oleg-sobchuk"}, "edited": false, "score": 1, "creation_date": 1521653153, "post_id": 49306648, "comment_id": 85827473, "body": "thx, it works! Just format should be <code>&quot;02&#47;01&#47;2006&quot;</code> for <code>dd&#47;mm&#47;yyyy</code>"}, {"owner": {"reputation": 799, "user_id": 2980967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ecQ8D.jpg?s=128&g=1", "display_name": "dustinevan", "link": "https://stackoverflow.com/users/2980967/dustinevan"}, "reply_to_user": {"reputation": 3134, "user_id": 3884750, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100003183948251/picture?type=large", "display_name": "Oleg  Sobchuk", "link": "https://stackoverflow.com/users/3884750/oleg-sobchuk"}, "edited": false, "score": 0, "creation_date": 1521734032, "post_id": 49306648, "comment_id": 85867960, "body": "great! I fixed the date fmt in the answer."}], "tags": [], "owner": {"reputation": 799, "user_id": 2980967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ecQ8D.jpg?s=128&g=1", "display_name": "dustinevan", "link": "https://stackoverflow.com/users/2980967/dustinevan"}, "is_accepted": true, "score": 3, "last_activity_date": 1521734003, "last_edit_date": 1521734003, "creation_date": 1521137991, "answer_id": 49306648, "question_id": 49285635, "link": "https://stackoverflow.com/questions/49285635/golang-gorilla-parse-date-with-specific-format-from-form/49306648#49306648", "title": "Golang gorilla parse date with specific format from form", "body": "<p>I haven't tested this answer because I don't have time to build up an example, but according to this: <a href=\"http://www.gorillatoolkit.org/pkg/schema\" rel=\"nofollow noreferrer\">http://www.gorillatoolkit.org/pkg/schema</a> </p>\n\n<blockquote>\n  <p>The supported field types in the destination struct are:</p>\n  \n  <ul>\n  <li>bool</li>\n  <li>float variants (float32, float64)</li>\n  <li>int variants (int, int8, int16, int32, int64)</li>\n  <li>string</li>\n  <li>uint variants (uint, uint8, uint16, uint32, uint64)</li>\n  <li>struct</li>\n  <li>a pointer to one of the above types</li>\n  <li>a slice or a pointer to a slice of one of the above types </li>\n  </ul>\n  \n  <p>Non-supported types are simply ignored, however custom types can be \n  registered to be converted.</p>\n</blockquote>\n\n<p>so you need to say: </p>\n\n<pre><code>var timeConverter = func(value string) reflect.Value {\n    if v, err := time.Parse(\"02/01/2006\", value); err == nil {\n        return reflect.ValueOf(v)\n    }\n    return reflect.Value{} // this is the same as the private const invalidType\n}\n\nfunc MyRoute(w http.ResponseWriter, r *http.Request) {\n    user := User{}\n    r.ParseForm()\n    defer r.Body.Close()\n    decoder := schema.NewDecoder()\n    decoder.RegisterConverter(time.Time{}, timeConverter)\n\n    if err := decoder.Decode(&amp;user, r.Form); err != nil {\n        fmt.Println(err)\n    }\n}\n</code></pre>\n\n<p>see: <a href=\"https://github.com/gorilla/schema/blob/master/decoder.go\" rel=\"nofollow noreferrer\">https://github.com/gorilla/schema/blob/master/decoder.go</a></p>\n"}], "owner": {"reputation": 3134, "user_id": 3884750, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100003183948251/picture?type=large", "display_name": "Oleg  Sobchuk", "link": "https://stackoverflow.com/users/3884750/oleg-sobchuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1531, "favorite_count": 0, "accepted_answer_id": 49306648, "answer_count": 1, "score": 1, "last_activity_date": 1521734003, "creation_date": 1521053461, "last_edit_date": 1521173983, "question_id": 49285635, "link": "https://stackoverflow.com/questions/49285635/golang-gorilla-parse-date-with-specific-format-from-form", "title": "Golang gorilla parse date with specific format from form", "body": "<p>I receive date from form. This date has specific format \"dd/mm/yyyy\". </p>\n\n<p>For parsing it to my struct I use gorilla/schema package, but this package can't recognize received data as date.</p>\n\n<p>How I can parse date and put it in struct right way? As field it has format \"01/02/2006\"</p>\n\n<p>My implementation:</p>\n\n<pre><code>type User struct {\n  Date   time.Time `schema:\"date\"`\n}\n\n\nfunc MyRoute(w http.ResponseWriter, r *http.Request) {\n  user := User{}\n  r.ParseForm()\n  defer r.Body.Close()\n\n  decoder := schema.NewDecoder()\n  if err := decoder.Decode(&amp;user, r.Form); err != nil {\n     fmt.Println(err)\n  }\n  .......................\n}\n</code></pre>\n"}, {"tags": ["go", "twilio"], "answers": [{"tags": [], "owner": {"reputation": 53136, "user_id": 28376, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ec1383b240b5ba15ffb9743fceb3c0e?s=128&d=identicon&r=PG", "display_name": "philnash", "link": "https://stackoverflow.com/users/28376/philnash"}, "is_accepted": false, "score": 1, "last_activity_date": 1521070634, "creation_date": 1521070634, "answer_id": 49289293, "question_id": 49284374, "link": "https://stackoverflow.com/questions/49284374/twilo-how-to-handle-the-timeout-in-dial/49289293#49289293", "title": "Twilo How to Handle the Timeout in Dial", "body": "<p>Twilio developer evangelist here.</p>\n\n<p>The behaviour of <a href=\"https://www.twilio.com/docs/api/twiml/dial\" rel=\"nofollow noreferrer\"><code>&lt;Dial&gt;</code></a> when there is no <a href=\"https://www.twilio.com/docs/api/twiml/dial#attributes-action\" rel=\"nofollow noreferrer\"><code>action</code> attribute</a> is to continue with the TwiML below it once the call is finished, whether by timeout or through a successful call.</p>\n\n<p>If you add a URL as the <code>action</code> attribute, then the behaviour changes and <code>&lt;Dial&gt;</code> will always make a request to the <code>action</code> URL once the call is completed. The important difference here though, is that the URL will be called with a <a href=\"https://www.twilio.com/docs/api/twiml/dial#attributes-action-dial-call-status-values\" rel=\"nofollow noreferrer\"><code>DialCallStatus</code> parameter</a> that will be one of \"completed\", \"answered\", \"busy\", \"no-answer\", \"failed\" and \"canceled\". This way you can check if the call was busy or not answered and return the TwiML for recording a message. Or if the call was completed successfully, you can just return <a href=\"https://www.twilio.com/docs/api/twiml/hangup\" rel=\"nofollow noreferrer\"><code>&lt;Hangup/&gt;</code></a>.</p>\n\n<p>Let me know if that helps at all.</p>\n"}], "owner": {"reputation": 23, "user_id": 7715173, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-tEtXjZ7ppkY/AAAAAAAAAAI/AAAAAAAACFI/7bdF-4UJp74/photo.jpg?sz=128", "display_name": "Parasa Charles", "link": "https://stackoverflow.com/users/7715173/parasa-charles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 604, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1586144751, "creation_date": 1521049092, "last_edit_date": 1521050457, "question_id": 49284374, "link": "https://stackoverflow.com/questions/49284374/twilo-how-to-handle-the-timeout-in-dial", "title": "Twilo How to Handle the Timeout in Dial", "body": "<p>I need to record a voice of my clients who is try to reach one of our advisors. This should happen when there is timeout </p>\n\n<ol>\n<li><p>User calls -->Number-----> If timeout --> say(Record your message)--> on end of the recording it should call the recordingStatusCallBack</p></li>\n<li><p>User Call --> Number -->  answer call success --> On end of the call it should call method. Not sure where should we put the action either on number (statuscallback) or on the dial Action verb?</p></li>\n</ol>\n\n<p>To achieve this I am try with the below twiML </p>\n\n<pre><code>&lt;Response&gt;\n   &lt;Dial callerId=\"+123124\" record=\"true\" timeout=\"10\"&gt;\n  &lt;Number \n  statusCallback=\"https://&lt;123134&gt;.ngrok.io/ttwilio/callStatusCallBack\" \n  statusCallbackEvent=\"completed\" \n  statusCallbackMethod=\"POST\"&gt;+1232424/Number&gt;\n &lt;/Dial&gt; \n &lt;Say&gt;Please Record you message&lt;/Say&gt; \n   &lt;Record \n     recordingStatusCallback=\n      \"https://&lt;123134&gt;.ngrok.io/ttwilio/callStatusCallback\" \n       recordingStatusCallbackMethod=\"POST\"/&gt;\n&lt;/Response&gt;\n</code></pre>\n\n<p>This works fine when there is a timeout but when the call is successfully ended twilio still ask for the user to \"Please Record you message\"</p>\n\n<p>How to achieve this task?</p>\n"}, {"tags": ["go", "amazon-s3", "snowball"], "answers": [{"tags": [], "owner": {"reputation": 115, "user_id": 1426181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f82fb43edbaa3575bb0d84e4bfc881f8?s=128&d=identicon&r=PG", "display_name": "user1426181", "link": "https://stackoverflow.com/users/1426181/user1426181"}, "is_accepted": true, "score": 0, "last_activity_date": 1525805989, "creation_date": 1525805989, "answer_id": 50240608, "question_id": 49284342, "link": "https://stackoverflow.com/questions/49284342/snowball-edge-aws-sdk-go-package-in-golang-cant-connect-to-s3/50240608#50240608", "title": "Snowball Edge - aws-sdk-go package in Golang - Can&#39;t Connect to S3", "body": "<p>Snowball Edge is a very different beast than is AWS S3. In addition to the access key and secret access key, it requires that an endpoint and additional credentials in the form of a certificate. The real AWS S3 has a valid certificate, supported by the certificate authorities, but Snowball Edge has a self-signed certificate.</p>\n\n<p>The configuration can be created with this:</p>\n\n<pre><code>cfg := aws.NewConfig().WithRegion(s3Config.S3Region).WithCredentials(creds).WithEndpoint(s3Config.S3Endpoint).WithHTTPClient(httpClient)\nsvc = s3.New(session.New(), cfg)\n</code></pre>\n\n<p>The endpoint looks like this (you see Snowball Edge responding on port 8443 in the question text above):</p>\n\n<pre><code>https://192.168.1.4:8443\n</code></pre>\n\n<p>The certificate is required to be formatted like you'd have in a file (including all the new line characters. It looks like this (again, the string you pass in has to include the new line characters after every line):</p>\n\n<pre><code>-----BEGIN CERTIFICATE-----\nMIIC7zCCAdegAwIBAgIJBJZB/gkBP0B5MA0GCSqGSIb3DQEBCwUAMBYxFDASBgNV\nBAMMCzE3Mi4yMC4xLjE3NB4XDTE3MDQyODIwMTMwOFoXDTE5MDQxODIwMTMwOFow\nFjEUMBIGA1UEAwwLMTcyLjIwLjEuMTcwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAw\nggEKAoIBAQCrLWlTfrSj9R1of5Z98EHYIEEPBgnWxnlrvA+ryAzPmiXbYomI4Tpl\nPsuIA+7hGXG10H0zwlz0n22EUv4pE79toYcd3czOJUAHEuSelhtP7u91vM4GguFx\nA00gosu04RFUD+BYNeaLTQfd7vdmQB3bY3KEbn7Dfrs/1MYFhKb8J77mgCuUbAPu\nPNvwLoV+hBL+ndgs+bIu4MtXjUJDiigRZkacpMQaduDMqEq6seoc+JwrKNBjRBRu\n3l/fcQoWf+g902oZJaXXnVGqqb7o2YAQFehUAbmCJfuKFSl5tu0B+3KvQQni7lK+\nSV8WItdrPumS98BBlt6NpzgC5fTwCmapAgMBAAGjQDA+MAwGA1UdEwQFMAMBAf8w\nHQYDVR0OBBYEFMAvKzKgKI+izqPX6DJjJz/0fELtMA8GA1UdEQQIMAaHBKwUAREw\nDQYJKoZIhvcNAQELBQADggEBAGwyzmI+9psQu9/N/oClN7Lej7e4E8cC8vymVfPz\nfdW45IMNVEYHxHbu9+JzLOtLxfuDmD6B6fEYVoPubb6tsnacuwOSMZhTvhhy9nv2\nf+2Pslgj/kYTeMePbHOPTyQ4sd1BE7ALdNiL/hd08ZNhqObagixNYw9eYeHEStBy\ntOADKcY9gOxek1k9t+96nATgSy0WIytwra0uEgyipKQ2gXKpgg15SI4nDxQLLEgG\nlb3FtRk+PfJxQ4zbHZe/cRNflcGwVCefycLQOA2Sdr8pgHW7gvETu9i9ywF0UV6f\nb9wsPcDmg3EaxBa+wrLlYSzaPhI+rZYh6bpnTn311QIFZ+s=\n-----END CERTIFICATE-----\n</code></pre>\n\n<p>Found the Snowball Edge to be pretty fast storage using S3. We were able to achieve about 1,100 MBytes/second of copy rate.</p>\n"}], "owner": {"reputation": 115, "user_id": 1426181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f82fb43edbaa3575bb0d84e4bfc881f8?s=128&d=identicon&r=PG", "display_name": "user1426181", "link": "https://stackoverflow.com/users/1426181/user1426181"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "accepted_answer_id": 50240608, "answer_count": 1, "score": 0, "last_activity_date": 1539504658, "creation_date": 1521048997, "last_edit_date": 1539504658, "question_id": 49284342, "link": "https://stackoverflow.com/questions/49284342/snowball-edge-aws-sdk-go-package-in-golang-cant-connect-to-s3", "title": "Snowball Edge - aws-sdk-go package in Golang - Can&#39;t Connect to S3", "body": "<p>I'm using the aws-sdk-go package in Golang to connect to Amazon S3 to provide a cloud-based storage pool. I have this working well. I would like to be able to support bulk high-speed transfers using Snowball, so I got a Snowball Edge to test this in my lab. I have not figured out how to get this working, and the documentation for Snowball Edge doesn't seem complete. This configuration may be impacted by having ordered a Snowball Edge and not just a Snowball.</p>\n\n<p>The reason that I'm finding the Edge more problematic, is that a normal Snowball requires an application called snowballAdapter to be running, which looks like it handles some port mapping issues. But, this application seems to be incompatible with the Edge device, as it reports that it doesn't work with a \"Snowball Edge Manifest file\".</p>\n\n<p>I looked at the ports that are available on the real AWS S3 and nmap reports:</p>\n\n<pre><code>nmap -v -sT -Pn s3.us-east-1.amazonaws.com\n...\nScanning s3.us-east-1.amazonaws.com (52.216.161.53) [1000 ports]\nDiscovered open port 443/tcp on 52.216.161.53\nDiscovered open port 80/tcp on 52.216.161.53\n</code></pre>\n\n<p>Whereas on Snowball Edge, the ports are:</p>\n\n<pre><code>nmap -v -sT -Pn 192.168.1.4\n....\nScanning 192.168.1.4 [1000 ports]\nDiscovered open port 8080/tcp on 192.168.1.4\nDiscovered open port 22/tcp on 192.168.1.4\nDiscovered open port 9091/tcp on 192.168.1.4\nDiscovered open port 8443/tcp on 192.168.1.4\n....\nPORT     STATE SERVICE\n22/tcp   open  ssh\n8080/tcp open  http-proxy\n8443/tcp open  https-alt\n9091/tcp open  xmltec-xmlmail\n</code></pre>\n\n<p>So, it seems to me that the issue may be that I have to make the aws package use port 8443 for Snowball Edge instead of 443 for the real S3. The code for connecting to S3 is pretty straight forward:</p>\n\n<pre><code>creds := credentials.NewStaticCredentials(s3Config.S3AccessKey, s3Config.S3SecretAccessKey, s3Config.S3Token)\n_, err := creds.Get()\n\nif err != nil {\n    return nil, nil, err\n}\n\nif len(baseFolder) &gt; 0 {\n    baseFolder = baseFolder + \"/\"\n}\n\ncfg := aws.NewConfig().WithRegion(s3Config.S3Region).WithCredentials(creds)\nsvc := s3.New(session.New(), cfg)\n\nparams := &amp;s3.ListObjectsInput{\n    Bucket:    aws.String(s3Config.S3BucketName),\n    Prefix:    aws.String(baseFolder),\n    Delimiter: aws.String(\"/\"),\n}\n\nresp, err := svc.ListObjects(params)\n</code></pre>\n\n<p>So, the question is, how do I change the code to point to the Snowball Edge? I've tried mapping to the Snowball Edge in /etc/hosts from the Amazon S3 endpoint. I understand why this didn't work after discovering that the ports are different. I've played around with adding different forms of \"WithEndpoint(\"...host...\") with no success. Or, am I on the completely wrong track, and should be able to get the snowballAdapter to work with a Snowball Edge?</p>\n\n<p>By the way, all the snowballEdge commands work as expected, so the device seems to be working fine, e.g.:</p>\n\n<pre><code>./snowballEdge list-access-keys\n\n    {\n      \"AccessKeyIds\" : [ \"...\" ]\n    }\n\n./snowballEdge get-secret-access-key --access-key-id ....\n\n    [snowballEdge]\n    aws_access_key_id = ...\n    aws_secret_access_key = ...\n</code></pre>\n\n<p>And, I've used the correct keys associated with the device, and it does have the S3 Service configured in it:</p>\n\n<pre><code>./snowballEdge list-services\n{\n  \"ServiceIds\" : [ \"s3\" ]\n}\n</code></pre>\n"}, {"tags": ["go", "pact", "pact-go"], "comments": [{"owner": {"reputation": 12824, "user_id": 665163, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/20ao7.png?s=128&g=1", "display_name": "J_A_X", "link": "https://stackoverflow.com/users/665163/j-a-x"}, "edited": false, "score": 0, "creation_date": 1521075241, "post_id": 49283145, "comment_id": 85582950, "body": "Are you specifying a consumer contract from your Go implementation?  There&#39;s already a provider one, yes, but you&#39;ll need to create the consumer one as well with Twillio being the provider.  An example of what you&#39;re doing would be helpful to understand your issue further."}], "answers": [{"tags": [], "owner": {"reputation": 2503, "user_id": 1008568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32ca6dc55ad8675eaea178f42926f608?s=128&d=identicon&r=PG", "display_name": "Matthew Fellows", "link": "https://stackoverflow.com/users/1008568/matthew-fellows"}, "is_accepted": true, "score": 2, "last_activity_date": 1521110355, "creation_date": 1521110355, "answer_id": 49297263, "question_id": 49283145, "link": "https://stackoverflow.com/questions/49283145/provider-not-registering-interaction/49297263#49297263", "title": "Provider Not Registering Interaction", "body": "<p>Here's a few things to consider:</p>\n\n<ol>\n<li>It's better to have two separate contract tests between your <code>client</code> &lt;-> <code>Twilio Adapter</code>, and <code>Twilio Adapter &lt;-&gt; Twilio</code>. It's possible to do what you're doing, but it will make the tests more complicated and probably harder to read/comprehend. Testing them in isolation gives you much more control.</li>\n<li>When doing the former contract test, rather then daisy chain another pact mock service for your Twilio Adapter's (Provider) dependency (Twilio), you're best using standard mock/stub tooling for this job - either code based mocks/doubles, service doubles (e.g. Mountebank) or the stub server shipped with Pact [1]. Don't forget you will get to validate these assumptions with the other contract test, so you're safe to do this.</li>\n<li>It's possible that because you have two mock servers running (one to mock the Twilio Adapter and another to mock Twilio) that your requests are being sent to the <em>same</em> mock service, and getting all tangled up</li>\n</ol>\n\n<p><em>[1] Here is are the list of binaries etc. that are shipped with pact-go:</em></p>\n\n<pre><code>    tree -L 3 /path/to/pact-go\n\n    .\n    \u251c\u2500\u2500 pact\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 README.md\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 bin\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 pact-broker\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 pact-mock-service\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 pact-provider-verifier\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 pact-publish\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 pact-stub-service\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 lib\n    \u2502\u00a0\u00a0     \u251c\u2500\u2500 app\n    \u2502\u00a0\u00a0     \u251c\u2500\u2500 ruby\n    \u2502\u00a0\u00a0     \u2514\u2500\u2500 vendor\n    \u2514\u2500\u2500 pact-go\n</code></pre>\n"}], "owner": {"reputation": 312, "user_id": 1162540, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/h5f5Q.jpg?s=128&g=1", "display_name": "Alex Haynes", "link": "https://stackoverflow.com/users/1162540/alex-haynes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 49297263, "answer_count": 1, "score": 0, "last_activity_date": 1521130780, "creation_date": 1521045224, "last_edit_date": 1521130780, "question_id": 49283145, "link": "https://stackoverflow.com/questions/49283145/provider-not-registering-interaction", "title": "Provider Not Registering Interaction", "body": "<p>I'm using the <a href=\"https://github.com/pact-foundation/pact-go\" rel=\"nofollow noreferrer\">Pact Go implementation</a> to try out contract testing. I've made a provider test that isn't working because I need to mock out my service's request to Twilio.</p>\n\n<p>I've made one Pact object for the contract between my consumer and this provider, and then another one called twilioPact for the contract between my provider and Twilio. I've added an interaction for the POST to the Twilio endpoint, but in the pact.log I'm not seeing it get registered. My test is making the request correctly, but there's no interaction registered for it so I get the 500 error from the mock server.</p>\n\n<p>Does anyone have any experience using Pact with a 'provider' that is also a 'consumer'?</p>\n\n<p>EDIT: After talking with Matt Fellows I was informed that I was using Pact incorrectly, and shouldn't be trying to run a mock service while running a provider verification. I had suspected as much, but none of the examples I had seen were for a provider that had a dependency. I was able to get my provider verification to work by writing a consumer test and passing the generated pact file to the pact-stub-service to act as the mock to Twilio.</p>\n"}, {"tags": ["html", "go", "go-gin"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521030501, "post_id": 49277604, "comment_id": 85557925, "body": "<a href=\"https://github.com/gin-gonic/gin#html-rendering\" rel=\"nofollow noreferrer\">github.com/gin-gonic/gin#html-rendering</a>"}], "answers": [{"tags": [], "owner": {"reputation": 700, "user_id": 4229820, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/PSShC.jpg?s=128&g=1", "display_name": "Henri Koski", "link": "https://stackoverflow.com/users/4229820/henri-koski"}, "is_accepted": false, "score": 9, "last_activity_date": 1521031022, "creation_date": 1521031022, "answer_id": 49277989, "question_id": 49277604, "link": "https://stackoverflow.com/questions/49277604/how-to-render-html-with-golang-data-in-golang-gin-web-frame/49277989#49277989", "title": "How to render HTML with golang data in golang gin web frame?", "body": "<p>Usually you have a folder with template files so first you need to tell the gin where these templates are located:</p>\n\n<pre><code>router := gin.Default()\nrouter.LoadHTMLGlob(\"templates/*\")\n</code></pre>\n\n<p>Then in handler function you simply pass template name the data to HTML function like this:</p>\n\n<pre><code>func (s *Server) renderIndex(c *gin.Context) {\n    c.HTML(http.StatusOK, \"index.tmpl\", []string{\"a\", \"b\", \"c\"})\n}\n</code></pre>\n\n<p>In <code>index.tmpl</code> you can the loop the data like this:</p>\n\n<pre><code>{{range .}}\n    {{.}}\n{{end}}\n</code></pre>\n\n<p>The <code>.</code> is always the current context so in first line <code>.</code> is the input data and inside the range loop <code>.</code> is the current element.</p>\n\n<p>Template example: <a href=\"https://play.golang.org/p/4_IPwD3Y84D\" rel=\"noreferrer\">https://play.golang.org/p/4_IPwD3Y84D</a></p>\n\n<p>Documentation about templating: <a href=\"https://golang.org/pkg/text/template/\" rel=\"noreferrer\">https://golang.org/pkg/text/template/</a></p>\n\n<p>Great examples: <a href=\"https://astaxie.gitbooks.io/build-web-application-with-golang/en/07.4.html\" rel=\"noreferrer\">https://astaxie.gitbooks.io/build-web-application-with-golang/en/07.4.html</a></p>\n"}], "owner": {"reputation": 1458, "user_id": 5844373, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-MBAfdAizcDE/AAAAAAAAAAI/AAAAAAAAABY/Lozrw7PsuFE/photo.jpg?sz=128", "display_name": "\u672a\u6765\u9646\u5bb6\u5634\u9876\u5c16\u7684\u6295\u8d44\u4eba", "link": "https://stackoverflow.com/users/5844373/%e6%9c%aa%e6%9d%a5%e9%99%86%e5%ae%b6%e5%98%b4%e9%a1%b6%e5%b0%96%e7%9a%84%e6%8a%95%e8%b5%84%e4%ba%ba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5755, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1597435884, "creation_date": 1521029896, "last_edit_date": 1597435884, "question_id": 49277604, "link": "https://stackoverflow.com/questions/49277604/how-to-render-html-with-golang-data-in-golang-gin-web-frame", "title": "How to render HTML with golang data in golang gin web frame?", "body": "<p>I am trying to place a golang array (also slice, struct, etc.) to HTML so I can use array element in HTML Element content when returning HTML from golang gin web framework. Another problem is how to render these data with loop? Such as Flask jinja\nworks in this way.</p>\n<pre><code>{% block body %}\n  &lt;ul&gt;\n  {% for user in users %}\n  &lt;li&gt;&lt;a href=&quot;{{ user.url }}&quot;&gt;{{ user.username }}&lt;/a&gt;&lt;/li&gt;\n  {% endfor %}\n  &lt;/ul&gt;\n</code></pre>\n"}, {"tags": ["sql", "function", "go", "generalization"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1521022488, "post_id": 49274905, "comment_id": 85552332, "body": "To answer your general question: That&#39;s not idiomatic Go. Instead, find a way to pass in the receiver, rather than creating it dynamically. The latter is practically impossible, and far harder to use anyway."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1521022522, "post_id": 49274905, "comment_id": 85552357, "body": "But to answer your specific use case, why not just use <a href=\"https://godoc.org/github.com/jmoiron/sqlx#DB.Get\" rel=\"nofollow noreferrer\">sqlx.Get</a>?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1521023537, "post_id": 49274905, "comment_id": 85553105, "body": "There is no way you can create a dynamic struct with required type coming from the database. If you want to store the value dynamically use interface."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1521023748, "post_id": 49274905, "comment_id": 85553247, "body": "&quot;I want to write a generic function&quot; translated either to &quot;I&#39;m experienced in runtime reflection and willing to pay the runtime costs&quot; or to &quot;I&#39;ll fail miserably trying to do so.&quot; Consider redesigning."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1521024466, "post_id": 49274905, "comment_id": 85553740, "body": "Hint: json.Unmarshal does something very similar to what you want to do here. Pass the destination as <code>interface{}</code>."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1521024711, "post_id": 49274905, "comment_id": 85553917, "body": "<a href=\"https://godoc.org/github.com/jmoiron/sqlx#DB.Get\" rel=\"nofollow noreferrer\">sqlx.Get</a> as stated by @Flimzy is actually doing the same wrapping the result to an <code>interface{}</code>."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 3, "last_activity_date": 1521026444, "creation_date": 1521026444, "answer_id": 49276445, "question_id": 49274905, "link": "https://stackoverflow.com/questions/49274905/generalisation-of-function-in-golang/49276445#49276445", "title": "Generalisation of function in Golang", "body": "<p>To answer your general question: That's not idiomatic Go. Instead, find a way to pass in the receiver, rather than creating it dynamically. The latter is practically impossible, and far harder to use anyway.</p>\n\n<p>To answer your specific use case, just use either sqlx's <a href=\"https://godoc.org/github.com/jmoiron/sqlx#DB.Get\" rel=\"nofollow noreferrer\">DB.Get</a> or <a href=\"https://godoc.org/github.com/jmoiron/sqlx#DB.Select\" rel=\"nofollow noreferrer\">DB.Select</a>, which accomplish exactly the same thing as your proposed wrapper function, but in a Go-idiomatic way.</p>\n"}], "owner": {"reputation": 309, "user_id": 8591671, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ae21750ead1b346f8240ee5d5458fd1a?s=128&d=identicon&r=PG&f=1", "display_name": "John Snow", "link": "https://stackoverflow.com/users/8591671/john-snow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "accepted_answer_id": 49276445, "answer_count": 1, "score": -5, "last_activity_date": 1521151031, "creation_date": 1521022207, "last_edit_date": 1521151031, "question_id": 49274905, "link": "https://stackoverflow.com/questions/49274905/generalisation-of-function-in-golang", "title": "Generalisation of function in Golang", "body": "<p>I want to write a generic function which handles SQL queries.</p>\n\n<p><a href=\"http://jmoiron.github.io/sqlx\" rel=\"nofollow noreferrer\">Sqlx</a> module provides function <code>StructScan()</code>, which automatically scans results into struct fields.</p>\n\n<pre><code>type Place struct {\n    Country       string\n    City          sql.NullString\n    TelephoneCode int `db:\"telcode\"`\n}\n\nrows, err := db.Queryx(\"SELECT * FROM place\")\nfor rows.Next() {\n    var p Place\n    err = rows.StructScan(&amp;p)\n}\n</code></pre>\n\n<p>So, proposed function signature looks as:</p>\n\n<pre><code>func Query(db *sql.DB, query) {\n    rows, err := db.Queryx(\"SELECT * FROM place\")\n    for rows.Next() {\n        var p CustomType\n        err = rows.StructScan(&amp;p)\n    }\n}\n</code></pre>\n\n<p>The problem is that I do not know in advance the exact type of the variable denoted as Custom Type since it differs depending on a particular query (some queries returns <strong>string</strong>, another <strong>int</strong> etc). </p>\n\n<p>One of the options would be to pass <strong>type</strong> <code>CustomType</code> as argument to <code>Query</code>. However, I do not know how to initialise the local variable <code>p</code> with needed type.   </p>\n\n<p>Is there a way to do it?</p>\n"}, {"tags": ["go", "model-view-controller"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1521024211, "post_id": 49274801, "comment_id": 85553569, "body": "Do not execute your functions asynchronous and sync them but run them just synchronous?"}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 1, "last_activity_date": 1521024104, "creation_date": 1521024104, "answer_id": 49275569, "question_id": 49274801, "link": "https://stackoverflow.com/questions/49274801/how-to-sync-goroutine-if-called-function-are-from-different-package/49275569#49275569", "title": "how to sync goroutine if called function are from different package?", "body": "<p>Use a closure:</p>\n\n<pre><code>package main\n\nimport \"sync\"\n\nfunc main() {\n    wg := &amp;sync.WaitGroup{}\n    wg.Add(1)\n\n    go func() {\n            f() // doesn't matter in which package f is defined.\n            wg.Done()\n    }()\n\n    wg.Wait()\n}\n\nfunc f() {\n}\n</code></pre>\n"}], "owner": {"reputation": 1044, "user_id": 2931666, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/5gBzA.jpg?s=128&g=1", "display_name": "Abhi Adr", "link": "https://stackoverflow.com/users/2931666/abhi-adr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 292, "favorite_count": 0, "accepted_answer_id": 49275569, "answer_count": 1, "score": -2, "last_activity_date": 1521024104, "creation_date": 1521021956, "last_edit_date": 1521022108, "question_id": 49274801, "link": "https://stackoverflow.com/questions/49274801/how-to-sync-goroutine-if-called-function-are-from-different-package", "title": "how to sync goroutine if called function are from different package?", "body": "<p>To learn how to build web-app in Go, I have created small web app where I am using Gorilla mux and I have mainly below packages main, handlers, model, structs.</p>\n\n<p>I want to use goroutines while going through documentation I came to know that I need to use sync package along with go fun().\nI tried to use as shown below, within the same package and it is working fine. But how to sync goroutine if called function are from diffrent package?</p>\n\n<pre><code>// same package : working\npackage models\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nvar wg sync.WaitGroup\n\nfunc Func1() (string, error) {\n    lexpiry := ReadDatafrom()\n    wg.Add(1)\n    go validExp(string(lexpiry))\n    ----\n    ----\n    wg.Wait()\n    ----\n    return \"S/F\", err\n}\n\nfunc validExp(lexpiry string) {\n    fmt.Println(\"CHeck Expiry Date\")\n    wg.Done()\n}\n</code></pre>\n\n<p>But if I need to call a function of different package, of course I can add go keyword before package like: <code>go otherPackage.Function()</code></p>\n\n<p>But how will I sync it? I mean the function which we are calling with go must have wg.Done()?</p>\n\n<pre><code>// Diffrent package : ? ( need guidance how to achive this )\n\npackage handlers\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"go_mjolnir/models\"\n    \"net/http\"\n)\n\nvar wg sync.WaitGroup\n\nfunc Func1(w http.ResponseWriter, r *http.Request) {\n    lexpiry := ReadDatafrom()\n    wg.Add(1)\n    go models.ValidExp(string(lexpiry))\n    ----\n        calling func of model package\n    ----\n    wg.Wait()\n    ----\n    // return json response\n}\n\npackage model\n---\n---\n\nfunc validExp(lexpiry string) {\n    fmt.Println(\"CHeck Expiry Date\")\n\n    // wg.Done()\n    // how to call wg.Done() of handllers packge , is it right way ?\n}\n</code></pre>\n\n<p>can some one guide me on this? How to sync goroutine if called function are from different packages? </p>\n"}, {"tags": ["testing", "go", "integration-testing"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1521015407, "post_id": 49272632, "comment_id": 85547938, "body": "The standard approach would be to use a configurable logger (i.e. probably not the standard library&#39;s <code>log</code> package), and for tests, configure logs to be discarded."}, {"owner": {"reputation": 1276, "user_id": 6237232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/557d1078fe8ace9c1e6f88d275f5f32a?s=128&d=identicon&r=PG&f=1", "display_name": "RidgeA", "link": "https://stackoverflow.com/users/6237232/ridgea"}, "edited": false, "score": 0, "creation_date": 1521015599, "post_id": 49272632, "comment_id": 85548029, "body": "You may use <code>Log</code> or <code>Logf</code> function in <code>testing.T</code> struct - <a href=\"https://golang.org/pkg/testing/#T.Log\" rel=\"nofollow noreferrer\">golang.org/pkg/testing/#T.Log</a>"}, {"owner": {"reputation": 1, "user_id": 10024395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9483e59154ae2804d6144c89a2d79c2a?s=128&d=identicon&r=PG&f=1", "display_name": "user10024395", "link": "https://stackoverflow.com/users/10024395/user10024395"}, "edited": false, "score": 0, "creation_date": 1521016028, "post_id": 49272632, "comment_id": 85548231, "body": "Yes but test log has to be tied to testing.T which means I can&#39;t use it in clearTable() in my code."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 4, "creation_date": 1521016751, "post_id": 49272632, "comment_id": 85548643, "body": "You should never call log.Fatal in tests. Instead, pass a *testing.T to clearTable and fail the test."}, {"owner": {"reputation": 1, "user_id": 10024395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9483e59154ae2804d6144c89a2d79c2a?s=128&d=identicon&r=PG&f=1", "display_name": "user10024395", "link": "https://stackoverflow.com/users/10024395/user10024395"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521018128, "post_id": 49272632, "comment_id": 85549430, "body": "@Peter But clearTable is just a helper function. It is not a test function. Should I pass *testing.T to helper function too? I am puzzled with how I am supposed to do this."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1521023272, "post_id": 49272632, "comment_id": 85552904, "body": "Yes, you should pass *testing.T to helper functions. It&#39;s just a value, nothing special at all."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1521033741, "post_id": 49272632, "comment_id": 85560206, "body": "Only if it&#39;s a helper function <i>for tests</i>. Any code that&#39;s used outside of tests should not reference the <code>testing</code> package."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1521033855, "post_id": 49272632, "comment_id": 85560294, "body": "Also there&#39;s no particular reason not to log in tests. It will be omitted in results unless <code>-v</code> is passed. If you find logging in tests to be a problem, then find a way to omit it; otherwise, you may as well leave it in. It is often useful in troubleshooting failing tests."}, {"owner": {"reputation": 1, "user_id": 10024395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9483e59154ae2804d6144c89a2d79c2a?s=128&d=identicon&r=PG&f=1", "display_name": "user10024395", "link": "https://stackoverflow.com/users/10024395/user10024395"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521459764, "post_id": 49272632, "comment_id": 85724201, "body": "@Peter What about the logging in TestMain? I can&#39;t pass *testing.T to TestMain?"}, {"owner": {"reputation": 1, "user_id": 10024395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9483e59154ae2804d6144c89a2d79c2a?s=128&d=identicon&r=PG&f=1", "display_name": "user10024395", "link": "https://stackoverflow.com/users/10024395/user10024395"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521459796, "post_id": 49272632, "comment_id": 85724224, "body": "@Adrian I am not saying it is a problem. Just wondering what is the best practice?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521462028, "post_id": 49272632, "comment_id": 85725653, "body": "&quot;Best practice&quot; is not a singular thing, and it&#39;s a matter of opinion, which makes it off topic for SO."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 10024395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9483e59154ae2804d6144c89a2d79c2a?s=128&d=identicon&r=PG&f=1", "display_name": "user10024395", "link": "https://stackoverflow.com/users/10024395/user10024395"}, "edited": false, "score": 1, "creation_date": 1521470326, "post_id": 49363161, "comment_id": 85731593, "body": "what do you mean by &quot;It is redundant with the first call, destroys all evidence of a failed test,&quot;?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 1, "user_id": 10024395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9483e59154ae2804d6144c89a2d79c2a?s=128&d=identicon&r=PG&f=1", "display_name": "user10024395", "link": "https://stackoverflow.com/users/10024395/user10024395"}, "edited": false, "score": 0, "creation_date": 1521471056, "post_id": 49363161, "comment_id": 85732141, "body": "@user136266, if a test fails, you usually don&#39;t want to destroy the test data. There is no point in emptying the worker table after a test if you also do it before the test."}, {"owner": {"reputation": 1, "user_id": 10024395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9483e59154ae2804d6144c89a2d79c2a?s=128&d=identicon&r=PG&f=1", "display_name": "user10024395", "link": "https://stackoverflow.com/users/10024395/user10024395"}, "edited": false, "score": 0, "creation_date": 1521525983, "post_id": 49363161, "comment_id": 85755325, "body": "How else show I initialize the connection to database if I don&#39;t have TestMain? just connect independently in each function?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 1, "user_id": 10024395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9483e59154ae2804d6144c89a2d79c2a?s=128&d=identicon&r=PG&f=1", "display_name": "user10024395", "link": "https://stackoverflow.com/users/10024395/user10024395"}, "edited": false, "score": 0, "creation_date": 1521537909, "post_id": 49363161, "comment_id": 85761489, "body": "This is what I prefer, yes. Again, tests are ideally self-contained and not spread out over multiple functions without explicit calls (which may even end up in different files)."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 2, "last_activity_date": 1521463030, "creation_date": 1521463030, "answer_id": 49363161, "question_id": 49272632, "link": "https://stackoverflow.com/questions/49272632/is-it-fine-to-have-logging-in-golang-test-or-is-it-a-practice-to-not-have-loggi/49363161#49363161", "title": "Is it fine to have logging in golang test? Or is it a practice to not have logging in test?", "body": "<p>Logging in tests is perfectly fine; that's why *testing.T has the Log and Logf methods.</p>\n\n<p>Instead of calling log.Fatalf you should pass the testing structs to your helper function and let tests fail:</p>\n\n<pre><code>func clearTable(t *testing.T, name string) {\n    t.Helper() // optional; identifies our caller as the culprit if test fails\n\n    _, err := testDB.Exec(fmt.Sprintf(\"DELETE FROM %s\", name))\n    if err != nil {\n            t.Fatalf(\"[FATA] Failed to clear a table in database. name=%q err=%q\", name, err)\n    }\n    _, err = testDB.Exec(fmt.Sprintf(\"ALTER SEQUENCE %s_id_seq RESTART WITH 1\", name))\n    if err != nil {\n            t.Fatalf(\"[FATA] Failed to reset ID sequence of a table in database. name=%q err=%q\", name, err)\n    }\n}\n</code></pre>\n\n<p>As you already mentioned in the comments, this does not work for the TestMain function.</p>\n\n<p>You should avoid defining TestMain, it is rarely necessary. Instead, call setup and teardown functions in each test. This makes tests self-contained and it is much easier to understand what is going on.</p>\n\n<pre><code>func TestCreateWorker(t *testing.T) {\n    clearTable(t, \"worker\")\n    defer clearTable(t, \"worker\")\n\n    // test follows\n}\n</code></pre>\n\n<p>Aside: think long and hard about whether you even want to call clearTable after each test. It is redundant with the first call, destroys all evidence of a failed test, and makes debugging harder.</p>\n\n<p>If you want to keep your TestMain around, define a different helper function that does not depend on testing.T.</p>\n"}], "owner": {"reputation": 1, "user_id": 10024395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9483e59154ae2804d6144c89a2d79c2a?s=128&d=identicon&r=PG&f=1", "display_name": "user10024395", "link": "https://stackoverflow.com/users/10024395/user10024395"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 486, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1521463030, "creation_date": 1521015314, "last_edit_date": 1521459841, "question_id": 49272632, "link": "https://stackoverflow.com/questions/49272632/is-it-fine-to-have-logging-in-golang-test-or-is-it-a-practice-to-not-have-loggi", "title": "Is it fine to have logging in golang test? Or is it a practice to not have logging in test?", "body": "<p>Is it fine to have logging in golang test? Or is it a practice to not have logging in test?</p>\n\n<p>My test currently looks something like this. I am not sure if I am doing it right and is need of advise for the best practice to do test in golang. This is an integration test btw.</p>\n\n<p>The log concern is mostly at the initialization step TestMain where the input is *testing.M that does not have log function.</p>\n\n<pre><code>var testDB *DB\n\nfunc clearTable(name string) {\n        var err error\n        _, err = testDB.Exec(fmt.Sprintf(\"DELETE FROM %s\", name))\n        if err != nil {\n                log.Fatalf(\"[FATA] Failed to clear a table in database. name=%q err=%q\", name, err)\n        }\n        _, err = testDB.Exec(fmt.Sprintf(\"ALTER SEQUENCE %s_id_seq RESTART WITH 1\", name))\n        if err != nil {\n                log.Fatalf(\"[FATA] Failed to reset ID sequence of a table in database. name=%q err=%q\", name, err)\n        }\n}\n\nfunc TestMain(m *testing.M) {\n        var err error\n        testDB, err = NewDB(fmt.Sprintf(\"dbname=%s sslmode=disable\", testDBName))\n        if err != nil {\n                log.Fatalf(\"[FATA] Failed to initialize test database. dbName=%q err=%q\", testDBName, err)\n        }\n        defer testDB.Close()\n        code := m.Run()\n        clearTable(\"worker\")\n        os.Exit(code)\n}\n\nfunc TestCreateWorker(t *testing.T) {\n        clearTable(\"worker\")\n\n        createdWorkers := make(map[int]*Worker, 10)\n        for i := 0; i &lt; 10; i++ {\n                username := strings.Join([]string{\"worker\", strconv.Itoa(i)}, \"\")\n                email := strings.Join([]string{username, \"@gmail.com\"}, \"\")\n                passwordHash := strings.Join([]string{username, \"PasswordHash\"}, \"\")\n                worker := Worker {\n                        Username: username, \n                        Email: email,\n                        PasswordHash: passwordHash,\n                }\n                err := testDB.CreateWorker(&amp;worker)\n                if err != nil {\n                        t.Errorf(\"[ERRO] Failed to create a new worker in database. username=%q email=%q passwordHash=%q err=%q\", username, email, passwordHash, err)\n                }\n                createdWorkers[i+1] = &amp;worker\n        }\n\n        rows, err := testDB.Query(\"SELECT * FROM worker\")\n        if err != nil {\n                t.Errorf(\"[ERRO] Failed to get all workers from database. err=%q\", err)\n        }\n        defer rows.Close()\n        for rows.Next() {\n                returnedWorker := new(Worker)\n                err := rows.Scan(&amp;returnedWorker.ID, &amp;returnedWorker.Username, &amp;returnedWorker.Email, &amp;returnedWorker.PasswordHash, &amp;returnedWorker.CreatedAt)\n                if err != nil {\n                        t.Errorf(\"[ERRO] Failed to scan returned row into worker struct. err=%q\", err)\n                }\n                createdWorker := createdWorkers[returnedWorker.ID]\n                if !reflect.DeepEqual(&amp;createdWorker, &amp;returnedWorker) {\n                        t.Errorf(\"[ERRO] Worker created in database and worker returned from database are different. createdWorker=%v returnedWorker=%v\", createdWorker, returnedWorker)\n                }\n        }\n}\n</code></pre>\n\n<p>Any good Golang github repo that does good logging to learn from?</p>\n"}, {"tags": ["go", "oauth-2.0", "ebay-api"], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 3214743, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5PKVF.jpg?s=128&g=1", "display_name": "Vahe", "link": "https://stackoverflow.com/users/3214743/vahe"}, "is_accepted": false, "score": 1, "last_activity_date": 1521056995, "creation_date": 1521056995, "answer_id": 49286557, "question_id": 49272402, "link": "https://stackoverflow.com/questions/49272402/ebay-api-client-credentials-authorization/49286557#49286557", "title": "ebay API client credentials authorization", "body": "<p>So, there is a problem (bug?) with the Ebay's implementation of the OAuth2.0 spec and I had to reimplement the TokenSource of the oauth2/clientcredentials package to set the token type to Bearer not Application Access Token.</p>\n"}], "owner": {"reputation": 31, "user_id": 3214743, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5PKVF.jpg?s=128&g=1", "display_name": "Vahe", "link": "https://stackoverflow.com/users/3214743/vahe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 472, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1521056995, "creation_date": 1521014530, "last_edit_date": 1521014560, "question_id": 49272402, "link": "https://stackoverflow.com/questions/49272402/ebay-api-client-credentials-authorization", "title": "ebay API client credentials authorization", "body": "<p>I want to implement an Ebay Browse API client credentials grant flow in Go using the <a href=\"https://godoc.org/golang.org/x/oauth2/clientcredentials\" rel=\"nofollow noreferrer\">oauth2</a> package. Here is my conf struct:</p>\n\n<pre><code>    conf := clientcredentials.Config{\n        ClientID:     \"My Client ID\",\n        ClientSecret: \"My client Secret\",\n        Scopes:       []string{\"https://api.ebay.com/oauth/api_scope\"},\n        TokenURL:     \"https://api.sandbox.ebay.com/identity/v1/oauth2/token\",\n        EndpointParams: url.Values{\"redirect_uri\": {\"the RuName\"}},\n    }\n</code></pre>\n\n<p>Then I tried to make a request by creating an *http.Request:</p>\n\n<pre><code>req, err := http.NewRequest(\"GET\", \"https://api.sandbox.ebay.com/buy/browse/v1/item/v1|202117468662|0?fieldgroups=COMPACT\", nil)\n    if err != nil {\n        log.Fatal(err)\n    }\nctx := context.Background()\nclient := conf.Client(ctx)\nres, err := client.Do(req)\nif err != nil {\n    log.Fatal(err)\n}\ndefer res.Body.Close()\n</code></pre>\n\n<p>But then I get:</p>\n\n<pre><code>{\n  \"errors\" : [ {\n    \"errorId\" : 1003,\n    \"domain\" : \"OAuth\",\n    \"category\" : \"REQUEST\",\n    \"message\" : \"Token type in the Authorization header is invalid:Application\",\n    \"longMessage\" : \"Token type in the Authorization header is invalid:Application\"\n  } ]\n}\n</code></pre>\n\n<p>It turned out, that when making the request to the resource server Go's package sets the Authorization header as:</p>\n\n<pre><code>Authorization: Application Access Token token_string \n</code></pre>\n\n<p>So, I tried to set the token type to Bearer manually by doing:</p>\n\n<pre><code>tok, err := conf.Token(ctx)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    client := conf.Client(ctx)\n    req, err := http.NewRequest(\"GET\", \"https://api.sandbox.ebay.com/buy/browse/v1/item/v1|202117468662|0?fieldgroups=COMPACT\", nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n    req.Header.Set(\"Authorization\", \"Bearer \" tok.AccessToken)\n    res, err := client.Do(req)\n</code></pre>\n\n<p>But I continue getting the same error.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1521009175, "post_id": 49270700, "comment_id": 85545125, "body": "There is a difference between a variable and a value. Variables hold values but not every value is a variable. Variables are the things which are changeable and addressable (simplified!). Some things are not variables. your MyintB is one, a value read from a map, e.g. m[&quot;foo&quot;] is an other example. Your example is totally unrelated to interfaces btw."}], "answers": [{"comments": [{"owner": {"reputation": 1001, "user_id": 4940012, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbcb1a537f1a07c08d08cc72c7efb921?s=128&d=identicon&r=PG&f=1", "display_name": "bearzyj", "link": "https://stackoverflow.com/users/4940012/bearzyj"}, "edited": false, "score": 0, "creation_date": 1521008637, "post_id": 49270816, "comment_id": 85544876, "body": "So, &quot;MyintB(2) &quot; is something like int(2), it is just a constant value, but not a variable of type &quot;MyintB&quot; ? ......However, &quot;MyintB&quot; could have a &quot;method&quot; or implement an interface, while &quot;int&quot; cannot......feels a little bit nonintuitive"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1001, "user_id": 4940012, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbcb1a537f1a07c08d08cc72c7efb921?s=128&d=identicon&r=PG&f=1", "display_name": "bearzyj", "link": "https://stackoverflow.com/users/4940012/bearzyj"}, "edited": false, "score": 1, "creation_date": 1521008933, "post_id": 49270816, "comment_id": 85545030, "body": "<code>MyintB(2)</code> is a value of type MyIntB, but it&#39;s not a variable."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1001, "user_id": 4940012, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbcb1a537f1a07c08d08cc72c7efb921?s=128&d=identicon&r=PG&f=1", "display_name": "bearzyj", "link": "https://stackoverflow.com/users/4940012/bearzyj"}, "edited": false, "score": 1, "creation_date": 1521009318, "post_id": 49270816, "comment_id": 85545178, "body": "The specification allows for the <code>int</code> type to have methods, but the type is not declared with any methods."}, {"owner": {"reputation": 1001, "user_id": 4940012, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbcb1a537f1a07c08d08cc72c7efb921?s=128&d=identicon&r=PG&f=1", "display_name": "bearzyj", "link": "https://stackoverflow.com/users/4940012/bearzyj"}, "edited": false, "score": 2, "creation_date": 1521010271, "post_id": 49270816, "comment_id": 85545614, "body": "Oh...OK! I checked source code &quot;go/1.10/libexec/src/builtin/builtin.go&quot;, the int &quot;type&quot; is defined there. Because it didn&#39;t implement any method there, so we cannot add any new method for &quot;int&quot; from an outside package directly, that&#39;s why we have to make a new type like MyintB to add method if needed. Umm...then, it looks not nonintuitive now :) Thanks very much for your help!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1521009440, "last_edit_date": 1521009440, "creation_date": 1521007855, "answer_id": 49270816, "question_id": 49270700, "link": "https://stackoverflow.com/questions/49270700/in-golang-why-an-interface-variable-can-get-address-of-a-struct-variable-but-can/49270816#49270816", "title": "In golang why an interface variable can get address of a struct variable but cannot from a basic type variable?", "body": "<p>It's <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"noreferrer\">explained in the specification</a>:</p>\n\n<blockquote>\n  <p>For an operand x of type T, the address operation &amp;x generates a pointer of type *T to x. The operand must be addressable, that is, either a variable, pointer indirection, or slice indexing operation; or a field selector of an addressable struct operand; or an array indexing operation of an addressable array. As an exception to the addressability requirement, x may also be a (possibly parenthesized) composite literal. If the evaluation of x would cause a run-time panic, then the evaluation of &amp;x does too.</p>\n</blockquote>\n\n<p>The expression <code>MyintB(2)</code> is an constant <em>value</em> of type <code>MyintB</code>. It is not a <em>variable</em> or one of the other operands allowed in an address operation. Variables are declared with <code>var</code> or with a <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"noreferrer\">short variable declaration</a>. </p>\n\n<p>The expression <code>MyintA{3}</code> is a <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"noreferrer\">composite literal</a>.  The exception to the addressability requirements allows taking the address of this operand.</p>\n\n<p>Do as the comment suggests to get a pointer to a MyintB:</p>\n\n<pre><code>b := MyintB(2)\na = &amp;b\n</code></pre>\n\n<p>The issue is with the address operator, not the assignment to an interface variable.</p>\n"}], "owner": {"reputation": 1001, "user_id": 4940012, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbcb1a537f1a07c08d08cc72c7efb921?s=128&d=identicon&r=PG&f=1", "display_name": "bearzyj", "link": "https://stackoverflow.com/users/4940012/bearzyj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1002, "favorite_count": 1, "accepted_answer_id": 49270816, "answer_count": 1, "score": 2, "last_activity_date": 1521009440, "creation_date": 1521007360, "question_id": 49270700, "link": "https://stackoverflow.com/questions/49270700/in-golang-why-an-interface-variable-can-get-address-of-a-struct-variable-but-can", "title": "In golang why an interface variable can get address of a struct variable but cannot from a basic type variable?", "body": "<p>I am learning golang from \"gotour\" tool with \"go1.10 darwin/amd64\".</p>\n\n<p>For below case:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Myapi interface {\n    fun1() int\n}\n\ntype MyintA struct {\n    val int\n}\n\ntype MyintB int\n\nfunc (v *MyintA)fun1() int {\n    return int(v.val) + 1\n}\n\nfunc (v *MyintB)fun1() int {\n    return int(*v) + 1\n}\n\nfunc main() {\n    var a Myapi\n    a = &amp;MyintA{3}\n    fmt.Println(a)\n    a = &amp;MyintB(2) // Need b:=MyintB(2); a=&amp;b\n    fmt.Println(a)\n}\n</code></pre>\n\n<p>The compiling error is:</p>\n\n<blockquote>\n  <p>$ go run try.go</p>\n  \n  <p># command-line-arguments </p>\n  \n  <p>./try.go:27:9: cannot take the address of MyintB(2)</p>\n</blockquote>\n\n<p>Why the interface variable could get address directly from MyintA but not MyintB in this case?</p>\n"}, {"tags": ["go", "google-bigquery"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 9488667, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Vishal Joshi", "link": "https://stackoverflow.com/users/9488667/vishal-joshi"}, "edited": false, "score": 0, "creation_date": 1521230526, "post_id": 49271029, "comment_id": 85659238, "body": "It would be nice if you could give a sample of how to create the bigquery.service instance. I found it in the bigquery go client code anyways. Thanks!"}, {"owner": {"reputation": 115571, "user_id": 5221944, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/iqXab.png?s=128&g=1", "display_name": "Mikhail Berlyant", "link": "https://stackoverflow.com/users/5221944/mikhail-berlyant"}, "reply_to_user": {"reputation": 3, "user_id": 9488667, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Vishal Joshi", "link": "https://stackoverflow.com/users/9488667/vishal-joshi"}, "edited": false, "score": 0, "creation_date": 1521230728, "post_id": 49271029, "comment_id": 85659334, "body": "as I mentioned - in above example - it is a sandboxed version of go with BQ client that we created for our UI and bigquery service is already precreated so our users do not need to worry of creating and authenticating etc. - just using :o)  glad you found how to actually create instance of bigquery.service on your own"}, {"owner": {"reputation": 2236, "user_id": 3656094, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/121054aceb0b541368ac081bc81beba7?s=128&d=identicon&r=PG&f=1", "display_name": "rickyalbert", "link": "https://stackoverflow.com/users/3656094/rickyalbert"}, "reply_to_user": {"reputation": 3, "user_id": 9488667, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Vishal Joshi", "link": "https://stackoverflow.com/users/9488667/vishal-joshi"}, "edited": false, "score": 0, "creation_date": 1589711453, "post_id": 49271029, "comment_id": 109396066, "body": "@VishalJoshi could you share how you created the bigquery.service instance?"}], "tags": [], "owner": {"reputation": 115571, "user_id": 5221944, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/iqXab.png?s=128&g=1", "display_name": "Mikhail Berlyant", "link": "https://stackoverflow.com/users/5221944/mikhail-berlyant"}, "is_accepted": true, "score": 3, "last_activity_date": 1521008870, "creation_date": 1521008870, "answer_id": 49271029, "question_id": 49268308, "link": "https://stackoverflow.com/questions/49268308/bigquery-golang-client-get-projects-list/49271029#49271029", "title": "Bigquery Golang client get projects list", "body": "<p>below example can give you an idea - it is sandboxed go that is part of our BQ UI   </p>\n\n<hr>\n\n<p><a href=\"https://i.stack.imgur.com/tJnaQ.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/tJnaQ.gif\" alt=\"enter image description here\"></a></p>\n\n<hr>\n\n<pre><code>func mainReturn() interface{} {\n    bigqueryService, err := getBigqueryService() ; if(err != nil) {return \"ERROR\"}\n    err2 := getProjects(bigqueryService)         ; if(err2 != nil) {return \"ERROR\"}\n    return \"OK\"\n}\n\nfunc getProjects(bigqueryService *bigquery.Service)(error) {\n    var buf bytes.Buffer\n    var pagetoken string = \"\"\n    ind := 0\n    for {\n        call := bigqueryService.Projects.List()\n        if len(pagetoken) &gt; 0 {call = call.PageToken(pagetoken)}\n\n        list, err := call.Do() ; if err != nil {return err}\n\n        if len(pagetoken) == 0 {\n            xFprintf(&amp;buf, \"TotalItems: %v\\n\", list.TotalItems)\n        }\n\n        for _, project := range list.Projects {\n            xFprintf(&amp;buf, \"========= Projects %v ==============\\n\", ind)\n            xFprintf(&amp;buf, \"Id: %v\\n\", project.Id)\n            xFprintf(&amp;buf, \"Kind: %v\\n\", project.Kind)\n            project := project.Id\n            del := strings.LastIndex(project, \".\")\n            if del != -1 {project = project[del+1:]}\n            ind++;\n        }\n\n        pagetoken = list.NextPageToken ; if len(pagetoken) == 0 {break}\n    }\n\n    xPrintln(buf.String())\n    return nil\n}\n</code></pre>\n\n<p>Please ignore some funny looking functions like xFprintf - this is just way we sandboxed go </p>\n"}], "owner": {"reputation": 3, "user_id": 9488667, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Vishal Joshi", "link": "https://stackoverflow.com/users/9488667/vishal-joshi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 272, "favorite_count": 0, "accepted_answer_id": 49271029, "answer_count": 1, "score": 0, "last_activity_date": 1521008870, "creation_date": 1520989715, "last_edit_date": 1521001919, "question_id": 49268308, "link": "https://stackoverflow.com/questions/49268308/bigquery-golang-client-get-projects-list", "title": "Bigquery Golang client get projects list", "body": "<p>How can I get a list of projects that the golang cloud client has access to using the serviceaccount key that I have provided?\nSeems like there is an API available: <a href=\"https://cloud.google.com/bigquery/docs/reference/rest/v2/projects/list\" rel=\"nofollow noreferrer\">https://cloud.google.com/bigquery/docs/reference/rest/v2/projects/list</a></p>\n\n<p>However, the Google Cloud client library does not expose it.</p>\n\n<p>My code looks like this</p>\n\n<pre><code>client, err := bigquery.NewClient(ctx, conn.ProjectID, option.WithServiceAccountFile(fname))\n</code></pre>\n\n<p>I want to enumerate the list of projects that this client can access.</p>\n"}, {"tags": ["go", "struct", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1520982747, "post_id": 49267235, "comment_id": 85538035, "body": "Just to start, <code>thing.New</code> returns a copy of the Handler. Once the handler is operating on the same struct, you need to add some sort of synchronization, as this will cause a data race."}, {"owner": {"reputation": 4687, "user_id": 408913, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/yZwgk.jpg?s=128&g=1", "display_name": "David Houde", "link": "https://stackoverflow.com/users/408913/david-houde"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520989616, "post_id": 49267235, "comment_id": 85539901, "body": "Thanks, I have found the piece that I think you are referencing and removed the * which was dereferencing the original BotHandler struct. I was hoping this might resolve the issue as it sounded like the issue I was having, but same results."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1520995582, "post_id": 49267235, "comment_id": 85541217, "body": "No, removing that <code>*</code> changes the reciever type, so you have yet another copy. I would back up and go through some of the basics, as there are many fundemdntal issues here adding to the confusion."}, {"owner": {"reputation": 4687, "user_id": 408913, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/yZwgk.jpg?s=128&g=1", "display_name": "David Houde", "link": "https://stackoverflow.com/users/408913/david-houde"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521037922, "post_id": 49267235, "comment_id": 85563334, "body": "Thanks @JimB for taking the time to comment. I&#39;ve started at square one to make sure I did not miss anything, and I&#39;m now seeing quite a few issues in my approach."}], "answers": [{"comments": [{"owner": {"reputation": 4687, "user_id": 408913, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/yZwgk.jpg?s=128&g=1", "display_name": "David Houde", "link": "https://stackoverflow.com/users/408913/david-houde"}, "edited": false, "score": 0, "creation_date": 1521036469, "post_id": 49269132, "comment_id": 85562378, "body": "This helps me a lot. I was not aware that returns or receivers acted this way.  Thanks!"}], "tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": false, "score": 1, "last_activity_date": 1520997362, "last_edit_date": 1520997362, "creation_date": 1520996715, "answer_id": 49269132, "question_id": 49267235, "link": "https://stackoverflow.com/questions/49267235/goroutines-and-passing-struct-to-original-context/49269132#49269132", "title": "GoRoutines and passing struct to original context", "body": "<p>In Go, arguments are passed to functions by value -- meaning <strong>what the function gets is a copy of the value, not a reference to the variable</strong>.  The same is true of the function receiver, and also the return list.</p>\n\n<p>It's not the most elegant description, but for the sake of explanation, let's call this the \"function wall.\"  If the value being passed one way or the other is a pointer, the function still gets a copy, but it's a copy of a memory address, and so the pointer can be used to change the value of the variable on the other side of the wall.  If it is a reference type, which uses a pointer in the implementation of the type, then again a change to the thing being pointed to can cross that wall.  But otherwise the change does not cross the wall, which is one reason so many Go functions are written to return values instead of just modifying values.</p>\n\n<p>Here's a runnable example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Car struct {\n    Color   string\n}\n\nfunc (c Car) Change() {  // c was passed by value, it's a copy\n    c.Color = \"Red\"\n}\n\nfunc main() {\n    ride := Car{\"Blue\"}\n    ride.Change()\n    fmt.Println(ride.Color)\n}\n</code></pre>\n\n<p>Prints \"Blue\"</p>\n\n<p>But two small changes:</p>\n\n<pre><code>func (c *Car) Change() {  // here\n    c.Color = \"Red\"\n}\n\nfunc main() {\n    ride := &amp;Car{\"Blue\"}  // and here\n    ride.Change()\n    fmt.Println(ride.Color)\n}\n</code></pre>\n\n<p>And now it prints \"Red\".   Struct is not a reference type.  So if you want modifications to a struct to cross the wall without using the return list to do it, use a pointer.  Of course this only applies to values being passed via argument, return list, or receiver; and not to variables that are in scope on both sides of the wall; or to modifying the underlying value behind a reference type.</p>\n\n<p>See also <a href=\"https://golang.org/doc/effective_go.html#pointers_vs_values\" rel=\"nofollow noreferrer\">\"Pointers Versus Values\" in Effective Go</a>, and <a href=\"https://research.swtch.com/godata\" rel=\"nofollow noreferrer\">\"Go Data Structures\"</a> by Russ Cox.</p>\n"}], "owner": {"reputation": 4687, "user_id": 408913, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/yZwgk.jpg?s=128&g=1", "display_name": "David Houde", "link": "https://stackoverflow.com/users/408913/david-houde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 963, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1521037941, "creation_date": 1520982095, "last_edit_date": 1521037941, "question_id": 49267235, "link": "https://stackoverflow.com/questions/49267235/goroutines-and-passing-struct-to-original-context", "title": "GoRoutines and passing struct to original context", "body": "<p>I have a configuration that defines a number of instances (SomeConfigItems) which have a thing() created for each of them. </p>\n\n<p>That thing is a struct returned by an included package, which contains, among other things, a Price (float64) and a nested struct. The nested struct maintains a map of trades.  </p>\n\n<p>The problem is that I am able to loop through the thing.Streams.Trades and see all trades happening in real time from my main()'s for{} loop. I am not able to see an updated thing.Price even though it is set in the Handler on occasion.  </p>\n\n<p>I am having a hard time understanding how the nested structs can contain data but not Price. I feel as though I am missing something with scoping, goroutines, or possibly pointers for instantiation of new objects. </p>\n\n<p>Any help would be appreciated, I will continue reading in the meantime. I've reduced the code to what seems relevant. </p>\n\n<h2>main.go:</h2>\n\n<pre><code>package main\nimport thing\nvar Things []thing.Handler\n\nfor _, name := range SomeConfigItems {\n  handler := thing.New(name)\n  Things = append(Things, handler)\n}\n\nfor {\n  for _, t := range Things {\n    log.Info(\"Price: \", t.Price) // This is set to 0 every iteration, but I can actively data in thing.Streams.Trades\n  }\n}\n</code></pre>\n\n<h2>thing.go:</h2>\n\n<pre><code>package thing\nimport streams\n\ntype Handler struct {\n    Name  string\n    Price   float64\n    Streams streams.Streams\n}\n\nfunc New(name string) (h Handler, err error) {\n    stream, err := streams.New(strings.ToLower(name))\n    h = Handler{\n        Name:  name,\n        Price: \"0.0\"\n        Streams: stream,\n    }\n  go h.handler()\n    return h, err\n}\n\nfunc (bot *Handler) handler() {\n    var currentPrice float64\n    for {\n        currentPrice = external.GetPrice(bot.Name).Price // Validated that this returns a float64\n        bot.Price = currentPrice                           // Verified that this is updated immediately after in this context.\n                                                       // Unable to see Price updated from outer context. \n    }\n}\n</code></pre>\n\n<h2>streams.go:</h2>\n\n<pre><code>package streams\n\ntype Streams struct {\n    Trades\n}\n\ntype State struct {\n  Price         string `json:\"p\"`\n  Quantity      string `json:\"q\"`\n}\n\ntype Trades struct {\n    Trades     map[float64]float64\n    TradeMutex sync.Mutex\n    Updates    chan State\n}\n\nfunc New(name string) (s Streams, err error) {\n    p := newTradeStream(name)\n    s = Streams{\n        Trades: p,\n    }\n    return s, err\n}\n\nfunc newTradeStream(name string) (ts Trades) {\n    ts = Trades{}\n    ts.Trades = make(map[float64]float64, MaxDepth)\n    ts.Updates = make(chan State, 500)\n  // ... Other watchdog code\n    return ts\n}\n</code></pre>\n\n<p>Note: </p>\n\n<p>I am added some debug logging in multiple locations. From within the Bot Handler, the price was printed (successfully), then updated, and then printed (successfully) again -- Showing no gap in the setting of Price from within the handler() function. </p>\n\n<p>When adding the same type of debugging to the main() for{} loop, I tried setting an incrementing counter and assigning the value of thing.Price -- Printing thing.Price on each loop results in 0, even if I set the price (and validate it gets set) in the same loop, it is back to 0 on the next iteration.</p>\n\n<p>This behavior is why I think that I am missing something very fundamental.</p>\n"}, {"tags": ["oracle", "go", "long-integer"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 2363951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/290d0bc92832e14a2da8555655dc81c3?s=128&d=identicon&r=PG", "display_name": "Shivani Singh", "link": "https://stackoverflow.com/users/2363951/shivani-singh"}, "edited": false, "score": 0, "creation_date": 1521081328, "post_id": 49269890, "comment_id": 85584355, "body": "Thanks for comment @nvl. You are right I am using mattn oracle package. Looks like currently this package does not support long raw. i really wonder if anyone happened to solve this problem before :("}, {"owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "reply_to_user": {"reputation": 23, "user_id": 2363951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/290d0bc92832e14a2da8555655dc81c3?s=128&d=identicon&r=PG", "display_name": "Shivani Singh", "link": "https://stackoverflow.com/users/2363951/shivani-singh"}, "edited": false, "score": 0, "creation_date": 1521085368, "post_id": 49269890, "comment_id": 85585209, "body": "try to change code <code>oci8cols[i].size = int(lp * 12)</code> on <code>oci8.pc</code>, some one able to get rid this error by changing that"}, {"owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "reply_to_user": {"reputation": 23, "user_id": 2363951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/290d0bc92832e14a2da8555655dc81c3?s=128&d=identicon&r=PG", "display_name": "Shivani Singh", "link": "https://stackoverflow.com/users/2363951/shivani-singh"}, "edited": false, "score": 0, "creation_date": 1521085390, "post_id": 49269890, "comment_id": 85585212, "body": "basically just increase the buffer, <code>lp * 12</code> or greater"}, {"owner": {"reputation": 23, "user_id": 2363951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/290d0bc92832e14a2da8555655dc81c3?s=128&d=identicon&r=PG", "display_name": "Shivani Singh", "link": "https://stackoverflow.com/users/2363951/shivani-singh"}, "edited": false, "score": 0, "creation_date": 1522104382, "post_id": 49269890, "comment_id": 86007657, "body": "thanks for your feedback. It gets too heavy for package to load. + few images are not loaded properly. They get downloaded half way."}], "tags": [], "owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "is_accepted": false, "score": 0, "last_activity_date": 1521002370, "creation_date": 1521002370, "answer_id": 49269890, "question_id": 49267194, "link": "https://stackoverflow.com/questions/49267194/how-to-read-image-from-oracle-long-raw-format-in-golang/49269890#49269890", "title": "How to read Image from Oracle (long raw format) in GoLang", "body": "<p>I assume you are using <code>go-oci8</code> as the driver. </p>\n\n<p>Based on this issue <a href=\"https://github.com/mattn/go-oci8/pull/71\" rel=\"nofollow noreferrer\">https://github.com/mattn/go-oci8/pull/71</a> there are someone who get the same error like yours, and then managed to fix it by modifying some codes on the driver.</p>\n\n<p>As per this <a href=\"https://github.com/mattn/go-oci8/commit/5e46694007e7f07045681911ef71634dd5bee8a9\" rel=\"nofollow noreferrer\">commit</a>, the problem is already solved by increasing the value of <code>oci8cols[i].size</code> on file <code>$GOPATH/src/github.com/mattn/go-oci8/oci8.go</code>. I think in your case you have bigger blob data, that's why the revision is still not working.</p>\n\n<pre><code>case C.SQLT_NUM:\n    oci8cols[i].kind = C.SQLT_CHR\n    oci8cols[i].size = int(lp * 4) // &lt;==== THIS VALUE\n    oci8cols[i].pbuf = C.malloc(C.size_t(oci8cols[i].size) + 1)\n</code></pre>\n\n<p>So, try to increase the multiplier, like:</p>\n\n<pre><code>oci8cols[i].size = int(lp * 12) // &lt;==== OR GREATER\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 2363951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/290d0bc92832e14a2da8555655dc81c3?s=128&d=identicon&r=PG", "display_name": "Shivani Singh", "link": "https://stackoverflow.com/users/2363951/shivani-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 488, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1521002370, "creation_date": 1520981826, "last_edit_date": 1521001543, "question_id": 49267194, "link": "https://stackoverflow.com/questions/49267194/how-to-read-image-from-oracle-long-raw-format-in-golang", "title": "How to read Image from Oracle (long raw format) in GoLang", "body": "<p>I am trying to read images (in long raw datatype) from external Oracle database using Golang code.</p>\n\n<p>When sql's row.Next() is called following error is caught:\nORA-01406: fetched column value was truncated</p>\n\n<p>row.Next works fine for reading blob images from mssql DB. </p>\n\n<p>Example code:</p>\n\n<pre><code>db, err := sql.Open(\"oci8\", getDSN()) //function to get connection details \n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    defer db.Close()\n    rows, err := db.Query(\"SELECT image FROM sysadm.all_images\")\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    defer rows.Close()\n    for rows.Next() {\n       var id string\n       var data []byte\n       rows.Scan(&amp;id, &amp;data)    \n    }\n    fmt.Println(\"Total errors\", rows.Err())\n}\n</code></pre>\n\n<p>I hope someone can help me to fix this issue or pinpoint to problem area.</p>\n"}, {"tags": ["go", "heroku", "amazon-s3"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1520979027, "post_id": 49266516, "comment_id": 85536714, "body": "See <a href=\"https://aws.amazon.com/sdk-for-go\" rel=\"nofollow noreferrer\">aws.amazon.com/sdk-for-go</a>."}, {"owner": {"reputation": 143, "user_id": 3710436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10d2e323e4281f0aa667052e03a53dbe?s=128&d=identicon&r=PG&f=1", "display_name": "user3710436", "link": "https://stackoverflow.com/users/3710436/user3710436"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1520979943, "post_id": 49266516, "comment_id": 85537070, "body": "There is a download function available in the aws docs, I need a function for just reading the file"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1520980441, "post_id": 49266516, "comment_id": 85537241, "body": "<a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/s3/#S3.GetObject\" rel=\"nofollow noreferrer\">GetObject</a> fetches an object from S3."}], "answers": [{"comments": [{"owner": {"reputation": 1383, "user_id": 452388, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/ecb122e117a5a20f498ac22d400f2d8c?s=128&d=identicon&r=PG", "display_name": "Claudio Bredfeldt", "link": "https://stackoverflow.com/users/452388/claudio-bredfeldt"}, "edited": false, "score": 1, "creation_date": 1548141778, "post_id": 49270166, "comment_id": 95426035, "body": "Where did <code>file</code> come from?"}, {"owner": {"reputation": 441, "user_id": 2967920, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/f5aa8bb3e35b31d8d34a9d2fcce48565?s=128&d=identicon&r=PG&f=1", "display_name": "user2967920", "link": "https://stackoverflow.com/users/2967920/user2967920"}, "edited": false, "score": 0, "creation_date": 1552114881, "post_id": 49270166, "comment_id": 96896840, "body": "From the Github example"}, {"owner": {"reputation": 261, "user_id": 3296970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2cf279565c0a40258ff31c03d0221a5e?s=128&d=identicon&r=PG&f=1", "display_name": "Archie Yalakki", "link": "https://stackoverflow.com/users/3296970/archie-yalakki"}, "edited": false, "score": 0, "creation_date": 1553880013, "post_id": 49270166, "comment_id": 97564233, "body": "file points to localfile where the object has been downloaded to. So, this line file, err := os.Create(item) should&#39;ve been file, err := os.Create(&quot;item_local&quot;). Now when you run the above program it would download  to item_local and place it from where ever you&#39;re running your program from."}], "tags": [], "owner": {"reputation": 217, "user_id": 1633066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MmSuB.jpg?s=128&g=1", "display_name": "Ammar Mohammed", "link": "https://stackoverflow.com/users/1633066/ammar-mohammed"}, "is_accepted": false, "score": 14, "last_activity_date": 1548947274, "last_edit_date": 1548947274, "creation_date": 1521004413, "answer_id": 49270166, "question_id": 49266516, "link": "https://stackoverflow.com/questions/49266516/reading-files-from-aws-s3-in-golang/49270166#49270166", "title": "Reading files from AWS S3 in Golang", "body": "<p>The code snippet below should work (given that you have installed the proper dependencies):</p>\n\n<pre><code>    package main\n\n    import (\n        \"github.com/aws/aws-sdk-go/aws\"\n        \"github.com/aws/aws-sdk-go/aws/session\"\n        \"github.com/aws/aws-sdk-go/service/s3\"\n        \"github.com/aws/aws-sdk-go/service/s3/s3manager\"\n\n        \"fmt\"\n        \"log\"\n        \"os\"\n    )\n\n    func main() {\n        // NOTE: you need to store your AWS credentials in ~/.aws/credentials\n\n        // 1) Define your bucket and item names\n        bucket := \"&lt;YOUR_BUCKET_NAME&gt;\"\n        item   := \"&lt;YOUR_ITEM_NAME&gt;\"\n\n        // 2) Create an AWS session\n        sess, _ := session.NewSession(&amp;aws.Config{\n                Region: aws.String(\"us-west-2\")},\n        )\n\n        // 3) Create a new AWS S3 downloader \n        downloader := s3manager.NewDownloader(sess)\n\n\n        // 4) Download the item from the bucket. If an error occurs, log it and exit. Otherwise, notify the user that the download succeeded.\n        file, err := os.Create(item)\n        numBytes, err := downloader.Download(file,\n            &amp;s3.GetObjectInput{\n                Bucket: aws.String(bucket),\n                Key:    aws.String(item),\n        })\n\n        if err != nil {\n            log.Fatalf(\"Unable to download item %q, %v\", item, err)\n        }\n\n        fmt.Println(\"Downloaded\", file.Name(), numBytes, \"bytes\")\n\n    }\n</code></pre>\n\n<p>For more details you can check the <a href=\"https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/s3-example-basic-bucket-operations.html\" rel=\"noreferrer\">AWS Go SDK</a> and the <a href=\"https://github.com/awsdocs/aws-doc-sdk-examples/blob/master/go/example_code/s3/s3_download_object.go\" rel=\"noreferrer\">Github Example</a></p>\n"}, {"tags": [], "owner": {"reputation": 1157, "user_id": 294439, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/jldP4.png?s=128&g=1", "display_name": "Serge Merzliakov", "link": "https://stackoverflow.com/users/294439/serge-merzliakov"}, "is_accepted": false, "score": 3, "last_activity_date": 1564623589, "last_edit_date": 1564623589, "creation_date": 1564621901, "answer_id": 57300648, "question_id": 49266516, "link": "https://stackoverflow.com/questions/49266516/reading-files-from-aws-s3-in-golang/57300648#57300648", "title": "Reading files from AWS S3 in Golang", "body": "<p>Here is a function for getting an object <strong>using V2 of the SDK</strong> (adapted from examples in <a href=\"https://github.com/aws/aws-sdk-go-v2\" rel=\"nofollow noreferrer\">https://github.com/aws/aws-sdk-go-v2</a>):</p>\n\n<p>Note: No Error handling - demo code only.</p>\n\n<pre><code>package s3demo\n\nimport (\n    \"os\"\n    \"context\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"github.com/aws/aws-sdk-go-v2/aws\"\n    \"github.com/aws/aws-sdk-go-v2/aws/awserr\"\n    \"github.com/aws/aws-sdk-go-v2/aws/external\"\n    \"github.com/aws/aws-sdk-go-v2/service/s3\"\n)\n\nfunc GetObjectWithV2SDKDemo() {\n    bucket := \"YOUR_BUCKET\"\n    key := \"YOUR_OBJECT_KEY\"\n    fileName := \"YOUR_FILE_PATH\"\n\n    // may need AWS_PROFILE and AWS_REGION populated as environment variables\n    cfg, err := external.LoadDefaultAWSConfig()\n    if err != nil {\n        panic(\"failed to load config, \" + err.Error())\n    }\n\n    svc := s3.New(cfg)\n    ctx := context.Background()\n    req := svc.GetObjectRequest(&amp;s3.GetObjectInput{\n        Bucket: aws.String(bucket),\n        Key:    aws.String(key),\n    })\n\n    resp, err := req.Send(ctx)\n    if err != nil {\n        panic(err)\n    }\n\n    s3objectBytes, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        panic(err)\n    }\n    // create file\n    f, err := os.Create(fileName)\n    defer f.Close()\n    if err != nil {\n        panic(err)\n    }\n\n    bytesWritten, err := f.Write(s3objectBytes)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Printf(\"Fetched %d bytes for S3Object\\n\", bytesWritten)\n    fmt.Printf(\"successfully downloaded data from %s/%s\\n to file %s\", bucket, key, fileName)\n} \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18271, "user_id": 447344, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hq0lN.jpg?s=128&g=1", "display_name": "Thomas Decaux", "link": "https://stackoverflow.com/users/447344/thomas-decaux"}, "is_accepted": false, "score": 3, "last_activity_date": 1599663910, "creation_date": 1599663910, "answer_id": 63814482, "question_id": 49266516, "link": "https://stackoverflow.com/questions/49266516/reading-files-from-aws-s3-in-golang/63814482#63814482", "title": "Reading files from AWS S3 in Golang", "body": "<p>Using current stable AWS lib for go:</p>\n<pre><code>sess := session.Must(session.NewSession(&amp;aws.Config{\n    ....\n    }))\n\n\nsvc := s3.New(sess)\n\nrawObject, err := svc.GetObject(\n                &amp;s3.GetObjectInput{\n                    Bucket: aws.String(&quot;toto&quot;),\n                    Key:    aws.String(&quot;toto.txt&quot;),\n                })\n\nbuf := new(bytes.Buffer)\nbuf.ReadFrom(rawObject.Body)\nmyFileContentAsString := buf.String()\n</code></pre>\n"}], "owner": {"reputation": 143, "user_id": 3710436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10d2e323e4281f0aa667052e03a53dbe?s=128&d=identicon&r=PG&f=1", "display_name": "user3710436", "link": "https://stackoverflow.com/users/3710436/user3710436"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 22010, "favorite_count": 3, "answer_count": 3, "score": 13, "last_activity_date": 1599663910, "creation_date": 1520978297, "question_id": 49266516, "link": "https://stackoverflow.com/questions/49266516/reading-files-from-aws-s3-in-golang", "title": "Reading files from AWS S3 in Golang", "body": "<p>I am trying to deploy a golang code on Heroku. My code needs a text file as input and I need to fetch this text file from S3 bucket. My go-code takes the filename as input, Can someone provide a code snippet for reading a file from S3 and storing its contents into a file?</p>\n\n<p>My GOlang code-</p>\n\n<pre><code>  func getDomains(path string) (lines []string, Error error) {\n\n    file, err := os.Open(path)\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    defer file.Close()\n\n    scanner := bufio.NewScanner(file)\n\n    for scanner.Scan() {\n        lines = append(lines, scanner.Text())\n    }\n\n    return lines, scanner.Err()\n}\n\nfunc Process(w http.ResponseWriter, r *http.Request) {\n\n\n    urls := make(chan *Http, Threads*10)\n    list, err := getDomains(\"**NEED A TEXT FILE FROM S3 HERE as an argument**\")\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    var wg sync.WaitGroup\n    for i := 0; i &lt; Threads; i++ {\n        wg.Add(1)\n        go func() {\n            for url := range urls {\n                url.DNS()\n            }\n\n            wg.Done()\n        }()\n    }\n\n    for i := 0; i &lt; len(list); i++ {\n        Progress := fmt.Sprintln(w, len(list))\n        urls &lt;- &amp;Http{Url: list[i], Num: Progress}\n    }\n\n    close(urls)\n\n    wg.Wait()\n\n    fmt.Printf(\"\\r%s\", strings.Repeat(\" \", 100))\n    fmt.Fprintln(w, \"\\rTask completed.\\n\")\n}\n</code></pre>\n\n<p>Can someone suggest a good library for <strong>reading</strong> the file from S3 into a text file? I cannot download the file from S3 because I have to deploy it on Heroku.</p>\n\n<p>A code snippet for example will be highly appreciated!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1520973901, "post_id": 49265533, "comment_id": 85534504, "body": "There&#39;s no such thing as a &quot;dead&quot; goroutine. An unrecovered panic crashes the program, but anything else is normal operation."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1520974128, "post_id": 49265533, "comment_id": 85534630, "body": "You could keep count by, well... keeping a count. At the start of the goroutine you could <code>defer</code> incrementing a global int or something. <code>defer</code>ed statements still execute in the event of a panic."}, {"owner": {"reputation": 49, "user_id": 8383667, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh6.googleusercontent.com/-hfZySuOHdGg/AAAAAAAAAAI/AAAAAAAAAFY/Ksu3_YA3V_4/photo.jpg?sz=128", "display_name": "p-ray", "link": "https://stackoverflow.com/users/8383667/p-ray"}, "edited": false, "score": 0, "creation_date": 1520975303, "post_id": 49265533, "comment_id": 85535152, "body": "But I only want to keep track fo the go routines if they end due to abnormal conditions such as panic / errors."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1520976617, "post_id": 49265533, "comment_id": 85535685, "body": "@p-ray: but error are <i>not</i> abnormal, only you can define what that means. An &quot;abnormal&quot; panic should crash the program, so there&#39;s not really anything to count there."}, {"owner": {"reputation": 49, "user_id": 8383667, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh6.googleusercontent.com/-hfZySuOHdGg/AAAAAAAAAAI/AAAAAAAAAFY/Ksu3_YA3V_4/photo.jpg?sz=128", "display_name": "p-ray", "link": "https://stackoverflow.com/users/8383667/p-ray"}, "edited": false, "score": 0, "creation_date": 1520985623, "post_id": 49265533, "comment_id": 85538948, "body": "A panic doesn&#39;t propagate out of the go routine."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520995976, "post_id": 49265533, "comment_id": 85541299, "body": "@p-ray, yes it does, that\u2019s the whole point, panics are meant to terminate the program. <a href=\"https://play.golang.org/p/7sRJXkK7pOV\" rel=\"nofollow noreferrer\">play.golang.org/p/7sRJXkK7pOV</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1521013968, "post_id": 49265533, "comment_id": 85547227, "body": "This looks like an XY Problem. What is the actual problem you&#39;re trying to solve? Obviously, counting non-existant entities isn&#39;t the right answer."}], "answers": [{"comments": [{"owner": {"reputation": 49, "user_id": 8383667, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh6.googleusercontent.com/-hfZySuOHdGg/AAAAAAAAAAI/AAAAAAAAAFY/Ksu3_YA3V_4/photo.jpg?sz=128", "display_name": "p-ray", "link": "https://stackoverflow.com/users/8383667/p-ray"}, "edited": false, "score": 0, "creation_date": 1520985591, "post_id": 49266232, "comment_id": 85538940, "body": "Thank you @Grzegorz you are a life saver. :D :D :D :D"}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 0, "last_activity_date": 1520976929, "creation_date": 1520976929, "answer_id": 49266232, "question_id": 49265533, "link": "https://stackoverflow.com/questions/49265533/how-to-keep-count-of-go-routines-that-are-dead/49266232#49266232", "title": "How to keep count of go routines that are dead?", "body": "<p>Use deferred function that will recover from panic.</p>\n\n<pre><code>func count() {\n    err := recover()\n    if err != nil {\n        // count error\n    } else {\n        // count no error\n    }\n}\n\nfunc trap() {\n    defer count()\n    if rand.Intn(2) &gt;= 1 {\n        panic(\"bad luck\")\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 8383667, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh6.googleusercontent.com/-hfZySuOHdGg/AAAAAAAAAAI/AAAAAAAAAFY/Ksu3_YA3V_4/photo.jpg?sz=128", "display_name": "p-ray", "link": "https://stackoverflow.com/users/8383667/p-ray"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 49266232, "answer_count": 1, "score": -4, "last_activity_date": 1520976929, "creation_date": 1520973791, "last_edit_date": 1520975347, "question_id": 49265533, "link": "https://stackoverflow.com/questions/49265533/how-to-keep-count-of-go-routines-that-are-dead", "title": "How to keep count of go routines that are dead?", "body": "<p>I have a piece of code where we run multiple go routines multiple to receive values. I am trying to keep count of how many go routines have died due to some exception or error. I don't want to update the count for normal execution.</p>\n\n<pre><code>  for {\n    go func(){\n       err := receiveValues()\n\n    }()\n  }\n</code></pre>\n\n<p>Here, receiveValues will call other function and return err if they fail</p>\n\n<pre><code>func recieveValues() error{\n  if err, val := callSomeFunc(); err != nil{\n    return err\n  }\n\n  if err2, val2 := callOtherFunc(val); err2 != nil{\n    return err2\n  }\n}\n</code></pre>\n\n<p>I could check when receiveValues() returns error and increment my count, but I also want to increment my count when go routine exits due to some panic or errors that I didn't expect, what will be the fool proof way to keep track to how many go routines have died?</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-ses", "dkim"], "comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1520973239, "post_id": 49264868, "comment_id": 85534178, "body": "<a href=\"https://serverfault.com/q/462664/126632\">serverfault.com/q/462664/126632</a>"}, {"owner": {"reputation": 429, "user_id": 1433721, "user_type": "registered", "accept_rate": 85, "profile_image": "https://lh5.googleusercontent.com/-lD6AeV9Tf58/AAAAAAAAAAI/AAAAAAAAAVs/0nRvIZ5-4NA/photo.jpg?sz=128", "display_name": "Andr&#233; G. Andrade", "link": "https://stackoverflow.com/users/1433721/andr%c3%a9-g-andrade"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1520974403, "post_id": 49264868, "comment_id": 85534764, "body": "Hi @MichaelHampton I found a comment at the link &quot;If your &#39;from&#39; description contains certain special characters it can fail even with everything set up correctly&quot; I removed the special characters and worked. I&#39;ll work on a solution and post latter. Thanks"}], "answers": [{"tags": [], "owner": {"reputation": 429, "user_id": 1433721, "user_type": "registered", "accept_rate": 85, "profile_image": "https://lh5.googleusercontent.com/-lD6AeV9Tf58/AAAAAAAAAAI/AAAAAAAAAVs/0nRvIZ5-4NA/photo.jpg?sz=128", "display_name": "Andr&#233; G. Andrade", "link": "https://stackoverflow.com/users/1433721/andr%c3%a9-g-andrade"}, "is_accepted": true, "score": 1, "last_activity_date": 1520975423, "creation_date": 1520975423, "answer_id": 49265919, "question_id": 49264868, "link": "https://stackoverflow.com/questions/49264868/aws-ses-sendrawemail-with-via-amazonses-com-warning/49265919#49265919", "title": "AWS SES SendRawEmail with via amazonses.com warning", "body": "<p>According this <a href=\"https://serverfault.com/questions/462664/remove-via-from-emails-sent-to-gmail-from-amazon-ses\">question</a> when the from descrition has special characters it fails to DKIM authentication. So I just mime encoded it using the following code.</p>\n\n<pre><code>mail.FromName(mime.QEncoding.Encode(\"UTF-8\", remetenteNome))\n</code></pre>\n"}], "owner": {"reputation": 429, "user_id": 1433721, "user_type": "registered", "accept_rate": 85, "profile_image": "https://lh5.googleusercontent.com/-lD6AeV9Tf58/AAAAAAAAAAI/AAAAAAAAAVs/0nRvIZ5-4NA/photo.jpg?sz=128", "display_name": "Andr&#233; G. Andrade", "link": "https://stackoverflow.com/users/1433721/andr%c3%a9-g-andrade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 407, "favorite_count": 0, "accepted_answer_id": 49265919, "answer_count": 1, "score": 0, "last_activity_date": 1520975423, "creation_date": 1520971084, "last_edit_date": 1520972730, "question_id": 49264868, "link": "https://stackoverflow.com/questions/49264868/aws-ses-sendrawemail-with-via-amazonses-com-warning", "title": "AWS SES SendRawEmail with via amazonses.com warning", "body": "<p>Hi I'm sending raw emails with attachemnts from Amazon AWS SES using raw format. To prepare the message I'm using the library github.com/domodwyer/mailyak and the following code. The problemn is that I'm receiving the \"via amazonses.com\" warning on GMail. When I send the email using SendEmail method I didn't get this warning. My domain and email has the DKIM signature. I also found <a href=\"https://stackoverflow.com/questions/28883840/amazonses-dkim-signature-not-inserted-with-sendrawemail\">this question</a> from a similar issue, but also without solution. </p>\n\n<p>The <a href=\"https://www.mail-tester.com\" rel=\"nofollow noreferrer\">mail-tester website</a> says that my message is has two DKIM signatures, one from my domain and other from amazonses.com</p>\n\n<pre><code>mail := mailyak.New(\"\", nil)\nmail.To(destinatario)\nmail.From(remetente)\nmail.FromName(remetenteNome)\nmail.Subject(titulo)\n\nif err := templateConteudo.ExecuteTemplate(mail.HTML(), \"conteudo\", emailData{Parametros: *parametros}); err != nil {\n    log.Println(err)\n    return\n}\n\nif anexos != nil {\n    for _, anexo := range anexos {\n        mail.Attach(anexo.Nome, *anexo.Arquivo)\n    }\n}\n\nbuffer, err := mail.MimeBuf()\nif err != nil {\n    log.Println(err)\n    return\n}\ndados, err := ioutil.ReadAll(buffer)\nif err != nil {\n    log.Println(err)\n    return\n}\n\ndadosSES := &amp;ses.SendRawEmailInput{\n    RawMessage: &amp;ses.RawMessage{\n        Data: dados,\n    },\n}\n\nif _, err := sesCTX.SendRawEmail(dadosSES); err != nil {\n    log.Println(err)\n    return\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520970004, "post_id": 49264525, "comment_id": 85532499, "body": "<code>test</code> is a slice not a <code>reflect.Value</code>, just use <code>append</code>."}, {"owner": {"reputation": 99, "user_id": 5969202, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1126780490673560/picture?type=large", "display_name": "Patrick", "link": "https://stackoverflow.com/users/5969202/patrick"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520983783, "post_id": 49264525, "comment_id": 85538388, "body": "Mhm but not if I wanna use the function like this. Var companies []company comp.FindAll(&amp;companies)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520984105, "post_id": 49264525, "comment_id": 85538476, "body": "Well then <code>companies</code> is also a slice, but it\u2019s a different type so you can\u2019t pass it to FindAll anyway."}], "answers": [{"comments": [{"owner": {"reputation": 99, "user_id": 5969202, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1126780490673560/picture?type=large", "display_name": "Patrick", "link": "https://stackoverflow.com/users/5969202/patrick"}, "edited": false, "score": 0, "creation_date": 1521019020, "post_id": 49270600, "comment_id": 85549977, "body": "Awesome, thanks for the example and the explaining. Now i understand it!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1521008613, "last_edit_date": 1521008613, "creation_date": 1521006929, "answer_id": 49270600, "question_id": 49264525, "link": "https://stackoverflow.com/questions/49264525/golang-reflect-into-interface/49270600#49270600", "title": "golang reflect into []interface{}", "body": "<p>Use <code>interface{}</code> instead of <code>[]interface{}</code> as the argument type:</p>\n\n<pre><code>func (m *Model) FindAll(result interface{}, c *Condition) error {\n  stmt := PrepairStmt(m, c)\n  rows, err := m.db.Query(stmt.selectParse(), c.arguments...)\n  if err != nil {\n    return err\n  }\n  defer rows.Close()\n\n  // resultv is the result slice\n  resultv := reflect.ValueOf(result).Elem()\n\n  // rowt is the struct type\n  rowt := resultv.Type().Elem()\n\n  // allocate a value for the row\n  rowv := reflect.New(rowt).Elem()\n\n  // collect values for scan\n  var values []interface{}\n  for _, e := range m.columns {\n      values = append(values, rowv.FieldByName(e.name).Addr().Interface())\n  }\n\n  for rows.Next() {\n\n    err = rows.Scan(values...)\n    if err != nil {\n      return err\n    }\n\n    // Append struct to result slice. Because the struct\n    // is copied in append, we can reuse the struct in \n    // this loop. \n    resultv.Set(reflect.Append(resultv, rowv))\n  }\n  return nil\n}\n</code></pre>\n\n<p>Use it like this:</p>\n\n<pre><code>var companies []company\ncomp.InitModel(newDbConnection(), &amp;comp)\ncomp.FindAll(&amp;companies) //in this is the db query and scan\n</code></pre>\n"}], "owner": {"reputation": 99, "user_id": 5969202, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1126780490673560/picture?type=large", "display_name": "Patrick", "link": "https://stackoverflow.com/users/5969202/patrick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 506, "favorite_count": 0, "accepted_answer_id": 49270600, "answer_count": 1, "score": 0, "last_activity_date": 1521008613, "creation_date": 1520969796, "question_id": 49264525, "link": "https://stackoverflow.com/questions/49264525/golang-reflect-into-interface", "title": "golang reflect into []interface{}", "body": "<p>i wanna create a mini framework which takes a simple struct and creates a full crud out of it. i already started and the \"findOne, update,create,delete\" is working. not i have a problem to create a findAll method. to be more clear, i dont know how to use reflect to address my ptr to an array of struct.</p>\n\n<p>Here a small example for the findOne function.</p>\n\n<pre><code>type company struct {\nId          int\nName        string\n}\n\ncomp.InitModel(newDbConnection(), &amp;comp)\n</code></pre>\n\n<p>In InitModel i can fill the pointer to the company with the following:</p>\n\n<pre><code>//m.caller = pointer to the ptr to comp (struct)\ncallerV := reflect.ValueOf(m.caller)\nCallerField := callerV.Elem()\nvar values []interface{}\nfor _, e := range m.columns {\n    values = append(values, CallerField.FieldByName(e.name).Addr().Interface())\n}\nerr := r.Scan(values...)\nif err != nil {\n    return err\n}\n</code></pre>\n\n<p>Now i wanna create a findAll method which would be called like this</p>\n\n<pre><code>var companies []company\ncomp.InitModel(newDbConnection(), &amp;comp)\ncomp.FindAll(&amp;companies) //in this is the db query and scan\nfmt.Println(companies) //here should be the result\n</code></pre>\n\n<p>But i have a problem to get the reflect with a []interface working.</p>\n\n<pre><code>func (m *Model) FindAll(test []interface{}, c *Condition) error {\n\n//get the sql statement from the struct\nstmt := PrepairStmt(m, c)\n\nrows, err := m.db.Query(stmt.selectParse(), c.arguments...)\nif err != nil {\n    return err\n}\ndefer rows.Close()\n\ncallerV := reflect.ValueOf(m.caller)\nCallerField := callerV.Elem()\nfor rows.Next() {\n\n    var values []interface{}\n    for _, e := range m.columns {\n        values = append(values, CallerField.FieldByName(e.name).Addr().Interface())\n    }\n\n    err = rows.Scan(values...)\n    if err != nil {\n        return err\n    }\n\n    valuePtr := reflect.New(reflect.TypeOf(test).Elem())\n    test = reflect.Append(test,reflect.ValueOf(values))\n}\n\nreturn nil\n}\n</code></pre>\n\n<p>Thats were my latest tries.\nmaybe someone can help me with this.\ni would be really thankful</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520967768, "post_id": 49263921, "comment_id": 85531366, "body": "You have typos: <code>&quot;LayoutColumns&quot; != &quot;layoutcolumns&quot;</code> and <code>&quot;layoutSections&quot; != &quot;layoutsections&quot;</code>"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1520967927, "post_id": 49263921, "comment_id": 85531435, "body": "Also, the text under &quot;Json:2&quot; in the question isn&#39;t valid JSON; maybe you meant <code>{&quot;x&quot;:&quot;y&quot;,&quot;z&quot;:&quot;a&quot;}</code> but you have <code>,</code> instead of <code>:</code>. If none of our comments so far help you solve it, your current parsing code and expected and actual results may help folks help you."}, {"owner": {"reputation": 75, "user_id": 9487414, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-RPNNiWhePUU/AAAAAAAAAAI/AAAAAAAAAHY/x9ECES-Kbi8/photo.jpg?sz=128", "display_name": "Nagaraja SV", "link": "https://stackoverflow.com/users/9487414/nagaraja-sv"}, "edited": false, "score": 0, "creation_date": 1520969862, "post_id": 49263921, "comment_id": 85532439, "body": "I have changed but still getting same problem"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520970563, "post_id": 49263921, "comment_id": 85532800, "body": "@NagarajaSV: Your &quot;Json:1&quot; example works just fine, so you need to show an the actual code in question. I have no idea what you are trying to do with &quot;Json:2&quot;."}, {"owner": {"reputation": 75, "user_id": 9487414, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-RPNNiWhePUU/AAAAAAAAAAI/AAAAAAAAAHY/x9ECES-Kbi8/photo.jpg?sz=128", "display_name": "Nagaraja SV", "link": "https://stackoverflow.com/users/9487414/nagaraja-sv"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520970869, "post_id": 49263921, "comment_id": 85532956, "body": "@JimB Right now in json1 I have empty value attribute and I am trying replace those empty values with ABC and EFZ"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520972122, "post_id": 49263921, "comment_id": 85533605, "body": "I&#39;m still unsure what it means to &quot;iterate between two json&quot;. <code>Json:2</code> is an object, and the only &quot;value&quot; field you have defined is a string -- are you trying to encode the Json:2 value again as a string?"}], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 9487414, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-RPNNiWhePUU/AAAAAAAAAAI/AAAAAAAAAHY/x9ECES-Kbi8/photo.jpg?sz=128", "display_name": "Nagaraja SV", "link": "https://stackoverflow.com/users/9487414/nagaraja-sv"}, "edited": false, "score": 0, "creation_date": 1521041617, "post_id": 49266013, "comment_id": 85566165, "body": "Thank you, Great!"}], "tags": [], "owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "is_accepted": true, "score": 0, "last_activity_date": 1520979985, "last_edit_date": 1520979985, "creation_date": 1520975859, "answer_id": 49266013, "question_id": 49263921, "link": "https://stackoverflow.com/questions/49263921/i-am-unable-to-iterate-between-two-json-in-golang/49266013#49266013", "title": "I am unable to iterate between two json in golang?", "body": "<p>I'm not sure If I got your request right but here's how I \"mapped\" the data from <code>Json2</code> to <code>Json1</code>.</p>\n\n<pre><code>// Added this for the inserter json (Json2)\ntype Inserter struct {\n    FirstName string `json:\"firstname\"`\n    LastName  string `json:\"lastname\"`\n}\n\nvar dat Layout\nvar ins Inserter\n\nfunc main() {\n    if err := json.Unmarshal(json1, &amp;dat); err != nil {\n        panic(err)\n    }\n    if err := json.Unmarshal(json2, &amp;ins); err != nil {\n        panic(err)\n    }\n\n    for sk, sec := range dat.LayoutSections {\n        for ck, col := range sec.LayoutColumns {\n            for ik, item := range col.LayoutItems {\n                itemPointer := &amp;dat.LayoutSections[sk].LayoutColumns[ck].LayoutItems[ik]\n\n                switch item.Name {\n                case \"firstname\":\n                    // Setting the FirstName value:\n                    itemPointer.Value = ins.FirstName\n                case \"lastname\":\n                    // Setting the LastName value:\n                    itemPointer.Value = ins.LastName\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<h3>Explanation:</h3>\n\n<p>Basically you can just dig into the:<br>\n<code>Layout</code> > <code>LayoutSections</code> > <code>LayoutColumns</code> > <code>LayoutItems</code></p>\n\n<p>Then check for the items you want to change, in our case <code>firstname</code> &amp; <code>lastname</code>. And finally just set their <code>Value</code> to what the <code>Inserter</code> json (Json2) contains.</p>\n\n<hr>\n\n<p>And here's the working <strong><a href=\"https://repl.it/@mihailo_misic/MappingJsonData\" rel=\"nofollow noreferrer\">Example</a></strong> with all the details.</p>\n"}], "owner": {"reputation": 75, "user_id": 9487414, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-RPNNiWhePUU/AAAAAAAAAAI/AAAAAAAAAHY/x9ECES-Kbi8/photo.jpg?sz=128", "display_name": "Nagaraja SV", "link": "https://stackoverflow.com/users/9487414/nagaraja-sv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 49266013, "answer_count": 1, "score": 0, "last_activity_date": 1520979985, "creation_date": 1520967522, "last_edit_date": 1520969920, "question_id": 49263921, "link": "https://stackoverflow.com/questions/49263921/i-am-unable-to-iterate-between-two-json-in-golang", "title": "I am unable to iterate between two json in golang?", "body": "<p>When I am calling an endpoint point getting below two json.\nIn response, I need to send one json response. \nIn Json1 <code>value</code> is empty and need to get the value from Json2. </p>\n\n<p>I am unable to get attributes with in \nLayoutSections</p>\n\n<p><em>Json:1</em></p>\n\n<pre><code>{\n\n    \"Name\": \"VisitDoctorLayout\",\n    \"Kind\": \"Visit\",\n    \"layoutsections\": [\n        {\n            \"label\": \"AccountInformation\",\n            \"style\": \"TwoColumnsTopToBottom\",\n            \"layoutcolumns\": [\n                {\n                    \"layoutitems\": [\n                        {\n                            \"behavior\": \"edit\",\n                            \"name\": \"firstname\",\n                            \"type\": \"string\",\n                            \"label\": \"first Name\",\n                            \"value\": \"\"\n                        },\n                        {\n                            \"behavior\": \"Required\",\n                            \"name\": \"lastname\",\n                            \"type\": \"string\",\n                            \"label\": \"Last Name\",\n                            \"value\": \"\"\n                        }\n                    ]\n                }\n            ]\n        }\n    ]\n}\n</code></pre>\n\n<p>Json:2</p>\n\n<pre><code>{\"firstname\":\"ABC\",\n\"lastname\":\"EFZ\"\n}\n</code></pre>\n\n<p>My sruct is something like below</p>\n\n<pre><code>type Layout struct {\n    ID             string           `json:\"ID\"`\n    Name           string           `json:\"name\"`\n    Kind           string           `json:\"kind\"`\n    Namespace      string           `json:\"namespace\"`\n    LayoutSections []LayoutSections `json:\"layoutsections\"`\n}\ntype LayoutSections struct {\n    Label         string          `json:\"label\"`\n    Style         string          `json:\"style\"`\n    LayoutColumns []LayoutColumns `json:\"layoutcolumns\"`\n}\n\ntype LayoutColumns struct {\n    LayoutItems []LayoutItems `json:\"layoutitems\"`\n}\ntype LayoutItems struct {\n    Behavior string `json:\"behavior\"`\n    Name     string `json:\"name\"`\n    Type     string `json:\"type\"`\n    Label    string `json:\"label\"`\n    Value    string `json:\"value\"`\n}\n</code></pre>\n"}, {"tags": ["go", "google-cloud-platform", "protocol-buffers", "google-cloud-endpoints", "grpc"], "comments": [{"owner": {"reputation": 449, "user_id": 3034042, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30a9a0a09fb8473eafdb9385a884fb69?s=128&d=identicon&r=PG&f=1", "display_name": "Wesley Wong", "link": "https://stackoverflow.com/users/3034042/wesley-wong"}, "edited": false, "score": 0, "creation_date": 1522356696, "post_id": 49263123, "comment_id": 86137864, "body": "Can you post your proto file? And to clarify, what you&#39;re saying is that Endpoints only recognizes client.WebRoute. The expectation is that it should just be WebRoute?"}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 5116946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/004cc92d4b17f210670a1375acb6f5cd?s=128&d=identicon&r=PG", "display_name": "lizan", "link": "https://stackoverflow.com/users/5116946/lizan"}, "is_accepted": false, "score": 0, "last_activity_date": 1522694424, "creation_date": 1522694424, "answer_id": 49616846, "question_id": 49263123, "link": "https://stackoverflow.com/questions/49263123/cloud-endpoint-grpc-dont-match-proto-definition/49616846#49616846", "title": "Cloud EndPoint GRPC dont match proto definition", "body": "<p>You cannot change the URL in the generated file. gRPC spec defines the HTTP path is \n<code>Service-Name \"/\" {method name}</code>. The Service-Name for protobuf is <code>?( {proto package name} \".\" ) {service name}</code>. You can change your proto file and regenerate the descriptors and your Go code to match what path you want.</p>\n"}], "owner": {"reputation": 1, "user_id": 9487208, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209411642763042/picture?type=large", "display_name": "William Quintal", "link": "https://stackoverflow.com/users/9487208/william-quintal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 316, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1522694424, "creation_date": 1520964789, "question_id": 49263123, "link": "https://stackoverflow.com/questions/49263123/cloud-endpoint-grpc-dont-match-proto-definition", "title": "Cloud EndPoint GRPC dont match proto definition", "body": "<p>I'm using Google Cloud EndPoints to access my GRPC server written in GoLang that run in Kuberkules. I was following the tutorial for <a href=\"https://cloud.google.com/endpoints/docs/grpc/configure-endpoints\" rel=\"nofollow noreferrer\">here</a>. Everythings is working but when i try to the a request i got this error </p>\n\n<p>rpc error: code = NotFound desc = Method does not exist.</p>\n\n<p>The EndPoint does not have the save URL has the one in my proto file , the have the package include in the name. Here is an exemple :</p>\n\n<p><a href=\"https://i.stack.imgur.com/QeGV3.png\" rel=\"nofollow noreferrer\">log request</a></p>\n\n<p>on the last request i change the value of the url in the generated protobuf file, it pass the endpoint but my server dont recognize it ... I got this error instead : </p>\n\n<pre><code>rpc error: code = Unimplemented desc = unknown service client.WebRoute\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/HgVEp.png\" rel=\"nofollow noreferrer\">protobuf generated code</a></p>\n\n<p>It was working locally , this is probably an issue about the descriptor files needed to generate the endpoints.</p>\n"}, {"tags": ["go", "serial-port"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1520957776, "post_id": 49260737, "comment_id": 85525502, "body": "Start by fixing the usage of the <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\"><code>io.Reader</code></a> according the documentation. How do you know you have an <code>io.EOF</code>? There&#39;s no code path here that checks for an EOF? There should not be a case where an <code>io.Reader</code> returns <code>n == 0</code> without an error."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1521024426, "post_id": 49260737, "comment_id": 85553706, "body": "FYI, the language is called &quot;Go&quot;. &quot;golang&quot; is a token recognized by a popular Internet search engine."}, {"owner": {"reputation": 427, "user_id": 6254868, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-coh80Kgp5wI/AAAAAAAAAAI/AAAAAAAAAEM/YAQYO15Emg0/photo.jpg?sz=128", "display_name": "\u041e\u043b\u0435\u0433 \u0421\u0438\u0434\u043e\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/6254868/%d0%9e%d0%bb%d0%b5%d0%b3-%d0%a1%d0%b8%d0%b4%d0%be%d1%80%d0%be%d0%b2"}, "edited": false, "score": 0, "creation_date": 1521112005, "post_id": 49260737, "comment_id": 85597381, "body": "Right you are, &quot;Go&quot; is the right name. But let&#39;s go to the subject."}, {"owner": {"reputation": 427, "user_id": 6254868, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-coh80Kgp5wI/AAAAAAAAAAI/AAAAAAAAAEM/YAQYO15Emg0/photo.jpg?sz=128", "display_name": "\u041e\u043b\u0435\u0433 \u0421\u0438\u0434\u043e\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/6254868/%d0%9e%d0%bb%d0%b5%d0%b3-%d0%a1%d0%b8%d0%b4%d0%be%d1%80%d0%be%d0%b2"}, "edited": false, "score": 1, "creation_date": 1521112624, "post_id": 49260737, "comment_id": 85597794, "body": "Now, I try manually handle disconections. But, I can not discover a good practice.  In the code of my app, once created descriptor &quot;walks&quot; from one function to another,  while it desposes by defer func. Thus, if I manually try to reconnect (close and re-create connection), all the stack of function calls gets a bad file descriptor. Is there a way to re-connect?"}, {"owner": {"reputation": 11257, "user_id": 10197418, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/be8Y6.jpg?s=128&g=1", "display_name": "MrFuppes", "link": "https://stackoverflow.com/users/10197418/mrfuppes"}, "edited": false, "score": 0, "creation_date": 1618235780, "post_id": 49260737, "comment_id": 118533952, "body": "related, although using <code>github.com&#47;tarm&#47;serial</code>: <a href=\"https://stackoverflow.com/q/50088669/10197418\">Golang reading from serial</a>"}], "owner": {"reputation": 427, "user_id": 6254868, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-coh80Kgp5wI/AAAAAAAAAAI/AAAAAAAAAEM/YAQYO15Emg0/photo.jpg?sz=128", "display_name": "\u041e\u043b\u0435\u0433 \u0421\u0438\u0434\u043e\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/6254868/%d0%9e%d0%bb%d0%b5%d0%b3-%d0%a1%d0%b8%d0%b4%d0%be%d1%80%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1051, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1521024322, "creation_date": 1520957099, "last_edit_date": 1521024322, "question_id": 49260737, "link": "https://stackoverflow.com/questions/49260737/read-and-write-serial-port-on-linux", "title": "Read and write serial port on Linux", "body": "<p>I use <code>github.com/jacobsa/go-serial/serial</code> package to work with serial port in my Go program.</p>\n\n<p>Simplified example:</p>\n\n<pre><code>options := serial.OpenOptions{\n        PortName: \"/dev/ttyUSB0\",\n        BaudRate: 115200,\n        DataBits: 8,\n        StopBits: 1,\n        MinimumReadSize = 0,\n        InterCharacterTimeout = 100,\n    }       \n\n\n    port, _ := serial.Open(options)\n    defer port.Close()\n\n    res := make([]byte, 1024)\n    var err error\n    var i int = 0\n\n    for i == 0 {\n        i, err = port.Read(res)\n        if err != nil &amp;&amp; err != io.EOF {\n            log.Printf(\"port.Read: %v\", err)\n            err = errors.New(\"I/O error\")\n        }\n\n}\nlog.Println(\"Read bytes: \", i)\n\n// do something else\n</code></pre>\n\n<p>When data is not ready, we have <code>io.EOF</code> error. But, when there is connection lost, there is also <code>io.EOF</code> errror! How could I distinguish waiting for new data and disconnection? If there is no data, FOR cycle need to be continue untill timeout is reached, but if connection is lost, I need to re-open port, because it's descriptor becames wrong. What is the good practice to handle these cases? </p>\n"}, {"tags": ["go", "byte", "buffer", "string-concatenation"], "comments": [{"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1520947782, "post_id": 49257401, "comment_id": 85517949, "body": "If golang (&lt;-- I don&#39;t know this language) has immutable string &amp; count reference (like Java), the second version is unnecessarily slow because of too many string copies."}, {"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 0, "creation_date": 1520949273, "post_id": 49257401, "comment_id": 85519035, "body": "general string concatenation is discussed at length here: <a href=\"https://stackoverflow.com/questions/1760757/how-to-efficiently-concatenate-strings-in-go\" title=\"how to efficiently concatenate strings in go\">stackoverflow.com/questions/1760757/&hellip;</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1520949326, "post_id": 49257401, "comment_id": 85519066, "body": "Why do you want to use bytes.Buffer in this case at all? There is no reason to it: It&#39;s slower, more complicated and has <i>zero</i> advantages. XY problem? Whats the actual question?"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1520950463, "post_id": 49257401, "comment_id": 85519927, "body": "A lot of the reason the second one is slow is because of how many times you call the <code>String()</code> method of the buffers.  Using the concatenation operation requires the runtime to allocate a new array of their joint length and copy both into it, which is a single operation.  Every time you call <code>String()</code>, the runtime has to copy the <i>entire buffer</i> into a new array that it then creates a string header for (which is how the runtime guarantees immutability, can&#39;t reuse the source array).  If you handled the buffer version using bytes (or runes), it would be a lot faster."}], "answers": [{"comments": [{"owner": {"reputation": 93, "user_id": 9477402, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Xue Guo", "link": "https://stackoverflow.com/users/9477402/xue-guo"}, "edited": false, "score": 0, "creation_date": 1522565896, "post_id": 49260249, "comment_id": 86198478, "body": "Thanks a lot! Your advice is quiet useful to me!"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1520993393, "last_edit_date": 1520993393, "creation_date": 1520955631, "answer_id": 49260249, "question_id": 49257401, "link": "https://stackoverflow.com/questions/49257401/what-is-the-correct-way-of-using-bytes-buffer-to-implement-fibonacci-like-string/49260249#49260249", "title": "What is the correct way of using bytes.Buffer to implement Fibonacci-like string concatenation in Go?", "body": "<p>In Go, use the <a href=\"https://golang.org/pkg/testing/\" rel=\"nofollow noreferrer\"><code>testing</code></a> package for benchmarks. </p>\n\n<p>Write reasonably efficient Go functions. Don't perform unnecessary conversions. Minimize allocations and copies. And so on. Allow for non-ASCII characters, for example Chinese characters. Allow for strings of more than one character. Consider using a byte slice. For example,</p>\n\n<pre><code>func fibonacciN(n int) uint64 {\n    f := uint64(0)\n    a, b := uint64(0), uint64(1)\n    for i := 0; i &lt; n; i++ {\n        f, a, b = a, b, a+b\n        if a &gt; b {\n            break\n        }\n    }\n    return f\n}\n\nfunc Fibonacci(a, b string, n int) string {\n    if n &lt; 0 {\n        n = 0\n    }\n    switch n {\n    case 0:\n        return \"\"\n    case 1:\n        return a\n    case 2:\n        return b\n    }\n    f := make([]byte, len(a)*int(fibonacciN(n-1))+len(b)*int(fibonacciN(n)))\n    ab := a + b\n    copy(f[len(f)-len(ab):], ab)\n    for i := 4; i &lt;= n; i++ {\n        end := len(f) - (len(a)*int(fibonacciN(i-3)) + len(b)*int(fibonacciN(i-2)))\n        start := len(f) - (len(a)*int(fibonacciN(i-1)) + len(b)*int(fibonacciN(i)))\n        copy(f[start:end], f[end:])\n    }\n    return string(f)\n}\n</code></pre>\n\n<hr>\n\n<p>Benchmark functions. For example, with n = 20,</p>\n\n<pre><code>$ go test fib_test.go -bench=. -benchmem\ngoos: linux\ngoarch: amd64\nBenchmarkPeterSO-8    1000000     1851 ns/op    13568 B/op     2 allocs/op\nBenchmarkPlus-8        500000     2493 ns/op    18832 B/op    18 allocs/op\nBenchmarkBuffer-8      100000    12773 ns/op    90256 B/op    60 allocs/op\nPASS\n$ \n</code></pre>\n\n<p><code>fib_test.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"testing\"\n)\n\nvar benchN = 20\n\nfunc fibonacciN(n int) uint64 {\n    f := uint64(0)\n    a, b := uint64(0), uint64(1)\n    for i := 0; i &lt; n; i++ {\n        f, a, b = a, b, a+b\n        if a &gt; b {\n            break\n        }\n    }\n    return f\n}\n\nfunc FibonacciPeterSO(a, b string, n int) string {\n    if n &lt; 0 {\n        n = 0\n    }\n    switch n {\n    case 0:\n        return \"\"\n    case 1:\n        return a\n    case 2:\n        return b\n    }\n    f := make([]byte, len(a)*int(fibonacciN(n-1))+len(b)*int(fibonacciN(n)))\n    ab := a + b\n    copy(f[len(f)-len(ab):], ab)\n    for i := 4; i &lt;= n; i++ {\n        end := len(f) - (len(a)*int(fibonacciN(i-3)) + len(b)*int(fibonacciN(i-2)))\n        start := len(f) - (len(a)*int(fibonacciN(i-1)) + len(b)*int(fibonacciN(i)))\n        copy(f[start:end], f[end:])\n    }\n    return string(f)\n}\n\nfunc BenchmarkPeterSO(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        FibonacciPeterSO(\"a\", \"b\", benchN)\n    }\n}\n\nfunc FibonacciPlus(n int) string {\n    FiboResult := \"\"\n    prev_result := \"a\"\n    next_result := \"b\"\n    if n == 1 {\n        FiboResult = \"a\"\n    } else if n == 2 {\n        FiboResult = \"b\"\n    } else {\n        for i := 3; i &lt;= n; i++ {\n            FiboResult = prev_result + next_result\n            prev_result = next_result\n            next_result = FiboResult\n        }\n    }\n    return FiboResult\n}\n\nfunc BenchmarkPlus(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        FibonacciPlus(benchN)\n    }\n}\n\nfunc FibonacciBuffer(n int) bytes.Buffer {\n    var FiboResult bytes.Buffer\n    var prev_result bytes.Buffer\n    prev_result.WriteString(\"a\")\n    var next_result bytes.Buffer\n    next_result.WriteString(\"b\")\n    if n == 1 {\n        FiboResult.WriteString(\"a\")\n    } else if n == 2 {\n        FiboResult.WriteString(\"b\")\n    } else {\n        for i := 3; i &lt;= n; i++ {\n            FiboResult.Reset()\n            FiboResult.WriteString(prev_result.String())\n            FiboResult.WriteString(next_result.String())\n            prev_result.Reset()\n            prev_result.WriteString(next_result.String())\n            next_result.Reset()\n            next_result.WriteString(FiboResult.String())\n        }\n    }\n    return FiboResult\n}\n\nfunc BenchmarkBuffer(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        FibonacciBuffer(benchN)\n    }\n}\n\nvar testN = benchN\n\nfunc TestPeterSO(t *testing.T) {\n    for n := 0; n &lt;= testN; n++ {\n        got := FibonacciPeterSO(\"a\", \"b\", n)\n        want := FibonacciPlus(n)\n        if want != got {\n            t.Errorf(\"want: %s got: %s\", want, got)\n        }\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 93, "user_id": 9477402, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Xue Guo", "link": "https://stackoverflow.com/users/9477402/xue-guo"}, "edited": false, "score": 0, "creation_date": 1522565823, "post_id": 49295215, "comment_id": 86198468, "body": "Yes! I successed with your solution. Thanks a lot!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1521108727, "last_edit_date": 1521108727, "creation_date": 1521104817, "answer_id": 49295215, "question_id": 49257401, "link": "https://stackoverflow.com/questions/49257401/what-is-the-correct-way-of-using-bytes-buffer-to-implement-fibonacci-like-string/49295215#49295215", "title": "What is the correct way of using bytes.Buffer to implement Fibonacci-like string concatenation in Go?", "body": "<p><a href=\"https://golang.org/pkg/bytes/#Buffer\" rel=\"nofollow noreferrer\"><code>bytes.Buffer</code></a> (or the newer and faster <a href=\"https://golang.org/pkg/strings/#Builder\" rel=\"nofollow noreferrer\"><code>strings.Builder</code></a>) wins over simple <code>+</code> string concatenation if you want to append \"many\" values, and obtain the result once in the end, because intermediate allocations are not needed compared to using <code>+</code> multiple times.</p>\n\n<p>And you are not using <code>bytes.Buffer</code> this way: you just write one <code>string</code> into it, and you obtain its content and you reset it. That's just a roundtrip which turns out to be an overhead.</p>\n\n<p>The problem here is that generating the Fibonacci string you are seeking, that requires <em>prepending</em> text to the buffer, not <em>appending</em> to it. And <code>bytes.Buffer</code> only supports appending to it, so using it like this is not a good fit at all.</p>\n\n<h2>Generating reverse with <code>bytes.Buffer</code></h2>\n\n<p>Note that a prepend operation is basically an append operation if you generate the reverse of a string. Which means if we first would generate the reverse of the result, we could use <code>bytes.Buffer</code> to perform an append when otherwise a prepend would be needed. Of course the appended string would have to also be the reverse of what otherwise would be prepended.</p>\n\n<p>And of course when we're done, we have to reverse the result to get what we originally wanted.</p>\n\n<p>Also note that when building result in an iterative way, the successive intermediate result is the concatenation of the previous and the one before that. So to obtain the nth result, we can simply append the substring of what we already have! This is a nice optimization.</p>\n\n<p>Here's how it would look like:</p>\n\n<pre><code>func FibonacciReverseBuf(n int) string {\n    switch n {\n    case 0:\n        return \"\"\n    case 1:\n        return \"a\"\n    case 2:\n        return \"b\"\n    }\n\n    prev, prev2 := 1, 1\n\n    buf := bytes.NewBufferString(\"ba\")\n\n    for i := 3; i &lt; n; i++ {\n        buf.Write(buf.Bytes()[:buf.Len()-prev2])\n        prev2, prev = prev, prev+prev2\n    }\n\n    // Reverse\n    b := buf.Bytes()\n    for i, j := 0, len(b)-1; i &lt; j; i, j = i+1, j-1 {\n        b[i], b[j] = b[j], b[i]\n    }\n\n    return string(b)\n}\n</code></pre>\n\n<h2>Generating reverse with <code>[]byte</code> and <code>append()</code></h2>\n\n<p>Also note that since we're only appending, we can just as easily use a <code>[]byte</code> and use the builtin <code>append()</code> function:</p>\n\n<pre><code>func FibonacciReverse(n int) string {\n    switch n {\n    case 0:\n        return \"\"\n    case 1:\n        return \"a\"\n    case 2:\n        return \"b\"\n    }\n\n    prev, prev2 := 1, 1\n\n    b := []byte(\"ba\")\n\n    for i := 3; i &lt; n; i++ {\n        b = append(b, b[:len(b)-prev2]...)\n        prev2, prev = prev, prev+prev2\n    }\n\n    // Reverse\n    for i, j := 0, len(b)-1; i &lt; j; i, j = i+1, j-1 {\n        b[i], b[j] = b[j], b[i]\n    }\n\n    return string(b)\n}\n</code></pre>\n\n<h2>Preallocating and using <code>copy()</code> in a single <code>[]byte</code></h2>\n\n<p>Still, using <code>append()</code> may cause reallocations, because we don't know how big the buffer (the result) will be. So we start with a small buffer, and <code>append()</code> will increase it as needed. Also <code>append()</code> requires slice value (slice header) assignments. And we also have to reverse the result. </p>\n\n<p>A much faster solution would be to get rid of those cons.</p>\n\n<p>First let's calculate how big the result will be (this is essentially calculating the Fibonacci numbers), and allocate the required byte slice in one step.</p>\n\n<p>If we do so, we can do the \"prepend\" operations by copying parts of our buffer (which is a <code>[]byte</code>) to specific positions. So no <code>append()</code>, no reallocations, no reversing.</p>\n\n<p>This is how it will look like:</p>\n\n<pre><code>func Fibonacci(n int) string {\n    switch n {\n    case 0:\n        return \"\"\n    case 1:\n        return \"a\"\n    case 2:\n        return \"b\"\n    }\n\n    fibs := make([]int, n)\n    fibs[0], fibs[1] = 1, 1\n    for i := 2; i &lt; n; i++ {\n        fibs[i] = fibs[i-1] + fibs[i-2]\n    }\n\n    l := fibs[n-1]\n    b := make([]byte, l)\n    b[l-2], b[l-1] = 'a', 'b'\n    for i := 3; i &lt; n; i++ {\n        copy(b[l-fibs[i]:], b[l-fibs[i-2]:])\n    }\n\n    return string(b)\n}\n</code></pre>\n\n<h2>Testing the output</h2>\n\n<p>To test if the above functions give the result we expect them to give, we may use the following testing function:</p>\n\n<pre><code>func TestFibonacci(t *testing.T) {\n    cases := []struct {\n        n   int\n        exp string\n    }{\n        {0, \"\"},\n        {1, \"a\"},\n        {2, \"b\"},\n        {3, \"ab\"},\n        {4, \"bab\"},\n        {5, \"abbab\"},\n        {6, \"bababbab\"},\n        {7, \"abbabbababbab\"},\n    }\n\n    funcs := []struct {\n        name string\n        f    func(int) string\n    }{\n        {\"FibonacciReverseBuf\", FibonacciReverseBuf},\n        {\"FibonacciReverse\", FibonacciReverse},\n        {\"Fibonacci\", Fibonacci},\n    }\n\n    for _, c := range cases {\n        for _, f := range funcs {\n            if got := f.f(c.n); got != c.exp {\n                t.Errorf(\"%s: Expected: %s, got: %s, n: %d\",\n                    f.name, c.exp, got, c.n)\n            }\n        }\n    }\n}\n</code></pre>\n\n<h2>Benchmark results</h2>\n\n<p>Benchmarking with <code>n = 20</code>:</p>\n\n<pre><code>BenchmarkFibonacciReverseBuf-4   200000   10739 ns/op    18024 B/op   10 allocs/op\nBenchmarkFibonacciReverse-4      100000   13208 ns/op    28864 B/op   10 allocs/op\nBenchmarkFibonacci-4             500000    3383 ns/op    13728 B/op    3 allocs/op\nBenchmarkPeterSO-4               300000    4417 ns/op    13568 B/op    2 allocs/op\nBenchmarkPlus-4                  200000    6072 ns/op    18832 B/op   18 allocs/op\nBenchmarkBuffer-4                 50000   29608 ns/op    90256 B/op   60 allocs/op\n</code></pre>\n\n<p>We can see that this use of <code>bytes.Buffer</code> was much better than yours. Still, using concatenation was faster, because there aren't many concatenations here, they are small ones, and that doesn't require reversing in the end.</p>\n\n<p>On the other hand my <code>Fibonacci()</code> solution outperformed all other presented solutions.</p>\n"}], "owner": {"reputation": 93, "user_id": 9477402, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Xue Guo", "link": "https://stackoverflow.com/users/9477402/xue-guo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1207, "favorite_count": 1, "accepted_answer_id": 49295215, "answer_count": 2, "score": 0, "last_activity_date": 1521108727, "creation_date": 1520947605, "last_edit_date": 1520948023, "question_id": 49257401, "link": "https://stackoverflow.com/questions/49257401/what-is-the-correct-way-of-using-bytes-buffer-to-implement-fibonacci-like-string", "title": "What is the correct way of using bytes.Buffer to implement Fibonacci-like string concatenation in Go?", "body": "<p>I tested simple string concatenation in Go with \u201c+\u201d and bytes.Buffer (both \u201c<code>WriteString</code>\u201d and \u201c<code>Write(bytes)</code>\u201d. The result shows that \u201c+\u201d is much slower than the other two, which makes sense.</p>\n\n<p>However, when I use the three ways to implement Fibonacci-like string concatenation (i.e. a, b, ab, bab, abbab, bababbab, abbabbababbab), \u201c+\u201d performs the best. The sample codes and the benchmarking results are shown as follows.</p>\n\n<p>String \u201c+\u201d</p>\n\n<pre><code>func Fibonacci(n int) string {  \n    FiboResult := \"\"\n    prev_result := \"a\"\n    next_result := \"b\"\n    if n == 1{  \n        FiboResult = \"a\"\n    }else if n == 2 {  \n        FiboResult = \"b\"\n    }else{\n        for i := 3; i &lt;= n; i++ {\n            FiboResult = prev_result + next_result\n            prev_result = next_result\n            next_result = FiboResult\n        }\n    }   \n    return FiboResult\n}\n</code></pre>\n\n<p>bytes.Buffer (WriteString)</p>\n\n<pre><code>func Fibonacci(n int) bytes.Buffer {  \n    var FiboResult bytes.Buffer\n    var prev_result bytes.Buffer\n    prev_result.WriteString(\"a\")\n    var next_result bytes.Buffer\n    next_result.WriteString(\"b\")\n    if n == 1{  \n        FiboResult.WriteString(\"a\")\n    }else if n == 2 {  \n        FiboResult.WriteString(\"b\")\n    }else{\n        for i := 3; i &lt;= n; i++ {\n            FiboResult.Reset()\n            FiboResult.WriteString(prev_result.String())\n            FiboResult.WriteString(next_result.String())\n            prev_result.Reset()\n            prev_result.WriteString(next_result.String())\n            next_result.Reset()\n            next_result.WriteString(FiboResult.String())\n        }\n    }   \n    return FiboResult\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/osqQH.png\" rel=\"nofollow noreferrer\">the benchmarking results</a></p>\n\n<p>I believe it is the overhead of <code>bytes.Buffer.String()</code> that make this happen. But I could not figure out how to use bytes.Buffer correctly in this case. Or how could I modify my code to avoid the problem? Hints, sample codes, or explanations are all appreciated. Many thanks in advance!</p>\n"}, {"tags": ["regex", "go", "subdomain"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 5, "creation_date": 1520947031, "post_id": 49257201, "comment_id": 85517375, "body": "Don&#39;t use a regex. Use the <code>url</code> package to parse the URL. Then just split on period."}, {"owner": {"reputation": 190, "user_id": 11699746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cbe995bb424c2cd47c1c01690775d95?s=128&d=identicon&r=PG&f=1", "display_name": "ChrisG", "link": "https://stackoverflow.com/users/11699746/chrisg"}, "edited": false, "score": 1, "creation_date": 1598371309, "post_id": 49257201, "comment_id": 112434688, "body": "Just split on period.. ah yes.. please read the RFC before you suggest ....."}], "answers": [{"comments": [{"owner": {"reputation": 190, "user_id": 11699746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cbe995bb424c2cd47c1c01690775d95?s=128&d=identicon&r=PG&f=1", "display_name": "ChrisG", "link": "https://stackoverflow.com/users/11699746/chrisg"}, "edited": false, "score": 2, "creation_date": 1598371255, "post_id": 49258338, "comment_id": 112434656, "body": "I dont know why this is marked as the answer. It gives you the full hostname not the subdomain as questioned. Its not the answer."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user9455968"}, "is_accepted": true, "score": 4, "last_activity_date": 1520950130, "creation_date": 1520950130, "answer_id": 49258338, "question_id": 49257201, "link": "https://stackoverflow.com/questions/49257201/extract-subdomain-from-url-using-regexp-in-golang/49258338#49258338", "title": "Extract subdomain from URL using regexp in Golang", "body": "<p>The <a href=\"https://golang.org/pkg/net/url/\" rel=\"nofollow noreferrer\"><code>url</code></a> package has a function <a href=\"https://golang.org/pkg/net/url/#Parse\" rel=\"nofollow noreferrer\"><code>parse</code></a> that allows you to parse an URL. The parsed <a href=\"https://golang.org/pkg/net/url/#URL\" rel=\"nofollow noreferrer\"><code>URL</code></a> instance has a method <a href=\"https://golang.org/pkg/net/url/#URL.Hostname\" rel=\"nofollow noreferrer\"><code>Hostname</code></a> which will return you the hostname.</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"log\"\n    \"net/url\"\n)\n\nfunc main() {\n    u, err := url.Parse(\"http://login.localhost:3000\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(u.Hostname())\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>login.localhost\n</code></pre>\n\n<p>See <a href=\"https://play.golang.com/p/3R1TPyk8qck\" rel=\"nofollow noreferrer\">https://play.golang.com/p/3R1TPyk8qck</a></p>\n"}, {"tags": [], "owner": {"reputation": 190, "user_id": 12472166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7525d4b4d2b4c46883b7339fd7d66d01?s=128&d=identicon&r=PG", "display_name": "Aryan Ahmed Anik", "link": "https://stackoverflow.com/users/12472166/aryan-ahmed-anik"}, "is_accepted": false, "score": 0, "last_activity_date": 1614712225, "creation_date": 1614712225, "answer_id": 66445657, "question_id": 49257201, "link": "https://stackoverflow.com/questions/49257201/extract-subdomain-from-url-using-regexp-in-golang/66445657#66445657", "title": "Extract subdomain from URL using regexp in Golang", "body": "<p>This is what I've used</p>\n<pre class=\"lang-golang prettyprint-override\"><code>\nfunc getSubdomain(r *http.Request) string {\n    //The Host that the user queried.\n    host := r.URL.Host\n    host = strings.TrimSpace(host)\n    //Figure out if a subdomain exists in the host given.\n    hostParts := strings.Split(host, &quot;.&quot;)\n\n    fmt.Println(&quot;host parts&quot;,hostParts)\n\n    lengthOfHostParts := len(hostParts)\n\n    // scenarios\n    // A. site.com  -&gt; length : 2\n    // B. www.site.com -&gt; length : 3\n    // C. www.hello.site.com -&gt; length : 4\n\n    if lengthOfHostParts == 4 {\n        return strings.Join([]string{hostParts[1]},&quot;&quot;) // scenario C\n    }\n    \n    if lengthOfHostParts == 3 { // scenario B with a check\n        subdomain := strings.Join([]string{hostParts[0]},&quot;&quot;)\n        \n        if subdomain == &quot;www&quot; {\n            return &quot;&quot;\n        } else {\n            return subdomain\n        }\n    }\n\n    return &quot;&quot; // scenario A\n}\n\n</code></pre>\n"}], "owner": {"reputation": 403, "user_id": 3902270, "user_type": "registered", "profile_image": "https://graph.facebook.com/100006418927672/picture?type=large", "display_name": "Karl Andresen", "link": "https://stackoverflow.com/users/3902270/karl-andresen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4075, "favorite_count": 1, "accepted_answer_id": 49258338, "answer_count": 2, "score": 3, "last_activity_date": 1614712225, "creation_date": 1520946987, "question_id": 49257201, "link": "https://stackoverflow.com/questions/49257201/extract-subdomain-from-url-using-regexp-in-golang", "title": "Extract subdomain from URL using regexp in Golang", "body": "<p>In the code sample below, I use regex to extract the subdomain name from a given URL. This sample works, but I don't think I've done it correctly at the point where I compile the regex, mainly where I insert the 'virtualHost' variable. Any suggestions?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nvar (\n    virtualHost string\n    domainRegex *regexp.Regexp\n)\n\nfunc extractSubdomain(host string) string {\n    matches := domainRegex.FindStringSubmatch(host)\n    if matches != nil &amp;&amp; len(matches) &gt; 1 {\n        return matches[1]\n    }\n    return \"\"\n}\n\nfunc init() {\n    // virtualHost = os.GetEnv(\"VIRTUAL_HOST\")\n    virtualHost = \"login.localhost:3000\"\n\n    domainRegex = regexp.MustCompile(`^(?:https?://)?([-a-z0-9]+)(?:\\.` + virtualHost + `)*$`)\n}\n\nfunc main() {\n    // host := req.host\n    host := \"http://acme.login.localhost:3000\"\n\n    if result := extractSubdomain(host); result != \"\" {\n        fmt.Printf(\"Subdomain detected: %s\\n\", result)\n        return\n    }\n\n    fmt.Println(\"No subdomain detected\")\n}\n</code></pre>\n"}, {"tags": ["regex", "go", "amazon-s3"], "comments": [{"owner": {"reputation": 377, "user_id": 6583638, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1zobe.jpg?s=128&g=1", "display_name": "Flying_whale", "link": "https://stackoverflow.com/users/6583638/flying-whale"}, "edited": false, "score": 0, "creation_date": 1520943073, "post_id": 49255699, "comment_id": 85514637, "body": "<code>.</code> is a metacharacter in regexes, you have to escape it with <code>\\ </code>"}, {"owner": {"reputation": 2921, "user_id": 1610473, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/0aba1bea3eea941fd79209f3c6704453?s=128&d=identicon&r=PG", "display_name": "SaganRitual", "link": "https://stackoverflow.com/users/1610473/saganritual"}, "edited": false, "score": 0, "creation_date": 1520943107, "post_id": 49255699, "comment_id": 85514666, "body": "<a href=\"https://regex101.com/\" rel=\"nofollow noreferrer\">regex101.com</a>"}, {"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "edited": false, "score": 0, "creation_date": 1520943112, "post_id": 49255699, "comment_id": 85514670, "body": "You can use <code>&#47;&#47;s3.amazonaws.com&#47;([-A-z0-9.]+) </code>"}], "answers": [{"tags": [], "owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "is_accepted": false, "score": 0, "last_activity_date": 1520943182, "creation_date": 1520943182, "answer_id": 49255918, "question_id": 49255699, "link": "https://stackoverflow.com/questions/49255699/regex-in-go-lang-matching-period-and-and-a-z-0-9/49255918#49255918", "title": "Regex in go lang matching period and - and A-z 0-9", "body": "<p>Add dot to the character class:</p>\n\n<pre><code>//s3.amazonaws.com/([-A-z0-9.]+)\n</code></pre>\n\n<p><a href=\"https://regex101.com/r/DkLgBB/1/\" rel=\"nofollow noreferrer\">Demo</a></p>\n"}, {"tags": [], "owner": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "is_accepted": false, "score": 2, "last_activity_date": 1520953606, "last_edit_date": 1520953606, "creation_date": 1520953260, "answer_id": 49259426, "question_id": 49255699, "link": "https://stackoverflow.com/questions/49255699/regex-in-go-lang-matching-period-and-and-a-z-0-9/49259426#49259426", "title": "Regex in go lang matching period and - and A-z 0-9", "body": "<p>In your regex you use <code>[A-z0-9-]</code>. Note that <code>[A-z]</code> <a href=\"https://stackoverflow.com/questions/4923380/difference-between-regex-a-z-and-a-za-z\">is different</a> from <code>[A-Za-z]</code>.</p>\n\n<p>To match a literal dot you could escape it: <code>\\.</code></p>\n\n<p>This part <code>([A-z0-9-]\\.+)</code> in this regex <code>//s3.amazonaws.com/([A-z0-9-]\\.+)</code> will match your character class once and then one or more times the dot like <code>j.....</code></p>\n\n<p>To fully match the 2 urls from your example, you could add a dot in the character class, add an optional forward slash at the end and you might omit the capturing group (parenthesis around the character class<code>([])</code>) if you only want to match the full url and not use the data in the captured group itself for further usage.</p>\n\n<p><a href=\"https://regex101.com/r/DaqwLV/2\" rel=\"nofollow noreferrer\"><code>//s3\\.amazonaws\\.com/[.A-z0-9-]+/?</code></a></p>\n\n<p>Looking at the other urls in your example, maybe this regex can help you and you can adapt it to your further requirements:</p>\n\n<p><a href=\"https://regex101.com/r/DaqwLV/4\" rel=\"nofollow noreferrer\"><code>(?:https?:)?//[A-z0-9.-]+\\.amazonaws\\.com(?:/(?:[A-z0-9.-]*/?))?</code></a></p>\n"}], "owner": {"reputation": 1, "user_id": 2452378, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08aa70e0d60620da43c4104af4b3390e?s=128&d=identicon&r=PG", "display_name": "txt3rob", "link": "https://stackoverflow.com/users/2452378/txt3rob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1017, "favorite_count": 1, "answer_count": 2, "score": -1, "last_activity_date": 1520953606, "creation_date": 1520942571, "question_id": 49255699, "link": "https://stackoverflow.com/questions/49255699/regex-in-go-lang-matching-period-and-and-a-z-0-9", "title": "Regex in go lang matching period and - and A-z 0-9", "body": "<p>I am trying to do a Regex in Go to match s3 bucket urls.</p>\n\n<p>so far i have</p>\n\n<pre><code>https://s3.amazonaws.com/(.+?)/\",\n        \"http://s3.amazonaws.com/(.+?)/\",\n        \"//s3-us-east-2.amazonaws.com/(.+?)/\",\n        \"//s3-us-west-1.amazonaws.com/(.+?)/\",\n        \"//s3-us-west-2.amazonaws.com/(.+?)/\",\n        \"//s3.ca-central-1.amazonaws.com/(.+?)/\",\n        \"//s3-ap-south-1.amazonaws.com/(.+?)/\",\n        \"//s3-ap-northeast-2.amazonaws.com/(.+?)/\",\n        \"//s3-ap-southeast-1.amazonaws.com/(.+?)/\",\n        \"//s3-ap-northeast-1.amazonaws.com/(.+?)/\",\n        \"//s3-eu-central-1.amazonaws.com/(.+?)/\",\n        \"//s3-eu-west-1.amazonaws.com/(.+?)/\",\n        \"//s3-eu-west-2.amazonaws.com/(.+?)/\",\n        \"//s3-eu-west-3.amazonaws.com/(.+?)/\",\n        \"//s3.sa-east-1.amazonaws.com/(.+?)/\",\n        \"https://(.+?).s3.amazonaws.com\",\n        \"//s3.amazonaws.com/([A-z0-9-]+)\",\n        \"//s3-ap-southeast-2.amazonaws.com/(.+?)/\",\n</code></pre>\n\n<p>but this is overkill so i was looking at</p>\n\n<p><code>//s3.amazonaws.com/([A-z0-9-]+)</code> </p>\n\n<p>but this misses out the . but when i do //s3.amazonaws.com/([A-z0-9-]\\.+) it does not match any of the strings found.</p>\n\n<p>I am currently trying to match it against</p>\n\n<p><code>//s3.amazonaws.com/bucket.name/</code> and <code>//s3.amazonaws.com/bucket-name-here</code></p>\n\n<p>any suggestions?</p>\n"}, {"tags": ["http", "asynchronous", "go"], "comments": [{"owner": {"reputation": 1276, "user_id": 6237232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/557d1078fe8ace9c1e6f88d275f5f32a?s=128&d=identicon&r=PG&f=1", "display_name": "RidgeA", "link": "https://stackoverflow.com/users/6237232/ridgea"}, "edited": false, "score": 0, "creation_date": 1520939976, "post_id": 49254774, "comment_id": 85512641, "body": "Could you provide minimal amount of code to describe what exactly you want to achieve? I am (and I pretty sure someone else among SO users) not familiar with <code>Jetty-Continuation</code> :-)"}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1520943857, "post_id": 49254774, "comment_id": 85515162, "body": "The question is about a general strategy and therefore it needs no code.  It is OK not to be familiar with all the terms."}], "answers": [{"comments": [{"owner": {"reputation": 557, "user_id": 3392595, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c595f43f1e4e86aa9dea8b36fccb87ab?s=128&d=identicon&r=PG&f=1", "display_name": "Forepick", "link": "https://stackoverflow.com/users/3392595/forepick"}, "edited": false, "score": 0, "creation_date": 1520950555, "post_id": 49255130, "comment_id": 85520001, "body": "Agreed that the solution may be a bit different in Go, with it&#39;s lightweight routines. What if I have a client which my receive it&#39;s response synchronously, and a service which response asynchronously by sending a callback to it&#39;s clients. I want to develop a middleware-service which receives the request from the client, calls the async-service and holds the client&#39;s connection till a callback from the async-service is received."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 557, "user_id": 3392595, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c595f43f1e4e86aa9dea8b36fccb87ab?s=128&d=identicon&r=PG&f=1", "display_name": "Forepick", "link": "https://stackoverflow.com/users/3392595/forepick"}, "edited": false, "score": 1, "creation_date": 1520964239, "post_id": 49255130, "comment_id": 85529434, "body": "@Forepick, you let the HTTP handler sit and wait until the response is ready. The handler function is called in its own goroutine, one per request. That&#39;s why it&#39;s okay to wait."}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 11, "last_activity_date": 1521016128, "last_edit_date": 1521016128, "creation_date": 1520940945, "answer_id": 49255130, "question_id": 49254774, "link": "https://stackoverflow.com/questions/49254774/async-http-request-handling/49255130#49255130", "title": "async http request handling", "body": "<p>You do not need this behavior in Go.</p>\n\n<p>Java HTTP servers use threads and if the servlet waits for something it effectively blocks the current thread. Threads are heavy and thread pools are limited.</p>\n\n<p>In Go the HTTP server implementation uses goroutines and if they are waiting they will not block operating system thread. Goroutines are lightweight and scheduled effectively by Go runtime. By effectively scheduling I mean switching when goroutine makes a system call or waits on channel.</p>\n\n<p>Simply speaking, do not try to copy the workaround from Java servlets as the workaround is not needed in Go.</p>\n\n<p>Let's consider a Java servlet, servlets share operating system threads</p>\n\n<pre><code>class Slow extends HttpServlet {\n\n    public void doGet(HttpServletRequest request, HttpServletResponse response)\n        Thread.sleep(1000);\n        // stops the thread for a second\n        // operating system puts a thread aside and reuses processor\n        // it is out of Java control\n        // when all pooled HTTP server threads are sleeping no request is served\n    }\n\n}\n</code></pre>\n\n<p>and Go HTTP handler, each handler is run in a seperate goroutine</p>\n\n<pre><code>func fast(w http.ResponseWriter, r *http.Request) {\n    time.Sleep(10000 * time.Second) \n    // Go scheduler puts the goroutine aside \n    // and reuses OS thread for handling another request\n    // when one second passes the goroutine is scheduled again \n    // and finishes serving request\n}\n</code></pre>\n\n<p><strong>In Go you get what you want by default.</strong></p>\n"}], "owner": {"reputation": 557, "user_id": 3392595, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c595f43f1e4e86aa9dea8b36fccb87ab?s=128&d=identicon&r=PG&f=1", "display_name": "Forepick", "link": "https://stackoverflow.com/users/3392595/forepick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1471, "favorite_count": 0, "accepted_answer_id": 49255130, "answer_count": 1, "score": -2, "last_activity_date": 1521016128, "creation_date": 1520939759, "last_edit_date": 1520948275, "question_id": 49254774, "link": "https://stackoverflow.com/questions/49254774/async-http-request-handling", "title": "async http request handling", "body": "<p>I'm trying to handle an HTTP request in Go asynchronously this way:</p>\n\n<ol>\n<li>I pass a handler function to the HTTP server</li>\n<li>In the handler I store the HttpRequest / HttpResponse objects in a slice or a map</li>\n<li>When returning from the handler function - the response is NOT returned to the client, but the connection remains open</li>\n<li>When \"some\" async input received from another source, I take the relevant HttpRequest / HttpResponse objects from memory, write the response and close the connection.</li>\n</ol>\n\n<p>What I aim for is very similar to Jetty-Continuation in Java.</p>\n\n<p>How can I implement such a behaviour in GoLang?</p>\n"}, {"tags": ["arrays", "string", "go", "slice"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1520934661, "post_id": 49252915, "comment_id": 85509254, "body": "That looks like a JSON array of strings, so how about unmarshaling it using the <code>encoding&#47;json</code> package?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1520935420, "post_id": 49252915, "comment_id": 85509750, "body": "Have you tried to spit the same and then save it into <code>map[string]string</code> with string index."}], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1520943742, "post_id": 49253127, "comment_id": 85515075, "body": "This also removes leading and trailing square brackets that may be part of the first or last string elements such as <code>[&quot;[211007@it_4&quot;,&quot;211008@it_4&quot;]</code>."}], "tags": [], "owner": {"reputation": 78, "user_id": 2790407, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf35247b7ced6e3b77ab9ba1e6509644?s=128&d=identicon&r=PG", "display_name": "zitryss", "link": "https://stackoverflow.com/users/2790407/zitryss"}, "is_accepted": false, "score": 0, "last_activity_date": 1520935062, "creation_date": 1520935062, "answer_id": 49253127, "question_id": 49252915, "link": "https://stackoverflow.com/questions/49252915/how-to-convert-string-to-array-of-string/49253127#49253127", "title": "How to convert string to array of string", "body": "<p>The standard library contains functions to work with strings (e.g. <code>strings.Trim()</code> and <code>strings.Split()</code>).</p>\n\n<p>See the code - <a href=\"https://play.golang.org/p/vOAzyU4eZbf\" rel=\"nofollow noreferrer\">https://play.golang.org/p/vOAzyU4eZbf</a></p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1520943687, "creation_date": 1520943687, "answer_id": 49256088, "question_id": 49252915, "link": "https://stackoverflow.com/questions/49252915/how-to-convert-string-to-array-of-string/49256088#49256088", "title": "How to convert string to array of string", "body": "<p>Your input looks like a JSON array with string elements. If that is so, simply use the <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\"><code>encoding/json</code></a> package to unmarshal it into a <code>[]string</code> variable.</p>\n\n<p>Example:</p>\n\n<pre><code>s := `[\"211007@it_4\",\"211008@it_4\"]`\nvar parts []string\nif err := json.Unmarshal([]byte(s), &amp;parts); err != nil {\n    fmt.Println(err)\n}\nfmt.Println(\"elements:\", parts)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/bi7SCoKAp_Q\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>elements: [211007@it_4 211008@it_4]\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 9073722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b09427cdc9f37084b8eab8b0fa1a0c9?s=128&d=identicon&r=PG&f=1", "display_name": "Nikunj Patel", "link": "https://stackoverflow.com/users/9073722/nikunj-patel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "accepted_answer_id": 49256088, "answer_count": 2, "score": -2, "last_activity_date": 1520944378, "creation_date": 1520934465, "last_edit_date": 1520944378, "question_id": 49252915, "link": "https://stackoverflow.com/questions/49252915/how-to-convert-string-to-array-of-string", "title": "How to convert string to array of string", "body": "<p>I am trying to convert a string <code>[\"211007@it_4\",\"211008@it_4\"]</code>, which is saved in MySQL database to an array of string to use it as an index value. </p>\n\n<p>I can not find a good way to do this in Go.</p>\n"}, {"tags": ["regex", "go", "text-processing"], "comments": [{"owner": {"reputation": 159902, "user_id": 3297613, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/KHhzd.jpg?s=128&g=1", "display_name": "Avinash Raj", "link": "https://stackoverflow.com/users/3297613/avinash-raj"}, "edited": false, "score": 3, "creation_date": 1520933525, "post_id": 49252535, "comment_id": 85508470, "body": "How can I 1. get your attempts? 2. get the lang that you&#39;re currently running?"}], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1520941331, "post_id": 49252985, "comment_id": 85513470, "body": "Why are you showing PHP code when the question is tagged Go?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1520943471, "post_id": 49252985, "comment_id": 85514912, "body": "@icza: Read the comment on the question: &quot;How can I 1. get your attempts? 2. get the lang that you&#39;re currently running?&quot; Check the revision history: <a href=\"https://stackoverflow.com/revisions/49252535/2\">stackoverflow.com/revisions/49252535/2</a>. The go tag was added to the original question after this answer was posted."}], "tags": [], "owner": {"reputation": 2959, "user_id": 454827, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/82010a08bede7e85ff79cb7d09e271c9?s=128&d=identicon&r=PG", "display_name": "ZiTAL", "link": "https://stackoverflow.com/users/454827/zital"}, "is_accepted": false, "score": 0, "last_activity_date": 1520934641, "creation_date": 1520934641, "answer_id": 49252985, "question_id": 49252535, "link": "https://stackoverflow.com/questions/49252535/regex-for-a-n-digit-number-that-ends-with-a-particular-letter/49252985#49252985", "title": "Regex for a n digit number that ends with a particular letter", "body": "<pre><code>&lt;?php\n$input = array();\n$input[] = '123456789000A';\n$input[] = '123456789012';\n$input[] = '12345678901';\n\nforeach($input as $i)\n{\n    preg_match(\"/^([0-9]+[a-z]{1}|[0-9]{12})$/i\", $i, $m);\n    print_r($m);\n}\n</code></pre>\n\n<p>Output: First match, second match, third not match</p>\n\n<pre><code>Array\n(\n    [0] =&gt; 123456789000A\n    [1] =&gt; 123456789000A\n)\nArray\n(\n    [0] =&gt; 123456789012\n    [1] =&gt; 123456789012\n)\nArray\n(\n)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 91458, "user_id": 5424988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b4f91c20dcd87cbd58dd351455198c?s=128&d=identicon&r=PG&f=1", "display_name": "The fourth bird", "link": "https://stackoverflow.com/users/5424988/the-fourth-bird"}, "is_accepted": true, "score": 1, "last_activity_date": 1520940062, "last_edit_date": 1520940062, "creation_date": 1520939109, "answer_id": 49254563, "question_id": 49252535, "link": "https://stackoverflow.com/questions/49252535/regex-for-a-n-digit-number-that-ends-with-a-particular-letter/49254563#49254563", "title": "Regex for a n digit number that ends with a particular letter", "body": "<p>You could match either 12 digits <code>[0-9]{12}</code> or 10 digits and an uppercase character <code>[0-9]{10}[A-Z]</code> using an or <code>|</code> in a non capturing group <code>(?:</code> for example:</p>\n\n<p><a href=\"https://regex101.com/r/UBigJ3/1\" rel=\"nofollow noreferrer\"><code>^(?:[0-9]{12}|[0-9]{10}[A-Z])$</code></a></p>\n\n<p>Or match your values between word boundaries <code>\\b</code>:</p>\n\n<p><a href=\"https://regex101.com/r/oFjvOu/1\" rel=\"nofollow noreferrer\"><code>\\b(?:[0-9]{12}|[0-9]{10}[A-Z])\\b</code></a></p>\n\n<p>To match one or more digits OR 10 digits followed by an uppercase character your could use this regex with word boundaries or anchored <code>$^</code>:</p>\n\n<p><a href=\"https://regex101.com/r/pySvBr/1\" rel=\"nofollow noreferrer\"><code>\\b(?:[0-9]+|[0-9]{10}[A-Z])\\b</code></a></p>\n"}], "owner": {"reputation": 407, "user_id": 473482, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/4d1d2d71be28186fdd5b2e2690eb8186?s=128&d=identicon&r=PG", "display_name": "ruwanego", "link": "https://stackoverflow.com/users/473482/ruwanego"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 49254563, "answer_count": 2, "score": -5, "last_activity_date": 1520940062, "creation_date": 1520933409, "last_edit_date": 1520935915, "question_id": 49252535, "link": "https://stackoverflow.com/questions/49252535/regex-for-a-n-digit-number-that-ends-with-a-particular-letter", "title": "Regex for a n digit number that ends with a particular letter", "body": "<p>How can I extract:</p>\n\n<ol>\n<li>A string with n digits (say 10) that ends with a letter (say \"A\"), for example: 4024204455A</li>\n<li>A 12-digit number, for example: 192345006905</li>\n</ol>\n\n<p>using a regex, from multiple text files with Go (golang)?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1520934227, "post_id": 49251583, "comment_id": 85508913, "body": "See related / possible duplicates: <a href=\"https://stackoverflow.com/questions/46956290/pointer-methods-on-non-pointer-types/46956348#46956348\">one</a>, <a href=\"https://stackoverflow.com/questions/42477951/what-is-the-method-set-of-sync-waitgroup/42480671#42480671\">two</a>, <a href=\"https://stackoverflow.com/questions/38481420/calling-a-method-with-a-pointer-receiver-by-an-object-instead-of-a-pointer-to-it/38481697#38481697\">three</a>."}, {"owner": {"reputation": 829, "user_id": 4667256, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/860591147318225/picture?type=large", "display_name": "Gilbert Nwaiwu", "link": "https://stackoverflow.com/users/4667256/gilbert-nwaiwu"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1520935218, "post_id": 49251583, "comment_id": 85509621, "body": "Thanks for these. Makes my question sort of a duplicate but at least the bit about addresses is unique."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1520935259, "post_id": 49251583, "comment_id": 85509647, "body": "That&#39;s also a duplicate of other questions..."}, {"owner": {"reputation": 829, "user_id": 4667256, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/860591147318225/picture?type=large", "display_name": "Gilbert Nwaiwu", "link": "https://stackoverflow.com/users/4667256/gilbert-nwaiwu"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1520935400, "post_id": 49251583, "comment_id": 85509738, "body": "Can you find one? I can&#39;t seem to find anything on it. Even more confusing i can get the address of a struct object by getting a pointer to the pointer"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1520935891, "post_id": 49251583, "comment_id": 85510068, "body": "The last part is a duplicate of <a href=\"https://stackoverflow.com/questions/39739743/golang-interface-func-to-print-memory-address/39740087#39740087\">Golang: interface func to print memory address</a>; also see <a href=\"https://stackoverflow.com/questions/42039827/difference-between-golang-pointers/42042673#42042673\">Difference between golang pointers</a>."}, {"owner": {"reputation": 829, "user_id": 4667256, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/860591147318225/picture?type=large", "display_name": "Gilbert Nwaiwu", "link": "https://stackoverflow.com/users/4667256/gilbert-nwaiwu"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1520936361, "post_id": 49251583, "comment_id": 85510398, "body": "I see. So its not like the value is not an address but fmt formats differently. Thanks for these"}], "answers": [{"comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1520933644, "post_id": 49252075, "comment_id": 85508557, "body": "you are saying that a pointer receiver type variable points to different address while when we use it as argument it points to different address"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1520933867, "post_id": 49252075, "comment_id": 85508683, "body": "Explain the last part of the question about <code>*int</code> being printed as an address but not <code>*Person</code> and it&#39;ll be complete."}, {"owner": {"reputation": 829, "user_id": 4667256, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/860591147318225/picture?type=large", "display_name": "Gilbert Nwaiwu", "link": "https://stackoverflow.com/users/4667256/gilbert-nwaiwu"}, "edited": false, "score": 0, "creation_date": 1520934253, "post_id": 49252075, "comment_id": 85508933, "body": "Very good explanation. I sort of guessed that go does the conversion for you. Please explain the last bit about printing the memory address so that I can accept this as the correct answer"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1521023100, "post_id": 49252075, "comment_id": 85552772, "body": "@Himanshu, I failed to parse this; care to elaborate? May be in a few more simple sentences."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 6, "last_activity_date": 1521023160, "last_edit_date": 1521023160, "creation_date": 1520931935, "answer_id": 49252075, "question_id": 49251583, "link": "https://stackoverflow.com/questions/49251583/go-struct-method-allows-type-mixing/49252075#49252075", "title": "Go struct method allows type mixing?", "body": "<p>You're confusing calling a method on a pointer receiver with keeping a pointer to a value. That is, there is no <em>inherent</em> connection between calling <code>SetName</code> defined on a pointer receiver with the requirement to store a pointer to a memory holding a value of type <code>Person</code> vs storing <code>Person</code> directly.</p>\n\n<p>When you have the declaration</p>\n\n<pre><code>var pers Person\n</code></pre>\n\n<p>and then call</p>\n\n<pre><code>pers.SetName(\"foo\")\n</code></pre>\n\n<p>the compiler takes the address of the memory block occupied by the\nvariable <code>pers</code>\u2014just like if you were doing that by hand through applying\nthe <code>&amp;</code> operator to <code>pers</code>, and passes that address to the <code>SetName</code>\nfunction, so the call ends up being done like</p>\n\n<pre><code>(&amp;pers).SetName(\"foo\")\n</code></pre>\n\n<p>or, to say it differently, the <code>SetName</code>'s receiver will be\n<code>&amp;pers</code>\u2014that is, the address of <code>pers</code>.</p>\n\n<p>Now there's nothing preventing you from taking the address of <code>pers</code>\nand storing it elsewhere:</p>\n\n<pre><code>var ptr *Person = &amp;pers\n</code></pre>\n\n<p>(you usually do not write such Java-style stuttering code but\nI'm doing this for extra clarity), and now you're able to call\n<code>SetName</code> right on the <code>ptr</code> value:</p>\n\n<pre><code>ptr.SetName(\"bar\")\n</code></pre>\n\n<p>Now the compiler will directly use the value stored in the variable <code>ptr</code>\nto pass it as the method's receiver.</p>\n\n<p>The final bit of this \"puzzle\" is that when you use\nthe special syntax provided by Go\u2014applying the address-taking operator <code>&amp;</code>\ndirectly to a literal,\u2014the compiler does something like this:</p>\n\n<pre><code>var __pers Person = Person{\n    // The contents of your literal\n}\nvar dave = &amp;__pers\n</code></pre>\n\n<p>\u2026and makes the <code>__pers</code> variable inaccessible by name (since it naturally\nhas no name).</p>\n\n<p>As you can see, this is no different from getting the pointer\nto a <code>Person</code> value's memory by hand.</p>\n\n<hr>\n\n<p>You might want to consult <a href=\"https://golang.org/doc/faq#different_method_sets\" rel=\"nofollow noreferrer\">this FAQ entry</a> to gain more understanding\nof how the method sets on a type <code>T</code> and <code>*T</code> relate, and why the latter\nalways includes the former but not vice-versa.\nAlso read <a href=\"https://golang.org/doc/faq#methods_on_values_or_pointers\" rel=\"nofollow noreferrer\">this</a>.</p>\n\n<hr>\n\n<p><em>Update:</em> to explain the difference in how <code>fmt.Println</code> formats and outputs\nthe values of type <code>*int</code> and <code>*Person</code>.</p>\n\n<ul>\n<li>The former is printed as the base-16 string representation\nof an address of a memory location containing that <code>int</code> value.</li>\n<li>The latter is rendered using a string representation resembling\nGo's syntax for taking a pointer to a literal: <code>&amp;{}</code>.</li>\n</ul>\n\n<p>This behaviour is as documented: <code>fmt.Print</code> and <code>fmt.Println</code>\nuse the so-called default formatting rules for the arguments they\nare passed, and these rules depend on the types of the arguments.</p>\n\n<p>Let's first consult the documentation on <code>fmt.Println</code>\n(run <code>go doc fmt.Println</code>):</p>\n\n<blockquote>\n  <p><code>func Println(a ...interface{}) (n int, err error)</code></p>\n  \n  <p><code>Println</code> formats <em>using the default formats for its operands</em>\n  and writes to standard output.\n  Spaces are always added between operands and a newline is appended.\n  It returns the number of bytes written and any write error encountered.</p>\n</blockquote>\n\n<p>(Emphasis mine.)</p>\n\n<p>Now let's turn to the documentation of the <code>fmt</code> package itself\n(run <code>go doc fmt</code>):</p>\n\n<blockquote>\n  <p>&lt;\u2026></p>\n  \n  <p>Printing</p>\n  \n  <p>The verbs:</p>\n  \n  <p>General:</p>\n  \n  <ul>\n  <li><p><code>%v</code> the value in a default format</p>\n  \n  <p>when printing structs, the plus flag (<code>%+v</code>) adds field names.</p></li>\n  </ul>\n  \n  <p>&lt;\u2026></p>\n  \n  <p>The default format for <code>%v</code> is:</p>\n\n<pre><code>bool:                    %t\nint, int8 etc.:          %d\nuint, uint8 etc.:        %d, %#x if printed with %#v\nfloat32, complex64, etc: %g\nstring:                  %s\nchan:                    %p\npointer:                 %p\n</code></pre>\n  \n  <p>For compound objects, the elements are printed using these rules,\n  recursively, laid out like this:</p>\n\n<pre><code>struct:             {field0 field1 ...}\narray, slice:       [elem0 elem1 ...]\nmaps:               map[key1:value1 key2:value2]\npointer to above:   &amp;{}, &amp;[], &amp;map[]\n</code></pre>\n</blockquote>\n\n<p>A <code>*Person</code> is a pointer to a struct type, so it's rendered as</p>\n\n<pre><code>&amp;{name}\n</code></pre>\n\n<p>where <code>name</code> is the contents of the name field; say, if it was assigned\nthe string \"Dave\", the output would be <code>&amp;{dave}</code>.</p>\n"}], "owner": {"reputation": 829, "user_id": 4667256, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/860591147318225/picture?type=large", "display_name": "Gilbert Nwaiwu", "link": "https://stackoverflow.com/users/4667256/gilbert-nwaiwu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 325, "favorite_count": 1, "accepted_answer_id": 49252075, "answer_count": 1, "score": 0, "last_activity_date": 1521023160, "creation_date": 1520930312, "question_id": 49251583, "link": "https://stackoverflow.com/questions/49251583/go-struct-method-allows-type-mixing", "title": "Go struct method allows type mixing?", "body": "<p>I have a simple struct with a single method:</p>\n\n<pre><code>type Person struct {\n  name string\n}\n\nfunc (p Person) SetName(name string) {\n  p.name = name\n}\n</code></pre>\n\n<p>the output of the following:</p>\n\n<pre><code>dave := Person{}\ndave.SetName(\"Dave\")\nfmt.Println(dave.name)\n</code></pre>\n\n<p>is going to be empty because the method receiver accepts a value(or more accurately creates a copy of the value you pass) so it will not modify your underlying value.</p>\n\n<p>If I change the method to this:</p>\n\n<pre><code>func (p *Person) SetName(name string) {\n  p.name = name\n}\n</code></pre>\n\n<p>the output will be \"Dave\".</p>\n\n<p>Now what I don't understand is am I not supposed to call the method on a pointer?\nSo when initialing my object I should do this:</p>\n\n<pre><code>dave := &amp;Person{}\n</code></pre>\n\n<p>instead of this:</p>\n\n<pre><code>dave := Person{}\n</code></pre>\n\n<p>Also using go's reflect package I was trying to find out the value of:</p>\n\n<pre><code>&amp;Person\n</code></pre>\n\n<p>and found it to be *Person, which is fine. When I print the value though I don't get a memory location compared to when I print the value of a pointer to an int:</p>\n\n<pre><code>a := 4\nfmt.Println(&amp;a)\n</code></pre>\n\n<p>I keep reading the docs, asking questions on so but the more I learn the more I wonder if I'm missing something simple since a lot of people don't think all this is confusing.</p>\n"}, {"tags": ["go", "amazon-s3", "image-uploading", "multipartform-data"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1520926231, "post_id": 49249633, "comment_id": 85504301, "body": "<a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/ETag\" rel=\"nofollow noreferrer\">That&#39;s what <code>ETag</code> means</a>."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1520926335, "post_id": 49249633, "comment_id": 85504373, "body": "Next, I&#39;d use something along the lines <a href=\"https://devops.stackexchange.com/a/2244\">of this answer</a> to 1) enumerate the buckets on your account and verifying &quot;mybucketname&quot; is there, and, if successful, 2) listing the contents of that bucket."}], "answers": [{"comments": [{"owner": {"reputation": 115, "user_id": 5934641, "user_type": "registered", "accept_rate": 14, "profile_image": "https://lh4.googleusercontent.com/-bgyruX0W0b0/AAAAAAAAAAI/AAAAAAAAAKg/T8xvy_s57X0/photo.jpg?sz=128", "display_name": "siri", "link": "https://stackoverflow.com/users/5934641/siri"}, "edited": false, "score": 0, "creation_date": 1521011588, "post_id": 49251683, "comment_id": 85546154, "body": "can you tell me how to process that ETag? @ZAky"}], "tags": [], "owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "is_accepted": false, "score": 0, "last_activity_date": 1520930671, "creation_date": 1520930671, "answer_id": 49251683, "question_id": 49249633, "link": "https://stackoverflow.com/questions/49249633/file-uploaded-to-s3-but-it-is-not-visible/49251683#49251683", "title": "File uploaded to s3 but it is not visible", "body": "<p>Check result.Location.</p>\n\n<p>Start with the documentation @ <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/s3/\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/service/s3/</a> and change it line by line until you get what you want.</p>\n"}, {"tags": [], "owner": {"reputation": 346, "user_id": 9490568, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ljyk.jpg?s=128&g=1", "display_name": "bharath", "link": "https://stackoverflow.com/users/9490568/bharath"}, "is_accepted": false, "score": 1, "last_activity_date": 1521024992, "creation_date": 1521024992, "answer_id": 49275900, "question_id": 49249633, "link": "https://stackoverflow.com/questions/49249633/file-uploaded-to-s3-but-it-is-not-visible/49275900#49275900", "title": "File uploaded to s3 but it is not visible", "body": "<p>You can retrieve the uploaded s3 object like this:</p>\n\n<pre><code>svc := s3.New(session.New(), cfg)\n\npath := \"mybucketname/\" + filename\ninput := &amp;s3.GetObjectInput{\n    Bucket: aws.String(\"mybucketname\"),\n    Key:    aws.String(path),\n}\n\nresult, err := svc.GetObject(input)\nif err != nil {\n    if aerr, ok := err.(awserr.Error); ok {\n        switch aerr.Code() {\n        case s3.ErrCodeNoSuchKey:\n            fmt.Println(s3.ErrCodeNoSuchKey, aerr.Error())\n        default:\n            fmt.Println(aerr.Error())\n        }\n    } else {\n        // Print the error, cast err to awserr.Error to get the Code and\n        // Message from an error.\n        fmt.Println(err.Error())\n    }\n    return\n}\n\nfmt.Println(result)\n</code></pre>\n\n<p>Shameless plug:\nYou can also use the command line tool I created from the below link to view the object.</p>\n\n<p><a href=\"https://github.com/bharath-srinivas/nephele\" rel=\"nofollow noreferrer\">https://github.com/bharath-srinivas/nephele</a></p>\n\n<p>You just have to do:</p>\n\n<p><code>$ nephele s3 list &lt;bucket-name&gt; --prefix &lt;prefix of the key/filename&gt;</code></p>\n\n<p>You can refer to the official documentation of aws-sdk-go here: <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/s3/#S3.GetObject\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/service/s3/#S3.GetObject</a></p>\n"}], "owner": {"reputation": 115, "user_id": 5934641, "user_type": "registered", "accept_rate": 14, "profile_image": "https://lh4.googleusercontent.com/-bgyruX0W0b0/AAAAAAAAAAI/AAAAAAAAAKg/T8xvy_s57X0/photo.jpg?sz=128", "display_name": "siri", "link": "https://stackoverflow.com/users/5934641/siri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 718, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1521024992, "creation_date": 1520922595, "last_edit_date": 1520941699, "question_id": 49249633, "link": "https://stackoverflow.com/questions/49249633/file-uploaded-to-s3-but-it-is-not-visible", "title": "File uploaded to s3 but it is not visible", "body": "<p>I'm trying to upload an image to the s3 bucket using GoLang. \nI have mentioned function body of program. Which takes an image file as multipart form data and a file name which I should to save the image in s3.</p>\n\n<pre><code>func uploadImage(res http.ResponseWriter, req *http.Request) {\nfile, handler, err := req.FormFile(\"uploaded_file\") // uploaded_file is the key(input field name) of the form-data\nif err != nil {\n    fmt.Println(err)\n    return\n}\n\ntype Resp struct {\n    Status   string `json:\"status\"`\n    Filename string `json:\"filename\"`\n}\nfilename := req.Form.Get(\"filename\")\n\nrnd := render.New()\nvar Response Resp\nResponse.Status = \"failed\"\nif filename != \"\" {\n    // define credentials\n    awsAccessKey := \"KEY\"\n    awsSecret := \"SECRET\"\n    token := \"\"\n    // set credentials\n    creds := credentials.NewStaticCredentials(awsAccessKey, awsSecret, token)\n    credentials, err := creds.Get()\n    if err != nil {\n        fmt.Printf(\"bad credentials: %s\", err)\n    }\n    fmt.Println(credentials)\n    //setup config and s3 settings\n    cfg := aws.NewConfig().WithRegion(\"ap-southeast-1\").WithCredentials(creds)\n\n    //create s3 credentail\n    svc := s3.New(session.New(), cfg)\n    type Sizer interface {\n        Size() int64\n    }\n\n    size := file.(Sizer).Size()\n    // create a buffer of size = images size\n    buffer := make([]byte, size)\n    file.Read(buffer)\n    fileBytes := bytes.NewReader(buffer)\n    fileType := http.DetectContentType(buffer)\n\n    path := \"mybucketname/\" + filename\n    params := &amp;s3.PutObjectInput{\n        Bucket:        aws.String(\"mybucketname\"),\n        Key:           aws.String(path),\n        Body:          fileBytes,\n        ContentLength: aws.Int64(size),\n        ContentType:   aws.String(fileType),\n        ACL:           aws.String(\"public-read\"),\n    }\n    resp, err := svc.PutObject(params)\n    if err != nil {\n        fmt.Printf(\"bad response: %s\", err)\n    }\n    fmt.Printf(\"response %s\", awsutil.StringValue(resp))\n\n    Response.Status = \"success\"\n    Response.Filename = awsutil.StringValue(resp)\n\n}\n\ndefer file.Close()\nres.Header().Set(\"Content-Type\", \"application/json\")\nrnd.JSON(res, http.StatusOK, Response)\n}\n</code></pre>\n\n<p>This function returns the status as success on successful upload of the image and the file name as http response.</p>\n\n<p>In console I can see some response as :</p>\n\n<pre><code>response {\nETag: \"\\\"bd9be6ada974e66a154552edc78b4a81\\\"\"\n}\n</code></pre>\n\n<p>I've no clue on what ETag means, but I understood that the image is uploaded and I got some positive response from s3. But I'm unable to find the image that I've uploaded in s3.</p>\n\n<p>I need some help to solve this.\nThanks in advance.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1520932952, "post_id": 49249216, "comment_id": 85508085, "body": "@mu is too short answer is current. But why do you need it in the first place? map is a data structure suitable for search. It may be the right thing to do in your case but It looks a bit odd."}], "answers": [{"tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": false, "score": 4, "last_activity_date": 1520921997, "creation_date": 1520921997, "answer_id": 49249505, "question_id": 49249216, "link": "https://stackoverflow.com/questions/49249216/nested-map-creation-in-golang/49249505#49249505", "title": "Nested map creation in golang", "body": "<p>Your <code>data</code>:</p>\n\n<pre><code>var data = map[string]interface{}{}\n</code></pre>\n\n<p>is a map from <code>string</code> to <code>interface{}</code> so <code>data[\"info\"]</code> is just an <code>interface{}</code> until you assert its type as <code>map[string]string</code>:</p>\n\n<pre><code>data[\"info\"].(map[string]string) // Now you have a map[string]string\n</code></pre>\n\n<p>Once you have a <code>map[string]string</code>, you can index it as desired:</p>\n\n<pre><code>data[\"info\"].(map[string]string)[\"email\"] = \"user@mail.com\"  \n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/yuyAN9FRCxc\" rel=\"nofollow noreferrer\">https://play.golang.org/p/yuyAN9FRCxc</a></p>\n"}, {"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1520933253, "creation_date": 1520933253, "answer_id": 49252493, "question_id": 49249216, "link": "https://stackoverflow.com/questions/49249216/nested-map-creation-in-golang/49252493#49252493", "title": "Nested map creation in golang", "body": "<p>According to <a href=\"https://blog.golang.org/laws-of-reflection\" rel=\"nofollow noreferrer\">Golang Laws of Reflection</a></p>\n\n<blockquote>\n  <p>A variable of interface type stores a pair: the concrete value\n  assigned to the variable, and that value's type descriptor. To be more\n  precise, the value is the underlying concrete data item that\n  implements the interface and the type describes the full type of that\n  item</p>\n</blockquote>\n\n<p>That's why we needs to type assert <code>map[string]string</code> to get the underlying value of <code>map[string]interface{}</code></p>\n\n<p>You also might wants to look at this <a href=\"https://research.swtch.com/interfaces\" rel=\"nofollow noreferrer\">post</a></p>\n\n<p>For an example you can loop on maps they have indexes. But interface act like a wrapper around type T storing the value and its type. They don't have indexes as the error said.</p>\n"}], "owner": {"reputation": 593, "user_id": 4273375, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/394947ca0e4bf377dacf12d32a424671?s=128&d=identicon&r=PG&f=1", "display_name": "Test admin", "link": "https://stackoverflow.com/users/4273375/test-admin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2238, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1520933253, "creation_date": 1520920705, "question_id": 49249216, "link": "https://stackoverflow.com/questions/49249216/nested-map-creation-in-golang", "title": "Nested map creation in golang", "body": "<p>I need to create a map as shown below:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {   \n   var data = map[string]interface{}{}  \n   data[\"name\"] = \"User\"    \n   data[\"info\"] = map[string]string{}   \n   data[\"info\"][\"email\"] = \"user@mail.com\"  \n   fmt.Println(data)\n}\n</code></pre>\n\n<p>I am trying to create nested maps, but I am getting an error as shown below:</p>\n\n<pre><code># command-line-arguments./interface.go:9: invalid operation: data[\"info\"][\"email\"] (type interface {} does not support indexing)\n</code></pre>\n\n<p>Please provide solution to fix this error. Thanks in advance.</p>\n"}, {"tags": ["go", "hugo"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1520921433, "post_id": 49249041, "comment_id": 85502073, "body": "Related / possible duplicate of <a href=\"https://stackoverflow.com/questions/46112679/golang-code-to-repeat-an-html-code-n-times/46112802#46112802\">Golang code to repeat an html code n times</a>."}], "answers": [{"tags": [], "owner": {"reputation": 1331, "user_id": 3376769, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/95c9b18fdbf40a1523370553ed5b1f8f?s=128&d=identicon&r=PG", "display_name": "jpalmieri", "link": "https://stackoverflow.com/users/3376769/jpalmieri"}, "is_accepted": false, "score": 4, "last_activity_date": 1520919818, "creation_date": 1520919818, "answer_id": 49249042, "question_id": 49249041, "link": "https://stackoverflow.com/questions/49249041/how-to-iterate-a-specific-number-of-times-in-a-go-template/49249042#49249042", "title": "How to iterate a specific number of times in a Go template?", "body": "<p>I found that <a href=\"https://gohugo.io/functions/seq/\" rel=\"nofollow noreferrer\">seq</a> was what I was looking for:</p>\n\n<pre><code>{{ range seq 100 }}\n  &lt;div class='star'&gt;&lt;/div&gt;\n{{ end }}\n</code></pre>\n"}], "owner": {"reputation": 1331, "user_id": 3376769, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/95c9b18fdbf40a1523370553ed5b1f8f?s=128&d=identicon&r=PG", "display_name": "jpalmieri", "link": "https://stackoverflow.com/users/3376769/jpalmieri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1461, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1520919818, "creation_date": 1520919818, "question_id": 49249041, "link": "https://stackoverflow.com/questions/49249041/how-to-iterate-a-specific-number-of-times-in-a-go-template", "title": "How to iterate a specific number of times in a Go template?", "body": "<p>I'm converting an erb template to a Go template (using Hugo), and I'm trying to create a specific number of identical <code>&lt;div&gt;</code>s. Ruby has the <a href=\"https://ruby-doc.org/core-2.5.0/Integer.html#method-i-times\" rel=\"nofollow noreferrer\">times</a> iterator, which worked well in the erb template. I assume there's something similar in Go, but I'm having a hard time finding it.</p>\n\n<p>in Erb:</p>\n\n<pre><code>&lt;% 100.times.each do |i| %&gt;\n  &lt;div class='star'&gt;&lt;/div&gt;\n&lt;% end %&gt;\n</code></pre>\n\n<p>I see that Go templates allow to iterate over a collection using <code>range</code>, but it's unclear how to do the above in a Go template without explicitly creating a collection with 100 items.</p>\n\n<p>This question has some information on iterating a specific number of times in Go, but is not in the context of Go templates:\n<a href=\"https://stackoverflow.com/questions/21950244/is-there-a-way-to-iterate-over-a-range-of-integers-in-golang\">Is there a way to iterate over a range of integers in Golang?</a></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 2271501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7838730b09562386406b12998486d10c?s=128&d=identicon&r=PG", "display_name": "Jordan Kasper", "link": "https://stackoverflow.com/users/2271501/jordan-kasper"}, "edited": false, "score": 0, "creation_date": 1520916514, "post_id": 49248364, "comment_id": 85500479, "body": "If Im understanding correctly the one in InitalizeRoutes() is not needed because of the one at package level in main.go?"}, {"owner": {"reputation": 25, "user_id": 2271501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7838730b09562386406b12998486d10c?s=128&d=identicon&r=PG", "display_name": "Jordan Kasper", "link": "https://stackoverflow.com/users/2271501/jordan-kasper"}, "edited": false, "score": 0, "creation_date": 1520916754, "post_id": 49248364, "comment_id": 85500541, "body": "nevermind I figured out what you were saying.  Thank you!"}], "tags": [], "owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "is_accepted": true, "score": 3, "last_activity_date": 1520915413, "creation_date": 1520915413, "answer_id": 49248364, "question_id": 49248284, "link": "https://stackoverflow.com/questions/49248284/panic-runtime-error-invalid-memory-address-or-nil-pointer-dereference-on-break/49248364#49248364", "title": "panic: runtime error: invalid memory address or nil pointer dereference on breaking up application", "body": "<p>You have a <code>var router *gin.Engine</code> inside the InitializeRoutes() function, you don't set router after that line to anything so its nil when you try to use later in the function. This one declared inside the function is shadowing the package level one and causing your problems, delete that line.</p>\n"}], "owner": {"reputation": 25, "user_id": 2271501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7838730b09562386406b12998486d10c?s=128&d=identicon&r=PG", "display_name": "Jordan Kasper", "link": "https://stackoverflow.com/users/2271501/jordan-kasper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4284, "favorite_count": 0, "accepted_answer_id": 49248364, "answer_count": 1, "score": 1, "last_activity_date": 1520915523, "creation_date": 1520914809, "last_edit_date": 1520915523, "question_id": 49248284, "link": "https://stackoverflow.com/questions/49248284/panic-runtime-error-invalid-memory-address-or-nil-pointer-dereference-on-break", "title": "panic: runtime error: invalid memory address or nil pointer dereference on breaking up application", "body": "<p>I am trying to compile my go app but am getting the following error:</p>\n\n<blockquote>\n  <p>panic: runtime error: invalid memory address or nil pointer dereference\n      [signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x14d6572]<br>\n      goroutine 1 [running]:\n      github.com/gin-gonic/gin.(*Engine).Use(0x0, 0xc420201f30, 0x1, 0x1, 0x2, 0x2)\n          /Users/jordan.kasper/go/src/github.com/gin-gonic/gin/gin.go:227 +0x22\n      gin-sample-app/handlers.InitializeRoutes()\n          /Users/jordan.kasper/go/src/gin-sample-app/handlers/routes.go:15 +0x61\n      main.main()\n          /Users/jordan.kasper/go/src/gin-sample-app/main.go:25 +0x77</p>\n</blockquote>\n\n<p>This is my main:</p>\n\n<pre><code>package main\n\nimport (\n    \"gin-sample-app/handlers\"\n\n    \"github.com/gin-gonic/gin\"\n)\n\nvar router *gin.Engine\n\nfunc main() {\n    // Set Gin to production mode\n    gin.SetMode(gin.ReleaseMode)\n\n    // Set the router as the default one provided by Gin\n    router = gin.Default()\n\n    // Process the templates at the start so that they don't have to be loaded\n    // from the disk again. This makes serving HTML pages very fast.\n    router.LoadHTMLGlob(\"templates/*\")\n\n    // Initialize the routes\n    handlers.InitializeRoutes()\n\n    // Start serving the application\n    router.Run()\n}\n</code></pre>\n\n<p>This is my InitializeRoutes:</p>\n\n<pre><code>package handlers\n\nimport (\n    \"gin-sample-app/middleware\"\n\n    \"github.com/gin-gonic/gin\"\n)\n\n// initializing the routes\nfunc InitializeRoutes() {\n\n    var router *gin.Engine\n\n    // Use the setUserStatus middleware for every route to set a flag\n    // indicating whether the request was from an authenticated user or not\n    router.Use(middleware.SetUserStatus())\n\n    // Handle the index route\n    router.GET(\"/\", ShowIndexPage)\n\n    // Group user related routes together\n    userRoutes := router.Group(\"/u\")\n    {\n        // Handle the GET requests at /u/login\n        // Show the login page\n        // Ensure that the user is not logged in by using the middleware\n        userRoutes.GET(\"/login\", middleware.EnsureNotLoggedIn(), showLoginPage)\n\n        // Handle POST requests at /u/login\n        // Ensure that the user is not logged in by using the middleware\n        userRoutes.POST(\"/login\", middleware.EnsureNotLoggedIn(), performLogin)\n\n        // Handle GET requests at /u/logout\n        // Ensure that the user is logged in by using the middleware\n        userRoutes.GET(\"/logout\", middleware.EnsureLoggedIn(), logout)\n\n        // Handle the GET requests at /u/register\n        // Show the registration page\n        // Ensure that the user is not logged in by using the middleware\n        userRoutes.GET(\"/register\", middleware.EnsureNotLoggedIn(), showRegistrationPage)\n\n        // Handle POST requests at /u/register\n        // Ensure that the user is not logged in by using the middleware\n        userRoutes.POST(\"/register\", middleware.EnsureNotLoggedIn(), register)\n    }\n\n    // Group article related routes together\n    articleRoutes := router.Group(\"/article\")\n    {\n        // Handle GET requests at /article/view/some_article_id\n        articleRoutes.GET(\"/view/:article_id\", getArticle)\n\n        // Handle the GET requests at /article/create\n        // Show the article creation page\n        // Ensure that the user is logged in by using the middleware\n        articleRoutes.GET(\"/create\", middleware.EnsureLoggedIn(), showArticleCreationPage)\n\n        // Handle POST requests at /article/create\n        // Ensure that the user is logged in by using the middleware\n        articleRoutes.POST(\"/create\", middleware.EnsureLoggedIn(), createArticle)\n\n    }\n\n}\n</code></pre>\n\n<p>I am still pretty new to Go so I am not exactly sure what is going on.  However this program originally started with all the files in the same package but I am now trying to separate it.  It worked before the split so might be just the way I am calling it?</p>\n"}, {"tags": ["excel", "go", "xls"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1520919146, "post_id": 49247038, "comment_id": 85501255, "body": "When you say &quot;some data&quot;, does this mean that most of the rows are OK and only a few appear to glitch, or that the problem is systemic and manifests itself for all the rows? I speculate the issue may be due to the fact it&#39;s too easy in Excel to input badly structured data which <i>appears to look</i> okay due to the WYSIWYG nature of this application."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1520919307, "post_id": 49247038, "comment_id": 85501319, "body": "BTW a simple approach to prove/disprove my claim is to open the offending document in Excel and export the contents of its first sheet as a CVS stream, and then look what&#39;s there\u2014is the data in it &quot;corrupt&quot; in the same way you observe with your Go code, or not."}, {"owner": {"reputation": 114, "user_id": 3209635, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100000186164522/picture?type=large", "display_name": "ismailzakky", "link": "https://stackoverflow.com/users/3209635/ismailzakky"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1520924182, "post_id": 49247038, "comment_id": 85503339, "body": "thank your for responding my question, i already check the uploaded excel and original exel file, its the same. and i forgot to mention, this thing happen only on my machine test, its works fine at my local computer/laptop. my laptop already have the same library version, and go version. idk what causing this problem to be happen."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1520925369, "post_id": 49247038, "comment_id": 85503899, "body": "Study the source code of that package to see whether it parses the documents naturally or calls out to Excel (via COM/COM+). If it does the latter, the difference could be explained by the difference of Excel versions. Otherwise you&#39;ll need to experiment further like copying the &quot;working&quot; binary to the &quot;faulty&quot; machine and trying there. Oh, and by the way, do you have architectural differences between those two machines\u2014like 32 vs 64 bit?"}, {"owner": {"reputation": 114, "user_id": 3209635, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100000186164522/picture?type=large", "display_name": "ismailzakky", "link": "https://stackoverflow.com/users/3209635/ismailzakky"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1520928962, "post_id": 49247038, "comment_id": 85505695, "body": "i&#39;ll try to read the code of the package. both has the same architecture x86_64, do you have any idea to populate this bug on my local laptop? it&#39;ll be much easier for me to search the root cause."}], "owner": {"reputation": 114, "user_id": 3209635, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100000186164522/picture?type=large", "display_name": "ismailzakky", "link": "https://stackoverflow.com/users/3209635/ismailzakky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 86, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1520906831, "creation_date": 1520905240, "last_edit_date": 1520906831, "question_id": 49247038, "link": "https://stackoverflow.com/questions/49247038/data-is-lost-while-extracting-data-from-xls", "title": "Data is lost while extracting data from xls", "body": "<p>i have 12000 rows data in xls file, i want to read  parse, and insert those data to database. I use <a href=\"https://github.com/extrame/xls/\" rel=\"nofollow noreferrer\">extrame/xls</a>  library to read xls data,\nbut some data are different/lost from the actual data from excel.</p>\n\n<p>this is my readXlsFile method : </p>\n\n<pre><code>func readXLSFile(filename string) ([][]string, error) {\n    result := [][]string{}\n\n    log.Println(\"Get into readXlsFile\")\n\n    xlFile, err := xls.Open(filename, \"utf-8\")\n    if err != nil {\n        return nil, err\n    }\n\n    sheet1 := xlFile.GetSheet(0)\n    str := \"\"\n    //log.Println(\"Max Row \", int(sheet1.MaxRow))\n    for i := 0; i &lt;= (int(sheet1.MaxRow)); i++ {\n        row1 := sheet1.Row(i)\n        temp := []string{}\n        for j := 0; j &lt;= int(row1.LastCol()); j++ {\n            temp = append(temp, row1.Col(j))\n\n            //log.Println(\"Max Col\", int(row1.LastCol()), \"Of row \", i+1)\n            str += fmt.Sprintf(\"column %d data = %s \", j+1, row1.Col(j))\n        }\n        log.Printf(\"row %d data : %s \\n\", i+1, str)\n        str = \"\"\n        result = append(result, temp)\n    }\n\n    return result, nil\n}\n</code></pre>\n\n<p>and here is my log that show the different data from my xls file : </p>\n\n<pre><code>2018/03/12 19:24:24 service.inquiry.go:4557: row 1836 data : column 1 data = :61:171218C59000NMSC column 2 data =   \n2018/03/12 19:24:24 service.inquiry.go:4557: row 1837 data : column 1 data = :86: column 2 data =  column 3 data =  column 4 data =  column 5 data =  column 6 data =  column 7 data =  column 8 data =  column 9 data =  column 10 data =  column 11 data =  column 12 data = PLS10299 column 13 data =  column 14 data = 22162- column 15 data =   \n2018/03/12 19:24:24 service.inquiry.go:4557: row 1838 data : column 1 data = :61:171218D300NMSC column 2 data =   \n2018/03/12 19:24:24 service.inquiry.go:4557: row 1839 data : column 1 data = :86: column 2 data =  column 3 data =  column 4 data =  column 5 data =  column 6 data =  column 7 data =  column 8 data =  column 9 data =  column 10 data =  column 11 data =  column 12 data = PLS10299 column 13 data =  column 14 data = 22162- column 15 data =   \n2018/03/12 19:24:24 service.inquiry.go:4557: row 1840 data : column 1 data = :61:171218D700NMSC column 2 data =   \n2018/03/12 19:24:24 service.inquiry.go:4557: row 1841 data : column 1 data = :86: column 2 data =  column 3 data =  column 4 data =  column 5 data =  column 6 data =  column 7 data =  column 8 data =  column 9 data =  column 10 data =  column 11 data =  column 12 data = PLS10299 column 13 data =  column 14 data = 22162- column 15 data =   \n</code></pre>\n\n<p>and this is the actual data from xls file : \n<img src=\"https://user-images.githubusercontent.com/5433381/37284534-6cb561fc-262e-11e8-90a1-3d8ba57d5144.png\" alt=\"image\"></p>\n\n<p>does anybody know why is this happening, and how to fix it?</p>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"reputation": 233, "user_id": 7893198, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/91639ade70c5fc21ded9450808e3c97c?s=128&d=identicon&r=PG&f=1", "display_name": "blue panther", "link": "https://stackoverflow.com/users/7893198/blue-panther"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1520904367, "post_id": 49246719, "comment_id": 85497480, "body": "I added detail to the question"}], "answers": [{"comments": [{"owner": {"reputation": 233, "user_id": 7893198, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/91639ade70c5fc21ded9450808e3c97c?s=128&d=identicon&r=PG&f=1", "display_name": "blue panther", "link": "https://stackoverflow.com/users/7893198/blue-panther"}, "edited": false, "score": 0, "creation_date": 1520908811, "post_id": 49247365, "comment_id": 85498609, "body": "got error: <code>panic: reflect: call of reflect.Value.NumField on ptr Value</code>"}], "tags": [], "owner": {"reputation": 71, "user_id": 4394954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4604fcb6843da829e6b969fb0225846?s=128&d=identicon&r=PG&f=1", "display_name": "No_20", "link": "https://stackoverflow.com/users/4394954/no-20"}, "is_accepted": false, "score": 2, "last_activity_date": 1520908022, "creation_date": 1520908022, "answer_id": 49247365, "question_id": 49246719, "link": "https://stackoverflow.com/questions/49246719/reflect-on-struct-passed-into-interface-function-parameter/49247365#49247365", "title": "Reflect on struct passed into interface{} function parameter", "body": "<p>Remove &amp; and Elem(), As follow:</p>\n\n<pre><code>func (db *DB) Migrate(domain ...interface{}) {\n    // statement := \"CREATE TABLE IF NOT EXISTS %s (%s, %s, %s, %s, %s)\"\n    for _,i := range domain {\n        params := BindStruct(i)\n        statement := CreateStatement(\"create\", len(params))\n        _,err := db.Exec(fmt.Sprintf(statement, params...))\n        if err != nil {\n            log.Fatal(\"Error migrating database schema - \", err)\n            break\n        }\n    }\n} \n\nfunc BindStruct(domain interface{}) (params []interface{}) {\n    tableName := reflect.TypeOf(domain).Name()\n    params = append(params, tableName)\n\n    val := reflect.ValueOf(domain)\n    for i:=0; i &lt; val.NumField(); i++ {\n        field := val.Type().Field(i)\n        tag := field.Tag\n\n        fieldName := field.Name\n        fieldType := tag.Get(\"sql_type\")\n        fieldTags := tag.Get(\"sql_tag\")\n\n        paramstring := fieldName + \" \" + fieldType + \" \" + fieldTags\n        params = append(params, paramstring)\n    }\n    return params\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "is_accepted": true, "score": 8, "last_activity_date": 1520911546, "last_edit_date": 1520911546, "creation_date": 1520909016, "answer_id": 49247496, "question_id": 49246719, "link": "https://stackoverflow.com/questions/49246719/reflect-on-struct-passed-into-interface-function-parameter/49247496#49247496", "title": "Reflect on struct passed into interface{} function parameter", "body": "<p>When you call <code>BindStruct(&amp;i)</code> you are passing a pointer to an interface. so this line:</p>\n\n<pre><code>val := reflect.ValueOf(domain).Elem()\n</code></pre>\n\n<p>will set val to a reflect.Value representing your interface because <code>reflect.ValueOf(domain)</code> gets a pointer then <code>.Elem()</code> resolves the interface - which results in your first error as it is indeed an interface value (and they don't have fields):</p>\n\n<blockquote>\n  <p>panic: reflect: call of reflect.Value.NumField on interface Value</p>\n</blockquote>\n\n<p>So, calling <code>params := BindStruct(i)</code> would always be correct as you need to pass the actual interface in not a pointer to it.</p>\n\n<p>You don't make clear what the underlying data types being passed into <code>Migrate()</code> are - are they values or pointers? It's important to know, e.g to inspect struct tags using reflection we need to get back to the struct values type, so the chain goes:</p>\n\n<blockquote>\n  <p>interface -> (pointer ?) -> value -> type</p>\n</blockquote>\n\n<p>I suspect you are using values as if interface was a value then the line:</p>\n\n<pre><code>val := reflect.ValueOf(domain).Elem()\n</code></pre>\n\n<p>would be expected to panic since <code>reflect.ValueOf(domain)</code> would resolve the value and then <code>.Elem()</code> would try to de-refrence a value.</p>\n\n<p>To be on the safe side we will check the Kind() of the incoming value to make sure we have a struct:</p>\n\n<p><a href=\"https://play.golang.org/p/6lPOwTd1Q0O\" rel=\"noreferrer\">https://play.golang.org/p/6lPOwTd1Q0O</a></p>\n\n<pre><code>func BindStruct(domain interface{}) (params []interface{}) {\n\n    val := reflect.ValueOf(domain) // could be any underlying type\n\n    // if its a pointer, resolve its value\n    if val.Kind() == reflect.Ptr {\n        val = reflect.Indirect(val)\n    }\n\n    // should double check we now have a struct (could still be anything)\n    if val.Kind() != reflect.Struct {\n         log.Fatal(\"unexpected type\")\n    }\n\n    // now we grab our values as before (note: I assume table name should come from the struct type)\n    structType := val.Type()  \n    tableName := structType.Name()\n    params = append(params, tableName)\n\n    for i:=0; i &lt; structType.NumField(); i++ {\n        field := structType.Field(i)\n        tag := field.Tag\n\n        fieldName := field.Name\n        fieldType := tag.Get(\"sql_type\")\n        fieldTags := tag.Get(\"sql_tag\")\n\n        paramstring := fieldName + \" \" + fieldType + \" \" + fieldTags\n        params = append(params, paramstring)\n    }\n    return params\n}\n</code></pre>\n"}], "owner": {"reputation": 233, "user_id": 7893198, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/91639ade70c5fc21ded9450808e3c97c?s=128&d=identicon&r=PG&f=1", "display_name": "blue panther", "link": "https://stackoverflow.com/users/7893198/blue-panther"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4195, "favorite_count": 2, "accepted_answer_id": 49247496, "answer_count": 2, "score": 6, "last_activity_date": 1566643996, "creation_date": 1520902939, "last_edit_date": 1592644375, "question_id": 49246719, "link": "https://stackoverflow.com/questions/49246719/reflect-on-struct-passed-into-interface-function-parameter", "title": "Reflect on struct passed into interface{} function parameter", "body": "<p>I pass struct into a function as <code>interface{}</code>. Then inside I work with it using <code>reflect</code> to get the struct attributes. Here's the code:</p>\n<pre><code>func (db *DB) Migrate(domain ...interface{}) {\n    // statement := &quot;CREATE TABLE IF NOT EXISTS %s (%s, %s, %s, %s, %s)&quot;\n    for _,i := range domain {\n        params := BindStruct(&amp;i)\n        statement := CreateStatement(&quot;create&quot;, len(params))\n        _,err := db.Exec(fmt.Sprintf(statement, params...))\n        if err != nil {\n            log.Fatal(&quot;Error migrating database schema - &quot;, err)\n            break\n        }\n    }\n} \n\nfunc BindStruct(domain interface{}) (params []interface{}) {\n    tableName := reflect.TypeOf(domain).Elem().Name()\n    params = append(params, tableName)\n\n    val := reflect.ValueOf(domain).Elem()\n    for i:=0; i &lt; val.NumField(); i++ {\n        field := val.Type().Field(i)\n        tag := field.Tag\n\n        fieldName := field.Name\n        fieldType := tag.Get(&quot;sql_type&quot;)\n        fieldTags := tag.Get(&quot;sql_tag&quot;)\n        \n        paramstring := fieldName + &quot; &quot; + fieldType + &quot; &quot; + fieldTags\n        params = append(params, paramstring)\n    }\n    return params\n}\n</code></pre>\n<p>I got an error on the line <code>for i:=0; i &lt; val.NumField(); i++ {</code> in <code>BindStruct</code> function. The error message is:</p>\n<blockquote>\n<p>panic: reflect: call of reflect.Value.NumField on interface Value</p>\n</blockquote>\n<p>If I remove <code>&amp;</code> from <code>params := BindStruct(&amp;i)</code> becoming <code>params := BindStruct(i)</code> in Migrate function, I get this error:</p>\n<blockquote>\n<p>panic: runtime error: invalid memory address or nil pointer</p>\n<p>dereference[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x4ff457]</p>\n</blockquote>\n<p>What gives?</p>\n"}, {"tags": ["string", "dictionary", "go", "format", "argument-unpacking"], "comments": [{"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 0, "creation_date": 1520903364, "post_id": 49246200, "comment_id": 85497243, "body": "I think you&#39;d usually say <code>fmt.Sprintf(&quot;%f %f&quot;, geopoint[&quot;latitude&quot;], geopoint[&quot;longitude&quot;])</code> or, if you really wanted, write your own function (possibly based on <code>regexp.ReplaceAllStringFunc</code>)."}], "answers": [{"comments": [{"owner": {"reputation": 804, "user_id": 6174302, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/58e83186008a31035bcb3525e794dbad?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Kao", "link": "https://stackoverflow.com/users/6174302/jason-kao"}, "edited": false, "score": 0, "creation_date": 1520899528, "post_id": 49246265, "comment_id": 85496370, "body": "Sorry if this was unclear in the question, but what I want to do is, like in Python, provide the keys for the values inside the format string."}, {"owner": {"reputation": 1944, "user_id": 4120554, "user_type": "registered", "accept_rate": 73, "profile_image": "https://lh5.googleusercontent.com/-RKmmNTC8iUo/AAAAAAAAAAI/AAAAAAAAAGs/oQQp9tU-Zb4/photo.jpg?sz=128", "display_name": "Marco Talento", "link": "https://stackoverflow.com/users/4120554/marco-talento"}, "reply_to_user": {"reputation": 804, "user_id": 6174302, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/58e83186008a31035bcb3525e794dbad?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Kao", "link": "https://stackoverflow.com/users/6174302/jason-kao"}, "edited": false, "score": 0, "creation_date": 1520899781, "post_id": 49246265, "comment_id": 85496435, "body": "I think there is no standard way to do that. At least for what I know about maps. Maybe there is some library with a weird  method that does that."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "reply_to_user": {"reputation": 804, "user_id": 6174302, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/58e83186008a31035bcb3525e794dbad?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Kao", "link": "https://stackoverflow.com/users/6174302/jason-kao"}, "edited": false, "score": 1, "creation_date": 1520923258, "post_id": 49246265, "comment_id": 85502916, "body": "You can use <code>text&#47;template</code> @JasonKao; but as mentioned <code>fmt.Sprintf)()</code> (with or without the <code>String()</code> function) is probably the &quot;Go way&quot; of doing it (Go is not Python!)"}], "tags": [], "owner": {"reputation": 1944, "user_id": 4120554, "user_type": "registered", "accept_rate": 73, "profile_image": "https://lh5.googleusercontent.com/-RKmmNTC8iUo/AAAAAAAAAAI/AAAAAAAAAGs/oQQp9tU-Zb4/photo.jpg?sz=128", "display_name": "Marco Talento", "link": "https://stackoverflow.com/users/4120554/marco-talento"}, "is_accepted": false, "score": 2, "last_activity_date": 1520899690, "last_edit_date": 1520899690, "creation_date": 1520899359, "answer_id": 49246265, "question_id": 49246200, "link": "https://stackoverflow.com/questions/49246200/how-do-i-unpack-a-map-into-keyword-arguments-for-string-format-in-golang/49246265#49246265", "title": "How do I unpack a map into keyword arguments for string format in Golang?", "body": "<p>I recommend using a struct to have your fields and then add method <code>String</code>.</p>\n\n<p>code: <a href=\"https://play.golang.org/p/ine_9GwK5o-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ine_9GwK5o-</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\n\ntype Point struct {\n   latitude float64\n   longitude float64\n}\n\nfunc (p Point) String() string {\n   return fmt.Sprintf(\"%f %f\", p.latitude, p.longitude)\n}\n\nfunc main() {\n\n    geoP:= Point{latitude:41.123, longitude:71.091}\n\n    fmt.Println(geoP)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1592, "user_id": 7251967, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-al-If026iHU/AAAAAAAAAAI/AAAAAAAAABE/9lsheyH-V9Q/photo.jpg?sz=128", "display_name": "negi Yogi", "link": "https://stackoverflow.com/users/7251967/negi-yogi"}, "is_accepted": false, "score": 0, "last_activity_date": 1566286476, "last_edit_date": 1566286476, "creation_date": 1520924239, "answer_id": 49250007, "question_id": 49246200, "link": "https://stackoverflow.com/questions/49246200/how-do-i-unpack-a-map-into-keyword-arguments-for-string-format-in-golang/49250007#49250007", "title": "How do I unpack a map into keyword arguments for string format in Golang?", "body": "<p>If I am not getting you wrong you can achieve the same like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nvar geopoint map[string]float64\n\nfunc main() {\n    geopoint = make(map[string]float64)\n    geopoint[\"latitude\"] = 41.123\n    geopoint[\"longitude\"] = 71.091\n\n    fmt.Println(fmt.Sprintf(\"latitude : %f\\nlongitude : %f\", geopoint[\"latitude\"], geopoint[\"longitude\"]))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>latitude : 41.123000\nlongitude : 71.091000\n</code></pre>\n\n<p>Check in playground: <a href=\"https://play.golang.org/p/g5DXb5iSeBY\" rel=\"nofollow noreferrer\">https://play.golang.org/p/g5DXb5iSeBY</a></p>\n"}, {"tags": [], "owner": {"reputation": 153, "user_id": 8522152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e4d2890561489533101b153f549c752?s=128&d=identicon&r=PG&f=1", "display_name": "dchiba", "link": "https://stackoverflow.com/users/8522152/dchiba"}, "is_accepted": false, "score": 2, "last_activity_date": 1520925143, "creation_date": 1520925143, "answer_id": 49250234, "question_id": 49246200, "link": "https://stackoverflow.com/questions/49246200/how-do-i-unpack-a-map-into-keyword-arguments-for-string-format-in-golang/49250234#49250234", "title": "How do I unpack a map into keyword arguments for string format in Golang?", "body": "<p>Carpetsmoker's idea, but the solution using text/template looks something like this.</p>\n\n<p><a href=\"https://play.golang.org/p/s2lPgA-Xa6C\" rel=\"nofollow noreferrer\">https://play.golang.org/p/s2lPgA-Xa6C</a></p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"text/template\"\n)\n\nfunc main() {\n    geopoint := map[string]float64{\n        \"latitude\":  41.123,\n        \"longitude\": 71.091,\n    }\n    template.Must(template.New(\"\").Parse(`{{ .latitude }} {{ .longitude }}`)).Execute(os.Stdout, geopoint)\n}\n</code></pre>\n"}], "owner": {"reputation": 804, "user_id": 6174302, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/58e83186008a31035bcb3525e794dbad?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Kao", "link": "https://stackoverflow.com/users/6174302/jason-kao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1266, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1566286476, "creation_date": 1520898873, "last_edit_date": 1520899552, "question_id": 49246200, "link": "https://stackoverflow.com/questions/49246200/how-do-i-unpack-a-map-into-keyword-arguments-for-string-format-in-golang", "title": "How do I unpack a map into keyword arguments for string format in Golang?", "body": "<p>In Python, to format a string with a dictionary, one can simply do:</p>\n\n<pre><code>geopoint = {\n  'latitude': 41.123,\n  'longitude':71.091\n}\n\nprint('{latitude} {longitude}'.format(**geopoint))\n</code></pre>\n\n<p>The output will be <code>41.123 71.091</code>. How do I achieve the same keyword unpacking of maps for string formatting in Go?</p>\n\n<p>EDIT: Sorry if this was unclear in the question, but what I want to do is, like in Python, provide the keys for the values inside the format string.</p>\n"}, {"tags": ["go", "cassandra", "gocql"], "answers": [{"comments": [{"owner": {"reputation": 3250, "user_id": 4801289, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/I0puU.jpg?s=128&g=1", "display_name": "Ismail H", "link": "https://stackoverflow.com/users/4801289/ismail-h"}, "edited": false, "score": 0, "creation_date": 1521017491, "post_id": 49245297, "comment_id": 85549053, "body": "Tried it, but how to create a session to run that ?"}, {"owner": {"reputation": 47278, "user_id": 18627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b31b9d123bff80f00317a1df0dd00e2?s=128&d=identicon&r=PG", "display_name": "Alex Ott", "link": "https://stackoverflow.com/users/18627/alex-ott"}, "reply_to_user": {"reputation": 3250, "user_id": 4801289, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/I0puU.jpg?s=128&g=1", "display_name": "Ismail H", "link": "https://stackoverflow.com/users/4801289/ismail-h"}, "edited": false, "score": 0, "creation_date": 1521040064, "post_id": 49245297, "comment_id": 85564996, "body": "The same way as described in documentation: <code>cluster := gocql.NewCluster(&quot;...&quot;); session, err := cluster.CreateSession();</code>"}], "tags": [], "owner": {"reputation": 47278, "user_id": 18627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b31b9d123bff80f00317a1df0dd00e2?s=128&d=identicon&r=PG", "display_name": "Alex Ott", "link": "https://stackoverflow.com/users/18627/alex-ott"}, "is_accepted": false, "score": 1, "last_activity_date": 1520893199, "creation_date": 1520893199, "answer_id": 49245297, "question_id": 49244479, "link": "https://stackoverflow.com/questions/49244479/how-to-create-a-keyspace-in-cassandra-using-gocql/49245297#49245297", "title": "How to create a keyspace in cassandra using gocql", "body": "<p>Did you try to execute <code>CREARE KEYSPACE ....</code> with <code>session.Query</code>?  Keyspace creation is just another CQL statement...</p>\n"}, {"comments": [{"owner": {"reputation": 3250, "user_id": 4801289, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/I0puU.jpg?s=128&g=1", "display_name": "Ismail H", "link": "https://stackoverflow.com/users/4801289/ismail-h"}, "edited": false, "score": 0, "creation_date": 1521017532, "post_id": 49245321, "comment_id": 85549080, "body": "How can I create a session that has the <code>control</code> property in it ?"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 3250, "user_id": 4801289, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/I0puU.jpg?s=128&g=1", "display_name": "Ismail H", "link": "https://stackoverflow.com/users/4801289/ismail-h"}, "edited": false, "score": 0, "creation_date": 1521023012, "post_id": 49245321, "comment_id": 85552704, "body": "session, err := cluster.CreateSession() should do it, but im not sure you need the .Control property, example here just has query method on session - <a href=\"https://github.com/gocql/gocql#important-default-keyspace-changes\" rel=\"nofollow noreferrer\">github.com/gocql/gocql#important-default-keyspace-changes</a>"}], "tags": [], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "is_accepted": true, "score": 3, "last_activity_date": 1520893357, "creation_date": 1520893357, "answer_id": 49245321, "question_id": 49244479, "link": "https://stackoverflow.com/questions/49244479/how-to-create-a-keyspace-in-cassandra-using-gocql/49245321#49245321", "title": "How to create a keyspace in cassandra using gocql", "body": "<p>I dont think there is any specific command in the library, but they create keyspaces as part of the tests (copied below) by issuing a normal query with the  CREATE KEYSPACE command - <a href=\"https://docs.datastax.com/en/cql/3.3/cql/cql_reference/cqlCreateKeyspace.html\" rel=\"nofollow noreferrer\">https://docs.datastax.com/en/cql/3.3/cql/cql_reference/cqlCreateKeyspace.html</a></p>\n\n<pre><code>func createKeyspace(tb testing.TB, cluster *ClusterConfig, keyspace string) {\n    c := *cluster\n    c.Keyspace = \"system\"\n    c.Timeout = 20 * time.Second\n    session, err := c.CreateSession()\n    if err != nil {\n        tb.Fatal(\"createSession:\", err)\n    }\n\n    err = session.control.query(`DROP KEYSPACE IF EXISTS ` + keyspace).Close()\n    if err != nil {\n        tb.Fatal(err)\n    }\n\n    err = session.control.query(fmt.Sprintf(`CREATE KEYSPACE %s\n    WITH replication = {\n        'class' : 'SimpleStrategy',\n        'replication_factor' : %d\n    }`, keyspace, *flagRF)).Close()\n\n    if err != nil {\n        tb.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>See here for issue and link to source in tests - <a href=\"https://github.com/gocql/gocql/issues/566\" rel=\"nofollow noreferrer\">https://github.com/gocql/gocql/issues/566</a></p>\n"}], "owner": {"reputation": 3250, "user_id": 4801289, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/I0puU.jpg?s=128&g=1", "display_name": "Ismail H", "link": "https://stackoverflow.com/users/4801289/ismail-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1060, "favorite_count": 0, "accepted_answer_id": 49245321, "answer_count": 2, "score": 2, "last_activity_date": 1520893357, "creation_date": 1520889169, "question_id": 49244479, "link": "https://stackoverflow.com/questions/49244479/how-to-create-a-keyspace-in-cassandra-using-gocql", "title": "How to create a keyspace in cassandra using gocql", "body": "<p>Is there any way to create a new keyspace in cassandra with gocql ?</p>\n"}, {"tags": ["go", "grpc"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1520887229, "post_id": 49244039, "comment_id": 85492009, "body": "Go doesn&#39;t generally need asynchronous APIs, you manage concurrency with goroutines."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520887976, "post_id": 49244039, "comment_id": 85492329, "body": "Or, if you&#39;re asking how to handle concurrent requests, that&#39;s what the <code>grpc.Server</code> does. Unless you&#39;re implementing your own, it&#39;s not something you need to worry about."}, {"owner": {"reputation": 2566, "user_id": 919918, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/e8ae3876d248ae26c2dfdb2a41dbcf9d?s=128&d=identicon&r=PG&f=1", "display_name": "Wayne", "link": "https://stackoverflow.com/users/919918/wayne"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520920314, "post_id": 49244039, "comment_id": 85501661, "body": "Thanks Jim; and what about the callback, where the gRPC calls your gRPC method implementation to perform some operation. In my example it is the Calculate method. Would you need to use channels and go routines inside this method if it would perform long running operations?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520954066, "post_id": 49244039, "comment_id": 85522655, "body": "I&#39;m afraid I still don&#39;t understand. The Go grpc API isn&#39;t structured around callbacks. If you want to do long running operations, you do long running operations. Channels and goroutines are just constructs of the language -- it&#39;s kind of like asking if you would use functions and variables to do long running operations."}, {"owner": {"reputation": 2566, "user_id": 919918, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/e8ae3876d248ae26c2dfdb2a41dbcf9d?s=128&d=identicon&r=PG&f=1", "display_name": "Wayne", "link": "https://stackoverflow.com/users/919918/wayne"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521184179, "post_id": 49244039, "comment_id": 85631332, "body": "I&#39;ll try again to explain my question more clearly. If the gRPC call is made some method get&#39;s invoke as specified by the proto file;   I implement this method and it returns the result only once the method completes the result is sent on the wire. If the method was to take long for one particular call/client (only for client 10) then how would this impact client caller no. 11. Would client 11 be unaffected or would it suffer because of the client 10&#39;s long running operation."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1521208146, "post_id": 49244039, "comment_id": 85645778, "body": "if you&#39;re asking wether the Go gRPC server will handle concurrent connections; yes it will, it wouldn&#39;t work very well if it didn&#39;t."}, {"owner": {"reputation": 2566, "user_id": 919918, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/e8ae3876d248ae26c2dfdb2a41dbcf9d?s=128&d=identicon&r=PG&f=1", "display_name": "Wayne", "link": "https://stackoverflow.com/users/919918/wayne"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521225274, "post_id": 49244039, "comment_id": 85656621, "body": "Your answer seems sensible. Thanks."}], "answers": [{"comments": [{"owner": {"reputation": 2566, "user_id": 919918, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/e8ae3876d248ae26c2dfdb2a41dbcf9d?s=128&d=identicon&r=PG&f=1", "display_name": "Wayne", "link": "https://stackoverflow.com/users/919918/wayne"}, "edited": false, "score": 0, "creation_date": 1521383641, "post_id": 49330958, "comment_id": 85697778, "body": "Can you please elaborate on point (2).  Please correct my understanding ...  Does this mean that the &quot;net/network server&quot; creates a go routine for each client that connects that calls the gRPC stub implementation [&quot;func (s *service) Calculate(ctx contex....&quot;].    These &quot;threaded&quot; calls do not block each other, also there is no synchronous blocking required. The gRPC stub methods have their own &quot;stack of local variables&quot;. These gRPC method calls are isolated and do not effect each other: not blocking each other and no locally shared state to worry about."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1521478490, "post_id": 49330958, "comment_id": 85737588, "body": "Your comment is basically right, although you will likely have &quot;shared state to worry about&quot; if you make your server do something more complex, e.g. if you add global in-memory caches anywhere. Folks use tools from the <a href=\"https://golang.org/pkg/sync/\" rel=\"nofollow noreferrer\"><code>sync</code> module</a> to coordinate access to shared data."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1521478844, "post_id": 49330958, "comment_id": 85737846, "body": "I want to emphasize you&#39;ll need to learn to run your own tests to get far with this kind of thing. Writing a test program to see &quot;what happens if I add <code>time.Sleep(10*time.Second)</code> here?&quot; can get an answer in minutes, versus waiting overnight for someone to answer here--having to wait overnight sounds like what people had to do in the old mainframe days!"}, {"owner": {"reputation": 116, "user_id": 8984194, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EUrclvdaRpk/AAAAAAAAAAI/AAAAAAAAAMg/W3ycGrAbIFg/photo.jpg?sz=128", "display_name": "Mahak Mukhi", "link": "https://stackoverflow.com/users/8984194/mahak-mukhi"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1521480624, "post_id": 49330958, "comment_id": 85738916, "body": "Adding to @twotwotwo: Yes that&#39;s correct. However, keep in mind connecting to a server and making an RPC are two different things and should be thought of as differently. Not every call to the gRCP stub will result in establishing a connection. But other than that your understanding is right, each call to the service handler on server-side happens from a different goroutine."}], "tags": [], "owner": {"reputation": 116, "user_id": 8984194, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EUrclvdaRpk/AAAAAAAAAAI/AAAAAAAAAMg/W3ycGrAbIFg/photo.jpg?sz=128", "display_name": "Mahak Mukhi", "link": "https://stackoverflow.com/users/8984194/mahak-mukhi"}, "is_accepted": true, "score": 5, "last_activity_date": 1521243969, "creation_date": 1521243969, "answer_id": 49330958, "question_id": 49244039, "link": "https://stackoverflow.com/questions/49244039/go-grpc-simple-service-asynchronous-and-synchronous-explanation/49330958#49330958", "title": "Go gRPC simple service Asynchronous and Synchronous explanation", "body": "<p>Thanks for your question. It is true that gRPC-Go is sync only; that is your Unary RPC(the one in your example) will return only when the RPC has finished (got a response from the server).</p>\n\n<p>About performance:</p>\n\n<ol>\n<li>The Dial operation establishes an underlying connection which may be expensive. So it not wise to do it every time getprime is called. A better way is to create a client, keep it around and make calls to the prime server on it. This way only first RPC incurs the cost of connection.</li>\n<li>For each RPC request a server gets we launch a goroutine to process that request. So in general, this should scale fairly well.</li>\n</ol>\n\n<p>About <strong>(A)</strong>: It is not uncommon for a service handler to make an RPC call to yet another server and wait for its response before returning back. \nNote that there's no way for a server to make call to the client. </p>\n"}, {"comments": [{"owner": {"reputation": 2566, "user_id": 919918, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/e8ae3876d248ae26c2dfdb2a41dbcf9d?s=128&d=identicon&r=PG&f=1", "display_name": "Wayne", "link": "https://stackoverflow.com/users/919918/wayne"}, "edited": false, "score": 0, "creation_date": 1521382172, "post_id": 49340848, "comment_id": 85697261, "body": "Thanks for the explanation: It is getting much clearer.  Please verify my understanding: (1) method &quot;func (s *service) Calculate(ctx context.Context, req *pb.Instruction)&quot; =  If we add a deliberate sleep of 10 minutes if the number is prime, clients that do get results that are not prime are not delayed by previous prime requests not processed yet?  (2) &quot;the function that makes the remote call waits for a reply before continuing&quot; = the client side call to the server (gRPC service).  (3) &quot;The server is normally multithreaded&quot; = the server does not block while requests are being processed."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 2566, "user_id": 919918, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/e8ae3876d248ae26c2dfdb2a41dbcf9d?s=128&d=identicon&r=PG&f=1", "display_name": "Wayne", "link": "https://stackoverflow.com/users/919918/wayne"}, "edited": false, "score": 0, "creation_date": 1521403650, "post_id": 49340848, "comment_id": 85704691, "body": "1) Yes--easy for you to write a test for this. 2) Yes, the wait&#39;s in the client. 3) Yes, one pending request does not block the server from processing others. If the terminology here remains confusing, you might want to look at materials about threads, like <a href=\"http://www.cs.ucsb.edu/~rich/class/cs170/notes/IntroThreads/index.html\" rel=\"nofollow noreferrer\">these lecture notes</a>, <a href=\"https://en.wikipedia.org/wiki/Thread_(computing)\" rel=\"nofollow noreferrer\">the wiki page</a>, <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">the Tour of Go</a>&#39;s bits on goroutines, or <a href=\"https://gobyexample.com/\" rel=\"nofollow noreferrer\">Go by Example</a> starting at <a href=\"https://gobyexample.com/goroutines\" rel=\"nofollow noreferrer\">Goroutines</a>."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 2566, "user_id": 919918, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/e8ae3876d248ae26c2dfdb2a41dbcf9d?s=128&d=identicon&r=PG&f=1", "display_name": "Wayne", "link": "https://stackoverflow.com/users/919918/wayne"}, "edited": false, "score": 0, "creation_date": 1521403768, "post_id": 49340848, "comment_id": 85704741, "body": "Looking at others&#39; code (e.g. on GitHub) and writing more test programs may also help, especially when the question is more &quot;what is library XYZ&#39;s concurrency model?&quot; than &quot;how do the concurrency primitives work in general?&quot;"}], "tags": [], "owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "is_accepted": false, "score": 3, "last_activity_date": 1521313795, "creation_date": 1521313795, "answer_id": 49340848, "question_id": 49244039, "link": "https://stackoverflow.com/questions/49244039/go-grpc-simple-service-asynchronous-and-synchronous-explanation/49340848#49340848", "title": "Go gRPC simple service Asynchronous and Synchronous explanation", "body": "<p>To phrase what JimB said as an answer: \"Synchronous\" means that the function that makes the remote call waits for a reply before continuing, not that the whole server or client does. The server is normally multithreaded, even when processing synchronous calls; it can accept and work on a second call while it's responding to the first. </p>\n\n<p>And similarly, if a client has multiple concurrent tasks that each have a gRPC call running, that won't block the process. Clients like that could include <code>net/http</code> servers serving end users, or gRPC servers handling multiple RPCs. </p>\n\n<p>Where you <em>might</em> add explicit <code>go</code> statements is if you want to do something else from the specific function making the RPC call. For example, if you want to issue several RPC calls at once then wait for all their results to come in, you could write code following the <a href=\"https://blog.golang.org/pipelines#TOC_4.\" rel=\"nofollow noreferrer\">examples of fan-out calls</a>.</p>\n"}], "owner": {"reputation": 2566, "user_id": 919918, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/e8ae3876d248ae26c2dfdb2a41dbcf9d?s=128&d=identicon&r=PG&f=1", "display_name": "Wayne", "link": "https://stackoverflow.com/users/919918/wayne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8882, "favorite_count": 4, "accepted_answer_id": 49330958, "answer_count": 2, "score": 5, "last_activity_date": 1521313795, "creation_date": 1520887080, "question_id": 49244039, "link": "https://stackoverflow.com/questions/49244039/go-grpc-simple-service-asynchronous-and-synchronous-explanation", "title": "Go gRPC simple service Asynchronous and Synchronous explanation", "body": "<p>I am trying to understand GoLang \"Go\" together with gRPC and to make a simple service scalable.</p>\n\n<p>Lets say I have a client1 that calls a service1(adds numbers) that calls service2(determines if the result is prime), and service2 returns the result to service1 that returns the result to client1 all via gRPC.</p>\n\n<p>When I use protocol buffers \"proto3\" and generate the Go code via protoc. \nI get generated methods that call the service in one particular way.\nI see no distinction to call the methods asynchronously \"Go\".</p>\n\n<p>And the underlying call seems to be \"Invoke\" which I believe is synchronous,the call returns once a result is received.</p>\n\n<p>How do I make service1 \"performant\", I know I can run this in a cluster and have copies, but that would mean I can only serve clients as per the amount of instances within the cluster.</p>\n\n<p>I want a \"single\" service to be able to serve multiple clients(e.g. 1000) .</p>\n\n<p>Here is a simple server and I am not sure if this is performant or not:\nI do know that the <code>getprime</code> function does dial every time,\nand this could probably be moved to make this dial persist and be re-used; But more importantly I want to make a simple performant scaleable service and get a good understanding. </p>\n\n<p><strong>(A)</strong>\nPerhaps the whole design is incorrect and the service1 should just return\nas soon as the instruction is received \"ack\", do the addition and send the next request to sercice2 which determines if the answer is prime or not; again service2 just responds with an acknowledgement of the request being received. Once prime is determined by the service2 a call is made to the client with an answer. </p>\n\n<p>If (A) above is the better approach, then still please explain the bottlenecks below; what happens when multiple clients are processed?\nThe call to \"Listen\" does what, \"blocks, or does not block\", etc.</p>\n\n<pre><code>package main\n\nimport (\n    pb \"demo/internal/pkg/proto_gen/calc\"\n    \"fmt\"\n    \"golang.org/x/net/context\"\n    \"google.golang.org/grpc\"\n    \"google.golang.org/grpc/reflection\"\n    \"log\"\n    \"net\"\n)\n\nconst (\n    port = \":8080\"\n)\n\ntype service struct {\n}\n\nfunc (s *service) Calculate(ctx context.Context, req *pb.Instruction) (*pb.Response, error) {\n\n    var answer float64\n    answer = req.Number1 + req.Number2\n\n    // call service prime\n    p := getprime(int(answer))\n    pa := pb.PrimeAnswer{Prime: p}\n    return &amp;pb.Response{Answer: answer, Prime: &amp;pa}, nil\n}\n\nconst (\n    primeAddress = \"127.0.0.1:8089\"\n)\n\nfunc getprime(number int) bool {\n    conn, err := grpc.Dial(primeAddress, grpc.WithInsecure())\n    if err != nil {\n        log.Fatalf(\"Did not connect to prime service: %v\", err)\n    }\n    defer conn.Close()\n\n    client := pb.NewPrimeServiceClient(conn)\n    p := pb.PrimeMessage{\"\", float64(number)}\n\n    r, err := client.Prime(context.Background(), &amp;p)\n    if err != nil {\n        log.Fatalf(\"Call to prime service failed: %v\", err)\n    }\n    return r.Prime\n}\n\nfunc main() {\n    lis, err := net.Listen(\"tcp\", port)\n    if err != nil {\n        log.Fatalf(\"failed to listen: %v\", err)\n    }\n\n    s := grpc.NewServer()\n    pb.RegisterCalculatorServer(s, &amp;service{})\n    reflection.Register(s)\n    if err := s.Serve(lis); err != nil {\n        log.Fatalf(\"failed to serve: %v\", err)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "grpc"], "answers": [{"tags": [], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "is_accepted": true, "score": 5, "last_activity_date": 1520887625, "creation_date": 1520887625, "answer_id": 49244154, "question_id": 49243846, "link": "https://stackoverflow.com/questions/49243846/how-to-send-grpc-meta-data-from-client-side/49244154#49244154", "title": "How to send grpc meta-data from client side", "body": "<p>I presume grpc is your client connection object. </p>\n\n<p>You create meta data using the metadata subpackage from a map[string]string (some other methods provided), you then pass it via context e.g</p>\n\n<pre><code>md := metadata.New(map[string]string{\"key1\": \"val1\", \"key2\": \"val2\"})\nctx := metadata.NewOutgoingContext(context.Background(), md)\n</code></pre>\n\n<p>Because you pass meta data via context you will need to use client.DialContext() rather than Dial I think <a href=\"https://godoc.org/google.golang.org/grpc#DialContext\" rel=\"noreferrer\">https://godoc.org/google.golang.org/grpc#DialContext</a></p>\n\n<p>See here for some examples - <a href=\"https://github.com/grpc/grpc-go/blob/master/Documentation/grpc-metadata.md\" rel=\"noreferrer\">https://github.com/grpc/grpc-go/blob/master/Documentation/grpc-metadata.md</a></p>\n"}], "owner": {"reputation": 69, "user_id": 5981590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cce6ff2e2b80392134e9b686af851bee?s=128&d=identicon&r=PG&f=1", "display_name": "bharat nc", "link": "https://stackoverflow.com/users/5981590/bharat-nc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2670, "favorite_count": 0, "accepted_answer_id": 49244154, "answer_count": 1, "score": 1, "last_activity_date": 1520887625, "creation_date": 1520886266, "question_id": 49243846, "link": "https://stackoverflow.com/questions/49243846/how-to-send-grpc-meta-data-from-client-side", "title": "How to send grpc meta-data from client side", "body": "<p>I'm using <code>grpc.Dial(server)</code> in golang to setup a grpc connection to my server.</p>\n\n<p>How do I send meta-data or custom headers through this Dial connection (from client side)?</p>\n"}, {"tags": ["c", "go", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520882900, "post_id": 49243034, "comment_id": 85489892, "body": "What is <code>ec_scalar</code>?"}, {"owner": {"reputation": 3, "user_id": 9481587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad46b628a7d1be424711e5932c7b1ec6?s=128&d=identicon&r=PG&f=1", "display_name": "Sleeping Shell", "link": "https://stackoverflow.com/users/9481587/sleeping-shell"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520883021, "post_id": 49243034, "comment_id": 85489955, "body": "Sorry, I meant to type scalar instead of point."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 0, "last_activity_date": 1520883268, "creation_date": 1520883268, "answer_id": 49243177, "question_id": 49243034, "link": "https://stackoverflow.com/questions/49243034/using-cgo-with-typedef-variables/49243177#49243177", "title": "Using cgo with typedef variables", "body": "<p>Go's static type system and type safety doesn't let you implicitly convert types, and doesn't let arrays decay into pointers. You will need to convert it manually using the <code>unsafe</code> package:</p>\n\n<pre><code>(*C.uchar)(unsafe.Pointer(pk2))\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 9481587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad46b628a7d1be424711e5932c7b1ec6?s=128&d=identicon&r=PG&f=1", "display_name": "Sleeping Shell", "link": "https://stackoverflow.com/users/9481587/sleeping-shell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 328, "favorite_count": 0, "accepted_answer_id": 49243177, "answer_count": 1, "score": 0, "last_activity_date": 1520883268, "creation_date": 1520882670, "last_edit_date": 1520882998, "question_id": 49243034, "link": "https://stackoverflow.com/questions/49243034/using-cgo-with-typedef-variables", "title": "Using cgo with typedef variables", "body": "<p>I am creating a project which uses cryptography that I coded in C due to existing libraries and speed. When attempting to interface with Cgo, I am having some trouble with typedefs I created in C. One example is below:</p>\n\n<pre><code>typedef unsigned char ec_scalar[32];\n</code></pre>\n\n<p>I am able to successfully create ec_point variables, and use functions that take in ec_point*. However, whenever I attempt to use functions that are passed with a normal ec_point, I get the error:</p>\n\n<pre><code>cannot use pk2 (type C.ec_scalar) as type *C.uchar in argument to _Cfunc_secret_to_public\n</code></pre>\n\n<p>I can't seem to find a way where I can easily convert this too. I also don't want to have to refactor my code to take in ec_point*, as ec_point is already a pointer (since it is an array of 32 char)</p>\n"}, {"tags": ["sql", "database", "go", "sqlite"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1520877944, "post_id": 49241759, "comment_id": 85487115, "body": "If you looked at the output from <code>Sprintf</code>, you&#39;d see it includes an error, because you&#39;re passing 6 values to format a string with only 5 placeholders."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1520923352, "post_id": 49241759, "comment_id": 85502964, "body": "Note that <code>go vet</code> should report this error."}], "answers": [{"tags": [], "owner": {"reputation": 579, "user_id": 7327745, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fcbd2d8ea52236dffc3449c0a29e881?s=128&d=identicon&r=PG&f=1", "display_name": "Subbu M", "link": "https://stackoverflow.com/users/7327745/subbu-m"}, "is_accepted": false, "score": 0, "last_activity_date": 1520882874, "creation_date": 1520882874, "answer_id": 49243088, "question_id": 49241759, "link": "https://stackoverflow.com/questions/49241759/error-executing-query-sql-golang/49243088#49243088", "title": "Error executing query sql - Golang", "body": "<p>You have an issue in you code. Missing one %s argument in CREATE TABLE .</p>\n\n<p>Update code as </p>\n\n<blockquote>\n  <p>statement := \"CREATE TABLE %s (%s, %s, %s, %s, %s)\"</p>\n</blockquote>\n"}], "owner": {"reputation": 233, "user_id": 7893198, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/91639ade70c5fc21ded9450808e3c97c?s=128&d=identicon&r=PG&f=1", "display_name": "blue panther", "link": "https://stackoverflow.com/users/7893198/blue-panther"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 286, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1520882874, "creation_date": 1520877865, "last_edit_date": 1520878024, "question_id": 49241759, "link": "https://stackoverflow.com/questions/49241759/error-executing-query-sql-golang", "title": "Error executing query sql - Golang", "body": "<p>I try to execute this query in Golang using native sql apis from golang.</p>\n\n<pre><code>type DB struct {\n    *sql.DB\n}\n\ntype IUser interface {\n    CreateUserTable() (sql.Result, error)\n}\n\n//InitDB initializes the database\nfunc InitDB() *DB {\n    db, err := sql.Open(dbDriver, dbName)\n    if err != nil {\n        log.Fatal(\"failed to initialize database: \",err)\n    }\n    err2 := db.Ping()\n    if err2 != nil {\n        log.Fatal(err2)\n    }\n\n    // var database *DB\n    // database.AutoMigrate(&amp;domain.User{})\n\n    return &amp;DB{db}\n}\n\nfunc (db *DB) CreateUserTable() (sql.Result, error) {\n    statement := \"CREATE TABLE %s (%s, %s, %s, %s)\"\n    v := []interface{}{\"User\", \"ID int PRIMARY KEY NOT NULL\", \"Name varchar(100) UNIQUE\", \"Email varchar(100) UNIQUE\", \"Address varchar(100) \",  \"Username varchar(100) UNIQUE\"}\n    return db.Exec(fmt.Sprintf(statement, v...))\n}\n</code></pre>\n\n<p>When I tried to executed above in the main function:</p>\n\n<pre><code>func main() {\n    db := model.InitDB()\n    newFunc(db)\n}\n\n\nfunc newFunc(db model.IUser) {\n    r, err := db.CreateUserTable()\n    if err != nil {\n        fmt.Println(\"Error executing query - \", err)\n    }\n    fmt.Println(r)\n}\n</code></pre>\n\n<p>It gives me error:</p>\n\n<blockquote>\n  <p>Error executing query -  near \"%\": syntax error</p>\n</blockquote>\n\n<p>How to fix this? (I'm using sqlite3 driver)</p>\n"}, {"tags": ["opencv", "go"], "answers": [{"tags": [], "owner": {"reputation": 1836, "user_id": 8368351, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/cA0x6.png?s=128&g=1", "display_name": "lucians", "link": "https://stackoverflow.com/users/8368351/lucians"}, "is_accepted": false, "score": 2, "last_activity_date": 1562334825, "last_edit_date": 1562334825, "creation_date": 1520903771, "answer_id": 49246819, "question_id": 49241490, "link": "https://stackoverflow.com/questions/49241490/gocv-how-to-cut-out-an-image-from-blue-background-using-opencv/49246819#49246819", "title": "gocv: how to cut out an image from blue background using opencv", "body": "<p>Here is what I did with Python because I don't know Go...</p>\n\n<p><a href=\"https://i.stack.imgur.com/TtCMO.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/TtCMO.png\" alt=\"result\"></a></p>\n\n<p>Let me explain first.</p>\n\n<p>(1) Image has been turned to gray. </p>\n\n<p>(2) Applied Canny Edge </p>\n\n<p>(3 - 4) Created kernel and used it to do Dilate and Close operations</p>\n\n<p>(5) Found contours</p>\n\n<p>(6) Created and applied mask</p>\n\n<p>(7) Cropped and saved the region</p>\n\n<p>Here is the code:</p>\n\n<pre><code>import cv2\nimport numpy as np\n\nimage = cv2.imread(\"image.png\")\ncopy = image.copy()\n\ngray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)\ncv2.imshow('Gray', gray)\ncv2.waitKey(0)\n\nedged = cv2.Canny(gray, 10, 250)\ncv2.imshow('Edged', edged)\ncv2.waitKey(0)\n\nkernel = np.ones((5, 5), np.uint8)\n\ndilation = cv2.dilate(edged, kernel, iterations=1)\ncv2.imshow('Dilation', dilation)\ncv2.waitKey(0)\n\nclosing = cv2.morphologyEx(dilation, cv2.MORPH_CLOSE, kernel)\ncv2.imshow('Closing', closing)\ncv2.waitKey(0)\n\n# if using OpenCV 4, remove image variable from below\nimage, cnts, hiers = cv2.findContours(closing, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)\n\ncont = cv2.drawContours(copy, cnts, -1, (0, 0, 0), 1, cv2.LINE_AA)\ncv2.imshow('Contours', cont)\ncv2.waitKey(0)\n\nmask = np.zeros(cont.shape[:2], dtype=\"uint8\") * 255\n\n# Draw the contours on the mask\ncv2.drawContours(mask, cnts, -1, (255, 255, 255), -1)\n\n# remove the contours from the image and show the resulting images\nimg = cv2.bitwise_and(cont, cont, mask=mask)\ncv2.imshow(\"Mask\", img)\ncv2.waitKey(0)\n\nfor c in cnts:\n    x, y, w, h = cv2.boundingRect(c)\n    if w &gt; 50 and h &gt; 130:\n        new_img = img[y:y + h, x:x + w]\n        cv2.imwrite('Cropped.png', new_img)\n\n        cv2.imshow(\"Cropped\", new_img)\n        cv2.waitKey(0)\n</code></pre>\n\n<p>Hope will help more than one user.</p>\n"}, {"comments": [{"owner": {"reputation": 697, "user_id": 569763, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3a05235ac9d98378afddbaf95c0d1f6f?s=128&d=identicon&r=PG", "display_name": "milosgajdos", "link": "https://stackoverflow.com/users/569763/milosgajdos"}, "edited": false, "score": 0, "creation_date": 1520939176, "post_id": 49247779, "comment_id": 85512194, "body": "Yes, you are right and I have <i>very</i> similar code written in <code>python</code> that does the job: I forgot to mention that in my question that doing this in Python is very easy as you demonstrated. My question is more related to the <code>gocv</code> and the opencv <code>copyTo() </code> function which is behind the <code>CopyToWithMask</code>"}, {"owner": {"reputation": 114459, "user_id": 4238408, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RWkmO.jpg?s=128&g=1", "display_name": "Quang Hoang", "link": "https://stackoverflow.com/users/4238408/quang-hoang"}, "reply_to_user": {"reputation": 697, "user_id": 569763, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3a05235ac9d98378afddbaf95c0d1f6f?s=128&d=identicon&r=PG", "display_name": "milosgajdos", "link": "https://stackoverflow.com/users/569763/milosgajdos"}, "edited": false, "score": 0, "creation_date": 1520996831, "post_id": 49247779, "comment_id": 85541522, "body": "@gyre another possible solution is to convert <code>mask</code> to BRG and <code>bitwise_and</code> with the original imgage."}], "tags": [], "owner": {"reputation": 114459, "user_id": 4238408, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RWkmO.jpg?s=128&g=1", "display_name": "Quang Hoang", "link": "https://stackoverflow.com/users/4238408/quang-hoang"}, "is_accepted": false, "score": 3, "last_activity_date": 1520911213, "creation_date": 1520911213, "answer_id": 49247779, "question_id": 49241490, "link": "https://stackoverflow.com/questions/49241490/gocv-how-to-cut-out-an-image-from-blue-background-using-opencv/49247779#49247779", "title": "gocv: how to cut out an image from blue background using opencv", "body": "<p><a href=\"https://i.stack.imgur.com/aqKsX.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/aqKsX.png\" alt=\"enter image description here\"></a></p>\n\n<p><code>inRange</code> with the given range runs perfectly for me. I'm not familiar with Go, but here's my python code:</p>\n\n<pre><code>import numpy as py\nimport cv2\n\nimg = cv2.imread(\"pizza.png\")\n\nhsv = cv2.cvtColor(img, cv2.COLOR_BGR2HSV)\nmask = cv2.inRange(hsv, (110, 100, 100), (130, 255, 255))\ninv_mask = cv2.bitwise_not(mask)\n\npizza = cv2.bitwise_and(img, img, mask=inv_mask)\n\ncv2.imshow(\"img\", img)\ncv2.imshow(\"mask\", mask)\ncv2.imshow(\"pizza\", pizza)\ncv2.imshow(\"inv mask\", inv_mask)\ncv2.waitKey()\n</code></pre>\n\n<p>A few of notes here:</p>\n\n<ul>\n<li><code>inRange</code> returns the <em>blue background</em> so we need to invert it to reveal the object's mask (if you need the object).</li>\n<li>You don't need to apply mask on <code>hsvImg</code> and convert to <code>BGR</code>, you can apply mask directly on the original image (which is <code>BGR</code> already).</li>\n<li>Python does not have <code>CopyToWithMask</code> so I use the equivalent <code>bitwise_and</code>. You may check this function in Go, but I suspect there would be no differences.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 697, "user_id": 569763, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3a05235ac9d98378afddbaf95c0d1f6f?s=128&d=identicon&r=PG", "display_name": "milosgajdos", "link": "https://stackoverflow.com/users/569763/milosgajdos"}, "is_accepted": true, "score": 3, "last_activity_date": 1524000435, "creation_date": 1524000435, "answer_id": 49887762, "question_id": 49241490, "link": "https://stackoverflow.com/questions/49241490/gocv-how-to-cut-out-an-image-from-blue-background-using-opencv/49887762#49887762", "title": "gocv: how to cut out an image from blue background using opencv", "body": "<p>So I spent quite some time on this to figure out what I'm missing and finally found the answer to my question in case anyone is interested. It's now clearer to me now why this question hasn't been answered as the solution to it is rather crazy due to <code>gocv</code> API.</p>\n\n<p>Here is the code that I had to write to get the result I'm after:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"path/filepath\"\n\n    \"gocv.io/x/gocv\"\n)\n\nfunc main() {\n    // read image\n    pizzaPath := filepath.Join(\"pizza.png\")\n    pizza := gocv.IMRead(pizzaPath, gocv.IMReadColor)\n    if pizza.Empty() {\n        fmt.Printf(\"Failed to read image: %s\\n\", pizzaPath)\n        os.Exit(1)\n    }\n    // Convert BGR to HSV image (dont modify the original)\n    hsvPizza := gocv.NewMat()\n    gocv.CvtColor(pizza, &amp;hsvPizza, gocv.ColorBGRToHSV)\n    pizzaChannels, pizzaRows, pizzaCols := hsvPizza.Channels(), hsvPizza.Rows(), hsvPizza.Cols()\n    // define HSV color upper and lower bound ranges\n    lower := gocv.NewMatFromScalar(gocv.NewScalar(110.0, 50.0, 50.0, 0.0), gocv.MatTypeCV8UC3)\n    upper := gocv.NewMatFromScalar(gocv.NewScalar(130.0, 255.0, 255.0, 0.0), gocv.MatTypeCV8UC3)\n    // split HSV lower bounds into H, S, V channels\n    lowerChans := gocv.Split(lower)\n    lowerMask := gocv.NewMatWithSize(pizzaRows, pizzaCols, gocv.MatTypeCV8UC3)\n    lowerMaskChans := gocv.Split(lowerMask)\n    // split HSV lower bounds into H, S, V channels\n    upperChans := gocv.Split(upper)\n    upperMask := gocv.NewMatWithSize(pizzaRows, pizzaCols, gocv.MatTypeCV8UC3)\n    upperMaskChans := gocv.Split(upperMask)\n    // copy HSV values to upper and lower masks\n    for c := 0; c &lt; pizzaChannels; c++ {\n        for i := 0; i &lt; pizzaRows; i++ {\n            for j := 0; j &lt; pizzaCols; j++ {\n                lowerMaskChans[c].SetUCharAt(i, j, lowerChans[c].GetUCharAt(0, 0))\n                upperMaskChans[c].SetUCharAt(i, j, upperChans[c].GetUCharAt(0, 0))\n            }\n        }\n    }\n    gocv.Merge(lowerMaskChans, &amp;lowerMask)\n    gocv.Merge(upperMaskChans, &amp;upperMask)\n    // global mask\n    mask := gocv.NewMat()\n    gocv.InRange(hsvPizza, lowerMask, upperMask, &amp;mask)\n    // cut out pizza mask\n    pizzaMask := gocv.NewMat()\n    gocv.Merge([]gocv.Mat{mask, mask, mask}, &amp;pizzaMask)\n    // cut out the pizza and convert back to BGR\n    gocv.BitwiseAnd(hsvPizza, pizzaMask, &amp;hsvPizza)\n    gocv.CvtColor(hsvPizza, &amp;hsvPizza, gocv.ColorHSVToBGR)\n    // write image to filesystem\n    outPizza := \"no_pizza.jpeg\"\n    if ok := gocv.IMWrite(outPizza, hsvPizza); !ok {\n        fmt.Printf(\"Failed to write image: %s\\n\", outPizza)\n        os.Exit(1)\n    }\n    // write pizza mask to filesystem\n    outPizzaMask := \"no_pizza_mask.jpeg\"\n    if ok := gocv.IMWrite(outPizzaMask, mask); !ok {\n        fmt.Printf(\"Failed to write image: %s\\n\", outPizza)\n        os.Exit(1)\n    }\n}\n</code></pre>\n\n<p>This code produces the result I was after:</p>\n\n<p><a href=\"https://i.stack.imgur.com/5zZl4.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/5zZl4.jpg\" alt=\"pizza cut out\"></a></p>\n\n<p>I'm also going to add another picture that shows the im</p>\n\n<p><a href=\"https://i.stack.imgur.com/vUkTl.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/vUkTl.jpg\" alt=\"image mask\"></a></p>\n\n<p>Now, let's get to code. <code>gocv</code> API function <code>InRange()</code> does not accept <code>Scalar</code> like OpenCV <a href=\"https://docs.opencv.org/master/d2/de8/group__core__array.html#ga48af0ab51e36436c5d04340e036ce981\" rel=\"nofollow noreferrer\">does</a> so you have to do all that crazy image channel splitting and merging dance since you need to pass in <code>Mat</code>s as lower and upper bounds to <code>InRange()</code>; these <code>Mat</code> masks have to have the exact number of channels as the image on which you run <code>InRange()</code>.</p>\n\n<p>This brings up another important point: when allocating the <code>Scalar</code>s in <code>gocv</code> for this task, I originally used <code>gocv.MatTypeCV8U</code> type which represents <em>single</em> channel color - not enough for <code>HSV</code> image which has three channels -- this is fixed by using <code>gocv.MatTypeCV8UC3</code> type.</p>\n\n<p>If I it were possible pass in <code>gocv.Scalar</code>s into <code>gocv.InRange()</code> a lot of the boiler plate code would disappear; so would all the unnecessary <code>gocv.NewMat()</code> allocations for splitting and reassembling the channels which are required to create lower and upper bounds channels.</p>\n"}], "owner": {"reputation": 697, "user_id": 569763, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3a05235ac9d98378afddbaf95c0d1f6f?s=128&d=identicon&r=PG", "display_name": "milosgajdos", "link": "https://stackoverflow.com/users/569763/milosgajdos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3340, "favorite_count": 1, "accepted_answer_id": 49887762, "answer_count": 3, "score": 3, "last_activity_date": 1562334825, "creation_date": 1520876807, "last_edit_date": 1521588047, "question_id": 49241490, "link": "https://stackoverflow.com/questions/49241490/gocv-how-to-cut-out-an-image-from-blue-background-using-opencv", "title": "gocv: how to cut out an image from blue background using opencv", "body": "<p>I started playing with <a href=\"https://github.com/hybridgroup/gocv\" rel=\"nofollow noreferrer\">gocv</a>. I'm trying to figure out a simple thing: how to cut out an object from an image which has a background of certain colour. In this case the object is pizza and background colour is blue.</p>\n\n<p><a href=\"https://i.stack.imgur.com/PnoWu.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/PnoWu.png\" alt=\"enter image description here\"></a></p>\n\n<p>I'm using <a href=\"https://godoc.org/gocv.io/x/gocv#InRange\" rel=\"nofollow noreferrer\">InRange</a> function (<a href=\"https://docs.opencv.org/master/d2/de8/group__core__array.html#ga48af0ab51e36436c5d04340e036ce981\" rel=\"nofollow noreferrer\">inRange</a> in OpenCV) to define the upper and lower threshold for blue colour to create a mask and then <a href=\"https://godoc.org/gocv.io/x/gocv#Mat.CopyToWithMask\" rel=\"nofollow noreferrer\">CopyToWithMask</a> function (<a href=\"https://docs.opencv.org/master/d3/d63/classcv_1_1Mat.html#a626fe5f96d02525e2604d2ad46dd574f\" rel=\"nofollow noreferrer\">copyTo</a> in OpenCV) to apply the mask on the original image. I expect the result to be the blue background with the pizza cut out of it.</p>\n\n<p>The code is very simple:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n\n    \"gocv.io/x/gocv\"\n)\n\nfunc main() {\n    imgPath := \"pizza.png\"\n    // read in an image from filesystem\n    img := gocv.IMRead(imgPath, gocv.IMReadColor)\n    if img.Empty() {\n        fmt.Printf(\"Could not read image %s\\n\", imgPath)\n        os.Exit(1)\n    }\n    // Create a copy of an image\n    hsvImg := img.Clone()\n\n    // Convert BGR to HSV image\n    gocv.CvtColor(img, hsvImg, gocv.ColorBGRToHSV)\n    lowerBound := gocv.NewMatFromScalar(gocv.NewScalar(110.0, 100.0, 100.0, 0.0), gocv.MatTypeCV8U)\n    upperBound := gocv.NewMatFromScalar(gocv.NewScalar(130.0, 255.0, 255.0, 0.0), gocv.MatTypeCV8U)\n\n    // Blue mask\n    mask := gocv.NewMat()\n    gocv.InRange(hsvImg, lowerBound, upperBound, mask)\n\n    // maskedImg: output array that has the same size and type as the input arrays.\n    maskedImg := gocv.NewMatWithSize(hsvImg.Rows(), hsvImg.Cols(), gocv.MatTypeCV8U)\n    hsvImg.CopyToWithMask(maskedImg, mask)\n\n    // save the masked image\n    newImg := gocv.NewMat()\n    // Convert back to BGR before saving\n    gocv.CvtColor(maskedImg, newImg, gocv.ColorHSVToBGR)\n    gocv.IMWrite(\"no_pizza.jpeg\", newImg)\n}\n</code></pre>\n\n<p>However the resulting image is basically almost completely black except for a slight hint of a pizza edge:</p>\n\n<p><a href=\"https://i.stack.imgur.com/KFWI2.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/KFWI2.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>As for the chosen upper and lower bound of blue colours, I followed the guide mentioned in the official <a href=\"http://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_imgproc/py_colorspaces/py_colorspaces.html?highlight=hsv_green\" rel=\"nofollow noreferrer\">documentation</a>:</p>\n\n<pre><code>blue = np.uint8([[[255, 0, 0]]])\nhsv_blue = cv2.cvtColor(blue, cv2.COLOR_BGR2HSV)\nprint(hsv_blue)\n\n[[[120 255 255]]]\n</code></pre>\n\n<blockquote>\n  <p>Now you take [H-10, 100,100] and [H+10, 255, 255] as lower bound and\n  upper bound respectively.</p>\n</blockquote>\n\n<p>I'm sure I'm missing something fundamental, but can't figure out what it is.</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1520876222, "post_id": 49241317, "comment_id": 85486259, "body": "You cannot modify a struct&#39;s type definition at runtime. A value of a struct type will always have all fields of the struct type definition."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1520876981, "post_id": 49241317, "comment_id": 85486624, "body": "Do you just want to blank it out with an empty string?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 3, "creation_date": 1520879872, "post_id": 49241317, "comment_id": 85488200, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/17306358/removing-fields-from-struct-or-hiding-them-in-json-response\">Removing fields from struct or hiding them in JSON Response</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "is_accepted": true, "score": 17, "last_activity_date": 1520879419, "last_edit_date": 1520879419, "creation_date": 1520877843, "answer_id": 49241752, "question_id": 49241317, "link": "https://stackoverflow.com/questions/49241317/is-it-possible-to-delete-a-field-of-a-struct-value-at-runtime/49241752#49241752", "title": "Is it possible to delete a field of a struct value at runtime?", "body": "<p>There is no way to actually edit a golang type (such as a struct) at runtime. Unfortunately you haven't really explained what you are hoping to achieve by \"deleting\" the APIKey field.</p>\n\n<p>General approaches would be:</p>\n\n<ol>\n<li><p>set the APIKey field to an empty string after inspection, if you dont want to display this field when empty set the json struct tag to omitempty (e.g `json:\"apiKey,omitempty\"`)</p></li>\n<li><p>set the APIKey field to never Marshal into JSON ( e.g ApiKey string   `json:\"-\"`) and you will still be able to inspect it just wont display in JSON, you could take this further by adding a custom marshal / unmarshal function to handle this in one direction or in a context dependent way</p></li>\n<li><p>copy the data to a new struct, e.g type RecordNoAPI struct without the APIKey field and return that after you have inspected the original Record</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 5400405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03e85347711a15921e46c34c994d9985?s=128&d=identicon&r=PG", "display_name": "Arthur Savage", "link": "https://stackoverflow.com/users/5400405/arthur-savage"}, "is_accepted": false, "score": 0, "last_activity_date": 1612179098, "creation_date": 1612179098, "answer_id": 65991960, "question_id": 49241317, "link": "https://stackoverflow.com/questions/49241317/is-it-possible-to-delete-a-field-of-a-struct-value-at-runtime/65991960#65991960", "title": "Is it possible to delete a field of a struct value at runtime?", "body": "<ol>\n<li>Created RecordShort structure without &quot;ApiKey&quot;</li>\n<li>Marshalin Record</li>\n<li>Unmarsaling Record to ShortRecord</li>\n</ol>\n<pre class=\"lang-golang prettyprint-override\"><code>type RecordShot struct {\n  Id     string   `json:&quot;id&quot;`\n  Body   []string `json:&quot;body&quot;`\n  Type   string   `json:&quot;type&quot;`\n}\n    \nrecord,_:=json.Marshal(Record)\njson.Unmarshal([]byte(record), &amp;RecordShot)\n</code></pre>\n"}], "owner": {"reputation": 382, "user_id": 7479934, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100007344395075/picture?type=large", "display_name": "Amanda Ferrari", "link": "https://stackoverflow.com/users/7479934/amanda-ferrari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10269, "favorite_count": 1, "accepted_answer_id": 49241752, "answer_count": 2, "score": 4, "last_activity_date": 1612179098, "creation_date": 1520876190, "last_edit_date": 1520879825, "question_id": 49241317, "link": "https://stackoverflow.com/questions/49241317/is-it-possible-to-delete-a-field-of-a-struct-value-at-runtime", "title": "Is it possible to delete a field of a struct value at runtime?", "body": "<p>I have the following struct:</p>\n\n<pre><code>type Record struct {\n  Id     string   `json:\"id\"`\n  ApiKey string   `json:\"apiKey\"`\n  Body   []string `json:\"body\"`\n  Type   string   `json:\"type\"`\n}\n</code></pre>\n\n<p>Which is a Blueprint of a dynamoDB table. And I need somehow, delete the ApiKey, after using to check if the user has access to the giving record. Explaining:</p>\n\n<p>I have and endpoint in my API where the user can send a <code>id</code> to get a item, but he needs to have access to the ID and the ApiKey (I'm using Id (uuid) + ApiKey) to create unique items.</p>\n\n<p>How I'm doing:</p>\n\n<pre><code> func getExtraction(id string, apiKey string) (Record, error) {\n    svc := dynamodb.New(cfg)\n\n    req := svc.GetItemRequest(&amp;dynamodb.GetItemInput{\n      TableName: aws.String(awsEnv.Dynamo_Table),\n      Key: map[string]dynamodb.AttributeValue{\n        \"id\": {\n          S: aws.String(id),\n        },\n      },\n    })\n\n    result, err := req.Send()\n    if err != nil {\n      return Record{}, err\n    }\n\n    record := Record{}\n    err = dynamodbattribute.UnmarshalMap(result.Item, &amp;record)\n    if err != nil {\n      return Record{}, err\n    }\n\n    if record.ApiKey != apiKey {\n      return Record{}, fmt.Errorf(\"item %d not found\", id)\n    }\n    // Delete ApiKey from record\n    return record, nil\n  }\n</code></pre>\n\n<p>After checking if the ApiKey is equal to the provided <code>apiKey</code>, I want to delete the <code>ApiKey</code> from <code>record</code>, but unfortunately that's not possible using <code>delete</code>.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["go", "crash", "coredump"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520876393, "post_id": 49241259, "comment_id": 85486367, "body": "This isn&#39;t really the place to post bugs about a Go implementation. The issue tracker should be sufficient."}, {"owner": {"reputation": 49, "user_id": 5766634, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6qqW6.png?s=128&g=1", "display_name": "Nila", "link": "https://stackoverflow.com/users/5766634/nila"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1520876400, "post_id": 49241259, "comment_id": 85486373, "body": "@RayfenWindspear Can you share your code on pastebin or somewhere ? I&#39;d like to test it on my machine if possible"}, {"owner": {"reputation": 49, "user_id": 5766634, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6qqW6.png?s=128&g=1", "display_name": "Nila", "link": "https://stackoverflow.com/users/5766634/nila"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520876543, "post_id": 49241259, "comment_id": 85486439, "body": "@JimB thought it might help. I spent days on this just to figure out that the plugin thing is broken (for me and some other guy on github)"}, {"owner": {"reputation": 49, "user_id": 5766634, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6qqW6.png?s=128&g=1", "display_name": "Nila", "link": "https://stackoverflow.com/users/5766634/nila"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1520876870, "post_id": 49241259, "comment_id": 85486567, "body": "@RayfenWindspear nope they work fine on darwin. Except for... this issue.  Just use go 1.10 and try again"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1520883307, "post_id": 49241259, "comment_id": 85490130, "body": "Yup, it &#39;sploded... <code>runtime: unexpected return pc for runtime.goexit called from 0xc42007c0c0</code>"}, {"owner": {"reputation": 49, "user_id": 5766634, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6qqW6.png?s=128&g=1", "display_name": "Nila", "link": "https://stackoverflow.com/users/5766634/nila"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1520883550, "post_id": 49241259, "comment_id": 85490256, "body": "@RayfenWindspear Yup, yet still some people downvote for no reason :/"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1520884247, "post_id": 49241259, "comment_id": 85490571, "body": "It&#39;s downvoted because bug reports are off topic. The support ticket is sufficient."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 1, "creation_date": 1520886725, "post_id": 49241259, "comment_id": 85491731, "body": "it seems a little unfair to OP to down vote when they would have been unclear whether a bug or programming error when asking"}, {"owner": {"reputation": 49, "user_id": 5766634, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6qqW6.png?s=128&g=1", "display_name": "Nila", "link": "https://stackoverflow.com/users/5766634/nila"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1520887084, "post_id": 49241259, "comment_id": 85491944, "body": "@RayfenWindspear The thing is, I would never expect this to be an actual bug in go, I&#39;d search on stack overflow, and I had this exact question yesterday, which I deleted to create this self-solving question so that others actually find the reason why their code fails. (I fixed up the main post now, so it doesn&#39;t look like a bugreport)"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1520887336, "post_id": 49241259, "comment_id": 85492060, "body": "@WebweaverD which is the reason I, myself, did not do any downvoting. It had one from someone else, which I deemed enough given that there is technically no specific documentation or guidelines that say this sort of bug is off topic... yet it is. Hence the explanation I gave. It really should be in the guidelines though."}], "answers": [{"tags": [], "owner": {"reputation": 49, "user_id": 5766634, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6qqW6.png?s=128&g=1", "display_name": "Nila", "link": "https://stackoverflow.com/users/5766634/nila"}, "is_accepted": false, "score": 0, "last_activity_date": 1520875930, "creation_date": 1520875930, "answer_id": 49241260, "question_id": 49241259, "link": "https://stackoverflow.com/questions/49241259/go-plugin-core-dumps-when-using-go-routines-and-variables/49241260#49241260", "title": "Go plugin core dumps when using go routines and variables", "body": "<p>I recently reported this issue to golang: <a href=\"https://github.com/golang/go/issues/24351\" rel=\"nofollow noreferrer\" title=\"Issue at github\">Issue related to go plugin crashes</a></p>\n\n<p>This only appears to be the case on darwin (OS X). </p>\n"}], "owner": {"reputation": 49, "user_id": 5766634, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6qqW6.png?s=128&g=1", "display_name": "Nila", "link": "https://stackoverflow.com/users/5766634/nila"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1520887311, "creation_date": 1520875930, "last_edit_date": 1520887311, "question_id": 49241259, "link": "https://stackoverflow.com/questions/49241259/go-plugin-core-dumps-when-using-go-routines-and-variables", "title": "Go plugin core dumps when using go routines and variables", "body": "<p>I am unable to use variables inside my go routine started in a go plugin.\nThe following code is an example of what I am trying to do.</p>\n\n<p>The code</p>\n\n<pre><code>// Can be an non-empty struct as well\nvar channel = make(chan string) \nlog.Println(channel) \ngo func(ch chan string) { \n    log.Println(ch) \n}(channel)\n</code></pre>\n\n<p>crahes with a coredump when executed in a go plugin on darwin.</p>\n\n<p>-Yes Go plugins work on darwin: <a href=\"http://prntscr.com/iq8czy\" rel=\"nofollow noreferrer\">http://prntscr.com/iq8czy</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1276, "user_id": 6237232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/557d1078fe8ace9c1e6f88d275f5f32a?s=128&d=identicon&r=PG&f=1", "display_name": "RidgeA", "link": "https://stackoverflow.com/users/6237232/ridgea"}, "edited": false, "score": 3, "creation_date": 1520875560, "post_id": 49241100, "comment_id": 85485909, "body": "Just create separate interface with new method"}], "answers": [{"tags": [], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "is_accepted": false, "score": 5, "last_activity_date": 1520885896, "last_edit_date": 1520885896, "creation_date": 1520878826, "answer_id": 49242015, "question_id": 49241100, "link": "https://stackoverflow.com/questions/49241100/how-to-add-new-method-in-interface-in-golang/49242015#49242015", "title": "how to add new method in interface in golang", "body": "<p>You can implement multiple interfaces with a single struct, as below. You would then have methods accept the different interfaces as arguments.</p>\n\n<p>If you need a single function which utilises methods from both interfaces you could just pass the pointer to your struct as separate arguments (one for each interface) but there is nothing stopping one interface satisfying multiple interfaces with a smaller scope so you could create a third interface which encapsulates the functionality of both to handle these situations (See IJ interface example).</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype I interface {\n    A()\n    B()\n}\n\n// interface 'J' could be defined in an external package, it doesn't matter\ntype J interface {\n    C()\n}\n\n// encapsulate I &amp; J interfaces as IJ\ntype IJ interface {\n    J\n    I\n}\n\n// S will satisfy interfaces I, J &amp; IJ\ntype S struct {}\n\nfunc (s *S) A(){\n    fmt.Println(\"A\")\n}\n\nfunc (s *S) B(){\n    fmt.Println(\"B\")\n}\n\nfunc (s *S) C(){\n    fmt.Println(\"C\")\n}\n\n\nfunc main() {\n    s := &amp;S{}\n    doWithI(s)\n    doWithJ(s)\n    fmt.Println(\"===================================\")\n    doWithIAndJ(s)\n}\n\nfunc doWithI(in I){\n    in.A()\n    in.B()\n}\n\nfunc doWithJ(in J){\n    in.C()\n}\n\nfunc doWithIAndJ(in IJ){\n    in.A()\n    in.B()\n    in.C()\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/DwH7Sr3zf_Y\" rel=\"nofollow noreferrer\">https://play.golang.org/p/DwH7Sr3zf_Y</a></p>\n"}], "owner": {"reputation": 167, "user_id": 5730790, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh5.googleusercontent.com/-pAdEv0dhFBk/AAAAAAAAAAI/AAAAAAAAAD8/Bn-xjC-R-Eo/photo.jpg?sz=128", "display_name": "Harsh Agarwal", "link": "https://stackoverflow.com/users/5730790/harsh-agarwal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4750, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1520885896, "creation_date": 1520875350, "question_id": 49241100, "link": "https://stackoverflow.com/questions/49241100/how-to-add-new-method-in-interface-in-golang", "title": "how to add new method in interface in golang", "body": "<p>I have a golang interface I</p>\n\n<pre><code>type I interface {\n    A()\n    B()\n}\n</code></pre>\n\n<p>This interface is an element of <code>type S struct</code>. Now I want to add a function C() to this interface which will be called an object of type S.\nBut this interface is implemented by many other types(for ex: T).\nAnd on compiling I get an error as <code>T does not implement C()</code>.</p>\n\n<p>One workaround for this is add a dummy implementation of C() in T which just returns a value of the T's return type.</p>\n\n<p>Is there any better way to do this?</p>\n"}, {"tags": ["post", "go", "get", "twilio"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1520873963, "post_id": 49240201, "comment_id": 85484894, "body": "You have two structs with the same xml tag. This is not allowed. What exactly are you trying to accomplish?"}, {"owner": {"reputation": 53136, "user_id": 28376, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8ec1383b240b5ba15ffb9743fceb3c0e?s=128&d=identicon&r=PG", "display_name": "philnash", "link": "https://stackoverflow.com/users/28376/philnash"}, "edited": false, "score": 0, "creation_date": 1520916495, "post_id": 49240201, "comment_id": 85500475, "body": "The <code>Dial</code> and <code>DialVoice</code> look very similar, can you just use one of them? How are you calling this struct to make the XML?"}], "owner": {"reputation": 23, "user_id": 7715173, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-tEtXjZ7ppkY/AAAAAAAAAAI/AAAAAAAACFI/7bdF-4UJp74/photo.jpg?sz=128", "display_name": "Parasa Charles", "link": "https://stackoverflow.com/users/7715173/parasa-charles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1520916204, "creation_date": 1520872538, "last_edit_date": 1520916204, "question_id": 49240201, "link": "https://stackoverflow.com/questions/49240201/how-to-configure-two-twilio-dial-number", "title": "How to Configure two Twilio Dial number", "body": "<pre><code>type TwilioMakeCallTwiML struct {\n    Say     *sayTwIML  `xml:\"Say,omitempty\"`\n    Play    *playTwIML `xml:\"Play,omitempty\"`\n    XMLName xml.Name   `xml:\"Response\"`\n    Dial    struct {\n        Say      *sayTwIML `xml:\"Say,omitempty\"`\n        Timeout  int `xml:\"timeout,attr\"`\n        CallerID string `xml:\"callerId,attr\"`\n        Record   string `xml:\"record,attr\"`\n        Number struct {\n            StatusCallbackEvent  string `xml:\"statusCallbackEvent,attr\"`\n            StatusCallback       string `xml:\"statusCallback,attr\"`\n            StatusCallbackMethod string `xml:\"statusCallbackMethod,attr\"`\n            PhoneNumber          string `xml:\",chardata\"`\n        } `xml:\"Number,omitempty\"`\n\n    } `xml:\"Dial,omitempty\"`\n    DialVoice    struct {\n        Say      string `xml:\"Say,omitempty\"`\n        CallerID string `xml:\"callerId,attr\"`\n        Record   string `xml:\"record,attr\"`\n        Number struct {\n            StatusCallbackEvent  string `xml:\"statusCallbackEvent,attr\"`\n            StatusCallback       string `xml:\"statusCallback,attr\"`\n            StatusCallbackMethod string `xml:\"statusCallbackMethod,attr\"`\n            PhoneNumber          string `xml:\",chardata\"`\n        } `xml:\"Number,omitempty\"`\n\n    } `xml:\"Dial,omitempty\"`\n}\n</code></pre>\n\n<blockquote>\n  <p>ttwilio.TwilioMakeCallTwiML field \"Dial\" with tag \"Dial,omitempty\"\n  conflicts with field \"DialVoice\" with tag \"Dial,omitempty\"\n  HTTP|2018/03/12 16:23:21\n  |[::1]:49370|POST|/ttwilio/receiveIncomingCall|500|21||TwilioProxy/1.1|18.924103ms|</p>\n</blockquote>\n\n<p>I want to replicate this TwiML </p>\n\n<pre><code>&lt;Response&gt;\n    &lt;Say&gt;Please wait while we're trying to connect you to the next available representative.&lt;/Say&gt;\n    &lt;Dial timeout=\"20\"&gt;&lt;!--cellphone #1--&gt;&lt;/Dial&gt;\n\n    &lt;Say&gt;Please wait while we're trying to connect you to the next available representative.&lt;/Say&gt;\n    &lt;Dial timeout=\"20\"&gt;&lt;!--cellphone #2--&gt;&lt;/Dial&gt;\n\n    &lt;Say&gt;Please wait while we're trying to connect you to the next available representative.&lt;/Say&gt;\n    &lt;Dial timeout=\"20\"&gt;&lt;!--cellphone #3--&gt;&lt;/Dial&gt;\n&lt;/Response&gt;\n</code></pre>\n"}, {"tags": ["json", "dictionary", "go", "marshalling"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1520869826, "post_id": 49239367, "comment_id": 85482208, "body": "If a function returns an error value, you should check it, period."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1520870048, "post_id": 49239367, "comment_id": 85482398, "body": "Check it. Nothing much can go wrong with map[string]string but OOM could happen."}, {"owner": {"reputation": 4770, "user_id": 437456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4f94c406a23f583b2bde99f8554db54d?s=128&d=identicon&r=PG", "display_name": "DMac the Destroyer", "link": "https://stackoverflow.com/users/437456/dmac-the-destroyer"}, "edited": false, "score": 0, "creation_date": 1520871170, "post_id": 49239367, "comment_id": 85483174, "body": "good point about OOM..."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1520871927, "post_id": 49239367, "comment_id": 85483678, "body": "Error should always be checked if return by function whether it generates or not."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 9, "last_activity_date": 1520956652, "last_edit_date": 1520956652, "creation_date": 1520872326, "answer_id": 49240146, "question_id": 49239367, "link": "https://stackoverflow.com/questions/49239367/can-marshalling-a-mapstringstring-to-json-return-an-error/49240146#49240146", "title": "Can marshalling a map[string]string to json return an error?", "body": "<p>Since any valid <code>string</code> value is a valid key and also a valid value in JSON (for details see <a href=\"https://stackoverflow.com/questions/8676011/which-characters-are-valid-invalid-in-a-json-key-name\">Which characters are valid/invalid in a JSON key name?</a>), theoretically it won't return any errors.</p>\n\n<p>If an out of memory error would occur, <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\"><code>json.Marshal()</code></a> would not return, your app would terminate with an error code.</p>\n\n<p>Since Go stores <code>string</code> values as their UTF-8 encoded byte sequences, there is the question of invalid UTF-8 encoded string content. This also won't result in any errors, as Go will substitute invalid code points with the Unicode replacement character U+FFFD, like in this example:</p>\n\n<pre><code>m := map[string]string{\"\\xff\": \"a\"}\ndata, err := json.Marshal(m)\nfmt.Println(string(data), err)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/gQr7tZGXvfw\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>{\"\\ufffd\":\"a\"} &lt;nil&gt;\n</code></pre>\n\n<p>This behavior is documented at <code>json.Marshal()</code>:</p>\n\n<blockquote>\n  <p>String values encode as JSON strings coerced to valid UTF-8, replacing invalid bytes with the Unicode replacement rune.</p>\n</blockquote>\n\n<p>It may be that marshaling a <code>map[string]string</code> will never return an error, still, you should always check returned errors unless the doc explicitly states that the returned <code>error</code> is always <code>nil</code> (the doc of <code>json.Marshal()</code> does not document such behavior). Such rare example is <a href=\"https://golang.org/pkg/math/rand/#Read\" rel=\"nofollow noreferrer\"><code>rand.Read()</code></a> which documents that <em>\"it always returns len(p) and a nil error\"</em>.</p>\n\n<p>And there is also the possibility that the standard library has errors, so even though the implementation of the <code>json</code> package may not <em>intend</em> to return any error when marshaling a <code>map[string]string</code>, a bug may cause it to still return a non-<code>nil</code> error.</p>\n\n<p>Also see related question: <a href=\"https://stackoverflow.com/questions/32708717/go-when-will-json-unmarshal-to-struct-return-error/32709715#32709715\">Go : When will json.Unmarshal to struct return error?</a></p>\n\n<h3>Concurrent map modification</h3>\n\n<p>For completeness, let's discuss another issue that might cause <code>json.Marshal()</code> to fail when a <code>map[string]string</code> is passed to it.</p>\n\n<p><a href=\"https://golang.org/doc/go1.6#runtime\" rel=\"nofollow noreferrer\">Go 1.6 added</a> a lightweight concurrent misuse of maps detection to the runtime, you can read more about it here: <a href=\"https://stackoverflow.com/questions/39288741/how-to-recover-from-concurrent-map-writes/39289246#39289246\">How to recover from concurrent map writes?</a></p>\n\n<p>This means that the Go runtime may detect if a map is read or modified in a goroutine, and it is also modified by another goroutine, concurrently, without synchronization.</p>\n\n<p>So the scenario here is that we pass a <code>map[string]string</code> to <code>json.Marshal()</code>. And for it to be marshaled, the <code>json</code> package has to iterate over the key-values of the map obviously. If we modify the map concurrently, that will result in a fail.</p>\n\n<p>Here is a sample code that provokes it (the loop is there to increase the likeliness of the concurrent modification, else we would be in the hands of the goroutine scheduler):</p>\n\n<pre><code>m := map[string]string{\"\\xff\": \"a\"}\n\ngo func() {\n    for i := 0; i &lt; 10000; i++ {\n        m[\"x\"] = \"b\"\n    }\n}()\n\nfor i := 0; i &lt; 10000; i++ {\n    if _, err := json.Marshal(m); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>Also note that in this case <code>json.Marshal()</code> will also not return (just like with the case of the out-of-memory error), instead the runtime will crash your app, intentionally. Output will be:</p>\n\n<pre><code>fatal error: concurrent map iteration and map write\n</code></pre>\n"}], "owner": {"reputation": 4770, "user_id": 437456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4f94c406a23f583b2bde99f8554db54d?s=128&d=identicon&r=PG", "display_name": "DMac the Destroyer", "link": "https://stackoverflow.com/users/437456/dmac-the-destroyer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 982, "favorite_count": 0, "accepted_answer_id": 49240146, "answer_count": 1, "score": 5, "last_activity_date": 1520956652, "creation_date": 1520869802, "last_edit_date": 1520873530, "question_id": 49239367, "link": "https://stackoverflow.com/questions/49239367/can-marshalling-a-mapstringstring-to-json-return-an-error", "title": "Can marshalling a map[string]string to json return an error?", "body": "<p>Say I have the following code:</p>\n\n<pre><code>m := map[string]string{}\n//... do stuff to the map\nb, err := json.Marshal(m)\n</code></pre>\n\n<p>Is there any way in this case that the <code>json.Marshal</code> call would return an error? </p>\n\n<p>I'm wondering partly out of curiosity and partly to consider whether I need to worry about that error check at all.</p>\n"}, {"tags": ["go", "unix-socket"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520869114, "post_id": 49238605, "comment_id": 85481641, "body": "<code>ReadAll</code> waits for <code>io.EOF</code>"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520870046, "post_id": 49238605, "comment_id": 85482397, "body": "@JimB apologies you are quite correct, I assumed it was hitting EOF, in fact a little more poking revealed that is not the case - I have updated my question - any thoughts on why the response is taking so long via go?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1520870293, "post_id": 49238605, "comment_id": 85482591, "body": "I don&#39;t understand the question, but maybe the confusion is because you&#39;re not correctly reading from the socket in the first place. A <code>Read</code> call is never guaranteed to return the buffer size of bytes, it returns what&#39;s available. Read the <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\"><code>io.Reader</code></a> documentation again. You must check the number of bytes read first, before checking for an error. Reading fewer bytes than your buffer size is not indicative of anything."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1520870632, "post_id": 49238605, "comment_id": 85482832, "body": "I would add that a few of the links at the bottom of <a href=\"http://www.openvas.org/compendium/openvas-compendium.html\" rel=\"nofollow noreferrer\">this document</a> broadly describe that protocol, and googling reveals that OpenVAS is open source, so one can just read its source code to get an idea about how a message boundary should be detected when working with this protocol. (Though I think JimB is correct"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1520871096, "post_id": 49238605, "comment_id": 85483122, "body": "as per updated question, I have removed the bit that returns if the response is less than the buffer size, I now get the full response back in dribs and drabs. The outstanding issue is why it is taking so long to return the full response (either via read or ReadAll) when netcat pulls it back in under a second. @Kostix, there are no docs (up to date) so looking through the source code is the only way I&#39;ve got anywhere with this but I dont think the issue im seeing is to do with openvas or the protocol as netcat is coping just fine with no knowledge."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520871244, "post_id": 49238605, "comment_id": 85483223, "body": "@WebweaverD: you have not removed it: <code>if n &lt; bufSize {</code>. That there is an error itself. Break the loop after you handle the bytes read, when you handle the error."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520871406, "post_id": 49238605, "comment_id": 85483345, "body": "@JimB - just had some text explaining the change, have updated source and question now to clarify"}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "edited": false, "score": 0, "creation_date": 1520871794, "post_id": 49238605, "comment_id": 85483588, "body": "Btw I thing now with this code you will never fulfill <code>if n == 0</code> because this case - in case of EOF or other err - has already been covered earlier inside your loop."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1520871903, "post_id": 49238605, "comment_id": 85483661, "body": "thanks, I had suspected - I will remove"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520872248, "post_id": 49238605, "comment_id": 85483837, "body": "@WebweaverD: I&#39;m not sure how to make this more clear -- handle the bytes read <i>first</i>, check the error after. From the <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\"><code>io.Reader</code> documentation</a>: <code>Callers should always process the n &gt; 0 bytes returned before considering the error err.</code>"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1520872792, "post_id": 49238605, "comment_id": 85484172, "body": "@JimB thanks for the suggestion (missed in previous comment) - that doesn&#39;t seem to make any difference to the response time, I have changed anyway as I guess there is a chance of losing the part of the message when reading the error first"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1520872973, "post_id": 49238605, "comment_id": 85484275, "body": "I had also thought that perhaps it was constant appends or printing to stdout slowing it down, but I have tried removing the Printlns and using a bytes.Buffer and this only make a marginal difference - still very slow"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520873226, "post_id": 49238605, "comment_id": 85484431, "body": "@WebweaverD: as for response time, you say in the post they both take about a minute -- so what exactly is the question now?"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 1, "creation_date": 1520873283, "post_id": 49238605, "comment_id": 85484468, "body": "both my attempts in go take a minute, via netcat it takes a second - that is the question why the ~59 second discrepancy between go and netcat - I would expect similar performance"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1520873802, "post_id": 49238605, "comment_id": 85484802, "body": "@WebweaverD: OK, I see what you&#39;re asking now. First guess is that the <code>openvassd</code> service is waiting for input -- try calling <code>CloseWrite</code> after you send your command. Otherwise I would trace the command and see exactly what it&#39;s doing."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1520874318, "post_id": 49238605, "comment_id": 85485132, "body": "Sounds reasonable but I cant see a way of doing that -  I write to the connection using c.conn.Write(data), there is no c.conn.CloseWrite() method on the net.Conn object, only .Close() which I presume will close for reading also."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1520875211, "post_id": 49238605, "comment_id": 85485688, "body": "@WebweaverD, <code>c.conn.(*net.UnixConn).CloseWrite()</code> should have you covered. The reason is that you appear to use the generic connection function, <code>net.Dial</code>, which returns an interface value, <code>net.Conn</code> (since it&#39;s, well, generic).  You might use <code>net.DialUnix</code> to get a value of the concrete type, <code>net.UnixConn</code> back. Still, when you pass &quot;unix&quot; as the 1st argument to <code>net.Dial</code>, you&#39;ll get an instance of <code>net.UnixConn</code> back, so it&#39;s safe to type-assert it."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1520875976, "post_id": 49238605, "comment_id": 85486134, "body": "@JimB thank you - that seems to be the issue, I did a quick test and the response came back immediately - if you want to present as an answer I will gladly accept"}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1520878252, "post_id": 49241333, "comment_id": 85487294, "body": "JFTR, <code>CloseWrite()</code> calls <a href=\"https://manpages.debian.org/2/shutdown\" rel=\"nofollow noreferrer\"><code>shutdown(fd, SHUT_WR)</code></a> on POSIX systems; hope this might explain more to the OP about this behaviour."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1520876240, "creation_date": 1520876240, "answer_id": 49241333, "question_id": 49238605, "link": "https://stackoverflow.com/questions/49238605/diagnosing-very-slow-read-from-unix-socket-using-golang-1-min-vs-1-sec-in-netca/49241333#49241333", "title": "Diagnosing very slow read from unix socket using golang (1 min vs 1 sec in netcat)", "body": "<p>It appears the service is waiting for more input, and eventually times out after a minute. In your CLI example, once the <code>echo</code> command completes that side of the pipe is shutdown for writes, in which case the service is notified by a 0-length recv. </p>\n\n<p>In order to do the same in Go, you need to call <a href=\"https://golang.org/pkg/net/#UnixConn.CloseWrite\" rel=\"nofollow noreferrer\"><code>CloseWrite</code></a> on the <code>net.UnixConn</code> after you have completed sending the command. </p>\n\n<pre><code>c.conn.(*net.UnixConn).CloseWrite()\n</code></pre>\n"}], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 356, "favorite_count": 0, "accepted_answer_id": 49241333, "answer_count": 1, "score": 1, "last_activity_date": 1520876240, "creation_date": 1520867669, "last_edit_date": 1520873952, "question_id": 49238605, "link": "https://stackoverflow.com/questions/49238605/diagnosing-very-slow-read-from-unix-socket-using-golang-1-min-vs-1-sec-in-netca", "title": "Diagnosing very slow read from unix socket using golang (1 min vs 1 sec in netcat)", "body": "<p><strong>Background</strong>\nIm writing a few packages to communicate with the OpenVas vulnerability scanner - the scanner uses a few different propitiatory protocols to communicate - are all comprised of either xml or text strings sent over a unix socket or tcp connection (im using unix socket).</p>\n\n<p>The issue I'm having is with the OTP protocol (OpenVas internal protocol which is not well documented)</p>\n\n<p>I can run the following command using netcat and I will get a response back in under a second:</p>\n\n<blockquote>\n  <p>echo -en '&lt; OTP/2.0 >\\nCLIENT &lt;|> NVT_INFO\\n' | ncat -U\n  /var/run/openvassd.sock</p>\n</blockquote>\n\n<p>This results in a fairly large response which looks like this in terminal:</p>\n\n<pre><code>&lt; OTP/2.0 &gt;\nSERVER &lt;|&gt; NVT_INFO &lt;|&gt; 201802131248 &lt;|&gt; SERVER\nSERVER &lt;|&gt; PREFERENCES &lt;|&gt;\ncache_folder &lt;|&gt; /var/cache/openvas\ninclude_folders &lt;|&gt; /var/lib/openvas/plugins\nmax_hosts &lt;|&gt; 30\n//lots more here\n</code></pre>\n\n<p>So for example, I previously had some code like this for reading the response back:</p>\n\n<pre><code>func (c Client) read() ([]byte, error) {\n\n    // set up buffer to read in chunks\n    bufSize := 8096\n    resp := []byte{}\n    buf := make([]byte, bufSize)\n\n    for {\n        n, err := c.conn.Read(buf)\n        resp = append(resp, buf[:n]...)\n        if err != nil {\n            if err != io.EOF {\n                return resp, fmt.Errorf(\"read error: %s\", err)\n            }\n            break\n        }\n        fmt.Println(\"got\", n, \"bytes.\")\n\n    }\n    fmt.Println(\"total response size:\", len(resp))\n\n    return resp, nil\n}\n</code></pre>\n\n<p>I get the full result but it comes in small pieces (i guess line by line) so the output I see is something like this (over the course of a minute or so before showing full response):</p>\n\n<pre><code>got 53 bytes.\ngot 62 bytes.\ngot 55 bytes.\ngot 62 bytes.\ngot 64 bytes.\ngot 59 bytes.\ngot 58 bytes.\ngot 54 bytes.\ngot 54 bytes.\ngot 54 bytes.\ngot 64 bytes.\ngot 59 bytes.\n... (more)\n</code></pre>\n\n<p>SO I decided to try ioutil.ReadAll:</p>\n\n<pre><code>func (c Client) read() ([]byte, error) {\n    fmt.Println(\"read start\")\n    d, err := ioutil.ReadAll(c.conn)\n    fmt.Println(\"read done\")\n    return d, err\n}\n</code></pre>\n\n<p>This does again return the full response, but the time between \"read start\" and \"read done\" is around a minute compared to the &lt; 1sec the command is expected to take.</p>\n\n<p>Any thoughts on why the read via golang is so slow compared to netcat - how can I diagnose/fix the issue?**</p>\n"}, {"tags": ["go", "db2", "odbc", "db2-luw"], "comments": [{"owner": {"reputation": 8474, "user_id": 8290634, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d23c338d78a579b717f1cb6e9f16fb1b?s=128&d=identicon&r=PG&f=1", "display_name": "mao", "link": "https://stackoverflow.com/users/8290634/mao"}, "edited": false, "score": 0, "creation_date": 1520867547, "post_id": 49237508, "comment_id": 85480483, "body": "Which Db2-client is installed ?  What is result of <code>ls $DB2HOME&#47;sqllib&#47;inlcude&#47;sqlcli*.h</code> ?  (should contain 2 files sqlcli1.h and sqlcli.h if you installed the correct Db2 product to allow the build to succeed)."}, {"owner": {"reputation": 115, "user_id": 8422242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ab88a9344b5dda75ba71fdd5602faaf?s=128&d=identicon&r=PG&f=1", "display_name": "D.Tan", "link": "https://stackoverflow.com/users/8422242/d-tan"}, "reply_to_user": {"reputation": 8474, "user_id": 8290634, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d23c338d78a579b717f1cb6e9f16fb1b?s=128&d=identicon&r=PG&f=1", "display_name": "mao", "link": "https://stackoverflow.com/users/8290634/mao"}, "edited": false, "score": 0, "creation_date": 1520869037, "post_id": 49237508, "comment_id": 85481581, "body": "I get <code>No such file or directory</code> when I run your command. To add more information, I don&#39;t have db2 installed on my local and I&#39;m trying to access a remote db2 server."}], "answers": [{"tags": [], "owner": {"reputation": 8474, "user_id": 8290634, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d23c338d78a579b717f1cb6e9f16fb1b?s=128&d=identicon&r=PG&f=1", "display_name": "mao", "link": "https://stackoverflow.com/users/8290634/mao"}, "is_accepted": true, "score": 2, "last_activity_date": 1520873223, "last_edit_date": 1520873223, "creation_date": 1520869836, "answer_id": 49239376, "question_id": 49237508, "link": "https://stackoverflow.com/questions/49237508/golang-db2-error/49239376#49239376", "title": "Golang DB2 error", "body": "<p>To build golang with the phiggins db2cli , your workstation or server needs to have a Db2 product (e.g. a suitable client, or a server package) installed locally specifically to deliver the INCLUDE files and the library files for development with Db2. </p>\n\n<p>The Db2-client software comes in different packages for different purposes, and a Db2-client also comes with a Db2-LUW server. For development purposes (i.e. to compile and link executable programs) you need the \"IBM Data Server Driver package\".</p>\n\n<p>IBM describes the different Db2 client types at this <a href=\"https://www.ibm.com/support/knowledgecenter/SSEPGG_11.1.0/com.ibm.swg.im.dbclient.install.doc/doc/c0022612.html\" rel=\"nofollow noreferrer\">link</a>.</p>\n\n<p>If your remote Db2-server runs on Linux/Unix/Windows, you can also try building golang-db2cli on that hostname and copy the build-targets to your workstation provided the server and workstation run the same distro and bitness and release and that the Db2 version/fixpack is identical to that of the client.</p>\n\n<p>Otherwise you can download and install the relevant package from IBM's Fix Central website (registration required) , or from IBM's Passport Advantage website for registered entitled customers. The Db2-client download links are available currently at this <a href=\"https://www-01.ibm.com/support/docview.wss?uid=swg21385217\" rel=\"nofollow noreferrer\">link</a>.</p>\n"}], "owner": {"reputation": 115, "user_id": 8422242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ab88a9344b5dda75ba71fdd5602faaf?s=128&d=identicon&r=PG&f=1", "display_name": "D.Tan", "link": "https://stackoverflow.com/users/8422242/d-tan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 928, "favorite_count": 1, "accepted_answer_id": 49239376, "answer_count": 1, "score": 0, "last_activity_date": 1520873223, "creation_date": 1520864364, "last_edit_date": 1520867164, "question_id": 49237508, "link": "https://stackoverflow.com/questions/49237508/golang-db2-error", "title": "Golang DB2 error", "body": "<p>I'm trying to connect to a db2 using golang using <a href=\"https://bitbucket.org/phiggins/db2cli\" rel=\"nofollow noreferrer\">https://bitbucket.org/phiggins/db2cli</a>. While trying to follow the instructions, I run into this error</p>\n\n<pre><code>vendor/bitbucket.org/phiggins/db2cli/api/api_unix.go:12:11: fatal \nerror: 'sqlcli1.h' file not found\n#include &lt;sqlcli1.h&gt;\n      ^~~~~~~~~~~\n1 error generated.\n</code></pre>\n\n<p>This is the script I tried to use</p>\n\n<pre><code>#!/bin/bash\nDB2HOME=$HOME/sqllib\nexport CGO_LDFLAGS=-L$DB2HOME/lib\nexport CGO_CFLAGS=-I$DB2HOME/include\n\ngo install .\n</code></pre>\n\n<p>Could someone point me to what I need to do to use db2cli? I'm running this code on a macbook.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 884, "user_id": 977910, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/6234b108b8c0e0b3b7cdff599021e2df?s=128&d=identicon&r=PG", "display_name": "temple", "link": "https://stackoverflow.com/users/977910/temple"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520894156, "post_id": 49237092, "comment_id": 85494785, "body": "I think you should read in detail for about the question."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520894435, "post_id": 49237092, "comment_id": 85494876, "body": "Then it&#39;s not clear what you&#39;re asking. Go has no concept of &quot;subscribing&quot; to a channel."}], "answers": [{"comments": [{"owner": {"reputation": 884, "user_id": 977910, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/6234b108b8c0e0b3b7cdff599021e2df?s=128&d=identicon&r=PG", "display_name": "temple", "link": "https://stackoverflow.com/users/977910/temple"}, "edited": false, "score": 0, "creation_date": 1520894231, "post_id": 49237348, "comment_id": 85494804, "body": "thanks your answer. but I think the major problem , I finally found the problem is in subscription will block the thread, so the second one does not go through."}], "tags": [], "owner": {"reputation": 1276, "user_id": 6237232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/557d1078fe8ace9c1e6f88d275f5f32a?s=128&d=identicon&r=PG&f=1", "display_name": "RidgeA", "link": "https://stackoverflow.com/users/6237232/ridgea"}, "is_accepted": false, "score": 3, "last_activity_date": 1520863878, "creation_date": 1520863878, "answer_id": 49237348, "question_id": 49237092, "link": "https://stackoverflow.com/questions/49237092/how-to-subscribe-to-multiple-channels-in-golang/49237348#49237348", "title": "How to subscribe to multiple channels in Golang", "body": "<p>You can wait for multiply channels in single gouroutine using <code>select</code> statement: <a href=\"https://play.golang.com/p/1PUfSyG0HHZ\" rel=\"nofollow noreferrer\">https://play.golang.com/p/1PUfSyG0HHZ</a></p>\n\n<p>More links:</p>\n\n<p><a href=\"https://tour.golang.org/concurrency/5\" rel=\"nofollow noreferrer\">https://tour.golang.org/concurrency/5</a></p>\n\n<p><a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Select_statements</a></p>\n"}, {"tags": [], "owner": {"reputation": 884, "user_id": 977910, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/6234b108b8c0e0b3b7cdff599021e2df?s=128&d=identicon&r=PG", "display_name": "temple", "link": "https://stackoverflow.com/users/977910/temple"}, "is_accepted": true, "score": 0, "last_activity_date": 1520894352, "creation_date": 1520894352, "answer_id": 49245495, "question_id": 49237092, "link": "https://stackoverflow.com/questions/49237092/how-to-subscribe-to-multiple-channels-in-golang/49245495#49245495", "title": "How to subscribe to multiple channels in Golang", "body": "<p>finally I found the solution is to set go for the first SubscribeExchangeUpdate\nso </p>\n\n<pre><code>go bt1.SubscribeExchangeUpdate(\"BTC-NEO\", ch1, nil)\nbt2.SubscribeExchangeUpdate(\"BTC-ETC\", ch2, nil)\n</code></pre>\n"}], "owner": {"reputation": 884, "user_id": 977910, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/6234b108b8c0e0b3b7cdff599021e2df?s=128&d=identicon&r=PG", "display_name": "temple", "link": "https://stackoverflow.com/users/977910/temple"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 2, "accepted_answer_id": 49245495, "answer_count": 2, "score": -2, "last_activity_date": 1520894352, "creation_date": 1520863140, "question_id": 49237092, "link": "https://stackoverflow.com/questions/49237092/how-to-subscribe-to-multiple-channels-in-golang", "title": "How to subscribe to multiple channels in Golang", "body": "<p>It use the golang's channel.\nHow to make st2 to display propertly in the following code:</p>\n\n<pre><code>package main\n\nimport (\n   \"fmt\"\n   \"github.com/OpinionatedGeek/go-bittrex\"\n)\n\nfunc main() {\n bt := bittrex.New(\"\", \"\")\n ch := make(chan bittrex.ExchangeState, 16)\n go func() {\n    for st := range ch1 {\n        fmt.Println(\"Message:\", st)\n    }\n    for st2 := range ch2 {\n        fmt.Println(\"Message:\", st2)\n    }\n}()\n\nbt1.SubscribeExchangeUpdate(\"BTC-NEO\", ch1, nil)\nbt2.SubscribeExchangeUpdate(\"BTC-ETC\", ch2, nil)\n</code></pre>\n\n<p>The problem here is that:\nit only BTC-NEO working. it looks BTC-ETC is just ignored.\nHow to subscribe both of them?</p>\n\n<p>the reference link is at:\n<a href=\"https://github.com/OpinionatedGeek/go-bittrex/blob/master/ws.go\" rel=\"nofollow noreferrer\">https://github.com/OpinionatedGeek/go-bittrex/blob/master/ws.go</a></p>\n"}, {"tags": ["sql", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1520861205, "post_id": 49236330, "comment_id": 85475884, "body": "What you seem to be trying to do is mapping a type to the a db relation, if that&#39;s what you want you can use an already existing ORM or implement one yourself. From the viewpoint of people who do not like to use an ORM, you should create the db without using Go, use .sql files and shell scripts to initialize your database. The question which one is better, ORM or no-ORM, is in the same category as Vim vs Emacs in that it&#39;s opinion based and therefore not something to be asked on SO."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520861549, "post_id": 49236330, "comment_id": 85476114, "body": "... and in case you decide you want to implement something ORM-ish yourself, use the <code>reflect</code> package to read a struct&#39;s field tags and build your query using those."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1520864302, "post_id": 49236330, "comment_id": 85478108, "body": "And before you know it, you will have handcrafted your own ORM! Save yourself a lot of trouble, and don&#39;t reinvent the wheel if you don&#39;t <i>really need to</i>."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1520876781, "post_id": 49236330, "comment_id": 85486526, "body": "there is this which seems to do struct tag migrations without the orm bit (not tested though) - <a href=\"https://github.com/naoina/migu\" rel=\"nofollow noreferrer\">github.com/naoina/migu</a>, also no reason you cant use gorm or similar just for migrations"}], "answers": [{"tags": [], "owner": {"reputation": 1496, "user_id": 4374970, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/mVn41.jpg?s=128&g=1", "display_name": "mfathirirhas", "link": "https://stackoverflow.com/users/4374970/mfathirirhas"}, "is_accepted": true, "score": 4, "last_activity_date": 1521188880, "creation_date": 1521188880, "answer_id": 49316134, "question_id": 49236330, "link": "https://stackoverflow.com/questions/49236330/bind-struct-with-database-creation-in-golang/49316134#49316134", "title": "Bind struct with database creation in Golang", "body": "<p>You can use <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\">reflect</a> to examine the struct and use it to construct your database query. </p>\n\n<p>For example:</p>\n\n<p>If you want to read struct's name to use it as table name:</p>\n\n<pre><code>tableName := reflect.TypeOf(your-struct).Name()\n</code></pre>\n\n<p>If you want to read struct's properties, loop and read it by using:</p>\n\n<pre><code>val := reflect.ValueOf(your-struct)\nfor i:=0; i &lt; val.NumField(); i++ {\n    field := val.Type().Field(i)\n    tag := field.Tag\n\n    fieldType := field.Type // get struct's variable type\n    fieldName := field.Name //get struct variable's name\n    fieldByTag1 := tag.Get(\"your-tag\") // get struct tag's name \n    fieldByTag2 := tag.Get(\"your-another-tag\") // get another struct tag's name(if you have more)\n}\n</code></pre>\n\n<p>Note that struct's tags are the one inside back tick -> `</p>\n\n<p>That's all you need to get from a struct. You should explore more in the documentation.</p>\n"}], "owner": {"reputation": 233, "user_id": 7893198, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/91639ade70c5fc21ded9450808e3c97c?s=128&d=identicon&r=PG&f=1", "display_name": "blue panther", "link": "https://stackoverflow.com/users/7893198/blue-panther"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1873, "favorite_count": 0, "accepted_answer_id": 49316134, "answer_count": 1, "score": 3, "last_activity_date": 1521188880, "creation_date": 1520860918, "question_id": 49236330, "link": "https://stackoverflow.com/questions/49236330/bind-struct-with-database-creation-in-golang", "title": "Bind struct with database creation in Golang", "body": "<p>How to bind data struct with database creation in Golang along with its tags/flags. </p>\n\n<p>For example I have this code:</p>\n\n<pre><code>type User struct {\n    ID      int     `sql:\"primary_key;AUTO_INCREMENT\"`\n    Name    string  `sql:\"type:varchar(100);unique\"`\n    Email   string  `sql:\"type:varchar(100);unique\"`\n    Address string  `sql:\"type:varchar(100)\"`\n}\n</code></pre>\n\n<p>When creating the database which should be based on this struct, I instead manually create it like this:</p>\n\n<pre><code>func (db *DB) CreateUserTable() (sql.Result, error) {\n\n    statement := \"CREATE TABLE IF NOT EXISTS %s (%s int, %s varchar, %s varchar, %s varchar)\"\n    return db.Exec(\n        fmt.Sprintf(statement,\n            \"user\",\n            \"id\",\n            \"name\",\n            \"email\",\n            \"address\",\n        ),\n    )\n}\n</code></pre>\n\n<p>How to bind the struct and its tags(primary key, NULL, etc) in database creation?. Is there best practice for it without using ORM libraries(gorm,etc)?</p>\n"}, {"tags": ["sql", "database", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1520851753, "post_id": 49233207, "comment_id": 85469916, "body": "From the docs of <a href=\"https://golang.org/pkg/database/sql/#DB.Prepare\" rel=\"nofollow noreferrer\">Prepare</a>: <i>&quot;Prepare creates a prepared statement for later queries or executions. Multiple queries or executions may be run concurrently from the returned statement. The caller must call the statement&#39;s Close method when the statement <b>is no longer needed</b>.&quot;</i> That means, if you still need the stmt don&#39;t close it."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1520853800, "post_id": 49233207, "comment_id": 85471043, "body": "Whether you use defer or not depends on your use case, and whether a deferred statement is useful in that context."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1520868869, "last_edit_date": 1520868869, "creation_date": 1520854929, "answer_id": 49234395, "question_id": 49233207, "link": "https://stackoverflow.com/questions/49233207/do-i-always-need-to-defer-stmt-close-when-i-use-prepared-statement-in-golang/49234395#49234395", "title": "Do I always need to defer stmt.close() when I use prepared statement in golang?", "body": "<p>Using <a href=\"https://golang.org/ref/spec#Defer_statements\" rel=\"nofollow noreferrer\"><code>defer</code></a> is not a <em>requirement</em>, it's a <em>convenience</em> and it offers <em>safety</em>. What matters is that if you create / prepare a statement (which uses some resources internally and may also use resources in the database server itself), then sometime, some point in the future you do call its <code>Close()</code> method in order to release resources allocated by it.</p>\n\n<p>Deferred functions are executed even if your function ends abruptly (e.g. you have an early <code>return</code> statement or even if your function panics), so using <code>defer</code> to close resources gives you safety that your code will not leak resources and / or memory.</p>\n\n<p>Note that <code>defer</code> will only run when the surrounding function returns. There may be cases when it is possible or even appropriate to close the statement earlier, and not wait until the surrounding function returns. A good example could be if you have a <code>for</code> loop doing many-many iterations, you would not want all the statements created in each iterations to keep resources until the <code>for</code> loop completes. In this case it is recommended to close resources before the next iteration begins. And in this case you would simply write a <code>stmt.Close()</code> instead of <code>defer stmt.Close()</code>, because the latter would not close the statement immediately, only when the function returns.</p>\n\n<p>Also note that \"outsourcing\" the loop's body to a separate function will also give you the possibility to use <code>defer</code> in that separate function, where the deferred close will happen before the next iteration begins. A variant of this may be that you use an anonymous function (a function literal) in the loop's body, where you also have the chance to use <code>defer</code>, e.g.:</p>\n\n<pre><code>for _, v := range values {\n    func() {\n        stmt, err := db.Prepare(\"INSERT INTO users(name) VALUES(?)\")\n        if err != nil {\n            // handle error\n            return\n        }\n        defer stmt.Close()\n\n        // Use stmt...\n    }()\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 10024395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9483e59154ae2804d6144c89a2d79c2a?s=128&d=identicon&r=PG&f=1", "display_name": "user10024395", "link": "https://stackoverflow.com/users/10024395/user10024395"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1550, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1520868869, "creation_date": 1520851329, "question_id": 49233207, "link": "https://stackoverflow.com/questions/49233207/do-i-always-need-to-defer-stmt-close-when-i-use-prepared-statement-in-golang", "title": "Do I always need to defer stmt.close() when I use prepared statement in golang?", "body": "<p>According to the post here, <a href=\"http://go-database-sql.org/modifying.html\" rel=\"nofollow noreferrer\">http://go-database-sql.org/modifying.html</a>, there is no defer stmt.close(). However, there is a stmt.close() API in sql package. I can't seem to find information on whether it is necessary to defer closing the stmt when using prepared statement. Hence, the question - Do I always need to defer stmt.close() when I use prepared statement in golang?</p>\n"}, {"tags": ["go", "enums", "constants"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user9478968"}, "edited": false, "score": 0, "creation_date": 1520851229, "post_id": 49232659, "comment_id": 85469587, "body": "There is no real support for enums in go.<a href=\"https://stackoverflow.com/a/14426447/9478968\">See previous StackOverflow answer.</a>"}, {"owner": {"reputation": 2195, "user_id": 2739334, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/5b6ca1ae0bd6f90024369c7d6c6800aa?s=128&d=identicon&r=PG&f=1", "display_name": "Spektakulatius", "link": "https://stackoverflow.com/users/2739334/spektakulatius"}, "edited": false, "score": 0, "creation_date": 1520854489, "post_id": 49232659, "comment_id": 85471465, "body": "Yeah that&#39;s what I know, too. But I want to define a constant, with some private values, like an enumeration would do."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1520857573, "post_id": 49232659, "comment_id": 85473483, "body": "Don&#39;t use a const, or don&#39;t use Go, or use something in between, for example: <a href=\"https://play.golang.org/p/ZM6to5DFOGB\" rel=\"nofollow noreferrer\">play.golang.org/p/ZM6to5DFOGB</a>. Basically the language does not provide what you so desire, so saying &quot;I want X&quot; if Go does not provide X is not gonna get you anywhere. Also, Go is open source so if you feel up to it, fork it and you can add the desired features yourself."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520858320, "post_id": 49232659, "comment_id": 85473945, "body": "... or <a href=\"https://play.golang.org/p/LQy066ICpCU\" rel=\"nofollow noreferrer\">play.golang.org/p/LQy066ICpCU</a>"}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "edited": false, "score": 1, "creation_date": 1520868850, "post_id": 49232659, "comment_id": 85481448, "body": "Guys marked this question a duplicate, though I believe you&#39;re more trying to find a concise and elegant solution for representing your idea, not exactly sticking to consts. If so, please see <a href=\"https://play.golang.org/p/arx_Ew5-Eja\" rel=\"nofollow noreferrer\">play.golang.org/p/arx_Ew5-Eja</a> with structs or <a href=\"https://play.golang.org/p/UBFDcRc1j54\" rel=\"nofollow noreferrer\">play.golang.org/p/UBFDcRc1j54</a> with slices."}, {"owner": {"reputation": 2195, "user_id": 2739334, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/5b6ca1ae0bd6f90024369c7d6c6800aa?s=128&d=identicon&r=PG&f=1", "display_name": "Spektakulatius", "link": "https://stackoverflow.com/users/2739334/spektakulatius"}, "edited": false, "score": 0, "creation_date": 1520929704, "post_id": 49232659, "comment_id": 85506100, "body": "I&#39;ll give it a try."}], "owner": {"reputation": 2195, "user_id": 2739334, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/5b6ca1ae0bd6f90024369c7d6c6800aa?s=128&d=identicon&r=PG&f=1", "display_name": "Spektakulatius", "link": "https://stackoverflow.com/users/2739334/spektakulatius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "closed_date": 1520855432, "answer_count": 0, "score": 0, "last_activity_date": 1520856403, "creation_date": 1520849535, "last_edit_date": 1520856403, "question_id": 49232659, "link": "https://stackoverflow.com/questions/49232659/how-to-do-enumeration-constant-with-multiple-private-values", "closed_reason": "Duplicate", "title": "How to do Enumeration (Constant) with multiple &quot;private&quot; values", "body": "<p>I'd like to create an enumeration (constants) with mutliple constant types for the values.</p>\n\n<pre><code>package startup\n\ntype args string\ntype argsOptional string\n\nconst (\n    HELP args = \"help\" argsOptional = \"h\"\n    ABOUT args = \"about\"\n)\n</code></pre>\n\n<p>How'd I do it? \nI cannot use any array as constant, so I am confused how it would be best to do it. </p>\n\n<p>Defining an const array like it's mentioned in the duplicate answer is not working and still not what I want!:</p>\n\n<pre><code>type args = [...]string\n\nconst (\n    HELP args = [2]string {\"help\",\"h\"}\n)\n</code></pre>\n\n<p>Does not compile!</p>\n"}, {"tags": ["go", "grpc"], "answers": [{"comments": [{"owner": {"reputation": 328, "user_id": 4134429, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0c903d4a7646fdb04b03cf277ef12f1f?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Shubham", "link": "https://stackoverflow.com/users/4134429/prashant-shubham"}, "edited": false, "score": 0, "creation_date": 1535742171, "post_id": 49306188, "comment_id": 91194017, "body": "Can you please guide how to keep the connection in client open so that further responses from streaming server can be received by client?"}, {"owner": {"reputation": 996, "user_id": 4909445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ded7e867ff7001048e511974d4c19137?s=128&d=identicon&r=PG&f=1", "display_name": "Shettyh", "link": "https://stackoverflow.com/users/4909445/shettyh"}, "reply_to_user": {"reputation": 328, "user_id": 4134429, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0c903d4a7646fdb04b03cf277ef12f1f?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Shubham", "link": "https://stackoverflow.com/users/4134429/prashant-shubham"}, "edited": false, "score": 0, "creation_date": 1535764294, "post_id": 49306188, "comment_id": 91199305, "body": "<code>feature, err := stream.Recv()</code> this is basically a blocking call, it waits until it receives the message from server. And this wait is inside a infinite <code>for loop</code>, so it wait for server to send messages indefinitely. Only thing is this code should be inside <code>go routine</code> so that it will receive messages from server asynchronously while client can do other things in main thread."}, {"owner": {"reputation": 328, "user_id": 4134429, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0c903d4a7646fdb04b03cf277ef12f1f?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Shubham", "link": "https://stackoverflow.com/users/4134429/prashant-shubham"}, "edited": false, "score": 0, "creation_date": 1535779613, "post_id": 49306188, "comment_id": 91201215, "body": "I wanted the same to do in C++, but when I put the code in while loop it breaks. Can you please guide me?"}, {"owner": {"reputation": 996, "user_id": 4909445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ded7e867ff7001048e511974d4c19137?s=128&d=identicon&r=PG&f=1", "display_name": "Shettyh", "link": "https://stackoverflow.com/users/4909445/shettyh"}, "reply_to_user": {"reputation": 328, "user_id": 4134429, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0c903d4a7646fdb04b03cf277ef12f1f?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Shubham", "link": "https://stackoverflow.com/users/4134429/prashant-shubham"}, "edited": false, "score": 0, "creation_date": 1535791153, "post_id": 49306188, "comment_id": 91203493, "body": "Take a look at this <a href=\"https://github.com/grpc/grpc/blob/master/examples/cpp/route_guide/route_guide_client.cc#L86\" rel=\"nofollow noreferrer\">github.com/grpc/grpc/blob/master/examples/cpp/route_guide/&hellip;</a>"}, {"owner": {"reputation": 328, "user_id": 4134429, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0c903d4a7646fdb04b03cf277ef12f1f?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Shubham", "link": "https://stackoverflow.com/users/4134429/prashant-shubham"}, "edited": false, "score": 0, "creation_date": 1535791251, "post_id": 49306188, "comment_id": 91203517, "body": "Thanks figured it out. Just one more help, can you guide me how to stop client from timeout ClientContext::set_deadline is not working ."}, {"owner": {"reputation": 996, "user_id": 4909445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ded7e867ff7001048e511974d4c19137?s=128&d=identicon&r=PG&f=1", "display_name": "Shettyh", "link": "https://stackoverflow.com/users/4909445/shettyh"}, "reply_to_user": {"reputation": 328, "user_id": 4134429, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0c903d4a7646fdb04b03cf277ef12f1f?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Shubham", "link": "https://stackoverflow.com/users/4134429/prashant-shubham"}, "edited": false, "score": 0, "creation_date": 1535791873, "post_id": 49306188, "comment_id": 91203662, "body": "Try setting deadline like this <a href=\"https://github.com/grpc/grpc/blob/master/test/cpp/end2end/end2end_test.cc#L1306\" rel=\"nofollow noreferrer\">github.com/grpc/grpc/blob/master/test/cpp/end2end/&hellip;</a>"}, {"owner": {"reputation": 328, "user_id": 4134429, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0c903d4a7646fdb04b03cf277ef12f1f?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Shubham", "link": "https://stackoverflow.com/users/4134429/prashant-shubham"}, "reply_to_user": {"reputation": 996, "user_id": 4909445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ded7e867ff7001048e511974d4c19137?s=128&d=identicon&r=PG&f=1", "display_name": "Shettyh", "link": "https://stackoverflow.com/users/4909445/shettyh"}, "edited": false, "score": 0, "creation_date": 1535792239, "post_id": 49306188, "comment_id": 91203746, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/179232/discussion-between-prashant-shubham-and-shettyh\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 996, "user_id": 4909445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ded7e867ff7001048e511974d4c19137?s=128&d=identicon&r=PG&f=1", "display_name": "Shettyh", "link": "https://stackoverflow.com/users/4909445/shettyh"}, "is_accepted": true, "score": 7, "last_activity_date": 1521136444, "creation_date": 1521136444, "answer_id": 49306188, "question_id": 49230524, "link": "https://stackoverflow.com/questions/49230524/grpc-private-channels/49306188#49306188", "title": "gRPC private channels", "body": "<p>As per as i understood the question. You want to send the the message to the particular client in gRPC. This is very much possible using <code>Server side streaming</code> or <code>Bi-directional</code> streaming in gRPC.</p>\n\n<p><strong>For example:</strong></p>\n\n<p>Define a server side streaming or bidi streaming api </p>\n\n<pre><code>rpc ListFeatures(Rectangle) returns (stream Feature) {}\n</code></pre>\n\n<p>On Server side:</p>\n\n<pre><code>func ListFeatures(rect *pb.Rectangle, stream pb.RouteGuide_ListFeaturesServer) error {\n  // Save this stream instance in the server on a map or other suitable data structure\n  // so that you can query for this stream instance later\n  // This will act same like your websocket session\n}\n</code></pre>\n\n<blockquote>\n  <p>When you want to send something to a specific client then get the\n  stream instance and do</p>\n</blockquote>\n\n<pre><code>err := stream.Send(feature); // Any times as required\n</code></pre>\n\n<p>On the client, it will be waiting for messages like this</p>\n\n<pre><code>stream, err := client.ListFeatures(ctx, rect)\n\nfor {\n    feature, err := stream.Recv()\n    ...\n    // handle message here\n}\n</code></pre>\n\n<p>Same thing can be done for bidi streaming rpc also. I hope this answers your question</p>\n"}], "owner": {"reputation": 523, "user_id": 2502761, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/eac8ddf404d16c2e2b0a23c8b3b4755e?s=128&d=identicon&r=PG", "display_name": "user2502761", "link": "https://stackoverflow.com/users/2502761/user2502761"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 761, "favorite_count": 2, "accepted_answer_id": 49306188, "answer_count": 1, "score": 12, "last_activity_date": 1521136444, "creation_date": 1520841673, "last_edit_date": 1520842595, "question_id": 49230524, "link": "https://stackoverflow.com/questions/49230524/grpc-private-channels", "title": "gRPC private channels", "body": "<p>Is it possible to only stream to certain clients from a gRPC server? </p>\n\n<p>I believe what I'm looking for is something like Pusher, where you have a channel for a client and you can publish messages that can be seen only by a client that has access to that channel.</p>\n\n<p>What I'm struggling with is understanding what are the steps we need to take to do something like this.</p>\n\n<p>Thinking about web-sockets I believe we can store each client connection, then we can find that connection and send messages. How can we do a similar thing with <code>gRPC</code>?</p>\n"}, {"tags": ["go", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1520841404, "last_edit_date": 1520841404, "creation_date": 1520841075, "answer_id": 49230385, "question_id": 49230330, "link": "https://stackoverflow.com/questions/49230330/how-to-access-struct-fields-in-a-template/49230385#49230385", "title": "How to access struct fields in a template", "body": "<p>Your <code>.category</code> value you want to compare to is not part of your <code>model</code>, but the template engine will attempt to resolve <code>.category</code> as <code>category</code> being a field or method of your <code>model</code> value.</p>\n\n<p>This is because the <code>{{range}}</code> action sets the dot <code>.</code> to the successive elements in each iteration.</p>\n\n<p>To refer to the top-level <code>category</code>, you may use the <code>$</code> sign like this:</p>\n\n<pre><code>&lt;select name=\"category\" id=\"category\"&gt;            \n    {{range $c := .cats}}\n      &lt;option value=\"{{$c.Title}}\"  {{ if eq $c.Title $.category}}active{{end}}&gt;{{$c.Title}}&lt;/option&gt;                                       \n    {{end}}    \n&lt;/select&gt;\n</code></pre>\n\n<p>See this runnable example:</p>\n\n<pre><code>func main() {\n    t := template.Must(template.New(\"\").Parse(src))\n    params := map[string]interface{}{\n        \"category\": \"Cars\",\n        \"cats\": []struct{ Title string }{\n            {\"Animals\"}, {\"Cars\"}, {\"Houses\"},\n        },\n    }\n    if err := t.Execute(os.Stdout, params); err != nil {\n        panic(err)\n    }\n}\n\nconst src = `&lt;select name=\"category\" id=\"category\"&gt;            \n    {{range $c := .cats}}\n      &lt;option value=\"{{$c.Title}}\"  {{ if eq $c.Title $.category}}active{{end}}&gt;{{$c.Title}}&lt;/option&gt;                                       \n    {{end}}    \n&lt;/select&gt;`\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/VXlREd5dYX7\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>&lt;select name=\"category\" id=\"category\"&gt;            \n\n      &lt;option value=\"Animals\"  &gt;Animals&lt;/option&gt;\n\n      &lt;option value=\"Cars\"  active&gt;Cars&lt;/option&gt;\n\n      &lt;option value=\"Houses\"  &gt;Houses&lt;/option&gt;\n\n&lt;/select&gt;\n</code></pre>\n"}], "owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2080, "favorite_count": 0, "accepted_answer_id": 49230385, "answer_count": 1, "score": 2, "last_activity_date": 1520841404, "creation_date": 1520840835, "last_edit_date": 1520841152, "question_id": 49230330, "link": "https://stackoverflow.com/questions/49230330/how-to-access-struct-fields-in-a-template", "title": "How to access struct fields in a template", "body": "<p>I'd like to compare two variables of string type inside a range loop as follows:</p>\n\n<pre><code>&lt;select name=\"category\" id=\"category\"&gt;            \n    {{range $c := .cats}}\n      &lt;option value=\"{{$c.Title}}\"  {{ if eq $c.Title .category}}active{{end}}&gt;{{$c.Title}}&lt;/option&gt;                                       \n    {{end}}    \n&lt;/select&gt;\n</code></pre>\n\n<p>both <code>$c.Title</code> and <code>category</code> are strings dispatched by the controller.</p>\n\n<p>However, instead on drop down menue being in the rendered template, I get :</p>\n\n<blockquote>\n  <p>can't evaluate field category in type model.category</p>\n</blockquote>\n\n<p><code>$c</code> is of struct type category:</p>\n\n<pre><code>type Category struct {\n    ID        int       `db:\"id\"`\n    Title     string    `db:\"title\"`\n    Slug      string    `db:\"slug\"`\n    CreatedAt time.Time `db:\"created_at\"`\n}\n</code></pre>\n\n<p>When I put directly the string value of <code>category</code> instead of <code>.category</code> in the code above, there is no issues.<br>\nI'm using  <a href=\"https://github.com/josephspurrier/gowebapp\" rel=\"nofollow noreferrer\">gowebapp</a> MVC framework, if it does matter.</p>\n\n<p>How can I fix this?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 3844047, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f594cf56ca5b0856611a40008d46f505?s=128&d=identicon&r=PG&f=1", "display_name": "glc-seven", "link": "https://stackoverflow.com/users/3844047/glc-seven"}, "edited": false, "score": 0, "creation_date": 1520825816, "post_id": 49227779, "comment_id": 85459146, "body": "thx. But i am stil confused with why after adding <code>go func</code> it would be ok."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "reply_to_user": {"reputation": 1, "user_id": 3844047, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f594cf56ca5b0856611a40008d46f505?s=128&d=identicon&r=PG&f=1", "display_name": "glc-seven", "link": "https://stackoverflow.com/users/3844047/glc-seven"}, "edited": false, "score": 0, "creation_date": 1520837888, "post_id": 49227779, "comment_id": 85462587, "body": "@glc-seven Because a go function is executed asynchronously. It doesn&#39;t wait for the channel write to complete. In fact if no one is listening to the channel the goroutines would just stack up more and more until the program crashes."}], "tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": true, "score": 2, "last_activity_date": 1520825427, "creation_date": 1520825427, "answer_id": 49227779, "question_id": 49227513, "link": "https://stackoverflow.com/questions/49227513/confused-with-defer-wg-done-and-channel/49227779#49227779", "title": "Confused with defer wg.Done and channel", "body": "<p>Well, first off, your channel use is confused and will block. In the goroutine it reads from the channel. But nothing wrote into it.</p>\n\n<p>I don't think your problem has anything to do with defer.</p>\n"}], "owner": {"reputation": 1, "user_id": 3844047, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f594cf56ca5b0856611a40008d46f505?s=128&d=identicon&r=PG&f=1", "display_name": "glc-seven", "link": "https://stackoverflow.com/users/3844047/glc-seven"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 49227779, "answer_count": 1, "score": -2, "last_activity_date": 1520840778, "creation_date": 1520823060, "last_edit_date": 1520840778, "question_id": 49227513, "link": "https://stackoverflow.com/questions/49227513/confused-with-defer-wg-done-and-channel", "title": "Confused with defer wg.Done and channel", "body": "<p>I encounter a problem about using defer wg.Done and channel.</p>\n\n<p>If I coded like below, there is no problem.</p>\n\n<pre><code>for i := 0; i &lt; ntasks; i++ {\n    wg.Add(1)\n    go func(args DoTaskArgs) {\n        // defer wg.Done()\n        for {\n            worker := &lt;-registerChan\n            ok := call(worker, \"Worker.DoTask\", &amp;args, nil)\n            if ok {\n                wg.Done()\n                // go func() {\n                registerChan &lt;- worker\n                // }()\n                break\n            }\n        }\n    }(DoTaskArgs{jobName, mapFiles[i], phase, i, n_other})\n}\nwg.Wait()\n</code></pre>\n\n<p>But if I use <code>defer wg.Done()</code>, the code would be stucked, unless wrap the <code>registerChan &lt;- worker</code> with <code>go func</code>.</p>\n\n<pre><code>for i := 0; i &lt; ntasks; i++ {\n    wg.Add(1)\n    go func(args DoTaskArgs) {\n        defer wg.Done()\n        for {\n            worker := &lt;-registerChan\n            ok := call(worker, \"Worker.DoTask\", &amp;args, nil)\n            if ok {\n                // go func() {\n                registerChan &lt;- worker\n                // }()\n                break\n            }\n        }\n    }(DoTaskArgs{jobName, mapFiles[i], phase, i, n_other})\n}\nwg.Wait()\n</code></pre>\n\n<p>What is the problem here? </p>\n"}, {"tags": ["go", "telnet"], "answers": [{"tags": [], "owner": {"reputation": 74246, "user_id": 80911, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/9e9b4f80c65dc6076d74cd421084e4fc?s=128&d=identicon&r=PG", "display_name": "Evert", "link": "https://stackoverflow.com/users/80911/evert"}, "is_accepted": false, "score": 2, "last_activity_date": 1520810501, "creation_date": 1520810501, "answer_id": 49226166, "question_id": 49226145, "link": "https://stackoverflow.com/questions/49226145/telnet-client-in-go/49226166#49226166", "title": "Telnet client in go", "body": "<p>The telnet library implements the 'Writer' type. The <a href=\"https://godoc.org/github.com/reiver/go-telnet#Writer\" rel=\"nofollow noreferrer\">Writer Type</a> has a <code>Write</code> method.</p>\n"}, {"tags": [], "owner": {"reputation": 660, "user_id": 580382, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/eUpm4.jpg?s=128&g=1", "display_name": "smokedice", "link": "https://stackoverflow.com/users/580382/smokedice"}, "is_accepted": false, "score": 4, "last_activity_date": 1520811766, "creation_date": 1520811766, "answer_id": 49226314, "question_id": 49226145, "link": "https://stackoverflow.com/questions/49226145/telnet-client-in-go/49226314#49226314", "title": "Telnet client in go", "body": "<p>In the example below you can see that the CallTELNET uses stdin and stdout to allow the user of the program to communicate through telnet. You can send \"hello world\" by running the program and typing the desired text you wish to send followed by the enter key.</p>\n\n   <p>package main</p>\n\n<pre><code>import (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n\n    \"github.com/reiver/go-oi\"\n    \"github.com/reiver/go-telnet\"\n)\n\ntype caller struct{}\n\nfunc (c caller) CallTELNET(ctx telnet.Context, w telnet.Writer, r telnet.Reader) {\n    scanner := bufio.NewScanner(os.Stdin)\n    for scanner.Scan() {\n        oi.LongWrite(w, scanner.Bytes())\n        oi.LongWrite(w, []byte(\"\\n\"))\n    }\n}\n\nfunc main() {\n    fmt.Printf(\"Dial to %s:%d\\n\", \"localhost\", 8080)\n    err := telnet.DialToAndCall(fmt.Sprintf(\"%s:%d\", \"localhost\", 8080), caller{})\n\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>Examples found <a href=\"https://systembash.com/a-simple-go-tcp-server-and-tcp-client/\" rel=\"nofollow noreferrer\">here</a> and <a href=\"https://gitlab.com/tyabuta/go-simple-telnet\" rel=\"nofollow noreferrer\">here</a></p>\n"}, {"tags": [], "owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "is_accepted": true, "score": 4, "last_activity_date": 1520860583, "creation_date": 1520860583, "answer_id": 49236233, "question_id": 49226145, "link": "https://stackoverflow.com/questions/49226145/telnet-client-in-go/49236233#49236233", "title": "Telnet client in go", "body": "<p>Example of programmatic connection using <a href=\"https://godoc.org/github.com/reiver/go-telnet\" rel=\"nofollow noreferrer\">go-telnet</a></p>\n\n<pre><code>func SetTest() {\n    conn, _ := telnet.DialTo(\"localhost:5555\")\n    conn.Write([]byte(\"hello world\"))\n    conn.Write([]byte(\"\\n\"))\n\n}\n</code></pre>\n"}], "owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5990, "favorite_count": 1, "accepted_answer_id": 49236233, "answer_count": 3, "score": 2, "last_activity_date": 1520860583, "creation_date": 1520810294, "last_edit_date": 1520848247, "question_id": 49226145, "link": "https://stackoverflow.com/questions/49226145/telnet-client-in-go", "title": "Telnet client in go", "body": "<p>I am trying to send 'hello world' to the telnet server from go client. In the <a href=\"https://godoc.org/github.com/reiver/go-telnet\" rel=\"nofollow noreferrer\">documentation</a> I have found example:</p>\n\n<pre><code>var caller telnet.Caller = telnet.StandardCaller    \ntelnet.DialToAndCall(\"localhost:5555\", caller)\n</code></pre>\n\n<p>What is the next step to send 'helloworld' now? </p>\n"}, {"tags": ["database", "mongodb", "go"], "answers": [{"comments": [{"owner": {"reputation": 89, "user_id": 8356853, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2aed1862ec54d83b1cfbde4ed86d572b?s=128&d=identicon&r=PG&f=1", "display_name": "SandaleRaclette", "link": "https://stackoverflow.com/users/8356853/sandaleraclette"}, "edited": false, "score": 0, "creation_date": 1520807387, "post_id": 49225678, "comment_id": 85455220, "body": "Ok but how to deal with a specific search as if I want the number ? Something like this won&#39;t work :  <code>&#47;&#47; Find Object by ID func (m *NumObjectDAO) FindByNumber(myNumber int) (Numobject, error) { \tvar numObject Numobject \terr := db.C(COLLECTION).Find(bson.D{{&quot;Number&quot;, myNumber}}).One(&amp;numObject) \treturn numObject, err }</code>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 89, "user_id": 8356853, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2aed1862ec54d83b1cfbde4ed86d572b?s=128&d=identicon&r=PG&f=1", "display_name": "SandaleRaclette", "link": "https://stackoverflow.com/users/8356853/sandaleraclette"}, "edited": false, "score": 2, "creation_date": 1520811558, "post_id": 49225678, "comment_id": 85456271, "body": "Why doesn&#39;t that work?  I am now unsure about what you are asking. It might help to update the question with example documents, the query and what you expect to get."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1520806267, "creation_date": 1520806267, "answer_id": 49225678, "question_id": 49225624, "link": "https://stackoverflow.com/questions/49225624/get-object-by-specific-field/49225678#49225678", "title": "Get Object by specific field", "body": "<p>Use <a href=\"https://godoc.org/gopkg.in/mgo.v2#Collection.Find\" rel=\"nofollow noreferrer\">Find</a> for general <a href=\"https://docs.mongodb.com/manual/tutorial/query-documents/\" rel=\"nofollow noreferrer\">queries</a>:</p>\n\n<pre><code>err := db.c(COLLECTION).Find(bson.D{{\"Number\", 10}}).One(&amp;numobjecct)\n</code></pre>\n"}], "owner": {"reputation": 89, "user_id": 8356853, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2aed1862ec54d83b1cfbde4ed86d572b?s=128&d=identicon&r=PG&f=1", "display_name": "SandaleRaclette", "link": "https://stackoverflow.com/users/8356853/sandaleraclette"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 47, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1520836531, "creation_date": 1520805869, "last_edit_date": 1520836531, "question_id": 49225624, "link": "https://stackoverflow.com/questions/49225624/get-object-by-specific-field", "title": "Get Object by specific field", "body": "<p>I'm actually learning go, following some tutorial as this <a href=\"https://hackernoon.com/build-restful-api-in-go-and-mongodb-5e7f2ec4be94\" rel=\"nofollow noreferrer\">one</a> to build an Resftul API app. </p>\n\n<p>First time Using Go and mongoDB, I don't understand well, how to get specific key in certain document of my collection.</p>\n\n<p>Actually I have this object model :</p>\n\n<pre><code>type Numobject struct {\n    ID     bson.ObjectId `bson:\"_id\" json:\"id\"`\n    Text   string        `bson:\"text\" json:\"text\"`\n    Number int           `bson:\"number\" json:\"number\"`\n    Found  bool          `bson:\"found\" json:\"found\"`\n    Type   string        `bson:\"type\" json:\"type\"`\n}\n</code></pre>\n\n<p>And I can have a specific object by ID with this function : </p>\n\n<pre><code>// Find Object by ID\nfunc (m *NumObjectDAO) FindByNumber(id string) (Numobject, error) {\n    var numObject Numobject\n    err := db.C(COLLECTION).FindId(bson.ObjectIdHex(id)).One(&amp;numObject)\n    return numObject, err\n}\n</code></pre>\n\n<p>I call my method in main.go as follow </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n    \"gopkg.in/mgo.v2/bson\"\n\n    . \"github.com/sandaleRaclette/03-coddingChallenge/config\"\n    . \"github.com/sandaleRaclette/03-coddingChallenge/dao\"\n    . \"github.com/sandaleRaclette/03-coddingChallenge/models\"\n)\n\n// Save the configuration of mongodatabase (localhost and which db use) in Config array\nvar config = Config{}\nvar dao = NumObjectDAO{}\n\n// GET list of all objects\nfunc AllObjectsEndPoint(w http.ResponseWriter, r *http.Request) {\n    movies, err := dao.FindAll()\n    if err != nil {\n        respondWithError(w, http.StatusInternalServerError, err.Error())\n        return\n    }\n    respondWithJson(w, http.StatusOK, movies)\n}\n\n// GET an Object by its ID\nfunc FindObjectEndpoint(w http.ResponseWriter, r *http.Request) {\n    params := mux.Vars(r)\n    numObject, err := dao.FindByNumber(params[\"number\"])\n    if err != nil {\n        respondWithError(w, http.StatusBadRequest, \"Invalid Object ID\")\n        return\n    }\n    respondWithJson(w, http.StatusOK, numObject)\n}\n\n//  Respond Methods\nfunc respondWithError(w http.ResponseWriter, code int, msg string) {\n    respondWithJson(w, code, map[string]string{\"error\": msg})\n}\n\nfunc respondWithJson(w http.ResponseWriter, code int, payload interface{}) {\n    response, _ := json.Marshal(payload)\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.WriteHeader(code)\n    w.Write(response)\n}\n\n// Parse the configuration file 'config.toml', and establish a connection to DB\nfunc init() {\n    config.Read()\n\n    dao.Server = config.Server\n    dao.Database = config.Database\n    dao.Connect()\n}\n\n// Define HTTP request routes and define the differents endpoints\nfunc main() {\n    r := mux.NewRouter()\n    r.HandleFunc(\"/api/v1/trivia\", AllObjectsEndPoint).Methods(\"GET\")\n    r.HandleFunc(\"/api/v1/trivia/{number}\", FindObjectEndpoint).Methods(\"GET\")\n\n    if err := http.ListenAndServe(\":3000\", r); err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>There is other methods than getting an object by ID? How can I get an object with a specific key as Number or Type following my model ? </p>\n\n<p>I want to obtain something like this when I GET \"/api/v1/trivia/45000000\" :</p>\n\n<pre><code>{\n        \"id\": \"5aa554c89d63b0d3580449a5\",\n        \"text\": \"45000000 is the number of turkeys Americans eat at Thanksgiving annually.\",\n        \"number\": 45000000,\n        \"found\": true,\n        \"type\": \"trivia\"\n    }\n</code></pre>\n\n<p>I'm actually looking <a href=\"https://docs.mongodb.com/manual/reference/method/db.collection.find/#db.collection.find\" rel=\"nofollow noreferrer\">here</a> for some answers but I have some difficulties with query... If someone can give me beginner explanation...</p>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 142005, "user_id": 465183, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/3b518a0ea4c992cfe9965671d0139ba4?s=128&d=identicon&r=PG", "display_name": "Gilles Quenot", "link": "https://stackoverflow.com/users/465183/gilles-quenot"}, "edited": false, "score": 1, "creation_date": 1520805657, "post_id": 49225584, "comment_id": 85454775, "body": "When you have text output, <a href=\"https://unix.meta.stackexchange.com/questions/4086/psa-please-dont-post-images-of-text\">don&#39;t take a picture but copy paste the output in your POST</a>"}, {"owner": {"reputation": 51, "user_id": 9476820, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-eH0VUzSVQ-8/AAAAAAAAAAI/AAAAAAAADds/n5VN4kZ5ziM/photo.jpg?sz=128", "display_name": "Justin Yeh", "link": "https://stackoverflow.com/users/9476820/justin-yeh"}, "reply_to_user": {"reputation": 142005, "user_id": 465183, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/3b518a0ea4c992cfe9965671d0139ba4?s=128&d=identicon&r=PG", "display_name": "Gilles Quenot", "link": "https://stackoverflow.com/users/465183/gilles-quenot"}, "edited": false, "score": 0, "creation_date": 1520806140, "post_id": 49225584, "comment_id": 85454904, "body": "Corrected, sorry - first post on S.O."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520809165, "post_id": 49225584, "comment_id": 85455714, "body": "@JustinYeh on your local machine is the <code>.&#47;app</code> folder also located under <code>$GOPATH&#47;src&#47;github.com&#47;user&#47;hftl&#47;</code>?"}, {"owner": {"reputation": 51, "user_id": 9476820, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-eH0VUzSVQ-8/AAAAAAAAAAI/AAAAAAAADds/n5VN4kZ5ziM/photo.jpg?sz=128", "display_name": "Justin Yeh", "link": "https://stackoverflow.com/users/9476820/justin-yeh"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520828712, "post_id": 49225584, "comment_id": 85459763, "body": "@mkopriva the full path of <code>.&#47;app</code> is <code>~&#47;go&#47;src&#47;github.com&#47;jyyeh77&#47;hftl&#47;</code> but I thought it wouldn&#39;t matter if I just copied the contents of <code>.&#47;app</code> via <code>COPY .&#47;app &#47;go&#47;src&#47;github.com&#47;user&#47;hftl</code> in the Dockerfile and set the working directory as such. Or does it matter?"}, {"owner": {"reputation": 16323, "user_id": 355499, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/78892b9338a302a4ba3cc1aa77edd99f?s=128&d=identicon&r=PG", "display_name": "Emil H", "link": "https://stackoverflow.com/users/355499/emil-h"}, "edited": false, "score": 0, "creation_date": 1520834741, "post_id": 49225584, "comment_id": 85461420, "body": "This could be due to some corruption of the 1.9 image. You could try deleting the <code>golang:1.9</code> image and then rebuilding..."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1520835954, "post_id": 49225584, "comment_id": 85461892, "body": "@JustinYeh I think, I&#39;m not sure, it would matter if you have sub packages under <code>.&#47;app</code>, say <code>.&#47;app&#47;foo</code>, and your application is importing them. Let&#39;s say in <code>.&#47;app&#47;main.go</code> if you have an import like <code>&quot;github.com&#47;jyyeh77&#47;hftl&#47;app&#47;foo&quot;</code>, but on docker it&#39;s located under <code>&quot;github.com&#47;user&#47;hftl&#47;app&#47;foo&quot;</code> then that could cause a problem I believe, but I&#39;m not sure if a linker segfault would be the result of this. And since you were able to resolve it by changing the version to 1.9 it means that you either don&#39;t have subpackages that you import or that it actually isn&#39;t a problem at all?"}, {"owner": {"reputation": 51, "user_id": 9476820, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-eH0VUzSVQ-8/AAAAAAAAAAI/AAAAAAAADds/n5VN4kZ5ziM/photo.jpg?sz=128", "display_name": "Justin Yeh", "link": "https://stackoverflow.com/users/9476820/justin-yeh"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520913321, "post_id": 49225584, "comment_id": 85499635, "body": "@mkopriva great point, I eventually made sure that my import paths in <code>.&#47;app</code> matched up with the directory structure created on docker - I think this was completely unrelated to the seemingly corrupted golang 1.10 image i was using."}], "owner": {"reputation": 51, "user_id": 9476820, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-eH0VUzSVQ-8/AAAAAAAAAAI/AAAAAAAADds/n5VN4kZ5ziM/photo.jpg?sz=128", "display_name": "Justin Yeh", "link": "https://stackoverflow.com/users/9476820/justin-yeh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 578, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1520830137, "creation_date": 1520805581, "last_edit_date": 1520830137, "question_id": 49225584, "link": "https://stackoverflow.com/questions/49225584/go-get-on-golang-docker-image-results-in-segmentation-fault", "title": "Go get on golang docker image results in segmentation fault", "body": "<p>I'm trying to run a Go web app in a docker image. When installing dependencies via <strong>RUN go get</strong>, I get a segmentation fault. When installing dependencies and running <strong>go build</strong> locally, I'm able to compile correctly.</p>\n\n<p>I have tried using glide and dep to vendor my dependencies, but I am not sure if dependency management is the issue here. I am also unsure why when using the <code>-v</code> flag in <code>go get -v</code>, the last dependency being installed is <code>github.com/user/hftl/app</code>, which is the directory that I'm copying all my <code>.go</code> files to in the container.</p>\n\n<p>I'm using Docker For Mac.</p>\n\n<p><strong>Output of running docker build ./</strong></p>\n\n<pre><code>Sending build context to Docker daemon  11.78MB\nStep 1/9 : FROM golang:1.10\n ---&gt; 1c1309ff8e0d\nStep 2/9 : ARG app_env\n ---&gt; Using cache\n ---&gt; 4a9c7610a671\nStep 3/9 : ENV APP_ENV $app_env\n ---&gt; Using cache\n ---&gt; 577846d489df\nStep 4/9 : COPY ./app /go/src/github.com/user/hftl/app\n ---&gt; 4a531e5ed4c1\nStep 5/9 : WORKDIR /go/src/github.com/user/hftl/app\nRemoving intermediate container 5b21fc994dba\n ---&gt; 878133804037\nStep 6/9 : RUN go get -v\n ---&gt; Running in a8ba8b45ffcc\ngithub.com/gin-gonic/gin (download)\ngithub.com/gin-contrib/sse (download)\ngithub.com/golang/protobuf (download)\ngithub.com/ugorji/go (download)\nFetching https://gopkg.in/go-playground/validator.v8?go-get=1\nParsing meta tags from https://gopkg.in/go-playground/validator.v8?go-get=1 (status code 200)\nget \"gopkg.in/go-playground/validator.v8\": found meta tag get.metaImport{Prefix:\"gopkg.in/go-playground/validator.v8\", VCS:\"git\", RepoRoot:\"https://gopkg.in/go-playground/validator.v8\"} at https://gopkg.in/go-playground/validator.v8?go-get=1\ngopkg.in/go-playground/validator.v8 (download)\nFetching https://gopkg.in/yaml.v2?go-get=1\nParsing meta tags from https://gopkg.in/yaml.v2?go-get=1 (status code 200)\nget \"gopkg.in/yaml.v2\": found meta tag get.metaImport{Prefix:\"gopkg.in/yaml.v2\", VCS:\"git\", RepoRoot:\"https://gopkg.in/yaml.v2\"} at https://gopkg.in/yaml.v2?go-get=1\ngopkg.in/yaml.v2 (download)\ngithub.com/mattn/go-isatty (download)\ngithub.com/kelseyhightower/envconfig (download)\ngithub.com/lib/pq (download)\ngithub.com/lib/pq/oid\ngithub.com/gin-gonic/gin/json\ngithub.com/gin-contrib/sse\ngithub.com/golang/protobuf/proto\ngopkg.in/go-playground/validator.v8\ngithub.com/ugorji/go/codec\ngopkg.in/yaml.v2\ngithub.com/mattn/go-isatty\ngithub.com/kelseyhightower/envconfig\ngithub.com/lib/pq\ngithub.com/gin-gonic/gin/render\ngithub.com/gin-gonic/gin/binding\ngithub.com/gin-gonic/gin\ngithub.com/user/hftl/app\ngo tool link: signal: segmentation fault\nThe command '/bin/sh -c go get -v' returned a non-zero code: 1\n</code></pre>\n\n<p><strong>My Dockerfile:</strong></p>\n\n<pre><code>FROM golang:1.10\n\nARG app_env\n\n# assign app_env variable from build -&gt; APP_ENV in container shell\n# can either be dev or production: set in docker-compose.yml under 'web'\nENV APP_ENV $app_env\n\n# copy app directory to container\nCOPY ./app /go/src/github.com/user/hftl/app\n\n# all container commands run from this path\nWORKDIR /go/src/github.com/user/hftl/app\n\n# install go deps and build binary\nRUN go get -v\nRUN go build\n\n# start the server\n# hot-reload via pilu/fresh on save of a Go file\nCMD if [ ${APP_ENV} = production ]; then \\\n        app; \\\n        else \\\n        go get github.com/pilu/fresh &amp;&amp; \\\n        fresh; \\\n        fi\n\nEXPOSE 8080\n</code></pre>\n\n<p>[EDIT 1]:</p>\n\n<p>I changed the <code>FROM golang:1.10</code> to <code>FROM golang:1.9.4</code> at the top of my Dockerfile and it seems to have resolved the issue, so it must be a problem with the official go 1.10 image. If anyone could clarify why <code>go tool link</code> would produce a segmentation fault on 1.10, but not 1.9.4, that would be wonderful.</p>\n"}, {"tags": ["go", "amazon-sqs"], "answers": [{"comments": [{"owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 2, "creation_date": 1520811585, "post_id": 49224664, "comment_id": 85456276, "body": "<i>&quot;the queue would still happily deliver any other messages it has available while there are available consumers.&quot;</i>  Then it wouldn&#39;t be &quot;FIFO.&quot;  That&#39;s the reason for this behavior -- so messages with the same message-group-id will not be delivered out of order."}], "tags": [], "owner": {"reputation": 1447, "user_id": 843567, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fbc83c8cfbee162a6f614c23b5db4229?s=128&d=identicon&r=PG", "display_name": "zenocon", "link": "https://stackoverflow.com/users/843567/zenocon"}, "is_accepted": false, "score": 8, "last_activity_date": 1520799619, "creation_date": 1520799619, "answer_id": 49224664, "question_id": 49224662, "link": "https://stackoverflow.com/questions/49224662/aws-sqs-queue-not-delivering-any-messages-until-visibility-timeout-expires-for/49224664#49224664", "title": "AWS SQS - Queue not delivering any messages until Visibility Timeout expires for one message", "body": "<p>OK, so turns out I missed this little nugget of info about FIFO queues in the documentation:</p>\n\n<p><a href=\"https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/FIFO-queues.html\" rel=\"noreferrer\">https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/FIFO-queues.html</a></p>\n\n<p><a href=\"https://i.stack.imgur.com/IYJ6M.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/IYJ6M.png\" alt=\"enter image description here\"></a></p>\n\n<blockquote>\n  <p>When you receive a message with a message group ID, no more messages\n  for the same message group ID are returned unless you delete the\n  message or it becomes visible.</p>\n</blockquote>\n\n<p>I was indeed using the same Message Group ID.  Hadn't given it a second thought.  Just be aware, if you do that and any one of your messages fails to process, it will back up all other messages in the queue, until the time that the message is finally dealt with.  The solution for me was to change the message group id.  There is some business logic id I can postfix on it that will work for me.</p>\n"}], "owner": {"reputation": 1447, "user_id": 843567, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fbc83c8cfbee162a6f614c23b5db4229?s=128&d=identicon&r=PG", "display_name": "zenocon", "link": "https://stackoverflow.com/users/843567/zenocon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2927, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1520799619, "creation_date": 1520799619, "question_id": 49224662, "link": "https://stackoverflow.com/questions/49224662/aws-sqs-queue-not-delivering-any-messages-until-visibility-timeout-expires-for", "title": "AWS SQS - Queue not delivering any messages until Visibility Timeout expires for one message", "body": "<p><strong>EDIT</strong>: <em>Solved this one while I was writing it up :P -- I love those kind of solutions.  I figured I'd post it anyway, maybe someone else will have the same problem and find my solution.  Don't care about points/karma, etc. I just already wrote the whole thing up, so figured I'd post it and the solution.</em></p>\n\n<p>I have an SQS FIFO queue.  It is using a dead letter queue.  Here is how it had been configured:</p>\n\n<p><a href=\"https://i.stack.imgur.com/E5edM.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/E5edM.png\" alt=\"FIFO Queue Configuration\"></a></p>\n\n<p>I have a single producer microservice, and I have 10 ECS images that are running as consumers.</p>\n\n<p>It is important that we process the messages close to the time they are delivered in the queue for business reasons.</p>\n\n<p>We're using a fairly recent version of the AWS SDK Golang client package for both producer and consumer code (if important, I can go look up the version, but it is not terribly outdated).</p>\n\n<p>I capture the logs for the producer so I know exactly when messages were put in the queue and what the messages were.</p>\n\n<p>I capture aggregate logs for all the consumers, so I have a full view of all 10 consumers and when messages were received and processed.</p>\n\n<p>Here's what I see under normal conditions looking at the logs:</p>\n\n<ol>\n<li>Message put in the queue at time x</li>\n<li>Message received by one of the 10 consumers at time x</li>\n<li>Message processed by consumer successfully</li>\n<li>Message deleted from queue by consumer at time x + (0-2 seconds)</li>\n<li>Repeat ad infinitum for up to about 700 messages / day at various times per day</li>\n</ol>\n\n<p>But the problem I am seeing now is that some messages are not being processed in a timely manner.  Occasionally we fail processing a message deliberately b/c of the state of the system for that message (e.g. maybe users still logged in, so it should back off and retry...which it does).  The problem is if the consumer fails a message it is causing the queue to stop delivering <em>any</em> other messages to any other consumers.</p>\n\n<p>\"Failure to process a message\" here just means the message was received, but the consumer declared it a failure, so we just log an error, and do not proceed to delete it from the queue.  Thus, the visibility timeout (here 5m) will expire and it will be re-delivered to another consumer and retried up to 10 times, after which it will go to the dead letter queue.</p>\n\n<p>After delving into the logs and analyzing it, here's what I'm seeing:</p>\n\n<ol>\n<li>Process begins like above (message produced, consumed, deleted).</li>\n<li>New message received at time x by consumer</li>\n<li>Consumer fails -- logs error and just returns (does not delete)</li>\n<li>Same message is received again at time x + 5m (visibility timeout)</li>\n<li>Consumer fails -- logs error and just returns (does not delete)</li>\n<li>Repeat up to 10x -- message goes to dead-letter queue</li>\n<li>New message received but it is now 50 minutes late!</li>\n<li>Now all messages that were put in the queue between steps 2-7 are 50 minutes late (5m visibility timeout * 10 retries)</li>\n</ol>\n\n<p>All the docs I've read tells me the queue should <em>not</em> behave this way, but I've verified it several times in our logs.  Sadly, we don't have a paid AWS support plan, or I'd file a ticket with them.  But just consider the fact that we have 10 separate consumers all reading from the same queue.  They only read from this queue.  We don't have any other queues it is using.  </p>\n\n<p>For de-duplication we are using the automated hash of the message body.  Messages are small JSON documents.</p>\n\n<p>My expectation would be if we have a single bad message that causes a visibility timeout, that the queue would still happily deliver any other messages it has available while there are available consumers.</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 149903, "user_id": 14637, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1904e7096278a10f1dfb3fdc0ceb53cc?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/14637/thomas"}, "is_accepted": false, "score": 9, "last_activity_date": 1520796776, "creation_date": 1520796776, "answer_id": 49224200, "question_id": 49224129, "link": "https://stackoverflow.com/questions/49224129/index-out-of-range-goroutine-golang/49224200#49224200", "title": "index out of range goroutine golang", "body": "<p><code>i</code> does become 2, but only at the very end of the loop. But because your goroutine function <em>closes over <code>i</code></em>, it doesn't see the value of <code>i</code> at the time the goroutine was started, but the value of <code>i</code> at the time it executes. In other words, all your goroutines share the same variable <code>i</code>.</p>\n\n<p>To fix this, one way is to copy <code>i</code> to a helper variable declared inside the loop body. A nicer way is to pass it as an argument to the goroutine:</p>\n\n<pre><code>    go func(i int) {\n        fmt.Printf(\"index: %v, length of slice: %v\\n\", i, len(grph.EntryPoints))\n        structures.CountLinks(&amp;grph, counter, queue, tracker, grph.EntryPoints[i], i)\n        wg.Done()\n    }(i)\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 6744696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59b2fc39aa80dc88825770af8a56b5c8?s=128&d=identicon&r=PG&f=1", "display_name": "sloan-dog", "link": "https://stackoverflow.com/users/6744696/sloan-dog"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 864, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1521128195, "creation_date": 1520796389, "last_edit_date": 1521128195, "question_id": 49224129, "link": "https://stackoverflow.com/questions/49224129/index-out-of-range-goroutine-golang", "title": "index out of range goroutine golang", "body": "<p><strong>Index out of range error where it seems impossible in goroutine generated by for loop</strong></p>\n\n<p>This is the go code I am executing.\nThe problem is that an index out of range error is yielded inside the evaluation of one of the arguments to countlinks call in a goroutine. The length of the slice we're iterating against is ALWAYS 2. Based on my understanding of for loops in go, <code>i</code> should never evaluate to 2 (yielding index out of range in expression <code>grph.entryPoints[i]</code>), and yet it is. Please, tell me how I am crazy.</p>\n\n<pre><code>func main() {\n    grph := structures.ConfigGraphDefault()\n    counter := structures.NewCounter()\n    queue := structures.NewQueue()\n    tracker := structures.NewTracker()\n    fmt.Printf(\"entries: %v\\nnodes: %v\\n\", grph.EntryPoints, grph.Nodes)\n    wg := sync.WaitGroup{}\n    fmt.Println(len(grph.EntryPoints))\n    // this will always evaluate to 2\n    l := len(grph.EntryPoints)\n    for i := 0; i &lt; l; i++ {\n        wg.Add(1)\n        go func() {\n            fmt.Printf(\"index: %v, length of slice: %v\\n\", i, len(grph.EntryPoints))\n            structures.CountLinks(&amp;grph, counter, queue, tracker, grph.EntryPoints[i], i)\n            wg.Done()\n        }()\n    }\n    wg.Wait()\n    fmt.Printf(\"counter: %v\", counter.GetCounts())\n}\n</code></pre>\n"}, {"tags": ["windows", "go", "heroku", "buildpack", "godeps"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1520796448, "post_id": 49224055, "comment_id": 85451781, "body": "Fix your PATH env var."}, {"owner": {"reputation": 2158, "user_id": 1312265, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2ffeafb08435f0369ea545b3f381e7ea?s=128&d=identicon&r=PG", "display_name": "Code_Yoga", "link": "https://stackoverflow.com/users/1312265/code-yoga"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1520803356, "post_id": 49224055, "comment_id": 85454099, "body": "@Volker : Setting GOBIN fixed the issue"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520858559, "post_id": 49225234, "comment_id": 85474105, "body": "Most users should not set <code>GOBIN</code> to <code>GOROOT&#47;bin</code>. Add the default <code>GOBIN</code> to your <code>PATH</code>"}, {"owner": {"reputation": 2158, "user_id": 1312265, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2ffeafb08435f0369ea545b3f381e7ea?s=128&d=identicon&r=PG", "display_name": "Code_Yoga", "link": "https://stackoverflow.com/users/1312265/code-yoga"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520860144, "post_id": 49225234, "comment_id": 85475213, "body": "@JimB : Could you please provide the exact format of these environment variables as I am confused."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1520869689, "post_id": 49225234, "comment_id": 85482097, "body": "the default value for <code>GOBIN</code> is <code>$GOPATH&#47;bin</code> -- you add that to your <code>PATH</code>."}], "tags": [], "owner": {"reputation": 2158, "user_id": 1312265, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2ffeafb08435f0369ea545b3f381e7ea?s=128&d=identicon&r=PG", "display_name": "Code_Yoga", "link": "https://stackoverflow.com/users/1312265/code-yoga"}, "is_accepted": false, "score": 0, "last_activity_date": 1520803317, "creation_date": 1520803317, "answer_id": 49225234, "question_id": 49224055, "link": "https://stackoverflow.com/questions/49224055/godep-is-not-recognized-as-an-internal-or-external-command/49225234#49225234", "title": "&#39;GoDep&#39; is not recognized as an internal or external command", "body": "<p>Setting the GOBIN value in the environment variables fixed the issue.</p>\n\n<p><a href=\"https://i.stack.imgur.com/LSQbb.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/LSQbb.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 2158, "user_id": 1312265, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2ffeafb08435f0369ea545b3f381e7ea?s=128&d=identicon&r=PG", "display_name": "Code_Yoga", "link": "https://stackoverflow.com/users/1312265/code-yoga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1473, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1520803317, "creation_date": 1520795929, "question_id": 49224055, "link": "https://stackoverflow.com/questions/49224055/godep-is-not-recognized-as-an-internal-or-external-command", "title": "&#39;GoDep&#39; is not recognized as an internal or external command", "body": "<p>I am trying to deploy my Go App on heroku, for which I am using Godep as build pack. After installing godep using the command </p>\n\n<pre><code>go get github.com/tools/godep\n</code></pre>\n\n<p>when I try to run </p>\n\n<pre><code>godep save\n</code></pre>\n\n<p>I am getting the error which states that 'godep' is not recognised as an internal or external command.</p>\n\n<p>Below is my env variables.</p>\n\n<p><a href=\"https://i.stack.imgur.com/z5nfT.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/z5nfT.png\" alt=\"enter image description here\"></a></p>\n\n<p>Can someone please point out where I am going wrong ?</p>\n"}, {"tags": ["mongodb", "go", "mongodb-query", "aggregation-framework", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 1245, "user_id": 975478, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/057a2e4b28f0ee27db450f0dece3fa6a?s=128&d=identicon&r=PG", "display_name": "xXPhenom22Xx", "link": "https://stackoverflow.com/users/975478/xxphenom22xx"}, "edited": false, "score": 0, "creation_date": 1520798268, "post_id": 49224361, "comment_id": 85452436, "body": "Unrecognized pipeline stage name: &#39;date_timestamp&#39;"}], "tags": [], "owner": {"reputation": 63390, "user_id": 2683814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/16a4c2fb341c51388d5cdfcf0e956f6c?s=128&d=identicon&r=PG&f=1", "display_name": "s7vr", "link": "https://stackoverflow.com/users/2683814/s7vr"}, "is_accepted": true, "score": 0, "last_activity_date": 1520798501, "last_edit_date": 1520798501, "creation_date": 1520797677, "answer_id": 49224361, "question_id": 49223031, "link": "https://stackoverflow.com/questions/49223031/golang-mgo-group-by-multiple-params-and-grab-last-by-datetime/49224361#49224361", "title": "Golang MGO Group By multiple params and grab last by datetime", "body": "<p>Try below aggregation.</p>\n\n<p>Add <code>$sort</code> before <code>$group</code>.</p>\n\n<pre><code>sort := bson.M{\n    \"$sort\": bson.M{\n    \"date_timestamp\": -1\n  }\n}\n\ngroup := bson.M{\n  {\"$group\": bson.M{\n     \"_id\": \"$serial\", \n     \"stage\": bson.M{\"$last\":\"$stage\"}, \n     \"order\": bson.M{\"$last\":\"$order\"}, \n     \"datetime\": bson:M{\"$last\":\"$date_timestamp\"}\n  }}\n}\n\npipeline:= []bson.M{sort, group}\n</code></pre>\n"}], "owner": {"reputation": 1245, "user_id": 975478, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/057a2e4b28f0ee27db450f0dece3fa6a?s=128&d=identicon&r=PG", "display_name": "xXPhenom22Xx", "link": "https://stackoverflow.com/users/975478/xxphenom22xx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 670, "favorite_count": 0, "accepted_answer_id": 49224361, "answer_count": 1, "score": 0, "last_activity_date": 1520798501, "creation_date": 1520789735, "last_edit_date": 1520798174, "question_id": 49223031, "link": "https://stackoverflow.com/questions/49223031/golang-mgo-group-by-multiple-params-and-grab-last-by-datetime", "title": "Golang MGO Group By multiple params and grab last by datetime", "body": "<p>I am using Golang and the MGO library</p>\n\n<p>I have some test records where I want to GROUP BY the serial number, stage, stage order and grab the last record by the datetime field. Most instances there is 1 record that per serial/stage/stage order but there can also be instances where there are multiple tests and I would like to grab the last test completed, not all of them for that combination.</p>\n\n<p>So, in short, there are records in my table that will have the same serial, stage, and stage order but different timestamps, I want to grab the last or only record for the entire data set so that I have a single record for every (serial, stage, stage order) combination and if there were duplicate tests I always grab the last record in that group.</p>\n\n<p><a href=\"https://i.stack.imgur.com/dVPbA.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/dVPbA.png\" alt=\"enter image description here\"></a></p>\n\n<p>With the above example I ONLY want to get the 2nd record back for that serial.</p>\n\n<p>My Code:\nI was trying to create a pipeline but can't seem to get it setup correctly:</p>\n\n<pre><code>pipeline := []bson.M{\n    bson.M{\n        \"$match\": bson.M{\"workorder\": i},\n    },\n    bson.M{\n        \"$group\": bson.M{\n            \"_id\": \"id\",\n            \"serial\": bson.M{\"$match\": \"$serial\"},\n            \"stage\": bson.M{\"$match\": \"$stage\"},\n            \"order\": bson.M{\"$match\": \"$order\"},\n            \"date\": bson.M{\"$last\": \"$date_timestamp\"},\n            },\n    },\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 0, "last_activity_date": 1520789359, "creation_date": 1520789359, "answer_id": 49222968, "question_id": 49222253, "link": "https://stackoverflow.com/questions/49222253/go-syscall-library-code-explanation/49222968#49222968", "title": "Go syscall library code explanation", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a> </p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Function_declarations\" rel=\"nofollow noreferrer\">Function declarations</a></p>\n  \n  <p>A function declaration may omit the body. Such a declaration provides\n  the signature for a function implemented outside Go, such as an\n  assembly routine.</p>\n</blockquote>\n\n<hr>\n\n<p>Read the documentation.</p>\n"}], "owner": {"reputation": 1224, "user_id": 3572717, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/JAVac.jpg?s=128&g=1", "display_name": "Yoaz Menda", "link": "https://stackoverflow.com/users/3572717/yoaz-menda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 1, "closed_date": 1520881529, "accepted_answer_id": 49222968, "answer_count": 1, "score": -2, "last_activity_date": 1520789598, "creation_date": 1520785527, "last_edit_date": 1520789598, "question_id": 49222253, "link": "https://stackoverflow.com/questions/49222253/go-syscall-library-code-explanation", "closed_reason": "Duplicate", "title": "Go syscall library code explanation", "body": "<p>Can anyone explain the following piece of code from the syscall package in the Go standard library?</p>\n\n<pre><code>// /usr/local/Cellar/go/1.10/libexec/src/syscall/syscall.go\n//\n//\n// Getpagesize and Exit are provided by the runtime    \nfunc Getpagesize() int\nfunc Exit(code int)\n</code></pre>\n\n<p>There is no function body and also it is not an interface. What is it then?</p>\n"}, {"tags": ["go", "websocket"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1520788489, "post_id": 49221790, "comment_id": 85449055, "body": "Sounds like you can simply make this a local variable in the websocket handler."}, {"owner": {"reputation": 405, "user_id": 1644017, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/739e6984f9073f1bacbdba4646dbbbcd?s=128&d=identicon&r=PG", "display_name": "Azamat", "link": "https://stackoverflow.com/users/1644017/azamat"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1520826548, "post_id": 49221790, "comment_id": 85459278, "body": "@CeriseLim&#243;n I need cookies to restore session, in case when user re-initiates websocket connection."}, {"owner": {"reputation": 405, "user_id": 1644017, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/739e6984f9073f1bacbdba4646dbbbcd?s=128&d=identicon&r=PG", "display_name": "Azamat", "link": "https://stackoverflow.com/users/1644017/azamat"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1520826661, "post_id": 49221790, "comment_id": 85459296, "body": "@Peter but how can I make variable <i>per request</i>?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1520828417, "post_id": 49221790, "comment_id": 85459711, "body": "@Azamat A websocket application typically upgrades an HTTP request to the WebSocket protocol and then runs a loop reading and processing messages.  If you want to store state for the duration of the connection, then declare a variable outside of the loop.  If you want to store state for the duration of processing a message, then declare a variable inside the loop.  Please show the code you have so far."}], "answers": [{"tags": [], "owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "is_accepted": false, "score": 0, "last_activity_date": 1521474819, "creation_date": 1521474819, "answer_id": 49367196, "question_id": 49221790, "link": "https://stackoverflow.com/questions/49221790/getting-websocket-session/49367196#49367196", "title": "Getting websocket session", "body": "<p>you could do something like this</p>\n\n<pre><code>// initialize an empty map\nvar Clients = make(map[*websocket.Conn]bool)\n</code></pre>\n\n<p>and then add the connection or token to the map like this</p>\n\n<pre><code>// upgrade connection to websocket and add it to the map\nconn, err := upgrader.Upgrade(w, r, nil)\nif err != nil {\n    fmt.Println(err)\n    return\n}\nClients[conn] = true\n</code></pre>\n"}], "owner": {"reputation": 405, "user_id": 1644017, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/739e6984f9073f1bacbdba4646dbbbcd?s=128&d=identicon&r=PG", "display_name": "Azamat", "link": "https://stackoverflow.com/users/1644017/azamat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 252, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1521474819, "creation_date": 1520782780, "last_edit_date": 1520827030, "question_id": 49221790, "link": "https://stackoverflow.com/questions/49221790/getting-websocket-session", "title": "Getting websocket session", "body": "<p>My idea is as follows. </p>\n\n<p>When connection from client-side (browser) is requested, server generates random <strong>token</strong> on websocket upgrade request and sends it via HTTP Set-Cookie header. Then, client authenticates via Challenge-Response authentication over websocket connection. On successful auth, server saves previously generated <strong>token</strong> in database for user. <strong>token</strong> cookie is needed to restore session, when user re-initiates websocket connection.</p>\n\n<p>My question is, how can I temporarily store <strong>token</strong> on memory per connection (per user), so that I can access it later and save in database for that user? (sort of \"request context\").</p>\n"}, {"tags": ["go", "go-cobra", "cobra"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1520794806, "post_id": 49221325, "comment_id": 85451186, "body": "Name&#39;s value is obviously &quot;sample_&quot;. Are you asking how to read a package variable?"}], "answers": [{"tags": [], "owner": {"reputation": 346, "user_id": 9490568, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ljyk.jpg?s=128&g=1", "display_name": "bharath", "link": "https://stackoverflow.com/users/9490568/bharath"}, "is_accepted": true, "score": 2, "last_activity_date": 1521027199, "creation_date": 1521027199, "answer_id": 49276716, "question_id": 49221325, "link": "https://stackoverflow.com/questions/49221325/how-to-extract-registered-information/49276716#49276716", "title": "How to extract registered information?", "body": "<p>You can use the value stored in the <code>Name</code> variable for performing operations within your program. An example usage of cobra is:</p>\n\n<pre><code>var Name = \"sample_\"\n\nvar rootCmd = &amp;cobra.Command{\n    Use:   \"hello\",\n    Short: \"Example short description\",\n    Run:   func(cmd *cobra.Command, args []string) {\n        // Do Stuff Here\n    },\n}\n\nvar echoCmd = &amp;cobra.Command{\n    Use:   \"echo\",\n    Short: \"Echo description\",\n    Run:   func(cmd *cobra.Command, args []string) {\n        fmt.Printf(\"hello %s\", Name)\n    },\n}\n\nfunc init() {\n    rootCmd.AddCommand(echoCmd)\n}\n\nfunc Execute() {\n    if err := rootCmd.Execute(); err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n}\n</code></pre>\n\n<p>`</p>\n\n<p>In the above code, you can see that <code>hello</code> is the root command and <code>echo</code> is a sub command. If you do <code>hello echo</code>, it'll echo the value <code>sample_</code> which is stored in the <code>Name</code> variable.</p>\n\n<p>You can also do something like this:</p>\n\n<pre><code>var echoCmd = &amp;cobra.Command{\n    Use:   \"echo\",\n    Short: \"Echo description\",\n    Run:   func(cmd *cobra.Command, args []string) {\n        // Perform some logical operations\n        if Name == \"sample_\" {\n            fmt.Printf(\"hello %s\", Name)\n        } else {\n            fmt.Println(\"Name did not match\")\n        }\n    },\n}\n</code></pre>\n\n<p>For knowing more about how to use cobra, you can also view my project from the below link.</p>\n\n<p><a href=\"https://github.com/bharath-srinivas/nephele\" rel=\"nofollow noreferrer\">https://github.com/bharath-srinivas/nephele</a></p>\n\n<p>Hope this helps.</p>\n"}], "owner": {"reputation": 69, "user_id": 5981590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cce6ff2e2b80392134e9b686af851bee?s=128&d=identicon&r=PG&f=1", "display_name": "bharat nc", "link": "https://stackoverflow.com/users/5981590/bharat-nc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 49276716, "answer_count": 1, "score": 0, "last_activity_date": 1521027199, "creation_date": 1520779931, "last_edit_date": 1520792519, "question_id": 49221325, "link": "https://stackoverflow.com/questions/49221325/how-to-extract-registered-information", "title": "How to extract registered information?", "body": "<p>I'm using cobra with my Golang application. How can I get the list of commands and values that I have registered with Cobra.</p>\n\n<p>If I add a root command and then a DisplayName command.</p>\n\n<pre><code>var Name = \"sample_\"\nvar rootCmd = &amp;cobra.Command{Use: \"Use help to find out more options\"}\nrootCmd.AddCommand(cmd.DisplayNameCommand(Name))\n</code></pre>\n\n<p>Will I be able to know what is the value in Name from within my program by using some Cobra function? Ideally I want to access this value in Name and use it for checking some logic.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 4, "creation_date": 1520775095, "post_id": 49220450, "comment_id": 85444609, "body": "Seems you are looking for <a href=\"https://golang.org/pkg/testing/#hdr-Benchmarks\" rel=\"nofollow noreferrer\">benchmarks</a>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1520776959, "post_id": 49220450, "comment_id": 85445138, "body": "See related / possible duplicate of <a href=\"https://stackoverflow.com/questions/41608578/order-of-the-code-and-performance/41608707#41608707\">Order of the code and performance</a>."}], "answers": [{"tags": [], "owner": {"reputation": 70, "user_id": 5398479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92f5f989c43330053a90166dd9020c0b?s=128&d=identicon&r=PG&f=1", "display_name": "A.Bau", "link": "https://stackoverflow.com/users/5398479/a-bau"}, "is_accepted": false, "score": 4, "last_activity_date": 1520775133, "creation_date": 1520775133, "answer_id": 49220537, "question_id": 49220450, "link": "https://stackoverflow.com/questions/49220450/how-to-test-go-function-execution-time-using-standard-lib/49220537#49220537", "title": "How to test Go function execution time using standard lib", "body": "<p>You can use testing </p>\n\n<pre><code>func BenchmarkFoo(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        Foo()\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 78, "user_id": 2790407, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf35247b7ced6e3b77ab9ba1e6509644?s=128&d=identicon&r=PG", "display_name": "zitryss", "link": "https://stackoverflow.com/users/2790407/zitryss"}, "is_accepted": false, "score": 0, "last_activity_date": 1520775487, "creation_date": 1520775487, "answer_id": 49220598, "question_id": 49220450, "link": "https://stackoverflow.com/questions/49220450/how-to-test-go-function-execution-time-using-standard-lib/49220598#49220598", "title": "How to test Go function execution time using standard lib", "body": "<p>You may use the \"benchmark\"-approach:</p>\n\n<ol>\n<li><p>Name the file %SOMETHING%_test.go</p></li>\n<li><p>Write tests, benchmarks, examples in it as follows:</p>\n\n<pre><code>package main\n\nimport (\n    \"testing\"\n)\n\nfunc fn() {\n    nums := []int{1, 2, 3, 4, 5, 6, 7, 8, 9, 10}\n    var m []int\n    for n := range nums {\n        if n%2 == 0 {\n            m = append(m, n)\n        }\n    }\n}\n\nfunc BenchmarkFunc(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        fn()\n    }\n}\n</code></pre></li>\n<li><p>Open the terminal and execute the following command:</p>\n\n<pre><code>go test -bench .\n</code></pre></li>\n<li><p>You will see the output like this:</p>\n\n<pre><code>goos: darwin\ngoarch: amd64\nBenchmarkFunc-2      5000000           360 ns/op         120 B/op          4 allocs/op\nPASS\nok      command-line-arguments  2.190s\n</code></pre></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 6, "last_activity_date": 1520812152, "last_edit_date": 1520812152, "creation_date": 1520775646, "answer_id": 49220622, "question_id": 49220450, "link": "https://stackoverflow.com/questions/49220450/how-to-test-go-function-execution-time-using-standard-lib/49220622#49220622", "title": "How to test Go function execution time using standard lib", "body": "<p>Use the Go <a href=\"https://golang.org/pkg/testing/\" rel=\"nofollow noreferrer\"><code>testing</code></a> package. For example,</p>\n\n<p><code>main.go</code>:</p>\n\n<pre><code>package main\n\nfunc doStuff() {\n    nums := []int{1, 2, 3, 4, 5, 6, 7, 8, 9, 10}\n    var m []int\n    for n := range nums {\n        if n%2 == 0 {\n            m = append(m, n)\n        }\n    }\n}\n\nfunc main() {\n    doStuff()\n}\n</code></pre>\n\n<p><code>main_test.go</code>:</p>\n\n<pre><code>package main\n\nimport \"testing\"\n\nfunc BenchmarkStuff(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        doStuff()\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go test -bench=. -benchmem\ngoos: linux\ngoarch: amd64\npkg: main\nBenchmarkStuff-4    5000000    276 ns/op    120 B/op    4 allocs/op\n</code></pre>\n\n<hr>\n\n<p>Using the information from the benchmark, you can improve performance. Reduce the number and size of allocations by using an estimate to initialize slice <code>m</code>. </p>\n\n<pre><code>func doStuff() {\n    nums := []int{1, 2, 3, 4, 5, 6, 7, 8, 9, 10}\n    m := make([]int, 0, len(nums)/2+1)\n    for n := range nums {\n        if n%2 == 0 {\n            m = append(m, n)\n        }\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go test -bench=. -benchmem\ngoos: linux\ngoarch: amd64\npkg: main\nBenchmarkStuff-4    20000000    83.1 ns/op    48 B/op    1 allocs/op\n</code></pre>\n"}], "owner": {"reputation": 7629, "user_id": 2335820, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/sLTHB.jpg?s=128&g=1", "display_name": "Kimmo Hintikka", "link": "https://stackoverflow.com/users/2335820/kimmo-hintikka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 848, "favorite_count": 2, "accepted_answer_id": 49220622, "answer_count": 3, "score": 5, "last_activity_date": 1520812152, "creation_date": 1520774535, "question_id": 49220450, "link": "https://stackoverflow.com/questions/49220450/how-to-test-go-function-execution-time-using-standard-lib", "title": "How to test Go function execution time using standard lib", "body": "<p>I've written the following function that when used with <code>Defer</code> will surely do the trick but is there something in standard library I could use for this? I'm looking something similar to Python <code>timeit</code> which I could use directly from the shell?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    defer timeTrack(time.Now(), \"looptest\")\n    nums := []int{1, 2, 3, 4, 5, 6, 7, 8, 9, 10}\n    var m []int\n    for n := range nums {\n        if n%2 == 0 {\n            m = append(m, n)\n        }\n    }\n}\n\nfunc timeTrack(start time.Time, name string) {\n    elapsed := time.Since(start)\n    fmt.Printf(\"%s took %s\", name, elapsed)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 3, "creation_date": 1520738096, "post_id": 49216260, "comment_id": 85436581, "body": "<a href=\"https://softwareengineering.stackexchange.com/questions/193821/are-there-any-problems-with-implementing-custom-http-methods\" title=\"are there any problems with implementing custom http methods\">softwareengineering.stackexchange.com/questions/193821/&hellip;</a>"}, {"owner": {"reputation": 22380, "user_id": 284111, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7540f1aac4d78cc963f6551e8307b757?s=128&d=identicon&r=PG", "display_name": "Andrew Savinykh", "link": "https://stackoverflow.com/users/284111/andrew-savinykh"}, "edited": false, "score": 0, "creation_date": 1616739059, "post_id": 49216260, "comment_id": 118102049, "body": "Also a comment on wording: go does not have exceptions as such so it never &quot;throws&quot; it either &quot;returns an error&quot; or &quot;panics&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "is_accepted": true, "score": 6, "last_activity_date": 1520786234, "last_edit_date": 1520786234, "creation_date": 1520751731, "answer_id": 49217525, "question_id": 49216260, "link": "https://stackoverflow.com/questions/49216260/http-newrequest-doesnt-throw-error-when-request-method-is-invalid/49217525#49217525", "title": "http.NewRequest() doesn&#39;t throw error when request method is invalid", "body": "<p><strong><em>bad</em></strong> is not considered as a bad http method. </p>\n\n<p>Any string of non zero length having characters from <strong>!#$%&amp;*+-.0123456789ABCDEFGHIJKLMNOPQRSTUWVXYZ^_`abcdefghijklmnopqrstuvwxyz|~</strong> is considered valid</p>\n\n<p>Following is the function used to validate a method </p>\n\n<pre><code>func validMethod(method string) bool {\n\n    /*\n\n         Method         = \"OPTIONS\"                ; Section 9.2\n\n                        | \"GET\"                    ; Section 9.3\n\n                        | \"HEAD\"                   ; Section 9.4\n\n                        | \"POST\"                   ; Section 9.5\n\n                        | \"PUT\"                    ; Section 9.6\n\n                        | \"DELETE\"                 ; Section 9.7\n\n                        | \"TRACE\"                  ; Section 9.8\n\n                        | \"CONNECT\"                ; Section 9.9\n\n                        | extension-method\n\n       extension-method = token\n\n         token          = 1*&lt;any CHAR except CTLs or separators&gt;\n\n    */\n\n    return len(method) &gt; 0 &amp;&amp; strings.IndexFunc(method, isNotToken) == -1\n\n}\n</code></pre>\n"}], "owner": {"reputation": 547, "user_id": 4036946, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wMtQe.gif?s=128&g=1", "display_name": "jsxqf", "link": "https://stackoverflow.com/users/4036946/jsxqf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 905, "favorite_count": 0, "accepted_answer_id": 49217525, "answer_count": 1, "score": 0, "last_activity_date": 1520786234, "creation_date": 1520737901, "question_id": 49216260, "link": "https://stackoverflow.com/questions/49216260/http-newrequest-doesnt-throw-error-when-request-method-is-invalid", "title": "http.NewRequest() doesn&#39;t throw error when request method is invalid", "body": "<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    // invalid method called \"bad\"\n    req, err := http.NewRequest(\"bad\", \"https://www.google.com\", nil)\n    if err != nil {\n        log.Printf(\"E! got err: %v\", err)\n    } else {\n        log.Printf(\"I! request method: %s\", req.Method)\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/NM8_4pkN5uM\" rel=\"nofollow noreferrer\">https://play.golang.org/p/NM8_4pkN5uM</a></p>\n\n<p>err is nil here, can someone explain?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "heroku"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520722398, "post_id": 49214569, "comment_id": 85434012, "body": "Please provide what dependency/vendor manager you&#39;re using and also the first couple lines of its corresponding vendor file. (<code>Godep.json</code>, <code>vendor.json</code>, etc.)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1520749122, "post_id": 49214569, "comment_id": 85438453, "body": "Take a look at their <code>ImportPath</code> and yours, that might be the problem <a href=\"https://devcenter.heroku.com/articles/deploying-go#manage-dependencies\" rel=\"nofollow noreferrer\">devcenter.heroku.com/articles/deploying-go#manage-dependenci&zwnj;&#8203;es</a>. That is <code>&quot;ImportPath&quot;: &quot;myproject&quot;,</code> makes sense only if your project lives in the <code>src</code> folder, if it&#39;s not use <code>&quot;ImportPath&quot;: &quot;github.com&#47;username&#47;myproject&quot;,</code> instead."}, {"owner": {"reputation": 1, "user_id": 1997663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a3822e07fcc8f9f59eb81ef2329548?s=128&d=identicon&r=PG", "display_name": "atmiguel", "link": "https://stackoverflow.com/users/1997663/atmiguel"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520786791, "post_id": 49214569, "comment_id": 85448430, "body": "Thank you @mkopriva! That fixed it. I was getting my Godep.json file from a collaborator who had set up their file structure incorrectly. Running <code>godep save</code> fixed the <code>ImportPath</code> automatically."}], "owner": {"reputation": 1, "user_id": 1997663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a3822e07fcc8f9f59eb81ef2329548?s=128&d=identicon&r=PG", "display_name": "atmiguel", "link": "https://stackoverflow.com/users/1997663/atmiguel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 369, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1520727707, "creation_date": 1520720144, "last_edit_date": 1520727707, "question_id": 49214569, "link": "https://stackoverflow.com/questions/49214569/how-do-i-correctly-import-local-packages-in-golang-and-have-it-still-work-with", "title": "How do I correctly import local packages in golang, and have it still work with heroku?", "body": "<p>I have an issue with importing a local package in my go project. It seems that while I'm working locally I have to import with the full path: \"github.com/username/myproject/mypackage\". But when I push to heroku I get an error about not being able to find that package. If I change the import to \"myproject/mypackage\", it works on heroku, but no longer works locally.</p>\n\n<p>The two solutions I've seen while researching seem like workarounds:</p>\n\n<ol>\n<li>Put my local packages into <code>vendor/</code>. My understanding is that the vendor directory is intended for third party libraries, so I'd rather not misuse that.</li>\n<li>Move <code>myproject/</code> to be directly in <code>src/</code>. All the golang resources seem to stress that the file structure is very important and that I should have a github.com folder. I'm not clear on why the file structure is important, so this is the solution I'm going with right now, but I can't help but think I'm doing something wrong.</li>\n</ol>\n\n<p>Has anyone else encountered this issue? I've included my file structure, .go files, and Godeps.json below for clarity.</p>\n\n<p>My file structure:</p>\n\n<pre><code>$GOPATH\n\u2514\u2500\u2500\u2500bin\n\u2514\u2500\u2500\u2500pkg\n\u2514\u2500\u2500\u2500src\n    \u2514\u2500\u2500\u2500github.com\n        \u2514\u2500\u2500\u2500username\n            \u2514\u2500\u2500\u2500myproject\n                \u2502   main.go\n                \u2514\u2500\u2500\u2500Godeps\n                \u2502   \u2502   Godeps.json\n                \u2514\u2500\u2500\u2500mypackage\n                    \u2502   mypackage.go\n</code></pre>\n\n<p>mypackage.go</p>\n\n<pre><code>package mypackage\n\nimport (\n    \"fmt\"\n)\n\nfunc PrintHelloWorld() {\n    fmt.Println(\"Hello, world!\")\n}\n</code></pre>\n\n<p>main.go:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/username/myproject/mypackage\" // import causing problems in heroku\n    \"log\"\n    \"net/http\"\n    \"log\"\n)\n\nfunc sayHelloWorld(w http.ResponseWriter, r *http.Request) {\n    mypackage.PrintHelloWorld()\n    fmt.Fprintf(w, \"Hello world!\")\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", sayHelloWorld)\n\n    err := http.ListenAndServe(\":9090\", nil)\n    if err != nil {\n        log.Fatal(\"ListenAndServe: \", err)\n    }\n}\n</code></pre>\n\n<p>Godeps.json:</p>\n\n<pre><code>{\n    \"ImportPath\": \"myproject\",\n    \"GoVersion\": \"go1.10\",\n    \"GodepVersion\": \"v80\",\n    \"Deps\": []\n}\n</code></pre>\n\n<p>Error when pushing to heroku:</p>\n\n<pre><code>-----&gt; Go app detected\n-----&gt; Checking Godeps/Godeps.json file.\n-----&gt; Using go1.10\n !!    Installing package '.' (default)\n !!\n-----&gt; Running: go install -v -tags heroku .\nmain.go:6:2: cannot find package \"github.com/username/myproject/mypackage\" in any of:\n    /tmp/tmp.xY81RbKUze/.go/src/myproject/vendor/github.com/username/myproject/mypackage (vendor tree)\n    /app/tmp/cache/go1.10/go/src/github.com/username/myproject/mypackage (from $GOROOT)\n    /tmp/tmp.xY81RbKUze/.go/src/github.com/username/myproject/mypackage (from $GOPATH)\n !     Push rejected, failed to compile Go app.\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1520723124, "post_id": 49214456, "comment_id": 85434165, "body": "Just a guess but the only <code>map[string]interface{}</code> you have defined is the type of the <code>Error</code> field. The error message would then mean that the json you got back contains an <code>&quot;error&quot;</code> key whose value is not a json object but a string. Looking at the <code>JSONRpcResp</code> it seems that the <code>&quot;error&quot;</code> key is a sibling to the <code>&quot;result&quot;</code> key, so without showing us the json data of which the <code>&quot;result&quot;</code> is a child, I cannot know for sure."}, {"owner": {"reputation": 45, "user_id": 9473379, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Adroitful", "link": "https://stackoverflow.com/users/9473379/adroitful"}, "edited": false, "score": 0, "creation_date": 1520725499, "post_id": 49214456, "comment_id": 85434576, "body": "The result should come from the JSON data I posted right? Here it is again:&quot;result&quot;: {     &quot;bits&quot;: &quot;7326472509313&quot;,     &quot;hash&quot;: &quot;060d0f6157d08bb294ad30f97a2c15c821ff46236281f118d65576b9e4a&zwnj;&#8203;0ba27&quot;,     &quot;merkle_tree_hash&quot;: &quot;36936f36718e134e1eecaef05e66ebc4079811d8ee5a543f36d370335ad&zwnj;&#8203;c0801&quot;,     &quot;nonce&quot;: &quot;0&quot;,     &quot;previous_block_hash&quot;: &quot;10f4da59558fe41bab50a15864d1394462cd90836aecf52524f4cbce02a&zwnj;&#8203;74a27&quot;,     &quot;time_stamp&quot;: &quot;1520718416&quot;,     &quot;version&quot;: &quot;1&quot;,     &quot;mixhash&quot;: &quot;0&quot;,     &quot;number&quot;: &quot;1011160&quot;,     &quot;transaction_count&quot;: &quot;1&quot; }&#39;"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1520725987, "post_id": 49214456, "comment_id": 85434666, "body": "@Adroitful are you certain that the error is not returned from <code>rpcResp, err := r.doPost</code>? But that it comes from <code>err = json.Unmarshal(*rpcResp.Result, &amp;reply)</code>?"}, {"owner": {"reputation": 45, "user_id": 9473379, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Adroitful", "link": "https://stackoverflow.com/users/9473379/adroitful"}, "edited": false, "score": 0, "creation_date": 1520730431, "post_id": 49214456, "comment_id": 85435395, "body": "Well, the error says it&#39;s problem trying to unmarshal a map to string. So I assume it&#39;s coming from the json.Unmarshal . I&#39;m pretty new to this language and it&#39;s giving me nothing but a headache. Probably just going to give up on this project lol"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520748728, "post_id": 49214456, "comment_id": 85438396, "body": "So you&#39;re saying that <code>doPost</code> does not call <code>json.Unmarshal</code>? Can you put a log statement before each of those two return statements? Or try this, comment out the Error field from JSONRpcResp."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1520756886, "post_id": 49214456, "comment_id": 85439994, "body": "@mkopriva, the OP clearly indicated they actively do not want to be helped. So why bother. &quot;lol&quot;."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1520758413, "post_id": 49214456, "comment_id": 85440334, "body": "@kostix unfortunately sometimes I have nothing better to do, and also given the fact that they posted this question in the first place there seems to be at least some attempt, small though it may be, to resolve their issue."}, {"owner": {"reputation": 63, "user_id": 1731143, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0881762e851631dafde4097ea51bcfd9?s=128&d=identicon&r=PG", "display_name": "KimB", "link": "https://stackoverflow.com/users/1731143/kimb"}, "edited": false, "score": 0, "creation_date": 1611916550, "post_id": 49214456, "comment_id": 116609308, "body": "Could you share the filebeat.yml configuration file ?"}], "owner": {"reputation": 45, "user_id": 9473379, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Adroitful", "link": "https://stackoverflow.com/users/9473379/adroitful"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 8474, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1520721303, "creation_date": 1520719301, "last_edit_date": 1520721303, "question_id": 49214456, "link": "https://stackoverflow.com/questions/49214456/json-cannot-unmarshal-string-into-go-value-of-type-mapstringinterface", "title": "json: cannot unmarshal string into Go value of type map[string]interface {}", "body": "<p>I have been working on converting some crypto pool software over to work with an incompatible coin. I believe I have it all about done. But this error keeps popping up and I just can't seem to figure out what the problem is. Here is my code:</p>\n\n<pre><code>type GetBalanceReply struct {\n    Unspent string `json:\"unspent\"`\n}\n\ntype SendTransactionReply struct {\n    Hash string `json:\"hash\"`\n}\n\ntype RPCClient struct {\n    sync.RWMutex\n    Url         string\n    Name        string\n    Account     string\n    Password    string\n    sick        bool\n    sickRate    int\n    successRate int\n    client      *http.Client\n}\n\n\ntype GetBlockReply struct {\n    Difficulty       string `json:\"bits\"`\n    Hash             string `json:\"hash\"`\n    MerkleTreeHash   string `json:\"merkle_tree_hash\"`\n    Nonce            string `json:\"nonce\"`\n    PrevHash         string `json:\"previous_block_hash\"`\n    TimeStamp        string `json:\"time_stamp\"`\n    Version          string `json:\"version\"`\n    Mixhash          string `json:\"mixhash\"`\n    Number           string `json:\"number\"`\n    TransactionCount string `json:\"transaction_count\"`\n}\n\ntype GetBlockReplyPart struct {\n    Number     string `json:\"number\"`\n    Difficulty string `json:\"bits\"`\n}\n\ntype TxReceipt struct {\n    TxHash string `json:\"hash\"`\n}\n\n\ntype Tx struct {\n    Gas      string `json:\"gas\"`\n    GasPrice string `json:\"gasPrice\"`\n    Hash     string `json:\"hash\"`\n}\n\ntype JSONRpcResp struct {\n    Id          *json.RawMessage       `json:\"id\"`\n    Result      *json.RawMessage       `json:\"result\"`\n    Balance     *json.RawMessage       `json:\"balance\"`\n    Transaction *json.RawMessage       `json:\"transaction\"`\n    Error  map[string]interface{} `json:\"error\"`\n}\n\n\nfunc (r *RPCClient) GetPendingBlock() (*GetBlockReplyPart, error) {\n    rpcResp, err := r.doPost(r.Url, \"fetchheaderext\", []interface{}{r.Account, r.Password, \"pending\"})\n    if err != nil {\n        return nil, err\n    }\n    if rpcResp.Result != nil {\n        var reply *GetBlockReplyPart\n        err = json.Unmarshal(*rpcResp.Result, &amp;reply)\n        return reply, err\n    }\n    return nil, nil\n}\n\nfunc (r *RPCClient) GetBlockByHeight(height int64) (*GetBlockReply, error) {\n    //params := []interface{}{fmt.Sprintf(\"0x%x\", height), true}\n    params := []interface{}{\"-t\", height}\n    return r.getBlockBy(\"fetch-header\", params)\n}\n</code></pre>\n\n<p>Whenever I run that manually in the wallet it displays:</p>\n\n<pre><code>\"result\": {\n    \"bits\": \"7326472509313\",\n    \"hash\": \"060d0f6157d08bb294ad30f97a2c15c821ff46236281f118d65576b9e4a0ba27\",\n    \"merkle_tree_hash\": \"36936f36718e134e1eecaef05e66ebc4079811d8ee5a543f36d370335adc0801\",\n    \"nonce\": \"0\",\n    \"previous_block_hash\": \"10f4da59558fe41bab50a15864d1394462cd90836aecf52524f4cbce02a74a27\",\n    \"time_stamp\": \"1520718416\",\n    \"version\": \"1\",\n    \"mixhash\": \"0\",\n    \"number\": \"1011160\",\n    \"transaction_count\": \"1\"\n}'\n</code></pre>\n\n<p>But, the code errors out with \"json: cannot unmarshal string into Go value of type map[string]interface {}\"</p>\n\n<p>Can anyone help me figure this one out? I've been hours on trying to figure it out on my own.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1520865485, "post_id": 49214590, "comment_id": 85479020, "body": "Be careful, this does NOT Lock access! This establishes a lock for as long as it takes to get a pointer, then unlocks and returns the pointer, allowing the caller to make concurrent accesses, including writes, of the data, without any locking."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1520867184, "post_id": 49214590, "comment_id": 85480236, "body": "Yes, the function has to cooperate and only access the data while the function is executing and not save the pointer. But as long as the function you pass behaves correctly, it does what the OP was asking for."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1520867853, "post_id": 49214590, "comment_id": 85480717, "body": "It doesn&#39;t matter if it saves the pointer. It could call <code>AccessMetaData().Size</code> and the read of <code>Size</code> would execute outside the mutex lock in <code>AccessMetaData</code>."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1520868409, "post_id": 49214590, "comment_id": 85481107, "body": "<code>AccessMetaData</code> doesn&#39;t return anything."}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 3, "last_activity_date": 1520863685, "last_edit_date": 1520863685, "creation_date": 1520720353, "answer_id": 49214590, "question_id": 49214205, "link": "https://stackoverflow.com/questions/49214205/how-to-lock-concurrent-access-to-all-struct-fields-internally/49214590#49214590", "title": "How to lock concurrent access to all struct fields internally?", "body": "<p>How about something like this?</p>\n\n<pre><code>type Data struct {\n    ID   string\n    Size int\n    //... and more fields\n}\n\ntype Project struct {\n    mu       sync.Mutex\n    metaData Data\n    //... and more fields\n}\n\nfunc (p *Project) AccessMetaData(f func(*Data)) {\n    p.mu.Lock()\n    defer p.mu.Unlock()\n    f(&amp;p.metaData)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3996, "user_id": 1615594, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/VD0n3.jpg?s=128&g=1", "display_name": "tsuz", "link": "https://stackoverflow.com/users/1615594/tsuz"}, "is_accepted": false, "score": 0, "last_activity_date": 1542955692, "creation_date": 1542955692, "answer_id": 53441846, "question_id": 49214205, "link": "https://stackoverflow.com/questions/49214205/how-to-lock-concurrent-access-to-all-struct-fields-internally/53441846#53441846", "title": "How to lock concurrent access to all struct fields internally?", "body": "<p>I was curious about this so I tested this, and if the parent struct is locked, the child struct is also locked. Try it locally as go playground seems to be deterministic.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype testGroup struct {\n    sync.Mutex\n    items map[string]*test\n}\n\ntype test struct {\n    x int\n}\n\nvar str string = \"test\"\n\nfunc increment(t *testGroup, wg *sync.WaitGroup) {\n    t.Lock()\n    t.items[str].x = t.items[str].x + 1\n    t.Unlock()\n    wg.Done()\n}\n\nfunc main() {\n    var w sync.WaitGroup\n    tg := testGroup{}\n    tg.items = make(map[string]*test)\n    tg.items[str] = &amp;test{}\n    for i := 0; i &lt; 1000; i++ {\n        w.Add(1)\n        go increment(&amp;tg, &amp;w)\n    }\n    w.Wait()\n    fmt.Println(\"final value of x\", tg.items[str].x)\n}\n</code></pre>\n\n<p>Try commenting out <code>t.Lock()</code> and <code>t.Unlock()</code> in <code>increment()</code> function</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6587056"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1030, "favorite_count": 0, "accepted_answer_id": 49214590, "answer_count": 2, "score": 0, "last_activity_date": 1542955692, "creation_date": 1520717294, "question_id": 49214205, "link": "https://stackoverflow.com/questions/49214205/how-to-lock-concurrent-access-to-all-struct-fields-internally", "title": "How to lock concurrent access to all struct fields internally?", "body": "<p>How to lock concurrent access to all struct fields internally? Let's say I have a struct:</p>\n\n<pre><code> type Data struct {\n    ID string\n    Size int\n    //... and more fields\n }\n</code></pre>\n\n<p>That will be used in another struct: </p>\n\n<pre><code>type Project struct {\n    mu sync.Mutex\n    MetaData Data\n    //... and more fields\n}\n</code></pre>\n\n<p>How could I modify/get MetaData struct and use mutex for that while not exposing its mutex to the outer packages? I know I could use Get/Set methods, but what if I needed to modify one field of Data struct (it wouldn't be very good/clean if every field had a get/set method with the same shared mutex)? Could you recommend a way/pattern to have a struct-wise mutex that would be locked/unlocked internally?</p>\n"}, {"tags": ["go", "token", "translation"], "owner": {"reputation": 1034, "user_id": 2089648, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/8b29d87d89de9c1abac217464e57b191?s=128&d=identicon&r=PG", "display_name": "user2089648", "link": "https://stackoverflow.com/users/2089648/user2089648"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1520715452, "creation_date": 1520715452, "question_id": 49213962, "link": "https://stackoverflow.com/questions/49213962/golang-translations-with-search", "title": "Golang Translations with search", "body": "<p>I have a package which is reusable but also needs translations.\nFor the first binary that uses it, all is well - for the second one I may forget some tokens that need translations. Subsequentially this leads to texts not being translated.</p>\n\n<p>Therefore I am looking for a way to have translations, that enables the compiler (or something else) to find all translation-tokens that are used in any of the to-be compiled packages.</p>\n\n<p>I have thought of maybe using go:generate.\nThis would make a translation look like so:</p>\n\n<pre><code>//go:generate collectTranslation \"TOKEN_FOR_TEXT\" \"Default text\"\ntranslator.Translate(\"TOKEN_FOR_TEXT\", \"Default text\")\n</code></pre>\n\n<p>This approach however has two problems:</p>\n\n<p>Problem 1) Redundancy - I have to remember to add a go:generate everywhere I use a translation. I would REALLY prefer a way that is more robust against human error.</p>\n\n<p>Problem 2) go generate does not automatically dereference dependencies. I need to get fancy with <code>go list -f '{{ .Deps }}'</code> to get the dependencies and then run go generate for those. (Obviously I don't do this by hand but automated.)</p>\n\n<hr>\n\n<p>Anyways my solutions while working feel like patchworks to the problem.\nIs there a cleaner solution?</p>\n"}, {"tags": ["html", "go", "heroku"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520717282, "post_id": 49213893, "comment_id": 85432804, "body": "Inside your <code>hello</code> handler use the <code>*http.Request</code>&#39;s <a href=\"https://golang.org/pkg/net/http/#Request.FormValue\" rel=\"nofollow noreferrer\">FormValue</a> method."}, {"owner": {"reputation": 143, "user_id": 3710436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10d2e323e4281f0aa667052e03a53dbe?s=128&d=identicon&r=PG&f=1", "display_name": "user3710436", "link": "https://stackoverflow.com/users/3710436/user3710436"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520720363, "post_id": 49213893, "comment_id": 85433545, "body": "Nothing prints on the same page, If I make a submit button and another handler for the second HTML page where the variable values can be printed, how would that HTML code be?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520720621, "post_id": 49213893, "comment_id": 85433600, "body": "To learn how to render values in your templates take a look at <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\">golang.org/pkg/text/template</a> (same rules apply for <code>html&#47;template</code>)."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520721003, "post_id": 49213893, "comment_id": 85433685, "body": "Here&#39;s an example: <a href=\"https://play.golang.org/p/X245hmGbAfb\" rel=\"nofollow noreferrer\">play.golang.org/p/X245hmGbAfb</a>"}], "owner": {"reputation": 143, "user_id": 3710436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10d2e323e4281f0aa667052e03a53dbe?s=128&d=identicon&r=PG&f=1", "display_name": "user3710436", "link": "https://stackoverflow.com/users/3710436/user3710436"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 93, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1520724123, "creation_date": 1520714929, "last_edit_date": 1520724123, "question_id": 49213893, "link": "https://stackoverflow.com/questions/49213893/golang-heroku-web-app-aws-s3", "title": "Golang Heroku Web app AWS S3", "body": "<p>I am trying to modify a CLI based golang program to a one working on Heroku (GUI). I want to read a file from AWS S3 and use it in the process() and getdomains() function. Need help with the S3 bucket connection and reading of file to put in place of \"domains.txt\"</p>\n\n<p>Some functions from the Go program Snippet: </p>\n\n<pre><code>  package main\n\n    import (\n        \"bufio\"\n        \"bytes\"\n        \"crypto/tls\"\n        \"fmt\"\n        \"io/ioutil\"\n        \"log\"\n        \"math/rand\"\n        \"net\"\n        \"net/http\"\n        \"os\"\n        \"strings\"\n        \"sync\"\n        \"time\"\n    )\n\n\n    var Wordlist string = \"\"\n    var int Threads, Timeout\n    var Https, Strict bool = false, false\n\n    type Http struct {\n        Url, Num string\n    }\n\n  func getDomains(path string) (lines []string, Error error) {\n\n    file, err := os.Open(path)\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    defer file.Close()\n\n    scanner := bufio.NewScanner(file)\n\n    for scanner.Scan() {\n        lines = append(lines, scanner.Text())\n    }\n\n    return lines, scanner.Err()\n}\n\nfunc Process() {\n\n\n        urls := make(chan *Http, Threads*10) // parameters threads taken as input from html form\n        list, err := getDomains(\"file name taken from html form\")\n        if err != nil {\n            log.Fatalln(err)\n        }\n\n        var wg sync.WaitGroup\n        for i := 0; i &lt; Threads; i++ {\n            wg.Add(1)\n            go func() {\n                for url := range urls {\n                    url.DNS()\n                }\n\n                wg.Done()\n            }()\n        }\n\n        for i := 0; i &lt; len(list); i++ {\n            Progress := fmt.Sprintf(\"%d\", len(list))\n            urls &lt;- &amp;Http{Url: list[i], Num: Progress}\n        }\n\n        close(urls)\n\n        wg.Wait()\n\n        fmt.Printf(\"\\r%s\", strings.Repeat(\" \", 100))\n        fmt.Printf(\"\\rTask completed.\\n\")\n    }\n</code></pre>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "visual-studio-code", "golint"], "comments": [{"owner": {"reputation": 2384, "user_id": 9280994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/378f51f8fdf92e078e0fd52507fed62f?s=128&d=identicon&r=PG&f=1", "display_name": "Jonathan R", "link": "https://stackoverflow.com/users/9280994/jonathan-r"}, "edited": false, "score": 0, "creation_date": 1520722838, "post_id": 49213300, "comment_id": 85434107, "body": "Did you already try to delete the folder in your GOPATH? It looks like Go gets mixed up on which package to use"}, {"owner": {"reputation": 3162, "user_id": 2404117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2a6081fe81e9a7be2e0324d65203911f?s=128&d=identicon&r=PG", "display_name": "shanmugharaj", "link": "https://stackoverflow.com/users/2404117/shanmugharaj"}, "reply_to_user": {"reputation": 2384, "user_id": 9280994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/378f51f8fdf92e078e0fd52507fed62f?s=128&d=identicon&r=PG&f=1", "display_name": "Jonathan R", "link": "https://stackoverflow.com/users/9280994/jonathan-r"}, "edited": false, "score": 0, "creation_date": 1520735893, "post_id": 49213300, "comment_id": 85436236, "body": "@JonathanR I am not entirely sure. My $GOPATH is <code>&#47;Users&#47;hey&#47;Code&#47;go</code> but I had placed it in my profile like this <code>&#47;Users&#47;shanmugharajk&#47;Code&#47;Go</code>. Case was wrong gave <code>Go</code> instead of <code>go</code>. I changed this in my bash profile and deleted all the packages outside of vendor folder. After that it works fine. But I try to reproduce the issue by repeating the same it doesn&#39;t occur. Finally I couldn&#39;t figure the reason for the error and how it got resolved :("}, {"owner": {"reputation": 2384, "user_id": 9280994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/378f51f8fdf92e078e0fd52507fed62f?s=128&d=identicon&r=PG&f=1", "display_name": "Jonathan R", "link": "https://stackoverflow.com/users/9280994/jonathan-r"}, "edited": false, "score": 1, "creation_date": 1520765076, "post_id": 49213300, "comment_id": 85441895, "body": "I believe on mac the GOPATH is case sensitive, I had this problem once, too."}], "owner": {"reputation": 3162, "user_id": 2404117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2a6081fe81e9a7be2e0324d65203911f?s=128&d=identicon&r=PG", "display_name": "shanmugharaj", "link": "https://stackoverflow.com/users/2404117/shanmugharaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 546, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1520711030, "creation_date": 1520711030, "question_id": 49213300, "link": "https://stackoverflow.com/questions/49213300/go-lint-complains-the-import-when-using-dep", "title": "Go lint complains the import when using dep", "body": "<p>I saw the similar question <a href=\"https://stackoverflow.com/questions/31969088/using-an-external-dependency-in-a-library\">here</a>. But I couldn't solve my case.</p>\n\n<p>I am having project initialised with dep and added the first dependency \"Echo\". Now folder structure looks like this</p>\n\n<pre><code>|--server\n|    |--server.go\n|--vendor\n|--main.go\n</code></pre>\n\n<p>The server.go has the following code</p>\n\n<pre><code>package server\n\nimport (\n    \"net/http\"\n\n    \"github.com/labstack/echo\"\n)\n\n// TestController : Test controller\nfunc TestController(c echo.Context) error {\n    return c.String(http.StatusOK, \"Hello, World!\")\n}\n</code></pre>\n\n<p>and the main.go has</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/labstack/echo\"\n    \"github.com/sfkshan/pos/server\"\n)\n\nfunc main() {\n    e := echo.New()\n    e.GET(\"/\", server.TestController)\n    e.Logger.Fatal(e.Start(\":1323\"))\n}\n</code></pre>\n\n<p>Now vscode shows the warning</p>\n\n<blockquote>\n  <p>cannot use server.TestController (type\n  func(\"github.com/sfkshan/pos/vendor/github.com/labstack/echo\".Context)\n  error) as type \"github.com/labstack/echo\".HandlerFunc in argument to\n  e.GET</p>\n</blockquote>\n\n<p>I am not sure why is this happening? If I delete the vendor folder folder the error vanishes. But again after running <code>dep ensure</code> (in this case vendor folder gets created which is expected) the error appears again.</p>\n"}, {"tags": ["go", "cron", "scheduled-tasks"], "owner": {"reputation": 133, "user_id": 3464189, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/9af2d112616d395cab63325e874e53e1?s=128&d=identicon&r=PG&f=1", "display_name": "user3464189", "link": "https://stackoverflow.com/users/3464189/user3464189"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 235, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1520709535, "creation_date": 1520707507, "last_edit_date": 1520709535, "question_id": 49212754, "link": "https://stackoverflow.com/questions/49212754/why-is-gocron-executing-multiple-times", "title": "Why is gocron executing multiple times?", "body": "<p>I am trying to build a service that executes on a cron schedule. I am trying to use gocron (<a href=\"https://github.com/jasonlvhit/gocron\" rel=\"nofollow noreferrer\">https://github.com/jasonlvhit/gocron</a>). My code looks like below:</p>\n\n<pre><code>func taskWithParams(a int, b string) {\n    fmt.Println(a, b)\n}\n\nfunc GetSchedules() {\n    s := gocron.NewScheduler()\n\n    //Retrieve the schedules from Dyanmo\n    var scheduleArray = dynamodb.GetConfiguration()\n\n    //iterate over all of the schedules\n    for _, i := range scheduleArray {\n\n        //Determine the days we need to schedule on\n        dayWeekStart, err := strconv.Atoi(i.Cron[\"day_week_start\"])\n        dayWeekEnd, err := strconv.Atoi(i.Cron[\"day_week_end\"])\n        if err != nil {\n            fmt.Println(\"error getting days:\", err)\n        }\n\n        //Determine the time to execute on\n        var timeToRun string\n        buffer := bytes.NewBufferString(\"\")\n        buffer.WriteString(i.Cron[\"hour\"])\n        buffer.WriteString(\":\")\n        buffer.WriteString(i.Cron[\"min\"])\n        timeToRun = buffer.String()\n\n        for x := dayWeekStart; x &lt;= dayWeekEnd; x++ {\n            switch {\n            case x == 0:\n                s.Every(1).Sunday().At(timeToRun).Do(taskWithParams, 0, timeToRun)\n            case x == 1:\n                s.Every(1).Monday().At(timeToRun).Do(taskWithParams, 1, timeToRun)\n            case x == 2:\n                s.Every(1).Tuesday().At(timeToRun).Do(taskWithParams, 2, timeToRun)\n            case x == 3:\n                s.Every(1).Wednesday().At(timeToRun).Do(taskWithParams, 3, timeToRun)\n            case x == 4:\n                s.Every(1).Thursday().At(timeToRun).Do(taskWithParams, 4, timeToRun)\n            case x == 5:\n                s.Every(1).Friday().At(timeToRun).Do(taskWithParams, 5, timeToRun)\n            case x == 6:\n                s.Every(1).Saturday().At(timeToRun).Do(taskWithParams, 6, timeToRun)\n            default:\n                fmt.Println(\"Improper cron day of week\")\n            }\n        }\n    }\n    &lt;-s.Start()\n}\n</code></pre>\n\n<p>Now, say I have a cron schedule to execute at noon Mon-Fri. When noon on Monday comes, the output looks like this:</p>\n\n<ul>\n<li>1 12:00</li>\n<li>2 12:00</li>\n<li>3 12:00</li>\n<li>4 12:00</li>\n<li>5 12:00</li>\n</ul>\n\n<p>Why is it executing for Tuesday-Friday on Monday? The examples seem straight-forward. I feel like I am doing something foolish but just can't see it.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 0, "creation_date": 1520733459, "post_id": 49211663, "comment_id": 85435867, "body": "unable to reproduce, your first line without <code>&#47;</code> works. (with go 1.9.2 on CentOS 7 on digiocean droplet)"}], "owner": {"reputation": 601, "user_id": 942453, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/03e605414eb1166342b975e9b003fff7?s=128&d=identicon&r=PG", "display_name": "MattL922", "link": "https://stackoverflow.com/users/942453/mattl922"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1520708238, "creation_date": 1520701294, "last_edit_date": 1520708238, "question_id": 49211663, "link": "https://stackoverflow.com/questions/49211663/go-file-server-from-hidden-directory", "title": "Go file server from hidden directory", "body": "<p>I was setting up a file server handler for certbot using <code>net/http</code>'s <code>FileServer</code> handler and ran into some odd behavior setting the file server's root directory to a hidden directory.</p>\n\n<p>I have a directory structure as follows:</p>\n\n<pre><code>certbot/\n |- .well-known/\n |    |- test.txt\n |- well-known/\n      |- test.txt\n</code></pre>\n\n<p>All with the same user/group/permissions.</p>\n\n<p>The following handler fails to serve test.txt (returns a 404 for GET /.well-known/test.txt):</p>\n\n<pre><code>http.Handle(\"/.well-known/\", http.StripPrefix(\"/.well-known/\", http.FileServer(http.Dir(\"./certbot/.well-known\"))))\n</code></pre>\n\n<p>However, these both work:</p>\n\n<pre><code>http.Handle(\"/.well-known/\", http.StripPrefix(\"/.well-known/\", http.FileServer(http.Dir(\"./certbot/well-known\"))))\nhttp.Handle(\"/.well-known/\", http.StripPrefix(\"/.well-known/\", http.FileServer(http.Dir(\"./certbot/.well-known/\"))))\n</code></pre>\n\n<p>I'm wondering why I have to add the trailing slash when serving from <code>./certbot/.well-known</code> but not from <code>./certbot/well-known</code>.  I don't see anything in the <a href=\"https://github.com/golang/go/tree/master/src/net/http\" rel=\"nofollow noreferrer\">net/http source code</a> that would cause this.  The <a href=\"https://golang.org/pkg/net/http/#Dir\" rel=\"nofollow noreferrer\">http.Dir documentation</a> states that it will allow access to directories that begin with a period.  Why is the trailing slash needed in the one handler but not the other?</p>\n\n<p>I'm using go v1.9.2 on a CentOS 7 Digital Ocean droplet.</p>\n"}, {"tags": ["go", "goland"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1520700694, "post_id": 49211487, "comment_id": 85427571, "body": "this may help: <a href=\"https://glamanate.com/blog/goland-ide-and-local-vendor-directories\" rel=\"nofollow noreferrer\">glamanate.com/blog/goland-ide-and-local-vendor-directories</a>"}], "answers": [{"tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 3, "last_activity_date": 1520701328, "creation_date": 1520701328, "answer_id": 49211670, "question_id": 49211487, "link": "https://stackoverflow.com/questions/49211487/importing-a-go-project-in-goland/49211670#49211670", "title": "Importing a go project in Goland", "body": "<p>Choose Open Directory and select <code>/Users/me/workspace/src/github.com/mynamespace/myproject</code> as the directory to open and the IDE will pick up everything in it.</p>\n\n<p>Then, you need to make sure that the IDE has the correct configuration for the GOPATH. To do so, go to Settings | Go | GOPATH and choose either the <code>Global GOPATH</code> (used across projects), or the <code>Project GOPATH</code> to be <code>/Users/me/workspace</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 3903, "user_id": 1434070, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/7uABI.jpg?s=128&g=1", "display_name": "fips", "link": "https://stackoverflow.com/users/1434070/fips"}, "is_accepted": false, "score": 0, "last_activity_date": 1520702580, "last_edit_date": 1520702580, "creation_date": 1520702259, "answer_id": 49211844, "question_id": 49211487, "link": "https://stackoverflow.com/questions/49211487/importing-a-go-project-in-goland/49211844#49211844", "title": "Importing a go project in Goland", "body": "<p><code>GoLand</code> picks up the Go env vars so add these to your <code>~/.bash_profile</code>:</p>\n\n<pre><code>### Go ###\nexport WORKSPACE=/Users/me/workspace/go  # &lt;= In your case without the /go\nexport GOPATH=$WORKSPACE\nexport GOBIN=$WORKSPACE/bin\nexport PATH=\"$PATH:$GOBIN\"\n</code></pre>\n\n<p>With these you should be able to build and run Go programs within or outside of GoLand.</p>\n"}], "owner": {"reputation": 533, "user_id": 1544322, "user_type": "registered", "accept_rate": 3, "profile_image": "https://www.gravatar.com/avatar/7cf5fbf80943ea67a8951dbcdfd6a9ab?s=128&d=identicon&r=PG", "display_name": "user12331", "link": "https://stackoverflow.com/users/1544322/user12331"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4025, "favorite_count": 0, "accepted_answer_id": 49211670, "answer_count": 2, "score": 2, "last_activity_date": 1520702580, "creation_date": 1520699952, "question_id": 49211487, "link": "https://stackoverflow.com/questions/49211487/importing-a-go-project-in-goland", "title": "Importing a go project in Goland", "body": "<p>I am trying to use the goland ide for my go project. My project directory structure is like this</p>\n\n<pre><code>/Users/me/workspace/src/github.com/mynamespace/myproject\n</code></pre>\n\n<p>Now the myproject directory consists of a glide.yaml file which downloads all the dependencies inside the vendor folder when I do</p>\n\n<pre><code>glide install\n</code></pre>\n\n<p>So the vendor path will be </p>\n\n<pre><code>/Users/me/workspace/src/github.com/mynamespace/myproject/vendor\n</code></pre>\n\n<p>Now I opened the project in the GoLand IDE. However, the sources have a bunch of import statements like</p>\n\n<pre><code>import \"github.com/mynamespace/anotherproject\"\n</code></pre>\n\n<p>which are marked as red. This means the GoLand IDE was not able to pick them up from the vendor folder.</p>\n\n<p>Could you please let me know how can I import these dependencies in the IDE?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 115745, "user_id": 119527, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/lTjBL.png?s=128&g=1", "display_name": "Jonathon Reinhart", "link": "https://stackoverflow.com/users/119527/jonathon-reinhart"}, "edited": false, "score": 0, "creation_date": 1520693381, "post_id": 49210374, "comment_id": 85425205, "body": "Please format your code correctly, indenting it with four spaces."}], "answers": [{"tags": [], "owner": {"reputation": 650, "user_id": 7669570, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f4c9c277ec9fea0992c74b3f989be39?s=128&d=identicon&r=PG&f=1", "display_name": "flevinkelming", "link": "https://stackoverflow.com/users/7669570/flevinkelming"}, "is_accepted": true, "score": 1, "last_activity_date": 1520711898, "last_edit_date": 1520711898, "creation_date": 1520694821, "answer_id": 49210624, "question_id": 49210374, "link": "https://stackoverflow.com/questions/49210374/use-append-to-add-a-new-value-to-slice-and-the-all-value-of-slice-are-changed/49210624#49210624", "title": "use append to add a new value to slice and the all value of slice are changed", "body": "<p>This is happening because you are changing the value of <code>area[\"id\"]</code> and <code>area[\"value\"]</code> with each iteration - the last being \"id\" of 3, and \"value\" of c. Each <code>map[string]interface{}</code> stored in <code>data</code> is pointing to the same object in memory.</p>\n\n<p>You can use a composite literal to achieve the desired results.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    var data = make([]map[string]interface{}, 0)\n    // var area = make(map[string]interface{})\n\n    maps_temp := []map[string]interface{}{{\"id\": 1, \"value\": \"a\"}, {\"id\": 2, \"value\": \"b\"}, {\"id\": 3, \"value\": \"c\"}}\n\n    for _, value := range maps_temp {\n        // area[\"id\"] = value[\"id\"]\n        // area[\"value\"] = value[\"value\"]\n\n        data = append(data, map[string]interface{}{\"id\": value[\"id\"], \"value\": value[\"value\"]})\n    }\n\n    fmt.Println(\"data:\", data)\n}\n</code></pre>\n\n<p>source on playground: <a href=\"https://play.golang.org/p/kU4eHowh8N2\" rel=\"nofollow noreferrer\">https://play.golang.org/p/kU4eHowh8N2</a></p>\n"}, {"tags": [], "owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "is_accepted": false, "score": 0, "last_activity_date": 1520694875, "creation_date": 1520694875, "answer_id": 49210633, "question_id": 49210374, "link": "https://stackoverflow.com/questions/49210374/use-append-to-add-a-new-value-to-slice-and-the-all-value-of-slice-are-changed/49210633#49210633", "title": "use append to add a new value to slice and the all value of slice are changed", "body": "<p>You only create one area map and are putting it in the array each time around, instead you need to create a new map for each iteration, e.g. </p>\n\n<pre><code>var data = make([]map[string]interface{}, 0)\n\nmaps_temp := []map[string]interface{}{{\"id\":1, \"value\":\"a\"},{\"id\":2, \"value\":\"b\"},{\"id\":3, \"value\":\"c\"}}    \n\nfor _, value := range maps_temp {\n    area := make(map[string]interface{})\n    area[\"id\"] = value[\"id\"]\n    area[\"value\"] = value[\"value\"]\n\n    data = append(data, area)\n}\nfmt.Println(\"data:\",data)\n\nresults in\ndata: [map[value:a id:1] map[id:2 value:b] map[id:3 value:c]]\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 8620954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab00b062b75f0b47ae1279c845a237f4?s=128&d=identicon&r=PG&f=1", "display_name": "Jason.dong", "link": "https://stackoverflow.com/users/8620954/jason-dong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 49210624, "answer_count": 2, "score": 0, "last_activity_date": 1520711898, "creation_date": 1520693317, "last_edit_date": 1520693907, "question_id": 49210374, "link": "https://stackoverflow.com/questions/49210374/use-append-to-add-a-new-value-to-slice-and-the-all-value-of-slice-are-changed", "title": "use append to add a new value to slice and the all value of slice are changed", "body": "<p><strong>code show below:</strong></p>\n\n<pre><code>var data = make([]map[string]interface{}, 0)\nvar area = make(map[string]interface{})\n\nmaps_temp := []map[string]interface{}{{\"id\":1, \"value\":\"a\"},{\"id\":2, \"value\":\"b\"},{\"id\":3, \"value\":\"c\"}}    \n\nfor _, value := range maps_temp {\n    area[\"id\"] = value[\"id\"]\n    area[\"value\"] = value[\"value\"]\n\n    data = append(data, area)\n    fmt.Println(\"data:\",data)\n}\n</code></pre>\n\n<p><strong>The result is :</strong></p>\n\n<pre><code>data: [map[id:3 value:c] map[id:3 value:c] map[id:3 value:c]]\n</code></pre>\n\n<p><strong>expected result is :</strong></p>\n\n<pre><code>data: [map[id:1 value:a] map[id:2 value:b] map[id:3 value:c]]\n</code></pre>\n\n<p>why?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520692758, "post_id": 49209858, "comment_id": 85425000, "body": "Do you need to use arrays for some reason? There\u2019s no problem if you start with slices."}, {"owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520693245, "post_id": 49209858, "comment_id": 85425166, "body": "@JimB could you give an example how to use 2d slices in this case? what if the matrix dimensions are 3x4?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520706282, "post_id": 49209858, "comment_id": 85429458, "body": "What is the &quot;matrix definition&quot;? If the type is <code>[3][4]int</code>, then that&#39;s the type you need to use. If the type is <code>[][]int</code>, then they can have any dimensions."}, {"owner": {"reputation": 465, "user_id": 1936173, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/8uQ1j.png?s=128&g=1", "display_name": "Illia Danko", "link": "https://stackoverflow.com/users/1936173/illia-danko"}, "edited": false, "score": 0, "creation_date": 1520869305, "post_id": 49209858, "comment_id": 85481793, "body": "Besides, when you pass an array as the argument to the function/method, you copy the whole array, i.e., inside the function/method you modify its copy. If you using slice, you can modify it on the fly without an extra copy. The rule of thumb is whenever it&#39;s possible path slice as the argument."}], "answers": [{"tags": [], "owner": {"reputation": 78, "user_id": 2790407, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf35247b7ced6e3b77ab9ba1e6509644?s=128&d=identicon&r=PG", "display_name": "zitryss", "link": "https://stackoverflow.com/users/2790407/zitryss"}, "is_accepted": true, "score": 1, "last_activity_date": 1520693174, "last_edit_date": 1520693174, "creation_date": 1520692785, "answer_id": 49210289, "question_id": 49209858, "link": "https://stackoverflow.com/questions/49209858/passing-a-2d-slice-to-a-golang-function-argument/49210289#49210289", "title": "Passing a 2D slice to a Golang function argument", "body": "<p>Try to write the data directly to the slice and pass it later to the function. Remember array and slices are different types. Moreover, the type <code>[3]int</code> is also different from <code>[4]int</code> (size matters).</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc print2D(arr [][]int) {\n    for i := 0; i &lt; len(arr); i++ {\n        for j := 0; j &lt; len(arr[0]); j++ {\n            fmt.Printf(\"%d \", arr[i][j])\n        }\n        fmt.Println()\n    }\n}\n\nfunc main() {\n    var arr [][]int\n    for i := 0; i &lt; 6; i++ {\n        tmp := make([]int, 6)\n        for j := 0; j &lt; 6; j++ {\n            fmt.Scanf(\"%d\", &amp;tmp[j])\n        }\n        arr = append(arr, tmp)\n    }\n    print2D(arr)\n}\n</code></pre>\n"}], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 717, "favorite_count": 0, "accepted_answer_id": 49210289, "answer_count": 1, "score": 1, "last_activity_date": 1520693174, "creation_date": 1520690103, "question_id": 49209858, "link": "https://stackoverflow.com/questions/49209858/passing-a-2d-slice-to-a-golang-function-argument", "title": "Passing a 2D slice to a Golang function argument", "body": "<p>I'm trying to scan a matrix from the stdin and simply print it using following code.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc print2D(arr [][]int) {\n    for i:=0; i&lt; len(arr); i++{\n        for j := 0; j&lt; len(arr[0]); j++{\n            fmt.Printf(\"%d \", arr[i][j])\n        }\n        fmt.Println()\n    }\n}\n\nfunc main() {\n    var arr [6][6]int\n    for i:= 0 ; i &lt; 6 ;i++ {\n        for j := 0; j&lt; 6; j++{\n            fmt.Scanf(\"%d\", &amp;arr[i][j])\n        }\n    }\n    print2D(arr[:])\n}\n</code></pre>\n\n<p>It throws the following error</p>\n\n<blockquote>\n  <p>./main.go:23: cannot use arr[:] (type [][6]int) as type [][]int in\n  argument to print2D</p>\n</blockquote>\n\n<p>Is there a way to pass a 2D slice without defining sizes in the function arguments? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1520690298, "post_id": 49209441, "comment_id": 85424243, "body": "<a href=\"https://github.com/bouk/monkey\" rel=\"nofollow noreferrer\">github.com/bouk/monkey</a>. Don&#39;t do it though."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1520708926, "post_id": 49209441, "comment_id": 85430325, "body": "Sounds like an XY Problem. What is your actual situation?"}], "answers": [{"tags": [], "owner": {"reputation": 167, "user_id": 9316126, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-NNuPzpCOcug/AAAAAAAAAAI/AAAAAAAAADo/XPDyVPMo1y8/photo.jpg?sz=128", "display_name": "Milan Vlach", "link": "https://stackoverflow.com/users/9316126/milan-vlach"}, "is_accepted": false, "score": 0, "last_activity_date": 1520691470, "last_edit_date": 1520691470, "creation_date": 1520690585, "answer_id": 49209939, "question_id": 49209441, "link": "https://stackoverflow.com/questions/49209441/patch-standard-package/49209939#49209939", "title": "Patch standard package", "body": "<p>I don't think what you are trying to do is achievable even with help of Reflect library. By calling Go's function/method from another package, you are calling <strong>a copy</strong> of the original code.</p>\n\n<p>You would have to either make wrapper function which somehow changes original behavior, which is cleaner and better way of handling for this kind of purposes. E.g.:</p>\n\n<pre><code>// Do stuff what you need.\nfunc ExitLog(message string) {\n   fmt.Printf(\"an error occured with message: '%s'\", message)\n   os.Exit(1)\n}\n</code></pre>\n\n<p>and call the function instead of the original one.</p>\n\n<p><strong>Edit:</strong> Someone in the comments mentioned a library for doing such a thing, but please reconsider your intention. Rewriting package's behavior by hacking it is not considered clean and/or good practice.</p>\n\n<p><strong>Edit2:</strong> If you are trying to send a message whenever an error occurs, take a look at publish-subscribe pattern:</p>\n\n<ul>\n<li><a href=\"https://hackernoon.com/communicating-go-applications-through-redis-pub-sub-messaging-paradigm-df7317897b13\" rel=\"nofollow noreferrer\">https://hackernoon.com/communicating-go-applications-through-redis-pub-sub-messaging-paradigm-df7317897b13</a></li>\n<li><a href=\"https://flaviocopes.com/golang-event-listeners/\" rel=\"nofollow noreferrer\">https://flaviocopes.com/golang-event-listeners/</a> </li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1520865820, "post_id": 49210110, "comment_id": 85479250, "body": "Per the top of the docs for that package: &quot;This is as unsafe as it sounds and I don&#39;t recommend anyone do it outside of a testing environment.&quot; This can also cause unpredictable behavior in any code that expects <code>os.Exit</code> to work the way it does in its documentation."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520882009, "post_id": 49210110, "comment_id": 85489394, "body": "The &quot;safe&quot; (aside from the risks of modifying a fundamental call like <code>os.Exit</code>) way to change the std lib behavior, is to just build a patched version."}], "tags": [], "owner": {"reputation": 71, "user_id": 8423881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d20071bbf3be523d87ed13232b3d497?s=128&d=identicon&r=PG&f=1", "display_name": "Malyutin Egor", "link": "https://stackoverflow.com/users/8423881/malyutin-egor"}, "is_accepted": true, "score": -3, "last_activity_date": 1520691610, "creation_date": 1520691610, "answer_id": 49210110, "question_id": 49209441, "link": "https://stackoverflow.com/questions/49209441/patch-standard-package/49210110#49210110", "title": "Patch standard package", "body": "<p>Thanks to <a href=\"https://stackoverflow.com/users/965900/mkopriva\">mkopriva</a>.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n\n    \"github.com/bouk/monkey\"\n)\n\nfunc myExit(code int) {\n    _ = code\n    fmt.Println(`I think you shouldn't exit.`)\n}\n\nfunc init() {\n    monkey.Patch(os.Exit, myExit)\n}\n\nfunc main() {\n    os.Exit(1)\n    fmt.Println(`But why?`)\n}\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 8423881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d20071bbf3be523d87ed13232b3d497?s=128&d=identicon&r=PG&f=1", "display_name": "Malyutin Egor", "link": "https://stackoverflow.com/users/8423881/malyutin-egor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 0, "accepted_answer_id": 49210110, "answer_count": 2, "score": -3, "last_activity_date": 1520700532, "creation_date": 1520687367, "last_edit_date": 1520700532, "question_id": 49209441, "link": "https://stackoverflow.com/questions/49209441/patch-standard-package", "title": "Patch standard package", "body": "<p>I want to replace some function from standard Go library (<code>os.Exit</code> specifically). Can I do that? I tried:</p>\n\n<pre><code>myExitValue := reflect.ValueOf(func() {\n    fmt.Println(\"exiting\")\n})\nreflect.ValueOf(os.Exit).Set(myExitValue)\n</code></pre>\n\n<p>But it panics: <code>reflect: reflect.Value.Set using unaddressable value</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1520669819, "post_id": 49206841, "comment_id": 85418620, "body": "<a href=\"http://www.tapirgames.com/blog/golang-interface-implementation\" rel=\"nofollow noreferrer\">tapirgames.com/blog/golang-interface-implementation</a>"}], "answers": [{"tags": [], "owner": {"reputation": 8303, "user_id": 3165602, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8b194cca5dcf6906c0911564bfb4166c?s=128&d=identicon&r=PG", "display_name": "Oleg Sklyar", "link": "https://stackoverflow.com/users/3165602/oleg-sklyar"}, "is_accepted": true, "score": 0, "last_activity_date": 1520670389, "creation_date": 1520670389, "answer_id": 49206975, "question_id": 49206841, "link": "https://stackoverflow.com/questions/49206841/how-does-the-range-interface-of-golang-run-internally/49206975#49206975", "title": "How does the &quot;range interface&quot; of golang run internally?", "body": "<p>An interface is a declaration of a <em>contract</em>, that is of the behaviour that implementing instances must support. By providing methods that are defined on the interface, a <code>struct</code> in Go automatically implements that interface and can be used in place of that interface wherever an interface based declaration is present. This is slightly different from many other languages such as Java or C++ where an instance must explicitly declare interfaces it implements and classes it extends. At runtime the code will get a concrete instance and execute a method of that instance. For the coder or for the declaration it does not matter, what matters is that instance will have a method as defined on the interface and that method can be called so the code can be written in generic interface terms. </p>\n\n<p>This idea to <em>accept interfaces and provide structs/instances</em> is central for the inversion of control and dependency injection.</p>\n\n<p>This is exactly what happens in you example. <code>NokiaPhone</code> and <code>IPhone</code> implement the <code>Phone</code> interface by providing methods declared on the interface <code>Phone</code>. When it comes to the loop, at each iteration a concrete instance is taken out of array, for that instance type the method asked for in the code is looked up, so the implementation now, and is executed. It works in the same way in Go, Java, C++ (with virtual methods) and many other languages that support either inheritance or interface/implementation pattern as Go does.</p>\n"}], "owner": {"reputation": 21, "user_id": 9202146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c49ba9be63821bfc4b2676be77f40926?s=128&d=identicon&r=PG&f=1", "display_name": "Vtwmz", "link": "https://stackoverflow.com/users/9202146/vtwmz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 1, "accepted_answer_id": 49206975, "answer_count": 1, "score": 1, "last_activity_date": 1520683235, "creation_date": 1520669426, "last_edit_date": 1520683235, "question_id": 49206841, "link": "https://stackoverflow.com/questions/49206841/how-does-the-range-interface-of-golang-run-internally", "title": "How does the &quot;range interface&quot; of golang run internally?", "body": "<pre><code>package main\n\nimport \"fmt\"\n\ntype Phone interface {\n    call()\n    sales() int\n}\n\ntype NokiaPhone struct {\n    price int\n}\n\nfunc (nokiaPhone NokiaPhone) call() {\n    fmt.Println(\"I am Nokia, I can call you!\")\n}\nfunc (nokiaPhone NokiaPhone) sales() int {\n    return nokiaPhone.price\n}\n\ntype IPhone struct {\n    price int\n}\n\nfunc (iPhone IPhone) call() {\n    fmt.Println(\"I am iPhone, I can call you!\")\n}\n\nfunc (iPhone IPhone) sales() int {\n    return iPhone.price\n}\n\nfunc main() {\n    var phones = [5]Phone{\n        NokiaPhone{price: 350},\n        IPhone{price: 5000},\n        IPhone{price: 3400},\n        NokiaPhone{price: 450},\n        IPhone{price: 5000},\n    }\n\n    var totalSales = 0\n    **for _, phone := *range phones* {\n        totalSales += phone.sales()\n    }**\n    fmt.Println(totalSales)\n\n}\n</code></pre>\n\n<p>i don't know the \"range phones\" run internally.i only understand that 'phone' is run in '[5]phone' order and i want to konw that golang how to recognizes iphone or  NokiaPhone. </p>\n\n<p>Thanks , forgive me for my lame English.</p>\n"}, {"tags": ["go", "mutex", "tcpclient"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1520692988, "post_id": 49205958, "comment_id": 85425075, "body": "FYI, writing a unit test or just running <code>go vet</code> would show the problem immediately."}], "answers": [{"tags": [], "owner": {"reputation": 1980, "user_id": 6375498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51ade4f86c3426c9f67f1a54b270b398?s=128&d=identicon&r=PG&f=1", "display_name": "Seva", "link": "https://stackoverflow.com/users/6375498/seva"}, "is_accepted": true, "score": 8, "last_activity_date": 1520672232, "creation_date": 1520672232, "answer_id": 49207226, "question_id": 49205958, "link": "https://stackoverflow.com/questions/49205958/how-to-write-and-read-concurrently-on-single-tcp-connection-in-golang/49207226#49207226", "title": "How to write and read concurrently on single TCP connection in golang?", "body": "<p>func testC(cc Cc, st string) actually takes a copy of cc. So, even with locking on a mutex, you actually locking on 10 copies of it which are totally independent. So, your locking code has no effect.</p>\n\n<p>Try changing testC function signature to <code>func testC(cc *Cc, st string)</code>. And then your call <code>go testC(&amp;cc, strconv.Itoa(i))</code>.</p>\n"}], "owner": {"reputation": 121, "user_id": 6926677, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TwIsI.jpg?s=128&g=1", "display_name": "Adzimzf", "link": "https://stackoverflow.com/users/6926677/adzimzf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1763, "favorite_count": 0, "accepted_answer_id": 49207226, "answer_count": 1, "score": 0, "last_activity_date": 1520672232, "creation_date": 1520662204, "question_id": 49205958, "link": "https://stackoverflow.com/questions/49205958/how-to-write-and-read-concurrently-on-single-tcp-connection-in-golang", "title": "How to write and read concurrently on single TCP connection in golang?", "body": "<p>I try to create a sigle TCP connection client used for multiple write and read concurrently. For example the TCP Server will return value like you write.\nThe problem is the data exchanged between write and read. I have tried with sync.Mutex but it still doesn't work.</p>\n\n<p>My Result is :</p>\n\n<pre><code>2018/03/10 12:52:10 STRING 4:1\n2018/03/10 12:52:10 STRING 5:6\n2018/03/10 12:52:10 STRING 2:3\nand so on\n</code></pre>\n\n<p>My Expectation is :</p>\n\n<pre><code>2018/03/10 12:52:10 STRING 4:4\n2018/03/10 12:52:10 STRING 5:5\n2018/03/10 12:52:10 STRING 2:2\n2018/03/10 12:52:10 STRING 3:3\n</code></pre>\n\n<p>Here's my code :\n    package main</p>\n\n<pre><code>import (\n    \"bufio\"\n    \"log\"\n    \"net\"\n    \"strconv\"\n    \"sync\"\n    \"time\"\n)\n\ntype Cc struct {\n    mux sync.Mutex\n    rw  *bufio.ReadWriter\n}\n\nfunc main() {\n    addr := \"127.0.0.1:3333\"\n    log.Println(\"Dial \" + addr)\n    conn, err := net.Dial(\"tcp\", addr)\n    cc := Cc{\n        rw: bufio.NewReadWriter(bufio.NewReader(conn), bufio.NewWriter(conn)),\n    }\n\n    if err != nil {\n        log.Println(err)\n    }\n    for i := 1; i &lt;= 10; i++ {\n        go testC(cc, strconv.Itoa(i))\n    }\n\n    time.Sleep(60 * time.Second)\n\n}\n\nfunc testC(cc Cc, st string) {\n    cc.mux.Lock()\n    defer cc.mux.Unlock()\n    _, err := cc.rw.WriteString(st + \"\\n\")\n    if err != nil {\n        log.Println(err)\n        // return errors.Wrap(err, \"Could not send additional STRING data (\"+strconv.Itoa(n)+\" bytes written)\")\n    }\n    // log.Println(\"Flush the buffer.\"s)\n    err = cc.rw.Flush()\n    if err != nil {\n        log.Println(err)\n        // return errors.Wrap(err, \"Flush failed.\")\n    }\n\n    time.Sleep(3 * time.Second)\n\n    // Read the reply.\n    // log.Println(\"Read the reply.\")\n    response, err := cc.rw.ReadString('\\n')\n    if err != nil {\n        log.Println(err)\n        // return errors.Wrap(err, \"Client: Failed to read the reply: '\"+response+\"'\")\n    }\n\n    log.Println(\"STRING \" + st + \":\" + response)\n    // cc.mux.Unlock()\n}\n</code></pre>\n\n<p>Sorry for my bad English, Thank You.</p>\n"}, {"tags": ["arrays", "go"], "answers": [{"comments": [{"owner": {"reputation": 2373, "user_id": 3029017, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/b97R1.jpg?s=128&g=1", "display_name": "shakhawat", "link": "https://stackoverflow.com/users/3029017/shakhawat"}, "edited": false, "score": 0, "creation_date": 1520659380, "post_id": 49205602, "comment_id": 85416452, "body": "Thank you so much!"}], "tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 2, "last_activity_date": 1520658845, "creation_date": 1520658845, "answer_id": 49205602, "question_id": 49205489, "link": "https://stackoverflow.com/questions/49205489/array-assignment-in-golang-content-copy-or-content-pointer-copy/49205602#49205602", "title": "Array Assignment in Golang: Content copy or Content pointer copy", "body": "<p>Your <code>x</code>:</p>\n\n<pre><code>x := []int{2, 4, 5}\n</code></pre>\n\n<p>is a <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"nofollow noreferrer\"><em>slice</em></a>, not an <a href=\"https://golang.org/ref/spec#Array_types\" rel=\"nofollow noreferrer\"><em>array</em></a>.</p>\n\n<p>If you make <code>x</code> an array:</p>\n\n<pre><code>x := [3]int{2, 4, 5}\n// ---^ Now it is an array\n</code></pre>\n\n<p>then you'll see the results you're expecting:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    x := [3]int{2, 4, 5}\n    y := x\n\n    y[0] = -10\n\n    // expecting 2 here, since it is supposed to be a content copy\n    fmt.Println(x[0])\n\n    // not same\n    fmt.Println(\"&amp;x: \", &amp;x)\n    fmt.Println(\"&amp;y: \", &amp;y)\n\n    // same (not anymore...)\n    fmt.Println(\"&amp;x[0]: \", &amp;x[0])\n    fmt.Println(\"&amp;y[0]: \", &amp;y[0])\n}\n</code></pre>\n\n<p>produces output like this:</p>\n\n<pre><code>2\n&amp;x:  &amp;[2 4 5]\n&amp;y:  &amp;[-10 4 5]\n&amp;x[0]:  0x10414020\n&amp;y[0]:  0x10414030\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/-3ZNPwlD1WT\" rel=\"nofollow noreferrer\">https://play.golang.org/p/-3ZNPwlD1WT</a></p>\n"}], "owner": {"reputation": 2373, "user_id": 3029017, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/b97R1.jpg?s=128&g=1", "display_name": "shakhawat", "link": "https://stackoverflow.com/users/3029017/shakhawat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 542, "favorite_count": 0, "accepted_answer_id": 49205602, "answer_count": 1, "score": 0, "last_activity_date": 1571159976, "creation_date": 1520657891, "last_edit_date": 1571159976, "question_id": 49205489, "link": "https://stackoverflow.com/questions/49205489/array-assignment-in-golang-content-copy-or-content-pointer-copy", "title": "Array Assignment in Golang: Content copy or Content pointer copy", "body": "<p>While learning nuances of array data structure in Golang I came across an interesting confusion. I have learnt from <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\" title=\"here\">blog.golang.org</a> that -</p>\n\n<blockquote>\n  <p>when you assign or pass around an array value you will\n  make a copy of its contents.</p>\n</blockquote>\n\n<p>To check this myself I wrote the following piece of code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    x := []int{2, 4, 5}\n    y := x\n\n    y[0] = -10\n\n    // expecting 2 here but getting -10, since  y := x is supposed to be a content copy\n    fmt.Println(x[0])\n\n    // not same\n    println(\"&amp;x: \", &amp;x)\n    println(\"&amp;y: \", &amp;y)\n\n    // same\n    println(\"&amp;x[0]: \", &amp;x[0])\n    println(\"&amp;y[0]: \", &amp;y[0])\n}\n</code></pre>\n\n<p>Doing exactly the same thing in Java I got same internal object address for x and y as expected.</p>\n\n<p>Go Code: <a href=\"https://play.golang.org/p/04l0l84eT4J\" rel=\"nofollow noreferrer\">https://play.golang.org/p/04l0l84eT4J</a></p>\n\n<p>Java code: <a href=\"https://pastebin.ubuntu.com/p/S3fHMTj5NC/\" rel=\"nofollow noreferrer\">https://pastebin.ubuntu.com/p/S3fHMTj5NC/</a></p>\n"}, {"tags": ["api", "http", "go"], "comments": [{"owner": {"reputation": 132, "user_id": 1429861, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/4bbbc1330f01613ef097bdd742e3ed64?s=128&d=identicon&r=PG", "display_name": "Bear0x3f", "link": "https://stackoverflow.com/users/1429861/bear0x3f"}, "edited": false, "score": 0, "creation_date": 1520644759, "post_id": 49204355, "comment_id": 85414113, "body": "Maybe you should use http.Handle, new struct for every request path, I think <code>func</code> has only one but <code>req</code> change thought loop so it end up the last <code>req</code>"}], "answers": [{"tags": [], "owner": {"reputation": 132, "user_id": 1429861, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/4bbbc1330f01613ef097bdd742e3ed64?s=128&d=identicon&r=PG", "display_name": "Bear0x3f", "link": "https://stackoverflow.com/users/1429861/bear0x3f"}, "is_accepted": false, "score": 1, "last_activity_date": 1520646018, "creation_date": 1520646018, "answer_id": 49204507, "question_id": 49204355, "link": "https://stackoverflow.com/questions/49204355/how-to-write-http-handlefunc-dynamically-in-golang/49204507#49204507", "title": "How to write http.HandleFunc() dynamically in golang?", "body": "<p>You should use <code>http.Handle</code></p>\n\n<pre><code>type APIHandleFunc struct {\n    ResponseFile string\n}\n\nfunc (api *APIHandleFunc) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    http.ServeFile(w, r, api.ResponseFile)\n}\n\n// StartServer .\nfunc StartServer(config Config) {\n    for _, req := range config.Requests {\n        http.Handle(apiPrefix+\"/\"+req.Request, &amp;APIHandleFunc{req.ResponceFile}/*new handler*/)\n    }\n    http.HandleFunc(\"/\", http.NotFound)\n}\n</code></pre>\n\n<p>and if you only write json to response just use <code>http.ServeFile</code></p>\n"}, {"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 5, "last_activity_date": 1520665479, "creation_date": 1520665479, "answer_id": 49206345, "question_id": 49204355, "link": "https://stackoverflow.com/questions/49204355/how-to-write-http-handlefunc-dynamically-in-golang/49206345#49206345", "title": "How to write http.HandleFunc() dynamically in golang?", "body": "<p>This is because Go's range loops <em>re-use</em> the declared variable <code>req</code>.</p>\n\n<blockquote>\n  <p>The iteration variables may be declared by the \"range\" clause using a\n  form of <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"noreferrer\">short variable declaration</a> (:=). In this case their types are\n  set to the types of the respective iteration values and their <a href=\"https://golang.org/ref/spec#Declarations_and_scope\" rel=\"noreferrer\">scope</a> is\n  the block of the \"for\" statement; they are <strong>re-used in each iteration</strong>.</p>\n</blockquote>\n\n<p>(emphasis mine)</p>\n\n<p>This behaviour, together with the fact that you are capturing the variable inside a <em>closure</em> is the reason why all of your handlers refer to the value of the last variable.</p>\n\n<blockquote>\n  <p>Function literals are <em>closures</em>: they may refer to variables defined in\n  a surrounding function. Those variables are then shared between the\n  surrounding function and the function literal, and they survive as\n  long as they are accessible.</p>\n</blockquote>\n\n<p>To solve this you can create a new variable from the iteration variable inside the loop and have the closure use that.</p>\n\n<p><a href=\"https://play.golang.org/p/GTNbf1eeFKV\" rel=\"noreferrer\">https://play.golang.org/p/GTNbf1eeFKV</a></p>\n"}], "owner": {"reputation": 587, "user_id": 8849858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed553eeb0056926d3af36bf594de34b?s=128&d=identicon&r=PG&f=1", "display_name": "sergkondr", "link": "https://stackoverflow.com/users/8849858/sergkondr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1850, "favorite_count": 0, "accepted_answer_id": 49206345, "answer_count": 2, "score": 1, "last_activity_date": 1520665479, "creation_date": 1520644346, "question_id": 49204355, "link": "https://stackoverflow.com/questions/49204355/how-to-write-http-handlefunc-dynamically-in-golang", "title": "How to write http.HandleFunc() dynamically in golang?", "body": "<p>I'm trying to write simple http server, that will serve requests to API. This is a code:</p>\n\n<pre><code>type Config struct {\n    ListenPort int `json:\"listenPort\"`\n    Requests   []struct {\n        Request      string `json:\"request\"`\n        ResponceFile string `json:\"responceFile\"`\n    } `json:\"requests\"`\n}\n...\n\nfunc main() {\n    ...\n    startServer(config)\n}\n\nfunc startServer(config Config) {\n    http.HandleFunc(apiPrefix+config.Requests[0].Request,\n        func(w http.ResponseWriter, r *http.Request) {\n            var dataStruct interface{}\n            err := loadJSON(config.Requests[0].ResponseFile, &amp;dataStruct)\n            if err != nil {\n                w.Write([]byte(\"Oops! Something was wrong\"))\n            }\n            data, _ := json.Marshal(dataStruct)\n            w.Header().Set(\"Content-Type\", \"application/json\")\n            w.Write(data)\n        })\n\n    http.HandleFunc(apiPrefix+config.Requests[1].Request,\n        func(w http.ResponseWriter, r *http.Request) {\n            var dataStruct interface{}\n            err := loadJSON(config.Requests[1].ResponseFile, &amp;dataStruct)\n            if err != nil {\n                w.Write([]byte(\"Oops! Something was wrong\"))\n            }\n            data, _ := json.Marshal(dataStruct)\n            w.Header().Set(\"Content-Type\", \"application/json\")\n            w.Write(data)\n        })\n\n    http.HandleFunc(\"/\", http.NotFound)\n\n    port := \"\"\n    if config.ListenPort != 0 {\n        port = fmt.Sprintf(\":%v\", config.ListenPort)\n    } else {\n        port = \":8080\"\n    }\n\n    fmt.Printf(\"Started @%v\\n\", port)\n    log.Fatal(http.ListenAndServe(port, nil))\n}\n\nfunc loadJSON(filePath string, retStruct interface{}) error {\n    fmt.Println(filePath)\n    fileJSON, err := ioutil.ReadFile(filePath)\n    json.Unmarshal(fileJSON, retStruct)\n    return err\n}\n</code></pre>\n\n<p>And this is config, where files that should be returned via specific requests are described:</p>\n\n<pre><code>{\n    \"listenPort\": 8080,\n    \"requests\": [\n        {\n            \"request\": \"switches/brocade\",\n            \"responseFile\": \"switches.json\"\n        },\n        {\n            \"request\": \"smth\",\n            \"responseFile\": \"smth.json\"\n        }\n    ]\n}\n</code></pre>\n\n<p>So question is: why this code is not the same as code atop? It returns only last response file, described in config.json on all requests from this file? Or what is correct way to write dynamically-defined handlers?</p>\n\n<pre><code>func startServer(config Config) {\n    for _, req := config.Requests {\n        http.HandleFunc(apiPrefix+req.Request,\n            func(w http.ResponseWriter, r *http.Request) {\n                var dataStruct interface{}\n                err := loadJSON(req.ResponseFile, &amp;dataStruct)\n                if err != nil {\n                    w.Write([]byte(\"Oops! Something was wrong\"))\n                }\n                data, _ := json.Marshal(dataStruct)\n                w.Header().Set(\"Content-Type\", \"application/json\")\n                w.Write(data)\n            })\n    }\n\n    http.HandleFunc(\"/\", http.NotFound)\n</code></pre>\n"}, {"tags": ["dictionary", "go", "slice"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1520636103, "post_id": 49203308, "comment_id": 85412175, "body": "<a href=\"https://play.golang.org/p/5oWMX6knkwA\" rel=\"nofollow noreferrer\">play.golang.org/p/5oWMX6knkwA</a> If you haven&#39;t set the value at <code>&quot;vector&quot;</code> key before, the value will be an untyped <code>nil</code> which you cannot type assert to anything."}, {"owner": {"reputation": 5971, "user_id": 5537840, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/aKRoy.jpg?s=128&g=1", "display_name": "Kenenbek Arzymatov", "link": "https://stackoverflow.com/users/5537840/kenenbek-arzymatov"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520637006, "post_id": 49203308, "comment_id": 85412478, "body": "@mkopriva thanks, it works!"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1520637250, "post_id": 49203308, "comment_id": 85412545, "body": "By the way, if the only reason for the map is to have that specific json structure it would be much more sensible, and practical, to define a struct with two fields, one for the string and the other for the vector. <a href=\"https://play.golang.org/p/7jCOj07uU2N\" rel=\"nofollow noreferrer\">play.golang.org/p/7jCOj07uU2N</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520637544, "post_id": 49203308, "comment_id": 85412626, "body": "@mkopriva good catch... I went a little crazy in my answer without stopping to think of WHY this was being done, haha."}], "answers": [{"tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": false, "score": 2, "last_activity_date": 1520637454, "last_edit_date": 1520637454, "creation_date": 1520636819, "answer_id": 49203504, "question_id": 49203308, "link": "https://stackoverflow.com/questions/49203308/store-values-and-slices-in-map/49203504#49203504", "title": "Store values and slices in map", "body": "<p>This will work, but you MUST ALWAYS manually check if the item is in the map AND run type assertions and act on them differently. I suggest making a type and only using methods instead of operating on the map itself.</p>\n\n<p><a href=\"https://play.golang.org/p/e2SFTN70F4v\" rel=\"nofollow noreferrer\">https://play.golang.org/p/e2SFTN70F4v</a></p>\n\n<pre><code>var ErrNotExists = errors.New(\"value doesn't exist\")\nvar ErrWrongType = errors.New(\"variable is wrong type\")\n\ntype MyMap map[string]interface{}\n\nfunc(m MyMap) IsArray(key string) bool {\n    val, ok := m[key]\n    if !ok {\n        return false\n    }\n    _, ok = val.([]string)\n    return ok\n}\n\nfunc(m MyMap) Exists(key string) bool {\n    _, ok := m[key]\n    return ok\n}\n\nfunc(m MyMap) SetString(key, value string) {\n    m[key] = value\n}\n\nfunc(m MyMap) SetArray(key string, value []string) {\n    m[key] = value\n}\n\nfunc(m MyMap) GetString(key string) (string, error) {\n    v, ok := m[key]\n    if !ok {\n        return \"\", ErrNotExists\n    }\n    realVal, ok := v.(string)\n    if !ok {\n        return \"\", ErrWrongType\n    }\n    return realVal, nil\n}\n\nfunc(m MyMap) GetArray(key string) ([]string, error) {\n    v, ok := m[key]\n    if !ok {\n        return nil, ErrNotExists\n    }\n    realVal, ok := v.([]string)\n    if !ok {\n        return nil, ErrWrongType\n    }\n    return realVal, nil\n}\n\nfunc(m MyMap) AppendArray(key string, toAppend []string) error {\n    v, ok := m[key]\n    if !ok {\n        return ErrNotExists\n    }\n    realVal, ok := v.([]string)\n    if !ok {\n        return ErrWrongType\n    }\n    m[key] = append(realVal, toAppend...)\n    return nil\n}\n\nfunc main() {\n    m := make(MyMap)\n    m.SetString(\"string\",\"hello\")\n    m.SetArray(\"array\",[]string{\"hi\",\"there\"})\n    fmt.Println(m)\n    fmt.Println(m.IsArray(\"string\"), m.IsArray(\"array\"))\n    s, err := m.GetString(\"string\")\n    if err != nil { // handle\n        fmt.Println(err)\n    }\n    a, err := m.GetArray(\"array\")\n    if err != nil { // handle\n        fmt.Println(err)\n    }\n    fmt.Println(s,a)\n    m.AppendArray(\"array\", []string{\"all\",\"you\",\"people\"})\n    a, err = m.GetArray(\"array\")\n    if err != nil { // handle\n        fmt.Println(err)\n    }\n    fmt.Println(a)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 153, "user_id": 8522152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e4d2890561489533101b153f549c752?s=128&d=identicon&r=PG&f=1", "display_name": "dchiba", "link": "https://stackoverflow.com/users/8522152/dchiba"}, "is_accepted": false, "score": -1, "last_activity_date": 1520655427, "creation_date": 1520655427, "answer_id": 49205278, "question_id": 49203308, "link": "https://stackoverflow.com/questions/49203308/store-values-and-slices-in-map/49205278#49205278", "title": "Store values and slices in map", "body": "<p>You can do something like this by defining JSON encoding processing of the value of map.</p>\n\n<p><a href=\"https://play.golang.org/p/1IW_hx8clhM\" rel=\"nofollow noreferrer\">https://play.golang.org/p/1IW_hx8clhM</a></p>\n\n<pre><code>package main\n\nimport (\n  \"encoding/json\"\n  \"fmt\"\n)\n\ntype MyMap map[string]MyValue\n\nfunc (m MyMap) Put(k, v string) {\n  if list, ok := m[k]; ok {\n    m[k] = append(list, v)\n  } else {\n    m[k] = []string{v}\n  }\n}\n\ntype MyValue []string\n\nfunc (m MyValue) MarshalJSON() ([]byte, error) {\n  if len(m) == 1 {\n    return json.Marshal(m[0])\n  } else {\n    return json.Marshal([]string(m))\n  }\n}\n\nfunc main() {\n  m := make(MyMap)\n  m.Put(\"string\", \"word\")\n  m.Put(\"vector\", \"earth\")\n  m.Put(\"vector\", \"sun\")\n  if data, err := json.Marshal(m); err == nil {\n    fmt.Println(string(data))\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 5971, "user_id": 5537840, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/aKRoy.jpg?s=128&g=1", "display_name": "Kenenbek Arzymatov", "link": "https://stackoverflow.com/users/5537840/kenenbek-arzymatov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 1, "answer_count": 2, "score": -3, "last_activity_date": 1520655427, "creation_date": 1520635557, "question_id": 49203308, "link": "https://stackoverflow.com/questions/49203308/store-values-and-slices-in-map", "title": "Store values and slices in map", "body": "<p>How can I store values in <code>map</code> which can be both <code>Type</code> and <code>[]Type</code>?</p>\n\n<p>I tried this:</p>\n\n<pre><code>mymap := make(map[string]interface{})\nmymap[\"string\"] = \"word\"\nmymap[\"vector\"] = append(mymap[\"vector\"].([]interface{}), \"earth\")\n</code></pre>\n\n<p>But I have an error:</p>\n\n<pre><code>panic: interface conversion: interface {} is nil, not []interface {}\n</code></pre>\n\n<p>The purpose of such <code>mymap</code> to use it for <code>json.Marshal</code> to get <code>json</code> object like this:</p>\n\n<pre><code>{\n    \"string\": \"word\",\n    \"vector\": [\n        \"earth\",\n        \"sun\"\n    ]\n}\n</code></pre>\n"}, {"tags": ["go", "assembly", "delve"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1520634849, "post_id": 49203089, "comment_id": 85411755, "body": "I&#39;m not 100% sure what you are asking, but have you tried collecting that return value in the noAlloc1 case when you return <code>&amp;values</code> and using it somehow? The compiler is very efficient at discovering useless operations and optimizing. It&#39;s possible the for loop is confusing the compiler optimizations. In fact, have you checked to see if noAlloc1 (being a simple function) is simply being inlined?"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 5, "last_activity_date": 1520646930, "last_edit_date": 1520646930, "creation_date": 1520637385, "answer_id": 49203573, "question_id": 49203089, "link": "https://stackoverflow.com/questions/49203089/golang-doing-unexpected-heap-memory-allocation/49203573#49203573", "title": "golang doing unexpected heap memory allocation", "body": "<p>Escape analysis determines whether any references to a value escape the function in which the value is declared. </p>\n\n<p>In Go, arguments are passed by value, typically on the stack; the stack is reclaimed at the end of the function. However, returning the reference <code>&amp;values</code> from the <code>memAllocRepro</code> function gives the <code>values</code> parameter declared in <code>memAllocRepro</code> a lifetime beyond the end of the function. The <code>values</code> variable is moved to the heap.</p>\n\n<p><code>memAllocRepro</code>: <code>&amp;values</code>: Alloc</p>\n\n<pre><code>./escape.go:3:6: cannot inline memAllocRepro: unhandled op FOR\n./escape.go:7:9: &amp;values escapes to heap\n./escape.go:7:9:    from ~r1 (return) at ./escape.go:7:2\n./escape.go:3:37: moved to heap: values\n</code></pre>\n\n<p>The <code>noAlloc1</code> function is inlined in the <code>main</code> function. The <code>values</code> argument, if necessary, is declared in and does not escape from the <code>main</code> function.</p>\n\n<p><code>noAlloc1</code>: <code>&amp;values</code>: No Alloc</p>\n\n<pre><code>./escape.go:10:6: can inline noAlloc1 as: func([]int)*[]int{return &amp;values}\n./escape.go:23:10: inlining call to noAlloc1 func([]int)*[]int{return &amp;values}\n</code></pre>\n\n<p>The <code>noAlloc2</code> function <code>values</code> argument is returned as <code>values</code>. <code>values</code> is returned on the stack. There is no reference to <code>values</code> in the <code>noAlloc2</code> function and so no escape.</p>\n\n<p><code>noAlloc2</code>: <code>values</code>: No Alloc</p>\n\n<hr>\n\n<pre><code>package main\n\nfunc memAllocRepro(values []int) *[]int {\n    for {\n        break\n    }\n    return &amp;values\n}\n\nfunc noAlloc1(values []int) *[]int {\n    return &amp;values\n}\n\nfunc noAlloc2(values []int) []int {\n    for {\n        break\n    }\n    return values\n}\n\nfunc main() {\n    memAllocRepro(nil)\n    noAlloc1(nil)\n    noAlloc2(nil)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go build -a -gcflags='-m -m' escape.go\n# command-line-arguments\n./escape.go:3:6: cannot inline memAllocRepro: unhandled op FOR\n./escape.go:10:6: can inline noAlloc1 as: func([]int) *[]int { return &amp;values }\n./escape.go:14:6: cannot inline noAlloc2: unhandled op FOR\n./escape.go:21:6: cannot inline main: non-leaf function\n./escape.go:23:10: inlining call to noAlloc1 func([]int) *[]int { return &amp;values }\n./escape.go:7:9: &amp;values escapes to heap\n./escape.go:7:9:    from ~r1 (return) at ./escape.go:7:2\n./escape.go:3:37: moved to heap: values\n./escape.go:11:9: &amp;values escapes to heap\n./escape.go:11:9:   from ~r1 (return) at ./escape.go:11:2\n./escape.go:10:32: moved to heap: values\n./escape.go:14:31: leaking param: values to result ~r1 level=0\n./escape.go:14:31:  from ~r1 (return) at ./escape.go:18:2\n./escape.go:23:10: main &amp;values does not escape\n$ \n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 9469857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce57b8dec78f8cdb1ffc9cab8febafa8?s=128&d=identicon&r=PG&f=1", "display_name": "djme", "link": "https://stackoverflow.com/users/9469857/djme"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 994, "favorite_count": 3, "accepted_answer_id": 49203573, "answer_count": 1, "score": 4, "last_activity_date": 1520647892, "creation_date": 1520634242, "last_edit_date": 1520647892, "question_id": 49203089, "link": "https://stackoverflow.com/questions/49203089/golang-doing-unexpected-heap-memory-allocation", "title": "golang doing unexpected heap memory allocation", "body": "<p>While benchmarking, I noticed a surprising heap memory allocation. After reducing the repro, I ended up with the following: </p>\n\n<pre><code>// --- Repro file ---\nfunc memAllocRepro(values []int) *[]int {\n\n  for {\n        break\n    }\n\n    return &amp;values\n}\n\n// --- Benchmark file ---\nfunc BenchmarkMemAlloc(b *testing.B) {\n\n    values := []int{1, 2, 3, 4}\n\n    for i := 0; i &lt; b.N; i++ {\n        memAllocRepro(values)\n    }\n}\n</code></pre>\n\n<p>And here is the benchmark output:</p>\n\n<pre><code>BenchmarkMemAlloc-4     50000000            40.2 ns/op        32 B/op          1 allocs/op\nPASS\nok      memalloc_debugging  2.113s\nSuccess: Benchmarks passed.\n</code></pre>\n\n<p>Now the funny this is, if I remove the for loop, or if I return the slice directly instead of a slice pointer, there are no more heap alloc: </p>\n\n<pre><code>// --- Repro file ---\nfunc noAlloc1(values []int) *[]int {\n\n    return &amp;values // No alloc!\n}\n\nfunc noAlloc2(values []int) []int {\n  for {\n        break\n    }\n\n    return values // No alloc!\n}\n\n// --- Benchmark file ---\nfunc BenchmarkNoAlloc(b *testing.B) {\n\n    values := []int{1, 2, 3, 4}\n\n    for i := 0; i &lt; b.N; i++ {\n        noAlloc1(values)\n        noAlloc2(values)\n    }\n</code></pre>\n\n<p>Benchmark result: </p>\n\n<pre><code>BenchmarkNoAlloc-4      300000000            4.20 ns/op        0 B/op          0 allocs/op\nPASS\nok      memalloc_debugging  1.756s\nSuccess: Benchmarks passed.\n</code></pre>\n\n<p>I found that very confusing and confirmed with Delve that the disassembly does has an allocation at the start of the memAllocRepro function: </p>\n\n<pre><code>(dlv) disassemble\nTEXT main.memAllocRepro(SB) memalloc_debugging/main.go\n        main.go:10      0x44ce10        65488b0c2528000000      mov rcx, qword ptr gs:[0x28]\n        main.go:10      0x44ce19        488b8900000000          mov rcx, qword ptr [rcx]\n        main.go:10      0x44ce20        483b6110                cmp rsp, qword ptr [rcx+0x10]\n        main.go:10      0x44ce24        7662                    jbe 0x44ce88\n        main.go:10      0x44ce26        4883ec18                sub rsp, 0x18\n        main.go:10      0x44ce2a        48896c2410              mov qword ptr [rsp+0x10], rbp\n        main.go:10      0x44ce2f        488d6c2410              lea rbp, ptr [rsp+0x10]\n        main.go:10      0x44ce34        488d0525880000          lea rax, ptr [rip+0x8825]\n        main.go:10      0x44ce3b        48890424                mov qword ptr [rsp], rax\n=&gt;      main.go:10      0x44ce3f*       e8bcebfbff              call 0x40ba00 runtime.newobject\n</code></pre>\n\n<p>I must say though, once I hit that point, I couldn't easily dig further. I'm pretty sure it would be possible to know at least which type is allocated by looking at the structure pointed to by the RAX register, but I wasn't very successful doing so. It's been a long time since I've read disassembly like this. </p>\n\n<pre><code>(dlv) regs\n   Rip = 0x000000000044ce3f\n   Rsp = 0x000000c042039f30\n   Rax = 0x0000000000455660\n   (...)\n</code></pre>\n\n<p>All that being said, I have 2 questions: \n* Anyone can tell why is there a heap allocation there and if it's \"expected\"? \n* How could I have gone further in my debugging session? Dumping memory to hex has a different address layout and go tool objdump will output disassembly, which mangle the content at the address location</p>\n\n<p>Full function dump with go tool objdump: </p>\n\n<pre><code>TEXT main.memAllocRepro(SB) memalloc_debugging/main.go\n  main.go:10        0x44ce10        65488b0c2528000000  MOVQ GS:0x28, CX            \n  main.go:10        0x44ce19        488b8900000000      MOVQ 0(CX), CX              \n  main.go:10        0x44ce20        483b6110        CMPQ 0x10(CX), SP           \n  main.go:10        0x44ce24        7662            JBE 0x44ce88                \n  main.go:10        0x44ce26        4883ec18        SUBQ $0x18, SP              \n  main.go:10        0x44ce2a        48896c2410      MOVQ BP, 0x10(SP)           \n  main.go:10        0x44ce2f        488d6c2410      LEAQ 0x10(SP), BP           \n  main.go:10        0x44ce34        488d0525880000      LEAQ runtime.types+34656(SB), AX    \n  main.go:10        0x44ce3b        48890424        MOVQ AX, 0(SP)              \n  main.go:10        0x44ce3f        e8bcebfbff      CALL runtime.newobject(SB)      \n  main.go:10        0x44ce44        488b7c2408      MOVQ 0x8(SP), DI            \n  main.go:10        0x44ce49        488b442428      MOVQ 0x28(SP), AX           \n  main.go:10        0x44ce4e        48894708        MOVQ AX, 0x8(DI)            \n  main.go:10        0x44ce52        488b442430      MOVQ 0x30(SP), AX           \n  main.go:10        0x44ce57        48894710        MOVQ AX, 0x10(DI)           \n  main.go:10        0x44ce5b        8b052ff60600        MOVL runtime.writeBarrier(SB), AX   \n  main.go:10        0x44ce61        85c0            TESTL AX, AX                \n  main.go:10        0x44ce63        7517            JNE 0x44ce7c                \n  main.go:10        0x44ce65        488b442420      MOVQ 0x20(SP), AX           \n  main.go:10        0x44ce6a        488907          MOVQ AX, 0(DI)              \n  main.go:16        0x44ce6d        48897c2438      MOVQ DI, 0x38(SP)           \n  main.go:16        0x44ce72        488b6c2410      MOVQ 0x10(SP), BP           \n  main.go:16        0x44ce77        4883c418        ADDQ $0x18, SP              \n  main.go:16        0x44ce7b        c3          RET                 \n  main.go:16        0x44ce7c        488b442420      MOVQ 0x20(SP), AX           \n  main.go:10        0x44ce81        e86aaaffff      CALL runtime.gcWriteBarrier(SB)     \n  main.go:10        0x44ce86        ebe5            JMP 0x44ce6d                \n  main.go:10        0x44ce88        e85385ffff      CALL runtime.morestack_noctxt(SB)   \n  main.go:10        0x44ce8d        eb81            JMP main.memAllocRepro(SB)      \n  :-1           0x44ce8f        cc          INT $0x3\n</code></pre>\n\n<p>Disassemble of the memory pointed to by the RAX register:</p>\n\n<pre><code>(dlv) disassemble -a 0x0000000000455660 0x0000000000455860\n        .:0     0x455660        1800                    sbb byte ptr [rax], al\n        .:0     0x455662        0000                    add byte ptr [rax], al\n        .:0     0x455664        0000                    add byte ptr [rax], al\n        .:0     0x455666        0000                    add byte ptr [rax], al\n        .:0     0x455668        0800                    or byte ptr [rax], al\n        .:0     0x45566a        0000                    add byte ptr [rax], al\n        .:0     0x45566c        0000                    add byte ptr [rax], al\n        .:0     0x45566e        0000                    add byte ptr [rax], al\n        .:0     0x455670        8e66f9                  mov fs, word ptr [rsi-0x7]\n        .:0     0x455673        1b02                    sbb eax, dword ptr [rdx]\n        .:0     0x455675        0808                    or byte ptr [rax], cl\n        .:0     0x455677        17                      ?\n        .:0     0x455678        60                      ?\n        .:0     0x455679        0d4a000000              or eax, 0x4a\n        .:0     0x45567e        0000                    add byte ptr [rax], al\n        .:0     0x455680        c01f47                  rcr byte ptr [rdi], 0x47\n        .:0     0x455683        0000                    add byte ptr [rax], al\n        .:0     0x455685        0000                    add byte ptr [rax], al\n        .:0     0x455687        0000                    add byte ptr [rax], al\n        .:0     0x455689        0c00                    or al, 0x0\n        .:0     0x45568b        004062                  add byte ptr [rax+0x62], al\n        .:0     0x45568e        0000                    add byte ptr [rax], al\n        .:0     0x455690        c0684500                shr byte ptr [rax+0x45], 0x0\n</code></pre>\n"}, {"tags": ["pointers", "dictionary", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1520629350, "post_id": 49202077, "comment_id": 85409458, "body": "Because maps are free to rearrange their contents on the fly, meaning that after the map is modified, the pointer may no longer point at the same value it did when it was created."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1520629429, "post_id": 49202077, "comment_id": 85409487, "body": "However, since your whole problem is that your method receiver is of pointer type... why not just store pointers in your map?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1520631083, "post_id": 49202077, "comment_id": 85410182, "body": "Duplicate. Too lazy to search."}, {"owner": {"reputation": 293, "user_id": 2098298, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f0cc2c45add2377604dc8295fcfe8d27?s=128&d=identicon&r=PG", "display_name": "user13097", "link": "https://stackoverflow.com/users/2098298/user13097"}, "edited": false, "score": 0, "creation_date": 1520766654, "post_id": 49202077, "comment_id": 85442309, "body": "I know the question is a duplicate.  I mention this in the question.  The point is that I was not satisfied with the accepted answers in the original questions, so asked it again with my objections to the previous answers."}, {"owner": {"reputation": 293, "user_id": 2098298, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f0cc2c45add2377604dc8295fcfe8d27?s=128&d=identicon&r=PG", "display_name": "user13097", "link": "https://stackoverflow.com/users/2098298/user13097"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1520767268, "post_id": 49202077, "comment_id": 85442484, "body": "@Adrian, I think that your first comment is the correct answer:  A map can rearrange its content on the fly, contrary to a slice that never does that.  A slice never grows.  So probably the designers of the language felt it would be safer for the programmers not to have a pointer to a value that could change at a time not of their choosing, or to give the map implementation freedom to reuse the relocated memory for something other than a value of the same type."}], "answers": [{"comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1520632311, "post_id": 49202499, "comment_id": 85410680, "body": "Thanks @peterSO your statement that <code>It is a false claim</code> is absolutely right. An upvote"}, {"owner": {"reputation": 293, "user_id": 2098298, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f0cc2c45add2377604dc8295fcfe8d27?s=128&d=identicon&r=PG", "display_name": "user13097", "link": "https://stackoverflow.com/users/2098298/user13097"}, "edited": false, "score": 1, "creation_date": 1520755435, "post_id": 49202499, "comment_id": 85439668, "body": "I am corrected in that cmap[1] += complex(1,0) does not &quot;modify&quot; the map element in place, but a good compiler implementation should not evaluate cmap[1] twice, just as the specification says.  As for my ignorance of map implementation, and even more so for the garbage collection implementation, I will not accept my lack of knowledge as an answer."}, {"owner": {"reputation": 293, "user_id": 2098298, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f0cc2c45add2377604dc8295fcfe8d27?s=128&d=identicon&r=PG", "display_name": "user13097", "link": "https://stackoverflow.com/users/2098298/user13097"}, "edited": false, "score": 0, "creation_date": 1520767582, "post_id": 49202499, "comment_id": 85442562, "body": "Thanks for the video of the map implementor, who answers the question (partially): &quot;It interferes with this growing procedure, so if I take the address of some entry in the bucket, and then I keep that entry around for a long time and in the meantime the map grows, then all of a sudden that pointer points to an old bucket and not a new bucket and that pointer is now invalid, so it&#39;s hard to provide the ability to take the address of a value in a map, without constraining how grow works... C++ grows in a different way, so you can take the address of a bucket&quot; (21:45)"}, {"owner": {"reputation": 293, "user_id": 2098298, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f0cc2c45add2377604dc8295fcfe8d27?s=128&d=identicon&r=PG", "display_name": "user13097", "link": "https://stackoverflow.com/users/2098298/user13097"}, "edited": false, "score": 0, "creation_date": 1520924787, "post_id": 49202499, "comment_id": 85503625, "body": "I accepted this answer because of the reference to the talk by the map implementor."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 14, "last_activity_date": 1611674285, "last_edit_date": 1611674285, "creation_date": 1520631398, "answer_id": 49202499, "question_id": 49202077, "link": "https://stackoverflow.com/questions/49202077/why-doesnt-go-allow-taking-the-address-of-map-value/49202499#49202499", "title": "Why doesn&#39;t Go allow taking the address of map value?", "body": "<p>Let's start with this misconception:</p>\n<blockquote>\n<p>I wanted to modify a map struct value in place. Numeric values in maps\ncan be modified in place using operators like ++ or +=</p>\n<pre><code> func icandothis() {\n    cmap := make(map[int]complex64)\n    cmap[1] += complex(1, 0)\n    fmt.Println(cmap[1])\n }\n</code></pre>\n</blockquote>\n<hr />\n<p>Let's expand the shorthand form:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n)\n\nfunc icandothisShort() {\n    cmap := make(map[int]complex64)\n    cmap[1] += complex(1, 0)\n    fmt.Println(cmap[1])\n}\n\nfunc icandothisLong() {\n    cmap := make(map[int]complex64)\n    // An assignment operation x op= y where op is a binary arithmetic operator\n    // is equivalent to x = x op (y) but evaluates x only once.\n    // cmap[1] += complex(1, 0)\n    v := cmap[1]          // v = zero value = complex(0, 0)\n    v = v + complex(1, 0) // v = complex(0, 0) + complex(1, 0) = complex(1, 0)\n    cmap[1] = v           // cmap[1] = v = complex(1, 0)\n    a := cmap[1]          // a = complex(1, 0)\n    fmt.Println(a)        // complex(1, 0)\n}\n\nfunc main() {\n    icandothisShort()\n    icandothisLong()\n}\n</code></pre>\n<p>Playground: <a href=\"https://play.golang.org/p/1OgmI_AD9uN\" rel=\"nofollow noreferrer\">https://play.golang.org/p/1OgmI_AD9uN</a></p>\n<p>Output:</p>\n<pre><code>(1+0i)\n(1+0i)\n</code></pre>\n<p>As you can see in <code>icandothisLong()</code>, the expanded form of <code>icandothisShort()</code>, there is no update in-place.</p>\n<hr />\n<hr />\n<p>The next misconception,</p>\n<blockquote>\n<p>Maps are backed by memory structures (possibly including arrays) just\nlike slices are.</p>\n<p>So what is the real reason why I can't take the address of a map\nvalue?</p>\n</blockquote>\n<hr />\n<p>Maps are backed by bucket memory structures. A map key, through an imperfect, dynamic hash, identifies a current primary bucket.  The map keys and values are stored in the primary bucket or an overflow bucket. The map buckets are constantly reorganized as map entries are created, updated, and deleted.\nA map entry has no fixed location in memory.</p>\n<p>Here is a fairly detailed explanation of how maps work:</p>\n<p><a href=\"https://www.youtube.com/watch?v=Tl7mi9QmLns\" rel=\"nofollow noreferrer\">GopherCon 2016: Keith Randall - Inside the Map Implementation</a></p>\n"}, {"comments": [{"owner": {"reputation": 293, "user_id": 2098298, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f0cc2c45add2377604dc8295fcfe8d27?s=128&d=identicon&r=PG", "display_name": "user13097", "link": "https://stackoverflow.com/users/2098298/user13097"}, "edited": false, "score": 0, "creation_date": 1520754631, "post_id": 49202933, "comment_id": 85439477, "body": "A pointer to a deleted value in a map should point to whatever valid value is stored at that location at the time, possibly the zero value.  It doesn&#39;t have to be the original value.  Just like a pointer to a slice element may point to something other than the original value if the element has been replaced, by setting it to something else."}], "tags": [], "owner": {"reputation": 9805, "user_id": 736054, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/omJT2.jpg?s=128&g=1", "display_name": "Konrad Borowski", "link": "https://stackoverflow.com/users/736054/konrad-borowski"}, "is_accepted": false, "score": 1, "last_activity_date": 1520634303, "last_edit_date": 1520634303, "creation_date": 1520633378, "answer_id": 49202933, "question_id": 49202077, "link": "https://stackoverflow.com/questions/49202077/why-doesnt-go-allow-taking-the-address-of-map-value/49202933#49202933", "title": "Why doesn&#39;t Go allow taking the address of map value?", "body": "<p>Because an alternative would be to not have <code>delete</code> function. Consider a following example.</p>\n\n<pre><code>m := map[int]int{1: 2}\nv := &amp;m[1]\ndelete(m, 1)\n</code></pre>\n\n<p>What <code>v</code> points to?</p>\n\n<p>There are four possible answers (well, more, but they are just as bad), none of which are satisfactory.</p>\n\n<ul>\n<li><p>A tombstone marking an missing entry. This wouldn't allow for reusing an entry after it was removed from a hash table which would require more common resizes and would waste memory in maps where elements are often deleted.</p></li>\n<li><p>A dangling pointer, which is incompatible with Go memory safety requirements.</p></li>\n<li><p>This is an invalid code. Would require runtime checking for all pointer accesses or implementing Rust style borrow checker.</p></li>\n<li><p>Require values to be behind a pointer which adds an indirection. You can do it yourself by using types like <code>map[int]*int</code>.</p></li>\n</ul>\n\n<p>You may say that a program shouldn't access pointers to a map element after it was deleted. This would be fine in memory unsafe programming language, which Go isn't.</p>\n\n<p>By the way, for reference purposes, other map operations are definitely possible to implement while allowing to take a reference to a map element. A map implementation following C++ iterator invalidation requirements will get those easily - although there is a cost as C++ maps are relatively slow. But if most C++ programs can manage this cost, so can Go.</p>\n"}], "owner": {"reputation": 293, "user_id": 2098298, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f0cc2c45add2377604dc8295fcfe8d27?s=128&d=identicon&r=PG", "display_name": "user13097", "link": "https://stackoverflow.com/users/2098298/user13097"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2548, "favorite_count": 2, "closed_date": 1520945589, "accepted_answer_id": 49202499, "answer_count": 2, "score": 1, "last_activity_date": 1611674285, "creation_date": 1520629276, "last_edit_date": 1520924731, "question_id": 49202077, "link": "https://stackoverflow.com/questions/49202077/why-doesnt-go-allow-taking-the-address-of-map-value", "closed_reason": "Duplicate", "title": "Why doesn&#39;t Go allow taking the address of map value?", "body": "<p>This is the same as <a href=\"https://stackoverflow.com/questions/32495402/why-does-go-forbid-taking-the-address-of-map-member-yet-allows-slice-el\">Why does go forbid taking the address of (&amp;) map member, yet allows (&amp;) slice element?</a> but I'm not satisfied with the accepted answer: \"Slices are backed by a backing array and maps are not.\"</p>\n\n<blockquote>\n  <p>Note:  I have now added my own answer to the referenced question\n  above.</p>\n</blockquote>\n\n<p>The question <a href=\"https://stackoverflow.com/questions/17438253/access-struct-in-map-without-copying\">Access Struct in Map (without copying)</a> is even better, but its accepted answer says you can't modify a field of a struct value in a map because you cannot take its address (which is my question).</p>\n\n<p>Maps are backed by memory structures (possibly including arrays) just like slices are.</p>\n\n<p>So what is the real reason why I can't take the address of a map value?</p>\n\n<p>I wanted to modify a map struct value in place. Numeric values in maps can be modified in place using operators like ++ or +=</p>\n\n<pre><code>     func icandothis() {\n        cmap := make(map[int]complex64)\n        cmap[1] += complex(1, 0)\n        fmt.Println(cmap[1])\n     }\n</code></pre>\n\n<p>But struct values cannot be modified:</p>\n\n<pre><code>type Complex struct {\n    R float32\n    I float32\n}\n\nfunc (x *Complex) Add(c Complex) {\n    x.R += c.R\n    x.I += c.I\n}\n\nfunc but_i_cannot_do_this() {\n    cmap := make(map[int]Complex)\n    //cmap[1].Add(Complex{1, 0})\n    fmt.Println(cmap[1])\n\n}\n\nfunc so_i_have_to_do_this() {\n    cmap := make(map[int]Complex)\n    c := cmap[1]\n    c.Add(Complex{1, 0})\n    cmap[1] = c\n    fmt.Println(cmap[1])\n\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1520629087, "post_id": 49201978, "comment_id": 85409339, "body": "Per <a href=\"https://golang.org/pkg/encoding/gob/#hdr-Basics\" rel=\"nofollow noreferrer\">the documentation</a>, &quot;Nil pointers are not permitted, as they have no value.&quot; You&#39;re writing your own encoding/decoding logic though, so you can encode it any way you choose."}, {"owner": {"reputation": 3428, "user_id": 2138200, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/61faabd8b9d251ddbe957c15517160eb?s=128&d=identicon&r=PG", "display_name": "sthomps", "link": "https://stackoverflow.com/users/2138200/sthomps"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1520629619, "post_id": 49201978, "comment_id": 85409568, "body": "Yeah, I was hoping to avoid having to manually encode this as <a href=\"https://golang.org/src/encoding/gob/encode.go\" rel=\"nofollow noreferrer\">golang.org/src/encoding/gob/encode.go</a> should do most of the work."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1520629703, "post_id": 49201978, "comment_id": 85409605, "body": "It will do most of the work, but it supports what it supports, and what it supports is clearly documented. You should only have to manually encode <code>nil</code>s."}, {"owner": {"reputation": 3428, "user_id": 2138200, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/61faabd8b9d251ddbe957c15517160eb?s=128&d=identicon&r=PG", "display_name": "sthomps", "link": "https://stackoverflow.com/users/2138200/sthomps"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1520630336, "post_id": 49201978, "comment_id": 85409861, "body": "Any suggestions for just encoding <code>nil</code>? I can check for <code>nil</code> then maybe encode it as a string <code>encoder.Encode(&quot;nil&quot;)</code>. However, when I call <code>decoder.Decode(...)</code> it expects a consistent type which won&#39;t work here."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1520634232, "post_id": 49201978, "comment_id": 85411477, "body": "I would ask yourself, why is it so important to make the Node fields un-exported in the first place? It seems to me like some obfuscation that requires extra work, maintenance, and possible bugs, for little payoff."}], "owner": {"reputation": 3428, "user_id": 2138200, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/61faabd8b9d251ddbe957c15517160eb?s=128&d=identicon&r=PG", "display_name": "sthomps", "link": "https://stackoverflow.com/users/2138200/sthomps"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 683, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1520628796, "creation_date": 1520628796, "question_id": 49201978, "link": "https://stackoverflow.com/questions/49201978/how-to-gob-encode-struct-with-unexported-pointer", "title": "How to gob encode struct with unexported pointer?", "body": "<p>I have a struct that I can successfully gob encode and decode as follows:</p>\n\n<pre><code>type Node struct {\n    Value int\n    Next  *Node\n}\n\nmyNode := Node{\n    Value: 1,\n    Next: &amp;Node{\n        Value: 2,\n    },\n}\nvar buf bytes.Buffer\nenc := gob.NewEncoder(&amp;buf)\ndec := gob.NewDecoder(&amp;buf)\nif err := enc.Encode(&amp;myNode); err != nil {\n    panic(err)\n}\nvar decodedNode Node\nif err := dec.Decode(&amp;decodedNode); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>I'd like to now hide the fields of <code>Node</code>:</p>\n\n<pre><code>type Node struct {\n    value int\n    next  *Node\n}\n</code></pre>\n\n<p>Because the fields are no longer exported I have to now write custom <code>GobEncode</code> and <code>GobDecode</code> functions:</p>\n\n<pre><code>func (d *Node) GobEncode() ([]byte, error) {\n    var buf bytes.Buffer\n    encoder := gob.NewEncoder(&amp;buf)\n    if err := encoder.Encode(d.value); err != nil {\n        return nil, err\n    }\n    if err := encoder.Encode(d.next); err != nil {\n        return nil, err\n    }\n    return buf.Bytes(), nil\n}\n\nfunc (d *Node) GobDecode(b []byte) error {\n    buf := bytes.NewBuffer(b)\n    decoder := gob.NewDecoder(buf)\n    if err := decoder.Decode(&amp;d.value); err != nil {\n        return err\n    }\n    if err := decoder.Decode(&amp;d.next); err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<p>This doesn't work because of a nil value in <code>Node.next</code>:</p>\n\n<pre><code>panic: gob: cannot encode nil pointer of type *main.Node [recovered]\n    panic: gob: cannot encode nil pointer of type *main.Node [recovered]\n    panic: gob: cannot encode nil pointer of type *main.Node\n</code></pre>\n\n<p>I'm re-using <code>gob.NewEncoder</code> inside my custom function because I'm trying to re-use as much of the <a href=\"https://golang.org/src/encoding/gob/encode.go\" rel=\"nofollow noreferrer\">encode package</a> as possible.</p>\n\n<p>Any suggestions for getting this working?</p>\n"}, {"tags": ["go", "locking", "mutex"], "answers": [{"comments": [{"owner": {"reputation": 399, "user_id": 3450077, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/648595373/picture?type=large", "display_name": "Francesco", "link": "https://stackoverflow.com/users/3450077/francesco"}, "edited": false, "score": 0, "creation_date": 1520625528, "post_id": 49201190, "comment_id": 85407604, "body": "Well, than it is pretty useless. I will drop go."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 399, "user_id": 3450077, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/648595373/picture?type=large", "display_name": "Francesco", "link": "https://stackoverflow.com/users/3450077/francesco"}, "edited": false, "score": 0, "creation_date": 1520625617, "post_id": 49201190, "comment_id": 85407635, "body": "It does. The write lock (<code>Lock()</code>/<code>Unlock()</code>) is exclusive: only one lock can be held. The read lock (<code>RLock()</code>/<code>RUnlock()</code>) is shared: any number of read locks can be held at the same time, but not at the same time as a write lock."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 399, "user_id": 3450077, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/648595373/picture?type=large", "display_name": "Francesco", "link": "https://stackoverflow.com/users/3450077/francesco"}, "edited": false, "score": 0, "creation_date": 1520625672, "post_id": 49201190, "comment_id": 85407671, "body": "You just have to <i>actually use the lock</i> for it to work... I&#39;ll update answer with some better explanation."}, {"owner": {"reputation": 399, "user_id": 3450077, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/648595373/picture?type=large", "display_name": "Francesco", "link": "https://stackoverflow.com/users/3450077/francesco"}, "edited": false, "score": 1, "creation_date": 1520625778, "post_id": 49201190, "comment_id": 85407714, "body": "Wait, it means that the Lock prevents RLock to lock, but RLock doe not block other read locks. Then I simply totally misunderstood how to use it, which it better :-) Thanks. Silly me"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 399, "user_id": 3450077, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/648595373/picture?type=large", "display_name": "Francesco", "link": "https://stackoverflow.com/users/3450077/francesco"}, "edited": false, "score": 2, "creation_date": 1520625804, "post_id": 49201190, "comment_id": 85407727, "body": "Yes, that&#39;s exactly correct. <code>Lock</code> is exclusive, <code>RLock</code> is shared."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1520625782, "last_edit_date": 1520625782, "creation_date": 1520625114, "answer_id": 49201190, "question_id": 49201112, "link": "https://stackoverflow.com/questions/49201112/getting-confused-on-locks-mutex-in-go/49201190#49201190", "title": "Getting confused on Locks/Mutex in Go", "body": "<p>Never double-lock. Your issue is that you're not wrapping the reads at the end of <code>main</code> in locks - if they don't try to establish a lock, there is nothing to prevent them reading while something else writes (even if the write is using a lock). The lock itself is what provides mutual exclusion (MutEx), so you only get it if you use it consistently:</p>\n\n<pre><code>func main() {\n    a := person{age: 3}\n    fmt.Println(a.age)\n    go func() {\n        a.Lock()\n        time.Sleep(5 * time.Second)\n        a.age = 4\n        fmt.Println(a.age)\n        a.Unlock()\n    }()\n    a.RLock()\n    fmt.Println(a.age)\n    fmt.Println(\"main\", a.age)\n    a.RUnlock()\n    time.Sleep(20 * time.Second)\n}\n</code></pre>\n\n<p>There is no magic happening here; it's actually the calls to <code>Lock</code> and <code>RLock</code> that do the locking. If you don't call them, nothing prevents concurrent accesses. When you call <code>Lock</code>, it waits until it can get the lock all to itself, then it locks it and returns. When you call <code>RLock</code>, it waits until there are no write locks, then grabs a (shared) read lock. It is calling those functions which provides mutual exclusion, not any magic happening behind the scenes.</p>\n"}, {"tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": false, "score": 0, "last_activity_date": 1520686902, "last_edit_date": 1520686902, "creation_date": 1520625716, "answer_id": 49201322, "question_id": 49201112, "link": "https://stackoverflow.com/questions/49201112/getting-confused-on-locks-mutex-in-go/49201322#49201322", "title": "Getting confused on Locks/Mutex in Go", "body": "<pre><code>type person struct {\n    sync.RWMutex\n    age int\n}\n\nfunc main() {\n    a := person{age: 3}\n    fmt.Println(a.age)\n    go func() {\n        a.Lock()\n        time.Sleep(5 * time.Second)\n        a.age = 4\n        fmt.Println(a.age)\n        a.Unlock()\n    }()\n    fmt.Println(a.age)\n    fmt.Println(\"main\", a.age)\n    time.Sleep(20 * time.Second)\n}\n\n\n3 &lt;- 2nd line of `main` fmt.Println(a.age) \n3 &lt;- after go routine fmt.Println(a.age)\nmain 3 &lt;- fmt.Println(\"main\", a.age)\n4 &lt;- goroutine after sleep fmt.Println(a.age)\n</code></pre>\n\n<p>The write lock does not lock the variable and could result in a race condition. (<a href=\"https://blog.golang.org/race-detector\" rel=\"nofollow noreferrer\">https://blog.golang.org/race-detector</a>)</p>\n\n<p>Locks will only synchronize access to <code>a.age</code>, making write access exclusive to a single goroutine at a single time.  It DOES not synchronize your go routines, which will need some sort of additional synchronization.  one of the most common pattern for synchronize the two would be to use a wait group:</p>\n\n<p><a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">https://golang.org/pkg/sync/#WaitGroup</a></p>\n\n<pre><code> func main() {\n        var wg sync.WaitGroup\n        wg.Add(1)\n        a := person{age: 3}\n        fmt.Println(a.age)\n        go func() {\n            defer wg.Done()\n            a.Lock()\n            time.Sleep(5 * time.Second)\n            a.age = 4\n            fmt.Println(a.age)\n            a.Unlock()\n        }()\n        wg.Wait()\n        fmt.Println(a.age)\n    }\n</code></pre>\n\n<p>The wait group synchronizes the two goroutines ensuring that the last print will be 4 </p>\n"}], "owner": {"reputation": 399, "user_id": 3450077, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/648595373/picture?type=large", "display_name": "Francesco", "link": "https://stackoverflow.com/users/3450077/francesco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1816, "favorite_count": 0, "accepted_answer_id": 49201190, "answer_count": 2, "score": 1, "last_activity_date": 1520686902, "creation_date": 1520624809, "question_id": 49201112, "link": "https://stackoverflow.com/questions/49201112/getting-confused-on-locks-mutex-in-go", "title": "Getting confused on Locks/Mutex in Go", "body": "<p>I am trying to build a map. Normally all read can be done in parallel, except when a write comes, than all reads need to be locked. I thought I understood how Mutex work in go but clearly I do not.</p>\n\n<p>I first tried to use a RWMutex write lock:</p>\n\n<pre><code>type person struct {\n    sync.RWMutex\n    age int\n}\n\nfunc main() {\n    a := person{age: 3}\n    fmt.Println(a.age)\n    go func() {\n        a.Lock()\n        time.Sleep(5 * time.Second)\n        a.age = 4\n        fmt.Println(a.age)\n        a.Unlock()\n    }()\n    fmt.Println(a.age)\n    fmt.Println(\"main\", a.age)\n    time.Sleep(20 * time.Second)\n}\n</code></pre>\n\n<p>I somewhat expected that the wrote lock would lock the read operation a.age. Instead I got:</p>\n\n<pre><code>3\n3\nmain 3\n4\n</code></pre>\n\n<p>So I decided to add also a read lock:</p>\n\n<pre><code>func main() {\n    a := person{age: 3}\n    fmt.Println(a.age)\n    go func() {\n        a.Lock()\n        a.RLock()\n        time.Sleep(5 * time.Second)\n        a.age = 4\n        fmt.Println(a.age)\n        a.Unlock()\n        a.RUnlock()\n    }()\n    fmt.Println(a.age)\n    fmt.Println(\"main\", a.age)\n    time.Sleep(20 * time.Second)\n}\n</code></pre>\n\n<p>Even worse, I got:</p>\n\n<pre><code>3\n3\nmain 3\n</code></pre>\n\n<p>Clearly I am not understanding how this works. Thanks for any help.</p>\n"}, {"tags": ["go", "static-files"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1520615597, "post_id": 49198742, "comment_id": 85402645, "body": "The serving is fine (clearly, since it works). The problem is you&#39;re using relative paths in your HTML where you should be using absolute paths (absolute paths begin with a <code>&#47;</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 28286, "user_id": 1995300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GR7Be.jpg?s=128&g=1", "display_name": "helmbert", "link": "https://stackoverflow.com/users/1995300/helmbert"}, "is_accepted": true, "score": 2, "last_activity_date": 1520615653, "creation_date": 1520615653, "answer_id": 49198873, "question_id": 49198742, "link": "https://stackoverflow.com/questions/49198742/golang-handle-static-folder/49198873#49198873", "title": "Golang handle static folder", "body": "<p>Your Go application is not at fault here, your generated HTML output is.</p>\n\n<p>Your error message says that your sub-page tries to load its CSS from <code>http://localhost:8080/cruise_schedule/static/...</code>, when it actually <em>should</em> load from <code>http://localhost:8080/static/...</code>. The first URL will not serve the static file since it's not below the <code>/static</code> prefix, and your application will probably serve its default 404 page (presumably a <code>text/plain</code> page).</p>\n\n<p>To solve this, I'd suggest either using absolute paths for your CSS (<code>&lt;link href=\"/static/...</code>) or using an appropriate <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base\" rel=\"nofollow noreferrer\"><code>&lt;base&gt;</code></a> tag.</p>\n"}], "owner": {"reputation": 354, "user_id": 7313092, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tg3FX.jpg?s=128&g=1", "display_name": "Persi", "link": "https://stackoverflow.com/users/7313092/persi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1073, "favorite_count": 0, "accepted_answer_id": 49198873, "answer_count": 1, "score": -2, "last_activity_date": 1520615653, "creation_date": 1520615243, "question_id": 49198742, "link": "https://stackoverflow.com/questions/49198742/golang-handle-static-folder", "title": "Golang handle static folder", "body": "<p>I'm not able to get files placed in static folder. I'm using gorilla mux package.</p>\n\n<p><strong>main.go</strong> code:</p>\n\n<pre><code>fs := http.FileServer(http.Dir(\"static\"))\nmainRouter.PathPrefix(\"/static/\").Handler(http.StripPrefix(\"/static/\", fs))\nhttp.Handle(\"/\", &amp;mainRouter)\n</code></pre>\n\n<p>Project structure:</p>\n\n<pre><code>static\ntemplates\n--style\n--javascript\n--...\nmain.go\n</code></pre>\n\n<p>When I hit index page:</p>\n\n<blockquote>\n  <p>loclalhost:8080/cruise_schedule</p>\n</blockquote>\n\n<p>I get all stylesheets and js files, but when I jump to another page:</p>\n\n<blockquote>\n  <p>localhost:8080/cruise_schedule/selected_cruise/e58ed042aad24b9b87fba8917c085534</p>\n</blockquote>\n\n<p>I get following errors:</p>\n\n<pre><code>Refused to apply style from 'http://localhost:8080/cruise_schedule/static/style/style.css' because its MIME type ('text/plain') is not a supported stylesheet MIME type, and strict MIME checking is enabled.\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>http://localhost:8080/cruise_schedule/static/javascript/resources.js \n</code></pre>\n\n<p>What should I do in order to properly serve static files?</p>\n"}, {"tags": ["go", "prometheus"], "answers": [{"tags": [], "owner": {"reputation": 24634, "user_id": 83591, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CuiTl.jpg?s=128&g=1", "display_name": "brian-brazil", "link": "https://stackoverflow.com/users/83591/brian-brazil"}, "is_accepted": true, "score": 0, "last_activity_date": 1520614319, "creation_date": 1520614319, "answer_id": 49198485, "question_id": 49198039, "link": "https://stackoverflow.com/questions/49198039/prometheus-count-non-static-data-using-counter/49198485#49198485", "title": "Prometheus count non-static data using counter", "body": "<p>ConstLabels are generally to be avoided. What you want to do is <code>httpRequestInfo.WithLabelValues(\"404\", \"get\").Inc()</code></p>\n\n<p>As this is a counter this should have a <code>_total</code> suffix rather than a <code>_sum</code> which used by summary metrics.</p>\n\n<p>You probably want to use <a href=\"https://godoc.org/github.com/prometheus/client_golang/prometheus/promhttp#InstrumentHandlerCounter\" rel=\"nofollow noreferrer\">InstrumentHandlerCounter</a> rather than implementing all the logic yourself for tracking HTTP requests.</p>\n"}], "owner": {"reputation": 69, "user_id": 5981590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cce6ff2e2b80392134e9b686af851bee?s=128&d=identicon&r=PG&f=1", "display_name": "bharat nc", "link": "https://stackoverflow.com/users/5981590/bharat-nc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 0, "accepted_answer_id": 49198485, "answer_count": 1, "score": 0, "last_activity_date": 1520616416, "creation_date": 1520612596, "last_edit_date": 1520616416, "question_id": 49198039, "link": "https://stackoverflow.com/questions/49198039/prometheus-count-non-static-data-using-counter", "title": "Prometheus count non-static data using counter", "body": "<p>I'm trying to count the number of unique URI's and keep a count of them. These URI's change over time and there can be multiple URIs of the same type. For example, there can be multiple \"/foo\" and \"/bar\" and a new URI can come in - lets say \"pooh\" - and I've to add them to the counter and keep count. In this case, I cannot use constant labels. For instance, if I were to count the number of http requests by method and/or status code, I can do this:</p>\n\n<pre><code>    httpRequestInfo := prometheus.NewCounterVec(\n        prometheus.CounterOpts{\n            Name:        \"http_requests_sum\",\n            ConstLabels: prometheus.Labels{\"component\": \"foo\"},\n            Help:        \" A Counter of the number of each type of request by status code and method\",\n        },\n        []string{\"code\", \"method\"},\n    )\n</code></pre>\n\n<p>How could I use counters in this scenario? Thanks!</p>\n"}, {"tags": ["go", "couchbase", "distributed-computing"], "answers": [{"comments": [{"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "edited": false, "score": 0, "creation_date": 1520613027, "post_id": 49198090, "comment_id": 85401164, "body": "Ok, I fix these issues based on your recommendation and it&#39;s working. Thanks"}], "tags": [], "owner": {"reputation": 22757, "user_id": 40015, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/4b0eb78ea5852ee0f54bfd6a2252c99e?s=128&d=identicon&r=PG", "display_name": "Matthew Groves", "link": "https://stackoverflow.com/users/40015/matthew-groves"}, "is_accepted": true, "score": 0, "last_activity_date": 1520612787, "creation_date": 1520612787, "answer_id": 49198090, "question_id": 49197790, "link": "https://stackoverflow.com/questions/49197790/couchbase-operation-has-timed-out-if-there-is-more-than-one-node/49198090#49198090", "title": "Couchbase operation has timed out if there is more than one node", "body": "<p>First, I'd recommend you use the official Couchbase image instead of <code>arungupta/couchbase</code>, since that is not maintained.</p>\n\n<p>Second, is your Go code running within the docker host? I suspect it is not, and that's the reason you're running into this issue. The Go client needs to be able to reach every Couchbase node. Outside of the docker host, it will only be able to get to one.</p>\n\n<p>My recommendation is to move your Go client inside of the docker host.</p>\n"}], "owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 472, "favorite_count": 0, "accepted_answer_id": 49198090, "answer_count": 1, "score": 1, "last_activity_date": 1520612787, "creation_date": 1520611841, "question_id": 49197790, "link": "https://stackoverflow.com/questions/49197790/couchbase-operation-has-timed-out-if-there-is-more-than-one-node", "title": "Couchbase operation has timed out if there is more than one node", "body": "<p>I would implement a distributed counter which works well if the couchbase cluster have only one node, but when I add a new one it's return an <code>operation has timed out</code> for every type of operation on the bucket:</p>\n\n<pre><code>type Incrementer struct {\n    bucket  *gocb.Bucket\n    gap     uint64\n    initial int64\n    ttl     uint32\n}\n\nfunc New(conn, bucketName, bucketPassword string, gap uint64, initial int64) *Incrementer {\n    cluster, err := gocb.Connect(conn)\n    if err != nil {\n        fmt.Println(\"ERRROR CONNECTING TO CLUSTER:\", err)\n        return nil\n    }\n\n    // Open Bucket\n    bucket, err := cluster.OpenBucket(bucketName, bucketPassword)\n    if err != nil {\n        fmt.Println(\"ERRROR OPENING BUCKET:\", err)\n        return nil\n    }\n\n    return &amp;Incrementer{\n        bucket:  bucket,\n        gap:     gap,\n        initial: initial,\n    }\n}\n\nfunc (i *Incrementer) Add(key string) error {\n    var current interface{}\n    cas, err := i.bucket.GetAndLock(key, i.ttl, &amp;current)\n    if err == gocb.ErrKeyNotFound {\n    _, _, err := i.bucket.Counter(key, 1, i.initial, 0)\n    if err != nil {\n        return err\n    }\n    }\n    if err != nil {\n        return err\n    }\n    newValue := current.(float64) + 1\n    if newValue &gt;= float64(i.gap) {\n        newValue = float64(i.initial)\n    }\n    _, err = i.bucket.Replace(key, newValue, cas, 0)*/\n\n    // https://developer.couchbase.com/documentation/server/3.x/developer/dev-guide-3.0/lock-items.html\n\n    return err\n}\n</code></pre>\n\n<p>Mostly this is the whole code and there is a docker compose as well: </p>\n\n<pre><code>version: \"3\"\nservices:\n  cb1:\n    image: arungupta/couchbase\n    deploy:\n      replicas: 2\n    ports:\n      - 8091:8091\n      - 8092:8092\n      - 8093:8093\n      - 8094:8094\n      - 11210:11210\n    links:\n      - cb2\n\n  cb2:\n    image: arungupta/couchbase\n    deploy:\n      replicas: 2\n</code></pre>\n\n<p>Scenario:\nWhen I setup the docker architect there is only one node because I have to add it manually in the Couchbase's UI. That's fine, it's working properly, but when I add the second server with the <code>Add Server</code> button, and try to use it again the <code>Add(key)</code> returns an <code>operation has timed out</code>. I figured out this error comes from the <code>i.bucket.GetAndLock(key, i.ttl, &amp;current)</code> part. </p>\n\n<p>I don't really understand why is it not doing the same as it working when there is only one node.</p>\n"}, {"tags": ["go", "heap", "priority-queue"], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1520611798, "post_id": 49197474, "comment_id": 85400500, "body": "removing elements from the heap slice, even while maintaining order, can break the heap invariants. Since you need to  re-heapify the slice anyway, it&#39;s much faster to not maintain slice order."}, {"owner": {"reputation": 143, "user_id": 2855831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29dec7ccaaff52ec670d33a5861bec15?s=128&d=identicon&r=PG&f=1", "display_name": "thisischuck", "link": "https://stackoverflow.com/users/2855831/thisischuck"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1520612170, "post_id": 49197474, "comment_id": 85400687, "body": "Good point, the main point for me here is to demonstrate that the heap is interanaly a slice so looking for a way to remove multiple elements from a heap at one time might mean that you should reconsider the data structure being used."}], "tags": [], "owner": {"reputation": 143, "user_id": 2855831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29dec7ccaaff52ec670d33a5861bec15?s=128&d=identicon&r=PG&f=1", "display_name": "thisischuck", "link": "https://stackoverflow.com/users/2855831/thisischuck"}, "is_accepted": false, "score": 1, "last_activity_date": 1520610794, "creation_date": 1520610794, "answer_id": 49197474, "question_id": 49195779, "link": "https://stackoverflow.com/questions/49195779/remove-elements-from-priority-queue-in-golang/49197474#49197474", "title": "Remove elements from priority queue in golang", "body": "<p>In order to answer this question we first need to understand what a heap is.  Heaps are a data structure that allow us to find the largest or smallest value depending on whether it is a Min Heap or a Max Heap.  To do this quickly, the computer maintains a tree, this image sums it up quite well.  This is a max heap:</p>\n\n<p><a href=\"https://i.stack.imgur.com/jFI0z.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/jFI0z.png\" alt=\"Max-heap diagram, nine nodes\"></a></p>\n\n<p>Of course computer's memory aren't laid out in trees, they are laid out linearly.  In fact, go stores heaps in slices, which means that you can iterate through the slice and remove elements like you'd normally do, for example:</p>\n\n<pre><code>  for i:=0; i&lt;len(heap); i++ {  \n    for _, element := heap {\n      if element == to_remove {\n        heap = append(heap[:i], heap[i+1:])\n        i--\n      }\n    }\n  }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1520618044, "last_edit_date": 1520618044, "creation_date": 1520612806, "answer_id": 49198096, "question_id": 49195779, "link": "https://stackoverflow.com/questions/49195779/remove-elements-from-priority-queue-in-golang/49198096#49198096", "title": "Remove elements from priority queue in golang", "body": "<p>Since the underlying data structure of your heap is a slice, you can remove the elements directly from the slice and re-initialize the heap again after.</p>\n\n<p>Starting from your example:</p>\n\n<pre><code>for _, event := range events {\n    i := event.GetIndex()\n    queue[i], queue[len(queue)-1] = queue[len(queue)-1], queue[i]\n    queue = queue[:len(queue)-1]\n}\nheap.Init(&amp;queue)\n</code></pre>\n\n<p>And a working example: <a href=\"https://play.golang.org/p/-KMEilCm3t9\" rel=\"nofollow noreferrer\">https://play.golang.org/p/-KMEilCm3t9</a></p>\n\n<pre><code>func main() {\n    h := IntHeap{1, 5, 2, 9, 8, 3, 7}\n\n    toRemove := 8\n    for i := 0; i &lt; len(h); i++ {\n        n := h[i]\n        if n == toRemove {\n            h[i], h[len(h)-1] = h[len(h)-1], h[i]\n            h = h[:len(h)-1]\n            i--\n        }\n    }\n\n    heap.Init(&amp;h)\n    fmt.Println(h)\n}\n</code></pre>\n"}], "owner": {"reputation": 5971, "user_id": 5537840, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/aKRoy.jpg?s=128&g=1", "display_name": "Kenenbek Arzymatov", "link": "https://stackoverflow.com/users/5537840/kenenbek-arzymatov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1219, "favorite_count": 0, "accepted_answer_id": 49198096, "answer_count": 2, "score": 1, "last_activity_date": 1520618044, "creation_date": 1520605222, "question_id": 49195779, "link": "https://stackoverflow.com/questions/49195779/remove-elements-from-priority-queue-in-golang", "title": "Remove elements from priority queue in golang", "body": "<p>I take the full realization of priority queue from <a href=\"https://golang.org/pkg/container/heap/#example__priorityQueue\" rel=\"nofollow noreferrer\">golang docs</a>. I'm interesting in removing several elements at once like <code>heap.Remove(&amp;queue, index1, index2, ...)</code>.</p>\n\n<p>Now it can be done in the straightforward way:</p>\n\n<pre><code>for _, event := range events {\n    heap.Remove(&amp;queue, event.getIndex())\n}\n</code></pre>\n\n<p>But this method has an overhead because every call to <code>heap.Remove</code> reorganizes tree. It seems  more efficient if we can remove all unnecessary elements firstly and only then reorganize tree. </p>\n\n<p>How it can be implemented?</p>\n"}, {"tags": ["mongodb", "go", "trim"], "comments": [{"owner": {"reputation": 882, "user_id": 3984522, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/6D9an.jpg?s=128&g=1", "display_name": "hsrv", "link": "https://stackoverflow.com/users/3984522/hsrv"}, "edited": false, "score": 0, "creation_date": 1520602879, "post_id": 49194388, "comment_id": 85394874, "body": "First, it seems that it&#39;s better to use <code>strings.TrimSpace</code> <a href=\"https://golang.org/pkg/strings/#TrimSpace\" rel=\"nofollow noreferrer\">golang.org/pkg/strings/#TrimSpace</a> to trim white space, it covers more cases. Second, it&#39;s not clear what you mean when you&#39;re speaking about sanitizing messages like that: <code>&quot;username&quot;: {&quot;$ne&quot;: null}</code>. Do you want to get rid of all characters like <code>&quot;:{$}</code> and make it like <code>username ne null</code>? But in that case you still have the length greater than 0."}], "answers": [{"comments": [{"owner": {"reputation": 465, "user_id": 1936173, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/8uQ1j.png?s=128&g=1", "display_name": "Illia Danko", "link": "https://stackoverflow.com/users/1936173/illia-danko"}, "edited": false, "score": 1, "creation_date": 1520870210, "post_id": 49196647, "comment_id": 85482528, "body": "also, you can use a raw string literal `` which makes an escape character unnecessary."}], "tags": [], "owner": {"reputation": 78, "user_id": 2790407, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf35247b7ced6e3b77ab9ba1e6509644?s=128&d=identicon&r=PG", "display_name": "zitryss", "link": "https://stackoverflow.com/users/2790407/zitryss"}, "is_accepted": false, "score": 1, "last_activity_date": 1520608058, "creation_date": 1520608058, "answer_id": 49196647, "question_id": 49194388, "link": "https://stackoverflow.com/questions/49194388/golang-mongodb-sanitize-input/49196647#49196647", "title": "golang + mongodb: sanitize input", "body": "<p>You need to escape the backslash in order to get rid of error.</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    firstName := \" ^$/  Hans \\\\ ^$  \"\n    sanitizedName := strings.Trim(firstName, \" $/^\\\\\")\n    fmt.Println(sanitizedName)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Hans\n</code></pre>\n"}], "owner": {"reputation": 167, "user_id": 4980627, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/39c107b0083f191b32a0ad45dc9afea6?s=128&d=identicon&r=PG&f=1", "display_name": "equalsound", "link": "https://stackoverflow.com/users/4980627/equalsound"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 596, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1520608058, "creation_date": 1520600426, "question_id": 49194388, "link": "https://stackoverflow.com/questions/49194388/golang-mongodb-sanitize-input", "title": "golang + mongodb: sanitize input", "body": "<p>I would like to verify the users' input before inserting it into the database. With this trim function, I can check whether the input was empty was empty or not.</p>\n\n<pre><code>if len(strings.Trim(r.Form.Get(\"firstName\"), \" \")) == 0 {\n</code></pre>\n\n<p>But I would like also to detect messages like these: </p>\n\n<pre><code>\"username\": {\"$ne\": null}\n</code></pre>\n\n<p>I tried stuff <code>like if len(strings.Trim(r.Form.Get(\"firstName\"), \" $/^\\\")) == 0 {</code>, but always get errors concerning the signs. What am I doing wrong?</p>\n"}, {"tags": ["go", "flags"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1520597657, "post_id": 49193480, "comment_id": 85391691, "body": "<a href=\"https://golang.org/pkg/flag/#FlagSet\" rel=\"nofollow noreferrer\">golang.org/pkg/flag/#FlagSet</a>. The exported functions you&#39;re calling are using <a href=\"https://golang.org/pkg/flag/#CommandLine\" rel=\"nofollow noreferrer\">this FlagSet</a> underneath. Use <code>NewFlagSet</code> to have as many sets as you&#39;d like."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1520604736, "post_id": 49193480, "comment_id": 85396032, "body": "@mkopriva Unfortunately <code>FlagSet</code> can&#39;t be used to solve it, see my answer for a counter-example."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1520606827, "post_id": 49193480, "comment_id": 85397317, "body": "@icza thanks, that&#39;s a great answer and counter-example."}], "answers": [{"comments": [{"owner": {"reputation": 1038, "user_id": 665650, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/6072b58060c96b1ca779bd40bcaef8d9?s=128&d=identicon&r=PG", "display_name": "Elfs\u042fUs", "link": "https://stackoverflow.com/users/665650/elfs%d0%afus"}, "edited": false, "score": 0, "creation_date": 1520623230, "post_id": 49195212, "comment_id": 85406565, "body": "As to why I need to register a flag twice by the same name, I have reusable service components that may contain the same flag.  A service may contain zero or more components with the same flag, thus individual components that require specific flags don&#39;t know if those flags have already been registered by another component.  Your suggestion to have a global container for the flags is a good alternative, but was hoping to avoid that since the flags package is already basically doing just that."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1520606289, "last_edit_date": 1520606289, "creation_date": 1520603233, "answer_id": 49195212, "question_id": 49193480, "link": "https://stackoverflow.com/questions/49193480/golang-flag-redefined/49195212#49195212", "title": "Golang flag redefined", "body": "<p>Unfortunately there isn't an easier way with the standard library, because every flag may only be registered once. We'll see how we can simplify your code, and also what we can do to avoid this pattern.</p>\n\n<h2>Flag.FlagSet doesn't help</h2>\n\n<p>The usage of <a href=\"https://golang.org/pkg/flag/#FlagSet\" rel=\"noreferrer\"><code>flag.FlagSet</code></a> is not a solution, it was designed to support subcommands (see this question for an example: <a href=\"https://stackoverflow.com/questions/24504024/defining-independent-flagsets-in-golang\">Defining Independent FlagSets in GoLang</a>).</p>\n\n<p>To demonstrate why it doesn't help: let's assume you have 2 flagsets (one may be the detaulf of the <code>flag</code> package). The first flagset may contain the <code>\"foo\"</code> and <code>\"bar\"</code> flags, and the second flagset may contain the <code>\"foo\"</code> and <code>\"baz\"</code> flags. What happens if the user provides values for all 3? The call to <a href=\"https://golang.org/pkg/flag/#FlagSet.Parse\" rel=\"noreferrer\"><code>FlagSet.Parse()</code></a> of the first flagset will report an error:</p>\n\n<blockquote>\n  <p>flag provided but not defined: -baz</p>\n</blockquote>\n\n<p>And similarly the <code>FlagSet.Parse()</code> of the second flagset would also report error for undefined <code>-bar</code>.</p>\n\n<h2>Simplifying your code</h2>\n\n<p>If you want to keep your approach, note that you can simplify your code by using flag vars (<a href=\"https://golang.org/pkg/flag/#StringVar\" rel=\"noreferrer\"><code>flag.StringVar()</code></a>), and then in <code>initFlags()</code> you can simply get a <code>string</code> value and assign to your flag variable like this:</p>\n\n<pre><code>var foo string\n\nfunc init() {\n    if flag.Lookup(\"foo\") == nil {\n        flag.StringVar(&amp;foo, \"foo\", \"\", \"this is foo\")\n    }\n}\n\nfunc initFlags() {\n    // \"foo\" does exist: if noone else registered it, then we did\n    foo = flag.Lookup(\"foo\").Value.(flag.Getter).Get().(string)\n}\n\nfunc main() {\n    flag.Parse()\n    initFlags()\n    ...\n}\n</code></pre>\n\n<p>Also if you want to handle multiple flags like this, then you should create helper functions to not repeat the (now less \"ugly\") code:</p>\n\n<pre><code>func regStringVar(p *string, name string, value string, usage string) {\n    if flag.Lookup(name) == nil {\n        flag.StringVar(p, name, value, usage)\n    }\n}\n\nfunc getStringFlag(name string) string {\n    return flag.Lookup(name).Value.(flag.Getter).Get().(string)\n}\n</code></pre>\n\n<p>And using the above helpers, registering 3 flag variables is like:</p>\n\n<pre><code>var foo, bar, baz string\n\nfunc init() {\n    regStringVar(&amp;foo, \"foo\", \"\", \"this is foo\")\n    regStringVar(&amp;bar, \"bar\", \"\", \"this is bar\")\n    regStringVar(&amp;baz, \"baz\", \"\", \"this is baz\")\n}\n\nfunc initFlags() {\n    foo = getStringFlag(\"foo\")\n    bar = getStringFlag(\"bar\")\n    baz = getStringFlag(\"baz\")\n}\n\nfunc main() {\n    flag.Parse()\n    initFlags()\n    ...\n}\n</code></pre>\n\n<h2>Solution?</h2>\n\n<p>The obvious solution would be to use different names. If common names may collide, you may prefix them e.g. with the package name or something. But you should use different, distinct, unique names.</p>\n\n<p>Think about it. If you want to use the same flag (same by <em>name</em>), why are you attempting to register it twice, at 2 different places?</p>\n\n<p>If you do want to use the same flag from multiple places, then \"outsource\" the flag variable and its registration. E.g. create a package that will take care of this, and from both places where it's needed, refer to this package. Or make sure to distribute the values of the flag variable to places where it's needed.</p>\n"}], "owner": {"reputation": 1038, "user_id": 665650, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/6072b58060c96b1ca779bd40bcaef8d9?s=128&d=identicon&r=PG", "display_name": "Elfs\u042fUs", "link": "https://stackoverflow.com/users/665650/elfs%d0%afus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12108, "favorite_count": 0, "accepted_answer_id": 49195212, "answer_count": 1, "score": 11, "last_activity_date": 1520606289, "creation_date": 1520597213, "question_id": 49193480, "link": "https://stackoverflow.com/questions/49193480/golang-flag-redefined", "title": "Golang flag redefined", "body": "<p>I have flags that may be defined in multiple components.  Its not possible to know if a component has already defined a flag, as such if two components Foo and Bar require flag Zed, but Foo and Bar must define flag Zed.  In this case, Go's flag's will panic with an error flag redefined.</p>\n\n<p>Is there any way to optionally initialize a flag only if it hasn't been initialized elsewhere?  Or alternatively check if a flag has already been set and if it has then lookup the flag value?</p>\n\n<p>The only way I see to do this is with something like this:</p>\n\n<pre><code>var fooFlag *string\n\nfunc init() {\n    if flag.Lookup(\"foo\") == nil {\n        fooFlag = flag.String(\"foo\", \"\", \"some flag foo\")\n    }\n}\n\nfunc initFlags() {\n    if fooFlag == nil &amp;&amp; flag.Lookup(\"foo\") != nil {\n        temp := (*flag.Lookup(\"foo\")).Value.(flag.Getter).Get().(string)\n        fooFlag = &amp;temp\n    }\n}\n\nfunc main() {\n    flag.Parse()\n    initFlags()\n    ...\n}\n</code></pre>\n\n<p>But this is incredibly ugly (and not sure how well this will work).  Any thoughts on a better way to go about this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 882, "user_id": 3984522, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/6D9an.jpg?s=128&g=1", "display_name": "hsrv", "link": "https://stackoverflow.com/users/3984522/hsrv"}, "edited": false, "score": 0, "creation_date": 1520602005, "post_id": 49192638, "comment_id": 85394322, "body": "There is a function <code>Client.Put(ctx context.Context, key *Key, src interface{}) (*Key, error)</code> <a href=\"https://godoc.org/cloud.google.com/go/datastore#Client.Put\" rel=\"nofollow noreferrer\">godoc.org/cloud.google.com/go/datastore#Client.Put</a> which saves entities into the datastore. Does it work?"}, {"owner": {"reputation": 63, "user_id": 5978740, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/195499d253943fe718f814d1239030b0?s=128&d=identicon&r=PG", "display_name": "Vikas Taank", "link": "https://stackoverflow.com/users/5978740/vikas-taank"}, "reply_to_user": {"reputation": 882, "user_id": 3984522, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/6D9an.jpg?s=128&g=1", "display_name": "hsrv", "link": "https://stackoverflow.com/users/3984522/hsrv"}, "edited": false, "score": 0, "creation_date": 1521716638, "post_id": 49192638, "comment_id": 85854941, "body": "thanks, it worked. Got that same method is for saving and updating"}, {"owner": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "edited": false, "score": 0, "creation_date": 1522682944, "post_id": 49192638, "comment_id": 86234587, "body": "Question is about datastore not about the cloud storage. please update the question"}, {"owner": {"reputation": 63, "user_id": 5978740, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/195499d253943fe718f814d1239030b0?s=128&d=identicon&r=PG", "display_name": "Vikas Taank", "link": "https://stackoverflow.com/users/5978740/vikas-taank"}, "reply_to_user": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "edited": false, "score": 0, "creation_date": 1522841992, "post_id": 49192638, "comment_id": 86308077, "body": "@mchampaneri thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 2384, "user_id": 9280994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/378f51f8fdf92e078e0fd52507fed62f?s=128&d=identicon&r=PG&f=1", "display_name": "Jonathan R", "link": "https://stackoverflow.com/users/9280994/jonathan-r"}, "is_accepted": false, "score": 0, "last_activity_date": 1520602632, "creation_date": 1520602632, "answer_id": 49195051, "question_id": 49192638, "link": "https://stackoverflow.com/questions/49192638/how-to-edit-an-existing-data-in-cloud-storage-of-gcp-using-an-api-in-golang/49195051#49195051", "title": "how to edit an existing data in cloud storage of GCP using an api in golang", "body": "<p>I would update like this:</p>\n\n<pre><code>currentCustomer := &amp;Customer{}\n_, err := client.RunInTransaction(ctx, func(tx *datastore.Transaction) error {\n    if getErr := tx.Get(key, currentCustomer); getErr != nil {\n        return getErr\n    }\n\n    // edit your object\n\n    var putErr error\n    _, putErr = tx.Put(key, updatedCustomer)\n\n    return putErr\n})\nif err != nil {\n    return nil, err\n}\n_, err = client.Put(ctx, key, customer)\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 5978740, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/195499d253943fe718f814d1239030b0?s=128&d=identicon&r=PG", "display_name": "Vikas Taank", "link": "https://stackoverflow.com/users/5978740/vikas-taank"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1522842332, "creation_date": 1520594496, "last_edit_date": 1522842332, "question_id": 49192638, "link": "https://stackoverflow.com/questions/49192638/how-to-edit-an-existing-data-in-cloud-storage-of-gcp-using-an-api-in-golang", "title": "how to edit an existing data in cloud storage of GCP using an api in golang", "body": "<p>I am creating an application which is communicating with google datastore, to fetch the existing data, and perform add, edit and delete operations on that existing data. I am able to fetch the existing data, and delete the data there. But not getting how to edit/update the data there through api in golang.</p>\n\n<p>Giving the code snippet which I am trying to execute for this :</p>\n\n<pre><code>    func EditCustomer(w http.ResponseWriter, r *http.Request){\n    ctx := context.Background()\n    params := mux.Vars(r)\n    customer_id :=params[\"partner_id\"]\n    projectID := util.MustGetenv(\"GOOGLE_CLOUD_PROJECT\")\n    client, err := datastore.NewClient(ctx, projectID)\n    if err != nil {\n        log.Fatalf(\"Failed to create client: %v\", err)\n    }\n    var customer models.Customer\n    kind := util.MustGetenv(\"DATA_STORE_KIND\") \n    ds.EditCustomer(client,kind,customer_id,&amp;customer,ctx)\n    json.NewEncoder(w).Encode(customer)\n}\n</code></pre>\n\n<p>EditCustomer method in dao is as :</p>\n\n<pre><code> func EditCustomer(client *datastore.Client,kind string ,name string,dst interface{},ctx context.Context) {\n    taskKey := datastore.NameKey(kind, name, nil)\n\n    &lt; some methos here to edit and update itin datstorage  &gt;\n}\n</code></pre>\n\n<p>Please advise for this. Anybody there who working with api's dev in golang ?</p>\n"}, {"tags": ["rest", "go", "kubernetes", "minikube"], "comments": [{"owner": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "edited": false, "score": 1, "creation_date": 1520598086, "post_id": 49192508, "comment_id": 85391920, "body": "Minikube is essentially a single Node kubernetes. Resources available on a Node should be part of the v1.Node object. The status member should contain information about allocatable RAM."}, {"owner": {"reputation": 923, "user_id": 2822921, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/a240cddfed87fa7da86cb9e4b1d6ef05?s=128&d=identicon&r=PG&f=1", "display_name": "Ashwin", "link": "https://stackoverflow.com/users/2822921/ashwin"}, "reply_to_user": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "edited": false, "score": 0, "creation_date": 1520664161, "post_id": 49192508, "comment_id": 85417350, "body": "I will be running the same in K8S cluster as-well. In that case also v1.Node works fine ?"}, {"owner": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "edited": false, "score": 0, "creation_date": 1520697105, "post_id": 49192508, "comment_id": 85426382, "body": "Yes, you can issue requests to the apiserver to get node information, either all the nodes, or a specific node by name. In those objects will be information about node capacities. And a specific pod can get its node ip and name via the downward api."}], "answers": [{"tags": [], "owner": {"reputation": 923, "user_id": 2822921, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/a240cddfed87fa7da86cb9e4b1d6ef05?s=128&d=identicon&r=PG&f=1", "display_name": "Ashwin", "link": "https://stackoverflow.com/users/2822921/ashwin"}, "is_accepted": true, "score": 7, "last_activity_date": 1520876667, "creation_date": 1520876667, "answer_id": 49241452, "question_id": 49192508, "link": "https://stackoverflow.com/questions/49192508/find-the-available-ram-using-go-api/49241452#49241452", "title": "Find the available RAM using GO API", "body": "<p>This code will fetch the available memory of the first cluster</p>\n\n<pre><code>nodeList, err := f.KubeClient.CoreV1().Nodes().List(metav1.ListOptions{})\n\nif err == nil {\n   if len(nodeList.Items) &gt; 0 {\n        node := &amp;nodeList.Items[0]\n        memQuantity := node.Status.Allocatable[v1.ResourceMemory]\n        totalMemAvail = int(memQuantity.Value() &gt;&gt; 20)\n    } else {\n        t.Fatal(\"Unable to read node list\")\n        return\n    }\n} else {\n    t.Fatalf(\"Error while reading node list data: %v\", err)\n}\n</code></pre>\n"}], "owner": {"reputation": 923, "user_id": 2822921, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/a240cddfed87fa7da86cb9e4b1d6ef05?s=128&d=identicon&r=PG&f=1", "display_name": "Ashwin", "link": "https://stackoverflow.com/users/2822921/ashwin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 578, "favorite_count": 1, "accepted_answer_id": 49241452, "answer_count": 1, "score": 6, "last_activity_date": 1520876667, "creation_date": 1520594040, "last_edit_date": 1520595517, "question_id": 49192508, "link": "https://stackoverflow.com/questions/49192508/find-the-available-ram-using-go-api", "title": "Find the available RAM using GO API", "body": "<p>I am using the Minikube environment and I have defined the max memory using</p>\n\n<pre><code>$] minikube config set memory 2048\n</code></pre>\n\n<p>Now I want to get this memory value using the Kubernetes API call in GO.\nI have tried the following,</p>\n\n<pre><code>import (\n    \"k8s.io/client-go/kubernetes\"\n    \"k8s.io/client-go/rest\"\n)\n\navailableMem := kubernetes.Interface.StorageV1beta1().RESTClient().Get().Name(\"config\")\n</code></pre>\n\n<p>But the output is not in readable manner.</p>\n"}, {"tags": ["parsing", "go", "time", "format"], "answers": [{"tags": [], "owner": {"reputation": 3489, "user_id": 9434800, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/469a55ff2e5beb918a1ba26465ed5518?s=128&d=identicon&r=PG&f=1", "display_name": "Mickael B.", "link": "https://stackoverflow.com/users/9434800/mickael-b"}, "is_accepted": true, "score": 0, "last_activity_date": 1520593664, "creation_date": 1520593664, "answer_id": 49192397, "question_id": 49192011, "link": "https://stackoverflow.com/questions/49192011/why-time-format-and-parse-gives-different-results/49192397#49192397", "title": "Why time format and parse gives different results?", "body": "<p>The difference is on the precision of the date.</p>\n\n<p>Your <code>time.Now()</code> returns a result with 6 decimals (Microseconds) and you try to format a time with 3 decimals (Milliseconds).</p>\n\n<p>You have to Round your time at Milliseconds like that : </p>\n\n<pre><code>t := time.Now().Round(time.Millisecond)\n</code></pre>\n"}], "owner": {"reputation": 85, "user_id": 5552235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff816ed295b6f9b90f686b07e962e7e7?s=128&d=identicon&r=PG&f=1", "display_name": "platzmaPritzma", "link": "https://stackoverflow.com/users/5552235/platzmapritzma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 49192397, "answer_count": 1, "score": 0, "last_activity_date": 1520593664, "creation_date": 1520592440, "last_edit_date": 1520593234, "question_id": 49192011, "link": "https://stackoverflow.com/questions/49192011/why-time-format-and-parse-gives-different-results", "title": "Why time format and parse gives different results?", "body": "<p>I'm taking the current time and format it and parse it back. When I compare the result with the current time they are not equal.</p>\n\n<p>Here is a playground example:\n<a href=\"https://play.golang.org/p/DDFzi1t8v_-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/DDFzi1t8v_-</a></p>\n\n<pre><code>t := time.Now()\nformatted := t.Format(\"2006-01-02 15:04:05.000 -0700\")\nparsed, _ := time.Parse(\"2006-01-02 15:04:05.000 -0700\", formatted)\nfmt.Println(parsed.Equal(t))\n</code></pre>\n\n<p>This is working on the playground but not in my local computer because my timezone is +0300.</p>\n\n<p>Here is the output of the same code on my computer:</p>\n\n<pre><code>t         :  2018-03-09 13:38:37.229832 +0300 +03 m=+0.000440904\nformatted :  2018-03-09 13:38:37.229 +0300\nparsed    :  2018-03-09 13:38:37.229 +0300 +03\nfalse\n</code></pre>\n\n<p>How can I make them equal?</p>\n"}]