[{"tags": ["arrays", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1512585085, "post_id": 47681138, "comment_id": 82321420, "body": "Please <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">take the Go tour</a> to get the basics of the language down."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1512585365, "post_id": 47681138, "comment_id": 82321546, "body": "You need to pass a value of a type that implements the <code>types.Type</code> interface, what you&#39;re doing is passing a value of type <code>types.BasicKind</code>, but this type does not implement that interface, therefore you cannot pass it in as the first argument to <code>types.NewArray</code>."}, {"owner": {"reputation": 3295, "user_id": 1660286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d8ae3ea1868a70d1b8c94ab726140d?s=128&d=identicon&r=PG&f=1", "display_name": "Daniil Grankin", "link": "https://stackoverflow.com/users/1660286/daniil-grankin"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512591385, "post_id": 47681138, "comment_id": 82324715, "body": "@Adrian are you sure Go tour covers go/types package??"}, {"owner": {"reputation": 3295, "user_id": 1660286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d8ae3ea1868a70d1b8c94ab726140d?s=128&d=identicon&r=PG&f=1", "display_name": "Daniil Grankin", "link": "https://stackoverflow.com/users/1660286/daniil-grankin"}, "edited": false, "score": 0, "creation_date": 1512592354, "post_id": 47681138, "comment_id": 82325250, "body": "<a href=\"https://golang.org/pkg/go/types/#Type\" rel=\"nofollow noreferrer\">golang.org/pkg/go/types/#Type</a> documentation says <code>All types implement the Type interface.</code> in this context it sounds that <code>int</code> is not type weird..."}, {"owner": {"reputation": 3295, "user_id": 1660286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d8ae3ea1868a70d1b8c94ab726140d?s=128&d=identicon&r=PG&f=1", "display_name": "Daniil Grankin", "link": "https://stackoverflow.com/users/1660286/daniil-grankin"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512594757, "post_id": 47681138, "comment_id": 82326518, "body": "@mkopriva could you please provide an example?? <a href=\"https://play.golang.org/p/UIQi6sgGVA\" rel=\"nofollow noreferrer\">play.golang.org/p/UIQi6sgGVA</a> or anyone, instead of just downvoting"}, {"owner": {"reputation": 3295, "user_id": 1660286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d8ae3ea1868a70d1b8c94ab726140d?s=128&d=identicon&r=PG&f=1", "display_name": "Daniil Grankin", "link": "https://stackoverflow.com/users/1660286/daniil-grankin"}, "edited": false, "score": 0, "creation_date": 1512594940, "post_id": 47681138, "comment_id": 82326617, "body": "finally I figured it out <a href=\"https://play.golang.org/p/fP112xqFp6\" rel=\"nofollow noreferrer\">play.golang.org/p/fP112xqFp6</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1512595602, "post_id": 47681138, "comment_id": 82326935, "body": "@SagarShah: what are you trying to do? The <code>go&#47;types</code> package doesn&#39;t do much on its own, and is definitely not something someone &quot;very new to go&quot; would be venturing into."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 3295, "user_id": 1660286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d8ae3ea1868a70d1b8c94ab726140d?s=128&d=identicon&r=PG&f=1", "display_name": "Daniil Grankin", "link": "https://stackoverflow.com/users/1660286/daniil-grankin"}, "edited": false, "score": 1, "creation_date": 1512596032, "post_id": 47681138, "comment_id": 82327136, "body": "@DanielGrankin by &quot;all types&quot; they mean types defined in that package, and it&#39;s just a generalization since <code>BasicKind</code>, a type also defined in that package, does not implement that interface."}, {"owner": {"reputation": 3295, "user_id": 1660286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d8ae3ea1868a70d1b8c94ab726140d?s=128&d=identicon&r=PG&f=1", "display_name": "Daniil Grankin", "link": "https://stackoverflow.com/users/1660286/daniil-grankin"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512596130, "post_id": 47681138, "comment_id": 82327184, "body": "Thanks @mkopriva it would be great if they explain what they mean :)"}], "answers": [{"comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1512596197, "post_id": 47683782, "comment_id": 82327218, "body": "Package <code>go&#47;types</code>, and all its sibling packages under the <code>go&#47;</code> parent are there to help you work with Go source code, analyzation, type checking, parsing, etc. <code>NewArray</code> is not meant to be used as an initializer for arrays that you use in your typical app."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1512596281, "post_id": 47683782, "comment_id": 82327264, "body": "That is the reason the OP was referred to the Go tour, stuff under <code>go&#47;</code> is generally for advanced users of the Go language, those that are familiar with the basics, not those that are just learning the basics."}, {"owner": {"reputation": 3295, "user_id": 1660286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d8ae3ea1868a70d1b8c94ab726140d?s=128&d=identicon&r=PG&f=1", "display_name": "Daniil Grankin", "link": "https://stackoverflow.com/users/1660286/daniil-grankin"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512596530, "post_id": 47683782, "comment_id": 82327393, "body": "@mkopriva Thank you!!! When I saw the question I though hm I&#39;ve taken go tour but don&#39;t know answer. Unfortunately first comments were not very helpful and I decided to figure out what is NewArray on my own and I got working example but had no idea why I need it, so thank you for explaining :)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1512596532, "post_id": 47683782, "comment_id": 82327395, "body": "If someone wants to initialize a slice or an array in Go they can do so with <code>make([]T, len, cap)</code> (for slices), or <code>var arr [N]T</code> (for arrays)."}, {"owner": {"reputation": 3295, "user_id": 1660286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d8ae3ea1868a70d1b8c94ab726140d?s=128&d=identicon&r=PG&f=1", "display_name": "Daniil Grankin", "link": "https://stackoverflow.com/users/1660286/daniil-grankin"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512596852, "post_id": 47683782, "comment_id": 82327558, "body": "Yeah, it&#39;s easy to find info how to create slice, array, but as for type.NewArray seems not :)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1512597693, "post_id": 47683782, "comment_id": 82327947, "body": "It&#39;s good practice to read a package&#39;s documentation in case you&#39;re unsure what one of its functions/types is supposed to be used for. <code>go&#47;types</code> is pretty clear about its objective right in the first paragraph. That said, I do find OPs confusion only natural and think that downvoting them is unhelpful and counterproductive."}, {"owner": {"reputation": 381, "user_id": 2711025, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000022213269/picture?type=large", "display_name": "Sagar Shah", "link": "https://stackoverflow.com/users/2711025/sagar-shah"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512625523, "post_id": 47683782, "comment_id": 82335943, "body": "@mkopriva Then how should I add an array as a struct member if I do not know what the length is going to be??"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 381, "user_id": 2711025, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000022213269/picture?type=large", "display_name": "Sagar Shah", "link": "https://stackoverflow.com/users/2711025/sagar-shah"}, "edited": false, "score": 1, "creation_date": 1512627416, "post_id": 47683782, "comment_id": 82336617, "body": "@SagarShah you can use a slice, which is just like an array but has dynamic length. In Go arrays are used very little, most of the time you should use a slice. A slice initialized like this <code>var S []T</code>, or <code>S := []T{}</code>, or <code>make([]T, len, cap)</code> can be grown by using <code>append</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 381, "user_id": 2711025, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000022213269/picture?type=large", "display_name": "Sagar Shah", "link": "https://stackoverflow.com/users/2711025/sagar-shah"}, "edited": false, "score": 1, "creation_date": 1512628196, "post_id": 47683782, "comment_id": 82336948, "body": "@SagarShah here are a couple examples <a href=\"https://play.golang.org/p/3EQRMXpIWL\" rel=\"nofollow noreferrer\">play.golang.org/p/3EQRMXpIWL</a>"}, {"owner": {"reputation": 381, "user_id": 2711025, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000022213269/picture?type=large", "display_name": "Sagar Shah", "link": "https://stackoverflow.com/users/2711025/sagar-shah"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512629597, "post_id": 47683782, "comment_id": 82337526, "body": "@mkopriva but that is a slice and not an array. i actually wanted to use my struct as a key in a map and it fails if it has an slice member. That is why I wanted an array member. But thank you for the help.."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 381, "user_id": 2711025, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000022213269/picture?type=large", "display_name": "Sagar Shah", "link": "https://stackoverflow.com/users/2711025/sagar-shah"}, "edited": false, "score": 1, "creation_date": 1512630238, "post_id": 47683782, "comment_id": 82337799, "body": "@SagarShah fair enough, but in Go you cannot have an array without first knowing its length because the <i>length is part of the type</i>. What you want is basically not supported by the language so you need to rethink the design of you map."}, {"owner": {"reputation": 381, "user_id": 2711025, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000022213269/picture?type=large", "display_name": "Sagar Shah", "link": "https://stackoverflow.com/users/2711025/sagar-shah"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512630992, "post_id": 47683782, "comment_id": 82338119, "body": "@mkopriva Thanks. Your latest comment has completely answered my question. I will have to redesign my approach. I think I have overused tuples as keys in dicts because i come from a python background"}], "tags": [], "owner": {"reputation": 3295, "user_id": 1660286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d8ae3ea1868a70d1b8c94ab726140d?s=128&d=identicon&r=PG&f=1", "display_name": "Daniil Grankin", "link": "https://stackoverflow.com/users/1660286/daniil-grankin"}, "is_accepted": false, "score": 1, "last_activity_date": 1512671921, "last_edit_date": 1512671921, "creation_date": 1512595942, "answer_id": 47683782, "question_id": 47681138, "link": "https://stackoverflow.com/questions/47681138/how-to-initialize-array-using-type-newarray-in-golang/47683782#47683782", "title": "how to initialize array using type.NewArray in golang?", "body": "<p>I'm also new in go. And for me the question doesn't look stupid. Unfortunately no one has explained how to use NewArray yet. It seems to me that golang community is not very friendly I've met more downvoting than real help for now. </p>\n\n<p>Btw I took course of Go tour :) But anyway I was confused that question how to get type of an object bring you to <code>reflect package</code> usually (type in google something like <code>golang get type of an object</code>) which has nothing in common with <code>types.Type</code>. I spent some time to figure out how to get <code>types.Type</code> object, and it's not obvious I think for people who has experience in other languages.</p>\n\n<p>So to use <code>NewArray</code> method you neeed to pass an object which implements <code>types.Type</code> as mkopriva pointed. I end up with</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"go/types\"\n)\n\ntype NewType int\n\nfunc (v NewType) String() string {\n    return string(v)\n}\n\nfunc (v NewType) Underlying() types.Type {\n    return types.Type(v)\n}\n\nfunc main() {\n    var a *types.Array\n    a = types.NewArray(NewType(0), 2)\n    fmt.Println(a)\n}\n</code></pre>\n\n<p>There is used new type with underlying <code>int</code>. I guess I don't understand something yet in golang since for using such simple thing I had to write such useless methods as <code>String</code> and <code>Underlying</code>, they are useless because of implementation, I don't see the reason to be forced write such code. I appriciate if golang experts explain this stuff!</p>\n"}], "owner": {"reputation": 381, "user_id": 2711025, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000022213269/picture?type=large", "display_name": "Sagar Shah", "link": "https://stackoverflow.com/users/2711025/sagar-shah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 696, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1513698269, "creation_date": 1512584964, "last_edit_date": 1513698269, "question_id": 47681138, "link": "https://stackoverflow.com/questions/47681138/how-to-initialize-array-using-type-newarray-in-golang", "title": "how to initialize array using type.NewArray in golang?", "body": "<p>Basically, I want to use the Array type struct in the <code>types</code> module but I'm unable to initialize it. What do you have to pass in the Type as the first argument?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"go/types\"\n)\n\nfunc main() {\n    var a *types.Array\n    a = types.NewArray(types.Int, 2) //error here\n    fmt.Println(a)\n}\n</code></pre>\n"}, {"tags": ["for-loop", "go", "slice", "go-templates"], "answers": [{"comments": [{"owner": {"reputation": 429, "user_id": 1433721, "user_type": "registered", "accept_rate": 85, "profile_image": "https://lh5.googleusercontent.com/-lD6AeV9Tf58/AAAAAAAAAAI/AAAAAAAAAVs/0nRvIZ5-4NA/photo.jpg?sz=128", "display_name": "Andr&#233; G. Andrade", "link": "https://stackoverflow.com/users/1433721/andr%c3%a9-g-andrade"}, "edited": false, "score": 0, "creation_date": 1512586251, "post_id": 47681360, "comment_id": 82321956, "body": "Hi @icza thanks for your answer, it worked perfectly."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1613564784, "last_edit_date": 1613564784, "creation_date": 1512585790, "answer_id": 47681360, "question_id": 47681082, "link": "https://stackoverflow.com/questions/47681082/iterate-over-only-the-first-n-items-of-an-array-in-a-go-template/47681360#47681360", "title": "Iterate over only the first n items of an array in a Go template", "body": "<p>Easiest would be to only pass 5 elements, so you don't need any logic in the template.</p>\n<p>You can also do this in template, if you also store the index in the <code>{{range}}</code> action. Then you can use an <code>{{if}}</code> action to check the index, and only render the body of the <code>{{if}}</code> if the index is less than 5:</p>\n<pre><code>{{range $i, $e := .Categorias}}{{if lt $i 5}}\n    &lt;li class=&quot;nav-item&quot;&gt;\n        {{.Nome}}\n    &lt;/li&gt;\n{{end}}{{end}}\n</code></pre>\n<p>Here's a simple example demonstrating it:</p>\n<pre><code>func main() {\n    t := template.Must(template.New(&quot;&quot;).Parse(src))\n    numbers := []int{0, 1, 2, 3, 4, 5, 6, 7, 8}\n    if err := t.Execute(os.Stdout, numbers); err != nil {\n        panic(err)\n    }\n}\n\nconst src = `{{range $i, $e := .}}{{if lt $i 5}}{{.}} {{end}}{{end}}`\n</code></pre>\n<p>Output (try it on the <a href=\"https://play.golang.org/p/yFUaH5eU-U\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n<pre><code>0 1 2 3 4 \n</code></pre>\n<h3>Go 1.10 template extension</h3>\n<p>Note that in <a href=\"https://tip.golang.org/doc/go1.10#html/template\" rel=\"nofollow noreferrer\">Go 1.10</a> there will be new <code>{{break}}</code> and <code>{{continue}}</code> actions which will provide an alternative, better solution for this.</p>\n<p>It will look something like this:</p>\n<pre><code>{{range $i, $e := .Categorias}}\n    &lt;li class=&quot;nav-item&quot;&gt;\n        {{.Nome}}\n    &lt;/li&gt;\n{{if eq $i 4}}{{break}}{{end}}{{end}}\n</code></pre>\n<p>This new <code>{{break}}</code> action will provide a superior solution as the above <code>{{range}}</code> action will only iterate over 5 elements at most (while the other solution without <code>{{break}}</code> has to iterate over all elements, just elements with index &gt;=  5 are not rendered).</p>\n<h3>Go 1.13 template extension</h3>\n<p><a href=\"https://tip.golang.org/doc/go1.13#text/template\" rel=\"nofollow noreferrer\">Go 1.13 adds the <code>slice</code> builtin template function</a> which provides an even nicer and more efficient solution. Slice the value you want to range over, so the <code>{{range}}</code> action only &quot;gets&quot; what you want to loop over:</p>\n<pre><code>func main() {\n    t := template.Must(template.New(&quot;&quot;).Parse(src))\n    numbers := []int{0, 1, 2, 3, 4, 5, 6, 7, 8}\n    if err := t.Execute(os.Stdout, numbers); err != nil {\n        panic(err)\n    }\n}\n\nconst src = `{{range $i, $e := (slice . 0 5)}}{{.}} {{end}}`\n</code></pre>\n<p>This will output (try it on the <a href=\"https://play.golang.org/p/MmExX_Q0_mG\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n<pre><code>0 1 2 3 4\n</code></pre>\n"}], "owner": {"reputation": 429, "user_id": 1433721, "user_type": "registered", "accept_rate": 85, "profile_image": "https://lh5.googleusercontent.com/-lD6AeV9Tf58/AAAAAAAAAAI/AAAAAAAAAVs/0nRvIZ5-4NA/photo.jpg?sz=128", "display_name": "Andr&#233; G. Andrade", "link": "https://stackoverflow.com/users/1433721/andr%c3%a9-g-andrade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1672, "favorite_count": 0, "accepted_answer_id": 47681360, "answer_count": 1, "score": 4, "last_activity_date": 1613564784, "creation_date": 1512584798, "last_edit_date": 1512586218, "question_id": 47681082, "link": "https://stackoverflow.com/questions/47681082/iterate-over-only-the-first-n-items-of-an-array-in-a-go-template", "title": "Iterate over only the first n items of an array in a Go template", "body": "<p>I have a vector with <code>n</code> elements. I'm using it to render items in a template. But I need to render only the 5 first elements. Please note that is possible to have less than 5 elements in vector, in this case will render all elements. Is there is a way to do it in template?</p>\n\n<pre><code>{{range .Categorias}}\n    &lt;li class=\"nav-item\"&gt;\n        {{.Nome}}\n    &lt;/li&gt;\n{{end}}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1512603197, "post_id": 47680947, "comment_id": 82330159, "body": "Show us how you save the entity. You know, a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1512638953, "post_id": 47680947, "comment_id": 82342370, "body": "Are you sure there is no <code>datastore</code> annotations for the field? Does the entity implements PropertyLoadSaver?"}], "owner": {"reputation": 107, "user_id": 7836768, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550083c73775e651fe894122315a87df?s=128&d=identicon&r=PG&f=1", "display_name": "Kieran W.", "link": "https://stackoverflow.com/users/7836768/kieran-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1512584758, "creation_date": 1512584263, "last_edit_date": 1512584758, "question_id": 47680947, "link": "https://stackoverflow.com/questions/47680947/why-does-datastore-use-text-type-on-property-when-saving-1-character", "title": "Why does Datastore use Text type on property when saving 1 character", "body": "<p>I have the following:</p>\n\n<pre><code>type Foo struct {\n   BarX string\n   BarY string\n}\n</code></pre>\n\n<p>When setting <em>BarX</em> = <strong>x</strong> and <em>BarY</em> = <strong>y</strong>, the Datastore Viewer is showing <em>BarX</em> as being <strong>Text</strong> and <em>BarY</em> as being <strong>String</strong>. I would expect both to be <strong>String</strong> due to the length of the data.</p>\n\n<p>I can't find any documentation on how to change this anywhere?</p>\n"}, {"tags": ["function", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1512571676, "post_id": 47676995, "comment_id": 82312955, "body": "You mean <a href=\"https://golang.org/pkg/runtime/#Caller\" rel=\"nofollow noreferrer\"><code>runtime.Caller</code></a>?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1512572079, "post_id": 47676995, "comment_id": 82313257, "body": "<code>runtime.Caller</code> reports the program counter, file and line numbers, not the name of the calling function. But, unless this is for debugging purposes, I&#39;d highly advise against using the name of the calling function in your function logic anyway; it&#39;s going to turn into an unmaintainable mess almost immediately."}, {"owner": {"reputation": 5971, "user_id": 5537840, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/aKRoy.jpg?s=128&g=1", "display_name": "Kenenbek Arzymatov", "link": "https://stackoverflow.com/users/5537840/kenenbek-arzymatov"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512572608, "post_id": 47676995, "comment_id": 82313667, "body": "@Adrian, am taking it into consideration"}], "owner": {"reputation": 5971, "user_id": 5537840, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/aKRoy.jpg?s=128&g=1", "display_name": "Kenenbek Arzymatov", "link": "https://stackoverflow.com/users/5537840/kenenbek-arzymatov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "closed_date": 1512571882, "answer_count": 0, "score": 0, "last_activity_date": 1512571934, "creation_date": 1512571469, "question_id": 47676995, "link": "https://stackoverflow.com/questions/47676995/find-an-identifier-of-caller-function", "closed_reason": "Duplicate", "title": "Find an identifier of caller function", "body": "<p>I have <code>func1</code> and <code>func2</code> functions. Each of them calls another <code>common_func</code> function.</p>\n\n<pre><code>func func1(){\n    common_func()\n}\n\nfunc func2(){\n    common_func()\n}\n\nfunc common_func(){\n\n}\n</code></pre>\n\n<p>Is it possible inside <code>common_func</code> find out which function called it (without passing additional info in arguments to function like <code>common_func(name_of_caller string)</code>)?</p>\n"}, {"tags": ["go", "uuid"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1512568934, "post_id": 47676060, "comment_id": 82311072, "body": "Why are you trying to convert it to <code>[]rune</code>? A UUID can only contain hex characters in it&#39;s string representation. Why not just use the <code>String()</code> method?"}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1512569063, "post_id": 47676060, "comment_id": 82311158, "body": "@JimB, I&#39;m a go noob and that&#39;s a snippet that I found to cut string to certain length. Appreciate a complete answer with code example."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1512569316, "post_id": 47676060, "comment_id": 82311301, "body": "you should probably start with the basic documentation, maybe run through the <a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">Tour of Go</a>. Cutting&amp;pasting without knowing why rarely ends well."}], "answers": [{"comments": [{"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "edited": false, "score": 0, "creation_date": 1512569597, "post_id": 47676255, "comment_id": 82311503, "body": "Note that this will contain dashes if you ask for more than 8 characters."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "edited": false, "score": 0, "creation_date": 1512569676, "post_id": 47676255, "comment_id": 82311556, "body": "@DietrichEpp: true, but since they were specifically slicing a UUID, which the string format is part of the specification, I assumed that was intended. Otherwise why use a UUID at all."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "edited": false, "score": 0, "creation_date": 1512569769, "post_id": 47676255, "comment_id": 82311613, "body": "@DietrichEpp, oh I see, they only wanted it for &quot;randomness&quot;"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 4, "last_activity_date": 1512569262, "creation_date": 1512569262, "answer_id": 47676255, "question_id": 47676060, "link": "https://stackoverflow.com/questions/47676060/how-to-cut-uuid-in-golang/47676255#47676255", "title": "How to cut uuid in golang?", "body": "<p>There is no need to convert the <code>UUID</code> to a <code>[]rune</code>. That <a href=\"https://godoc.org/github.com/satori/go.uuid#UUID\" rel=\"nofollow noreferrer\"><code>UUID</code></a> type is stored in a binary representation as a <code>[16]byte</code>. There is a <a href=\"https://godoc.org/github.com/satori/go.uuid#UUID.String\" rel=\"nofollow noreferrer\"><code>UUID.String()</code></a> method which you can use to convert to a string, then slice it.</p>\n\n<pre><code> slug := u1.String()[:7]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1512569644, "post_id": 47676287, "comment_id": 82311530, "body": "Which do you reckon yields more random results? <code>hex.EncodeToString(u1.Bytes()[:4])</code> or <code>make([]byte, 4)</code> ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1512569841, "post_id": 47676287, "comment_id": 82311662, "body": "@Karlom: <code>make([]byte, 4)</code> isn&#39;t random, you have to put random data into it."}, {"owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "edited": false, "score": 2, "creation_date": 1512569900, "post_id": 47676287, "comment_id": 82311704, "body": "They are both uniformly random. However, with UUIDs you are generating extra random bits so you can throw them away. Why bother with UUIDs just to throw them away?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512571255, "post_id": 47676287, "comment_id": 82312657, "body": "If you read the source of the UUID library, it&#39;s using the Go PRNG anyway. Using UUID vs. generating 4 random bytes are definitively equally random."}], "tags": [], "owner": {"reputation": 181215, "user_id": 82294, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5c5f910416e2b92bb73fa59c56fe695d?s=128&d=identicon&r=PG", "display_name": "Dietrich Epp", "link": "https://stackoverflow.com/users/82294/dietrich-epp"}, "is_accepted": true, "score": 3, "last_activity_date": 1512569943, "last_edit_date": 1512569943, "creation_date": 1512569355, "answer_id": 47676287, "question_id": 47676060, "link": "https://stackoverflow.com/questions/47676060/how-to-cut-uuid-in-golang/47676287#47676287", "title": "How to cut uuid in golang?", "body": "<p>In that package (I just looked at the source code) a UUID is an alias for <code>[16]byte</code>, so you cannot concert it to a rune array, not that you want to. </p>\n\n<p>Try this:</p>\n\n<pre><code>s := hex.EncodeToString(u1.Bytes()[:4])\n</code></pre>\n\n<p>This will give you 8 hex digits. However, this is still a roundabout way of doing things. A v4 UUID is random except for certain bits, so if you are not using the whole UUID it is more straightforward to just generate 4 random bytes. Use the <code>Read()</code> function in <code>math/rand</code> (which must be seeded) or <code>crypto/rand</code> (which is what the UUID library uses). </p>\n\n<pre><code>b := make([]byte, 4)\nrand.Read(b) // Doesn\u2019t actually fail\ns := hex.EncodeToString(b)\n</code></pre>\n"}], "owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2495, "favorite_count": 0, "accepted_answer_id": 47676287, "answer_count": 2, "score": -1, "last_activity_date": 1512569943, "creation_date": 1512568655, "question_id": 47676060, "link": "https://stackoverflow.com/questions/47676060/how-to-cut-uuid-in-golang", "title": "How to cut uuid in golang?", "body": "<p>In order to make semi-random slugs, I'd like to use first 8 characters of uuid. So I have</p>\n\n<pre><code>import (\n    fmt\n    \"github.com/satori/go.uuid\"\n)\n\n    u1 := uuid.NewV4()\n    fmt.Println(\"u1 :\", u1)\n\n    runes := []rune(u1)\n    slug := string(runes[0:7]) \n</code></pre>\n\n<p>But in compile time I get this error:</p>\n\n<blockquote>\n  <p>cannot convert u1 (type uuid.UUID) to type []rune</p>\n</blockquote>\n\n<p>How can I fix it?</p>\n"}, {"tags": ["logging", "go"], "comments": [{"owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "edited": false, "score": 2, "creation_date": 1512567454, "post_id": 47675096, "comment_id": 82310071, "body": "<code>logger</code> is visible in all source files within the same package."}, {"owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "reply_to_user": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "edited": false, "score": 0, "creation_date": 1512573274, "post_id": 47675096, "comment_id": 82314170, "body": "@dev.bmax - thanks but I dont ask on the same package...."}], "answers": [{"comments": [{"owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "edited": false, "score": 0, "creation_date": 1512577643, "post_id": 47677744, "comment_id": 82317175, "body": "Thanks, so in this case I need to create constructor for module b(from different package ) ? can you also provide the code which I should use in the work package ?"}, {"owner": {"reputation": 3312, "user_id": 4175960, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/QbvYc.png?s=128&g=1", "display_name": "Eddy Hernandez", "link": "https://stackoverflow.com/users/4175960/eddy-hernandez"}, "reply_to_user": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "edited": false, "score": 0, "creation_date": 1512577955, "post_id": 47677744, "comment_id": 82317361, "body": "You should create the logger only one, sure I will update my answer"}, {"owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "edited": false, "score": 0, "creation_date": 1512578285, "post_id": 47677744, "comment_id": 82317596, "body": "Ok thanks, so just to see if I get it right, Before I call to the module B (from different package) I need to call to the new method and pass the logger and then use the logger inside this module, am I right?"}, {"owner": {"reputation": 3312, "user_id": 4175960, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/QbvYc.png?s=128&g=1", "display_name": "Eddy Hernandez", "link": "https://stackoverflow.com/users/4175960/eddy-hernandez"}, "reply_to_user": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "edited": false, "score": 0, "creation_date": 1512578669, "post_id": 47677744, "comment_id": 82317794, "body": "If you want to use it as receiver yes, you also can pass it as parameter, I&#39;m adding another func in my answer"}, {"owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "edited": false, "score": 0, "creation_date": 1512578916, "post_id": 47677744, "comment_id": 82317967, "body": "Ohh, So I should pass it in every function ? its not better to get it from the <code>New</code> method and somehow keep it ? and then re-use it ?"}, {"owner": {"reputation": 3312, "user_id": 4175960, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/QbvYc.png?s=128&g=1", "display_name": "Eddy Hernandez", "link": "https://stackoverflow.com/users/4175960/eddy-hernandez"}, "reply_to_user": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "edited": false, "score": 0, "creation_date": 1512579180, "post_id": 47677744, "comment_id": 82318148, "body": "The main point here is, if you want to use a <code>var</code> in another package you should pass it to other package, there are no Universal scope. or another option is create a new logger when you need it, but this is not good performance practice"}], "tags": [], "owner": {"reputation": 3312, "user_id": 4175960, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/QbvYc.png?s=128&g=1", "display_name": "Eddy Hernandez", "link": "https://stackoverflow.com/users/4175960/eddy-hernandez"}, "is_accepted": true, "score": 2, "last_activity_date": 1512578483, "last_edit_date": 1512578483, "creation_date": 1512573708, "answer_id": 47677744, "question_id": 47675096, "link": "https://stackoverflow.com/questions/47675096/use-same-object-instancelog-in-diffrent-files/47677744#47677744", "title": "Use same object instance(log) in diffrent files", "body": "<p>There are some points here:</p>\n\n<p>Go groups files in package concept for example if you have some .go files in a directory with the <code>package main</code> that means that all files are sharing the package scope, in this case the <code>func init()</code> inits the <code>var logger</code> that is present in the <code>main</code> package.</p>\n\n<p>I prefer to not use package scope variables, but this depends on your implementation\n<a href=\"https://dave.cheney.net/2017/06/11/go-without-package-scoped-variables\" rel=\"nofollow noreferrer\">https://dave.cheney.net/2017/06/11/go-without-package-scoped-variables</a></p>\n\n<p>Maybe you wanted to use logger in different package for example <code>github.com/youruser/work</code></p>\n\n<p>I prefer to pass the object log to the functions or methods you wanted to use it (as parameters or receiver)</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/user/utils\"\n    \"github.com/user/work\"\n)\n\nfunc main() {\n    logger := utils.InitLogs()\n    work.Do(logger)\n}\n</code></pre>\n\n<p>or using as receiver</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/user/utils\"\n    \"github.com/user/work\"\n)\n\nfunc main() {\n    logger := utils.InitLogs()\n    w := work.New()\n    w.Log = logger\n    w.Do()\n}\n</code></pre>\n\n<p>then in Do() you can log using the receiver</p>\n\n<p>in the work package you should add it as filed</p>\n\n<pre><code>type Worker struct {\n    Log *logrus.Logger\n}\n</code></pre>\n\n<p>I really hope you can find it useful.</p>\n\n<p><strong>update:</strong>\nAn example of work package</p>\n\n<pre><code>package work\n\nimport \"github.com/sirupsen/logrus\"\n\ntype Worker struct {\n    Log *logrus.Logger\n}\n\nfunc New() *Worker {\n    return new(Worker)\n}\n\nfunc (w *Worker) Do() {\n    // some work\n    // Here you are passing as receiver parameter\n    w.Log.Info(\"bla bla\")\n}\n\nfunc AnotherFunc(log *logrus.Logger) {\n    // Here you are passing as method parameter\n   log.Info(\"bla bla\")\n}\n</code></pre>\n"}], "owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 895, "favorite_count": 3, "accepted_answer_id": 47677744, "answer_count": 1, "score": 1, "last_activity_date": 1512631096, "creation_date": 1512565747, "last_edit_date": 1512631096, "question_id": 47675096, "link": "https://stackoverflow.com/questions/47675096/use-same-object-instancelog-in-diffrent-files", "title": "Use same object instance(log) in diffrent files", "body": "<p>I use logrus logger and I init it inside my main function like following</p>\n\n<pre><code>main.go file content\n\n\nimport \"github.com/sirupsen/logrus\"\n\nvar logger                *logrus.Logger\n\nfunc init() {\n\n    logger = utils.InitLogs()\n}\n\n\n\nfunc main(){\n\n    logger.Info(\"bla bla\")\n\n   } \n</code></pre>\n\n<p>And I was able to use it  e.g.<code>logger.info(\u201ctest\u201d)</code> in the main file, now I don\u2019t want to create the <code>init</code> file in each\nother file which need to use the logger , I want to use in other project file the same instance which I\u2019ve created in the main.go file\nHow should I do it in golfing ?</p>\n\n<p><strong>Im not asking about sharing it on the same package</strong></p>\n"}, {"tags": ["for-loop", "go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 3, "creation_date": 1512563004, "post_id": 47674150, "comment_id": 82307158, "body": "The receive (can) return two values. Use the second one."}], "answers": [{"comments": [{"owner": {"reputation": 1187, "user_id": 3168824, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/kbuoD.jpg?s=128&g=1", "display_name": "Christof K&#228;lin", "link": "https://stackoverflow.com/users/3168824/christof-k%c3%a4lin"}, "edited": false, "score": 0, "creation_date": 1512572609, "post_id": 47676483, "comment_id": 82313668, "body": "You are right, the comma-ok idiom is the way to go here. I should have known this, but I was dazzled by concurrency. Thanks for this :-)"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 1187, "user_id": 3168824, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/kbuoD.jpg?s=128&g=1", "display_name": "Christof K&#228;lin", "link": "https://stackoverflow.com/users/3168824/christof-k%c3%a4lin"}, "edited": false, "score": 1, "creation_date": 1512576995, "post_id": 47676483, "comment_id": 82316753, "body": "@ChristofK&#228;lin, see <a href=\"https://dave.cheney.net/2014/03/19/channel-axioms\" rel=\"nofollow noreferrer\">this</a> for more info."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1512570338, "last_edit_date": 1512570338, "creation_date": 1512569996, "answer_id": 47676483, "question_id": 47674150, "link": "https://stackoverflow.com/questions/47674150/select-statement-in-a-for-loop-reading-from-a-closed-channel-gives-zero-values-f/47676483#47676483", "title": "Select statement in a for-loop reading from a closed channel gives zero values forever", "body": "<p>Receive on a closed channel yields the zero value after all elements in the channel are received.</p>\n\n<p>Use the two value receive to detect when the channel is closed and break from the loop.  The second value is false when the channel yields a zero value because the channel is closed.</p>\n\n<pre><code>for {\n    select {\n    case s, ok := &lt;-r:\n        if !ok {\n            break loop\n        }\n        fmt.Println(s)\n    case &lt;-totalTimeout: // signaling usage of a channel\n        fmt.Println(\"Timed out\")\n        break loop\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1187, "user_id": 3168824, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/kbuoD.jpg?s=128&g=1", "display_name": "Christof K&#228;lin", "link": "https://stackoverflow.com/users/3168824/christof-k%c3%a4lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1634, "favorite_count": 0, "accepted_answer_id": 47676483, "answer_count": 1, "score": 1, "last_activity_date": 1512571628, "creation_date": 1512562692, "last_edit_date": 1512571628, "question_id": 47674150, "link": "https://stackoverflow.com/questions/47674150/select-statement-in-a-for-loop-reading-from-a-closed-channel-gives-zero-values-f", "title": "Select statement in a for-loop reading from a closed channel gives zero values forever", "body": "<p>Given this code that simulates fetching of some website-stuff for 3 URL's using a fan-in pattern and range over the condensed channel: <a href=\"https://play.golang.org/p/MSkRI7x4vz\" rel=\"nofollow noreferrer\">https://play.golang.org/p/MSkRI7x4vz</a></p>\n\n<pre><code>for s := range r {\n    println(s)\n}\n</code></pre>\n\n<p>This works well, but I want to use an overall timeout signal channel, so I try to use a select in a for-loop like this:\n<a href=\"https://play.golang.org/p/LjDoIc0j-z\" rel=\"nofollow noreferrer\">https://play.golang.org/p/LjDoIc0j-z</a></p>\n\n<pre><code>totalTimeout := time.After(300 * time.Millisecond)\nloop:\n    for {\n        select {\n        case s := &lt;-r:\n            fmt.Println(s)\n        case &lt;-totalTimeout: // signaling usage of a channel\n            fmt.Println(\"Timed out\")\n            break loop\n        }\n    }\n}\n</code></pre>\n\n<p>This behaves not well: After the input channels are closed, the condensed channel from fan-in is closed. But now zero-values are read until the timeout effectively occurs. When I read <a href=\"http://www.tapirgames.com/blog/golang-channel\" rel=\"nofollow noreferrer\">http://www.tapirgames.com/blog/golang-channel</a> or the specs <a href=\"https://golang.org/ref/spec#Close\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Close</a> it seems that receiving from a closed channel \"never blocks\" and thus gives back zero values. I can only guess, that a range detects the close, where the select cannot, because it's condition is a read from a channel in itself.</p>\n\n<p>I could break out like this</p>\n\n<pre><code>case s := &lt;-r:\n    if s == \"\" {\n        break loop\n    }\n    fmt.Println(s)\n</code></pre>\n\n<p>Is there another approach to stop getting empty values or is this the proper idiomatic way using a select in a for loop?</p>\n"}, {"tags": ["go", "compiler-errors", "syntax-error"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1512560328, "post_id": 47673293, "comment_id": 82305607, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/25800242/go-golang-syntax-error-unexpected-expecting\">Go golang, syntax error: unexpected ++, expecting :</a>"}, {"owner": {"reputation": 3295, "user_id": 1660286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d8ae3ea1868a70d1b8c94ab726140d?s=128&d=identicon&r=PG&f=1", "display_name": "Daniil Grankin", "link": "https://stackoverflow.com/users/1660286/daniil-grankin"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1512560513, "post_id": 47673293, "comment_id": 82305719, "body": "It doesn&#39;t answer why error says expression when statement is accepted as well, I don&#39;t think it&#39;s dupe"}, {"owner": {"reputation": 3295, "user_id": 1660286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d8ae3ea1868a70d1b8c94ab726140d?s=128&d=identicon&r=PG&f=1", "display_name": "Daniil Grankin", "link": "https://stackoverflow.com/users/1660286/daniil-grankin"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1512561176, "post_id": 47673293, "comment_id": 82306107, "body": "I actually wrote that ++i is not expression in my question so I didn&#39;t ask about it and pointed the same place in doc. I see that i++ is statement and I also wrote about it I don&#39;t see why error says expecting expression when I can use statement and it confuses."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1512561276, "post_id": 47673293, "comment_id": 82306154, "body": "Ah I see what you&#39;re asking now. Sorry for the confusion."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1512561752, "post_id": 47673293, "comment_id": 82306443, "body": "I&#39;m voting to close this question as off-topic because this question is not about programming but about a not super helpful error message in a certain compiler."}, {"owner": {"reputation": 3295, "user_id": 1660286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d8ae3ea1868a70d1b8c94ab726140d?s=128&d=identicon&r=PG&f=1", "display_name": "Daniil Grankin", "link": "https://stackoverflow.com/users/1660286/daniil-grankin"}, "edited": false, "score": 0, "creation_date": 1512561816, "post_id": 47673293, "comment_id": 82306479, "body": "I guess providing error messages is about programming"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1512561983, "post_id": 47673293, "comment_id": 82306583, "body": "If you care about such stuff: Dig into the compiler, fix it and send a fix. Go is open source. SO is totally the wrong place for such discussions. Open a bug report or engage on golang-nuts."}, {"owner": {"reputation": 3295, "user_id": 1660286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d8ae3ea1868a70d1b8c94ab726140d?s=128&d=identicon&r=PG&f=1", "display_name": "Daniil Grankin", "link": "https://stackoverflow.com/users/1660286/daniil-grankin"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1512562356, "post_id": 47673293, "comment_id": 82306800, "body": "If I was sure I&#39;m right I could fix and created PR. But I&#39;m not, that&#39;s why I asked. @Volker do you think I should ask about difference between usages terms statement and expression in bug report? :) Or should I probably use always specific forums instead of SO?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1512563080, "post_id": 47673293, "comment_id": 82307200, "body": "@DanielGrankin You&#39;re right, the error message is &quot;somewhat&quot; misleading, but it never bothered me. You get the same error message if you replace <code>++i</code> with <code>break</code> (or with any other non-simple statement). You may file an issue if you feel like it."}, {"owner": {"reputation": 3295, "user_id": 1660286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d8ae3ea1868a70d1b8c94ab726140d?s=128&d=identicon&r=PG&f=1", "display_name": "Daniil Grankin", "link": "https://stackoverflow.com/users/1660286/daniil-grankin"}, "edited": false, "score": 1, "creation_date": 1512575556, "post_id": 47673293, "comment_id": 82315726, "body": "I&#39;d like to say thank you guys who was interested in the question and tried to figure out the &quot;issue&quot;. And also I&#39;d like to say to everyone who reads the comment please don&#39;t close, discredit a question if you really don&#39;t know answer."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1512629935, "post_id": 47673293, "comment_id": 82337677, "body": "SO is not the place for linguistic discussions or nomenclature wars. Especially not in implementation dependent error messages. It does not matter whether the nomenclature is wrong or misleading, incorrect or generally accepted or correct. You are asking about a non-code, non-programming question."}], "answers": [{"comments": [{"owner": {"reputation": 3295, "user_id": 1660286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d8ae3ea1868a70d1b8c94ab726140d?s=128&d=identicon&r=PG&f=1", "display_name": "Daniil Grankin", "link": "https://stackoverflow.com/users/1660286/daniil-grankin"}, "edited": false, "score": 0, "creation_date": 1512561328, "post_id": 47673638, "comment_id": 82306191, "body": "so if someone tries to use statement instead of expression <a href=\"https://stackoverflow.com/questions/23880663/golang-why-and-not-work-in-expressions\" title=\"golang why and not work in expressions\">stackoverflow.com/questions/23880663/&hellip;</a> he is downvoted and if error message says to use expresion when statement can be used as well it is normal, is&#39;s it?"}, {"owner": {"reputation": 3295, "user_id": 1660286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d8ae3ea1868a70d1b8c94ab726140d?s=128&d=identicon&r=PG&f=1", "display_name": "Daniil Grankin", "link": "https://stackoverflow.com/users/1660286/daniil-grankin"}, "edited": false, "score": 0, "creation_date": 1512561496, "post_id": 47673638, "comment_id": 82306290, "body": "I just want to know it&#39;s fine I&#39;m not pretending it&#39;s not. For now I don&#39;t see it&#39;s normal."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1512562873, "post_id": 47673638, "comment_id": 82307086, "body": "This <i>could</i> be the explanation, but since we get the same error message when we replace <code>++i</code> with <code>break</code> for example (or with any other statement that is not a simple statement), I don&#39;t think this reasoning is valid."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1512563902, "post_id": 47673638, "comment_id": 82307695, "body": "The SimpleStmt <a href=\"https://golang.org/src/cmd/compile/internal/syntax/parser.go\" rel=\"nofollow noreferrer\">parser</a> tries to match an expression if nothing else does. This means that if it doesn&#39;t fail on parsing others (eg: <code>SendStmt</code>, <code>Assignment</code>, etc...), it will fail trying to parse an expression."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1512567362, "post_id": 47673638, "comment_id": 82310001, "body": "As for <code>break</code>, the same thing happens. It&#39;s not allowed anywhere in the <code>SimpleStmt</code> so the last error bubbled up is the default parsing for an expression."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1512567596, "post_id": 47673638, "comment_id": 82310177, "body": "@Marc But regardless of the parser implementation the error message &quot;expected simple statement&quot; would be more appropriate."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1512567689, "post_id": 47673638, "comment_id": 82310251, "body": "I agree, and this goes back to my edit above about providing more context. This isn&#39;t straightforward though. A few things to think about: at what level of the grammar do you return an error? do you include all context? do you return all failed grammar nodes, or just the latest one?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1512568183, "post_id": 47673638, "comment_id": 82310589, "body": "@Marc The generated error message is for the <i>user of the tool</i>, not for the writer or maintainer of the tool, and therefore the error message should be the most <i>helpful and relevant to the user</i>, and not one that reflects <i>how</i> or <i>when</i> the parser drew the conclusion that the syntax is invalid."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1512569435, "post_id": 47673638, "comment_id": 82311382, "body": "I&#39;m still in agreement. The issues I mentioned in my previous comments have to do with &quot;exactly what error message do you return&quot;? This is entirely about providing actionable information to the user without drowning them in a flood of irrelevant data. My only point is that there probably isn&#39;t a perfect answer when it comes to parsing, and certainly not an easy one."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1512570154, "post_id": 47673638, "comment_id": 82311888, "body": "@Marc Ok then (I missed the &quot;agreeing&quot; part)."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": false, "score": 3, "last_activity_date": 1512567762, "last_edit_date": 1512567762, "creation_date": 1512561103, "answer_id": 47673638, "question_id": 47673293, "link": "https://stackoverflow.com/questions/47673293/is-there-used-incorrect-terminology-in-description-of-a-compile-error-as-to-for/47673638#47673638", "title": "Is there used incorrect terminology in description of a compile error as to &#39;for&#39; syntax in golang?", "body": "<p>The Go Spec says the post statement of a for clause accepts (among other things) a <a href=\"https://golang.org/ref/spec#IncDecStmt\" rel=\"nofollow noreferrer\">IndDec</a> statement.</p>\n\n<p>The IncDec statement is defined as: <code>IncDecStmt = Expression ( \"++\" | \"--\" ) .</code></p>\n\n<p>The parser finds an IndDec statement but an empty expression and thus spits out the error \"expecting expression\".</p>\n\n<p>Edit: this probably fails because the fallback node to parse for a <code>SimplStmt</code> is an expression. The <code>IncDecStmt</code> failed, so it moves on to the default. The error accurately reflects the latest error that is bubbled up.</p>\n\n<p>While the error message is correct, it is a little bit misleading. However, fixing it would involve passing more context about the current tree being parsed. eg: <code>bad ForClause: bad PostStmt: bad SimpleStmt: expected expression</code>.</p>\n\n<p>There's still the problem that the <code>expected expression</code> is the last error encountered. Before that, it failed to parse the <code>IncDecStmt</code> but that error is swallowed because it falls back on an expression. The same applies at higher levels of the tree.</p>\n\n<p>Even without that problem it would be rather heavy-handed and probably even more confusing than the current error messages. You may want to ask for input from the Go folks though.</p>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1512568337, "post_id": 47675891, "comment_id": 82310678, "body": "But we get the same error (<code>unexpected break, expecting expression</code>) even if we write <code>for i := 0; i &lt; 1; break {}</code>. There is no expression expected before <code>break</code>."}, {"owner": {"reputation": 3295, "user_id": 1660286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d8ae3ea1868a70d1b8c94ab726140d?s=128&d=identicon&r=PG&f=1", "display_name": "Daniil Grankin", "link": "https://stackoverflow.com/users/1660286/daniil-grankin"}, "edited": false, "score": 0, "creation_date": 1512574702, "post_id": 47675891, "comment_id": 82315127, "body": "Thank you for the explanation! The error is not very descriptive at least for me and now it is clear that description is reasonable and where it comes from."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 3, "last_activity_date": 1512577691, "last_edit_date": 1512577691, "creation_date": 1512568115, "answer_id": 47675891, "question_id": 47673293, "link": "https://stackoverflow.com/questions/47673293/is-there-used-incorrect-terminology-in-description-of-a-compile-error-as-to-for/47675891#47675891", "title": "Is there used incorrect terminology in description of a compile error as to &#39;for&#39; syntax in golang?", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification\n  </a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#PrimaryExpr\" rel=\"nofollow noreferrer\">Primary expressions</a></p>\n  \n  <p>Primary expressions are the operands for unary and binary expressions.</p>\n\n<pre><code>PrimaryExpr =\n  Operand |\n  Conversion |\n  PrimaryExpr Selector |\n  PrimaryExpr Index |\n  PrimaryExpr Slice |\n  PrimaryExpr TypeAssertion |\n  PrimaryExpr Arguments .\n\nSelector       = \".\" identifier .\nIndex          = \"[\" Expression \"]\" .\nSlice          = \"[\" [ Expression ] \":\" [ Expression ] \"]\" |\n                 \"[\" [ Expression ] \":\" Expression \":\" Expression \"]\" .\nTypeAssertion  = \".\" \"(\" Type \")\" .\nArguments      = \"(\" [ ( ExpressionList | Type [ \",\" ExpressionList ] ) [ \"...\" ] [ \",\" ] ] \")\" .\n</code></pre>\n  \n  <p>Operators and punctuation</p>\n  \n  <p>The following character sequences represent operators:</p>\n\n<pre><code>++    \n--    \n</code></pre>\n  \n  <p><a href=\"https://golang.org/ref/spec#Operators\" rel=\"nofollow noreferrer\">Operators</a></p>\n  \n  <p>Operators combine operands into expressions.</p>\n\n<pre><code>Expression = UnaryExpr | Expression binary_op Expression .\nUnaryExpr  = PrimaryExpr | unary_op UnaryExpr .\n\nbinary_op  = \"||\" | \"&amp;&amp;\" | rel_op | add_op | mul_op .\nrel_op     = \"==\" | \"!=\" | \"&lt;\" | \"&lt;=\" | \"&gt;\" | \"&gt;=\" .\nadd_op     = \"+\" | \"-\" | \"|\" | \"^\" .\nmul_op     = \"*\" | \"/\" | \"%\" | \"&lt;&lt;\" | \"&gt;&gt;\" | \"&amp;\" | \"&amp;^\" .\n\nunary_op   = \"+\" | \"-\" | \"!\" | \"^\" | \"*\" | \"&amp;\" | \"&lt;-\" .\n</code></pre>\n  \n  <p>Operator precedence</p>\n  \n  <p>The ++ and -- operators form statements, not expressions.</p>\n  \n  <p><a href=\"https://golang.org/ref/spec#IncDec_statements\" rel=\"nofollow noreferrer\">IncDec statements</a></p>\n  \n  <p>The \"++\" and \"--\" statements increment or decrement their operands by\n  the untyped constant 1. As with an assignment, the operand must be\n  addressable or a map index expression.</p>\n\n<pre><code>IncDecStmt = Expression ( \"++\" | \"--\" ) .\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p><code>++</code> and <code>--</code> are operators. The <code>++</code> and <code>--</code> operators form statements, not expressions. </p>\n\n<pre><code>IncDecStmt = Expression ( \"++\" | \"--\" ) . \n</code></pre>\n\n<p>When the compiler encounters an <code>++</code> operator, it expects it to be immediately preceded by an expresssion.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nfunc main() {\n\n    // syntax error: unexpected ++, expecting expression\n    for i := 0; i &lt; 1; ++i {}\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/y2d9ijeMdw\" rel=\"nofollow noreferrer\">https://play.golang.org/p/y2d9ijeMdw</a></p>\n\n<p>Output:</p>\n\n<pre><code>main.go:6:21: syntax error: unexpected ++, expecting expression\n</code></pre>\n\n<p>The compiler complains about the syntax. It found a <code>++</code> operator without an immediately preceding expression: <code>syntax error: unexpected ++, expecting expression</code>.</p>\n"}], "owner": {"reputation": 3295, "user_id": 1660286, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60d8ae3ea1868a70d1b8c94ab726140d?s=128&d=identicon&r=PG&f=1", "display_name": "Daniil Grankin", "link": "https://stackoverflow.com/users/1660286/daniil-grankin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 1, "accepted_answer_id": 47675891, "answer_count": 2, "score": 0, "last_activity_date": 1512577691, "creation_date": 1512559995, "last_edit_date": 1512560787, "question_id": 47673293, "link": "https://stackoverflow.com/questions/47673293/is-there-used-incorrect-terminology-in-description-of-a-compile-error-as-to-for", "title": "Is there used incorrect terminology in description of a compile error as to &#39;for&#39; syntax in golang?", "body": "<p>I tried to use something like</p>\n\n<pre><code>for i := 0; i &lt; len(bytes); ++i {\n        ...\n}\n</code></pre>\n\n<p>It is not correct and I got an error </p>\n\n<blockquote>\n  <p>syntax error: unexpected ++, expecting <strong>expression</strong></p>\n</blockquote>\n\n<p>It was because of <code>++i</code> is not an expression I thought.</p>\n\n<p>Then I found out that <code>i++</code> (it works in <code>for</code> loop) is not an expression as well according to <a href=\"https://golang.org/doc/faq#inc_dec\" rel=\"nofollow noreferrer\">the documentation</a>.</p>\n\n<p>Also I met that in <a href=\"https://stackoverflow.com/questions/23880663/golang-why-and-not-work-in-expressions\">some cases</a> (now I think in all cases) a statement can not be used instead of expression.</p>\n\n<p>Now if we come back to the error we see that <code>for</code> loop requires an <strong>expression</strong>. I was confused with that. I checked one more part of <a href=\"https://golang.org/ref/spec#For_statements\" rel=\"nofollow noreferrer\">the documentation</a> it turns out <code>for</code> requires a statement. </p>\n\n<blockquote>\n  <p>For statements with for clause</p>\n  \n  <p>A \"for\" statement with a ForClause is also controlled by its\n  condition, but additionally it may specify an init and a post\n  <strong>statement</strong></p>\n</blockquote>\n\n<p>I started with question (which I liked more than the final question because it was about language non-acquaintance as I thought)</p>\n\n<p>Is it special case for loop syntax that statement are accepted as expression or are there other cases in golang?</p>\n\n<p>During writing the question and checking the documentation I end up to a questions</p>\n\n<p>Is there used incorrect terminology in description of the error that should be fixed not to confuse? Or is it normally in some cases to substitute such terms as statement and expression? </p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1512555496, "post_id": 47671747, "comment_id": 82302480, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/47446523/google-app-engine-datastore-returns-no-rows-if-i-have-an-order-clause/47455578#47455578\">Google App Engine Datastore returns no rows if i have an Order clause</a>."}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1512556593, "post_id": 47671747, "comment_id": 82303196, "body": "Please add code for your Foo struct and for insert (put) and query."}, {"owner": {"reputation": 107, "user_id": 7836768, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550083c73775e651fe894122315a87df?s=128&d=identicon&r=PG&f=1", "display_name": "Kieran W.", "link": "https://stackoverflow.com/users/7836768/kieran-w"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1512579866, "post_id": 47671747, "comment_id": 82318564, "body": "@icza I&#39;m doing it exactly like that. There are no &quot;noindex&quot; properties. I&#39;m running everything locally, and even if I start with a blank datastore, add 1 or multiple records, I still can&#39;t get any records returned with .Order() specified."}], "answers": [{"tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": false, "score": 1, "last_activity_date": 1512556926, "creation_date": 1512556926, "answer_id": 47672293, "question_id": 47671747, "link": "https://stackoverflow.com/questions/47671747/datastore-query-returns-no-data-when-ordering-result/47672293#47672293", "title": "Datastore query returns no data when ordering result", "body": "<p>Entities are indexed at the moment of inserting.</p>\n\n<ol>\n<li>Make sure your struct field does not have <code>noindex</code> annotation for datastore.</li>\n<li><p>Make sure your struct field does not change property name in the annotation (comment. e.g.:</p>\n\n<p>Bar string // <code>datastore:bar</code></p></li>\n<li><p>Make sure you did not override PropertyLoadSaver and do not make the property unindexable and do not change name.</p></li>\n<li>Check in datastore viewer you can order on the property so it's not problem with your Put() code and probably problem with your query.</li>\n</ol>\n"}], "owner": {"reputation": 107, "user_id": 7836768, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550083c73775e651fe894122315a87df?s=128&d=identicon&r=PG&f=1", "display_name": "Kieran W.", "link": "https://stackoverflow.com/users/7836768/kieran-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 566, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1512580282, "creation_date": 1512555211, "last_edit_date": 1512580282, "question_id": 47671747, "link": "https://stackoverflow.com/questions/47671747/datastore-query-returns-no-data-when-ordering-result", "title": "Datastore query returns no data when ordering result", "body": "<p>I have a simple test object Foo with the string property Bar. When I do a .GetAll(\"Foo\") query I get all objects returned, however, when I add .Order(\"Bar\") then nothing is returned. I have tried both with and without index.yaml specifying the object and property, with and without sort order. What am I missing? I'm not using \"noindex\" on the Bar property.</p>\n\n<pre><code>type Foo struct {\n   Bar string\n}\n\n.NewQuery(\"Foo\").Order(\"Bar\").GetAll(c, &amp;foo)  &lt;-- nothing returned\n\n.NewQuery(\"Foo\").GetAll(c, &amp;foo)  &lt;-- objects returned\n</code></pre>\n"}, {"tags": ["go", "command"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512572862, "post_id": 47667479, "comment_id": 82313862, "body": "Note that when you call <code>exec.Command</code>, the first parameter is the command, subsequent parameters are the args. So your code changes the actual execution to (shell equivalent) <code>echo &quot;echo2&quot; &quot;oh wait I changed my mind&quot;</code>. To change the command to execute, not just its args, you have to update <code>cmd.Path</code>."}, {"owner": {"reputation": 576, "user_id": 1272013, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/769b3ccb233f1144eccad8c6038e8cf4?s=128&d=identicon&r=PG", "display_name": "cyc115", "link": "https://stackoverflow.com/users/1272013/cyc115"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512575667, "post_id": 47667479, "comment_id": 82315798, "body": "Ah thank you @Adrian. It seems so :)."}], "answers": [{"comments": [{"owner": {"reputation": 576, "user_id": 1272013, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/769b3ccb233f1144eccad8c6038e8cf4?s=128&d=identicon&r=PG", "display_name": "cyc115", "link": "https://stackoverflow.com/users/1272013/cyc115"}, "reply_to_user": {"reputation": 5608, "user_id": 660828, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2ab261718814b4842efac71a1b6cd1a5?s=128&d=identicon&r=PG", "display_name": "Tom Jowitt", "link": "https://stackoverflow.com/users/660828/tom-jowitt"}, "edited": false, "score": 0, "creation_date": 1512575938, "post_id": 47668364, "comment_id": 82315997, "body": "Thank you for your answer Cerise and @Tom"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1512553307, "last_edit_date": 1512553307, "creation_date": 1512542582, "answer_id": 47668364, "question_id": 47667479, "link": "https://stackoverflow.com/questions/47667479/modify-arguments-after-calling-exec-cmd-in-go/47668364#47668364", "title": "Modify arguments after calling exec.Cmd() in Go", "body": "<p>When changing the command to execute, you must also set <a href=\"https://godoc.org/os/exec#Cmd.Path\" rel=\"nofollow noreferrer\">cmd.Path</a> as in  <a href=\"https://github.com/golang/go/blob/a032f74bf0b40a94669159e7d7e96722eb76199b/src/os/exec/exec.go#L152-L162\" rel=\"nofollow noreferrer\">exec.Command</a>. </p>\n\n<pre><code>cmd := exec.Command(\"echo\", \"hello world\")\ncmd.Env = []string{\"env1=1\"}\ncmd.Args = []string{\"echo2\", \"oh wait I changed my mind\"}\n\nlp, err := exec.LookPath(\"echo2\")\nif err != nil {\n    // handle error\n}\n\ncmd.Path = lp\nif err := cmd.Run(); err != nil {\n    // handle error\n}\n</code></pre>\n"}], "owner": {"reputation": 576, "user_id": 1272013, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/769b3ccb233f1144eccad8c6038e8cf4?s=128&d=identicon&r=PG", "display_name": "cyc115", "link": "https://stackoverflow.com/users/1272013/cyc115"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 1, "accepted_answer_id": 47668364, "answer_count": 1, "score": 1, "last_activity_date": 1512553307, "creation_date": 1512538501, "last_edit_date": 1512543652, "question_id": 47667479, "link": "https://stackoverflow.com/questions/47667479/modify-arguments-after-calling-exec-cmd-in-go", "title": "Modify arguments after calling exec.Cmd() in Go", "body": "<p>I am trying to run command with <code>exec.Cmd(command, flags...)</code> and want to have the flexibility to modify the arguments before calling the <code>cmd.Run()</code> function. </p>\n\n<p>for example:</p>\n\n<pre><code>cmd := exec.Command(\"echo\", \"hello world\")\ncmd.Env = []string{\"env1=1\"}\ncmd.Args = []string{\"echo2\", \"oh wait I changed my mind\"}\ncmd.Run()\n</code></pre>\n\n<p>The above code seems to be always running <code>echo hello world</code> but not <code>echo2 oh wait I changed my mind</code></p>\n\n<p>Am I correct to expect <code>echo2</code> to be run instead of <code>echo</code>? </p>\n"}, {"tags": ["go", "grpc"], "answers": [{"tags": [], "owner": {"reputation": 1998, "user_id": 4094489, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/egnIZ.jpg?s=128&g=1", "display_name": "Citrullin", "link": "https://stackoverflow.com/users/4094489/citrullin"}, "is_accepted": true, "score": 2, "last_activity_date": 1512551575, "last_edit_date": 1512551575, "creation_date": 1512547542, "answer_id": 47669533, "question_id": 47667467, "link": "https://stackoverflow.com/questions/47667467/send-huge-data-from-client-to-server/47669533#47669533", "title": "Send huge data from client to server", "body": "<p>The second one is more the way you want to go. But another point: Are you sure you want to have these hundreds of megabytes in your RAM? I'm not the Go-Geek, but I generally would prefer to work on a File Stream. And probably implement something like a back-pressure-system.</p>\n\n<p>If you work with streams: I would also implement something to make sure that you can handle a break of the stream. Let's say you have the half of your stream and the stream breaks. You don't want to start again and get all previous stream elements, which you already have on the client side. You risk again a connection break within the stream. Maybe at the same point. So, something like pagination. Let's say </p>\n\n<pre><code>message CMRequest{\n  int startAt = 0;\n}\n\nmessage CmReply {\n  string id = 0;\n  string name = 1;\n}\n</code></pre>\n\n<p>If the stream breaks, you send a new request with startAt= LastCmReply.id+1</p>\n\n<p>Here's a video of some good practices in grpc: <a href=\"https://www.youtube.com/watch?v=Z_yD7YPL2oE&amp;index=17&amp;list=WL\" rel=\"nofollow noreferrer\">https://www.youtube.com/watch?v=Z_yD7YPL2oE&amp;index=17&amp;list=WL</a></p>\n"}, {"tags": [], "owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "is_accepted": false, "score": 1, "last_activity_date": 1512816947, "creation_date": 1512816947, "answer_id": 47727799, "question_id": 47667467, "link": "https://stackoverflow.com/questions/47667467/send-huge-data-from-client-to-server/47727799#47727799", "title": "Send huge data from client to server", "body": "<p>You have two options:</p>\n\n<ol>\n<li>Implement client-side streaming protocol in the way you have described above (split your file into chunks and send them one-by-one to the server):\n<a href=\"https://github.com/grpc/grpc-go/issues/414#issuecomment-284515856\" rel=\"nofollow noreferrer\">https://github.com/grpc/grpc-go/issues/414#issuecomment-284515856</a></li>\n<li>Extend the default <code>4 MB</code> limits for a message size for your <code>GRPC</code> client and server (then you'll be able to send and receive big messages without streaming):\n<a href=\"https://godoc.org/google.golang.org/grpc#MaxMsgSize\" rel=\"nofollow noreferrer\">https://godoc.org/google.golang.org/grpc#MaxMsgSize</a>\n<a href=\"https://godoc.org/google.golang.org/grpc#WithMaxMsgSize\" rel=\"nofollow noreferrer\">https://godoc.org/google.golang.org/grpc#WithMaxMsgSize</a></li>\n</ol>\n"}], "owner": {"reputation": 947, "user_id": 3218674, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/E7ZAV.jpg?s=128&g=1", "display_name": "Gauranga", "link": "https://stackoverflow.com/users/3218674/gauranga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2521, "favorite_count": 2, "accepted_answer_id": 47669533, "answer_count": 2, "score": 3, "last_activity_date": 1512816947, "creation_date": 1512538464, "last_edit_date": 1512553404, "question_id": 47667467, "link": "https://stackoverflow.com/questions/47667467/send-huge-data-from-client-to-server", "title": "Send huge data from client to server", "body": "<p>I am working with <code>Go</code> and <code>Grpc</code>. I have one <code>XML</code> file to be sent from client to server. When server calls a method on client, client responds back with an <code>XML</code> document which could range from few <code>kB</code> to 100s <code>MB</code> or may be more. Please help me with how should I do it? Should I </p>\n\n<ol>\n<li>assign the value to a <code>string</code> variable and send normally -> <code>rpc GetCMData (CmRequest) returns (CmReply) {}</code></li>\n<li>assign the value to a <code>string</code> variable and send as a <code>stream</code> -> <code>rpc GetCMData (CmRequest) returns (stream CmReply) {}</code></li>\n<li>Is there any other better way to do so?</li>\n</ol>\n\n<p>This is how <code>CmReply</code> looks like:</p>\n\n<pre><code>message CmReply {\n  string name = 1;\n}\n</code></pre>\n"}, {"tags": ["go", "grpc"], "comments": [{"owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "edited": false, "score": 0, "creation_date": 1512552961, "post_id": 47667085, "comment_id": 82300766, "body": "Have you looked at <a href=\"https://godoc.org/github.com/golang/protobuf/proto\" rel=\"nofollow noreferrer\">godoc.org/github.com/golang/protobuf/proto</a>?"}, {"owner": {"reputation": 1998, "user_id": 4094489, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/egnIZ.jpg?s=128&g=1", "display_name": "Citrullin", "link": "https://stackoverflow.com/users/4094489/citrullin"}, "reply_to_user": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "edited": false, "score": 0, "creation_date": 1512556955, "post_id": 47667085, "comment_id": 82303458, "body": "@dev.bmad Yes. Serialization of it shouldn&#39;t be the problem. But how to send it over the generated gRPC Server? On return streams I can only use send() with the generated struct message."}, {"owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "edited": false, "score": 1, "creation_date": 1512564948, "post_id": 47667085, "comment_id": 82308386, "body": "Here&#39;s a <a href=\"https://github.com/harshavardhana/grpc-gob-hello\" rel=\"nofollow noreferrer\">demo</a> that I&#39;ve found on GitHub. It does a different job, but you can get the idea of what needs to be implemented (<code>grpc.Codec</code>, <code>grpc.ServiceDesc </code>, <code>grpc.MethodDesc</code>, etc)."}, {"owner": {"reputation": 1998, "user_id": 4094489, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/egnIZ.jpg?s=128&g=1", "display_name": "Citrullin", "link": "https://stackoverflow.com/users/4094489/citrullin"}, "reply_to_user": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "edited": false, "score": 0, "creation_date": 1512565201, "post_id": 47667085, "comment_id": 82308563, "body": "@dev.bmax Thanks. Did a short look into the code. Looks good. I will try it at home. :)"}, {"owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "edited": false, "score": 0, "creation_date": 1512832746, "post_id": 47667085, "comment_id": 82420566, "body": "Sorry, the problem is not clear: if you get <code>[]byte</code> from your Database, and you can define GRPC method which returns <code>[]byte</code> to the client, just connect GRPC server and Database client with each other."}, {"owner": {"reputation": 1998, "user_id": 4094489, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/egnIZ.jpg?s=128&g=1", "display_name": "Citrullin", "link": "https://stackoverflow.com/users/4094489/citrullin"}, "reply_to_user": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "edited": false, "score": 0, "creation_date": 1512843726, "post_id": 47667085, "comment_id": 82423965, "body": "@VitalyIsaev That&#39;s one way. I save the whole protobuf message response in the database. I want to return this message without serialization at all."}], "owner": {"reputation": 1998, "user_id": 4094489, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/egnIZ.jpg?s=128&g=1", "display_name": "Citrullin", "link": "https://stackoverflow.com/users/4094489/citrullin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 407, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1512546604, "creation_date": 1512536402, "last_edit_date": 1512546604, "question_id": 47667085, "link": "https://stackoverflow.com/questions/47667085/grpc-send-directly-protobuf-format", "title": "gRPC send directly protobuf format", "body": "<p>I got an service where I also want to use protobuf for the storage system. So instead of serialize the object from a protobuf wire format, I just want to read the database and send this result direct as response. I already researched within the generated and grpc code but it is, at the moment, still a mystery how it works. I get the response from the database as type of []byte. How can I achieve this?</p>\n"}, {"tags": ["regex", "testing", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1512537102, "post_id": 47666821, "comment_id": 82293405, "body": "A natural guess would be: &quot;Go&#39;s own regular expression syntax!&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 3549, "user_id": 658270, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/56a007a4b2c47b141bd39790278f88a7?s=128&d=identicon&r=PG", "display_name": "Sonia Hamilton", "link": "https://stackoverflow.com/users/658270/sonia-hamilton"}, "edited": false, "score": 0, "creation_date": 1512594378, "post_id": 47666864, "comment_id": 82326315, "body": "Duh! Who knew? Thanks @hobbs."}], "tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 4, "last_activity_date": 1512535022, "creation_date": 1512535022, "answer_id": 47666864, "question_id": 47666821, "link": "https://stackoverflow.com/questions/47666821/go-test-regex-type-or-syntax/47666864#47666864", "title": "go test regex type or syntax", "body": "<p>It's Go regex, documented in <a href=\"https://golang.org/pkg/regexp/syntax/\" rel=\"nofollow noreferrer\">regexp/syntax</a>.</p>\n"}], "owner": {"reputation": 3549, "user_id": 658270, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/56a007a4b2c47b141bd39790278f88a7?s=128&d=identicon&r=PG", "display_name": "Sonia Hamilton", "link": "https://stackoverflow.com/users/658270/sonia-hamilton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 655, "favorite_count": 0, "accepted_answer_id": 47666864, "answer_count": 1, "score": 1, "last_activity_date": 1512535022, "creation_date": 1512534716, "question_id": 47666821, "link": "https://stackoverflow.com/questions/47666821/go-test-regex-type-or-syntax", "title": "go test regex type or syntax", "body": "<p>What type or syntax of regex is used when running <code>go test -r &lt;regex&gt;</code> commands? I'm using <code>-list</code> to find the tests I want to run before using <code>-r</code>, like this:</p>\n\n<pre><code>go test -list 'Foo' *.go\n</code></pre>\n\n<p>I'm having specific difficulty with the following two test names:</p>\n\n<pre><code>func TestSendTrap(...\nfunc TestSendTrapFull(...\n</code></pre>\n\n<p>This works:</p>\n\n<pre><code>go test -list 'TestSendTrap\\b' *.go\n</code></pre>\n\n<p>So I'm presuming <a href=\"https://www.debuggex.com/cheatsheet/regex/pcre\" rel=\"nofollow noreferrer\">PCRE syntax</a> is being used, but <a href=\"https://golang.org/cmd/go/\" rel=\"nofollow noreferrer\">command go</a> doesn't detail.</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1512525193, "post_id": 47665513, "comment_id": 82290375, "body": "<code>append</code> may potentially change the contents of the underlying array. So after you append to a slice - the slice you appended to is not guaranteed to stay the same."}, {"owner": {"reputation": 1, "user_id": 9059303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a88c455bf2c44d175d729d993e028a7?s=128&d=identicon&r=PG&f=1", "display_name": "Chandra Pratama", "link": "https://stackoverflow.com/users/9059303/chandra-pratama"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1512526536, "post_id": 47665513, "comment_id": 82290697, "body": "Thanks.. So, what is the better solution for my problem?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1512547366, "post_id": 47665513, "comment_id": 82297675, "body": "This answer directly answers your question: <a href=\"https://stackoverflow.com/questions/16248241/concatenate-two-slices-in-go/40036950#40036950\">Concatenate two slices in Go</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9059303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a88c455bf2c44d175d729d993e028a7?s=128&d=identicon&r=PG&f=1", "display_name": "Chandra Pratama", "link": "https://stackoverflow.com/users/9059303/chandra-pratama"}, "edited": false, "score": 0, "creation_date": 1512528652, "post_id": 47665943, "comment_id": 82291222, "body": "Thanks for the answer. Is this a heavy operation? I thought that I can use slice the same as I used ArrayList in Java or vector in cpp"}, {"owner": {"reputation": 698, "user_id": 5617424, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3rmoz.jpg?s=128&g=1", "display_name": "Vane Trajkov", "link": "https://stackoverflow.com/users/5617424/vane-trajkov"}, "reply_to_user": {"reputation": 1, "user_id": 9059303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a88c455bf2c44d175d729d993e028a7?s=128&d=identicon&r=PG&f=1", "display_name": "Chandra Pratama", "link": "https://stackoverflow.com/users/9059303/chandra-pratama"}, "edited": false, "score": 0, "creation_date": 1512530043, "post_id": 47665943, "comment_id": 82291543, "body": "Not sure how ArrayList in Java or vector in cpp behave but what I can say that we should be careful working with slices as they are pointers to piece of an underlying array, as the docs say <code>A slice is not an array. A slice describes a piece of an array.</code>.  In this case, you have no choice than to create a copy of the slice you want to pass around and use it in more operations. This will guarantee you that no funky business will happen in the background when the same existing slice is trying to relocate memory to accommodate new writes.  - <a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">blog.golang.org/slices</a>"}], "tags": [], "owner": {"reputation": 698, "user_id": 5617424, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3rmoz.jpg?s=128&g=1", "display_name": "Vane Trajkov", "link": "https://stackoverflow.com/users/5617424/vane-trajkov"}, "is_accepted": true, "score": 0, "last_activity_date": 1512529449, "last_edit_date": 1512529449, "creation_date": 1512527846, "answer_id": 47665943, "question_id": 47665513, "link": "https://stackoverflow.com/questions/47665513/slice-append-change-other-elements-in-slice/47665943#47665943", "title": "Slice append change other elements in Slice", "body": "<p>In your <code>append</code> function calls you are using slices meaning you work with references, thus no guarantee that the values will remain static as @zerkms mentioned. \nWhat you can do is create a copy of the slice <code>temp</code> returned from the 1st <code>append</code> call and use it in the 2nd <code>append</code>. This will make passing a copy of the <code>temp</code> slice and with that avoiding any interferences. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(subsets([]int{0, 1, 2, 3, 4}))\n}\n\nfunc subsets(nums []int) [][]int {\n    res := [][]int{}\n\n    res = append(res, []int{})\n    for i := 0; i &lt; len(nums); i++ {\n        for j := range res {\n            fmt.Println(i)\n            temp := append(res[j], nums[i])\n            copy_temp := make([]int, len(temp))\n            copy(copy_temp, temp)\n            fmt.Println(copy_temp)\n            res = append(res, copy_temp)\n            fmt.Println(res)\n        }\n    }\n\n    return res\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 9059303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a88c455bf2c44d175d729d993e028a7?s=128&d=identicon&r=PG&f=1", "display_name": "Chandra Pratama", "link": "https://stackoverflow.com/users/9059303/chandra-pratama"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 687, "favorite_count": 0, "accepted_answer_id": 47665943, "answer_count": 1, "score": -1, "last_activity_date": 1538210964, "creation_date": 1512524662, "last_edit_date": 1538210964, "question_id": 47665513, "link": "https://stackoverflow.com/questions/47665513/slice-append-change-other-elements-in-slice", "title": "Slice append change other elements in Slice", "body": "<p>I'm solving Leetcode question at <a href=\"https://leetcode.com/problems/subsets\" rel=\"nofollow noreferrer\">https://leetcode.com/problems/subsets</a> with Golang and iterative solution. The algorithm is basically trying to add the new element to the existing array. After all, it will generate all of the subsets.</p>\n\n<p>But when some elements added to the existing array solution, it change the other element also. Here's the code I provided. I put some debugging Println also.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(subsets([]int{0, 1, 2, 3, 4}))\n}\n\nfunc subsets(nums []int) [][]int {\n    res := [][]int{}\n\n    res = append(res, []int{})\n    for i := 0; i &lt; len(nums); i++ {\n        for j := range res {\n            fmt.Println(i)\n            temp := append(res[j], nums[i])\n            fmt.Println(temp)\n            res = append(res, temp)\n            fmt.Println(res)\n        }\n    }\n\n    return res\n}\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>0\n[0]\n[[] [0]]\n1\n[1]\n[[] [0] [1]]\n1\n[0 1]\n[[] [0] [1] [0 1]]\n2\n[2]\n[[] [0] [1] [0 1] [2]]\n2\n[0 2]\n[[] [0] [1] [0 1] [2] [0 2]]\n2\n[1 2]\n[[] [0] [1] [0 1] [2] [0 2] [1 2]]\n2\n[0 1 2]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2]]\n3\n[3]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3]]\n3\n[0 3]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3]]\n3\n[1 3]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3]]\n3\n[0 1 3]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3]]\n3\n[2 3]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3] [2 3]]\n3\n[0 2 3]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3] [2 3] [0 2 3]]\n3\n[1 2 3]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3] [2 3] [0 2 3] [1 2 3]]\n3\n[0 1 2 3]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3] [2 3] [0 2 3] [1 2 3] [0 1 2 3]]\n4\n[4]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3] [2 3] [0 2 3] [1 2 3] [0 1 2 3] [4]]\n4\n[0 4]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3] [2 3] [0 2 3] [1 2 3] [0 1 2 3] [4] [0 4]]\n4\n[1 4]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3] [2 3] [0 2 3] [1 2 3] [0 1 2 3] [4] [0 4] [1 4]]\n4\n[0 1 4]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3] [2 3] [0 2 3] [1 2 3] [0 1 2 3] [4] [0 4] [1 4] [0 1 4]]\n4\n[2 4]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3] [2 3] [0 2 3] [1 2 3] [0 1 2 3] [4] [0 4] [1 4] [0 1 4] [2 4]]\n4\n[0 2 4]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3] [2 3] [0 2 3] [1 2 3] [0 1 2 3] [4] [0 4] [1 4] [0 1 4] [2 4] [0 2 4]]\n4\n[1 2 4]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3] [2 3] [0 2 3] [1 2 3] **[0 1 2 3]** [4] [0 4] [1 4] [0 1 4] [2 4] [0 2 4] [1 2 4]]\n4\n[0 1 2 4]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3] [2 3] [0 2 3] [1 2 3] **[0 1 2 4]** [4] [0 4] [1 4] [0 1 4] [2 4] [0 2 4] [1 2 4] [0 1 2 4]]\n4\n[3 4]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3] [2 3] [0 2 3] [1 2 3] [0 1 2 4] [4] [0 4] [1 4] [0 1 4] [2 4] [0 2 4] [1 2 4] [0 1 2 4] [3 4]]\n4\n[0 3 4]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3] [2 3] [0 2 3] [1 2 3] [0 1 2 4] [4] [0 4] [1 4] [0 1 4] [2 4] [0 2 4] [1 2 4] [0 1 2 4] [3 4] [0 3 4]]\n4\n[1 3 4]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3] [2 3] [0 2 3] [1 2 3] [0 1 2 4] [4] [0 4] [1 4] [0 1 4] [2 4] [0 2 4] [1 2 4] [0 1 2 4] [3 4] [0 3 4] [1 3 4]]\n4\n[0 1 3 4]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3] [2 3] [0 2 3] [1 2 3] [0 1 2 4] [4] [0 4] [1 4] [0 1 4] [2 4] [0 2 4] [1 2 4] [0 1 2 4] [3 4] [0 3 4] [1 3 4] [0 1 3 4]]\n4\n[2 3 4]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3] [2 3] [0 2 3] [1 2 3] [0 1 2 4] [4] [0 4] [1 4] [0 1 4] [2 4] [0 2 4] [1 2 4] [0 1 2 4] [3 4] [0 3 4] [1 3 4] [0 1 3 4] [2 3 4]]\n4\n[0 2 3 4]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3] [2 3] [0 2 3] [1 2 3] [0 1 2 4] [4] [0 4] [1 4] [0 1 4] [2 4] [0 2 4] [1 2 4] [0 1 2 4] [3 4] [0 3 4] [1 3 4] [0 1 3 4] [2 3 4] [0 2 3 4]]\n4\n[1 2 3 4]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3] [2 3] [0 2 3] [1 2 3] [0 1 2 4] [4] [0 4] [1 4] [0 1 4] [2 4] [0 2 4] [1 2 4] [0 1 2 4] [3 4] [0 3 4] [1 3 4] [0 1 3 4] [2 3 4] [0 2 3 4] [1 2 3 4]]\n4\n[0 1 2 4 4]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3] [2 3] [0 2 3] [1 2 3] [0 1 2 4] [4] [0 4] [1 4] [0 1 4] [2 4] [0 2 4] [1 2 4] [0 1 2 4] [3 4] [0 3 4] [1 3 4] [0 1 3 4] [2 3 4] [0 2 3 4] [1 2 3 4] [0 1 2 4 4]]\n[[] [0] [1] [0 1] [2] [0 2] [1 2] [0 1 2] [3] [0 3] [1 3] [0 1 3] [2 3] [0 2 3] [1 2 3] [0 1 2 4] [4] [0 4] [1 4] [0 1 4] [2 4] [0 2 4] [1 2 4] [0 1 2 4] [3 4] [0 3 4] [1 3 4] [0 1 3 4] [2 3 4] [0 2 3 4] [1 2 3 4] [0 1 2 4 4]]\n</code></pre>\n\n<p>When it add the [0 1 2 4] element, it also change the existing [0 1 2 3] to [0 1 2 4]. Is there any specific reason why this happen?</p>\n"}, {"tags": ["go", "grpc", "godeps"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1512517589, "post_id": 47664531, "comment_id": 82288316, "body": "Show the very line that triggers that compilation error."}, {"owner": {"reputation": 1354, "user_id": 6412942, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c8302ba86cf28126f773c6f40573c175?s=128&d=identicon&r=PG&f=1", "display_name": "leopoodle", "link": "https://stackoverflow.com/users/6412942/leopoodle"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1512518018, "post_id": 47664531, "comment_id": 82288478, "body": "@zerkms it is added now."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1512518702, "post_id": 47664531, "comment_id": 82288702, "body": "You can\u2019t import the same packages from multiple paths. Move the vendored packages from your dependencies into the top level vendor directory."}, {"owner": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "edited": false, "score": 1, "creation_date": 1512519257, "post_id": 47664531, "comment_id": 82288862, "body": "Nested vendoring is a real pain to deal with and no solution is ideal.  Your easiest option is to manually delete the vendored package from xxxx/yyyy. If that fails because it is using a different version of grpc, vendor that version into your own project and leave it deleted from the external one."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1512519861, "post_id": 47664531, "comment_id": 82288989, "body": "@SteveHe: you should vendor that package so you do have control over it."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512575749, "post_id": 47664531, "comment_id": 82315857, "body": "This is why it&#39;s generally considered bad practice to vendor dependencies in a library; vendoring should only be used for binaries."}], "answers": [{"tags": [], "owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "is_accepted": false, "score": -1, "last_activity_date": 1514144988, "last_edit_date": 1514144988, "creation_date": 1512832912, "answer_id": 47730051, "question_id": 47664531, "link": "https://stackoverflow.com/questions/47664531/same-vendor-code-from-multiple-packages/47730051#47730051", "title": "same vendor code from multiple packages", "body": "<p>I think, you must vendor <em>every</em> dependency of your project (if necessary - include Go std library too), or you shouldn't use vendoring at all. There's no third choise. </p>\n"}], "owner": {"reputation": 1354, "user_id": 6412942, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c8302ba86cf28126f773c6f40573c175?s=128&d=identicon&r=PG&f=1", "display_name": "leopoodle", "link": "https://stackoverflow.com/users/6412942/leopoodle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 359, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1514144988, "creation_date": 1512517450, "last_edit_date": 1512521302, "question_id": 47664531, "link": "https://stackoverflow.com/questions/47664531/same-vendor-code-from-multiple-packages", "title": "same vendor code from multiple packages", "body": "<p>I'm trying to use grpc <code>\"google.golang.org/grpc\"</code> package.</p>\n\n<pre><code>import (\n    \"github.com/xxxx/yyyy\"\n    \"google.golang.org/grpc\"\n)\n\nconn, err := grpc.Dial(address)\npppp.NewXXXXClient(conn) // where pppp is from github.com/xxxx/yyyy\n</code></pre>\n\n<p>What happens if <code>github.com/xxxx/yyyy</code> also vendors the same grpc package?\nI am getting a compilation error like below</p>\n\n<pre><code>cannot use conn (type *\"google.golang.org/grpc\".ClientConn) as type\n*\"github.com/xxxx/yyyy/vendor/google.golang.org/grpc\".ClientConn\n</code></pre>\n\n<p>How can I get around this?</p>\n"}, {"tags": ["go", "reflection"], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 1575078, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6549a3cc64878c9f8e01b00aec87a840?s=128&d=identicon&r=PG", "display_name": "\u0414\u043c\u0438\u0442\u0440\u0438\u0439 \u0417\u0432\u0430\u043d\u0447\u0443\u043a", "link": "https://stackoverflow.com/users/1575078/%d0%94%d0%bc%d0%b8%d1%82%d1%80%d0%b8%d0%b9-%d0%97%d0%b2%d0%b0%d0%bd%d1%87%d1%83%d0%ba"}, "edited": false, "score": 0, "creation_date": 1611315481, "post_id": 47664689, "comment_id": 116417565, "body": "Very helpful example, thanks!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 4, "last_activity_date": 1512519710, "last_edit_date": 1512519710, "creation_date": 1512518566, "answer_id": 47664689, "question_id": 47664320, "link": "https://stackoverflow.com/questions/47664320/golang-recursively-reflect-both-type-of-field-and-value/47664689#47664689", "title": "golang recursively reflect both type of field and value", "body": "<p>Try this:</p>\n\n<pre><code>func printValue(prefix string, v reflect.Value, visited map[interface{}]bool) {\n\n    fmt.Printf(\"%s: \", v.Type())\n\n    // Drill down through pointers and interfaces to get a value we can print.\n    for v.Kind() == reflect.Ptr || v.Kind() == reflect.Interface {\n        if v.Kind() == reflect.Ptr {\n            // Check for recursive data\n            if visited[v.Interface()] {\n                fmt.Println(\"visted\")\n                return\n            }\n            visited[v.Interface()] = true\n        }\n        v = v.Elem()\n    }\n\n    switch v.Kind() {\n    case reflect.Slice, reflect.Array:\n        fmt.Printf(\"%d elements\\n\", v.Len())\n        for i := 0; i &lt; v.Len(); i++ {\n            fmt.Printf(\"%s%d: \", prefix, i)\n            printValue(prefix+\"   \", v.Index(i), visited)\n        }\n    case reflect.Struct:\n        t := v.Type() // use type to get number and names of fields\n        fmt.Printf(\"%d fields\\n\", t.NumField())\n        for i := 0; i &lt; t.NumField(); i++ {\n            fmt.Printf(\"%s%s: \", prefix, t.Field(i).Name)\n            printValue(prefix+\"   \", v.Field(i), visited)\n        }\n    case reflect.Invalid:\n        fmt.Printf(\"nil\\n\")\n    default:\n        fmt.Printf(\"%v\\n\", v.Interface())\n    }\n}\n</code></pre>\n\n<p>Because it's possible to get the type from a value, there's no need to pass types to the print function.</p>\n\n<p><a href=\"https://play.golang.org/p/fqpG6VLk1A\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 63, "user_id": 9048256, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c32f35ab2d5bf056c400464f5e505630?s=128&d=identicon&r=PG&f=1", "display_name": "Coder Jones", "link": "https://stackoverflow.com/users/9048256/coder-jones"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 906, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1512519710, "creation_date": 1512516216, "question_id": 47664320, "link": "https://stackoverflow.com/questions/47664320/golang-recursively-reflect-both-type-of-field-and-value", "title": "golang recursively reflect both type of field and value", "body": "<p>\nIn golang, I want to recursively reflect through a struct, getting the name of the field, it's type and the value.</p>\n\n<p>\nThe code here helped me reflect <a href=\"https://stackoverflow.com/questions/47624318/golang-recurisive-reflection/47625992?noredirect=1#comment82247395_47625992\">golang recurisive reflection</a></p>\n\n<p>The problem is when I try to extract the value I keep getting panics when I reflect the value on a ptr Value.\nIs it possible to reflect both the type, and keep passing the value through until I get to the primitives, and at that point print both the field name, type and value?</p>\n\n<p>Here is the code I modified:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    func printType(prefix string, t reflect.Type, v reflect.Value visited map[reflect.Type]bool) {\n\n    // Print the name of this type with opening ( for description.\n    fmt.Printf(\"%s (\", t)\n\n    // Traverse elements, adding to description as we go.\nelems:\n    for {\n        switch t.Kind() {\n        case reflect.Ptr:\n            fmt.Print(\"ptr to \")\n        case reflect.Slice:\n            fmt.Print(\"slice of \")\n        case reflect.Array:\n            fmt.Printf(\"array with %d elements of \", t.Len())\n        default:\n            break elems\n        }\n        t = t.Elem()\n    }\n\n    // Print the kind of the type and the closing ) of the description.\n    // In the case of a struct, we print the names of the fields and recurse.\n    switch t.Kind() {\n    case reflect.Struct:\n        fmt.Printf(\"struct with %d fields)\\n\", t.NumField())\n        if visited[t] {\n            // Don't blow up on recursive type definition.\n            break\n        }\n        visited[t] = true\n        prefix += \"    \"\n        for i := 0; i &lt; t.NumField(); i++ {\n            f := t.Field(i)\n            // Get value for field\n            fieldValue := v.Field(i)\n\n            fmt.Print(prefix, f.Name, \" \")\n            printType(prefix, f.Type, fieldValue, visited)\n        }\n    default:\n        fmt.Printf(\"%s) : %s\\n\", t.Kind(), v)\n    }\n}\n</code></pre>\n\n\n\n<p>When I run this I get a panic when calling fieldValue := v.Field(i)\nAny thoughts on how to achieve this?</p>\n\n<p>Thanks</p>\n\n\n"}, {"tags": ["google-app-engine", "firebase", "go", "google-cloud-firestore"], "comments": [{"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1512557267, "post_id": 47663044, "comment_id": 82303665, "body": "Does <code>firestoreClient</code> use http client? May be you should pass/assign an http client created by urlfetch.Client(ctx)"}], "answers": [{"comments": [{"owner": {"reputation": 3645, "user_id": 1730966, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4dff6dbd5d9ec926ffb5266be887526f?s=128&d=identicon&r=PG", "display_name": "nibarius", "link": "https://stackoverflow.com/users/1730966/nibarius"}, "edited": false, "score": 0, "creation_date": 1512587809, "post_id": 47672546, "comment_id": 82322783, "body": "Ah, I forgot about that. But unfortunately it doesn&#39;t work. <code>firestore.NewClient()</code> returns the following error: <code>unsupported HTTP client specified</code>. It seems like it returns that error if any http client is provided when calling firestore.NewClient()"}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "reply_to_user": {"reputation": 3645, "user_id": 1730966, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4dff6dbd5d9ec926ffb5266be887526f?s=128&d=identicon&r=PG", "display_name": "nibarius", "link": "https://stackoverflow.com/users/1730966/nibarius"}, "edited": false, "score": 0, "creation_date": 1512638646, "post_id": 47672546, "comment_id": 82342170, "body": "Maybe it uses sockets that are not supported by urlfetch."}, {"owner": {"reputation": 3645, "user_id": 1730966, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4dff6dbd5d9ec926ffb5266be887526f?s=128&d=identicon&r=PG", "display_name": "nibarius", "link": "https://stackoverflow.com/users/1730966/nibarius"}, "edited": false, "score": 0, "creation_date": 1512766639, "post_id": 47672546, "comment_id": 82404631, "body": "That seems to be the case. Sockets can&#39;t be used in the free version of GAE."}], "tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": false, "score": 1, "last_activity_date": 1512557614, "creation_date": 1512557614, "answer_id": 47672546, "question_id": 47663044, "link": "https://stackoverflow.com/questions/47663044/using-cloud-firestore-with-appengine-go-standard-environment-returns-rpc-error-w/47672546#47672546", "title": "Using Cloud Firestore with AppEngine Go Standard Environment returns rpc error when running on AppEngline", "body": "<p>On AppEngine you need to create a client that uses Http client provided by urlfetch service.</p>\n\n<p>The <a href=\"https://godoc.org/cloud.google.com/go/firestore#NewClient\" rel=\"nofollow noreferrer\"><code>firestore.NewClient()</code></a> function accepts <a href=\"https://godoc.org/google.golang.org/api/option#ClientOption\" rel=\"nofollow noreferrer\"><code>ClientOptions</code></a> parameters that you can create using <a href=\"https://godoc.org/google.golang.org/api/option#WithHTTPClient\" rel=\"nofollow noreferrer\"><code>WithHTTPCLient()</code></a> function.</p>\n\n<p>Here is an article on <a href=\"https://cloud.google.com/appengine/docs/standard/go/issue-requests\" rel=\"nofollow noreferrer\">issuing HTTP requests from AppEngine Go</a>.</p>\n\n<p>That should help.</p>\n"}, {"comments": [{"owner": {"reputation": 3581, "user_id": 95055, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b682b7e4db82aaca0ee9da21b7bbc840?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/95055/peter"}, "edited": false, "score": 1, "creation_date": 1533101357, "post_id": 48054485, "comment_id": 90216359, "body": "I think the restriction for EU users to use GCP for Business only has changed <a href=\"https://cloud.google.com/billing/docs/resources/vat-overview\" rel=\"nofollow noreferrer\">cloud.google.com/billing/docs/resources/vat-overview</a>. That restriction now applies only to Russia."}], "tags": [], "owner": {"reputation": 3645, "user_id": 1730966, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4dff6dbd5d9ec926ffb5266be887526f?s=128&d=identicon&r=PG", "display_name": "nibarius", "link": "https://stackoverflow.com/users/1730966/nibarius"}, "is_accepted": true, "score": 3, "last_activity_date": 1514854760, "creation_date": 1514854760, "answer_id": 48054485, "question_id": 47663044, "link": "https://stackoverflow.com/questions/47663044/using-cloud-firestore-with-appengine-go-standard-environment-returns-rpc-error-w/48054485#48054485", "title": "Using Cloud Firestore with AppEngine Go Standard Environment returns rpc error when running on AppEngline", "body": "<p>I've raised an <a href=\"https://github.com/GoogleCloudPlatform/google-cloud-go/issues/822\" rel=\"nofollow noreferrer\">issue</a> about this in the Firestore client library issue tracker and it seems like the situation is a bit complex.</p>\n\n<p>When using App Engine the Firestore client library's network connections goes trough the App Engine <a href=\"https://godoc.org/google.golang.org/appengine/socket\" rel=\"nofollow noreferrer\">socket library</a>. However sockets is only available for <a href=\"https://cloud.google.com/appengine/docs/standard/go/sockets/\" rel=\"nofollow noreferrer\">paid App Engine apps</a>:</p>\n\n<blockquote>\n  <p>Sockets are only available for paid apps, and traffic from sockets is billed as outgoing bandwidth. Sockets are also limited by daily and per minute (burst) quotas.</p>\n</blockquote>\n\n<p>So this is the reason why the Firestore client library fails. For small scale projects it's possible to enable billing of your App Engine app and still stay within the free range. If billing is enabled it should work when the app is deployed as well.</p>\n\n<p>However if you are living within the European Union you are not allowed to have a paid App Engine app for non commercial purposes due to <a href=\"https://cloud.google.com/free/docs/frequently-asked-questions\" rel=\"nofollow noreferrer\">Google policies</a>:</p>\n\n<blockquote>\n  <p>If you are located in the European Union and the sole purpose for which you want to use Google Cloud Platform services has no potential economic benefit you should not use the service. If you have already started using Google Cloud Platform, you should discontinue using the service. See Create, modify, or close your billing account to learn how to disable billing on your projects.</p>\n</blockquote>\n\n<p>So if you are in Europe or for some other reason are unable to use have a paid App Engine app you will not be able to use the Firestore client library.</p>\n\n<p>One alternative in this case is to use the <a href=\"https://firebase.google.com/docs/firestore/use-rest-api\" rel=\"nofollow noreferrer\">Firestore REST API</a> instead and manually make HTTP requests to Firestore. It's a bit more work, but for smaller scale projects it works.</p>\n"}], "owner": {"reputation": 3645, "user_id": 1730966, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4dff6dbd5d9ec926ffb5266be887526f?s=128&d=identicon&r=PG", "display_name": "nibarius", "link": "https://stackoverflow.com/users/1730966/nibarius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2653, "favorite_count": 0, "accepted_answer_id": 48054485, "answer_count": 2, "score": 2, "last_activity_date": 1514854760, "creation_date": 1512509705, "question_id": 47663044, "link": "https://stackoverflow.com/questions/47663044/using-cloud-firestore-with-appengine-go-standard-environment-returns-rpc-error-w", "title": "Using Cloud Firestore with AppEngine Go Standard Environment returns rpc error when running on AppEngline", "body": "<p>I'm trying to use Firestore in my AppEngine (standard environment) app written in Go. I've been following the \"<a href=\"https://firebase.google.com/docs/firestore/quickstart\" rel=\"nofollow noreferrer\">Getting Started with Cloud Firestore\"</a> guide and have been using the <a href=\"https://godoc.org/cloud.google.com/go/firestore\" rel=\"nofollow noreferrer\">firestore package</a> documentation to implement a simple example that works fine when running it on my local dev server.</p>\n\n<p>However when I deploy the app and try the deployed version the call to <a href=\"https://godoc.org/cloud.google.com/go/firestore#DocumentRef.Set\" rel=\"nofollow noreferrer\"><code>DocumentRef.Set()</code></a> fails with the error</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>rpc error: code = Unavailable desc = all SubConns are in TransientFailure\n</code></pre>\n\n<p>This is my code that reproduces the issue:</p>\n\n<pre class=\"lang-default prettyprint-override\"><code>func init() {\n    http.HandleFunc(\"/test\", testHandler)\n}\n\ntype testData struct {\n    TestData string `firestore:\"myKey,omitempty\"`\n}\n\nfunc testHandler(w http.ResponseWriter, r *http.Request) {\n    ctx := appengine.NewContext(r)\n\n    var firestoreClient *firestore.Client\n    var firebaseApp *firebase.App\n    var err error\n\n    conf := &amp;firebase.Config{ProjectID: \"my-project\"}\n    firebaseApp, err = firebase.NewApp(ctx, conf)\n\n    if err != nil {\n        fmt.Fprintf(w, \"Failed to create a new firestore app: %v\", err)\n        return\n    }\n\n    firestoreClient, err = firebaseApp.Firestore(ctx)\n    if err != nil {\n        fmt.Fprintf(w, \"Failed to create a new firestore client: %v\", err)\n        return\n    }\n\n    data := testData{\"my value\"}\n    _, err = firestoreClient.Collection(\"testCollection\").Doc(\"testDoc\").Set(ctx, data)\n    if err != nil {\n        fmt.Fprintf(w, \"Failed to create a firestore document: %v\", err)\n        return\n    }\n    firestoreClient.Close()\n    fmt.Fprint(w, \"Data stored in Firestore successfully\")\n}\n</code></pre>\n\n<p>As mentioned before, on the dev server this works fine. So there the returned page contains the text <code>Data stored in Firestore successfully</code>.</p>\n\n<p>When running the deployed code I get <code>Failed to create a firestore document: rpc error: code = Unavailable desc = all SubConns are in TransientFailure</code> instead. Why do I get this error and how can I avoid it?</p>\n"}, {"tags": ["go", "goquery"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512508847, "post_id": 47662687, "comment_id": 82284797, "body": "What happens if you use <code>doc.Each()</code> directly (without the <code>Find</code>) instead of using the non-matching <code>Find(&quot;~&quot;)</code>?"}, {"owner": {"reputation": 121, "user_id": 6866042, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8b042cbaa411bd7d6f1fbeb0ddcd0ea7?s=128&d=identicon&r=PG&f=1", "display_name": "nexequ", "link": "https://stackoverflow.com/users/6866042/nexequ"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512509999, "post_id": 47662687, "comment_id": 82285379, "body": "I receive string &quot;#document&quot;"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512510726, "post_id": 47662687, "comment_id": 82285743, "body": "If it takes in the doctype element at all, it should be the first of two children of <code>#document</code> (the second being the <code>html</code> element)."}, {"owner": {"reputation": 121, "user_id": 6866042, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8b042cbaa411bd7d6f1fbeb0ddcd0ea7?s=128&d=identicon&r=PG&f=1", "display_name": "nexequ", "link": "https://stackoverflow.com/users/6866042/nexequ"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512513103, "post_id": 47662687, "comment_id": 82286788, "body": "But it&#39;s not:  doc.Each(func(_ int, item *goquery.Selection) { \t\tfmt.Println(goquery.NodeName(item)) \t}) -&gt; returns #document only"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512515887, "post_id": 47662687, "comment_id": 82287721, "body": "Right. Look at the <i>children</i> of #document."}, {"owner": {"reputation": 121, "user_id": 6866042, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8b042cbaa411bd7d6f1fbeb0ddcd0ea7?s=128&d=identicon&r=PG&f=1", "display_name": "nexequ", "link": "https://stackoverflow.com/users/6866042/nexequ"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512635233, "post_id": 47662687, "comment_id": 82340170, "body": "Unfortunately still nothing: fmt.Println(goquery.NodeName(item.Children()))"}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 0, "last_activity_date": 1512578865, "creation_date": 1512578865, "answer_id": 47679429, "question_id": 47662687, "link": "https://stackoverflow.com/questions/47662687/doctype-with-goquery/47679429#47679429", "title": "Doctype with goquery", "body": "<p>It doesn't seem like there is a reliable way to <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Document/doctype\" rel=\"nofollow noreferrer\">retrieve the doctype</a> using either jQuery itself (in the web browser) or <a href=\"https://godoc.org/github.com/PuerkitoBio/goquery\" rel=\"nofollow noreferrer\">goquery</a> on the backend.</p>\n"}], "owner": {"reputation": 121, "user_id": 6866042, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/8b042cbaa411bd7d6f1fbeb0ddcd0ea7?s=128&d=identicon&r=PG&f=1", "display_name": "nexequ", "link": "https://stackoverflow.com/users/6866042/nexequ"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1512578865, "creation_date": 1512508142, "last_edit_date": 1512508513, "question_id": 47662687, "link": "https://stackoverflow.com/questions/47662687/doctype-with-goquery", "title": "Doctype with goquery", "body": "<p>Is there any possibility to retrieve document doctype with goquery?</p>\n\n<p>I've tried several things, but any worked. I suppose that it is possible, because NodeName func has switch with \"html.DoctypeNode\" case. </p>\n\n<p>That code didn't find doctype:</p>\n\n<pre><code>doc.Find(\"~\").Each(func(_ int, item *goquery.Selection) {\n    fmt.Println(goquery.NodeName(item))\n})\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1512515588, "last_edit_date": 1512515588, "creation_date": 1512511938, "answer_id": 47663517, "question_id": 47662614, "link": "https://stackoverflow.com/questions/47662614/http-responsewriter-write-with-interface/47663517#47663517", "title": "http.ResponseWriter.Write with interface{}", "body": "<p>The example at <a href=\"https://github.com/denisenkom/go-mssqldb/blob/master/examples/tsql/tsql.go\" rel=\"nofollow noreferrer\">denisekom</a> prints to stdout using the fmt.Print family of functions.  Change the example to print to a response writer by using the fmt.Fprint family of functions. </p>\n\n<p>The fmt.Fprint functions write to the io.Writer specified as the first argument.  The response writer satisfies the io.Writer interface.  Here's the modified code from the original example where <code>w</code> is the http.ResponseWriter.</p>\n\n<pre><code>vals := make([]interface{}, len(cols))\nfor i := 0; i &lt; len(cols); i++ {\n    vals[i] = new(interface{})\n    if i != 0 {\n        fmt.Fprint(w, \"\\t\")\n    }\n    fmt.Fprint(w, cols[i])\n}\nfmt.Fprintln(w)\nfor rows.Next() {\n    err = rows.Scan(vals...)\n    if err != nil {\n        fmt.Fprintln(w, err)\n        continue\n    }\n    for i := 0; i &lt; len(vals); i++ {\n        if i != 0 {\n            fmt.Fprint(w, \"\\t\")\n        }\n        printValue(w, vals[i].(*interface{}))\n    }\n    fmt.Fprintln(w)\n\n}\n\n... \n\nfunc printValue(w io.Writer, pval *interface{}) {\n    switch v := (*pval).(type) {\n    case nil:\n        fmt.Fprint(w, \"NULL\")\n    case bool:\n        if v {\n            fmt.Fprint(w, \"1\")\n        } else {\n            fmt.Fprint(w, \"0\")\n        }\n    case []byte:\n        fmt.Fprint(w, string(v))\n    case time.Time:\n        fmt.Fprint(w, v.Format(\"2006-01-02 15:04:05.999\"))\n    default:\n        fmt.Fprint(w, v)\n    }\n}\n</code></pre>\n\n<p>Regarding the code in the question: the expression <code>string(v)</code> is a string conversion. A string conversion does not convert numbers to a decimal representation as the code is assuming.  See the <a href=\"https://golang.org/ref/spec#Conversions_to_and_from_a_string_type\" rel=\"nofollow noreferrer\">spec</a> for details on string conversions.  Use either the <code>fmt</code> package as above or the <code>strconv</code> package to convert numbers to decimal strings.  The type switch should be <code>switch v := (*(vals[i].(*interface{})).(type) {</code>.  That's a bit of mess, and that leads to my next point.</p>\n\n<p>The original example uses more indirection than needed. Here's a simplified version ready to be called with a response writer:</p>\n\n<pre><code>func exec(w io.Writer, db *sql.DB, cmd string) error {\n    rows, err := db.Query(cmd)\n    if err != nil {\n        return err\n    }\n    defer rows.Close()\n    cols, err := rows.Columns()\n    if err != nil {\n        return err\n    }\n    if cols == nil {\n        return nil\n    }\n    vals := make([]interface{}, len(cols))\n    args := make([]interface{}, len(cols))\n    for i := 0; i &lt; len(cols); i++ {\n        args[i] = &amp;vals[i]\n        if i != 0 {\n            fmt.Fprint(w, \"\\t\")\n        }\n        fmt.Fprint(w, cols[i])\n    }\n    for rows.Next() {\n        err = rows.Scan(args...)\n        if err != nil {\n            fmt.Fprintln(w, err)\n            continue\n        }\n        for i := 0; i &lt; len(vals); i++ {\n            if i != 0 {\n                fmt.Print(\"\\t\")\n            }\n            printValue(w, vals[i])\n        }\n        fmt.Fprintln(w)\n\n    }\n    if rows.Err() != nil {\n        return rows.Err()\n    }\n    return nil\n}\n\nfunc printValue(w io.Writer, v interface{}) {\n    switch v := v.(type) {\n    case nil:\n        fmt.Fprint(w, \"NULL\")\n    case bool:\n        if v {\n            fmt.Fprint(w, \"1\")\n        } else {\n            fmt.Fprint(w, \"0\")\n        }\n    case []byte:\n        fmt.Fprint(w, string(v))\n    case time.Time:\n        fmt.Fprint(w, v.Format(\"2006-01-02 15:04:05.999\"))\n    default:\n        fmt.Fprint(w, v)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2151, "user_id": 1828137, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/d1c33b5212cd795da1f7ab47f532f18b?s=128&d=identicon&r=PG&f=1", "display_name": "tmwoods", "link": "https://stackoverflow.com/users/1828137/tmwoods"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 536, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1512515588, "creation_date": 1512507824, "question_id": 47662614, "link": "https://stackoverflow.com/questions/47662614/http-responsewriter-write-with-interface", "title": "http.ResponseWriter.Write with interface{}", "body": "<p>I'm running a <code>SQL</code> query using the sample from <a href=\"https://github.com/denisenkom/go-mssqldb/blob/master/examples/tsql/tsql.go\" rel=\"nofollow noreferrer\">denisenkom</a> but coupled with a <code>http.ResponseWriter</code>and I'm struggling with <code>interface{}</code> type conversion. There are a few posts that are close to what I'm doing but the solution seems kind of heavy handed and always use <code>fmt</code> (which I'm not using).</p>\n\n<p>Note that my query works and returns a result. I'm just trying to display that result.</p>\n\n<p>Here is my code that I think is relatively close but doesn't work. I've tried a couple other things but none even compile.</p>\n\n<pre><code>vals := make([]interface{}, len(cols))\nfor i := 0; i &lt; len(cols); i++ {\n        vals[i] = new(interface{})\n        if i != 0 {\n                w.Write([]byte(\"\\t\"))\n        }\n        w.Write([]byte(cols[i]))\n}\n\nfor rows.Next() {\n      err = rows.Scan(vals...)\n      if err != nil {\n          w.Write([]byte(\"Row problem: \" + err.Error()))\n          continue\n      }\n      for i := 0; i &lt; len(vals); i++ {\n          if i != 0 {\n              w.Write([]byte(\"\\t\"))\n          }\n\n      //THIS IS THE PART I'M STUCK ON       \n      switch v := vals[i].(type) {\n      case int:\n           w.Write([]byte(\"int!\\n\" + string(v)))\n      case int8:\n           w.Write([]byte(\"int8!\\n\" + string(v)))\n\n      //etc, etc\n      //more types\n      //etc, etc\n\n      case float64:\n           w.Write([]byte(\"float64!\\n\" + string(v))) //This fails, can't convert, will need something else\n      case string:\n           w.Write([]byte(\"string!\\n\" + v))\n      default:\n           w.Write([]byte(\"something else!\\n\"))\n      }\n  }\n\n}\n</code></pre>\n\n<p>But isn't there a better way to dynamically check the underlying type and convert it to something readable? All I want to do is spit out the results of a query, this seems like I'm doing something wrong.</p>\n\n<p>Note that it always hits the <code>default</code> case, even when it's explicitly the same type.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 199, "user_id": 9058067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b9a4e9c846a65887389b5c59169c149?s=128&d=identicon&r=PG&f=1", "display_name": "szabado", "link": "https://stackoverflow.com/users/9058067/szabado"}, "edited": false, "score": 0, "creation_date": 1512501749, "post_id": 47660897, "comment_id": 82281277, "body": "The number <code>0x10436000</code> seems to appear in other stack traces as well.  I&#39;m not sure what its significance is? <a href=\"https://github.com/golang/go/issues/20763\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/20763</a>"}, {"owner": {"reputation": 24853, "user_id": 446681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cBjgR.jpg?s=128&g=1", "display_name": "Hector Correa", "link": "https://stackoverflow.com/users/446681/hector-correa"}, "edited": false, "score": 0, "creation_date": 1512507329, "post_id": 47660897, "comment_id": 82284091, "body": "This is really interesting. I get a different output <code>main.F(0x1)</code> (see <a href=\"https://gist.github.com/hectorcorrea/5fd563f1dabb88bd0f351c0fc2bae5ee\" rel=\"nofollow noreferrer\">gist.github.com/hectorcorrea/5fd563f1dabb88bd0f351c0fc2bae5e&zwnj;&#8203;e</a>). Notice that I am using go 1.7.1 on a Mac."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "reply_to_user": {"reputation": 24853, "user_id": 446681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cBjgR.jpg?s=128&g=1", "display_name": "Hector Correa", "link": "https://stackoverflow.com/users/446681/hector-correa"}, "edited": false, "score": 0, "creation_date": 1512507746, "post_id": 47660897, "comment_id": 82284302, "body": "I get the same as @HectorCorrea using Go 1.9 on OSX.  What&#39;s your Go version and environment?"}, {"owner": {"reputation": 199, "user_id": 9058067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b9a4e9c846a65887389b5c59169c149?s=128&d=identicon&r=PG&f=1", "display_name": "szabado", "link": "https://stackoverflow.com/users/9058067/szabado"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1512507944, "post_id": 47660897, "comment_id": 82284384, "body": "@Kaedys I&#39;m using 1.9.2 on OSX, and I don&#39;t see it locally.  Golang play uses version 1.9, but I&#39;m willing to assume it doesn&#39;t use OSX."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1512511201, "post_id": 47660897, "comment_id": 82285974, "body": "Also I recommend this article to learn about interpretation of stack traces: <a href=\"https://www.goinggo.net/2015/01/stack-traces-in-go.html\" rel=\"nofollow noreferrer\">Ardan Labs: Stack Traces In Go</a>. And to learn more about the implementation of the Go Playground: <a href=\"https://blog.golang.org/playground\" rel=\"nofollow noreferrer\">The Go Blog: Inside the Go Playground</a>"}], "answers": [{"comments": [{"owner": {"reputation": 199, "user_id": 9058067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b9a4e9c846a65887389b5c59169c149?s=128&d=identicon&r=PG&f=1", "display_name": "szabado", "link": "https://stackoverflow.com/users/9058067/szabado"}, "edited": false, "score": 0, "creation_date": 1512508890, "post_id": 47662796, "comment_id": 82284814, "body": "Typo: I think you mean 64 bit word architecture with 32 bit pointers?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1512511159, "post_id": 47662796, "comment_id": 82285955, "body": "Nicely written!"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 17, "last_activity_date": 1515596798, "last_edit_date": 1515596798, "creation_date": 1512508666, "answer_id": 47662796, "question_id": 47660897, "link": "https://stackoverflow.com/questions/47660897/unknown-field-in-panic-stack-trace/47662796#47662796", "title": "Unknown field in panic stack trace", "body": "<p>The data printed in the stack trace is the arguments, but the values don't correspond directly to the arguments passed in, it's the raw data printed in pointer-sized values (though usually this is the same as the native word size). The playground is slightly unique, in that it's a 64bit word architecture with 32bit pointers(<code>GOARCH=amd64p32</code>).</p>\n\n<p>In <a href=\"https://github.com/golang/go/blob/0b3b5113c0bbc62306a0404b235cbdf5a431bf67/src/runtime/traceback.go#L427\" rel=\"nofollow noreferrer\">traceback.go</a> you can see that the values are printed by stepping through the arguments based on pointer size; </p>\n\n<pre><code>for i := uintptr(0); i &lt; frame.arglen/sys.PtrSize; i++ {\n</code></pre>\n\n<p>So because the word size is twice as big as the pointer size in the playground, you will always have an even number of values printed in the frame arguments. </p>\n\n<p>Another example of how the data is presented can be seen in the playground by using smaller types in the function arguments: <a href=\"https://play.golang.org/p/vHZDEHQZLh\" rel=\"nofollow noreferrer\">https://play.golang.org/p/vHZDEHQZLh</a></p>\n\n<pre><code>func F(a uint8) {\n    panic(nil)\n}\n\n// F(1)\n// main.F(0x97301, 0x10436000)\n</code></pre>\n\n<p>Only the first 8 bits of the 64bit word are used, which is <code>0x97301 &amp; 0x0f</code>, or simply <code>1</code>. The extra <code>0x97300</code> from the first value and the entire <code>0x10436000</code> are just the remainder of that first 64bit word which is unused by the function. </p>\n\n<p>You can see the same behavior on <code>amd64</code> systems by using more arguments. This signature for example;</p>\n\n<pre><code>func F(a, b, c uint32)\n</code></pre>\n\n<p>when called via <code>F(1, 1, 1)</code>, it will print a stack trace like:</p>\n\n<pre><code>main.F(0x100000001, 0xc400000001)\n</code></pre>\n\n<p>because the 3 32bit values take 2 words</p>\n\n<p>The final set of values to note are return values, which are also allocated on the stack. The following function signature:</p>\n\n<pre><code>func F(a int64) (int, int)\n</code></pre>\n\n<p>on amd64, would show the stack frame arguments like:</p>\n\n<pre><code>main.F(0xa, 0x1054d60, 0xc420078058)\n</code></pre>\n\n<p>With one word for <code>a</code>, and two more for the <code>(int, int)</code> return values. The return values are not initialized however, so there's not much to me gained here other than to understand why these values are there. </p>\n"}], "owner": {"reputation": 199, "user_id": 9058067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b9a4e9c846a65887389b5c59169c149?s=128&d=identicon&r=PG&f=1", "display_name": "szabado", "link": "https://stackoverflow.com/users/9058067/szabado"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 313, "favorite_count": 2, "accepted_answer_id": 47662796, "answer_count": 1, "score": 18, "last_activity_date": 1515596798, "creation_date": 1512500724, "question_id": 47660897, "link": "https://stackoverflow.com/questions/47660897/unknown-field-in-panic-stack-trace", "title": "Unknown field in panic stack trace", "body": "<p>In trying to learn how to debug stack traces from panics, I came across something confusing.</p>\n\n<pre><code>package main\n\nfunc F(a int) {\n    panic(nil)\n}\n\nfunc main() {\n    F(1)\n}\n</code></pre>\n\n<p>outputs the following when I run it on the attached play link:</p>\n\n<pre><code>panic: nil\n\ngoroutine 1 [running]:\nmain.F(0x1, 0x10436000)\n    /tmp/sandbox090887108/main.go:4 +0x20\nmain.main()\n    /tmp/sandbox090887108/main.go:8 +0x20\n</code></pre>\n\n<p>I can't decipher what the second number means (the 0x10436000 in main.F(0x1, 0x10436000)).  It doesn't appear if there's a second int argument, or if anything else if passed in as the first argument (can be seen in the second play link).</p>\n\n<p>One arg: <a href=\"https://play.golang.org/p/3iV48xlNFR\" rel=\"noreferrer\">https://play.golang.org/p/3iV48xlNFR</a></p>\n\n<p>Two args: <a href=\"https://play.golang.org/p/4jA7ueI86K\" rel=\"noreferrer\">https://play.golang.org/p/4jA7ueI86K</a></p>\n"}, {"tags": ["go", "character-encoding", "transliteration"], "answers": [{"comments": [{"owner": {"reputation": 1518, "user_id": 591004, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/038dd79c1cd086e1c0d2d001771bf982?s=128&d=identicon&r=PG", "display_name": "derFunk", "link": "https://stackoverflow.com/users/591004/derfunk"}, "edited": false, "score": 0, "creation_date": 1512500851, "post_id": 47660356, "comment_id": 82280801, "body": "Thanks, yes, this will barf with <code>encoding: rune not supported by encoding.</code>. For the mapping I&#39;m thinking there must be something like a transliteration map, but I also had no success so far to find one. The problem is there are so many languages which would need to be properly transliterated, but I&#39;d be okay with a simple subset of common &quot;European&quot; characters already."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 1518, "user_id": 591004, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/038dd79c1cd086e1c0d2d001771bf982?s=128&d=identicon&r=PG", "display_name": "derFunk", "link": "https://stackoverflow.com/users/591004/derfunk"}, "edited": false, "score": 0, "creation_date": 1512501230, "post_id": 47660356, "comment_id": 82280994, "body": "even iconv is unhappy: <code>echo &quot;Jos&#233; Kak\u0131s\u0131r&quot; | iconv -f UTF8 -t ISO_8859-1</code> fails with: <code>Jos\ufffd Kakiconv: illegal input sequence at position 9</code>"}, {"owner": {"reputation": 1518, "user_id": 591004, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/038dd79c1cd086e1c0d2d001771bf982?s=128&d=identicon&r=PG", "display_name": "derFunk", "link": "https://stackoverflow.com/users/591004/derfunk"}, "edited": false, "score": 0, "creation_date": 1512502775, "post_id": 47660356, "comment_id": 82281810, "body": "And so am I - :)"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1512545045, "post_id": 47660356, "comment_id": 82296565, "body": "The <code>iconv</code> has the <code>-c</code> command-line option which should make it happy ;-)"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1512545170, "post_id": 47660356, "comment_id": 82296624, "body": "I think one may try to wrap an encoder for <code>ISO-8859-1</code> providing a custom implementation for the <a href=\"https://godoc.org/golang.org/x/text/encoding#ReplaceUnsupported\" rel=\"nofollow noreferrer\"><code>encoding.Encoder.ReplaceUnsupported</code> function</a>."}, {"owner": {"reputation": 1518, "user_id": 591004, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/038dd79c1cd086e1c0d2d001771bf982?s=128&d=identicon&r=PG", "display_name": "derFunk", "link": "https://stackoverflow.com/users/591004/derfunk"}, "edited": false, "score": 0, "creation_date": 1512567651, "post_id": 47660356, "comment_id": 82310218, "body": "That&#39;s not the type of happy I want to achieve: <code>-c When this option is given, characters that cannot be converted are silently discarded, instead of leading to a conversion error.</code> :-)"}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": false, "score": 0, "last_activity_date": 1512500006, "last_edit_date": 1512500006, "creation_date": 1512498404, "answer_id": 47660356, "question_id": 47660160, "link": "https://stackoverflow.com/questions/47660160/best-way-to-translate-utf-8-to-iso8859-1-in-go/47660356#47660356", "title": "Best way to translate UTF-8 to ISO8859-1 in Go", "body": "<p>I believe the <a href=\"https://godoc.org/golang.org/x/text/encoding/charmap\" rel=\"nofollow noreferrer\">charmap</a> package does what you want with a <code>charmap.ISO8859_1.NewEncoder()</code></p>\n\n<p>Edit: nevermind, that will barf on unsupported runes. Sorry. It may be worth looking into this package some more though.</p>\n\n<p>Ultimately, it feels like you will need to find (or create) a mapping from UTF-8 to ISO8859. I don't think you'll find a \"standard\" one out there though, the mapping is too arbitrary.</p>\n"}, {"tags": [], "owner": {"reputation": 2314, "user_id": 2573589, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jKaca.png?s=128&g=1", "display_name": "Jonathan Warden", "link": "https://stackoverflow.com/users/2573589/jonathan-warden"}, "is_accepted": false, "score": 1, "last_activity_date": 1598988267, "last_edit_date": 1598988267, "creation_date": 1598986099, "answer_id": 63693721, "question_id": 47660160, "link": "https://stackoverflow.com/questions/47660160/best-way-to-translate-utf-8-to-iso8859-1-in-go/63693721#63693721", "title": "Best way to translate UTF-8 to ISO8859-1 in Go", "body": "<p>There are two ideas from the Unicode spec that might be used to identify &quot;similar&quot; characters.</p>\n<p>The first is the <em>decompositions</em> of characters into a base character + a combining mark. Your code takes advantage of this: doing the decomposition and then removing the combining mark, leaving the base character.</p>\n<p>But unfortunately the &quot;i&quot; character for some reason does not decompose into a dotless &quot;\u0131&quot; plus a combining dot (if anybody understands <em>why</em> this decision was made, please comment!). This fact is also discussed here: <a href=\"https://stackoverflow.com/questions/50086824/why-do-latin-small-letter-dotless-i-combining-dot-above-not-get-normalized-to\">Why do LATIN SMALL LETTER DOTLESS I, COMBINING DOT ABOVE not get normalized to &quot;i&quot; in NFC form?</a></p>\n<p>The second is the mapping of characters to &quot;confusable&quot; characters as defined in Unicode TR39. For example, you will find the following line in <a href=\"http://www.unicode.org/Public/security/latest/confusables.txt\" rel=\"nofollow noreferrer\">http://www.unicode.org/Public/security/latest/confusables.txt</a></p>\n<blockquote>\n<p>0131 ;    0069 ;  MA  # ( \u0131 \u2192 i ) LATIN SMALL LETTER DOTLESS I \u2192 LATIN SMALL LETTER I #</p>\n</blockquote>\n<p>This mapping exists to identify strings that could be &quot;confused&quot; for other strings for security purposes (e.g. spoofing domains). It allows you to convert a string to its &quot;skeleton&quot;: two strings with the same skeleton are potentially visibly confusable. For example the skeleton of &quot;\ud835\udd2d\ud835\udcb6\u1eff\ud835\udd61\ud835\udd52\u2113&quot; is &quot;paypal&quot;, and the skeleton of &quot;Jos\u00e9 Kak\u0131s\u0327\u0131r&quot; is &quot;Jose\u0301 Kakis\u0326ir&quot;. You could try this for your purposes, but this is not recommended per the spec:</p>\n<blockquote>\n<p>A skeleton is intended only for internal use for testing confusability of strings; the resulting text is not suitable for display to users, because it will appear to be a hodgepodge of different scripts. In particular, the result of mapping an identifier will not necessary be an identifier. Thus the confusability mappings can be used to test whether two identifiers are confusable (if their skeletons are the same), but should definitely not be used as a &quot;normalization&quot; of identifiers.</p>\n</blockquote>\n<p>If you do choose to try this, here is a Go package: <a href=\"https://github.com/mtibben/confusables\" rel=\"nofollow noreferrer\">https://github.com/mtibben/confusables</a></p>\n<p>Another option is a custom mapping of characters to logically similar characters suitable for your application, based on some knowledgable person's judgment about &quot;similarity&quot;. I am not aware of any such mappings. Depending on your application you might try to do this manually.</p>\n<p>Also note: &quot;\u00e9&quot; and many other accented characters is supported by the iso-8859-1 character set, so removing the accent is not necessary. Whatever you end up implementing, your code should first determine whether the rune is supported by the encoding before attempting to map it to a similar character.</p>\n"}], "owner": {"reputation": 1518, "user_id": 591004, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/038dd79c1cd086e1c0d2d001771bf982?s=128&d=identicon&r=PG", "display_name": "derFunk", "link": "https://stackoverflow.com/users/591004/derfunk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1580, "favorite_count": 1, "answer_count": 2, "score": 5, "last_activity_date": 1598988267, "creation_date": 1512497698, "last_edit_date": 1512505672, "question_id": 47660160, "link": "https://stackoverflow.com/questions/47660160/best-way-to-translate-utf-8-to-iso8859-1-in-go", "title": "Best way to translate UTF-8 to ISO8859-1 in Go", "body": "<p>I'm trying to map UTF-8 characters to their \"similar\" ISO8859-1 representation. Removing diacritics, but also replacing characters like <code>\u0141</code> with <code>L</code> or <code>\u0131</code> with <code>i</code>.</p>\n\n<p>Example:\n<code>Jos\u00e9 Kak\u0131s\u0327\u0131r</code> should become <code>Jose Kakisir</code>.</p>\n\n<p>I'm aware that removing diacritics can be done this way:</p>\n\n<pre><code>// (From https://blog.golang.org/normalization#TOC_10.)\nimport (\n    \"unicode\"\n\n    \"golang.org/x/text/transform\"\n    \"golang.org/x/text/unicode/norm\"\n)\n\nisMn := func(r rune) bool {\n    return unicode.Is(unicode.Mn, r) // Mn: nonspacing marks\n}\nt := transform.Chain(norm.NFD, transform.RemoveFunc(isMn), norm.NFC)\nresult, _, err := transform.String(t, \"Jos\u00e9 Kak\u0131s\u0327\u0131r\")\nprintln(result)\n</code></pre>\n\n<p>Which prints out <code>Jose Kar\u0131s\u0131r</code> - <code>s\u0327</code> replaced with <code>s</code>, but <code>\u0131</code> not replaced with <code>i</code>.</p>\n\n<p>What's the best way to achieve that in Go?</p>\n"}, {"tags": ["ios", "macos", "go", "macos-high-sierra"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1512489163, "post_id": 47657272, "comment_id": 82273689, "body": "There <a href=\"https://www.google.com/search?q=golang+mac+os+x+operation+not+permitted\" rel=\"nofollow noreferrer\">appears</a> to be quite a lot of reasons for this, not related to Go actually. Have you investigated further? I mean, the error message is too generic."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1512491292, "post_id": 47657272, "comment_id": 82275092, "body": "This may have nothing to do with Go. I guess  OS X El Capitan onwards, many resources (mainly files and folders) are protected from malicious activity by System Integrity  Protection (SIP). Look at  <a href=\"https://www.mikesel.info/fix-operation-not-permitted-root-os-x-terminal/\" rel=\"nofollow noreferrer\">mikesel.info/fix-operation-not-permitted-root-os-x-terminal</a> and <a href=\"https://serverfault.com/questions/748838/sudo-mv-fails-with-operation-not-permitted\" title=\"sudo mv fails with operation not permitted\">serverfault.com/questions/748838/&hellip;</a>"}, {"owner": {"reputation": 251, "user_id": 1389959, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lvqKu.png?s=128&g=1", "display_name": "Srinivas Gowda", "link": "https://stackoverflow.com/users/1389959/srinivas-gowda"}, "edited": false, "score": 0, "creation_date": 1512519581, "post_id": 47657272, "comment_id": 82288931, "body": "yes I did go through quite a few apple and golang issues and forums to get find out more but nothing where it talks about how to ship a binary or inside a mac app."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 14661616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/906efbc28bf273835af52aca4fac3f74?s=128&d=identicon&r=PG&f=1", "display_name": "Yukesh Kumar", "link": "https://stackoverflow.com/users/14661616/yukesh-kumar"}, "is_accepted": false, "score": 0, "last_activity_date": 1608640307, "last_edit_date": 1608640307, "creation_date": 1608639234, "answer_id": 65408545, "question_id": 47657272, "link": "https://stackoverflow.com/questions/47657272/golang-binary-on-mac-os-error-operation-not-permitted/65408545#65408545", "title": "Golang binary on Mac OS error &quot;operation not permitted&quot;", "body": "<p>This is not related to Go. Go to your system preferences and just give full disk access to the ide you're using.</p>\n"}], "owner": {"reputation": 251, "user_id": 1389959, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lvqKu.png?s=128&g=1", "display_name": "Srinivas Gowda", "link": "https://stackoverflow.com/users/1389959/srinivas-gowda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1252, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1608640307, "creation_date": 1512487986, "last_edit_date": 1512510339, "question_id": 47657272, "link": "https://stackoverflow.com/questions/47657272/golang-binary-on-mac-os-error-operation-not-permitted", "title": "Golang binary on Mac OS error &quot;operation not permitted&quot;", "body": "<p>I'm trying to ship a golang binary inside a Mac application. It is ideally just an HTTP server with some basic functions on folders and files.</p>\n\n<p>The binary seems to work just fine when I run it from a terminal but when I try to call it from my Mac application programmatically it gives me an error \"operation not permitted\" and quits.</p>\n\n<p>After code-signing with a valid identity file I get the same error.</p>\n\n<p>Error:</p>\n\n<pre><code>go build -ldflags -s .\ncodesign -s \"Developer ID Application: *** *tesco\" binaryFile\n</code></pre>\n\n<p>Golang ENV:</p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"GOHOSTOS=\"darwin\"\nGOOS=\"darwin\"\nGOPATH=\"/Users/srinivas/go\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/darwin_amd64\"\nGCCGO=\"gccgo\"\nCC=\"clang\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/3n/vpg5bnks45n75n\nd91qh7sy3c0000gn/T/go-build925744934=/tmp/go-build -gno-record-gcc-switches -fno-common\"\nCXX=\"clang++\"\nCGO_ENABLED=\"1\"\nPKG_CONFIG=\"pkg-config\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\n</code></pre>\n"}, {"tags": ["loops", "pointers", "go"], "comments": [{"owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "edited": false, "score": 1, "creation_date": 1512482627, "post_id": 47655016, "comment_id": 82269073, "body": "Variable <code>task</code> stores a local copy which changes in each iteration, but the address of <code>task</code> (which is stored in the map) stays the same. So, when you print the map contents, all map values point to the copy of the last list item."}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1512482813, "post_id": 47655148, "comment_id": 82269192, "body": "I&#39;d say the proper solution would be <code>for i := range taskList { taskMap[taskName] = &amp;taskList[i] }</code>. I mean, if one wants to get a pointer to an element of the slice on each iteration, there&#39;s no point in obtaining the element itself \u2014 its index would suffice, and it can easily be used to obtain a pointer to its corresponding element."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512484599, "post_id": 47655148, "comment_id": 82270344, "body": "Except that in your example <code>taskName</code> doesn&#39;t exist; you need the element to get the name. The posted solution seems correct to me."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1512485665, "post_id": 47655148, "comment_id": 82271153, "body": "It&#39;s not hard to &quot;make it exist&quot;. No, really."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1512492660, "post_id": 47655148, "comment_id": 82275948, "body": "Ooooor you could just use the two-argument form of the <code>range</code> operator and not have to use an intermediate variable or an additional slice identifier.  Seriously, why make this harder than it needs to be.  The two-arg form is perfectly appropriate here."}], "tags": [], "owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "is_accepted": true, "score": 5, "last_activity_date": 1512809632, "last_edit_date": 1512809632, "creation_date": 1512481585, "answer_id": 47655148, "question_id": 47655016, "link": "https://stackoverflow.com/questions/47655016/loops-and-map-references/47655148#47655148", "title": "Loops and map references", "body": "<p>You get the same value for all keys cause you are referencing the same <code>task</code> variable in your <code>for</code> loop. Use following snippet to get references to items in your slice.</p>\n\n<pre><code>for idx, task := range taskList {\n    taskMap[task.Name] = &amp;taskList[idx]\n}\n</code></pre>\n\n<p>BTW to (shallow) copy a variable you can assign it to a new variable like</p>\n\n<pre><code>for _, task := range taskList {\n    x := task\n    taskMap[task.Name] = &amp;x\n}\n</code></pre>\n\n<p>a new <code>x</code> variable will be created in each iteration and a pointer to that will be used inside the map.</p>\n"}, {"comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1512481834, "post_id": 47655159, "comment_id": 82268538, "body": "Actually I like Arman&#39;s answer better than mine, it shows you how to do it without changing the existing data structure. Mine is acceptable in this scenario but you don&#39;t always control what comes in."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": false, "score": 0, "last_activity_date": 1512481629, "creation_date": 1512481629, "answer_id": 47655159, "question_id": 47655016, "link": "https://stackoverflow.com/questions/47655016/loops-and-map-references/47655159#47655159", "title": "Loops and map references", "body": "<p>You're storing the address of <code>task</code> rather than the value.</p>\n\n<p>You can instead switch <code>taskList</code> to a slice of pointers: <code>taskList := []*Task{</code> and use <code>taskMap[task.Name] = task</code>.</p>\n"}], "owner": {"reputation": 11109, "user_id": 78640, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/b083b8207ccd0744a5abb18c8e75d24d?s=128&d=identicon&r=PG", "display_name": "Sergi Mansilla", "link": "https://stackoverflow.com/users/78640/sergi-mansilla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 1, "accepted_answer_id": 47655148, "answer_count": 2, "score": 0, "last_activity_date": 1512901965, "creation_date": 1512481174, "last_edit_date": 1512901965, "question_id": 47655016, "link": "https://stackoverflow.com/questions/47655016/loops-and-map-references", "title": "Loops and map references", "body": "<p>I have code that loops over an array of <code>Task</code> and creates a Map with string keys and <code>Task</code> values:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Task struct {\n    Name    string\n    Project string\n}\n\nfunc main() {\n    taskMap := map[string]*Task{}\n    taskList := []Task{\n        {\n            Name:    \"name1\",\n            Project: \"project1\",\n        },\n        {\n            Name:    \"name2\",\n            Project: \"project2\",\n        },\n        {\n            Name:    \"name3\",\n            Project: \"project3\",\n        },\n    }\n    for _, task := range taskList {\n        taskMap[task.Name] = &amp;task\n    }\n\n    // Print results\n    for k, v := range taskMap {\n        fmt.Println(k, v)\n    }\n}\n</code></pre>\n\n<p>The output for this code is the following:</p>\n\n<pre><code>name1 &amp;{name3 project3}\nname2 &amp;{name3 project3}\nname3 &amp;{name3 project3}\n</code></pre>\n\n<p>This is not what I expected, since it is printing the same every time. I have a slight clue of what is going on here, because if I replace the loop with the following, it works as expected:</p>\n\n<pre><code>for _, task := range taskList {\n        taskMap[task.Name] = &amp;Task{\n            Name:        task.Name,\n            Project: task.Project,\n        }\n}\n</code></pre>\n\n<p>So somehow the reference to the last visited task is the one that ends up stored in every key of <code>taskMap</code>, apparently.</p>\n\n<p>Is there a way to do this without resorting to copying each field manually?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1512483142, "post_id": 47654934, "comment_id": 82269379, "body": "The wording is misleading (even though the intent is clear and correct): a variable of type <code>[]T</code> <i>is</i> a slice, and <code>a := make([]T); b = a</code> produces two distinct slices; the &quot;problem&quot; is that the both slices there <i>share the same underlying array.</i> To cite <a href=\"https://golang.org/ref/spec#Appending_and_copying_slices\" rel=\"nofollow noreferrer\">the <code>append()</code> manual</a>: &#171;The variadic function append appends zero or more values x to s of type S, which must be a slice type, and returns the resulting slice, also of type S.&#187;"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1512483331, "post_id": 47654934, "comment_id": 82269480, "body": "Hence the root problem the OP has is that if they want to actually copy <i>the data</i> a slice <i>references,</i> they need to be explicit about that. The two approaches you shown are correct (I personally like the second better) but for completenes you&#39;d also mention <code>b := make([]T, len(a)); copy(b, a)</code> which is not too effective but arguably the most explicit way to &quot;clone&quot; a slice <code>a</code> &quot;into&quot; slice <code>b</code>."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1512483435, "post_id": 47654934, "comment_id": 82269535, "body": "Oh, and also <a href=\"https://github.com/golang/go/wiki/SliceTricks#copy\" rel=\"nofollow noreferrer\">this</a>."}, {"owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1512484062, "post_id": 47654934, "comment_id": 82269983, "body": "@kostix I added some of your comments to the answer."}, {"owner": {"reputation": 317, "user_id": 7221826, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/a4abec0a80b101095bc8f9b8959a026f?s=128&d=identicon&r=PG&f=1", "display_name": "jj1111", "link": "https://stackoverflow.com/users/7221826/jj1111"}, "edited": false, "score": 0, "creation_date": 1512485037, "post_id": 47654934, "comment_id": 82270665, "body": "thank you both! this cleared up a lot (going with b = append([]T(nil), a...))"}], "tags": [], "owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "is_accepted": true, "score": 2, "last_activity_date": 1512809434, "last_edit_date": 1512809434, "creation_date": 1512480925, "answer_id": 47654934, "question_id": 47654863, "link": "https://stackoverflow.com/questions/47654863/value-which-i-range-over-in-slice-changes-when-iterating/47654934#47654934", "title": "value which I range over in slice changes when iterating", "body": "<p>Slices are reference-like types. When you pass it to some function and change contents of it there, it would change the original slice too.</p>\n\n<p>I suggest you to read <a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">this</a> and <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">this</a> to fully understand slices.</p>\n\n<p>Your <code>x := append(slice)</code> won't create a new slice. Assuming you have a variable <code>slice</code> with type <code>[]int</code> you could copy it with:</p>\n\n<pre><code>x := append(make([]int, 0), slice...)\n</code></pre>\n\n<p>or without creating an empty slice</p>\n\n<pre><code>x := append([]int(nil), slice...)\n</code></pre>\n\n<p>or to be more explicit</p>\n\n<pre><code>x := make([]int, len(slice))\ncopy(x, slice)\n</code></pre>\n"}], "owner": {"reputation": 317, "user_id": 7221826, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/a4abec0a80b101095bc8f9b8959a026f?s=128&d=identicon&r=PG&f=1", "display_name": "jj1111", "link": "https://stackoverflow.com/users/7221826/jj1111"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "accepted_answer_id": 47654934, "answer_count": 1, "score": -2, "last_activity_date": 1512809434, "creation_date": 1512480747, "question_id": 47654863, "link": "https://stackoverflow.com/questions/47654863/value-which-i-range-over-in-slice-changes-when-iterating", "title": "value which I range over in slice changes when iterating", "body": "<p>I've got a []int that I range over. I get that when I iterate I have a key/value. I want to also access the slice which I'm iterating over. I don't understand why the slice changes however.</p>\n\n<pre><code>func main() {\nvar rows []string\nrows = append(rows, \"1  2   3\", \"4  5   6\")\nfor _, row := range rows {\n    row := formatRow(row)\n    fmt.Println(\"sent row: \", row) // &lt;------ THIS RETURNS [1,2,3]\n    for i, _ := range row {\n        fmt.Println(\"sent row: \", row) // &lt;------ THIS RETURNS [1,3,3]\n        _ = getShortRow(row, i)\n    }\n}\n}\n\nfunc getShortRow(row []int, i int) []int {\n    if i == 0 {\n        row := append(row[1:])\n        return row\n}\nendPosition := i + 1\nif endPosition == len(row) {\n    row := append(row[:i])\n    return row\n}\n\nst := append(row[:i])\nend := append(row[i+1:])\nrow = append(st, end...)\nreturn row\n}\n\nfunc formatRow(row string) []int {\n    row = strings.Replace(row, \"    \", \",\", -1)\n    if row[len(row)-1:] == \",\" {\n        row = row[:len(row)-1]\n    }\n    nValues := strings.Count(row, \",\") + 1\n    var s []int\n    // convert []string to []int\n    for index := 0; index &lt; nValues; index++ {\n        var value int\n        if index == nValues-1 {\n            value, _ = strconv.Atoi(row)\n        } else {\n            commaPosition := strings.Index(row, \",\")\n            value, _ = strconv.Atoi(row[:commaPosition])\n            row = row[commaPosition+1:]\n        }\n        s = append(s, value)\n    }\n    return s\n}\n</code></pre>\n\n<p>I can't figure out why the slice value is [1,2,3] then [1,2,3] then [1,3,3]. It seems like it should never change.</p>\n"}, {"tags": ["go", "visual-studio-code"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 5, "creation_date": 1512479576, "post_id": 47654479, "comment_id": 82267093, "body": "The default rules of <a href=\"https://golang.org/cmd/gofmt/\" rel=\"nofollow noreferrer\"><code>gofmt</code></a> implies using tabs for identation. I believe you can change that, but I&#39;d strongly suggest to stick to the default formatting rules else your code will be a mess to merge with other Go code that follow the default rules."}, {"owner": {"reputation": 1, "user_id": 6765082, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mt2NA.png?s=128&g=1", "display_name": "flaith", "link": "https://stackoverflow.com/users/6765082/flaith"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1512479905, "post_id": 47654479, "comment_id": 82267309, "body": "Thanks @icza, I&#39;m just starting to learn Golang and, before VSCode, I&#39;m using Jetbrains Goland which have a re-format without this behavior. So I&#39;ll keep for Go the tab and for the others (html, php, python, ...) spaces. Now I need to find how ;-P"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 12191522, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a95931e2bfb4bbe78362cd7f83aa180e?s=128&d=identicon&r=PG&f=1", "display_name": "\u0412\u043b\u0430\u0434\u0438\u043c\u0438\u0440 \u042f\u0432\u0434\u043e\u0448\u0435\u043d\u043a\u043e", "link": "https://stackoverflow.com/users/12191522/%d0%92%d0%bb%d0%b0%d0%b4%d0%b8%d0%bc%d0%b8%d1%80-%d0%af%d0%b2%d0%b4%d0%be%d1%88%d0%b5%d0%bd%d0%ba%d0%be"}, "is_accepted": false, "score": 0, "last_activity_date": 1570656516, "creation_date": 1570656516, "answer_id": 58312571, "question_id": 47654479, "link": "https://stackoverflow.com/questions/47654479/visual-studio-code-go-after-a-reformat-tabs-settings-are-not-effective/58312571#58312571", "title": "Visual Studio Code: Go - After a reformat, tabs settings are not effective", "body": "<p>My solution:\nI work on macOS and have to install gnu-sed from terminal: <strong><em>brew install gnu-sed</em></strong></p>\n\n<p>Install <a href=\"https://marketplace.visualstudio.com/items?itemName=pucelle.run-on-save\" rel=\"nofollow noreferrer\">Run On Save</a> extension. </p>\n\n<p>Edit settings.json. My settings:</p>\n\n<pre><code>{\n    \"editor.renderWhitespace\": \"all\",\n    \"python.pythonPath\": \"/anaconda2/bin/python\",\n    \"[go]\": {\n        \"editor.insertSpaces\": true,\n        \"editor.tabSize\": 4,\n        \"editor.formatOnSave\": true,\n    },\n    \"runOnSave.statusMessageTimeout\": 3000,\n    \"runOnSave.commands\": [\n        {\n            \"match\": \".*\\\\.go\",\n            \"notMatch\": \"\",\n            \"command\": \"gsed -i 's|\\\\t|    |g' ${file}\",\n            \"runIn\": \"backend\"\n        }\n    ]\n}\n</code></pre>\n\n<p>You can use just sed command on Linux and something like this on Windows.\nBe aware gsed must be available. $PATH should be updated to find it.\nAlso, \"runIn\" property can be set in \"terminal\" to make sure everything works properly.</p>\n"}], "owner": {"reputation": 1, "user_id": 6765082, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mt2NA.png?s=128&g=1", "display_name": "flaith", "link": "https://stackoverflow.com/users/6765082/flaith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 965, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1570656516, "creation_date": 1512479434, "last_edit_date": 1512498749, "question_id": 47654479, "link": "https://stackoverflow.com/questions/47654479/visual-studio-code-go-after-a-reformat-tabs-settings-are-not-effective", "title": "Visual Studio Code: Go - After a reformat, tabs settings are not effective", "body": "<p>after having some trouble with my settings for <strong>Golang</strong>, only about the tabs, I found a solution, but now, after formatting my code, <strong>VSCode</strong> return to the previous behaviour.</p>\n\n<p>I want my tabs to be <strong>4 SPACES ONLY</strong>, not the tab character.</p>\n\n<p>here is a part of my setting:</p>\n\n<pre><code>\"editor.tabCompletion\": true,\n\"editor.detectIndentation\": false,\n\"editor.tabSize\": 4,\n// Insert spaces when pressing Tab.\n\"editor.insertSpaces\": true,\n\"go.formatOnSave\": false,\n\"[go]\": {\n    \"editor.detectIndentation\": false,\n    \"editor.tabSize\": 4,\n    \"editor.insertSpaces\": true\n},\n\"markdownlint.config\": {\n    \"default\": true,\n    \"MD033\": false\n}\n</code></pre>\n\n<p>Follow the link to see the image before the re-format</p>\n\n<p><a href=\"https://i.stack.imgur.com/i8X01.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/i8X01.png\" alt=\"enter image description here\"></a></p>\n\n<p>Here is the image after the re-format</p>\n\n<p><a href=\"https://i.stack.imgur.com/Rupb1.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Rupb1.png\" alt=\"enter image description here\"></a></p>\n\n<p>My status bar before and after the re-format keep the same</p>\n\n<p><a href=\"https://i.stack.imgur.com/AcElf.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/AcElf.png\" alt=\"enter image description here\"></a></p>\n\n<p>And my installed extensions just in case it's an extension issue</p>\n\n<p><a href=\"https://i.stack.imgur.com/IPYuB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/IPYuB.png\" alt=\"enter image description here\"></a></p>\n\n<p>Thanks for your help</p>\n"}, {"tags": ["go", "fasthttp"], "answers": [{"comments": [{"owner": {"reputation": 40221, "user_id": 7311767, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/13Fpq.png?s=128&g=1", "display_name": "Stephen Rauch", "link": "https://stackoverflow.com/users/7311767/stephen-rauch"}, "edited": false, "score": 0, "creation_date": 1512527898, "post_id": 47654064, "comment_id": 82291029, "body": "If you are going to answer a question, it would be great if you took a moment to edit it. Also, if the question was worth answering, isn&#39;t it likely worth an upvote? Thanks and Cheers!"}], "tags": [], "owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "is_accepted": true, "score": 6, "last_activity_date": 1512478252, "creation_date": 1512478252, "answer_id": 47654064, "question_id": 47653938, "link": "https://stackoverflow.com/questions/47653938/how-to-get-all-headers-in-array/47654064#47654064", "title": "How to get all headers in array", "body": "<p>Use <code>request.Header.VisitAll</code>. See <a href=\"https://godoc.org/github.com/valyala/fasthttp#RequestHeader.VisitAll\" rel=\"noreferrer\">related doc</a>.</p>\n\n<pre><code>r.Header.VisitAll(func (key, value []byte) {\n    log.Printf(\"%v: %v\", key, value)\n})\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 9055943, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ce4e0997ab9d1c733725c5785b081e6?s=128&d=identicon&r=PG&f=1", "display_name": "BlackFox", "link": "https://stackoverflow.com/users/9055943/blackfox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 965, "favorite_count": 0, "accepted_answer_id": 47654064, "answer_count": 1, "score": 2, "last_activity_date": 1582281312, "creation_date": 1512477827, "last_edit_date": 1582281312, "question_id": 47653938, "link": "https://stackoverflow.com/questions/47653938/how-to-get-all-headers-in-array", "title": "How to get all headers in array", "body": "<p>I tried to get all headers in handler and faced some difficulties.</p>\n\n<p>valyala/fasthttp has the needed methods and I can get headlines one by one, but I don`t see the obvious way to get all of the headers.</p>\n\n<p>So, How can I get all of the headers into an array?</p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "edited": false, "score": 1, "creation_date": 1512480011, "post_id": 47650500, "comment_id": 82267388, "body": "You shouldn&#39;t compare local performance with GAE. See <a href=\"https://stackoverflow.com/questions/41389295/why-does-google-cloud-sql-using-jdbc-take-longer-to-insert-records-from-google/41390857#41390857\" title=\"why does google cloud sql using jdbc take longer to insert records from google\">stackoverflow.com/questions/41389295/&hellip;</a>."}, {"owner": {"reputation": 532, "user_id": 999349, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0b5ca65662f2b4cc779dbeaaba6029ad?s=128&d=identicon&r=PG", "display_name": "Luigitni", "link": "https://stackoverflow.com/users/999349/luigitni"}, "reply_to_user": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "edited": false, "score": 0, "creation_date": 1512482047, "post_id": 47650500, "comment_id": 82268676, "body": "Thanks for your comment and your link. I am aware of the completely different hardware and architecture of the two systems. My aim is not to compare the performance of the systems. I am not measure the time it takes to complete the request or the efficiency of a solution compared to the other but to gain some insights on what it takes for each system to meet certain requirements. In this case that would be &quot;What do I need to do to have GAE respond to 500 concurrent requests?&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": false, "score": 5, "last_activity_date": 1512475195, "last_edit_date": 1512475195, "creation_date": 1512473956, "answer_id": 47652730, "question_id": 47650500, "link": "https://stackoverflow.com/questions/47650500/concurrent-requests-handling-on-google-app-engine/47652730#47652730", "title": "Concurrent requests handling on Google App Engine", "body": "<p>To make optimal usage in terms of minimizing costs you need to configure few things in <code>app.yaml</code>:</p>\n\n<ul>\n<li>Enable <code>threadsafe: true</code> - actually it's from <a href=\"https://cloud.google.com/appengine/docs/standard/python/config/appref\" rel=\"noreferrer\">Python config</a> and not applicable to Go but I would set it just in case.</li>\n<li>Adjust <a href=\"https://cloud.google.com/appengine/docs/standard/go/config/appref#scaling_elements\" rel=\"noreferrer\">scaling section</a>:\n\n<ul>\n<li><code>max_concurrent_requests</code> - set to maximum 80</li>\n<li><code>max_idle_instances</code> - set to minimum 0</li>\n<li><code>max_pending_latency</code> -  set it to automatic or greater then <code>min_pending_latency</code></li>\n<li><code>min_idle_instances</code> - set it to 0</li>\n<li><code>min_pending_latency</code> - set to higher number. If you are OK to get 1 second latency and you handlers take on average 100ms to process set it to 900ms.</li>\n</ul></li>\n</ul>\n\n<p>Then you should be able to proceed a lot of request on single instance.</p>\n\n<p>If you OK to burn cash for the sake of responsiveness &amp; scalabiluty - increase <code>min_idle_instances</code> &amp; <code>max_idle_instances</code>.</p>\n\n<p>Also do you use similar instance types for VM and GAE? The GAE F1 instance is not too fast and is more optimal for async tasks like working with IO (<em>datastore,http,etc.</em>). You can configure usage of more powerful instance to better scale for computation intensive tasks.</p>\n\n<p>Also do you test on paid account? Free accounts have quotas and AppEngine would refuse percentage of requests if it believe the load would exceed the daily quota if continuous with the same pattern.</p>\n"}, {"tags": [], "owner": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "is_accepted": false, "score": 4, "last_activity_date": 1512480767, "creation_date": 1512480767, "answer_id": 47654867, "question_id": 47650500, "link": "https://stackoverflow.com/questions/47650500/concurrent-requests-handling-on-google-app-engine/47654867#47654867", "title": "Concurrent requests handling on Google App Engine", "body": "<p>Extending on Alexander's answer.</p>\n\n<p>The GAE scaling logic is based on incoming traffic trend analysis.</p>\n\n<p>The key for being able to handle your case - sudden spikes in traffic (which can't be takes into account in the trend analysis due to its variation speed) - is to have sufficient resident (idle) instances configured for your application to handle such traffic until GAE spins up additional dynamic instances. It can handle as high peaks as you want (if your pockets are deep enough).</p>\n\n<p>See <a href=\"https://cloud.google.com/appengine/docs/standard/go/how-instances-are-managed\" rel=\"nofollow noreferrer\">Scaling dynamic instances</a> for more details.</p>\n"}, {"tags": [], "owner": {"reputation": 532, "user_id": 999349, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0b5ca65662f2b4cc779dbeaaba6029ad?s=128&d=identicon&r=PG", "display_name": "Luigitni", "link": "https://stackoverflow.com/users/999349/luigitni"}, "is_accepted": true, "score": 2, "last_activity_date": 1512485702, "creation_date": 1512485702, "answer_id": 47656528, "question_id": 47650500, "link": "https://stackoverflow.com/questions/47650500/concurrent-requests-handling-on-google-app-engine/47656528#47656528", "title": "Concurrent requests handling on Google App Engine", "body": "<p>Thanks everyone for their help.\nMany interesting points and insights have been made by the answers I had on this topic.</p>\n\n<p>The fact the the Cloud Console were reporting no errors led me to believe that the bottleneck was happening after the real request processing.</p>\n\n<p>I found the reason why the results were not as expected: bandwidth.</p>\n\n<p>Each response had a payload of roughly 1MB and thus responding to 500 simultaneous connections from the same client would clog the lines, resulting in timeouts.\nThis was obviously not happening when requesting to the VM, where the bandwith is much larger.</p>\n\n<p>Now GAE scaling is in line with what I expected: it successfully scales to accomodate each incoming request.</p>\n"}], "owner": {"reputation": 532, "user_id": 999349, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0b5ca65662f2b4cc779dbeaaba6029ad?s=128&d=identicon&r=PG", "display_name": "Luigitni", "link": "https://stackoverflow.com/users/999349/luigitni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1400, "favorite_count": 0, "accepted_answer_id": 47656528, "answer_count": 3, "score": 2, "last_activity_date": 1512485702, "creation_date": 1512467364, "last_edit_date": 1512467822, "question_id": 47650500, "link": "https://stackoverflow.com/questions/47650500/concurrent-requests-handling-on-google-app-engine", "title": "Concurrent requests handling on Google App Engine", "body": "<p>I was experimenting with concurrent request handling on few platforms.</p>\n\n<p>The aim of the experiment was to have a <strong>broad</strong> measure of the capacity bounds of some selected technologies.</p>\n\n<p>I set up a Linux VM on my machine with a basic Go http server (the vanilla <code>http.HandleFunc</code> of the <code>http</code> default package).\nThe server would then compute a modified version of the <em><a href=\"https://benchmarksgame.alioth.debian.org/u64q/program.php?test=fasta&amp;lang=go&amp;id=3\" rel=\"nofollow noreferrer\">fasta</a></em> algorithm that restricted threads and processes to 1, and return the result. N was set to 100000.\nThe algorithm runs in roughly 2 seconds.\nI used the <em>same</em> algorithm and logic on a Google App Engine project.</p>\n\n<p>The algorithm is written using the same code, just the handler set up is done on <code>init()</code> instead of <code>main()</code> as per GAE requirements.</p>\n\n<p>On the other end an Android client is spawning 500 threads each one issuing in parallel a <code>GET</code> request to the <em>fasta</em> computing server, with a request timeout of 5000 ms.</p>\n\n<p>I was expecting the GAE application to scale and answer back to each request and the local Go server to fail on some of the 500 requests but results were the opposite:\nthe local server correctly replied to each request within the timeout bounds while the GAE application was able to handle just 160 requests out of 500. The remaining requests timed out.</p>\n\n<p>I checked on the Cloud Console and I verified that 18 GAE instances were spawned, but still the vast majority of requests failed.</p>\n\n<p>I thought that most of them failed because of the start-up time of each GAE instance, so I repeated the experiment right after but I had the same results: most of the requests timed out.</p>\n\n<p>I was expecting GAE to scale to accomodate ALL the requests, believing that if a single local VM could successfully reply to 500 concurrent requests GAE would have done the same, but this is not what happened.</p>\n\n<p>The GAE console doesn't show any error and correctly reports the number of incoming requests.</p>\n\n<p><em>What could be the cause of this?</em> \nAlso, if a single instance could handle all the incoming requests on my machine by virtue of only goroutines, how come that GAE needed to scale so much at all?</p>\n"}, {"tags": ["go", "beego"], "answers": [{"tags": [], "owner": {"reputation": 12623, "user_id": 5985853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/49VtI.jpg?s=128&g=1", "display_name": "Alexey Soshin", "link": "https://stackoverflow.com/users/5985853/alexey-soshin"}, "is_accepted": false, "score": 0, "last_activity_date": 1512845983, "creation_date": 1512845983, "answer_id": 47732062, "question_id": 47650213, "link": "https://stackoverflow.com/questions/47650213/create-database-with-migration-beego/47732062#47732062", "title": "Create database with migration beego", "body": "<p>To address your problem, you're not executing your SQL in the end.</p>\n\n<p>Add the following line to your <code>Up()</code>:</p>\n\n<pre><code>m.SQL(m.GetSQL())\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 6907245, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1056621974406892/picture?type=large", "display_name": "\u0110\u1eafc Ti&#234;n", "link": "https://stackoverflow.com/users/6907245/%c4%90%e1%ba%afc-ti%c3%aan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 484, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1512845983, "creation_date": 1512466420, "question_id": 47650213, "link": "https://stackoverflow.com/questions/47650213/create-database-with-migration-beego", "title": "Create database with migration beego", "body": "<p>I already created migration file via <code>bee generate migration create_users_table</code>. Then i had one file in folder database/migrations/20171205_154034_create_users_table.go\nThis is my file :</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/astaxie/beego/migration\"\n)\n\n// DO NOT MODIFY\ntype CreateUsersTable_20171205_154034 struct {\n    migration.Migration\n}\n\n// DO NOT MODIFY\nfunc init() {\n    m := &amp;CreateUsersTable_20171205_154034{}\n    m.Created = \"20171205_154034\"\n\n    migration.Register(\"CreateUsersTable_20171205_154034\", m)\n}\n\n// Run the migrations\nfunc (m *CreateUsersTable_20171205_154034) Up() {\n    m.CreateTable(\"users\",\"InnoDB\",\"utf8\")\n    m.PriCol(\"id\").SetAuto(true).SetNullable(false).SetDataType(\"INT(10)\").SetUnsigned(true)\n}\n\n// Reverse the migrations\nfunc (m *CreateUsersTable_20171205_154034) Down() {\n    m.SQL(\"DROP TABLE users\")\n}\n</code></pre>\n\n<p>Finally, i run <code>bee migrate -conn=\"username:password@tcp(127.0.0.1:3306)/mydb\"</code>.\nI got <code>Migration successful!</code> no error. But i did not have users table in database. Whats wrong?\nThank you for reading. Hope anyone help me</p>\n"}, {"tags": ["go", "depth-first-search"], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 0, "last_activity_date": 1512464180, "creation_date": 1512464180, "answer_id": 47649565, "question_id": 47648631, "link": "https://stackoverflow.com/questions/47648631/confused-about-the-depth-first-search-result-when-using-golang/47649565#47649565", "title": "Confused about the depth-first-search result when using Golang", "body": "<p>If <code>list</code> has capacity, then it will be modified and therefore you are modifying your argument. Instead make a copy of list, and then append <code>nums[i]</code> to it.</p>\n\n<p>See <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">Go Slices: usage and internals</a></p>\n"}, {"tags": [], "owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "is_accepted": true, "score": 0, "last_activity_date": 1512500739, "last_edit_date": 1512500739, "creation_date": 1512464611, "answer_id": 47649683, "question_id": 47648631, "link": "https://stackoverflow.com/questions/47648631/confused-about-the-depth-first-search-result-when-using-golang/47649683#47649683", "title": "Confused about the depth-first-search result when using Golang", "body": "<p><code>append</code> function may or may not modify the underlying array that your slice refers to. So you are not creating a completely new list when using append. I changed <code>helper</code> to match your desired behavior.</p>\n\n<pre><code>for i := index; i &lt; length; i++ {\n    if i != index &amp;&amp; nums[i] == nums[i - 1] {\n        continue\n    }\n    if nums[i] &gt; target {\n        break\n    }\n    var newList []int\n    newList = append(newList, list...)\n    newList = append(newList, nums[i])\n    helper(nums, i, target - nums[i], newList, resultp, length)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18221, "user_id": 1439305, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/gNHmR.jpg?s=128&g=1", "display_name": "Audrius Meskauskas", "link": "https://stackoverflow.com/users/1439305/audrius-meskauskas"}, "is_accepted": false, "score": 0, "last_activity_date": 1512468914, "creation_date": 1512468914, "answer_id": 47651072, "question_id": 47648631, "link": "https://stackoverflow.com/questions/47648631/confused-about-the-depth-first-search-result-when-using-golang/47651072#47651072", "title": "Confused about the depth-first-search result when using Golang", "body": "<p>The line</p>\n\n<pre><code>helper(nums, i, target - nums[i], append(list, nums[i]), resultp, length)\n</code></pre>\n\n<p>may not perform as expected. It is called within the loop, and you are probably assuming that in the each iteration the  <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">append</a> will always add the new member to the existing slice. If has more complex behavior that you seem not caring about enough:</p>\n\n<ul>\n<li>If the new value fits into the current capacity of the backing array withing the slice, it is added to the current backing array. All variables assigned to that slice now report the updated content with the added new value present.</li>\n<li>If the value does not fit, a new array is allocated. In this case further modifications of the returned slice will not change the content of the initial slice if that old value is also retained.</li>\n</ul>\n\n<p>I am under impression that you may not expect value/content disagreement between the value returned by <code>append</code> and the parameter <code>list</code> you pass to it. </p>\n\n<p>This behavior is described <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">here</a> (scroll to \"gotcha\").</p>\n"}, {"tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": false, "score": 0, "last_activity_date": 1512496706, "creation_date": 1512496706, "answer_id": 47659846, "question_id": 47648631, "link": "https://stackoverflow.com/questions/47648631/confused-about-the-depth-first-search-result-when-using-golang/47659846#47659846", "title": "Confused about the depth-first-search result when using Golang", "body": "<p>So you can see the behavior a bit better by adding some print output:</p>\n\n<p><a href=\"https://play.golang.org/p/JPmqoAJE4S\" rel=\"nofollow noreferrer\">https://play.golang.org/p/JPmqoAJE4S</a></p>\n\n<p>Importantly, you can see it at this point:</p>\n\n<pre><code>0694 helper [2 3 7] 1 1 [2 2 2 2 2 2 2 3] [[2 2 2 2 2 2 2 2 2]] 3\n4425 calling down 1 6 [2 2 2 2 2 2] 3\n8511 helper [2 3 7] 1 3 [2 2 2 2 2 2 3] [[2 2 2 2 2 2 2 2 2]] 3\n8511 calling down 1 3 [2 2 2 2 2 2 3] 3\n8162 helper [2 3 7] 1 0 [2 2 2 2 2 2 3 3] [[2 2 2 2 2 2 2 2 2]] 3\n8162 solution [2 2 2 2 2 2 3 3] [[2 2 2 2 2 2 2 2 2] [2 2 2 2 2 2 3 3]]\n1318 calling down 1 8 [2 2 2 2 2] 3\n5089 helper [2 3 7] 1 5 [2 2 2 2 2 3] [[2 2 2 2 2 2 2 2 2] [2 2 2 2 2 3 3 3]] 3\n5089 calling down 1 5 [2 2 2 2 2 3] 3\n4728 helper [2 3 7] 1 2 [2 2 2 2 2 3 3] [[2 2 2 2 2 2 2 2 2] [2 2 2 2 2 3 3 3]] 3\n1318 calling down 2 8 [2 2 2 2 2] 7\n3274 helper [2 3 7] 2 1 [2 2 2 2 2 7] [[2 2 2 2 2 2 2 2 2] [2 2 2 2 2 7 3 3]] 3\n</code></pre>\n\n<p>This is the sequence of actions:</p>\n\n<ul>\n<li>You recursively call with <code>[2 2 2 2 2 2 3]</code> and append 3.  You find that this is a valid solution and add <code>[2 2 2 2 2 2 3 3]</code> to the result slice.</li>\n<li>You return up a few levels until you're back to <code>[2 2 2 2 2]</code> (before adding the 6th 2) and start trying to add 3s.  You recursively call with <code>[2 2 2 2 2]</code> and append 3.  Unfortunately, this overwrites your existing solution <code>[2 2 2 2 2 2 3 3]</code>.  Since it's using the <em>same backing array</em>, you append <code>3</code> to the first 5 items in that slice, overwriting the 6th index in the slice you previously added to your solution set.  Your second solution becomes <code>[2 2 2 2 2 3 3 3]</code> (note the <code>3</code> in the 6th slot)</li>\n<li>You find that this solution set isn't going to work after a couple iterations (at <code>[2 2 2 2 2 3 3]</code>) because the remaining target (2) is less than the last number added (3), so you return up.</li>\n<li>You repeat this sequence with a 7 in the 6th slot, overwriting the underlying array index again.  Your second solution becomes <code>[2 2 2 2 2 7 3 3]</code>, because you're <em>still</em> using the same underlying array.  You find this solution also won't work, and return up.</li>\n</ul>\n\n<p>After this point, you return up to before the list slice was greater than 4 in length (which is when the slice grew, by default it grows by doubling in size), meaning you're using a different (previous) backing array, which is why further iterations do not further change the existing solutions.  By luck, none of the remaining solutions collide in a similar fashion.</p>\n\n<p>This alternative print version shows you where the backing array changes (by showing where the address of the first entry changes): <a href=\"https://play.golang.org/p/nrgtMyqwow\" rel=\"nofollow noreferrer\">https://play.golang.org/p/nrgtMyqwow</a>.  As you can see, it changes when you grow beyond lengths 2, 4, and 8, but as you return upwards, you end up reverting back to different backing arrays.</p>\n\n<p>The easiest solution to fix your specific problem is to copy the list slice before adding it to the solution set:</p>\n\n<pre><code>if target == 0 {\n    sol := make([]int, len(list))\n    copy(sol, list)\n    *resultp = append(*resultp, sol)\n    return\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/3qTKoAumj0\" rel=\"nofollow noreferrer\">https://play.golang.org/p/3qTKoAumj0</a></p>\n\n<p><code>[[2 2 2 2 2 2 2 2 2] [2 2 2 2 2 2 3 3] [2 2 2 2 3 7] [2 2 2 3 3 3 3] [2 2 7 7] [2 3 3 3 7] [3 3 3 3 3 3]]</code></p>\n"}], "owner": {"reputation": 13, "user_id": 6849642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/898aad647814c3e03df0506612851655?s=128&d=identicon&r=PG&f=1", "display_name": "Shawn", "link": "https://stackoverflow.com/users/6849642/shawn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "accepted_answer_id": 47649683, "answer_count": 4, "score": 1, "last_activity_date": 1512500739, "creation_date": 1512460502, "last_edit_date": 1512463903, "question_id": 47648631, "link": "https://stackoverflow.com/questions/47648631/confused-about-the-depth-first-search-result-when-using-golang", "title": "Confused about the depth-first-search result when using Golang", "body": "<p>I tried to solve the 'Combination Sum' on leetcode, and the result is wrong when using test case:</p>\n\n<blockquote>\n  <p>[7,3,2] 18</p>\n</blockquote>\n\n<p>I used C++ with the same logic and passed, but when using Golang, my result is:</p>\n\n<blockquote>\n  <p>[[2,2,2,2,2,2,2,2,2],[2,2,2,2,2,7,3,3],[2,2,2,2,3,7],[2,2,2,3,3,3,3],[2,2,7,7],[2,3,3,3,7],[3,3,3,3,3,3]]</p>\n</blockquote>\n\n<p>and the correct one should be</p>\n\n<blockquote>\n  <p>[[2,2,2,2,2,2,2,2,2],[2,2,2,2,2,2,3,3],[2,2,2,2,3,7],[2,2,2,3,3,3,3],[2,2,7,7],[2,3,3,3,7],[3,3,3,3,3,3]]</p>\n</blockquote>\n\n<p>the code is shown below:</p>\n\n<pre><code>import \"sort\"\nfunc combinationSum(candidates []int, target int) [][]int {\n    result := make([][]int, 0, 0)\n    resultp := &amp;result\n    sort.Ints(candidates)\n    helper(candidates, 0, target, make([]int, 0, 0), resultp, len(candidates))\n    return *resultp\n}\n\nfunc helper(nums []int, index int, target int, list []int, resultp *[][]int, length int) {\n    if target == 0 {\n        *resultp = append(*resultp, list)\n        return\n    }\n    for i := index; i &lt; length; i++ {\n        if i != index &amp;&amp; nums[i] == nums[i - 1] {\n            continue\n        }\n        if (nums[i] &gt; target) {\n            break\n        }\n        helper(nums, i, target - nums[i], append(list, nums[i]), resultp, length)\n    }\n}\n</code></pre>\n\n<p>Can anyone tell me why the result is incorrect, I am just confused about the [2,2,2,2,2,7,3,3] in my answer, why the 7 is before the 3 since the array has been sorted? Or anyone can tell me what mistake I have made in my code </p>\n\n\n"}, {"tags": ["mysql", "go", "orm", "go-gorm"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1512467096, "post_id": 47647554, "comment_id": 82259041, "body": "<code>how would I do it with gorm without resorting to raw SQL?</code> -- This is precisely why ORMs are best avoided, IMO. You spend more time working around them than working with them."}], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 6301574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c61afeb36449f1bdb8610fd6022033c8?s=128&d=identicon&r=PG&f=1", "display_name": "Northern", "link": "https://stackoverflow.com/users/6301574/northern"}, "edited": false, "score": 0, "creation_date": 1512473541, "post_id": 47647789, "comment_id": 82263241, "body": "Tried preloading, but it doesn&#39;t seem to work. It preloads all the sessions for all the users, but it doesn&#39;t allow me to limit which users will be returned.  SOLUTION: what did work was &quot;Related&quot;.  db.First(&amp;mySessionObj, &amp;Session{SessionID: &quot;Some ID&quot;}).Related(&amp;myUserObj)"}], "tags": [], "owner": {"reputation": 790, "user_id": 1454445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f6e77c80d980f4f8d2bafbfec5b9ded5?s=128&d=identicon&r=PG", "display_name": "Kyle", "link": "https://stackoverflow.com/users/1454445/kyle"}, "is_accepted": true, "score": 1, "last_activity_date": 1512457041, "creation_date": 1512457041, "answer_id": 47647789, "question_id": 47647554, "link": "https://stackoverflow.com/questions/47647554/struct-user-has-many-sessions-find-a-user-given-a-session/47647789#47647789", "title": "Struct user - has many sessions. Find a user given a session", "body": "<p>What you want is gorm's preloading feature: <a href=\"http://jinzhu.me/gorm/crud.html#preloading-eager-loading\" rel=\"nofollow noreferrer\">http://jinzhu.me/gorm/crud.html#preloading-eager-loading</a></p>\n\n<p>It has the ability to filter the child table with a where-like syntax.</p>\n"}], "owner": {"reputation": 73, "user_id": 6301574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c61afeb36449f1bdb8610fd6022033c8?s=128&d=identicon&r=PG&f=1", "display_name": "Northern", "link": "https://stackoverflow.com/users/6301574/northern"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 47647789, "answer_count": 1, "score": 0, "last_activity_date": 1512466865, "creation_date": 1512456079, "last_edit_date": 1512466865, "question_id": 47647554, "link": "https://stackoverflow.com/questions/47647554/struct-user-has-many-sessions-find-a-user-given-a-session", "title": "Struct user - has many sessions. Find a user given a session", "body": "<p>I'm using gorm for Go with MySQL driver, and here's what I'm trying to do.\nHere are my two structs:</p>\n\n<pre><code>type User struct {\n    ID       uint      `gorm:\"primary_key\"`\n    Email    string    `sql:\"unique_index;not null;type:varchar(64)\"`\n    Password string    `sql:\"index;not null;type:varchar(64)\"`\n    Sessions []Session `gorm:\"ForeignKey:UserID\"`\n    Roles    []Role    `gorm:\"many2many:users_roles;\"`\n    Level    uint      `sql:\"not null;type:tinyint(1);DEFAULT:1\"`\n}\n\ntype Session struct {\n    ID       uint      `gorm:\"primary_key\"`\n    SessionID string `sql:\"index\"`\n    UserID    uint   `sql:\"index\"`\n    UpdatedAt time.Time\n}\n</code></pre>\n\n<p>As is seen from the code, a struct <code>User</code> is supposed to have a <em>has many</em> relationship with the Sessions. </p>\n\n<p>Now let's suppose I have a user record in the database, and a session record in the sessions table with the user's ID.\nI'd like to be able to retrieve the user data based on the Session ID. That is, find a session record based on <code>SessionID</code>, and then grab the user info based on the <code>UserID</code> of that session.</p>\n\n<p>In pure MySQL, I'd do it like this:</p>\n\n<pre><code>SELECT\n    *\nFROM\n    `users\nWHERE `id` = (SELECT `user_id` FROM `sessions` WHERE `session_id` = &lt;MY-SESSION-ID&gt; LIMIT 1)\n</code></pre>\n\n<p>Or I could do it with a join like this</p>\n\n<pre><code>SELECT\n    `u`.*\nFROM\n    `users` `u`\nLEFT JOIN `sessions` `s`\nON `s`.`user_id` = `u`.`id`\nWHERE\n    `s`.`session_id` = &lt;MY-SESSION-ID&gt;\nGROUP BY `u`.`id`\n</code></pre>\n\n<p>Anyway, how would I do it with gorm without resorting to raw SQL?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2083, "user_id": 1515720, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/757d7f8d7844e26cb054ff176c9b3d48?s=128&d=identicon&r=PG", "display_name": "ardent", "link": "https://stackoverflow.com/users/1515720/ardent"}, "edited": false, "score": 0, "creation_date": 1512458710, "post_id": 47647333, "comment_id": 82254547, "body": "time.Timer will only fire a single time, so there isn&#39;t really a need to range over it. Did you mean to use a time.Ticker?"}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "reply_to_user": {"reputation": 2083, "user_id": 1515720, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/757d7f8d7844e26cb054ff176c9b3d48?s=128&d=identicon&r=PG", "display_name": "ardent", "link": "https://stackoverflow.com/users/1515720/ardent"}, "edited": false, "score": 1, "creation_date": 1512459225, "post_id": 47647333, "comment_id": 82254818, "body": "@ardent an expired Timer can be reset, meaning it can in fact fire more than once (and unlike a Ticker, it can do it at irregular intervals, if the controlling code wants.)"}, {"owner": {"reputation": 2280, "user_id": 2094168, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/cf7f39f46237a00ea06cd9706be9efab?s=128&d=identicon&r=PG", "display_name": "2ank3th", "link": "https://stackoverflow.com/users/2094168/2ank3th"}, "edited": false, "score": 0, "creation_date": 1512466158, "post_id": 47647333, "comment_id": 82258468, "body": "I am using random intervals and using timer reset as hobbs mentioned."}], "answers": [{"comments": [{"owner": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "edited": false, "score": 0, "creation_date": 1512460390, "post_id": 47648211, "comment_id": 82255424, "body": "It might be a little more efficient and make more sense for rf.done to be replaced with a simple <code>bool</code> rather than a <code>chan struct{}</code>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "edited": false, "score": 0, "creation_date": 1512460642, "post_id": 47648211, "comment_id": 82255568, "body": "@Acidic That introduces a data race when Stop and Reset are called from another goroutine."}, {"owner": {"reputation": 2280, "user_id": 2094168, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/cf7f39f46237a00ea06cd9706be9efab?s=128&d=identicon&r=PG", "display_name": "2ank3th", "link": "https://stackoverflow.com/users/2094168/2ank3th"}, "edited": false, "score": 0, "creation_date": 1512467482, "post_id": 47648211, "comment_id": 82259296, "body": "Thanks, Cerise Limon. I am resetting the timer. I tried something similar to what you wrote but I used a channel of type bool and it blocked the channel when I tried rf.done &lt;- true. Do you know why close works but not rf.done &lt;- true doesn&#39;t?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 2280, "user_id": 2094168, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/cf7f39f46237a00ea06cd9706be9efab?s=128&d=identicon&r=PG", "display_name": "2ank3th", "link": "https://stackoverflow.com/users/2094168/2ank3th"}, "edited": false, "score": 0, "creation_date": 1512484927, "post_id": 47648211, "comment_id": 82270567, "body": "@2ank3th Sending to a channel can work, but I cannot determine why it did not work for you without seeing more code."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1512459922, "last_edit_date": 1512459922, "creation_date": 1512458746, "answer_id": 47648211, "question_id": 47647333, "link": "https://stackoverflow.com/questions/47647333/how-do-i-close-the-timer-channel/47648211#47648211", "title": "How do I close the timer channel?", "body": "<p>Use a channel to signal when the loop should exit. </p>\n\n<pre><code>rf.done := make(chan struct{})\nrf.electionTimer = time.NewTimer(electionTime) \n\nfunc stopTimer(){\n    if rf.electionTimer != nil {\n         rf.electionTimer.Stop()\n         close(rf.done)\n    }\n}\n</code></pre>\n\n<p>Select on both the signal channel and the timer channel in a loop.  Break out of the loop when signal channel is closed.</p>\n\n<pre><code>loop:\n    for {\n        select {\n        case t := &lt;-rf.electionTimer.C:\n            // Do something\n        case &lt;-rf.done:\n            break loop\n        }\n    }\n</code></pre>\n\n<p>Note that it does not make sense to use a loop in the question or this answer if the application does not call <a href=\"https://godoc.org/time#Timer.Reset\" rel=\"nofollow noreferrer\">Reset</a> on the timer. If the timer is not reset, then only one value will be sent to the timer's channel.</p>\n"}, {"comments": [{"owner": {"reputation": 2280, "user_id": 2094168, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/cf7f39f46237a00ea06cd9706be9efab?s=128&d=identicon&r=PG", "display_name": "2ank3th", "link": "https://stackoverflow.com/users/2094168/2ank3th"}, "edited": false, "score": 0, "creation_date": 1512466055, "post_id": 47648357, "comment_id": 82258417, "body": "My initial solution was to use t := &lt;-rf.electionTimer.C but this creates a lot of goroutines that are frozen slowing down the process."}], "tags": [], "owner": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "is_accepted": false, "score": -1, "last_activity_date": 1512459731, "last_edit_date": 1512459731, "creation_date": 1512459334, "answer_id": 47648357, "question_id": 47647333, "link": "https://stackoverflow.com/questions/47647333/how-do-i-close-the-timer-channel/47648357#47648357", "title": "How do I close the timer channel?", "body": "<p>The channel from the <a href=\"https://golang.org/pkg/time/#Timer\" rel=\"nofollow noreferrer\">timer</a> does not output a time several times. It will only output a time once after the timer has ended. Therefore, it is useless to use the <code>rf.electionTimer</code> in a <code>for</code> loop.</p>\n\n<p>Try replacing your <code>for</code> loop with:</p>\n\n<pre><code>t := &lt;-rf.electionTimer.C\n// Do something with t\n</code></pre>\n\n<p>This will pause execution until the timer has stopped.</p>\n\n<p>Keep in mind, using <code>rf.electionTimer.Stop()</code> will prevent the timer from ever ending and your <code>&lt;-rf.electionTimer.C</code> line will freeze.</p>\n\n<blockquote>\n  <p>How do I close the channel so that for loop exits?</p>\n</blockquote>\n\n<p>To prevent the <code>&lt;-rf.electionTimer.C</code> from preventing execution of code, I suggest you use:</p>\n\n<pre><code>rf.electionTimer.Reset(0)\n</code></pre>\n"}], "owner": {"reputation": 2280, "user_id": 2094168, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/cf7f39f46237a00ea06cd9706be9efab?s=128&d=identicon&r=PG", "display_name": "2ank3th", "link": "https://stackoverflow.com/users/2094168/2ank3th"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1376, "favorite_count": 0, "accepted_answer_id": 47648211, "answer_count": 2, "score": 2, "last_activity_date": 1512467146, "creation_date": 1512455155, "last_edit_date": 1512467146, "question_id": 47647333, "link": "https://stackoverflow.com/questions/47647333/how-do-i-close-the-timer-channel", "title": "How do I close the timer channel?", "body": "<p>I have a timer which is reset by certain events. A go function listens to the channel using range. How do I close the channel so that for loop exits? </p>\n\n<pre><code>func resetTimer(){\n        if rf.electionTimer != nil {\n             rf.electionTimer.Stop()\n        }\n}\n\nrf.electionTimer = time.NewTimer(electionTime) \n\n\nfor _ = range rf.electionTimer.C {\n  // Do something\n}\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 1321, "user_id": 3107689, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdbb6168012bc7c8d4a43f36f6b089dd?s=128&d=identicon&r=PG", "display_name": "yeya", "link": "https://stackoverflow.com/users/3107689/yeya"}, "edited": false, "score": 0, "creation_date": 1512454901, "post_id": 47647206, "comment_id": 82252844, "body": "Is it have to be in <code>go</code>?"}, {"owner": {"reputation": 55, "user_id": 7425610, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee14446bf5d9e375410f60287b7d15fe?s=128&d=identicon&r=PG&f=1", "display_name": "user7425610", "link": "https://stackoverflow.com/users/7425610/user7425610"}, "reply_to_user": {"reputation": 1321, "user_id": 3107689, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdbb6168012bc7c8d4a43f36f6b089dd?s=128&d=identicon&r=PG", "display_name": "yeya", "link": "https://stackoverflow.com/users/3107689/yeya"}, "edited": false, "score": 0, "creation_date": 1512471929, "post_id": 47647206, "comment_id": 82262220, "body": "yes. The language is Go"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1512459134, "last_edit_date": 1512459134, "creation_date": 1512456706, "answer_id": 47647707, "question_id": 47647206, "link": "https://stackoverflow.com/questions/47647206/is-it-possible-to-rewrite-strings-in-unknown-json-structure/47647707#47647707", "title": "Is it possible to rewrite strings in unknown json structure?", "body": "<p>Yes, it is possible using the standard library and a little bit of code.</p>\n\n<p>Unmarshal to interface{}</p>\n\n<pre><code>var v interface{}\nif err := json.Unmarshal(data, &amp;v); err != nil {\n  // handle error\n}\n</code></pre>\n\n<p>Traverse the unmarshaled value, shortening strings and rewriting as you go:</p>\n\n<pre><code>func shorten(v interface{}) interface{} {\n    switch v := v.(type) {\n    case []interface{}:\n        for i, e := range v {\n            v[i] = shorten(e)\n        }\n        return v\n    case map[string]interface{}:\n        m := make(map[string]interface{})\n        for k, e := range v {\n            m[shortenString(k)] = shorten(e)\n        }\n        return m\n    case string:\n        return shortenString(v)\n    default:\n        return v\n    }\n}\n</code></pre>\n\n<p>The function <code>shorten</code> calls <code>shortenString(s string) string</code> to convert a long string to <code>short://ID=xxx</code>.</p>\n\n<p>Marshal the value back to JSON:</p>\n\n<pre><code>p, err := json.Marshal(shorten(v))\nif err != nil {\n    // handle error\n}\n\n// p is a []byte\nfmt.Printf(\"%s\\n\", p)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/9VuEkZrPLz\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}, {"tags": [], "owner": {"reputation": 103812, "user_id": 320726, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/02041b18199678d1f02e6d5040dbb907?s=128&d=identicon&r=PG", "display_name": "6502", "link": "https://stackoverflow.com/users/320726/6502"}, "is_accepted": false, "score": 1, "last_activity_date": 1512458218, "creation_date": 1512458218, "answer_id": 47648080, "question_id": 47647206, "link": "https://stackoverflow.com/questions/47647206/is-it-possible-to-rewrite-strings-in-unknown-json-structure/47648080#47648080", "title": "Is it possible to rewrite strings in unknown json structure?", "body": "<p>If the requirement is to replace all strings longer than 85 characters with a new shortened version in a JSON and if you can assume the JSON is a valid JSON (i.e. if you're not required to give a diagnostic in case of invalid input) then you can just use a single regexp substitution.</p>\n\n<p>A quoted string in a valid JSON can be matched with</p>\n\n<pre><code>/\"([^\\\\\"]|\\\\.)*\"/\n</code></pre>\n\n<p>therefore you could just replace all instances of this pattern with the possibly shortened version.</p>\n"}, {"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": false, "score": 0, "last_activity_date": 1512463302, "creation_date": 1512463302, "answer_id": 47649309, "question_id": 47647206, "link": "https://stackoverflow.com/questions/47647206/is-it-possible-to-rewrite-strings-in-unknown-json-structure/47649309#47649309", "title": "Is it possible to rewrite strings in unknown json structure?", "body": "<p>Here is a an approach (tested) which uses <code>json.Decoder</code>'s <a href=\"https://golang.org/pkg/encoding/json/#Decoder.Token\" rel=\"nofollow noreferrer\">Token()</a> method, and avoids deserializing the whole data structure into memory. It's mostly done for fun and for the sake illustrating how you can use that method, but it could possibly be of some use if your JSON documents are very large and you would like to avoid the memory overhead.</p>\n\n<pre><code>// For example\nr, w := os.Stdin, os.Stdout\n\ndec := json.NewDecoder(r)\n// Avoids any round-trip loss by leaving numbers un-parsed\ndec.UseNumber()\n\n// Current state (in an object or in an array; following the open\n// delim, or a key, or a value). The decoder has its own stack pretty\n// like this one, but it's private, so keep our own.\nconst (\n    jsonArrayStart = iota\n    jsonArrayVal\n    jsonObjectStart\n    jsonObjectKey\n    jsonObjectVal\n)\nstack := []byte{}\n\nfor {\n    t, err := dec.Token()\n    if err == io.EOF {\n        break\n    } else if err != nil {\n        log.Fatal(err)\n    }\n\n    switch val := t.(type) {\n    case json.Delim:\n        // Copy delimiters out, and push/pop the state stack as appropriate\n        w.WriteString(string([]rune{rune(val)}))\n        switch val {\n        case '[':\n            stack = append(stack, jsonArrayStart)\n        case '{':\n            stack = append(stack, jsonObjectStart)\n        case ']', '}':\n            stack = stack[:len(stack)-1]\n        }\n        // The rest of the cases just copy values out\n    case nil:\n        w.WriteString(\"null\")\n    case json.Number:\n        w.WriteString(string(val))\n    case bool:\n        if val {\n            w.WriteString(\"true\")\n        } else {\n            w.WriteString(\"false\")\n        }\n    case string:\n        // Modify strings if called for (shortenString needs to be provided)\n        if len(val) &gt;= 85 {\n            val = shortenString(val)\n        }\n        encoded, err := json.Marshal(val)\n        if err != nil {\n            log.Fatal(err)\n        }\n        w.Write(encoded)\n    }\n\n    if dec.More() {\n        // If there's more in the current array/object, write a colon or comma\n        // (if we just wrote a key/value), and set the next state.\n        // Arrays start with a value, and follow with more values.\n        // Objects start with a key and alternate between key and value.\n        switch stack[len(stack)-1] {\n        case jsonArrayStart:\n            stack[len(stack)-1] = jsonArrayVal\n        case jsonArrayVal:\n            w.WriteString(\",\")\n            // State remains jsonArrayVal\n        case jsonObjectStart:\n            stack[len(stack)-1] = jsonObjectKey\n        case jsonObjectKey:\n            w.WriteString(\":\")\n            stack[len(stack)-1] = jsonObjectVal\n        case jsonObjectVal:\n            w.WriteString(\",\")\n            stack[len(stack)-1] = jsonObjectKey\n        }\n    } else {\n        if len(stack) == 0 {\n            // End after the first complete value (array/object) in the stream\n            break\n        }\n        if stack[len(stack)-1] == jsonObjectKey {\n            // Should never happen\n            log.Fatal(\"Object key without a value?\")\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 7425610, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee14446bf5d9e375410f60287b7d15fe?s=128&d=identicon&r=PG&f=1", "display_name": "user7425610", "link": "https://stackoverflow.com/users/7425610/user7425610"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 47647707, "answer_count": 3, "score": 0, "last_activity_date": 1512463302, "creation_date": 1512454605, "question_id": 47647206, "link": "https://stackoverflow.com/questions/47647206/is-it-possible-to-rewrite-strings-in-unknown-json-structure", "title": "Is it possible to rewrite strings in unknown json structure?", "body": "<p>I have a requirement to parse arbitrary json, encode/rewrite any string key or value longer than 85 characters(think of a kind of short URL service) and marshal it back to raw json.\n e.g. a document like this <code>{\"Name\": \"Ed\", \"Text\": \"long characters....85 chars\"}</code> should become something like this <code>{\"Name\": \"Ed\", \"Text\": \"short://ID=3403\"}</code>. This example is simple but I have to deal with complex structures with nested objects and arrays and basically unknown  structures.</p>\n\n<p>My question is: Is it possible to do this using a known library or even the standard encoding/json package? \n What I actually need is the equivalent of an implementation of <a href=\"https://golang.org/pkg/encoding/json/#Marshaler\" rel=\"nofollow noreferrer\">Marshaler</a> interface on <code>type  string</code> but we know that's not possible so I'm wondering what other options I have (beside forking the standard encoding/json package)</p>\n"}, {"tags": ["select", "go", "scheduling", "channel", "goroutine"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1512446121, "post_id": 47645808, "comment_id": 82250203, "body": "<code>select</code> does not provide any guarantees on what channel it would pick. <code>select</code> is opposite to the &quot;balance&quot; actually. If you want to split evenly - read from one channel, then from the other, without <code>select</code> at all."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1512456104, "post_id": 47645808, "comment_id": 82253304, "body": "If any of your goroutines were actually <i>doing any work</i> you wouldn&#39;t have any problems with fairness."}, {"owner": {"reputation": 319, "user_id": 8652703, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dce90a6950f92d17211799b8bb7eabea?s=128&d=identicon&r=PG&f=1", "display_name": "Terry Pang", "link": "https://stackoverflow.com/users/8652703/terry-pang"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1512519233, "post_id": 47645808, "comment_id": 82288849, "body": "@zerkms yes, found in <code>runtime.selectgo</code>, indeed it check each case by the  sort result using<code>fastrand</code>."}], "answers": [{"tags": [], "owner": {"reputation": 12494, "user_id": 1402929, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/IORgE.jpg?s=128&g=1", "display_name": "Matt Harrison", "link": "https://stackoverflow.com/users/1402929/matt-harrison"}, "is_accepted": false, "score": 2, "last_activity_date": 1512448866, "creation_date": 1512448866, "answer_id": 47646216, "question_id": 47645808, "link": "https://stackoverflow.com/questions/47645808/how-does-select-work-when-multiple-channels-are-involved/47646216#47646216", "title": "How does select work when multiple channels are involved?", "body": "<p>As mentioned in the comment, if you want to ensure balance, you can just forgo using <code>select</code> altogether in the reading goroutine and rely on the synchronisation provided by unbuffered channels:</p>\n\n<pre><code>go func() {\n    for {\n        &lt;-chana\n        acount++\n        &lt;-chanb\n        bcount++\n\n        if acount == 1000 || bcount == 1000 {\n            fmt.Println(\"finish one acount, bcount\", acount, bcount)\n            break\n        }\n    }\n    wg.Done()\n}()\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1512497370, "post_id": 47647227, "comment_id": 82278887, "body": "Virtual machines often have 1 VCPU assigned which results in <code>GOMAXPROCS</code> defaulting to 1, which would explain the &quot;one-sided&quot; effect you experienced. You can verify it with the <code>fmt.Println(runtime.GOMAXPROCS(0))</code> code."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1512532210, "post_id": 47647227, "comment_id": 82292103, "body": "Ok. I tried with above code. Actually, I have 2 VCPU&#39;s allocated. It does look one-sided still on my system. These are the numbers for acount, bcount : 19 1000, 243 1000, 1000 1, 1000 38, 1000 635, 262 1000, 1 1000, 1000 51, 1 1000, 1000 98, 1 1000, 245 1000, 1 1000"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1512549120, "post_id": 47647227, "comment_id": 82298507, "body": "Since there are 3 goroutines working in the example (2 producers and 1 consumer), as long as available CPUs are less than 3, the side effect can be explained with the same reasoning. In my example I had 4 CPUs, so this was not experienced."}], "tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": false, "score": 0, "last_activity_date": 1512474074, "last_edit_date": 1512474074, "creation_date": 1512454688, "answer_id": 47647227, "question_id": 47645808, "link": "https://stackoverflow.com/questions/47645808/how-does-select-work-when-multiple-channels-are-involved/47647227#47647227", "title": "How does select work when multiple channels are involved?", "body": "<p><strong>Edited</strong> : You can balance from the supply side too, but @icza's answer seems to be a better option to me than this &amp; also explains scheduling which was causing this in the first place. Surprisingly it was one-sided even on my (virtual) machine.</p>\n\n<p>Here's something which can balance two routines from the supply side (somehow doesn't seem to work on Playground). </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    _ \"net/http/pprof\"\n    \"sync\"\n    \"sync/atomic\"\n    \"time\"\n)\n\nfunc main() {\n    chana := make(chan int)\n    chanb := make(chan int)\n    var balanceSwitch int32\n\n    go func() {\n        for i := 0; i &lt; 1000; i++ {\n            for atomic.LoadInt32(&amp;balanceSwitch) != 0 {\n                fmt.Println(\"Holding R1\")\n                time.Sleep(time.Nanosecond * 1)\n            }\n            chana &lt;- 100 * i\n            fmt.Println(\"R1: Sent i\", i)\n            atomic.StoreInt32(&amp;balanceSwitch, 1)\n\n        }\n    }()\n\n    go func() {\n        for i := 0; i &lt; 1000; i++ {\n\n            for atomic.LoadInt32(&amp;balanceSwitch) != 1 {\n                fmt.Println(\"Holding R2\")\n                time.Sleep(time.Nanosecond * 1)\n            }\n            chanb &lt;- i\n            fmt.Println(\"R2: Sent i\", i)\n            atomic.StoreInt32(&amp;balanceSwitch, 0)\n\n        }\n    }()\n\n    time.Sleep(time.Microsecond * 300)\n\n    acount := 0\n    bcount := 0\n    wg := sync.WaitGroup{}\n    wg.Add(1)\n    go func() {\n        for {\n            select {\n            case &lt;-chana:\n                acount++\n            case &lt;-chanb:\n                bcount++\n            }\n            fmt.Println(\"Acount Bcount\", acount, bcount)\n            if acount == 1000 || bcount == 1000 {\n                fmt.Println(\"finish one acount, bcount\", acount, bcount)\n                break\n            }\n        }\n        wg.Done()\n    }()\n\n    wg.Wait()\n}\n</code></pre>\n\n<p>By changing <code>atomic.LoadInt32(&amp;balanceSwitch) != XX</code> and <code>atomic.StoreInt32(&amp;balanceSwitch, X)</code>, or other mechanisms you can map it to any number of routines. It may not be the best thing to do, but if that's a requirement then you may have to consider such options. Hope this helps.</p>\n"}, {"comments": [{"owner": {"reputation": 591, "user_id": 4988345, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2517afc431338fa4835c9b0643db73a6?s=128&d=identicon&r=PG&f=1", "display_name": "aiguy", "link": "https://stackoverflow.com/users/4988345/aiguy"}, "edited": false, "score": 0, "creation_date": 1536625274, "post_id": 47648910, "comment_id": 91481960, "body": "wouldnt your example with equal priority waste more CPU time doing empty iterations of <code>for{}</code> loop with more sparsity in data going through the channels? So basically one goroutine would always use one CPU to 1) check chana - empty 2) select default 3) check chanb - empty 4) select default 5) evaluate if - false. Over and over instead of sharing that CPU with other goroutines to do useful work?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 591, "user_id": 4988345, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2517afc431338fa4835c9b0643db73a6?s=128&d=identicon&r=PG&f=1", "display_name": "aiguy", "link": "https://stackoverflow.com/users/4988345/aiguy"}, "edited": false, "score": 0, "creation_date": 1536646408, "post_id": 47648910, "comment_id": 91486657, "body": "@aiguy Nice catch! You&#39;re right, thanks for pointing that out. I added a solution for that case as well. See edited answer."}, {"owner": {"reputation": 15500, "user_id": 8486518, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QUM0SNPJsXo/AAAAAAAAAAI/AAAAAAAAABU/3rAlBsd0Qlg/photo.jpg?sz=128", "display_name": "M\u1ea1nh Quy\u1ebft Nguy\u1ec5n", "link": "https://stackoverflow.com/users/8486518/m%e1%ba%a1nh-quy%e1%ba%bft-nguy%e1%bb%85n"}, "edited": false, "score": 0, "creation_date": 1560399832, "post_id": 47648910, "comment_id": 99724840, "body": "@icza if I select from 2 channels <code>ch1</code>, <code>ch2</code> and both has elements to read at the same time. The go routine will pick one case to execute, say <code>ch2</code>. My question is: Will the available element from <code>ch1</code> be pulled out or not?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 15500, "user_id": 8486518, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QUM0SNPJsXo/AAAAAAAAAAI/AAAAAAAAABU/3rAlBsd0Qlg/photo.jpg?sz=128", "display_name": "M\u1ea1nh Quy\u1ebft Nguy\u1ec5n", "link": "https://stackoverflow.com/users/8486518/m%e1%ba%a1nh-quy%e1%ba%bft-nguy%e1%bb%85n"}, "edited": false, "score": 0, "creation_date": 1560403633, "post_id": 47648910, "comment_id": 99725810, "body": "@M\u1ea1nhQuy\u1ebftNguy\u1ec5n No, it won&#39;t be, only the chosen communication op is executed."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 22, "last_activity_date": 1536646376, "last_edit_date": 1536646376, "creation_date": 1512461767, "answer_id": 47648910, "question_id": 47645808, "link": "https://stackoverflow.com/questions/47645808/how-does-select-work-when-multiple-channels-are-involved/47648910#47648910", "title": "How does select work when multiple channels are involved?", "body": "<p>The Go <a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"noreferrer\"><code>select</code></a> statement is not biased toward any (ready) cases. Quoting from the spec:</p>\n\n<blockquote>\n  <p>If one or more of the communications can proceed, a single one that can proceed is chosen via a <strong>uniform pseudo-random selection</strong>. Otherwise, if there is a default case, that case is chosen. If there is no default case, the \"select\" statement blocks until at least one of the communications can proceed.</p>\n</blockquote>\n\n<p>If multiple communications can proceed, one is selected randomly. This is not a perfect random distribution, and the spec does not guarantee that, but it's random.</p>\n\n<p>What you experience is the result of the Go Playground having <code>GOMAXPROCS=1</code> (<a href=\"https://play.golang.org/p/GIIyXQb643\" rel=\"noreferrer\">which you can verify here</a>) and the goroutine scheduler not being preemptive. What this means is that by default goroutines are not executed parallel. A goroutine is put in park if a blocking operation is encountered (e.g. reading from the network, or attempting to receive from or send on a channel that is blocking), and another one ready to run continues.</p>\n\n<p>And since there is no blocking operation in your code, goroutines may not be put in park and it may be only one of your \"producer\" goroutines will run, and the other may not get scheduled (ever).</p>\n\n<p>Running your code on my local computer where <code>GOMAXPROCS=4</code>, I have very \"realistic\" results. Running it a few times, the output:</p>\n\n<pre><code>finish one acount, bcount 1000 901\nfinish one acount, bcount 1000 335\nfinish one acount, bcount 1000 872\nfinish one acount, bcount 427 1000\n</code></pre>\n\n<p>If you need to prioritize a single case, check out this answer: <a href=\"https://stackoverflow.com/questions/46200343/force-priority-of-go-select-statement/46202533#46202533\">Force priority of go select statement</a></p>\n\n<p>The default behavior of <code>select</code> does not guarantee equal priority, but on average it will be close to it. If you need guaranteed equal priority, then you should not use <code>select</code>, but you could do a sequence of 2 non-blocking receive from the 2 channels, which could look something like this:</p>\n\n<pre><code>for {\n    select {\n    case &lt;-chana:\n        acount++\n    default:\n    }\n    select {\n    case &lt;-chanb:\n        bcount++\n    default:\n    }\n    if acount == 1000 || bcount == 1000 {\n        fmt.Println(\"finish one acount, bcount\", acount, bcount)\n        break\n    }\n}\n</code></pre>\n\n<p>The above 2 non-blocking receive will drain the 2 channels at equal speed (with equal priority) if both supply values, and if one does not, then the other is constantly received from without getting delayed or blocked.</p>\n\n<p>One thing to note about this is that if <em>none</em> of the channels provide any values to receive, this will be basically a \"busy\" loop and hence consume computational power. To avoid this, we may detect that none of the channels were ready, and <em>then</em> use a <code>select</code> statement with both of the receives, which then will block until one of them is ready to receive from, not wasting any CPU resources:</p>\n\n<pre><code>for {\n    received := 0\n    select {\n    case &lt;-chana:\n        acount++\n        received++\n    default:\n    }\n    select {\n    case &lt;-chanb:\n        bcount++\n        received++\n    default:\n    }\n\n    if received == 0 {\n        select {\n        case &lt;-chana:\n            acount++\n        case &lt;-chanb:\n            bcount++\n        }\n    }\n\n    if acount == 1000 || bcount == 1000 {\n        fmt.Println(\"finish one acount, bcount\", acount, bcount)\n        break\n    }\n}\n</code></pre>\n\n<p>For more details about goroutine scheduling, see these questions:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/39245660/number-of-threads-used-by-go-runtime/39246575#39246575\">Number of threads used by Go runtime</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/30073441/goroutines-8kb-and-windows-os-thread-1-mb/30074921#30074921\">Goroutines 8kb and windows OS thread 1 mb</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/28186361/why-does-it-not-create-many-threads-when-many-goroutines-are-blocked-in-writing/28186656#28186656\">Why does it not create many threads when many goroutines are blocked in writing file in golang?</a></p>\n"}], "owner": {"reputation": 319, "user_id": 8652703, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dce90a6950f92d17211799b8bb7eabea?s=128&d=identicon&r=PG&f=1", "display_name": "Terry Pang", "link": "https://stackoverflow.com/users/8652703/terry-pang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13253, "favorite_count": 2, "accepted_answer_id": 47648910, "answer_count": 3, "score": 18, "last_activity_date": 1553602075, "creation_date": 1512445888, "last_edit_date": 1553602075, "question_id": 47645808, "link": "https://stackoverflow.com/questions/47645808/how-does-select-work-when-multiple-channels-are-involved", "title": "How does select work when multiple channels are involved?", "body": "<p>I found when using select on multiple non buffered channels like</p>\n\n<pre><code>select {\ncase &lt;- chana:\ncase &lt;- chanb:\n}\n</code></pre>\n\n<p>Even when both channels have data, but when processing this select,\nthe call that falls in case chana and case chanb is not balanced. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    _ \"net/http/pprof\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    chana := make(chan int)\n    chanb := make(chan int)\n\n    go func() {\n        for i := 0; i &lt; 1000; i++ {\n            chana &lt;- 100 * i\n        }\n    }()\n\n    go func() {\n        for i := 0; i &lt; 1000; i++ {\n            chanb &lt;- i\n        }\n    }()\n\n    time.Sleep(time.Microsecond * 300)\n\n    acount := 0\n    bcount := 0\n    wg := sync.WaitGroup{}\n    wg.Add(1)\n    go func() {\n        for {\n            select {\n            case &lt;-chana:\n                acount++\n            case &lt;-chanb:\n                bcount++\n            }\n            if acount == 1000 || bcount == 1000 {\n                fmt.Println(\"finish one acount, bcount\", acount, bcount)\n                break\n            }\n        }\n        wg.Done()\n    }()\n\n    wg.Wait()\n}\n</code></pre>\n\n<p>Run this demo, when one of the chana,chanb finished read/write, the other may remain 999-1 left.</p>\n\n<p>Is there any method to ensure the balance?</p>\n\n<p>found related topic<br>\n<a href=\"https://stackoverflow.com/questions/19865194/golang-channels-select-statement\">golang-channels-select-statement</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "edited": false, "score": 2, "creation_date": 1512444886, "post_id": 47645647, "comment_id": 82249890, "body": "If this code is in a main() func, then the process exits as soon as it returns,so you need something that waits for a while."}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 1, "creation_date": 1512445279, "post_id": 47645647, "comment_id": 82249985, "body": "Have a look at <code>sync.WaitGroup</code>: <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">golang.org/pkg/sync/#WaitGroup</a>"}, {"owner": {"reputation": 15, "user_id": 2838078, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/34771181bccfbebaeee5256708b2cd6a?s=128&d=identicon&r=PG&f=1", "display_name": "binaryCode", "link": "https://stackoverflow.com/users/2838078/binarycode"}, "edited": false, "score": 0, "creation_date": 1512446274, "post_id": 47645647, "comment_id": 82250247, "body": "superfell, you right this code running in main() func, thank you for your answer, you solve my question...."}], "answers": [{"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": false, "score": 0, "last_activity_date": 1512448684, "creation_date": 1512448684, "answer_id": 47646188, "question_id": 47645647, "link": "https://stackoverflow.com/questions/47645647/golang-channel-wont-receive-messages/47646188#47646188", "title": "Golang Channel Won&#39;t Receive Messages", "body": "<p>Your case works like <a href=\"https://play.golang.org/p/7_4uExK4AC\" rel=\"nofollow noreferrer\">this</a>, though it may appear to work certain times, but it's not guaranteed to always. </p>\n\n<p>Just to add some context, in an unbuffered channel, the sending go routine is blocked as it tries to send a value and a receive is guaranteed to occur before the sending go routine is awakened (in this case the main), so it may seem like a viable option in such cases. But the sending go routine may still exit before the print statement in the receiving go routine is executed. So basically you need to use a synchronization mechanism such that the sending go routine exits only after the work in the receiver is completed.</p>\n\n<p><a href=\"https://play.golang.org/p/xTq0x76WN3\" rel=\"nofollow noreferrer\">Here's</a> how you can use a synchronization mechanism, have annotated it so that you can make better sense out of it. This will work for both buffered and unbuffered channels. <a href=\"https://play.golang.org/p/FXSW8i1Y8H\" rel=\"nofollow noreferrer\">Another option</a> is to have the receive in the main thread itself so that it doesn't exit before receive processing is done, this way you won't need a separate synchronization mechanism. Hope this helps.</p>\n"}, {"tags": [], "owner": {"reputation": 71, "user_id": 2581977, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D7RSt.jpg?s=128&g=1", "display_name": "hao", "link": "https://stackoverflow.com/users/2581977/hao"}, "is_accepted": false, "score": 0, "last_activity_date": 1514186247, "creation_date": 1514186247, "answer_id": 47966535, "question_id": 47645647, "link": "https://stackoverflow.com/questions/47645647/golang-channel-wont-receive-messages/47966535#47966535", "title": "Golang Channel Won&#39;t Receive Messages", "body": "<ol>\n<li><p>You created a channel which has 9 buffer space, which means main routine (r1) will not blocked until the 10th element was ready to send to messages.</p></li>\n<li><p>In your go func() (r2), it most probably starts running when r1 almost finished for r2 is a new routine and system takes time to create stacks etc.  </p></li>\n</ol>\n\n<p>so, r2 doesn't print anything, for r1 is done and program exits while r2 has just begin running.</p>\n"}], "owner": {"reputation": 15, "user_id": 2838078, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/34771181bccfbebaeee5256708b2cd6a?s=128&d=identicon&r=PG&f=1", "display_name": "binaryCode", "link": "https://stackoverflow.com/users/2838078/binarycode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 849, "favorite_count": 1, "answer_count": 2, "score": -2, "last_activity_date": 1514186247, "creation_date": 1512444754, "last_edit_date": 1512445114, "question_id": 47645647, "link": "https://stackoverflow.com/questions/47645647/golang-channel-wont-receive-messages", "title": "Golang Channel Won&#39;t Receive Messages", "body": "<p>I try to explore go channel, i create channel buffer max 10, with gomaxprocess is 2, but i wonder why this code won't receive message</p>\n\n<pre><code>runtime.GOMAXPROCS(2)\nmessages := make(chan int, 9)\n\ngo func() {\n    for {\n        i := &lt;-messages\n        fmt.Println(\"Receive data:\", i)\n    }\n}()\nfor i := 0; i &lt;= 9; i++ {\n    fmt.Println(\"Send data \", i)\n    messages &lt;- i\n}\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1512463845, "post_id": 47645253, "comment_id": 82257075, "body": "I don&#39;t quite understand why closing <code>A&lt;-&gt;rw1</code> can&#39;t be used to terminate the whole chain. I&#39;d modify the code in all the &quot;piping&quot; goroutines in such a way that when <code>io.Copy</code> in them returns <code>io.EOF</code>, they close their other end of the pipe as well so that EOF gets propagated across all the pipeline."}, {"owner": {"reputation": 1161, "user_id": 3917295, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/BFoJm.jpg?s=128&g=1", "display_name": "vinllen", "link": "https://stackoverflow.com/users/3917295/vinllen"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1512464918, "post_id": 47645253, "comment_id": 82257721, "body": "@kostix hi, Kostix, Thanks for your reply. In my understanding, there are two goroutines that serve for the different direction. If <code>A&lt;-&gt;rw1</code> is closed, the second goroutine will exit because <code>rw1</code> receive <code>EOF</code> but the first will not because <code>rw2</code> doesn&#39;t receive <code>EOF</code>. If the <code>sourthConn.Close()</code> isn&#39;t blocking, the first goroutine can exit because the <code>rw2(sourthConn)</code> is closed. But the problem is the <code>sourthConn.Close()</code> is blocking when <code>sourthConn.read()</code> calls which is my guess."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1512483102, "post_id": 47645253, "comment_id": 82269355, "body": "As commented in your <a href=\"https://stackoverflow.com/questions/47586404/how-to-set-timeout-in-os-file-io-read-in-golang\">previous question</a>, you cannot timeout (yet) or close a blocked Read on an <code>*os.File</code>.  Why are you building a telnet connection through an <code>*os.File</code>, and not a network connection?"}, {"owner": {"reputation": 1161, "user_id": 3917295, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/BFoJm.jpg?s=128&g=1", "display_name": "vinllen", "link": "https://stackoverflow.com/users/3917295/vinllen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1512524468, "post_id": 47645253, "comment_id": 82290192, "body": "@JimB It is because I find a <a href=\"https://github.com/kr/pty\" rel=\"nofollow noreferrer\">pty library</a> in GitHub which use <code>*os.File</code> to start <code>os.exec.Command</code>. Do you have any other way to start <code>telnet</code> connection?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1512572087, "post_id": 47645253, "comment_id": 82313264, "body": "Does something like <a href=\"https://godoc.org/github.com/ziutek/telnet\" rel=\"nofollow noreferrer\">godoc.org/github.com/ziutek/telnet</a> suit your needs? Also, if you&#39;re reading the output from an <code>exec.Cmd</code>, then the pipe will be closed when the process terminates and the <code>Read</code> will return, so I&#39;m still not understanding where you need to interrupt a <code>Read</code> call."}], "owner": {"reputation": 1161, "user_id": 3917295, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/BFoJm.jpg?s=128&g=1", "display_name": "vinllen", "link": "https://stackoverflow.com/users/3917295/vinllen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 852, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1512442013, "creation_date": 1512441701, "last_edit_date": 1512442013, "question_id": 47645253, "link": "https://stackoverflow.com/questions/47645253/how-to-close-golang-os-file-when-it-is-blocking-in-reading", "title": "How to close golang os.File when it is blocking in reading?", "body": "<p>I start two goroutines to forward message between two <code>io.ReadWriter</code> where <code>rw1</code> is a TCP connection with type <code>Conn.net</code> and <code>rw2</code> is the type of <code>*os.File</code> which use <code>pty</code> <a href=\"https://github.com/kr/pty\" rel=\"nofollow noreferrer\">library</a> to build telnet connection. Here comes the forwarding code:</p>\n\n<pre><code>func Connection(northConn net.Conn) {\n    // code omit ...        \n\n    transport(northConn, sourthConn)\n\n    // code omit ...\n\n    sourthConn.Close() // close\n}\n\nfunc transport(rw1, rw2 io.ReadWriter) error {\n    errc := make(chan error, 1)\n    go func() {\n        _, err := io.Copy(rw1, rw2)\n        errc &lt;- err\n    }()\n\n    go func() {\n        _, err := io.Copy(rw2, rw1)\n        errc &lt;- err\n    }()\n\n    err := &lt;-errc\n    if err != nil &amp;&amp; err == io.EOF {\n        err = nil\n    }\n    return err\n}\n</code></pre>\n\n<p>The pipeline is \"<code>A</code>&lt;-><code>rw1(northConn)</code>&lt;-><code>rw2(sourthConn)</code>&lt;-><code>telnet server</code>\" where A communicate with rw1 through TCP connection, <code>rw2</code> communicate with telnet server through <code>*os.File</code> read and write. The above two goroutines just forwarding message between <code>rw1</code> and <code>rw2</code>.<br>\nThese two goroutines can be normally closed if sending <code>exit</code> command from <code>A</code> so that connection between <code>rw2</code> and <code>telnet server</code> close firstly and <code>A</code>&lt;-><code>rw1</code> close secondly. But if I shutdown the A terminal which means sending <code>EOF</code> to <code>rw1</code> only, the <code>A</code>&lt;-><code>rw1</code> connection can be closed while <code>rw2</code>&lt;-><code>telnet server</code> not. The second goroutine can exit normally while the first goroutine is still blocking at <code>io.Copy(rw1, rw2)</code>. And the <code>sourthConn.Close()</code> is blocking too.<br>\nSo my question is how to make the first goroutine exit in this situation and the <code>sourth.Close()</code> run unblocking? I came up with an idea that send <code>exit</code> command in the second goroutine after <code>rw1</code> receive <code>EOF</code> but I don't know whether this is a good method and whether this may bring bugs:</p>\n\n<pre><code>go func() {\n    _, err := io.Copy(rw2, rw1)\n    rw2.Write([]byte(\"exit\\n\")) // add this sentence\n    errc &lt;- err\n}()\n</code></pre>\n\n<p>How can I shutdown the <code>*os.File</code> directly from outside?</p>\n"}, {"tags": ["unix", "go", "unix-socket"], "answers": [{"comments": [{"owner": {"reputation": 50273, "user_id": 167958, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0defa74609a4ce5d51f2467b69c509be?s=128&d=identicon&r=PG", "display_name": "Omnifarious", "link": "https://stackoverflow.com/users/167958/omnifarious"}, "edited": false, "score": 1, "creation_date": 1512438800, "post_id": 47644819, "comment_id": 82248343, "body": "That&#39;s good enough for me. This whole thing I&#39;m working on is extremely Linux specific. I&#39;ve even had to fight a bit to keep it from being x86_64 specific. This UnixRights thing is just the ticket. It should work on anything that implements the Posix API that allows this sort of thing."}, {"owner": {"reputation": 50273, "user_id": 167958, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0defa74609a4ce5d51f2467b69c509be?s=128&d=identicon&r=PG", "display_name": "Omnifarious", "link": "https://stackoverflow.com/users/167958/omnifarious"}, "edited": false, "score": 0, "creation_date": 1512438938, "post_id": 47644819, "comment_id": 82248376, "body": "If you don&#39;t mind, I&#39;m going to edit the real answer into your answer. Who knows if that code you link to will be there forever?"}], "tags": [], "owner": {"reputation": 12494, "user_id": 1402929, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/IORgE.jpg?s=128&g=1", "display_name": "Matt Harrison", "link": "https://stackoverflow.com/users/1402929/matt-harrison"}, "is_accepted": true, "score": 3, "last_activity_date": 1512439846, "last_edit_date": 1512439846, "creation_date": 1512438502, "answer_id": 47644819, "question_id": 47644667, "link": "https://stackoverflow.com/questions/47644667/is-it-possible-to-use-go-to-send-and-receive-file-descriptors-over-unix-domain-s/47644819#47644819", "title": "Is it possible to use Go to send and receive file descriptors over Unix domain sockets?", "body": "<p>There's a package that does it here: <a href=\"https://github.com/ftrvxmtrx/fd/blob/master/fd.go\" rel=\"nofollow noreferrer\">https://github.com/ftrvxmtrx/fd/blob/master/fd.go</a>. However that's using the Syscall package to achieve it. I'm not sure if there's a way to do this with Go standard library API.</p>\n\n<p>In the <code>syscall</code> package, the things to look at are <code>UnixRights</code>, <code>ParseUnixRights</code>, and <code>ParseSocketControlMessage</code>. These can be used in conjunction with <code>Readmsg</code> and <code>Sendmsg</code> to send file descriptors over AF_UNIX sockets.</p>\n\n<p>The basic structure goes something like this for receiving:</p>\n\n<pre><code>buf := make([]byte, syscall.CmsgSpace(&lt;number of file descriptors expected&gt; * 4))\n_, _, _, _, err = syscall.Recvmsg(socket, nil, buf, 0)\nif err != nil {\n    panic(err)\n}\nvar msgs []syscall.SocketControlMessage\nmsgs, err = syscall.ParseSocketControlMessage(buf)\nvar allfds []int\nfor i := 0, i &lt; len(msgs) &amp;&amp; err == null; i++ {\n    var msgfds []int\n    msgfds, err = syscall.ParseUnixRights(&amp;msgs[i])\n    append(allfds, msgfds...)\n}\n</code></pre>\n\n<p>And for sending, it's much simpler (<code>var fds []int</code>):</p>\n\n<pre><code>rights := syscall.UnixRights(fds...)\nerr := syscall.Sendmsg(socket, nil, rights, nil, 0)\n</code></pre>\n"}], "owner": {"reputation": 50273, "user_id": 167958, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0defa74609a4ce5d51f2467b69c509be?s=128&d=identicon&r=PG", "display_name": "Omnifarious", "link": "https://stackoverflow.com/users/167958/omnifarious"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1557, "favorite_count": 0, "accepted_answer_id": 47644819, "answer_count": 1, "score": 1, "last_activity_date": 1512439846, "creation_date": 1512437302, "last_edit_date": 1512438416, "question_id": 47644667, "link": "https://stackoverflow.com/questions/47644667/is-it-possible-to-use-go-to-send-and-receive-file-descriptors-over-unix-domain-s", "title": "Is it possible to use Go to send and receive file descriptors over Unix domain sockets?", "body": "<p>In the <code>unix(7)</code> man page for Unix domain sockets, it says that <code>sendmsg</code> can be used with the <code>SCM_RIGHTS</code> flag to send file descriptors over these sockets. Is this supported in Go? Is there any good example code out there showing how it's done?</p>\n\n<p>It appears that there is a <a href=\"https://golang.org/pkg/syscall/#Msghdr\" rel=\"nofollow noreferrer\"><code>Msghdr</code> structure</a> declared in the <code>syscall</code> package. But no functions take it. Maybe I have to use the raw system call interface?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 4564727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c45f88d5fa2da325b3774f84f5ef74e?s=128&d=identicon&r=PG&f=1", "display_name": "Ramil", "link": "https://stackoverflow.com/users/4564727/ramil"}, "edited": false, "score": 0, "creation_date": 1512584904, "post_id": 47643772, "comment_id": 82321330, "body": "Thanks. This seems the right answer. I&#39;ve looked at the Execute method in the documentation and it&#39;s expecting a Writer. I&#39;ll accept this."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1512430767, "creation_date": 1512430767, "answer_id": 47643772, "question_id": 47643704, "link": "https://stackoverflow.com/questions/47643704/how-to-display-html-table-using-golang-template/47643772#47643772", "title": "How to Display HTML Table Using Golang Template", "body": "<p>Execute the template to a <a href=\"https://godoc.org/bytes#Buffer\" rel=\"nofollow noreferrer\">bytes.Buffer</a>.  Use the contents of the buffer as the body.</p>\n\n<pre><code>t := template.Must(template.New(\"\").Parse(`&lt;table&gt;{{range .}}&lt;tr&gt;&lt;td&gt;{{.}}&lt;/td&gt;&lt;/tr&gt;{{end}}&lt;/table&gt;`))\n\nvar body bytes.Buffer\nif err := t.Execute(&amp;body, persons); err != nil {\n   log.Fatal(err)\n}\ntitle := \"User Info Page\"\np := &amp;Page{Title: title, Body: body.Bytes()}\nrenderTemplate(w, \"view\", p)\n</code></pre>\n\n<p>If it's also a requirement to print to stdout, then add the following code after executing the template:</p>\n\n<pre><code>os.Stdout.Write(body.Bytes())\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 4564727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c45f88d5fa2da325b3774f84f5ef74e?s=128&d=identicon&r=PG&f=1", "display_name": "Ramil", "link": "https://stackoverflow.com/users/4564727/ramil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2987, "favorite_count": 0, "accepted_answer_id": 47643772, "answer_count": 1, "score": 1, "last_activity_date": 1512430767, "creation_date": 1512430341, "question_id": 47643704, "link": "https://stackoverflow.com/questions/47643704/how-to-display-html-table-using-golang-template", "title": "How to Display HTML Table Using Golang Template", "body": "<p>I am trying to use html/template package to display a table of information in a web page in Golang. The current implementation of the template I have outputs to standard out. </p>\n\n<p>I want to be able to pass the page content generated by the template to another function that will render my web page. </p>\n\n<p>How to achieve this? </p>\n\n<p>Explanation of code attached below. Basically, I want to capture the result of t.Execute(os.Stdout, persons) where persons is a slice of string. I know that t.Execute only returns an error. But it prints to standard out the template t along with the person name values. I wanted to capture the combined template and person array texts into a variable instead. I would like to assign the content to the body variable in my code below.</p>\n\n<pre><code>    t := template.Must(template.New(\"\").Parse(`&lt;table&gt;{{range .}}&lt;tr&gt;&lt;td&gt;{{.}}&lt;/td&gt;&lt;/tr&gt;{{end}}&lt;/table&gt;`))\n\n    if err := t.Execute(os.Stdout, persons); err != nil {\n       log.Fatal(err)\n    }\n    title := \"User Info Page\"\n    p := &amp;Page{Title: title, Body: []byte(body)}\n    renderTemplate(w, \"view\", p)\n}\n</code></pre>\n"}, {"tags": ["go", "mocking"], "answers": [{"comments": [{"owner": {"reputation": 36140, "user_id": 6463558, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/g22sX.jpg?s=128&g=1", "display_name": "slideshowp2", "link": "https://stackoverflow.com/users/6463558/slideshowp2"}, "edited": false, "score": 0, "creation_date": 1590555717, "post_id": 47643967, "comment_id": 109719694, "body": "So, the core idea is to use dependency injection?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 36140, "user_id": 6463558, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/g22sX.jpg?s=128&g=1", "display_name": "slideshowp2", "link": "https://stackoverflow.com/users/6463558/slideshowp2"}, "edited": false, "score": 1, "creation_date": 1590556362, "post_id": 47643967, "comment_id": 109719886, "body": "@slideshowp2 I wouldn&#39;t call it the <i>core</i> idea but yes, in my understanding, it is an important part of the equation."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 15, "last_activity_date": 1512433150, "last_edit_date": 1512433150, "creation_date": 1512431990, "answer_id": 47643967, "question_id": 47643192, "link": "https://stackoverflow.com/questions/47643192/how-to-mock-functions-in-golang/47643967#47643967", "title": "How to mock functions in golang", "body": "<p>In Go you cannot mock a function declaration, same with method declarations on a concrete type, you cannot mock those.</p>\n\n<p>For example:</p>\n\n<pre><code>func F()\n\nfunc (T) M()\n</code></pre>\n\n<p><code>F</code> and <code>M</code> are not mockable in Go.</p>\n\n<hr>\n\n<p>However you can mock function values, whether they are variables, fields on a struct, or parameters passed to other functions.</p>\n\n<p>For example:</p>\n\n<pre><code>var Fn = func() { ... }\n\ntype S struct {\n    Fn func()\n}\n\nfunc F(Fn func())\n</code></pre>\n\n<p><code>Fn</code> in all three cases is mockable.</p>\n\n<hr>\n\n<p>The other thing that you can mock in Go, and the prefered option most of the time, is an <code>interface</code>.</p>\n\n<p>For example:</p>\n\n<pre><code>type ProductRepository interface {\n    GetProductById(DB *sql.DB, ID int) (p Product, err error)\n}\n\n// the real implementater of the interface\ntype ProductStore struct{}\n\nfunc (ProductStore) GetProductById(DB *sql.DB, ID int) (p Product, err error) {\n    q := \"SELECT * FROM product WHERE id = \" + ID\n    // ...\n}\n\n// the mock implementer\ntype ProductRepositoryMock struct {}\n\nfunc (ProductRepositoryMock) GetProductById(DB *sql.DB, ID int) (p Product, err error) {\n    // ...\n}\n</code></pre>\n\n<p>Now any piece of code that depends on <code>ProductRepository</code> can be passed a value of type <code>ProductStore</code> when you're in \"normal mode\" and a value of type <code>ProductRepositoryMock</code> when you're testing.</p>\n\n<hr>\n\n<p>Another option using <code>interface</code>s, which allows you to keep your functions <em>mostly</em> unchaged is to define an interface that mimics the methods of <code>*sql.DB</code> then use that interface type as the type to be passed to your functions, implement a mock version of that interface and use that during testing.</p>\n\n<p>For example:</p>\n\n<pre><code>type DBIface interface {\n    Query(query string, args ...interface{}) (*sql.Rows, error)\n    // ...\n    // It's enough to implement only those methods that\n    // the functions that depend on DBIface actually use.\n    // If none of your functions ever calls SetConnMaxLifetime\n    // you don't need to declare that method on the DBIface type.\n}\n\ntype DBMock struct {}\n\nfunc (DBMock) Query(query string, args ...interface{}) (*sql.Rows, error) {\n    // ...\n}\n\nfunc GetProductByName(DB DBIface, name string) (p Product, err error) {\n   ...\n}\n</code></pre>\n\n<p><code>DB</code> parameter to <code>GetProductByName</code> is now mockable.</p>\n"}], "owner": {"reputation": 443, "user_id": 948383, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/40d0367c1bec78fc750f133415c7eff0?s=128&d=identicon&r=PG", "display_name": "madshov", "link": "https://stackoverflow.com/users/948383/madshov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7275, "favorite_count": 3, "accepted_answer_id": 47643967, "answer_count": 1, "score": 3, "last_activity_date": 1512433150, "creation_date": 1512427375, "question_id": 47643192, "link": "https://stackoverflow.com/questions/47643192/how-to-mock-functions-in-golang", "title": "How to mock functions in golang", "body": "<p>I have written a simple package, which basically consists of a lot of getter functions. Each file in this package corresponds to a service, so for instance the product file, contains functions relating to the product service/db, order file to order service etc. Each function takes as parameters a db resource to the underlying db, and parameters for the sql, eg. productid, name, orderid. Each of the functions returns a struct (eg. Order, product) or an error:</p>\n\n<pre><code>// product.go\n\npackage lib\n\ntype Product struct {\n   ID int\n   Name string\n   Price float\n}\n\nfunc GetProductById(DB *sql.DB, ID int) (p Product, err error) {\n   q := \"SELECT * FROM product WHERE id = \" + ID\n   ...\n}\n\nfunc GetProductByName(DB *sql.DB, name string) (p Product, err error) {\n   ...\n}\n\n// order.go\n\npackage lib\n\ntype Order struct {\n   ID int\n   Date string\n   Items []items\n}\n\nfunc GetOrderById(DB *sql.DB, ID int) (o Order, err error) {\n   ...\n}\n</code></pre>\n\n<p>The problem is that I'm not able to mock these functions from my main package. What I really like to do, is to rewrite the package, so I somehow can pass to function to a type instead. But I'm not sure how to do this. Especially not when the functions take different input parameters and return different structs. Is there a way to do this?</p>\n"}, {"tags": ["go", "url-redirection"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1512426946, "creation_date": 1512426946, "answer_id": 47643112, "question_id": 47643065, "link": "https://stackoverflow.com/questions/47643065/go-http-redirection-securely/47643112#47643112", "title": "Go http redirection securely", "body": "<p>The http.Redirect function writes a complete response. The program continues to execute after the call to http.Redirect. If the call to http.Redirect is not the last line of the function, then it is typical for applications to return from the handler immediately after the call.</p>\n\n<pre><code>func serveFoo(w http.ResponseWriter, r *http.Request) {\n   ...\n      http.Redirect(w, r, \"/somewhere\", 302)\n      return\n   ...\n\n} \n</code></pre>\n"}], "owner": {"reputation": 187, "user_id": 5169717, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4552faa86f3364cafc2fe9f1e3b1e337?s=128&d=identicon&r=PG&f=1", "display_name": "v8rs", "link": "https://stackoverflow.com/users/5169717/v8rs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "accepted_answer_id": 47643112, "answer_count": 1, "score": 0, "last_activity_date": 1512426946, "creation_date": 1512426688, "last_edit_date": 1512426929, "question_id": 47643065, "link": "https://stackoverflow.com/questions/47643065/go-http-redirection-securely", "title": "Go http redirection securely", "body": "<p>I know that in a PHP web app if you redirect using header('Location: <a href=\"http://somewhere.com\" rel=\"nofollow noreferrer\">http://somewhere.com</a>') but you don't die() / exit(), the code after the header function is always executed and displayed. I would like to know if when using http.Redirect(w, r, \"/somewhere\", 302) in Go happens the same. And if yes how could avoid it.</p>\n"}, {"tags": ["go", "time"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1512423431, "post_id": 47642359, "comment_id": 82243249, "body": "Go&#39;s time representation is always int64 nanoseconds."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1512423641, "post_id": 47642359, "comment_id": 82243360, "body": "For implementation details see <a href=\"https://golang.org/src/time/time.go?s=5813:6814#L106\" rel=\"nofollow noreferrer\">golang.org/src/time/time.go?s=5813:6814#L106</a>"}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1512423766, "post_id": 47642359, "comment_id": 82243419, "body": "Are you working with time zones? If not, there are many ways to ignore the 32 bit time limitation. If you are, there are still ways to ignore the 32 bit time limitation such as <a href=\"https://github.com/evalEmpire/y2038\" rel=\"nofollow noreferrer\">my y2038 library for C</a>. Most modern programming languages do not have the Year 2038 problem... unless the program is actually running in 2038 on a machine with a 32 bit clock."}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 2, "creation_date": 1512426750, "post_id": 47642359, "comment_id": 82244805, "body": "Go supports int64 on 32 bit platforms, see <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/mtnn-01Dh_I\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 1, "creation_date": 1512427374, "post_id": 47642359, "comment_id": 82245038, "body": "Are you asking this because you want your code to still be able to run on a machine with a 32 bit hardware clock in 2038? Or are you concerned about 32-bit date math issues prior to 2038?"}], "answers": [{"tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": false, "score": 3, "last_activity_date": 1512433375, "last_edit_date": 1512433375, "creation_date": 1512425020, "answer_id": 47642725, "question_id": 47642359, "link": "https://stackoverflow.com/questions/47642359/length-of-time-representation-in-go/47642725#47642725", "title": "Length of time representation in Go", "body": "<p>If you really want to find the size of <code>time_t</code>, you can use <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\"><code>cgo</code></a> to link to <code>time.h</code>. Then the sizeof <code>time_t</code> will be available as <code>C.sizeof_time_t</code>. It doesn't get much simpler.</p>\n\n<pre><code>package main\n\n// #include &lt;time.h&gt;\nimport \"C\"\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(C.sizeof_time_t);\n}\n</code></pre>\n\n<p>Other than trying to set the system time to increasingly distant dates, which is not very polite to anything else running on that system, I don't know of any way to directly query the limits of the hardware clock in a portable fashion in any programming language. C simply hard codes the size of <code>time_t</code> in a file provided by the operating system (on OS X it's <code>/usr/include/i386/_types.h</code>), so you're probably best off taking advantage of that information by querying the size of <code>time_t</code> via <code>cgo</code>.</p>\n\n<p>But there's very few reasons to do this. Go does not use <code>time_t</code> and does not appear to suffer from 2038 issues unless you actually plan to have code running on a 32-bit machine in 2038. If that's your plan, I'd suggest finding a better plan.</p>\n\n<hr>\n\n<blockquote>\n  <p><em>I presume Go time is not magic and will wrap in 2038 on a platform with a 32-bit time_t. If this is false and it is somehow always 64-bit, clue me in because that will prevent much grief.</em></p>\n</blockquote>\n\n<p>Most of the the Year 2038 Problem is programs assuming that the time since 1970 will fit in a 32-bit signed integer. This effects time and date functions, as well as network and data formats which choose to represent time as a 32-bit signed integer since 1970. This is not some hardware limit (except if it's actually 2038, see below), but rather a design limitation of older programming languages and protocols. There's nothing stopping you from using 64 bit integers to represent time, or choosing a different epoch. And that's exactly what newer programming languages do, no magic required.</p>\n\n<p>Go was first released in 2009 long after issues such as Unicode, concurrency, and 32-bit time (ie. the <a href=\"https://en.wikipedia.org/wiki/Year_2038_problem\" rel=\"nofollow noreferrer\">Year 2038 Problem</a>) were acknowledged as issues any programming language would have to tackle. Given how many issues there are with C's time library, I highly doubt that Go is using it at all. <a href=\"https://github.com/golang/go/blob/master/src/time/time.go\" rel=\"nofollow noreferrer\">A quick skim of the source code confirms</a>.</p>\n\n<hr>\n\n<p>While I can't find any explicit mention in the Go documentation of the limits of its <code>Time</code> representation, it appears to be completely disconnected from C's <code>time.h</code> structures such as <code>time_t</code>. Since <code>Time</code> uses 64 bit integers, it seems to be clear of 2038 problems unless you're asking for actual clock time.</p>\n\n<p>Digging into <a href=\"https://golang.org/pkg/time/#Time\" rel=\"nofollow noreferrer\">the Go docs for <code>Time</code></a> we find their 0 is well outside the range of a 32-bit <code>time_t</code> which ranges from 1901 to 2038.</p>\n\n<blockquote>\n  <p>The zero value of type Time is January 1, year 1, 00:00:00.000000000 UTC</p>\n</blockquote>\n\n<p><a href=\"https://golang.org/pkg/time/#Unix\" rel=\"nofollow noreferrer\"><code>time.Unix</code></a> takes seconds and nanoseconds as 64 bit integers leaving no doubt that it is divorced from the size of <code>time_t</code>.</p>\n\n<p><a href=\"https://golang.org/pkg/time/#Parse\" rel=\"nofollow noreferrer\"><code>time.Parse</code></a> will parse a year \"<em>in the range 0000..9999</em>\", again well outside the range of a 32-bit <code>time_t</code>.</p>\n\n<p>And so on. The only limitation I could find is that a <a href=\"https://golang.org/pkg/time/#Duration\" rel=\"nofollow noreferrer\">Duration</a> is limited to 290 years because it has a nanosecond accuracy and 290 years is about 63 bits worth of nanoseconds.</p>\n\n<p>Of course, you should test your code on a machine with a 32-bit <code>time_t</code>.</p>\n\n<hr>\n\n<p>One side issue of the 2038 Problem is time zones. Computers calculate time zone information from a time zone database, usually <a href=\"https://en.wikipedia.org/wiki/Tz_database\" rel=\"nofollow noreferrer\">the IANA time zone database</a>. This allows one to get the time offset for a certain location at a certain time.</p>\n\n<p>Computers have their own copy of the time zone database installed. Unfortunately its difficult to know where they are located or when they were last updated. To avoid this issue, most programming languages supply their own copy of the time zone database. <a href=\"https://github.com/golang/go/tree/master/lib/time\" rel=\"nofollow noreferrer\">Go does as well</a>.</p>\n\n<hr>\n\n<p>The only real limitation on a machine with 32-bit time is the limits of its hardware clock. This tells the software what time it is <em>right now</em>. A 32-bit clock only becomes an issue if your program is still running on a 32-bit machine in 2038. There isn't much point to mitigating that because <strong><em>everything</em></strong> on that machine will have the same problem and its unlikely they took it into account. You're better off decommissioning that hardware before 2038.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1512427901, "last_edit_date": 1512427901, "creation_date": 1512425647, "answer_id": 47642854, "question_id": 47642359, "link": "https://stackoverflow.com/questions/47642359/length-of-time-representation-in-go/47642854#47642854", "title": "Length of time representation in Go", "body": "<p>Ordinarily, <code>time.Time</code> uses 63 bits to represent wall clock seconds elapsed since January 1, year 1 00:00:00 UTC, up through 219250468-12-04 15:30:09.147483647 +0000 UTC. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    var t time.Time\n    fmt.Println(t)\n    t = time.Unix(1&lt;&lt;63-1, 1&lt;&lt;31-1)\n    fmt.Println(t)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/QPs1m6eMPH\" rel=\"nofollow noreferrer\">https://play.golang.org/p/QPs1m6eMPH</a></p>\n\n<p>Output:</p>\n\n<pre><code>0001-01-01 00:00:00 +0000 UTC\n219250468-12-04 15:30:09.147483647 +0000 UTC\n</code></pre>\n\n<p>If <code>time.Time</code> is monotonic (derived from <code>time.Now()</code>), <code>time.Time</code> uses 33 bits to represent wall clock seconds, covering the years 1885 through 2157.</p>\n\n<p>References:</p>\n\n<p><a href=\"https://golang.org/pkg/time/\" rel=\"nofollow noreferrer\">Package time</a></p>\n\n<p><a href=\"https://github.com/golang/proposal/blob/master/design/12914-monotonic.md\" rel=\"nofollow noreferrer\">Proposal: Monotonic Elapsed Time Measurements in Go</a></p>\n"}], "owner": {"reputation": 97, "user_id": 3695609, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/B4gHm.png?s=128&g=1", "display_name": "ESR", "link": "https://stackoverflow.com/users/3695609/esr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 808, "favorite_count": 2, "answer_count": 2, "score": 3, "last_activity_date": 1512433375, "creation_date": 1512423347, "question_id": 47642359, "link": "https://stackoverflow.com/questions/47642359/length-of-time-representation-in-go", "title": "Length of time representation in Go", "body": "<p>Under Unix, I'm working on a program that needs to behave differently depending on whether time is 32-bit (will wrap in 2038) or 64-bit.</p>\n\n<p>I presume Go time is not magic and will wrap in 2038 on a platform with a 32-bit time_t.  If this is false and it is somehow always 64-bit, clue me in because that will prevent much grief.</p>\n\n<p>What's the simplest way in Go to write a test for the platform's time_t size?  Is there any way simpler than the obvious hack with cgo?</p>\n"}, {"tags": ["go", "kubernetes", "yaml", "kubernetes-helm"], "comments": [{"owner": {"reputation": 465, "user_id": 1936173, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/8uQ1j.png?s=128&g=1", "display_name": "Illia Danko", "link": "https://stackoverflow.com/users/1936173/illia-danko"}, "edited": false, "score": 0, "creation_date": 1512426343, "post_id": 47642166, "comment_id": 82244632, "body": "Try to insert dash sign into the include clause"}], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 10, "last_activity_date": 1512423857, "creation_date": 1512423857, "answer_id": 47642473, "question_id": 47642166, "link": "https://stackoverflow.com/questions/47642166/helm-extra-newline-when-using-include-for-templating/47642473#47642473", "title": "Helm: Extra newline when using &quot;include&quot; for templating", "body": "<p>You can use a hyphen to suppress the newline on template commands. You're already using it for <code>define</code> and <code>end</code>.</p>\n\n<p>Similarly, you should use <code>{{- include ... -}}</code>.</p>\n"}], "owner": {"reputation": 1693, "user_id": 4487457, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/0ZObm.jpg?s=128&g=1", "display_name": "Minh Mai", "link": "https://stackoverflow.com/users/4487457/minh-mai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5073, "favorite_count": 0, "accepted_answer_id": 47642473, "answer_count": 1, "score": 6, "last_activity_date": 1512423857, "creation_date": 1512422483, "question_id": 47642166, "link": "https://stackoverflow.com/questions/47642166/helm-extra-newline-when-using-include-for-templating", "title": "Helm: Extra newline when using &quot;include&quot; for templating", "body": "<p>I get a weird new line when my chart is rendered that templates from another file using <code>{{ include }}</code>. For instance, my manifest looks like this </p>\n\n<pre><code>      containers:\n      - name: {{ .Release.Name }}\n        image: {{ .Values.global.image}}:{{ .Values.global.imageTag }}\n        imagePullPolicy: {{ .Values.global.pullPolicy }}\n        ports:\n          - containerPort: {{ .Values.gloabl.containerPort }}\n{{ include \"common_deployment\" . }}\n</code></pre>\n\n<p>and my <code>common_deployment</code> is defined as </p>\n\n<pre><code>{{- define \"common_deployment\" }}\n        envFrom:\n          - secretRef:\n              name: {{ .Release.Name }}-secret\n{{- end -}}\n</code></pre>\n\n<p>when I look at my manifest after doing a dry run on Helm, my template looks something like this </p>\n\n<pre><code> containers:\n  - name: test\n    image: myrepo/myimage:latest\n    imagePullPolicy: Always\n    ports:\n      - containerPort: 4444\n\nenvFrom:\n  - secretRef:\n      name: test-secret\n</code></pre>\n\n<p>Notice how there is a new lie between the <code>ports</code> and the <code>envFrom</code>. I'm wondering if this will affect how my pods will turn out because there are issues with volumes being mounted and I want to be able to make sure that this templating problem is the culprit before going down another rabbit hole.</p>\n"}, {"tags": ["go", "ibm-cloud-infrastructure"], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 3729938, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/10d93eb4a8858bdd81a5ad0286d82b41?s=128&d=identicon&r=PG&f=1", "display_name": "Dennis", "link": "https://stackoverflow.com/users/3729938/dennis"}, "edited": false, "score": 0, "creation_date": 1512428319, "post_id": 47642944, "comment_id": 82245414, "body": "I ran the code you provided and although it runs, it does not appear that the mask does anything. Below is a sample entry of what is returned:        {     &quot;accountId&quot;: ####,     &quot;id&quot;: ####,     &quot;modifyDate&quot;: &quot;2017-12-01T05:11:45-06:00&quot;,     &quot;name&quot;: &quot;Name&quot;,     &quot;primarySubnetId&quot;: ####,     &quot;vlanNumber&quot;: ####     } Things that are not specified in the mask (modifyDate) are returned and things that are specified in the mask (primaryRouter) are not returned. If I take out the mask the same data is returned."}, {"owner": {"reputation": 5193, "user_id": 5996587, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/d15f53deb1b5f2cab3534565c91c5394?s=128&d=identicon&r=PG&f=1", "display_name": "codec", "link": "https://stackoverflow.com/users/5996587/codec"}, "edited": false, "score": 0, "creation_date": 1534928395, "post_id": 47642944, "comment_id": 90876570, "body": "Were you able to fix this issue? I am facing the same issue"}], "tags": [], "owner": {"reputation": 531, "user_id": 8249389, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AOh14GjnUtxJUu4YLKUe6DqOvIBISza0fOlIoa6MyJghHY8=k-s128", "display_name": "Fernando Iquiza", "link": "https://stackoverflow.com/users/8249389/fernando-iquiza"}, "is_accepted": false, "score": 0, "last_activity_date": 1512426062, "creation_date": 1512426062, "answer_id": 47642944, "question_id": 47641717, "link": "https://stackoverflow.com/questions/47641717/how-to-add-object-mask-to-call-getnetworkvlans-using-golang/47642944#47642944", "title": "How to add object mask to call GetNetworkVlans using golang", "body": "<p>The reason is that in order to obtain relational data from an object in the API you must declare an object mask in your API call, as far as I can see, it is not declared in your code, it should be something like this:</p>\n\n<pre><code>func getPrivateVlan(env string) (string, error) {\n// 1. Create a session\nsess := session.New(user, pass)\n// 2. Get a service\naccountService := services.GetAccountService(sess)\n\n//declare Mask\nobject_mask := \"id;name;primaryRouter\"\n\n// 3. Invoke a method including the Object mask:\nvlans, err := accountService.Mask(object_mask).GetNetworkVlans()\n\nvlan := vlans[0]\nlog.Println(*vlan.Name)           //works\nlog.Println(*vlan.PrimaryRouter)  //\n}\n</code></pre>\n\n<p>Try the following code for example:</p>\n\n<pre><code>package main\n\nimport (\n\"fmt\"\n\"github.com/softlayer/softlayer-go/services\"\n\"github.com/softlayer/softlayer-go/session\"\n\"encoding/json\"\n)\n\nfunc main() {\n// SoftLayer API username and key\nusername := \"set-me\"\napikey   := \"set-me\"\n\n// Create a session\nsess := session.New(username, apikey)\n\n// Get SoftLayer_Account service\nservice := services.GetAccountService(sess)\n\n// Object-Mask to get specific Vlan's information\nmask := \"id;name;primaryRouter\"\n\n// Call to getNetworkVlans in order to retrieve vlans according to filter.\nresult, err := service.Mask(mask).GetNetworkVlans()\nif err != nil {\n    fmt.Printf(\"\\n Unable to retrieve vlans:\\n - %s\\n\", err)\n    return\n}\n\n// Following helps to print the result in json format.\njsonFormat, jsonErr := json.MarshalIndent(result,\"\",\"     \")\nif jsonErr != nil {\n    fmt.Println(jsonErr)\n    return\n}\nfmt.Println(string(jsonFormat))\n}\n</code></pre>\n\n<p>For more information please see below:</p>\n\n<p><a href=\"https://sldn.softlayer.com/article/object-masks#Property_Set\" rel=\"nofollow noreferrer\">https://sldn.softlayer.com/article/object-masks#Property_Set</a></p>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 3729938, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/10d93eb4a8858bdd81a5ad0286d82b41?s=128&d=identicon&r=PG&f=1", "display_name": "Dennis", "link": "https://stackoverflow.com/users/3729938/dennis"}, "is_accepted": true, "score": 0, "last_activity_date": 1525879393, "creation_date": 1525879393, "answer_id": 50256921, "question_id": 47641717, "link": "https://stackoverflow.com/questions/47641717/how-to-add-object-mask-to-call-getnetworkvlans-using-golang/50256921#50256921", "title": "How to add object mask to call GetNetworkVlans using golang", "body": "<p>source: <a href=\"https://stackoverflow.com/questions/50241215/unable-to-get-itemcategory-info-from-call-getconfiguration-when-called-from-gola\">Unable to get itemCategory info from call GetConfiguration when called from golang</a></p>\n\n<p>F.Ojeda:\nThe default endpoint is REST but in your environment you are using xmlrpc, which is probably due to the existence of the ~ / .softlayer file and in this it is configured as an XMLRPC enpoint.</p>\n\n<p>For more information you can see the following documentation: <a href=\"https://github.com/softlayer/softlayer-go\" rel=\"nofollow noreferrer\">https://github.com/softlayer/softlayer-go</a></p>\n\n<p>This issue happens for the XMLRPC enpoint and you can report it in the go GitHub. <a href=\"https://github.com/softlayer/softlayer-go/issues/\" rel=\"nofollow noreferrer\">https://github.com/softlayer/softlayer-go/issues/</a></p>\n\n<p>Try in your code with the REST endpoint, like this example:</p>\n\n<pre><code>endpoint := \"https://api.softlayer.com/rest/v3\"\n\n// Create a session\nsess := session.New(username, apikey, endpoint)\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 3729938, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/10d93eb4a8858bdd81a5ad0286d82b41?s=128&d=identicon&r=PG&f=1", "display_name": "Dennis", "link": "https://stackoverflow.com/users/3729938/dennis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 0, "accepted_answer_id": 50256921, "answer_count": 2, "score": 0, "last_activity_date": 1525879393, "creation_date": 1512420481, "last_edit_date": 1512421479, "question_id": 47641717, "link": "https://stackoverflow.com/questions/47641717/how-to-add-object-mask-to-call-getnetworkvlans-using-golang", "title": "How to add object mask to call GetNetworkVlans using golang", "body": "<pre><code>func getPrivateVlan(env string) (string, error) {\n// 1. Create a session\nsess := session.New(user, pass)\n// 2. Get a service\naccountService := services.GetAccountService(sess)\n// 3. Invoke a method:\nvlans, err := accountService.GetNetworkVlans()\nvlan := vlans[0]\nlog.Println(*vlan.Name)           //works\nlog.Println(*vlan.PrimaryRouter)  //Doesn't work\n}\n</code></pre>\n\n<p>The object returned is an array of vlans of type SoftLayer_Network_Vlan, <a href=\"https://sldn.softlayer.com/reference/datatypes/softlayer_network_vlan\" rel=\"nofollow noreferrer\">https://sldn.softlayer.com/reference/datatypes/softlayer_network_vlan</a>.\nI am able to access the properties in column \"Local Properties\" (ie Name) but am unable to access the properties in column \"Relational &amp; Count Properties\" (ie PrimaryRouter).\nHow can I add an object mask to my call in order to see these properties?</p>\n"}, {"tags": ["go", "parallel-processing", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1512419896, "post_id": 47641514, "comment_id": 82241549, "body": "You&#39;re waiting for the goroutine before receiving from the channel. You have an unbuffered channel here, so you don&#39;t need the wait group, nor do you need the goroutine at all."}], "answers": [{"comments": [{"owner": {"reputation": 587, "user_id": 5882700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/837d071cb94747474e5d0095af97ff5e?s=128&d=identicon&r=PG&f=1", "display_name": "Lukenzo", "link": "https://stackoverflow.com/users/5882700/lukenzo"}, "edited": false, "score": 0, "creation_date": 1512419997, "post_id": 47641587, "comment_id": 82241600, "body": "Buffering channel solved my problem. How I should change my current code and not use buffered channels?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 587, "user_id": 5882700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/837d071cb94747474e5d0095af97ff5e?s=128&d=identicon&r=PG&f=1", "display_name": "Lukenzo", "link": "https://stackoverflow.com/users/5882700/lukenzo"}, "edited": false, "score": 0, "creation_date": 1512420042, "post_id": 47641587, "comment_id": 82241628, "body": "Another fix is to receive on the channel before calling wg.Wait()."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512420272, "post_id": 47641587, "comment_id": 82241725, "body": "In which case (at least in this example) you don&#39;t need the wait group - you can&#39;t receive on the (unbuffered) channel until the function sends, which is the last thing it does before it returns."}, {"owner": {"reputation": 587, "user_id": 5882700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/837d071cb94747474e5d0095af97ff5e?s=128&d=identicon&r=PG&f=1", "display_name": "Lukenzo", "link": "https://stackoverflow.com/users/5882700/lukenzo"}, "edited": false, "score": 0, "creation_date": 1512420499, "post_id": 47641587, "comment_id": 82241832, "body": "Won&#39;t I need waitGroup if I will call two TestFunc go routines in main?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512421097, "post_id": 47641587, "comment_id": 82242116, "body": "The comment applies to this specific example.  If you receive values from the two goroutines, then there&#39;s probably not a reason to use a goroutine."}, {"owner": {"reputation": 587, "user_id": 5882700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/837d071cb94747474e5d0095af97ff5e?s=128&d=identicon&r=PG&f=1", "display_name": "Lukenzo", "link": "https://stackoverflow.com/users/5882700/lukenzo"}, "edited": false, "score": 0, "creation_date": 1512421434, "post_id": 47641587, "comment_id": 82242276, "body": "@CeriseLim&#243;n, Whati want I want to do is to create a recursive sorting algorithm. It would use go routines to sort two array slices and then merge them. Is this a good approach? I need to do that in parallel."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1512420379, "last_edit_date": 1512420379, "creation_date": 1512419886, "answer_id": 47641587, "question_id": 47641514, "link": "https://stackoverflow.com/questions/47641514/goroutines-deadlock-when-using-channels/47641587#47641587", "title": "goroutines deadlock when using channels", "body": "<p>Communication on the unbuffered channel <code>ch</code> succeeds only when both a sender and receiver are ready.</p>\n\n<p>The main function waits on the wait group before receiving the value.  The goroutine attempts to send on the channel before call wg.Done. It's a deadlock.</p>\n\n<p>One fix is to use a buffered channel:</p>\n\n<pre><code>     ch := make(chan []int, 1)\n</code></pre>\n\n<p>Another fix is to receive on the channel before calling wg.Wait().</p>\n\n<pre><code>result := &lt;-ch\nwg.Wait()\n</code></pre>\n\n<p>Yet another fix is to delete all lines using the wait group. It's not needed in this specific example.</p>\n"}], "owner": {"reputation": 587, "user_id": 5882700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/837d071cb94747474e5d0095af97ff5e?s=128&d=identicon&r=PG&f=1", "display_name": "Lukenzo", "link": "https://stackoverflow.com/users/5882700/lukenzo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 367, "favorite_count": 1, "accepted_answer_id": 47641587, "answer_count": 1, "score": 0, "last_activity_date": 1512420379, "creation_date": 1512419562, "question_id": 47641514, "link": "https://stackoverflow.com/questions/47641514/goroutines-deadlock-when-using-channels", "title": "goroutines deadlock when using channels", "body": "<p>Im new to go lang and I am trying to write a simple recursive algorithm which will use  goroutines. I am using channels to receive output from goroutine, but when I try to do so I receive \"fatal error: all goroutines are asleep - deadlock!\" error. If I comment out channels code everything runs fine.\nThis is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    numbers := []int{2, -1, 10, 4, 3, 6, 22}\n\n    ch := make(chan []int)\n\n    wg := &amp;sync.WaitGroup{}\n    wg.Add(1)\n    go testFunc(numbers, ch, wg)\n    wg.Wait()\n\n    result := &lt;-ch\n\n    fmt.Println(\"Result: \", result)\n}\n\nfunc testFunc(numbers []int, ch chan []int, wg *sync.WaitGroup) {\n    defer wg.Done()\n    ch &lt;- numbers\n}\n</code></pre>\n\n<p>What I am doing wrong  ? I am assigning value to channel in goroutine and reading it in main. Isn't that enough to communicate?</p>\n"}, {"tags": ["go", "timezone", "google-calendar-api", "timezone-offset", "rfc3339"], "comments": [{"owner": {"reputation": 1253974, "user_id": 22656, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6d8ebb117e8d83d74ea95fbdd0f87e13?s=128&d=identicon&r=PG", "display_name": "Jon Skeet", "link": "https://stackoverflow.com/users/22656/jon-skeet"}, "edited": false, "score": 1, "creation_date": 1512419793, "post_id": 47641511, "comment_id": 82241502, "body": "It looks like it&#39;s more broken at the month part than the UTC offset..."}, {"owner": {"reputation": 81, "user_id": 6500168, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/601b94035e1a7a2b6cc2c24f82f8c05e?s=128&d=identicon&r=PG&f=1", "display_name": "Amr Khalil", "link": "https://stackoverflow.com/users/6500168/amr-khalil"}, "reply_to_user": {"reputation": 1253974, "user_id": 22656, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6d8ebb117e8d83d74ea95fbdd0f87e13?s=128&d=identicon&r=PG", "display_name": "Jon Skeet", "link": "https://stackoverflow.com/users/22656/jon-skeet"}, "edited": false, "score": 0, "creation_date": 1512420003, "post_id": 47641511, "comment_id": 82241605, "body": "is it one based of zero-based in the month part"}, {"owner": {"reputation": 1253974, "user_id": 22656, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6d8ebb117e8d83d74ea95fbdd0f87e13?s=128&d=identicon&r=PG", "display_name": "Jon Skeet", "link": "https://stackoverflow.com/users/22656/jon-skeet"}, "edited": false, "score": 3, "creation_date": 1512420103, "post_id": 47641511, "comment_id": 82241654, "body": "It should be 1-based in ISO-8601 format. Basically that looks like a broken date to me."}, {"owner": {"reputation": 81, "user_id": 6500168, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/601b94035e1a7a2b6cc2c24f82f8c05e?s=128&d=identicon&r=PG&f=1", "display_name": "Amr Khalil", "link": "https://stackoverflow.com/users/6500168/amr-khalil"}, "reply_to_user": {"reputation": 1253974, "user_id": 22656, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6d8ebb117e8d83d74ea95fbdd0f87e13?s=128&d=identicon&r=PG", "display_name": "Jon Skeet", "link": "https://stackoverflow.com/users/22656/jon-skeet"}, "edited": false, "score": 0, "creation_date": 1512420165, "post_id": 47641511, "comment_id": 82241686, "body": "ok thanks I thought it was zero based"}], "owner": {"reputation": 81, "user_id": 6500168, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/601b94035e1a7a2b6cc2c24f82f8c05e?s=128&d=identicon&r=PG&f=1", "display_name": "Amr Khalil", "link": "https://stackoverflow.com/users/6500168/amr-khalil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 174, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1512419536, "creation_date": 1512419536, "question_id": 47641511, "link": "https://stackoverflow.com/questions/47641511/timezone-format-err-in-google-calendar-api", "title": "timezone format err in google calendar API", "body": "<pre><code>input = append(input, strings.TrimSpace(sessions[uuid][\"nameStage\"].(string)))\ninput = append(input, strings.TrimSpace(sessions[uuid][\"startDateStage\"].(string))+\"T\"+strings.TrimSpace(sessions[uuid][\"startTimeStage\"].(string))+\"+02:00\")\ninput = append(input, strings.TrimSpace(sessions[uuid][\"endDateStage\"].(string))+\"T\"+strings.TrimSpace(sessions[uuid][\"endTimeStage\"].(string))+\"+02:00\")\n\n\nfunc createEvent(input []string, tok *oauth2.Token) string {\n\n    client := conf.Client(oauth2.NoContext, tok)\n    calendarService, _ := calendar.New(client)\n    event := new(calendar.Event)\n\n    // set calendar values\n\n    event.Summary = input[0]\n    startTime := new(calendar.EventDateTime)\n    startTime.DateTime = input[1]\n    event.Start = startTime\n\n    endTime := new(calendar.EventDateTime)\n    endTime.DateTime = input[2]\n    event.End = endTime\n_, err := calendarService.Events.Insert(\"primary\", event).Do()\n    if err != nil {\n        log.Println(err)\n        return \"Cannot create event\"\n    }\n\n    return \"Done successfully\"\n}\n</code></pre>\n\n<p>this is  a part of my code I use to create event using google calendar API \n.the code is written in go.\nthe code takes the name and the time values from the session and puts it in array and sends it to createEvent\nsometimes the code runs correctly and sometimes it gives me an error</p>\n\n<pre><code>googleapi: Error 400: Invalid value for: Invalid format: \"2018-00-18T22:08:00+02:00\" is malformed at \"+02:00\", invalid\n</code></pre>\n\n<p>I use \"+02:00\" to make timezone Cairo/Egypt</p>\n"}, {"tags": ["go", "websocket"], "comments": [{"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 2, "creation_date": 1512403546, "post_id": 47637308, "comment_id": 82232791, "body": "I haven&#39;t used gorilla or websockets, but you should be able to relax your test constraints, by initializing a server in your test (actually binding through the socket) and then using a test client in another go routine to interact with it.  This will at least allow you to verify your server is functioning using the websocket protocol and through the network stack, but of course doesn&#39;t verify that your server works through chrome.."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "reply_to_user": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1512403632, "post_id": 47637308, "comment_id": 82232839, "body": "@dm03514 - since I new to this topic it will be great if you can provide some example....thanks!"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1512405065, "post_id": 47637670, "comment_id": 82233753, "body": "when I run <code>go tes</code> in the root I got the following error: <code>runtime.main_main&#183;f: relocation target main.main not defined runtime.main_main&#183;f: undefined: &quot;main.main&quot; </code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1512405116, "post_id": 47637670, "comment_id": 82233780, "body": "I just create new golang project with this file and I try to run it...is it OK?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512405256, "post_id": 47637670, "comment_id": 82233875, "body": "In a directory on your GOPATH, save the above to a file named <code>echo_test.go</code>.  From that directory, run the <code>go test</code> command.  If this does not work, then something is wrong with your local Go configuration. See <a href=\"https://golang.org/cmd/go/#hdr-Test_packages\" rel=\"nofollow noreferrer\">the Go documentation for more information about testing</a>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1512405809, "post_id": 47637670, "comment_id": 82234203, "body": "Ok, thanks I did it PASS ok      _/Users/i03333/go/webSocketClient      0.012s How should I check myweb socket program ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1512406138, "post_id": 47637670, "comment_id": 82234429, "body": "My question is how should I run it and it will stops at BP and the websocket code in my previous query <a href=\"https://stackoverflow.com/questions/47635764/run-web-socket-locally-for-debug\" title=\"run web socket locally for debug\">stackoverflow.com/questions/47635764/&hellip;</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512407000, "post_id": 47637670, "comment_id": 82234980, "body": "The code above shows the mechanics of testing a websocket endpoint using an example named echo.  Replace echo with your endpoint.  Replace the read/write loop in the test with whatever is appropriate for your endpoint.  I might be able comment further if you show the code for your ednpoint. Setting breakpoints in a debugger is outside the scope of this question."}, {"owner": {"reputation": 742, "user_id": 601555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81b70354d05caf6bdf7e7953713c1cd4?s=128&d=identicon&r=PG", "display_name": "Ilija Eftimov", "link": "https://stackoverflow.com/users/601555/ilija-eftimov"}, "edited": false, "score": 1, "creation_date": 1583237482, "post_id": 47637670, "comment_id": 107041460, "body": "The solution above works just fine. A tiny improvement I suggest:  I believe it&#39;s more elegant to parse <code>s.URL</code> as a <code>URL</code> struct using <a href=\"https://golang.org/pkg/net/url/#Parse\" rel=\"nofollow noreferrer\"><code>url.Parse</code></a> and then change the scheme of the <code>URL</code> using <code>u.Scheme = &quot;ws&quot;</code>.  Here&#39;s a working example: <a href=\"https://play.golang.org/p/QiOkv8s608s\" rel=\"nofollow noreferrer\">play.golang.org/p/QiOkv8s608s</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 742, "user_id": 601555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81b70354d05caf6bdf7e7953713c1cd4?s=128&d=identicon&r=PG", "display_name": "Ilija Eftimov", "link": "https://stackoverflow.com/users/601555/ilija-eftimov"}, "edited": false, "score": 1, "creation_date": 1583247944, "post_id": 47637670, "comment_id": 107047439, "body": "@IlijaEftimov  The string manipulation code is short, fast and handles both <code>http</code> and <code>https</code>. Although <code>https</code> is not used in this answer, I think it&#39;s important to show a conversion that will work with <code>https</code>.  See <a href=\"https://play.golang.org/p/0WXHNFOptkq\" rel=\"nofollow noreferrer\">play.golang.org/p/0WXHNFOptkq</a> for a more complete conversion based on <code>url.Parse</code>."}, {"owner": {"reputation": 154, "user_id": 8913763, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ICicn.jpg?s=128&g=1", "display_name": "VadimFilin", "link": "https://stackoverflow.com/users/8913763/vadimfilin"}, "edited": false, "score": 0, "creation_date": 1612871824, "post_id": 47637670, "comment_id": 116896309, "body": "Too heavy solution. Need to find the way to mock &quot;websocket.Conn&quot;"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 27, "last_activity_date": 1512404506, "creation_date": 1512404506, "answer_id": 47637670, "question_id": 47637308, "link": "https://stackoverflow.com/questions/47637308/create-unit-test-for-ws-in-golang/47637670#47637670", "title": "create unit test for ws in golang", "body": "<p>Create a <a href=\"https://godoc.org/net/http/httptest#Server\" rel=\"noreferrer\">test server</a> using the <a href=\"https://godoc.org/net/http/httptest\" rel=\"noreferrer\">net/http/httptest</a> package. Connect to that server using the Gorilla client. Read and write messages to test the connection.</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"net/http/httptest\"\n    \"strings\"\n    \"testing\"\n\n    \"github.com/gorilla/websocket\"\n)\n\nvar upgrader = websocket.Upgrader{}\n\nfunc echo(w http.ResponseWriter, r *http.Request) {\n    c, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        return\n    }\n    defer c.Close()\n    for {\n        mt, message, err := c.ReadMessage()\n        if err != nil {\n            break\n        }\n        err = c.WriteMessage(mt, message)\n        if err != nil {\n            break\n        }\n    }\n}\n\nfunc TestExample(t *testing.T) {\n    // Create test server with the echo handler.\n    s := httptest.NewServer(http.HandlerFunc(echo))\n    defer s.Close()\n\n    // Convert http://127.0.0.1 to ws://127.0.0.\n    u := \"ws\" + strings.TrimPrefix(s.URL, \"http\")\n\n    // Connect to the server\n    ws, _, err := websocket.DefaultDialer.Dial(u, nil)\n    if err != nil {\n        t.Fatalf(\"%v\", err)\n    }\n    defer ws.Close()\n\n    // Send message to server, read response and check to see if it's what we expect.\n    for i := 0; i &lt; 10; i++ {\n        if err := ws.WriteMessage(websocket.TextMessage, []byte(\"hello\")); err != nil {\n            t.Fatalf(\"%v\", err)\n        }\n        _, p, err := ws.ReadMessage()\n        if err != nil {\n            t.Fatalf(\"%v\", err)\n        }\n        if string(p) != \"hello\" {\n            t.Fatalf(\"bad message\")\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6361, "favorite_count": 5, "accepted_answer_id": 47637670, "answer_count": 1, "score": 13, "last_activity_date": 1512411458, "creation_date": 1512403341, "last_edit_date": 1512411458, "question_id": 47637308, "link": "https://stackoverflow.com/questions/47637308/create-unit-test-for-ws-in-golang", "title": "create unit test for ws in golang", "body": "<p>I use the gorilla web socket framework and use the following client to run the web socket locally and debug it</p>\n\n<p><a href=\"https://github.com/gorilla/websocket\" rel=\"noreferrer\">https://github.com/gorilla/websocket</a></p>\n\n<pre><code>ws = new WebSocket(\"ws://localhost:8080/mypath\")\nws.onmessage = function(ev) { console.log(ev.data) }\nws.send(\"hello\")\n</code></pre>\n\n<p>This is working when I use it in the chrome console but my question if there is a way to do some unit test in go and avoid using the chrome console?</p>\n"}, {"tags": ["go", "websocket"], "comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1581194275, "post_id": 47635764, "comment_id": 106351505, "body": "here is the golang websocket tutorial which supplies above code and solves this question <a href=\"https://github.com/elliotforbes/tutorialedge.net/blob/master/content/golang/go-websocket-tutorial.md\" rel=\"nofollow noreferrer\">github.com/elliotforbes/tutorialedge.net/blob/master/content&zwnj;&#8203;/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1512400971, "post_id": 47636352, "comment_id": 82231091, "body": "Thanks a lot, I&#39;ve tried it now and I got error, please see my edit, any idea?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 1, "creation_date": 1512401216, "post_id": 47636352, "comment_id": 82231244, "body": "Sorry after second try it works 1+ , is there a way to run it from unit test ? if yes can you provide example please?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512402998, "post_id": 47636352, "comment_id": 82232413, "body": "@RaynD  Use net/http/httptest Server and Gorilla websocket client to use from test.  Ask new question for details."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1512403093, "post_id": 47636352, "comment_id": 82232479, "body": "Ok thanks, just last question in this context , how should I print the <code>hello</code> messge from the client inside the go file (ws handler) , I dont see it in the w obj..."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512403316, "post_id": 47636352, "comment_id": 82232638, "body": "Start with the read/write loop <a href=\"https://godoc.org/github.com/gorilla/websocket\" rel=\"nofollow noreferrer\">at the beginning of the documentation</a>.  After reading the message,  <code>log.Printf(&quot;%s&quot;, p)</code> to see the received message."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1512403416, "post_id": 47636352, "comment_id": 82232700, "body": "thanks, will try . btw as you suggested I open new query <a href=\"https://stackoverflow.com/questions/47637308/create-unit-test-for-ws-in-golang\" title=\"create unit test for ws in golang\">stackoverflow.com/questions/47637308/&hellip;</a> , hope you can help. thanks!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1512400682, "last_edit_date": 1512400682, "creation_date": 1512400321, "answer_id": 47636352, "question_id": 47635764, "link": "https://stackoverflow.com/questions/47635764/run-web-socket-locally-for-debug/47636352#47636352", "title": "Run web-Socket locally for debug", "body": "<p>Browsers do not use the WebSocket protocol when fetching a web page for display. Code is required to use a WebSocket endpoint from a browser.</p>\n\n<p>The Gorilla package includes <a href=\"https://github.com/gorilla/websocket/tree/master/examples\" rel=\"noreferrer\">examples</a> showing how to connect from a browser (the <a href=\"https://github.com/gorilla/websocket/blob/b89020ee79b89a7f932c5617d218fc06db382f53/examples/chat/home.html#L31-L45\" rel=\"noreferrer\">chat</a> and <a href=\"https://github.com/gorilla/websocket/blob/b89020ee79b89a7f932c5617d218fc06db382f53/examples/command/home.html#L31-L45\" rel=\"noreferrer\">command</a> examples are good places to start).</p>\n\n<p>You can can connect to a WebSocket endpoint using the browser console:</p>\n\n<pre><code>&gt; ws = new WebSocket(\"ws://localhost:8080/mypath\")\n&gt; ws.onmessage = function(ev) { console.log(ev.data) }\n&gt; ws.send(\"hello\")\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1538, "favorite_count": 0, "accepted_answer_id": 47636352, "answer_count": 1, "score": 4, "last_activity_date": 1512400938, "creation_date": 1512398325, "last_edit_date": 1512400938, "question_id": 47635764, "link": "https://stackoverflow.com/questions/47635764/run-web-socket-locally-for-debug", "title": "Run web-Socket locally for debug", "body": "<p>I\u2019m using gorilla web socket and I want to run it locally , I mean with the following chrome client\nor other recommended tool \u2026when I run into debug mode I got error </p>\n\n<p>I use </p>\n\n<pre><code>\"github.com/gorilla/websocket\"\n\n\nvar upgrader = websocket.Upgrader{\n    ReadBufferSize:  1024,\n    WriteBufferSize: 1024,\n}\n\nupgrader.CheckOrigin = func(r *http.Request) bool { return true }\n\nc, err := upgrader.Upgrade(w, r, nil)\nif err != nil {\n    log.Print(\"upgrade:\", err)\n    return\n}\n</code></pre>\n\n<p>When I run the following url in chrome or web socket client I got error</p>\n\n<p>websocket: not a websocket handshake: 'upgrade' token not found in 'Connection' header</p>\n\n<pre><code>localhost:8081/mypath\n</code></pre>\n\n<p>and I want to run it </p>\n\n<pre><code>ws://localhost:8081/mypath\n</code></pre>\n\n<p>and provide token for local simulation, how I can do it ? </p>\n\n<p>To check it I use Simple WebSocket Client of chrome. any other client will be helpful </p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>when I try it in the chrome console I got the following error:</p>\n\n<blockquote>\n  <p>VM42:164 Refused to connect to 'ws://localhost:8081/mypath' because it\n  violates the following Content Security Policy directive: \"connect-src\n  'self' uploads.github.com status.github.com collector.githubapp.com\n  api.github.com www.google-analytics.com github-cloud.s3.amazonaws.com\n  github-production-repository-file-5c1aeb.s3.amazonaws.com\n  github-production-upload-manifest-file-7fdce7.s3.amazonaws.com\n  github-production-user-asset-6210df.s3.amazonaws.com\n  wss://live.github.com</p>\n</blockquote>\n"}, {"tags": ["go", "webrtc", "collider", "apprtc"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1512396916, "post_id": 47635265, "comment_id": 82228426, "body": "What is &quot;collider&quot;? Please show exactly what steps you&#39;re following. <code>collider&#47;collider</code> isn&#39;t a go get-able url, so you may have some other incorrect import paths."}], "answers": [{"comments": [{"owner": {"reputation": 27181, "user_id": 1070354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/56ca246e6d24b9a09114ff4542bcc2b1?s=128&d=identicon&r=PG", "display_name": "favoretti", "link": "https://stackoverflow.com/users/1070354/favoretti"}, "edited": false, "score": 0, "creation_date": 1512403479, "post_id": 47637253, "comment_id": 82232750, "body": "Sounds like default ubuntu that ships with go 1.2 indeed :("}, {"owner": {"reputation": 4315, "user_id": 4182755, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ggHFY.jpg?s=128&g=1", "display_name": "Abdul Manaf", "link": "https://stackoverflow.com/users/4182755/abdul-manaf"}, "edited": false, "score": 0, "creation_date": 1512452433, "post_id": 47637253, "comment_id": 82252026, "body": "this is due to, i have installed go from official website . but go already available in my ubuntu 14.04(using apt-get). I had just removed old version, it will be working fine. thanks for all your supports."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 1, "last_activity_date": 1512403162, "creation_date": 1512403162, "answer_id": 47637253, "question_id": 47635265, "link": "https://stackoverflow.com/questions/47635265/cant-build-collider-websocket-based-signaling-server-in-go/47637253#47637253", "title": "Cant build collider (websocket-based signaling server in Go)", "body": "<p>Sounds like you're using a really old version of go. Could you run <code>go version</code>?</p>\n\n<p><code>tls.DialWithDialer</code> was added in <a href=\"https://golang.org/doc/go1.3#minor_library_changes\" rel=\"nofollow noreferrer\">go 1.3</a> in 2014.</p>\n"}], "owner": {"reputation": 4315, "user_id": 4182755, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/ggHFY.jpg?s=128&g=1", "display_name": "Abdul Manaf", "link": "https://stackoverflow.com/users/4182755/abdul-manaf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 250, "favorite_count": 0, "accepted_answer_id": 47637253, "answer_count": 1, "score": 0, "last_activity_date": 1512403162, "creation_date": 1512396652, "question_id": 47635265, "link": "https://stackoverflow.com/questions/47635265/cant-build-collider-websocket-based-signaling-server-in-go", "title": "Cant build collider (websocket-based signaling server in Go)", "body": "<p>Iam trying to build apprtc signaling server(collider).  Based on tutorial, we only need to enter </p>\n\n<blockquote>\n  <p>go get collidermain</p>\n</blockquote>\n\n<p>after setting $GOPATH. But I got error like this </p>\n\n<pre><code> &gt; go get collider/collidermain\nsrc/collider/collidermain/main.go:9:2: no buildable Go source files in /home/abdulmanaf/poc/apprtcNewVersion/apprtc/src/collider\n</code></pre>\n\n<p>Then I had tried to build collider folder. But I got error like this</p>\n\n<pre><code>&gt; go get collider/collider\n# golang.org/x/net/websocket\nsrc/golang.org/x/net/websocket/dial.go:18:19: error: reference to undefined identifier \u2018tls.DialWithDialer\u2019\n   conn, err = tls.DialWithDialer(dialer, \"tcp\", parseAuthority(config.Location), config.TlsConfig)\n</code></pre>\n\n<p>What is the actual issue related to this? I need to build and deploy collider application</p>\n"}, {"tags": ["go", "metrics", "prometheus"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512398383, "post_id": 47634807, "comment_id": 82229290, "body": "The error message means what it says, something else is already using port 8080 so it can&#39;t start a new web server listening on that port."}, {"owner": {"reputation": 478, "user_id": 1456549, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/KP9PS.jpg?s=128&g=1", "display_name": "Munai Das Udasin", "link": "https://stackoverflow.com/users/1456549/munai-das-udasin"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512399272, "post_id": 47634807, "comment_id": 82229908, "body": "Hi @Adrian, you can ignore the error part. I am certain it was a mistake on my part. I ran kubectl exec -it &lt;podname&gt; -- /&lt;go-binary&gt; after I deployed the service. It was bound to give the message."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512399324, "post_id": 47634807, "comment_id": 82229952, "body": "So now there are no metrics and no error message?"}, {"owner": {"reputation": 478, "user_id": 1456549, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/KP9PS.jpg?s=128&g=1", "display_name": "Munai Das Udasin", "link": "https://stackoverflow.com/users/1456549/munai-das-udasin"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512399329, "post_id": 47634807, "comment_id": 82229959, "body": "Otherwise, the :8080/metrics endpoint stills gives me an empty response."}, {"owner": {"reputation": 478, "user_id": 1456549, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/KP9PS.jpg?s=128&g=1", "display_name": "Munai Das Udasin", "link": "https://stackoverflow.com/users/1456549/munai-das-udasin"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512399489, "post_id": 47634807, "comment_id": 82230071, "body": "Yes. no error message and an empty response."}, {"owner": {"reputation": 3830, "user_id": 127388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/881dc3adae8bea1d62d510c528369650?s=128&d=identicon&r=PG&f=1", "display_name": "rado", "link": "https://stackoverflow.com/users/127388/rado"}, "edited": false, "score": 0, "creation_date": 1547242626, "post_id": 47634807, "comment_id": 95139734, "body": "was this resolved?"}], "answers": [{"comments": [{"owner": {"reputation": 478, "user_id": 1456549, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/KP9PS.jpg?s=128&g=1", "display_name": "Munai Das Udasin", "link": "https://stackoverflow.com/users/1456549/munai-das-udasin"}, "edited": false, "score": 0, "creation_date": 1512405704, "post_id": 47637843, "comment_id": 82234134, "body": "I have counter increments throughout my code. Will these work?  xyzAPICallsCounter.WithLabelValues(&quot;pool&quot;,&quot;exists&quot;, &quot;failed&quot;).Inc()"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 478, "user_id": 1456549, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/KP9PS.jpg?s=128&g=1", "display_name": "Munai Das Udasin", "link": "https://stackoverflow.com/users/1456549/munai-das-udasin"}, "edited": false, "score": 0, "creation_date": 1512405981, "post_id": 47637843, "comment_id": 82234324, "body": "Do they show up on the metrics endpoint after calling <code>Inc()</code>?"}, {"owner": {"reputation": 478, "user_id": 1456549, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/KP9PS.jpg?s=128&g=1", "display_name": "Munai Das Udasin", "link": "https://stackoverflow.com/users/1456549/munai-das-udasin"}, "edited": false, "score": 0, "creation_date": 1512406132, "post_id": 47637843, "comment_id": 82234425, "body": "No they don&#39;t. Only go metrics in the first case. If I define my own registry,  then it is blank."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 478, "user_id": 1456549, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/KP9PS.jpg?s=128&g=1", "display_name": "Munai Das Udasin", "link": "https://stackoverflow.com/users/1456549/munai-das-udasin"}, "edited": false, "score": 0, "creation_date": 1512406249, "post_id": 47637843, "comment_id": 82234500, "body": "Can you show more code where you&#39;re calling <code>Inc()</code>? Could you also update your snippet to reflect how you&#39;re creating/registering everything? The go metrics will definitely not show up since you&#39;re creating your own registry instead of using the default one."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": false, "score": 0, "last_activity_date": 1512405067, "creation_date": 1512405067, "answer_id": 47637843, "question_id": 47634807, "link": "https://stackoverflow.com/questions/47634807/prometheus-metrics-not-showing-up-using-prometheus-go-client/47637843#47637843", "title": "Prometheus metrics not showing up using prometheus go client", "body": "<p>CounterVec is a collection of counters and is not exported until it has counters in it.</p>\n\n<p>See the <a href=\"https://github.com/prometheus/client_golang/blob/master/prometheus/counter.go#L99\" rel=\"nofollow noreferrer\">code docs</a> and <a href=\"https://github.com/prometheus/client_golang/blob/master/examples/random/main.go\" rel=\"nofollow noreferrer\">example</a> for more info.</p>\n"}], "owner": {"reputation": 478, "user_id": 1456549, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/KP9PS.jpg?s=128&g=1", "display_name": "Munai Das Udasin", "link": "https://stackoverflow.com/users/1456549/munai-das-udasin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1970, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1512405067, "creation_date": 1512395133, "last_edit_date": 1512399140, "question_id": 47634807, "link": "https://stackoverflow.com/questions/47634807/prometheus-metrics-not-showing-up-using-prometheus-go-client", "title": "Prometheus metrics not showing up using prometheus go client", "body": "<p>I am using prometheus golang client. The code snippet is below. The build for the same is working okay.</p>\n\n<p>The issue is that only go metrics are shown. xyz_* metrics are missing. I call the initMetrics() as first thing in the main() func.</p>\n\n<pre><code>// Declaring prometheus metric counters\nvar (\n\n  metric_prefix = \"xyz_\"\n\n  xyzAPICallsCounter = prometheus.NewCounterVec(\n    prometheus.CounterOpts{\n      Name: metric_prefix + \"api_calls_total\" ,\n      Help: \"Number of calls to xyz endpoint\",\n    },\n    []string{\n      // Type of api call. Present values \n      \"type\",\n      // Method can be \"add\", \"delete\", \"getall\", \"get\", \"create\", \"ensure\"\n      \"method\",\n      // Status is success or failed\n      \"status\",\n    },\n  )\n\n)\n\n    func initMetrics(){\n    prometheus.MustRegister(xyzAPICallsCounter)\n    http.Handle(\"/metrics\", promhttp.Handler())\n    http.ListenAndServe(\":8080\", nil)\n    }\n</code></pre>\n\n<p>Edit: I changed the initMetrics() function to below and now there are no metrics at all and the below error message.</p>\n\n<pre><code>func initMetrics(){\n  var registry = prometheus.NewRegistry()\n  registry.MustRegister(\n    xyzAPICallsCounter,\n  )\n  http.Handle(\"/metrics\", promhttp.HandlerFor(registry, promhttp.HandlerOpts{}))\n  log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n"}, {"tags": ["recursion", "go", "slice"], "comments": [{"owner": {"reputation": 11, "user_id": 9026703, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YcM5j.png?s=128&g=1", "display_name": "Lukasz Ostrowski", "link": "https://stackoverflow.com/users/9026703/lukasz-ostrowski"}, "edited": false, "score": 0, "creation_date": 1512394807, "post_id": 47634379, "comment_id": 82226945, "body": "I forgot to add, that I build my own len. I can&#39;t use build-in len function."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1512410990, "post_id": 47634379, "comment_id": 82237142, "body": "You simply <b>cannot</b> do this. This is totally impossible: The recursion must end (the <code>s==nil</code> case in your code) and this can be done only with the builtin len function."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1512395583, "last_edit_date": 1512395583, "creation_date": 1512394077, "answer_id": 47634475, "question_id": 47634379, "link": "https://stackoverflow.com/questions/47634379/own-len-function-with-recursion-in-go/47634475#47634475", "title": "own len function with recursion in Go", "body": "<p>It panics because you have no valid termination condition.</p>\n\n<p>When your <code>len2()</code> is called with a non-<code>nil</code> empty slice, it attempts to slice it like <code>s[1:]</code>, which will be a runtime panic.</p>\n\n<p>Instead of checking for <code>nil</code> slice, check if the slice is empty by comparing its length to <code>0</code>:</p>\n\n<pre><code>func len2(s []int) int {\n    if len(s) == 0 {\n        return 0\n    }\n    return 1 + len2(s[1:])\n}\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/Qkb_ZQxZ9b\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>If you can't use the builtin <code>len()</code> function (which you already did in your solution), you may use the <code>for ... range</code>:</p>\n\n<pre><code>func len2(s []int) int {\n    size := 0\n    for i := range s {\n        size = i + 1\n    }\n    return size\n}\n</code></pre>\n\n<p>Try this on the <a href=\"https://play.golang.org/p/wbrYy2rSKN\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>And if it must be recursive, then for example:</p>\n\n<pre><code>func len2(s []int) int {\n    size := 0\n    for range s {\n        size = 1 + len2(s[1:])\n        break\n    }\n    return size\n}\n</code></pre>\n\n<p>Try this on the <a href=\"https://play.golang.org/p/5ghvRHrg5_\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>But know that these are awful solutions compared to using the builtin <code>len()</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 11, "user_id": 9026703, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YcM5j.png?s=128&g=1", "display_name": "Lukasz Ostrowski", "link": "https://stackoverflow.com/users/9026703/lukasz-ostrowski"}, "edited": false, "score": 0, "creation_date": 1512394709, "post_id": 47634514, "comment_id": 82226877, "body": "i want to create own len function - that is i don&#39;t want do use embedded len function."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1512411071, "post_id": 47634514, "comment_id": 82237179, "body": "Not guaranteed by the language spec to work with all implementations."}], "tags": [], "owner": {"reputation": 3210, "user_id": 379906, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d0d2b9a421355f4a5bab3658c6f6b41d?s=128&d=identicon&r=PG", "display_name": "db80", "link": "https://stackoverflow.com/users/379906/db80"}, "is_accepted": false, "score": -1, "last_activity_date": 1512420385, "last_edit_date": 1512420385, "creation_date": 1512394232, "answer_id": 47634514, "question_id": 47634379, "link": "https://stackoverflow.com/questions/47634379/own-len-function-with-recursion-in-go/47634514#47634514", "title": "own len function with recursion in Go", "body": "<p>If you do not want to use len() func, you can use <a href=\"https://golang.org/pkg/builtin/#cap\" rel=\"nofollow noreferrer\">cap()</a></p>\n\n<pre><code>func main() {\n  x := []int{1, 2, 3}\n  fmt.Println(len2(x))\n}\n\nfunc len2(s []int) int {\n\n if cap(s) == 0 {\n    return 0\n }\n\n  return 1 + len2(s[1:])\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/BbEC_jXxnj\" rel=\"nofollow noreferrer\">Try it again</a></p>\n\n<p><strong>Original Answer:</strong></p>\n\n<p>In order to check if an array (slice) is empty, you should use the function <a href=\"https://golang.org/pkg/builtin/#len\" rel=\"nofollow noreferrer\">len()</a></p>\n\n<pre><code>  if len(s) == 0 {\n    return 0\n  }\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/XeUetiei1X\" rel=\"nofollow noreferrer\">Try it</a> </p>\n"}, {"comments": [{"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1512456486, "post_id": 47634876, "comment_id": 82253471, "body": "Please add reasons for negative votes , especially when the answer is an accepted answer"}], "tags": [], "owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "is_accepted": true, "score": 0, "last_activity_date": 1512395362, "creation_date": 1512395362, "answer_id": 47634876, "question_id": 47634379, "link": "https://stackoverflow.com/questions/47634379/own-len-function-with-recursion-in-go/47634876#47634876", "title": "own len function with recursion in Go", "body": "<p>The following is not a solution with better performance than <code>len</code> but an implementation that does not use any extra libraries and depends on recursion to find length</p>\n\n<pre><code>func len2(s []int) (count int) {\n    defer func() {\n        if r := recover(); r != nil {\n            count = 0\n        }\n    }()\n\n    return 1 + len2(s[1:])\n}\n</code></pre>\n\n<p>Here is sample code </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var x []int = nil\n    var x1 = []int{1, 2, 3, 4}\n    var x2 = []int{}\n    var x3 = make([]int, 10, 20)\n    fmt.Println(len2(x))\n    fmt.Println(len2(x1))\n    fmt.Println(len2(x2))\n    fmt.Println(len2(x3))\n}\n\nfunc len2(s []int) (count int) {\n    defer func() {\n        if r := recover(); r != nil {\n            count = 0\n        }\n    }()\n\n    return 1 + len2(s[1:])\n}\n</code></pre>\n\n<p>Checkout the same in <a href=\"https://play.golang.org/p/L4dPom9kwg\" rel=\"nofollow noreferrer\">playground</a></p>\n"}, {"comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1512404355, "post_id": 47635247, "comment_id": 82233310, "body": "An alternative with recursion that uses the same range loop protections (and never actually loops, it just uses the range operator as a ghetto <code>len</code> call without actually calling <code>len</code>): <a href=\"https://play.golang.org/p/KeXUfnJAr3\" rel=\"nofollow noreferrer\">play.golang.org/p/KeXUfnJAr3</a>"}], "tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": false, "score": -1, "last_activity_date": 1512396610, "creation_date": 1512396610, "answer_id": 47635247, "question_id": 47634379, "link": "https://stackoverflow.com/questions/47634379/own-len-function-with-recursion-in-go/47635247#47635247", "title": "own len function with recursion in Go", "body": "<p>If you can leave without recursion here is a function that does not use <code>len()</code> and should be faster then re-slicing recursively.</p>\n\n<pre><code>func len2(s []int) (count int) {\n  for i := range s {\n    count = i + 1\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 9026703, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YcM5j.png?s=128&g=1", "display_name": "Lukasz Ostrowski", "link": "https://stackoverflow.com/users/9026703/lukasz-ostrowski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 47634876, "answer_count": 4, "score": 0, "last_activity_date": 1512420385, "creation_date": 1512393786, "question_id": 47634379, "link": "https://stackoverflow.com/questions/47634379/own-len-function-with-recursion-in-go", "title": "own len function with recursion in Go", "body": "<p>I'm trying to build simple function to count elements in slice (like len) It must be simple (without additional libs) and with recursion. The problem is when i try to check is slice is empty (is nul).</p>\n\n<pre><code>package main\nimport \"fmt\"\n\nfunc main() {\n  x := []int{1, 2, 3}\n  fmt.Println(len2(x))\n}\nfunc len2(s []int) int {\n  if s == nil {\n    return 0\n  }\n  return 1 + len2(s[1:])\n}\n</code></pre>\n\n<p>the result it should be in this example '3'.</p>\n\n<p>It's broken in if s == nil: </p>\n\n<pre><code>panic: runtime error: slice bounds out of range\n</code></pre>\n"}, {"tags": ["go", "udp", "dhcp"], "comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1512456588, "post_id": 47633520, "comment_id": 82253509, "body": "What is a &quot;fake UDP package&quot;? Not an expert, but AFAIK there are no such things as &quot;packages&quot; in UDP. Also what does &quot;fake&quot; mean? That it&#39;s really TCP? You should really describe what your <i>goal</i> is, rather than the method you think might solve your problem."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 8833530, "user_type": "registered", "profile_image": "https://graph.facebook.com/10213939675348984/picture?type=large", "display_name": "Iago SP", "link": "https://stackoverflow.com/users/8833530/iago-sp"}, "is_accepted": true, "score": 0, "last_activity_date": 1512489892, "last_edit_date": 1512489892, "creation_date": 1512481518, "answer_id": 47655127, "question_id": 47633520, "link": "https://stackoverflow.com/questions/47633520/how-to-send-a-fake-udp-package-in-golang/47655127#47655127", "title": "How to send a fake udp package in golang", "body": "<p>At the end I managed to make works this check to send in periods of 10 minuts an upd package with an mac address I know is gonna never be reached as following.</p>\n\n<pre><code>func (h *DHCPHandler) check() {\n    //Fetch parameters from config file\n    config := getConfig() // here is a mac saved on a json file 01:ff:ff:ff:ff:ff\n    macFake, err := net.ParseMAC(config.MacFake)\n\n    if err != nil {\n            fmt.Println(\"error with the fake mac provided on the json file\", err)\n    }\n\n    // create connection\n    conn, err := net.Dial(\"udp4\", \"127.0.0.1:67\")\n    if err != nil {\n            fmt.Println(\"error with the connection\", err)\n    }\n\n    //stay alive\n    for {\n            fmt.Fprintf(conn, \"GET / HTTP/1.0\\r\\n\\r\\n\")\n            conn.Write(dhcp.RequestPacket(dhcp.Discover, macFake, h.ip, []byte{0, 1, 2, 3}, true, nil))\n            time.Sleep(10 * time.Minute)\n    }\n</code></pre>\n\n<p>}</p>\n\n<p>On the main function, I just need to call this check goroutine and add on the server side (ServeDHCP) this code:</p>\n\n<pre><code>    mac := p.CHAddr().String()\n    //Fetch parameters from config file\n    config := getConfig()\n    if mac == config.MacFake { //udp package received and a mac saved on a json file 01:ff:ff:ff:ff:ff\n            // send notification to restart if failure on a systemd\n            daemon.SdNotify(false, \"WATCHDOG=1\")\n            return\n    }\n</code></pre>\n\n<p>The last part needed is to add a systemd check, in my case I send the watchdog every 10 min, so, the systemd check will be setted it to 11min</p>\n\n<pre><code>[Service]\nExecStartPre=//something \nWatchdogSec=11min \nRestart=on-failure\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 8833530, "user_type": "registered", "profile_image": "https://graph.facebook.com/10213939675348984/picture?type=large", "display_name": "Iago SP", "link": "https://stackoverflow.com/users/8833530/iago-sp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 636, "favorite_count": 0, "accepted_answer_id": 47655127, "answer_count": 1, "score": -4, "last_activity_date": 1512489892, "creation_date": 1512390881, "last_edit_date": 1512481069, "question_id": 47633520, "link": "https://stackoverflow.com/questions/47633520/how-to-send-a-fake-udp-package-in-golang", "title": "How to send a fake udp package in golang", "body": "<p>Im trying to send a fake udp (a random mac address, let's say 01:ff:ff:ff:ff:ff) package to be handled by the ServeDHCP on the server side, Im running the following dhcpv4 github repository <a href=\"https://github.com/krolaw/dhcp4\" rel=\"nofollow noreferrer\">github.com/krolaw/dhcp4</a>. </p>\n\n<p>The goal of send a discover package, is to check if the dhcp is alive.</p>\n\n<p>In fact I created a new func called check</p>\n\n<pre><code>func (h *DHCPHandler) check () {\n    con, err = net.Dial(\"udp\", \"127.0.0.1:67\")\n    for {\n            //fake udp package???\n            time.Sleep(10 * time.Minute)\n    }\n</code></pre>\n\n<p>}</p>\n\n<p>in the main of the function, I have the following call <code>go handler.check()</code></p>\n\n<p>And in the ServeDHCP I should pass these parameters: <br> <code>func (h *DHCPHandler) ServeDHCP(p dhcp.Packet, msgType dhcp.MessageType, options dhcp.Options)</code></p>\n\n<p>How could I send a fake upd package from the func check? </p>\n"}, {"tags": ["go", "immutability"], "comments": [{"owner": {"reputation": 2659, "user_id": 425997, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/6pMR3.jpg?s=128&g=1", "display_name": "David", "link": "https://stackoverflow.com/users/425997/david"}, "edited": false, "score": 0, "creation_date": 1526509132, "post_id": 47632706, "comment_id": 87777583, "body": "This was also a good related read for me: <a href=\"https://flaviocopes.com/go-copying-structs\" rel=\"nofollow noreferrer\">flaviocopes.com/go-copying-structs</a>"}], "answers": [{"comments": [{"owner": {"reputation": 460, "user_id": 6677487, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rt-9p328Y48/AAAAAAAAAAI/AAAAAAAACR8/GX_XGEr4Gp0/photo.jpg?sz=128", "display_name": "Vikram Singh Choudhary", "link": "https://stackoverflow.com/users/6677487/vikram-singh-choudhary"}, "edited": false, "score": 0, "creation_date": 1512389824, "post_id": 47632959, "comment_id": 82223859, "body": "This is helpful. Is possible to make the struct to be read-only inside of package?"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 5, "creation_date": 1512393111, "post_id": 47632959, "comment_id": 82225870, "body": "No, but since you control the code inside the package all you need to do is simply never write to the structure once it is created."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 460, "user_id": 6677487, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rt-9p328Y48/AAAAAAAAAAI/AAAAAAAACR8/GX_XGEr4Gp0/photo.jpg?sz=128", "display_name": "Vikram Singh Choudhary", "link": "https://stackoverflow.com/users/6677487/vikram-singh-choudhary"}, "edited": false, "score": 8, "creation_date": 1512407515, "post_id": 47632959, "comment_id": 82235280, "body": "@VIKRAMSINGHCHOUDHARY although this may be overkill, you could also just move your type into it&#39;s own package where there is nothing but it, its exported methods and constructors."}, {"owner": {"reputation": 69512, "user_id": 697630, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/40769e88c0dc93d387a9e368c332fdf9?s=128&d=identicon&r=PG", "display_name": "Edwin Dalorzo", "link": "https://stackoverflow.com/users/697630/edwin-dalorzo"}, "edited": false, "score": 0, "creation_date": 1602260785, "post_id": 47632959, "comment_id": 113674540, "body": "I believe there are <a href=\"http://blog.j7mbo.com/bypassing-golangs-lack-of-constructors/\" rel=\"nofollow noreferrer\">some tradeoffs</a> with this approach."}], "tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": true, "score": 46, "last_activity_date": 1592882139, "last_edit_date": 1592882139, "creation_date": 1512389020, "answer_id": 47632959, "question_id": 47632706, "link": "https://stackoverflow.com/questions/47632706/immutable-struct-in-golang/47632959#47632959", "title": "Immutable Struct in Golang", "body": "<p>It is possible to make a struct read-only outside of its package by making its members non-exported and providing readers. For example:</p>\n<pre><code>package mypackage\n\ntype myReadOnly struct {\n  value int\n}\n\nfunc (s myReadOnly) Value() int {\n  return s.value\n}\n\nfunc NewMyReadonly(value int) myReadOnly{\n  return myReadOnly{value: value}\n}\n</code></pre>\n<p>And usage:</p>\n<pre><code>myReadonly := mypackage.NewMyReadonly(3)\nfmt.Println(myReadonly.Value())  // Prints 3\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "is_accepted": false, "score": 7, "last_activity_date": 1512391840, "creation_date": 1512391840, "answer_id": 47633820, "question_id": 47632706, "link": "https://stackoverflow.com/questions/47632706/immutable-struct-in-golang/47633820#47633820", "title": "Immutable Struct in Golang", "body": "<p>There is no way to mark fields/variables as read only in a generic way. The only thing you could do is marking fields/variable as unexported (first letter small) and provide public getters to prevent other packages editing variables.</p>\n"}, {"comments": [{"owner": {"reputation": 2185, "user_id": 998248, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/9da7f340f13894027213bfb9aa2c5fed?s=128&d=identicon&r=PG", "display_name": "Anthony Naddeo", "link": "https://stackoverflow.com/users/998248/anthony-naddeo"}, "edited": false, "score": 2, "creation_date": 1602037010, "post_id": 62711646, "comment_id": 113590311, "body": "This feels crazy to me in 2020. Is the lack of immutability a hot topic in golang or is this just something that systems people don&#39;t care about?"}, {"owner": {"reputation": 27685, "user_id": 610979, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/ku5ga.png?s=128&g=1", "display_name": "Frank Schmitt", "link": "https://stackoverflow.com/users/610979/frank-schmitt"}, "edited": false, "score": 0, "creation_date": 1618412960, "post_id": 62711646, "comment_id": 118594809, "body": "I disagree with the &quot;systems people&quot; part. E.g. in Rust, immutable is the default. And yes, it&#39;s crazy that Golang does not support this."}], "tags": [], "owner": {"reputation": 66, "user_id": 7769816, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Xczg8XeF1SU/AAAAAAAAAAI/AAAAAAAAACw/OeQOM1ddxF0/photo.jpg?sz=128", "display_name": "Alok Tripathi", "link": "https://stackoverflow.com/users/7769816/alok-tripathi"}, "is_accepted": false, "score": 1, "last_activity_date": 1593765619, "creation_date": 1593765619, "answer_id": 62711646, "question_id": 47632706, "link": "https://stackoverflow.com/questions/47632706/immutable-struct-in-golang/62711646#62711646", "title": "Immutable Struct in Golang", "body": "<p>There is no way to define immutable structures in Go: struct fields are mutable and the const keyword doesn't apply to them. Go makes it easy however to copy an entire struct with a simple assignment, so we may think that passing arguments by value is all that is needed to have immutability at the cost of copying.</p>\n<p>However, and unsurprisingly, this does not copy values referenced by pointers. And the since built-in collections (map, slice and array) are references and are mutable, copying a struct that contains one of these just copies the pointer to the same underlying memory.</p>\n<p>Example :</p>\n<pre><code>type S struct {\n    A string\n    B []string\n}\n\nfunc main() {\n    x := S{&quot;x-A&quot;, []string{&quot;x-B&quot;}}\n    y := x // copy the struct\n    y.A = &quot;y-A&quot;\n    y.B[0] = &quot;y-B&quot;\n\n    fmt.Println(x, y)\n    // Outputs &quot;{x-A [y-B]} {y-A [y-B]}&quot; -- x was modified!\n}\n</code></pre>\n<p><strong>Note</strong> : So you have to be extremely careful about this, and not assume immutability if you pass a parameter by value.</p>\n<p>There are some deepcopy libraries that attempt to solve this using (slow) reflection, but they fall short since private fields can't be accessed with reflection. So defensive copying to avoid race conditions will be difficult, requiring lots of boilerplate code. Go doesn't even have a Clone interface that would standardize this.</p>\n<p>Credit : <a href=\"https://bluxte.net/\" rel=\"nofollow noreferrer\">https://bluxte.net/</a></p>\n"}], "owner": {"reputation": 460, "user_id": 6677487, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rt-9p328Y48/AAAAAAAAAAI/AAAAAAAACR8/GX_XGEr4Gp0/photo.jpg?sz=128", "display_name": "Vikram Singh Choudhary", "link": "https://stackoverflow.com/users/6677487/vikram-singh-choudhary"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13923, "favorite_count": 4, "accepted_answer_id": 47632959, "answer_count": 3, "score": 33, "last_activity_date": 1593765619, "creation_date": 1512388134, "question_id": 47632706, "link": "https://stackoverflow.com/questions/47632706/immutable-struct-in-golang", "title": "Immutable Struct in Golang", "body": "<p>Is it possible to define an immutable struct in Golang? Once initialized then only read operation on struct's field, no modification of field values. If so, how to do that.</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 356, "user_id": 5998521, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mkFFT.jpg?s=128&g=1", "display_name": "Pietro Bongiovanni", "link": "https://stackoverflow.com/users/5998521/pietro-bongiovanni"}, "is_accepted": false, "score": 1, "last_activity_date": 1512382735, "creation_date": 1512382735, "answer_id": 47631077, "question_id": 47630962, "link": "https://stackoverflow.com/questions/47630962/gorm-multiple-preloadings-dont-work/47631077#47631077", "title": "Gorm multiple Preloadings don&#39;t work", "body": "<p>Just realised I was selecting queries where the relation (i.e. FK) with the <code>Report</code> table was null.</p>\n\n<p>Works fine if the relation key is not null.</p>\n"}], "owner": {"reputation": 356, "user_id": 5998521, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mkFFT.jpg?s=128&g=1", "display_name": "Pietro Bongiovanni", "link": "https://stackoverflow.com/users/5998521/pietro-bongiovanni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1527757286, "creation_date": 1512382355, "last_edit_date": 1527757286, "question_id": 47630962, "link": "https://stackoverflow.com/questions/47630962/gorm-multiple-preloadings-dont-work", "title": "Gorm multiple Preloadings don&#39;t work", "body": "<p>Good Monday Morning everyone!\nI am having a problem with preloading entities! I am doing multiple preloadings of entities. The <code>Country</code>entity is working fine, but the <code>Report</code> is not being preloaded. Any ideas what might be causing that?</p>\n\n<pre><code>type Review struct {\n  ID             int\n  Report   Report 'gorm:\"ForeignKey:ReportId\"'\n  ReportId uint\n  Country        Country      'gorm:\"ForeignKey:CountryId\"'\n  CountryId      uint\n}\nfunc FindApprovedReviews(page int, countryId int) ([]Review, int, error) {\n  var reviews [] Review\n\n// Subtract one to fix Offset but keep page number correct\n  page -= 1\n  err := db.Where(\"approved_at IS NOT NULL\").\n//TODO: Change this to a configuration file value\n      Limit(10).\n      Where(\"approved_by IS NOT NULL\").\n      Where(\"country_id = ?\", countryId).\n//TODO: Change this (the 10) to a configuration value\n      Offset(page * 10).\n      Order(\"id desc\").\n      Preload(\"Report\").\n      Preload(\"Country\").\n      Find(&amp;reviews).\n      Error\n  if err != nil {\n      return nil, 0, err\n  }\n\n  return reviews, count, err\n}\n</code></pre>\n\n<p>The two related structs (<code>Country</code> and <code>Report</code>) are simply made up of <code>gorm.Model</code> for teting purpose.</p>\n\n<p>Thanks in advance for the help!!</p>\n\n<p>EDIT: I am using the <code>mysql</code> driver.</p>\n\n<p>P.S. The <code>[...]</code> represent business data that has been hidden, but they are simple columns that are working fine.</p>\n"}, {"tags": ["go", "cookies"], "answers": [{"comments": [{"owner": {"reputation": 1152, "user_id": 1603399, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/95QCa.jpg?s=128&g=1", "display_name": "dimiguel", "link": "https://stackoverflow.com/users/1603399/dimiguel"}, "edited": false, "score": 2, "creation_date": 1553751803, "post_id": 47626652, "comment_id": 97502734, "body": "Setting <code>Path: &quot;&#47;&quot;</code> was the only thing that worked for me with CORS. So to anyone in the future, <code>Set-Cookie</code> does not work with CORS and <code>withCredentials</code> unless you add <code>Path: &quot;&#47;&quot;</code>."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1512362629, "creation_date": 1512362629, "answer_id": 47626652, "question_id": 47626574, "link": "https://stackoverflow.com/questions/47626574/set-cookie-not-being-detected/47626652#47626652", "title": "Set cookie not being detected", "body": "<p>The call to <code>r.Cookie(\"id\")</code> reads a \"Cookie\" header in the request.</p>\n\n<p>The call to <code>http.SetCookie(w, &amp;ck)</code> adds a \"Set-Cookie\" header in the response.  The call does not modify the request.</p>\n\n<p>Instead of calling the function recursively to get the cookie (which does not work for the reasons stated above), just use the cookie you have on hand:</p>\n\n<pre><code>func CheckUpdateCookie(w http.ResponseWriter, r *http.Request) {\n    val, err := r.Cookie(\"id\")\n    if err != nil {\n        val := &amp;http.Cookie{\n            Name: \"id\",\n            Value: 5,\n            MaxAge: 60,\n        }\n        http.SetCookie(w, val)\n    }\n    // val is now set to the cookie.\n}\n</code></pre>\n\n<p>It is typical to set the path to \"/\"  so that the cookie is available on all paths:</p>\n\n<pre><code>        val := &amp;http.Cookie{\n            Name: \"id\",\n            Value: 5,\n            MaxAge: 60,\n            Path: \"/\",\n        }\n</code></pre>\n"}], "owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1253, "favorite_count": 0, "accepted_answer_id": 47626652, "answer_count": 1, "score": 0, "last_activity_date": 1512362629, "creation_date": 1512362163, "question_id": 47626574, "link": "https://stackoverflow.com/questions/47626574/set-cookie-not-being-detected", "title": "Set cookie not being detected", "body": "<p>I'm running into a problem trying to retrieve a cookie if it is set and if not I want to update it then retrieve it.</p>\n\n<p>To start I have a function that sets a cookie:</p>\n\n<pre><code>func IndexHandler(w http.ResponseWriter, r *http.Request) {\n    ...\n    ck := http.Cookie{\n        Name: \"id\",\n        Value: 5,\n        MaxAge: 60,\n    }\n}\n</code></pre>\n\n<p>Then in another function I check to see if that cookie exists and if it (throws an error) then I recreate it</p>\n\n<pre><code>func CheckUpdateCookie(w http.ResponseWriter, r *http.Request) {\n    val, err := r.Cookie(\"id\")\n    if err != nil {\n        ck := http.Cookie{\n            Name: \"id\",\n            Value: 5,\n            MaxAge: 60,\n        }\n\n        http.SetCookie(w, &amp;ck)\n        CheckUpdateCookie(w, r)\n    }\n}\n</code></pre>\n\n<p>This leads to it running into an infinite loop and not recognizing that the cookie has been set again, if I print the err I get <code>http: named cookie not present</code> even though I have set the cookie in the body of the function.</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512362454, "post_id": 47626457, "comment_id": 82210913, "body": "The error is telling you that the application exited. The application probably exited because of a call to log.Fatalf. Use the <a href=\"https://cloud.google.com/appengine/docs/standard/go/logs/reference\" rel=\"nofollow noreferrer\">appengine loggger</a> to log the error and return from the handler instead of calling log.Fatalf.  Look at the error in the console to determine what might be wrong."}, {"owner": {"reputation": 358, "user_id": 7296857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fda7320a4b822f1f388b5996f6f4f00c?s=128&d=identicon&r=PG&f=1", "display_name": "user", "link": "https://stackoverflow.com/users/7296857/user"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512364522, "post_id": 47626457, "comment_id": 82211494, "body": "I used the appengine logger and removed the regular log package, but removing log.Fatalf did not stop the problem. It appears that the function client.Put is a cause of the problem, as commenting it out makes the webpage load ok, but why?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512364731, "post_id": 47626457, "comment_id": 82211576, "body": "What&#39;s the error returned from Put?"}, {"owner": {"reputation": 358, "user_id": 7296857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fda7320a4b822f1f388b5996f6f4f00c?s=128&d=identicon&r=PG&f=1", "display_name": "user", "link": "https://stackoverflow.com/users/7296857/user"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512365493, "post_id": 47626457, "comment_id": 82211817, "body": "I couldn&#39;t see error from Put specifically. The page just kept loading and eventually the log said &quot;This request caused a new process to be started for your application, and thus caused your application code to be loaded for the first time. This request may thus take longer and use more CPU than a typical request for your application.&quot; Then it said &quot;Process terminated because the request deadline was exceeded. (Error code 123)&quot;"}, {"owner": {"reputation": 358, "user_id": 7296857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fda7320a4b822f1f388b5996f6f4f00c?s=128&d=identicon&r=PG&f=1", "display_name": "user", "link": "https://stackoverflow.com/users/7296857/user"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512373322, "post_id": 47626457, "comment_id": 82214682, "body": "I have another problem with this code that may be related: upon checking with the local datastore at <a href=\"http://localhost:8000/datastore\" rel=\"nofollow noreferrer\">localhost:8000/datastore</a>, it appears that the entity was not actually being saved: &quot;Datastore has no entities in the Empty namespace.&quot; Yet, client.Put did not produce an error since returned error = nil."}], "answers": [{"comments": [{"owner": {"reputation": 21495, "user_id": 62288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01239dcaa443502ce71059f5308bca74?s=128&d=identicon&r=PG", "display_name": "Dave W. Smith", "link": "https://stackoverflow.com/users/62288/dave-w-smith"}, "edited": false, "score": 1, "creation_date": 1512404653, "post_id": 47632463, "comment_id": 82233486, "body": "A better tutorial than what? If there&#39;s a tutorial out there that calls for using the wrong library, it needs to be fixed."}, {"owner": {"reputation": 358, "user_id": 7296857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fda7320a4b822f1f388b5996f6f4f00c?s=128&d=identicon&r=PG&f=1", "display_name": "user", "link": "https://stackoverflow.com/users/7296857/user"}, "reply_to_user": {"reputation": 21495, "user_id": 62288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01239dcaa443502ce71059f5308bca74?s=128&d=identicon&r=PG", "display_name": "Dave W. Smith", "link": "https://stackoverflow.com/users/62288/dave-w-smith"}, "edited": false, "score": 0, "creation_date": 1512461985, "post_id": 47632463, "comment_id": 82256186, "body": "The code was taken from this one: <a href=\"https://cloud.google.com/datastore/docs/reference/libraries#client-libraries-usage-go\" rel=\"nofollow noreferrer\">cloud.google.com/datastore/docs/reference/&hellip;</a>"}, {"owner": {"reputation": 358, "user_id": 7296857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fda7320a4b822f1f388b5996f6f4f00c?s=128&d=identicon&r=PG&f=1", "display_name": "user", "link": "https://stackoverflow.com/users/7296857/user"}, "reply_to_user": {"reputation": 21495, "user_id": 62288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01239dcaa443502ce71059f5308bca74?s=128&d=identicon&r=PG", "display_name": "Dave W. Smith", "link": "https://stackoverflow.com/users/62288/dave-w-smith"}, "edited": false, "score": 0, "creation_date": 1512464914, "post_id": 47632463, "comment_id": 82257719, "body": "(That page didn&#39;t use the appengine package, so maybe it&#39;s my own fault for trying to adapt it this way, but the two versions are confusingly similar for me and some users even suggested we could use either one)"}], "tags": [], "owner": {"reputation": 358, "user_id": 7296857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fda7320a4b822f1f388b5996f6f4f00c?s=128&d=identicon&r=PG&f=1", "display_name": "user", "link": "https://stackoverflow.com/users/7296857/user"}, "is_accepted": false, "score": 1, "last_activity_date": 1512387328, "creation_date": 1512387328, "answer_id": 47632463, "question_id": 47626457, "link": "https://stackoverflow.com/questions/47626457/why-is-gae-returning-server-error-when-the-code-works-in-the-local-development-s/47632463#47632463", "title": "why is GAE returning server error when the code works in the local development server?", "body": "<p>I found out that the use of the package \"cloud.google.com/go/datastore\" was causing the problem. Instead, the solution should have been implemented using the package \"google.golang.org/appengine/datastore\". It appears that the former package was not compatible with GAE in my implementation. Switching to the latter package led to working code. For Datastore in GAE a better tutorial to follow should have been the following: <a href=\"https://cloud.google.com/appengine/docs/standard/go/getting-started/creating-guestbook\" rel=\"nofollow noreferrer\">https://cloud.google.com/appengine/docs/standard/go/getting-started/creating-guestbook</a></p>\n"}], "owner": {"reputation": 358, "user_id": 7296857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fda7320a4b822f1f388b5996f6f4f00c?s=128&d=identicon&r=PG&f=1", "display_name": "user", "link": "https://stackoverflow.com/users/7296857/user"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 370, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1512387328, "creation_date": 1512361299, "last_edit_date": 1512361721, "question_id": 47626457, "link": "https://stackoverflow.com/questions/47626457/why-is-gae-returning-server-error-when-the-code-works-in-the-local-development-s", "title": "why is GAE returning server error when the code works in the local development server?", "body": "<p>I'm trying to test the Datastore functionality using Google App Engine and my code works as expected in the local development server:</p>\n\n<pre><code>// code based on the following guide: https://cloud.google.com/datastore/docs/reference/libraries#client-libraries-install-go\npackage datastoretest\n\nimport (\n        \"fmt\"\n        \"log\"\n        \"net/http\"\n        \"cloud.google.com/go/datastore\"\n        \"google.golang.org/appengine\" \n)\n\ntype Task struct {\n        Description string\n}\n\nfunc init() {\n    http.HandleFunc(\"/\", handler)\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n\n    ctx := appengine.NewContext(r)\n\n    // Set Google Cloud Platform project ID.\n    projectID := \"myProjectID\" //note: actual ID is different\n\n    // Creates a client.\n    client, err := datastore.NewClient(ctx, projectID)\n    if err != nil {\n        log.Fatalf(\"Failed to create client: %v\", err)\n    }\n\n    // Sets the kind for the new entity.\n    kind := \"Task\"\n    // Sets the name/ID for the new entity.\n    name := \"sampletask1\"\n    // Creates a Key instance.\n    taskKey := datastore.NameKey(kind, name, nil)\n\n    // Creates a Task instance.\n    task := Task{\n            Description: \"Buy milk\",\n    }\n\n    // Saves the new entity.\n    if _, err := client.Put(ctx, taskKey, &amp;task); err != nil {\n            log.Fatalf(\"Failed to save task: %v\", err)\n    }\n\n    fmt.Fprint(w, \"Saved \", taskKey, \":\", task.Description)\n\n}\n</code></pre>\n\n<p>However, after being deployed to a GAE project, it's returning the following message to the visitor:</p>\n\n<pre><code>Error: Server Error\nThe server encountered an error and could not complete your request.\nPlease try again in 30 seconds.\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1161, "user_id": 3917295, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/BFoJm.jpg?s=128&g=1", "display_name": "vinllen", "link": "https://stackoverflow.com/users/3917295/vinllen"}, "edited": false, "score": 0, "creation_date": 1512366658, "post_id": 47626369, "comment_id": 82212180, "body": "Thanks, Cerise. I have another question if I set the channel with size 2 so that the <code>errc</code> be set two times, but the <code>func transport </code> only read one time and then exit, can this channel safety garbage?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1161, "user_id": 3917295, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/BFoJm.jpg?s=128&g=1", "display_name": "vinllen", "link": "https://stackoverflow.com/users/3917295/vinllen"}, "edited": false, "score": 0, "creation_date": 1512366937, "post_id": 47626369, "comment_id": 82212264, "body": "Yes, you can prevent a leak by using a channel with capacity 2."}, {"owner": {"reputation": 1161, "user_id": 3917295, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/BFoJm.jpg?s=128&g=1", "display_name": "vinllen", "link": "https://stackoverflow.com/users/3917295/vinllen"}, "edited": false, "score": 0, "creation_date": 1512367058, "post_id": 47626369, "comment_id": 82212312, "body": "Thank you very much! It helps me"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1161, "user_id": 3917295, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/BFoJm.jpg?s=128&g=1", "display_name": "vinllen", "link": "https://stackoverflow.com/users/3917295/vinllen"}, "edited": false, "score": 0, "creation_date": 1512367400, "post_id": 47626369, "comment_id": 82212420, "body": "@vinllen Yikes, I missed that the channel in the question has buffer size of one.  There is no leak. See updated answer."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1512367059, "last_edit_date": 1512367059, "creation_date": 1512360638, "answer_id": 47626369, "question_id": 47626333, "link": "https://stackoverflow.com/questions/47626333/will-goroutine-leakage-happen-that-channel-with-one-buffer-which-have-two-inputs/47626369#47626369", "title": "Will goroutine leakage happen that channel with one buffer which have two inputs but only one output?", "body": "<p>The value from one goroutine is received and the other is buffered. Both goroutines can send to the channel and exit. There is no leak.</p>\n\n<p>You might want to receive both values to ensure that application detects an error when the first goroutine to send is successful and the second goroutine encounters an error.</p>\n\n<pre><code>var err error\nfor i := 0; i &lt; 2; i++ {\n  if e := &lt;-errc; e != nil {\n    err = e\n  }\n}\n</code></pre>\n\n<p>Because io.Copy does not return io.EOF, there's no need to check for io.EOF when collecting the errors.</p>\n\n<p>The code can be simplified to use a single goroutine:</p>\n\n<pre><code>errc := make(chan error, 1)\ngo func() {\n    _, err := io.Copy(rw1, rw2)\n    errc &lt;- err\n}()\n\n_, err := io.Copy(rw2, rw1)\n\nif e := &lt;-errc; e != nil {\n   err = e\n}\n</code></pre>\n"}], "owner": {"reputation": 1161, "user_id": 3917295, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/BFoJm.jpg?s=128&g=1", "display_name": "vinllen", "link": "https://stackoverflow.com/users/3917295/vinllen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 47626369, "answer_count": 1, "score": 1, "last_activity_date": 1512377283, "creation_date": 1512360330, "last_edit_date": 1512377283, "question_id": 47626333, "link": "https://stackoverflow.com/questions/47626333/will-goroutine-leakage-happen-that-channel-with-one-buffer-which-have-two-inputs", "title": "Will goroutine leakage happen that channel with one buffer which have two inputs but only one output?", "body": "<p>I have a function that is used to forward a message between two <code>io.ReadWriter</code>s.  Once an error happens, I need to log the error and return. But I think I may have a goroutine leakage problem in my code:</p>\n\n<pre><code>func transport(rw1, rw2 io.ReadWriter) error {\n    errc := make(chan error, 1) // only one buffer\n    go func() {\n        _, err := io.Copy(rw1, rw2)\n        errc &lt;- err\n    }()\n\n    go func() {\n        _, err := io.Copy(rw2, rw1)\n        errc &lt;- err\n    }()\n\n    err := &lt;-errc // only one error catched\n    if err != nil &amp;&amp; err == io.EOF {\n        err = nil\n    }\n    return err\n}\n</code></pre>\n\n<p>Because there is only one error can be caught in this function, will the second goroutine exit and garbaged normally? Or should I write one more <code>err &lt;- errc</code> to receive another error.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512377222, "post_id": 47626052, "comment_id": 82216575, "body": "If <code>Hello</code> takes a single argument then use <code>vals := []reflect.Value{reflect.ValueOf(args)}</code>, if, on the other hand, <code>Hello</code> takes two byte slices you&#39;ll have to first <i>type assert</i> the <code>args interface{}</code> value to get the individual arguments, call <code>reflect.ValueOf</code> on them, put them into a <code>[]reflect.Value{}</code> slice and pass them to <code>Call</code>. <a href=\"https://play.golang.org/p/ssIXKO-RKB\" rel=\"nofollow noreferrer\">play.golang.org/p/ssIXKO-RKB</a>"}, {"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 0, "creation_date": 1512421401, "post_id": 47626052, "comment_id": 82242251, "body": "Isn&#39;t that why we use reflection to figure it out?  Ok it will be a slice of values.  Arguments could be strings, numbers, boolean etc.  Usually just those."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512422802, "post_id": 47626052, "comment_id": 82242878, "body": "Is args (a) the bytes <code>&quot;[[74 111 104 110] [32 97 110 100 32 74 97 110 101]]&quot;</code>, (b) a slice where each element can be any type, (c) a slice where each element is always a []byte, (d) a slice where each element is a value with the correct type for the call, or (e) something else.  Perhaps it will helpful if you tell us what <code>codec.NewDecoder(frame, s.h)</code> is.  If nothing else, show one example value using <code>fmt.Printf(&quot; args : %#v\\n&quot;, req.Args)</code>."}, {"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 0, "creation_date": 1512423889, "post_id": 47626052, "comment_id": 82243483, "body": "(b).  I&#39;ve updated the question to hopefully make it clear.  codec.NewDecoder  is from <code>github.com&#47;ugorji&#47;go&#47;codec</code>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512424731, "post_id": 47626052, "comment_id": 82243882, "body": "See my updated answer."}], "answers": [{"comments": [{"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 0, "creation_date": 1512416371, "post_id": 47626202, "comment_id": 82239834, "body": "that doesn&#39;t work.  <code>Recovered in f reflect: Call using []interface {} as type string.</code>  At the top of the question I mention that args is an <code>interface{}</code>"}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1512359192, "creation_date": 1512359192, "answer_id": 47626202, "question_id": 47626052, "link": "https://stackoverflow.com/questions/47626052/decoding-arguments-using-reflection/47626202#47626202", "title": "Decoding arguments using reflection", "body": "<p>I was wrong - problem is using <code>[]</code> instead of singular value: </p>\n\n<pre><code>  val := reflect.ValueOf(args)\n\n  //  Do some kind of conversion...\n  a := []reflect.Value{val}\n\n  result := f.Call(a) \n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/AqQama-LJv\" rel=\"nofollow noreferrer\">https://play.golang.org/p/AqQama-LJv</a></p>\n"}, {"comments": [{"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 0, "creation_date": 1512416436, "post_id": 47626214, "comment_id": 82239871, "body": "This doesn&#39;t work for me as it stands.  Args is of type <code>interface{}</code>.  See my updated answer in my attempt at solving it."}, {"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 0, "creation_date": 1512437506, "post_id": 47626214, "comment_id": 82248053, "body": "With a bit of tweaking I got this to work.  It was pretty close and just needed other types added."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1512424707, "last_edit_date": 1512424707, "creation_date": 1512359251, "answer_id": 47626214, "question_id": 47626052, "link": "https://stackoverflow.com/questions/47626052/decoding-arguments-using-reflection/47626214#47626214", "title": "Decoding arguments using reflection", "body": "<p>Try the following. </p>\n\n<p>The basic idea is to create a []reflect.Value for the call to reflect.Call by looping over the function arguments. For each argument, convert the incoming argument type to the type expected in the function call.</p>\n\n<pre><code>var req = struct {\n    Ver      int\n    MsgID    int\n    FuncName string\n    Args     interface{}\n}{\n    Args: []interface{}{[]byte(\"John\"), \"Jane\", 123, \"456\"},\n}\nargs := req.Args.([]interface{})\n\nvar funcs Funcs\nf := reflect.ValueOf(funcs).MethodByName(\"Hello\")\nvar callArgs []reflect.Value\nt := f.Type()\n// For each function argument ...\nfor i := 0; i &lt; t.NumIn(); i++ {\n    t := t.In(i)\n    v := reflect.New(t).Elem()\n    if i &lt; len(args) {\n        // Convert arg to type of v and set.\n        arg := args[i]\n        switch t.Kind() {\n        case reflect.String:\n            switch arg := arg.(type) {\n            case string:\n                v.SetString(arg)\n            case []byte:\n                v.SetString(string(arg))\n            default:\n                panic(\"not supported\")\n            }\n        case reflect.Slice:\n            if t.Elem() != reflect.TypeOf(byte(0)) {\n                panic(\"not supported\")\n            }\n            switch arg := arg.(type) {\n            case string:\n                v.SetBytes([]byte(arg))\n            case []byte:\n                v.SetBytes(arg)\n            default:\n                panic(\"not supported\")\n            }\n\n        case reflect.Int:\n            switch arg := arg.(type) {\n            case int:\n                v.SetInt(int64(arg))\n            case string:\n                i, err := strconv.ParseInt(arg, 10, 0)\n                if err != nil {\n                    panic(\"bad int\")\n                }\n                v.SetInt(i)\n            default:\n                panic(\"not supported\")\n            }\n        default:\n            panic(\"not supported\")\n        }\n    }\n    // Collect arguments for the call below.\n    callArgs = append(callArgs, v)\n}\n\nresult := f.Call(callArgs)\nfmt.Println(result)\n</code></pre>\n\n<p>The snippet includes conversions for string, []byte and int types. Conversions for other types can be added.  </p>\n\n<p><a href=\"https://play.golang.org/p/WJR6tRIpPZ\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 713, "favorite_count": 1, "accepted_answer_id": 47626214, "answer_count": 2, "score": 1, "last_activity_date": 1512424707, "creation_date": 1512357727, "last_edit_date": 1512423869, "question_id": 47626052, "link": "https://stackoverflow.com/questions/47626052/decoding-arguments-using-reflection", "title": "Decoding arguments using reflection", "body": "<p>This is a followup question to <a href=\"https://stackoverflow.com/questions/47625370/function-and-argument-unmarshalling-in-go\">Function and argument unmarshalling in go?</a>.  </p>\n\n<p>Given the following interface variable.</p>\n\n<pre><code>var args interface{}\n</code></pre>\n\n<p>Assuming as an example it contained these bytes:</p>\n\n<pre><code>[[74 111 104 110] [32 97 110 100 32 74 97 110 101]]\n</code></pre>\n\n<p>i.e. two strings \"John\", \" and Jane\"</p>\n\n<p>And a function value obtained by MethodByName</p>\n\n<pre><code>f := reflect.ValueOf(s.functions).MethodByName(\"Hello\")\nif f.IsValid() {\n  val := reflect.ValueOf(args)\n  //  Do some kind of conversion...\n\n  result := f.Call(val) // This won't compile. Wrong type.  How do I massage args of type interface{} into what's expected by the call.\n\n}\n</code></pre>\n\n<p>I don't particularly care if it fails. I will capture the failure of the call with recover.</p>\n\n<p>Here is a bit more detail:</p>\n\n<pre><code>var req struct {\n    Ver      int\n    MsgID    int\n    FuncName string\n    Args     interface{}\n}\n\ndec := codec.NewDecoder(frame, s.h)\n\nerr = dec.Decode(&amp;req)\nif err != nil {\n    s.log.Println(err)\n    break\n}\n\nfmt.Println(\"New Msg:\")\nfmt.Printf(\" ver  : %d\\n\", req.Ver)\nfmt.Printf(\" id   : %d\\n\", req.MsgID)\nfmt.Printf(\" func : %s\\n\", req.FuncName)\n\nf := reflect.ValueOf(s.functions).MethodByName(req.FuncName)\nif f.IsValid() {\n    defer func() {\n        if r := recover(); r != nil {\n            fmt.Println(\"Recovered in f\", r)\n        }\n    }()\n\n    fmt.Println(\"Function is: \", req.FuncName)\n    var callArgs []reflect.Value\n    args := reflect.ValueOf(req.Args)\n    t := f.Type()\n    for i := 0; i &lt; t.NumIn(); i++ {\n        t := t.In(i)\n        v := reflect.New(t).Elem()\n        if i &lt; args.Len() {\n            // Convert arg to type of v and set.\n            arg := args.Index(i)\n            switch t.Kind() {\n            case reflect.String:\n                v.SetString(string(reflect.Value.Bytes(arg)))\n            case reflect.Slice:\n                if t.Elem() == reflect.TypeOf(byte(0)) {\n                    v.SetBytes(reflect.Value.Bytes(arg))\n                } else {\n                    panic(\"not supported\")\n                }\n            case reflect.Int:\n                //i, err := strconv.ParseInt(string(arg), 10, 0)\n                // if err != nil {\n                //  panic(\"bad int\")\n                // }\n                // v.SetInt(i)\n            default:\n                panic(\"not supported\")\n            }\n        }\n        // Collect arguments for the call below.\n        callArgs = append(callArgs, v)\n    }\n    result := f.Call(callArgs)\n    fmt.Println(result)\n\n    val := reflect.ValueOf(req.Args)\n    a := []reflect.Value{val}\n\n    r := f.Call(a)\n    fmt.Println(\"Returned\", r[0], r[1])\n}\n</code></pre>\n\n<p>Outputs:</p>\n\n<p>New Msg:\n ver  : 2\n id   : 1\n func : Hello\nFunction is:  Hello\nRecovered in f reflect: call of reflect.Value.Bytes on interface Value</p>\n\n<p>Note:  This is an RPC API.  I have a function name (see link at top of question) and some arguments that are passed in as an array.  The arguments in my example here are strings but could anything that you could pass to a function.  It's whatever the function requires.  It's generic.</p>\n\n<p>e.g. </p>\n\n<p>Hello(name ...string) string</p>\n\n<p>or</p>\n\n<p>Add(n ...int) int</p>\n\n<p>or </p>\n\n<p>DoSomething(a string, b int, c bool)</p>\n\n<p>etc</p>\n\n<p>i.e.  I'm unmarshalling the arguments and I don't know what they are.\nExcept that I do know they will be passed into a slice and\nthrown into a variable Args which has the type <code>interface{}</code>  I hope this makes sense now</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 0, "creation_date": 1512354503, "post_id": 47625616, "comment_id": 82209204, "body": "Thanks this looks like the missing piece of the puzzle.  MethodByName and example usage."}], "tags": [], "owner": {"reputation": 3063, "user_id": 5075720, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-kNyMGvaELDs/AAAAAAAAAAI/AAAAAAAAVnw/P1Rt8TFE2gc/photo.jpg?sz=128", "display_name": "PaSTE", "link": "https://stackoverflow.com/users/5075720/paste"}, "is_accepted": false, "score": 1, "last_activity_date": 1512354012, "creation_date": 1512354012, "answer_id": 47625616, "question_id": 47625370, "link": "https://stackoverflow.com/questions/47625370/function-and-argument-unmarshalling-in-go/47625616#47625616", "title": "Function and argument unmarshalling in go?", "body": "<p>You can do this using the <code>reflect</code> package (general caveats about performance and code readability apply).  Just create a type and implement the functions for that type, then call <a href=\"https://golang.org/pkg/reflect/#Value.MethodByName\" rel=\"nofollow noreferrer\">reflect.MethodByName()</a> on a <code>Value</code> created from an instance of that type:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype functions struct {}\n\nfunc (f functions) Hello(name string) (string, error) {\n    fmt.Println(\"Hello,\", name)\n    return name, nil\n}\n\nfunc main() {\n    var f functions\n    m := reflect.ValueOf(f).MethodByName(\"Hello\")\n    if m.IsValid() {\n        // Either call f.Hello() here, or use the returned Value like so:\n        v := make([]reflect.Value, 1) // function Values only take Value slices as arguments\n        v[0] = reflect.ValueOf(\"Asha\")\n        r := m.Call(v)\n        fmt.Println(\"Returned\", r)\n    }\n}\n</code></pre>\n\n<p>This prints:</p>\n\n<p><code>Hello, Asha\nReturned [Asha &lt;error Value&gt;]</code></p>\n\n<p>(See <a href=\"https://play.golang.org/p/0q1i3WBuAL\" rel=\"nofollow noreferrer\">https://play.golang.org/p/0q1i3WBuAL</a>)</p>\n\n<p>However, if you know the function names you want to be able to call <em>a priori</em>, or if you want the user to be able to use names other than the exact function name, just use a <code>switch</code> or <code>if</code>/<code>else</code> statement:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc Hello(name string) {\n    fmt.Println(\"Hello,\", name)\n}\n\nfunc main() {\n    userInput := make([]string, 2)\n    userInput[0] = \"HeLlO\"\n    userInput[1] = \"\uc7ac\uc740\"\n\n    switch(strings.ToLower(userInput[0])) { // allow any case\n    case \"hello\":\n        Hello(userInput[1])\n    default:\n        panic(\"user input not recognized\")\n    }\n}\n</code></pre>\n\n<p>This prints:</p>\n\n<p><code>Hello, \uc7ac\uc740</code></p>\n\n<p>(See <a href=\"https://play.golang.org/p/oBxsI42q4a\" rel=\"nofollow noreferrer\">https://play.golang.org/p/oBxsI42q4a</a>)</p>\n"}], "owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1512354012, "creation_date": 1512351766, "question_id": 47625370, "link": "https://stackoverflow.com/questions/47625370/function-and-argument-unmarshalling-in-go", "title": "Function and argument unmarshalling in go?", "body": "<p>Given an interface containing functions with varying parameters and a concrete implementation of that interface how do I take a stream of bytes and call methods from the interface based on that byte stream.  Basically an RPC call.</p>\n\n<p>e.g. </p>\n\n<pre><code>type funcs interface {\n  func Hello(name string) (string, error)\n  func Add(numbers...int) (result, error)\n}\n</code></pre>\n\n<p>And lets say I had the following input data</p>\n\n<pre><code>Hello John\nAdd 1 2 3 4\n</code></pre>\n\n<p>I figure this has to be done with reflection but this package I find a bit of mystery to use.  Not great examples.  Looking at RPC packages is also a bit mysterious. I don't understand what they are doing and there seem to be limitations or assumptions, perhaps to make the code simpler and/or faster to implement.</p>\n\n<p>Can someone shed some light on how I might take the string \"Hello\" and find the function handle \"Hello\" from the funcs table.  And know that it's expecting a single parameter that is a string and then calling that function with the argument provided \"John\".  </p>\n"}, {"tags": ["http", "go", "middleware"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1512377083, "post_id": 47625304, "comment_id": 82216502, "body": "<a href=\"https://stackoverflow.com/q/47558164/720999\">See also</a>."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 5, "last_activity_date": 1513605857, "last_edit_date": 1513605857, "creation_date": 1512354157, "answer_id": 47625639, "question_id": 47625304, "link": "https://stackoverflow.com/questions/47625304/how-to-reuse-request-body-of-http-request-between-http-middleware-handlers/47625639#47625639", "title": "How to reuse request body of *http.Request between HTTP middleware handlers?", "body": "<p>The outer handler reads the request body to EOF. When the inner handler is called, there's nothing more to read from the body.</p>\n\n<p>To fix the issue, restore the request body with the data read previously in the outer handler:</p>\n\n<pre><code>func Registration(w http.ResponseWriter, r *http.Request) {\n    b, err := ioutil.ReadAll(r.Body) \n    // ...other code\n    r.Body = ioutil.NopCloser(bytes.NewReader(b))\n    user.Create(w, r)\n}\n</code></pre>\n\n<p>The function <code>bytes.NewReader()</code> returns a <code>io.Reader</code> on a byte slice.  The function <code>ioutil.NopCloser</code> converts an <code>io.Reader</code> to the <code>io.ReadCloser</code> required for <code>r.Body</code>. </p>\n"}, {"comments": [{"owner": {"reputation": 109, "user_id": 2585537, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/45c821c7954c157acdfddaa50653d464?s=128&d=identicon&r=PG", "display_name": "Chen", "link": "https://stackoverflow.com/users/2585537/chen"}, "edited": false, "score": 0, "creation_date": 1555988579, "post_id": 47665056, "comment_id": 98275617, "body": "I think it is necessary to call r.Body.Close() before this line"}], "tags": [], "owner": {"reputation": 640, "user_id": 3197412, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2eb2a78a67a1736e656f716f2cb5e65?s=128&d=identicon&r=PG", "display_name": "batazor", "link": "https://stackoverflow.com/users/3197412/batazor"}, "is_accepted": true, "score": 0, "last_activity_date": 1512521202, "creation_date": 1512521202, "answer_id": 47665056, "question_id": 47625304, "link": "https://stackoverflow.com/questions/47625304/how-to-reuse-request-body-of-http-request-between-http-middleware-handlers/47665056#47665056", "title": "How to reuse request body of *http.Request between HTTP middleware handlers?", "body": "<p>In the end, I was able to recover data in this way:</p>\n\n<pre><code>r.Body = ioutil.NopCloser(bytes.NewBuffer(b))\n</code></pre>\n"}], "owner": {"reputation": 640, "user_id": 3197412, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2eb2a78a67a1736e656f716f2cb5e65?s=128&d=identicon&r=PG", "display_name": "batazor", "link": "https://stackoverflow.com/users/3197412/batazor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1574, "favorite_count": 1, "accepted_answer_id": 47665056, "answer_count": 2, "score": 3, "last_activity_date": 1513605857, "creation_date": 1512351205, "last_edit_date": 1512377043, "question_id": 47625304, "link": "https://stackoverflow.com/questions/47625304/how-to-reuse-request-body-of-http-request-between-http-middleware-handlers", "title": "How to reuse request body of *http.Request between HTTP middleware handlers?", "body": "<p>I use go-chi as HTTP-router, and I want to reuse one method inside another</p>\n\n<pre><code>func Registration(w http.ResponseWriter, r *http.Request) {\n    b, err := ioutil.ReadAll(r.Body) // if you delete this line, the user will be created   \n    // ...other code\n\n    // if all good then create new user\n    user.Create(w, r)\n}\n\n...\n\nfunc Create(w http.ResponseWriter, r *http.Request) {\n  b, err := ioutil.ReadAll(r.Body)  \n  // ...other code\n\n  // ... there I get the problem with parse JSON from &amp;b\n}\n</code></pre>\n\n<p><code>user.Create</code> return error <code>\"unexpected end of JSON input\"</code></p>\n\n<p>Actually, after I executed <code>ioutil.ReadAll</code><br>\n<code>user.Create</code> ceased to parse JSON,<br>\nin <code>r.Body</code> there was an empty array<code>[]</code>how can I fix this problem?</p>\n"}, {"tags": ["go", "scope", "shadowing"], "comments": [{"owner": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "edited": false, "score": 3, "creation_date": 1512342665, "post_id": 47624326, "comment_id": 82206516, "body": "Wait, it&#39;s not a &quot;clash&quot; but rather what is called &quot;shadowing.&quot; Are you asking whether there is a way for code inside <code>main</code> to refer to the global <code>a</code> even though the inner <code>a</code> is shadowing (hiding) it?"}, {"owner": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "edited": false, "score": 2, "creation_date": 1512342795, "post_id": 47624326, "comment_id": 82206558, "body": "BTW this might help: <a href=\"https://developmentality.wordpress.com/2014/03/03/go-gotcha-1-variable-shadowing-within-inner-scope-due-to-use-of-operator/\" rel=\"nofollow noreferrer\">developmentality.wordpress.com/2014/03/03/&hellip;</a> (found it by Googling &quot;golang shadow&quot;)"}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1512345875, "post_id": 47624326, "comment_id": 82207325, "body": "If you want to change the value of the global variable just do <code>a = &quot;bye&quot;</code> instead of <code>a := &quot;bye&quot;</code>"}, {"owner": {"reputation": 73, "user_id": 2151980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc5586bdb0cf86839413ca5221492703?s=128&d=identicon&r=PG", "display_name": "Nikhil H", "link": "https://stackoverflow.com/users/2151980/nikhil-h"}, "reply_to_user": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "edited": false, "score": 0, "creation_date": 1512384869, "post_id": 47624326, "comment_id": 82221122, "body": "@RayToal yes, that&#39;s what I am asking for, but as it seems from the answers below that might not be possible."}, {"owner": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "edited": false, "score": 1, "creation_date": 1512466662, "post_id": 47624326, "comment_id": 82258755, "body": "It is possible in many other programming languages (e.g., C++ has <code>::</code>, Ada has <code>subprogram.name</code>), but Go doesn&#39;t seem to have a way to do that."}], "answers": [{"tags": [], "owner": {"reputation": 59, "user_id": 4684258, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uRg5h.jpg?s=128&g=1", "display_name": "mfrw", "link": "https://stackoverflow.com/users/4684258/mfrw"}, "is_accepted": false, "score": 1, "last_activity_date": 1512377467, "last_edit_date": 1512377467, "creation_date": 1512342789, "answer_id": 47624382, "question_id": 47624326, "link": "https://stackoverflow.com/questions/47624326/clashing-global-and-local-variable-name/47624382#47624382", "title": "Clashing global and local variable name", "body": "<p>This is called variable shadowing.\nYou just name them differently. </p>\n\n<p>You can't just ask go to behave differently.</p>\n"}, {"comments": [{"owner": {"reputation": 73, "user_id": 2151980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc5586bdb0cf86839413ca5221492703?s=128&d=identicon&r=PG", "display_name": "Nikhil H", "link": "https://stackoverflow.com/users/2151980/nikhil-h"}, "edited": false, "score": 0, "creation_date": 1512385091, "post_id": 47624512, "comment_id": 82221246, "body": "Is there a way to use both variables with same name and different scopes?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1512398500, "post_id": 47624512, "comment_id": 82229378, "body": "No. Variables are referenced by name. If two have the same name, you&#39;ll only be able to refer to one of them in any given scope."}], "tags": [], "owner": {"reputation": 9345, "user_id": 4237316, "user_type": "registered", "accept_rate": 47, "profile_image": "https://graph.facebook.com/100004533998341/picture?type=large", "display_name": "Harald Nordgren", "link": "https://stackoverflow.com/users/4237316/harald-nordgren"}, "is_accepted": true, "score": 8, "last_activity_date": 1512386915, "last_edit_date": 1512386915, "creation_date": 1512343875, "answer_id": 47624512, "question_id": 47624326, "link": "https://stackoverflow.com/questions/47624326/clashing-global-and-local-variable-name/47624512#47624512", "title": "Clashing global and local variable name", "body": "<p>I think your original example illustrates the situation well. Just like most in programming languages the scope matters.</p>\n\n<p>The scoping closest to the use is what decides the value of <code>a</code>. So if you redeclare (<code>:=</code>) the variable inside your function, then for the duration of that function you will have the value <code>\"bye\"</code>.</p>\n\n<p>If you chose to use the same name for two things, the consequence is that the inner name will always dominate. If you need both values then name the variables differently.</p>\n"}, {"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 4, "last_activity_date": 1512390183, "creation_date": 1512390183, "answer_id": 47633309, "question_id": 47624326, "link": "https://stackoverflow.com/questions/47624326/clashing-global-and-local-variable-name/47633309#47633309", "title": "Clashing global and local variable name", "body": "<p>Well, this is not really a solution but a workaround. Before creating a shadowning variable, you can make a pointer to an outside variable.</p>\n\n<pre><code>var a string = \"hello\"\n\nfunc main() {\n    b := \"world\"\n\n    fmt.Println(a, b)\n\n    pa := &amp;a\n    a := \"bye\"\n\n    fmt.Println(*pa, b, a)\n}\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 2151980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc5586bdb0cf86839413ca5221492703?s=128&d=identicon&r=PG", "display_name": "Nikhil H", "link": "https://stackoverflow.com/users/2151980/nikhil-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2022, "favorite_count": 0, "accepted_answer_id": 47624512, "answer_count": 3, "score": 2, "last_activity_date": 1514299245, "creation_date": 1512342422, "last_edit_date": 1514299245, "question_id": 47624326, "link": "https://stackoverflow.com/questions/47624326/clashing-global-and-local-variable-name", "title": "Clashing global and local variable name", "body": "<p>Here is the code snippet in question:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nvar a string = \"hello\"\n\nfunc main() {\n    b := \"world\"\n\n    fmt.Println(a, b)\n\n    a := \"bye\"\n\n    fmt.Println(a, b)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>hello world\nbye world\n</code></pre>\n\n<p>My question is, how do I resolve name clash between the \"global\" and \"local\" variables <code>a</code>?</p>\n\n<p>More specifically, how do I tell Go which <code>a</code> to use?</p>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1512344321, "post_id": 47624318, "comment_id": 82206939, "body": "Don&#39;t call <code>reflect.TypeOf(subtyp)</code>, <code>subtyp</code> is already of type <code>reflect.Type</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1512345100, "post_id": 47624318, "comment_id": 82207108, "body": "<a href=\"https://play.golang.org/p/Th0uGACjwH\" rel=\"nofollow noreferrer\">play.golang.org/p/Th0uGACjwH</a> this is just an example, i don&#39;t like the way i&#39;m handling the field names but it&#39;s getting late here, so this&#39;ll hopefully point you to the right direction."}], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 9048256, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c32f35ab2d5bf056c400464f5e505630?s=128&d=identicon&r=PG&f=1", "display_name": "Coder Jones", "link": "https://stackoverflow.com/users/9048256/coder-jones"}, "edited": false, "score": 0, "creation_date": 1512434631, "post_id": 47625992, "comment_id": 82247313, "body": "Thanks this works.   If I wanted to pass a struct with values, is it possible to also extract the values for each field ? i.e.parent := Parent{Name: &quot;Joe&quot;, Children: []*child{&amp;child{Name: &quot;Bobby&quot;, Age: 4,},},}   Then the output would print  &quot;Name *string (ptr to string) (Bobby)&quot;   ?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 63, "user_id": 9048256, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c32f35ab2d5bf056c400464f5e505630?s=128&d=identicon&r=PG&f=1", "display_name": "Coder Jones", "link": "https://stackoverflow.com/users/9048256/coder-jones"}, "edited": false, "score": 0, "creation_date": 1512435008, "post_id": 47625992, "comment_id": 82247395, "body": "The code above works on types as asked in the question. The code for values will be very similar. Use fmt.Sprintf(&quot;%v&quot;, v) to print the values."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1512357265, "creation_date": 1512357265, "answer_id": 47625992, "question_id": 47624318, "link": "https://stackoverflow.com/questions/47624318/golang-recurisive-reflection/47625992#47625992", "title": "golang recurisive reflection", "body": "<p>Here's one way to do it. </p>\n\n<pre><code>func printType(prefix string, t reflect.Type, visited map[reflect.Type]bool) {\n\n    // Print the name of this type with opening ( for description.\n    fmt.Printf(\"%s (\", t)\n\n    // Traverse elements, adding to description as we go.\nelems:\n    for {\n        switch t.Kind() {\n        case reflect.Ptr:\n            fmt.Print(\"ptr to \")\n        case reflect.Slice:\n            fmt.Print(\"slice of \")\n        case reflect.Array:\n            fmt.Printf(\"array with %d elements of \", t.Len())\n        default:\n            break elems\n        }\n        t = t.Elem()\n    }\n\n    // Print the kind of the type and the closing ) of the description.\n    // In the case of a struct, we print the names of the fields and recurse.\n    switch t.Kind() {\n    case reflect.Struct:\n        fmt.Printf(\"struct with %d fields)\\n\", t.NumField())\n        if visited[t] {\n            // Don't blow up on recursive type definition.\n            break\n        }\n        visited[t] = true\n        prefix += \"    \"\n        for i := 0; i &lt; t.NumField(); i++ {\n            f := t.Field(i)\n            fmt.Print(prefix, f.Name, \" \")\n            printType(prefix, f.Type, visited)\n        }\n    default:\n        fmt.Printf(\"%s)\\n\", t.Kind())\n    }\n}\n\nfunc main() {\n    printType(\"\", reflect.TypeOf(Parent{}), make(map[reflect.Type]bool))\n}\n</code></pre>\n\n<p>The output for Parent{} given the following types:</p>\n\n<pre><code>type child struct {\n    Name *string\n    Age  int\n}\n\ntype Parent struct {\n    Name     string\n    Surname  *string\n    Children []*child\n    PetNames []string\n    Parents  [2]*Parent\n    child\n}\n</code></pre>\n\n<p>is:</p>\n\n<pre><code>main.Parent (struct with 6 fields)\n    Name string (string)\n    Surname *string (ptr to string)\n    Children []*main.child (slice of ptr to struct with 2 fields)\n        Name *string (ptr to string)\n        Age int (int)\n    PetNames []string (slice of string)\n    Parents [2]*main.Parent (array with 2 elements of ptr to struct with 6 fields)\n    child main.child (struct with 2 fields)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/LEaanxYN2v\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 63, "user_id": 9048256, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c32f35ab2d5bf056c400464f5e505630?s=128&d=identicon&r=PG&f=1", "display_name": "Coder Jones", "link": "https://stackoverflow.com/users/9048256/coder-jones"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 288, "favorite_count": 0, "accepted_answer_id": 47625992, "answer_count": 1, "score": 1, "last_activity_date": 1512357265, "creation_date": 1512342345, "question_id": 47624318, "link": "https://stackoverflow.com/questions/47624318/golang-recurisive-reflection", "title": "golang recurisive reflection", "body": "<p>\nI am trying to reflect recursively over a struct, printing out the type of each field.   Where a field is an slice of structs, I'd like to be able to \nidentify the type held in the array and then reflect over that type.</p>\n\n<p>\nHere is some sample code</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"log\"\n    \"reflect\"\n)\n\ntype child struct {\n    Name *string\n    Age  int\n}\n\ntype Parent struct {\n    Name     string\n    Surname  *string\n    Children []*child\n    PetNames []string\n}\n\nfunc main() {\n\n    typ := reflect.TypeOf(Parent{})\n    log.Printf(\"This is a : %s\", typ.Kind())\n\n    for i := 0; i &lt; typ.NumField(); i++ {\n        p := typ.Field(i)\n        if !p.Anonymous {\n            switch p.Type.Kind() {\n            case reflect.Ptr:\n                log.Printf(\"Ptr: %s is a type %s\", p.Name, p.Type)\n            case reflect.Slice:\n                log.Printf(\"Slice: %s is a type %s\", p.Name, p.Type)\n                subtyp := p.Type.Elem()\n                if subtyp.Kind() == reflect.Ptr {\n                    subtyp = subtyp.Elem()\n                }\n                log.Printf(\"\\tDereferenced Type%s\", subtyp)\n            default:\n                log.Printf(\"Default: %s is a type %s\", p.Name, p.Type)\n            }\n        }\n    }\n\n}\n</code></pre>\n\n<p>\nThe output looks like this:</p>\n\n<pre><code>This is a : struct\nDefault: Name is a type string\nPtr: Surname is a type *string\nSlice: Children is a type []*main.child\n    Dereferenced Type main.child\nSlice: PetNames is a type []string\n    Dereferenced Type string\n</code></pre>\n\n\n\n<p>When I identify that a field type is a slice of pointers, I am able to infer the type by calling subtype.Elem().</p>\n\n<p>The output is 'main.child'</p>\n\n<p>If I then try to reflect child using</p>\n\n<pre><code>subSubType := reflect.TypeOf(subtyp)\nlog.Printf(\"%+v\", subSubType) \n</code></pre>\n\n<p>I get the following:</p>\n\n<pre><code> *reflect.rtype\n</code></pre>\n\n<p>How can I use the reflection API to iterate over the fields of the child struct?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1512332623, "post_id": 47622888, "comment_id": 82203655, "body": "<a href=\"https://play.golang.org/p/z_3D6tn2yn\" rel=\"nofollow noreferrer\">play.golang.org/p/z_3D6tn2yn</a>"}], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1512332631, "creation_date": 1512332631, "answer_id": 47622922, "question_id": 47622888, "link": "https://stackoverflow.com/questions/47622888/space-required-for-golang-interface/47622922#47622922", "title": "Space required for Golang interface", "body": "<p>Interace is a structure of 2 words: </p>\n\n<ul>\n<li>pointer to data </li>\n<li>pointer to itab - table of methods.</li>\n</ul>\n\n<p>So at 64-bit machine: it will take 8*2=16 bytes.</p>\n"}, {"tags": [], "owner": {"reputation": 465, "user_id": 1936173, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/8uQ1j.png?s=128&g=1", "display_name": "Illia Danko", "link": "https://stackoverflow.com/users/1936173/illia-danko"}, "is_accepted": true, "score": 5, "last_activity_date": 1512435607, "last_edit_date": 1512435607, "creation_date": 1512340596, "answer_id": 47624101, "question_id": 47622888, "link": "https://stackoverflow.com/questions/47622888/space-required-for-golang-interface/47624101#47624101", "title": "Space required for Golang interface", "body": "<ul>\n<li>interface consumes 2 words of memory: 1 word for runtime type and 1 word for data pointer;</li>\n<li>string consumes 2 words of memory: 1 word for base pointer and 1 word for length;</li>\n<li>slice consumes 3 words of memory: 1 word for base pointer, 1 word for length and 1 word for capacity;</li>\n<li>function, channel and map consume 1 word.</li>\n</ul>\n\n<p>Based on the machine type(32bit or 64bit) word size is 4 bytes length or 8 bytes length respectively.</p>\n"}], "owner": {"reputation": 16096, "user_id": 2014591, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7d6cff955bb3f1865a419650bfe1372c?s=128&d=identicon&r=PG", "display_name": "hlin117", "link": "https://stackoverflow.com/users/2014591/hlin117"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 329, "favorite_count": 1, "accepted_answer_id": 47624101, "answer_count": 2, "score": 1, "last_activity_date": 1512435607, "creation_date": 1512332464, "last_edit_date": 1512332604, "question_id": 47622888, "link": "https://stackoverflow.com/questions/47622888/space-required-for-golang-interface", "title": "Space required for Golang interface", "body": "\n\n<p>How much space (in bytes) does a Golang interface take up?</p>\n\n<p>For example, which would take up more space?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Stringer interface { String() string }\n\nstrSlice := make([]string, 4)\nstringerSlice := make([]Stringer, 4)\n</code></pre>\n"}, {"tags": ["go", "path"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1512330291, "post_id": 47622494, "comment_id": 82202895, "body": "run the executable from <code>&#47;Users&#47;i02222333&#47;go&#47;src&#47;myapp</code> then. Where the source code/project is doesn&#39;t really matter, what matters is from which folder you start the executable."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1512330392, "post_id": 47622494, "comment_id": 82202930, "body": "@tkausl - I run the command inside the test file (the end of the first path) , there I should know that path in 2 level up <code>myapp</code>, how should I do it? can you provide example ?"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1512395219, "post_id": 47625114, "comment_id": 82227216, "body": "You should be using <code>filepath</code> rather than <code>path</code> for file paths, and if you&#39;re going through the motions of joining rather than simple string concatenation, don&#39;t hardcode the <code>&#47;</code> separator in there."}], "tags": [], "owner": {"reputation": 2620, "user_id": 6489829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a56125658a5592143ade081194b89d6f?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Gore", "link": "https://stackoverflow.com/users/6489829/jack-gore"}, "is_accepted": true, "score": 0, "last_activity_date": 1512349464, "creation_date": 1512349464, "answer_id": 47625114, "question_id": 47622494, "link": "https://stackoverflow.com/questions/47622494/how-to-get-root-folder-of-project-two-level-up/47625114#47625114", "title": "How to get root folder of project, two level up", "body": "<p>You can get the directory name of '../../' using the <code>path</code> package like this:</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"os\"\n    \"path\"\n)\n\nfunc main() {\n    dirname, err := os.Getwd()\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Printf(\"Current directory: %v\\n\", dirname)\n    dir, err := os.Open(path.Join(dirname, \"../../\"))\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Printf(\"Name of ../../: %v\\n\", dir.Name())\n}\n</code></pre>\n\n<p>Here is an example of my output:</p>\n\n<pre><code>$ go run main.go\nCurrent directory: /Users/jack/go/src/stackoverflow/example/directory\nName of ../../: /Users/jack/go/src/stackoverflow\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2040, "favorite_count": 0, "accepted_answer_id": 47625114, "answer_count": 1, "score": 2, "last_activity_date": 1512349464, "creation_date": 1512330154, "last_edit_date": 1512331027, "question_id": 47622494, "link": "https://stackoverflow.com/questions/47622494/how-to-get-root-folder-of-project-two-level-up", "title": "How to get root folder of project, two level up", "body": "<p>Im inside deep folder inside file and I want to get the dir which is 2 level up, I see the following api but not sure how to add something like \n\"../../\" , any idea? </p>\n\n<pre><code>  dir, err := os.Getwd()\n</code></pre>\n\n<p>for example I  get the following </p>\n\n<pre><code>/Users/i02222333/go/src/myapp/src/test\n</code></pre>\n\n<p>And I need </p>\n\n<pre><code>/Users/i02222333/go/src/myapp\n</code></pre>\n\n<p>I can cut the string with the path with some manipulation but my question is if there is better solution to do it with golang ?</p>\n"}, {"tags": ["go", "amazon-s3", "aws-sdk-go"], "comments": [{"owner": {"reputation": 15273, "user_id": 2980607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6ee98ba9cb770efb26642e7ab18dfe8?s=128&d=identicon&r=PG&f=1", "display_name": "peteb", "link": "https://stackoverflow.com/users/2980607/peteb"}, "edited": false, "score": 1, "creation_date": 1512326145, "post_id": 47621804, "comment_id": 82201482, "body": "Post what you&#39;ve already tried to do."}, {"owner": {"reputation": 179, "user_id": 3891823, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1510554955/picture?type=large", "display_name": "Eric Reis Figueiredo", "link": "https://stackoverflow.com/users/3891823/eric-reis-figueiredo"}, "reply_to_user": {"reputation": 15273, "user_id": 2980607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6ee98ba9cb770efb26642e7ab18dfe8?s=128&d=identicon&r=PG&f=1", "display_name": "peteb", "link": "https://stackoverflow.com/users/2980607/peteb"}, "edited": false, "score": 0, "creation_date": 1512326359, "post_id": 47621804, "comment_id": 82201542, "body": "I have only tried to do what the examples from AWS suggests. Open a file from your system and the upload it to S3. I am going to edit the question with the examples. My bad."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1512327100, "post_id": 47621804, "comment_id": 82201809, "body": "Show what you are trying to upload. s3manager.UploadInput.Body is an io.Reader. Create an io.Reader using bytes.NewReader, strings.NewReader, bytes.Buffer or any other number of types that support the interface."}, {"owner": {"reputation": 179, "user_id": 3891823, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1510554955/picture?type=large", "display_name": "Eric Reis Figueiredo", "link": "https://stackoverflow.com/users/3891823/eric-reis-figueiredo"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512327292, "post_id": 47621804, "comment_id": 82201886, "body": "@CeriseLim&#243;n i think that will solve my problems I was so focused on the file that i didn&#39;t event realized that s3manager.UploadInput.Body was and io.Reader. Totally my fault. I am testing it now and I will post here the result."}, {"owner": {"reputation": 1748, "user_id": 4106031, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NM3jO.jpg?s=128&g=1", "display_name": "Alok Kumar Singh", "link": "https://stackoverflow.com/users/4106031/alok-kumar-singh"}, "edited": false, "score": 0, "creation_date": 1536035198, "post_id": 47621804, "comment_id": 91267499, "body": "@EricReisFigueiredo Can you post the answer how did you use the io.Reader"}, {"owner": {"reputation": 179, "user_id": 3891823, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1510554955/picture?type=large", "display_name": "Eric Reis Figueiredo", "link": "https://stackoverflow.com/users/3891823/eric-reis-figueiredo"}, "reply_to_user": {"reputation": 1748, "user_id": 4106031, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NM3jO.jpg?s=128&g=1", "display_name": "Alok Kumar Singh", "link": "https://stackoverflow.com/users/4106031/alok-kumar-singh"}, "edited": false, "score": 0, "creation_date": 1536189998, "post_id": 47621804, "comment_id": 91338798, "body": "@AlokKumarSingh sure, I will post the details in the answers"}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 40792, "user_id": 563420, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/715062f31800335c2a33422b311dbb93?s=128&d=identicon&r=PG", "display_name": "rynop", "link": "https://stackoverflow.com/users/563420/rynop"}, "edited": false, "score": 0, "creation_date": 1541750059, "post_id": 47622067, "comment_id": 93330295, "body": "@rynop: Yes, you can pass any type that implements the <code>io.Reader</code> interface, including, obviously, a <code>*bytes.Buffer</code>.  That&#39;s what &quot;any <code>io.Reader</code> you want&quot; means in the answer."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 3, "last_activity_date": 1512327582, "creation_date": 1512327582, "answer_id": 47622067, "question_id": 47621804, "link": "https://stackoverflow.com/questions/47621804/upload-object-to-aws-s3-without-creating-a-file-using-aws-sdk-go/47622067#47622067", "title": "Upload object to AWS S3 without creating a file using aws-sdk-go", "body": "<p>The <code>Body</code> field of the <a href=\"https://godoc.org/github.com/aws/aws-sdk-go/service/s3/s3manager#UploadInput\" rel=\"nofollow noreferrer\"><code>UploadInput</code></a> struct is just an <code>io.Reader</code>. So pass any <code>io.Reader</code> you want--it doesn't need to be a file.</p>\n"}, {"tags": [], "owner": {"reputation": 179, "user_id": 3891823, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1510554955/picture?type=large", "display_name": "Eric Reis Figueiredo", "link": "https://stackoverflow.com/users/3891823/eric-reis-figueiredo"}, "is_accepted": false, "score": 6, "last_activity_date": 1536194275, "creation_date": 1536194275, "answer_id": 52194978, "question_id": 47621804, "link": "https://stackoverflow.com/questions/47621804/upload-object-to-aws-s3-without-creating-a-file-using-aws-sdk-go/52194978#52194978", "title": "Upload object to AWS S3 without creating a file using aws-sdk-go", "body": "<p>In this answer, I will post all the things that worked for me that related to this question. Many thanks to @ThunderCat and @Flimzy that alerted me that the body parameter of the upload request was already an io.Reader. I will post some sample codes commenting on what I've learned from this question and how it helped me solve this problem. Perhaps this will help others like me and @AlokKumarSingh.</p>\n\n<p><strong>Case 1: You already have the data in memory (e.g. receiving data from a streaming/messaging service like Kafka, Kinesis or SQS)</strong></p>\n\n<pre><code>func main() {\n    if len(os.Args) != 3 {\n        fmt.Printf(\n            \"bucket and file name required\\nUsage: %s bucket_name filename\",\n            os.Args[0],\n        )\n    }\n\n    bucket := os.Args[1]\n    filename := os.Args[2]\n\n    // this is your data that you have in memory\n    // in this example it is hard coded but it may come from very distinct\n    // sources, like streaming services for example.\n    data := \"Hello, world!\"\n\n    // create a reader from data data in memory\n    reader := strings.NewReader(data)\n\n    sess, err := session.NewSession(&amp;aws.Config{\n        Region: aws.String(\"us-east-1\")},\n    )\n    uploader := s3manager.NewUploader(sess)\n\n    _, err = uploader.Upload(&amp;s3manager.UploadInput{\n        Bucket: aws.String(bucket),\n        Key: aws.String(filename),\n        // here you pass your reader\n        // the aws sdk will manage all the memory and file reading for you\n        Body: reader,\n    })\n    if err != nil {.\n        fmt.Printf(\"Unable to upload %q to %q, %v\", filename, bucket, err)\n    }\n\n    fmt.Printf(\"Successfully uploaded %q to %q\\n\", filename, bucket)\n}\n</code></pre>\n\n<p><strong>Case 2: You already have a persisted file and you want to upload it but you dont want to maintain the whole file in memory:</strong></p>\n\n<pre><code>func main() {\n    if len(os.Args) != 3 {\n        fmt.Printf(\n            \"bucket and file name required\\nUsage: %s bucket_name filename\",\n            os.Args[0],\n        )\n    }\n\n    bucket := os.Args[1]\n    filename := os.Args[2]\n\n    // open your file\n    // the trick here is that the method os.Open just returns for you a reader\n    // for the desired file, so you will not maintain the whole file in memory.\n    // I know this might sound obvious, but for a starter (as I was at the time\n    // of the question) it is not.\n    fileReader, err := os.Open(filename)\n    if err != nil {\n        fmt.Printf(\"Unable to open file %q, %v\", err)\n    }\n    defer fileReader.Close()\n\n    sess, err := session.NewSession(&amp;aws.Config{\n        Region: aws.String(\"us-east-1\")},\n    )\n    uploader := s3manager.NewUploader(sess)\n\n    _, err = uploader.Upload(&amp;s3manager.UploadInput{\n        Bucket: aws.String(bucket),\n        Key:    aws.String(filename),\n        // here you pass your reader\n        // the aws sdk will manage all the memory and file reading for you\n        Body: fileReader,\n    })\n    if err != nil {\n        fmt.Printf(\"Unable to upload %q to %q, %v\", filename, bucket, err)\n    }\n\n    fmt.Printf(\"Successfully uploaded %q to %q\\n\", filename, bucket)\n}\n</code></pre>\n\n<p><strong>Case 3: This is how I implemented it on the final version of my system, but to understand why I did it I must give you some background.</strong></p>\n\n<p>My use case evolved a bit. The upload code was going to be a function in Lambda and the files turned out to be huge. What do this changes mean: If I uploaded the file via an entry point in API Gateway attached to a Lambda function I would have to wait for the whole file to complete the upload in Lambda. Since lambda is priced by the duration and memory usage of the invocation, this could be a really big problem.</p>\n\n<p>So, to solve this problem I used a pre-signed post URL for the upload. How does this affect the architecture/workflow?</p>\n\n<p>Instead of upload to S3 from my backend code, I just create and authenticate a URL for posting the object to S3 in the backend and send this URL to the frontend. With that, I just implemented a multipart upload to that URL. I know that this is a lot more specific than the question, but it wasn't easy to discover this solution, so I think it would be a good idea to document it here for others.</p>\n\n<p>Here is a sample of how to create that pre-signed URL in <em>nodejs</em>.</p>\n\n<pre><code>const AWS = require('aws-sdk');\n\nmodule.exports.upload = async (event, context, callback) =&gt; {\n\n  const s3 = new AWS.S3({ signatureVersion: 'v4' });\n  const body = JSON.parse(event.body);\n\n  const params = {\n    Bucket: process.env.FILES_BUCKET_NAME,\n    Fields: {\n      key: body.filename,\n    },\n    Expires: 60 * 60\n  }\n\n  let promise = new Promise((resolve, reject) =&gt; {\n    s3.createPresignedPost(params, (err, data) =&gt; {\n      if (err) {\n        reject(err);\n      } else {\n        resolve(data);\n      }\n    });\n  })\n\n  return await promise\n    .then((data) =&gt; {\n      return {\n        statusCode: 200,\n        body: JSON.stringify({\n          message: 'Successfully created a pre-signed post url.',\n          data: data,\n        })\n      }\n    })\n    .catch((err) =&gt; {\n      return {\n        statusCode: 400,\n        body: JSON.stringify({\n          message: 'An error occurred while trying to create a pre-signed post url',\n          error: err,\n        })\n      }\n    });\n};\n</code></pre>\n\n<p>If you want to use <em>go</em> it's the same idea, you just have to change de sdk.</p>\n"}, {"comments": [{"owner": {"reputation": 1888, "user_id": 4322357, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8b45d8603128dd706074ab9f1544860e?s=128&d=identicon&r=PG&f=1", "display_name": "Cole Bittel", "link": "https://stackoverflow.com/users/4322357/cole-bittel"}, "edited": false, "score": 0, "creation_date": 1558536745, "post_id": 52248173, "comment_id": 99135762, "body": "You&#39;ve noted that you uploaded the body as <code>s.bodyBuf</code> but you haven&#39;t demonstrated what <code>bodyBuf</code> is or looks like. It must implement <code>io.Reader</code> somehow, but you haven&#39;t shown that."}], "tags": [], "owner": {"reputation": 1748, "user_id": 4106031, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NM3jO.jpg?s=128&g=1", "display_name": "Alok Kumar Singh", "link": "https://stackoverflow.com/users/4106031/alok-kumar-singh"}, "is_accepted": false, "score": -1, "last_activity_date": 1536522715, "creation_date": 1536522715, "answer_id": 52248173, "question_id": 47621804, "link": "https://stackoverflow.com/questions/47621804/upload-object-to-aws-s3-without-creating-a-file-using-aws-sdk-go/52248173#52248173", "title": "Upload object to AWS S3 without creating a file using aws-sdk-go", "body": "<p>Here is what I ended up writing</p>\n\n<pre><code>func (s *S3Sink) upload() {\n    now := time.Now()\n    key := s.getNewKey(now)\n\n    _, err := s.uploader.Upload(&amp;s3manager.UploadInput{\n        Bucket: aws.String(s.bucket),\n        Key:    aws.String(key),\n        Body:   s.bodyBuf,\n    })\n\n    if err != nil {\n        glog.Errorf(\"Error uploading %s to s3, %v\", key, err)\n    }\n    glog.Infof(\"Uploaded at %s\", key)\n    s.lastUploadTimestamp = now.UnixNano()\n\n    s.bodyBuf.Truncate(0)\n}\n</code></pre>\n\n<p>More details below:\n<a href=\"https://github.com/heptiolabs/eventrouter/blob/20edca33bc6e20465810d49bdb213119464eb440/sinks/s3sink.go#L185-L201\" rel=\"nofollow noreferrer\">https://github.com/heptiolabs/eventrouter/blob/20edca33bc6e20465810d49bdb213119464eb440/sinks/s3sink.go#L185-L201</a></p>\n"}, {"tags": [], "owner": {"reputation": 531, "user_id": 412400, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/148216784aed58282fa1a64f7f5a6aa7?s=128&d=identicon&r=PG", "display_name": "Ghjnut", "link": "https://stackoverflow.com/users/412400/ghjnut"}, "is_accepted": false, "score": 1, "last_activity_date": 1587431692, "creation_date": 1587431692, "answer_id": 61334477, "question_id": 47621804, "link": "https://stackoverflow.com/questions/47621804/upload-object-to-aws-s3-without-creating-a-file-using-aws-sdk-go/61334477#61334477", "title": "Upload object to AWS S3 without creating a file using aws-sdk-go", "body": "<p>Here's a little implementation I wrote up that utilizes pipes and incorporates timeouts. </p>\n\n<pre><code>package example\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"io\"\n    \"sync\"\n    \"time\"\n\n    \"github.com/aws/aws-sdk-go/service/s3/s3manager\"\n)\n\nfunc FileWriter(ctx context.Context, uploader *s3manager.Uploader, wg *sync.WaitGroup, bucket string, key string, timeout time.Duration) (writer *io.PipeWriter) {\n    // create a per-file flush timeout\n    fileCtx, cancel := context.WithTimeout(ctx, timeout)\n\n    // pipes are open until one end is closed\n    pr, pw := io.Pipe()\n\n    wg.Add(1)\n    go func() {\n        params := &amp;s3manager.UploadInput{\n            Bucket: aws.String(bucket),\n            Key:    aws.String(key),\n            Body:   pr,\n        }\n\n        // blocking\n        _, err := uploader.Upload(params)\n        if err != nil {\n            fmt.Printf(\"Unable to upload, %v. Bucket: %s\", err, bucket)\n        }\n\n        // always call context cancel functions!\n        cancel()\n        wg.Done()\n    }()\n\n    // when context is cancelled, close the pipe\n    go func() {\n        &lt;-fileCtx.Done()\n        // should check fileCtx.Err() here\n        if err := pw.Close(); err != nil {\n            fmt.Printf(\"Unable to close\")\n        }\n    }()\n\n    return pw\n}\n</code></pre>\n"}], "owner": {"reputation": 179, "user_id": 3891823, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1510554955/picture?type=large", "display_name": "Eric Reis Figueiredo", "link": "https://stackoverflow.com/users/3891823/eric-reis-figueiredo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6714, "favorite_count": 2, "accepted_answer_id": 47622067, "answer_count": 4, "score": 2, "last_activity_date": 1587431692, "creation_date": 1512326044, "last_edit_date": 1512326625, "question_id": 47621804, "link": "https://stackoverflow.com/questions/47621804/upload-object-to-aws-s3-without-creating-a-file-using-aws-sdk-go", "title": "Upload object to AWS S3 without creating a file using aws-sdk-go", "body": "<p>I am trying to upload an object to AWS S3 using golang sdk without needing to create a file in my system (trying to upload only the string). But I am having difficulties to accomplish that. Can anybody give me an example of how can I upload to AWS S3 without needing to create a file?</p>\n\n<p>AWS Example of how to upload a file:</p>\n\n<pre><code>// Creates a S3 Bucket in the region configured in the shared config\n// or AWS_REGION environment variable.\n//\n// Usage:\n//    go run s3_upload_object.go BUCKET_NAME FILENAME\nfunc main() {\n    if len(os.Args) != 3 {\n        exitErrorf(\"bucket and file name required\\nUsage: %s bucket_name filename\",\n            os.Args[0])\n    }\n\n    bucket := os.Args[1]\n    filename := os.Args[2]\n\n    file, err := os.Open(filename)\n    if err != nil {\n        exitErrorf(\"Unable to open file %q, %v\", err)\n    }\n\n    defer file.Close()\n\n    // Initialize a session in us-west-2 that the SDK will use to load\n    // credentials from the shared credentials file ~/.aws/credentials.\n    sess, err := session.NewSession(&amp;aws.Config{\n        Region: aws.String(\"us-west-2\")},\n    )\n\n    // Setup the S3 Upload Manager. Also see the SDK doc for the Upload Manager\n    // for more information on configuring part size, and concurrency.\n    //\n    // http://docs.aws.amazon.com/sdk-for-go/api/service/s3/s3manager/#NewUploader\n    uploader := s3manager.NewUploader(sess)\n\n    // Upload the file's body to S3 bucket as an object with the key being the\n    // same as the filename.\n    _, err = uploader.Upload(&amp;s3manager.UploadInput{\n        Bucket: aws.String(bucket),\n\n        // Can also use the `filepath` standard library package to modify the\n        // filename as need for an S3 object key. Such as turning absolute path\n        // to a relative path.\n        Key: aws.String(filename),\n\n        // The file to be uploaded. io.ReadSeeker is preferred as the Uploader\n        // will be able to optimize memory when uploading large content. io.Reader\n        // is supported, but will require buffering of the reader's bytes for\n        // each part.\n        Body: file,\n    })\n    if err != nil {\n        // Print the error and exit.\n        exitErrorf(\"Unable to upload %q to %q, %v\", filename, bucket, err)\n    }\n\n    fmt.Printf(\"Successfully uploaded %q to %q\\n\", filename, bucket)\n}\n</code></pre>\n\n<p>I already tried to create the file programmatically but it is creating the file on my system and then uploading it to S3.</p>\n"}, {"tags": ["postgresql", "go", "pq"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512327491, "post_id": 47621459, "comment_id": 82201959, "body": "Did you try leaving out the conversion from the <code>driver.Value</code> and adding it to the query? e.g. <code>$2::ingredients[]</code>."}, {"owner": {"reputation": 1247, "user_id": 2442403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1f615cb1e409558cc935422ca6e844d5?s=128&d=identicon&r=PG", "display_name": "cat-t", "link": "https://stackoverflow.com/users/2442403/cat-t"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512328371, "post_id": 47621459, "comment_id": 82202272, "body": "Just tried, same error as above."}], "answers": [{"comments": [{"owner": {"reputation": 1247, "user_id": 2442403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1f615cb1e409558cc935422ca6e844d5?s=128&d=identicon&r=PG", "display_name": "cat-t", "link": "https://stackoverflow.com/users/2442403/cat-t"}, "edited": false, "score": 0, "creation_date": 1512328507, "post_id": 47622098, "comment_id": 82202322, "body": "I&#39;m considering doing so at this point. Only reason I wasn&#39;t before was because I just needed a simple array without the need to access individual items or search by individual items."}], "tags": [], "owner": {"reputation": 9345, "user_id": 4237316, "user_type": "registered", "accept_rate": 47, "profile_image": "https://graph.facebook.com/100004533998341/picture?type=large", "display_name": "Harald Nordgren", "link": "https://stackoverflow.com/users/4237316/harald-nordgren"}, "is_accepted": false, "score": 1, "last_activity_date": 1512328908, "last_edit_date": 1512328908, "creation_date": 1512327784, "answer_id": 47622098, "question_id": 47621459, "link": "https://stackoverflow.com/questions/47621459/inserting-array-of-custom-types-into-postgres/47622098#47622098", "title": "Inserting array of custom types into postgres", "body": "<p>It seems your database design is very complicated and not taking into account the strengths (and weaknesses) of SQL.</p>\n\n<p>May I suggest you split the ingredients into their own table with a reference to the recipe. Then finding out a full recipe is a <code>JOIN</code> operation.</p>\n\n<p><strong>Creating the DB:</strong></p>\n\n<pre><code>CREATE TABLE ingredients (\n    recipe_id uuid,\n    name text,\n    quantity int,\n    unit text\n);\n\nCREATE TABLE recipes (\n    recipe_id uuid PRIMARY KEY,\n    name text\n);\n</code></pre>\n\n<p><strong>Inserting a recipe and querying to read it out:</strong></p>\n\n<pre><code>INSERT INTO recipes VALUES (\n  '5d1cb631-37bd-46cc-a278-4c8558ed8964', 'cake1'\n);\n\nINSERT INTO ingredients (recipe_id, name, quantity, unit) VALUES\n  ('5d1cb631-37bd-46cc-a278-4c8558ed8964', 'flour', 3, 'cups'),\n  ('5d1cb631-37bd-46cc-a278-4c8558ed8964', 'water', 1, 'cups')\n;\n\nSELECT r.name, i.name, i.quantity, i.unit\nFROM ingredients AS i\nINNER JOIN recipes AS r\nON r.recipe_id=i.recipe_id;\n</code></pre>\n\n<p>SQLFiddle link: <a href=\"http://sqlfiddle.com/#!17/262ad/14\" rel=\"nofollow noreferrer\">http://sqlfiddle.com/#!17/262ad/14</a></p>\n"}, {"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1512332074, "last_edit_date": 1512332074, "creation_date": 1512330674, "answer_id": 47622594, "question_id": 47621459, "link": "https://stackoverflow.com/questions/47621459/inserting-array-of-custom-types-into-postgres/47622594#47622594", "title": "Inserting array of custom types into postgres", "body": "<p>You can either use this approach outlined here: <a href=\"https://github.com/lib/pq/issues/544\" rel=\"nofollow noreferrer\">https://github.com/lib/pq/issues/544</a></p>\n\n<pre><code>type Ingredient struct {\n    Name string\n    Quantity string\n    Unit string\n}\n\nfunc (i *Ingredient) Value() (driver.Value, error) {\n    return fmt.Sprintf(\"('%s','%s','%s')\", i.Name, i.Quantity, i.Unit), nil\n}\n\nstmt := `INSERT INTO recipes (name, ingredients) VALUES ($1, $2::ingredient[])`\n\ndb.Exec(stmt, \"some_name\", pq.Array([]*Ingredient{{\"flour\", \"3\", \"cups\"}}))\n</code></pre>\n\n<p>Or if you have records in the table and you query it, you will probably see the ingredient array in its <em>literal</em> form, which you can than mimic during insert.</p>\n\n<pre><code>func (ings *Ingredients) Value() (driver.Value, error) {\n    val := `{`\n    for i, ing := range ings {\n        if i != 0 {\n            val += \",\"\n        }\n        val += fmt.Sprintf(`\"('%s','%s','%s')\"`, ing.Name, ing.Quantity, ing.Unit)\n    }\n    val += `}`\n    return val, nil\n}\n\n// e.g. `{\"('flour','3','cups')\"}`\n\nstmt := `INSERT INTO recipes (name, ingredients) VALUES ($1, $2::ingredient[])`\n\n// ...\n</code></pre>\n"}], "owner": {"reputation": 1247, "user_id": 2442403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1f615cb1e409558cc935422ca6e844d5?s=128&d=identicon&r=PG", "display_name": "cat-t", "link": "https://stackoverflow.com/users/2442403/cat-t"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1567, "favorite_count": 0, "accepted_answer_id": 47622594, "answer_count": 2, "score": 4, "last_activity_date": 1512332074, "creation_date": 1512324061, "last_edit_date": 1512324236, "question_id": 47621459, "link": "https://stackoverflow.com/questions/47621459/inserting-array-of-custom-types-into-postgres", "title": "Inserting array of custom types into postgres", "body": "<p>I'm trying to insert a row with a column that is an array of a custom type (<code>ingredient</code>). My tables are:</p>\n\n<pre><code>CREATE TYPE ingredient AS (\n    name text,\n    quantity text,\n    unit text\n);\n\nCREATE TABLE IF NOT EXISTS recipes (\n    recipe_id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n    name text,\n    ingredients ingredient[],\n    // ...\n);\n</code></pre>\n\n<p>Using raw sql, I can insert a row by:</p>\n\n<p><code>INSERT INTO recipes (name, ingredients) VALUES ('some_name', ARRAY[ROW('aa', 'bb', 'cc'), ROW('xx', 'yy', 'zz')]::ingredient[]  );</code></p>\n\n<p>But I'm struggling to do this in go with the <code>pq</code> lib. I've created a <code>pq.Array</code> interface:</p>\n\n<pre><code>type Ingredient struct {\n    Name string\n    Quantity string\n    Unit string\n}\n\ntype Ingredients []*Ingredient\n\nfunc (ings *Ingredients) ConvertValue(v interface{}) (driver.Value, error) {\n    return \"something\", nil\n}\nfunc (ings *Ingredients) Value() (driver.Value, error) {\n    val := `ARRAY[]`\n    for i, ing := range ings {\n        if i != 0 {\n            val += \",\"\n        }\n        val += fmt.Printf(`ROW('%v','%v','%v')`, ing.Name, ing.Quantity, ing.Unit)\n    }\n    val += `::ingredient[]`\n    return val, nil\n}\n\n\n// and then trying to insert via:\nstmt := `INSERT INTO recipes (\n        name,\n        ingredients\n    )\n    VALUES ($1, $2)\n`\n_, err := db.Exec(stmt,\n    \"some_name\",\n    &amp;Ingredients{\n        &amp;Ingredient{\"flour\", \"3\", \"cups\"},\n    },\n)\n</code></pre>\n\n<p>But pg keeps throwing the error:</p>\n\n<pre><code>  Error insertingpq: malformed array literal: \"ARRAY[ROW('flour','3','cups')]::ingredient[]\"\n</code></pre>\n\n<p>Am I returning an incorrect <code>driver.Value</code>?</p>\n"}, {"tags": ["go", "travis-ci", "hugo"], "comments": [{"owner": {"reputation": 1821, "user_id": 1513675, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/85aed9cac25cfc65e30e90ce806796ed?s=128&d=identicon&r=PG", "display_name": "brodoll", "link": "https://stackoverflow.com/users/1513675/brodoll"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1512335657, "post_id": 47620143, "comment_id": 82204591, "body": "@Flimzy It does. The accepted answer of a similar question which i linked mentions the use of a makefile with an empty recipe, which i threw in the Repo main folder together with .travis.yml, but had no luck"}], "answers": [{"comments": [{"owner": {"reputation": 1821, "user_id": 1513675, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/85aed9cac25cfc65e30e90ce806796ed?s=128&d=identicon&r=PG", "display_name": "brodoll", "link": "https://stackoverflow.com/users/1513675/brodoll"}, "edited": false, "score": 0, "creation_date": 1512677868, "post_id": 47685697, "comment_id": 82366302, "body": "I&#39;ll take a look at the options, I was not aware of them. And yes it is to get a working CI setup to build my hugo blog. Thanks for taking a look into this! I&#39;ll get back with the results asap"}, {"owner": {"reputation": 1821, "user_id": 1513675, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/85aed9cac25cfc65e30e90ce806796ed?s=128&d=identicon&r=PG", "display_name": "brodoll", "link": "https://stackoverflow.com/users/1513675/brodoll"}, "edited": false, "score": 0, "creation_date": 1512731058, "post_id": 47685697, "comment_id": 82385927, "body": "fetching hugo with wget worked for me. Now <a href=\"https://travis-ci.org/gtpedrosa/gtpedrosa.github.io/jobs/313427676\" rel=\"nofollow noreferrer\">my build</a> is passing. Thank you! :)"}], "tags": [], "owner": {"reputation": 1386, "user_id": 3973292, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71393bd67bd84015884ff6127afc5ed1?s=128&d=identicon&r=PG&f=1", "display_name": "bep", "link": "https://stackoverflow.com/users/3973292/bep"}, "is_accepted": true, "score": 2, "last_activity_date": 1512606519, "creation_date": 1512606519, "answer_id": 47685697, "question_id": 47620143, "link": "https://stackoverflow.com/questions/47620143/travis-error-the-command-go-get-u-v-github-com-spf13-hugo-failed-and-exited/47685697#47685697", "title": "travis error: The command &quot;go get -u -v github.com/spf13/hugo&quot; failed and exited with 1 during", "body": "<p><code>go get</code> doesn't really work with Hugo -- or to be more precise: The behaviour is undefined.</p>\n\n<p>Hugo vendors its dependencies, but does not commit those to the GitHub repo. So you would have to use <code>dep</code> and <code>mage</code>(a Go variant of Make) -- and the easiest way is to look at this Travis setup:</p>\n\n<p><a href=\"https://github.com/gohugoio/hugo/blob/master/.travis.yml\" rel=\"nofollow noreferrer\">https://github.com/gohugoio/hugo/blob/master/.travis.yml</a></p>\n\n<p>Note that if this is to get a working CI setup to build Hugo sites, I would recommend just to fetch one of the releases from here via <code>curl</code> or <code>wget</code>:</p>\n\n<p><a href=\"https://github.com/gohugoio/hugo/releases\" rel=\"nofollow noreferrer\">https://github.com/gohugoio/hugo/releases</a></p>\n"}], "owner": {"reputation": 1821, "user_id": 1513675, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/85aed9cac25cfc65e30e90ce806796ed?s=128&d=identicon&r=PG", "display_name": "brodoll", "link": "https://stackoverflow.com/users/1513675/brodoll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 350, "favorite_count": 0, "accepted_answer_id": 47685697, "answer_count": 1, "score": 2, "last_activity_date": 1512606519, "creation_date": 1512316373, "question_id": 47620143, "link": "https://stackoverflow.com/questions/47620143/travis-error-the-command-go-get-u-v-github-com-spf13-hugo-failed-and-exited", "title": "travis error: The command &quot;go get -u -v github.com/spf13/hugo&quot; failed and exited with 1 during", "body": "<p>I receive the following error while trying to build my hugo blog with travis: </p>\n\n<blockquote>\n  <p>The command \"go get -u -v github.com/spf13/hugo\" failed and exited with 1 during .</p>\n</blockquote>\n\n<p>I have tried to create a makefile with an empty recipe as <a href=\"https://stackoverflow.com/questions/39937224/travis-go-error-the-command-eval-go-get-t-v-failed\">suggested here</a>, but had no success. Here is the <a href=\"https://travis-ci.org/gtpedrosa/gtpedrosa.github.io/builds/310874054\" rel=\"nofollow noreferrer\">build log</a>. </p>\n\n<p>Any suggestions on how to avoid this error?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1512313546, "post_id": 47619683, "comment_id": 82197337, "body": "Are you looking for a runtime test, or a static analysis test, or something else?"}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1512313800, "post_id": 47619683, "comment_id": 82197414, "body": "Standard unit testing."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1512313940, "post_id": 47619683, "comment_id": 82197449, "body": "One approach is to change <code>doSomethingParams</code> from a method into a field of type func, after that you could mock it during a test. You may have to change it&#39;s signature to add <code>*Foo</code> as a param if it depends on the receiver. One downside of this, at least for me, is that <code>*Foo</code> can&#39;t be compared with <code>reflect.DeepEqual</code> reliably anymore."}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512314061, "post_id": 47619683, "comment_id": 82197491, "body": "@mkopriva that is an interesting approach, probably would work, but does &quot;feel&quot; like it is wrong (anti-pattern). It shouldn&#39;t be all that hard to just stub it out, should it?"}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "edited": false, "score": 0, "creation_date": 1512314266, "post_id": 47619683, "comment_id": 82197542, "body": "Oh, I might be able to use embedding? Not sure..."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512314268, "post_id": 47619683, "comment_id": 82197543, "body": "@deitch If it&#39;s a function/method it is. The &quot;right&quot; way would be to introduce an interface, have that as a field on <code>Foo</code> and have <code>DoSomethingX</code> call the interface method instead. This way, then, you can rely on <code>reflect.DeepEqual</code> but it may feel like overkill to create interfaces for this."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512314605, "post_id": 47619683, "comment_id": 82197637, "body": "<i>&quot;It shouldn&#39;t be all that hard to just stub it out, should it?&quot;</i> @deitch, you cannot stub the method <code>Foo.doSomethingParams</code>, it&#39;s not possible in Go. To give <code>Foo</code> access to a stub/mock/fake, it has to be a parameter (of type interface or func) to a method call or a field (of type interface or func) of <code>Foo</code>."}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512314732, "post_id": 47619683, "comment_id": 82197667, "body": "@mkopriva _ The &quot;right&quot; way would be to introduce an interface_ yes, but if it is within the same struct...."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512314951, "post_id": 47619683, "comment_id": 82197735, "body": "@deitch well you can always rethink the design of the actual test. For example you could have your exported methods reuse the test table you use to test the unexported method."}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "edited": false, "score": 0, "creation_date": 1512315095, "post_id": 47619683, "comment_id": 82197783, "body": "&quot;reuse the test table&quot; - yeah, not a bad idea. A bit wasteful to rerun everything, but in the context of go, which is very quick, not too bad."}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "edited": false, "score": 0, "creation_date": 1512315475, "post_id": 47619683, "comment_id": 82197896, "body": "Nah, embedding didn&#39;t work. How would I use an interface in the same struct (above example)?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 5, "creation_date": 1512315708, "post_id": 47619683, "comment_id": 82197953, "body": "I don&#39;t think that&#39;s a useful test. It&#39;s certainly not a <i>unit</i> test. What you should be testing for is that the function has the proper return values and/or proper side effects.  If a future implementation accomplishes that goal without calling <code>doSomethingParams()</code>, the test should continue to pass."}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "edited": false, "score": 0, "creation_date": 1512316512, "post_id": 47619683, "comment_id": 82198193, "body": "Actually, given that <code>DoSomethingA</code> is exported, your approach is correct, methinks."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1512316566, "post_id": 47619683, "comment_id": 82198215, "body": "Generally I agree with @Flimzy, but if you have an exported method that passes args specific to it to an unexported one and the computation of the unexported one is expensive. It may make sense to just test that the exported passes the correct values to the unexported one."}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512371409, "post_id": 47619683, "comment_id": 82213887, "body": "the point @mkopriva is making is roughly where I was."}, {"owner": {"reputation": 1548, "user_id": 2841607, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/JjWu8.jpg?s=128&g=1", "display_name": "minitauros", "link": "https://stackoverflow.com/users/2841607/minitauros"}, "edited": false, "score": 0, "creation_date": 1547761753, "post_id": 47619683, "comment_id": 95314078, "body": "So did you get to a conclusive answer on this? I&#39;m struggling with the same thing. It feels like I am kind of bloating my tests now by rewriting the logic that tests what <code>doSomethingParams</code> does inside all my tests for the exported functions. I am basically writing the exact same test for <code>doSomethingParams</code> inside <code>DoSomethingA</code>, <code>B</code> and <code>C</code>. Would be nicer to say &quot;just assume that <code>doSomethingParams</code> has been called&quot;, and then test <code>doSomethingParams</code> only once. Else if functions <code>D</code> through <code>Z</code> are added, the test will be humongous."}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "edited": false, "score": 0, "creation_date": 1547789562, "post_id": 47619683, "comment_id": 95320589, "body": "Not really, or at least nothing beyond the suggestions in the comments. It just isn&#39;t something built into go. Use an interface (overkill) or accept it."}], "owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 228, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1512313455, "creation_date": 1512313455, "question_id": 47619683, "link": "https://stackoverflow.com/questions/47619683/golang-how-to-test-if-one-exported-function-calls-another-unexported", "title": "golang how to test if one exported function calls another unexported", "body": "<p>What is the best way to test if one exported <code>func</code> calls another? E.g. (bit of a contrived example):</p>\n\n<pre><code>type Foo struct{}\n\nfunc (f *Foo) DoSomethingA(param string) bool {\n    return f.doSomethingParams(param, false, true)\n}\nfunc (f *Foo) DoSomethingB(param string) bool {\n    return f.doSomethingParams(param, true, true)\n}\nfunc (f *Foo) DoSomethingC(param string) bool {\n    return f.doSomethingParams(param, false, false)\n}\nfunc (f *Foo) doSomethingParams(param string, optA, optB bool) bool {\n    // do stuff here\n}\n</code></pre>\n\n<p>I can test <code>doSomethingParams()</code> independently in all its variants. I want a simple test that when I call <code>DoSomethingA()</code> that it calls <code>doSomethingParams(param, false, false)</code>, etc.</p>\n\n<p>What is the easiest way to do that? Obviously replacing <code>Foo</code> with an interface won't work as this is a specific implementation I am testing which, in turn, is calling its own implementation of <code>doSomethingParams()</code>.</p>\n"}, {"tags": ["go", "finalization"], "answers": [{"comments": [{"owner": {"reputation": 26934, "user_id": 8316315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44d833a8a46fea39d7bfca1540ea9c07?s=128&d=identicon&r=PG&f=1", "display_name": "Florian Weimer", "link": "https://stackoverflow.com/users/8316315/florian-weimer"}, "edited": false, "score": 0, "creation_date": 1518890565, "post_id": 47621374, "comment_id": 84692896, "body": "I think I would have to put this into the run-time itself because I can&#39;t patch all the sources involved. But it is possible to deregister finalizers, so the counting becomes non-trivial. I had hoped for some way to gather counters from the run-time itself."}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": false, "score": 4, "last_activity_date": 1512323592, "creation_date": 1512323592, "answer_id": 47621374, "question_id": 47619192, "link": "https://stackoverflow.com/questions/47619192/finalizer-statistics/47621374#47621374", "title": "Finalizer statistics", "body": "<p>You can keep keep a count of these objects by incrementing and decrementing a unexported package variable when a new object is created and finalized, respectively.</p>\n\n<p>For example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"sync/atomic\"\n)\n\nvar totalObjects int32\n\nfunc TotalObjects() int32 {\n    return atomic.LoadInt32(&amp;totalObjects)\n}\n\ntype Object struct {\n    p uintptr // C allocated pointer\n}\n\nfunc NewObject() *Object {\n    o := &amp;Object{\n    }\n    // TODO: perform other initializations\n    atomic.AddInt32(&amp;totalObjects, 1)\n    runtime.SetFinalizer(o, (*Object).finalizer)\n    return o\n}\n\nfunc (o *Object) finalizer() {\n    atomic.AddInt32(&amp;totalObjects, -1)\n    // TODO: perform finalizations\n}\n\nfunc main() {\n    fmt.Println(\"Total objects:\", TotalObjects())\n    for i := 0; i &lt; 100; i++ {\n        _ = NewObject()\n        runtime.GC()\n    }\n    fmt.Println(\"Total objects:\", TotalObjects())\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/n35QABBIcj\" rel=\"nofollow noreferrer\">https://play.golang.org/p/n35QABBIcj</a></p>\n"}, {"tags": [], "owner": {"reputation": 630, "user_id": 9361705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3480b01ac2475fdc98d6d64b1f1d6143?s=128&d=identicon&r=PG&f=1", "display_name": "John Doe", "link": "https://stackoverflow.com/users/9361705/john-doe"}, "is_accepted": false, "score": 0, "last_activity_date": 1519466035, "last_edit_date": 1519466035, "creation_date": 1519464843, "answer_id": 48961370, "question_id": 47619192, "link": "https://stackoverflow.com/questions/47619192/finalizer-statistics/48961370#48961370", "title": "Finalizer statistics", "body": "<p>It's possible to make a wrapper on <code>runtime.SetFinalizer</code> which does the counting for you. Of course, it's a question of using it everywhere where you use <code>SetFinalizer</code>.</p>\n\n<p>In case this is problematic, you can also modify <code>SetFinalizer</code> source code directly, but that requires <a href=\"https://go.googlesource.com/go\" rel=\"nofollow noreferrer\">a modified Go compiler</a>.</p>\n\n<p>Atomic integers are used as <code>SetFinalizer</code> may be called on different threads, and otherwise a counter may not be accurate as without those a race condition could possibly occur. Golang guarantees that finalizers are called from a single goroutine, so it's not needed for inner function.</p>\n\n<p><a href=\"https://play.golang.org/p/KKCH2UwTFYw\" rel=\"nofollow noreferrer\">https://play.golang.org/p/KKCH2UwTFYw</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n    \"runtime\"\n    \"sync/atomic\"\n)\n\nvar finalizersCreated int64\nvar finalizersRan int64\n\nfunc SetFinalizer(obj interface{}, finalizer interface{}) {\n    finType := reflect.TypeOf(finalizer)\n    funcType := reflect.FuncOf([]reflect.Type{finType.In(0)}, nil, false)\n    f := reflect.MakeFunc(funcType, func(args []reflect.Value) []reflect.Value {\n        finalizersRan++\n        return reflect.ValueOf(finalizer).Call([]reflect.Value{args[0]})\n    })\n    runtime.SetFinalizer(obj, f.Interface())\n    atomic.AddInt64(&amp;finalizersCreated, 1)\n}\n\nfunc main() {\n    v := \"a\"\n    SetFinalizer(&amp;v, func(a *string) {\n        fmt.Println(\"Finalizer ran\")\n    })\n    fmt.Println(finalizersRan, finalizersCreated)\n    runtime.GC()\n    fmt.Println(finalizersRan, finalizersCreated)\n}\n</code></pre>\n"}], "owner": {"reputation": 26934, "user_id": 8316315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44d833a8a46fea39d7bfca1540ea9c07?s=128&d=identicon&r=PG&f=1", "display_name": "Florian Weimer", "link": "https://stackoverflow.com/users/8316315/florian-weimer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 1, "answer_count": 2, "score": 9, "last_activity_date": 1519466035, "creation_date": 1512310027, "question_id": 47619192, "link": "https://stackoverflow.com/questions/47619192/finalizer-statistics", "title": "Finalizer statistics", "body": "<p>Is there a way to obtain the total number of finalizers registered using <a href=\"https://golang.org/pkg/runtime/#SetFinalizer\" rel=\"noreferrer\"><code>runtime.SetFinalizer</code></a> and which have not yet run?</p>\n\n<p>We are considering adding a <code>struct</code> with a registered finalizer to some of our products to release memory allocated using <code>malloc</code>, and the object could potentially have a relatively high allocation rate.  It would be nice if we could monitor the number of finalizers, to make sure that they do not pile up and trigger out-of-memory errors (like they tend to with other garbage collectors).</p>\n\n<p>(I'm aware that explicit deallocation would avoid this problem, but we cannot change the existing code, which does not call a <code>Close</code> function or something like that.)</p>\n"}, {"tags": ["docker", "go", "go-gorm"], "comments": [{"owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "edited": false, "score": 1, "creation_date": 1512307771, "post_id": 47618758, "comment_id": 82195764, "body": "Seems you are importing gorm both from vendor directory and gopath and there is a mismatch. Provide more details about how did you do your vendoring."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1512307912, "post_id": 47618758, "comment_id": 82195792, "body": "You should only have a vendor directory in the top level of your project. Imported packed need to have vendored packages hoisted to the top level vendor directory."}, {"owner": {"reputation": 2884, "user_id": 1430476, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/cf9e49064895c6b498e936d2a2b80bf3?s=128&d=identicon&r=PG", "display_name": "Tino", "link": "https://stackoverflow.com/users/1430476/tino"}, "edited": false, "score": 0, "creation_date": 1512321983, "post_id": 47618758, "comment_id": 82200118, "body": "I have added my project folder structure. I&#39;m not doing much much more then the using glide to put deps into /vendor and then having the above docker build steps."}], "answers": [{"tags": [], "owner": {"reputation": 676, "user_id": 1024460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/31d235d84f04379422e8c7e67ef54e91?s=128&d=identicon&r=PG", "display_name": "psykeron", "link": "https://stackoverflow.com/users/1024460/psykeron"}, "is_accepted": true, "score": 1, "last_activity_date": 1512406562, "creation_date": 1512406562, "answer_id": 47638262, "question_id": 47618758, "link": "https://stackoverflow.com/questions/47618758/golang-error-inside-docker/47638262#47638262", "title": "Golang error inside docker", "body": "<p>It's because <code>go get</code> is called by <code>go-wrapper download</code>. This fetches the dependencies from the remote instead of looking in the vendor folder.</p>\n\n<p>If your libraries are already vendored and the code is in the <code>vendor</code> folder, all you should have to do is <code>go run</code> or <code>go install</code>.</p>\n\n<p>and why do you need go-wrapper when you can just do.</p>\n\n<pre><code>RUN glide install\nRUN go install\nWORKDIR \"../bin\"\nRUN myapp\n</code></pre>\n"}], "owner": {"reputation": 2884, "user_id": 1430476, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/cf9e49064895c6b498e936d2a2b80bf3?s=128&d=identicon&r=PG", "display_name": "Tino", "link": "https://stackoverflow.com/users/1430476/tino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 854, "favorite_count": 0, "accepted_answer_id": 47638262, "answer_count": 1, "score": 0, "last_activity_date": 1512406562, "creation_date": 1512306947, "last_edit_date": 1512321896, "question_id": 47618758, "link": "https://stackoverflow.com/questions/47618758/golang-error-inside-docker", "title": "Golang error inside docker", "body": "<p>I get a strange error in docker when building my go app:</p>\n\n<pre><code>./main.go:31:9: cannot use db (type *\"github.com/khwerhahn/somerepo/vendor/github.com/jinzhu/gorm\".DB) as type *\"app/vendor/github.com/jinzhu/gorm\".DB in argument to Migrate  \nThe command '/bin/sh -c go-wrapper install' returned a non-zero code: 2\n</code></pre>\n\n<p>Could somebody hint me into the right direction, because locally the app runs just fine. Its just inside the docker container. I use <code>glide</code> to manage dependencies. </p>\n\n<p>Dockerfile:</p>\n\n<pre><code>FROM golang:1.9\nWORKDIR /go/src/app\nCOPY . .\nRUN go-wrapper download\nRUN go-wrapper install\n\nCMD [\"go-wrapper\", \"run\"]\n</code></pre>\n\n<p>//// Edit\nThis is how my structure looks. <code>Glide</code> manages the vendor folder. The docker build does the rest. </p>\n\n<p><a href=\"https://i.stack.imgur.com/rN9eW.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/rN9eW.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["go", "pipeline", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 188, "user_id": 6409265, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9878e2d0f8d4e0c02a8f4b7858891d80?s=128&d=identicon&r=PG&f=1", "display_name": "FChris", "link": "https://stackoverflow.com/users/6409265/fchris"}, "edited": false, "score": 0, "creation_date": 1512311824, "post_id": 47618839, "comment_id": 82196855, "body": "I think I will consider this, but declare a whole Result type, that also contains information whether the result is an error etc. I would prefer it though, to have the filter return its outStream instead of getting it passed, this way multiple other routines can make use of its results."}], "tags": [], "owner": {"reputation": 4780, "user_id": 2133484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b491cf2d331464c4655247dc43e3d89?s=128&d=identicon&r=PG", "display_name": "Arman Ordookhani", "link": "https://stackoverflow.com/users/2133484/arman-ordookhani"}, "is_accepted": false, "score": 1, "last_activity_date": 1512307578, "creation_date": 1512307578, "answer_id": 47618839, "question_id": 47618039, "link": "https://stackoverflow.com/questions/47618039/how-to-effectively-test-the-pipes-and-filters-pattern/47618839#47618839", "title": "How to effectively test the pipes and filters pattern", "body": "<p>I think you should change your structure a bit. First, testing that a function prints something or not don't seems good to me at all. Logs shouldn't be a part of your business logic. They are just add-ons to make debugging and tracing easier. Second you are starting a goroutine that doesn't provide any output (except logs) so you couldn't control when it has finished its job.</p>\n\n<p>An alternative solution:</p>\n\n<p>Declare a channel to get outputs from your function and preferably pass it to your function. I used a string channel to be simple as possible.</p>\n\n<pre><code>var outStream = make(chan string)\nwatchTemperature(ctx, inStream, outStream)\n</code></pre>\n\n<p>Instead of normal log facilities, log to this channel and for each input token you should create an output token:</p>\n\n<pre><code>if temp &gt; maxTemp {\n    outStream &lt;- \"Temperature too high!\"\n} else {\n    outStream &lt;- \"Normal\"\n}\n</code></pre>\n\n<p>And in your test after each send you wait for an output:</p>\n\n<pre><code>inStream &lt;- maxTemp + 1\nreply &lt;- outStream\nif reply != \"Temperature too high!\" {\n    // test failed\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 188, "user_id": 6409265, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9878e2d0f8d4e0c02a8f4b7858891d80?s=128&d=identicon&r=PG&f=1", "display_name": "FChris", "link": "https://stackoverflow.com/users/6409265/fchris"}, "edited": false, "score": 0, "creation_date": 1512311632, "post_id": 47619096, "comment_id": 82196799, "body": "This helps alot as it makes me rethink my approach. However, in terms of the pipeline pattern, the goroutine does not stop/end after reporting a result. So it would be hard to synchronize in that manner unless I report that a step has been completed, which is not really different from a result channel right?"}, {"owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "reply_to_user": {"reputation": 188, "user_id": 6409265, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9878e2d0f8d4e0c02a8f4b7858891d80?s=128&d=identicon&r=PG&f=1", "display_name": "FChris", "link": "https://stackoverflow.com/users/6409265/fchris"}, "edited": false, "score": 1, "creation_date": 1512312051, "post_id": 47619096, "comment_id": 82196917, "body": "You can use channels to send progress / result / completion. Or you can use <code>sync.WaitGroup</code> to get notified, when all of the workers of the same type / step are done."}, {"owner": {"reputation": 188, "user_id": 6409265, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9878e2d0f8d4e0c02a8f4b7858891d80?s=128&d=identicon&r=PG&f=1", "display_name": "FChris", "link": "https://stackoverflow.com/users/6409265/fchris"}, "edited": false, "score": 0, "creation_date": 1512312194, "post_id": 47619096, "comment_id": 82196954, "body": "Is it common to have, say an optional, channel as a parameter for functions that initiate goroutines, to which progress updates are written if present and which are not used if not provided?"}, {"owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "reply_to_user": {"reputation": 188, "user_id": 6409265, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9878e2d0f8d4e0c02a8f4b7858891d80?s=128&d=identicon&r=PG&f=1", "display_name": "FChris", "link": "https://stackoverflow.com/users/6409265/fchris"}, "edited": false, "score": 0, "creation_date": 1512312499, "post_id": 47619096, "comment_id": 82197040, "body": "For channels of result / progress, it&#39;s best practice to create, return and deferred close it in the same function, that launches the worker goroutines."}, {"owner": {"reputation": 188, "user_id": 6409265, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9878e2d0f8d4e0c02a8f4b7858891d80?s=128&d=identicon&r=PG&f=1", "display_name": "FChris", "link": "https://stackoverflow.com/users/6409265/fchris"}, "edited": false, "score": 0, "creation_date": 1512312821, "post_id": 47619096, "comment_id": 82197123, "body": "I think this&#39;ll be the last question, everything else I got an answer too :-). Are goroutines ever UnitTested otherwise but by channels handing data over and observing what is dropping out of the channels?"}, {"owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "reply_to_user": {"reputation": 188, "user_id": 6409265, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9878e2d0f8d4e0c02a8f4b7858891d80?s=128&d=identicon&r=PG&f=1", "display_name": "FChris", "link": "https://stackoverflow.com/users/6409265/fchris"}, "edited": false, "score": 0, "creation_date": 1512313869, "post_id": 47619096, "comment_id": 82197433, "body": "If you have a single <code>select</code> statement and you can isolate each case into a standalone function, then you can unit test them like normal code. But, if you have more logic in your <code>for</code> loop, then you have no choice IMHO. Check out an example of testing concurrent code from the Go <a href=\"https://golang.org/src/sync/waitgroup_test.go\" rel=\"nofollow noreferrer\">source</a>"}, {"owner": {"reputation": 188, "user_id": 6409265, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9878e2d0f8d4e0c02a8f4b7858891d80?s=128&d=identicon&r=PG&f=1", "display_name": "FChris", "link": "https://stackoverflow.com/users/6409265/fchris"}, "edited": false, "score": 0, "creation_date": 1512322374, "post_id": 47619096, "comment_id": 82200242, "body": "Do you extract the logic into an extra function and just test that function then?"}], "tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": true, "score": 1, "last_activity_date": 1512309612, "last_edit_date": 1512309612, "creation_date": 1512309285, "answer_id": 47619096, "question_id": 47618039, "link": "https://stackoverflow.com/questions/47618039/how-to-effectively-test-the-pipes-and-filters-pattern/47619096#47619096", "title": "How to effectively test the pipes and filters pattern", "body": "<p>Not always a worker goroutine has a result to deliver. But, if you want to know exactly when it is done, you need to synchronize it with your main goroutine using one of the concurrency primitives. It could be a signaling channel, or a wait group.</p>\n\n<p>Here's an example:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"context\"\n    \"fmt\"\n    \"log\"\n    \"strings\"\n)\n\nconst (\n    maxTemp = 90\n    errMsg  = \"Temperature too high!\"\n)\n\nfunc watchTemperature(ctx context.Context, inStream &lt;-chan int, finished chan&lt;- bool) {\n    go func() {\n        defer func() {\n            finished &lt;- true\n        }()\n        for {\n            select {\n            case &lt;-ctx.Done():\n                return\n            case temp := &lt;-inStream:\n                if temp &gt; maxTemp {\n                    log.Print(errMsg)\n                }\n            }\n        }\n    }()\n}\n\nfunc main() {\n    // quit signals to stop the work\n    ctx, quit := context.WithCancel(context.Background())\n    var buf bytes.Buffer\n    // Make sure, this is called before launching the goroutine!\n    log.SetOutput(&amp;buf)\n    inStream := make(chan int)\n    finished := make(chan bool)\n    // pass the callback channel to the goroutine\n    watchTemperature(ctx, inStream, finished)\n\n    // asynchronously to prevent a deadlock\n    go func() {\n        inStream &lt;- maxTemp + 1\n        quit()\n    }()\n    // Block until the goroutine returns.\n    &lt;-finished\n\n    if !strings.Contains(buf.String(), errMsg) {\n        panic(\"Expected log message not found\")\n    }\n\n    fmt.Println(\"Pass!\")\n}\n</code></pre>\n"}], "owner": {"reputation": 188, "user_id": 6409265, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9878e2d0f8d4e0c02a8f4b7858891d80?s=128&d=identicon&r=PG&f=1", "display_name": "FChris", "link": "https://stackoverflow.com/users/6409265/fchris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 333, "favorite_count": 0, "accepted_answer_id": 47619096, "answer_count": 2, "score": 1, "last_activity_date": 1512309612, "creation_date": 1512301690, "question_id": 47618039, "link": "https://stackoverflow.com/questions/47618039/how-to-effectively-test-the-pipes-and-filters-pattern", "title": "How to effectively test the pipes and filters pattern", "body": "<p>I am using the pipes and filters pattern as described in this <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">blog post</a>. </p>\n\n<p>I am wondering how to test this effectively. My idea was to just test each filter independently. For example I have a filter that looks like this</p>\n\n<pre><code>func watchTemperature(ctx context.Context, inStream &lt;-chan int) {\n    maxTemp = 90\n\n    go func() {\n        for {\n            select {\n            case &lt;-ctx.Done():\n                return\n            case temp := &lt;-inStream:\n                if temp &gt; maxTemp{\n                    log.Print(\"Temperature too high!\")\n                }\n            }\n        }\n    }()\n}\n</code></pre>\n\n<p>In my test for now I only want to see if the log has been printed. \nMy test looks as follows.</p>\n\n<pre><code>func TestWatchTemperature(t *testing.T) {\n    maxTemp = 90\n\n    ctx := context.Background()\n    inStream := make(chan int)\n    defer close(inStream)\n    watchTemperature(ctx, inStream)\n\n    var buf bytes.Buffer\n    log.SetOutput(&amp;buf)\n\n    inStream&lt;-maxTemp+1\n\n    logMsg := buf.String()\n    assert.True(t,  strings.Contains(logMsg, \"Temperature too high!\"), \n        \"Expected log message not found\")\n}\n</code></pre>\n\n<p>As this filter is the end of my pipeline, I do not have an out channel I can read from to determine if this goroutine/filter has already done something. </p>\n\n<p>The only thing I found online so far was, to just wait for a few seconds after writing to the inStream in my test and then check the log. However this seems like a really poor choice, as it simple introduces a race condition and slows down the test.</p>\n\n<p>What is the best way to test something like this or is there simply no good way to test it with this design of my filter and I always need an outStream?</p>\n"}, {"tags": ["sql-server", "go"], "answers": [{"tags": [], "owner": {"reputation": 119223, "user_id": 5070879, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/7534153a9cc70ad4e20680d6ca1b09ff?s=128&d=identicon&r=PG&f=1", "display_name": "Lukasz Szozda", "link": "https://stackoverflow.com/users/5070879/lukasz-szozda"}, "is_accepted": true, "score": 3, "last_activity_date": 1512298089, "last_edit_date": 1512298089, "creation_date": 1512297756, "answer_id": 47617571, "question_id": 47617509, "link": "https://stackoverflow.com/questions/47617509/unable-to-connect-to-ms-sql/47617571#47617571", "title": "Unable to connect to MS SQL", "body": "<p>Probably you need to activate TCP.</p>\n\n<p>More info: <a href=\"https://technet.microsoft.com/en-us/library/hh231672(v=sql.110).aspx\" rel=\"nofollow noreferrer\">Enable TCP/IP Network Protocol for SQL Server</a></p>\n\n<p><a href=\"https://i.stack.imgur.com/QKZmY.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/QKZmY.png\" alt=\"enter image description here\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/MkSwd.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/MkSwd.png\" alt=\"enter image description here\"></a></p>\n\n<p><sup>Images source: <a href=\"https://docs.microsoft.com/en-us/azure/includes/media/virtual-machines-sql-server-connection-tcp-protocol/enable-tcp.png\" rel=\"nofollow noreferrer\">https://docs.microsoft.com/en-us/azure/includes/media/virtual-machines-sql-server-connection-tcp-protocol/enable-tcp.png</a> and <a href=\"https://docs.microsoft.com/en-us/azure/includes/media/virtual-machines-sql-server-connection-tcp-protocol/restart-sql-server.png\" rel=\"nofollow noreferrer\">https://docs.microsoft.com/en-us/azure/includes/media/virtual-machines-sql-server-connection-tcp-protocol/restart-sql-server.png</a></sup></p>\n"}], "owner": {"reputation": 2675, "user_id": 924646, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/bxQ3m.jpg?s=128&g=1", "display_name": "andrey.shedko", "link": "https://stackoverflow.com/users/924646/andrey-shedko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1398, "favorite_count": 0, "accepted_answer_id": 47617571, "answer_count": 1, "score": 1, "last_activity_date": 1512301506, "creation_date": 1512297197, "last_edit_date": 1512301506, "question_id": 47617509, "link": "https://stackoverflow.com/questions/47617509/unable-to-connect-to-ms-sql", "title": "Unable to connect to MS SQL", "body": "<p>I'm playing around with <code>Golang</code> and trying to connect to MS SQL. I'm using <code>github.com/denisenkom/go-mssqldb</code> package and <code>sqlx</code> for this purpose.\nBut I'm getting error: <code>Unable to open tcp connection with host 'localhost:1433': dial tcp [::1]:1433: connectex: No connection could be made because the target machine actively refused it</code>.<br/>\nI'm completely sure that everything with database itself since it's perfectly working with my.Net project.\nHere is is the code:<br/></p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    \"log\"\n\n    _ \"github.com/denisenkom/go-mssqldb\"\n    \"github.com/jmoiron/sqlx\"\n)\n\ntype Excursion struct {\n    Id   int            `db:\"id\"`\n    Name sql.NullString `db:\"name\"`\n}\n\nfunc main() {\n    db, err := sqlx.Connect(\"sqlserver\", \"server=localhost;user id=DESKTOP-H74S9IT\\\\andrey.shedko;database=Flex;connection timeout=30;\")\n    if err := db.Ping(); err != nil {\n        log.Fatal(err)\n    }\n    rows, err := db.Queryx(\"SELECT Id, Name FROM dbo.Excursions\")\n    for rows.Next() {\n        var item Excursion\n        err = rows.StructScan(&amp;item)\n        if err != nil {\n            log.Fatal(err)\n        }\n        fmt.Printf(\n            \"%d - %s:  %s\\n===================\\n\",\n            item.Id,\n            item.Name.String,\n        )\n    }\n    defer db.Close()\n}\n</code></pre>\n\n<p>Could you advice please what is wrong with this?</p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 57, "user_id": 3565093, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/Llcy1.jpg?s=128&g=1", "display_name": "ma3x", "link": "https://stackoverflow.com/users/3565093/ma3x"}, "edited": false, "score": 0, "creation_date": 1512292455, "post_id": 47616537, "comment_id": 82192025, "body": "I have found the problem. <code>linkProvider.Get</code> took long time so visit is done before a new link is fetched."}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 3565093, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/Llcy1.jpg?s=128&g=1", "display_name": "ma3x", "link": "https://stackoverflow.com/users/3565093/ma3x"}, "edited": false, "score": 0, "creation_date": 1512289989, "post_id": 47616655, "comment_id": 82191521, "body": "Thank you! Have you any advises for second problem?"}], "tags": [], "owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "is_accepted": true, "score": 5, "last_activity_date": 1512289821, "creation_date": 1512289821, "answer_id": 47616655, "question_id": 47616537, "link": "https://stackoverflow.com/questions/47616537/concurrency-limit-goroutines-does-not-work-as-expected/47616655#47616655", "title": "Concurrency: limit goroutines does not work as expected", "body": "<p>I would solve this problem using channels and blocking feature - <a href=\"https://play.golang.org/p/KbYOI1oGNs\" rel=\"noreferrer\">https://play.golang.org/p/KbYOI1oGNs</a></p>\n\n<p>The main change is that we have a channel <code>guard</code>, we put new item there when goroutine is started (and it will block if size reaches limit), release when finished.</p>\n\n<pre><code>func (t *test) start() {\n    maxGoroutines := t.max\n    guard := make(chan struct{}, maxGoroutines)\n\n    for {\n        guard &lt;- struct{}{}\n        go func() {\n            t.visit()\n            &lt;-guard\n        }()\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 3565093, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/Llcy1.jpg?s=128&g=1", "display_name": "ma3x", "link": "https://stackoverflow.com/users/3565093/ma3x"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 629, "favorite_count": 0, "accepted_answer_id": 47616655, "answer_count": 1, "score": 2, "last_activity_date": 1512330237, "creation_date": 1512288723, "last_edit_date": 1512330237, "question_id": 47616537, "link": "https://stackoverflow.com/questions/47616537/concurrency-limit-goroutines-does-not-work-as-expected", "title": "Concurrency: limit goroutines does not work as expected", "body": "<p>I'm working on a search engine project currently. For faster crawl speed I use one goroutine per a link visit. But I encountered two problems that made me wonder!</p>\n\n<p>First one is a code sample:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"sync\"\nimport \"time\"\n\ntype test struct {\n    running int\n    max     int\n    mu      sync.Mutex\n}\n\nfunc main() {\n    t := &amp;test{max: 1000}\n    t.start()\n}\n\nfunc (t *test) start() {\n    for {\n        if t.running &gt;= t.max {\n            time.Sleep(200 * time.Millisecond)\n            continue\n        }\n        go t.visit()\n    }\n}\n\nfunc (t *test) visit() {\n    t.inc()\n    defer t.dec()\n    fmt.Println(\"visit called\")\n    fmt.Printf(\"running: %d, max: %d\\n\", t.running, t.max)\n    fmt.Println()\n    time.Sleep(time.Second)\n}\n\nfunc (t *test) inc() {\n    t.mu.Lock()\n    t.running++\n    t.mu.Unlock()\n}\nfunc (t *test) dec() {\n    t.mu.Lock()\n    t.running--\n    t.mu.Unlock()\n}\n</code></pre>\n\n<p>Output (cropped):</p>\n\n<pre><code>running: 2485, max: 1000\n\nrunning: 2485, max: 1000\n\nrunning: 2485, max: 1000\n\nvisit called\nrunning: 2485, max: 1000\n\nrunning: 2485, max: 1000\n\nrunning: 2485, max: 1000\n\nrunning: 2485, max: 1000\n\n\nvisit called\nrunning: 2485, max: 1000\n\n\nrunning: 2485, max: 1000\n</code></pre>\n\n<p>While I'm explicitly checking for maximum allowed goroutines in the loop, Why running goroutines exceeds the maximum?</p>\n\n<hr>\n\n<p>Second one is a part of real project code:</p>\n\n<p><strong>UPDATE:</strong> This is actually fixed, the problem was in <code>LinkProvider.Get()</code> implementation that took too long to return. <code>parser.visit()</code> returns in the mean time, but the loop in <code>Parser.Start()</code> is waiting for a new link... and the output seems sequential!</p>\n\n<pre><code>package worker\n\nimport (\n    \"errors\"\n    \"fmt\"\n    \"sync\"\n    \"time\"\n\n    \"bitbucket.org/codictive/ise/components/crawler/models\"\n    \"bitbucket.org/codictive/ise/components/log/logger\"\n    \"bitbucket.org/codictive/ise/core/component\"\n    \"bitbucket.org/codictive/ise/core/database\"\n)\n\n// Worker is a service that processes crawlable links.\ntype Worker interface {\n    Start() error\n    Stop() error\n    Restart() error\n    Status() Status\n}\n\n// Status contains runtime status of a worker.\ntype Status struct {\n    Running             bool\n    RunningParsersCount int\n}\n\n// New return a new defaultWorker with given config.\nfunc New() Worker {\n    return &amp;defaultWorker{\n        flow: make(chan bool),\n        stop: make(chan bool),\n    }\n}\n\n// defaultWorker is a Worker implementation.\ntype defaultWorker struct {\n    linkProvider         LinkProvider\n    handlersLimit        int\n    runningHandlersCount int\n    running              bool\n    mu                   sync.Mutex\n    flow                 chan bool\n    stop                 chan bool\n}\n\nfunc (w *defaultWorker) init() {\n    prate, _ := component.IntConfig(\"crawler.crawlInterval\")\n    arate, _ := component.IntConfig(\"crawler.ad_crawlInterval\")\n    concLimit, _ := component.IntConfig(\"crawler.concurrent_workers_limit\")\n    w.linkProvider = NewLinkProvider(time.Duration(prate)*time.Hour, time.Duration(arate)*time.Hour)\n    w.handlersLimit = concLimit\n}\n\n// Start runs worker.\nfunc (w *defaultWorker) Start() error {\n    logger.Info(\"Starting crawler worker...\")\n    w.running = true\n    w.init()\n\n    defer func() {\n        w.running = false\n        logger.Info(\"Worker stopped.\")\n    }()\n\n    for {\n        select {\n        case &lt;-w.stop:\n            w.flow &lt;- true\n            return nil\n        default:\n            fmt.Printf(\"running: %d limit: %d\\n\", w.runningHandlersCount, w.handlersLimit)\n            if w.runningHandlersCount &gt;= w.handlersLimit {\n                time.Sleep(200 * time.Millisecond)\n                continue\n            }\n\n            link := w.linkProvider.Get()\n            if link.ID == 0 {\n                logger.Debug(\"no link to crawl\")\n                time.Sleep(time.Minute)\n                continue\n            }\n\n            go func(l *models.CrawlLink) {\n                go w.visit(l)\n            }(link)\n        }\n    }\n}\n\n// Stop stops worker.\nfunc (w *defaultWorker) Stop() error {\n    logger.Info(\"Stopping crawler worker...\")\n    w.stop &lt;- true\n    select {\n    case &lt;-w.flow:\n        return nil\n    case &lt;-time.After(2 * time.Minute):\n        return errors.New(\"worker did not stopped properly\")\n    }\n}\n\n// Restart re-starts worker.\nfunc (w *defaultWorker) Restart() error {\n    logger.Info(\"Re-starting crawler worker...\")\n    w.stop &lt;- true\n    select {\n    case &lt;-w.flow:\n        return w.Start()\n    case &lt;-time.After(2 * time.Minute):\n        return errors.New(\"can not restart worker\")\n    }\n}\n\n// Status reports current worker status.\nfunc (w *defaultWorker) Status() Status {\n    return Status{\n        Running:             w.running,\n        RunningParsersCount: w.runningHandlersCount,\n    }\n}\n\nfunc (w *defaultWorker) visit(cl *models.CrawlLink) {\n    w.incrementRunningWorkers()\n    defer w.decrementRunningWorkers()\n\n    if cl == nil {\n        logger.Warning(\"[crawler.worker.visit] Can not visit a nil link.\")\n        return\n    }\n    if err := cl.LoadFull(); err != nil {\n        logger.Error(\"[crawler.worker.visit] Can not load link relations. (%v)\", err)\n        return\n    }\n\n    parser := NewParser(cl)\n    if parser == nil {\n        logger.Error(\"[crawler.worker.visit] Parser instantiation failed.\")\n        return\n    }\n    before := time.Now()\n    if err := parser.Parse(); err != nil {\n        cl.Error = err.Error()\n        logger.Error(\"[crawler.worker.visit] Parser finished with error: %v.\", err)\n        db := database.Open()\n        if err := db.Save(&amp;cl).Error; err != nil {\n            logger.Error(\"[crawler.worker.visit] can not update crawl link. (%v)\", err)\n        }\n    }\n    logger.Debug(\"[crawler.worker.visit] Parsing %q took %s.\", cl.URL, time.Since(before))\n    fmt.Printf(\"[crawler.worker.visit] Parsing %q took %s.\\n\", cl.URL, time.Since(before))\n}\n\nfunc (w *defaultWorker) incrementRunningWorkers() {\n    w.mu.Lock()\n    w.runningHandlersCount++\n    w.mu.Unlock()\n    fmt.Printf(\"increment called. current: %d\\n\", w.runningHandlersCount)\n}\n\nfunc (w *defaultWorker) decrementRunningWorkers() {\n    w.mu.Lock()\n    w.runningHandlersCount--\n    w.mu.Unlock()\n    fmt.Printf(\"decrement called. current: %d\\n\", w.runningHandlersCount)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>2017/12/03 11:24:36 profile: cpu profiling enabled, /var/folders/1x/01d32mrs2plcj9pnb3mnnrhw0000gn/T/profile924798503/cpu.pprof\nrunning: 0 limit: 1000\nRunning server on :8080\nrunning: 0 limit: 1000\nincrement called. current: 1\n[crawler.worker.visit] Parsing \"https://www.sheypoor.com/%D9%81%D8%B1%D8%A7%D8%B4%D8%A8%D9%86%D8%AF/%D8%A7%D9%85%D9%84%D8%A7%DA%A9/%D9%81%D8%B1%D9%88%D8%B4-%D8%A7%D8%AF%D8%A7%D8%B1%DB%8C-%D9%88-%D8%AA%D8%AC%D8%A7%D8%B1%DB%8C\" took 370.140513ms.\ndecrement called. current: 0\nrunning: 0 limit: 1000\nincrement called. current: 1\n[crawler.worker.visit] Parsing \"https://www.sheypoor.com/%D8%B3%D8%A7%D9%85%D8%B3%D9%88%D9%86%DA%AF-s3-neo-24252682.html\" took 193.193357ms.\ndecrement called. current: 0\nrunning: 0 limit: 1000\nincrement called. current: 1\n[crawler.worker.visit] Parsing \"https://www.sheypoor.com/%D9%85%DB%8C%D8%B2%D9%88%D8%B5%D9%86%D8%AF%D9%84%DB%8C-%D8%AA%D8%A7%D9%84%D8%A7%D8%B1-22399505.html\" took 201.636741ms.\ndecrement called. current: 0\nrunning: 0 limit: 1000\nincrement called. current: 1\n[crawler.worker.visit] Parsing \"https://www.sheypoor.com/50000%D9%85%D8%AA%D8%B1-%D8%B2%D9%85%DB%8C%D9%86-%D9%85%D8%B1%D8%BA%D8%AF%D8%A7%D8%B1%DB%8C-%D9%88%D8%A7%D9%82%D8%B9-%D8%AF%D8%B1-%D8%AE%D8%B1%D9%85%D8%AF%D8%B1%D9%87-23075331.html\" took 210.360596ms.\ndecrement called. current: 0\n^C2017/12/03 11:24:43 profile: caught interrupt, stopping profiles\n2017/12/03 11:24:43 profile: cpu profiling disabled, /var/folders/1x/01d32mrs2plcj9pnb3mnnrhw0000gn/T/profile924798503/cpu.pprof\n</code></pre>\n\n<p>As you can see the <code>visit</code> method runs completely sequential! Whether I call it with just <code>go visit(link)</code> or the one used in above code.\nWhy this happens? What is stopping the loop from iterating?</p>\n"}, {"tags": ["go", "pprof"], "answers": [{"comments": [{"owner": {"reputation": 133, "user_id": 7931079, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/57330c6078c62d95d0d4e72838e89ca2?s=128&d=identicon&r=PG&f=1", "display_name": "Nelson", "link": "https://stackoverflow.com/users/7931079/nelson"}, "edited": false, "score": 0, "creation_date": 1512293696, "post_id": 47616225, "comment_id": 82192327, "body": "have you try add fmt.Println(bs)? that will reduce memory occupy"}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 133, "user_id": 7931079, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/57330c6078c62d95d0d4e72838e89ca2?s=128&d=identicon&r=PG&f=1", "display_name": "Nelson", "link": "https://stackoverflow.com/users/7931079/nelson"}, "edited": false, "score": 0, "creation_date": 1512294806, "post_id": 47616225, "comment_id": 82192604, "body": "Yes, Sure. Using  <code>fmt.Println(bs)</code> makes GC(garbage collector) more time to collect Memory and the memory usage is <code>25520KBytes</code> for me with <code>fmt.Println(bs)</code> ."}, {"owner": {"reputation": 133, "user_id": 7931079, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/57330c6078c62d95d0d4e72838e89ca2?s=128&d=identicon&r=PG&f=1", "display_name": "Nelson", "link": "https://stackoverflow.com/users/7931079/nelson"}, "edited": false, "score": 0, "creation_date": 1512295847, "post_id": 47616225, "comment_id": 82192859, "body": "Yes, fmt.Println(bs) makes GC more times. But no print should not occupy more and more memory until system limit."}, {"owner": {"reputation": 133, "user_id": 7931079, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/57330c6078c62d95d0d4e72838e89ca2?s=128&d=identicon&r=PG&f=1", "display_name": "Nelson", "link": "https://stackoverflow.com/users/7931079/nelson"}, "edited": false, "score": 0, "creation_date": 1512296031, "post_id": 47616225, "comment_id": 82192900, "body": "In my testing, no print will occupy more than 3GB memory"}, {"owner": {"reputation": 133, "user_id": 7931079, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/57330c6078c62d95d0d4e72838e89ca2?s=128&d=identicon&r=PG&f=1", "display_name": "Nelson", "link": "https://stackoverflow.com/users/7931079/nelson"}, "edited": false, "score": 0, "creation_date": 1512296524, "post_id": 47616225, "comment_id": 82193022, "body": "I still can\u2019t understand why no print will exhausting system memory and with print work fine. No print should trigger GC periodly too?"}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 133, "user_id": 7931079, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/57330c6078c62d95d0d4e72838e89ca2?s=128&d=identicon&r=PG&f=1", "display_name": "Nelson", "link": "https://stackoverflow.com/users/7931079/nelson"}, "edited": false, "score": 0, "creation_date": 1512298319, "post_id": 47616225, "comment_id": 82193444, "body": "see <a href=\"http://morsmachine.dk/go-scheduler\" rel=\"nofollow noreferrer\">Go scheduler</a> and <a href=\"http://www.sarathlakshman.com/2016/06/15/pitfall-of-golang-scheduler\" rel=\"nofollow noreferrer\">this</a>"}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 4, "last_activity_date": 1512288326, "last_edit_date": 1512288326, "creation_date": 1512285926, "answer_id": 47616225, "question_id": 47615543, "link": "https://stackoverflow.com/questions/47615543/convert-byte-to-string-in-golang-strange-occupy-heap/47616225#47616225", "title": "convert byte[] to string in golang strange occupy heap", "body": "<p><strong>No</strong>, there is <strong>no</strong> memory leak:<br>\nYou are using <code>500000</code> concurrent goroutines, you just need to <strong>limit (reduce) the number of concurrent goroutines</strong>, e.g.:</p>\n\n<pre><code>c := make(chan int, runtime.NumCPU())\n</code></pre>\n\n<p>Try this ( and see the end of this edit):</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"runtime\"\n    \"strings\"\n    \"time\"\n)\n\nfunc main() {\n    c := make(chan int, runtime.NumCPU())\n    for {\n        c &lt;- 1\n        bs := bytes.NewBufferString(\"A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z\").Bytes()\n        s := string(bs)\n        ss := strings.Split(s, \",\")\n        go func(ss []string) {\n            fmt.Println(ss)\n            time.Sleep(time.Millisecond)\n            &lt;-c\n        }(ss)\n    }\n}\n</code></pre>\n\n<hr>\n\n<p>Your Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"net/http\"\n    _ \"net/http/pprof\"\n    \"strings\"\n    \"time\"\n)\n\nvar (\n    c = make(chan int, 500000)\n)\n\nfunc main() {\n    go func() {\n        http.ListenAndServe(\":8080\", nil)\n    }()\n    f := func(ss []string) {\n        fmt.Println(ss)\n        time.Sleep(time.Millisecond)\n        &lt;-c\n    }\n    for {\n        c &lt;- 1\n        bs := bytes.NewBufferString(\"A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z\").Bytes()\n        // fmt.Println(bs) // will raise memory leak after marked as comment???\n        s := string(bs)\n        ss := strings.Split(s, \",\")\n        go f(ss)\n    }\n}\n</code></pre>\n\n<p>It reaches steady state after a while and even <strong>reduced</strong> Memory usage:</p>\n\n<pre><code>// Mem          CPU time:\n// 5,464,208K 0:1:20\n// 5,468,208K 0:2:20\n// 5,469,608K 0:3:20\n// 5,469,844K 0:4:20\n// 5,469,844K 0:5:20\n// 5,469,848K 0:6:20\n// 5,469,848K 0:7:20 fixed\n// 5,469,848K 0:8:20 fixed\n// 5,469,616K 0:9:20 reduced\n</code></pre>\n"}], "owner": {"reputation": 133, "user_id": 7931079, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/57330c6078c62d95d0d4e72838e89ca2?s=128&d=identicon&r=PG&f=1", "display_name": "Nelson", "link": "https://stackoverflow.com/users/7931079/nelson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 847, "favorite_count": 0, "accepted_answer_id": 47616225, "answer_count": 1, "score": 2, "last_activity_date": 1512288326, "creation_date": 1512278712, "question_id": 47615543, "link": "https://stackoverflow.com/questions/47615543/convert-byte-to-string-in-golang-strange-occupy-heap", "title": "convert byte[] to string in golang strange occupy heap", "body": "<p>I found strange occupy heap when convert byte[] to string with below code</p>\n\n<pre><code>package main\n\nimport (\n  \"bytes\"\n  \"fmt\"\n  \"net/http\"\n  _ \"net/http/pprof\"\n  \"strings\"\n  \"time\"\n)\n\nvar (\n  c = make(chan int, 500000)\n)\n\nfunc main() {\n  go func() {\n    http.ListenAndServe(\":8080\", nil)\n  }()\n  f := func(ss []string) {\n    fmt.Println(ss)\n    time.Sleep(time.Millisecond)\n    &lt;-c\n  }\n  for {\n    c &lt;- 1\n    bs := bytes.NewBufferString(\"A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z\").Bytes()\n    fmt.Println(bs) // will raise memory leak after marked as comment???\n    s := string(bs)\n    ss := strings.Split(s, \",\")\n    go f(ss)\n  }\n}\n</code></pre>\n\n<ol>\n<li><p>without <code>fmt.Println(bs)</code> will gradually exhausting memory.</p></li>\n<li><p>with <code>fmt.Println(bs)</code> work fine. i can't understand what happened? i'm worked with <code>version go1.9.2 darwin/amd64</code></p></li>\n</ol>\n"}, {"tags": ["go", "google-cloud-datastore", "kubernetes", "google-cloud-platform"], "comments": [{"owner": {"reputation": 3779, "user_id": 1214341, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c2ab16e7bad14de2336741347b36c2cf?s=128&d=identicon&r=PG", "display_name": "vjdhama", "link": "https://stackoverflow.com/users/1214341/vjdhama"}, "edited": false, "score": 0, "creation_date": 1512284280, "post_id": 47613623, "comment_id": 82190377, "body": "Did you just try to edit permission on instances itself?"}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "reply_to_user": {"reputation": 3779, "user_id": 1214341, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/c2ab16e7bad14de2336741347b36c2cf?s=128&d=identicon&r=PG", "display_name": "vjdhama", "link": "https://stackoverflow.com/users/1214341/vjdhama"}, "edited": false, "score": 0, "creation_date": 1537829224, "post_id": 47613623, "comment_id": 91917896, "body": "@vjdhama How do I edit it? there is not a edit button at permissions"}], "answers": [{"tags": [], "owner": {"reputation": 643, "user_id": 7552759, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ldvQc.jpg?s=128&g=1", "display_name": "Anurope", "link": "https://stackoverflow.com/users/7552759/anurope"}, "is_accepted": true, "score": 10, "last_activity_date": 1512323731, "last_edit_date": 1512323731, "creation_date": 1512323271, "answer_id": 47621300, "question_id": 47613623, "link": "https://stackoverflow.com/questions/47613623/cant-access-google-cloud-datastore-from-google-kubernetes-engine-cluster/47621300#47621300", "title": "Can&#39;t access Google Cloud Datastore from Google Kubernetes Engine cluster", "body": "<p>So what I learnt in the process of debugging this issue was that:</p>\n\n<ul>\n<li><p>During the creation of a Kubernetes Cluster you can specify permissions for the GCE nodes that will be created.</p></li>\n<li><p>If you for example enable Datastore access on the cluster nodes during creation, you will be able to access Datastore directly from the Pods without having to set up anything else.</p></li>\n<li><p>If your cluster node permissions are disabled for most things (default settings) like mine were, you will need to create an appropriate Service Account for each application that wants to use a GCP resource like Datastore.</p></li>\n<li><p>Another alternative is to create a new node pool with the <code>gcloud</code> command, set the desired permission scopes and then migrate all deployments to the new node pool (rather tedious).</p></li>\n</ul>\n\n<p>So at the end of the day I fixed the issue by creating a Service Account for my application, downloading the JSON authentication key, creating a Kubernetes secret which contains that key, and in the case of Datastore, I set the <code>GOOGLE_APPLICATION_CREDENTIALS</code> environment variable to the path of the mounted secret JSON key. </p>\n\n<p>This way when my application starts, it checks if the <code>GOOGLE_APPLICATION_CREDENTIALS</code> variable is present, and authenticates Datastore API access based on the JSON key that the variable points to.</p>\n\n<p>Deployment YAML snippet:</p>\n\n<pre><code>  ...\n  containers:\n  - image: foo\n    name: foo\n    env:\n    - name: GOOGLE_APPLICATION_CREDENTIALS\n      value: /auth/credentials.json\n    volumeMounts:\n    - name: foo-service-account\n      mountPath: \"/auth\"\n      readOnly: true\n  volumes:\n  - name: foo-service-account\n    secret:\n      secretName: foo-service-account\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1779, "user_id": 5830773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/96e221616c08bf912559eccb219b5b89?s=128&d=identicon&r=PG&f=1", "display_name": "M. Schena", "link": "https://stackoverflow.com/users/5830773/m-schena"}, "is_accepted": false, "score": 0, "last_activity_date": 1539600695, "last_edit_date": 1539600695, "creation_date": 1539600342, "answer_id": 52814965, "question_id": 47613623, "link": "https://stackoverflow.com/questions/47613623/cant-access-google-cloud-datastore-from-google-kubernetes-engine-cluster/52814965#52814965", "title": "Can&#39;t access Google Cloud Datastore from Google Kubernetes Engine cluster", "body": "<p>After struggling some hours, I was also able to connect to the datastore. Here are my results, most of if from <a href=\"https://cloud.google.com/kubernetes-engine/docs/tutorials/authenticating-to-cloud-platform\" rel=\"nofollow noreferrer\">Google Docs</a>:</p>\n\n<ol>\n<li><p>Create Service Account</p>\n\n<p><code>gcloud iam service-accounts create [SERVICE_ACCOUNT_NAME]</code></p></li>\n<li><p>Get full iam account name</p>\n\n<p><code>gcloud iam service-accounts list</code></p>\n\n<p>The result will look something like this: </p>\n\n<p><code>[SERVICE_ACCOUNT_NAME]@[PROJECT_NAME].iam.gserviceaccount.com</code></p></li>\n<li><p>Give owner access to the project for the service account</p>\n\n<p><code>gcloud projects add-iam-policy-binding [PROJECT_NAME] --member serviceAccount:[SERVICE_ACCOUNT_NAME]@[PROJECT_NAME].iam.gserviceaccount.com --role roles/owner</code></p></li>\n<li><p>Create key-file</p>\n\n<p><code>gcloud iam service-accounts keys create mycredentials.json --iam-account [SERVICE_ACCOUNT_NAME]@[PROJECT_NAME].iam.gserviceaccount.com</code></p></li>\n<li><p>Create <code>app-key</code> Secret</p>\n\n<p><code>kubectl create secret generic app-key --from-file=credentials.json=mycredentials.json</code></p>\n\n<p>This <code>app-key</code> secret will then be mounted in the deployment.yaml</p></li>\n<li><p>Edit deyployment file</p></li>\n</ol>\n\n<p>deployment.yaml:</p>\n\n<pre><code>...\nspec:\n containers:\n - name: app\n   image: eu.gcr.io/google_project_id/springapplication:v1\n   volumeMounts:\n   - name: google-cloud-key\n     mountPath: /var/secrets/google\n   env:\n   - name: GOOGLE_APPLICATION_CREDENTIALS\n     value: /var/secrets/google/credentials.json\n   ports:\n   - name: http-server\n     containerPort: 8080\n volumes:\n - name: google-cloud-key\n   secret:\n     secretName: app-key\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 193, "user_id": 1131714, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/138066bcf1d1a83a410acc3fd9cea8d1?s=128&d=identicon&r=PG", "display_name": "Kurt", "link": "https://stackoverflow.com/users/1131714/kurt"}, "is_accepted": false, "score": 0, "last_activity_date": 1563444574, "creation_date": 1563444574, "answer_id": 57092102, "question_id": 47613623, "link": "https://stackoverflow.com/questions/47613623/cant-access-google-cloud-datastore-from-google-kubernetes-engine-cluster/57092102#57092102", "title": "Can&#39;t access Google Cloud Datastore from Google Kubernetes Engine cluster", "body": "<p>I was using a minimalistic Dockerfile like:</p>\n\n<pre><code>FROM SCRATCH\nADD main /\nEXPOSE 80\nCMD [\"/main\"]\n</code></pre>\n\n<p>which kept my go app in an indefinite \"hanging\" state when trying to connect to the GCP Datastore. After LOTS of playing I figured out that the SCRATCH Docker image might be missing certain environment tools / variables / libraries which the Google cloud library requires. Using this Dockerfile now works:</p>\n\n<pre><code>FROM golang:alpine\nRUN apk add --no-cache ca-certificates\nADD main /\nEXPOSE 80\nCMD [\"/main\"]\n</code></pre>\n\n<p>It does not require me to provide the google credentials environment variable. The library seems to automatically understand where it's running in (maybe from the context.Background() ?) and automatically uses a default service account which Google creates for you when you create your cluster on GKE.</p>\n"}], "owner": {"reputation": 643, "user_id": 7552759, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ldvQc.jpg?s=128&g=1", "display_name": "Anurope", "link": "https://stackoverflow.com/users/7552759/anurope"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2885, "favorite_count": 0, "accepted_answer_id": 47621300, "answer_count": 3, "score": 6, "last_activity_date": 1563444574, "creation_date": 1512256494, "last_edit_date": 1512323443, "question_id": 47613623, "link": "https://stackoverflow.com/questions/47613623/cant-access-google-cloud-datastore-from-google-kubernetes-engine-cluster", "title": "Can&#39;t access Google Cloud Datastore from Google Kubernetes Engine cluster", "body": "<p>I have a simple application that Gets and Puts information from a Datastore.</p>\n\n<p>It works everywhere, but when I run it from inside the Kubernetes Engine cluster, I get this output:</p>\n\n<pre><code>Error from Get()\nrpc error: code = PermissionDenied desc = Request had insufficient authentication scopes.\nError from Put()\nrpc error: code = PermissionDenied desc = Request had insufficient authentication scopes.\n</code></pre>\n\n<p>I'm using the <code>cloud.google.com/go/datastore</code> package and the Go language.</p>\n\n<p>I don't know why I'm getting this error since the application works everywhere else just fine.</p>\n\n<p><strong>Update:</strong></p>\n\n<p>Looking for an answer I found this comment on Google Groups:</p>\n\n<blockquote>\n  <p>In order to use Cloud Datastore from GCE, the instance needs to be\n  configured with a couple of extra scopes. These can't be added to\n  existing GCE instances, but you can create a new one with the\n  following Cloud SDK command:</p>\n  \n  <p>gcloud compute instances create hello-datastore --project\n   --zone  --scopes datastore userinfo-email</p>\n</blockquote>\n\n<p>Would that mean I can't use Datastore from GKE by default?</p>\n\n<p><strong>Update 2:</strong></p>\n\n<p>I can see that when creating my cluster I didn't enable any permissions (which are disabled for most services by default). I suppose that's what's causing the issue:</p>\n\n<p><img src=\"https://i.stack.imgur.com/gTx4i.png\" width=\"400\"/></p>\n\n<p>Strangely, I can use CloudSQL just fine even though it's disabled (using the <code>cloudsql_proxy</code> container).</p>\n"}, {"tags": ["email", "go", "multipart"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1512247455, "post_id": 47612379, "comment_id": 82182966, "body": "See the <a href=\"https://golang.org/src/mime/multipart/writer_test.go\" rel=\"nofollow noreferrer\">tests</a> for example uses of the multipart package."}], "answers": [{"tags": [], "owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "is_accepted": false, "score": 1, "last_activity_date": 1512300511, "creation_date": 1512300511, "answer_id": 47617875, "question_id": 47612379, "link": "https://stackoverflow.com/questions/47612379/mutlipart-email-in-go/47617875#47617875", "title": "mutlipart email in go", "body": "<p>You may like this package <a href=\"https://github.com/scorredoira/email\" rel=\"nofollow noreferrer\">https://github.com/scorredoira/email</a></p>\n\n<pre><code>// compose the message\nm := email.NewMessage(\"Hi\", \"this is the body\")\nm.From = mail.Address{Name: \"From\", Address: \"from@example.com\"}\nm.To = []string{\"to@example.com\"}\n\n// add attachments\nif err := m.Attach(\"email.go\"); err != nil {\n    log.Fatal(err)\n}\n\n// send it\nauth := smtp.PlainAuth(\"\", \"from@example.com\", \"pwd\", \"smtp.zoho.com\")\nif err := email.Send(\"smtp.zoho.com:587\", auth, m); err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 72, "user_id": 8850201, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-8Ga_nFEa-Yg/AAAAAAAAAAI/AAAAAAAAAAw/QnpLp8KGylQ/photo.jpg?sz=128", "display_name": "Florian", "link": "https://stackoverflow.com/users/8850201/florian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 857, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1512300511, "creation_date": 1512247274, "question_id": 47612379, "link": "https://stackoverflow.com/questions/47612379/mutlipart-email-in-go", "title": "mutlipart email in go", "body": "<p>I'm trying to send multipart-emails using golang, but I can't figure out how to create them. I know there's a multipart package, but there are no example how to use it. </p>\n\n<p>I already tried the library mailyak, but it doesn't work like it should. So, how can I create multipart emails with normal golang smtp/multipart package?</p>\n\n<p>The mail should have a html and a plain-text part.</p>\n"}, {"tags": ["go", "patch", "goland"], "answers": [{"tags": [], "owner": {"reputation": 28120, "user_id": 492773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4c30dea4ed3e1c2efc5e877f1f3c971?s=128&d=identicon&r=PG", "display_name": "kichik", "link": "https://stackoverflow.com/users/492773/kichik"}, "is_accepted": false, "score": 3, "last_activity_date": 1512238229, "creation_date": 1512238229, "answer_id": 47610967, "question_id": 47610873, "link": "https://stackoverflow.com/questions/47610873/exec-command-for-patch-command/47610967#47610967", "title": "exec.command for patch command", "body": "<p>You're missing this paragraph from the <a href=\"https://golang.org/pkg/os/exec/\" rel=\"nofollow noreferrer\">documentation</a>:</p>\n\n<blockquote>\n  <p>Unlike the \"system\" library call from C and other languages, the\n  os/exec package intentionally does not invoke the system shell and\n  does not expand any glob patterns or handle other expansions,\n  pipelines, or redirections typically done by shells. The package\n  behaves more like C's \"exec\" family of functions. To expand glob\n  patterns, either call the shell directly, taking care to escape any\n  dangerous input, or use the path/filepath package's Glob function. To\n  expand environment variables, use package os's ExpandEnv.</p>\n</blockquote>\n\n<p>The shell is responsible for handling <code>&lt;</code> operations. You can set <code>stdin</code> yourself with the file as input or you can use the shell. To use the shell, try something like:</p>\n\n<pre><code>runCommand(\"/bin/sh\", \"patch -p0 &lt; /tmp/file\")\n</code></pre>\n\n<p>Note that this won't work on Windows. Reading the file and writing to <code>stdin</code> yourself is a more easily portable solution.</p>\n"}], "owner": {"reputation": 559, "user_id": 1364965, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/7132085b7f3def420c4c8eec8242f06f?s=128&d=identicon&r=PG", "display_name": "u_peerless", "link": "https://stackoverflow.com/users/1364965/u-peerless"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1512315916, "creation_date": 1512237614, "last_edit_date": 1512315916, "question_id": 47610873, "link": "https://stackoverflow.com/questions/47610873/exec-command-for-patch-command", "title": "exec.command for patch command", "body": "<p>I am trying to patch a file using the below command</p>\n\n<pre><code>patch -p0 &lt; &lt;file_path&gt;\n</code></pre>\n\n<p>My runCommand syntax is as below:</p>\n\n<pre><code>func runCommand(cmd string, args ...string) error {\n    ecmd := exec.Command(cmd, args...)\n    ecmd.Stdout = os.Stdout\n    ecmd.Stderr = os.Stderr\n    ecmd.Stdin = os.Stdin\n    err := ecmd.Run()\n    return err\n}\n</code></pre>\n\n<p>Now I am passing my patch command as below:</p>\n\n<pre><code>cmd = \"patch\"\nargs := []string{\"-p0\", \"&lt;\",  \"/tmp/file\"}\nerr = runCommand(cmd, args...)\n</code></pre>\n\n<p>But I am seeing the below error:</p>\n\n<p><strong>patch: **** Can't find file '&lt;' : No such file or directory</strong></p>\n\n<p>Can you please let me know what I am missing here?</p>\n"}, {"tags": ["docker", "go", "jenkins", "kubernetes"], "comments": [{"owner": {"reputation": 12494, "user_id": 1402929, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/IORgE.jpg?s=128&g=1", "display_name": "Matt Harrison", "link": "https://stackoverflow.com/users/1402929/matt-harrison"}, "edited": false, "score": 0, "creation_date": 1512238565, "post_id": 47610730, "comment_id": 82180246, "body": "&quot;Everything is available locally&quot; - Are you sure it&#39;s in the build context?"}, {"owner": {"reputation": 2884, "user_id": 1430476, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/cf9e49064895c6b498e936d2a2b80bf3?s=128&d=identicon&r=PG", "display_name": "Tino", "link": "https://stackoverflow.com/users/1430476/tino"}, "reply_to_user": {"reputation": 12494, "user_id": 1402929, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/IORgE.jpg?s=128&g=1", "display_name": "Matt Harrison", "link": "https://stackoverflow.com/users/1402929/matt-harrison"}, "edited": false, "score": 0, "creation_date": 1512238743, "post_id": 47610730, "comment_id": 82180303, "body": "hm ok how would I do that?"}], "answers": [{"comments": [{"owner": {"reputation": 2884, "user_id": 1430476, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/cf9e49064895c6b498e936d2a2b80bf3?s=128&d=identicon&r=PG", "display_name": "Tino", "link": "https://stackoverflow.com/users/1430476/tino"}, "edited": false, "score": 0, "creation_date": 1512290044, "post_id": 47615201, "comment_id": 82191533, "body": "Thank you for your time explaining. Very neat. I&#39;ll give it a go. I use Jenkins and Kubernetes. Whenever there is a change in repo it rebuilds the image. I just have to optimise the go stuff coming from node... thx. BTW: You should write a blog article about it!"}, {"owner": {"reputation": 12114, "user_id": 1556338, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/032183d1d89374352470ebe6bc87b38c?s=128&d=identicon&r=PG&f=1", "display_name": "Bernard", "link": "https://stackoverflow.com/users/1556338/bernard"}, "reply_to_user": {"reputation": 2884, "user_id": 1430476, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/cf9e49064895c6b498e936d2a2b80bf3?s=128&d=identicon&r=PG", "display_name": "Tino", "link": "https://stackoverflow.com/users/1430476/tino"}, "edited": false, "score": 0, "creation_date": 1512306655, "post_id": 47615201, "comment_id": 82195438, "body": "Thanks, I reach more people here."}], "tags": [], "owner": {"reputation": 12114, "user_id": 1556338, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/032183d1d89374352470ebe6bc87b38c?s=128&d=identicon&r=PG&f=1", "display_name": "Bernard", "link": "https://stackoverflow.com/users/1556338/bernard"}, "is_accepted": true, "score": 1, "last_activity_date": 1538006919, "last_edit_date": 1538006919, "creation_date": 1512274620, "answer_id": 47615201, "question_id": 47610730, "link": "https://stackoverflow.com/questions/47610730/docker-build-go-app-private-github/47615201#47615201", "title": "docker build go app private github", "body": "<p>Only use <code>golang:1.8-onbuild</code> if you need to compile your go code image INSIDE a container. That's typically useful for CI builds. Otherwise avoid since it's a massive image.</p>\n\n<p>A much much faster solution is to build your Go application locally (dev env for instance) and copy the final Go application to a very lightweight container.</p>\n\n<p>I'll give you our standard process.</p>\n\n<ol>\n<li><p>If your local machine is a Mac or Windows, you need to <code>cross-compile</code> your Go code for linux using: <code>GOOS=liux GOARCH=amd64 go build -o myapp_linux-amd64</code>. The <code>linux-amd64</code> is just a convention to remind yourself that the file is compiled for linux, not mac or windows.</p></li>\n<li><p>We also deploy our Go apps to the very lightweight Alpine linux container. Alpine is now the standard Docker image to create app. It's very small and secure but it has one major quirk; it is using the musc instead of the more common glibc as the underlying OS/IO library, so we need a few more compilation flags: <code>-a -ldflags '-w -extldflags \"-static\"'</code></p></li>\n<li><p>As an extra, we also remove the developer's own path in the filename listed in a stacktrace using: <code>-gcflags=-trimpath=$(pwd) -asmflags=-trimpath=$(pwd)</code></p></li>\n</ol>\n\n<p>The resulting compile command that we use is:\n<code>\nCGO_ENABLED=0 GOOS=linux GOARCH=amd64 GOROOT_FINAL=$(pwd) go build -a -ldflags '-w -extldflags \"-static\"' -gcflags=-trimpath=$(pwd) -asmflags=-trimpath=$(pwd) -o myapp_linux-amd64\n</code></p>\n\n<p>You can now build your app locally on your dev env and create the image using the following Dockerfile:</p>\n\n<pre><code>FROM alpine:3.6\nCOPY ./myapp_linux-amd64 /usr/local/bin/myapp\n\nENTRYPOINT []\nCMD /usr/local/bin/myapp\n</code></pre>\n\n<p>build it using:</p>\n\n<p><code>docker build -t myimagename:tag .</code></p>\n"}, {"tags": [], "owner": {"reputation": 251, "user_id": 4108883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84ec38ff376007b34152d5756b9f56ae?s=128&d=identicon&r=PG", "display_name": "HammerMeetNail", "link": "https://stackoverflow.com/users/4108883/hammermeetnail"}, "is_accepted": false, "score": 0, "last_activity_date": 1512274819, "creation_date": 1512274819, "answer_id": 47615217, "question_id": 47610730, "link": "https://stackoverflow.com/questions/47610730/docker-build-go-app-private-github/47615217#47615217", "title": "docker build go app private github", "body": "<p>Is there anything else in the Dockerfile other than FROM? What docker command are you using to turn on the container? If you're just trying to build a docker image and that's failing, there shouldn't be any interaction or authorization with github unless defined in the Dockerfile. </p>\n\n<p>Can you try running this? It will pull down the official Go Alpine image and boot you into an interactive terminal. </p>\n\n<pre><code>docker run -it golang:1.9.2-alpine3.6 sh\n</code></pre>\n\n<p>Alternatively you could also use your image.</p>\n\n<pre><code>docker run -it golang:1.8-onbuild sh\n</code></pre>\n\n<p>If that works, the issue is probably with the Dockerfile and not with Docker or the Go image. </p>\n\n<p>If you want to know more about Docker and Go checkout the <a href=\"https://hub.docker.com/_/golang/\" rel=\"nofollow noreferrer\">official repository</a>. I also recently wrote about <a href=\"https://medium.com/a-little-bit/containers-make-it-easy-43ec04809e82\" rel=\"nofollow noreferrer\">Docker and Go</a> and how to get up and running with it quickly. </p>\n"}, {"tags": [], "owner": {"reputation": 2195, "user_id": 1758194, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/H7jM0.jpg?s=128&g=1", "display_name": "Orvyl", "link": "https://stackoverflow.com/users/1758194/orvyl"}, "is_accepted": false, "score": 0, "last_activity_date": 1512791728, "creation_date": 1512791728, "answer_id": 47725169, "question_id": 47610730, "link": "https://stackoverflow.com/questions/47610730/docker-build-go-app-private-github/47725169#47725169", "title": "docker build go app private github", "body": "<p>If you have <code>/vendor</code> inside the root directory of your project/package, it should not pull anything from the internet. Here's how I did mine: <a href=\"https://gist.github.com/orvyl/7000f973abe88d40c8c91d4e28e139a7\" rel=\"nofollow noreferrer\">https://gist.github.com/orvyl/7000f973abe88d40c8c91d4e28e139a7</a></p>\n"}], "owner": {"reputation": 2884, "user_id": 1430476, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/cf9e49064895c6b498e936d2a2b80bf3?s=128&d=identicon&r=PG", "display_name": "Tino", "link": "https://stackoverflow.com/users/1430476/tino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 748, "favorite_count": 0, "accepted_answer_id": 47615201, "answer_count": 3, "score": 1, "last_activity_date": 1538006919, "creation_date": 1512236879, "question_id": 47610730, "link": "https://stackoverflow.com/questions/47610730/docker-build-go-app-private-github", "title": "docker build go app private github", "body": "<p>I'm trying to build a docker image from my <code>go</code> app. The github repo is private. I'm a bit new to go (and docker), but I thought that the <code>/vendor</code> file managed through <code>glide</code> should circumvent the problem? Also why does docker have to get everything from github? Everything is available locally. </p>\n\n<p>command:</p>\n\n<pre><code>docker build -t testimage .\n</code></pre>\n\n<p>Dockerfile</p>\n\n<pre><code>FROM golang:1.8-onbuild\n</code></pre>\n\n<p>It fails at the step</p>\n\n<pre><code>exec go get -v -d\n....... \nfatal: could not read Username for 'https://github.com': No such device or address\n</code></pre>\n\n<p>How can I get around this? Thx</p>\n"}, {"tags": ["pointers", "go", "struct", "reflection"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 3, "creation_date": 1512230569, "post_id": 47609731, "comment_id": 82177858, "body": "<code>Test</code> doesn&#39;t return anything."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1512230639, "post_id": 47609731, "comment_id": 82177887, "body": "Don&#39;t use <code>this</code> as a variable name. Name your receivers to mean something."}, {"owner": {"reputation": 65, "user_id": 5762493, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f4d966c30995440b1ab28c2353c18d6e?s=128&d=identicon&r=PG&f=1", "display_name": "rowele", "link": "https://stackoverflow.com/users/5762493/rowele"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 1, "creation_date": 1512231747, "post_id": 47609731, "comment_id": 82178248, "body": "@tkausl  How can I get the Name value from the Blog\uff1f"}, {"owner": {"reputation": 65, "user_id": 5762493, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f4d966c30995440b1ab28c2353c18d6e?s=128&d=identicon&r=PG&f=1", "display_name": "rowele", "link": "https://stackoverflow.com/users/5762493/rowele"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1512231824, "post_id": 47609731, "comment_id": 82178269, "body": "@Flimzy  How can I get the Name value from the Blog\uff1f"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1512232486, "post_id": 47609731, "comment_id": 82178458, "body": "The normal way would be: <code>name := blog.Name</code>.  Why are you using reflection?"}, {"owner": {"reputation": 65, "user_id": 5762493, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f4d966c30995440b1ab28c2353c18d6e?s=128&d=identicon&r=PG&f=1", "display_name": "rowele", "link": "https://stackoverflow.com/users/5762493/rowele"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1512233307, "post_id": 47609731, "comment_id": 82178733, "body": "@Flimzy This is just a demo, I want to use reflection to call the corresponding method and get the value of it based on the different struct type"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512233651, "post_id": 47609731, "comment_id": 82178827, "body": "<a href=\"https://play.golang.org/p/7ug1S_mdCo\" rel=\"nofollow noreferrer\">play.golang.org/p/7ug1S_mdCo</a>"}, {"owner": {"reputation": 65, "user_id": 5762493, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f4d966c30995440b1ab28c2353c18d6e?s=128&d=identicon&r=PG&f=1", "display_name": "rowele", "link": "https://stackoverflow.com/users/5762493/rowele"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512233944, "post_id": 47609731, "comment_id": 82178931, "body": "@mkopriva The page cannot be opened:Unavailable For Legal Reasons"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512233954, "post_id": 47609731, "comment_id": 82178939, "body": "@rowele updated the previous example with detailed names <a href=\"https://play.golang.org/p/iyUw-Sp97-\" rel=\"nofollow noreferrer\">play.golang.org/p/iyUw-Sp97-</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512233992, "post_id": 47609731, "comment_id": 82178952, "body": "@rowele You can&#39;t open go playground?"}], "answers": [{"comments": [{"owner": {"reputation": 65, "user_id": 5762493, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f4d966c30995440b1ab28c2353c18d6e?s=128&d=identicon&r=PG&f=1", "display_name": "rowele", "link": "https://stackoverflow.com/users/5762493/rowele"}, "edited": false, "score": 0, "creation_date": 1512234276, "post_id": 47610317, "comment_id": 82179045, "body": "Thank you for your selfless dedication,I really can&#39;t open this website"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 3, "last_activity_date": 1512234128, "creation_date": 1512234128, "answer_id": 47610317, "question_id": 47609731, "link": "https://stackoverflow.com/questions/47609731/how-does-reflect-get-the-returned-structure-pointer/47610317#47610317", "title": "How does reflect get the returned structure pointer", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype Blog struct {\n    Name string\n}\n\nfunc (blog *Blog) Test() *Blog {\n    fmt.Println(\"this is Test method\")\n    blog.Name = \"robin\"\n    return blog\n}\n\nfunc main() {\n    rv := reflect.ValueOf(&amp;Blog{})\n    rm := rv.MethodByName(\"Test\")\n\n    results := rm.Call(nil)\n    fmt.Printf(\"%#v\\n\", results)\n\n    blogPointer := results[0]\n    fmt.Printf(\"%#v\\n\", blogPointer)\n\n    blogValue := blogPointer.Elem()\n    fmt.Printf(\"%#v\\n\", blogValue)\n\n    nameFieldValue := blogValue.FieldByName(\"Name\")\n    fmt.Printf(\"%#v\\n\", nameFieldValue)\n\n    name := nameFieldValue.String()\n    fmt.Println(name)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/iyUw-Sp97-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/iyUw-Sp97-</a></p>\n"}, {"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 1, "last_activity_date": 1512241510, "creation_date": 1512241510, "answer_id": 47611474, "question_id": 47609731, "link": "https://stackoverflow.com/questions/47609731/how-does-reflect-get-the-returned-structure-pointer/47611474#47611474", "title": "How does reflect get the returned structure pointer", "body": "<p>first we call the function returned by the interface and then we can fetch its value using Elem() method call to the pointer to interface</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\n// Blog struct to hold the name of the author\ntype Blog struct {\n    Name string\n}\n\n//Test functon to to test the blog name\nfunc (blog *Blog) Test() *Blog {\n    fmt.Println(\"this is Test method\")\n    blog.Name = \"robin\"\n    return blog\n}\n\nfunc main() {\n    var o interface{} = &amp;Blog{}\n    v := reflect.ValueOf(o)\n    m := v.MethodByName(\"Test\")\n    res := m.Call(nil)\n    ptr := res[0]\n    fieldValue := ptr.Elem().FieldByName(\"Name\").String()\n    fmt.Println(fieldValue)\n}\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 5762493, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f4d966c30995440b1ab28c2353c18d6e?s=128&d=identicon&r=PG&f=1", "display_name": "rowele", "link": "https://stackoverflow.com/users/5762493/rowele"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1531404302, "creation_date": 1512230427, "last_edit_date": 1531404302, "question_id": 47609731, "link": "https://stackoverflow.com/questions/47609731/how-does-reflect-get-the-returned-structure-pointer", "title": "How does reflect get the returned structure pointer", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype Blog struct {\n    Name string\n}\n\nfunc (blog *Blog) Test() (*Blog){\n    fmt.Println(\"this is Test method\")\n    blog.Name = \"robin\"\n    return blog\n}\n\nfunc main() {\n    var o interface{} = &amp;Blog{}\n    v := reflect.ValueOf(o)\n    m := v.MethodByName(\"Test\")\n    rets := m.Call([]reflect.Value{})\n    fmt.Println(rets)\n}\n</code></pre>\n\n<p>I got the following output:</p>\n\n<ul>\n<li>this is Test method</li>\n<li>[]</li>\n</ul>\n\n<p>Why is there no Blog struct and how to get the value of the Blog Name?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 12, "creation_date": 1512218286, "post_id": 47607955, "comment_id": 82174295, "body": "<code>Why not just put the code at end of given function.</code> Because you could have multiple returns."}, {"owner": {"reputation": 15201, "user_id": 7386332, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb50c81104978fe1e111da483c41ff0f?s=128&d=identicon&r=PG&f=1", "display_name": "Anton vBR", "link": "https://stackoverflow.com/users/7386332/anton-vbr"}, "edited": false, "score": 5, "creation_date": 1512218448, "post_id": 47607955, "comment_id": 82174333, "body": "One use case: when you open a file you put a defer to make sure it closes in the end. Thus the open and close code is together and easier to read."}, {"owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "edited": false, "score": 2, "creation_date": 1512220412, "post_id": 47607955, "comment_id": 93155107, "body": "This one is the best article fully describing deferred functions in Go - <a href=\"https://blog.learngoprogramming.com/golang-defer-simplified-77d3b2b817ff\" rel=\"nofollow noreferrer\">blog.learngoprogramming.com/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 75362, "user_id": 625403, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/786eed7da67079cb5d63a49d469af25b?s=128&d=identicon&r=PG", "display_name": "amalloy", "link": "https://stackoverflow.com/users/625403/amalloy"}, "edited": false, "score": 2, "creation_date": 1556582715, "post_id": 47608035, "comment_id": 98479256, "body": "FWIW, &quot;guaranteed&quot; is a bit of a strong word to use here. Obviously there are scenarios where your deferred function will not run: for example, perhaps someone applies a shotgun to your CPU. More generally, perhaps the surrounding function never returns at all. I&#39;d prefer to say that, before the surrounding function returns, it will execute all deferred functions."}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 63, "last_activity_date": 1556608097, "last_edit_date": 1556608097, "creation_date": 1512218694, "answer_id": 47608035, "question_id": 47607955, "link": "https://stackoverflow.com/questions/47607955/use-of-defer-in-go/47608035#47608035", "title": "Use of defer in Go", "body": "<p>We usually use <code>defer</code> to close or deallocate resources. </p>\n\n<p>A surrounding function executes all deferred function calls before it returns, even if it panics. If you just place a function call at the end of a surrounding function, it is skipped when panic happens.</p>\n\n<p>Moreover a deferred function call can handle panic by calling the <code>recover</code> built-in function. This cannot be done by an ordinary function call at the end of a function.</p>\n\n<p>Each deferred call is put on stack, and executed in reverse order when the surrounding function ends. The reversed order helps deallocate resources correctly.</p>\n\n<p>The <code>defer</code> statement must be reached for a function to be called.</p>\n\n<p>You can think of it as another way to implement <code>try-catch-finally</code> blocks.</p>\n\n<p>Closing like <code>try-finally</code>:</p>\n\n<pre><code>func main() {\n    f, err := os.Create(\"file\")\n    if err != nil {\n        panic(\"cannot create file\")\n    }\n    defer f.Close()\n    // no matter what happens here file will be closed\n    // for sake of simplicity I skip checking close result\n    fmt.Fprintf(f,\"hello\")\n}\n</code></pre>\n\n<p>Closing and panic handling like <code>try-catch-finally</code></p>\n\n<pre><code>func main() {\n    defer func() {\n        msg := recover()\n        fmt.Println(msg)\n    }()\n    f, err := os.Create(\".\") // . is a current directory\n    if err != nil {\n        panic(\"cannot create file\")\n    }\n    defer f.Close()\n    // no matter what happens here file will be closed\n    // for sake of simplicity I skip checking close result\n    fmt.Fprintf(f,\"hello\")\n}\n</code></pre>\n\n<p>The benefit over try-catch-finally is that there is no nesting of blocks and variable scopes. This simplifies the structure of the surrounding function.</p>\n\n<p>Just like finally blocks, deferred function calls can also modify the return value if they can reach the returned data.</p>\n\n<pre><code>func yes() (text string) {\n    defer func() {\n       text = \"no\"\n    }()\n    return \"yes\"\n}\n\nfunc main() {\n    fmt.Println(yes())\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 3, "last_activity_date": 1539053590, "last_edit_date": 1539053590, "creation_date": 1512221344, "answer_id": 47608393, "question_id": 47607955, "link": "https://stackoverflow.com/questions/47607955/use-of-defer-in-go/47608393#47608393", "title": "Use of defer in Go", "body": "<p>Key benefit of using <code>defer</code> - it will be called any way no matter how function will return. If an extraordinary situation would occur deferred function will be called. </p>\n\n<p>So it gives nice things:</p>\n\n<ol>\n<li><p>Recover after <code>panic</code>. This allows yes realize <code>try ... catch</code> behavior. </p></li>\n<li><p>Not to forget clean up (close files, free memory, etc) before normal exit. You may open some resource and you have to close it before exit. But function can have several exit points - so you have to add freeing in <em>every</em> return point. That\u2019s very tedious in maintenance. Or you can put only one deferred statement  - and resources will be released automatically. </p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": false, "score": 5, "last_activity_date": 1512222223, "creation_date": 1512222223, "answer_id": 47608524, "question_id": 47607955, "link": "https://stackoverflow.com/questions/47607955/use-of-defer-in-go/47608524#47608524", "title": "Use of defer in Go", "body": "<p>Well, it's not always guaranteed that your code may reach the end of the function (e.g. an error or some other condition may force you to return well ahead of the end of a function). The defer statement makes sure that whatever function is assigned to it gets executed for sure even if the function panics or the code returns well before the end of the function. </p>\n\n<p>The defer statement also helps keep the code clean esp. in cases when there are multiple return statements in a function esp. when one needs to free resources before return (e.g. imagine you have an open call for accessing a resource at the beginning of the function  - for which a corresponding close must be called before the function returns for avoiding a resource leak. And say your function has multiple return statements, maybe for different conditions including error checking. In such a case, without defer, you normally would call close for that resource before each return statement). The defer statement makes sure the function you pass to it is always called irrespective of where the function returns, and thus saves you from extraenous housekeeping work.</p>\n\n<p>Also defer can be called multiple times in the same function. E.g.: In case you have different resources being allocated through your function which need to be eventually freed before returning, then you can call defer for each of them after allocation and these functions are executed in the reverse order of the sequence in which they were called when the function exits. </p>\n"}, {"comments": [{"owner": {"reputation": 134, "user_id": 576534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/555c71acb76e4526eb8db3e1954a08f1?s=128&d=identicon&r=PG", "display_name": "Walt", "link": "https://stackoverflow.com/users/576534/walt"}, "edited": false, "score": 3, "creation_date": 1551902810, "post_id": 54866276, "comment_id": 96815301, "body": "The question wasn&#39;t &quot;how does defer work?&quot; The question was &quot;why do I want it?&quot;"}], "tags": [], "owner": {"reputation": 15076, "user_id": 3702377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Ac4wz.jpg?s=128&g=1", "display_name": "Benyamin Jafari", "link": "https://stackoverflow.com/users/3702377/benyamin-jafari"}, "is_accepted": false, "score": 1, "last_activity_date": 1551097894, "creation_date": 1551097894, "answer_id": 54866276, "question_id": 47607955, "link": "https://stackoverflow.com/questions/47607955/use-of-defer-in-go/54866276#54866276", "title": "Use of defer in Go", "body": "<blockquote>\n  <p>A <code>defer</code> statement defers the execution of a function until the\n  surrounding function returns.</p>\n</blockquote>\n\n<p>This example demonstrates <code>defer</code> functionality:</p>\n\n<pre><code>func elapsed(what string) func() {\n    start := time.Now()\n    fmt.Println(\"start\")\n    return func() {\n        fmt.Printf(\"%s took %v\\n\", what, time.Since(start))\n    }\n}\n\nfunc main() {\n    defer elapsed(\"page\")()\n    time.Sleep(time.Second * 3)\n}\n</code></pre>\n\n<p>Out:</p>\n\n<pre><code>start\npage took 3s\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2019, "user_id": 10035556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86cea073655558939d961937095efc80?s=128&d=identicon&r=PG&f=1", "display_name": "Mayur", "link": "https://stackoverflow.com/users/10035556/mayur"}, "is_accepted": false, "score": 9, "last_activity_date": 1559036797, "creation_date": 1559036797, "answer_id": 56339391, "question_id": 47607955, "link": "https://stackoverflow.com/questions/47607955/use-of-defer-in-go/56339391#56339391", "title": "Use of defer in Go", "body": "<p>There are already good answers here. I would like to mention one more use case.</p>\n\n<pre><code>func BillCustomer(c *Customer) error {\n    c.mutex.Lock()\n    defer c.mutex.Unlock()\n\n    if err := c.Bill(); err != nil {\n        return err\n    }\n\n    if err := c.Notify(); err != nil {\n        return err\n    }\n\n    // ... do more stuff ...\n\n    return nil\n}\n</code></pre>\n\n<p>The <code>defer</code> in this example ensures that no matter how <code>BillCustomer</code> returns, the <code>mutex</code> will be <code>unlocked</code> immediately prior to <code>BillCustomer</code> returning. This is extremely useful because without <code>defer</code> you would have to remember to <code>unlock</code> the <code>mutex</code> in every place that the function could possibly <code>return</code>.</p>\n\n<p><a href=\"https://kylewbanks.com/blog/when-to-use-defer-in-go\" rel=\"noreferrer\">ref</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 1746, "user_id": 5785743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21a09b5b4639c7459d79f565db0d63da?s=128&d=identicon&r=PG&f=1", "display_name": "pr-pal", "link": "https://stackoverflow.com/users/5785743/pr-pal"}, "is_accepted": false, "score": 1, "last_activity_date": 1565496625, "last_edit_date": 1565496625, "creation_date": 1560620837, "answer_id": 56612779, "question_id": 47607955, "link": "https://stackoverflow.com/questions/47607955/use-of-defer-in-go/56612779#56612779", "title": "Use of defer in Go", "body": "<p>Summary:</p>\n\n<p>When we do certain operations that need cleanup, we can \"schedule\" the cleanup operations which would be run when the function returns no matter which path that happens, including due to panic.</p>\n\n<p>Detailed answer:</p>\n\n<ol>\n<li>Programming languages strive to provide constructs that facilitate simpler and less error-prone development. (E.g. why should Golang support garbage collection when we can free the memory ourselves)</li>\n<li>A function can return at multiple points. The user might overlook doing certain cleanup operations in some paths</li>\n<li>Some cleanup operations are not relevant in all return paths</li>\n<li>Also, it is better to keep the cleanup code closer to the original operation which needed the cleanup</li>\n<li>When we do certain operations that need cleanup, we can \"schedule\" the cleanup operations which would be run when the function returns no matter which path that happens.</li>\n</ol>\n"}], "owner": {"reputation": 833, "user_id": 7498628, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh5.googleusercontent.com/-qMH6F-M2q4U/AAAAAAAAAAI/AAAAAAAAAA0/UpXnAhY-GiY/photo.jpg?sz=128", "display_name": "Shubham Chaudhary", "link": "https://stackoverflow.com/users/7498628/shubham-chaudhary"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16805, "favorite_count": 10, "accepted_answer_id": 47608035, "answer_count": 6, "score": 50, "last_activity_date": 1565527405, "creation_date": 1512218184, "last_edit_date": 1565527405, "question_id": 47607955, "link": "https://stackoverflow.com/questions/47607955/use-of-defer-in-go", "title": "Use of defer in Go", "body": "<p>What is the use of <code>defer</code> in Go? The language documentation says it is executed when the surrounding function returns. Why not just put the code at end of given function?</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1512210121, "post_id": 47606800, "comment_id": 82172011, "body": "From different packages, therefore different structures. Maybe you can type convert them. And please: Take the Tour of Go once more."}, {"owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1512216860, "post_id": 47606800, "comment_id": 82173912, "body": "Thank you Volker for reply"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1512210487, "creation_date": 1512210487, "answer_id": 47606891, "question_id": 47606800, "link": "https://stackoverflow.com/questions/47606800/how-assign-struct-of-a-package-into-another-packages-struct-with-same-fields/47606891#47606891", "title": "How assign struct of a package into another package&#39;s struct with same fields", "body": "<p><code>main.DispatchesDetails</code> and <code>store.DispatchesDetails</code> are completely different types. You probably want to choose one and use it exclusively.</p>\n\n<p>For example, instead of:</p>\n\n<pre><code>package main\n\ndetails := &amp;DispatchesDetails{ ... }\n</code></pre>\n\n<p>use:</p>\n\n<pre><code>package main\n\ndetails := &amp;store.DispatchesDetails{ ... }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 1, "last_activity_date": 1516094094, "last_edit_date": 1516094094, "creation_date": 1512210813, "answer_id": 47606939, "question_id": 47606800, "link": "https://stackoverflow.com/questions/47606800/how-assign-struct-of-a-package-into-another-packages-struct-with-same-fields/47606939#47606939", "title": "How assign struct of a package into another package&#39;s struct with same fields", "body": "<p>You need to import store package inside your main package. Go is strictly typed language. Here you cannot assign a struct to another struct even if they are similar. Though you can <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">embed</a> your struct into another.</p>\n\n<pre><code>package main\nimport( \n      \"store\"\n     )\n\ntype DispatchesDetailsStruct struct{\n\n}\n\nfunc main(){\n  storedispatchObject := store.DispatchesDetailsStruct{}\n  storedispatchObject.value = userDetails.value\n  dispatchesList, err := dps.GetDispatchByCondition(storedispatchObject, objRaouteAvailability)\n}\n</code></pre>\n\n<p>After above code snippet the DispatchesDetailsStruct will be of store type and you can use it in store function</p>\n"}, {"comments": [{"owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "edited": false, "score": 0, "creation_date": 1512217358, "post_id": 47607601, "comment_id": 82174039, "body": "yes thank you Eugene Lisitsky , it will be good to imports but in my case i don&#39;t think to create another package to use struct which is used one time in project."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "edited": false, "score": 0, "creation_date": 1512219407, "post_id": 47607601, "comment_id": 82174594, "body": "That\u2019s up to you and your project. Sometimes it\u2019s useful starting with 2or 3 packages making them loose coupled."}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1512215461, "creation_date": 1512215461, "answer_id": 47607601, "question_id": 47606800, "link": "https://stackoverflow.com/questions/47606800/how-assign-struct-of-a-package-into-another-packages-struct-with-same-fields/47607601#47607601", "title": "How assign struct of a package into another package&#39;s struct with same fields", "body": "<p>Go considers named types different even they have the same structure. </p>\n\n<p>I recommend this way if you need the same type in different structures - <strong>move all types definitions to 3rd package</strong> and import from there. </p>\n\n<p>Thus you solve many issues at once:</p>\n\n<ol>\n<li><p>Every type is defined once. If you need some changes you do them in one place. </p></li>\n<li><p>All definitions are grouped together - easier to find. Package with types will be small. </p></li>\n<li><p>You never run into cyclic imports if you need type from another package. </p></li>\n</ol>\n\n<p>So you may come to a project structure like this:</p>\n\n<pre><code>github.com/user/project/schema  \u2014 types\ngithub.com/user/project/user  \u2014 some package for users\ngithub.com/user/project/resources  \u2014 types\n</code></pre>\n"}], "owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 0, "accepted_answer_id": 47606939, "answer_count": 3, "score": -4, "last_activity_date": 1537180347, "creation_date": 1512209856, "last_edit_date": 1537180347, "question_id": 47606800, "link": "https://stackoverflow.com/questions/47606800/how-assign-struct-of-a-package-into-another-packages-struct-with-same-fields", "title": "How assign struct of a package into another package&#39;s struct with same fields", "body": "\n\n\n\n<p>I have a struct in <code>main</code> package :</p>\n\n<pre><code>package main\ntype DispatchesDetailsStruct struct{}\n</code></pre>\n\n<p>And I created another struct in package <code>store</code> With same fields as of struct created in <code>main</code> package.</p>\n\n<pre><code>package store\ntype DispatchesDetails struct{}\n</code></pre>\n\n<p>Here what I'm going to do, I created a function inside <code>store</code> package with return <code>DispatchesDetails</code> struct.</p>\n\n<pre><code>func (s *DispatchStore) GetDispatchByCondition(dispatchObject DispatchesRequestStruct, objRaouteAvailability Availability) (dds []DispatchesDetails, err error) {}\n</code></pre>\n\n<p>Now i call this <code>store</code> function from <code>main</code> package and assign returned value to <code>main</code> package struct but its showing error message </p>\n\n<blockquote>\n  <p>can not assign store.DispatchesDetails to DispatchesDetailsStruct type.</p>\n</blockquote>\n\n<p>I'm confused please help me.\nThanks</p>\n\n\n\n\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512210184, "post_id": 47606761, "comment_id": 82172034, "body": "<a href=\"https://play.golang.org/p/ZQgQfmO-tK\" rel=\"nofollow noreferrer\">play.golang.org/p/ZQgQfmO-tK</a>"}, {"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512210920, "post_id": 47606761, "comment_id": 82172228, "body": "@mkopriva looks like your code works correctly only with first error"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1512217910, "post_id": 47606761, "comment_id": 82174188, "body": "you must have caught my comment before i corrected my typo (changed <code>if</code> to <code>for</code>). Here&#39;s an executable example <a href=\"https://play.golang.org/p/iFEsfOuvow\" rel=\"nofollow noreferrer\">play.golang.org/p/iFEsfOuvow</a>. Basically this is Go&#39;s while loop; <code>for err != nil {...</code> = <code>while error do</code>."}, {"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "reply_to_user": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1513789063, "post_id": 47606761, "comment_id": 82789412, "body": "@VonC, There are two right answers here. And I have check both answers as useful. Now I have changed the answer which I have accepted as most helpful for me to find solution."}, {"owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "reply_to_user": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1513789179, "post_id": 47606761, "comment_id": 82789460, "body": "@VonC, do you thing the second answer is incorrect ?"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1512210189, "creation_date": 1512210189, "answer_id": 47606848, "question_id": 47606761, "link": "https://stackoverflow.com/questions/47606761/repeat-code-if-an-error-occured/47606848#47606848", "title": "Repeat code if an error occured", "body": "<p>The only improvement I see is:</p>\n\n<pre><code>for {\n    err := mssql.Db.ProcessAllData(true, &amp;processedAsutpIds, filename)\n    if err == nil {\n        fmt.Println(\"done.\")\n        os.Exit(0)\n    }\n    fmt.Println(err.Error())\n    fmt.Println(\"!!!! Error occurred - sleep for 5 minutes\")\n    time.Sleep(time.Minute * 5)\n}\n</code></pre>\n\n<p>That is: Eliminate the 'else', since it's implicit.  <code>go vet</code> would tell you the same.  You should also use <code>gofmt</code> to correct indentation.</p>\n\n<p>You might also want to check for specific errors, and only continue for network errors. But that's an application decision.</p>\n"}, {"comments": [{"owner": {"reputation": 1107, "user_id": 2356861, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9f4dbcbb819e6e60fdc78b2a6b9d9f46?s=128&d=identicon&r=PG", "display_name": "RexFuzzle", "link": "https://stackoverflow.com/users/2356861/rexfuzzle"}, "edited": false, "score": 0, "creation_date": 1560158862, "post_id": 47606858, "comment_id": 99631418, "body": "Adding some backoff would&#39;t be a bad idea- simple <code>sleep*(i+1)</code> would do it."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 1107, "user_id": 2356861, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9f4dbcbb819e6e60fdc78b2a6b9d9f46?s=128&d=identicon&r=PG", "display_name": "RexFuzzle", "link": "https://stackoverflow.com/users/2356861/rexfuzzle"}, "edited": false, "score": 1, "creation_date": 1560159401, "post_id": 47606858, "comment_id": 99631664, "body": "@RexFuzzle Agreed. You even have more formized backoff policy with <a href=\"https://github.com/jpillora/backoff\" rel=\"nofollow noreferrer\">github.com/jpillora/backoff</a>. Or <a href=\"https://github.com/cenkalti/backoff\" rel=\"nofollow noreferrer\">github.com/cenkalti/backoff</a> (as an algorithm that uses feedback to multiplicatively decrease the rate of some process, in order to gradually find an acceptable rate, which seems overkill here)"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 1107, "user_id": 2356861, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/9f4dbcbb819e6e60fdc78b2a6b9d9f46?s=128&d=identicon&r=PG", "display_name": "RexFuzzle", "link": "https://stackoverflow.com/users/2356861/rexfuzzle"}, "edited": false, "score": 0, "creation_date": 1560159464, "post_id": 47606858, "comment_id": 99631696, "body": "@RexFuzzle Note that the those libraries I mentioned above are improved in <a href=\"https://medium.com/@lestrrat/yak-shaving-with-backoff-libraries-in-go-80240f0aa30c\" rel=\"nofollow noreferrer\">medium.com/@lestrrat/&hellip;</a> and <a href=\"https://github.com/lestrrat-go/backoff\" rel=\"nofollow noreferrer\">github.com/lestrrat-go/backoff</a>"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 12, "last_activity_date": 1512210234, "creation_date": 1512210234, "answer_id": 47606858, "question_id": 47606761, "link": "https://stackoverflow.com/questions/47606761/repeat-code-if-an-error-occured/47606858#47606858", "title": "Repeat code if an error occured", "body": "<p>You might consider a retry function such as the one described in \"<a href=\"https://blog.abourget.net/en/2016/01/04/my-favorite-golang-retry-function/\" rel=\"noreferrer\">My favorite #golang retry function</a>\" by Alexandre Bourget:</p>\n\n<pre><code>    var signedContent []byte\n    err := retry(5, 2*time.Second, func() (err error) {\n        signedContent, err = signFile(unsignedFile, contents)\n        return\n    })\n    if err != nil {\n        log.Println(err)\n        http.Error(w, err.Error(), 500)\n        return\n    }\n</code></pre>\n\n<p>With the retry function being:</p>\n\n<pre><code>func retry(attempts int, sleep time.Duration, f func() error) (err error) {\n    for i := 0; ; i++ {\n        err = f()\n        if err == nil {\n            return\n        }\n\n        if i &gt;= (attempts - 1) {\n            break\n        }\n\n        time.Sleep(sleep)\n\n        log.Println(\"retrying after error:\", err)\n    }\n    return fmt.Errorf(\"after %d attempts, last error: %s\", attempts, err)\n}\n</code></pre>\n"}], "owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8306, "favorite_count": 2, "accepted_answer_id": 47606858, "answer_count": 2, "score": 7, "last_activity_date": 1512210234, "creation_date": 1512209600, "question_id": 47606761, "link": "https://stackoverflow.com/questions/47606761/repeat-code-if-an-error-occured", "title": "Repeat code if an error occured", "body": "<p>I have a code which is doing a very long ETL operation. There are network problems sometimes. I want to catch the error <code>read tcp 10.10.10.10:32423 -&gt; 20.20.20.20:2344: i/o timeout</code> and retry the operation again.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>for {\n    err := mssql.Db.ProcessAllData(true, &amp;processedAsutpIds, filename)\n    if err == nil {\n      fmt.Println(\"done.\")\n      os.Exit(0)\n    } else {\n      fmt.Println(err.Error())\n      fmt.Println(\"!!!! Error occurred - sleep for 5 minutes\")\n      time.Sleep(time.Minute * 5)\n    }\n}\n</code></pre>\n\n<p>Is it possible to rewrite it in more idiomatic way ?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1512171409, "last_edit_date": 1512171409, "creation_date": 1512168806, "answer_id": 47602630, "question_id": 47602587, "link": "https://stackoverflow.com/questions/47602587/what-the-purpose-of-function-like-initialization-for-builtin-types-in-go/47602630#47602630", "title": "What the purpose of function-like initialization for builtin types in go?", "body": "<p>You are referring to a <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">type conversion</a>.  A type conversion is used to convert a value of one type to a value of another type.</p>\n\n<p>The expression <code>int(5)</code> converts the untyped 5 to an <code>int</code> with value 5.</p>\n\n<p>The expression <code>[]int(nil)</code> converts the untyped <code>nil</code> to a <code>[]int</code> with value <code>nil</code>.</p>\n\n<p>The statements</p>\n\n<pre><code>a := 5\nb := int(5)\n</code></pre>\n\n<p>declare a <code>int</code> variable with value 5. The declaration of <code>a</code> uses the <a href=\"https://golang.org/ref/spec#Constants\" rel=\"nofollow noreferrer\">default type</a> for integer constants (which is <code>int</code>).  The declaration of <code>b</code> explicitly uses the <code>int</code> type. Otherwise, they are the same. The use of the default type in the declaration of <code>a</code> is usually preferred over the explicit type in the declaration of <code>b</code>.  The type conversion is commonly used for types other than the default type. Example <code>c := int64(22)</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": true, "score": 2, "last_activity_date": 1512170995, "creation_date": 1512170995, "answer_id": 47602928, "question_id": 47602587, "link": "https://stackoverflow.com/questions/47602587/what-the-purpose-of-function-like-initialization-for-builtin-types-in-go/47602928#47602928", "title": "What the purpose of function-like initialization for builtin types in go?", "body": "<p>Generally you don't need to use <code>:=</code> in combination with a type conversion because it defeats the point of <code>:=</code>. <code>:=</code> is there to infer the type. The type can generally be inferred from a constant value.</p>\n\n<p>But not always. For example...</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    a := 5\n    b := uint(5)\n    var c uint = 5\n\n    fmt.Printf(\"%T\\n\", a)\n    fmt.Printf(\"%T\\n\", b)\n    fmt.Printf(\"%T\\n\", c)\n}\n</code></pre>\n\n<p><code>a := 5</code> infers that <code>a</code> is of type <code>int</code>, but what if you wanted it to be something else? <code>5</code> could be <a href=\"https://golang.org/ref/spec#Numeric_types\" rel=\"nofollow noreferrer\">a bunch of different integer types</a>. Maybe an unsigned integer? Maybe an integer of a specific length like <code>int16</code>?</p>\n\n<p>You can do this by either specifying the type of the constant explicitly, as in <code>b := uint(8)</code>, or by specifying the type of the variable explicitly, as in <code>var c uint = 8</code>. With <code>b := uint(8)</code>, <code>b</code>'s type is inferred from the uint constant being assigned to it. With <code>var c uint = 8</code>, <code>8</code> is inferred to be an unsigned integer because it is being assigned to a variable with the type <code>uint</code>. In both cases, <code>b</code> and <code>c</code> will be of type <code>uint</code>.</p>\n\n<p>I'm not aware of any significant difference between <code>b := uint(8)</code> and <code>var b uint = 8</code>, so which you use is largely up to taste. I have a <em>slight</em> preference for <code>var b uint = 8</code> because it is visually distinct from <code>b := 8</code> to make it clear explicit types are being used.</p>\n"}], "owner": {"reputation": 465, "user_id": 1936173, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/8uQ1j.png?s=128&g=1", "display_name": "Illia Danko", "link": "https://stackoverflow.com/users/1936173/illia-danko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 47602928, "answer_count": 2, "score": -3, "last_activity_date": 1512171409, "creation_date": 1512168465, "question_id": 47602587, "link": "https://stackoverflow.com/questions/47602587/what-the-purpose-of-function-like-initialization-for-builtin-types-in-go", "title": "What the purpose of function-like initialization for builtin types in go?", "body": "<p>I know, go converts right side untyped constant to left side typed variable right after <code>:=</code> initialization in expression: <code>a := 5</code>.\nAnd it looks like the same as <code>b := int(5)</code> statement. So, what is the purpose of the second statement and how it differs from the first one?\nAlso, somewhere, I have seen <code>[]int(nil)</code> expression, that's a bit confuse me.</p>\n"}, {"tags": ["json", "go", "serialization", "marshalling"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 0, "last_activity_date": 1512169673, "last_edit_date": 1512169673, "creation_date": 1512169421, "answer_id": 47602720, "question_id": 47602542, "link": "https://stackoverflow.com/questions/47602542/what-is-the-best-way-to-implement-entity-component-system/47602720#47602720", "title": "What Is The Best Way to Implement Entity-Component System", "body": "<p>Gor one thing, you can just use functions instead of reflection:</p>\n\n<pre><code>type componentMaker func() Component  // Define generator signature\n\nvar componentRegistry = make(map[string]componentMaker) // Update map type\n\ncomponentRegistry[\"ChiComponent\"] = func() Component { return new(ChiComponent) } // Define generators\n\nentity.Components[v] = componentRegistry[v]() // Call generator\n</code></pre>\n\n<p>And so on. No reflection needed.</p>\n"}], "owner": {"reputation": 23, "user_id": 9041366, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-r-o5pXPtP20/AAAAAAAAAAI/AAAAAAAAAEo/nCOA8Cw4t6c/photo.jpg?sz=128", "display_name": "Weicheng Huang", "link": "https://stackoverflow.com/users/9041366/weicheng-huang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 456, "favorite_count": 1, "accepted_answer_id": 47602720, "answer_count": 1, "score": 2, "last_activity_date": 1512181264, "creation_date": 1512168169, "last_edit_date": 1512181264, "question_id": 47602542, "link": "https://stackoverflow.com/questions/47602542/what-is-the-best-way-to-implement-entity-component-system", "title": "What Is The Best Way to Implement Entity-Component System", "body": "<p>Recently I am planing to implement a  <a href=\"https://en.wikipedia.org/wiki/Entity%E2%80%93component%E2%80%93system\" rel=\"nofollow noreferrer\">Entity-Component-System</a> like Overwatch.   </p>\n\n<p>The major challenge(and difficulty) in my project is that, my engine allows user defined customized map, in which user was allowed to define customized unit. In another word, <strong>user can select which component they need for an entity type</strong></p>\n\n<p>For example</p>\n\n<pre><code>type Component interface {\n    ComponentName() string\n}\n\ntype HealthComponent struct {\n    HP uint\n}\n\ntype ManaComponent struct {\n    MP uint\n}\n\ntype ChiComponent struct{\n        Chi uint\n}\n// assuming each component has implemented Component interface\n</code></pre>\n\n<p>The corresponding Entity definition is:</p>\n\n<pre><code>type Entity struct {\n    ID         EID\n    EntityName string\n    Components map[string]Component\n}\n</code></pre>\n\n<p>A user will have some entity definition in JSON format:</p>\n\n<pre><code>{\n \"EntityName\": \"FootMan\",\n \"Components\": {\n  \"HealthComponent\": {\n   \"HP\": 500\n  }\n }\n}\n---------------------------------------------\n{\n \"EntityName\": \"Warlock\",\n \"Components\": {\n  \"HealthComponent\": {\n   \"HP\": 250\n  },\n  \"ManaComponent\": {\n   \"MP\": 100\n  }\n }\n}\n---------------------------------------------\n{\n \"EntityName\": \"Monk\",\n \"Components\": {\n  \"HealthComponent\": {\n   \"HP\": 250\n  },\n  \"ChiComponent\": {\n   \"Chi\": 100\n  }\n }\n}\n</code></pre>\n\n<p>Please notice that ID is not included in JSON because we need to initialize it at run-time</p>\n\n<p>So here comes the problem:<br>\n<strong>What is the most efficient way to build such an entity with a given JSON definition?</strong>\nCurrently my solution is using a registry to maintain a map between struct type and component name</p>\n\n<pre><code>var componentRegistry = make(map[string]reflect.Type)\nfunc init() {\n\n    componentRegistry[\"ChiComponent\"] = reflect.TypeOf(ChiComponent{})\n    componentRegistry[\"HealthComponent\"] = reflect.TypeOf(HealthComponent{})\n    componentRegistry[\"ManaComponent\"] = reflect.TypeOf(ManaComponent{})\n\n}\n</code></pre>\n\n<p>The builder code is</p>\n\n<pre><code>func ComponentBuilder(name string) Component {\n\n    v := reflect.New(componentRegistry[name])\n    fmt.Println(v)\n    return v.Interface().(Component)\n}\n\nfunc EntityBuilder(EntityName string, RequireComponent []string) *Entity {\n\n    var entity = new(Entity)\n    entity.ID = getNextAvailableID()\n    entity.EntityName = EntityName\n    entity.Components = make(map[string]Component)\n    for _, v := range RequireComponent {\n        entity.Components[v] = ComponentBuilder(v)\n    }\n\n    return entity\n}\n</code></pre>\n\n<p>For each system that want to access a component in this entity needs to do following:</p>\n\n<pre><code>var d = monk_entity.Components[\"ChiComponent\"].(*ChiComponent)\nd.Chi = 13\n\nvar h = monk_entity.Components[\"HealthComponent\"].(*HealthComponent)\nh.HP = 313\n</code></pre>\n\n<p>It works, but I am using too much reflection in this approach and I am not able to assign initial value to entity, which was store in user defined JSON file. Is there any better way to do so?</p>\n"}, {"tags": ["go", "random"], "comments": [{"owner": {"reputation": 2186, "user_id": 1647656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0a27a80f0a9800a2fc5935ecf7071eca?s=128&d=identicon&r=PG", "display_name": "Alex Guerra", "link": "https://stackoverflow.com/users/1647656/alex-guerra"}, "edited": false, "score": 1, "creation_date": 1512168958, "post_id": 47602451, "comment_id": 82164078, "body": "I don&#39;t see anything wrong. Is that the exact code you&#39;re running? I think that maybe as the number of elements increases, the odds of a collision increases non-linearly, but that&#39;s just my intuition."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512169209, "post_id": 47602451, "comment_id": 82164180, "body": "You&#39;re re-shuffling and re-scanning the entire list every time there&#39;s a single collision. I&#39;m not at all surprised this takes forever."}, {"owner": {"reputation": 2186, "user_id": 1647656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0a27a80f0a9800a2fc5935ecf7071eca?s=128&d=identicon&r=PG", "display_name": "Alex Guerra", "link": "https://stackoverflow.com/users/1647656/alex-guerra"}, "edited": false, "score": 0, "creation_date": 1512169858, "post_id": 47602451, "comment_id": 82164351, "body": "Actually, from testing it looks like the odds of a collision are pretty linear."}, {"owner": {"reputation": 500, "user_id": 651612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c517f41d4ecb182dffa2d5ae86044be?s=128&d=identicon&r=PG", "display_name": "slaxor", "link": "https://stackoverflow.com/users/651612/slaxor"}, "edited": false, "score": 0, "creation_date": 1512171779, "post_id": 47602451, "comment_id": 82164897, "body": "Yes that is my code (for now at least) in my app i will probably groom it a little but the idea will be the same. It looks fine for the first couple of runs, then the number of collisions increase rapidly. from 1 or 2 to 10 or more, and when i do the loop above it doesn&#39;t end even when I let it run for an hour or so."}, {"owner": {"reputation": 500, "user_id": 651612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c517f41d4ecb182dffa2d5ae86044be?s=128&d=identicon&r=PG", "display_name": "slaxor", "link": "https://stackoverflow.com/users/651612/slaxor"}, "edited": false, "score": 0, "creation_date": 1512172139, "post_id": 47602451, "comment_id": 82164991, "body": "I haven&#39;t considered runtime complexity since the number of record to shuffle will hardly ever be above lets say 20"}, {"owner": {"reputation": 2186, "user_id": 1647656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0a27a80f0a9800a2fc5935ecf7071eca?s=128&d=identicon&r=PG", "display_name": "Alex Guerra", "link": "https://stackoverflow.com/users/1647656/alex-guerra"}, "edited": false, "score": 0, "creation_date": 1512172443, "post_id": 47602451, "comment_id": 82165063, "body": "I can&#39;t recreate the issue. <a href=\"https://gist.github.com/heyimalex/93fe27a8a88914cb61d61701edcfa23d\" rel=\"nofollow noreferrer\">Here&#39;s</a> my code."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1512353483, "last_edit_date": 1512353483, "creation_date": 1512345733, "answer_id": 47624694, "question_id": 47602451, "link": "https://stackoverflow.com/questions/47602451/go-random-generator-stops-working-after-some-calls/47624694#47624694", "title": "go random generator stops working after some calls", "body": "<blockquote>\n  <p>\"With this piece of code, I want shuffle db ids so that none of the\n  ids refer to themselves. [Sometimes] it doesn't end even when I let it\n  run for an hour or so.\"</p>\n</blockquote>\n\n<p>tl;dr There is a faster solution that is more than a thousand times faster.</p>\n\n<hr>\n\n<p>Your code:</p>\n\n<p><code>slaxor.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"math/rand\"\n    \"time\"\n)\n\nfunc main() {\n    seed := time.Now().UnixNano() &amp; 999999999\n    log.Print(\"seed: \", seed)\n    rand.Seed(seed)\n    ordered := []int{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19}\n\n    randomized := shufflePreventCollisionSlaxor(ordered)\n    log.Print(\"Final Result\")\n    log.Print(\"ordered: \", ordered)\n    log.Print(\"random:  \", randomized)\n\n}\n\nfunc shufflePreventCollisionSlaxor(ordered []int) []int {\n    randomized := rand.Perm(len(ordered))\n    for i, o := range ordered {\n        if o == randomized[i] {\n            log.Printf(\"Doing it again because ordered[%d] (%d) is == randomized[%d] (%d)\", i, o, i, randomized[i])\n            log.Print(ordered)\n            log.Print(randomized)\n            shufflePreventCollisionSlaxor(ordered)\n        }\n    }\n    return randomized\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/JI5rJGcAAz\" rel=\"nofollow noreferrer\">https://play.golang.org/p/JI5rJGcAAz</a></p>\n\n<p>It is not obvious how, or even if, the code fulfills its purpose.</p>\n\n<p>The termination condition is probabalistic, not deterministic.</p>\n\n<p>Let's leave aside the issue of whether the code fulfills its purpose.</p>\n\n<hr>\n\n<p>This benchmark has been modified so that <code>stderr</code> is limited by the speed of the sink <code>/dev/null</code>, not a terminal.</p>\n\n<p><code>slaxor.bash</code>:</p>\n\n<pre><code>go build -o slaxor slaxor.go &amp;&amp; time (for i in $(seq 10000) ; do ./slaxor 2&gt; /dev/null ; done)\n</code></pre>\n\n<p>The benchmark measures the execution of a program and a single execution of the algorithm. The benchmark times are inconsistent because the pseudorandom seed value changes for each program execution. The benchmark sometimes \"doesn't end even when I let it run for an hour or so.\"</p>\n\n<p>There is a faster solution that runs and terminates in a few seconds, despite the program execution overhead.</p>\n\n<p><code>peterso.bash</code>:</p>\n\n<pre><code>go build -o peterso peterso.go &amp;&amp; time (for i in $(seq 10000) ; do ./peterso 2&gt; /dev/null ; done)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ ./peterso.bash\nreal    0m5.290s\nuser    0m5.224s\nsys     0m1.128s\n\n$ ./peterso.bash\nreal    0m7.462s\nuser    0m7.109s\nsys     0m1.922s\n</code></pre>\n\n<p><code>peterso.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"math/rand\"\n    \"time\"\n)\n\nfunc main() {\n    seed := time.Now().UnixNano() &amp; 999999999\n    log.Print(\"seed: \", seed)\n    r = rand.New(rand.NewSource(seed))\n    ordered := []int{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19}\n\n    randomized := shufflePreventCollisionPeterSO(ordered)\n    log.Print(\"Final Result\")\n    log.Print(\"ordered: \", ordered)\n    log.Print(\"random:  \", randomized)\n    if randomized == nil {\n        err := \"Shuffle Error!\"\n        fmt.Print(err)\n        log.Fatal(err)\n    }\n}\n\nvar r *rand.Rand\n\nfunc isNoCollision(a, b []int) bool {\n    if len(a) == len(b) {\n        for i, ai := range a {\n            if ai == b[i] {\n                return false\n            }\n        }\n        return true\n    }\n    return false\n}\n\nfunc shufflePreventCollisionPeterSO(ordered []int) []int {\n    const guard = 4 * 1024 // deterministic, finite time\n    for n := 1; n &lt;= guard; n++ {\n        randomized := r.Perm(len(ordered))\n        if isNoCollision(ordered, randomized) {\n            return randomized\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<p>The guard provides a deterministic, finite time, termination condition.</p>\n\n<p>Playground: <a href=\"https://play.golang.org/p/ZT-sfDW5Mi\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ZT-sfDW5Mi</a></p>\n\n<hr>\n\n<p>Let's put aside the distorted program execution benchmarks, let's look at function execution times. Because this is important, the Go standard library has the <code>testing</code> package for testing and benchmarking functions.</p>\n\n<p>Tests:</p>\n\n<pre><code>$ go test shuffle_test.go -v -count=1 -run=. -bench=!\n=== RUN   TestTimeSlaxor\n=== RUN   TestTimeSlaxor/1K\n=== RUN   TestTimeSlaxor/2K\n=== RUN   TestTimeSlaxor/3K\n--- PASS: TestTimeSlaxor (13.78s)\n    --- PASS: TestTimeSlaxor/1K (1.18s)\n    --- PASS: TestTimeSlaxor/2K (1.27s)\n    --- PASS: TestTimeSlaxor/3K (11.33s)\n=== RUN   TestTimePeterSO\n=== RUN   TestTimePeterSO/1K\n=== RUN   TestTimePeterSO/2K\n=== RUN   TestTimePeterSO/3K\n=== RUN   TestTimePeterSO/1M\n=== RUN   TestTimePeterSO/2M\n=== RUN   TestTimePeterSO/3M\n--- PASS: TestTimePeterSO (6.57s)\n    --- PASS: TestTimePeterSO/1K (0.00s)\n    --- PASS: TestTimePeterSO/2K (0.00s)\n    --- PASS: TestTimePeterSO/3K (0.00s)\n    --- PASS: TestTimePeterSO/1M (1.13s)\n    --- PASS: TestTimePeterSO/2M (2.25s)\n    --- PASS: TestTimePeterSO/3M (3.19s)\nPASS\nok      command-line-arguments  20.347s\n$ \n</code></pre>\n\n<p>In a fraction of the rapidly increasing time it takes to run 3K (3,000) iterations of <code>shufflePreventCollisionSlaxor</code>, 3M (3,000,000) iterations of <code>shufflePreventCollisionPeterSO</code> run, a more than thousand-fold improvement.</p>\n\n<p>Benchmarks:</p>\n\n<pre><code>$ go test shuffle_test.go -v -count=1 -run=! -bench=.\ngoos: linux\ngoarch: amd64\nBenchmarkTimePeterSO-8   1000000      1048 ns/op      434 B/op      2 allocs/op\nBenchmarkTimeSlaxor-8      10000   2256271 ns/op   636894 B/op   3980 allocs/op\nPASS\nok      command-line-arguments  23.643s\n$ \n</code></pre>\n\n<p>It's easy to see that the <code>shufflePreventCollisionPeterSO</code> average per iteration cost of 1,000,000 iterations is small, 1,048 nanoseconds, especially when compared to only 10,000 iterations of <code>shufflePreventCollisionSlaxor</code> at 2,256,271 nanoseconds average per iteration.</p>\n\n<p>Also, note the sparing use of memory by <code>shufflePreventCollisionPeterSO</code>, on average 2 allocations for a total allocation of 434 bytes per iteration, versus the profligate use of memory by <code>shufflePreventCollisionSlaxor</code>, on average 3,980 allocations for a total allocation of 636,894 bytes per iteration.</p>\n\n<p><code>shuffle_test.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"strconv\"\n    \"testing\"\n)\n\nfunc shufflePreventCollisionSlaxor(ordered []int) []int {\n    randomized := rand.Perm(len(ordered))\n    for i, o := range ordered {\n        if o == randomized[i] {\n            shufflePreventCollisionSlaxor(ordered)\n        }\n    }\n    return randomized\n}\n\nvar r *rand.Rand\n\nfunc isNoCollision(a, b []int) bool {\n    if len(a) == len(b) {\n        for i, ai := range a {\n            if ai == b[i] {\n                return false\n            }\n        }\n        return true\n    }\n    return false\n}\n\nfunc shufflePreventCollisionPeterSO(ordered []int) []int {\n    const guard = 4 * 1024 // deterministic, finite time\n    for n := 1; n &lt;= guard; n++ {\n        randomized := r.Perm(len(ordered))\n        if isNoCollision(ordered, randomized) {\n            return randomized\n        }\n    }\n    return nil\n}\n\nconst testSeed = int64(60309766)\n\nfunc testTime(t *testing.T, ordered, randomized []int, shuffle func([]int) []int) {\n    shuffled := shuffle(ordered)\n    want := fmt.Sprintf(\"%v\", randomized)\n    got := fmt.Sprintf(\"%v\", shuffled)\n    if want != got {\n        t.Errorf(\"Error:\\n  from: %v\\n  want: %s\\n  got:  %s\\n\", ordered, want, got)\n    }\n}\n\nfunc testTimeSlaxor(t *testing.T, n int) {\n    rand.Seed(testSeed)\n    ordered := []int{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19}\n    randomized := []int{3, 1, 17, 15, 10, 16, 14, 19, 7, 6, 11, 2, 0, 12, 8, 18, 13, 4, 9, 5}\n    testTime(t, ordered, randomized, shufflePreventCollisionSlaxor)\n    for i := 1; i &lt; n; i++ {\n        shufflePreventCollisionSlaxor(ordered)\n    }\n}\n\nfunc TestTimeSlaxor(t *testing.T) {\n    for k := 1; k &lt;= 3; k++ {\n        n := 1000 * k\n        t.Run(strconv.Itoa(k)+\"K\", func(t *testing.T) { testTimeSlaxor(t, n) })\n    }\n}\n\nfunc testTimePeterSo(t *testing.T, n int) {\n    r = rand.New(rand.NewSource(testSeed))\n    ordered := []int{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19}\n    randomized := []int{10, 7, 15, 14, 8, 6, 18, 17, 19, 11, 5, 16, 2, 12, 1, 13, 3, 0, 9, 4}\n    testTime(t, ordered, randomized, shufflePreventCollisionPeterSO)\n    for i := 1; i &lt; n; i++ {\n        shufflePreventCollisionPeterSO(ordered)\n    }\n}\n\nfunc TestTimePeterSO(t *testing.T) {\n    for k := 1; k &lt;= 3; k++ {\n        n := 1000 * k\n        t.Run(strconv.Itoa(k)+\"K\", func(t *testing.T) { testTimePeterSo(t, n) })\n    }\n    for m := 1; m &lt;= 3; m++ {\n        n := 1000 * 1000 * m\n        t.Run(strconv.Itoa(m)+\"M\", func(t *testing.T) { testTimePeterSo(t, n) })\n    }\n}\n\nfunc benchTime(b *testing.B, ordered, randomized []int, shuffle func([]int) []int) {\n    shuffled := shuffle(ordered)\n    want := fmt.Sprintf(\"%v\", randomized)\n    got := fmt.Sprintf(\"%v\", shuffled)\n    if want != got {\n        b.Errorf(\"Error:\\n  from: %v\\n  want: %s\\n  got:  %s\\n\", ordered, want, got)\n    }\n}\n\n\nfunc BenchmarkTimePeterSO(b *testing.B) {\n    b.ReportAllocs()\n    r = rand.New(rand.NewSource(testSeed))\n    ordered := []int{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19}\n    randomized := []int{10, 7, 15, 14, 8, 6, 18, 17, 19, 11, 5, 16, 2, 12, 1, 13, 3, 0, 9, 4}\n    benchTime(b, ordered, randomized, shufflePreventCollisionPeterSO)\n    r = rand.New(rand.NewSource(testSeed))\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        shufflePreventCollisionPeterSO(ordered)\n    }\n}\n\n\nfunc BenchmarkTimeSlaxor(b *testing.B) {\n    b.ReportAllocs()\n    r = rand.New(rand.NewSource(testSeed))\n    ordered := []int{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19}\n    randomized := []int{10, 7, 15, 14, 8, 6, 18, 17, 19, 11, 5, 16, 2, 12, 1, 13, 3, 0, 9, 4}\n    benchTime(b, ordered, randomized, shufflePreventCollisionPeterSO)\n    r = rand.New(rand.NewSource(testSeed))\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        shufflePreventCollisionSlaxor(ordered)\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/ozazWGNZsu\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ozazWGNZsu</a></p>\n"}], "owner": {"reputation": 500, "user_id": 651612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c517f41d4ecb182dffa2d5ae86044be?s=128&d=identicon&r=PG", "display_name": "slaxor", "link": "https://stackoverflow.com/users/651612/slaxor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1512353483, "creation_date": 1512167662, "question_id": 47602451, "link": "https://stackoverflow.com/questions/47602451/go-random-generator-stops-working-after-some-calls", "title": "go random generator stops working after some calls", "body": "<p>I want shuffle db ids so that none of the id refer to themselves, but with this piece of code:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"math/rand\"\n    \"time\"\n)\n\nfunc main() {\n    seed := time.Now().UnixNano() &amp; 999999999\n    log.Print(\"seed: \", seed)\n    rand.Seed(seed)\n    ordered := []int{0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19}\n\n    randomized := shufflePreventCollision(ordered)\n    log.Print(\"Final Result\")\n    log.Print(\"ordered: \", ordered)\n    log.Print(\"random:  \", randomized)\n\n}\n\nfunc shufflePreventCollision(ordered []int) []int {\n    randomized := rand.Perm(len(ordered))\n    for i, o := range ordered {\n        if o == randomized[i] {\n            log.Printf(\"Doing it again because ordered[%d] (%d) is == randomized[%d] (%d)\", i, o, i, randomized[i])\n            log.Print(ordered)\n            log.Print(randomized)\n            shufflePreventCollision(ordered)\n        }\n    }\n    return randomized\n}\n</code></pre>\n\n<p>I find a strange behaviour, when it runs often it at some point hangs and cannot find non-colliding sequences anymore. I tried \n<code>go build -o rand_example3 rand_example3.go &amp;&amp; time (for i in $(seq 10000) ; do ./rand_example3 ; done)</code></p>\n\n<p>And it seems to never end. Am I missing some understanding here or is there really something fishy with math/rand?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 2, "creation_date": 1512161420, "post_id": 47601250, "comment_id": 82161241, "body": "You&#39;re most likely using a nil pointer. Look at what that line of code is doing and it should be clear."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1512161601, "post_id": 47601250, "comment_id": 82161319, "body": "Without the relevant code included, no one can offer much help. &quot;nil pointer dereference&quot; means you&#39;re trying to access a pointer whose value is nil. Best practice to avoid it is not to do that."}], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 7, "last_activity_date": 1598900726, "last_edit_date": 1598900726, "creation_date": 1512161466, "answer_id": 47601302, "question_id": 47601250, "link": "https://stackoverflow.com/questions/47601250/what-is-invalid-memory-address-or-nil-pointer-dereference-in-golang-how-can-i-f/47601302#47601302", "title": "What is invalid memory address or nil pointer dereference in Golang, How can I fix it?", "body": "<p>It's hard to say how to fix it without seeing your code, but basically it means you have a pointer that is <code>nil</code>, and you are trying to get the value that it points to:</p>\n<pre><code>var x *MyStruct\nfmt.Println(*x)\n</code></pre>\n<p>to fix it, you would need to either check if it's nil before dereferencing it:</p>\n<pre><code>var x *MyStruct\nif x != nil {\n    fmt.Println(*x)\n}\n</code></pre>\n<p>or get it to actually point to a value</p>\n<pre><code>var x *MyStruct\nx = &amp;MyStruct{}\nfmt.Println(*x)\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 3982574, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4eed45bca388ea07e582d227d6a1421b?s=128&d=identicon&r=PG&f=1", "display_name": "ybnsl", "link": "https://stackoverflow.com/users/3982574/ybnsl"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11604, "favorite_count": 0, "closed_date": 1512167376, "accepted_answer_id": 47601302, "answer_count": 1, "score": -2, "last_activity_date": 1598900726, "creation_date": 1512161222, "last_edit_date": 1512162116, "question_id": 47601250, "link": "https://stackoverflow.com/questions/47601250/what-is-invalid-memory-address-or-nil-pointer-dereference-in-golang-how-can-i-f", "closed_reason": "Not suitable for this site", "title": "What is invalid memory address or nil pointer dereference in Golang, How can I fix it?", "body": "<p>I am getting the following error:</p>\n\n<blockquote>\n  <p>panic: runtime error: invalid memory address or nil pointer\n  dereference [signal 0xb code=0x1 addr=0x0 pc=0x400da9]</p>\n  \n  <p>goroutine 125 [running]: runtime.panic(0x697480, 0x850d13)\n      /usr/lib/go/src/pkg/runtime/panic.c:279 +0xf5 main.concurrent(0x25e5)\n      /home/ytn/go/src/listner/start.go:19 +0x1a9 created by main.main\n      /home/ytn/go/src/listner/init.go:51 +0x224</p>\n</blockquote>\n\n<p>How can I fix it and What is the best practice to avoid this kind of error?</p>\n\n<pre><code>   for i := n; i &lt; n+11; i++ {\n            user,  err := s.GetUser(i)\n            fmt.Sprint(user.Username) //This is line 19\n            if err != nil &amp;&amp; user != nil {\n              continue\n           }\n     } defer wg.Done()\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1512159968, "post_id": 47600814, "comment_id": 82160574, "body": "If there are conflicting fields, there is no way for the marshaller to know what to do with them. You can use struct tags to omit one of the anonymous fields, or to have it encode an anonymous field with a name (as if it weren&#39;t anonymous), or you can write your own <code>MarshalJSON</code> to use whatever custom logic you need; but in the case of an ambiguity, there is no way without further information from you that the marshaller can know what to do."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1512160103, "post_id": 47600814, "comment_id": 82160644, "body": "The logic used by the JSON encoder is explained in detail in the documentation: <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#Marshal</a>"}, {"owner": {"reputation": 31635, "user_id": 90723, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/56ee28134dd0776825445e3551979b14?s=128&d=identicon&r=PG", "display_name": "Bob Aman", "link": "https://stackoverflow.com/users/90723/bob-aman"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512171297, "post_id": 47600814, "comment_id": 82164762, "body": "Yeah, it seems like <code>MarshalJSON</code> is the right answer then."}], "owner": {"reputation": 31635, "user_id": 90723, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/56ee28134dd0776825445e3551979b14?s=128&d=identicon&r=PG", "display_name": "Bob Aman", "link": "https://stackoverflow.com/users/90723/bob-aman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 292, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1512159057, "creation_date": 1512159057, "question_id": 47600814, "link": "https://stackoverflow.com/questions/47600814/how-do-i-json-serialize-a-struct-with-ambiguous-embedding-in-go", "title": "How do I JSON serialize a struct with ambiguous embedding in Go?", "body": "<p>It would seem that having both <code>Identity</code> and <code>Report</code> embed <code>CommonProperties</code> causes omission of all of the common fields in the JSON serialization of the <code>CompositeObject</code>.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"time\"\n)\n\ntype CommonProperties struct {\n    Type         string    `json:\"type,omitempty\"`\n    ID           string    `json:\"id,omitempty\"`\n    CreatedByRef string    `json:\"created_by_ref,omitempty\"`\n    Created      time.Time `json:\"created,omitempty\"`\n    Modified     time.Time `json:\"modified,omitempty\"`\n    Revoked      bool      `json:\"revoked,omitempty\"`\n    Labels       []string  `json:\"labels,omitempty\"`\n    Confidence   int       `json:\"confidence,omitempty\"`\n    Language     string    `json:\"lang,omitempty\"`\n}\n\ntype Identity struct {\n    CommonProperties\n    Name               string   `json:\"name,omitempty\"`\n    Description        string   `json:\"description,omitempty\"`\n    IdentityClass      string   `json:\"identity_class,omitempty\"`\n    Sectors            []string `json:\"sectors,omitempty\"`\n    ContactInformation string   `json:\"contact_information,omitempty\"`\n}\n\ntype Report struct {\n    CommonProperties\n    Name        string    `json:\"name,omitempty\"`\n    Description string    `json:\"description,omitempty\"`\n    Published   time.Time `json:\"published,omitempty\"`\n    ObjectRefs  []string  `json:\"object_refs,omitempty\"`\n}\n\ntype CompositeObject struct {\n    InternalID string `json:\"uid,omitempty\"`\n    Pending    bool   `json:\"pending\"`\n    Type       string `json:\"type\"`\n\n    *Identity\n    *Report\n}\n\nfunc main() {\n    co := CompositeObject{\n        Type:    \"report\",\n        Pending: true,\n        Report: &amp;Report{\n            Name:        \"Spear Phishing Report\",\n            Description: \"...\",\n            Published:   time.Date(2016, 5, 12, 8, 17, 27, 0, time.UTC),\n            ObjectRefs: []string{\n                \"indicator--26ffb872-1dd9-446e-b6f5-d58527e5b5d2\",\n                \"campaign--83422c77-904c-4dc1-aff5-5c38f3a2c55c\",\n                \"relationship--f82356ae-fe6c-437c-9c24-6b64314ae68a\",\n            },\n            CommonProperties: CommonProperties{\n                ID:           \"report--84e4d88f-44ea-4bcd-bbf3-b2c1c320bcb3\",\n                Type:         \"report\",\n                Created:      time.Date(2016, 5, 12, 8, 17, 27, 0, time.UTC),\n                CreatedByRef: \"identity--a463ffb3-1bd9-4d94-b02d-74e4f1658283\",\n                Modified:     time.Date(2016, 5, 12, 8, 17, 27, 0, time.UTC),\n            },\n        },\n    }\n    json, _ := json.Marshal(&amp;co)\n    fmt.Println(string(json))\n}\n</code></pre>\n\n<p>Play links:</p>\n\n<ul>\n<li><a href=\"https://play.golang.org/p/iVxtYHWVPw\" rel=\"nofollow noreferrer\">https://play.golang.org/p/iVxtYHWVPw</a></li>\n<li><a href=\"https://play.golang.org/p/6adrrJ9iac\" rel=\"nofollow noreferrer\">https://play.golang.org/p/6adrrJ9iac</a></li>\n</ul>\n\n<p>The second one gets the desired output by commenting out second <code>CommonProperties</code> embed.</p>\n\n<p>I don't understand why an embed w/ this type of ambiguity would prevent JSON serialization. Is there a solution that doesn't involve writing a bunch of <code>MarshalJSON()</code> functions?</p>\n"}, {"tags": ["string", "go", "data-conversion"], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 8088391, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-VLfRcfy0VNI/AAAAAAAAAAI/AAAAAAAAE1s/toVEVSXW1lY/photo.jpg?sz=128", "display_name": "Wilfredo", "link": "https://stackoverflow.com/users/8088391/wilfredo"}, "edited": false, "score": 0, "creation_date": 1512161512, "post_id": 47600114, "comment_id": 82161286, "body": "Thank you, I misunderstood the usage of string cast. I will read the specification more carefully"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1512156266, "last_edit_date": 1512156266, "creation_date": 1512155941, "answer_id": 47600114, "question_id": 47600029, "link": "https://stackoverflow.com/questions/47600029/golang-int-reference-to-string/47600114#47600114", "title": "golang int reference to string", "body": "<p>The <a href=\"https://golang.org/ref/spec#Conversions_to_and_from_a_string_type\" rel=\"noreferrer\">specification says</a>:</p>\n\n<blockquote>\n  <p>Converting a signed or unsigned integer value to a string type yields a string containing the UTF-8 representation of the integer.</p>\n</blockquote>\n\n<p>The expression <code>string(*y)</code> evaluates to <code>\"\\x06\"</code>. This is a string with the one byte 6.</p>\n\n<p>Use <a href=\"https://godoc.org/strconv#Itoa\" rel=\"noreferrer\">strconv.Itoa</a> to convert an integer to a string:  <code>strconv.Itoa(*y) == \"6\"</code>.</p>\n\n<p>Note that <code>*y</code> evaluates to 6. The pointer dereference used in the application has no impact on how the string type conversion executes.</p>\n"}, {"tags": [], "owner": {"reputation": 33, "user_id": 2961180, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84c945fcd20530878fd9b5bc6f03421e?s=128&d=identicon&r=PG", "display_name": "Samuel H.", "link": "https://stackoverflow.com/users/2961180/samuel-h"}, "is_accepted": false, "score": 1, "last_activity_date": 1512156379, "creation_date": 1512156379, "answer_id": 47600198, "question_id": 47600029, "link": "https://stackoverflow.com/questions/47600029/golang-int-reference-to-string/47600198#47600198", "title": "golang int reference to string", "body": "<p>The <code>string</code> method converts ASCII indexes into characters, you need strconv's <code>Itoa</code> </p>\n\n<p><a href=\"https://play.golang.org/p/ouRqTIApWo\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ouRqTIApWo</a></p>\n"}], "owner": {"reputation": 9, "user_id": 8088391, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-VLfRcfy0VNI/AAAAAAAAAAI/AAAAAAAAE1s/toVEVSXW1lY/photo.jpg?sz=128", "display_name": "Wilfredo", "link": "https://stackoverflow.com/users/8088391/wilfredo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 512, "favorite_count": 0, "accepted_answer_id": 47600114, "answer_count": 2, "score": -3, "last_activity_date": 1512156379, "creation_date": 1512155636, "last_edit_date": 1512155745, "question_id": 47600029, "link": "https://stackoverflow.com/questions/47600029/golang-int-reference-to-string", "title": "golang int reference to string", "body": "<p>Please help me understand this, maybe I'm doing something wrong.</p>\n\n<pre><code>func main() {\n    x := 6\n    y := &amp;x\n    fmt.Println(\"x: \", x, \", y:\", *y, \"string y:\", string(*y))\n}\n</code></pre>\n\n<p>returns: </p>\n\n<pre><code>x:  6 , y: 6 string y:\n</code></pre>\n\n<p>Why string(*y) does not return 6 ? </p>\n"}, {"tags": ["go", "grpc"], "answers": [{"tags": [], "owner": {"reputation": 1591, "user_id": 706304, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/kPaEB.jpg?s=128&g=1", "display_name": "chilladx", "link": "https://stackoverflow.com/users/706304/chilladx"}, "is_accepted": true, "score": 11, "last_activity_date": 1512411612, "last_edit_date": 1512411612, "creation_date": 1512411260, "answer_id": 47639484, "question_id": 47599509, "link": "https://stackoverflow.com/questions/47599509/grpc-context-on-the-client-side/47639484#47639484", "title": "gRPC context on the client side", "body": "<p>I finally found my way: <a href=\"https://github.com/grpc/grpc-go/blob/master/Documentation/grpc-metadata.md\" rel=\"noreferrer\">https://github.com/grpc/grpc-go/blob/master/Documentation/grpc-metadata.md</a></p>\n\n<p>So basically, <code>grpc.SetHeader()</code> + <code>grpc.SendHeader()</code> and <code>grpc.SetTrailer()</code> are totally what I was looking for. On the client side, <code>grpc.Header()</code> and <code>grpc.Trailer()</code> functions need to be passed to the RPC call, and their argument is a <code>metadata.MD</code> object to be filled.</p>\n\n<p>On the client side, define your receiving metadata:</p>\n\n<pre><code>var header, trailer metadata.MD\n</code></pre>\n\n<p>Then, pass it to the <code>SomeRPCCall()</code> unary RPC:</p>\n\n<pre><code>response, err := client.SomeRPCCall(\n    context.Background(),\n    proto.MyMessage{},\n    grpc.Header(&amp;header),\n    grpc.Trailer(&amp;trailer),\n)\n</code></pre>\n\n<p>And now, you can check what's in your metadata:</p>\n\n<pre><code>for key, value := range header {\n    fmt.Printf(\"%s =&gt; %s\", key, value)\n}\n\nfor key, value := range trailer {\n    fmt.Printf(\"%s =&gt; %s\", key, value)\n}\n</code></pre>\n\n<p>On the server side, you can:</p>\n\n<ul>\n<li><p>force the data to be sent right after the RPC is received (but before it's processed):</p>\n\n<p><code>grpc.SendHeader(ctx, metadata.New(map[string]string{\"my-key\": \"my-value\"}))</code></p></li>\n<li><p>or set &amp; send the metadata at the end of the RPC process (along with the <code>Status</code>):</p>\n\n<p><code>grpc.SetTrailer(ctx, metadata.New(map[string]string{\"my-key\": \"my-value\"}))</code></p></li>\n</ul>\n"}], "owner": {"reputation": 1591, "user_id": 706304, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/kPaEB.jpg?s=128&g=1", "display_name": "chilladx", "link": "https://stackoverflow.com/users/706304/chilladx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7135, "favorite_count": 1, "accepted_answer_id": 47639484, "answer_count": 1, "score": 9, "last_activity_date": 1529865977, "creation_date": 1512153277, "last_edit_date": 1529865977, "question_id": 47599509, "link": "https://stackoverflow.com/questions/47599509/grpc-context-on-the-client-side", "title": "gRPC context on the client side", "body": "<p>I am building a client/server system in go, using gRPC and protobuf (and with a gRPC gateway to REST).</p>\n\n<p>I use <a href=\"https://godoc.org/google.golang.org/grpc/metadata\" rel=\"noreferrer\">metadata</a> in the context on the server side to carry authentication data from the client, and that works perfectly well.</p>\n\n<p>Now, I'd like the server to set some metadata keys/values so that the client can get them, alongside with the response. How can I do that? Using <a href=\"https://godoc.org/google.golang.org/grpc#SetHeader\" rel=\"noreferrer\">SetHeader</a> and <a href=\"https://godoc.org/google.golang.org/grpc#SendHeader\" rel=\"noreferrer\">SendHeader</a>? Ideally, I'd like every single response from the server to integrate that metadata (can be seen as some kind of <a href=\"https://godoc.org/google.golang.org/grpc#UnaryServerInterceptor\" rel=\"noreferrer\">UnaryInterceptor</a>, but on the response rather than the request?)</p>\n\n<p>Here is the code for the <a href=\"https://gitlab.com/pantomath-io/demo-grpc/blob/add-auth/server/main.go\" rel=\"noreferrer\">server</a> and for the <a href=\"https://gitlab.com/pantomath-io/demo-grpc/blob/add-auth/client/main.go\" rel=\"noreferrer\">client</a>.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 5, "creation_date": 1512137045, "post_id": 47595070, "comment_id": 82147495, "body": "A routine written in assembly."}, {"owner": {"reputation": 1867, "user_id": 5281215, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/10153631051339031/picture?type=large", "display_name": "Boo Yan Jiong", "link": "https://stackoverflow.com/users/5281215/boo-yan-jiong"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1512137334, "post_id": 47595070, "comment_id": 82147668, "body": "Haha, can you elaborate more? I learn Go without much Computer science background... is it something related to assembly language? Sorry, i am newbie... :P"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1512137380, "post_id": 47595070, "comment_id": 82147699, "body": "Yes, It&#39;s written in assembly, using a dialect somewhat unique to Go."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1512137549, "post_id": 47595070, "comment_id": 82147840, "body": "There&#39;s about a 99% chance you&#39;ll never write an assembly routine. They&#39;re only used in specific, rare circumstances - <i>very</i> performance-sensitive code where it&#39;s worth the effort to write raw assembly (not easy) optimized for each platform you want to support (even less easy)."}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 2, "creation_date": 1512137902, "post_id": 47595070, "comment_id": 82148088, "body": "Example <a href=\"https://golang.org/src/crypto/md5/md5block_amd64.s\" rel=\"nofollow noreferrer\">golang.org/src/crypto/md5/md5block_amd64.s</a>"}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 1, "last_activity_date": 1512139040, "creation_date": 1512139040, "answer_id": 47595695, "question_id": 47595070, "link": "https://stackoverflow.com/questions/47595070/what-is-an-assembly-routine-and-how-to-use-it-in-go/47595695#47595695", "title": "What is an assembly routine and how to use it in Go?", "body": "<p>Please read <a href=\"https://en.wikipedia.org/wiki/Machine_code\" rel=\"nofollow noreferrer\">this</a> and follow the links there.</p>\n\n<p>To cite it</p>\n\n<blockquote>\n  <p>Machine code or machine language is a set of instructions executed\n  directly by a computer's central processing unit (CPU). Each\n  instruction performs a very specific task, such as a load, a jump, or\n  an ALU operation on a unit of data in a CPU register or memory.</p>\n  \n  <p>&lt;\u2026></p>\n  \n  <p>All practical programs today are written in higher-level languages or\n  assembly language.</p>\n</blockquote>\n\n<p>The Go's own reference doc on its support for assembler is <a href=\"https://golang.org/doc/asm\" rel=\"nofollow noreferrer\">this</a>.</p>\n"}], "owner": {"reputation": 1867, "user_id": 5281215, "user_type": "registered", "accept_rate": 56, "profile_image": "https://graph.facebook.com/10153631051339031/picture?type=large", "display_name": "Boo Yan Jiong", "link": "https://stackoverflow.com/users/5281215/boo-yan-jiong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 723, "favorite_count": 0, "accepted_answer_id": 47595695, "answer_count": 1, "score": 0, "last_activity_date": 1512145764, "creation_date": 1512136895, "last_edit_date": 1512145764, "question_id": 47595070, "link": "https://stackoverflow.com/questions/47595070/what-is-an-assembly-routine-and-how-to-use-it-in-go", "title": "What is an assembly routine and how to use it in Go?", "body": "<p>I am reading a <em>Go</em> tutorial (<a href=\"http://files.cnblogs.com/files/rojas/thewaytogo.pdf\" rel=\"nofollow noreferrer\">The Way To Go</a>), and it mentions something about <strong>assembly routine</strong>, can somebody please explain what is that? It also states about <em>implemented 'outside' Go</em>, and also <em>no body</em>... may I know what is the purpose?</p>\n\n<p>Quote as follow:</p>\n\n<blockquote>\n  <p>To declarer<i>[sic]</i> a function implemented outside Go, such as an assembly routine, you simply give the name and signature, and no body:</p>\n  \n  <p><code>func flushICache(begin, end uintptr) // implemented externally</code></p>\n</blockquote>\n\n<p>I tried to search online, but it seems hard to find any tutorial regarding <strong>assembly routine</strong>, what is that alien? And, what is the meaning of <strong>implemented outside Go</strong>?</p>\n"}, {"tags": ["go", "http.client"], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 2533994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48dc6f1233a7bf85c7902db511696cb0?s=128&d=identicon&r=PG", "display_name": "isaac", "link": "https://stackoverflow.com/users/2533994/isaac"}, "edited": false, "score": 0, "creation_date": 1512220322, "post_id": 47592348, "comment_id": 82174833, "body": "what i want to do is to close the connection once the context is canceled. Transport.CancelRequest can help to close the connection as the document says, but it doesn&#39;t look like so, and it&#39;s deprecated. So if Request.WithContext can&#39;t help to close the connection, how can i do that? Thanks!"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 15, "user_id": 2533994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48dc6f1233a7bf85c7902db511696cb0?s=128&d=identicon&r=PG", "display_name": "isaac", "link": "https://stackoverflow.com/users/2533994/isaac"}, "edited": false, "score": 0, "creation_date": 1512226908, "post_id": 47592348, "comment_id": 82176694, "body": "@isaac: As I said in my answer: this is already handled by the standard http package. When the context is cancelled, the connection will be closed. Further, <a href=\"https://golang.org/pkg/net/http/#Transport.CancelRequest\" rel=\"nofollow noreferrer\">as documented</a>, <code>CancelRequest</code> is deprecated. Don&#39;t use that any more."}, {"owner": {"reputation": 15, "user_id": 2533994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48dc6f1233a7bf85c7902db511696cb0?s=128&d=identicon&r=PG", "display_name": "isaac", "link": "https://stackoverflow.com/users/2533994/isaac"}, "edited": false, "score": 0, "creation_date": 1512276425, "post_id": 47592348, "comment_id": 82189011, "body": "OK, @Flimzy, thanks for the reply. I understand what you trying to say. But what i wanted to know is whether it&#39;s possible to close connection immediately when i cancel it? apparently Request.WithContext can&#39;t achieve this. I can get the response after I cancel it and only then the connection will close. Force to close the connection is my intention."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 15, "user_id": 2533994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48dc6f1233a7bf85c7902db511696cb0?s=128&d=identicon&r=PG", "display_name": "isaac", "link": "https://stackoverflow.com/users/2533994/isaac"}, "edited": false, "score": 0, "creation_date": 1512292846, "post_id": 47592348, "comment_id": 82192120, "body": "@isaac: What evidence do you have that the connection doesn&#39;t close immediately?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 15, "user_id": 2533994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48dc6f1233a7bf85c7902db511696cb0?s=128&d=identicon&r=PG", "display_name": "isaac", "link": "https://stackoverflow.com/users/2533994/isaac"}, "edited": false, "score": 0, "creation_date": 1512312911, "post_id": 47592348, "comment_id": 82197152, "body": "@isaac: Your additional information confirms what I&#39;ve been saying all along. I&#39;ve updated my answer with a detailed explanation."}, {"owner": {"reputation": 15, "user_id": 2533994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48dc6f1233a7bf85c7902db511696cb0?s=128&d=identicon&r=PG", "display_name": "isaac", "link": "https://stackoverflow.com/users/2533994/isaac"}, "edited": false, "score": 1, "creation_date": 1512313118, "post_id": 47592348, "comment_id": 82197213, "body": "looks like i misunderstand the meaning of FIN and RST flag, you&#39;re right, the connection was closed once I cancel the context. Thanks for the reply."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 5, "last_activity_date": 1512312892, "last_edit_date": 1512312892, "creation_date": 1512127433, "answer_id": 47592348, "question_id": 47591342, "link": "https://stackoverflow.com/questions/47591342/request-context-wont-close-connection/47592348#47592348", "title": "request.context won&#39;t close connection", "body": "<p>You don't need to do anything yourself to cancel a request when the context is cancelled. This is already handled by the standard http package <a href=\"https://golang.org/pkg/net/http/#Request.Context\" rel=\"nofollow noreferrer\">as documented</a>.</p>\n\n<p>All you should need is:</p>\n\n<pre><code>func SendRequest(ctx context.Context, url string) {\n    req, err := http.NewRequest(\"GET\", url, nil)\n    if err != nil {\n        panic(err)\n    }\n    req = req.WithContext(ctx)\n\n    res, err := client.Do(req)\n    if err != nil {\n        panic(err)\n    }\n    defer res.Body.Close()\n    io.Copy(ioutil.Discard, res.Body)\n    fmt.Printf(\"return status: %d\\n\", url, res.StatusCode)\n}\n</code></pre>\n\n<h2>EDIT</h2>\n\n<p>Your TCP dump confirms that everything is working as it should, and precisely as I have described above.</p>\n\n<p>To break it down:</p>\n\n<p>Your outbound request is indeed being cancelled after one second, as your TCP dump confirms:</p>\n\n<pre><code>6 2017-12-04 06:10:21.864955 0.0993000      40 TCP       17503 \u2192 9090 [FIN, ACK] Seq=96 Ack=1 Win=8192 Len=0\n7 2017-12-04 06:10:21.864955 0.0000000      40 TCP       9090 \u2192 17503 [ACK] Seq=1 Ack=97 Win-7936 Len=0\n</code></pre>\n\n<p>That <code>FIN</code> on line 6 means the HTTP client is telling the server \"I'm done talking to you\".  The <code>ACK</code> on line 7 means the server responded to the request, and closed the connection.</p>\n\n<p>However, your HTTP handler ignores the cancelled request,and attempts to respond anyway, generating line 8:</p>\n\n<pre><code>8 2017-12-04 06:10:30.868955 9.004000     169 HTTP      HTTP/1.1 200 OK  (text/plain)\n</code></pre>\n\n<p>But then the server receives the message that the connection is invalid:</p>\n\n<pre><code>9 2017-12-04 06:10:30.868955  0.000000      40 TCP       17503 \u2192 8080 [RST, ACK] Seq=97 Ack=130 Win=0 Len=0\n</code></pre>\n\n<p>The <code>RST</code> means the connection has been reset, and is currently invalid. This is because the connection was terminated 9 seconds earlier.</p>\n\n<p>So you see, your request is cancelled immediately, exactly as it should.</p>\n\n<p>The only improvement you could add to your code is to have your HTTP handler in the server actually detect and honor such cancellations, by exiting early when the incoming request has been cancelled.</p>\n"}], "owner": {"reputation": 15, "user_id": 2533994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48dc6f1233a7bf85c7902db511696cb0?s=128&d=identicon&r=PG", "display_name": "isaac", "link": "https://stackoverflow.com/users/2533994/isaac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1908, "favorite_count": 1, "accepted_answer_id": 47592348, "answer_count": 1, "score": 1, "last_activity_date": 1529865992, "creation_date": 1512124001, "last_edit_date": 1529865992, "question_id": 47591342, "link": "https://stackoverflow.com/questions/47591342/request-context-wont-close-connection", "title": "request.context won&#39;t close connection", "body": "<p>I'm using context.Context to cancel a http request</p>\n\n<p>I find although I got the \"context cancel\", the underlying socket connection is still available, and I can get the response after a few seconds. Is it designed this way to read response once request is set out?</p>\n\n<p>This is the code</p>\n\n<pre><code>func SendRequest(ctx context.Context, url string) {\n    req, err := http.NewRequest(\"GET\", url, nil)\n    if err != nil {\n        fmt.Println(err)\n    }\n    req = req.WithContext(ctx)\n\n    res, err := client.Do(req)\n    select {\n    case &lt;-ctx.Done():\n        fmt.Printf(\"%s Canceled\\n\", url)\n        //client.Transport.(*http.Transport).CancelRequest(req)\n        //client.Transport.(*http.Transport).CloseIdleConnections()\n    }\n    if res != nil {\n        defer res.Body.Close()\n    }\n    if err != nil {\n        fmt.Printf(\"Failed: %v\\n\", err)\n    } else {\n        io.Copy(ioutil.Discard, res.Body)\n        fmt.Printf(\"return status: %d\\n\", url, res.StatusCode)\n    }\n}\n</code></pre>\n\n<p>The URL I'm requesting will return after several seconds, so I can still read the response body, and the connection was closed after the process exits.</p>\n\n<p>Here is a simple code to reproduce the issue</p>\n\n<pre><code>func client() {\n    ctx, cancel := context.WithCancel(context.Background())\n    client := http.DefaultClient\n    request, _ := http.NewRequest(\"GET\", \"http://127.0.0.1:9090\", nil)\n    req := request.WithContext(ctx)\n\n    go func() {\n        client.Do(req)\n    }()\n\n    time.Sleep(time.Duration(1) * time.Second)\n    cancel()\n\n    &lt;-time.After(time.Duration(10) * time.Second)\n\n}\n\nfunc sayhelloName(w http.ResponseWriter, r *http.Request) {\n    time.Sleep(time.Duration(10) * time.Second)\n    fmt.Fprintf(w, \"Hello world!\")\n}\n\nfunc server() {\n    http.HandleFunc(\"/\", sayhelloName)\n    err := http.ListenAndServe(\":9090\", nil)\n    if err != nil {\n        log.Fatal(\"ListenAndServe: \", err)\n    }\n}\n</code></pre>\n\n<p>connection was closed after exactly 10 second<br>\n<a href=\"https://i.stack.imgur.com/e9BAX.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/e9BAX.png\" alt=\"connection was closed after exactly 10 second\"></a></p>\n"}, {"tags": ["curl", "go", "timeout"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1512135273, "post_id": 47590994, "comment_id": 82146352, "body": "There&#39;s not enough to go by here, but a broken ipv6 network will behave like this. You should have <code>DualStack</code> enabled in your dialer anyway, which will work around that problem."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1512136777, "post_id": 47590994, "comment_id": 82147342, "body": "Oh, and never discard an <code>http.Transport</code>, which is going to leak connections."}, {"owner": {"reputation": 314, "user_id": 1160840, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/8bacc6ec0fd4d84ec3482be576e2a661?s=128&d=identicon&r=PG", "display_name": "strzelecki.maciek", "link": "https://stackoverflow.com/users/1160840/strzelecki-maciek"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1512136885, "post_id": 47590994, "comment_id": 82147401, "body": "it seems that moderator removed my comment - yes, i fallen victim to misconfigured office network. Deployed on &quot;proper&quot; location, the exporter is not timeouting anymore."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1512137029, "post_id": 47590994, "comment_id": 82147485, "body": "It would still benefit you to fix the improper use of the <code>http.Transport</code> and add <code>DualStack</code> to your dialer."}, {"owner": {"reputation": 314, "user_id": 1160840, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/8bacc6ec0fd4d84ec3482be576e2a661?s=128&d=identicon&r=PG", "display_name": "strzelecki.maciek", "link": "https://stackoverflow.com/users/1160840/strzelecki-maciek"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1512137099, "post_id": 47590994, "comment_id": 82147528, "body": "could you give a best-practice example? :)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1512137297, "post_id": 47590994, "comment_id": 82147652, "body": "The package documentation is quite thorough, and look at the <a href=\"https://golang.org/pkg/net/http/#RoundTripper\" rel=\"nofollow noreferrer\"><code>DefaultTransport</code></a> definition for the recommended defaults. Not discarding the transport is easy; don&#39;t do that, just reuse it (reuse the client too if you&#39;re not making any changes to it)."}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 458735, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PYkFf.jpg?s=128&g=1", "display_name": "Vincent", "link": "https://stackoverflow.com/users/458735/vincent"}, "is_accepted": false, "score": 0, "last_activity_date": 1512132694, "creation_date": 1512132694, "answer_id": 47593817, "question_id": 47590994, "link": "https://stackoverflow.com/questions/47590994/net-http-vs-curl-why-is-go-timing-out-where-curl-isnt/47593817#47593817", "title": "net/http vs curl - why is go timing out where curl isnt?", "body": "<p>This should be more a comment than an answer but I've got not enough points to comment :(</p>\n\n<p>Maybe you should try to not define tr and client on each request.</p>\n\n<p>If you launch to much parallel requests at the same time on a target it can be problematic depending of your target server and your client system. This can explain why a single test request is fine after.</p>\n\n<p>Finally, I'm not go expert at all, but I think you should avoid the if/else with nil:</p>\n\n<pre><code>req, err := http.NewRequest(\"GET\", url, nil)\nif err != nil {\n    log.Error(\"Error while creating the request| \", err)\n    errorLabel = \"cant_create_request\"\n} else {\n   ...\n}\nreturn string(contents), statusCode, errorLabel\n</code></pre>\n\n<p>Shouldn't it be :</p>\n\n<pre><code>req, err := http.NewRequest(\"GET\", url, nil)\nif err != nil {\n    log.Error(\"Error while creating the request| \", err)\n    return string(contents), statusCode, \"cant_create_request\" //return nil instead ?\n}\n...\nreturn string(contents), statusCode, errorLabel\n</code></pre>\n\n<p>To much \"if levels\" is difficult to read and error prone.</p>\n"}], "owner": {"reputation": 314, "user_id": 1160840, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/8bacc6ec0fd4d84ec3482be576e2a661?s=128&d=identicon&r=PG", "display_name": "strzelecki.maciek", "link": "https://stackoverflow.com/users/1160840/strzelecki-maciek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 600, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1512136824, "creation_date": 1512122879, "last_edit_date": 1512136824, "question_id": 47590994, "link": "https://stackoverflow.com/questions/47590994/net-http-vs-curl-why-is-go-timing-out-where-curl-isnt", "title": "net/http vs curl - why is go timing out where curl isnt?", "body": "<p>I have a piece of code checking http/s endpoints for status and loadtime. Then for each top-level page im checking level-1 hrefs, to check that everything that the page is referencing is loading with a 200 as well.</p>\n\n<p>(i check 50 top level pages, and each top-level page has on average of 8 links)</p>\n\n<p>I check top level pages via some goroutines (25) and a waitgroup. For level-1 pages i tried another gouroutines+waitgroup and then a straight forloop (just to compare).</p>\n\n<p>On these level-1 pages im getting alot of \"CLient.Timeout exceeded while awaiting headers\" errors. When i grab such a url, and retry with curl instantly, then it loads perfectly (with a curl)</p>\n\n<p>The pages that timeout on headers are a mixture of js, png, gif, html. Regular stuff that works perfectly when i manually curl it, but somehow fails big time from go.</p>\n\n<p>Below is the function i invoke to get the page contents.</p>\n\n<pre><code>func (t Target) getContents(timeout int64) (string, string, string) {\n    var contents []byte\n    statusCode := \"0\"\n    errorLabel := \"no_error\"\n\n    tr := &amp;http.Transport{\n        TLSClientConfig: &amp;tls.Config{InsecureSkipVerify: true},\n        //      Dial: (&amp;net.Dialer{\n        //          Timeout:   15 * time.Second,\n        //          KeepAlive: 15 * time.Second,\n        //      }).Dial,\n        TLSHandshakeTimeout:   10 * time.Second,\n        ResponseHeaderTimeout: 10 * time.Second,\n        ExpectContinueTimeout: 1 * time.Second,\n    }\n\n    client := &amp;http.Client{Transport: tr, Timeout: time.Duration(timeout) * time.Second}\n\n    url := t.getPageURL()\n    req, err := http.NewRequest(\"GET\", url, nil)\n    if err != nil {\n        log.Error(\"Error while creating the request| \", err)\n        errorLabel = \"cant_create_request\"\n    } else {\n        //req.Header.Add(\"cache-control\", \"no-cache\")\n        if t.Agent != \"\" {\n            req.Header.Set(\"User-Agent\", t.Agent)\n        }\n        if t.SourceIP != \"\" {\n            req.Header.Set(\"X-Forwarded-For\", t.SourceIP)\n        }\n        if t.Host != \"\" {\n            req.Header.Set(\"Host\", t.Host)\n            req.Host = t.Host\n        }\n        response, err := client.Do(req)\n        if err != nil {\n            log.Error(\"Error while doing the request| \", err.Error())\n            errorLabel = \"cant_do_request\"\n        } else {\n            defer response.Body.Close()\n            statusCode = strconv.Itoa(response.StatusCode)\n            contents, err = ioutil.ReadAll(response.Body)\n            if err != nil {\n                log.Error(\"Error while reading the response| \", err)\n                errorLabel = \"cant_read_response\"\n\n            }\n        }\n    }\n    return string(contents), statusCode, errorLabel\n}\n</code></pre>\n"}, {"tags": ["dictionary", "go", "reference", "slice"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1512139386, "post_id": 47590444, "comment_id": 82148977, "body": "The most important thing to take away from this is that <i>there are no references in Go, everything is passed by value</i>. Take a look at <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">Go slice internals</a> for an excellent run-down of how slices really work and why they behave as you&#39;ve observed."}, {"owner": {"reputation": 29, "user_id": 7455746, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-6JuQ_Kockyk/AAAAAAAAAAI/AAAAAAAACHc/O4neKIfHQLg/photo.jpg?sz=128", "display_name": "phye", "link": "https://stackoverflow.com/users/7455746/phye"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512441727, "post_id": 47590444, "comment_id": 82249113, "body": "Thanks Adrian. I knew the details behind golang slice internals, was just curious why slice was so designed (As edited above)."}, {"owner": {"reputation": 309, "user_id": 8591671, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ae21750ead1b346f8240ee5d5458fd1a?s=128&d=identicon&r=PG&f=1", "display_name": "John Snow", "link": "https://stackoverflow.com/users/8591671/john-snow"}, "edited": false, "score": 0, "creation_date": 1547117300, "post_id": 47590444, "comment_id": 95085283, "body": "I believe the question deserves more upvotes. While the answers indeed providing some insights about the implementation, the <i>reasoning</i> for choosing this particular way of implementation is not fully clear, at least for me."}], "answers": [{"comments": [{"owner": {"reputation": 3216, "user_id": 1273978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0dd2212a18f9aba8d63b14c552027a12?s=128&d=identicon&r=PG", "display_name": "metakeule", "link": "https://stackoverflow.com/users/1273978/metakeule"}, "edited": false, "score": 0, "creation_date": 1512149070, "post_id": 47590531, "comment_id": 82155012, "body": "Your answer is overly verbose IMHO. In order to use a language and to get an idea about the underlying concept, it is not necessary to know every detail. Instead of repeating the implementation, explaining, why the implementation makes sense would have been more valuable."}, {"owner": {"reputation": 29, "user_id": 7455746, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-6JuQ_Kockyk/AAAAAAAAAAI/AAAAAAAACHc/O4neKIfHQLg/photo.jpg?sz=128", "display_name": "phye", "link": "https://stackoverflow.com/users/7455746/phye"}, "edited": false, "score": 0, "creation_date": 1512355637, "post_id": 47590531, "comment_id": 82209417, "body": "I totally understand the implementation detail hiding after slice(as stated in The Go Programming Language, i.e., in slice type we have Len, Cap .etc), and also totally understand the copy by value mechanism ---- the same mechanism with C programming language, the actual params passed are actually those params pushed to stack. The reason that I asked this question is actually not these implementation difference, but the logic behind the difference, i.e., why for map param, we have in place CRUD, but for slice, we have to return the slice if the slice passed in slice have been appended."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 8, "last_activity_date": 1512159943, "last_edit_date": 1512159943, "creation_date": 1512121298, "answer_id": 47590531, "question_id": 47590444, "link": "https://stackoverflow.com/questions/47590444/slice-vs-map-to-be-used-in-parameter/47590531#47590531", "title": "slice vs map to be used in parameter", "body": "<p>The difference in behavior lies in the implementation of those types.</p>\n\n<p>Maps are <em>pointers</em> to a data structure, while slices are small <em>structs</em> which contain the pointer to the backing array, the slice length and capacity. <a href=\"https://golang.org/pkg/reflect/#SliceHeader\" rel=\"nofollow noreferrer\"><code>reflect.SliceHeader</code></a> models a slice header:</p>\n\n<pre><code>type SliceHeader struct {\n    Data uintptr\n    Len  int\n    Cap  int\n}\n</code></pre>\n\n<p>This is the main reason for the deviation: pointer vs struct.</p>\n\n<p>When you add a new element to a map, the pointer remains the same. The pointed map structure may change, but the map pointer will not.</p>\n\n<p>When you change an <em>element</em> of a slice, you effectively change the element of the backing array. The slice header will not change: it will continue to hold the same pointer, length and capacity. Any copiy of the slice value (the slice header) points to the same backing array, and as such, all will see the changed element.</p>\n\n<p>When you <em>add</em> a new element to a slice, the slice header that describes the <em>new</em> slice (which contains the additional element) <strong>must change</strong>: the length must be increased by 1, and optionally the pointer and capacity may change too (if a new backing array had to be allocated to accommodate the new element).</p>\n\n<p>Everything is passed by value in Go. This is the 2nd reason for the deviation. When a slice is passed, a copy is made from the header, and if something is appended to the copy, even if the result is properly assigned back to it (back to the copy), the original slice header will know nothing about that.</p>\n\n<p>When a map is passed, the map value (which is a pointer) will also be copied, but both the original map pointer and the copy map pointer will point to the same map structure. Adding a value or changing the map via any of those pointers will change the one and only pointed map structure.</p>\n\n<p>To make them behave the same, you would have to make them the same <em>\"type\"</em> of type, that is: pointers. As noted above, maps are already (hidden) pointers. If you go ahead and start passing pointers to slices, and you operate on the <em>pointed</em> value, they will behave the same as maps. In practice this is rarely used (there is even less language support to aid working with slice pointers than array pointers), and rather the alternative approach is wide spread where the new slice is returned. You can read more about it here: <a href=\"https://stackoverflow.com/questions/38013922/slicing-a-slice-pointer-passed-as-argument/38014097#38014097\">Slicing a slice pointer passed as argument</a></p>\n"}, {"comments": [{"owner": {"reputation": 29, "user_id": 7455746, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-6JuQ_Kockyk/AAAAAAAAAAI/AAAAAAAACHc/O4neKIfHQLg/photo.jpg?sz=128", "display_name": "phye", "link": "https://stackoverflow.com/users/7455746/phye"}, "edited": false, "score": 0, "creation_date": 1512441799, "post_id": 47591567, "comment_id": 82249128, "body": "Have you wondered why slice was not implemented as a pointer but a struct?"}], "tags": [], "owner": {"reputation": 882, "user_id": 3984522, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/6D9an.jpg?s=128&g=1", "display_name": "hsrv", "link": "https://stackoverflow.com/users/3984522/hsrv"}, "is_accepted": false, "score": 1, "last_activity_date": 1512124776, "creation_date": 1512124776, "answer_id": 47591567, "question_id": 47590444, "link": "https://stackoverflow.com/questions/47590444/slice-vs-map-to-be-used-in-parameter/47591567#47591567", "title": "slice vs map to be used in parameter", "body": "<p>To modify the slice you just need to edit the code like this (<a href=\"https://play.golang.org/p/2SeP93itIL\" rel=\"nofollow noreferrer\">https://play.golang.org/p/2SeP93itIL</a>):</p>\n\n<pre><code>func editSlice(s *[]int) {\n    *s = append(*s, 5)\n    *s = append(*s, 9)\n}\n</code></pre>\n\n<p>There is some explanation in <a href=\"https://golang.org/doc/effective_go.html#slices\" rel=\"nofollow noreferrer\">Effective Go</a>:</p>\n\n<blockquote>\n  <p>If a function takes a slice argument, changes it makes <strong>to the</strong>\n  <strong>elements</strong> of the slice will be visible to the caller</p>\n</blockquote>\n\n<p>That's why modified arguments of the slice will be visible to the caller, but the new slice itself is not visible until you return it or assign to the existing variable. Because <code>append</code> returns <em>a new slice</em>:</p>\n\n<blockquote>\n  <p>We must return the slice afterwards because, although Append can\n  modify the elements of slice, <strong>the slice itself</strong> (the run-time data\n  structure holding the pointer, length, and capacity) <strong>is passed by\n  value</strong>.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 98, "user_id": 5595614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/508773b7491d10484c6bb70448a955b5?s=128&d=identicon&r=PG&f=1", "display_name": "Flying onion", "link": "https://stackoverflow.com/users/5595614/flying-onion"}, "is_accepted": false, "score": 0, "last_activity_date": 1512230754, "creation_date": 1512230754, "answer_id": 47609780, "question_id": 47590444, "link": "https://stackoverflow.com/questions/47590444/slice-vs-map-to-be-used-in-parameter/47609780#47609780", "title": "slice vs map to be used in parameter", "body": "<p>If two objects have the same memory address, then if you change the value of one of them, the other will change, because they are actually one object.</p>\n\n<p>In your code, <code>m</code> in <code>editMap</code> and <code>m</code> in <code>main</code> have the same value: <strong>the address of a same dictionary object</strong>. However, the values of <code>s</code> in <code>editSlice</code> and <code>s</code> in <code>main</code> are two different objects.</p>\n\n<p>I hope my explanation is clear enough.</p>\n"}], "owner": {"reputation": 29, "user_id": 7455746, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-6JuQ_Kockyk/AAAAAAAAAAI/AAAAAAAACHc/O4neKIfHQLg/photo.jpg?sz=128", "display_name": "phye", "link": "https://stackoverflow.com/users/7455746/phye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1243, "favorite_count": 1, "answer_count": 3, "score": 2, "last_activity_date": 1512383347, "creation_date": 1512121044, "last_edit_date": 1512383347, "question_id": 47590444, "link": "https://stackoverflow.com/questions/47590444/slice-vs-map-to-be-used-in-parameter", "title": "slice vs map to be used in parameter", "body": "<p>In golang, slice and map are both reference types. When you simply need to modify elements in slice/map, the modification to slice/map members will be \"broadcasted\" to all slices. E.g, given <code>m1 := make(map[int]int); m2 := m1</code>, <code>m1[3] = 5</code> will lead to <code>m2[3] == 5</code>. </p>\n\n<p>However, when you try to add new elements into these two types, things start to differ. As is shown in the example below, the new elements added into a map param will be shown automatically in the argument; however, the new elements added into a slice, are 'discarded' in the argument. </p>\n\n<p>Question is, why is this difference?</p>\n\n<pre><code>func editMap(m map[int]int) {\n    m[3] = 8\n    m[4] = 9\n}\n\nfunc editSlice(s []int) {\n    s = append(s, 5)\n    s = append(s, 9)\n}\n\nfunc main() {\n    m := make(map[int]int, 0)\n    m[1] = 5\n    m[2] = 3\n    fmt.Printf(\"%v\\n\", m)  //map[1:5 2:3]\n    editMap(m)\n    fmt.Printf(\"%v\\n\", m)  //map[1:5 2:3 3:8 4:9]\n\n    s := make([]int, 2)\n    s[0] = 2\n    s[1] = 5\n    fmt.Printf(\"%v\\n\", s)  //[2 5]\n    editSlice(s)\n    fmt.Printf(\"%v\\n\", s)  //[2 5]\n}\n</code></pre>\n\n<p>Edit: \nI may not be clear on the intention of this question and please let me rephrase it(sorry for this and thanks for all the internal details). </p>\n\n<p>What I really want to ask is, apparently map is implemented as a pointer to hide all details for the hash map; why wasn't slice implemented similarly?</p>\n\n<p>The current slice implementation is indeed quite lightweight, however, from an API point of view (API between golang users like us and golang maintainers like Ross Cox), the APIs of these two 'reference' types are not that uniform and may lead to pitfalls for developers new to golang. </p>\n"}, {"tags": ["go", "channel", "multiplexing"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1512120645, "post_id": 47589584, "comment_id": 82137609, "body": "What you&#39;re after is called &quot;fan-out&quot;, you may start <a href=\"https://blog.golang.org/pipelines#TOC_4.\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1512139987, "post_id": 47589584, "comment_id": 82149411, "body": "No, fan-out is what asker&#39;s got but doesn&#39;t want: multiple clients reading from the same channel."}], "answers": [{"comments": [{"owner": {"reputation": 13903, "user_id": 86388, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/cPl84.jpg?s=128&g=1", "display_name": "Tarion", "link": "https://stackoverflow.com/users/86388/tarion"}, "edited": false, "score": 0, "creation_date": 1512406931, "post_id": 47596042, "comment_id": 82234933, "body": "Thanks, I came up with some reusable solution around this: <a href=\"https://github.com/Lobaro/go-util/blob/master/broadcast/broadcast.go\" rel=\"nofollow noreferrer\">github.com/Lobaro/go-util/blob/master/broadcast/broadcast.go</a>"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 6, "last_activity_date": 1512140221, "creation_date": 1512140221, "answer_id": 47596042, "question_id": 47589584, "link": "https://stackoverflow.com/questions/47589584/how-to-multiplex-channel-output-in-go/47596042#47596042", "title": "How to multiplex channel output in go", "body": "<p>Mutiplexing is pretty straightforward: make a slice of channels you want to multiplex to, start up a goroutine that reads from the original channel and copies each message to each channel in the slice:</p>\n\n<pre><code>// Really this should be in Bootloader but this is just an example\nvar consumers []chan []byte\n\nfunc (b *Bootloader) multiplex() {\n    // We'll use a sync.once to make sure we don't start a bunch of these.\n    sync.Once(func(){ \n        go func() {\n            // Every time a message comes over the channel...\n            for v := range b.logCh {\n                // Loop over the consumers...\n                for _,cons := range consumers {\n                    // Send each one the message\n                    cons &lt;- v\n                }\n            }\n        }()\n    })\n}\n</code></pre>\n"}], "owner": {"reputation": 13903, "user_id": 86388, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/cPl84.jpg?s=128&g=1", "display_name": "Tarion", "link": "https://stackoverflow.com/users/86388/tarion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1467, "favorite_count": 0, "accepted_answer_id": 47596042, "answer_count": 1, "score": 0, "last_activity_date": 1512140221, "creation_date": 1512117953, "question_id": 47589584, "link": "https://stackoverflow.com/questions/47589584/how-to-multiplex-channel-output-in-go", "title": "How to multiplex channel output in go", "body": "<p>I'm looking for a solution to multiplex some channel output in go.</p>\n\n<p>I have a source of data which is a read from an <code>io.Reader</code> that I send to a single channel. On the other side I have a websocket request handler that reads from the channel. Now it happens that two clients create a websocket connection, both reading from the same channel but each of them only getting a part of the messages.</p>\n\n<p><strong>Code example (simplified):</strong></p>\n\n<pre><code>func (b *Bootloader) ReadLog() (&lt;-chan []byte, error) {\n    if b.logCh != nil {\n        logrus.Warn(\"ReadLog called while channel already exists!\")\n        return b.logCh, nil // This is where we get problems\n    }\n\n    b.logCh = make(chan []byte, 0)\n\n    go func() {\n        buf := make([]byte, 1024)\n        for {\n            n, err := b.p.Read(buf)\n\n            if err == nil {\n                msg := make([]byte, n)\n                copy(msg, buf[:n])\n                b.logCh &lt;- msg\n            } else {\n                break\n            }\n        }\n\n        close(b.logCh)\n        b.logCh = nil\n    }()\n\n    return b.logCh, nil\n}\n</code></pre>\n\n<p>Now when <code>ReadLog()</code> is called twice, the second call just returns the channel created in the first call, which leads to the problem explained above.</p>\n\n<p><strong>The question is:</strong> How to do proper multiplexing?</p>\n\n<p>Is it better/easier/more ideomatic to care about the multiplexing on the sending or receiving site?</p>\n\n<p>Should I hide the channel from the receiver and work with callbacks?</p>\n\n<p>I'm a little stuck at the moment. Any hints are welcome.</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1512114802, "post_id": 47588826, "comment_id": 82134848, "body": "You haven&#39;t included all your code in the answer. cloneTLSConfig is defined here in the http/transport pkg, you probably don&#39;t need it: <a href=\"https://tip.golang.org/src/net/http/transport.go#L2014\" rel=\"nofollow noreferrer\">tip.golang.org/src/net/http/transport.go#L2014</a> Include all code in your question as a starting point."}], "answers": [{"tags": [], "owner": {"reputation": 2495, "user_id": 266384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b5e8308e6353deef846a706b3f634a3?s=128&d=identicon&r=PG", "display_name": "Patrick", "link": "https://stackoverflow.com/users/266384/patrick"}, "is_accepted": false, "score": 0, "last_activity_date": 1522253891, "creation_date": 1522253891, "answer_id": 49539546, "question_id": 47588826, "link": "https://stackoverflow.com/questions/47588826/go-and-mysql-and-clonetlsconfig/49539546#49539546", "title": "go and mysql and cloneTLSConfig", "body": "<p>You are using an old version of <strong>golang</strong> (&lt;= 1.6.4) and this is no longer supported by the <strong>go-sql-driver/mysql</strong> maintainer.</p>\n\n<p>You have to upgrade your golang version or use another mysql driver, like <a href=\"https://github.com/ziutek/mymysql\" rel=\"nofollow noreferrer\">ziutek/mymysql</a>.</p>\n\n<p>See <a href=\"https://github.com/go-sql-driver/mysql/issues/720\" rel=\"nofollow noreferrer\">this link</a> for more detail.</p>\n"}], "owner": {"reputation": 73, "user_id": 7779864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea604688c69cebe14322a73b5c5680ef?s=128&d=identicon&r=PG&f=1", "display_name": "leo", "link": "https://stackoverflow.com/users/7779864/leo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 400, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1522253891, "creation_date": 1512114510, "last_edit_date": 1522253740, "question_id": 47588826, "link": "https://stackoverflow.com/questions/47588826/go-and-mysql-and-clonetlsconfig", "title": "go and mysql and cloneTLSConfig", "body": "<p>when I use go mysql. i got this problem. \nundefined: cloneTLSConfig\nI don't know how to fix this problem.\nhere it is my code.</p>\n\n<pre><code>package main\n\nimport(\n        \"database/sql\"\n\n        _\"github.com/go-sql-driver/mysql\"\n\n         \"fmt\"\n         \"log\"\n)\n\nfunc main() {\n    db,err=sql.Open(\"mysql\",\"root:19920211@tcp(localhost:3306)/names?charset=utf8\" )\n\n    if err!=nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(\"Well done\")\n\n    defer db.Close()\n}\n</code></pre>\n\n<p>When building:</p>\n\n<pre><code>$ go build\n# github.com/go-sql-driver/mysql\nsrc/github.com/go-sql-driver/mysql/utils.go:81: undefined: cloneTLSConfig\n</code></pre>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 2, "last_activity_date": 1512113537, "creation_date": 1512113537, "answer_id": 47588605, "question_id": 47588264, "link": "https://stackoverflow.com/questions/47588264/marshal-and-unmarshal-a-time-time-got-different-values/47588605#47588605", "title": "Marshal and Unmarshal a time.Time, Got different values", "body": "<p>Probably to do with monotonic time being wiped by marshalling. See the the package docs</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1512141144, "last_edit_date": 1512141144, "creation_date": 1512117969, "answer_id": 47589592, "question_id": 47588264, "link": "https://stackoverflow.com/questions/47588264/marshal-and-unmarshal-a-time-time-got-different-values/47589592#47589592", "title": "Marshal and Unmarshal a time.Time, Got different values", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/time/\" rel=\"nofollow noreferrer\">Package time</a></p>\n  \n  <p><code>import \"time\"</code> </p>\n  \n  <p>Note that the Go == operator compares not just the time instant but\n  also the Location and the monotonic clock reading. </p>\n  \n  <p><a href=\"https://golang.org/pkg/time/#Time.Equal\" rel=\"nofollow noreferrer\">func (Time) Equal</a></p>\n  \n  <p><code>func (t Time) Equal(u Time) bool</code></p>\n  \n  <p>Equal reports whether t and u represent the same time instant. Two\n  times can be equal even if they are in different locations. For\n  example, 6:00 +0200 CEST and 4:00 UTC are Equal. See the documentation\n  on the Time type for the pitfalls of using == with Time values; most\n  code should use Equal instead.</p>\n</blockquote>\n\n<hr>\n\n<pre><code>// A Time represents an instant in time with nanosecond precision.\n//\n// Time instants can be compared using the Before, After, and Equal methods.\n//\n// Note that the Go == operator compares not just the time instant but also the\n// Location and the monotonic clock reading. Therefore, Time values should not\n// be used as map or database keys without first guaranteeing that the\n// identical Location has been set for all values, which can be achieved\n// through use of the UTC or Local method, and that the monotonic clock reading\n// has been stripped by setting t = t.Round(0). In general, prefer t.Equal(u)\n// to t == u, since t.Equal uses the most accurate comparison available and\n// correctly handles the case when only one of its arguments has a monotonic\n// clock reading.\n//\ntype Time struct {\n// wall and ext encode the wall time seconds, wall time nanoseconds,\n// and optional monotonic clock reading in nanoseconds.\n//\n// From high to low bit position, wall encodes a 1-bit flag (hasMonotonic),\n// a 33-bit seconds field, and a 30-bit wall time nanoseconds field.\n// The nanoseconds field is in the range [0, 999999999].\n// If the hasMonotonic bit is 0, then the 33-bit field must be zero\n// and the full signed 64-bit wall seconds since Jan 1 year 1 is stored in ext.\n// If the hasMonotonic bit is 1, then the 33-bit field holds a 33-bit\n// unsigned wall seconds since Jan 1 year 1885, and ext holds a\n// signed 64-bit monotonic clock reading, nanoseconds since process start.\nwall uint64\next  int64\n\n// loc specifies the Location that should be used to\n// determine the minute, hour, month, day, and year\n// that correspond to this Time.\n// The nil location means UTC.\n// All UTC times are represented with loc==nil, never loc==&amp;utcLoc.\nloc *Location\n}\n</code></pre>\n\n<hr>\n\n<p>It has long been the case, not just now (go1.9 +), that it is wrong to compare Go <code>time.Time</code>s by comparing the implementation (opaque <code>struct</code>) with the Go equal operator (<code>==</code>). For example, as far back as go1.4,</p>\n\n<blockquote>\n  <p>Note that the Go <code>==</code> operator compares not just the time instant but\n  also the Location. Therefore, Time values should not be used as map or\n  database keys without first guaranteeing that the identical Location\n  has been set for all values, which can be achieved through use of the\n  UTC or Local method.</p>\n</blockquote>\n\n<p>go1.9 merely added an additional element, a monotonic value, to the opaque <code>time.Time</code> <code>struct</code>.</p>\n\n<hr>\n\n<p>Always use the <code>time.Equal</code> method to assert <code>time.Time</code> equality.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    now := time.Now() // wall, location, &amp; monotonic\n    fmt.Println(\"Now:   \", now)\n    clock := now.Round(0) // wall &amp; location\n    fmt.Println(\"Clock: \", clock)\n    utc := now.UTC() // wall &amp; location UTC\n    fmt.Println(\"UTC:   \", utc)\n    fmt.Println(\"now.Equal(clock)\", now.Equal(clock)) // true\n    fmt.Println(\"now == clock    \", now == clock)     // false\n    fmt.Println(\"now.Equal(utc)  \", now.Equal(utc))   // true\n    fmt.Println(\"now == utc      \", now == utc)       // false\n    fmt.Println(\"clock.Equal(utc)\", clock.Equal(utc)) // true\n    fmt.Println(\"clock == utc    \", clock == utc)     // false\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/VbFV2AcYw-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/VbFV2AcYw-</a></p>\n\n<p>Output:</p>\n\n<pre><code>Now:    2017-12-01 14:54:15.168706745 -0500 EST m=+0.000899521\nClock:  2017-12-01 14:54:15.168706745 -0500 EST\nUTC:    2017-12-01 19:54:15.168706745 +0000 UTC\nnow.Equal(clock) true\nnow == clock     false\nnow.Equal(utc)   true\nnow == utc       false\nclock.Equal(utc) true\nclock == utc     false\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 6716386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f857698011c87ba78e30761e2b41404a?s=128&d=identicon&r=PG&f=1", "display_name": "yangzhijia", "link": "https://stackoverflow.com/users/6716386/yangzhijia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 974, "favorite_count": 2, "accepted_answer_id": 47588605, "answer_count": 2, "score": 2, "last_activity_date": 1512141144, "creation_date": 1512112043, "last_edit_date": 1512113329, "question_id": 47588264, "link": "https://stackoverflow.com/questions/47588264/marshal-and-unmarshal-a-time-time-got-different-values", "title": "Marshal and Unmarshal a time.Time, Got different values", "body": "<p>I am try to update my Go code from 1.8 to 1.9. but, i got some problem:</p>\n\n<pre><code>package simple_struct\n\nimport (\n    \"time\"\n    \"encoding/json\"\n    \"github.com/stretchr/testify/assert\"\n    \"testing\"\n)\n\ntype SimpleStruct struct {\n    CreateTime time.Time\n    Other      string\n}\n\nfunc NewSimpleStruct() *SimpleStruct {\n    return &amp;SimpleStruct{\n        CreateTime: time.Now(),\n    }\n}\n\nfunc Test(t *testing.T) {\n    s1 := NewSimpleStruct()\n    data, err := json.Marshal(s1)\n    assert.Nil(t, err)\n    s2 := &amp;SimpleStruct{}\n    err = json.Unmarshal(data, s2)\n    assert.Nil(t, err)\n\n    assert.Equal(t, s2, s1)\n    // this is not equal\n    // output:\n    /*\n\n    Diff:\n    --- Expected\n    +++ Actual\n    @@ -1,3 +1,3 @@\n    (*simple_struct.SimpleStruct)({\n        - CreateTime: (time.Time) 2017-12-01 14:54:53.948875421 +0800 CST,\n        + CreateTime: (time.Time) 2017-12-01 14:54:53.948875421 +0800 CST m=+0.001827244,\n    */\n}\n</code></pre>\n\n<p>It is working in Golang 1.8, but not in Golang 1.9. </p>\n\n<p>I know that Golang 1.9 has update <code>time.Time</code>, but I do not understand this.</p>\n"}, {"tags": ["sockets", "http", "go", "tcp"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512106885, "post_id": 47587153, "comment_id": 82131954, "body": "Perhaps the comment is wrong.  Once the response body is read to EOF, there&#39;s nothing preventing the client from reusing the connection."}, {"owner": {"reputation": 109, "user_id": 6935109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8254e5349c1bae71bd2826d25443e281?s=128&d=identicon&r=PG&f=1", "display_name": "loin.liao", "link": "https://stackoverflow.com/users/6935109/loin-liao"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512112915, "post_id": 47587153, "comment_id": 82134062, "body": "@CeriseLim&#243;n yes, it&#39;s a error on comment. <a href=\"https://github.com/golang/go/issues/22954\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/22954</a> but the response body not read EOF. just read content-Length in http header then read Content-Length bytes from body."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1512132590, "post_id": 47587153, "comment_id": 82144663, "body": "&quot;Read to EOF&quot; shorthand for &quot;read to the end of the response body&quot;.  Reading content-length bytes is reading to the end of the response body."}], "answers": [{"comments": [{"owner": {"reputation": 109, "user_id": 6935109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8254e5349c1bae71bd2826d25443e281?s=128&d=identicon&r=PG&f=1", "display_name": "loin.liao", "link": "https://stackoverflow.com/users/6935109/loin-liao"}, "edited": false, "score": 0, "creation_date": 1512110160, "post_id": 47587434, "comment_id": 82133029, "body": "but in GO net/http comment, it says:  &quot;The default HTTP client&#39;s Transport does not attempt to reuse HTTP/1.0 or HTTP/1.1 TCP connections (&quot;keep-alive&quot;) unless the Body is read to completion and is closed.&quot; but i don&#39;t close the resp.Body. so does we don&#39;t need close? just read completion is ready to be reuse?"}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1512107808, "creation_date": 1512107808, "answer_id": 47587434, "question_id": 47587153, "link": "https://stackoverflow.com/questions/47587153/when-does-go-http-get-reuse-the-tcp-connection/47587434#47587434", "title": "when does Go http.Get reuse the tcp connection?", "body": "<p>You have read it till the end in first occurence of line:</p>\n\n<pre><code>_, err = ioutil.ReadAll(resp.Body)\n</code></pre>\n\n<p>So the connection is ready to be resused. Try not to read and run again.</p>\n"}, {"tags": [], "owner": {"reputation": 109, "user_id": 6935109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8254e5349c1bae71bd2826d25443e281?s=128&d=identicon&r=PG&f=1", "display_name": "loin.liao", "link": "https://stackoverflow.com/users/6935109/loin-liao"}, "is_accepted": false, "score": 1, "last_activity_date": 1512113082, "creation_date": 1512113082, "answer_id": 47588501, "question_id": 47587153, "link": "https://stackoverflow.com/questions/47587153/when-does-go-http-get-reuse-the-tcp-connection/47588501#47588501", "title": "when does Go http.Get reuse the tcp connection?", "body": "<p>this problem has been solved in\n<a href=\"https://github.com/golang/go/issues/22954\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/22954</a>.</p>\n"}], "owner": {"reputation": 109, "user_id": 6935109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8254e5349c1bae71bd2826d25443e281?s=128&d=identicon&r=PG&f=1", "display_name": "loin.liao", "link": "https://stackoverflow.com/users/6935109/loin-liao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2513, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1512113082, "creation_date": 1512105999, "last_edit_date": 1512107855, "question_id": 47587153, "link": "https://stackoverflow.com/questions/47587153/when-does-go-http-get-reuse-the-tcp-connection", "title": "when does Go http.Get reuse the tcp connection?", "body": "<p>in GO net/http Response Body annotation says:</p>\n\n<blockquote>\n  <p>It is the caller's responsibility to close Body. The default HTTP client's Transport does not attempt to reuse HTTP/1.0 or HTTP/1.1 TCP connections (\"keep-alive\") unless the Body is read to completion and is\n  closed.</p>\n</blockquote>\n\n<p>It's mean: if I use http.Get and don't call resp.Body.Close() then it will not resue HTTP/1.0 or HTTP/1.1 TCP connections (\"keep-alive\") yeah?</p>\n\n<p>so I write some code:\n     <pre>\npackage main</p>\n\n<p>import (\n    \"time\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n)</p>\n\n<p>func main() {\n    resp, err := http.Get(\"<a href=\"http://127.0.0.1:8588\" rel=\"nofollow noreferrer\">http://127.0.0.1:8588</a>\")</p>\n\n<pre><code>if err != nil {\n    panic(err)\n}\n_, err = ioutil.ReadAll(resp.Body)\nif err != nil {\n    panic(err)\n}\n\nresp2, err := http.Get(\"http://127.0.0.1:8588\")\n\nif err != nil {\n    panic(err)\n}\n_, err = ioutil.ReadAll(resp2.Body)\nif err != nil {\n    panic(err)\n}\n\nfmt.Println(\"before time sleep\")\ntime.Sleep(time.Second * 35)\n</code></pre>\n\n<p>}\n     </pre>\nand I only see ONE tcp connection build in wireshark, why?\nI don't close <code>res.Body</code> so the <code>http</code> client should't be reuse the tcp connection.</p>\n"}, {"tags": ["go", "timeout"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512100537, "post_id": 47586404, "comment_id": 82130457, "body": "What is the concrete type of self.reader?"}, {"owner": {"reputation": 1161, "user_id": 3917295, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/BFoJm.jpg?s=128&g=1", "display_name": "vinllen", "link": "https://stackoverflow.com/users/3917295/vinllen"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512100645, "post_id": 47586404, "comment_id": 82130487, "body": "@CeriseLim&#243;n io.ReadWriteCloser/*io.File"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1512101316, "post_id": 47586404, "comment_id": 82130622, "body": "For *os.File, <a href=\"https://go-review.googlesource.com/c/go/+/71770\" rel=\"nofollow noreferrer\">wait for Go 1.10.</a>.  The other option is to write some syscall code."}, {"owner": {"reputation": 1161, "user_id": 3917295, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/BFoJm.jpg?s=128&g=1", "display_name": "vinllen", "link": "https://stackoverflow.com/users/3917295/vinllen"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512101472, "post_id": 47586404, "comment_id": 82130656, "body": "@CeriseLim&#243;n Thanks, but is there any backup method to solve this problem?"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 1, "creation_date": 1512108288, "post_id": 47586404, "comment_id": 82132339, "body": "Have you tried this recipe using <code>context</code>?  <a href=\"https://gist.github.com/dchapes/6c992bf3e943934462509338cd213e99\" rel=\"nofollow noreferrer\">gist.github.com/dchapes/6c992bf3e943934462509338cd213e99</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 1, "creation_date": 1512135359, "post_id": 47586404, "comment_id": 82146407, "body": "@EugeneLisitsky: that cannot cancel a blocked Read"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1512135415, "post_id": 47586404, "comment_id": 82146441, "body": "@vinllen: in what situation do you have an <code>*os.File</code> that blocks indefinitely?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1512155678, "post_id": 47586404, "comment_id": 82158527, "body": "@JimB Read on a pipe can block indefinitely."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512156086, "post_id": 47586404, "comment_id": 82158738, "body": "@CeriseLim&#243;n: yes, I know, I just wanted to know if this particular question could easily apply the self-pipe trick (though it&#39;s still a not a pretty solution). Regardless, usually you don&#39;t have an large number of these, and the answer is &quot;just leave it&quot;."}, {"owner": {"reputation": 1161, "user_id": 3917295, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/BFoJm.jpg?s=128&g=1", "display_name": "vinllen", "link": "https://stackoverflow.com/users/3917295/vinllen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1512359565, "post_id": 47586404, "comment_id": 82210221, "body": "@JimB Sorry for the delay response, for example, I just want close the os.File when then given times out or a given signal raises. However, I&#39;ve no idea how to exit the os.File.read()"}], "answers": [{"tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 1, "last_activity_date": 1533821424, "creation_date": 1533821424, "answer_id": 51768386, "question_id": 47586404, "link": "https://stackoverflow.com/questions/47586404/how-to-set-timeout-in-os-file-io-read-in-golang/51768386#51768386", "title": "How to set timeout in *os.File/io.Read in golang", "body": "<p>Your mistake here is something different:</p>\n\n<p>When you read from the reader you just read one time and that is wrong:</p>\n\n<pre><code>go func() { \n        n, err = self.reader.Read(buf) // this Read needs to be in a loop\n        ch &lt;- true \n}() \n</code></pre>\n\n<p>Here is a simple example (<a href=\"https://play.golang.org/p/2AnhrbrhLrv\" rel=\"nofollow noreferrer\">https://play.golang.org/p/2AnhrbrhLrv</a>)</p>\n\n<pre><code>buf := bytes.NewBufferString(\"0123456789\")\nr := make([]byte, 3)\nn, err := buf.Read(r)\nfmt.Println(string(r), n, err)\n// Output: 012 3 &lt;nil&gt;\n</code></pre>\n\n<p>The size of the given slice is used when using the io.Reader. If you would log the n variable in your code you would see, that not the whole file is read. The select statement outside of your goroutine is at the wrong place.</p>\n\n<pre><code>go func() {\n    a := make([]byte, 1024)\n    for {\n        select {\n        case &lt;-quit:\n            result &lt;- []byte{}\n            return\n        default:\n            _, err = self.reader.Read(buf)\n            if err == io.EOF {\n                result &lt;- a\n                return\n            }\n        }\n    }\n}()\n</code></pre>\n\n<p>But there is something more! You want to implement the io.Reader interface. After the <code>Read()</code> method is called until the file ends you should not start a goroutine in here, because you just read chunks of the file. \nAlso the timeout inside the Read() method doesn't help, because that timeout works for each call and not for the whole file.</p>\n"}, {"comments": [{"owner": {"reputation": 764, "user_id": 1195013, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/4ed7ee81265e8dcf1aa5738dc14f4049?s=128&d=identicon&r=PG", "display_name": "Valer", "link": "https://stackoverflow.com/users/1195013/valer"}, "edited": false, "score": 0, "creation_date": 1616069379, "post_id": 52106160, "comment_id": 117890845, "body": "Performance is greatly sacrificed with 1 byte reads, not ideal in the general case."}], "tags": [], "owner": {"reputation": 380, "user_id": 2562707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/144239114cfd238694964d1d4a75666c?s=128&d=identicon&r=PG", "display_name": "Joshua Kolden", "link": "https://stackoverflow.com/users/2562707/joshua-kolden"}, "is_accepted": false, "score": 0, "last_activity_date": 1535668113, "creation_date": 1535668113, "answer_id": 52106160, "question_id": 47586404, "link": "https://stackoverflow.com/questions/47586404/how-to-set-timeout-in-os-file-io-read-in-golang/52106160#52106160", "title": "How to set timeout in *os.File/io.Read in golang", "body": "<p>In addition to @apxp's point about looping over Read, you could use a buffer size of 1 byte so that you never block as long is there is data to read.</p>\n\n<p>When interacting with external resources anything can happen.  It is possible for any given io.Reader implementation to simply block forever. Here, I'll write one for you...</p>\n\n<pre><code>type BlockingReader struct{}\n\nfunc (BlockingReader) Read(b []byte) (int, error) {\n    &lt;-make(chan struct{})\n    return 0, nil\n}\n</code></pre>\n\n<p>Remember anyone can implement an interface, so you can't make any assumptions that it will behave like <code>*os.File</code> or any other standard library <code>io.Reader</code>. In addition to asinine coding like mine above, an <code>io.Reader</code> could legitimately connect to a resources that can block forever.</p>\n\n<p>You cannot kill gorountines, so if an io.Reader truly blocks forever the blocked goroutine will continue to consume resources until your application terminates. However, this shouldn't be a problem, a blocked goroutine does not consume much in the way of resources, and should be fine as long as you don't blindly retry blocked Reads by spawning more gorountines.</p>\n"}, {"tags": [], "owner": {"reputation": 183, "user_id": 3314207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c01c79b4b34a6e1f7c126bb94eb0a365?s=128&d=identicon&r=PG&f=1", "display_name": "misterwilliam", "link": "https://stackoverflow.com/users/3314207/misterwilliam"}, "is_accepted": false, "score": 1, "last_activity_date": 1545440985, "creation_date": 1545440985, "answer_id": 53892327, "question_id": 47586404, "link": "https://stackoverflow.com/questions/47586404/how-to-set-timeout-in-os-file-io-read-in-golang/53892327#53892327", "title": "How to set timeout in *os.File/io.Read in golang", "body": "<p>Instead of setting a timeout directly on the <code>read</code>, you can <code>close</code> the <code>os.File</code> after a timeout. As written in <a href=\"https://golang.org/pkg/os/#File.Close\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/#File.Close</a></p>\n\n<blockquote>\n  <p>Close closes the File, rendering it unusable for I/O. On files that support SetDeadline, any pending I/O operations will be canceled and return immediately with an error.</p>\n</blockquote>\n\n<p>This should cause your <code>read</code> to fail immediately.</p>\n"}], "owner": {"reputation": 1161, "user_id": 3917295, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/BFoJm.jpg?s=128&g=1", "display_name": "vinllen", "link": "https://stackoverflow.com/users/3917295/vinllen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7025, "favorite_count": 2, "answer_count": 3, "score": 9, "last_activity_date": 1545440985, "creation_date": 1512100418, "last_edit_date": 1512101534, "question_id": 47586404, "link": "https://stackoverflow.com/questions/47586404/how-to-set-timeout-in-os-file-io-read-in-golang", "title": "How to set timeout in *os.File/io.Read in golang", "body": "<p>I know there is a function called <code>SetReadDeadline</code> that can set a timeout in socket(conn.net) reading, while io.Read not. There is a way that starts another routine as a timer to solve this problem, but it brings another problem that the reader routine(io.Read) still block:</p>\n\n<pre><code>func (self *TimeoutReader) Read(buf []byte) (n int, err error) { \n    ch := make(chan bool) \n    n = 0 \n    err = nil \n    go func() { // this goroutime still exist even when timeout\n            n, err = self.reader.Read(buf) \n            ch &lt;- true \n    }() \n    select { \n    case &lt;-ch: \n            return \n    case &lt;-time.After(self.timeout): \n            return 0, errors.New(\"Timeout\") \n    } \n    return \n} \n</code></pre>\n\n<p>This question is similar in this <a href=\"https://groups.google.com/forum/#!msg/golang-nuts/Hmjf5Ws8g5w/cbj6JyaCpKMJ\" rel=\"noreferrer\">post</a>, but the answer is unclear.\nDo you guys have any good idea to solve this problem?</p>\n"}, {"tags": ["json", "go", "marshalling", "unmarshalling"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512097101, "post_id": 47585926, "comment_id": 82129631, "body": "Check the error returned from json.Unmarshal. Show the declaration of <code>instances</code>."}, {"owner": {"reputation": 853, "user_id": 4963334, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/35454f0f8a31948bbdaccefdc8dd1f6c?s=128&d=identicon&r=PG&f=1", "display_name": "immrsteel", "link": "https://stackoverflow.com/users/4963334/immrsteel"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512097341, "post_id": 47585926, "comment_id": 82129688, "body": "@ Cerise Lim&#243;n instances := make([]Instance, 0)"}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 0, "creation_date": 1512097954, "post_id": 47585926, "comment_id": 82129847, "body": "Your JSON response data is not valid JSON..."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1512098150, "last_edit_date": 1512098150, "creation_date": 1512097848, "answer_id": 47586077, "question_id": 47585926, "link": "https://stackoverflow.com/questions/47585926/golang-json-marshalling/47586077#47586077", "title": "Golang Json marshalling", "body": "<p>The structs do not match the structure of the data.  Perhaps you wanted this:</p>\n\n<pre><code>type Status struct {\n    Slug string `json:\"slug\"`\n}\n\ntype Instance struct {\n    Slug string `json:\"slug\"`\n    Stat Status `json:\"status\"`\n}\n</code></pre>\n\n<p>Output: [{instances_raw {up}} {instance_raw2 {down}}]</p>\n\n<p><kbd><a href=\"https://play.golang.org/p/cidI12cen0\" rel=\"nofollow noreferrer\">run it on the plaground</a></kbd></p>\n\n<p>or this:</p>\n\n<pre><code>type Instance struct {\n    Slug string `json:\"slug\"`\n    Stat map[string]interface{} `json:\"status\"`\n}\n</code></pre>\n\n<p>Output: [{instances_raw map[label: dead:true slug:up stop:false traffic:true]} {instance_raw2 map[slug:down stop:false traffic:true label: dead:true]}]</p>\n\n<p><kbd><a href=\"https://play.golang.org/p/AQEOURYatO\" rel=\"nofollow noreferrer\">run it on the playground</a></kbd></p>\n\n<p>Always check errors. The example JSON above is not valid and the json.Unmarshal function reports this error.</p>\n"}], "owner": {"reputation": 853, "user_id": 4963334, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/35454f0f8a31948bbdaccefdc8dd1f6c?s=128&d=identicon&r=PG&f=1", "display_name": "immrsteel", "link": "https://stackoverflow.com/users/4963334/immrsteel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 257, "favorite_count": 0, "accepted_answer_id": 47586077, "answer_count": 1, "score": -1, "last_activity_date": 1512098150, "creation_date": 1512096613, "last_edit_date": 1512097298, "question_id": 47585926, "link": "https://stackoverflow.com/questions/47585926/golang-json-marshalling", "title": "Golang Json marshalling", "body": "<pre><code>type Status struct {\n slug  string  `json:\"slug\"` \n}\n\ntype Instance struct {\n  Slug   string                   `json:\"slug\"`\n  Stat   map[string]*Status       `json:\"status\"`\n }\n</code></pre>\n\n<p><strong>This Json response is recieved for API call:</strong></p>\n\n<pre><code>    [ {\n    \"status\": {\n      \"stop\": false,\n      \"traffic\": true,\n      \"label\": null,\n      \"dead\": true,\n      \"slug\": \"up\",\n    }, \n    \"slug\": \"instances_raw\",\n    \"started_at\": \"15120736198\",\n    \"replacement\": null\n    },\n\n    {\n    \"status\": {\n      \"stop\": false,\n      \"traffic\": true,\n      \"label\": null,\n      \"dead\": true,\n      \"slug\": \"down\",\n     },\n    \"slug\": \"instance_raw2\",\n    \"started_at\": \"1512073194\",\n    \"replacement\": null\n   }\n  ]\n</code></pre>\n\n<p>I am trying to marshall json into above struct but running into issue:</p>\n\n<pre><code>instances := make([]Instance, 0)\nres := api call return above json\nbody, _ := ioutil.ReadAll(res.Body)\njson.Unmarshal(body, &amp;instances)\nfmt.Println(\"I am struct %s\",instances)\n</code></pre>\n\n<p>It is marshalling into:</p>\n\n<pre><code>I am struct %s [{ map[stop:0xc42018e1b0 dead:0xc42018e1e0 label:&lt;nil&gt; running:0xc42018e220 down:0xc42018e150 traffic:0xc42018e180]}]\n</code></pre>\n\n<p><em>Can someone help me figure out why it is not marshalling as I am expecting?</em></p>\n\n<p><strong>Expected marshalling:</strong></p>\n\n<pre><code>[{instances_raw map[slug:up]} {instances_raw2 map[slug:down]}] \n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 28120, "user_id": 492773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4c30dea4ed3e1c2efc5e877f1f3c971?s=128&d=identicon&r=PG", "display_name": "kichik", "link": "https://stackoverflow.com/users/492773/kichik"}, "edited": false, "score": 2, "creation_date": 1512095009, "post_id": 47585712, "comment_id": 82129121, "body": "Maybe <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">cgo</a> can help."}, {"owner": {"reputation": 155397, "user_id": 978917, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/92d059913eace78a868a3e87f98e0a57?s=128&d=identicon&r=PG", "display_name": "ruakh", "link": "https://stackoverflow.com/users/978917/ruakh"}, "reply_to_user": {"reputation": 28120, "user_id": 492773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4c30dea4ed3e1c2efc5e877f1f3c971?s=128&d=identicon&r=PG", "display_name": "kichik", "link": "https://stackoverflow.com/users/492773/kichik"}, "edited": false, "score": 2, "creation_date": 1512096741, "post_id": 47585712, "comment_id": 82129538, "body": "@kichik: It appears from the question that the OP is already using cgo."}], "answers": [{"tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": false, "score": 1, "last_activity_date": 1512097921, "creation_date": 1512097921, "answer_id": 47586092, "question_id": 47585712, "link": "https://stackoverflow.com/questions/47585712/read-a-binary-file-written-by-c-in-go/47586092#47586092", "title": "Read a binary file written by C in Go", "body": "<p>Read them using the <code>encoding/binary</code> package that you can find at <a href=\"https://golang.org/pkg/encoding/binary/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/binary/</a></p>\n\n<p>You can use <code>binary.Read</code> to read into a Go struct. You'll need to account for the padding the C version will add. In your example, default padding would put 2 pad bytes before <code>createTime</code>.</p>\n"}], "owner": {"reputation": 11839, "user_id": 730346, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/86187a52f1e2f64890194d0451748ce5?s=128&d=identicon&r=PG", "display_name": "Daniel YC Lin", "link": "https://stackoverflow.com/users/730346/daniel-yc-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 711, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1512097921, "creation_date": 1512094837, "last_edit_date": 1512096698, "question_id": 47585712, "link": "https://stackoverflow.com/questions/47585712/read-a-binary-file-written-by-c-in-go", "title": "Read a binary file written by C in Go", "body": "<p>What's the proper way to reading a binary file written by C?\nI've a C header file, there are some 'struct's.\nIs it possible to use these header file instead of manual re-write them in Go.</p>\n\n<pre><code>/* sample.h */\n#define HEADER_SIZE 2048 //* large then sizeof(header)\ntypedef struct {\n    uint8_t version;\n    uint8_t endian;\n    uint32_t createTime;\n} header;\n\ntypedef struct {\n    uint64_t data1;\n    uint32_t data2;\n    char name[128];\n} record;\n</code></pre>\n\n<p>Here is my starting Go program with pseudo code</p>\n\n<pre><code>package \"main\"\n// #include \"sample.h\"\nimport \"C\"\nfunc main() {\n  f, _ := os.Open(\"sample_file\")\n  // read(buf, HEADER_SIZE) and print out\n  // use structure header to decode the buf\n  // while not end of file {\n  //    read(buf, sizeof(record) and print out\n  // }\n}\n</code></pre>\n"}, {"tags": ["sockets", "go", "tcp"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1512092613, "post_id": 47585244, "comment_id": 82128549, "body": "TCP works the same regardless of language. It\u2019s up to you to properly handle the message boundaries."}, {"owner": {"reputation": 974, "user_id": 5736835, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a20959e2ab8649b47ccdf9a97e5d8422?s=128&d=identicon&r=PG&f=1", "display_name": "WDUK", "link": "https://stackoverflow.com/users/5736835/wduk"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1512093369, "post_id": 47585244, "comment_id": 82128747, "body": "So why do all the examples use Read(someBuffer) since it doesn&#39;t even handle such things? When would Read ever be used if you can&#39;t tell it the boundaries? I can&#39;t find examples of how to actually do it correctly."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1512094207, "post_id": 47585244, "comment_id": 82128940, "body": "I don\u2019t understand, how else would you read from a TCP connection? That\u2019s how TCP works, it\u2019s a stream protocol and there is simply no concept of messages. If you need message envelopes of some sort you use a higher level protocol."}, {"owner": {"reputation": 974, "user_id": 5736835, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a20959e2ab8649b47ccdf9a97e5d8422?s=128&d=identicon&r=PG&f=1", "display_name": "WDUK", "link": "https://stackoverflow.com/users/5736835/wduk"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1512095034, "post_id": 47585244, "comment_id": 82129130, "body": "Because it is passing live game data over a socket. I need a two way channel which http doesn&#39;t give. TCP socket seems like the only thing for it. So i don&#39;t know why TCP would be a bad choice for putting messages in it ? What else is there?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1512095262, "post_id": 47585244, "comment_id": 82129186, "body": "TCP isn&#39;t a bad choice, you just have to handle the message framing in the higher level protocol, because it&#39;s not part of TCP. You&#39;ve already defined a primitive protocol here, you have length prefixed messages, so use that rather than guessing. Maybe part of the misunderstanding is that you have Read returning &quot;messageSize&quot;, but that&#39;s not a message size, its simply the number of bytes read, which may be more or less than expected. (though it will probably match giving your limited payload size)"}, {"owner": {"reputation": 974, "user_id": 5736835, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a20959e2ab8649b47ccdf9a97e5d8422?s=128&d=identicon&r=PG&f=1", "display_name": "WDUK", "link": "https://stackoverflow.com/users/5736835/wduk"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1512095365, "post_id": 47585244, "comment_id": 82129211, "body": "Well due to the infrequency of the messages, Read seems to return a message size and is writing the full message to the buffer. But i don&#39;t know how - i think i&#39;m getting lucky due to it reading End Of File. But there is no other method for Conn to read incoming messages so am a bit confused how to read the data with my current primitive protocol."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1512095616, "post_id": 47585244, "comment_id": 82129271, "body": "This is because <code>Read</code> is the basic primitive method for receiving data, basically equivalent to <code>recv</code> on a socket. Yes, you&#39;re getting lucky because of the small message size, regardless you should strictly follow your protocol just like you would in any language. I see what you&#39;re looking for now. I&#39;ll post an answer on how to read your proposed protocol."}], "answers": [{"comments": [{"owner": {"reputation": 974, "user_id": 5736835, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a20959e2ab8649b47ccdf9a97e5d8422?s=128&d=identicon&r=PG&f=1", "display_name": "WDUK", "link": "https://stackoverflow.com/users/5736835/wduk"}, "edited": false, "score": 0, "creation_date": 1512099197, "post_id": 47585913, "comment_id": 82130108, "body": "Ah nice that looks like what i was looking for! Thank you :)"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 19, "last_activity_date": 1512096502, "creation_date": 1512096502, "answer_id": 47585913, "question_id": 47585244, "link": "https://stackoverflow.com/questions/47585244/whats-the-correct-way-to-use-net-conn-read-for-persistant-tcp-sockets/47585913#47585913", "title": "Whats the correct way to use net.Conn.Read for persistant TCP sockets", "body": "<p>TCP doesn't provide any message framing, it's up to you to buffer the stream and parse the messages according to whatever protocol you've defined. </p>\n\n<p>When parsing a TCP stream, it's often useful to immediately wrap the connection in a <a href=\"https://golang.org/pkg/bufio/#Reader\" rel=\"noreferrer\"><code>bufio.Reader</code></a>, as not only can it make reading more efficient, but it provides you with more useful methods. An example of how you could parse your protocol could be:</p>\n\n<pre><code>buff := make([]byte, 50)\nc := bufio.NewReader(conn)\n\nfor {\n    // read a single byte which contains the message length\n    size, err := c.ReadByte()\n    if err != nil {\n        return err\n    }\n\n    // read the full message, or return an error\n    _, err := io.ReadFull(c, buff[:int(size)])\n    if err != nil {\n        return err\n    }\n\n    fmt.Printf(\"received %x\\n\", buff[:int(size)])\n}\n</code></pre>\n"}], "owner": {"reputation": 974, "user_id": 5736835, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a20959e2ab8649b47ccdf9a97e5d8422?s=128&d=identicon&r=PG&f=1", "display_name": "WDUK", "link": "https://stackoverflow.com/users/5736835/wduk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7625, "favorite_count": 3, "accepted_answer_id": 47585913, "answer_count": 1, "score": 5, "last_activity_date": 1512096502, "creation_date": 1512091138, "question_id": 47585244, "link": "https://stackoverflow.com/questions/47585244/whats-the-correct-way-to-use-net-conn-read-for-persistant-tcp-sockets", "title": "Whats the correct way to use net.Conn.Read for persistant TCP sockets", "body": "<p>I have a working TCP socket setup on my Go server. I accept an incoming connection, run a for loop and read incoming data using the net.Conn.Read function.</p>\n\n<p>But it just doesn't make sense to me. How does it know the full message has been received in order to continue with a return of message size?</p>\n\n<p>This is my code currently:</p>\n\n<pre><code> func (tcpSocket *TCPServer) HandleConnection(conn net.Conn) {\n\n    println(\"Handling connection! \", conn.RemoteAddr().String(), \" connected!\")    \n    recieveBuffer := make([]byte, 50) // largest message we ever get is 50 bytes\n\n    defer func() {          \n        fmt.Println(\"Closing connection for: \", conn.RemoteAddr().String())\n        conn.Close()\n    }()\n\n    for {\n        // how does it know the end of a message vs the start of a new one?\n        messageSize, err := conn.Read(recieveBuffer) \n        if err != nil {\n            return\n        }\n        if messageSize &gt; 0 { // update keep alive since we got a message\n            conn.SetReadDeadline(time.Now().Add(time.Second * 5))    \n        }\n    }\n}\n</code></pre>\n\n<p>Lets say my application sends a message which is 6 bytes long (could be any size). How does <code>conn.Read</code> know when its received the end of said message to then continue?</p>\n\n<p>My experience mainly lies in C#, so Go is but unusual here. For my C# application the messages have the size of the message contained in first byte, then i use a for loop to read the remaining bytes up to message size. </p>\n\n<p>Yet the above code in Go seems to get the full message and continues - it some how automatically knows the size of my message?</p>\n\n<p>I am really confused how this is happening or if its just working by luck when i'm actually approaching it wrong. </p>\n\n<p>All my messages have the header in the first byte stating the size of the message. But it seems i don't need it on a Go server, am i misunderstanding how this works?</p>\n"}, {"tags": ["http", "go", "http-headers", "mime"], "comments": [{"owner": {"reputation": 36566, "user_id": 2341603, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ZTHIr.jpg?s=128&g=1", "display_name": "Obsidian Age", "link": "https://stackoverflow.com/users/2341603/obsidian-age"}, "edited": false, "score": 0, "creation_date": 1512089732, "post_id": 47585037, "comment_id": 82127808, "body": "You&#39;d need to set the header while <b>processing</b> the <code>.zip</code> on the server."}, {"owner": {"reputation": 415, "user_id": 5319281, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/22148896d125fa2c7357852622e2911d?s=128&d=identicon&r=PG&f=1", "display_name": "AppTest", "link": "https://stackoverflow.com/users/5319281/apptest"}, "reply_to_user": {"reputation": 36566, "user_id": 2341603, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ZTHIr.jpg?s=128&g=1", "display_name": "Obsidian Age", "link": "https://stackoverflow.com/users/2341603/obsidian-age"}, "edited": false, "score": 0, "creation_date": 1512089873, "post_id": 47585037, "comment_id": 82127847, "body": "Is there anyway to do this if I don&#39;t have access to the server?"}, {"owner": {"reputation": 36566, "user_id": 2341603, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ZTHIr.jpg?s=128&g=1", "display_name": "Obsidian Age", "link": "https://stackoverflow.com/users/2341603/obsidian-age"}, "edited": false, "score": 0, "creation_date": 1512090178, "post_id": 47585037, "comment_id": 82127927, "body": "Unfortunately not; the mime must be set server-side."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1512095752, "post_id": 47585037, "comment_id": 82129302, "body": "This problem is unrelated to the value of the Content-Type response header."}], "answers": [{"comments": [{"owner": {"reputation": 415, "user_id": 5319281, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/22148896d125fa2c7357852622e2911d?s=128&d=identicon&r=PG&f=1", "display_name": "AppTest", "link": "https://stackoverflow.com/users/5319281/apptest"}, "edited": false, "score": 0, "creation_date": 1512092046, "post_id": 47585191, "comment_id": 82128398, "body": "Thank you, that works great. Whats the reason for the difference when writing in server response format? Is it something to do with the write docs saying &quot;Header, values for non-canonical keys will have unpredictable behavior&quot;?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 415, "user_id": 5319281, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/22148896d125fa2c7357852622e2911d?s=128&d=identicon&r=PG&f=1", "display_name": "AppTest", "link": "https://stackoverflow.com/users/5319281/apptest"}, "edited": false, "score": 0, "creation_date": 1512095463, "post_id": 47585191, "comment_id": 82129236, "body": "An HTTP response has a status line, headers, blank line and the body (possibly in some encoding).  The zip file is the body.  If you are not fammilar with the HTTP protcool, then page <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Messages\" rel=\"nofollow noreferrer\">developer.mozilla.org/en-US/docs/Web/HTTP/Messages</a> might be helpful ."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1512090752, "creation_date": 1512090752, "answer_id": 47585191, "question_id": 47585037, "link": "https://stackoverflow.com/questions/47585037/zip-cant-be-opened-with-go-because-of-incorrect-mime-from-server/47585191#47585191", "title": "Zip can&#39;t be opened with Go because of incorrect mime from server", "body": "<p>The <a href=\"https://godoc.org/net/http#Response.Write\" rel=\"nofollow noreferrer\">Response.Write</a> method writes the response in server response format to the argument.  That's not what you want.</p>\n\n<p>Use <a href=\"https://godoc.org/io#Copy\" rel=\"nofollow noreferrer\">io.Copy</a> to copy the response body to the file:</p>\n\n<pre><code>func GetZipFromServer(zipname string) {\n    file, err := os.Open(zipname + \".zip\")\n    log1.Check(err, \"File open failed\")\n    defer file.Close()\n\n    stat, err := file.Stat()\n    log1.Check(err, \"Stat failed\")\n\n    fmt.Println(stat.Size())\n\n    url := \"http://some_server123.com/rest/\"\n    res, err := http.Post(url, \"application/zip\", file)\n    log1.Check(err, \"Response failed\")\n\n    defer resp.Body.Close()\n\n    f, err := os.Create(zipname + \".html.zip\")\n    log1.Check(err, \"Cannot create file\")\n\n    _, err := io.Copy(f, resp.Body)\n    log1.Check(err, \"Cannot write file\")\n\n    err = f.Close()\n    log1.Check(err, \"Cannot close file\")\n}\n</code></pre>\n\n<p>Also, close the response body.</p>\n"}], "owner": {"reputation": 415, "user_id": 5319281, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/22148896d125fa2c7357852622e2911d?s=128&d=identicon&r=PG&f=1", "display_name": "AppTest", "link": "https://stackoverflow.com/users/5319281/apptest"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 250, "favorite_count": 0, "accepted_answer_id": 47585191, "answer_count": 1, "score": 1, "last_activity_date": 1512092291, "creation_date": 1512089529, "last_edit_date": 1512092291, "question_id": 47585037, "link": "https://stackoverflow.com/questions/47585037/zip-cant-be-opened-with-go-because-of-incorrect-mime-from-server", "title": "Zip can&#39;t be opened with Go because of incorrect mime from server", "body": "<p>I have an application that sends a zip file to a server. The zip is then manipulated and a new zip is send back in the response.</p>\n\n<p>The problem is that the response sent back has a mime of <code>application/octet-stream</code> instead of <code>application/zip</code> message. </p>\n\n<p>I think this is the reason why the resulting zip can't be opened by <code>archive/zip</code> and I get a <code>zip: not a valid zip file</code>. </p>\n\n<p>Is there any way for me to change the mime when retrieving the zip file? </p>\n\n<p>My code for getting the zip:</p>\n\n<pre><code>func GetZipFromServer(zipname string) {\n\n    ////////////////////////////////////////////////////\n    // Open local zip file\n\n    file, err := os.Open(zipname + \".zip\")\n    log1.Check(err, \"File open failed\")\n    defer file.Close()\n\n    stat, err := file.Stat()\n    log1.Check(err, \"Stat failed\")\n\n    fmt.Println(stat.Size())\n\n    ////////////////////////////////////////////////////\n    // Get new zip from server\n\n    url := \"http://some_server123.com/rest/\"\n    res, err := http.Post(url, \"application/zip\", file)\n    log1.Check(err, \"Response failed\")\n\n    ////////////////////////////////////////////////////\n    // Save new zip from server as file\n\n    f, err := os.Create(zipname + \".html.zip\")\n    log1.Check(err, \"Cannot create file\")\n\n    err = res.Write(f)\n    log1.Check(err, \"Cannot write file\")\n\n    err = f.Close()\n    log1.Check(err, \"Cannot close file\")\n}\n</code></pre>\n"}]