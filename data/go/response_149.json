[{"tags": ["xml", "go"], "answers": [{"comments": [{"owner": {"reputation": 2066, "user_id": 6363050, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f9db389fc3801b8ecef05ed3074e2f03?s=128&d=identicon&r=PG&f=1", "display_name": "Samuel Dare", "link": "https://stackoverflow.com/users/6363050/samuel-dare"}, "edited": false, "score": 0, "creation_date": 1510787278, "post_id": 47318811, "comment_id": 81588858, "body": "Thanks ..now it return `&lt;nil&gt; will add a snippet of the xml file"}], "tags": [], "owner": {"reputation": 136, "user_id": 5665152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26a2e119f11fb353b9a36e69ed9f6208?s=128&d=identicon&r=PG&f=1", "display_name": "Virre", "link": "https://stackoverflow.com/users/5665152/virre"}, "is_accepted": false, "score": -1, "last_activity_date": 1510787020, "creation_date": 1510787020, "answer_id": 47318811, "question_id": 47318602, "link": "https://stackoverflow.com/questions/47318602/reading-xml-file-line-by-line/47318811#47318811", "title": "Reading XML file line by line", "body": "<p>From my limited knowledge your assignment needs to be a pointer so try\n Accounts *AccountUser instead of Accounts AccountUser</p>\n\n<p>You might want to supply the XML so it is easier for others to understand and show examples with.</p>\n"}, {"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1510823571, "post_id": 47320873, "comment_id": 81601874, "body": "@Data_Kid, note that you must never ever assume anything about the insignificant white space (such as like breaks) in the XML documents you process! That may break anytime due to updating or reconfiguring of the software which generates them."}], "tags": [], "owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "is_accepted": true, "score": 2, "last_activity_date": 1510801898, "last_edit_date": 1510801898, "creation_date": 1510801414, "answer_id": 47320873, "question_id": 47318602, "link": "https://stackoverflow.com/questions/47318602/reading-xml-file-line-by-line/47320873#47320873", "title": "Reading XML file line by line", "body": "<p>There are some problems with your code  : </p>\n\n<p>First is your <code>xml</code> file is not correct the correct xml file must contains parent xml like <code>&lt;Data&gt; //Yourdata here &lt;/Data&gt;</code> it must be look like this : </p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n&lt;Data&gt;\n    &lt;Results&gt;\n        &lt;Client&gt;\n            &lt;ID&gt;72rere341&lt;/ID&gt;\n        &lt;/Client&gt;\n        &lt;PartnerKey xsi:nil=\"true\" /&gt;\n        &lt;PartnerProperties&gt;\n            &lt;Name&gt;email&lt;/Name&gt;\n            &lt;Value&gt;example1@test1.com&lt;/Value&gt;\n        &lt;/PartnerProperties&gt;\n        &lt;ID&gt;755454475&lt;/ID&gt;\n        &lt;ObjectID xsi:nil=\"true\" /&gt;\n        &lt;UserID&gt;5fd0acfc-6crerfrgrfe6e9a675f65&lt;/UserID&gt;\n        &lt;ActiveFlag&gt;true&lt;/ActiveFlag&gt;\n        &lt;Delete&gt;0&lt;/Delete&gt;\n        &lt;LastSuccessfulLogin&gt;2014-11-07T16:00:46.747&lt;/LastSuccessfulLogin&gt;\n    &lt;/Results&gt;\n    &lt;Results&gt;\n        &lt;Client&gt;\n            &lt;ID&gt;72rere5341&lt;/ID&gt;\n        &lt;/Client&gt;\n        &lt;PartnerKey xsi:nil=\"true\" /&gt;\n        &lt;PartnerProperties&gt;\n            &lt;Name&gt;email&lt;/Name&gt;\n            &lt;Value&gt;example2@test1.com&lt;/Value&gt;\n        &lt;/PartnerProperties&gt;\n        &lt;ID&gt;7225483&lt;/ID&gt;\n        &lt;ObjectID xsi:nil=\"true\" /&gt;\n        &lt;UserID&gt;example2@test1.com&lt;/UserID&gt;\n        &lt;ActiveFlag&gt;false&lt;/ActiveFlag&gt;\n        &lt;Delete&gt;0&lt;/Delete&gt;\n        &lt;LastSuccessfulLogin&gt;2015-04-29T05:01:27.85&lt;/LastSuccessfulLogin&gt;\n    &lt;/Results&gt;\n&lt;/Data&gt;\n</code></pre>\n\n<p>Second your struct <code>AccountUser</code> has a method:</p>\n\n<pre><code>func (a AccountUser) String() string {\n    return fmt.Sprintf(\"%s - %s - %s\", a.ParentMID, a.EmailAddress, a.UserID)\n}\n</code></pre>\n\n<p>To fix your problem fix the your xml file, and make your <code>String()</code> method like this : </p>\n\n<pre><code>func (a *AccountUser) String() string {\n    return \"\"\n}\n</code></pre>\n\n<p>And here is the working code that I have tried with the above xml file : </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"os\"\n)\n\ntype AccountUser struct {\n    UserID              string\n    ActiveFlag          string\n    LastSuccessfulLogin string\n    PartnerProperties   Partner `xml:\"PartnerProperties\"`\n}\n\ntype Partner struct {\n    Name  string\n    Value string\n}\n\ntype Query struct {\n    ResultList []AccountUser `xml:\"Results\"`\n}\n\nfunc (a *AccountUser) String() string {\n    return fmt.Sprintf(\"%s - %s - %s\", a.PartnerProperties.Name, a.PartnerProperties.Value, a.UserID)\n}\n\nfunc main() {\n    xmlFile, err := os.Open(\"read.xml\")\n    if err != nil {\n        fmt.Println(\"Error opening file:\", err)\n        return\n    }\n    defer xmlFile.Close()\n\n    b, err := ioutil.ReadAll(xmlFile)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(\"read result = \", string(b))\n\n    var q Query\n    err = xml.Unmarshal(b, &amp;q)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(q.ResultList[0].String())\n}\n</code></pre>\n"}], "owner": {"reputation": 2066, "user_id": 6363050, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f9db389fc3801b8ecef05ed3074e2f03?s=128&d=identicon&r=PG&f=1", "display_name": "Samuel Dare", "link": "https://stackoverflow.com/users/6363050/samuel-dare"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 942, "favorite_count": 0, "accepted_answer_id": 47320873, "answer_count": 2, "score": 2, "last_activity_date": 1510801898, "creation_date": 1510785829, "last_edit_date": 1510788033, "question_id": 47318602, "link": "https://stackoverflow.com/questions/47318602/reading-xml-file-line-by-line", "title": "Reading XML file line by line", "body": "<p>I am new to go and trying to write a script to parse multiple soap responses.</p>\n\n<p>Here is a snippet of the xml snippet of the xml I am trying to parse. Its a  full SOAP response but I have just included that tags I wish to parse</p>\n\n<pre><code>            &lt;Results xsi:type=\"AccountUser\"&gt;\n                &lt;Client&gt;\n                    &lt;ID&gt;72rere341&lt;/ID&gt;\n                &lt;/Client&gt;\n                &lt;PartnerKey xsi:nil=\"true\" /&gt;\n                &lt;PartnerProperties&gt;\n                    &lt;Name&gt;email&lt;/Name&gt;\n                    &lt;Value&gt;example1@test1.com&lt;/Value&gt;\n                &lt;/PartnerProperties&gt;\n                &lt;ID&gt;755454475&lt;/ID&gt;\n                &lt;ObjectID xsi:nil=\"true\" /&gt;\n                &lt;UserID&gt;5fd0acfc-6crerfrgrfe6e9a675f65&lt;/UserID&gt;\n                &lt;ActiveFlag&gt;true&lt;/ActiveFlag&gt;\n                &lt;Delete&gt;0&lt;/Delete&gt;\n                &lt;LastSuccessfulLogin&gt;2014-11-07T16:00:46.747&lt;/LastSuccessfulLogin&gt;\n            &lt;/Results&gt;\n            &lt;Results xsi:type=\"AccountUser\"&gt;\n                &lt;Client&gt;\n                    &lt;ID&gt;72rere5341&lt;/ID&gt;\n                &lt;/Client&gt;\n                &lt;PartnerKey xsi:nil=\"true\" /&gt;\n                &lt;PartnerProperties&gt;\n                    &lt;Name&gt;email&lt;/Name&gt;\n                    &lt;Value&gt;example2@test1.com&lt;/Value&gt;\n                &lt;/PartnerProperties&gt;\n                &lt;ID&gt;7225483&lt;/ID&gt;\n                &lt;ObjectID xsi:nil=\"true\" /&gt;\n                &lt;UserID&gt;example2@test1.com&lt;/UserID&gt;\n                &lt;ActiveFlag&gt;false&lt;/ActiveFlag&gt;\n                &lt;Delete&gt;0&lt;/Delete&gt;\n                &lt;LastSuccessfulLogin&gt;2015-04-29T05:01:27.85&lt;/LastSuccessfulLogin&gt;\n            &lt;/Results&gt;\n</code></pre>\n\n<p>I would like to print each <code>result</code> on a new line.</p>\n\n<p>Here is a snippet of my code:</p>\n\n<pre><code>package main \n\n\nimport (\n\n    \"os\"\n    \"fmt\"\n    \"encoding/xml\"\n    \"io/ioutil\"\n\n)\n\ntype AccountUser struct {\n\n\n    ParentMID string `xml:\"Client&gt;ID\"`\n    EmailAddress string `xml:\"PartnerProperties&gt;Value\"`\n    BuinessUnit string `xml:\"ID\"`\n    UserID string `xml:\"UserID\"`\n    Active string`xml:\"ActiveFlag\"`\n    LastSucessfulLogin string`xml:\"LastSucessfulLogin\"`\n\n}\n\ntype Email struct {\n\n    Email string `xml:\"PartnerProperties&gt;Value\"`\n}\n\n\ntype Query struct {\n    Accounts AccountUser\n    AccountList []Email `xml:\"PartnerProperties&gt;Value\"`\n}\n\nfunc (a AccountUser) String() string {\n    return fmt.Sprintf(\"%s - %s - %s\", a.ParentMID, a.EmailAddress, a.UserID)\n}\n\n\nfunc main() {\n    xmlFile, err := os.Open(\"Results.xml\")\n    if err != nil {\n        fmt.Println(\"Error opening file:\", err)\n        return\n    }\n    defer xmlFile.Close()\n\n    b, _ := ioutil.ReadAll(xmlFile)\n\n    var q Query\n    xml.Unmarshal(b, &amp;q)\n\n    fmt.Println(q.Accounts)\n    for _, account := range q.AccountList {\n        fmt.Printf(\"\\t%s\\n\", account)\n    }\n}\n</code></pre>\n\n<p>When I run this in terminal, It returns nothing\nie. </p>\n\n<pre><code>-     - //just the string in the function\n</code></pre>\n\n<p>I would love pointers on how I can resolve this. </p>\n"}, {"tags": ["gcc", "go", "ld", "nettle"], "answers": [{"comments": [{"owner": {"reputation": 4649, "user_id": 681679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ba1bdfa6ba08225903a74383be42b06?s=128&d=identicon&r=PG", "display_name": "photoionized", "link": "https://stackoverflow.com/users/681679/photoionized"}, "edited": false, "score": 0, "creation_date": 1510815294, "post_id": 47323361, "comment_id": 81597406, "body": "Also, the main reason that you&#39;re having to add all of these linker flags is because of the fact that you&#39;re trying to compile everything statically. Assuming you were using dynamic linking <code>go build</code> with no additional linker flags should work since shared libraries store references to their own dependencies. But, since you&#39;re using musl, I&#39;m assuming you&#39;re trying to get this completely static for ease of distribution?"}], "tags": [], "owner": {"reputation": 4649, "user_id": 681679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ba1bdfa6ba08225903a74383be42b06?s=128&d=identicon&r=PG", "display_name": "photoionized", "link": "https://stackoverflow.com/users/681679/photoionized"}, "is_accepted": true, "score": 1, "last_activity_date": 1510815460, "last_edit_date": 1510815460, "creation_date": 1510815092, "answer_id": 47323361, "question_id": 47318505, "link": "https://stackoverflow.com/questions/47318505/how-do-i-fix-an-undefined-reference-to-nettle-sha256-digest/47323361#47323361", "title": "How do I fix an undefined reference to `nettle_sha256_digest`?", "body": "<p>From the looks of it you're linking your dependent libraries in the wrong order (see <a href=\"https://stackoverflow.com/questions/45135/why-does-the-order-in-which-libraries-are-linked-sometimes-cause-errors-in-gcc\">Why does the order in which libraries are linked sometimes cause errors in GCC?</a> for more context).</p>\n\n<p>With statically linked libraries the linker attempts to resolve symbols in the order that the libraries were specified in. If a relied-upon symbol comes up as undefined then the linker looks to see if it's defined in the subsequent libraries specified. Since in your build invocation <code>-lnettle</code> is specified <strong><em>before</em></strong> <code>-lgnutls</code> the gnutls library can't resolve the symbols it needs from nettle.</p>\n\n<p>What this means is that (at minimum) you'll have to move your reference to <code>-lnettle</code> to after <code>-lgnutls</code>. Not sure this will solve all of your problems since I'm not familiar with all of the linking dependencies you have listed, but it should at least solve your current errors running <code>go build</code>.</p>\n"}], "owner": {"reputation": 1694, "user_id": 1774723, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/rKOqh.png?s=128&g=1", "display_name": "erstaples", "link": "https://stackoverflow.com/users/1774723/erstaples"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1590, "favorite_count": 0, "accepted_answer_id": 47323361, "answer_count": 1, "score": 1, "last_activity_date": 1510848838, "creation_date": 1510785327, "last_edit_date": 1510848838, "question_id": 47318505, "link": "https://stackoverflow.com/questions/47318505/how-do-i-fix-an-undefined-reference-to-nettle-sha256-digest", "title": "How do I fix an undefined reference to `nettle_sha256_digest`?", "body": "<p><strong>TL;DR</strong></p>\n\n<p>I'm attempting to build a go project that uses this dependency: <a href=\"https://github.com/mqu/openldap\" rel=\"nofollow noreferrer\">https://github.com/mqu/openldap</a>, which in turn externally links lldap and llber libraries, which in turn uses lgnutls, which uses lnettle, which is where I'm stuck.</p>\n\n<p>The <code>go build</code> produces a long list of undefined references and the build fails. Here's a sample:</p>\n\n<pre><code>/usr/lib/x86_64-linux-gnu/libgnutls.a(sha-x86-ssse3.o): In function `_ctx_init':\n(.text+0x468): undefined reference to `nettle_sha256_digest'\n/usr/lib/x86_64-linux-gnu/libgnutls.a(sha-x86-ssse3.o): In function `_ctx_init':\n(.text+0x476): undefined reference to `nettle_sha224_init'\n/usr/lib/x86_64-linux-gnu/libgnutls.a(sha-x86-ssse3.o): In function `_ctx_init':\n(.text+0x494): undefined reference to `nettle_sha256_init'\n/usr/lib/x86_64-linux-gnu/libgnutls.a(sha-x86-ssse3.o): In function `_ctx_init':\n(.text+0x4b8): undefined reference to `nettle_sha256_digest'\n/usr/lib/x86_64-linux-gnu/libgnutls.a(sha-x86-ssse3.o): In function `_ctx_init':\n(.text+0x4c6): undefined reference to `nettle_sha256_init'\n/usr/lib/x86_64-linux-gnu/libgnutls.a(sha-x86-ssse3.o):(.data.rel.ro+0x18): undefined reference to `nettle_sha256_init'\n/usr/lib/x86_64-linux-gnu/libgnutls.a(sha-x86-ssse3.o):(.data.rel.ro+0x28): undefined reference to `nettle_sha256_digest'\n/usr/lib/x86_64-linux-gnu/libgnutls.a(sha-x86-ssse3.o):(.data.rel.ro+0x58): undefined reference to `nettle_sha224_init'\n/usr/lib/x86_64-linux-gnu/libgnutls.a(sha-x86-ssse3.o):(.data.rel.ro+0x68): undefined reference to `nettle_sha224_digest'\n/usr/lib/x86_64-linux-gnu/libgnutls.a(sha-x86-ssse3.o):(.data.rel.ro+0x98): undefined reference to `nettle_sha1_init'\n/usr/lib/x86_64-linux-gnu/libgnutls.a(sha-x86-ssse3.o):(.data.rel.ro+0xa8): undefined reference to `nettle_sha1_digest'\n</code></pre>\n\n<p>And my <code>go build</code> command:</p>\n\n<pre><code>CC=/usr/local/musl/bin/musl-gcc \\\n    GOOS=linux go build \\\n    -o /bin/activedirectory \\\n    -ldflags '-linkmode external -extldflags \"-static -L/usr/lib/x86_64-linux-gnu -lnettle -lp11 -lsasl2 -lgnutls -ltasn1\"'\n</code></pre>\n\n<p>I have tried resolving this by installing <code>libnettle4</code>, <code>nettle-dev</code>, <code>libghc-nettle-dev</code>, <code>nettle-bin</code>. I have made sure to include <code>-lnettle</code> in the ldflags. No luck.</p>\n\n<p><strong>More context</strong></p>\n\n<p>The openldap library is linking the <code>ldap</code> and <code>lber</code> libs in the code:</p>\n\n<pre><code>package openldap\n\n/*\n\n#define LDAP_DEPRECATED 1\n#include &lt;stdlib.h&gt;\n#include &lt;ldap.h&gt;\n\nstatic inline char* to_charptr(const void* s) { return (char*)s; }\nstatic inline LDAPControl** to_ldapctrlptr(const void* s) {\n    return (LDAPControl**) s;\n}\n*/\n// #cgo CFLAGS: -DLDAP_DEPRECATED=1\n// #cgo linux CFLAGS: -DLINUX=1\n// #cgo LDFLAGS: -lldap -llber\n</code></pre>\n\n<p>This has required me to install and include in the ldflags all the libraries you see in my build command.</p>\n\n<p>So the dependency chain, in short, goes like this:</p>\n\n<p>lldap -> lgnutls -> lnettle. </p>\n\n<p>I added lgnutls and that resolved my gnutls dependency issues, but I'm unable to resolve my nettle depencency issues.</p>\n\n<p><strong>My question</strong></p>\n\n<p>What am I doing wrong in my attempts to fix these nettle dependency issues?</p>\n\n<p><strong>Bonus question</strong></p>\n\n<p>Is there a best practice for resolving these ld linker dependencies? Right now my flow looks like this:</p>\n\n<ol>\n<li>Run the build</li>\n<li>Watch for \"undefined reference\" errors</li>\n<li>Figure out which package is missing by googling the error or looking at the name referenced (e.g. <code>nettle_sha1_digest</code> = nettle package)</li>\n<li>Install that package</li>\n<li>Repeat</li>\n</ol>\n\n<p>I guess I'm wondering if there's a magic bullet that can install all dependencies for me? :)</p>\n"}, {"tags": ["json", "go", "data-structures"], "answers": [{"tags": [], "owner": {"reputation": 17785, "user_id": 952648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c85487802cc06d71bf6b7d739685f4bd?s=128&d=identicon&r=PG", "display_name": "tom", "link": "https://stackoverflow.com/users/952648/tom"}, "is_accepted": false, "score": 2, "last_activity_date": 1510784698, "creation_date": 1510784698, "answer_id": 47318354, "question_id": 47318201, "link": "https://stackoverflow.com/questions/47318201/how-to-initialize-values-inside-nested-json-struct-in-go/47318354#47318354", "title": "How to initialize values inside nested json struct in GO?", "body": "<p>You can either use an anonymous struct literal (which requires copy-pasting the type of <code>DataStruct</code>) or assign values to individual fields using <code>=</code>.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype ServiceStruct struct {\n    Name       string `json:\"name\"`\n    DataStruct struct {\n        ID   string `json:\"id\"`\n        Size string `json:\"size\"`\n    }\n}\n\nfunc main() {\n    s1 := ServiceStruct{\n        Name: \"foo\",\n        DataStruct: struct {\n            ID   string `json:\"id\"`\n            Size string `json:\"size\"`\n        }{\n            ID:   \"bar\",\n            Size: \"100\",\n        },\n    }\n\n    s2 := ServiceStruct{\n        Name: \"foo\",\n    }\n    s2.DataStruct.ID = \"bar\"\n    s2.DataStruct.Size = \"100\"\n\n    fmt.Println(s1)\n    fmt.Println(s2)\n\n    // Output:\n    // {foo {bar 100}}\n    // {foo {bar 100}}\n}\n</code></pre>\n\n<p>Alternatively, consider giving the type of <code>DataStruct</code> a name so you can refer to it in the struct literal instead of copy-pasting (which is not recommended).</p>\n"}, {"tags": [], "owner": {"reputation": 461, "user_id": 5253539, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-9q1xBp-smn8/AAAAAAAAAAI/AAAAAAAAAtE/49pv4N4bqSQ/photo.jpg?sz=128", "display_name": "Shawn", "link": "https://stackoverflow.com/users/5253539/shawn"}, "is_accepted": false, "score": 1, "last_activity_date": 1510784921, "creation_date": 1510784921, "answer_id": 47318415, "question_id": 47318201, "link": "https://stackoverflow.com/questions/47318201/how-to-initialize-values-inside-nested-json-struct-in-go/47318415#47318415", "title": "How to initialize values inside nested json struct in GO?", "body": "<p><a href=\"https://play.golang.org/p/GObadB9WyN\" rel=\"nofollow noreferrer\">https://play.golang.org/p/GObadB9WyN</a></p>\n\n<p>Example of passing/unmarshaling a JSON into your struct. This has been my primary use-case, I hope it is helpful.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype ServiceStruct struct {\n    Name     string `json:\"name\"`\n    DataStruct struct {\n        ID    string `json:\"id\"`\n        Size  string `json:\"size\"`\n    }\n}\n\nfunc main() {\n    x := `{\n        \"Name\": \"Fido\",\n        \"DataStruct\": {\n            \"ID\": \"Dog\",\n            \"Size\": \"Small\"\n        }\n    }`\n\n    ex := ServiceStruct{}\n    json.Unmarshal([]byte(x), &amp;ex)\n\n    fmt.Println(ex.Name)\n}\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 6278240, "user_type": "registered", "profile_image": "https://graph.facebook.com/10208570767688814/picture?type=large", "display_name": "Niraj Fonseka", "link": "https://stackoverflow.com/users/6278240/niraj-fonseka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3141, "favorite_count": 0, "closed_date": 1510785451, "answer_count": 2, "score": -1, "last_activity_date": 1510784921, "creation_date": 1510783939, "question_id": 47318201, "link": "https://stackoverflow.com/questions/47318201/how-to-initialize-values-inside-nested-json-struct-in-go", "closed_reason": "Duplicate", "title": "How to initialize values inside nested json struct in GO?", "body": "<p>I have this struct right now </p>\n\n<pre><code>type ServiceStruct struct {\n      Name     string `json:\"name\"`\n      DataStruct struct {\n          ID    string `json:\"id\"`\n          Size  string `json:\"size\"`\n     }\n}\n</code></pre>\n\n<p>But im not sure how to assign values to the elements inside this struct. Specially the DataStruct inside the ServiceStruct</p>\n"}, {"tags": ["go", "synchronization", "goroutine"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1510778341, "post_id": 47316687, "comment_id": 81584537, "body": "It seems like you&#39;d want to do that on the receiving end of the channel and not process the same event more than once."}, {"owner": {"reputation": 21, "user_id": 7692877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120f4ff7ae8880e8c586e85f3b61ceeb?s=128&d=identicon&r=PG&f=1", "display_name": "No Matter", "link": "https://stackoverflow.com/users/7692877/no-matter"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1510778842, "post_id": 47316687, "comment_id": 81584840, "body": "But how do I check if the event was already processed by another goroutine given that atm routines do not know about each other? That&#39;s the main question really."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 5, "creation_date": 1510779305, "post_id": 47316687, "comment_id": 81585096, "body": "How would you do it if it was single-threaded? This isn&#39;t about goroutines. If you want to deduplicate, you need to know whether or not a message is a duplicate. That means (potentially) storing every message you&#39;ve ever gotten and comparing every new message to every old message to see if you&#39;ve seen it before."}], "answers": [{"tags": [], "owner": {"reputation": 240, "user_id": 8800369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4f69be8fda374dc3075128df3a05f37?s=128&d=identicon&r=PG", "display_name": "Hein Oldewage", "link": "https://stackoverflow.com/users/8800369/hein-oldewage"}, "is_accepted": true, "score": 0, "last_activity_date": 1510928256, "creation_date": 1510928256, "answer_id": 47352717, "question_id": 47316687, "link": "https://stackoverflow.com/questions/47316687/goroutines-and-messages-de-duplicatioin/47352717#47352717", "title": "Goroutines and messages de-duplicatioin", "body": "<p>So you represent your current architecture as follows:</p>\n\n<p><a href=\"https://i.stack.imgur.com/uUJvf.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/uUJvf.jpg\" alt=\"Current architecture\"></a></p>\n\n<p>With this type of solution the Generators need to check a shared resource to see if an event was already emitted. This might look something like this:</p>\n\n<pre><code>var hasEmmited map[string]bool\nvar lock sync.Mutex\n\nfunc HasEmitted(event e) bool {\n   lock.Lock()\n   defer lock.Unlock()\n   e,ok := hasEmmited[e.ID]\n   return e &amp;&amp; ok\n}\n\nfunc SetEmmited(event e) {\n   lock.Lock()\n   defer lock.Lock()\n   hasEmmited[e.ID] = true\n}\n</code></pre>\n\n<p>This requires locking/unlocking, which even in the best case scenario with no contention is till a great over-head considering the small amount of work being done in the critical section. </p>\n\n<p>With a small change in the architecture, like in the second diagram, it would be possible for one go-routine to to do the filtering without any locking. </p>\n\n<p><a href=\"https://i.stack.imgur.com/zneQ8.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/zneQ8.jpg\" alt=\"A potential solution\"></a></p>\n\n<p>Some commenters have said that designing solutions using go-routines is the same as designing for single-threaded applications. I do not believe this is the case.\nI would suggest looking at:</p>\n\n<p>Golang related messaging: <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">https://blog.golang.org/pipelines</a></p>\n\n<p>Some message handling design patterns: <a href=\"http://www.enterpriseintegrationpatterns.com/\" rel=\"nofollow noreferrer\">http://www.enterpriseintegrationpatterns.com/</a></p>\n\n<p>The enterprise integration patterns might look out of place here, but it covers a lot of message passing patters that also applies in go.</p>\n"}], "owner": {"reputation": 21, "user_id": 7692877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120f4ff7ae8880e8c586e85f3b61ceeb?s=128&d=identicon&r=PG&f=1", "display_name": "No Matter", "link": "https://stackoverflow.com/users/7692877/no-matter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 275, "favorite_count": 0, "accepted_answer_id": 47352717, "answer_count": 1, "score": 0, "last_activity_date": 1510928256, "creation_date": 1510777811, "last_edit_date": 1510779329, "question_id": 47316687, "link": "https://stackoverflow.com/questions/47316687/goroutines-and-messages-de-duplicatioin", "title": "Goroutines and messages de-duplicatioin", "body": "<p>So I have some kind of event queues and several goroutines which are getting the events from their corresponding queues in an infinite loop, process them, and send results into a channel. Different queues may give you the same event, so I need to make sure that each event is sent to channel exactly once, and any occurence of that message in another queue will be ignored. I believe that's more of an architectural issue but I can't figure out how to handle this properly.</p>\n\n<p>Simplified version of my current code is below.</p>\n\n<p>Goroutines that get and handle incoming events look somewhat like this:</p>\n\n<pre><code>func (q *Queue) ProcessEvents(handler Handler) {\n   lastEvent = 0\n   for {\n       events = getEvents(lastEvent)\n       for _, e := range events {\n           if e.ID &gt; lastEvent  {\n                lastEvent = event.ID\n           }\n           handler.Handle(e)\n       }\n   }\n}\n</code></pre>\n\n<p>Handler:</p>\n\n<pre><code>type Handler struct {\n    c chan Event\n}\n\nfunc (h *Handler) Handle(event *Event) {\n    //event processing omitted\n    h.c &lt;- event //Now it just sends a processed event into the channel no matter what.\n}\n</code></pre>\n\n<p>And in main() I do</p>\n\n<pre><code>func main() {\n    msgc := make(chan Event)\n    for _, q := range queues {\n        go func(queue Queue) {\n            queue.ProcessEvents(&amp;Handler{msgc})\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1584, "user_id": 6778826, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HOfOO.jpg?s=128&g=1", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/6778826/aleksandar"}, "edited": false, "score": 0, "creation_date": 1510779493, "post_id": 47316113, "comment_id": 81585213, "body": "Thanks but now I get <code>video-convert.go:12:6: camids declared and not used</code> you can see the full code in this snipplet <a href=\"https://gitlab.com/aleks001/visit-at/snippets/1684621\" rel=\"nofollow noreferrer\">gitlab.com/aleks001/visit-at/snippets/1684621</a>"}, {"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "reply_to_user": {"reputation": 1584, "user_id": 6778826, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HOfOO.jpg?s=128&g=1", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/6778826/aleksandar"}, "edited": false, "score": 0, "creation_date": 1510780632, "post_id": 47316113, "comment_id": 81585818, "body": "Go does not allow you to declare variables and then not use them. Are you using the <code>camids</code> variable at all? <i>I can not open the link you&#39;ve provided</i>"}, {"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "reply_to_user": {"reputation": 1584, "user_id": 6778826, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HOfOO.jpg?s=128&g=1", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/6778826/aleksandar"}, "edited": false, "score": 0, "creation_date": 1510780788, "post_id": 47316113, "comment_id": 81585896, "body": "@Aleksandar the gitlab link is not working (404). Post snippet to <a href=\"https://play.golang.com\" rel=\"nofollow noreferrer\">play.golang.com</a> or <a href=\"https://gist.github.com\" rel=\"nofollow noreferrer\">gist.github.com</a>. Thanks."}, {"owner": {"reputation": 1584, "user_id": 6778826, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HOfOO.jpg?s=128&g=1", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/6778826/aleksandar"}, "edited": false, "score": 0, "creation_date": 1510781769, "post_id": 47316113, "comment_id": 81586377, "body": "Sorry for the gitlab issue. here the gist for the conf and the play for the app. Conf: <a href=\"https://gist.github.com/git001/285162deb0f89ed49ef14c89aaa396fe\" rel=\"nofollow noreferrer\">gist.github.com/git001/285162deb0f89ed49ef14c89aaa396fe</a> . APP: <a href=\"https://play.golang.com/p/X93HI2D5Hu\" rel=\"nofollow noreferrer\">play.golang.com/p/X93HI2D5Hu</a>"}, {"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "reply_to_user": {"reputation": 1584, "user_id": 6778826, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HOfOO.jpg?s=128&g=1", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/6778826/aleksandar"}, "edited": false, "score": 0, "creation_date": 1510782056, "post_id": 47316113, "comment_id": 81586529, "body": "@Aleksandar as I&#39;ve already told you. You&#39;ve declared and initialized the <code>camids</code> variable but you&#39;re <b>not using it in your code at all.</b> This is not allowed in go. If you declare a variable you <b>MUST</b> use it or the program wont compile."}, {"owner": {"reputation": 1584, "user_id": 6778826, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HOfOO.jpg?s=128&g=1", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/6778826/aleksandar"}, "edited": false, "score": 0, "creation_date": 1510783252, "post_id": 47316113, "comment_id": 81587147, "body": "Still when I remove the comment I get the same error <a href=\"https://play.golang.com/p/fDBqUGO1L4\" rel=\"nofollow noreferrer\">play.golang.com/p/fDBqUGO1L4</a>"}, {"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "reply_to_user": {"reputation": 1584, "user_id": 6778826, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HOfOO.jpg?s=128&g=1", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/6778826/aleksandar"}, "edited": false, "score": 0, "creation_date": 1510783404, "post_id": 47316113, "comment_id": 81587216, "body": "@Aleksandar why did you remove the comment?"}, {"owner": {"reputation": 1584, "user_id": 6778826, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HOfOO.jpg?s=128&g=1", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/6778826/aleksandar"}, "edited": false, "score": 0, "creation_date": 1510783723, "post_id": 47316113, "comment_id": 81587375, "body": "Because I want to define the var and then use it with viper. Is this the wrong way? I&#39;m going crazy with this stuff. Should I define a var and then use it or what&#39;s the right way?"}, {"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1510784130, "post_id": 47316113, "comment_id": 81587585, "body": "You&#39;ve completely misunderstood me on the <b>usage</b> part. I hope this <a href=\"https://play.golang.org/p/Mkc93m4MSO\" rel=\"nofollow noreferrer\">playground link</a> will clear up this misunderstanding."}, {"owner": {"reputation": 1584, "user_id": 6778826, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HOfOO.jpg?s=128&g=1", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/6778826/aleksandar"}, "reply_to_user": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1510784592, "post_id": 47316113, "comment_id": 81587807, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/159099/discussion-between-aleksandar-and-mihailo\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "is_accepted": true, "score": 3, "last_activity_date": 1510775510, "creation_date": 1510775510, "answer_id": 47316113, "question_id": 47315927, "link": "https://stackoverflow.com/questions/47315927/whats-the-right-type-for-viper/47316113#47316113", "title": "what&#39;s the right type for viper", "body": "<p>If you've declared <code>camids</code></p>\n\n<pre><code>var camids map[string]interface{}\n</code></pre>\n\n<p>above, you don't need to use <code>:=</code> since the variable <code>camids</code> has been already declared.<br>\nSo just write:</p>\n\n<pre><code>camids = viper.GetStringMap(\"cameraids\")\n</code></pre>\n\n<p><br></p>\n\n<hr>\n\n<p><code>:=</code> is used when you want to declare the variable and assigns the value to it at the same time.</p>\n\n<p><code>=</code> is used when you've already declared the variable beforehand and you're just assigning the value to it.</p>\n"}], "owner": {"reputation": 1584, "user_id": 6778826, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HOfOO.jpg?s=128&g=1", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/6778826/aleksandar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 47316113, "answer_count": 1, "score": -1, "last_activity_date": 1510775510, "creation_date": 1510774872, "question_id": 47315927, "link": "https://stackoverflow.com/questions/47315927/whats-the-right-type-for-viper", "title": "what&#39;s the right type for viper", "body": "<p>I have the following yaml file and want to iterate over the cameraids.---</p>\n\n<pre><code>--- \nprofiles:\n  HDready: ' -vcodec libx264 -pix_fmt yuv420p -crf 23 -s 1280x720 '\n  mobile: ' -vcodec libx264 -pix_fmt yuv420p -crf 23 -s 480x270 '\n\ncameraids:\n  111:\n    fps: 30\n  191:\n    fps: 50\n  851:\n    fps: 50\n</code></pre>\n\n<p>I want now to iterate over the cameraids and profiles therefore I declare the variable for cameraids like this</p>\n\n<p><code>var camids map[string]interface{}</code></p>\n\n<p>The same as the <code>fmt.Println(reflect.TypeOf(viper.Get(\"cameraids\")))</code> prints but I always get the following error <code>no new variables on left side of :=</code> when I try to get the map from viper</p>\n\n<p><code>camids := viper.GetStringMap(\"cameraids\")</code></p>\n\n<p>Please can you explain and help me what I misunderstand, thanks.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 7, "last_activity_date": 1510785253, "last_edit_date": 1510785253, "creation_date": 1510774444, "answer_id": 47315823, "question_id": 47315683, "link": "https://stackoverflow.com/questions/47315683/how-to-parse-long-hexadecimal-string-into-uint/47315823#47315823", "title": "How to parse long hexadecimal string into uint", "body": "<p>Use <a href=\"https://golang.org/pkg/math/big\" rel=\"nofollow noreferrer\">math/big</a> for working with numbers larger than 64 bits.</p>\n\n<p>From the <a href=\"https://golang.org/pkg/math/big/#example_Int_SetString\" rel=\"nofollow noreferrer\"><code>Int.SetString</code></a> example:</p>\n\n<pre><code>s := \"d3c21bcecceda1000000\"\ni := new(big.Int)\ni.SetString(s, 16)\nfmt.Println(i)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/vf31ce93vA\" rel=\"nofollow noreferrer\">https://play.golang.org/p/vf31ce93vA</a></p>\n\n<p>The <code>math/big</code> types also support the <code>encoding.TextMarshaler</code> and <code>fmt.Scanner</code> interfaces.</p>\n\n<p>For example</p>\n\n<pre><code>i := new(big.Int)\nfmt.Sscan(\"0x000000d3c21bcecceda1000000\", i)\n</code></pre>\n\n<p>Or </p>\n\n<pre><code>i := new(big.Int)\nfmt.Sscanf(\"0x000000d3c21bcecceda1000000\", \"0x%x\", i)\n</code></pre>\n"}], "owner": {"reputation": 165, "user_id": 4150729, "user_type": "registered", "accept_rate": 81, "profile_image": "https://graph.facebook.com/1492722699/picture?type=large", "display_name": "Nik Kunkel", "link": "https://stackoverflow.com/users/4150729/nik-kunkel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1216, "favorite_count": 1, "accepted_answer_id": 47315823, "answer_count": 1, "score": 3, "last_activity_date": 1510785253, "creation_date": 1510773920, "last_edit_date": 1510779008, "question_id": 47315683, "link": "https://stackoverflow.com/questions/47315683/how-to-parse-long-hexadecimal-string-into-uint", "title": "How to parse long hexadecimal string into uint", "body": "<p>I'm pulling in data that is in long hexadecimal string form which I need to convert into decimal notation, truncate 18 decimal places, and then serve up in JSON.</p>\n\n<p>For example I may have the hex string:</p>\n\n<pre><code>\"0x00000000000000000000000000000000000000000000d3c21bcecceda1000000\"\n</code></pre>\n\n<p>At first I was attempting to use <code>ParseUint()</code>, however since the highest it supports is <code>int64</code>, my number ends up being way too big.</p>\n\n<p>This example after conversion and truncation results in 10^6.\nHowever there are instances where this number can be up to 10^12 (meaning pre truncation 10^30!).</p>\n\n<p>What is the best strategy to attack this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1510767388, "post_id": 47313720, "comment_id": 81578519, "body": "The backslashes may be interpreted as escape chars, so try doubling them &quot;C:\\\\RaceReports\\\\myprogram&quot;, or try with forward slashes instead which may be auto-translated to backslashes internally. (Not posting as an answer since I&#39;m not certain if either of these will actually work.)"}, {"owner": {"reputation": 32193, "user_id": 2908724, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/1xBJR.png?s=128&g=1", "display_name": "bishop", "link": "https://stackoverflow.com/users/2908724/bishop"}, "edited": false, "score": 0, "creation_date": 1510767729, "post_id": 47313720, "comment_id": 81578707, "body": "The <code>$env:</code> syntax isn&#39;t familiar to me. What version of Windows is this? Does <code>set GORACE=&#39;log_path=C:\\RaceReports\\myprogram&#39;</code> work?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 32193, "user_id": 2908724, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/1xBJR.png?s=128&g=1", "display_name": "bishop", "link": "https://stackoverflow.com/users/2908724/bishop"}, "edited": false, "score": 0, "creation_date": 1510853209, "post_id": 47313720, "comment_id": 81623027, "body": "@bishop: Windows PowerShell: <a href=\"https://technet.microsoft.com/en-us/library/ff730964.aspx\" rel=\"nofollow noreferrer\">Creating \u2013 and Modifying -- Environment Variables</a> For example, <code>$env:TestVariable = &quot;This is a test environment variable.&quot;</code>."}], "owner": {"reputation": 3685, "user_id": 1847261, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/87730852cde40d956d3854bea0cd2d01?s=128&d=identicon&r=PG", "display_name": "Phil K", "link": "https://stackoverflow.com/users/1847261/phil-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 125, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1510766776, "creation_date": 1510766776, "question_id": 47313720, "link": "https://stackoverflow.com/questions/47313720/go-race-detector-how-to-set-log-path-on-windows", "title": "Go race detector: How to set log_path on Windows?", "body": "<p>I am using the Go race detector on Windows and would like the detected races to be logged to a file rather than to stderr. This is possible by <a href=\"https://golang.org/doc/articles/race_detector.html#Options\" rel=\"nofollow noreferrer\">setting the <code>GORACE</code> environment variable</a>:</p>\n\n<pre><code>$ GORACE='log_path=/var/reports/myprogram' ./myprogram\n</code></pre>\n\n<p>However, when trying it on Windows my program writes an error to stderr and immediately exits:</p>\n\n<pre><code>PS C:\\foo&gt; $env:GORACE = 'log_path=C:\\RaceReports\\myprogram'\nPS C:\\foo&gt; .\\myprogram.exe\nERROR: expected '='\nPS C:\\foo&gt;\n</code></pre>\n\n<p>It works fine if I don't use absolute paths:</p>\n\n<pre><code>PS C:\\foo&gt; $env:GORACE = 'log_path=myprogram'\nPS C:\\foo&gt; .\\myprogram.exe\nPS C:\\foo&gt; ls\n\n\n    Directory: C:\\foo\n\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a----       15/11/2017     17:17            581 myprogram.7904\n-a----       15/11/2017     16:55        2599936 myprogram.exe\n\n\nPS C:\\foo&gt;\n</code></pre>\n\n<p>Am I doing something wrong? Is this a bug in Go? Any help is much appreciated.</p>\n"}, {"tags": ["parsing", "go"], "comments": [{"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 1, "creation_date": 1510764540, "post_id": 47312576, "comment_id": 81576734, "body": "please provide as much as possible code that can be compiled. Use the <a href=\"https://play.golang.org\" rel=\"nofollow noreferrer\">play.golang.org</a> to make sure things are working."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1510765615, "post_id": 47312576, "comment_id": 81577490, "body": "Have you made any attempt to actually parse the string you&#39;re getting? This question, as it stands, is basically asking for an entire implementation."}, {"owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "edited": false, "score": 0, "creation_date": 1510765870, "post_id": 47312576, "comment_id": 81577644, "body": "This might help you: <a href=\"https://stackoverflow.com/questions/13421424/how-to-evaluate-an-infix-expression-in-just-one-scan-using-stacks\">How to evaluate an infix expression in just one scan using stacks?</a>. It&#39;s not an implementation, but it has the logic."}], "answers": [{"tags": [], "owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "is_accepted": false, "score": 0, "last_activity_date": 1510767725, "creation_date": 1510767725, "answer_id": 47314007, "question_id": 47312576, "link": "https://stackoverflow.com/questions/47312576/how-to-parse-an-input-string-like-a-calculator-to-grab-the-operator-and-operan/47314007#47314007", "title": "How to parse an input string, like a calculator, to grab the operator and operands?", "body": "<p>Some pointers for you. </p>\n\n<ol>\n<li>To get operands from your <code>line</code> try <code>strings.FieldsFunc()</code>.</li>\n<li>Convert your operands to <code>float64</code> try <code>strconv.ParseFloat()</code> or <code>fmt.Sscanf()</code>. </li>\n<li>Figure out what operation <code>+, -, /, *</code> you have. Perhaps with <code>strings.ContainsRune()</code>.  </li>\n<li>Perform operation on operands and present results. </li>\n<li>Have fun!</li>\n</ol>\n"}], "owner": {"reputation": 1, "user_id": 6302662, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7987e78bf41a1c9aec87665ac4d220b?s=128&d=identicon&r=PG&f=1", "display_name": "That1GirlProgrammer", "link": "https://stackoverflow.com/users/6302662/that1girlprogrammer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 248, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1510768211, "creation_date": 1510763296, "last_edit_date": 1510768211, "question_id": 47312576, "link": "https://stackoverflow.com/questions/47312576/how-to-parse-an-input-string-like-a-calculator-to-grab-the-operator-and-operan", "title": "How to parse an input string, like a calculator, to grab the operator and operands?", "body": "<p>I am brand new to the Go programming language and I am trying to build a very simple calculator. The issues I am running into is if someone enters in <code>4+2</code> or <code>5/10</code> or <code>100-25</code> to the command line how do I grab the operator and operands out of this string in order to perform the equation?</p>\n\n<p>This is what I have so far, but this just grabs the entire string</p>\n\n<pre><code>package main\n\nimport (\n\"bufio\"\n\"fmt\"\n\"os\"\n\"stack\" //stack code works perfectly\n)\n\nfunc main() {\n\n// Read a line from stdin.\nscanner := bufio.NewScanner(os.Stdin)\n\nfor scanner.Scan() {\n    line := scanner.Text()\n    // fmt.Println(line)\n\n    //Separate the string based on operator and operands\n\n    // Push all of the characters onto the stack.\n    s := stack.New()\n    for i := 0; i &lt; len(line); i++ {\n        if err := s.Push(line[i]); err != nil {\n            panic(\"Push failed\")\n        }\n    }\n</code></pre>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 4, "creation_date": 1510762160, "post_id": 47312029, "comment_id": 81575062, "body": "These are different tools. Mutexes sequentialize access to a resource. On the other hand channels are for orchestrating computations between goroutines. There are a plethora of patterns that can be done using channels that are meaningless when we talk about a Mutex. For example channels can help with constructing pipelines which will stop, when we close the channel. Or patterns like fan-in and fan-out. Or having a M:N job dispatching."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1510762282, "post_id": 47312029, "comment_id": 81575145, "body": "Your contrived example that is relatively similar with both is the exception to the rule. It&#39;s usually very clear where you need &quot;mutual exclusion&quot; rather than synchronization and communication. When in doubt, the simpler implementation is usually what you want."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1510763362, "post_id": 47312029, "comment_id": 81575917, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/26521587/golang-how-to-share-value-message-or-mutex\">Golang, how to share value - message or mutex?</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1510764749, "post_id": 47312029, "comment_id": 81576880, "body": "You should also note that your example implementations don&#39;t do the same thing. The channel implementation coordinates the &quot;ping-pong&quot; back and forth be sending a message, while the mutex implementation just provides mutual exclusion around the ball variable which results in no deterministic ordering."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1510765764, "post_id": 47312029, "comment_id": 81577581, "body": "See also: <a href=\"https://github.com/golang/go/wiki/MutexOrChannel\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/MutexOrChannel</a>"}], "answers": [{"comments": [{"owner": {"reputation": 363, "user_id": 5040388, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh3.googleusercontent.com/-smIq4fgpQ34/AAAAAAAAAAI/AAAAAAAAABE/e5qpViT4k8Y/photo.jpg?sz=128", "display_name": "tetafro", "link": "https://stackoverflow.com/users/5040388/tetafro"}, "edited": false, "score": 0, "creation_date": 1577225653, "post_id": 47313691, "comment_id": 105125887, "body": "Sorry, I don&#39;t understand what you&#39;re comparing. The first example calls <code>Lock()</code> on each increment. The second example is not using channels for increment, it uses channels only for checking the timer. It would be more fair to pass each value through the channel (and it would make channel 2-4x slower) - <a href=\"https://gist.github.com/quasilyte/009edaf14aad08f6d1997b026c63c0a0\" rel=\"nofollow noreferrer\">example</a>."}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 363, "user_id": 5040388, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh3.googleusercontent.com/-smIq4fgpQ34/AAAAAAAAAAI/AAAAAAAAABE/e5qpViT4k8Y/photo.jpg?sz=128", "display_name": "tetafro", "link": "https://stackoverflow.com/users/5040388/tetafro"}, "edited": false, "score": 0, "creation_date": 1577603710, "post_id": 47313691, "comment_id": 105206338, "body": "See the new edit, this is a complete rewrite, just for your comment, thanks for the comment. It seems there is no other <b>concurrent safe</b> way to increment unless using a channel for synchronization or Locked increment."}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": false, "score": 3, "last_activity_date": 1577814744, "last_edit_date": 1577814744, "creation_date": 1510766671, "answer_id": 47313691, "question_id": 47312029, "link": "https://stackoverflow.com/questions/47312029/when-should-you-use-a-mutex-over-a-channel/47313691#47313691", "title": "When should you use a mutex over a channel?", "body": "<p>In most cases prefer channels, in some <code>sync.Mutex</code>:<br>\nUse channels if:<br>\n - transferring ownership (transferring data itself not a pointer to data)<br>\n - coordination and synchronization</p>\n\n<p>Use primitives if:<br>\n - guarding internal state of a struct<br>\n - performance critical (algorithm and use case dependent, not a general rule) </p>\n\n<p>Note: For concurrent safe code using primitives needs more care.</p>\n\n<hr>\n\n<h2>Micro-benchmark</h2>\n\n<p>To make it clear, imagine we need a one second counter, so in the following examples we count for a second then print the counter value to see how fast it counts:  </p>\n\n<pre><code>No |         Count |       Method\n------------------------------------------------------\n 1 |     17_729_027 | Using sync.RWMutex for increment   \n 2 |     12_180_741 | Using channel for increment    \n 3 |    106_743_095 | Using channel for timer \n 4 |    104_178_671 | Using time.AfterFunc and channel sync\n</code></pre>\n\n<p>Note: go version go1.13.5 linux/amd64</p>\n\n<hr>\n\n<p>Codes:</p>\n\n<p>1 - Using <code>sync.RWMutex</code> for increment:</p>\n\n<pre><code>package main\n\nimport (\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    var i rwm\n    go func() {\n        for {\n            i.inc() // free running counter\n        }\n    }()\n    time.Sleep(1 * time.Second)\n    println(i.read()) // sampling the counter\n}\n\ntype rwm struct {\n    sync.RWMutex\n    i int\n}\n\nfunc (l *rwm) inc() {\n    l.Lock()\n    defer l.Unlock()\n    l.i++\n}\nfunc (l *rwm) read() int {\n    l.RLock()\n    defer l.RUnlock()\n    return l.i\n}\n</code></pre>\n\n<hr>\n\n<p>2 - Using channel for increment:</p>\n\n<pre><code>package main\n\nimport (\n    \"time\"\n)\n\nfunc main() {\n    ch := make(chan int, 1)\n    ch &lt;- 1\n    timeout := time.NewTimer(1 * time.Second)\nloop:\n    for {\n        select {\n        case &lt;-timeout.C:\n            timeout.Stop()\n            break loop\n        default:\n            ch &lt;- 1 + &lt;-ch\n        }\n    }\n\n    println(&lt;-ch)\n}\n</code></pre>\n\n<hr>\n\n<p>3 - Using channel for timer:</p>\n\n<pre><code>package main\n\nimport \"time\"\n\nfunc main() {\n    ch := make(chan int)\n    go func() {\n        timeout := time.NewTimer(1 * time.Second)\n        defer timeout.Stop()\n        i := 1\n        for {\n            select {\n            case &lt;-timeout.C:\n                ch &lt;- i\n                return\n            default:\n                i++\n            }\n        }\n    }()\n\n    println(&lt;-ch)\n}\n</code></pre>\n\n<hr>\n\n<p>4 - Using <code>time.AfterFunc</code> and channel sync:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    d := 1 * time.Second\n    i := uint64(0)\n    ch := make(chan struct{})\n\n    time.AfterFunc(d, func() {\n        close(ch)\n    })\n\nloop:\n    for {\n        select {\n        case &lt;-ch:\n            break loop\n        default:\n            i++\n        }\n    }\n\n    fmt.Println(i) // 104_178_671\n}\n\n</code></pre>\n"}], "owner": {"reputation": 227, "user_id": 2565110, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/OaGSb.png?s=128&g=1", "display_name": "muiiu", "link": "https://stackoverflow.com/users/2565110/muiiu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4036, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1577814744, "creation_date": 1510761756, "question_id": 47312029, "link": "https://stackoverflow.com/questions/47312029/when-should-you-use-a-mutex-over-a-channel", "title": "When should you use a mutex over a channel?", "body": "<p>For the past few weeks I've been wrestling with one (not-so) simple question:</p>\n\n<h3>When is it best to use a <code>sync.Mutex</code> and, conversely, when is it best use a <code>chan</code>?</h3>\n\n<p>It seems that for a lot of problems either strategy is interchangeable with the other - <em>and that's just the problem!</em></p>\n\n<p>Take <a href=\"https://youtu.be/QDDwwePbDtw?t=2m55s\" rel=\"nofollow noreferrer\">this video</a> found in the Golang documentation. Below, I've taken the liberty to dictate the code in the playground and also translate it to a <code>sync.Mutex</code> equivalent.</p>\n\n<h3>Is there a certain problem - encountered in the real world - that warrants the use of one other?</h3>\n\n<p>Notes:</p>\n\n<ul>\n<li>I am a huge fan of <a href=\"https://github.com/junegunn/fzf/blob/master/src/matcher.go#L153\" rel=\"nofollow noreferrer\">this use of chan</a> and struggle to think of a more elegant implementation using sync.Mutex.</li>\n<li>It's worth noting that the <code>chan</code> implementation does more work in the same time (reaches 12)*</li>\n</ul>\n\n<p>Playgrounds:</p>\n\n<ul>\n<li><a href=\"https://play.golang.org/p/u2pAJ6soNd\" rel=\"nofollow noreferrer\">Chan implementation</a> </li>\n<li><a href=\"https://play.golang.org/p/lxtd2yQYe0\" rel=\"nofollow noreferrer\">Mutex implementation</a></li>\n</ul>\n\n<p>Ping/pong with <code>chan</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype Ball struct { hits int }\n\nfunc main() {\n    table := make(chan *Ball)\n    go player(\"ping\", table)\n    go player(\"pong\", table)\n\n    table &lt;- new(Ball)\n    time.Sleep(1 * time.Second)\n    &lt;-table\n}\n\nfunc player(name string, table chan *Ball) {\n    for {\n        ball := &lt;-table\n        ball.hits++\n        fmt.Println(name, ball.hits)\n        time.Sleep(100 * time.Millisecond)\n        table &lt;- ball\n    }\n}\n</code></pre>\n\n<p>Ping/pong with <code>sync.Mutex</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n    \"sync\"\n)\n\ntype Ball struct { hits int }\n\nvar m =  sync.Mutex{}\n\nfunc main() {\n    ball := new(Ball)\n    go player(\"ping\", ball)\n    go player(\"pong\", ball)\n\n    time.Sleep(1 * time.Second)\n}\n\nfunc player(name string, ball *Ball) {\n    for {\n        m.Lock()\n        ball.hits++\n        fmt.Println(name, ball.hits)\n        time.Sleep(100 * time.Millisecond)\n        m.Unlock()\n\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "unmarshalling"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1510758797, "post_id": 47310867, "comment_id": 81572340, "body": "What do you mean the &quot;slice is without quotes&quot;? You have a json array with a single object. That can&#39;t unmarshal into a slice of strings."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1510758815, "post_id": 47310867, "comment_id": 81572355, "body": "message in json is an object, not a string &quot;without quotes&quot;."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 5, "creation_date": 1510758837, "post_id": 47310867, "comment_id": 81572371, "body": "If you would be &quot;kind&quot; enough to check error messages (like here on the <a href=\"https://play.golang.org/p/VZ8hoZbU3Y\" rel=\"nofollow noreferrer\">Go Playground</a>), you&#39;ll see why it fails: <i>&quot;json: cannot unmarshal object into Go struct field Message.message of type string&quot;</i>. Never omit errors."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1510758932, "post_id": 47310867, "comment_id": 81572454, "body": "Don&#39;t use string to unmarshal a JSON object but a struct like <code>struct{SpamScore int; PhishScor int}</code> and use the appropriate tags. And please bookmark <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">mholt.github.io/json-to-go</a>."}, {"owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "edited": false, "score": 0, "creation_date": 1510759859, "post_id": 47310867, "comment_id": 81573220, "body": "wow...I love that Volker&#39;s mholt.github.io/json-to-go, do you have something like this for xml ? ;)"}, {"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 1, "creation_date": 1510763213, "post_id": 47310867, "comment_id": 81575774, "body": "@irom you probably meant to say &#39;JSON array in your data string&#39; is what you getting from your api. Yes?"}], "answers": [{"comments": [{"owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "edited": false, "score": 0, "creation_date": 1510772909, "post_id": 47312334, "comment_id": 81581617, "body": "Appreciate a lot, I think Volker was first"}], "tags": [], "owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "is_accepted": false, "score": 3, "last_activity_date": 1510762637, "creation_date": 1510762637, "answer_id": 47312334, "question_id": 47310867, "link": "https://stackoverflow.com/questions/47310867/how-to-parse-slice-inside-json-in-golang/47312334#47312334", "title": "How to parse slice inside json in golang?", "body": "\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Message struct {\n    QueryEndTime string `json:\"queryEndTime\"`\n\n    // you need to use a struct can use anon struct\n    Message      []struct {\n        SpamScore  int `json:\"spamScore\"`\n        PhishScore int `json:\"phishScore\"`\n    } `json:\"message\"`\n\n}\n\nfunc main() {\n    var message Message\n\n    // You can use backticks to for your example JSON, so that you don't have to escape anything.\n    data := `{\n        \"queryEndTime\" : \"2017-11-15T14:39:00Z\", \n        \"message\" : [\n            {\"spamScore\":67, \"phishScore\":0}\n        ]\n    }`\n\n    // please check for errors\n    err := json.Unmarshal([]byte(data), &amp;message)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    // +v prints structs very nicely \n    fmt.Printf(\"%+v\\n\", message)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Mu3WZCej3L\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Mu3WZCej3L</a></p>\n\n<p>Have fun!</p>\n"}], "owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1463, "favorite_count": 0, "closed_date": 1510778762, "answer_count": 1, "score": -3, "last_activity_date": 1510762637, "creation_date": 1510758674, "question_id": 47310867, "link": "https://stackoverflow.com/questions/47310867/how-to-parse-slice-inside-json-in-golang", "closed_reason": "Not suitable for this site", "title": "How to parse slice inside json in golang?", "body": "<p>I am trying to unmarshal json data. The slice inside is deliberately without quotes, because this is what I am getting from https (added manually \\ before \")</p>\n\n<pre><code>data:=\"{\\\"queryEndTime\\\" : \\\"2017-11-15T14:39:00Z\\\", \\\"message\\\" : [{\\\"spamScore\\\":67,\\\"phishScore\\\":0}]}\"\n</code></pre>\n\n<p>into Message struct:</p>\n\n<pre><code>type Message struct {\n    QueryEndTime string `json:\"queryEndTime\"`\n    Message []string `json:\"message\"`\n\n}\n</code></pre>\n\n<p>but I am getting correct QueryEndTime and empty Message. I tried to change Message type but it always stays empty</p>\n\n<pre><code>var message Message\njson.Unmarshal([]byte(data), &amp;message)\nfmt.Printf(\"QueryEndTime: %s\\nMessage: %s\\n\", message.QueryEndTime, message.Message)\nQueryEndTime: 2017-11-15T14:39:00Z\nMessage: []\n</code></pre>\n\n<p>See it in go playground <a href=\"https://play.golang.org/p/on0_cSKb0c\" rel=\"nofollow noreferrer\">https://play.golang.org/p/on0_cSKb0c</a>.</p>\n"}, {"tags": ["go", "cors", "axios", "negroni"], "comments": [{"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 0, "creation_date": 1510755611, "post_id": 47309286, "comment_id": 81569798, "body": "typo? <code>AllowedOrigins: []string{&quot;http:&#47;&#47;172.0.0.1&quot;}</code> perhaps 127.0.0.1"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510755620, "post_id": 47309286, "comment_id": 81569808, "body": "For one thing, you&#39;re accessing the site at 127.0.0.1, but you&#39;re setting the origins to 172.0.0.1."}, {"owner": {"reputation": 195, "user_id": 5695168, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/804366438d3017e7bb0067db40bb5459?s=128&d=identicon&r=PG&f=1", "display_name": "Andreas W", "link": "https://stackoverflow.com/users/5695168/andreas-w"}, "edited": false, "score": 0, "creation_date": 1510756535, "post_id": 47309286, "comment_id": 81570574, "body": "Oh my mistake... I changed it but it is still not working."}, {"owner": {"reputation": 1276, "user_id": 6237232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/557d1078fe8ace9c1e6f88d275f5f32a?s=128&d=identicon&r=PG&f=1", "display_name": "RidgeA", "link": "https://stackoverflow.com/users/6237232/ridgea"}, "edited": false, "score": 0, "creation_date": 1510758241, "post_id": 47309286, "comment_id": 81571920, "body": "Do you have any error message in browser&#39;s console? Also you have <code>http</code> in browser, and go code, but <code>https</code> in js code."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1510758378, "post_id": 47309286, "comment_id": 81572026, "body": "<code>http:&#47;&#47;localhost</code> and <code>http:&#47;&#47;localhost:8080</code> are different origins. There should be a message in the JS console, actually."}, {"owner": {"reputation": 195, "user_id": 5695168, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/804366438d3017e7bb0067db40bb5459?s=128&d=identicon&r=PG&f=1", "display_name": "Andreas W", "link": "https://stackoverflow.com/users/5695168/andreas-w"}, "edited": false, "score": 0, "creation_date": 1510762354, "post_id": 47309286, "comment_id": 81575198, "body": "This is the error I get from the console Failed to load <a href=\"http://127.0.0.1:8090/users/login\" rel=\"nofollow noreferrer\">127.0.0.1:8090/users/login</a>: Response to preflight request doesn&#39;t pass access control check: No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource. Origin &#39;<a href=\"http://127.0.0.1:8080\" rel=\"nofollow noreferrer\">127.0.0.1:8080</a>&#39; is therefore not allowed access.  I access the api just with http"}], "answers": [{"tags": [], "owner": {"reputation": 195, "user_id": 5695168, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/804366438d3017e7bb0067db40bb5459?s=128&d=identicon&r=PG&f=1", "display_name": "Andreas W", "link": "https://stackoverflow.com/users/5695168/andreas-w"}, "is_accepted": true, "score": 3, "last_activity_date": 1510829383, "creation_date": 1510829383, "answer_id": 47327683, "question_id": 47309286, "link": "https://stackoverflow.com/questions/47309286/axios-does-not-send-post-to-golang-api/47327683#47327683", "title": "axios does not send POST to golang api", "body": "<p>Okay I found a solution for the problem:</p>\n\n<p>As described in <a href=\"https://danieltse.com/resolve-access-control-allow-origin-cors-error-with-negroni/\" rel=\"nofollow noreferrer\">this</a> article, I added some more options to the cors negroni plugin. One important option that was missing in my application was the line </p>\n\n<pre><code>AllowedHeaders: []string{\"X-Auth-Key\", \"X-Auth-Secret\", \"Content-Type\"},\n</code></pre>\n\n<p>Because my app sent the Content-Type Header and the api refused it. </p>\n\n<p>I hope this will help others with similar problems.</p>\n"}], "owner": {"reputation": 195, "user_id": 5695168, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/804366438d3017e7bb0067db40bb5459?s=128&d=identicon&r=PG&f=1", "display_name": "Andreas W", "link": "https://stackoverflow.com/users/5695168/andreas-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1689, "favorite_count": 0, "accepted_answer_id": 47327683, "answer_count": 1, "score": 2, "last_activity_date": 1510829383, "creation_date": 1510754138, "last_edit_date": 1510756553, "question_id": 47309286, "link": "https://stackoverflow.com/questions/47309286/axios-does-not-send-post-to-golang-api", "title": "axios does not send POST to golang api", "body": "<p>I have a golang api backend with a negroni middleware.</p>\n\n<p>I already implemented the CORS handler for negroni, so my api should allow cross origin resource sharing.</p>\n\n<pre><code>// allow OPTIONS method of CORS requests\nc := cors.New(cors.Options{\n    AllowedOrigins: []string{\"http://127.0.0.1\"},\n})\n\n//common.StartUp() - Replaced with init method\n// Get the mux router object\nrouter := routers.InitRoutes()\n// Create a negroni instance\nn := negroni.Classic()\nn.Use(c)\nn.UseHandler(router)\n\nserver := &amp;http.Server{\n    Addr:    common.AppConfig.Server,\n    Handler: n,\n}\nlog.Println(\"Listening...\")\nserver.ListenAndServe()\n</code></pre>\n\n<p>This is from the <a href=\"https://github.com/rs/cors/blob/master/examples/negroni/server.go\" rel=\"nofollow noreferrer\">https://github.com/rs/cors/blob/master/examples/negroni/server.go</a> example of implementing CORS with negroni.</p>\n\n<p>Nevertheless my api now responses a 200 status back to my frontend, but the frontend does not send the POST request to the server. This my axios code:</p>\n\n<pre><code>import axios from 'axios';\nconst data = {\nemail: 'user@mail.com',\npassword: 'secret',\n};\n\nexport default {\nname: 'Login',\nmethods: {\nlogin() {\n  axios.post('https://127.0.0.1:8090/users/login', data);\n},\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/V4azY.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/V4azY.png\" alt=\"enter image description here\"></a>\nPostman does not have any problems with sending the POST request. What am I doing wrong?</p>\n"}, {"tags": ["arrays", "go", "append"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1510757139, "post_id": 47307552, "comment_id": 81571041, "body": "A nitpick: that&#39;s not an array, it&#39;s a slice. You cannot append to Go arrays since their sizes is a part of their types."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 7489661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jCF3Q.jpg?s=128&g=1", "display_name": "Alex Taran", "link": "https://stackoverflow.com/users/7489661/alex-taran"}, "is_accepted": false, "score": 0, "last_activity_date": 1510749513, "creation_date": 1510749513, "answer_id": 47307653, "question_id": 47307552, "link": "https://stackoverflow.com/questions/47307552/append-for-array-of-maps-raplaces-all-previous-array-items-on-the-latest-one/47307653#47307653", "title": "Append for array of maps raplaces all previous array items on the latest one", "body": "<p>Got in a minute after posting the question...</p>\n\n<p>Looks like append doesn't copy map, just inserts the same.. So recreating the map each time I need to append it helps:</p>\n\n<pre><code>package main\n\n\nimport \"fmt\"\n\nfunc main() {\n  values := make([]map[string]string, 0)\n  row := make(map[string]string)\n  row[\"item1\"] = \"value1\"\n  row[\"item2\"] = \"value2\"\n  values = append(values, row)\n  fmt.Println(values)\n  row2 := make(map[string]string)\n  row2[\"item1\"] = \"value3\"\n  row2[\"item2\"] = \"value4\"\n  values = append(values, row2)\n  fmt.Println(values)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "is_accepted": true, "score": 1, "last_activity_date": 1510749610, "creation_date": 1510749610, "answer_id": 47307687, "question_id": 47307552, "link": "https://stackoverflow.com/questions/47307552/append-for-array-of-maps-raplaces-all-previous-array-items-on-the-latest-one/47307687#47307687", "title": "Append for array of maps raplaces all previous array items on the latest one", "body": "<p>maps variables are pointers to a map so assume that your row map is in 0x50 memory address, then your values array would be some like this</p>\n\n<pre><code>values := {{0x50}, {0x50}}\n</code></pre>\n\n<p>so both will change by changing row.\na simple way to do that is to repeat making row again after first println or change the name of second map</p>\n"}], "owner": {"reputation": 1, "user_id": 7489661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jCF3Q.jpg?s=128&g=1", "display_name": "Alex Taran", "link": "https://stackoverflow.com/users/7489661/alex-taran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 47307687, "answer_count": 2, "score": -2, "last_activity_date": 1510763304, "creation_date": 1510749181, "last_edit_date": 1510763304, "question_id": 47307552, "link": "https://stackoverflow.com/questions/47307552/append-for-array-of-maps-raplaces-all-previous-array-items-on-the-latest-one", "title": "Append for array of maps raplaces all previous array items on the latest one", "body": "<p>The question may sound very stupid but I really don't understand what's wrong.</p>\n\n<p>I want to create an array of maps like this:</p>\n\n<pre><code>values := make([]map[string]string, 0)\n</code></pre>\n\n<p>Then I create some map:</p>\n\n<pre><code>row := make(map[string]string)\nrow[\"item1\"] = \"value1\"\nrow[\"item2\"] = \"value2\"\n</code></pre>\n\n<p>Then append it to the array:</p>\n\n<pre><code>values = append(values, row)\n</code></pre>\n\n<p>Printing values now gives:</p>\n\n<pre><code>[map[item1:value1 item2:value2]]\n</code></pre>\n\n<p>Do the same using some other values:</p>\n\n<pre><code>row[\"item1\"] = \"value3\"\nrow[\"item2\"] = \"value4\"\nvalues = append(values, row)\n</code></pre>\n\n<p>Now printing values gives:</p>\n\n<pre><code>[map[item1:value3 item2:value4] map[item1:value3 item2:value4]]\n</code></pre>\n\n<p>So the first array item = the second one.\nWhat can cause this?</p>\n\n<p>Full code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n  values := make([]map[string]string, 0)\n  row := make(map[string]string)\n  row[\"item1\"] = \"value1\"\n  row[\"item2\"] = \"value2\"\n  values = append(values, row)\n  fmt.Println(values)\n  row[\"item1\"] = \"value3\"\n  row[\"item2\"] = \"value4\"\n  values = append(values, row)\n  fmt.Println(values)\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "stripe-payments"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 7375625, "user_type": "registered", "profile_image": "https://graph.facebook.com/1315574155159324/picture?type=large", "display_name": "Gaultier Romon", "link": "https://stackoverflow.com/users/7375625/gaultier-romon"}, "edited": false, "score": 0, "creation_date": 1510752614, "post_id": 47305965, "comment_id": 81567697, "body": "Ok thanks a lot this fix allowed me to make the app to compile but i get this error now  `         Post <a href=\"https://api.stripe.com/v1/customers\" rel=\"nofollow noreferrer\">api.stripe.com/v1/customers</a>: http.DefaultTransport and            http.DefaultClient are not available in App Engine. See            <a href=\"https://cloud.google.com/appengine/docs/go/urlfetch/\" rel=\"nofollow noreferrer\">cloud.google.com/appengine/docs/go/urlfetch</a> `  It does not make any sense since i am using urlfetch in the setStripeClient method"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1510744983, "last_edit_date": 1510744983, "creation_date": 1510744530, "answer_id": 47305965, "question_id": 47303285, "link": "https://stackoverflow.com/questions/47303285/cannot-get-stripe-charge-work-with-app-engine-golang/47305965#47305965", "title": "Cannot get stripe charge work with app engine Golang", "body": "<p>The error message tells you the problem. The stripe.BackendConfiguration type does not implement stripe.Backend interface.  The error message also gives the helpful hint that the missing Call method is on the pointer receiver.</p>\n\n<p>The fix is to use a pointer value:</p>\n\n<pre><code>b = &amp;stripe.BackendConfiguration{  // note the &amp;\n    stripe.APIBackend, \n    \"https://api.stripe.com/v1\",\n    urlfetch.Client(context),\n}\n</code></pre>\n\n<p>See the <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">specification regarding method sets</a>.  The method set of a value receiver does not include the pointer receiver methods.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 7375625, "user_type": "registered", "profile_image": "https://graph.facebook.com/1315574155159324/picture?type=large", "display_name": "Gaultier Romon", "link": "https://stackoverflow.com/users/7375625/gaultier-romon"}, "is_accepted": false, "score": 0, "last_activity_date": 1510753422, "creation_date": 1510753422, "answer_id": 47309004, "question_id": 47303285, "link": "https://stackoverflow.com/questions/47303285/cannot-get-stripe-charge-work-with-app-engine-golang/47309004#47309004", "title": "Cannot get stripe charge work with app engine Golang", "body": "<p>Ok finally got the solution by doing so : </p>\n\n<pre><code>func setStripeChargeClient(context context.Context, key string) *charge.Client {\n       c := &amp;charge.Client{}\n\n       //SETTING THE CLIENT WITH URL FETCH PROPERLY\n       fetch := &amp;http.Client{\n              Transport: &amp;urlfetch.Transport{\n              Context: context,\n        },\n       }\n\n     //USE SetHTTPClient method to switch httpClient\n     stripe.SetHTTPClient(fetch)\n\n     var b stripe.Backend\n     b = &amp;stripe.BackendConfiguration{stripe.APIBackend, \n     \"https://api.stripe.com/v1\",fetch}\n\n     c.Key = key\n     c.B = b\n\n     return c\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 37028, "user_id": 59198, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6448b40e7037dd0fda767f2370c31809?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/59198/chris"}, "is_accepted": false, "score": 0, "last_activity_date": 1518695859, "creation_date": 1518695859, "answer_id": 48806731, "question_id": 47303285, "link": "https://stackoverflow.com/questions/47303285/cannot-get-stripe-charge-work-with-app-engine-golang/48806731#48806731", "title": "Cannot get stripe charge work with app engine Golang", "body": "<p>This was my solution as per Stripe's GAE recommendations:</p>\n\n<pre><code>func myHandler(w http.ResponseWriter, r *http.Request) {\n    c := appengine.NewContext(r)\n    myStripeKey := \"pk_test_ABCDEF...\"\n    httpClient := urlfetch.Client(c)\n    stripeClient := client.New(myStripeKey, stripe.NewBackends(httpClient))\n    chargeParams := &amp;stripe.ChargeParams{\n        Amount:    uint64(totalCents),\n        Currency:  \"usd\",\n        Desc:      description,\n        Email:     email,\n        Statement: \"MyCompany\",\n    }\n    chargeParams.SetSource(token)\n    charge, chargeErr := stripeClient.Charges.New(chargeParams)\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 7375625, "user_type": "registered", "profile_image": "https://graph.facebook.com/1315574155159324/picture?type=large", "display_name": "Gaultier Romon", "link": "https://stackoverflow.com/users/7375625/gaultier-romon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 340, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1518695859, "creation_date": 1510736919, "last_edit_date": 1510750508, "question_id": 47303285, "link": "https://stackoverflow.com/questions/47303285/cannot-get-stripe-charge-work-with-app-engine-golang", "title": "Cannot get stripe charge work with app engine Golang", "body": "<p>So here is my problem, i have been following the github readme for app engine users in order to implement stripe into my app but the thing is that i can\u2019t make it work as it seems that the http.DefaultTransport and http.DefaultClient are not available in App Engine. </p>\n\n<p>I have seen that in the readme you show us how to initialize the Stripe client with app engine but i cannot find any charge card example so this is why i have come to this implementation.</p>\n\n<p>I am used to this problem, since i have been working with app engine for a long time but for some reason i still get this akward error : </p>\n\n<p><code>cannot use stripe.BackendConfiguration literal (type stripe.BackendConfiguration) as type stripe.Backend in assignment: stripe.BackendConfiguration does not implement stripe.Backend (Call method has pointer receiver)</code></p>\n\n<p>Here is the code : </p>\n\n<pre><code>func setStripeChargeClient(context context.Context, key string) *charge.Client {\n    c := &amp;charge.Client{}\n\n    var b stripe.Backend\n    b = stripe.BackendConfiguration{\n        stripe.APIBackend, \n        \"https://api.stripe.com/v1\",\n        urlfetch.Client(context),\n    }\n\n    c.Key = key\n    c.B = b\n\n    return c\n}\n</code></pre>\n\n<p>Getting the error on that b assignation \u2026</p>\n\n<p>What i can\u2019t figure it out is why this example seems to work all around the web and does not work in my app, if you could please enlighten me on this one, i would be in your debt hahaha</p>\n\n<p>and then calling it this way </p>\n\n<p><code>stripeClient := setStripeChargeClient(context, \"sk_live_key \u00bb)</code></p>\n"}, {"tags": ["http", "go", "proxy"], "comments": [{"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1510735599, "post_id": 47302778, "comment_id": 81556576, "body": "What have you tried to set proxies?"}, {"owner": {"reputation": 381, "user_id": 8573838, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-id8ZMMo9mIA/AAAAAAAAAAI/AAAAAAAAADM/VJic0_NAcpo/photo.jpg?sz=128", "display_name": "James Morgan", "link": "https://stackoverflow.com/users/8573838/james-morgan"}, "reply_to_user": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1510735760, "post_id": 47302778, "comment_id": 81556686, "body": "tried assigning a proxy within a transport and then including that when I initialise a client. Then the proxy will be used within the requests issued by that client. I&#39;m not aware of any other ways to achieve it"}], "answers": [{"comments": [{"owner": {"reputation": 381, "user_id": 8573838, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-id8ZMMo9mIA/AAAAAAAAAAI/AAAAAAAAADM/VJic0_NAcpo/photo.jpg?sz=128", "display_name": "James Morgan", "link": "https://stackoverflow.com/users/8573838/james-morgan"}, "edited": false, "score": 0, "creation_date": 1510738495, "post_id": 47303699, "comment_id": 81558301, "body": "So you&#39;re saying that it wouldn&#39;t actually be too costly to create a new client for each request I make, correct? That&#39;s good to hear. Will look into extending the method you&#39;ve given as well, thanks :)"}, {"owner": {"reputation": 2590, "user_id": 1209451, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/1700220388/picture?type=large", "display_name": "Oleg", "link": "https://stackoverflow.com/users/1209451/oleg"}, "reply_to_user": {"reputation": 381, "user_id": 8573838, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-id8ZMMo9mIA/AAAAAAAAAAI/AAAAAAAAADM/VJic0_NAcpo/photo.jpg?sz=128", "display_name": "James Morgan", "link": "https://stackoverflow.com/users/8573838/james-morgan"}, "edited": false, "score": 0, "creation_date": 1510739348, "post_id": 47303699, "comment_id": 81558817, "body": "@JordanAllen: Yes - client its just struct with 4 fields . Transport is the interface - http.Transport is abit more than client itself - if you want you can preapre it for each proxy but actually it does not worth ."}, {"owner": {"reputation": 381, "user_id": 8573838, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-id8ZMMo9mIA/AAAAAAAAAAI/AAAAAAAAADM/VJic0_NAcpo/photo.jpg?sz=128", "display_name": "James Morgan", "link": "https://stackoverflow.com/users/8573838/james-morgan"}, "edited": false, "score": 0, "creation_date": 1510739652, "post_id": 47303699, "comment_id": 81559024, "body": "Amazing answer. Thank you, given me a lot of options and a lot of help understanding my options. Appreciate it!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1510756740, "post_id": 47303699, "comment_id": 81570728, "body": "Never create an <code>http.Transport</code> for each request (though I can&#39;t tell if that&#39;s what you&#39;re recommending or not). Not reusing the transport will leak open connections."}, {"owner": {"reputation": 2590, "user_id": 1209451, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/1700220388/picture?type=large", "display_name": "Oleg", "link": "https://stackoverflow.com/users/1209451/oleg"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1510773555, "post_id": 47303699, "comment_id": 81582010, "body": "@JimB: You are right - Transport can keep connection open."}], "tags": [], "owner": {"reputation": 2590, "user_id": 1209451, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/1700220388/picture?type=large", "display_name": "Oleg", "link": "https://stackoverflow.com/users/1209451/oleg"}, "is_accepted": true, "score": 1, "last_activity_date": 1510747759, "last_edit_date": 1510747759, "creation_date": 1510738187, "answer_id": 47303699, "question_id": 47302778, "link": "https://stackoverflow.com/questions/47302778/using-different-proxy-on-each-request/47303699#47303699", "title": "Using different proxy on each request", "body": "<p>Creating of http.Client is not so expensive - its just a struct allocation that can be done for each request.</p>\n\n<p>You should create http.Client and transport objects yourself and set proxy directly there.</p>\n\n<pre><code>proxyUrl, err := url.Parse(\"http://127.0.0.1:123\")\nif err != nil {\n    panic(err)\n}\nmyClient := &amp;http.Client{Transport: &amp;http.Transport{Proxy: http.ProxyURL(proxyUrl)}}\nmyClient.Get(\"http://www.google.com/\")\n</code></pre>\n\n<p>Tere is the other posibility to use always the same client with different proxies: </p>\n\n<p>http.ProxyURL call from the first example is function: </p>\n\n<pre><code>// ProxyURL returns a proxy function (for use in a Transport)\n// that always returns the same URL.\nfunc ProxyURL(fixedURL *url.URL) func(*Request) (*url.URL, error) {\n    return func(*Request) (*url.URL, error) {\n        return fixedURL, nil\n    }\n}\n</code></pre>\n\n<p>You can extend it and chose proxy based on the information from request or implement some other logic.</p>\n\n<p><strong>UPD</strong>: here is implementation how to use ProxyUrl with only one Client. But overehead of changing context is comparable with overhead on creating a client. I would use the first scenario. </p>\n\n<p>// We must write our own Get (or some other) request and add somewere the info that this is a proxy request. You can do it via context of request.</p>\n\n<pre><code>func GetWithProxy(c *http.Client,proxyUrl *url.URL, url string) (resp *http.Response, err error) {\n    req, err := http.NewRequest(\"GET\", url, nil)\n    if err != nil {\n        return nil, err\n    }\n\n    if proxyUrl != nil {\n        req = req.WithContext(context.WithValue(context.Background(),\"proxy\",proxyUrl))\n    }\n\n    return c.Do(req)\n}\n</code></pre>\n\n<p>// Organize client that can use this information:</p>\n\n<pre><code>proxyUrl, err := url.Parse(\"http://127.0.0.1:123\")\nif err != nil {\n    panic(err)\n}\n\nmyClient := &amp;http.Client{Transport: &amp;http.Transport{Proxy: func(req *http.Request) (*url.URL, error) {\n    currentProxy,_ := req.Context().Value(\"proxy\").(*url.URL)\n    return currentProxy, nil\n}}}\n</code></pre>\n\n<p>Use it:</p>\n\n<pre><code>GetWithProxy(myClient,nil,\"http://www.google.com/\")\nGetWithProxy(myClient,proxyUrl,\"http://www.google.com/\")\n</code></pre>\n"}], "owner": {"reputation": 381, "user_id": 8573838, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-id8ZMMo9mIA/AAAAAAAAAAI/AAAAAAAAADM/VJic0_NAcpo/photo.jpg?sz=128", "display_name": "James Morgan", "link": "https://stackoverflow.com/users/8573838/james-morgan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 340, "favorite_count": 0, "accepted_answer_id": 47303699, "answer_count": 1, "score": 1, "last_activity_date": 1510747759, "creation_date": 1510735118, "last_edit_date": 1510735244, "question_id": 47302778, "link": "https://stackoverflow.com/questions/47302778/using-different-proxy-on-each-request", "title": "Using different proxy on each request", "body": "<p>As far as it is my understanding, the only way I can set a proxy for a request is to assign it to a client and then use that for a request. However, I also understand I should reuse the clients for my requests. Is there any way to individually assign proxies for each request whilst using the same client? Or any way to efficiently do a collection of requests with a different proxy for each request? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3136, "user_id": 3751577, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9AQ6n.png?s=128&g=1", "display_name": "Hexaholic", "link": "https://stackoverflow.com/users/3751577/hexaholic"}, "edited": false, "score": 2, "creation_date": 1510734108, "post_id": 47302402, "comment_id": 81555718, "body": "I don&#39;t know Go, but it looks like you will have to implement that function yourself. Maybe this is helpful: <a href=\"https://stackoverflow.com/questions/33581426/how-can-i-convert-from-int-to-hex-in-golang/33581477\" title=\"how can i convert from int to hex in golang\">stackoverflow.com/questions/33581426/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 3, "creation_date": 1510740205, "post_id": 47303182, "comment_id": 81559385, "body": "WTF is this? It serializes an <code>int64</code> value into a series of bytes using the big-endian format; there is no &quot;hex&quot; in there\u2014which is uniformly taken to mean <i>string</i> representation of an integer using base 16 for conversion. (Please note that I&#39;m not to blame you but this is worth pointing out)."}, {"owner": {"reputation": 944, "user_id": 1498624, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/4WQ2c.jpg?s=128&g=1", "display_name": "grabthefish", "link": "https://stackoverflow.com/users/1498624/grabthefish"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1510750386, "post_id": 47303182, "comment_id": 81566083, "body": "i fully agree with you, this was a really bad name for this function"}], "tags": [], "owner": {"reputation": 944, "user_id": 1498624, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/4WQ2c.jpg?s=128&g=1", "display_name": "grabthefish", "link": "https://stackoverflow.com/users/1498624/grabthefish"}, "is_accepted": false, "score": 2, "last_activity_date": 1510736547, "creation_date": 1510736547, "answer_id": 47303182, "question_id": 47302402, "link": "https://stackoverflow.com/questions/47302402/how-to-convert-int-to-hex/47303182#47303182", "title": "How to convert int to hex", "body": "<p>the article you linked contains an url to the full <a href=\"https://github.com/Jeiwan/blockchain_go/tree/part_2\" rel=\"nofollow noreferrer\">source code</a></p>\n\n<p>in the file utils.go is the <code>IntToHex</code> function used</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/binary\"\n    \"log\"\n)\n\n// IntToHex converts an int64 to a byte array\nfunc IntToHex(num int64) []byte {\n    buff := new(bytes.Buffer)\n    err := binary.Write(buff, binary.BigEndian, num)\n    if err != nil {\n        log.Panic(err)\n    }\n\n    return buff.Bytes()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 141, "user_id": 4143680, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EZtiINlnyus/AAAAAAAAAAI/AAAAAAAABQc/se2NRS39sZw/photo.jpg?sz=128", "display_name": "Henry Henderson", "link": "https://stackoverflow.com/users/4143680/henry-henderson"}, "is_accepted": false, "score": 5, "last_activity_date": 1510737724, "creation_date": 1510737724, "answer_id": 47303535, "question_id": 47302402, "link": "https://stackoverflow.com/questions/47302402/how-to-convert-int-to-hex/47303535#47303535", "title": "How to convert int to hex", "body": "<p>Looks like the author of that article left that function out of his/her example, or implied the reader to write their own. Representing an integer as its base-16 format is quite easily and can be done using the standard library's <a href=\"https://golang.org/pkg/strconv/\" rel=\"noreferrer\">strconv</a> package. Here's an example below of one I believe would fit your program:</p>\n\n<pre><code>func IntToHex(n int64) []byte {\n    return []byte(strconv.FormatInt(n, 16))\n}\n</code></pre>\n\n<ul>\n<li><a href=\"https://play.golang.org/p/ci8h_XET3T\" rel=\"noreferrer\">Playground Example</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1510743986, "creation_date": 1510743986, "answer_id": 47305776, "question_id": 47302402, "link": "https://stackoverflow.com/questions/47302402/how-to-convert-int-to-hex/47305776#47305776", "title": "How to convert int to hex", "body": "<p>Just use</p>\n\n<pre><code>s := fmt.Sprintf(\"%0x\", 745658)\nfmt.Println(s)\n// Output: b60ba\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/hrE2FnvvYH\" rel=\"nofollow noreferrer\">https://play.golang.org/p/hrE2FnvvYH</a></p>\n"}], "owner": {"reputation": 73, "user_id": 7779864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea604688c69cebe14322a73b5c5680ef?s=128&d=identicon&r=PG&f=1", "display_name": "leo", "link": "https://stackoverflow.com/users/7779864/leo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6033, "favorite_count": 0, "closed_date": 1510816086, "answer_count": 3, "score": -2, "last_activity_date": 1510743986, "creation_date": 1510733782, "last_edit_date": 1510740045, "question_id": 47302402, "link": "https://stackoverflow.com/questions/47302402/how-to-convert-int-to-hex", "closed_reason": "Duplicate", "title": "How to convert int to hex", "body": "<p>I follow the article about building blockchain in go: <a href=\"https://jeiwan.cc/posts/building-blockchain-in-go-part-2/\" rel=\"nofollow noreferrer\">https://jeiwan.cc/posts/building-blockchain-in-go-part-2/</a>\nWhen I study the part 2, I can't run the code in the <code>prepareDate</code> function. It always throw up a error:</p>\n\n<blockquote>\n  <p>underfined: IntToHex. </p>\n</blockquote>\n\n<p>This is my code:</p>\n\n<pre><code>    func (pow *ProofOfWork) prepareData(nonce int) []byte {\n\n    data := bytes.Join(\n\n     [][]byte{\n            pow.block.PrevBlockHash,\n            pow.block.Data,\n            IntToHex(pow.block.Timestamp),\n            IntToHex(int64(targetBits)),\n            IntToHex(int64(nonce)),\n        },\n        []byte{},\n    )\n\n    return data\n}\n</code></pre>\n"}, {"tags": ["docker", "go", "apache-kafka", "sarama"], "answers": [{"comments": [{"owner": {"reputation": 912, "user_id": 6012434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MZcOa.png?s=128&g=1", "display_name": "Robo", "link": "https://stackoverflow.com/users/6012434/robo"}, "reply_to_user": {"reputation": 49, "user_id": 8793532, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ZXoL9yGLChQ/AAAAAAAAAAI/AAAAAAAAAj8/AtQrkKX8QKQ/photo.jpg?sz=128", "display_name": "\u0441\u0430\u043d\u0436\u0430\u0440 \u043a\u0443\u043b\u0438\u0435\u0432", "link": "https://stackoverflow.com/users/8793532/%d1%81%d0%b0%d0%bd%d0%b6%d0%b0%d1%80-%d0%ba%d1%83%d0%bb%d0%b8%d0%b5%d0%b2"}, "edited": false, "score": 0, "creation_date": 1510743425, "post_id": 47303687, "comment_id": 81561452, "body": "it&#39;s a DNS issue, your container is not using the same DNS server as your computer. If you need any further help I suggest you ask a new question."}], "tags": [], "owner": {"reputation": 912, "user_id": 6012434, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MZcOa.png?s=128&g=1", "display_name": "Robo", "link": "https://stackoverflow.com/users/6012434/robo"}, "is_accepted": true, "score": 0, "last_activity_date": 1510738158, "creation_date": 1510738158, "answer_id": 47303687, "question_id": 47301748, "link": "https://stackoverflow.com/questions/47301748/apache-kafka-consumer-implemented-in-golang-panics-when-deployed-to-docker/47303687#47303687", "title": "Apache Kafka consumer implemented in Golang panics when deployed to Docker", "body": "<p>On line 27 of kafka.go, you are ignoring the error returned from <code>ConsumePartition()</code>. It's likely that it's returning an error and not a valid partition consumer, but since you're ignoring it when you attempt to use the partition consumer it's crashing.</p>\n"}], "owner": {"reputation": 49, "user_id": 8793532, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ZXoL9yGLChQ/AAAAAAAAAAI/AAAAAAAAAj8/AtQrkKX8QKQ/photo.jpg?sz=128", "display_name": "\u0441\u0430\u043d\u0436\u0430\u0440 \u043a\u0443\u043b\u0438\u0435\u0432", "link": "https://stackoverflow.com/users/8793532/%d1%81%d0%b0%d0%bd%d0%b6%d0%b0%d1%80-%d0%ba%d1%83%d0%bb%d0%b8%d0%b5%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 465, "favorite_count": 1, "accepted_answer_id": 47303687, "answer_count": 1, "score": 0, "last_activity_date": 1510738158, "creation_date": 1510731241, "question_id": 47301748, "link": "https://stackoverflow.com/questions/47301748/apache-kafka-consumer-implemented-in-golang-panics-when-deployed-to-docker", "title": "Apache Kafka consumer implemented in Golang panics when deployed to Docker", "body": "<p>here is my attempt in implementing a simple microservice that is supposed to read messages from a kafka server and send it via HTTP. It works fine when i run it from the terminal, but when deployed on to docker it panics with </p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x40 pc=0x7b6345]\n\ngoroutine 12 [running]:\nmain.kafkaRoutine.func1(0xc420174060, 0x0, 0x0)\n    /go/src/github.com/deathcore666/ProperConsumerServiceYo/kafka.go:36 +0x95\ncreated by main.kafkaRoutine\n    /go/src/github.com/deathcore666/ProperConsumerServiceYo/kafka.go:32 +0x1ad\n</code></pre>\n\n<p>kafka.go lines 32 and 36 are the ones where  <code>go func(pc sarama.PartitionConsumer)</code> function sits.\nI am relatively new to programming, so any help would be appreciated. Thank you!</p>\n\n<p>main.go:</p>\n\n<pre><code>func main() {\nvar (\n    listen = flag.String(\"listen\", \":8080\", \"HTTP listen address\")\n    proxy  = flag.String(\"proxy\", \"\", \"Optional comma-separated list of URLs to proxy uppercase requests\")\n)\nflag.Parse()\n\nlogger := log.NewLogfmtLogger(os.Stderr)\n\nvar svc KafkaService\nsvc = kafkaService{}\nsvc = proxyingMiddleware(context.Background(), *proxy, logger)(svc)\nsvc = loggingMiddleware(logger)(svc)\n\n\nconsumehandler := httptransport.NewServer(\n    makeConsumeEndpoint(svc),\n    decodeConsumeRequest,\n    encodeResponse,\n)\n\nhttp.Handle(\"/consume\", consumehandler)\n\nlogger.Log(\"msg\", \"HTTP\", \"addr\", *listen)\nlogger.Log(\"err\", http.ListenAndServe(*listen, nil))}\n</code></pre>\n\n<p>service.go:</p>\n\n<pre><code>    package main\n\nimport (\n    \"context\"\n    \"errors\"\n    \"time\"\n)\n\n//KafkaService yolo\ntype KafkaService interface {\n    Consume(context.Context, string) (string, error)\n}\n\n//ErrEmpty yolo\nvar ErrEmpty = errors.New(\"No topic provided\")\n\ntype kafkaService struct{}\n\n//Consumer logic implemented here\nfunc (kafkaService) Consume(_ context.Context, topic string) (string, error) {\n    if topic == \"\" {\n        return \"\", ErrEmpty\n    }\n\n    var inChan = make(chan string)\n    var readyChan = make(chan struct{})\n    var result string\n    var brokers = []string{\"192.168.88.208:9092\"}\n    //var brokersLocal = []string{\"localhost:9092\"}\n    go kafkaRoutine(inChan, topic, brokers)\n    go func() {\n        for {\n            select {\n            case msg := &lt;-inChan:\n                result = result + msg + \"\\n\"\n            case &lt;-time.After(time.Second * 1):\n                readyChan &lt;- struct{}{}\n            }\n\n        }\n    }()\n\n    &lt;-readyChan\n    close(inChan)\n    return result, nil\n}\n\n//ServiceMiddleware is a chainable thing for the service\ntype ServiceMiddleware func(KafkaService) KafkaService\n</code></pre>\n\n<p>kafka.go:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n\n    \"github.com/Shopify/sarama\"\n)\n\nfunc kafkaRoutine(inChan chan string, topic string, brokers []string) {\n    config := sarama.NewConfig()\n    config.Consumer.Return.Errors = true\n    consumer, err := sarama.NewConsumer(brokers, config)\n    if err != nil {\n        panic(err)\n    }\n\n    topics, _ := consumer.Topics()\n    if !(containsTopic(topics, topic)) {\n        inChan &lt;- \"There is no such a topic\"\n        fmt.Println(\"kafkaroutine exited\")\n        return\n    }\n\n    partitionList, err := consumer.Partitions(topic)\n    for _, partition := range partitionList {\n        pc, _ := consumer.ConsumePartition(topic, partition, sarama.OffsetOldest)\n        go func(pc sarama.PartitionConsumer) {\n        loop:\n            for {\n                select {\n                case msg := &lt;-pc.Messages():\n                    inChan &lt;- string(msg.Value)\n                case &lt;-time.After(time.Second * 1):\n                    break loop\n                }\n            }\n        }(pc)\n    }\n    fmt.Println(\"Kafka GoRoutine exited\")\n}\n\nfunc containsTopic(topics []string, topic string) bool {\n    for _, v := range topics {\n        if topic == v {\n            return true\n        }\n    }\n    return false\n}\n</code></pre>\n"}, {"tags": ["xml", "web-services", "go", "soap"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1510728774, "post_id": 47300735, "comment_id": 81553022, "body": "I fail to parse your question. Do you want to ask &#171;which fields do I put into the <code>GetAllPersons</code> struct type which is the type representing an input request to the &quot;getAllPersons&quot; WS call?&#187;?"}, {"owner": {"reputation": 947, "user_id": 3218674, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/E7ZAV.jpg?s=128&g=1", "display_name": "Gauranga", "link": "https://stackoverflow.com/users/3218674/gauranga"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1510729274, "post_id": 47300735, "comment_id": 81553290, "body": "@kostix: Have made changes to make question clear. I hope that will help."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1510730550, "post_id": 47300735, "comment_id": 81553860, "body": "These strings after the type are called tags (see <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Struct_types</a>) and are used typically during (un)marshalling from serialisation formats like xml."}, {"owner": {"reputation": 2066, "user_id": 6363050, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f9db389fc3801b8ecef05ed3074e2f03?s=128&d=identicon&r=PG&f=1", "display_name": "Samuel Dare", "link": "https://stackoverflow.com/users/6363050/samuel-dare"}, "edited": false, "score": 0, "creation_date": 1511292674, "post_id": 47300735, "comment_id": 81796698, "body": "Did you figure this out? Where did you store your password and user name? Having similar issues"}, {"owner": {"reputation": 947, "user_id": 3218674, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/E7ZAV.jpg?s=128&g=1", "display_name": "Gauranga", "link": "https://stackoverflow.com/users/3218674/gauranga"}, "reply_to_user": {"reputation": 2066, "user_id": 6363050, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/f9db389fc3801b8ecef05ed3074e2f03?s=128&d=identicon&r=PG&f=1", "display_name": "Samuel Dare", "link": "https://stackoverflow.com/users/6363050/samuel-dare"}, "edited": false, "score": 0, "creation_date": 1511328408, "post_id": 47300735, "comment_id": 81809227, "body": "@Data_Kid: Posted answer. Please check."}], "answers": [{"tags": [], "owner": {"reputation": 947, "user_id": 3218674, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/E7ZAV.jpg?s=128&g=1", "display_name": "Gauranga", "link": "https://stackoverflow.com/users/3218674/gauranga"}, "is_accepted": true, "score": 3, "last_activity_date": 1511328380, "creation_date": 1511328380, "answer_id": 47427389, "question_id": 47300735, "link": "https://stackoverflow.com/questions/47300735/making-a-soap-call-with-gowsdl/47427389#47427389", "title": "Making a SOAP call with gowsdl", "body": "<p>Below is the code that I figured out to get things done with the code generated by <code>gowsdl</code>.</p>\n\n<pre><code>main(){\n    basicauth := personService.BasicAuth{\"\",\"\"}\n    service := personService.NewPersonServiceImpl(\"\", false, &amp;basicauth)\n\n    persons, err := service.GetAllPersons(&amp;personService.GetAllPersons{})\n\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(persons)\n    fmt.Printf(\"Alive?: %t\\n\", persons.GetAllPersonsReturn[0].Name)\n    fmt.Printf(\"Alive?: %t\\n\", persons.GetAllPersonsReturn[1].Name)\n    fmt.Printf(\"Alive?: %t\\n\", persons.GetAllPersonsReturn[0].Id)\n    fmt.Printf(\"Alive?: %t\\n\", persons.GetAllPersonsReturn[1].Id)\n    fmt.Printf(\"Alive?: %t\\n\", persons.GetAllPersonsReturn[0].Age)\n    fmt.Printf(\"Alive?: %t\\n\", persons.GetAllPersonsReturn[1].Age)\n    fmt.Printf(persons.GetAllPersonsReturn[0].Name)\n\n    request := &amp;personService.AddPerson{P: &amp;personService.Person{Age: 24, Name: \"Govinda\", Id: 55555555}}\n    trial, err := service.AddPerson(request)\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>For the 2nd question, thanks to Volker for mentioning the answer in comments.\n<code>These strings after the type are called tags (see golang.org/ref/spec#Struct_types) and are used typically during (un)marshalling from serialisation formats like xml</code></p>\n"}], "owner": {"reputation": 947, "user_id": 3218674, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/E7ZAV.jpg?s=128&g=1", "display_name": "Gauranga", "link": "https://stackoverflow.com/users/3218674/gauranga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1113, "favorite_count": 0, "accepted_answer_id": 47427389, "answer_count": 1, "score": 1, "last_activity_date": 1511328380, "creation_date": 1510727191, "last_edit_date": 1510729904, "question_id": 47300735, "link": "https://stackoverflow.com/questions/47300735/making-a-soap-call-with-gowsdl", "title": "Making a SOAP call with gowsdl", "body": "<p>I am using <code>gowsdl</code> to consume a <code>SOAP</code> request in Go. I got <code>WSDL</code> and generated the code using that. In the auto-generated code, it generated stub and some code snippets are mentioned below. </p>\n\n<ol>\n<li><p>I have to make a <code>SOAP</code> call and have to pass <code>GetAllPersons struct</code> as an input to the service. Please help me how do we do that? I have the request <code>xml</code> but dont know how to update that in <code>GetAllPersons struct</code>?</p>\n\n<pre><code>persons, err := service.GetAllPersons(request)\n\ntype GetAllPersons struct {\n    XMLName xml.Name `xml:\"http://service.jaxws.journaldev.com getAllPersons\"`\n}\n</code></pre></li>\n<li><p>And as per Go specification, a variable is declared using the sybtax <code>VariableName Type</code>. What is the 3rd value <code>xml:\"http://service.jaxws.journaldev.com getAllPersons\"</code> in above <code>struct</code>?</p></li>\n</ol>\n"}, {"tags": ["mongodb", "go", "pipe", "aggregate", "mgo"], "comments": [{"owner": {"reputation": 23, "user_id": 8681081, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-s0mfw4w6Kcs/AAAAAAAAAAI/AAAAAAAAAE4/B9brn5sPpeI/photo.jpg?sz=128", "display_name": "\u517b\u7531\u57fa", "link": "https://stackoverflow.com/users/8681081/%e5%85%bb%e7%94%b1%e5%9f%ba"}, "edited": false, "score": 0, "creation_date": 1510723807, "post_id": 47299992, "comment_id": 81551130, "body": "&lt;pre&gt;o1 := bson.M{&quot;_id&quot;: bson.M{&quot;device_id&quot;: &quot;$device_id&quot;}}  o2 := bson.M{&quot;pubtime&quot;: bson.M{&quot;$last&quot;: &quot;$pubtime&quot;}} o3 := bson.M{&quot;$group&quot;: []bson.M{o1, o2}}\tpipe := c.Pipe([]bson.M{o3}) var result []bson.M{} _ = pipe.All(&amp;result) fmt.Println(result)&lt;/pre&gt; It was get empty."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 8681081, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-s0mfw4w6Kcs/AAAAAAAAAAI/AAAAAAAAAE4/B9brn5sPpeI/photo.jpg?sz=128", "display_name": "\u517b\u7531\u57fa", "link": "https://stackoverflow.com/users/8681081/%e5%85%bb%e7%94%b1%e5%9f%ba"}, "edited": false, "score": 0, "creation_date": 1510733482, "post_id": 47301827, "comment_id": 81555384, "body": "Sorry\uff0cI want to know how to do in Golang."}, {"owner": {"reputation": 23, "user_id": 8681081, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-s0mfw4w6Kcs/AAAAAAAAAAI/AAAAAAAAAE4/B9brn5sPpeI/photo.jpg?sz=128", "display_name": "\u517b\u7531\u57fa", "link": "https://stackoverflow.com/users/8681081/%e5%85%bb%e7%94%b1%e5%9f%ba"}, "edited": false, "score": 0, "creation_date": 1510733535, "post_id": 47301827, "comment_id": 81555414, "body": "My Mongodb shell is ok."}], "tags": [], "owner": {"reputation": 4759, "user_id": 2309068, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I4C5d.jpg?s=128&g=1", "display_name": "Clement Amarnath", "link": "https://stackoverflow.com/users/2309068/clement-amarnath"}, "is_accepted": false, "score": 0, "last_activity_date": 1510731496, "creation_date": 1510731496, "answer_id": 47301827, "question_id": 47299992, "link": "https://stackoverflow.com/questions/47299992/how-to-do-that-mongodb-aggregation-in-golang/47301827#47301827", "title": "How to do that Mongodb aggregation in golang", "body": "<p>It can be done using <a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/group/\" rel=\"nofollow noreferrer\">$group</a> and <a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/first/\" rel=\"nofollow noreferrer\">$first</a> in mongodb aggregation pipeline</p>\n\n<p>Mongodb shell query</p>\n\n<pre><code>db.collection.aggregate([\n    {$group: {_id:{device_id:\"$device_id\"}, pubtime:{$first:\"$pubtime\"}}}\n]);\n</code></pre>\n\n<p>The result which we get after executing the above query in mongo shell</p>\n\n<pre><code>{ \"_id\" : { \"device_id\" : \"12222\" }, \"pubtime\" : ISODate(\"2017-11-07T09:41:49.452Z\") }\n{ \"_id\" : { \"device_id\" : \"1111\" }, \"pubtime\" : ISODate(\"2017-11-07T09:40:11.204Z\") }\n{ \"_id\" : { \"device_id\" : \"1232213\" }, \"pubtime\" : ISODate(\"2017-11-07T09:37:37.006Z\") }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 23, "user_id": 8681081, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-s0mfw4w6Kcs/AAAAAAAAAAI/AAAAAAAAAE4/B9brn5sPpeI/photo.jpg?sz=128", "display_name": "\u517b\u7531\u57fa", "link": "https://stackoverflow.com/users/8681081/%e5%85%bb%e7%94%b1%e5%9f%ba"}, "edited": false, "score": 0, "creation_date": 1510737921, "post_id": 47302895, "comment_id": 81557925, "body": "Thx a lot!Thx a lot!Thx a lot!Thx a lot!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1510735838, "last_edit_date": 1510735838, "creation_date": 1510735491, "answer_id": 47302895, "question_id": 47299992, "link": "https://stackoverflow.com/questions/47299992/how-to-do-that-mongodb-aggregation-in-golang/47302895#47302895", "title": "How to do that Mongodb aggregation in golang", "body": "<p>You're not checking the errors, that's your main problem. <code>Pipe.All()</code> returns an error which you gracefully discard. Don't do that.</p>\n\n<pre><code>var result = []bson.M{}\nerr := pipe.All(&amp;result)\nfmt.Println(result, err)\n</code></pre>\n\n<p>This will print:</p>\n\n<pre><code>[] a group's fields must be specified in an object\n</code></pre>\n\n<p>The error says it all. The value of <code>$group</code> must be e.g. a <code>bson.M</code> value, and not a slice of <code>bson.M</code>:</p>\n\n<pre><code>o3 := bson.M{\"$group\": bson.M{\n    \"_id\":     bson.M{\"device_id\": \"$device_id\"},\n    \"pubtime\": bson.M{\"$last\": \"$pubtime\"},\n}}\npipe := c.Pipe([]bson.M{o3})\nvar result = []bson.M{}\nerr := pipe.All(&amp;result)\nfmt.Println(result, err)\n</code></pre>\n\n<p>Now the output will be:</p>\n\n<p><code>[map[_id:map[device_id:12222] pubtime:2017-11-07 10:41:49.452 +0100 CET] map[_id:map[device_id:1111] pubtime:2017-11-07 10:40:11.204 +0100 CET] map[_id:map[device_id:1232213] pubtime:2017-11-07 10:42:13.658 +0100 CET]] &lt;nil&gt;</code></p>\n\n<p>So it works.</p>\n\n<p>And to make the results sorted by <code>pubtime</code>, use <code>$sort</code>. Here's the final code:</p>\n\n<pre><code>pipe := c.Pipe([]bson.M{\n    {\n        \"$group\": bson.M{\n            \"_id\":     bson.M{\"device_id\": \"$device_id\"},\n            \"pubtime\": bson.M{\"$last\": \"$pubtime\"},\n        },\n    },\n    {\"$sort\": bson.M{\"pubtime\": 1}},\n})\nvar result = []bson.M{}\nerr := pipe.All(&amp;result)\nfmt.Println(result, err)\n</code></pre>\n\n<p>If you want the results sorted in descending order, then use:</p>\n\n<pre><code>{\"$sort\": bson.M{\"pubtime\": -1}}\n</code></pre>\n\n<p>Also note that when grouping, if the group <code>_id</code> is a single field, you don't need to wrap it into an object, you can simply use <code>$device_id</code> as the group id:</p>\n\n<pre><code>\"$group\": bson.M{\n    \"_id\":     \"$device_id\",\n    \"pubtime\": bson.M{\"$last\": \"$pubtime\"},\n},\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 8681081, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-s0mfw4w6Kcs/AAAAAAAAAAI/AAAAAAAAAE4/B9brn5sPpeI/photo.jpg?sz=128", "display_name": "\u517b\u7531\u57fa", "link": "https://stackoverflow.com/users/8681081/%e5%85%bb%e7%94%b1%e5%9f%ba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1164, "favorite_count": 0, "accepted_answer_id": 47302895, "answer_count": 2, "score": 2, "last_activity_date": 1510735838, "creation_date": 1510723628, "last_edit_date": 1510735582, "question_id": 47299992, "link": "https://stackoverflow.com/questions/47299992/how-to-do-that-mongodb-aggregation-in-golang", "title": "How to do that Mongodb aggregation in golang", "body": "<p>I have a MongoDB collection like this:</p>\n\n<pre><code>{ \"_id\" : ObjectId(\"5a017ee061313781045889ea\"),  \"device_id\" : \"1232213\",   \"value\" : \"23233\", \"pubtime\" : ISODate(\"2017-11-07T09:37:37.006Z\") }\n{ \"_id\" : ObjectId(\"5a017f7b61313781045889eb\"),  \"device_id\" : \"1111\",   \"value\" : \"23233\", \"pubtime\" : ISODate(\"2017-11-07T09:40:11.204Z\") }\n{ \"_id\" : ObjectId(\"5a017fdd61313781045889ec\"),  \"device_id\" : \"12222\",   \"value\" : \"23233\", \"pubtime\" : ISODate(\"2017-11-07T09:41:49.452Z\") }\n{ \"_id\" : ObjectId(\"5a017ff561313781045889ed\"),  \"device_id\" : \"1232213\",   \"value\" : \"23233\", \"pubtime\" : ISODate(\"2017-11-07T09:42:13.658Z\") }\n</code></pre>\n\n<p>I want to distinct it by <code>\"device_id\"</code> AND sort it by <code>\"pubtime\"</code>.</p>\n\n<p>I know that Golang could use pipe to do it. But I don't know how to do it. What I tried:</p>\n\n<pre><code>o1 := bson.M{\"_id\": bson.M{\"device_id\": \"$device_id\"}}\n\no2 := bson.M{\"pubtime\": bson.M{\"$last\": \"$pubtime\"}}\no3 := bson.M{\"$group\": []bson.M{o1, o2}}\npipe := c.Pipe([]bson.M{o3})\nvar result = []bson.M{}\n_ = pipe.All(&amp;result)\nfmt.Println(result)\n</code></pre>\n\n<p>The result is empty.</p>\n\n<p>It is ok in MongoDB:</p>\n\n<pre><code>db.collections.aggregate({\"$group\":\n                        {\"_id\":{\"device_id\":\"$device_id\"},\n                        \"pubtime\":{\"$last\": \"$pubtime\"} ,\n                       \"value\":{\"$last\": \"$value\"} ,\n                        }});\n</code></pre>\n"}, {"tags": ["go", "iteration"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1510721703, "post_id": 47299504, "comment_id": 81550396, "body": "Declare <code>Admins</code> and <code>Regulars</code> as a concrete type so you can avoid type assertions when inserting into the tables."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 3, "creation_date": 1510721715, "post_id": 47299504, "comment_id": 81550397, "body": "What about that method doesn&#39;t feel right to you? Are you thinking you could do this without having three separate loops? Also, why are <code>Admins</code> and <code>Regulars</code> slices of empty interface instead of slices of some type?"}, {"owner": {"reputation": 473, "user_id": 3314232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S3Bym.jpg?s=128&g=1", "display_name": "Saeed Falsafin", "link": "https://stackoverflow.com/users/3314232/saeed-falsafin"}, "edited": false, "score": 0, "creation_date": 1510728869, "post_id": 47299504, "comment_id": 81553080, "body": "You can use <a href=\"https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;uact=8&amp;ved=0ahUKEwi0grWu_7_XAhUCtxQKHUhNCEgQFggnMAA&amp;url=https%3A%2F%2Fgithub.com%2Fjinzhu%2Fgorm&amp;usg=AOvVaw2jjszk_MAcWnVY3dnZYIFW\" rel=\"nofollow noreferrer\">GORM</a> ORM, It supports structs for models and you can insert whole object to the database."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1510734127, "post_id": 47299504, "comment_id": 81555725, "body": "Apart from the suggestion by @CeriseLim&#243;n, you could have CRUD methods for interaction with the database which could make it look cleaner."}, {"owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1510747186, "post_id": 47299504, "comment_id": 81563882, "body": "@AndySchweig It just feels taxing I guess. I would avoid this method completely in javascript because of speed. Also I believe that&#39;s a mistake I will fix it right away."}, {"owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "reply_to_user": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1510747398, "post_id": 47299504, "comment_id": 81564020, "body": "@Ravi I&#39;m not sure if I understood you correctly or not but I do have CRUD type methods for inserting users with roles and whatnot (unless that&#39;s not what you meant), it&#39;s just the three separate loops that doesn&#39;t feel right"}, {"owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1510747524, "post_id": 47299504, "comment_id": 81564094, "body": "@AndySchweig As an example, in javascript I would use an object loop and the role would be the key and the name would be the value and it&#39;s very compact and I only have to use the Insert queries once each (in code)."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 1, "creation_date": 1510758567, "post_id": 47299504, "comment_id": 81572168, "body": "If the role is the only thing that&#39;s different for the three lists of users, you could write a function that takes  a slice of strings and the role as arguments and call that for each list. That seems pretty obvious, though, so maybe it&#39;s more complicated than that...?"}, {"owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1510759176, "post_id": 47299504, "comment_id": 81572648, "body": "@AndySchweig Could you mock up a simple function like that for me, or point me in the right direction to do something similar. Structs and slices are new to me so any help is appreciated. I unfortunately don&#39;t learn well from the documentation, although they did a good job writing the docs I learn best from relevant examples."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1510808941, "post_id": 47299504, "comment_id": 81594884, "body": "@AndySchweig has shown the way for what I meant, for insert (Create) - one method to insert. Same for other CRUD operations."}], "answers": [{"tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 1, "last_activity_date": 1510770965, "creation_date": 1510770965, "answer_id": 47314869, "question_id": 47299504, "link": "https://stackoverflow.com/questions/47299504/iterate-over-struct-and-perform-database-queries/47314869#47314869", "title": "Iterate over struct and perform database queries", "body": "<p>Would something like this be better?</p>\n\n<pre><code>v := getSiteUsers(&amp;usrs, website)\n\ninsertUsers := func(users []string, role roleType) {\n    for _, user := range users {\n        // Insert into user table\n        // Insert into user table with given role\n    }\n}\n\ninsertUsers(v.Active.Moderators, moderatorRole)\ninsertUsers(v.Active.Admins, adminRole)\ninsertUsers(v.Active.Regulars, regularRole)\n</code></pre>\n"}], "owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 47314869, "answer_count": 1, "score": 0, "last_activity_date": 1510770965, "creation_date": 1510721097, "last_edit_date": 1510747208, "question_id": 47299504, "link": "https://stackoverflow.com/questions/47299504/iterate-over-struct-and-perform-database-queries", "title": "Iterate over struct and perform database queries", "body": "<p>So I'm new to go and I come from a javascript/node background and for practice, I've been rewriting some of my javascript code into go.</p>\n\n<p>I have a situation where I have an struct (in node it was my object) and I need to iterate over it and perform two database queries. I have something that works but it seems costly and repetitive.</p>\n\n<p><strong>Struct:</strong></p>\n\n<pre><code>type SiteUsers struct {\n    Active struct {\n        Moderators []string `json:\"moderators\"`\n        Admins     []string `json:\"admins\"`\n        Regulars   []string `json:\"regulars\"`\n    } `json:\"active\"`\n}\n</code></pre>\n\n<p>Then in the function where I handle an api request that returns JSON binded to this struct I use a for range loop for each role under active. For each one I perform the same first query and then a second one that is specific to each one.</p>\n\n<pre><code>v := getSiteUsers(&amp;usrs, website)\n\nfor _, moderators := range v.Active.Moderators {\n    // Insert into user table\n    // Insert into user table with role of moderator\n}\n\nfor _, admins := range v.Active.Admins {\n    // Insert into user table\n    // Insert into user table with role of admin\n}\n\nfor _, regulars := range v.Active.Regulars {\n    // Insert into user table\n    // Insert into user table with role of regular\n}\n</code></pre>\n\n<p>This method will work but it doesn't feel completely right and I would love to get some input from people experienced with go.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1510739577, "post_id": 47300994, "comment_id": 81558979, "body": "Your example is missing the package import statement which brings that <code>quotedprintable</code> symbol into the scope."}, {"owner": {"reputation": 169, "user_id": 3838144, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1e04ca54aa48f9dd43dbbf4dd7a451f9?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul", "link": "https://stackoverflow.com/users/3838144/rahul"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1510741758, "post_id": 47300994, "comment_id": 81560355, "body": "i just put the function only"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1510742585, "post_id": 47300994, "comment_id": 81560911, "body": "That&#39;s exactly what I wanted to highlight: as present, your answer is only 50% useful (or lower)."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 721, "user_id": 8930534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0277bb31c0a6d6334cf3d287289bc17?s=128&d=identicon&r=PG&f=1", "display_name": "Hugh", "link": "https://stackoverflow.com/users/8930534/hugh"}, "edited": false, "score": 2, "creation_date": 1510745485, "post_id": 47300994, "comment_id": 81562792, "body": "The use of the non-standard errors package is a distraction to the answer (thank you @Hugh for adding the import path to the errors package in an edit)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1510755464, "post_id": 47300994, "comment_id": 81569679, "body": "Definitely agree with @CeriseLim&#243;n on this - there&#39;s absolutely no reason to go outside the stdlib for this answer."}], "tags": [], "owner": {"reputation": 169, "user_id": 3838144, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1e04ca54aa48f9dd43dbbf4dd7a451f9?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul", "link": "https://stackoverflow.com/users/3838144/rahul"}, "is_accepted": true, "score": 1, "last_activity_date": 1510745257, "last_edit_date": 1510745257, "creation_date": 1510728322, "answer_id": 47300994, "question_id": 47299375, "link": "https://stackoverflow.com/questions/47299375/how-to-get-a-quoted-printable-string-in-golang/47300994#47300994", "title": "How to get a quoted printable string in golang", "body": "<p>Use the <a href=\"https://godoc.org/mime/quotedprintable\" rel=\"nofollow noreferrer\">standard quotedprintable package</a> to encode the string:</p>\n\n<pre><code>...\n\nimport (\n    \"bytes\"\n    \"mime/quotedprintable\"\n    \"github.com/pkg/errors\"\n)\n\n...\n\nfunc toQuotedPrintable(s string) (string, error) {\n    var ac bytes.Buffer\n    w := quotedprintable.NewWriter(&amp;ac)\n    _, err := w.Write([]byte(s))\n    if err != nil {\n        return \"\", errors.Wrap(err, \"write\")\n    }\n    err = w.Close()\n    if err != nil {\n        return \"\", errors.Wrap(err, \"close\")\n    }\n    return ac.String(), nil\n}\n</code></pre>\n"}], "owner": {"reputation": 169, "user_id": 3838144, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/1e04ca54aa48f9dd43dbbf4dd7a451f9?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul", "link": "https://stackoverflow.com/users/3838144/rahul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 576, "favorite_count": 0, "accepted_answer_id": 47300994, "answer_count": 1, "score": 0, "last_activity_date": 1510745257, "creation_date": 1510720209, "last_edit_date": 1510728654, "question_id": 47299375, "link": "https://stackoverflow.com/questions/47299375/how-to-get-a-quoted-printable-string-in-golang", "title": "How to get a quoted printable string in golang", "body": "<p>How to get a quoted printable string created according to \u00bb RFC2045, section 6.7. in golang</p>\n\n<p>PHP equivalent is \"quoted_printable_encode ( string $str )\"</p>\n"}, {"tags": ["http", "go", "cors"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1510712633, "post_id": 47298310, "comment_id": 81548199, "body": "Check the request <code>host</code> header and serve the response correspondingly."}, {"owner": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1510713102, "post_id": 47298310, "comment_id": 81548315, "body": "How do I do that? Do you have any examples?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1510713194, "post_id": 47298310, "comment_id": 81548339, "body": "<a href=\"https://stackoverflow.com/q/42921567/251311\">stackoverflow.com/q/42921567/251311</a>"}, {"owner": {"reputation": 89146, "user_id": 211563, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d32a10a2f047dec1e5582e74cba6b3ec?s=128&d=identicon&r=PG", "display_name": "Andrew Marshall", "link": "https://stackoverflow.com/users/211563/andrew-marshall"}, "edited": false, "score": 1, "creation_date": 1510713579, "post_id": 47298310, "comment_id": 81548432, "body": "FWIW, setting the same header multiple times won\u2019t work with <a href=\"https://golang.org/pkg/net/http/#Header.Set\" rel=\"nofollow noreferrer\"><code>Header.Set()</code></a> as it replaces any previously set values. Instead use <a href=\"https://golang.org/pkg/net/http/#Header.Add\" rel=\"nofollow noreferrer\"><code>Header.Add()</code></a>."}, {"owner": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "edited": false, "score": 0, "creation_date": 1510715449, "post_id": 47298310, "comment_id": 81548852, "body": "No that doesn&#39;t work. Now it says      The &#39;Access-Control-Allow-Origin&#39; header contains multiple values"}, {"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 0, "creation_date": 1510756830, "post_id": 47298310, "comment_id": 81570800, "body": "If you want both try this: <code>w.Header().Set(&quot;Access-Control-Allow-Origin&quot;, &quot;http:&#47;&#47;www.example.com http:&#47;&#47;example.com&quot;)</code> - space as separator instead of a comma. According to <a href=\"https://www.w3.org/TR/cors/#access-control-allow-origin-response-header\" rel=\"nofollow noreferrer\">this</a> the list is space separated."}, {"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1510757339, "post_id": 47298310, "comment_id": 81571208, "body": "Apparently &#39;Neither comma separated, nor space separated domains did work. Matching against a list of domains and putting a single host in the headers is still better security and does work properly.&#39; So back to @zerkms comments. see <a href=\"https://stackoverflow.com/questions/25309318/best-method-access-control-allow-origin-multiple-origin-domains\">here</a>"}, {"owner": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "edited": false, "score": 0, "creation_date": 1510757748, "post_id": 47298310, "comment_id": 81571555, "body": "Yeah it still complains about multiple headers. I feel like that would be the ideal sollution. I did finally figure it out this morning. The information I want is in the http.request object earlier in the code. Assuming you have an object  r *http.Request, you can then get the origin like this origin := r.Header.Get(&quot;Origin&quot;); So I&#39;m just returning an empty object on each api call if it isn&#39;t the correct origin."}], "answers": [{"tags": [], "owner": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "is_accepted": true, "score": 2, "last_activity_date": 1510758748, "creation_date": 1510758748, "answer_id": 47310903, "question_id": 47298310, "link": "https://stackoverflow.com/questions/47298310/golang-http-allow-certain-domain-name-both-with-www-and-without/47310903#47310903", "title": "golang http allow certain domain name both with www and without", "body": "<p>I found that the Origin information is in the http.Request object. You can get the origin  with </p>\n\n<pre><code>origin := r.Header.Get(\"Origin\");\n</code></pre>\n\n<p>Assuming you have a object some where like</p>\n\n<pre><code>r *http.Request\n</code></pre>\n\n<p>If the object is coming from example.com it will return example.com, likewise www.example.com. You can then test if it is one of these two values as a way to authenticate. </p>\n"}, {"comments": [{"owner": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "edited": false, "score": 0, "creation_date": 1510759133, "post_id": 47310926, "comment_id": 81572598, "body": "It&#39;s r.Header.Get(&quot;Origin&quot;) Not Host"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "edited": false, "score": 0, "creation_date": 1510759403, "post_id": 47310926, "comment_id": 81572839, "body": "Those headers serve different purposes. See <a href=\"https://tools.ietf.org/html/rfc7230#section-5.4\" rel=\"nofollow noreferrer\">RFC7230</a> for a description of the Host header."}, {"owner": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "edited": false, "score": 0, "creation_date": 1510759690, "post_id": 47310926, "comment_id": 81573065, "body": "I just tested it and Host is returning an empty string, origin is returning what I asked for, the origin..."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 0, "last_activity_date": 1510758810, "creation_date": 1510758810, "answer_id": 47310926, "question_id": 47298310, "link": "https://stackoverflow.com/questions/47298310/golang-http-allow-certain-domain-name-both-with-www-and-without/47310926#47310926", "title": "golang http allow certain domain name both with www and without", "body": "<p>The Access-Control-Allow-Origin header supports only a single value, so you have to inspect the Host request header and then make a decision based on that:</p>\n\n<pre><code>package main\n\nimport \"net/http\"\n\nfunc myHandler(w http.ResponseWriter, r *http.Request) {\n    switch host := r.Header.Get(\"Host\"); host {\n    case \"www.example.com\", \"example.com\":\n            w.Header().Set(\"Access-Control-Allow-Origin\", \"http://\"+host)\n    }\n}\n</code></pre>\n\n<p>Not that the Host header is sometimes changed by proxy servers. They then usually add an X-Forwarded-Host header or similar. Only inspect that if you trust the proxy, though (and how to establish that trust is a different question).</p>\n"}], "owner": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1982, "favorite_count": 0, "accepted_answer_id": 47310903, "answer_count": 2, "score": 0, "last_activity_date": 1510758810, "creation_date": 1510712083, "question_id": 47298310, "link": "https://stackoverflow.com/questions/47298310/golang-http-allow-certain-domain-name-both-with-www-and-without", "title": "golang http allow certain domain name both with www and without", "body": "<p>I have a golang api I'm writting. I use the following function for cors</p>\n\n<pre><code>func ResponseWithJSON(w http.ResponseWriter, json []byte, code int) {\n    w.Header().Set(\"Content-Type\", \"application/json; charset=utf-8\")\n    w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    w.WriteHeader(code)\n    w.Write(json)\n}\n</code></pre>\n\n<p>This allows my api to be accessible by anyone. I would like to limit it to my domain name. Because that sounds more secure. Lets call it www.example.com</p>\n\n<p>I can Change it to </p>\n\n<pre><code> w.Header().Set(\"Access-Control-Allow-Origin\", \"http://www.example.com\")\n</code></pre>\n\n<p>And this will allow me to make calls when the url is www.example.com but not example.com</p>\n\n<p>I can then change it to </p>\n\n<pre><code>w.Header().Set(\"Access-Control-Allow-Origin\", \"http://example.com\")\n</code></pre>\n\n<p>Now I can access my api from example.com but not www.example.com</p>\n\n<p>Adding both does not work\nNeither this way</p>\n\n<pre><code>w.Header().Set(\"Access-Control-Allow-Origin\", \"http://www.example.com,http://example.com\")\n</code></pre>\n\n<p>Nor This way</p>\n\n<pre><code>w.Header().Set(\"Access-Control-Allow-Origin\", \"http://www.example.com\")\nw.Header().Set(\"Access-Control-Allow-Origin\", \"http://example.com\")\n</code></pre>\n\n<p>So, is there a way for me to get the requesting origin? so I can dynamically allow the domain? Is there another way for me to solve this problem? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1510711739, "post_id": 47298227, "comment_id": 81548014, "body": "None of those are &quot;high traffic&quot; functions that are going to be impacted by a few <i>nonaseconds</i> of delay for the benefit of consistency."}, {"owner": {"reputation": 1657, "user_id": 2864464, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c606da71fcfa488180a8d81c8fdcc7b4?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Kohler", "link": "https://stackoverflow.com/users/2864464/alexander-kohler"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1510712436, "post_id": 47298227, "comment_id": 81548161, "body": "I guess I wasn&#39;t necessarily saying that these functions were &quot;high traffic&quot;, it was more of a follow-up of why I felt it was weird. When you say consistency, you mean the consistency of <i>always</i> deferring the unlock of a mutex, for example?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510724147, "post_id": 47298227, "comment_id": 81551233, "body": "&quot;and <b>presumably</b> no way to panic&quot;. Assumption based programming is a good way to hurt yourself."}, {"owner": {"reputation": 1657, "user_id": 2864464, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c606da71fcfa488180a8d81c8fdcc7b4?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Kohler", "link": "https://stackoverflow.com/users/2864464/alexander-kohler"}, "edited": false, "score": 0, "creation_date": 1510745840, "post_id": 47298227, "comment_id": 81563001, "body": "Oh, certainly!! I made the assumption for the sake of asking the question, otherwise I can understand why the defer was there."}], "answers": [{"comments": [{"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 1, "creation_date": 1510717322, "post_id": 47298429, "comment_id": 81549252, "body": "Generally you need to have a <i>very</i> good reason <i>not</i> to defer functions like this. Panics happen where you least expect them sometimes, and it is always better safe than sorry."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 8, "last_activity_date": 1568184998, "last_edit_date": 1568184998, "creation_date": 1510713054, "answer_id": 47298429, "question_id": 47298227, "link": "https://stackoverflow.com/questions/47298227/are-there-any-advantages-to-having-a-defer-in-a-simple-no-return-non-panicking/47298429#47298429", "title": "Are there any advantages to having a defer in a simple, no return, non-panicking function?", "body": "<p>Always deferring things like <code>Mutex.Unlock()</code> and <code>WaitGroup.Done()</code> at the top of the function makes debugging and maintenance easier, since you see immediately that those pieces are handled correctly so you know that those important pieces are taken care of, and can quickly move on to other issues. </p>\n\n<p>It's not a big deal in 3 line functions, but consistent-looking code is also just easier to read in general. Then as the code grows, you don't have to worry about adding an expression that may panic, or complicated early return logic, because the pre-existing defers will always work correctly.</p>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 2, "last_activity_date": 1510724863, "creation_date": 1510724863, "answer_id": 47300239, "question_id": 47298227, "link": "https://stackoverflow.com/questions/47298227/are-there-any-advantages-to-having-a-defer-in-a-simple-no-return-non-panicking/47300239#47300239", "title": "Are there any advantages to having a defer in a simple, no return, non-panicking function?", "body": "<p>Panic is a sudden (so it could be unpredicted or unprepared) violation of normal control flow. Potentially it can emerge from anything - quite often from external things - for example memory failure. <code>defer</code> mechanism gives an easy and quite cheap tool to perform exit operation. Thus not leave a system in broken state. This is important for locks in high load applications  because it help not to lose locked resources and freeze the whole system in lock once. </p>\n\n<p>And if for some moment code has no places for panic (hard to guess such system ;) but things evolve. Later this function would be more complex and able to throw panic. </p>\n\n<p>Conclusion: Defer helps you to ensure your function will exit correctly if something \u201cgoes wring\u201d. Also quite important it is future-proof - same reply for different failures. </p>\n\n<p>So it\u2019s a food style to put them even in easy functions. As a programmer you can see nothing is lost. And be more sure in a code. </p>\n"}], "owner": {"reputation": 1657, "user_id": 2864464, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c606da71fcfa488180a8d81c8fdcc7b4?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Kohler", "link": "https://stackoverflow.com/users/2864464/alexander-kohler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 0, "accepted_answer_id": 47298429, "answer_count": 2, "score": 5, "last_activity_date": 1568184998, "creation_date": 1510711422, "last_edit_date": 1510714152, "question_id": 47298227, "link": "https://stackoverflow.com/questions/47298227/are-there-any-advantages-to-having-a-defer-in-a-simple-no-return-non-panicking", "title": "Are there any advantages to having a defer in a simple, no return, non-panicking function?", "body": "<p>Going through the standard library, I see a lot functions similar to the following:</p>\n\n<pre><code>// src/database/sql/sql.go\nfunc (dc *driverConn) removeOpenStmt(ds *driverStmt) {\n    dc.Lock()\n    defer dc.Unlock()\n    delete(dc.openStmt, ds)\n}\n...\n\nfunc (db *DB) addDep(x finalCloser, dep interface{}) {\n    //println(fmt.Sprintf(\"addDep(%T %p, %T %p)\", x, x, dep, dep))\n    db.mu.Lock()\n    defer db.mu.Unlock()\n    db.addDepLocked(x, dep)\n}\n// src/expvar/expvar.go\nfunc (v *Map) addKey(key string) {\n    v.keysMu.Lock()\n    defer v.keysMu.Unlock()\n    v.keys = append(v.keys, key)\n    sort.Strings(v.keys)\n}\n// etc...\n</code></pre>\n\n<p>I.e.: simple functions with no returns and presumably no way to panic that are still deferring the unlock of their mutex. As I understand it, the overhead of a <code>defer</code> has been improved (and perhaps is still in the process of being improved), but that being said: <strong>Is there any reason to include a <code>defer</code> in functions like these?  Couldn't these types of defers end up slowing down a high traffic function?</strong></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1510761794, "post_id": 47297579, "comment_id": 81574780, "body": "What&#39;s stopping you from keeping multiple *sql.DBs around, one for each database?"}], "answers": [{"comments": [{"owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1510736875, "post_id": 47301358, "comment_id": 81557339, "body": "Please upvote the question if you are also interested in an answer like me, thanks :)"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1510767598, "post_id": 47301358, "comment_id": 81578631, "body": "What do you think of? Also I see a place for separate connection pooler"}, {"owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1510784751, "post_id": 47301358, "comment_id": 81587887, "body": "Perhaps having a map with serverID and pointer to sql.DB as you suggested is a good solution."}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 0, "last_activity_date": 1510729788, "creation_date": 1510729788, "answer_id": 47301358, "question_id": 47297579, "link": "https://stackoverflow.com/questions/47297579/how-do-you-use-go-sql-driver-when-you-have-a-sharded-mysql-database-solution/47301358#47301358", "title": "How do you use go-sql-driver when you have a sharded MySQL database solution?", "body": "<p>I am also interested in the question. I guess there could be such solution:</p>\n\n<ol>\n<li><p>Minimize number of idle connection in pool <code>db.SerMaxIdleConns(N)</code></p></li>\n<li><p>Make <code>map[serverID]*sql.DB</code>. When you have no such connection - add it to map. </p></li>\n<li><p>Make Dara more local - so backends usually go to \u201ctheir\u201d databases. However Pinterest seems not to use it. </p></li>\n<li><p>Increase number of sockets and files on backend machines so they can keep more open connections. </p></li>\n<li><p>Provide some reasonable idle timeout so very old unused connections could be closed. </p></li>\n</ol>\n"}], "owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 47301358, "answer_count": 1, "score": 1, "last_activity_date": 1510729788, "creation_date": 1510706139, "question_id": 47297579, "link": "https://stackoverflow.com/questions/47297579/how-do-you-use-go-sql-driver-when-you-have-a-sharded-mysql-database-solution", "title": "How do you use go-sql-driver when you have a sharded MySQL database solution?", "body": "<p>Reading this article: <a href=\"http://go-database-sql.org/accessing.html\" rel=\"nofollow noreferrer\">http://go-database-sql.org/accessing.html</a></p>\n\n<p>It says that the sql.DB object is designed to be long-lived and that we should not Open() and Close() databases frequently. But what should I do if I have 10 different MySQL servers and I have sharded them in a way that I have 511 databases in each server for example the way Pinterest shards their data with MySQL?</p>\n\n<p><a href=\"https://medium.com/@Pinterest_Engineering/sharding-pinterest-how-we-scaled-our-mysql-fleet-3f341e96ca6f\" rel=\"nofollow noreferrer\">https://medium.com/@Pinterest_Engineering/sharding-pinterest-how-we-scaled-our-mysql-fleet-3f341e96ca6f</a></p>\n\n<p>Then would I not need to constantly access new nodes with new databases all the time? As I understand then I have to Open and Close the database connection all the time depending on which node and database I have to access.</p>\n\n<p>It also says that:</p>\n\n<blockquote>\n  <p>If you don\u2019t treat the sql.DB as a long-lived object, you could\n  experience problems such as poor reuse and sharing of connections,\n  running out of available network resources, or sporadic failures due\n  to a lot of TCP connections remaining in TIME_WAIT status. Such\n  problems are signs that you\u2019re not using database/sql as it was\n  designed.</p>\n</blockquote>\n\n<p>Will this be a problem? How should I solve this issue then?</p>\n"}, {"tags": ["pointers", "go"], "answers": [{"tags": [], "owner": {"reputation": 426981, "user_id": 596781, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a18405dd4b022837867d1f5453a05f41?s=128&d=identicon&r=PG", "display_name": "Kerrek SB", "link": "https://stackoverflow.com/users/596781/kerrek-sb"}, "is_accepted": false, "score": 7, "last_activity_date": 1510698825, "creation_date": 1510698825, "answer_id": 47296358, "question_id": 47296325, "link": "https://stackoverflow.com/questions/47296325/passing-by-reference-and-value-in-go-to-functions/47296358#47296358", "title": "Passing by reference and value in Go to functions", "body": "<p>The purpose of reference semantics is to allow a function to manipulate data outside its own scope. Compare:</p>\n\n<pre><code>func BrokenSwap(a int, b int) {\n  a, b = b, a\n}\n\nfunc RealSwap(a *int, b *int) {\n  *a, *b = *b, *a\n}\n</code></pre>\n\n<p>When you call <code>BrokenSwap(x, y)</code>, there is no effect, because the function receives and manipulates a private copy of the data. By contrast, when you call <code>RealSwap(&amp;x, &amp;y)</code>, you actually exchange the values of the <em>caller's</em> <code>x</code> and <code>y</code>. Taking the address of the variables explicitly at the call site informs the reader that those variables may be mutated.</p>\n"}, {"comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1510699146, "post_id": 47296376, "comment_id": 81544157, "body": "Another reason pointers are passed is to reduce the size of the value being passed.  A pointer is a single machine word (4 or 8 bytes, depending on your system architecture) in size.  A sql.DB is a structure that it up to around 180 bytes in size.  That&#39;s a lot of data to copy into a function call."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 2, "creation_date": 1510699245, "post_id": 47296376, "comment_id": 81544200, "body": "180b really isn&#39;t that much but yes, that is a valid reason in some cases to use pointers. In general I would not use that reasoning unless profiling indicated it solved a real problem. Premature optimization, root of all evil, yadda yadda."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1510703597, "post_id": 47296376, "comment_id": 81545802, "body": "@Kaedys: 180 bytes is pretty insignificant. A single cache line is basically free, and most common CPUs transfer up to 8 lines in a single burst. Simply dereferencing a pointer may take much longer, or not, it depends on the data locality and cache state. I&#39;ve optimized many pieces of code by removing pointers. Use a pointer for its functionality first and foremost."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510755861, "post_id": 47296376, "comment_id": 81569991, "body": "I didn&#39;t mention memory savings in the answer because it sounds like a newer Go developer was asking, and it&#39;s easy for advice like that to lead to overuse or misuse of a feature. While there are certainly cases where it <i>might</i> help to save memory by passing a pointer, those cases are rare and should be found through direct measurement. For someone learning the language, I think it&#39;s better not to consider that a reason to use a pointer, and just focus on pointer semantics as the reason to use them."}, {"owner": {"reputation": 824, "user_id": 36821, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d46e74f575bd0417b5cb638202ec99d4?s=128&d=identicon&r=PG", "display_name": "krulik", "link": "https://stackoverflow.com/users/36821/krulik"}, "edited": false, "score": 1, "creation_date": 1583922866, "post_id": 47296376, "comment_id": 107272517, "body": "@Adrian Java also passes by value always"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 824, "user_id": 36821, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d46e74f575bd0417b5cb638202ec99d4?s=128&d=identicon&r=PG", "display_name": "krulik", "link": "https://stackoverflow.com/users/36821/krulik"}, "edited": false, "score": 1, "creation_date": 1583930533, "post_id": 47296376, "comment_id": 107276621, "body": "@krulik that&#39;s one way to look at it, but an unhelpful one for most developers. Since <i>all objects in Java are references</i>, any time you pass an object, you&#39;re <i>passing a reference</i>. Therefore, pass-by-reference semantics apply to the vast majority of Java code."}, {"owner": {"reputation": 824, "user_id": 36821, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d46e74f575bd0417b5cb638202ec99d4?s=128&d=identicon&r=PG", "display_name": "krulik", "link": "https://stackoverflow.com/users/36821/krulik"}, "edited": false, "score": 1, "creation_date": 1584031605, "post_id": 47296376, "comment_id": 107318508, "body": "@Adrian there&#39;s no difference between Java semantics and Go semantics in this case. You pass the reference by value in both languages. In both languages this value is stored in a new variable."}, {"owner": {"reputation": 17430, "user_id": 309483, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/d797538504a367f277d19bd8369e9a19?s=128&d=identicon&r=PG", "display_name": "Janus Troelsen", "link": "https://stackoverflow.com/users/309483/janus-troelsen"}, "edited": false, "score": 0, "creation_date": 1602261734, "post_id": 47296376, "comment_id": 113674953, "body": "Since slices are always references, I think it becomes confusing to say that Go does not have references. You could say &quot;the slice itself is a value&quot;, but that is not helpful, since if you assign a value of it, you&#39;re not manipulating a copy. Since there is no pointer syntax, it is also confusing to claim that a slice is &quot;actually a pointer&quot;."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 23, "last_activity_date": 1510699612, "last_edit_date": 1510699612, "creation_date": 1510698890, "answer_id": 47296376, "question_id": 47296325, "link": "https://stackoverflow.com/questions/47296325/passing-by-reference-and-value-in-go-to-functions/47296376#47296376", "title": "Passing by reference and value in Go to functions", "body": "<p>First, Go technically has only pass-by-value. When passing a pointer to an object, you're passing a pointer by value, not passing an object by reference. The difference is subtle but occasionally relevant. For example, you can overwrite the pointer value which has no impact on the caller, as opposed to dereferencing it and overwriting the memory it points to.</p>\n\n<pre><code>// *int means you *must* pass a *int (pointer to int), NOT just an int!\nfunc someFunc(x *int) {\n    *x = 2 // Whatever variable caller passed in will now be 2\n    y := 7\n    x = &amp;y // has no impact on the caller because we overwrote the pointer value!\n}\n</code></pre>\n\n<p>As to your question \"Why do we need to have the asterisk in front of the type?\": The asterisk indicates that the value is of type pointer to <code>sql.DB</code>, rather than a value of type <code>sql.DB</code>. These are not interchangeable!</p>\n\n<p>Why would you want to send a pointer address? So that you can share the value between the caller of a function and the function body, with changes made inside the function reflected in the caller (for example, a pointer is the <em>only way</em> that a \"setter\" method can work on an object). While Java passes objects by reference always, Go passes by value always (i.e. it creates a <em>copy</em> of the value in the function); if you pass something to a function, and that function modifies that value, the caller won't see those changes. If you want changes to propogate outside the function, you must pass a pointer.</p>\n\n<p>See also: the <a href=\"https://tour.golang.org/moretypes/1\" rel=\"noreferrer\">Go tour section on Pointers</a>, the <a href=\"https://golang.org/ref/spec#Pointer_types\" rel=\"noreferrer\">Go spec section on pointers</a>, the <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"noreferrer\">Go spec section on the address operators</a></p>\n"}], "owner": {"reputation": 1591, "user_id": 7304216, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7948f2563d2a2d276561b3a05c357150?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Pocock", "link": "https://stackoverflow.com/users/7304216/nick-pocock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5729, "favorite_count": 5, "accepted_answer_id": 47296376, "answer_count": 2, "score": 7, "last_activity_date": 1510699612, "creation_date": 1510698615, "question_id": 47296325, "link": "https://stackoverflow.com/questions/47296325/passing-by-reference-and-value-in-go-to-functions", "title": "Passing by reference and value in Go to functions", "body": "<p>I am a bit confused about passing by reference and value in Go.</p>\n\n<p>I've seen this explained of the * in front of a type.</p>\n\n<blockquote>\n  <ul>\n  <li>in front of a type name, means that the declared variable will store an address of another variable of that type (not a value of that\n  type).</li>\n  </ul>\n</blockquote>\n\n<p>This just doesn't make sense to me.</p>\n\n<p>In Java if I was passing a Database instance into a function I would do </p>\n\n<pre><code> databaseFunction(DatabaseType db) {\n      // do something\n}\n</code></pre>\n\n<p>However in the go example I have it's passed like so.</p>\n\n<pre><code>func PutTasks(db *sql.DB) echo.HandlerFunc {\n\n}\n</code></pre>\n\n<p>Why do we need to have the asterisk in front of the type? </p>\n\n<p>According to this cheat sheet, I found.</p>\n\n<blockquote>\n  <p>func PrintPerson(p *Person)   ONLY receives the pointer address\n  (reference)</p>\n</blockquote>\n\n<p>I don't understand why I would only want to send a pointer address as a parameter.</p>\n"}, {"tags": ["go", "sciter"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1510695329, "post_id": 47295522, "comment_id": 81542380, "body": "Adding a dll to the source folder does not build it into the binary. Please show what exactly you&#39;re doing."}], "answers": [{"tags": [], "owner": {"reputation": 367, "user_id": 5623778, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/69e63cb22a93b5779ab522847f51d0d3?s=128&d=identicon&r=PG", "display_name": "Robert", "link": "https://stackoverflow.com/users/5623778/robert"}, "is_accepted": false, "score": 1, "last_activity_date": 1510701034, "creation_date": 1510701034, "answer_id": 47296797, "question_id": 47295522, "link": "https://stackoverflow.com/questions/47295522/including-a-shared-library-in-a-go-build/47296797#47296797", "title": "Including a shared library in a go build", "body": "<p>My way of solving this was to use an additional tool, which had the added benefit of an optional desktop file and other metadata. AppImage solves the library problem, all I had to do was create an AppImage with the so files in /usr/lib/ and build through their command.</p>\n"}, {"tags": [], "owner": {"reputation": 436, "user_id": 6040478, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tlFMNGHJuWM/AAAAAAAAAAI/AAAAAAAAABA/XfFSwrGQjrk/photo.jpg?sz=128", "display_name": "adabru", "link": "https://stackoverflow.com/users/6040478/adabru"}, "is_accepted": false, "score": 1, "last_activity_date": 1576855381, "creation_date": 1576855381, "answer_id": 59427638, "question_id": 47295522, "link": "https://stackoverflow.com/questions/47295522/including-a-shared-library-in-a-go-build/59427638#59427638", "title": "Including a shared library in a go build", "body": "<p>@Robert's solution is nice. One could also place the *.so file in the same directory as the executable and create a start.sh script with the line:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>LD_LIBRARY_PATH=\"$(dirname \"$0\")\" \"$(dirname \"$0\")/your_executable\"\n</code></pre>\n"}], "owner": {"reputation": 367, "user_id": 5623778, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/69e63cb22a93b5779ab522847f51d0d3?s=128&d=identicon&r=PG", "display_name": "Robert", "link": "https://stackoverflow.com/users/5623778/robert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 396, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1576855381, "creation_date": 1510694952, "question_id": 47295522, "link": "https://stackoverflow.com/questions/47295522/including-a-shared-library-in-a-go-build", "title": "Including a shared library in a go build", "body": "<p>How can I include an SO file when I build for linux? With windows I simply put the dll in the same folder but that did not work with the linux build. In particular, I am building a go sciter project and need to include the <code>libsciter-gtk-64.so</code> in the executable/package.</p>\n"}, {"tags": ["csv", "go", "concurrency", "channel"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1510694203, "post_id": 47295259, "comment_id": 81541781, "body": "Create a <code>map[string](chan []string)</code>. Then given a partition key you can send the row to a corresponding channel."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1510694752, "post_id": 47295259, "comment_id": 81542095, "body": "Agree w/@zerkms. Or for more flexibility while keeping things simple, make each worker an instance of a <code>struct</code> type that holds its ID, a channel for sending rows, a quit channel to tell it when to stop/flush/close, and anything else it needs, and then hold a <code>map[string]worker</code> and use that to send the correct line to the correct worker."}, {"owner": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "edited": false, "score": 0, "creation_date": 1510697214, "post_id": 47295259, "comment_id": 81543291, "body": "Thanks so much guys! I&#39;ve created these suggested constructs,  but am not quite sure: - how to prevent deadlock - how to append to the map[string]worker as suggested to keep track (I called this workerPool) - still, how to choose among the workers I&#39;ve already created  Current progress here: <a href=\"https://play.golang.org/p/j56r_QvSJs\" rel=\"nofollow noreferrer\">play.golang.org/p/j56r_QvSJs</a>"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1510698131, "post_id": 47295259, "comment_id": 81543752, "body": "@gpanda channels aren&#39;t well suited to act as an unbound totally ordered queues. Instead, you may create a structure that holds a lock (a mutex) and internally is implemented as a slice. Then on every <code>push</code> you append an element to the slice, and on every <code>pop</code> you take one from the head."}, {"owner": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1510704476, "post_id": 47295259, "comment_id": 81546086, "body": "Point well taken, @zerkms. Still, with this approach I&#39;m so close! Just get deadlock after all routines finish.  <a href=\"https://play.golang.org/p/8T1swVHlgT\" rel=\"nofollow noreferrer\">play.golang.org/p/8T1swVHlgT</a> Will work on this and report back after I&#39;ve tried your mux solution."}, {"owner": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1510717028, "post_id": 47295259, "comment_id": 81549202, "body": "Hi @zerkms, Adrian. After reading up, I successfully implemented this using sync.Mutex. My solution is here: <a href=\"https://play.golang.org/p/7vFroFQLxS\" rel=\"nofollow noreferrer\">play.golang.org/p/7vFroFQLxS</a> If it&#39;s proper form here, I&#39;ll edit my question with the answer as I feel presumptuous answering my own question because you both were so helpful and I couldn&#39;t have done it without your patience :) I hope you see some other improvement like the _, ok syntax. For those like me struggling with this, consider: &quot;A common Go newbie mistake is to over-use channels...  Don\u2019t be afraid to use a Mutex if that fits your problem best...&quot;  Happy coding :)"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1510717550, "post_id": 47295259, "comment_id": 81549307, "body": "@gpanda I think it&#39;s not thread safe: <code>workerPool</code> access must be synchronised as well, since you read-write to it concurrently. Besides that, when you make it concurrency-safe you would find out that nothing in your implementation guarantees order: so lines might be scheduled to be processed in an arbitrary order."}, {"owner": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1510717900, "post_id": 47295259, "comment_id": 81549373, "body": "@zerkms I&#39;m ok with lines being processed in arbitrary order as the data is coming out of order, as long as a single worker is guaranteed to only receive exactly one unique partition. Can you please add some detail as to why workerPool as implemented is unsafe? I&#39;m really just using it to keep track of whether I&#39;ve created a worker for the partition from the current line or not."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1510717977, "post_id": 47295259, "comment_id": 81549390, "body": "<code>workerPool[hour] = w</code> - here is a modification, <code>workerPool[hour].Work(l)</code> here is read from <code>workerPool</code>. If a shared piece of data is accessed concurrently and if at least one of those accesses is modification - the access must be syncrhonised. You may solve it using the <code>sync.RWMutex</code>"}, {"owner": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1510718919, "post_id": 47295259, "comment_id": 81549627, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/159019/discussion-between-gpanda-and-zerkms\">continue this discussion in chat</a>."}, {"owner": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1510719369, "post_id": 47295259, "comment_id": 81549753, "body": "@zerkms moved to chat per mod request"}], "answers": [{"comments": [{"owner": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "edited": false, "score": 0, "creation_date": 1510761635, "post_id": 47311323, "comment_id": 81574657, "body": "I will absolutely have a look at how this works for my use case and report back with any questions. Thanks!"}, {"owner": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "edited": false, "score": 0, "creation_date": 1510802060, "post_id": 47311323, "comment_id": 81592970, "body": "Both solutions are great, but the second is especially elegant. I especially appreciate the , ok syntax for use of closing the chan in worker(), as well as the explanatory comments. I&#39;m curious about the comment about how the Lock() is not required for independent files. I think this is where I will adapt to write to a separate csv for each partition - are you sure a lock wouldn&#39;t be required here for writing each partition to a file?"}, {"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "reply_to_user": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "edited": false, "score": 1, "creation_date": 1510812653, "post_id": 47311323, "comment_id": 81596277, "body": "@gpanda yes I&#39;m pretty sure you don&#39;t need to Lock for that. It is only required because when printing we have one single shared resource std out where we print to. Try commenting out the <code>mu.Lock and mu.Unlock</code>. Nothing bad will happen except order of lines will be random. With this lock each worker is saying &quot;Look everyone shut-up while up speaking&quot;. When you have one file per worker you are not sharing anything so you can think of <code>part := [][]string{}</code> as your file. And we are not locking it for appending to it."}], "tags": [], "owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "is_accepted": true, "score": 1, "last_activity_date": 1510780160, "last_edit_date": 1510780160, "creation_date": 1510759889, "answer_id": 47311323, "question_id": 47295259, "link": "https://stackoverflow.com/questions/47295259/concurrently-write-multiple-csv-files-from-one-splitting-on-a-partition-column/47311323#47311323", "title": "Concurrently write multiple csv files from one, splitting on a partition column in Golang", "body": "<p>Synchronous version no go concurrent magic first (see concurrent version below).</p>\n\n\n\n<pre><code>package main\n\nimport (\n    \"encoding/csv\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"strings\"\n)\n\nfunc main() {\n\n    // CSV\n    r := csv.NewReader(csvFile1)\n    partitions := make(map[string][][]string)\n\n    for {\n        rec, err := r.Read()\n        if err != nil {\n            if err == io.EOF {\n                err = nil\n\n                save_partitions(partitions)\n\n                return\n            }\n            log.Fatal(err)\n        }\n\n        process(rec, partitions)\n    }\n\n}\n\n// prints only\nfunc save_partitions(partitions map[string][][]string) {\n    for part, recs := range partitions {\n        fmt.Println(part)\n        for _, rec := range recs {\n            fmt.Println(rec)\n        }\n    }\n}\n\n// this can also write/append directly to a file\nfunc process(rec []string, partitions map[string][][]string) {\n    l := len(rec)\n    part := rec[l-1]\n    if p, ok := partitions[part]; ok {\n        partitions[part] = append(p, rec)\n    } else {\n        partitions[part] = [][]string{rec}\n    }\n}\n\n// DUMMY\nvar csvFile1 = strings.NewReader(`\nfsdio,abc,def,2017,11,06,01\n1sdf9,abc,def,2017,11,06,01\n1d243,abc,def,2017,11,06,01\n1v2t3,abc,def,2017,11,06,01\na1523,abc,def,2017,11,06,01\n1r2r3,abc,def,2017,11,06,02\n11213,abc,def,2017,11,06,02\ng1253,abc,def,2017,11,06,02\nd1e23,abc,def,2017,11,06,02\na1d23,abc,def,2017,11,06,02\n12jj3,abc,def,2017,11,06,03\nt1r23,abc,def,2017,11,06,03\n2123r,abc,def,2017,11,06,03\n22123,abc,def,2017,11,06,03\n14d23,abc,def,2017,11,06,04\n1da23,abc,def,2017,11,06,04\n12fy3,abc,def,2017,11,06,04\n12453,abc,def,2017,11,06,04`)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/--iqZGzxCF\" rel=\"nofollow noreferrer\">https://play.golang.org/p/--iqZGzxCF</a></p>\n\n<p>And the concurrent version:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/csv\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"strings\"\n    \"sync\"\n)\n\nvar (\n    // list of channels to communicate with workers\n    // workers accessed synchronousely no mutex required\n    workers = make(map[string]chan []string)\n\n    // wg is to make sure all workers done before exiting main\n    wg = sync.WaitGroup{}\n\n    // mu used only for sequential printing, not relevant for program logic\n    mu = sync.Mutex{}\n)\n\nfunc main() {\n\n    // wait for all workers to finish up before exit\n    defer wg.Wait()\n\n    r := csv.NewReader(csvFile1)\n\n    for {\n        rec, err := r.Read()\n        if err != nil {\n            if err == io.EOF {\n                savePartitions()\n                return\n            }\n            log.Fatal(err) // sorry for the panic\n        }\n        process(rec)\n    }\n\n}\n\nfunc process(rec []string) {\n    l := len(rec)\n    part := rec[l-1]\n\n    if c, ok := workers[part]; ok {\n        // send rec to worker\n        c &lt;- rec\n    } else {\n        // if no worker for the partition\n\n        // make a chan\n        nc := make(chan []string)\n        workers[part] = nc\n\n        // start worker with this chan\n        go worker(nc)\n\n        // send rec to worker via chan\n        nc &lt;- rec\n    }\n}\n\nfunc worker(c chan []string) {\n\n    // wg.Done signals to main worker completion\n    wg.Add(1)\n    defer wg.Done()\n\n    part := [][]string{}\n    for {\n        // wait for a rec or close(chan)\n        rec, ok := &lt;-c\n        if ok {\n            // save the rec\n            // instead of accumulation in memory\n            // this can be saved to file directly\n            part = append(part, rec)\n        } else {\n            // channel closed on EOF\n\n            // dump partition\n            // locks ensures sequential printing\n            // not a required for independent files\n            mu.Lock()\n            for _, p := range part {\n                fmt.Printf(\"%+v\\n\", p)\n            }\n            mu.Unlock()\n\n            return\n        }\n    }\n}\n\n// simply signals to workers to stop\nfunc savePartitions() {\n    for _, c := range workers {\n        // signal to all workers to exit\n        close(c)\n    }\n}\n\n// DUMMY\nvar csvFile1 = strings.NewReader(`\nfsdio,abc,def,2017,11,06,01\n1sdf9,abc,def,2017,11,06,01\n1d243,abc,def,2017,11,06,01\n1v2t3,abc,def,2017,11,06,01\na1523,abc,def,2017,11,06,01\n1r2r3,abc,def,2017,11,06,02\n11213,abc,def,2017,11,06,02\ng1253,abc,def,2017,11,06,02\nd1e23,abc,def,2017,11,06,02\na1d23,abc,def,2017,11,06,02\n12jj3,abc,def,2017,11,06,03\nt1r23,abc,def,2017,11,06,03\n2123r,abc,def,2017,11,06,03\n22123,abc,def,2017,11,06,03\n14d23,abc,def,2017,11,06,04\n1da23,abc,def,2017,11,06,04\n12fy3,abc,def,2017,11,06,04\n12453,abc,def,2017,11,06,04`)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/oBTPosy0yT\" rel=\"nofollow noreferrer\">https://play.golang.org/p/oBTPosy0yT</a></p>\n\n<p>Have fun!</p>\n"}], "owner": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1542, "favorite_count": 1, "accepted_answer_id": 47311323, "answer_count": 1, "score": 1, "last_activity_date": 1510780160, "creation_date": 1510693851, "last_edit_date": 1510694779, "question_id": 47295259, "link": "https://stackoverflow.com/questions/47295259/concurrently-write-multiple-csv-files-from-one-splitting-on-a-partition-column", "title": "Concurrently write multiple csv files from one, splitting on a partition column in Golang", "body": "<p>My objective is to read one or multiple csv files that share a common format, and write to separate files based on a partition column in the csv data. Please allow that the last column is the partition, that data is un-sorted, and a given partition can be found in multiple files. Example of one file:</p>\n\n<pre><code>fsdio,abc,def,2017,11,06,01\n1sdf9,abc,def,2017,11,06,04\n22df9,abc,def,2017,11,06,03\n1d243,abc,def,2017,11,06,02\n</code></pre>\n\n<p><em>If this approach smells like the dreaded XY Problem, I'm happy to adjust.</em></p>\n\n<p>What I've tried so far:</p>\n\n<ul>\n<li>Read in the data set and iterate over each line  </li>\n<li>If the partition has\nbeen seen, spin off a new worker routine (this will contain a file/csv\nwriter). Send the line into a <code>chan []string</code>.</li>\n<li>As each worker is a file writer, it should only receive lines for exactly one partition over it's input channel.</li>\n</ul>\n\n<p>This obviously doesn't work (yet),  as I'm not aware of how to send a line to the correct worker based on the partition value seen on a given line.</p>\n\n<p>I've given each worker an <code>id string</code> for each partition value, but am not aware how to select that worker to send to, if I should be creating a separate <code>chan []string</code> for each worker and send to that channel with a <code>select</code>, or if perhaps a struct should hold each worker with some sort of pool and routing functionality.</p>\n\n<p>TLDR; I'm lost as to how to conditionally send data to a given go routine or channel based on some categorical <code>string</code> value, where the number of unique's can be arbitrary, but likely does not exceed 24 unique partition values.</p>\n\n<p><em>I will caveat by stating I've noticed questions like this do get down-voted, so if you feel this is counter-constructive or incomplete enough to down-vote, please comment with why so I can avoid repeating the offense.</em></p>\n\n<p>Thanks for any help in advance!</p>\n\n<p><a href=\"https://play.golang.org/p/YhT9V4yLl-\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<p>Snippet:</p>\n\n<pre><code>  package main\n\n    import (\n        \"encoding/csv\"\n        \"fmt\"\n        \"log\"\n        \"strings\"\n        \"time\"\n    )\n\n    func main() {\n\n        // CSV\n        r := csv.NewReader(csvFile1)\n        lines, err := r.ReadAll()\n        if err != nil {\n            log.Fatalf(\"error reading all lines: %v\", err)\n        }\n\n        // CHANNELS\n        lineChan := make(chan []string)\n\n        // TRACKER\n        var seenPartitions []string\n\n        for _, line := range lines {\n\n            hour := line[6]\n            if !stringInSlice(hour, seenPartitions) {\n                seenPartitions = append(seenPartitions, hour)\n                go worker(hour, lineChan)\n            }\n            // How to send to the correct worker/channel? \n            lineChan &lt;- line\n\n        }\n        close(lineChan)\n    }\n\n    func worker(id string, lineChan &lt;-chan []string) {\n        for j := range lineChan {\n            fmt.Println(\"worker\", id, \"started  job\", j)\n            // Write to a new file here and wait for input over the channel\n            time.Sleep(time.Second)\n            fmt.Println(\"worker\", id, \"finished job\", j)\n        }\n    }\n\n    func stringInSlice(str string, list []string) bool {\n        for _, v := range list {\n            if v == str {\n                return true\n            }\n        }\n        return false\n    }\n\n    // DUMMY\nvar csvFile1 = strings.NewReader(`\n12fy3,abc,def,2017,11,06,04 \nfsdio,abc,def,2017,11,06,01\n11213,abc,def,2017,11,06,02\n1sdf9,abc,def,2017,11,06,01\n2123r,abc,def,2017,11,06,03\n1v2t3,abc,def,2017,11,06,01\n1r2r3,abc,def,2017,11,06,02\ng1253,abc,def,2017,11,06,02\nd1e23,abc,def,2017,11,06,02\na1d23,abc,def,2017,11,06,02\n12jj3,abc,def,2017,11,06,03\nt1r23,abc,def,2017,11,06,03\n22123,abc,def,2017,11,06,03\n14d23,abc,def,2017,11,06,04\n1d243,abc,def,2017,11,06,01\n1da23,abc,def,2017,11,06,04\na1523,abc,def,2017,11,06,01\n12453,abc,def,2017,11,06,04`)\n</code></pre>\n"}, {"tags": ["logging", "go", "runtime"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510694793, "post_id": 47294834, "comment_id": 81542120, "body": "The stdlib logger doesn&#39;t have logging levels, so this seems like a request for a third-party library, which is off-topic for SO."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1510699319, "post_id": 47294834, "comment_id": 81544235, "body": "Off-topic though it may be, the most common libs I see for level-based logging are <a href=\"https://github.com/sirupsen/logrus\" rel=\"nofollow noreferrer\">logrus</a> and <a href=\"https://github.com/op/go-logging\" rel=\"nofollow noreferrer\">go-logging</a>.  Both support runtime alteration of the log level without application restart, though neither are specifically oriented around DB-specified configuration (or runtime config manipulation via DB values)"}], "answers": [{"comments": [{"owner": {"reputation": 439, "user_id": 795818, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/e03c6f536e76133771f81fd7e053abf1?s=128&d=identicon&r=PG", "display_name": "Matthias", "link": "https://stackoverflow.com/users/795818/matthias"}, "edited": false, "score": 1, "creation_date": 1511178826, "post_id": 47324781, "comment_id": 81735675, "body": "Logrus + few lines of goroutine to check loglevel from database in the loop did the trick. Thanks for your suggestion"}, {"owner": {"reputation": 1632, "user_id": 306819, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/dd75cc276ca4b29e97f7dfcd6087faf0?s=128&d=identicon&r=PG", "display_name": "siddhusingh", "link": "https://stackoverflow.com/users/306819/siddhusingh"}, "edited": false, "score": 2, "creation_date": 1537515868, "post_id": 47324781, "comment_id": 91820749, "body": "I think question is how to change the log level at run time. Like its there in logback / log4j2."}], "tags": [], "owner": {"reputation": 401, "user_id": 37400, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc19147e89d6521f92ef9e2c1c4dac24?s=128&d=identicon&r=PG", "display_name": "Matthew Campbell", "link": "https://stackoverflow.com/users/37400/matthew-campbell"}, "is_accepted": true, "score": 0, "last_activity_date": 1510820584, "creation_date": 1510820584, "answer_id": 47324781, "question_id": 47294834, "link": "https://stackoverflow.com/questions/47294834/go-runtime-logging-verbosity-change/47324781#47324781", "title": "Go runtime logging verbosity change", "body": "<p>I would recommend using a library like <a href=\"https://github.com/sirupsen/logrus\" rel=\"nofollow noreferrer\">https://github.com/sirupsen/logrus</a> that has built in logging levels. Also can do structured logging</p>\n"}], "owner": {"reputation": 439, "user_id": 795818, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/e03c6f536e76133771f81fd7e053abf1?s=128&d=identicon&r=PG", "display_name": "Matthias", "link": "https://stackoverflow.com/users/795818/matthias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1165, "favorite_count": 0, "accepted_answer_id": 47324781, "answer_count": 1, "score": 1, "last_activity_date": 1510820584, "creation_date": 1510692164, "question_id": 47294834, "link": "https://stackoverflow.com/questions/47294834/go-runtime-logging-verbosity-change", "title": "Go runtime logging verbosity change", "body": "<p>I need to change logging verbosity/level while Golang application is running, without restarting</p>\n\n<p>I came from PHP where there are several logging frameworks supporting DB-based configuration change on run-time</p>\n\n<p>What's the most standard/canonical way to achieve this kind of functionality in Go?</p>\n"}, {"tags": ["winapi", "go", "wmi", "bios"], "comments": [{"owner": {"reputation": 2324, "user_id": 2496266, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2abb84c0653aa5d942af9ceb1c93e28a?s=128&d=identicon&r=PG", "display_name": "Chaim Eliyah", "link": "https://stackoverflow.com/users/2496266/chaim-eliyah"}, "edited": false, "score": 0, "creation_date": 1510691896, "post_id": 47294617, "comment_id": 81540524, "body": "Please post your own code (or what you&#39;ve tried), the desired behavior, and the actual behavior. For some basic guidelines see <a href=\"https://stackoverflow.com/help/how-to-ask\">stackoverflow.com/help/how-to-ask</a>"}, {"owner": {"reputation": 23, "user_id": 8924214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa6b5a24f266057b3e38b540c6bb80ea?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Smith", "link": "https://stackoverflow.com/users/8924214/jack-smith"}, "reply_to_user": {"reputation": 2324, "user_id": 2496266, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/2abb84c0653aa5d942af9ceb1c93e28a?s=128&d=identicon&r=PG", "display_name": "Chaim Eliyah", "link": "https://stackoverflow.com/users/2496266/chaim-eliyah"}, "edited": false, "score": 1, "creation_date": 1510694134, "post_id": 47294617, "comment_id": 81541742, "body": "@ChaimEliyah updated the question"}], "answers": [{"comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1510752051, "post_id": 47302259, "comment_id": 81567260, "body": "That detour is brilliant!"}, {"owner": {"reputation": 23, "user_id": 8924214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa6b5a24f266057b3e38b540c6bb80ea?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Smith", "link": "https://stackoverflow.com/users/8924214/jack-smith"}, "edited": false, "score": 0, "creation_date": 1510764179, "post_id": 47302259, "comment_id": 81576471, "body": "\u0421\u043f\u0430\u0441\u0438\u0431\u043e \u0432\u0430\u043c \u0431\u043e\u043b\u044c\u0448\u043e\u0435. \u041d\u043e \u044f \u043e\u0434\u043d\u043e\u0433\u043e \u043d\u0435 \u043c\u043e\u0433\u0443 \u043f\u043e\u043d\u044f\u0442\u044c \u0438 \u043d\u0435 \u043c\u043e\u0433\u0443 \u043d\u0430\u0439\u0442\u0438: \u041a\u0430\u043a \u043c\u043d\u0435 \u0441\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441 \u0434\u043e\u043f\u0443\u0441\u0442\u0438\u043c \u043d\u0430 bios, \u043f\u0440\u043e\u0431\u043e\u0432\u0430\u043b Win32_Bios \u043d\u043e \u043f\u0438\u0448\u0435\u0442 Invalid Class \u0438\u043b\u0438 Invalid Query. \u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043a\u0430\u043a \u0441\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u0430\u043f\u0440\u043e\u0441 \u043d\u0435 \u043d\u0430\u0448\u0435\u043b."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 23, "user_id": 8924214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa6b5a24f266057b3e38b540c6bb80ea?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Smith", "link": "https://stackoverflow.com/users/8924214/jack-smith"}, "edited": false, "score": 0, "creation_date": 1510765517, "post_id": 47302259, "comment_id": 81577423, "body": "@JackSmith, sorry I don&#39;t even have access to Windows and was writing off my memory. <a href=\"https://social.technet.microsoft.com/Forums/en-US/c5684592-adaf-4fcd-8adb-335c7633ca71/query-bios-version-before-running-command-or-installing-application?forum=mdt\" rel=\"nofollow noreferrer\">This</a> has a working WMI query for bios: <code>select * from WIN32_BIOS where SMBIOSBIOSVersion &lt; &quot;A26&quot;</code> so I&#39;d work from there. See also <a href=\"https://msdn.microsoft.com/en-us/library/Aa394077.aspx\" rel=\"nofollow noreferrer\">this</a>."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 23, "user_id": 8924214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa6b5a24f266057b3e38b540c6bb80ea?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Smith", "link": "https://stackoverflow.com/users/8924214/jack-smith"}, "edited": false, "score": 0, "creation_date": 1510765658, "post_id": 47302259, "comment_id": 81577517, "body": "@JackSmith \u2026and <a href=\"https://www.google.ru/search?q=WMI+BIOS+site%3Arsdn.ru\" rel=\"nofollow noreferrer\">this</a> and the links provided <a href=\"https://habrahabr.ru/post/138400/#comment_4622655\" rel=\"nofollow noreferrer\">here</a> and so on. Please do your research."}, {"owner": {"reputation": 23, "user_id": 8924214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa6b5a24f266057b3e38b540c6bb80ea?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Smith", "link": "https://stackoverflow.com/users/8924214/jack-smith"}, "edited": false, "score": 0, "creation_date": 1510771911, "post_id": 47302259, "comment_id": 81581031, "body": "@kostix this is most importand for me i was able to find it - <a href=\"https://msdn.microsoft.com/en-us/library/aa389273%28v=vs.85%29.aspx?f=255&amp;MSPPError=-2147217396\" rel=\"nofollow noreferrer\">msdn.microsoft.com/en-us/library/&hellip;</a>"}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 3, "last_activity_date": 1510733228, "creation_date": 1510733228, "answer_id": 47302259, "question_id": 47294617, "link": "https://stackoverflow.com/questions/47294617/how-to-get-all-system-bios-information-for-windows/47302259#47302259", "title": "How to get all system/bios information for Windows", "body": "<h3>A detour about the methodology in programming</h3>\n\n<p>(Sorry for a detour, which follows, but I think I had to make it.)</p>\n\n<p>You're attacking your problem from a wrong angle.\nProgramming is not about finding a random package, trying it,\nseeing it failing and turning for help;\nit's rather about inventing a general approach to solving the problem\nat hand and then trying to figure out what are there to solve it.</p>\n\n<p>For instance, in your case, it might easily be not fruitful\nto search for \"BIOS+information+golang\" because <em>it's too narrow.</em></p>\n\n<p>Instead, try to figure out</p>\n\n<ol>\n<li>How to get <em>any</em> information <em>about a system</em> on Windows.</li>\n<li>How to do that in Go.</li>\n</ol>\n\n<p>While this is boring, I have to recommend reading\n<a href=\"http://whathaveyoutried.com\" rel=\"nofollow noreferrer\">this</a> seriously: this will really help\nyou getting your future programming challenges solved.</p>\n\n<h3>The problem at hand</h3>\n\n<p>OK, now back to your problem.</p>\n\n<p>On Windows, the standard way to obtain information about a system\nis querying the so-called <a href=\"https://en.wikipedia.org/wiki/Windows_Management_Instrumentation\" rel=\"nofollow noreferrer\">Windows Management Instrumentation\n(or WMI for short)</a>  subsystem.</p>\n\n<p>Once you know this, you should dig into these two directions:</p>\n\n<ul>\n<li><p>What WMI calls do you need to perform to get the information\nwhich is of interest to you.</p>\n\n<p>This one is easily searcheable.\nThe first hit I got doing that is <a href=\"https://blogs.technet.microsoft.com/askperf/2012/02/17/useful-wmic-queries/\" rel=\"nofollow noreferrer\">this</a>\nwhich I'd say is a pretty good start.</p></li>\n<li><p>How to do WMI calls from Go.</p>\n\n<p>This one can be done in two ways:</p>\n\n<ul>\n<li><p>Direct implementation by hand.\nGo has very good built-in support for dynamically loading Windows DLLs\nand calling functions from them.</p>\n\n<p><a href=\"https://github.com/alexbrainman/odbc/blob/master/api/zapi_windows.go\" rel=\"nofollow noreferrer\">This</a> is a good demonstation of the basic concepts.</p></li>\n<li><p>Using a ready-made package.\nAgain, quick searching yields <a href=\"https://godoc.org/github.com/StackExchange/wmi\" rel=\"nofollow noreferrer\"><code>github.com/StackExchange/wmi</code></a>.</p></li>\n</ul></li>\n</ul>\n\n<p>So, if I were you, I'd first code up whatever the WMI calls suit my needs\nusing VBS or JScript (or whatnot) on <a href=\"https://en.wikipedia.org/wiki/Windows_Script_Host\" rel=\"nofollow noreferrer\">WSH</a>\nand then \"ported\" that solution to Go using any of the described approaches.</p>\n"}], "owner": {"reputation": 23, "user_id": 8924214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa6b5a24f266057b3e38b540c6bb80ea?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Smith", "link": "https://stackoverflow.com/users/8924214/jack-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 519, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1510733271, "creation_date": 1510691283, "last_edit_date": 1510733271, "question_id": 47294617, "link": "https://stackoverflow.com/questions/47294617/how-to-get-all-system-bios-information-for-windows", "title": "How to get all system/bios information for Windows", "body": "<p>I want to know how to get full information about <strong>PC and BIOS</strong>. I came across this post - <em><a href=\"https://groups.google.com/forum/#!msg/golang-nuts/pKuFQxAy4P4/62FnqGON1pEJ\" rel=\"nofollow noreferrer\">https://groups.google.com/forum/#!msg/golang-nuts/pKuFQxAy4P4/62FnqGON1pEJ</a></em> </p>\n\n<p><strong>Code:</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/ochapman/godmi\"\n)\nfunc main(){\n    BS:=godmi.GetBIOSInformation()\n    fmt.Println(\"BS:\",BS)\n    sys:=godmi.GetSystemInformation()\n    fmt.Println(\"sys:\",sys)\n    BB:=godmi.GetBaseboardInformation()\n    fmt.Println(\"BB:\",BB)\n}\n</code></pre>\n\n<p><strong>I could not compile because there is an error:</strong></p>\n\n<pre><code># github.com/ochapman/godmi\ngo\\src\\github.com\\ochapman\\godmi\\godmi.go:674:13: undefined: syscall.Mmap\ngo\\src\\github.com\\ochapman\\godmi\\godmi.go:674:79: undefined: syscall.PROT_RE\ngo\\src\\github.com\\ochapman\\godmi\\godmi.go:674:98: undefined: syscall.MAP_SHA\ngo\\src\\github.com\\ochapman\\godmi\\godmi.go:680:8: undefined: syscall.Munmap\n</code></pre>\n\n<p>As I understood it only for <strong>Linux</strong>, for <strong>Windows</strong> I did not find anything like it at all. <strong>Can eat an alternative?</strong></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 109, "user_id": 2602998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b233ab92078305f1161a6c17e0ee87d2?s=128&d=identicon&r=PG", "display_name": "Kanu", "link": "https://stackoverflow.com/users/2602998/kanu"}, "edited": false, "score": 1, "creation_date": 1592311627, "post_id": 47294083, "comment_id": 110375064, "body": "Sorry I know this is a bit old but anyway. The question here is how are you gonna handle the error: you already received the response and it is successful. If error happened during Close should you drop the successful response and throw error? Or should you drop error and proceed with success result? I assume this was the initial question."}], "tags": [], "owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "is_accepted": false, "score": 15, "last_activity_date": 1510689298, "last_edit_date": 1510689298, "creation_date": 1510688979, "answer_id": 47294083, "question_id": 47293975, "link": "https://stackoverflow.com/questions/47293975/should-i-error-check-close-on-a-response-body/47294083#47294083", "title": "Should I error-check Close() on a response body?", "body": "<p>This is a downside of using <code>defer</code></p>\n\n<p>It would be advised, as a responsible developer, that you check for all possible error prone points, and handle them as gracefully as you can.</p>\n\n<p>Here are some of the options you can choose in handling this situation:</p>\n\n<h3>Option #1</h3>\n\n<p>Do not use <code>defer</code>, instead manually call close once you're done with the response's body and simply check for errors then.</p>\n\n<h3>Option #2</h3>\n\n<p>Create an anonymous function that wraps the closing and error checking code. Something like this:</p>\n\n<pre><code>defer func() {\n    err := resp.Body.Close()\n    if err != nil {\n        log.Fatal(err)\n    }\n}()\n</code></pre>\n\n<blockquote>\n  <p>Avoid using <code>panics</code> in your programs. Try to handle the errors gracefully by doing something or at least logging the error.</p>\n</blockquote>\n\n<hr>\n\n<p><a href=\"http://www.blevesearch.com/news/Deferred-Cleanup,-Checking-Errors,-and-Potential-Problems/\" rel=\"noreferrer\">Additional information can be found here.</a></p>\n"}, {"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1510730297, "post_id": 47294087, "comment_id": 81553749, "body": "@rcorre, while I&#39;m with Adrian on this, note that everything stated applies only to bodies of HTTP responses\u2014don&#39;t blindly apply this to everything! In particular, always check possible errors from <code>Close()</code> called on files opened for writing! For an explanation, read <a href=\"https://manpages.debian.org/stretch/manpages-dev/close.2.en.html#Dealing_with_error_returns_from_close%28%29\" rel=\"nofollow noreferrer\">the <code>open(2)</code> manual page</a>."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1510730398, "post_id": 47294087, "comment_id": 81553793, "body": "I&#39;d also add that I habitually put the <code>&#47;&#47; ignoring error</code> at the end of the same line such statement appears on\u2014to provide a clear hint about the intended behaviour to the next programmer."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1510748397, "post_id": 47294087, "comment_id": 81564657, "body": "I wouldn&#39;t say it only applies to HTTP response bodies - my answer was to assess the specific case and use your best judgement, which I think is pretty generally applicable advice."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 15, "last_activity_date": 1510689395, "last_edit_date": 1510689395, "creation_date": 1510688987, "answer_id": 47294087, "question_id": 47293975, "link": "https://stackoverflow.com/questions/47293975/should-i-error-check-close-on-a-response-body/47294087#47294087", "title": "Should I error-check Close() on a response body?", "body": "<p>There are two things to consider: What would you do with it if you checked it and there was an error? And, what would the side-effects be if there was an error?</p>\n\n<p>In most cases, for closing a response body, the answer to both questions is... absolutely nothing. If there's nothing you'd do if there was an error and the error has no appreciable impact, there's no reason to check it.</p>\n\n<p>Also note that <code>Close()</code> returns an error in order to fulfill the <code>io.Closer</code> interface; the function doesn't necessarily return an error. You'd need to check the source to know for sure if it has an error case.</p>\n"}, {"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 3, "creation_date": 1510699947, "post_id": 47295303, "comment_id": 81544513, "body": "This sort of thing is great for simple error cases. It&#39;s especially useful for cleaning up playground examples. Many times in production though, each error is often handled differently, which could clutter the namespace with <code>errcheckJSON</code> or <code>errcheck1</code> (probably not the case with <code>Close</code> though). Not dinging on your answer, but just noting the limitations of the general error case. Seems good to me for <code>Close</code>, though I would use something more like this <a href=\"https://play.golang.org/p/nzGTFe81g_\" rel=\"nofollow noreferrer\">play.golang.org/p/nzGTFe81g_</a> instead of causing a panic."}, {"owner": {"reputation": 96, "user_id": 2499344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/595babac8f8e3bc6670ff2eee4afdc1d?s=128&d=identicon&r=PG", "display_name": "Speedoops", "link": "https://stackoverflow.com/users/2499344/speedoops"}, "edited": false, "score": 0, "creation_date": 1611625034, "post_id": 47295303, "comment_id": 116506826, "body": "There is a problem: when <code>err != nil</code> is true, <code>errcheck</code> should log and return, not just log."}, {"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 0, "creation_date": 1611625776, "post_id": 47295303, "comment_id": 116506983, "body": "<code>log.Fatal(err)</code> in <code>errcheck</code> panics so return is not necessary and if you replace <code>log.Fatal(err)</code> with <code>log.Println(err)</code> then return is implicit. Also comment by RayfenWindspear address the use case (simple playground examples)."}], "tags": [], "owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "is_accepted": false, "score": 4, "last_activity_date": 1510776751, "last_edit_date": 1510776751, "creation_date": 1510694070, "answer_id": 47295303, "question_id": 47293975, "link": "https://stackoverflow.com/questions/47293975/should-i-error-check-close-on-a-response-body/47295303#47295303", "title": "Should I error-check Close() on a response body?", "body": "<p>To add to @Mihailo option #2, call it option #2.1\nDefine function <code>dclose()</code> like so:</p>\n\n\n\n<pre><code>func dclose(c io.Closer) {\n    if err := c.Close(); err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>use like so:</p>\n\n<pre><code>defer dclose(resp.Body)\n</code></pre>\n\n<p>Also in your code the check for <code>err!=nil</code> can declare:</p>\n\n<pre><code>func errcheck(err error) {\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>then use:</p>\n\n<pre><code>errcheck(err)\n</code></pre>\n\n<p>then your code becomes:</p>\n\n<pre><code>resp, err := http.Get(\"http://example.com/\")\nerrcheck(err)\ndefer dclose(resp.Body)\n\nbody, err := ioutil.ReadAll(resp.Body)\nerrcheck(err)\n\nfmt.Printf(\"%s\", string(body))\n</code></pre>\n\n<p>IMHO a little cleaner perhaps? But I'll wait for the <code>go</code> aficionado's to correct me and highlight drawbacks.</p>\n\n<p>EDIT</p>\n\n<p>Thanks! @RayfenWindspear</p>\n\n<p>Do replace <code>log.Fatal(err)</code> with <code>log.Println(err)</code> to avoid unnecessary panic.</p>\n\n<p>EDIT2</p>\n\n<p><code>dclose()</code> to avoid confusion with go <code>close()</code></p>\n\n<p>Have fun!</p>\n"}], "owner": {"reputation": 5163, "user_id": 1435461, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/05f6236ee5ec04b27e27f504ebdd3744?s=128&d=identicon&r=PG", "display_name": "rcorre", "link": "https://stackoverflow.com/users/1435461/rcorre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5869, "favorite_count": 6, "accepted_answer_id": 47294087, "answer_count": 3, "score": 20, "last_activity_date": 1510776751, "creation_date": 1510688493, "question_id": 47293975, "link": "https://stackoverflow.com/questions/47293975/should-i-error-check-close-on-a-response-body", "title": "Should I error-check Close() on a response body?", "body": "<p>The docs for <a href=\"https://golang.org/pkg/net/http/\" rel=\"noreferrer\"><code>net/http</code></a> have the following example:</p>\n\n<pre><code>resp, err := http.Get(\"http://example.com/\")\nif err != nil {\n    panic(err)\n}\ndefer resp.Body.Close()\nbody, err := ioutil.ReadAll(resp.Body)\nfmt.Printf(\"%s\", body)\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/io/#Closer\" rel=\"noreferrer\"><code>Close</code></a> returns an <code>error</code>, but it is not checked. Is there something I'm missing here? The importance of checking every error is frequently emphasized in go, but I see this <code>defer resp.Body.Close()</code> pattern a lot with no error checks.</p>\n"}, {"tags": ["unit-testing", "testing", "go"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1510689349, "creation_date": 1510689349, "answer_id": 47294172, "question_id": 47293902, "link": "https://stackoverflow.com/questions/47293902/mocking-remote-api-calls-in-golang/47294172#47294172", "title": "Mocking remote api calls in golang", "body": "<p>Make the endpoint URL configurable instead of hard-coding it - make it a function parameter, or a field of some configuration <code>struct</code>, or returned from an internal configuration service, something like that. Designing for testability is all about avoiding hard-coded configuration and dependencies: code should receive its configuration values and its dependencies from the caller rather than setting or creating them itself.</p>\n"}], "owner": {"reputation": 233, "user_id": 2588946, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c7cae512182f8d5080169ff37b50889f?s=128&d=identicon&r=PG", "display_name": "Bobloblawlawblogs", "link": "https://stackoverflow.com/users/2588946/bobloblawlawblogs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1352, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1510689349, "creation_date": 1510688170, "question_id": 47293902, "link": "https://stackoverflow.com/questions/47293902/mocking-remote-api-calls-in-golang", "title": "Mocking remote api calls in golang", "body": "<p>I'm trying to get better at writing mocked golang tests that call a remote api\nI can similate a single call pretty easily with the httptest library but am a \nbit stuck handling other functions that call single endpoint calls multiple times.</p>\n\n<p>For example given a simple create function </p>\n\n<pre><code>func createItem(url string, product Product) (int, error) {\n    // make request\n    return createdId, nil\n}\n</code></pre>\n\n<p>I can write some tests that look like this </p>\n\n<pre><code>func TestCreateItem(t *testing.T) {\n    mock_ts := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        w.Header().Set(\"Content-Type\", \"application/json\")\n        w.Write([]byte(`37`))\n    }))\n\n    prod := Product{...}\n\n    _, err := createItem(mock_ts.URL, 1, prod)\n    if err != nil {\n        t.Errorf(\"Error saving item: %v\", err)\n    }\n}\n</code></pre>\n\n<p>Now if I have this other wrapper function I won't be able to pass in the \nmock test server url. </p>\n\n<pre><code>func someFunctionThatMakesManyItems(...) {\n    url = \"http://www.realapiendpoint.com\" // or some func that gets api url\n\n    // this function might generate a list of items\n    for _, item := range items {\n        createItem(url, item)\n    }\n\n}\n</code></pre>\n\n<p>I could need to pass in the url to the someFunctionThatMakesManyItems and any \nfunctions that rely on api functions and that just seems like the wrong approach.</p>\n\n<p>Any advice on how to model this better to help with my tests?</p>\n"}, {"tags": ["function", "go", "cookies"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1510688057, "post_id": 47293642, "comment_id": 81538539, "body": "To see how <a href=\"https://golang.org/pkg/net/http/#Client\" rel=\"nofollow noreferrer\">http.Client</a> uses the cookie jar cmd/ctrl+f through <a href=\"https://github.com/golang/go/blob/master/src/net/http/client.go\" rel=\"nofollow noreferrer\">this file</a> for &quot;Jar&quot;, &quot;Cookies&quot;, or &quot;SetCookies&quot;. For example <code>SetCookies</code> appears only once <a href=\"https://github.com/golang/go/blob/master/src/net/http/client.go#L182\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 381, "user_id": 8573838, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-id8ZMMo9mIA/AAAAAAAAAAI/AAAAAAAAADM/VJic0_NAcpo/photo.jpg?sz=128", "display_name": "James Morgan", "link": "https://stackoverflow.com/users/8573838/james-morgan"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1510688267, "post_id": 47293642, "comment_id": 81538644, "body": "Oh so the method I&#39;ve created above is a form of extension method on that? Sorry if I&#39;m not following, will take a closer look at your links. So essentially what is going on is when the client calls a method and the response contains cookies, the set cookie bit is run? Which I have extended."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1510688660, "post_id": 47293642, "comment_id": 81538843, "body": "<code>NewJar</code> allocates and returns a new instance of type <code>*Jar</code>, now type <code>*Jar</code>, thanks to the methods defined on it, implements the interface called <code>CookieJar</code>, implicitly. <code>http.Client</code> has a field called <code>Jar</code> which is defined as having the type <code>CookieJar</code>, that means that you can set <code>http.Client.Jar</code> to anything that implements the <code>CookieJar</code> interface. The <code>NewJarClient</code> function returns a new <code>*http.Client</code> instance with it&#39;s <code>Jar</code> field set to <code>*Jar</code> instance returned from <code>NewJar</code>. This allows the client to use <code>*Jar</code>&#39;s methods without really knowing it&#39;s a <code>*Jar</code>, it only..."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1510688879, "post_id": 47293642, "comment_id": 81538964, "body": ".. it only cares about the methods, which are then called by the <code>http.Client</code> when sending request. It doesn&#39;t matter what those <code>CookieJar</code> methods do, you can implement them to do anything. <code>http.Client</code> then calls your methods providing the parameters and handling the returned values how it sees fit."}, {"owner": {"reputation": 381, "user_id": 8573838, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-id8ZMMo9mIA/AAAAAAAAAAI/AAAAAAAAADM/VJic0_NAcpo/photo.jpg?sz=128", "display_name": "James Morgan", "link": "https://stackoverflow.com/users/8573838/james-morgan"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1510688969, "post_id": 47293642, "comment_id": 81539020, "body": "Perfect. That makes a lot more sense. I really appreciate it. Is there any way I can mark this question as solved using your comment as an answer? I&#39;m new to stack and I don&#39;t see an option to close it based on your reply :)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1510689144, "post_id": 47293642, "comment_id": 81539119, "body": "No problem, I&#39;ll turn the comments into a real answer."}, {"owner": {"reputation": 381, "user_id": 8573838, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-id8ZMMo9mIA/AAAAAAAAAAI/AAAAAAAAADM/VJic0_NAcpo/photo.jpg?sz=128", "display_name": "James Morgan", "link": "https://stackoverflow.com/users/8573838/james-morgan"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1510689339, "post_id": 47293642, "comment_id": 81539230, "body": "Awesome, thanks for all the help!"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510724509, "post_id": 47293642, "comment_id": 81551333, "body": "Please consider using the std cookie jar in net/http/cookiejar instead of your own hand-rolled one. Cookie handling is tricky."}, {"owner": {"reputation": 381, "user_id": 8573838, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-id8ZMMo9mIA/AAAAAAAAAAI/AAAAAAAAADM/VJic0_NAcpo/photo.jpg?sz=128", "display_name": "James Morgan", "link": "https://stackoverflow.com/users/8573838/james-morgan"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510735055, "post_id": 47293642, "comment_id": 81556280, "body": "@Volker is this in reference to my NewJar method? So that one should be replaced with the standard implementation of the cookiejar, correct? :)"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510740568, "post_id": 47293642, "comment_id": 81559589, "body": "@JordanAllen. Yes. Do not use your own (which is broken) but use a correct one, e.g. the one in the std lib."}, {"owner": {"reputation": 381, "user_id": 8573838, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-id8ZMMo9mIA/AAAAAAAAAAI/AAAAAAAAADM/VJic0_NAcpo/photo.jpg?sz=128", "display_name": "James Morgan", "link": "https://stackoverflow.com/users/8573838/james-morgan"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510740774, "post_id": 47293642, "comment_id": 81559726, "body": "Yes, just noticed mine is broke in the sense that when new cookies are set with the same name as existing ones. Instead of overwriting, the cookies are instead set again, leading to duplicate cookies. The standard lib doesn&#39;t allow for maintaining cookies across requests does it? So the rest of my implementation would remain the same aside from the NewJar? Sorry - new to the language @Volker"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510741588, "post_id": 47293642, "comment_id": 81560242, "body": "@JordanAllen Sorry for the drastic words but your implementation is completely broken, it is far of what a RFC 6265 compliant cookie jar would look like. Both methods Cookies and SetCookies are wrong (e.g. they handle paths wrong, ignore all flags, domain handling is missing, expiration is ignored, etc, pp) Please: Do not even try rolling your own. Use the standard one which does absolutely everything (of course it will &quot;maintaining cookies across requests&quot; because that is the <i>job</i> of a cookie jar) and in a correct way."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510741647, "post_id": 47293642, "comment_id": 81560276, "body": "@JordanAllen Try running the test cases of the std cookie jar implementation against your jar and see what is wrong. (Basically everything)."}, {"owner": {"reputation": 381, "user_id": 8573838, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-id8ZMMo9mIA/AAAAAAAAAAI/AAAAAAAAADM/VJic0_NAcpo/photo.jpg?sz=128", "display_name": "James Morgan", "link": "https://stackoverflow.com/users/8573838/james-morgan"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510741838, "post_id": 47293642, "comment_id": 81560422, "body": "@Volker honestly I appreciate the drastic words. Will help stop me running into just as drastic problems. I was under the impression there was no way to maintain sessions in requests without having to create my own version. Maybe the sources I used for research were dated or just as ill-informed as myself. I&#39;ll look for some ways to utilise the standard cookiejar. Thanks"}, {"owner": {"reputation": 381, "user_id": 8573838, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-id8ZMMo9mIA/AAAAAAAAAAI/AAAAAAAAADM/VJic0_NAcpo/photo.jpg?sz=128", "display_name": "James Morgan", "link": "https://stackoverflow.com/users/8573838/james-morgan"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510742844, "post_id": 47293642, "comment_id": 81561080, "body": "@Volker Got it all working now, going to answer my own question with a solution as I was looking for session maintenance across requests. Assumed for some reason I couldn&#39;t do it - not sure where I got that idea. got it working perfectly now with the standard implementation"}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 0, "last_activity_date": 1510689980, "last_edit_date": 1510689980, "creation_date": 1510689861, "answer_id": 47294292, "question_id": 47293642, "link": "https://stackoverflow.com/questions/47293642/how-cookies-are-managed-by-networking-code/47294292#47294292", "title": "How cookies are managed by networking code", "body": "<p><code>NewJar</code> allocates and returns a new instance of type <code>*Jar</code>, now type <code>*Jar</code>, thanks to the methods defined on it, implements the interface called <code>CookieJar</code>, implicitly.</p>\n\n<p>The <code>http.Client</code> type has a field called <code>Jar</code> which is defined as having the type <code>CookieJar</code>, that means that you can set <code>http.Client.Jar</code> to anything that implements the <code>CookieJar</code> interface, including the <code>*Jar</code> type. The <code>NewJarClient</code> function returns a new <code>*http.Client</code> instance with it's <code>Jar</code> field set to the <code>*Jar</code> instance returned by <code>NewJar</code>.</p>\n\n<p>This allows the returned client value to use <code>*Jar</code>'s methods without really knowing that it's a <code>*Jar</code>, it only knows that the value in its <code>Jar</code> field has the same set of methods as those defined by the <code>CookieJar</code> interface.</p>\n\n<p>So the <code>http.Client</code> instance, when sending requests, uses your <code>*Jar</code> by calling its methods providing the parameters and handling the returned values. How your <code>*Jar</code> is used by the client is an implementation detail of the <code>http.Client</code> type and you don't have to worry about that. You just need to make sure that the methods that implement the <code>CookieJar</code> interface do what you want them to do, how and when they are called is up to the client.</p>\n\n<p>But if you're interested in the implementation details of the client anyway, you can check out the source file of <a href=\"https://github.com/golang/go/blob/master/src/net/http/client.go\" rel=\"nofollow noreferrer\">http.Client</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 381, "user_id": 8573838, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-id8ZMMo9mIA/AAAAAAAAAAI/AAAAAAAAADM/VJic0_NAcpo/photo.jpg?sz=128", "display_name": "James Morgan", "link": "https://stackoverflow.com/users/8573838/james-morgan"}, "is_accepted": false, "score": 0, "last_activity_date": 1510743309, "creation_date": 1510743309, "answer_id": 47305561, "question_id": 47293642, "link": "https://stackoverflow.com/questions/47293642/how-cookies-are-managed-by-networking-code/47305561#47305561", "title": "How cookies are managed by networking code", "body": "<p>Due to misinformation in the form of a few dated blog posts, I came to the impression that I was unable to maintain cookies across requests in go - for some weird reason. Having thought that, I researched and looked into creating my own implementation which ca be seen above. It's been brought to my attention that my implementation is completely broken and flawed and that the standard http library itself can perfectly handle maintaining cookies, simply by including a value for the <code>Jar</code> when creating a client. For example:</p>\n\n<pre><code>jar, _ := cookiejar.New(nil)\n\nproxyURL, _ := url.Parse(\"http://127.0.0.1:8888\")\n\ntr := &amp;http.Transport{\n    MaxIdleConns:       10,\n    IdleConnTimeout:    30 * time.Second,\n    DisableCompression: true,\n    Proxy:              http.ProxyURL(proxyURL),\n}\n\nc := &amp;http.Client{\n    Jar:       jar,\n    Transport: tr,\n} \n</code></pre>\n"}], "owner": {"reputation": 381, "user_id": 8573838, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh4.googleusercontent.com/-id8ZMMo9mIA/AAAAAAAAAAI/AAAAAAAAADM/VJic0_NAcpo/photo.jpg?sz=128", "display_name": "James Morgan", "link": "https://stackoverflow.com/users/8573838/james-morgan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 47294292, "answer_count": 2, "score": 0, "last_activity_date": 1510743309, "creation_date": 1510687129, "last_edit_date": 1510690922, "question_id": 47293642, "link": "https://stackoverflow.com/questions/47293642/how-cookies-are-managed-by-networking-code", "title": "How cookies are managed by networking code", "body": "<p>I was recently migrating over from C# and looking to create some of my old applications. As such I have needed to find a way to manage sessions within Go web requests. I found a solution in the form of this code: </p>\n\n<pre><code>// Jar is session object struct - cookie jar including mutex for syncing\ntype Jar struct {\n    sync.Mutex\n    cookies map[string][]*http.Cookie\n}\n\n// NewJar is a function for creating cookie jar for use\nfunc NewJar() *Jar {\n    jar := new(Jar)\n    jar.cookies = make(map[string][]*http.Cookie)\n    return jar\n}\n\n// SetCookies sets the cookies for the jar\nfunc (jar *Jar) SetCookies(u *url.URL, cookies []*http.Cookie) {\n    jar.Lock()\n    if _, ok := jar.cookies[u.Host]; ok {\n        for _, c := range cookies {\n            jar.cookies[u.Host] = append(jar.cookies[u.Host], c)\n        }\n    } else {\n        jar.cookies[u.Host] = cookies\n    }\n    jar.Unlock()\n}\n\n// Cookies returns cookies for each host\nfunc (jar *Jar) Cookies(u *url.URL) []*http.Cookie {\n    return jar.cookies[u.Host]\n}\n\n// NewJarClient creates new client, utilising a NewJar()\nfunc NewJarClient() *http.Client {\n\n    proxyURL, _ := url.Parse(\"http://127.0.0.1:8888\")\n\n    tr := &amp;http.Transport{\n        MaxIdleConns:       10,\n        IdleConnTimeout:    30 * time.Second,\n        DisableCompression: true,\n        Proxy:              http.ProxyURL(proxyURL),\n    }\n\n    return &amp;http.Client{\n        Jar:       NewJar(),\n        Transport: tr,\n    }\n}\n</code></pre>\n\n<p>The problem I'm having is in understanding how this works. I create a client doing the following </p>\n\n<pre><code>client := NewJarClient()\n</code></pre>\n\n<p>but then when I issue networking fuctions using it such as a get request, the cookies automatically carry on and it all works as planned. The problem is  Ihave no idea why. I see no mention of methods such as the Cookies one or the <code>SetCookies</code> one ever being called and it seems to just handle each one by magically running the functions. Could someone annotate or explain the given methods line by line or in a way so that they'd make better sense to me coming over from a C# background. Thanks :) </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": true, "score": 2, "last_activity_date": 1510769826, "last_edit_date": 1510769826, "creation_date": 1510676559, "answer_id": 47290585, "question_id": 47290361, "link": "https://stackoverflow.com/questions/47290361/cant-understand-code-about-gos-print-function/47290585#47290585", "title": "can&#39;t understand code about go&#39;s print function", "body": "<p>You left out a vital piece of the example, the two lines preceding what you posted.</p>\n\n<pre><code>// Open the tar archive for reading.\nr := bytes.NewReader(buf.Bytes())\ntr := tar.NewReader(r)\n</code></pre>\n\n<p>This creates a <code>tar.Reader</code> which implements <code>io.Reader</code>. The statement <code>io.Copy(os.Stdout, tr)</code> in the <code>if</code> statement knows how to copy the contents of the reader to <code>Stdout</code>.</p>\n\n<p><a href=\"https://godoc.org/archive/tar#Reader\" rel=\"nofollow noreferrer\">Godoc for <code>tar.Reader</code></a></p>\n\n<p>Also might be useful to note that the code example in the package documentation doesn't ever write the tar it creates to disk. It is all done in memory using <code>bytes.Buffer</code>s. Examples of writing to disk would be in the <code>io</code> package.</p>\n"}], "owner": {"reputation": 97, "user_id": 8645601, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/92BVV.jpg?s=128&g=1", "display_name": "user8645601", "link": "https://stackoverflow.com/users/8645601/user8645601"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 47290585, "answer_count": 1, "score": 0, "last_activity_date": 1510769826, "creation_date": 1510675928, "last_edit_date": 1510676019, "question_id": 47290361, "link": "https://stackoverflow.com/questions/47290361/cant-understand-code-about-gos-print-function", "title": "can&#39;t understand code about go&#39;s print function", "body": "<p>i am new to golang, when i read the code example of package \"archtive/tar\",i read some code like this:</p>\n\n<pre><code>// Iterate through the files in the archive.\nfor {\nhdr, err := tr.Next()\n    if err == io.EOF {\n        // end of tar archive\n        break\n    }\n    if err != nil {\n        log.Fatalln(err)\n    }\n    fmt.Printf(\"Contents of %s:\\n\", hdr.Name)\n    if _, err := io.Copy(os.Stdout, tr); err != nil {\n        log.Fatalln(err)\n    }\n    fmt.Println()\n}\n</code></pre>\n\n<p>the output just like this:</p>\n\n<pre><code>Contents of readme.txt:\nThis archive contains some text files.\nContents of gopher.txt:\nGopher names:\nGeorge\nGeoffrey\nGonzo\nContents of todo.txt:\nGet animal handling license.\n</code></pre>\n\n<p>can anyone tell me how the programe print the body of the struct? thank you.</p>\n"}, {"tags": ["string", "go", "slice", "go-templates", "confd"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1510672142, "post_id": 47288067, "comment_id": 81528599, "body": "Not sure if this is what you&#39;re looking for <a href=\"https://play.golang.org/p/EHB-8BZ83o\" rel=\"nofollow noreferrer\">play.golang.org/p/EHB-8BZ83o</a>"}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "edited": false, "score": 0, "creation_date": 1510677437, "post_id": 47288067, "comment_id": 81532263, "body": "What do you exactly mean by &#39;split go template function&#39;? Templates are one mechanism, <code>strings.Spit</code> is a diferent one.."}, {"owner": {"reputation": 21030, "user_id": 15619, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2f169a510b7cba5a57e86d520b268447?s=128&d=identicon&r=PG", "display_name": "Riduidel", "link": "https://stackoverflow.com/users/15619/riduidel"}, "reply_to_user": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "edited": false, "score": 0, "creation_date": 1510741274, "post_id": 47288067, "comment_id": 81560050, "body": "@WojciechKaczmarek There is a <a href=\"https://github.com/kelseyhightower/confd/blob/master/docs/templates.md#split\" rel=\"nofollow noreferrer\"><code>split</code></a> function available in confd go templates, which is what I use to split my array"}, {"owner": {"reputation": 21030, "user_id": 15619, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2f169a510b7cba5a57e86d520b268447?s=128&d=identicon&r=PG", "display_name": "Riduidel", "link": "https://stackoverflow.com/users/15619/riduidel"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1510758912, "post_id": 47288067, "comment_id": 81572441, "body": "@mkopriva no because you use pure go where I&#39;m looking for a solution using go template. In fact, the better I can think about is creating a duplicated array and iterating it from the position of the element to remove"}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "edited": false, "score": 0, "creation_date": 1510759111, "post_id": 47288067, "comment_id": 81572578, "body": "@Riduidel I think that if you use the term &#39;go template&#39; people are assuming templates from standard Go library (<code>text&#47;template</code> or <code>html&#47;template</code>). Let&#39;s go back to the basics. Do you mean <a href=\"https://github.com/kelseyhightower/confd\" rel=\"nofollow noreferrer\">github.com/kelseyhightower/confd</a> ?"}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "edited": false, "score": 0, "creation_date": 1510759223, "post_id": 47288067, "comment_id": 81572697, "body": "Btw the SO tag you used also suggests the standard library templates I mentioned."}, {"owner": {"reputation": 21030, "user_id": 15619, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2f169a510b7cba5a57e86d520b268447?s=128&d=identicon&r=PG", "display_name": "Riduidel", "link": "https://stackoverflow.com/users/15619/riduidel"}, "reply_to_user": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "edited": false, "score": 0, "creation_date": 1510759593, "post_id": 47288067, "comment_id": 81572983, "body": "@WojciechKaczmarek yes, but, as far as I understand, confd uses an extended version of standard go templates. Am I right ?"}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "edited": false, "score": 1, "creation_date": 1510760080, "post_id": 47288067, "comment_id": 81573392, "body": "@Riduidel Maybe, I don&#39;t know. For sure, the <code>split</code> function is not in standard lib of template functions  <a href=\"https://golang.org/pkg/text/template/#hdr-Functions\" rel=\"nofollow noreferrer\">golang.org/pkg/text/template/#hdr-Functions</a> . I&#39;d suggest you add more explicit reference to that function so that the casual reader knows quickly it&#39;s not only about standard templates. Then you&#39;d get the faster &amp; more accurate answer from the actual user of the <code>confd</code> package. Can you cite a documentation of that <code>split</code> also?"}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1510760956, "post_id": 47288067, "comment_id": 81574103, "body": "Thanks. Now we know from the docs it&#39;s the same template language and also that <code>split</code> is a wrapper for <code>strings.Split</code>. Then you can adapt the proposal @mkopriva gave you. You just need to capture a result of <code>split</code> to a var and then use <code>append</code> from @mkopriva&#39;s example on it. Looks like it&#39;ll be shorter and more elegant than reiterating."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1510764182, "creation_date": 1510764182, "answer_id": 47312875, "question_id": 47288067, "link": "https://stackoverflow.com/questions/47288067/how-to-shift-slice-in-go-template/47312875#47312875", "title": "How to shift slice in go template?", "body": "<p>If you are unable to manipulate the slice/string outside the template, and if you are unable to add custom functions to the template either you will have do this inside the template. It's more verbose, but doable.</p>\n\n<p>One approach is to have two loops nested inside a parent loop. The parent will look for the container you want to leave out, at which point it will spawn the two child loops with <code>$i</code> holding the index of the one to be left out. The first child loop can then list containers whose index is greater than <code>$i</code> and the second child loop will list containers whose index is less than <code>$i</code>.</p>\n\n<pre><code>{{range $i, $c := $cons}}\n    {{/* find item to be skipped */}}\n    {{if (eq $c $.Skip)}}\n\n        {{range $j, $c := $cons}}\n            {{/* list items that come after the one to be skipped */}}\n            {{if (gt $j $i)}}\n                {{$c}}\n            {{end}}\n        {{end}}\n\n        {{range $j, $c := $cons}}\n            {{/* list items that come before the one to be skipped */}}\n            {{if (lt $j $i)}}\n                {{$c}}\n            {{end}}\n        {{end}}\n\n    {{end}}\n{{end}}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/lGdExfHAvy\" rel=\"nofollow noreferrer\">https://play.golang.org/p/lGdExfHAvy</a></p>\n"}], "owner": {"reputation": 21030, "user_id": 15619, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2f169a510b7cba5a57e86d520b268447?s=128&d=identicon&r=PG", "display_name": "Riduidel", "link": "https://stackoverflow.com/users/15619/riduidel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 623, "favorite_count": 2, "accepted_answer_id": 47312875, "answer_count": 1, "score": 1, "last_activity_date": 1519217329, "creation_date": 1510669189, "last_edit_date": 1519217329, "question_id": 47288067, "link": "https://stackoverflow.com/questions/47288067/how-to-shift-slice-in-go-template", "title": "How to shift slice in go template?", "body": "<p>I'm using <a href=\"https://github.com/kelseyhightower/confd\" rel=\"nofollow noreferrer\">confd</a> to populate a file through a template.</p>\n\n<p>In this file, I want to have a list of elements shifted and inserted.\nThis slice contains strings like</p>\n\n<pre><code>0=container-1\n1=container-2\n2=container-3\n3=container-4\n</code></pre>\n\n<p>(in fact, it is a string that I split using <a href=\"https://github.com/kelseyhightower/confd/blob/master/docs/templates.md#split\" rel=\"nofollow noreferrer\"><code>split</code></a> confd function).\n I want, on each container, be able to filter container name out and shift the list to have the ones after my container appear first. </p>\n\n<p>As an example, on <code>container-2</code> I would like to have as result</p>\n\n<pre><code>2=container-3\n3=container-4\n0=container-1\n</code></pre>\n\n<p>How to do that in a confd go template ? I think I know how to do that in go (but I'm not that good in that particular language), but I don't find how to do that using only a template ...</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1510669392, "post_id": 47288056, "comment_id": 81526393, "body": "<code>range</code> returns the index first: <a href=\"https://golang.org/ref/spec#For_range\" rel=\"nofollow noreferrer\">golang.org/ref/spec#For_range</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2437, "user_id": 1914002, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ae822f979980ea450842c7cc36baeb94?s=128&d=identicon&r=PG", "display_name": "dapangmao", "link": "https://stackoverflow.com/users/1914002/dapangmao"}, "edited": false, "score": 0, "creation_date": 1510669575, "post_id": 47288139, "comment_id": 81526519, "body": "Thanks for the quick answer!"}], "tags": [], "owner": {"reputation": 944, "user_id": 1498624, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/4WQ2c.jpg?s=128&g=1", "display_name": "grabthefish", "link": "https://stackoverflow.com/users/1498624/grabthefish"}, "is_accepted": true, "score": 5, "last_activity_date": 1510669433, "creation_date": 1510669433, "answer_id": 47288139, "question_id": 47288056, "link": "https://stackoverflow.com/questions/47288056/different-results-for-string-iteration-in-go/47288139#47288139", "title": "Different results for string iteration in Go", "body": "<pre><code>for x := range str {\n    println(x - 'a')\n}\n</code></pre>\n\n<p>x contains the index of the letter</p>\n\n<p>what you want to do is take the second value returned by the range and ignore the first</p>\n\n<pre><code>for _, x := range str {\n    println(x - 'a')\n}\n</code></pre>\n"}], "owner": {"reputation": 2437, "user_id": 1914002, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ae822f979980ea450842c7cc36baeb94?s=128&d=identicon&r=PG", "display_name": "dapangmao", "link": "https://stackoverflow.com/users/1914002/dapangmao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 47288139, "answer_count": 1, "score": -1, "last_activity_date": 1510669433, "creation_date": 1510669130, "question_id": 47288056, "link": "https://stackoverflow.com/questions/47288056/different-results-for-string-iteration-in-go", "title": "Different results for string iteration in Go", "body": "<p>Just used two simple ways to iterate a string in Go. The first one seems right but the second way got minus numbers starting with -97. Could somebody knows why?</p>\n\n<pre><code>func main() {\n    str := \"abc\"\n\n    for i := 0; i &lt; len(str) ; i++ {\n        println(str[i] - 'a')\n    }\n\n    for x := range str {\n        println(x - 'a')\n    }\n}\n</code></pre>\n\n<p>The result is -</p>\n\n<pre><code>0\n1\n2\n-97\n-96\n-95\n</code></pre>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 24536, "user_id": 111124, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8215e290861f1c44a457d26c4f24af70?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/111124/andrew"}, "edited": false, "score": 1, "creation_date": 1510669408, "post_id": 47287973, "comment_id": 81526398, "body": "*discordgo.Session looks to be a struct, not an interface."}, {"owner": {"reputation": 55556, "user_id": 197606, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/14da0a77145571d61cee03ac6bb0fb35?s=128&d=identicon&r=PG", "display_name": "Webnet", "link": "https://stackoverflow.com/users/197606/webnet"}, "reply_to_user": {"reputation": 24536, "user_id": 111124, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8215e290861f1c44a457d26c4f24af70?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/111124/andrew"}, "edited": false, "score": 0, "creation_date": 1510669830, "post_id": 47287973, "comment_id": 81526714, "body": "@Andrew You are correct, I meant to include the link for <a href=\"https://godoc.org/github.com/bwmarrin/discordgo#Session\" rel=\"nofollow noreferrer\">godoc.org/github.com/bwmarrin/discordgo#Session</a>.  Can you help me understand the impact of that?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1510670041, "post_id": 47287973, "comment_id": 81526885, "body": "@Webnet: go is statically typed, you can&#39;t substitute one concrete type for another. You might be able to replace <code>ready</code> with a function that takes an interface exposing just the methods you need, but <code>ready</code> doesn&#39;t do anything but call <code>UpdateStatus</code>, which we would hope is already tested."}], "answers": [{"comments": [{"owner": {"reputation": 55556, "user_id": 197606, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/14da0a77145571d61cee03ac6bb0fb35?s=128&d=identicon&r=PG", "display_name": "Webnet", "link": "https://stackoverflow.com/users/197606/webnet"}, "edited": false, "score": 0, "creation_date": 1510670519, "post_id": 47288349, "comment_id": 81527270, "body": "Thanks for the details.  When using this approach, I get the error <code>event.go:115:AddHandler() Invalid handler type, handler will never be called</code>.  Digging further it looks like it&#39;s wanting a <code>handler interface</code> which I can&#39;t find - <a href=\"https://github.com/bwmarrin/discordgo/blob/master/event.go#L111\" rel=\"nofollow noreferrer\">github.com/bwmarrin/discordgo/blob/master/event.go#L111</a>"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1510681518, "post_id": 47288349, "comment_id": 81534721, "body": "And <i>that</i> is because the author of that library has coded it in a manner that makes is nearly impossible to mock.  He accepts a function as an empty interface to AddHandler, but then matches it against a very long list of specific concrete function types (<a href=\"https://github.com/bwmarrin/discordgo/blob/master/eventhandlers.go#L895\" rel=\"nofollow noreferrer\">github.com/bwmarrin/discordgo/blob/master/eventhandlers.go#&zwnj;&#8203;L895</a>).  Might be worth opening a ticket on his repo and requesting he make it a bit easier to test with mocks."}, {"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1510692147, "post_id": 47288349, "comment_id": 81540672, "body": "AHHH didn&#39;t see the addHandler call to register <code>ready</code> :( :("}], "tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": true, "score": 1, "last_activity_date": 1510670414, "last_edit_date": 1510670414, "creation_date": 1510670110, "answer_id": 47288349, "question_id": 47287973, "link": "https://stackoverflow.com/questions/47287973/how-to-use-a-struct-interface-to-mock-dependency-for-testing/47288349#47288349", "title": "How to use a struct/interface to mock dependency for testing", "body": "<p>As @Andrew pointed out <code>discordgo.Session</code> is a go struct (from the docs link you posted <code>type Session struct {</code>)</p>\n\n<p><code>structs</code> are Concrete types in go and are unable to be substituted.  The only argument go compiler will allow for <code>ready</code> is a pointer to a session.</p>\n\n<p>To break this dependency you can create a custom <a href=\"https://gobyexample.com/interfaces\" rel=\"nofollow noreferrer\">interface</a> owned and controlled by your project using the methods that you need.  This will allow you to create and call <code>ready</code> with a fake structure for your tests.</p>\n\n<p>Sometimes 3rd party libraries already have interfaces so it's usually worth-while to scan their godoc to see which interfaces are available before creating your own.</p>\n\n<hr>\n\n<p>But if you have to create your own for testing (and I find myself regularly having to do this), it might look like:</p>\n\n<pre><code>type StatusUpdater interface {\n   UpdateStatus(int, string)\n}\n\n// This function will be called (due to AddHandler above) when the bot receives\n// the \"ready\" event from Discord.\nfunc ready(s StatusUpdater, event *discordgo.Ready) {\n\n    // Set the playing status.\n    s.UpdateStatus(0, status)\n}\n</code></pre>\n\n<p>Now the dependency on <code>discordgo.Session</code> has been broken, and your test code can call <code>ready</code> function with its fake session, and then make assertions on it!</p>\n"}], "owner": {"reputation": 55556, "user_id": 197606, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/14da0a77145571d61cee03ac6bb0fb35?s=128&d=identicon&r=PG", "display_name": "Webnet", "link": "https://stackoverflow.com/users/197606/webnet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 701, "favorite_count": 0, "accepted_answer_id": 47288349, "answer_count": 1, "score": 0, "last_activity_date": 1510670463, "creation_date": 1510668844, "last_edit_date": 1510670463, "question_id": 47287973, "link": "https://stackoverflow.com/questions/47287973/how-to-use-a-struct-interface-to-mock-dependency-for-testing", "title": "How to use a struct/interface to mock dependency for testing", "body": "<p>I'm new to go here... my objective is to unit test that a status is being updated in my ready().  I've been looking at <a href=\"https://engineering.aircto.com/writing-testable-code-in-golang/\" rel=\"nofollow noreferrer\">https://engineering.aircto.com/writing-testable-code-in-golang/</a> and trying to figure out how to adapt what they're doing to my use case, filling in gaps of golang knowledge where I can.</p>\n\n<p>I'm getting the error <strong>cannot use fakeSession (type *FakeSession) as type *discordgo.Session in argument to ready</strong> but I'm not sure <em>why</em> I'm getting this error.</p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>import (\n    \"fmt\"\n    \"os\"\n    \"os/signal\"\n    \"syscall\"\n\n    \"github.com/bwmarrin/discordgo\"\n)\n\nvar (\n    // bot token used for this bot when connecting\n    token    = os.Getenv(\"DISCORD_BOT_TOKEN\")\n    status   = os.Getenv(\"BOT_STATUS\")\n)\n\nfunc main() {\n    // initiate Discord bot\n\n    // Register ready as a callback for the ready events.\n    discordConnection.AddHandler(ready)\n\n    // running the app, waiting to receive a close signal\n}\n\n// This function will be called (due to AddHandler above) when the bot receives\n// the \"ready\" event from Discord.\nfunc ready(session *discordgo.Session, event *discordgo.Ready) {\n\n    // Set the playing status.\n    session.UpdateStatus(0, status)\n}\n</code></pre>\n\n<p><strong>main_test.go</strong></p>\n\n<pre><code>type FakeSession struct {\n    status  string\n    idle    int\n}\n\nfunc (f *FakeSession) UpdateStatus(idle int, game string) error {\n    f.idle, f.status = idle, game\n    return nil\n}\n\nfunc TestStatusIsUpdated(t *testing.T) {\n    readyDependency := &amp;discordgo.Ready{}\n    fakeSession := &amp;FakeSession{}\n\n    ready(fakeSession, readyDependency)\n\n    // @todo assert that idle/game status were set to correct values\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510668599, "post_id": 47287795, "comment_id": 81525836, "body": "Of course there is: You did not strip the leading / from the URL Path."}, {"owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510668785, "post_id": 47287795, "comment_id": 81525974, "body": "To the person that voted to close because of off-topic could you please care to explain?. @Volker I thought that the split method would do that but now I see exactly what it does. I just picked up Go yesterday coming from a javascript background so there&#39;s much to learn!"}, {"owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510672303, "post_id": 47287795, "comment_id": 81528696, "body": "@Volker There&#39;s no need to come off as condescending. I have been reading the documentation but I as an individual do not learn well by documentation even by trying examples. I learn best by answers by people who can explain the concept how it would be explained face to face. You shouldn&#39;t assume things just as I didn&#39;t assume that&#39;s how split worked it&#39;s what I thought it did and it took someone explaining it in different terms than the documentation to understand it better."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510672577, "post_id": 47287795, "comment_id": 81528885, "body": "Please excuse if I made a condescending statement, I didn&#39;t intend to. But please note that  rating on questions does not rate your need for an answer or how helpful an answer would be to you but how helpful and important the question is for others. As this is a very specific problem with a trivial underlying cause I do not think lots of other people will benefit from answers to this question."}, {"owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510672719, "post_id": 47287795, "comment_id": 81528998, "body": "@Volker I understand and I will close the question but the answer provided here taught me more than in 5 minutes than the documentation did in 1 hour. Thank you for your inputs."}], "answers": [{"comments": [{"owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "edited": false, "score": 0, "creation_date": 1510668935, "post_id": 47287896, "comment_id": 81526080, "body": "Oh that makes much more sense now looking at it, I didnt even think of the quotes being stripped. Another question arises though, if I pass in <code>localhost:8080&#47;</code> as the parameter for the prefix string, it still gives 3 as the length. Isn&#39;t it supposed to strip off the base so that it&#39;s <code>api&#47;users</code> instead of <code>&#47;api&#47;users</code> now and then split would correctly remove the one slash and return 2?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "edited": false, "score": 0, "creation_date": 1510671613, "post_id": 47287896, "comment_id": 81528214, "body": "@Mr.Smithyyy <code>localhost:8080&#47;</code> is a host therefore it&#39;s doubtful that <code>r.URL.Path</code> contains that."}, {"owner": {"reputation": 601, "user_id": 2179112, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dae92dd58d619263a99d1eaee40ad8bc?s=128&d=identicon&r=PG", "display_name": "Heinrich supports Monica", "link": "https://stackoverflow.com/users/2179112/heinrich-supports-monica"}, "reply_to_user": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "edited": false, "score": 0, "creation_date": 1510675973, "post_id": 47287896, "comment_id": 81531288, "body": "@Mr.Smithyyy <code>localhost:8080</code> is a host (with :port), and the <code>&#47;</code> at the end is already part of the path, which thus is <code>&#47;api&#47;users</code>."}], "tags": [], "owner": {"reputation": 601, "user_id": 2179112, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dae92dd58d619263a99d1eaee40ad8bc?s=128&d=identicon&r=PG", "display_name": "Heinrich supports Monica", "link": "https://stackoverflow.com/users/2179112/heinrich-supports-monica"}, "is_accepted": true, "score": 1, "last_activity_date": 1510668630, "creation_date": 1510668630, "answer_id": 47287896, "question_id": 47287795, "link": "https://stackoverflow.com/questions/47287795/trouble-parsing-parameters/47287896#47287896", "title": "Trouble parsing parameters", "body": "<p>What you are seeing is not a space (that's just the separator), but an empty string, so the array looks like this <code>[\"\", \"api\", \"users\"]</code>. If you take away the commas and quotes, it will look like your output.\nSo, your params are \"\"/\"api\"/\"users\". Usually, you can skip this 0-th index when processing the params.</p>\n"}], "owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 30, "favorite_count": 0, "accepted_answer_id": 47287896, "answer_count": 1, "score": -1, "last_activity_date": 1510668630, "creation_date": 1510668311, "question_id": 47287795, "link": "https://stackoverflow.com/questions/47287795/trouble-parsing-parameters", "title": "Trouble parsing parameters", "body": "<p>I'm trying to use a simple method that will take the request and parse the parameters but it returns the wrong number of parameters.</p>\n\n<p>In my main I make a request and then call:</p>\n\n<p><code>fmt.Println(parseParams(r, \"http://localhost:8080\", 2))</code> </p>\n\n<p>which leads to following values being set in the method when logged:</p>\n\n<p><strong>url:</strong> <code>/api/users</code></p>\n\n<p><strong>params:</strong> <code>[ api users]</code></p>\n\n<p><strong>len(params):</strong> <code>3</code></p>\n\n<p>So it seems as if it think there's one extra param that I don't specify and looking at it more closely I can see theres a space before api in the params but I don't know where that comes from</p>\n\n<pre><code>func parseParams(req *http.Request, prefix string, num int) ([]string, error) {\n    url := strings.TrimPrefix(req.URL.Path, prefix)\n    params := strings.Split(url, \"/\")\n\n    if len(params) != num || len(params[0]) == 0 || len(params[1]) == 0 {\n        return nil, fmt.Errorf(\"Bad format. Expecting exactly %d params\", num)\n    }\n\n    return params, nil\n}\n</code></pre>\n"}, {"tags": ["go", "types"], "comments": [{"owner": {"reputation": 8224, "user_id": 985383, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/anF0k.png?s=128&g=1", "display_name": "piggyback", "link": "https://stackoverflow.com/users/985383/piggyback"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1510663469, "post_id": 47286194, "comment_id": 81522159, "body": "thank, I have updated it - I still don&#39;t understand how I can use it. Do I have to cast Amount to this type? How do I use it in practice?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1510663697, "post_id": 47286194, "comment_id": 81522309, "body": "How do you convert a byte b to an uint16? <code>uint16(b)</code>. That&#39;s a general rule."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1510666206, "post_id": 47286194, "comment_id": 81524120, "body": "What exactly are you trying to do? The whole point of the <code>math&#47;big</code> types is to use their methods, and you&#39;re removing the methods."}], "answers": [{"comments": [{"owner": {"reputation": 8224, "user_id": 985383, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/anF0k.png?s=128&g=1", "display_name": "piggyback", "link": "https://stackoverflow.com/users/985383/piggyback"}, "edited": false, "score": 0, "creation_date": 1510663585, "post_id": 47286280, "comment_id": 81522234, "body": "what does it mean to have unexported fields?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 8224, "user_id": 985383, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/anF0k.png?s=128&g=1", "display_name": "piggyback", "link": "https://stackoverflow.com/users/985383/piggyback"}, "edited": false, "score": 1, "creation_date": 1510663668, "post_id": 47286280, "comment_id": 81522291, "body": "@nick: Sounds like you should take the <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">Go Tour</a> to get a grasp of basic concepts like exported and unexported fields in Go."}, {"owner": {"reputation": 8224, "user_id": 985383, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/anF0k.png?s=128&g=1", "display_name": "piggyback", "link": "https://stackoverflow.com/users/985383/piggyback"}, "edited": false, "score": 0, "creation_date": 1510663670, "post_id": 47286280, "comment_id": 81522292, "body": "I obtain by running what you are showing <code>cannot convert big.NewInt(100) (type *big.Int) to type Dimension</code>"}, {"owner": {"reputation": 1600, "user_id": 4562156, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/WuCmq.jpg?s=128&g=1", "display_name": "Sean Pianka", "link": "https://stackoverflow.com/users/4562156/sean-pianka"}, "edited": false, "score": 0, "creation_date": 1584520882, "post_id": 47286280, "comment_id": 107458359, "body": "The error indicates you are returning a big.NewInt from a function which returns a Dimension"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1510678344, "last_edit_date": 1510678344, "creation_date": 1510663550, "answer_id": 47286280, "question_id": 47286194, "link": "https://stackoverflow.com/questions/47286194/using-type-definition-in-golang/47286280#47286280", "title": "Using type definition in Golang", "body": "<p>Given:</p>\n\n<pre><code>type Dimension big.Int\n</code></pre>\n\n<p>There is no way to declare a <code>Dimension</code> without using the <code>big</code> package's <code>Int</code> initializer, since it contains unexported fields.  So your best bet is to wrap the underlying initializer with your own:</p>\n\n<pre><code>func NewDimension(i int64) *Dimension {\n    x := big.NewInt(100)\n    z := Dimension(*x)\n    return &amp;z\n}\n</code></pre>\n\n<p>Then call it as:</p>\n\n<pre><code>i := NewDimension(100)\n</code></pre>\n"}], "owner": {"reputation": 8224, "user_id": 985383, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/anF0k.png?s=128&g=1", "display_name": "piggyback", "link": "https://stackoverflow.com/users/985383/piggyback"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5948, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1510678344, "creation_date": 1510663283, "last_edit_date": 1510663442, "question_id": 47286194, "link": "https://stackoverflow.com/questions/47286194/using-type-definition-in-golang", "title": "Using type definition in Golang", "body": "<p>In my code I have:</p>\n\n<pre><code>type Dimension big.Int\n</code></pre>\n\n<p>However, it is not clear to me how I can initialize a dimension object.\nI know that I can create a big.Int object by doing:</p>\n\n<pre><code>i := big.NewInt(100)\n</code></pre>\n\n<p>However, how do I convert it to <code>Dimension</code>, or better, how can I initialized it directly as <code>Dimension</code>?</p>\n"}, {"tags": ["go", "package"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1510663971, "post_id": 47285916, "comment_id": 81522515, "body": "As you can see this in <a href=\"https://github.com/zvelo/ttlru/blob/master/ttlru.go#L12\" rel=\"nofollow noreferrer\">github.com/zvelo/ttlru/blob/master/ttlru.go#L12</a> packages expects to be imported as &quot;zvelo.io/ttlru&quot; so you must import it that way. No arguing."}], "answers": [{"comments": [{"owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "edited": false, "score": 0, "creation_date": 1510662984, "post_id": 47286018, "comment_id": 81521842, "body": "There is no such repo in github or I don&#39;t have access"}], "tags": [], "owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "is_accepted": true, "score": 5, "last_activity_date": 1510662787, "creation_date": 1510662787, "answer_id": 47286018, "question_id": 47285916, "link": "https://stackoverflow.com/questions/47285916/golang-cannot-install-package-zvelo-ttlru/47286018#47286018", "title": "Golang: cannot install package zvelo/ttlru", "body": "<p>try go getting and importing \"zvelo.io/ttlru\"</p>\n"}, {"tags": [], "owner": {"reputation": 804, "user_id": 7171834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9r1VB.png?s=128&g=1", "display_name": "Peter Gloor", "link": "https://stackoverflow.com/users/7171834/peter-gloor"}, "is_accepted": false, "score": 2, "last_activity_date": 1510740736, "last_edit_date": 1510740736, "creation_date": 1510740259, "answer_id": 47304424, "question_id": 47285916, "link": "https://stackoverflow.com/questions/47285916/golang-cannot-install-package-zvelo-ttlru/47304424#47304424", "title": "Golang: cannot install package zvelo/ttlru", "body": "<p>As stated in the <a href=\"https://github.com/zvelo/ttlru\" rel=\"nofollow noreferrer\">README.md</a> and the error message, import from zvelo.io/ttlru and not github.com/zvelo/ttlru.</p>\n\n<p>Make sure to use <code>go get zvelo.io/ttlru</code></p>\n\n<p>You will then find the source of the package in <code>/home/.../work_go/src/zvelo.io/ttlru/</code>.</p>\n"}], "owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 47286018, "answer_count": 2, "score": 4, "last_activity_date": 1542469188, "creation_date": 1510662478, "last_edit_date": 1542469188, "question_id": 47285916, "link": "https://stackoverflow.com/questions/47285916/golang-cannot-install-package-zvelo-ttlru", "title": "Golang: cannot install package zvelo/ttlru", "body": "<p>I would like to use <a href=\"https://github.com/zvelo/ttlru\" rel=\"nofollow noreferrer\">zvelo/ttlru</a> and have successfully <code>go get</code> this package from github. </p>\n\n<p><strong>Problem:</strong></p>\n\n<p>The following error occurs, when I try to <code>go run</code> my go program, that contains the <code>import \"github.com/zvelo/ttlru\"</code>:</p>\n\n<blockquote>\n  <p>go_server.go:8:2: code in directory\n  /home/.../work_go/src/github.com/zvelo/ttlru expects import\n  \"zvelo.io/ttlru\"</p>\n</blockquote>\n\n<p>What is wrong here? I don't see any <code>zvelo.io/ttlru</code> imports anywhere.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510661889, "post_id": 47285629, "comment_id": 81521138, "body": "ASCII is 7 bit and fits very well into a byte. Please clarify."}, {"owner": {"reputation": 303, "user_id": 1819455, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2cbd3418f87a820190f8a5af32468ace?s=128&d=identicon&r=PG&f=1", "display_name": "zerozero7", "link": "https://stackoverflow.com/users/1819455/zerozero7"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510662257, "post_id": 47285629, "comment_id": 81521364, "body": "I just started to learn go - what I wanted is to generate latin alphabet using <code>for</code> loop, and parsing int values to chars. Sorry if I asked the wrong question"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1510663590, "post_id": 47285629, "comment_id": 81522237, "body": "<code>for c := &#39;A&#39;; c &lt;=&#39;Z&#39;; c++ { fmt.Printf(&quot;%c&quot;, c) }</code>. Int-values <i>are</i> chars, maybe you want to convert them to runes. Please study &quot;Strings, bytes, runes and characters in Go&quot; <a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">blog.golang.org/strings</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1510666692, "post_id": 47285629, "comment_id": 81524464, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/29914662/equivalent-of-pythons-ord-chr-in-go/29914705#29914705\">Equivalent of python&#39;s ord(), chr() in go?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 2, "last_activity_date": 1510847616, "creation_date": 1510847616, "answer_id": 47333956, "question_id": 47285629, "link": "https://stackoverflow.com/questions/47285629/how-to-convert-ascii-code-to-byte-in-golang/47333956#47333956", "title": "How to convert ascii code to byte in golang?", "body": "<p>Golang string literals are UTF-8 and since ASCII is a subset of UTF-8, and each of its characters are only 7 bits, we can easily get them as bytes by casting (e.g. <code>bytes := []byte(str)</code>:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n  asciiStr := \"ABC\"\n  asciiBytes := []byte(asciiStr)\n\n  fmt.Printf(\"OK: string=%v, bytes=%v\\n\", asciiStr, asciiBytes)\n  fmt.Printf(\"OK: byte(A)=%v\\n\", asciiBytes[0])\n}\n// OK: string=ABC, bytes=[65 66 67]\n// OK: byte(A)=65\n</code></pre>\n"}], "owner": {"reputation": 303, "user_id": 1819455, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2cbd3418f87a820190f8a5af32468ace?s=128&d=identicon&r=PG&f=1", "display_name": "zerozero7", "link": "https://stackoverflow.com/users/1819455/zerozero7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10378, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1510847616, "creation_date": 1510661673, "question_id": 47285629, "link": "https://stackoverflow.com/questions/47285629/how-to-convert-ascii-code-to-byte-in-golang", "title": "How to convert ascii code to byte in golang?", "body": "<p>As the title say, I can find the function to give me ascii code of bytes, but not the other way around</p>\n"}, {"tags": ["go", "webserver", "go-server"], "answers": [{"comments": [{"owner": {"reputation": 4095, "user_id": 3489228, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dc8a6bb66b246e776aa08f382b219b1d?s=128&d=identicon&r=PG&f=1", "display_name": "Jeff P Chacko", "link": "https://stackoverflow.com/users/3489228/jeff-p-chacko"}, "edited": false, "score": 1, "creation_date": 1510726794, "post_id": 47286697, "comment_id": 81552130, "body": "This is interesting. I&#39;d figured out another approach where I use <code>http.ServeFile</code>. Where I first check if file exists using <code>os.Stat</code> and then serve the corresponding file or index.html. Could you also tell me which approach would be better and why?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 4095, "user_id": 3489228, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dc8a6bb66b246e776aa08f382b219b1d?s=128&d=identicon&r=PG&f=1", "display_name": "Jeff P Chacko", "link": "https://stackoverflow.com/users/3489228/jeff-p-chacko"}, "edited": false, "score": 0, "creation_date": 1510730515, "post_id": 47286697, "comment_id": 81553839, "body": "@JeffPChacko The handler returned by <code>http.FileServer()</code> also uses <code>http.ServeFile()</code> (or parts of its implementation) under the hood, but also provides other goodies like directory listing and security to make sure no file is served outside of the given folder. If don&#39;t use <code>http.FileServer()</code>, you have to take care of these (e.g. you have to normalize / resolve tricky request paths containing <code>..</code>)."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 10, "last_activity_date": 1510674749, "last_edit_date": 1510674749, "creation_date": 1510664937, "answer_id": 47286697, "question_id": 47285119, "link": "https://stackoverflow.com/questions/47285119/how-to-custom-handle-a-file-not-being-found-when-using-go-static-file-server/47286697#47286697", "title": "How to custom handle a file not being found when using go static file server?", "body": "<p>The handler returned by <a href=\"https://golang.org/pkg/net/http/#FileServer\" rel=\"noreferrer\"><code>http.FileServer()</code></a> does not support customization, it does not support providing a custom 404 page or action.</p>\n\n<p>What we may do is wrap the handler returned by <code>http.FileServer()</code>, and in our handler we may do whatever we want of course. In our wrapper handler we will call the file server handler, and if that would send a <code>404</code> not found response, we won't send it to the client but replace it with a redirect response.</p>\n\n<p>To achieve that, in our wrapper we create a wrapper <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"noreferrer\"><code>http.ResponseWriter</code></a> which we will pass to the handler returned by <code>http.FileServer()</code>, and in this wrapper response writer we may inspect the status code, and if it's <code>404</code>, we may act to <em>not</em> send the response to the client, but instead send a redirect to <code>/index.html</code>.</p>\n\n<p>This is an example how this wrapper <code>http.ResponseWriter</code> may look like:</p>\n\n<pre><code>type NotFoundRedirectRespWr struct {\n    http.ResponseWriter // We embed http.ResponseWriter\n    status              int\n}\n\nfunc (w *NotFoundRedirectRespWr) WriteHeader(status int) {\n    w.status = status // Store the status for our own use\n    if status != http.StatusNotFound {\n        w.ResponseWriter.WriteHeader(status)\n    }\n}\n\nfunc (w *NotFoundRedirectRespWr) Write(p []byte) (int, error) {\n    if w.status != http.StatusNotFound {\n        return w.ResponseWriter.Write(p)\n    }\n    return len(p), nil // Lie that we successfully written it\n}\n</code></pre>\n\n<p>And wrapping the handler returned by <code>http.FileServer()</code> may look like this:</p>\n\n<pre><code>func wrapHandler(h http.Handler) http.HandlerFunc {\n    return func(w http.ResponseWriter, r *http.Request) {\n        nfrw := &amp;NotFoundRedirectRespWr{ResponseWriter: w}\n        h.ServeHTTP(nfrw, r)\n        if nfrw.status == 404 {\n            log.Printf(\"Redirecting %s to index.html.\", r.RequestURI)\n            http.Redirect(w, r, \"/index.html\", http.StatusFound)\n        }\n    }\n}\n</code></pre>\n\n<p>Note that I used <code>http.StatusFound</code> redirect status code instead of <code>http.StatusMovedPermanently</code> as the latter may be cached by browsers, and so if a file with that name is created later, the browser would not request it but display <code>index.html</code> immediately.</p>\n\n<p>And now put this in use, the <code>main()</code> function:</p>\n\n<pre><code>func main() {\n    fs := wrapHandler(http.FileServer(http.Dir(\".\")))\n    http.HandleFunc(\"/\", fs)\n    panic(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p>Attempting to query a non-existing file, we'll see this in the log:</p>\n\n<pre><code>2017/11/14 14:10:21 Redirecting /a.txt3 to /index.html.\n2017/11/14 14:10:21 Redirecting /favicon.ico to /index.html.\n</code></pre>\n\n<p>Note that our custom handler (being well-behaviour) also redirected the request to <code>/favico.ico</code> to <code>index.html</code> because I do not have a <code>favico.ico</code> file in my file system. You may want to add this as an exception if you don't have it either.</p>\n\n<p>The full example is available on the <a href=\"https://play.golang.org/p/5E9KreSsnp\" rel=\"noreferrer\">Go Playground</a>. You can't run it there, save it to your local Go workspace and run it locally.</p>\n\n<p>Also check this related question: <a href=\"https://stackoverflow.com/questions/34017342/log-404-on-http-fileserver\">Log 404 on http.FileServer</a></p>\n"}], "owner": {"reputation": 4095, "user_id": 3489228, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dc8a6bb66b246e776aa08f382b219b1d?s=128&d=identicon&r=PG&f=1", "display_name": "Jeff P Chacko", "link": "https://stackoverflow.com/users/3489228/jeff-p-chacko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1914, "favorite_count": 1, "accepted_answer_id": 47286697, "answer_count": 1, "score": 6, "last_activity_date": 1510674749, "creation_date": 1510660242, "question_id": 47285119, "link": "https://stackoverflow.com/questions/47285119/how-to-custom-handle-a-file-not-being-found-when-using-go-static-file-server", "title": "How to custom handle a file not being found when using go static file server?", "body": "<p>So I'm using a go server to serve up a single page web application.  </p>\n\n<p>This works for serving all the assets on the root route. All the CSS and HTML are served up correctly. </p>\n\n<pre><code>fs := http.FileServer(http.Dir(\"build\"))\nhttp.Handle(\"/\", fs)\n</code></pre>\n\n<p>So when the URL is <code>http://myserverurl/index.html</code> or <code>http://myserverurl/styles.css</code>, it serves the corresponding file.</p>\n\n<p>But for a URL like <code>http://myserverurl/myCustompage</code>, it throws <code>404</code> if <code>myCustompage</code> is not a file in the build folder.  </p>\n\n<p>How do I make all routes for which a file does not exist serve <code>index.html</code>? </p>\n\n<p>It is a single page web application and it will render the appropriate screen once the html and js are served. But it needs <code>index.html</code> to be served on routes for which there is no file.</p>\n\n<p>How can this be done?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1510677188, "post_id": 47286088, "comment_id": 81532115, "body": "I suggest posting a link to the godoc for the command. Maybe explain why it works as well. I just can&#39;t bring myself to upvote a 3 word answer..."}], "tags": [], "owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "is_accepted": true, "score": 3, "last_activity_date": 1510720445, "last_edit_date": 1510720445, "creation_date": 1510662974, "answer_id": 47286088, "question_id": 47283877, "link": "https://stackoverflow.com/questions/47283877/spawning-a-docker-command-yields-an-empty-result/47286088#47286088", "title": "Spawning a docker command yields an empty result", "body": "<p>try <a href=\"https://golang.org/pkg/os/exec/#Cmd.CombinedOutput\" rel=\"nofollow noreferrer\">using cmd.CombinedOutput()</a></p>\n"}], "owner": {"reputation": 338, "user_id": 7568347, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2TaRT.jpg?s=128&g=1", "display_name": "timonweb", "link": "https://stackoverflow.com/users/7568347/timonweb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 47286088, "answer_count": 1, "score": 0, "last_activity_date": 1510720445, "creation_date": 1510656900, "question_id": 47283877, "link": "https://stackoverflow.com/questions/47283877/spawning-a-docker-command-yields-an-empty-result", "title": "Spawning a docker command yields an empty result", "body": "<p>I have the following Go code, where I try to spawn <code>docker</code> command and get its output:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"os/exec\"\n\nfunc main() {\n    cmd := exec.Command(\"docker\")\n    cmdOutput, err := cmd.Output()\n    if (err != nil) {\n        panic(err)\n    }\n    fmt.Println(string(cmdOutput))\n}\n</code></pre>\n\n<p>But when I run this code as a result I get an empty string, which is stange since I get an output when I run <code>docker</code> command directly in a command line. </p>\n\n<p>Moreover, this same code yields results just fine if I spawn other commands with it, for example <code>ls</code>. </p>\n\n<p>What may be wrong here?</p>\n"}, {"tags": ["go", "range", "beego"], "answers": [{"comments": [{"owner": {"reputation": 29, "user_id": 8500854, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-aerqM9C_dlU/AAAAAAAAAAI/AAAAAAAAAJ0/Em40PjeWx9Q/photo.jpg?sz=128", "display_name": "Ravindra Mandalapu", "link": "https://stackoverflow.com/users/8500854/ravindra-mandalapu"}, "edited": false, "score": 0, "creation_date": 1510657235, "post_id": 47283067, "comment_id": 81517968, "body": "Thanks for the reply, but in my case i have different range of numbers and each case this dropdown will be different. how can i get different arrays based on number"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 29, "user_id": 8500854, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-aerqM9C_dlU/AAAAAAAAAAI/AAAAAAAAAJ0/Em40PjeWx9Q/photo.jpg?sz=128", "display_name": "Ravindra Mandalapu", "link": "https://stackoverflow.com/users/8500854/ravindra-mandalapu"}, "edited": false, "score": 0, "creation_date": 1510657403, "post_id": 47283067, "comment_id": 81518077, "body": "In Go you can use <a href=\"https://golang.org/ref/spec#For_statements\" rel=\"nofollow noreferrer\">for loops</a> and <a href=\"https://golang.org/ref/spec#Appending_and_copying_slices\" rel=\"nofollow noreferrer\">append</a> to create slices of any length. Or actually you don&#39;t even have to use appned if you know the number of items, just initialize your slice to the correct length and then use indexes to set the slice element values."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 29, "user_id": 8500854, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-aerqM9C_dlU/AAAAAAAAAAI/AAAAAAAAAJ0/Em40PjeWx9Q/photo.jpg?sz=128", "display_name": "Ravindra Mandalapu", "link": "https://stackoverflow.com/users/8500854/ravindra-mandalapu"}, "edited": false, "score": 0, "creation_date": 1510658092, "post_id": 47283067, "comment_id": 81518537, "body": "@RavindraMandalapu I&#39;ve added an example of how to create a sequence of numbers."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 29, "user_id": 8500854, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-aerqM9C_dlU/AAAAAAAAAAI/AAAAAAAAAJ0/Em40PjeWx9Q/photo.jpg?sz=128", "display_name": "Ravindra Mandalapu", "link": "https://stackoverflow.com/users/8500854/ravindra-mandalapu"}, "edited": false, "score": 0, "creation_date": 1510658957, "post_id": 47283067, "comment_id": 81519119, "body": "@RavindraMandalapu I&#39;ve now also added a playground link with an executable example."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 0, "last_activity_date": 1510658928, "last_edit_date": 1510658928, "creation_date": 1510654580, "answer_id": 47283067, "question_id": 47282397, "link": "https://stackoverflow.com/questions/47282397/beego-range-in-view-templates/47283067#47283067", "title": "Beego range in view templates", "body": "<p>You first need something you can range over, like an <code>array</code>, <code>slice</code>, <code>map</code>, or a <code>channel</code>.</p>\n\n<p>For example in your Go code create a slice of ints (<code>[]int</code>) and assign it to the template data.</p>\n\n<pre><code>items := []int{1, 2, 3, 4, 5}\nthis.Data[\"items\"] = items\n</code></pre>\n\n<p>Now inside the template you can range over <code>items</code> like so:</p>\n\n<pre><code>{{range $val := .items}}\n&lt;a class=\"dropdown-item\" href=\"#\"&gt;{{$val}}&lt;/a&gt;\n{{end}}\n</code></pre>\n\n<hr>\n\n<pre><code>func numSequence(num int) []int {\n    out := make([]int, num) // create slice of length equal to num\n\n    for i := range out {\n        out[i] = i + 1\n    }\n    return out\n}\n\nfmt.Println(numSequence(5))\n// Output: [1, 2, 3, 4, 5]\n\nfmt.Println(numSequence(7))\n// Output: [1, 2, 3, 4, 5, 6, 7]\n</code></pre>\n\n<hr>\n\n<p>Executable example on <a href=\"https://play.golang.org/p/3wGqUoXOe7\" rel=\"nofollow noreferrer\">Go playgound</a>.</p>\n\n<p>Please note: since playground doesn't support importing of 3rd party packages the example executes the template using the <code>html/template</code> package instead of using the beego framework, but this is ok because beego uses <code>html/template</code> under the hood. Also the hyphen in the example template (<code>-}}</code>) gets rid of whitespace up to the next token, you don't have to use it if you don't want to.</p>\n"}], "owner": {"reputation": 29, "user_id": 8500854, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-aerqM9C_dlU/AAAAAAAAAAI/AAAAAAAAAJ0/Em40PjeWx9Q/photo.jpg?sz=128", "display_name": "Ravindra Mandalapu", "link": "https://stackoverflow.com/users/8500854/ravindra-mandalapu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 754, "favorite_count": 0, "closed_date": 1510655823, "answer_count": 1, "score": 2, "last_activity_date": 1510658928, "creation_date": 1510652807, "question_id": 47282397, "link": "https://stackoverflow.com/questions/47282397/beego-range-in-view-templates", "closed_reason": "Duplicate", "title": "Beego range in view templates", "body": "<p>I have an integer having value 5 and i want to loop against it and populate a dropdown as following using range or for loop in html. can any one help me how to do that</p>\n\n<pre><code>&lt;a class=\"dropdown-item\" href=\"#\"&gt;1&lt;/a&gt;\n&lt;a class=\"dropdown-item\" href=\"#\"&gt;2&lt;/a&gt;\n&lt;a class=\"dropdown-item\" href=\"#\"&gt;3&lt;/a&gt;\n&lt;a class=\"dropdown-item\" href=\"#\"&gt;4&lt;/a&gt;\n&lt;a class=\"dropdown-item\" href=\"#\"&gt;5&lt;/a&gt;\n</code></pre>\n"}, {"tags": ["go", "hashicorp-vault"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1510649951, "post_id": 47281295, "comment_id": 81513127, "body": "<code>s&#47;:=&#47;=&#47;</code> in <code>VClient, err := api.NewClient(conf)</code>. You are not setting the global variable but recreating a new one."}], "answers": [{"comments": [{"owner": {"reputation": 367, "user_id": 4422411, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/0c814c955bffcac9b4c22371a0a84df8?s=128&d=identicon&r=PG&f=1", "display_name": "kish", "link": "https://stackoverflow.com/users/4422411/kish"}, "edited": false, "score": 0, "creation_date": 1558335835, "post_id": 52936800, "comment_id": 99052218, "body": "How to close the connection properly?"}], "tags": [], "owner": {"reputation": 21, "user_id": 5394285, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-7TfJXnmAPaI/AAAAAAAAAAI/AAAAAAAAAB0/t36oJAalyOQ/photo.jpg?sz=128", "display_name": "Matey Aryeh", "link": "https://stackoverflow.com/users/5394285/matey-aryeh"}, "is_accepted": false, "score": 2, "last_activity_date": 1540237736, "creation_date": 1540237736, "answer_id": 52936800, "question_id": 47281295, "link": "https://stackoverflow.com/questions/47281295/working-with-vault-client-on-golang/52936800#52936800", "title": "Working with Vault client on golang", "body": "<p>So as stated by @<a href=\"https://stackoverflow.com/users/1266756/volker\">Volker</a>, you are not updating your already created global variable. So instead you should have something like this. Note that the client is created as another variable which is then passed to the global one.</p>\n\n<pre><code>var VClient *api.Client // global variable\n\nfunc InitVault(token string) error {\n    conf := &amp;api.Config{\n        Address: \"http://127.0.0.1:8200\",\n    }\n\n    client, err := api.NewClient(conf)\n    if err != nil {\n        return err\n    }\n    VClient = client\n\n    VClient.SetToken(token)\n    return nil\n}\n\n\nfunc main() {\n    err := InitVault(\"root token\")\n    if err != nil {\n        log.Println(err)\n    }\n    c := VClient.Logical()\n\n    secret, err = c.Write(\"kv/hi\",\n    map[string]interface{}{\n        \"name\":     name,\n        \"username\": username,\n        \"password\": password,\n    })\n    if err != nil {\n        log.Println(err)\n    }\n    log.Println(secret)\n}\n</code></pre>\n"}], "owner": {"reputation": 79, "user_id": 6180958, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/T4JwD.png?s=128&g=1", "display_name": "Arthur", "link": "https://stackoverflow.com/users/6180958/arthur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5722, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1540237736, "creation_date": 1510649446, "last_edit_date": 1510664719, "question_id": 47281295, "link": "https://stackoverflow.com/questions/47281295/working-with-vault-client-on-golang", "title": "Working with Vault client on golang", "body": "<p>I am kind of new comer on golang and Vault. I am trying to store some value/key pairs in secret and then read it. But for me is not so clear how client creation works (in fact should I call it for each operation or I can create one). For example code bellow:</p>\n\n<pre><code>client, err := api.NewClient(conf)\nclient.SetToken(token)\n\nc := client.Logical()\n\nsec, err := c.Write(\"/secret/test/\" + name,\n    map[string]interface{}{ \n        \"name\": name,\n        \"username\": username,\n        \"password\": password,\n    })\n</code></pre>\n\n<p>It works perfectly. But it looks strange to me to call <code>NewClient</code> each time when I need to write or read something. So I try to create <code>init</code> function for it. Something like this:</p>\n\n<pre><code>var VClient *api.Client // global variable\n\nfunc InitVault(token string) int{\n\n    conf := &amp;api.Config{\n        Address: \"http://127.0.0.1:8200\",\n    }\n\n    VClient, err := api.NewClient(conf)\n    if  err != nil {\n           log.Println(err)\n           return 0\n    }\n\n    VClient.SetToken(token)    \n    return 1\n}\n</code></pre>\n\n<p>And, it makes an initialization, but when I try to make initialization:</p>\n\n<pre><code>main (){\n\nr := InitVault(\"token string\")\n\nc := VClient.Logical()\n\n    sec, err := c.Write(\"/secret/test/\" + name,\n        map[string]interface{}{ \n            \"name\": name,\n            \"username\": username,\n            \"password\": password,\n        })\n}\n</code></pre>\n\n<p>I got a nil pointer exception. There is not so many examples which can really help in this case. Am I wrong and for each and every operation with Vault I need to call <code>NewClient</code>? As I mentioned before it look strange to me, that is why I decided to post my question here, will be glad to get any answers.</p>\n\n<p>Best regards\nArtur</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1510648940, "post_id": 47281081, "comment_id": 81512534, "body": "Use the same principle as in this answer: <a href=\"https://stackoverflow.com/questions/46365221/fill-os-stdin-for-function-that-reads-from-it/46365584#46365584\">Fill os.Stdin for function that reads from it</a>."}, {"owner": {"reputation": 602, "user_id": 818944, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/c4caeda8ef836969be3503e716756881?s=128&d=identicon&r=PG", "display_name": "EnterSB", "link": "https://stackoverflow.com/users/818944/entersb"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1510650511, "post_id": 47281081, "comment_id": 81513447, "body": "@icza Thanks, I&#39;ve followed your instructions, I am adding answer below."}], "answers": [{"comments": [{"owner": {"reputation": 602, "user_id": 818944, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/c4caeda8ef836969be3503e716756881?s=128&d=identicon&r=PG", "display_name": "EnterSB", "link": "https://stackoverflow.com/users/818944/entersb"}, "edited": false, "score": 0, "creation_date": 1510649780, "post_id": 47281179, "comment_id": 81513019, "body": "If I understood well, I would have to call ConsolePrinter Print method in example, right?"}, {"owner": {"reputation": 908, "user_id": 2525337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42ee56a548ee6259f9e44a66d1c3aa61?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/2525337/john-smith"}, "reply_to_user": {"reputation": 602, "user_id": 818944, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/c4caeda8ef836969be3503e716756881?s=128&d=identicon&r=PG", "display_name": "EnterSB", "link": "https://stackoverflow.com/users/818944/entersb"}, "edited": false, "score": 0, "creation_date": 1510650778, "post_id": 47281179, "comment_id": 81513615, "body": "Just try don&#39;t delibarate :)"}, {"owner": {"reputation": 908, "user_id": 2525337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42ee56a548ee6259f9e44a66d1c3aa61?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/2525337/john-smith"}, "reply_to_user": {"reputation": 602, "user_id": 818944, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/c4caeda8ef836969be3503e716756881?s=128&d=identicon&r=PG", "display_name": "EnterSB", "link": "https://stackoverflow.com/users/818944/entersb"}, "edited": false, "score": 1, "creation_date": 1510651016, "post_id": 47281179, "comment_id": 81513791, "body": "So now you know, but you&#39;ve got a documented and tested piece of code. Remember, that a cover is only a software metric. There is no need to duplicate tests to get a cover higher."}, {"owner": {"reputation": 602, "user_id": 818944, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/c4caeda8ef836969be3503e716756881?s=128&d=identicon&r=PG", "display_name": "EnterSB", "link": "https://stackoverflow.com/users/818944/entersb"}, "edited": false, "score": 0, "creation_date": 1510651366, "post_id": 47281179, "comment_id": 81513999, "body": "I understand what you say. Still, I wanted to see if there was way for that part of code to be covered with tests."}, {"owner": {"reputation": 602, "user_id": 818944, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/c4caeda8ef836969be3503e716756881?s=128&d=identicon&r=PG", "display_name": "EnterSB", "link": "https://stackoverflow.com/users/818944/entersb"}, "edited": false, "score": 0, "creation_date": 1510651714, "post_id": 47281179, "comment_id": 81514250, "body": "by your opinion, which is better, example as you wrote or test?"}, {"owner": {"reputation": 908, "user_id": 2525337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42ee56a548ee6259f9e44a66d1c3aa61?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/2525337/john-smith"}, "reply_to_user": {"reputation": 602, "user_id": 818944, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/c4caeda8ef836969be3503e716756881?s=128&d=identicon&r=PG", "display_name": "EnterSB", "link": "https://stackoverflow.com/users/818944/entersb"}, "edited": false, "score": 1, "creation_date": 1510652026, "post_id": 47281179, "comment_id": 81514454, "body": "For example - &quot;when you want to document a function to the user, use Examples. Otherwise use tests - often you need to use data provider to test the function. It&#39;s all relative. Make your choice."}], "tags": [], "owner": {"reputation": 908, "user_id": 2525337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/42ee56a548ee6259f9e44a66d1c3aa61?s=128&d=identicon&r=PG", "display_name": "John Smith", "link": "https://stackoverflow.com/users/2525337/john-smith"}, "is_accepted": false, "score": 9, "last_activity_date": 1548107856, "last_edit_date": 1548107856, "creation_date": 1510649007, "answer_id": 47281179, "question_id": 47281081, "link": "https://stackoverflow.com/questions/47281081/how-to-test-method-that-prints-to-console-in-golang/47281179#47281179", "title": "how to test method that prints to console in golang?", "body": "<p>Use <a href=\"https://golang.org/pkg/testing/#hdr-Examples\" rel=\"nofollow noreferrer\"><code>Examples</code></a> to convey the usage of a function.</p>\n\n<p>Don't fret over 100% test coverage, especially for simple straightforward functions.</p>\n\n<pre><code>func ExampleHello() {\n    fmt.Println(\"hello\")\n    // Output: hello\n}\n</code></pre>\n\n<p>The additional benefit is that <code>examples</code> are outputted in a generated doc with go doc tool.</p>\n"}, {"tags": [], "owner": {"reputation": 602, "user_id": 818944, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/c4caeda8ef836969be3503e716756881?s=128&d=identicon&r=PG", "display_name": "EnterSB", "link": "https://stackoverflow.com/users/818944/entersb"}, "is_accepted": true, "score": 6, "last_activity_date": 1510650694, "creation_date": 1510650694, "answer_id": 47281683, "question_id": 47281081, "link": "https://stackoverflow.com/questions/47281081/how-to-test-method-that-prints-to-console-in-golang/47281683#47281683", "title": "how to test method that prints to console in golang?", "body": "<p>Following comment that @icza wrote, I've written test below.</p>\n\n<pre><code>func TestPrint(t *testing.T) {\n    rescueStdout := os.Stdout\n    r, w, _ := os.Pipe()\n    os.Stdout = w\n\n    cp := &amp;ConsolePrinter{}\n    cp.Print(\"test\")\n\n    w.Close()\n    out, _ := ioutil.ReadAll(r)\n    os.Stdout = rescueStdout\n\n    if string(out) != \"this is value: test\" {\n        t.Errorf(\"Expected %s, got %s\", \"this is value: test\", out)\n    }\n}\n</code></pre>\n\n<p>I've found example in question <a href=\"https://stackoverflow.com/questions/10473800/in-go-how-do-i-capture-stdout-of-a-function-into-a-string\" title=\"What is the best way to convert byte array to string?\">What is the best way to convert byte array to string?</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 602, "user_id": 818944, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/c4caeda8ef836969be3503e716756881?s=128&d=identicon&r=PG", "display_name": "EnterSB", "link": "https://stackoverflow.com/users/818944/entersb"}, "edited": false, "score": 0, "creation_date": 1510653106, "post_id": 47282218, "comment_id": 81515254, "body": "Thanks, I am doing this for other method I am testing."}], "tags": [], "owner": {"reputation": 303, "user_id": 8008395, "user_type": "registered", "profile_image": "https://graph.facebook.com/1019408758194319/picture?type=large", "display_name": "Bohdan Kostko", "link": "https://stackoverflow.com/users/8008395/bohdan-kostko"}, "is_accepted": false, "score": 2, "last_activity_date": 1510652284, "creation_date": 1510652284, "answer_id": 47282218, "question_id": 47281081, "link": "https://stackoverflow.com/questions/47281081/how-to-test-method-that-prints-to-console-in-golang/47282218#47282218", "title": "how to test method that prints to console in golang?", "body": "<p>I would recommend to create new instance of the <a href=\"https://golang.org/pkg/log/#New\" rel=\"nofollow noreferrer\">logger</a>, which would behave exactly as <code>fmt</code> methods for printing data to console. Also, you can configure it with additional features like showing the filename, date and etc. Such custom logger can be passed as a parameter to your service/instance factory method. That would make it really easy to mock and test.</p>\n\n<p>Your code</p>\n\n<pre><code>type Logs interface {\n    Println(v ...interface{})\n}\n\ntype InstanceToTest struct {\n    log Logs\n}\n\nfunc InstanceToTestFactory(logger Logs) *InstanceToTest {\n    return &amp;InstanceToTest{logger}\n}\n\nfunc (i *InstanceToTest) SomeMethod(a string) {\n    i.log.Println(a)\n}\n</code></pre>\n\n<p>Create a mock for logger</p>\n\n<pre><code>type LoggerMock struct {\n    CalledPrintln []interface{}    \n}\n\nfunc (l *LoggerMock) Println(v ...interface{}) {\n    l.CalledPrintln = append(CalledPrintln, v)\n}\n</code></pre>\n\n<p>And in your test</p>\n\n<pre><code>func TestInstanceToTestSomeMethod(t *testing.T) {\n    l := &amp;LoggerMock{}\n    i := InstanceToTestFactory(l)\n    a := \"Test\"\n\n    i.SomeMethod(a)\n\n    if len(l.CalledPrintln) == 0 || l.CalledPrintln[0] != a {\n        t.Error(\"Not called\")\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 602, "user_id": 818944, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/c4caeda8ef836969be3503e716756881?s=128&d=identicon&r=PG", "display_name": "EnterSB", "link": "https://stackoverflow.com/users/818944/entersb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6577, "favorite_count": 0, "accepted_answer_id": 47281683, "answer_count": 3, "score": 0, "last_activity_date": 1548107856, "creation_date": 1510648642, "question_id": 47281081, "link": "https://stackoverflow.com/questions/47281081/how-to-test-method-that-prints-to-console-in-golang", "title": "how to test method that prints to console in golang?", "body": "<p>I have next struct.</p>\n\n<pre><code>package logger\n\nimport \"fmt\"\n\ntype IPrinter interface {\n    Print(value string)\n}\n\ntype ConsolePrinter struct{}\n\nfunc (cp *ConsolePrinter) Print(value string) {\n    fmt.Printf(\"this is value: %s\", value)\n}\n</code></pre>\n\n<p>Test coverage says I need to test that ConsolePrinter Print method.</p>\n\n<p>How can I cover this method?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "edited": false, "score": 0, "creation_date": 1510648490, "post_id": 47280837, "comment_id": 81512315, "body": "start logging errors, u may find smth useful"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1510667689, "post_id": 47280837, "comment_id": 81525164, "body": "Show the actual code you use, because this can&#39;t compile. You can&#39;t use an <code>io.Reader</code> properly while discarding errors and the bytes read value. You almost never want to use a use connected udp socket for the client. Your linked blog post is pretty poor quality, I would find better sources if you&#39;re not sure how networking works."}, {"owner": {"reputation": 4120, "user_id": 1099314, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jKm3r.png?s=128&g=1", "display_name": "Ninh Pham", "link": "https://stackoverflow.com/users/1099314/ninh-pham"}, "edited": false, "score": 0, "creation_date": 1595691836, "post_id": 47280837, "comment_id": 111565343, "body": "This will help <a href=\"https://stackoverflow.com/a/35804927/1099314\">stackoverflow.com/a/35804927/1099314</a>. Have no fun!!!"}], "answers": [{"tags": [], "owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "is_accepted": false, "score": 2, "last_activity_date": 1510692366, "creation_date": 1510692366, "answer_id": 47294878, "question_id": 47280837, "link": "https://stackoverflow.com/questions/47280837/golang-udp-client-cant-receive-msg-from-server/47294878#47294878", "title": "golang udp client can&#39;t receive msg from server", "body": "<p>Here is a minimum code for you to play around with. </p>\n\n<p>start a server part in one terminal:</p>\n\n<p><code>go run main.go server :53033</code></p>\n\n<p>start client in the other terminal:</p>\n\n<p><code>go run main.go client :53033</code></p>\n\n<p>now type messages at the <strong>client</strong> terminal and you should see both client and server exchanging messages. You can start multiple clients (in new terminal windows) and communicate with the same server.</p>\n\n\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"net\"\n    \"os\"\n)\n\nfunc server(url string) {\n    log.Printf(\"serving on %s\\n\", url)\n    addr, err := net.ResolveUDPAddr(\"udp\", url)\n    errcheck(err)\n\n    conn, err := net.ListenUDP(\"udp\", addr)\n    errcheck(err)\n    defer close(conn)\n\n    msg := make([]byte, 1024)\n\n    for {\n        n, retAddr, err := conn.ReadFromUDP(msg)\n        errcheck(err)\n\n        log.Printf(\"received %v bytes, ret addr %v, msg %s\", n, retAddr, string(msg[:n]))\n\n        reply := []byte(fmt.Sprintf(\"received from you: %v bytes\", n))\n        n, err = conn.WriteToUDP(reply, retAddr)\n        errcheck(err)\n\n        log.Printf(\"sent reply %v bytes\\n\", n)\n    }\n}\n\nfunc client(url string) {\n    log.Printf(\"client for server url: %s\\n\", url)\n\n    addr, err := net.ResolveUDPAddr(\"udp\", url)\n    errcheck(err)\n\n    conn, err := net.DialUDP(\"udp\", nil, addr)\n    errcheck(err)\n    defer close(conn)\n\n    msg := make([]byte, 512)\n    scanner := bufio.NewScanner(os.Stdin)\n    for {\n        if scanner.Scan() {\n            line := scanner.Text()\n\n            n, err := conn.Write([]byte(line))\n            errcheck(err)\n            log.Printf(\"sent %d bytes \\n\", n)\n\n            n, err = conn.Read(msg)\n            errcheck(err)\n            log.Printf(\"server replied with: %s \\n\", string(msg[:n]))\n        }\n    }\n}\n\nfunc main() {\n    args := os.Args[1:]\n\n    if len(args) &lt; 2 {\n        log.Fatal(\"expecting 2 arguments client or server first followed by the address:port\")\n    }\n\n    switch args[0] {\n    case \"server\":\n        server(args[1])\n\n    case \"client\":\n        client(args[1])\n\n    default:\n        log.Fatal(\"first argument must be server or client\")\n    }\n\n}\n\nfunc errcheck(err error) {\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc close(c io.Closer) {\n    err := c.Close()\n    if err != nil {\n        log.Fatal()\n    }\n}\n</code></pre>\n\n<p>Have fun!</p>\n"}], "owner": {"reputation": 145, "user_id": 8390201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af51319263ed43525aac990b55e309a1?s=128&d=identicon&r=PG&f=1", "display_name": "Evan.zz", "link": "https://stackoverflow.com/users/8390201/evan-zz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1135, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1510692366, "creation_date": 1510647792, "question_id": 47280837, "link": "https://stackoverflow.com/questions/47280837/golang-udp-client-cant-receive-msg-from-server", "title": "golang udp client can&#39;t receive msg from server", "body": "<p>i can send msg from client to server successfully. But when i try to reply message back to client, somehow client cant receive the message.</p>\n\n<p>Client:</p>\n\n<pre><code>conn, _:= net.Dial(\"udp\", serv_addr:port)\ndefer conn.close()\nbuf:= []byte(\"Hey, server\")\nconn.Write(buf)\n\nrecv:= make([]byte, 1024)\nfmt.Println(\"Reading...\\n\")\nconn.Read(recv)\n</code></pre>\n\n<p>Server:</p>\n\n<pre><code>addr, _:= net.ResolveUDPAddr(\"udp\", addr:port)\nmsg := make([]byte, 1024)\n\nconn,_: net.ListenUDP(\"udp\", addr)\n_, ret_addr, _: conn.ReadFromUDP(msg)\n//print msg\nconn.WriteToUDP([]byte(\"got your msg\", ret)\n</code></pre>\n\n<p>It's a very simple udp connection. server can printout the msg from client, but on client side, it keeps waiting before conn.read() while server finished its task.</p>\n\n<p>I followed <a href=\"http://www.minaandrawos.com/2016/05/14/udp-vs-tcp-in-golang/\" rel=\"nofollow noreferrer\">this</a> article. my implementation is almost identical.</p>\n"}, {"tags": ["go", "websocket", "socket.io", "chat"], "comments": [{"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1510645847, "post_id": 47280162, "comment_id": 81510964, "body": "Please copy to the question an actual error which you have."}, {"owner": {"reputation": 374, "user_id": 4523659, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh6.googleusercontent.com/-b9g7tGVjJ2Y/AAAAAAAAAAI/AAAAAAAAAHc/AG0d1FIs4LA/photo.jpg?sz=128", "display_name": "vinod bhandary", "link": "https://stackoverflow.com/users/4523659/vinod-bhandary"}, "reply_to_user": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1510645938, "post_id": 47280162, "comment_id": 81511011, "body": "app server.go:2848: http: panic serving 127.0.0.1:50420: interface conversion: interface is nil, not io.Writer goroutine 166 [running]: net/http.(*conn).serve.func1(0xc4201d03c0)"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1510668036, "post_id": 47280162, "comment_id": 81525423, "body": "There&#39;s a data race on <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">clients</a>.   Fix that issue first, possibly with the assistance of the <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">race detector</a>.  Once you do that, tell us the line of code where the panic occurs."}], "answers": [{"tags": [], "owner": {"reputation": 404, "user_id": 6692196, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vV1ew.png?s=128&g=1", "display_name": "Gene S", "link": "https://stackoverflow.com/users/6692196/gene-s"}, "is_accepted": false, "score": 0, "last_activity_date": 1510868852, "creation_date": 1510868852, "answer_id": 47339645, "question_id": 47280162, "link": "https://stackoverflow.com/questions/47280162/one-to-one-chat-in-golang/47339645#47339645", "title": "one to one chat in golang", "body": "<p>I think you use <code>gorilla/websocket</code> API incorrectly. You copied the <code>echo</code> example which, being a basic demo, is expected to handle a single ws connection only. Start with the <code>chat</code> example. Particularly pay attention to the fact that <code>serveWs</code> is a non-blocking call while your <code>handleConnections</code> is blocking, i.e. it never returns. Take a look here for a full-featured example of <code>gorilla/websocket</code> API use:\n<a href=\"https://github.com/tinode/chat/blob/master/server/wshandler.go\" rel=\"nofollow noreferrer\">https://github.com/tinode/chat/blob/master/server/wshandler.go</a></p>\n\n<p>As correctly pointed out by Cerise L, you most certainly have a race on your <code>clients</code> although I think it's unlikely to produce a panic. I think the most likely source of panic is a call to <code>Upgrade</code> on a closed http connection. It's impossible to say exactly because you did not post the full output of the panic.</p>\n"}], "owner": {"reputation": 374, "user_id": 4523659, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh6.googleusercontent.com/-b9g7tGVjJ2Y/AAAAAAAAAAI/AAAAAAAAAHc/AG0d1FIs4LA/photo.jpg?sz=128", "display_name": "vinod bhandary", "link": "https://stackoverflow.com/users/4523659/vinod-bhandary"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 533, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1510868852, "creation_date": 1510645239, "last_edit_date": 1510646063, "question_id": 47280162, "link": "https://stackoverflow.com/questions/47280162/one-to-one-chat-in-golang", "title": "one to one chat in golang", "body": "<p>I want to create one to one chat in revel framework but it gives error. Firstly work in revel chat according to demo but refreshing page did not work so I tried this method and dont know how to handle single chat.</p>\n\n<p>Here is an error:</p>\n\n<pre><code>app server.go:2848: http: panic serving 127.0.0.1:50420: interface conversion: interface is nil, not io.Writer goroutine 166 [running]: net/http.(*conn).serve.func1(0xc4201d03c0)\n</code></pre>\n\n<p>my go code is where I handle ws root,single user chat need to db connection to. I'm using posgres for it</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/websocket\"\n)\n\nvar clients = make(map[*websocket.Conn]bool) // connected clients\nvar broadcast = make(chan Message)           // broadcast channel\n\n// Configure the upgrader\nvar upgrader = websocket.Upgrader{\n    CheckOrigin: func(r *http.Request) bool {\n        return true\n    },\n}\n\n// Define our message object\ntype Message struct {\n    Email    string `json:\"email\"`\n    Username string `json:\"username\"`\n    Message  string `json:\"message\"`\n    Created  string `json:\"created\"`\n}\n\nfunc main() {\n    // Create a simple file server\n    fs := http.FileServer(http.Dir(\"public\"))\n    http.Handle(\"/\", fs)\n\n    // Configure websocket route\n    http.HandleFunc(\"/ws\", handleConnections)\n\n    // Start listening for incoming chat messages\n    go handleMessages()\n\n    // Start the server on localhost port 8000 and log any errors\n    log.Println(\"http server started on :8090\")\n    err := http.ListenAndServe(\":8090\", nil)\n    if err != nil {\n        log.Fatal(\"ListenAndServe: \", err)\n    }\n}\n\nfunc handleConnections(w http.ResponseWriter, r *http.Request) {\n    // Upgrade initial GET request to a websocket\n    ws, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n    // Make sure we close the connection when the function returns\n    defer ws.Close()\n\n    // Register our new client\n    clients[ws] = true\n\n    for {\n        var msg Message\n        // Read in a new message as JSON and map it to a Message object\n        err := ws.ReadJSON(&amp;msg)\n        if err != nil {\n            log.Printf(\"error: %v\", err)\n            delete(clients, ws)\n            break\n        }\n        // Send the newly received message to the broadcast channel\n        broadcast &lt;- msg\n    }\n}\n\nfunc handleMessages() {\n    for {\n        // Grab the next message from the broadcast channel\n        msg := &lt;-broadcast\n        // Send it out to every client that is currently connected\n        for client := range clients {\n            err := client.WriteJSON(msg)\n            if err != nil {\n                log.Printf(\"error: %v\", err)\n                client.Close()\n                delete(clients, client)\n            }\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["json", "go", "marshalling"], "comments": [{"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 2, "creation_date": 1510642758, "post_id": 47279367, "comment_id": 81509373, "body": "What is <code>availableExpressions</code>?  make minimum code e.g. on <a href=\"https://play.golang.org\" rel=\"nofollow noreferrer\">play.golang.org</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6076171"}, "reply_to_user": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 0, "creation_date": 1510664595, "post_id": 47279367, "comment_id": 81522944, "body": "<a href=\"https://play.golang.org/p/KWtk25zHQP\" rel=\"nofollow noreferrer\">play.golang.org/p/KWtk25zHQP</a>"}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 0, "creation_date": 1510666938, "post_id": 47279367, "comment_id": 81524651, "body": "You need to debug your code logic."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6076171"}, "edited": false, "score": 0, "creation_date": 1510756450, "post_id": 47287353, "comment_id": 81570500, "body": "why is it repeating the output thrice? otherwise, thanks :)"}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 0, "creation_date": 1510765297, "post_id": 47287353, "comment_id": 81577290, "body": "on line 121 comment this line: <code>fmt.Println(cmd.Value)</code> e.g. try <a href=\"https://play.golang.org/p/cWC4v0yCsd\" rel=\"nofollow noreferrer\">this</a>. and <a href=\"https://play.golang.org/p/lrEw7EbxBE\" rel=\"nofollow noreferrer\">test</a>,"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6076171"}, "edited": false, "score": 0, "creation_date": 1510824852, "post_id": 47287353, "comment_id": 81602753, "body": "I meant that returning four times the output as normally expected, e.g: <code>[{&quot;Value&quot;:{&quot;Name&quot;:&quot;print&quot;,&quot;Arguments&quot;:[&quot;\\&quot;Hello World\\&quot;&quot;]}},{&quot;Value&quot;:{&quot;Name&quot;:&quot;print&quot;,&quot;Arguments&quot;:[&quot;\\&quot;Hello World\\&quot;&quot;]}},{&quot;Value&quot;:{&quot;Name&quot;:&quot;print&quot;,&quot;Arguments&quot;:[&quot;\\&quot;Hello World\\&quot;&quot;]}},{&quot;Value&quot;:{&quot;Name&quot;:&quot;print&quot;,&quot;Arguments&quot;:[&quot;\\&quot;Hello World\\&quot;&quot;]}}]</code> instead of <code>{&quot;Value:{&quot;Name&quot;:&quot;\\&quot;print&quot;\\&quot;, &quot;Arguments&quot;:&quot;\\&quot;Hello World\\&quot;&quot;}}</code>"}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 0, "creation_date": 1510825451, "post_id": 47287353, "comment_id": 81603188, "body": "just debug your code logic inside your editor,  also this <code>strings.Split(line, &quot; &quot;)</code> is splits <code>&quot;Hello World&quot;</code> to <code>&quot;Hello</code> and <code>World&quot;</code> it is one token: <code>&quot;Hello World&quot;</code>, and you need better tokenizer."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6076171"}, "edited": false, "score": 0, "creation_date": 1510825545, "post_id": 47287353, "comment_id": 81603266, "body": "Look further inside the <code>Arguments</code> section, I join &quot;Hello World&quot; from there"}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 1, "last_activity_date": 1510666916, "creation_date": 1510666916, "answer_id": 47287353, "question_id": 47279367, "link": "https://stackoverflow.com/questions/47279367/go-test-fails-empty-slice-where-json-should-have-been/47287353#47287353", "title": "go test fails, empty slice where JSON should have been", "body": "<p>You need to debug your code logic:  </p>\n\n<p>I switched:</p>\n\n<pre><code>    for _, a := range availableExpressions {\n        for _, b := range availableStatements {\n</code></pre>\n\n<p>with:</p>\n\n<pre><code>    for _, a := range availableStatements {\n        for _, b := range availableExpressions {\n</code></pre>\n\n<p>Run <a href=\"https://play.golang.org/p/xWEu91d-8c\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"strconv\"\n    \"strings\"\n)\n\n// Function not implemented yet,\n// but there for completedness\ntype Function struct {\n    Name      string\n    Arguments []interface{}\n    // A function can contain\n    // both expressions and\n    // statements\n    Code []Mixed\n}\n\n// Mixed can be either Statement\n// or Expression\ntype Mixed struct {\n    isStatement  bool\n    isExpression bool\n    Value        interface{}\n}\n\n// Statement represents\n// statements. How a statement\n// is used is entirely up to\n// the interpreter.\ntype Statement struct {\n    Name      string\n    Arguments []interface{}\n}\n\n// Since an Expression\n// is calculated beforehand,\n// store the value\ntype Expression struct {\n    Name      string\n    Arguments []interface{}\n    Value     interface{}\n}\n\n// commands contains commands to\n// execute later.\n// It is of type Mixed because Mixed\n// can be of type Expression or Statement\nvar commands = make([]*Mixed, 0)\n\nvar availableStatements = []string{\n    \"print\",\n}\nvar availableExpressions = []string{\n    \"+\",\n    \"-\",\n    \"*\",\n    \"/\",\n}\n\n// Compile takes in code, and returns JSON\n// bytes and an error if there was one\nfunc Compile(in string) ([]byte, error) {\n    // iterate through every line in the code\n    for _, line := range strings.Split(in, \"\\n\") {\n        // Divide the line into sections\n        // for easier processing\n        tokens := strings.Split(line, \" \")\n        for _, a := range availableStatements {\n            for _, b := range availableExpressions {\n                if tokens[1] == b {\n                    // It is an expression, so\n                    // calculate the value of\n                    // the expression\n                    var val int\n                    num1, err := strconv.Atoi(tokens[0])\n                    if err != nil {\n                        return nil, err\n                    }\n                    num2, err := strconv.Atoi(tokens[1])\n                    if err != nil {\n                        return nil, err\n                    }\n                    args := []int{num1, num2}\n                    switch b {\n                    case \"+\":\n                        val = args[0] + args[1]\n                    case \"*\":\n                        val = args[0] * args[1]\n                    case \"-\":\n                        val = args[0] - args[1]\n                    case \"/\":\n                        val = args[0] / args[1]\n                    }\n                    cmd := &amp;Mixed{\n                        isExpression: true,\n                        isStatement:  false,\n                        Value: &amp;Expression{\n                            Name: b,\n                            // for some reason go doesn't\n                            // let me put args directly\n                            Arguments: []interface{}{args},\n                            Value:     val,\n                        }}\n                    fmt.Println(cmd.Value)\n                    commands = append(commands, cmd)\n                } else if tokens[0] == a {\n                    // argument is a statement, don't bother\n                    // to evaluate the value\n                    arguments := strings.Join(tokens[1:], \" \")\n                    cmd := &amp;Mixed{\n                        isStatement:  true,\n                        isExpression: false,\n                        Value: &amp;Statement{\n                            Name:      a,\n                            Arguments: []interface{}{arguments},\n                        }}\n                    fmt.Println(cmd.Value)\n                    commands = append(commands, cmd)\n                }\n            }\n        }\n    }\n    gen, err := json.Marshal(commands)\n    fmt.Println(commands)\n    // empty the commands\n    commands = make([]*Mixed, 0)\n    if err != nil {\n        return nil, err\n    }\n    return gen, nil\n}\n\nfunc Execute(input_file string) error {\n    // open input file\n    f, err := ioutil.ReadFile(input_file)\n    if err != nil {\n        return err\n    }\n    // unmarshal the JSON\n    var data []*Mixed\n    err = json.Unmarshal(f, data)\n    if err != nil {\n        return err\n    }\n    for _, v := range data {\n        var a *Expression\n        var b *Statement\n        // get absolute value of v\n        if v.isExpression {\n            a = v.Value.(*Expression)\n            b = nil\n        } else if v.isStatement {\n            b = v.Value.(*Statement)\n            a = nil\n        }\n        // since the expression is\n        // already calculated at compile-time,\n        // don't bother evaluating\n        if a != nil {\n            fmt.Println(a.Value)\n        }\n        if b != nil {\n            // on the other hand, evaluate\n            // statements since they're *not*\n            // evaluated at compile-time\n            switch b.Name {\n            case \"print\":\n                for _, n := range b.Arguments {\n                    fmt.Printf(\"%v\", n)\n                }\n                fmt.Printf(\"\\n\")\n            }\n        }\n    }\n    return nil\n}\n\nfunc main() {\n    cases := []struct {\n        in  string\n        out string\n    }{\n        {\n            in:  \"print \\\"Hello World\\\"\",\n            out: \"[{\\\"Name\\\":\\\"print\\\",\\\"Arguments\\\":[\\\"Hello World\\\"]}]\",\n        },\n        {\n            in:  \"print \\\"My name is Jack White\\\"\",\n            out: \"[{\\\"Name\\\":\\\"print\\\",\\\"Arguments\\\":[\\\"My name is Jack White\\\"]}]\",\n        },\n    }\n    real_stuff, err := Compile(cases[0].in)\n    if err != nil {\n        fmt.Printf(\"error: %s\\n\", err)\n    }\n    fmt.Println(string(real_stuff))\n    if string(real_stuff) != cases[0].out {\n        fmt.Printf(\"got %s, expected %s\\n\", string(real_stuff), cases[0].out)\n        //t.Fail()\n    }\n    real_stuff, err = Compile(cases[1].in)\n    if err != nil {\n        fmt.Printf(\"error: %s\\n\", err)\n    }\n    fmt.Println(string(real_stuff))\n    if string(real_stuff) != cases[1].out {\n        fmt.Printf(\"got %s, expected %s\\n\", string(real_stuff), cases[1].out)\n        //t.Fail()\n    }\n}\n</code></pre>\n\n<p>output (<code>go test</code>):</p>\n\n<pre><code>&amp;{print [\"Hello World\"]}\n&amp;{print [\"Hello World\"]}\n&amp;{print [\"Hello World\"]}\n&amp;{print [\"Hello World\"]}\n[0xc04204e3c0 0xc04204e420 0xc04204e460 0xc04204e4c0]\ngot [{\"Value\":{\"Name\":\"print\",\"Arguments\":[\"\\\"Hello World\\\"\"]}},{\"Value\":{\"Name\":\"print\",\"Arguments\":[\"\\\"Hello World\\\"\"]}},{\"Value\":{\"Name\":\"print\",\"Arguments\":[\"\\\"Hello World\\\"\"]}},{\"Value\":{\"Name\":\"print\",\"Arguments\":[\"\\\"Hello World\\\"\"]}}], expected [{\"Name\":\"print\",\"Arguments\":[\"Hello World\"]}]\n&amp;{print [\"My name is Jack White\"]}\n&amp;{print [\"My name is Jack White\"]}\n&amp;{print [\"My name is Jack White\"]}\n&amp;{print [\"My name is Jack White\"]}\n[0xc04204e6e0 0xc04204e720 0xc04204e760 0xc04204e7c0]\ngot [{\"Value\":{\"Name\":\"print\",\"Arguments\":[\"\\\"My name is Jack White\\\"\"]}},{\"Value\":{\"Name\":\"print\",\"Arguments\":[\"\\\"My name is Jack White\\\"\"]}},{\"Value\":{\"Name\":\"print\",\"Arguments\":[\"\\\"My name is Jack White\\\"\"]}},{\"Value\":{\"Name\":\"print\",\"Arguments\":[\"\\\"My name is Jack White\\\"\"]}}], expected [{\"Name\":\"print\",\"Arguments\":[\"My name is Jack White\"]}]\n--- FAIL: TestCompile (0.00s)\nFAIL\nexit status 1\nFAIL    ar/sogo 0.016s\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6076171"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 47287353, "answer_count": 1, "score": 0, "last_activity_date": 1510666916, "creation_date": 1510642247, "question_id": 47279367, "link": "https://stackoverflow.com/questions/47279367/go-test-fails-empty-slice-where-json-should-have-been", "title": "go test fails, empty slice where JSON should have been", "body": "<p>I am testing a piece of code, called <code>Compile</code>:</p>\n\n<pre><code>// Compile takes in code, and returns JSON\n// bytes and an error if there was one\nfunc Compile(in string) ([]byte, error) {\n    // iterate through every line in the code\n    for _, line := range strings.Split(in, \"\\n\") {\n        // Divide the line into sections\n        // for easier processing\n        tokens := strings.Split(line, \" \")\n        for _, a := range availableExpressions {\n            for _, b := range availableStatements {\n                if tokens[1] == b {\n                    // It is an expression, so\n                    // calculate the value of\n                    // the expression\n                    var val int\n                    num1, err := strconv.Atoi(tokens[0])\n                    if err != nil {\n                        return nil, err\n                    }\n                    num2, err := strconv.Atoi(tokens[1])\n                    if err != nil {\n                        return nil, err\n                    }\n                    args := []int{num1, num2}\n                    switch b {\n                    case \"+\":\n                        val = args[0] + args[1]\n                    case \"*\":\n                        val = args[0] * args[1]\n                    case \"-\":\n                        val = args[0] - args[1]\n                    case \"/\":\n                        val = args[0] / args[1]\n                    }\n                    cmd := &amp;Mixed{\n                        isExpression: true,\n                        isStatement:  false,\n                        Value: &amp;Expression{\n                            Name: b,\n                            // for some reason go doesn't\n                            // let me put args directly\n                            Arguments: []interface{}{args},\n                            Value:     val,\n                        }}\n                    fmt.Println(cmd.Value)\n                    commands = append(commands, cmd)\n                } else if tokens[0] == a {\n                    // argument is a statement, don't bother\n                    // to evaluate the value\n                    arguments := strings.Join(tokens[1:], \" \")\n                    cmd := &amp;Mixed{\n                        isStatement:  true,\n                        isExpression: false,\n                        Value: &amp;Statement{\n                            Name:      a,\n                            Arguments: []interface{}{arguments},\n                        }}\n                    fmt.Println(cmd.Value)\n                    commands = append(commands, cmd)\n                }\n            }\n        }\n    }\n    gen, err := json.Marshal(commands)\n    // fmt prints an empty slice\n    // no matter what is in\n    fmt.Println(commands)\n    // empty the commands\n    commands = make([]*Mixed, 0)\n    if err != nil {\n        return nil, err\n    }\n    return gen, nil\n}\n</code></pre>\n\n<p>But when running the test:</p>\n\n<pre><code>$ cat compile_test.go\npackage main\n\nimport \"fmt\"\nimport \"testing\"\n\nfunc TestCompile(t *testing.T) {\n    cases := []struct {\n        in  string\n        out string\n    }{\n        {\n            in:  \"print \\\"Hello World\\\"\",\n            out: \"[{\\\"Name\\\":\\\"print\\\",\\\"Arguments\\\":[\\\"Hello World\\\"]}]\",\n        },\n        {\n            in:  \"print \\\"My name is Jack White\\\"\",\n            out: \"[{\\\"Name\\\":\\\"print\\\",\\\"Arguments\\\":[\\\"My name is Jack White\\\"]}]\",\n        },\n    }\n    real_stuff, err := Compile(cases[0].in)\n    if err != nil {\n        fmt.Printf(\"error: %s\\n\", err)\n    }\n    if string(real_stuff) != cases[0].out {\n        fmt.Printf(\"got %s, expected %s\\n\", string(real_stuff), cases[0].out)\n        t.Fail()\n    }\n    real_stuff, err = Compile(cases[1].in)\n    if err != nil {\n        fmt.Printf(\"error: %s\\n\", err)\n    }\n    if string(real_stuff) != cases[1].out {\n        fmt.Printf(\"got %s, expected %s\\n\", string(real_stuff), cases[1].out)\n        t.Fail()\n    }\n}\n$ go test\n[]\ngot [], expected [{\"Name\":\"print\",\"Arguments\":[\"Hello World\"]}]\n[]\ngot [], expected [{\"Name\":\"print\",\"Arguments\":[\"My name is Jack White\"]}]\n--- FAIL: TestCompile (0.06s)\n</code></pre>\n\n<p>Can someone explain why the test fails and why <code>Compile</code> doesn't work?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 2, "creation_date": 1510635198, "post_id": 47277874, "comment_id": 81506685, "body": "There is no folder <code>handlers</code> in <code>api</code>."}, {"owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1510635330, "post_id": 47277874, "comment_id": 81506723, "body": "@tkausl Yes but from what I&#39;ve read in the previous answers it seems you end with the package name. If I try to just do <code>api</code> it removes the error on the import and puts an error on the main that says <code>cannot refer to unexported name handlers.indexHandler</code>"}, {"owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1510637362, "post_id": 47277874, "comment_id": 81507332, "body": "I understand the downvotes due to the amount of &quot;duplicates&quot; but I believe that Topo&#39;s answer adds some better explanation, especially for the part about the capitalization because I missed that in many tutorials. Things like that are easy to overlook."}], "answers": [{"comments": [{"owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "edited": false, "score": 0, "creation_date": 1510635942, "post_id": 47277994, "comment_id": 81506874, "body": "So the combination of adding the other folder (or just importing api) and then capitalizing the function (which I must have missed completely in the docs) worked.  When I read the other answers, I assumed that what you ended the import with was the name of the package not the name of the folder."}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "reply_to_user": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "edited": false, "score": 1, "creation_date": 1510636084, "post_id": 47277994, "comment_id": 81506921, "body": "@Mr.Smithyyy Good. the part about capitalizing the letters for exported functions or variables, because it&#39;s easy to miss when passing a struct to another package to do something with it, it won&#39;t be able to see the fields that are not exported (Start with a capital letter)."}], "tags": [], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "is_accepted": true, "score": 1, "last_activity_date": 1510635669, "creation_date": 1510635669, "answer_id": 47277994, "question_id": 47277874, "link": "https://stackoverflow.com/questions/47277874/cannot-find-package-api-handlers/47277994#47277994", "title": "Cannot find package &quot;api/handlers&quot;", "body": "<p>What's happening is that <code>import api/handlers</code> is looking for the folder <code>handlers</code> in the folder <code>api</code>, and then looking in the contents for the package name. Add a <code>handlers</code> folder inside <code>api</code> and move <code>index.go</code> and <code>repo.go</code> into that folder. Or just change the package name to <code>api</code> in those files and just do <code>import api</code>.</p>\n\n<p>About your comment:</p>\n\n<blockquote>\n  <p>cannot refer to unexported name handlers.indexHandler</p>\n</blockquote>\n\n<p>In order for you to be able to use function <code>indexHandler</code> from your main package, you should rename it to <code>IndexHandler</code>. In go, for things to be able to be accessed by other packages, the name needs to start with a capital letter.</p>\n"}], "owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 491, "favorite_count": 0, "accepted_answer_id": 47277994, "answer_count": 1, "score": -1, "last_activity_date": 1510635669, "creation_date": 1510634988, "question_id": 47277874, "link": "https://stackoverflow.com/questions/47277874/cannot-find-package-api-handlers", "title": "Cannot find package &quot;api/handlers&quot;", "body": "<p>Ok so this question has been asked before and I believe I have looked through all of them to and tested the answers but I will explain how each one doesn't match my case. I might have missed the answer in one of those but I read each one and attempted to see if it could fit my case</p>\n\n<p><a href=\"https://stackoverflow.com/questions/35480623/how-to-import-local-packages-in-go\">How to import local packages in go?</a> I believe my imports follow the structure of the answer</p>\n\n<p><a href=\"https://stackoverflow.com/questions/13214029/go-build-cannot-find-package-even-though-gopath-is-set\">Go build: &quot;Cannot find package&quot; (even though GOPATH is set)</a> I'm not sure if this one is fully pertinent but I don't think it's the same error.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/34815455/golang-why-cant-i-import-local-package-in-gopath-src-project-but-can-in-home\">Golang - Why can&#39;t I import local package in GOPATH/src/project but can in home directory?</a> My import path isn't relative so this question isn't pertinent.</p>\n\n<p>My error is simple: </p>\n\n<pre><code>cannot find package \"api/handlers\" in any of: \nC:\\Go\\src\\api\\handlers (from $GOROOT) \nC:\\Projects\\Go\\src\\api\\handlers (from $GOPATH)`\n</code></pre>\n\n<p>My project structure is as follows:</p>\n\n<pre><code>src\n|\n --api\n   |\n    -- index.go\n    -- repo.go\n   |\n   github.com\n   |\n   main.go\n</code></pre>\n\n<p>Environment variables:</p>\n\n<pre><code>$GOPATH : C:\\Projects\\Go\n$GOROOT : C:\\Go\\\n</code></pre>\n\n<p>index and repo.go both have the same package name, imports, and just an empty function:</p>\n\n<pre><code>package handlers\n\nimport (\n    \"net/http\"\n)\n\nfunc indexHandler(w http.ResponseWriter, r *http.Request) {\n}\n</code></pre>\n\n<p>My main.go:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"api/handlers\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/api/index\", handlers.indexHandler)\n    http.HandleFunc(\"/api/repo\", handlers.repoHandler)\n\n    log.Fatal(http.ListenAndServer(\"localhost:8080\", nil))\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1510630182, "post_id": 47277005, "comment_id": 81505364, "body": "Have you looked at <code>Location</code>: <a href=\"https://golang.org/pkg/time/#Location\" rel=\"nofollow noreferrer\">golang.org/pkg/time/#Location</a>"}, {"owner": {"reputation": 3103, "user_id": 60247, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/573b0abaa71b7cf74c4f3cc482b67dcd?s=128&d=identicon&r=PG", "display_name": "Shane H", "link": "https://stackoverflow.com/users/60247/shane-h"}, "reply_to_user": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1510631571, "post_id": 47277005, "comment_id": 81505722, "body": "@EugeneLisitsky If I do e.g. time.Local.String() I get &quot;Local&quot; -- do you know what I&#39;m doing wrong?"}, {"owner": {"reputation": 3103, "user_id": 60247, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/573b0abaa71b7cf74c4f3cc482b67dcd?s=128&d=identicon&r=PG", "display_name": "Shane H", "link": "https://stackoverflow.com/users/60247/shane-h"}, "edited": false, "score": 0, "creation_date": 1510632065, "post_id": 47277005, "comment_id": 81505859, "body": "Corrected, JimB. Thanks"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1510632693, "post_id": 47277005, "comment_id": 81506007, "body": "You can only guess, and you won&#39;t know when you&#39;re wrong. Trying to maintain data from different timezones between timezones always leads to confusion, so I always recommend using UTC exclusively. Most servers are configured as UTC anyway, so there&#39;s probably nothing to guess."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1510644622, "post_id": 47277005, "comment_id": 81510299, "body": "I coucur with @JimB: while you can do <code>time.Local.String()</code> and hope for the best (especially on Windows), it&#39;s best to not <i>expose</i> this information in any data exchange happening between geographically disparate computers. While it&#39;s okay to have non-UTC locale on the machine running your software, make sure that it converts all the time it sends outside to UTC. Or <i>at least</i> make sure you&#39;re using timezone-aware external (on-the-wire) representations for the timestamps you send\u2014such as <code>time.RFC3339</code>."}], "answers": [{"comments": [{"owner": {"reputation": 3103, "user_id": 60247, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/573b0abaa71b7cf74c4f3cc482b67dcd?s=128&d=identicon&r=PG", "display_name": "Shane H", "link": "https://stackoverflow.com/users/60247/shane-h"}, "edited": false, "score": 0, "creation_date": 1510651923, "post_id": 47279794, "comment_id": 81514376, "body": "Thanks Hugh. This is roughly what I&#39;ve resorted to already, with a quick check of TZ environment variable, and I&#39;m looking to parse output of timedatectl which will work on FreeBSD as well. But I was really hoping somebody had done this cross platform stuff already and I Just hadn&#39;t found it."}], "tags": [], "owner": {"reputation": 721, "user_id": 8930534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0277bb31c0a6d6334cf3d287289bc17?s=128&d=identicon&r=PG&f=1", "display_name": "Hugh", "link": "https://stackoverflow.com/users/8930534/hugh"}, "is_accepted": true, "score": 2, "last_activity_date": 1510643859, "creation_date": 1510643859, "answer_id": 47279794, "question_id": 47277005, "link": "https://stackoverflow.com/questions/47277005/determine-current-host-location-e-g-europe-london/47279794#47279794", "title": "Determine current host location e.g. Europe/London", "body": "<p>On Ubuntu (and probably other Linux distros), <code>/etc/timezone</code> contains a description of the location (e.g. <code>Australia/Sydney</code>), if one was set when the server was setup. As has been mentioned in the comments, there is no guarantee this is going to be correct.</p>\n\n<p>If you have internet access you could do a GET request to <code>https://freegeoip.net/json/</code> or something similar which will return a json object containing geolocation data for your ip. Again, there are many things that could affect the accuracy of this.</p>\n\n<p>The code below does both these things, note for brevity there is no error checking (which is bad).</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\ntype LocationData struct {\n    IP          string  `json:\"ip\"`\n    CountryCode string  `json:\"country_code\"`\n    CountryName string  `json:\"country_name\"`\n    RegionCode  string  `json:\"region_code\"`\n    RegionName  string  `json:\"region_name\"`\n    City        string  `json:\"city\"`\n    ZipCode     string  `json:\"zip_code\"`\n    TimeZone    string  `json:\"time_zone\"`\n    Latitude    float64 `json:\"latitude\"`\n    Longitude   float64 `json:\"longitude\"`\n    MetroCode   int     `json:\"metro_code\"`\n}\n\nfunc main() {\n    // Using /etc/timezone\n    buf, _ := ioutil.ReadFile(\"/etc/timezone\")\n    fmt.Printf(\"%s\", buf)\n\n    // Using freegeoip\n    var locationData LocationData\n\n    resp, _ := http.Get(\"https://freegeoip.net/json/\")\n    defer resp.Body.Close()\n\n    decoder := json.NewDecoder(resp.Body)\n    decoder.Decode(&amp;locationData)\n\n    fmt.Println(locationData.TimeZone)\n}\n</code></pre>\n"}], "owner": {"reputation": 3103, "user_id": 60247, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/573b0abaa71b7cf74c4f3cc482b67dcd?s=128&d=identicon&r=PG", "display_name": "Shane H", "link": "https://stackoverflow.com/users/60247/shane-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 0, "accepted_answer_id": 47279794, "answer_count": 1, "score": 1, "last_activity_date": 1510643859, "creation_date": 1510628705, "last_edit_date": 1510631715, "question_id": 47277005, "link": "https://stackoverflow.com/questions/47277005/determine-current-host-location-e-g-europe-london", "title": "Determine current host location e.g. Europe/London", "body": "<p>I'm developing a client application that will run on our user's servers. I'd like to make a guess at the current location e.g. America/New_York or Europe/London to relay to the service so it can compute current time on the client with respect to UTC offset and daylight saving rules. </p>\n\n<p>Any thoughts on how the app could best guess at current location? I know I can get the current timezone like \"PST\" but that doesn't tell me what I need to know. </p>\n"}, {"tags": ["go", "mux"], "answers": [{"comments": [{"owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "edited": false, "score": 0, "creation_date": 1510627853, "post_id": 47276886, "comment_id": 81504814, "body": "Yes sorry I&#39;ll edit my post to provide that information I do indeed run it with that command. I tried your solution and ran into some other problems I will update my question."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "edited": false, "score": 0, "creation_date": 1510628617, "post_id": 47276886, "comment_id": 81504979, "body": "Do you mean <code>getUsers</code> method of an <code>App</code> struct? If yes try call it as <code>a.getUsers</code> inside other methods. Or there is another go file(s) where it is defined? If so as them to <code>go run</code> too. Even with <code>*</code>."}, {"owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "edited": false, "score": 0, "creation_date": 1510629526, "post_id": 47276886, "comment_id": 81505199, "body": "<code>getUsers</code> is defined in my app.go file so it should run with that. I tried using <code>go run *.go</code> and it gave me an error of <code>*.go: The filename, directory name, or volume label syntax is incorrect.</code> Sorry for the lack of knowledge on the topic. I come from a javascript background and I&#39;ve been trying to read all of the guides I can on this but documentation becomes a blur after a while."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "edited": false, "score": 0, "creation_date": 1510629808, "post_id": 47276886, "comment_id": 81505275, "body": "Don\u2019t worry. We are have started sometime ago :).  Is it the whole file? I see only a method defined on structure but I do not see a standalone function with such parameters."}, {"owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "edited": false, "score": 0, "creation_date": 1510630320, "post_id": 47276886, "comment_id": 81505392, "body": "Oh yeah sorry I&#39;m getting a grip on structs. I have probably 4 more similar functions like that one (get, post, put ,delete) style and they all pretty much look the same with the same parameters so I guess all of the methods are on the struct. I can put them all in the question but I felt it would just clutter the code since they look idential at definition."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "edited": false, "score": 0, "creation_date": 1510630526, "post_id": 47276886, "comment_id": 81505440, "body": "If they present in the same folder and package just add their files to <code>go run</code> and run from that folder. About <code>*</code> - looks like shell issues."}, {"owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "edited": false, "score": 0, "creation_date": 1510630951, "post_id": 47276886, "comment_id": 81505551, "body": "Do I still need to do that if the methods are in the <code>app.go</code> file? I figured that they would automatically included when the initialize and run methods were run in the <code>main.go</code> file. As for shell issues I don&#39;t know if it matter but I am running the commands in the powershell on Visual Studio Code."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "edited": false, "score": 0, "creation_date": 1510631304, "post_id": 47276886, "comment_id": 81505656, "body": "Method should be visible to compiler. Now it doesn\u2019t see. Go run is designed to work with individual files. So you can pass all the files explicitly. At a moment do not waste time for a shell issues."}, {"owner": {"reputation": 804, "user_id": 7171834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9r1VB.png?s=128&g=1", "display_name": "Peter Gloor", "link": "https://stackoverflow.com/users/7171834/peter-gloor"}, "edited": false, "score": 0, "creation_date": 1510738456, "post_id": 47276886, "comment_id": 81558278, "body": "Not sure about Linux but <code>go run *.go</code> will certainly not work on Windows."}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 2, "last_activity_date": 1510628711, "last_edit_date": 1510628711, "creation_date": 1510627745, "answer_id": 47276886, "question_id": 47276835, "link": "https://stackoverflow.com/questions/47276835/undefined-app-with-mux/47276886#47276886", "title": "Undefined: App with mux", "body": "<p>How do you run it? If with <code>go run</code> try to pass it all the files:</p>\n\n<pre><code>go run main.go app.go\n</code></pre>\n\n<p>Or even with asterisk to catch them all:</p>\n\n<pre><code>go run *.go\n</code></pre>\n\n<p>Another option: build application then run it:</p>\n\n<pre><code>go build -o app &amp;&amp; ./app\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 0, "last_activity_date": 1510653386, "creation_date": 1510653386, "answer_id": 47282625, "question_id": 47276835, "link": "https://stackoverflow.com/questions/47276835/undefined-app-with-mux/47282625#47282625", "title": "Undefined: App with mux", "body": "<p>Just to add to <a href=\"https://stackoverflow.com/a/47276886/965900\">@Eugene Lisitsky's answer</a>.</p>\n\n<p>If <code>*.go</code> doesn't work for you for some reason you'll have to manually list all files on which your program depends.</p>\n\n<p>That means that besides <code>main.go</code> and <code>app.go</code> you also need to list files that define the <code>getUsers</code>, <code>respondWithError</code> and <code>respondWithJSON</code> functions, and if the files in which you define these functions reference some other identifiers that are defined in yet other files you'll also need to include those and so on.</p>\n\n<p>And as you can see this can get pretty annoying pretty quickly so it might be a good idea to put all of your app code, and all other code that's outside of the main.go file into separate packages, then have main.go import those packages, and with that you should be able to run your app with <code>go run main.go</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 7040650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b43c6032e2a53f58340215e5254c5c1?s=128&d=identicon&r=PG&f=1", "display_name": "Macro", "link": "https://stackoverflow.com/users/7040650/macro"}, "is_accepted": false, "score": 0, "last_activity_date": 1512384574, "last_edit_date": 1512384574, "creation_date": 1512354097, "answer_id": 47625631, "question_id": 47276835, "link": "https://stackoverflow.com/questions/47276835/undefined-app-with-mux/47625631#47625631", "title": "Undefined: App with mux", "body": "<p>I have this problem too. Maybe we follow the same <a href=\"https://medium.com/@kelvinpfw/building-and-testing-a-rest-api-in-golang-using-gorilla-mux-and-mysql-1f0518818ff6\" rel=\"nofollow noreferrer\">tutorial</a>.\ntry this:</p>\n\n<pre><code>go build .  // create a file end with \".exe\", my file name is \"golang.exe\"\n./golang.exe\n</code></pre>\n\n<p>then it's ok!</p>\n"}], "owner": {"reputation": 1809, "user_id": 4274475, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b7d37b7f022503a0869af7bb8c2ace16?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.Smithyyy", "link": "https://stackoverflow.com/users/4274475/mr-smithyyy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1220, "favorite_count": 1, "accepted_answer_id": 47276886, "answer_count": 3, "score": 3, "last_activity_date": 1512384574, "creation_date": 1510627267, "last_edit_date": 1510628153, "question_id": 47276835, "link": "https://stackoverflow.com/questions/47276835/undefined-app-with-mux", "title": "Undefined: App with mux", "body": "<p>So I just started learning Go yesterday and I have been following a fairly simple tutorial on creating a restful api. I can run the tests and everything but when I try to run the app and have it listen on a part it gives me <code>undefined: App</code>.</p>\n\n<p>I cannot seem to find the error in this as Initialize and run should be sufficient enough to start the server. The tutorial also has it exactly like this and I followed it carefully.</p>\n\n<h2>UPDATE:</h2>\n\n<p>As clarification I attempt to run the program with <code>go run main.go</code> and that's what prompts the error. </p>\n\n<p>I also attempted to follow the advice of an answer and ran <code>go run main.go app.go</code> and I get <code>undefined: getUsers</code> and it points to the line where it says <code>users, err := getUsers(a.DB, start, count)</code>. I have added them to my app.go code below.</p>\n\n<h2>main.go</h2>\n\n<pre><code>package main\n\nfunc main() {\n    a := App{}\n\n    a.Initialize(\"root\", \"password\", \"user\")\n\n    a.Run(\":8080\")\n}\n</code></pre>\n\n<h2>app.go</h2>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"strconv\"\n    \"encoding/json\"\n    \"net/http\"\n    \"github.com/gorilla/mux\"\n    \"database/sql\"\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\ntype App struct {\n    Router *mux.Router\n    DB     *sql.DB\n}\n\nfunc (a *App) Initialize(user, password, dbname string) {\n    connectionString := fmt.Sprintf(\"%s:%s@/%s\", user, password, dbname)\n\n    var err error\n\n    a.DB, err = sql.Open(\"mysql\", connectionString)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    a.Router = mux.NewRouter()\n    a.initializeRoutes()\n}\n\nfunc (a *App) initializeRoutes() {\n    a.Router.HandleFunc(\"/users\", a.getUsers).Methods(\"GET\")\n}\n\nfunc (a *App) Run(addr string) {\n    log.Fatal(http.ListenAndServe(addr, a.Router))\n}\n\nfunc (a *App) getUsers(w http.ResponseWriter, r *http.Request) {\n    count, _ := strconv.Atoi(r.FormValue(\"count\"))\n    start, _ := strconv.Atoi(r.FormValue(\"start\"))\n\n    if count &gt; 10 || count &lt; 1 {\n        count = 10\n    }\n\n    if start &lt; 0 {\n        start = 0\n    }\n\n    users, err := getUsers(a.DB, start, count)\n\n    if err != nil {\n        respondWithError(w, http.StatusInternalServerError, err.Error())\n\n        return\n    }\n\n    respondWithJSON(w, http.StatusOK, users);\n}\n</code></pre>\n"}, {"tags": ["go", "amazon-ec2"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1510625311, "post_id": 47275763, "comment_id": 81504229, "body": "Yes, but can your application scale across 72 vCPUs, with NUMA and a single scheduler?"}], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 1, "last_activity_date": 1510619643, "creation_date": 1510619643, "answer_id": 47275807, "question_id": 47275763, "link": "https://stackoverflow.com/questions/47275763/go-routines-in-ec2-instance/47275807#47275807", "title": "go routines in ec2 instance", "body": "<p>As Go 1.5 Release Notes says</p>\n\n<blockquote>\n  <p>By default, Go programs run with GOMAXPROCS set to the number of cores available; in prior releases it defaulted to 1.</p>\n</blockquote>\n\n<p>So starting from Go 1.5, the default value should be the number of cores.  Which means that yes, the go routines should be distributed among the 72 CPUs unless you do something like <code>runtime.GOMAXPROCS(1)</code></p>\n"}], "owner": {"reputation": 308, "user_id": 2781252, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/EMRkD.jpg?s=128&g=1", "display_name": "Bernardo Rodrigues", "link": "https://stackoverflow.com/users/2781252/bernardo-rodrigues"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 47275807, "answer_count": 1, "score": -2, "last_activity_date": 1510619643, "creation_date": 1510619259, "question_id": 47275763, "link": "https://stackoverflow.com/questions/47275763/go-routines-in-ec2-instance", "title": "go routines in ec2 instance", "body": "<p>Im writing an app in golang, and I'm doing some tests in a <a href=\"https://aws.amazon.com/ec2/instance-types/c5/\" rel=\"nofollow noreferrer\">c5.18xlarge ec2</a> instance from aws, which has 72 vCPUs.</p>\n\n<p>Is it correct to say that the go routines will be distributed among the 72 vCPUs?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 1, "creation_date": 1510616795, "post_id": 47275291, "comment_id": 81502016, "body": "Did you try explicitly setting the <code>&#39;Transfer-Encoding&#39;</code> header to something else that is allowed by the service you&#39;re using? <code>gzip</code> or <code>identity</code> maybe?"}, {"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "reply_to_user": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1510617239, "post_id": 47275291, "comment_id": 81502128, "body": "I&#39;ve just tried identity.  It overrides it"}, {"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "reply_to_user": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1510617679, "post_id": 47275291, "comment_id": 81502244, "body": "Would using a os.file as the io.Reader cause it to use chunked?"}, {"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1510617767, "post_id": 47275291, "comment_id": 81502262, "body": "Could you inline the content? It&#39;s probably chunking the new lines if it&#39;s multi-line. Or you could try setting the <code>Content-Length</code>, as somebody previously mentioned. Maybe even explicitly removing the <code>&#39;Transfer-Encoding&#39;</code> header afterwards."}, {"owner": {"reputation": 148712, "user_id": 19750, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/13b41b2620da0b1e630715e0c91a0b03?s=128&d=identicon&r=PG", "display_name": "Josh Lee", "link": "https://stackoverflow.com/users/19750/josh-lee"}, "edited": false, "score": 1, "creation_date": 1510618154, "post_id": 47275291, "comment_id": 81502368, "body": "For what it&#39;s worth, go seems to be following the spec here: <i>All HTTP/1.1 applications MUST be able to receive and decode the &quot;chunked&quot; transfer-coding</i>"}, {"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 0, "creation_date": 1510618171, "post_id": 47275291, "comment_id": 81502376, "body": "Turns out that this is the case.  As it&#39;s a file io.Reader type it&#39;s using chunked and setting Content-Length also doesn&#39;t help, it overrides it.  I&#39;ll have to see if there is another way around this."}, {"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "reply_to_user": {"reputation": 148712, "user_id": 19750, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/13b41b2620da0b1e630715e0c91a0b03?s=128&d=identicon&r=PG", "display_name": "Josh Lee", "link": "https://stackoverflow.com/users/19750/josh-lee"}, "edited": false, "score": 0, "creation_date": 1510618189, "post_id": 47275291, "comment_id": 81502378, "body": "@JoshLee - tell that to Amazon!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1510619189, "post_id": 47275291, "comment_id": 81502653, "body": "Now that I had a moment to test it, did you try setting ContentLength? That seems to work for me."}, {"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 0, "creation_date": 1510619958, "post_id": 47275291, "comment_id": 81502860, "body": "If I set it on the request that comes back from http.NewRequest, not by using a header set by request.Header.Set.  I assumed the client would be smarter."}], "answers": [{"comments": [{"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 0, "creation_date": 1510619507, "post_id": 47275640, "comment_id": 81502728, "body": "That actually works.  Now I have another issue... S3 woes!"}, {"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 2, "creation_date": 1510620271, "post_id": 47275640, "comment_id": 81502928, "body": "In fact, I don&#39;t need this.  Just set req.ContentLength."}, {"owner": {"reputation": 26448, "user_id": 10322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa46a3814b72439b1d2efa8f7c9162c2?s=128&d=identicon&r=PG", "display_name": "ctcherry", "link": "https://stackoverflow.com/users/10322/ctcherry"}, "reply_to_user": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 0, "creation_date": 1510620470, "post_id": 47275640, "comment_id": 81502981, "body": "Nice! Glad you figured it out"}], "tags": [], "owner": {"reputation": 26448, "user_id": 10322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa46a3814b72439b1d2efa8f7c9162c2?s=128&d=identicon&r=PG", "display_name": "ctcherry", "link": "https://stackoverflow.com/users/10322/ctcherry"}, "is_accepted": true, "score": 5, "last_activity_date": 1510618428, "creation_date": 1510618428, "answer_id": 47275640, "question_id": 47275291, "link": "https://stackoverflow.com/questions/47275291/go-http-client-adds-chunked-encoding-which-is-not-support-by-service/47275640#47275640", "title": "Go HTTP Client adds chunked encoding which is not support by service", "body": "<p><code>TransferEncoding</code> is a field directly on the Request struct. If you set it explicitly it will not be overridden.</p>\n\n<p><code>req.TransferEncoding = []string{\"identity\"}</code></p>\n\n<p><a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"noreferrer\">https://golang.org/pkg/net/http/#Request</a></p>\n"}, {"tags": [], "owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "is_accepted": false, "score": 2, "last_activity_date": 1510620847, "creation_date": 1510620847, "answer_id": 47275961, "question_id": 47275291, "link": "https://stackoverflow.com/questions/47275291/go-http-client-adds-chunked-encoding-which-is-not-support-by-service/47275961#47275961", "title": "Go HTTP Client adds chunked encoding which is not support by service", "body": "<p>Setting Transfer Encoding header like this makes it not use chunked:</p>\n\n<pre><code>req.TransferEncoding = []string{\"identity\"}\n</code></pre>\n\n<p>However the http client sources give the reason for it choosing chunked in my case.  Specifically, I was using \"PUT\" as the method and had no content-length specified.  So all I needed was to set the req.ContentLength.</p>\n\n<p>However, you can see my <code>DoHTTPRequest</code> wrapper function doesn't know how big to set it.  And I had assumed that setting the header will make it work originally.  Well, it doesn't work by setting the header. And you can see why in the sources that determine whether to make it use chunked encoding.</p>\n\n<pre><code>// shouldSendChunkedRequestBody reports whether we should try to send a\n// chunked request body to the server. In particular, the case we really\n// want to prevent is sending a GET or other typically-bodyless request to a\n// server with a chunked body when the body has zero bytes, since GETs with\n// bodies (while acceptable according to specs), even zero-byte chunked\n// bodies, are approximately never seen in the wild and confuse most\n// servers. See Issue 18257, as one example.\n//\n// The only reason we'd send such a request is if the user set the Body to a\n// non-nil value (say, ioutil.NopCloser(bytes.NewReader(nil))) and didn't\n// set ContentLength, or NewRequest set it to -1 (unknown), so then we assume\n// there's bytes to send.\n//\n// This code tries to read a byte from the Request.Body in such cases to see\n// whether the body actually has content (super rare) or is actually just\n// a non-nil content-less ReadCloser (the more common case). In that more\n// common case, we act as if their Body were nil instead, and don't send\n// a body.\nfunc (t *transferWriter) shouldSendChunkedRequestBody() bool {\n    // Note that t.ContentLength is the corrected content length\n    // from rr.outgoingLength, so 0 actually means zero, not unknown.\n    if t.ContentLength &gt;= 0 || t.Body == nil { // redundant checks; caller did them\n        return false\n    }\n    if requestMethodUsuallyLacksBody(t.Method) {\n        // Only probe the Request.Body for GET/HEAD/DELETE/etc\n        // requests, because it's only those types of requests\n        // that confuse servers.\n        t.probeRequestBody() // adjusts t.Body, t.ContentLength\n        return t.Body != nil\n    }\n    // For all other request types (PUT, POST, PATCH, or anything\n    // made-up we've never heard of), assume it's normal and the server\n    // can deal with a chunked request body. Maybe we'll adjust this\n    // later.\n    return true\n}\n</code></pre>\n\n<p>So my solution is simply:</p>\n\n<pre><code>// DoHTTPRequest Do a full HTTP Client Request, with timeout\nfunc DoHTTPRequest(method, url string, body io.Reader, headers map[string]string, timeout time.Duration) (*http.Response, error) {\n\n    // Create the request\n    req, err := http.NewRequest(method, url, body)\n    if err != nil {\n        return nil, err\n    }\n\n    // Add headers\n    for k, v := range headers {\n        req.Header.Set(k, v)\n        // Set the Content Length correctly if specified.\n        if strings.EqualFold(k, \"Content-Length\") {\n            length, err := strconv.Atoi(v)\n            if err != nil {\n               return nil, fmt.Errorf(\"Bad Content-Length header\")\n            }\n            req.ContentLength = int64(length)\n        }\n    }\n\n    client := &amp;http.Client{\n        Timeout:   timeout,\n        Transport: &amp;loghttp.Transport{},\n    }\n\n    return client.Do(req)\n}\n</code></pre>\n\n<p>Which satisfies S3 as far as having a correct content length.  I didn't need to set the TransferEncoding to identity.</p>\n"}], "owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2588, "favorite_count": 0, "accepted_answer_id": 47275640, "answer_count": 2, "score": 1, "last_activity_date": 1510620847, "creation_date": 1510616108, "last_edit_date": 1510617819, "question_id": 47275291, "link": "https://stackoverflow.com/questions/47275291/go-http-client-adds-chunked-encoding-which-is-not-support-by-service", "title": "Go HTTP Client adds chunked encoding which is not support by service", "body": "<p>The go HTTP client is adding a \"chunked\" transfer encoding field to my client request.  Unfortunately, this is not supported by the service I'm connecting to and it comes back with an error.</p>\n\n<p>Is there a way to disable this?</p>\n\n<p>This is my Request code:</p>\n\n<pre><code>// DoHTTPRequest Do a full HTTP Client Request, with timeout\nfunc DoHTTPRequest(method, url string, body io.Reader, headers map[string]string, timeout time.Duration) (*http.Response, error) {\n\n    // Create the request\n    req, err := http.NewRequest(method, url, body)\n    if err != nil {\n        return nil, err\n    }\n\n    // Add headers\n    for k, v := range headers {\n        req.Header.Set(k, v)\n    }\n\n    client := &amp;http.Client{\n        Timeout: timeout,\n    }\n\n    return client.Do(req)\n}\n</code></pre>\n\n<p>Basically I would like this header dropped.  This client is talking to S3 which is rather sensitive as to what headers it is sent.</p>\n\n<p>I get this error:</p>\n\n<pre><code>A header you provided implies functionality that is not implemented\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 5529600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b287d1a781caf5c91bae51a339e9e412?s=128&d=identicon&r=PG&f=1", "display_name": "mrjd", "link": "https://stackoverflow.com/users/5529600/mrjd"}, "edited": false, "score": 0, "creation_date": 1510608297, "post_id": 47273748, "comment_id": 81498743, "body": "Thanks for the answer. That was the problem. I just realised same the moment I saw your answer."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 6, "last_activity_date": 1510608039, "creation_date": 1510608039, "answer_id": 47273748, "question_id": 47273729, "link": "https://stackoverflow.com/questions/47273729/goroutine-does-not-run/47273748#47273748", "title": "Goroutine does not run", "body": "<p>Your function blocks before it gets to start the goroutine:</p>\n\n<pre><code>eventCh := make(chan []byte)\neventCh &lt;- body\n</code></pre>\n\n<p>This makes a new channel, and before it can be passed off to any other routine, it tries to send a message to that channel. Since the channel is unbuffered and nothing is reading from it, the send blocks indefinitely.</p>\n"}], "owner": {"reputation": 35, "user_id": 5529600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b287d1a781caf5c91bae51a339e9e412?s=128&d=identicon&r=PG&f=1", "display_name": "mrjd", "link": "https://stackoverflow.com/users/5529600/mrjd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 47273748, "answer_count": 1, "score": 2, "last_activity_date": 1510608039, "creation_date": 1510607971, "question_id": 47273729, "link": "https://stackoverflow.com/questions/47273729/goroutine-does-not-run", "title": "Goroutine does not run", "body": "<p>I'm trying to use a goroutine to write item to database. The goroutine however doesn't seem to do anything for some reason.</p>\n\n<p>I've got following functions:</p>\n\n<pre><code>func addEvent(w http.ResponseWriter, r *http.Request) {\n    body, err := ioutil.ReadAll(r.Body)\n    fmt.Println(string(body[:]))\n\n    if err != nil {\n        panic(err)\n    }\n\n    eventCh := make(chan []byte)\n    eventCh &lt;- body\n    go models.WriteEventToDb(eventCh)\n\n}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>func WriteEventToDb(eventCh chan []byte) {\n    fmt.Println(\"event\")\n    event := &lt;-eventCh\n    newEvent := createNewEvent(event)\n    err := db.Insert(&amp;newEvent)\n\n    if err != nil {\n        panic(err)\n    }\n\n}\n</code></pre>\n\n<p>Any idea why WriteEventToDb does not run?</p>\n"}, {"tags": ["go", "command-line", "go-cobra"], "comments": [{"owner": {"reputation": 519, "user_id": 6680332, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-bkTG-Ocx05o/AAAAAAAAAAI/AAAAAAAAA2c/n6WLPcA4z5A/photo.jpg?sz=128", "display_name": "codenio", "link": "https://stackoverflow.com/users/6680332/codenio"}, "edited": false, "score": 2, "creation_date": 1518851968, "post_id": 47272328, "comment_id": 84682162, "body": "you could remove &#39;Run&#39; section from the RootCmd so that it displays the list of available subcommands and exit. It works more or less like a complaint with safer exit."}], "answers": [{"comments": [{"owner": {"reputation": 1592, "user_id": 703061, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/7db295545ff40053c8d7f062167395ef?s=128&d=identicon&r=PG&f=1", "display_name": "wayfare", "link": "https://stackoverflow.com/users/703061/wayfare"}, "edited": false, "score": 0, "creation_date": 1510602841, "post_id": 47272390, "comment_id": 81495835, "body": "Thanks for replying @Adrian.I thought of doing it, but wondering if there is some flag or better way to do it. In future there will be many flags and it will look ugly to have all of them in run body."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 1592, "user_id": 703061, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/7db295545ff40053c8d7f062167395ef?s=128&d=identicon&r=PG&f=1", "display_name": "wayfare", "link": "https://stackoverflow.com/users/703061/wayfare"}, "edited": false, "score": 0, "creation_date": 1510603218, "post_id": 47272390, "comment_id": 81496044, "body": "I&#39;m not sure what you mean... there are no flags used in your quoted code, and the above would only need to be used once, in one place (<code>RootCmd.Run</code>) regardless of how many subcommands you have."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1510602604, "creation_date": 1510602604, "answer_id": 47272390, "question_id": 47272328, "link": "https://stackoverflow.com/questions/47272328/how-to-make-subcommand-required-in-go-cli-using-cobra/47272390#47272390", "title": "How to make subcommand required in Go CLI using cobra", "body": "<p>You can just make the body of the function handle it, perhaps by <a href=\"https://godoc.org/github.com/spf13/cobra#Command.Help\" rel=\"nofollow noreferrer\">printing help</a> and <a href=\"https://golang.org/pkg/os#Exit\" rel=\"nofollow noreferrer\">exiting as non-successful</a>:</p>\n\n<pre><code>Run: func(cmd *cobra.Command, args []string)  {\n    // Root command does nothing\n    cmd.Help()\n    os.Exit(1)\n},\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 111, "user_id": 4573050, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kqtJX.jpg?s=128&g=1", "display_name": "hampercm", "link": "https://stackoverflow.com/users/4573050/hampercm"}, "is_accepted": false, "score": 0, "last_activity_date": 1607014592, "creation_date": 1607014592, "answer_id": 65130517, "question_id": 47272328, "link": "https://stackoverflow.com/questions/47272328/how-to-make-subcommand-required-in-go-cli-using-cobra/65130517#65130517", "title": "How to make subcommand required in Go CLI using cobra", "body": "<p>Omitting the <code>Run</code> (and <code>RunE</code>) field from the <code>cobra.Command</code> will make it a requirement for a valid subcommand to be given:</p>\n<pre><code>var RootCmd = &amp;cobra.Command{\n    Use:   &quot;myapp&quot;,\n    Short: &quot;tool&quot;,\n    Long:  `tool long help...`,\n}\n</code></pre>\n<p>If no subcommand is given on the command line, Cobra will print out the command's <code>Help()</code> text , which will include the root command's <code>Long</code> help text and the autogenerated usage help for all subcommands.</p>\n"}], "owner": {"reputation": 1592, "user_id": 703061, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/7db295545ff40053c8d7f062167395ef?s=128&d=identicon&r=PG&f=1", "display_name": "wayfare", "link": "https://stackoverflow.com/users/703061/wayfare"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1807, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1607014592, "creation_date": 1510602363, "last_edit_date": 1510602781, "question_id": 47272328, "link": "https://stackoverflow.com/questions/47272328/how-to-make-subcommand-required-in-go-cli-using-cobra", "title": "How to make subcommand required in Go CLI using cobra", "body": "<p>I am using <a href=\"https://github.com/spf13/cobra\" rel=\"nofollow noreferrer\">Cobra</a> to make some cli updated to my app. I want to make this command required, meaning the application should fail if it doesn't find the argument it is looking for. </p>\n\n<pre><code>package commands\n\nimport (\n    \"github.com/spf13/cobra\"\n    \"errors\"\n    \"fmt\"\n)\n\nvar (\n    Env string\n)\n\nvar RootCmd = &amp;cobra.Command{\n    Use:   \"myapp\",\n    Short: \"tool\",\n    Long:  `tool`,\n    Run: func(cmd *cobra.Command, args []string)  {\n        // Root command does nothing\n    },\n}\n\nfunc init() {\n    RootCmd.AddCommand(Environment)\n}\n\nvar Environment = &amp;cobra.Command{\n    Use:   \"env\",\n    Short: \"Specify Environment to run against\",\n    Long: `Can be dev or prod`,\n    Args: func(cmd *cobra.Command, args []string) error {\n        if len(args) != 1 {\n            return errors.New(\"requires at least one arg\")\n        }\n\n        if args[0] == \"dev\" || args[0] == \"prod\" {\n            return nil\n        }else {\n            return errors.New(\"input can only be dev or prod\")\n        }\n        return fmt.Errorf(\"invalid env specified: %s\", args[0])\n    },\n    PreRunE: func(cmd *cobra.Command, args []string) error {\n        if len(args) != 1 {\n          return fmt.Errorf(\"env is required\")\n        }\n      return nil\n    },\n    Run: func(cmd *cobra.Command, args []string) {\n        Env = args[0]\n    },\n}\n</code></pre>\n\n<p>and main package is </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"util\"\n    \"commands\"\n)\n\nfunc main() {\n    log.Println(\"Executing\")\n\n    if err := commands.RootCmd.Execute(); err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    log.Println(\"Executing\")\n}\n</code></pre>\n\n<p>Now if I run this as ./myApp without any env, it doesn't complain about it. However if I use env after myapp then it activates the function and runs all the validations. </p>\n"}, {"tags": ["html", "go"], "answers": [{"comments": [{"owner": {"reputation": 14311, "user_id": 5085211, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eEZjd.png?s=128&g=1", "display_name": "fuglede", "link": "https://stackoverflow.com/users/5085211/fuglede"}, "edited": false, "score": 1, "creation_date": 1510597868, "post_id": 47271151, "comment_id": 81493111, "body": "Excellent, thanks! Knew the standard libraries had to have something."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 7, "last_activity_date": 1510598579, "last_edit_date": 1510598579, "creation_date": 1510597790, "answer_id": 47271151, "question_id": 47271121, "link": "https://stackoverflow.com/questions/47271121/replacing-html-entities-in-go-strings/47271151#47271151", "title": "Replacing HTML entities in Go strings", "body": "<p>Use the <a href=\"https://godoc.org/html#example-UnescapeString\" rel=\"nofollow noreferrer\">html.UnescapeString</a> function:</p>\n\n<pre><code>fmt.Println(html.UnescapeString(\"R&amp;oslash;&amp;d gr&amp;oslash;d &amp;amp; fl&amp;oslash;de\"))\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/lqK4Jvs6qJ\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 14311, "user_id": 5085211, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eEZjd.png?s=128&g=1", "display_name": "fuglede", "link": "https://stackoverflow.com/users/5085211/fuglede"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1956, "favorite_count": 0, "accepted_answer_id": 47271151, "answer_count": 1, "score": 2, "last_activity_date": 1510598579, "creation_date": 1510597692, "question_id": 47271121, "link": "https://stackoverflow.com/questions/47271121/replacing-html-entities-in-go-strings", "title": "Replacing HTML entities in Go strings", "body": "<p>This feels like one of those operations that must be common enough that this is a duplicate question, but since I was not able to find it anywhere:</p>\n\n<p>What is the most straightforward way to replace HTML entities with their string representations in a Go <code>string</code>? That is, how would I turn the string <code>R&amp;oslash;&amp;d gr&amp;oslash;d &amp;amp; fl&amp;oslash;de</code> into <code>R\u00f8d gr\u00f8d &amp; fl\u00f8de</code>?</p>\n\n<p>My own solutions have been either using <code>strings.Replace</code> on all relevant entities (which quickly becomes intractable), or wrapping the string into an XML document and decoding it with <code>xml.Decoder</code> (which seems silly and leads to numerous edge cases).</p>\n"}, {"tags": ["json", "parsing", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1510596042, "post_id": 47270595, "comment_id": 81492123, "body": "You also have a <code>go</code> keyword with without a function call. If that&#39;s a typo missing the <code>()</code>, you then have a goroutine without any synchronization."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 6, "creation_date": 1510597825, "post_id": 47270595, "comment_id": 81493088, "body": "As is one of the most common issues out there, <i>don&#39;t ignore errors</i>.  json.Unmarshal returns an error type.  The output of that error would have told you that your json had invalid quotes, and after you fixed that, would have told you that your destination variable needed to be a pointer."}], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 56, "last_activity_date": 1510596221, "last_edit_date": 1510596221, "creation_date": 1510595915, "answer_id": 47270657, "question_id": 47270595, "link": "https://stackoverflow.com/questions/47270595/how-to-parse-json-string-to-struct/47270657#47270657", "title": "How to parse JSON string to struct", "body": "<p>Two problems, first, your json is invalid, it needs to use <code>\"</code> instead of <code>'</code></p>\n\n<p>Second, you have to unmarshal into <code>&amp;data</code> and not to <code>data</code></p>\n\n<p><a href=\"https://play.golang.org/p/zdMq5_ex8G\" rel=\"noreferrer\">https://play.golang.org/p/zdMq5_ex8G</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype Request struct {\n    Operation string      `json:\"operation\"`\n    Key string            `json:\"key\"`\n    Value string          `json:\"value\"`\n}\n\nfunc main() {\n    s := string(`{\"operation\": \"get\", \"key\": \"example\"}`)\n    data := Request{}\n    json.Unmarshal([]byte(s), &amp;data)\n    fmt.Printf(\"Operation: %s\", data.Operation)\n}\n</code></pre>\n\n<p>Side note, you would have seen this, if you would have been checking your errors:</p>\n\n<pre><code>err := json.Unmarshal([]byte(s), data)\nif err != nil {\n    fmt.Println(err.Error()) \n    //json: Unmarshal(non-pointer main.Request)\n}\n\ns := string(\"{'operation': 'get', 'key': 'example'}\")\n//...\nerr := json.Unmarshal([]byte(s), data)\nif err != nil {\n    fmt.Println(err.Error()) \n    //invalid character '\\'' looking for beginning of object key string\n}\n</code></pre>\n"}], "owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32014, "favorite_count": 3, "accepted_answer_id": 47270657, "answer_count": 1, "score": 18, "last_activity_date": 1587036718, "creation_date": 1510595692, "last_edit_date": 1587036718, "question_id": 47270595, "link": "https://stackoverflow.com/questions/47270595/how-to-parse-json-string-to-struct", "title": "How to parse JSON string to struct", "body": "<p>I have <code>struct</code> of Request, value is optional:</p>\n\n<pre><code>type Request struct {\n    Operation string      `json:\"operation\"`\n    Key string            `json:\"key\"`\n    Value string          `json:\"value\"`\n}\n</code></pre>\n\n<p>And function that should parse json string to struct^ </p>\n\n<pre><code>go func() {\n    s := string(\"{'operation': 'get', 'key': 'example'}\")\n    data := Request{}\n    json.Unmarshal([]byte(s), data)\n    log.Printf(\"Operation: %s\", data.Operation)\n}\n</code></pre>\n\n<p>For some reason data.Operation is empty. What is wrong here?</p>\n"}, {"tags": ["go", "transactions", "bitcoin"], "owner": {"reputation": 6904, "user_id": 702627, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e96c4c0e797bdd50fa0beeff740218eb?s=128&d=identicon&r=PG", "display_name": "tmesser", "link": "https://stackoverflow.com/users/702627/tmesser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 429, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1510594616, "creation_date": 1510594616, "question_id": 47270278, "link": "https://stackoverflow.com/questions/47270278/multiple-input-output-transactions-using-golang-btcd", "title": "Multiple input/output transactions using golang btcd", "body": "<p>I originally had this question on the bitcoin stack exchange, but I've been told that as it's at least partially a coding question it makes more sense here on SO.</p>\n\n<p>I am using golang's <a href=\"https://github.com/btcsuite/btcd\" rel=\"nofollow noreferrer\">btcd</a> as a basis for creating some server-side tools for handling transactions. I found a good <a href=\"https://github.com/prettymuchbryce/hellobitcoin\" rel=\"nofollow noreferrer\">example</a> for creating a basic one-input-one-output transaction to get me started on the implementation, and I have also <a href=\"https://en.bitcoin.it/wiki/Transaction\" rel=\"nofollow noreferrer\">read</a> <a href=\"https://en.bitcoin.it/wiki/Script\" rel=\"nofollow noreferrer\">the documentation</a> <a href=\"https://en.bitcoin.it/wiki/Protocol_documentation#Transaction_Verification\" rel=\"nofollow noreferrer\">heavily</a> on the technical specifics here.  I have also looked at the other <a href=\"https://github.com/btcsuite/\" rel=\"nofollow noreferrer\">btcsuite</a> libraries pretty heavily to try to gain more insight. To be clear, I am NOT expecting any of these tools to issue the transaction or anything like that; I understand that this was written out of btcd in particular for very, very good reasons. I am just trying to use these tools to create valid transactions that I can issue later.</p>\n\n<p>I am still incredibly confused on the particulars in implementing multiple input, multiple output transactions and the scripts that we use on them.  A few topics:</p>\n\n<ul>\n<li>I'm <a href=\"https://github.com/btcsuite/btcd/blob/master/txscript/standard.go#L415\" rel=\"nofollow noreferrer\">familiar</a> with the script tools in btcd, the link goes to the most common one used, but all of these scripts are used for one specific output. There seems to be absolutely no documentation anywhere about how to provide scripting for multiple outputs. If I'm doing a normal P2PK or P2PKH transaction, do I simply concatenate the scripts for all the various outputs, or what?</li>\n<li><p>In the <a href=\"https://github.com/prettymuchbryce/hellobitcoin/blob/master/transaction.go#L161\" rel=\"nofollow noreferrer\">create Transaction example</a> in the HelloBitcoin example I've linked above, the overall magic happens near the end with:</p>\n\n<pre><code>buffer.Write(version)\nbuffer.Write(inputs)\nbuffer.Write(inputTransactionBytesReversed)\nbuffer.Write(outputIndexBytes)\nbuffer.WriteByte(byte(scriptSigLength))\nbuffer.Write(scriptSig)\nbuffer.Write(sequence)\nbuffer.Write(numOutputs)\nbuffer.Write(satoshiBytes)\nbuffer.WriteByte(byte(scriptPubKeyLength))\nbuffer.Write(scriptPubKey)\nbuffer.Write(lockTimeField)\n</code></pre></li>\n</ul>\n\n<p>And I feel like there are a lot of unanswered questions on how to expand this to handle multiple inputs and multiple outputs. For the inputs, is it as simple as taking all the input transactions into little-endian, noting the correct number in <code>inputs</code>, and going from there? For outputs, do you just have an individual block of to <code>satoshiBytes</code> to <code>scriptPubKey</code>? I can't find in the documentation  how this is supposed to all glue together, and at this point I feel like I need some help with the nuts and bolts of this. Thanks in advance for any help - if we can get these two points answered I might end up making more questions from the stuff that will inevitably result from this.</p>\n"}, {"tags": ["xcode", "macos", "go"], "comments": [{"owner": {"reputation": 1437, "user_id": 4038702, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/364QK.jpg?s=128&g=1", "display_name": "Pandelis", "link": "https://stackoverflow.com/users/4038702/pandelis"}, "edited": false, "score": 1, "creation_date": 1510592051, "post_id": 47268576, "comment_id": 81489867, "body": "Could you try reinstalling with brew?"}], "answers": [{"comments": [{"owner": {"reputation": 3623, "user_id": 491557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3c20e970d3e909fa67a7809965c4936?s=128&d=identicon&r=PG", "display_name": "Spangen", "link": "https://stackoverflow.com/users/491557/spangen"}, "reply_to_user": {"reputation": 1591, "user_id": 7304216, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7948f2563d2a2d276561b3a05c357150?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Pocock", "link": "https://stackoverflow.com/users/7304216/nick-pocock"}, "edited": false, "score": 2, "creation_date": 1510589522, "post_id": 47268705, "comment_id": 81488125, "body": "There are some other options at <a href=\"https://stackoverflow.com/questions/32893412/command-line-tools-not-working-os-x-el-capitan-macos-sierra-macos-high-sierra/32894314#32894314\" title=\"command line tools not working os x el capitan macos sierra macos high sierra\">stackoverflow.com/questions/32893412/&hellip;</a>  That&#39;s where I got my solution from"}], "tags": [], "owner": {"reputation": 3623, "user_id": 491557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3c20e970d3e909fa67a7809965c4936?s=128&d=identicon&r=PG", "display_name": "Spangen", "link": "https://stackoverflow.com/users/491557/spangen"}, "is_accepted": true, "score": 3, "last_activity_date": 1510589443, "creation_date": 1510589443, "answer_id": 47268705, "question_id": 47268576, "link": "https://stackoverflow.com/questions/47268576/unable-to-build-go-application-after-mac-update/47268705#47268705", "title": "Unable to build Go application after Mac update", "body": "<p>I encountered this after upgrade to High Sierra and addressed it with</p>\n\n<pre><code>sudo xcode-select --reset\n</code></pre>\n"}], "owner": {"reputation": 1591, "user_id": 7304216, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7948f2563d2a2d276561b3a05c357150?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Pocock", "link": "https://stackoverflow.com/users/7304216/nick-pocock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1822, "favorite_count": 0, "accepted_answer_id": 47268705, "answer_count": 1, "score": 3, "last_activity_date": 1510589454, "creation_date": 1510589075, "last_edit_date": 1510589454, "question_id": 47268576, "link": "https://stackoverflow.com/questions/47268576/unable-to-build-go-application-after-mac-update", "title": "Unable to build Go application after Mac update", "body": "<p>I just updated to High Sierra and now I can't build any GoLang Applications. I get the following error:</p>\n\n<pre><code>&gt; # command-line-arguments\n/usr/local/Cellar/go/1.8.3/libexec/pkg/tool/darwin_amd64/link: running clang failed: exit status 1\nxcrun: error: invalid active developer path (/Library/Developer/CommandLineTools), missing xcrun at: /Library/Developer/CommandLineTools/usr/bin/xcrun\n</code></pre>\n\n<p>I have tried </p>\n\n<pre><code>xcode-select --install\n</code></pre>\n\n<p>and </p>\n\n<pre><code>xcode-select --reset \n</code></pre>\n\n<p>But neither have worked, has anyone else encountered this?</p>\n"}, {"tags": ["file", "search", "recursion", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 11, "creation_date": 1510583074, "post_id": 47266529, "comment_id": 81483695, "body": "Use <a href=\"https://golang.org/pkg/path/filepath/#Walk\" rel=\"nofollow noreferrer\">golang.org/pkg/path/filepath/#Walk</a>."}], "answers": [{"comments": [{"owner": {"reputation": 78, "user_id": 15697984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f45828b3cf3a025d311d8f7546fb052?s=128&d=identicon&r=PG", "display_name": "Hannah89", "link": "https://stackoverflow.com/users/15697984/hannah89"}, "edited": false, "score": 0, "creation_date": 1619107585, "post_id": 47266698, "comment_id": 118810775, "body": "You should update the answer to use the more efficient filepath.WalkDir function available in Go 1.16."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 20, "last_activity_date": 1598274883, "last_edit_date": 1598274883, "creation_date": 1510583401, "answer_id": 47266698, "question_id": 47266529, "link": "https://stackoverflow.com/questions/47266529/go-find-files-in-directory-recursively/47266698#47266698", "title": "Go find files in directory recursively", "body": "<p>The standard library's <code>filepath</code> package includes <a href=\"https://golang.org/pkg/path/filepath/#Walk\" rel=\"noreferrer\"><code>Walk</code></a> for exactly this purpose: &quot;Walk walks the file tree rooted at root, calling walkFn for each file or directory in the tree, including root.&quot; For example:</p>\n<pre><code>libRegEx, e := regexp.Compile(&quot;^.+\\\\.(dylib)$&quot;)\nif e != nil {\n    log.Fatal(e)\n}\n\ne = filepath.Walk(&quot;/usr/lib&quot;, func(path string, info os.FileInfo, err error) error {\n    if err == nil &amp;&amp; libRegEx.MatchString(info.Name()) {\n        println(info.Name())\n    }\n    return nil\n})\nif e != nil {\n    log.Fatal(e)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2796, "user_id": 7508302, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bHYHM.jpg?s=128&g=1", "display_name": "Cililing", "link": "https://stackoverflow.com/users/7508302/cililing"}, "edited": false, "score": 0, "creation_date": 1592218050, "post_id": 60624172, "comment_id": 110336315, "body": "This will not work. You will find only files/dirs in <code>dirPath</code>, not all files."}], "tags": [], "owner": {"reputation": 1801, "user_id": 4482269, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/00fe165b96c14b609710b822674239c4?s=128&d=identicon&r=PG&f=1", "display_name": "Wolfack", "link": "https://stackoverflow.com/users/4482269/wolfack"}, "is_accepted": false, "score": -3, "last_activity_date": 1583953343, "last_edit_date": 1583953343, "creation_date": 1583866444, "answer_id": 60624172, "question_id": 47266529, "link": "https://stackoverflow.com/questions/47266529/go-find-files-in-directory-recursively/60624172#60624172", "title": "Go find files in directory recursively", "body": "<p>You can use all the files in the directory using following code:</p>\n\n<pre><code>files, err := ioutil.ReadDir(dirPath)\ncheck(err)\n\nfor _, file := range files {\n    fmt.Println(dirPath + file.Name())\n}\n</code></pre>\n\n<p>The code is using the <code>io/ioutil</code> package to read all the files in the given directory and then looping through them to print there names.</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user13908149"}, "is_accepted": false, "score": 0, "last_activity_date": 1597645979, "last_edit_date": 1597645979, "creation_date": 1597525628, "answer_id": 63430821, "question_id": 47266529, "link": "https://stackoverflow.com/questions/47266529/go-find-files-in-directory-recursively/63430821#63430821", "title": "Go find files in directory recursively", "body": "<p>If you are looking for something that doesn't use walk, I found <a href=\"https://github.com/rootVIII/queryFS\" rel=\"nofollow noreferrer\">this project</a></p>\n<p>The main recursive algorithm seems effective despite using strings. It basically amounts to the below code and kinda reminds me of merge sort and other recursive algorithms:</p>\n<pre><code>func processed(fileName string, processedDirectories []string) bool {\n    for i := 0; i &lt; len(processedDirectories); i++ {\n        if processedDirectories[i] != fileName {\n            continue\n        }\n        return true\n    }\n    return false\n}\n\nfunc listDirContents(path string, dirs []string) {\n    files, _ := ioutil.ReadDir(path)\n\n    for _, f := range files {\n        var newPath string\n        if path != &quot;/&quot; {\n            newPath = fmt.Sprintf(&quot;%s/%s&quot;, path, f.Name())\n        } else {\n            newPath = fmt.Sprintf(&quot;%s%s&quot;, path, f.Name())\n        }\n\n        if f.IsDir() {\n            if !processed(newPath, dirs) {\n                dirs = append(dirs, newPath)\n                listDirContents(newPath, dirs)\n            }\n        } else {\n            fmt.Println(newPath)\n        }\n    }\n}\n</code></pre>\n<p>That actually prints <em>all</em> found paths starting from the provided directory and includes all sub-directories. Therefor you would have to check if the path contains your target string instead of just printing the path with <code>fmt.Println()</code> statements.</p>\n<p>After trying it out vs the <code>find</code> command, it scanned my <code>/home</code> directory in about .8s... the <code>find</code> command found the same files but did it in about .3s (a full .5s faster than the above algorithm).</p>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 2, "last_activity_date": 1619099361, "creation_date": 1619099361, "answer_id": 67214584, "question_id": 47266529, "link": "https://stackoverflow.com/questions/47266529/go-find-files-in-directory-recursively/67214584#67214584", "title": "Go find files in directory recursively", "body": "<p>Starting with Go 1.16, you can use <code>filepath.WalkDir</code>:</p>\n<pre><code>package main\n\nimport (\n   &quot;io/fs&quot;\n   &quot;path/filepath&quot;\n)\n\nfunc walk(s string, d fs.DirEntry, e error) error {\n   if e != nil { return e }\n   if ! d.IsDir() {\n      println(s)\n   }\n   return nil\n}\n\nfunc main() {\n   filepath.WalkDir(&quot;..&quot;, walk)\n}\n</code></pre>\n<p><a href=\"https://golang.org/pkg/path/filepath#WalkDir\" rel=\"nofollow noreferrer\">https://golang.org/pkg/path/filepath#WalkDir</a></p>\n"}], "owner": {"reputation": 2336, "user_id": 2708147, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DPFXd.png?s=128&g=1", "display_name": "Netherwire", "link": "https://stackoverflow.com/users/2708147/netherwire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7033, "favorite_count": 1, "accepted_answer_id": 47266698, "answer_count": 4, "score": 8, "last_activity_date": 1619099361, "creation_date": 1510582981, "question_id": 47266529, "link": "https://stackoverflow.com/questions/47266529/go-find-files-in-directory-recursively", "title": "Go find files in directory recursively", "body": "<p>I want to find all files matching a specific pattern in a directory recursively (including subdirectories). I wrote the code to do this:</p>\n\n<pre><code>libRegEx, e := regexp.Compile(\"^.+\\\\.(dylib)$\")\nif e != nil {\n    log.Fatal(e)\n}\n\nfiles, err := ioutil.ReadDir(\"/usr/lib\")\nif err != nil {\n    log.Fatal(err)\n}\n\nfor _, f := range files {\n    if libRegEx.MatchString(f.Name()) {\n        println(f.Name())\n    }\n}\n</code></pre>\n\n<p>Unfortunately, it only searches in <code>/usr/bin</code>, but I also want to search for matches in its subdirectories. How can I achieve this? Thanks.</p>\n"}, {"tags": ["go", "proxy", "server"], "answers": [{"tags": [], "owner": {"reputation": 333, "user_id": 8922502, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Oyosg_0WtdU/AAAAAAAAAAI/AAAAAAAAAuM/A008xMxw41w/photo.jpg?sz=128", "display_name": "John Smith", "link": "https://stackoverflow.com/users/8922502/john-smith"}, "is_accepted": true, "score": 1, "last_activity_date": 1510593168, "creation_date": 1510593168, "answer_id": 47269875, "question_id": 47263080, "link": "https://stackoverflow.com/questions/47263080/proxy-request-host-is-overwritten-by-the-real-request/47269875#47269875", "title": "Proxy request host is overwritten by the real request", "body": "<p>I should use LocalAddrContextKey but looks like there is a known bug with setting it <a href=\"https://github.com/golang/go/issues/18686\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/18686</a>\nA workaround is to hijack the <code>http.ResponseWriter</code> ex: </p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n)\n\nfunc main() {\n    http.ListenAndServe(\":8080\", http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n\n        hij, ok := w.(http.Hijacker)\n        if !ok {\n            panic(\"http server does not support hijacker\")\n        }\n\n        clientConn, _, err := hij.Hijack()\n        if err != nil {\n            panic(err.Error())\n        }\n\n        println(clientConn.LocalAddr().String())\n\n    }))\n}\n</code></pre>\n"}], "owner": {"reputation": 333, "user_id": 8922502, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Oyosg_0WtdU/AAAAAAAAAAI/AAAAAAAAAuM/A008xMxw41w/photo.jpg?sz=128", "display_name": "John Smith", "link": "https://stackoverflow.com/users/8922502/john-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 47269875, "answer_count": 1, "score": 1, "last_activity_date": 1510597445, "creation_date": 1510571917, "last_edit_date": 1592644375, "question_id": 47263080, "link": "https://stackoverflow.com/questions/47263080/proxy-request-host-is-overwritten-by-the-real-request", "title": "Proxy request host is overwritten by the real request", "body": "<p>I am trying to serve a proxy like this:</p>\n<pre><code>package main\n\nimport (\n    &quot;net/http&quot;\n)\n\nfunc main() {\n    http.ListenAndServe(&quot;:8080&quot;, http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        println(r.Host)\n    }))\n}\n</code></pre>\n<p>and calling it with curl</p>\n<p><code>curl -k -x http://localhost:8080 http://golang.org/</code></p>\n<p>I get <code>golang.org</code> printed out. Why I do not get the proxy hostname <code>localhost</code>? is that a bug or limitation with the http proxy?</p>\n<h1>Update</h1>\n<p>To clarify, what I am looking for is something like Nginx server address <a href=\"http://nginx.org/en/docs/http/ngx_http_core_module.html#var_server_addr\" rel=\"nofollow noreferrer\">http://nginx.org/en/docs/http/ngx_http_core_module.html#var_server_addr</a></p>\n"}, {"tags": ["inheritance", "go"], "comments": [{"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 0, "creation_date": 1510572197, "post_id": 47262783, "comment_id": 81477025, "body": "And then do what? please elaborate"}, {"owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "reply_to_user": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 0, "creation_date": 1510572360, "post_id": 47262783, "comment_id": 81477116, "body": "Well the actual implementation of this is in a web backend. It&#39;s an attempt to have a generic JSON response back to the client with <code>Results</code> as type <code>[]*DataModel</code> where that could be filled with different types of data types, depending on the request."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1510572824, "post_id": 47262783, "comment_id": 81477397, "body": "Go does not have struct inheritance, it does however support struct embedding, which are two very different things. A struct of type <code>Foo</code> that embeds a struct of type <code>Bar</code> cannot be used in places where <code>Bar</code> is expected. All <code>Foo</code> gets from embedding <code>Bar</code> is access to <code>Bar</code>&#39;s fields and methods. So <code>Foo</code> IS NOT <code>Bar</code>, it only &quot;knows about&quot; <code>Bar</code>, while <code>Bar</code> does not even know, or care, about <code>Foo</code> at all."}, {"owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "edited": false, "score": 0, "creation_date": 1510573354, "post_id": 47262783, "comment_id": 81477712, "body": "This cleared up the questions I had surrounding embedding, thank you!"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1510574035, "post_id": 47262783, "comment_id": 81478123, "body": "&quot;What is the correct way to go about doing an abstraction like this?&quot; No, it is not. Go has no notion of inheritance and you should not try to model your code in a inheritance-based style. &quot;Is it possible in Go?&quot; No. You would use interfaces instead of parent classes."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 1, "creation_date": 1510581047, "post_id": 47262783, "comment_id": 81482360, "body": "Just to give you a clue as to how go&#39;s embedding works: it&#39;s composition, not inheritance. You could try and write: <code>tom := &amp;Person{Name: &quot;Tom&quot;, Age: 13, Pet: &amp;dog.Animal}</code>. your <code>dog</code> variable <i>contains</i> a full <code>Animal</code>, but it is <i>not</i> an animal. It&#39;s is own type that consists of its own fields (<code>Colour</code>), and an <code>Animal</code>, whatever that type might be"}], "answers": [{"comments": [{"owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "edited": false, "score": 0, "creation_date": 1510572438, "post_id": 47263226, "comment_id": 81477169, "body": "I was trying to avoid using an empty interface for the reason that you could pass anything into it. For example, the <code>Person</code> could end up with a <code>Bicycle</code> as his <code>Pet</code>."}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "edited": false, "score": 0, "creation_date": 1510572782, "post_id": 47263226, "comment_id": 81477376, "body": "So you may use(1) based on functionality of Object. Is this Good for your case?"}, {"owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "edited": false, "score": 1, "creation_date": 1510573425, "post_id": 47263226, "comment_id": 81477764, "body": "Thank you, your solution helped me find the bug in my code. I was incorrectly setting Pet to <code>*Animal</code> which is a pointer to the interface rather than having it be of the interface type itself. Thanks!"}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 2, "last_activity_date": 1510573220, "last_edit_date": 1510573220, "creation_date": 1510572353, "answer_id": 47263226, "question_id": 47262783, "link": "https://stackoverflow.com/questions/47262783/what-is-the-correct-way-to-implement-struct-abstraction-in-go/47263226#47263226", "title": "What is the correct way to implement Struct abstraction in Go?", "body": "<p>Two working samples:  </p>\n\n<p>1- Try <a href=\"https://play.golang.org/p/hg_4K61NLu\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Animal interface {\n    color() string\n}\ntype Dog struct {\n    Color string\n}\n\nfunc (d Dog) color() string {\n    return d.Color\n}\n\ntype Person struct {\n    Name string\n    Age  int\n    Pet  Animal\n}\n\nfunc main() {\n    dog := &amp;Dog{Color: \"brown\"}\n    tom := &amp;Person{Name: \"Tom\", Age: 13, Pet: dog}\n    fmt.Println(tom.Pet.color())\n}\n</code></pre>\n\n<hr>\n\n<p>2- Try <a href=\"https://play.golang.org/p/zR5opxAkrv\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Animal struct{}\ntype Dog struct {\n    Animal\n    Color string\n}\n\ntype Person struct {\n    Name string\n    Age  int\n    Pet  interface{}\n}\n\nfunc main() {\n    dog := &amp;Dog{Color: \"brown\"}\n    tom := &amp;Person{Name: \"Tom\", Age: 13, Pet: dog}\n    fmt.Println(tom.Name)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 0, "last_activity_date": 1510574416, "creation_date": 1510574416, "answer_id": 47263896, "question_id": 47262783, "link": "https://stackoverflow.com/questions/47262783/what-is-the-correct-way-to-implement-struct-abstraction-in-go/47263896#47263896", "title": "What is the correct way to implement Struct abstraction in Go?", "body": "<p>Just to add to the accepted answer, the use of interfaces or embedding is not really a requirement, at least not in this simple example.</p>\n\n<p>For example, if you have a set of types that have the same structure but do not have any methods, i.e. pure data without behaviour, in such a case you can use a single type to represent the set and an additional \"enum\" to represent the \"kind\".</p>\n\n<p>For example:</p>\n\n<pre><code>type AnimalKind string\n\nconst (\n    AnimalKindDog AnimalKind = \"dog\"\n    AnimalKindCat AnimalKind = \"cat\"\n)\n\ntype Animal struct {\n    Kind  AnimalKind\n    Color string\n}\n\n// ...\n\ndog := &amp;Animal{Kind: AnimalKindDog, Color: \"brown\"}\ntom := &amp;Person{Name: \"Tom\", Age: 13, Pet: dog}\n</code></pre>\n"}], "owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 753, "favorite_count": 0, "accepted_answer_id": 47263226, "answer_count": 2, "score": 0, "last_activity_date": 1510574416, "creation_date": 1510570909, "last_edit_date": 1510572018, "question_id": 47262783, "link": "https://stackoverflow.com/questions/47262783/what-is-the-correct-way-to-implement-struct-abstraction-in-go", "title": "What is the correct way to implement Struct abstraction in Go?", "body": "<p>I'm having some issues understanding Go's struct inheritance. I'm trying to do somewhat of an abstraction for an object type. See the example code below:</p>\n\n<pre><code>package main\n\ntype Animal struct{}\ntype Dog struct {\n    Animal\n    Color string\n}\n\ntype Person struct {\n    Name string\n    Age  int\n    Pet  *Animal\n}\n\nfunc main() {\n    dog := &amp;Dog{Color: \"brown\"}\n    tom := &amp;Person{Name: \"Tom\", Age: 13, Pet: dog}\n}\n</code></pre>\n\n<p>This is causing a compilation error: </p>\n\n<blockquote>\n  <p>cannot use dog (type *Dog) as type *Animal in field value</p>\n</blockquote>\n\n<p>What is the correct way to go about doing an abstraction like this? Is it possible in Go?</p>\n\n<p>End goal for the example would be to have different types of Pets - Dog, Cat, Hamser, etc. Then be able to store that into a struct expecting type Animal.</p>\n\n<p>To visualize, something like:</p>\n\n<pre><code>type Person struct {\n    Name string\n    Age  int\n    Pet  *Dog OR *Cat OR *Hamster\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/KVSzbZxjh1\" rel=\"nofollow noreferrer\">Go Playground Link</a></p>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1510581210, "post_id": 47262088, "comment_id": 81482466, "body": "open a delve session and disassemble, or just <code>[s,d]trace</code> the process. You&#39;ll see that what icza sais in his answer is exactly what is going on: <code>&lt;-forever</code> is a blocking operation. Similarly <code>forever&lt;-true</code> would block, too (because no routine is reading from the channel)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1510583639, "post_id": 47262088, "comment_id": 81484052, "body": "Channels are covered thoroughly in the excellent <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">Go tour</a>."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 14, "last_activity_date": 1592380075, "last_edit_date": 1592380075, "creation_date": 1510568744, "answer_id": 47262117, "question_id": 47262088, "link": "https://stackoverflow.com/questions/47262088/golang-forever-channel/47262117#47262117", "title": "Golang: forever channel", "body": "<p>That code creates an unbuffered channel, and attempts to receive from it.</p>\n\n<p>And since no one ever sends anything on it, it's essentially a blocking forever operation.</p>\n\n<p>The <em>purpose</em> of this is to keep the goroutine from ending / returning, most likely because there are other goroutines which do some work concurrently or they wait for certain events or incoming messages (like your log message says).</p>\n\n<p>And the <em>need</em> for this is that without this, the application might quit without waiting for other goroutines. Namely, if the <code>main</code> goroutine ends, the program ends as well. Quoting from <a href=\"https://golang.org/ref/spec#Program_execution\" rel=\"nofollow noreferrer\">Spec: Program execution:</a></p>\n\n<blockquote>\n  <p>Program execution begins by initializing the main package and then invoking the function main. When that function invocation returns, the program exits. It does not wait for other (non-<code>main</code>) goroutines to complete.</p>\n</blockquote>\n\n<p>Check out this answer for similar and more techniques: <a href=\"https://stackoverflow.com/questions/36419054/go-projects-main-goroutine-sleep-forever/36419222#36419222\">Go project&#39;s main goroutine sleep forever?</a></p>\n\n<p>For an introduction about channels, see <a href=\"https://stackoverflow.com/questions/39826692/what-are-golang-channels-used-for/39826883#39826883\">What are channels used for?</a></p>\n"}, {"tags": [], "owner": {"reputation": 231, "user_id": 10391801, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1dJ83.jpg?s=128&g=1", "display_name": "big_in_japan", "link": "https://stackoverflow.com/users/10391801/big-in-japan"}, "is_accepted": false, "score": 2, "last_activity_date": 1563457860, "creation_date": 1563457860, "answer_id": 57096120, "question_id": 47262088, "link": "https://stackoverflow.com/questions/47262088/golang-forever-channel/57096120#57096120", "title": "Golang: forever channel", "body": "<p>The code in the question is probably coming from the RabbitMQ golang tutorial <a href=\"https://www.rabbitmq.com/tutorials/tutorial-one-go.html\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>Here's a more extended chunk of it with some commends of my own:</p>\n\n<pre><code>    ...\n    // create an unbuffered channel for bool types.\n    // Type is not important but we have to give one anyway.\n    forever := make(chan bool) \n\n    // fire up a goroutine that hooks onto msgs channel and reads\n    // anything that pops into it. This essentially is a thread of\n    // execution within the main thread. msgs is a channel constructed by\n    // previous code.\n    go func() {\n        for d := range msgs {\n            log.Printf(\"Received a message: %s\", d.Body)\n        }\n    }()\n\n    log.Printf(\" [*] Waiting for messages. To exit press CTRL+C\")\n    // We need to block the main thread so that the above thread stays\n    // on reading from msgs channel. To do that just try to read in from\n    // the forever channel. As long as no one writes to it we will wait here.\n    // Since we are the only ones that know of it it is guaranteed that\n    // nothing gets written in it. We could also do a busy wait here but\n    // that would waste CPU cycles for no good reason.\n    &lt;-forever\n</code></pre>\n"}], "owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3687, "favorite_count": 0, "accepted_answer_id": 47262117, "answer_count": 2, "score": 4, "last_activity_date": 1592380075, "creation_date": 1510568644, "last_edit_date": 1510579234, "question_id": 47262088, "link": "https://stackoverflow.com/questions/47262088/golang-forever-channel", "title": "Golang: forever channel", "body": "<p>Just have a question, what is happening here?  </p>\n\n<pre><code>forever := make(chan bool)\n\nlog.Printf(\" [*] Waiting for messages. To exit press CTRL+C\")\n&lt;-forever\n</code></pre>\n"}, {"tags": ["go", "io", "path"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1510584034, "post_id": 47261719, "comment_id": 81484349, "body": "This technically isn&#39;t relative to absolute, it&#39;s tilde expansion. <code>~&#47;sample.sh</code> is an absolute path (what it refers to does not change based on CWD). The tilde is just a shortcut for the user&#39;s (absolute) home directory path."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510584044, "post_id": 47261719, "comment_id": 81484360, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/17609732/expand-tilde-to-home-directory\">Expand tilde to home directory</a>"}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1510583775, "post_id": 47261747, "comment_id": 81484152, "body": "This seems like a red herring - <code>Join</code> doesn&#39;t have anything to do with the question that was asked, nor does <code>Clean</code>.  It&#39;s not until the last 3 paragraphs or that the question is addressed."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510584043, "post_id": 47261747, "comment_id": 81484358, "body": "@Adrian The first version of the question didn&#39;t mention resolving <code>~</code>, just resolving paths. But yes, they are not relevant anymore."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510584071, "post_id": 47261747, "comment_id": 81484377, "body": "Ah, fair enough, didn&#39;t see that it had been edited."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510584160, "post_id": 47261747, "comment_id": 81484447, "body": "@Adrian Edited the answer to make it obvious."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 23, "last_activity_date": 1510584151, "last_edit_date": 1510584151, "creation_date": 1510567679, "answer_id": 47261747, "question_id": 47261719, "link": "https://stackoverflow.com/questions/47261719/how-can-i-resolve-a-relative-path-to-absolute-path-in-golang/47261747#47261747", "title": "How can I resolve a relative path to absolute path in golang?", "body": "<p>Resolving <code>~</code> (denoting the user home) is a different story, and usually it's the shell that resolves this. For details see <a href=\"https://stackoverflow.com/questions/17609732/expand-tilde-to-home-directory\">Expand tilde to home directory</a>.</p>\n\n<p>If you want to do it from Go code, you may use the <a href=\"https://golang.org/pkg/os/user/#Current\" rel=\"noreferrer\"><code>user.Current()</code></a> function to get details about the current user, including its home folder which will be <code>User.HomeDir</code>. But still, you'll have to handle replacing this yourself.</p>\n\n<p>Original answer follows.</p>\n\n<hr>\n\n<p>You may use <a href=\"https://golang.org/pkg/path/#Join\" rel=\"noreferrer\"><code>path.Join()</code></a> or <a href=\"https://golang.org/pkg/path/filepath/#Join\" rel=\"noreferrer\"><code>filepath.Join()</code></a>.</p>\n\n<p>For example:</p>\n\n<pre><code>base := \"/home/bob\"\nfmt.Println(path.Join(base, \"work/go\", \"src/github.com\"))\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>/home/bob/work/go/src/github.com\n</code></pre>\n\n<p>You may use <a href=\"https://golang.org/pkg/path/#Clean\" rel=\"noreferrer\"><code>path.Clean()</code></a> and <a href=\"https://golang.org/pkg/path/filepath/#Clean\" rel=\"noreferrer\"><code>filepath.Clean()</code></a> to \"remove\" dots <code>.</code> and double dots <code>..</code> from  your path.</p>\n\n<p>You may use <a href=\"https://golang.org/pkg/path/filepath/#Abs\" rel=\"noreferrer\"><code>filepath.Abs()</code></a> to resolve relative paths and get an absolute (prepending the working directory if it's not absolute). <code>filepath.Abs()</code> also calls <code>Clean()</code> on the result.</p>\n\n<p>For example:</p>\n\n<pre><code>fmt.Println(filepath.Abs(\"/home/bob/../alice\"))\n</code></pre>\n\n<p>Outputs:</p>\n\n<pre><code>/home/alice &lt;nil&gt;\n</code></pre>\n\n<p>Try the examples on the <a href=\"https://play.golang.org/p/Yu-ilGiJpT\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<p>See related question: <a href=\"https://stackoverflow.com/questions/32620870/resolving-absolute-path-from-relative-path/32623803#32623803\">Resolving absolute path from relative path</a></p>\n"}], "owner": {"reputation": 889, "user_id": 7345054, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/59ef46389ac278ba85e18c3ee641809b?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Cui", "link": "https://stackoverflow.com/users/7345054/andrew-cui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 26791, "favorite_count": 2, "accepted_answer_id": 47261747, "answer_count": 1, "score": 16, "last_activity_date": 1510584151, "creation_date": 1510567602, "last_edit_date": 1510567767, "question_id": 47261719, "link": "https://stackoverflow.com/questions/47261719/how-can-i-resolve-a-relative-path-to-absolute-path-in-golang", "title": "How can I resolve a relative path to absolute path in golang?", "body": "<p>Is there a api like 'path.resolve' in node? Or something can do the same?</p>\n\n<p>For Example (nodejs code):\n<code>path.resolve(\"~/sample.sh\")</code>\nShould got: <code>/home/currentuser/sample.sh</code></p>\n"}, {"tags": ["javascript", "reactjs", "go", "webpack"], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1510569416, "creation_date": 1510569416, "answer_id": 47262316, "question_id": 47261505, "link": "https://stackoverflow.com/questions/47261505/bundled-file-is-not-found/47262316#47262316", "title": "Bundled file is not found", "body": "<p>The <code>echo</code> server you've set up only serves one single path, the root path (<code>\"/\"</code>), by rendering the contents of the <code>index.html</code> file. Because you haven't set up any other handlers for that server, any request to a path other than the root will result in 404, including those requests made from the index page via script and link tags, e.g.; <code>&lt;script src=\"./build/app.bundle.js\"&gt;&lt;/script&gt;</code>.</p>\n\n<p>To be able to serve a request to a path like <code>\"/static/build/app.bundle.js\"</code> for example you need to tell the server how to do that by registering a new handler.</p>\n\n<p>With the <code>echo</code> server you can use its <a href=\"https://godoc.org/github.com/labstack/echo#Echo.Static\" rel=\"nofollow noreferrer\">Static</a> method to do that.</p>\n\n<pre><code>e.Static(\"/static\", \"static\")\n</code></pre>\n\n<p>Please keep in mind that the links you use in html tags, the location of the corresponding files on your machine, and the location from where you launched your app matters if you use relative paths like <code>./build/app.bundle.js</code>, and because of that the two arguments to <code>e.Static</code> may need to be somewhat different from the example here.</p>\n\n<p>Here's a bit more <a href=\"https://echo.labstack.com/guide/static-files\" rel=\"nofollow noreferrer\">info</a>.</p>\n"}], "owner": {"reputation": 493, "user_id": 8234642, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh3.googleusercontent.com/-vf_HkR3DFnI/AAAAAAAAAAI/AAAAAAAAAF4/1k3QCnQMEeI/photo.jpg?sz=128", "display_name": "Nic Bonetto", "link": "https://stackoverflow.com/users/8234642/nic-bonetto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 47262316, "answer_count": 1, "score": 0, "last_activity_date": 1510569416, "creation_date": 1510566943, "last_edit_date": 1510567270, "question_id": 47261505, "link": "https://stackoverflow.com/questions/47261505/bundled-file-is-not-found", "title": "Bundled file is not found", "body": "<p>I am using Golang (Echo) for my backend and React for my frontend. When I bundle my code using webpack, the file is created; however, I am getting an error in my console when I go to localhost:3000 stating the bundle file cannot be found. This is the exact error message: GET <a href=\"http://localhost:3000/build/app.bundle.js\" rel=\"nofollow noreferrer\">http://localhost:3000/build/app.bundle.js</a> net::ERR_ABORTED.</p>\n\n<p>Here is my server: </p>\n\n<pre><code>func main() {\n    env.SetEnvVars()\n\n    e := echo.New()\n    e.File(\"/\", \"server/static/index.html\")\n\n    e.Logger.Fatal(e.Start(os.Getenv(\"PORT\")))\n}\n</code></pre>\n\n<p>Here is my webpack.config.js file:</p>\n\n<pre><code>module.exports = {\n  entry: './client/main.jsx',\n  output: {\n    path: path.resolve(__dirname, 'server/static/build'),\n    filename: 'app.bundle.js'\n  },\n  ...\n</code></pre>\n\n<p>And the script tag in my index.html file is:</p>\n\n<pre><code>&lt;script src=\"./build/app.bundle.js\"&gt;&lt;/script&gt;\n</code></pre>\n\n<p>The directory path regarding these files is currently:</p>\n\n<pre><code>/\n  server/\n    main.go\n    static/\n      index.html\n      build/\n        app.bundle.js\n</code></pre>\n\n<p>Any help would be appreciated!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1510553293, "post_id": 47257954, "comment_id": 81466677, "body": "Your application quits bofore you have chance to get any output. After the <code>go func() { ... })()</code> statement completes - nothing prevents the program from exiting."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1510553426, "post_id": 47257954, "comment_id": 81466726, "body": "I am not sure what you are trying to accomplish, but I offer this: <a href=\"https://play.golang.org/p/GGx5HGOtBL\" rel=\"nofollow noreferrer\">play.golang.org/p/GGx5HGOtBL</a>"}, {"owner": {"reputation": 21, "user_id": 8647441, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/f3f09847041e6356526709fe71ce1780?s=128&d=identicon&r=PG&f=1", "display_name": "Kid Liou", "link": "https://stackoverflow.com/users/8647441/kid-liou"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1510555683, "post_id": 47257954, "comment_id": 81467628, "body": "Thanks for @CeriseLim&#243;n playground supporting, but is that mean I need to close the channel first then I could read values from it in another go routines?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1510558978, "post_id": 47257954, "comment_id": 81469076, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/28958192/whats-wrong-with-this-golang-code/28958240#28958240\">What&#39;s wrong with this golang code?</a>"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1510581906, "post_id": 47257954, "comment_id": 81482925, "body": "<code>wg.Add(size)</code> &lt;- you&#39;re adding 10 to the waitgroup, but spawning only 1 routine that calls <code>wg.Done</code>. However, <code>main</code> returns before the routines are even finished. Try <code>go build -race</code> to see if race detector picks up on some things you missed, and use <code>delve</code> to step through everything"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510584241, "post_id": 47257954, "comment_id": 81484514, "body": "If you&#39;re going to force them to run synchronously, why use goroutines at all? Why not just use regular function calls?"}], "answers": [{"tags": [], "owner": {"reputation": 901, "user_id": 3615752, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/95f412691055035fad3a563e8b162dc4?s=128&d=identicon&r=PG&f=1", "display_name": "kamal", "link": "https://stackoverflow.com/users/3615752/kamal"}, "is_accepted": false, "score": 0, "last_activity_date": 1510553653, "creation_date": 1510553653, "answer_id": 47258111, "question_id": 47257954, "link": "https://stackoverflow.com/questions/47257954/finite-loop-in-go-routine/47258111#47258111", "title": "Finite loop in Go routine", "body": "<p>You have put goroutine in <code>main</code> and <code>main</code> function finishes before your go routine finishes. So either do not use goroutine in <code>main</code> or use some kind of boolean receiving channel at the end of <code>main</code> which gets <code>true</code> when goroutine completed.</p>\n"}, {"tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": false, "score": 5, "last_activity_date": 1510561724, "last_edit_date": 1510561724, "creation_date": 1510558202, "answer_id": 47259097, "question_id": 47257954, "link": "https://stackoverflow.com/questions/47257954/finite-loop-in-go-routine/47259097#47259097", "title": "Finite loop in Go routine", "body": "<p>No, don't use  infinite loop.\n<strong>Synchronization is better done with channels or the facilities of the sync package.</strong>  The <code>main()</code> is a <strong>goroutine</strong> too (main one), so if <code>main</code> exits before other goroutines, your task remains unfinished. \nOne way is to use <code>sync.WaitGroup</code> to wait for other goroutines to finish (see examples 1,2 and 3). Another way is using channels to wait for other goroutines to finish (see examples 4 and 5). I provide some examples so you may choose which one fits to your case:</p>\n\n<hr>\n\n<p>1- One tx and multi rx (leave channel open), Try <a href=\"https://play.golang.org/p/UtrP7SrgfI\" rel=\"noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    go tx()\n    wg.Add(20)\n    for i := 1; i &lt;= 20; i++ {\n        go rx()\n    }\n    wg.Wait()\n}\n\nfunc tx() {\n    for i := 1; i &lt;= 20; i++ {\n        vChan &lt;- i\n    }\n}\n\nfunc rx() {\n    defer wg.Done()\n    fmt.Println(&lt;-vChan)\n}\n\nvar wg sync.WaitGroup\n\nvar vChan = make(chan int, 10)\n</code></pre>\n\n<hr>\n\n<p>2- One tx and one rx (leave channel open), Try <a href=\"https://play.golang.org/p/UxgGJcHHcX\" rel=\"noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    go tx()\n    wg.Add(1)\n    go rx()\n    wg.Wait()\n}\n\nfunc tx() {\n    for i := 1; i &lt;= 20; i++ {\n        vChan &lt;- i\n    }\n}\n\nfunc rx() {\n    defer wg.Done()\n    for i := 1; i &lt;= 20; i++ {\n        fmt.Println(&lt;-vChan)\n    }\n}\n\nvar wg sync.WaitGroup\n\nvar vChan = make(chan int, 10)\n</code></pre>\n\n<hr>\n\n<p>3- Closing channel to signal end of tx, Try <a href=\"https://play.golang.org/p/r_O1KUhfib\" rel=\"noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    go tx()\n    wg.Add(1)\n    go rx()\n    wg.Wait()\n}\n\nfunc tx() {\n    for i := 1; i &lt;= 5; i++ {\n        vChan &lt;- i\n    }\n    close(vChan)\n}\n\nfunc rx() {\n    defer wg.Done()\n    for v := range vChan {\n        fmt.Println(v)\n    }\n}\n\nvar wg sync.WaitGroup\n\nvar vChan = make(chan int, 10)\n</code></pre>\n\n<hr>\n\n<p>4- Closing channel to signal end of tx, using main goroutine for rx, try <a href=\"https://play.golang.org/p/C1kOW3jm2k\" rel=\"noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    go tx()\n    for v := range vChan {\n        fmt.Println(v)\n    }\n}\n\nfunc tx() {\n    for i := 1; i &lt;= 20; i++ {\n        vChan &lt;- i\n    }\n    close(vChan)\n}\n\nvar vChan = make(chan int, 10)\n</code></pre>\n\n<hr>\n\n<p>5- Using quit channel, try <a href=\"https://play.golang.org/p/q-nPwlc3RI\" rel=\"noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    go tx()\n    go rx()\n    &lt;-quit\n}\nfunc rx() {\n    for v := range vChan {\n        fmt.Println(v)\n    }\n    quit &lt;- struct{}{}\n}\nfunc tx() {\n    for i := 10; i &lt;= 15; i++ {\n        vChan &lt;- i\n    }\n    close(vChan)\n}\n\nvar quit = make(chan struct{}, 1)\nvar vChan = make(chan int, 10)\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>10\n11\n12\n13\n14\n15\n</code></pre>\n\n<hr>\n\n<p>6- Multi tx multi rx, try <a href=\"https://play.golang.org/p/aITJ9tSNgg\" rel=\"noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    wg.Add(5)\n    for i := 1; i &lt;= 5; i++ {\n        go tx()\n        go rx()\n    }\n    wg.Wait()\n}\n\nvar n = 10\n\nfunc tx() {\n    vChan &lt;- n\n    n++\n}\n\nfunc rx() {\n    defer wg.Done()\n    fmt.Println(&lt;-vChan)\n}\n\nvar wg sync.WaitGroup\n\nvar vChan = make(chan int, 10)\n</code></pre>\n\n<hr>\n\n<p>7- Multi tx and one rx, try <a href=\"https://play.golang.org/p/iT4-oklHLW\" rel=\"noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    for i := 1; i &lt;= 5; i++ {\n        wg.Add(1)\n        go tx()\n    }\n\n    go rx()\n    wg.Wait()\n}\n\nfunc rx() {\n    for {\n        fmt.Println(&lt;-vChan)\n        wg.Done()\n    }\n}\n\nvar n = 20\n\nfunc tx() {\n    vChan &lt;- n\n    n++\n}\n\nvar wg sync.WaitGroup\n\nvar vChan = make(chan int, 10)\n</code></pre>\n\n<hr>\n\n<p>I hope this helps.</p>\n"}], "owner": {"reputation": 21, "user_id": 8647441, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/f3f09847041e6356526709fe71ce1780?s=128&d=identicon&r=PG&f=1", "display_name": "Kid Liou", "link": "https://stackoverflow.com/users/8647441/kid-liou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 271, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1510561724, "creation_date": 1510552797, "question_id": 47257954, "link": "https://stackoverflow.com/questions/47257954/finite-loop-in-go-routine", "title": "Finite loop in Go routine", "body": "<p>I am trying to execute two or more go routine synchronously after finish the topic</p>\n\n<p><a href=\"https://stackoverflow.com/questions/39818254/goroutines-order-of-execution\">goroutines order of execution</a></p>\n\n<p>And I write some code to test the go routines' behaviour\n(I treat it like a queue, BTW the go concurrency tutorial page not really help me)</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"sync\"\n)\n\nconst size = 10\nvar vChan chan int = make(chan int, size)\n\nfunc justSend(wg *sync.WaitGroup) {\n        defer wg.Done()\n        for i := 1; i &lt;= 10; i++ {\n                vChan &lt;- i\n        }\n}\n\nfunc justPrint(wg *sync.WaitGroup) {\n        defer wg.Done()\n        v := &lt;- vChan\n        fmt.Printf(\"%4d \", v);\n}\n\nfunc main() {\n        wg := new(sync.WaitGroup)\n\n        go func() {\n                wg.Add(1)\n                go justSend(wg)\n                wg.Wait()\n                wg.Add(size)\n                go justPrint(wg)\n                wg.Wait()\n                close(vChan)\n        }()\n}\n</code></pre>\n\n<p>But it print nothing, should we design a go routine always have a infinite loop in there or we can't get it work properly?</p>\n\n<p>(The piece of code is prepared for my real problem on building multiple websocket connection and testing our API server's response, so...I think passing bunch of channel which has same type between different function is quite annoying, so I set it globally)</p>\n"}, {"tags": ["go", "serialization", "persistence", "b-tree"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510584357, "post_id": 47257471, "comment_id": 81484587, "body": "You might find Go easier to learn if you read some Go code that does something similar to what you&#39;re attempting, as opposed to looking at Java and trying to replicate its behavior in Go."}, {"owner": {"reputation": 2981, "user_id": 6206947, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ef3bb38797a3bd7c6e2b92797e9b80dc?s=128&d=identicon&r=PG", "display_name": "nicovank", "link": "https://stackoverflow.com/users/6206947/nicovank"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510587269, "post_id": 47257471, "comment_id": 81486573, "body": "Well that was my question, what would be the way to do so in Go. icza provided a very complete answer!"}], "answers": [{"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 1, "last_activity_date": 1510551090, "last_edit_date": 1510551090, "creation_date": 1510550629, "answer_id": 47257550, "question_id": 47257471, "link": "https://stackoverflow.com/questions/47257471/built-in-libraries-to-persist-a-btree-equivalent-to-javas-filechannel-and-b/47257550#47257550", "title": "Built-in libraries to persist a BTree, equivalent to Java&#39;s `FileChannel` and `ByteBuffer`", "body": "<p>Note that <code>bytes.Buffer</code> implements the <code>io.Writer</code> interface. As a result, you can use <a href=\"https://golang.org/pkg/fmt/#Fprintf\" rel=\"nofollow noreferrer\"><code>fmt.Fprintf</code></a>:</p>\n\n<pre><code>func Fprintf(w io.Writer, format string, a ...interface{}) (n int, err error)\n</code></pre>\n\n<p><code>format</code> string parameter can be used to write ints and doubles directly into the buffer. See <a href=\"https://golang.org/pkg/fmt/#hdr-Printing\" rel=\"nofollow noreferrer\">here</a> for details.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1510564050, "last_edit_date": 1510564050, "creation_date": 1510561202, "answer_id": 47259769, "question_id": 47257471, "link": "https://stackoverflow.com/questions/47257471/built-in-libraries-to-persist-a-btree-equivalent-to-javas-filechannel-and-b/47259769#47259769", "title": "Built-in libraries to persist a BTree, equivalent to Java&#39;s `FileChannel` and `ByteBuffer`", "body": "<h2>Using the <code>encoding/gob</code> package</h2>\n\n<p>Using the <a href=\"https://golang.org/pkg/encoding/gob/\" rel=\"nofollow noreferrer\"><code>encoding/gob</code></a> package you can serialize entire trees into a series of bytes and deserialize them with a single method call.</p>\n\n<p>See this example:</p>\n\n<pre><code>type Node struct {\n    Data     int\n    Children []*Node\n}\n\nfunc (n *Node) String() string {\n    buf := &amp;bytes.Buffer{}\n    buf.WriteString(fmt.Sprintf(\"Node[Data: %d, Children: [\", n.Data))\n    for i, v := range n.Children {\n        if i &gt; 0 {\n            buf.WriteString(\", \")\n        }\n        buf.WriteString(v.String())\n    }\n    buf.WriteString(\"]\")\n    return buf.String()\n}\n</code></pre>\n\n<p>The <code>Node.String()</code> method is not required, I only created it to easily print / verify the tree.</p>\n\n<p>Now using <code>gob</code> to serialize and deserialize a tree:</p>\n\n<pre><code>root := &amp;Node{\n    Data: 1,\n    Children: []*Node{\n        {Data: 2},\n        {Data: 3},\n    },\n}\nfmt.Println(root)\n\nbuf := &amp;bytes.Buffer{}\nif err := gob.NewEncoder(buf).Encode(root); err != nil {\n    panic(err)\n}\n\nvar root2 *Node\nif err := gob.NewDecoder(buf).Decode(&amp;root2); err != nil {\n    panic(err)\n}\nfmt.Println(root2)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/tXL2X5E27d\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Node[Data: 1, Children: [Node[Data: 2, Children: [], Node[Data: 3, Children: []]\nNode[Data: 1, Children: [Node[Data: 2, Children: [], Node[Data: 3, Children: []]\n</code></pre>\n\n<p>Here I used an in-memory buffer (<a href=\"https://golang.org/pkg/bytes/#Buffer\" rel=\"nofollow noreferrer\"><code>bytes.Buffer</code></a>), but if you want to save to / load from a file, you don't even need an in-memory buffer, you can directly pass an <a href=\"https://golang.org/pkg/os/#File\" rel=\"nofollow noreferrer\"><code>*os.File</code></a> value to <a href=\"https://golang.org/pkg/encoding/gob/#NewEncoder\" rel=\"nofollow noreferrer\"><code>gob.NewEncoder()</code></a> and <a href=\"https://golang.org/pkg/encoding/gob/#NewDecoder\" rel=\"nofollow noreferrer\"><code>gob.NewDecoder()</code></a> (as <code>*os.File</code> implements both <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\"><code>io.Reader</code></a> and <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"nofollow noreferrer\"><code>io.Writer</code></a>).</p>\n\n<h2>Manual serialization / deserialization</h2>\n\n<p>Also note that if you don't want to (or can't) use <code>encoding/gob</code> to do the complete serialization in one step, you can also use <a href=\"https://golang.org/pkg/encoding/binary/#Write\" rel=\"nofollow noreferrer\"><code>binary.Write()</code></a> and <a href=\"https://golang.org/pkg/encoding/binary/#Read\" rel=\"nofollow noreferrer\"><code>binary.Read()</code></a> functions to directly write to / read from your file without using any in-memory buffers.</p>\n\n<p>See this example encoding and decoding an <code>int32</code> and a <code>float64</code> value:</p>\n\n<pre><code>var i int32\nvar f float64\n\ni, f = 1, 3.14\n\nbuf := &amp;bytes.Buffer{}\nif err := binary.Write(buf, binary.LittleEndian, i); err != nil {\n    panic(err)\n}\nif err := binary.Write(buf, binary.LittleEndian, f); err != nil {\n    panic(err)\n}\n\nvar i2 int32\nvar f2 float64\nif err := binary.Read(buf, binary.LittleEndian, &amp;i2); err != nil {\n    panic(err)\n}\nif err := binary.Read(buf, binary.LittleEndian, &amp;f2); err != nil {\n    panic(err)\n}\n\nfmt.Println(i2, f2)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/YcDHhZQicV\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>1 3.14\n</code></pre>\n\n<p>Again, you can pass your file directly to <code>binary.Read()</code> and <code>binary.Write()</code> instead of <code>*bytes.Buffer</code>.</p>\n\n<h2>Non-binary serialization</h2>\n\n<p>You could also use other, non-binary serialization formats such as JSON.\n The <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\"><code>encoding/json</code></a> package will also be able to serialize / deserialize your entire tree with a single call. Using JSON would be less performant in terms of storage and speed though, but the serialized format would be more human-friendly (more readable / editable), and compatible with other applications / technologies. </p>\n"}], "owner": {"reputation": 2981, "user_id": 6206947, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ef3bb38797a3bd7c6e2b92797e9b80dc?s=128&d=identicon&r=PG", "display_name": "nicovank", "link": "https://stackoverflow.com/users/6206947/nicovank"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 309, "favorite_count": 0, "accepted_answer_id": 47259769, "answer_count": 2, "score": 0, "last_activity_date": 1510564050, "creation_date": 1510550063, "question_id": 47257471, "link": "https://stackoverflow.com/questions/47257471/built-in-libraries-to-persist-a-btree-equivalent-to-javas-filechannel-and-b", "title": "Built-in libraries to persist a BTree, equivalent to Java&#39;s `FileChannel` and `ByteBuffer`", "body": "<p>So, I wrote this persistent BTree in Java, following the CLRS algorithms.\nI used <code>FileChannel</code> and <code>ByteBuffer</code> to store the tree in a file, reading and writing the nodes when needed.</p>\n\n<p>I tried looking how I could store such a BTree in Go, and discovered <code>os.File</code>, which I think could be used the same way as Java's <code>FileChannel</code>.\nHowever, I could not find an equivalent for <code>ByteBuffer</code>. I looked at <code>bytes.Buffer</code>, and I see how this could work, however it does not have the <code>ByteBuffer</code>'s handy <code>putInt</code>, <code>putDouble</code>, etc...</p>\n\n<p>Would I have to implement myself those function to transform ints and doubles to byte arrays? I also looked at <code>encoding.binary</code>, but this looks very cumbersome. I understand that I would have to encode my variables to a byte array every time, then copy that byte array to the buffer.</p>\n\n<p>What structures would be recommended in this case?</p>\n"}, {"tags": ["go", "io", "null", "reader"], "answers": [{"tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 6, "last_activity_date": 1510544483, "creation_date": 1510544483, "answer_id": 47256763, "question_id": 47256520, "link": "https://stackoverflow.com/questions/47256520/ioutil-readall-fails-miserably/47256763#47256763", "title": "ioutil.ReadAll fails miserably", "body": "<p><code>io.ReadWriter</code> is an interface, what you need is an instance of <code>io.ReadWriter</code> to write into (via io.Copy) and return the <code>io.Reader</code> interface off of that.</p>\n\n<p>One type that comes to mind is a <code>bytes.Buffer</code>.  Your code would look like this</p>\n\n<pre><code>func getString(link, path string) (io.Reader, error) {\n\n    dick := bytes.NewBuffer(nil)\n\n    if link != \"\" {\n        resp, err := http.Get(link)\n        if err != nil {\n            return nil, err\n        }\n\n        io.Copy(dick, resp.Body)\n    }\n\n    if path != \"\" {\n        file, err := os.Open(path)\n        if err != nil {\n            return nil, err\n        }\n\n        io.Copy(dick, file)\n    }\n\n    return dick, nil\n\n}\n</code></pre>\n\n<p>You are also swallowing the error from <code>io.Copy</code> which isn't a great idea.</p>\n"}, {"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 3, "last_activity_date": 1510544532, "creation_date": 1510544532, "answer_id": 47256769, "question_id": 47256520, "link": "https://stackoverflow.com/questions/47256520/ioutil-readall-fails-miserably/47256769#47256769", "title": "ioutil.ReadAll fails miserably", "body": "<p>Simply declaring a variable (<code>dick</code>) as an interface type (<code>io.ReadWriter</code>) does not create a concrete type that will handle the interface method implementations.</p>\n\n<p><code>dick</code> still needs access to a type that actually implements the <code>Read</code> and <code>Write</code> methods. See <a href=\"https://golang.org/doc/effective_go.html#interfaces_and_types\" rel=\"nofollow noreferrer\">here</a> for more details about how interfaces work.</p>\n\n<p>As for the error above, you can use a <a href=\"https://golang.org/pkg/bytes/#Buffer\" rel=\"nofollow noreferrer\"><code>bytes.Buffer</code></a>. This type already satisfies the <code>io.ReadWriter</code> interface.</p>\n\n<pre><code>func getString(link, path string) (io.Reader, error) {\n    var dick bytes.Buffer // bytes.Buffer is an io.ReadWriter.\n    if link != \"\" {\n        resp, err := http.Get(link)\n        // ...\n        io.Copy(dick, resp.Body)\n    }\n    // ...\n    return dick, nil\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1510584656, "creation_date": 1510584656, "answer_id": 47267111, "question_id": 47256520, "link": "https://stackoverflow.com/questions/47256520/ioutil-readall-fails-miserably/47267111#47267111", "title": "ioutil.ReadAll fails miserably", "body": "<p>If you just want a <code>Reader</code> back from the function, it's much simpler than the other answers make it out to be. The <code>io.Copy</code>, buffer, etc is completely unnecessary:</p>\n\n<pre><code>func getString(link, path string) (io.Reader, error) {\n    if link != \"\" {\n        resp, err := http.Get(link)\n        if err != nil {\n            return nil, err\n        }\n        return resp.Body, err // http.Response.Body implements io.Reader\n    }\n\n    if path != \"\" {\n        return os.Open(path) // os.File implements io.Reader\n    }\n\n    return nil, errors.New(\"No path or link given\")\n}\n</code></pre>\n\n<p>You might want to return an <code>io.ReadCloser</code> so that the caller knows it needs to, and will be able to, close it once it finishes reading from it. Both <code>Body</code> and <code>File</code> implement <code>ReadCloser</code> so the only change needed would be the function's return signature.</p>\n"}], "owner": {"reputation": 59, "user_id": 8812355, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-riMUSBnAj7Y/AAAAAAAAAAI/AAAAAAAAF3A/Ul1bq_YesNI/photo.jpg?sz=128", "display_name": "Codrut Erdei", "link": "https://stackoverflow.com/users/8812355/codrut-erdei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1508, "favorite_count": 0, "accepted_answer_id": 47256763, "answer_count": 3, "score": 1, "last_activity_date": 1510584656, "creation_date": 1510542237, "question_id": 47256520, "link": "https://stackoverflow.com/questions/47256520/ioutil-readall-fails-miserably", "title": "ioutil.ReadAll fails miserably", "body": "<p>I'm trying to get an io.Reader back from this weather it's a link or a path I'm given. For some context I'm using flags</p>\n\n<pre><code>func getString(link, path string) (io.Reader, error) {\n\n    var dick io.ReadWriter\n\n    if link != \"\" {\n        resp, err := http.Get(link)\n        if err != nil {\n            return nil, err\n        }\n\n        io.Copy(dick, resp.Body)\n    }\n\n    if path != \"\" {\n        file, err := os.Open(path)\n        if err != nil {\n            return nil, err\n        }\n\n        io.Copy(dick, file)\n    }\n\n    return dick, nil\n\n}\n</code></pre>\n\n<p>and boom</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x20 pc=0x46e949]\n</code></pre>\n\n<p>this bad boy comes along</p>\n"}, {"tags": ["go", "exec"], "comments": [{"owner": {"reputation": 774, "user_id": 3291674, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3hKJP.png?s=128&g=1", "display_name": "Ethan Yang", "link": "https://stackoverflow.com/users/3291674/ethan-yang"}, "edited": false, "score": 1, "creation_date": 1510542872, "post_id": 47256497, "comment_id": 81464055, "body": "Clearly indicate the file name with path and its content, the command you put and the output of you command, so that people can identify the issue more easily."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510566303, "post_id": 47256497, "comment_id": 81473316, "body": "Two major bugs: You are executing a shell script (redirections with <code>&gt;</code> are executed by the shell). Each argument must be it&#39;s own string."}], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1510551544, "creation_date": 1510551544, "answer_id": 47257715, "question_id": 47256497, "link": "https://stackoverflow.com/questions/47256497/why-i-run-python-script-from-golang-wrong/47257715#47257715", "title": "Why I run python script from golang wrong", "body": "<p>Where\u2019s file <code>hi.py</code> located? Try to split it by arguments, it seems to try filename <code>/root/hi.py &gt; /root/1.log</code></p>\n"}], "owner": {"reputation": 1, "user_id": 8930316, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EVwCUGs5O-k/AAAAAAAAAAI/AAAAAAAAABQ/n8oDnWpmauQ/photo.jpg?sz=128", "display_name": "Qing Qin", "link": "https://stackoverflow.com/users/8930316/qing-qin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 389, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1510551544, "creation_date": 1510541993, "last_edit_date": 1510542250, "question_id": 47256497, "link": "https://stackoverflow.com/questions/47256497/why-i-run-python-script-from-golang-wrong", "title": "Why I run python script from golang wrong", "body": "<pre><code>import (\n    \"fmt\"\n    \"os/exec\"\n    \"bytes\"\n)\n\nfunc main() {\n    cmd :=\"/root/hi.py &gt; /root/1.log\"\n\n    out,err:= exec.Command(\"python\",\"-c\",cmd).Output()\n    fmt.Printf(\"Out: %s \", string(out))\n    fmt.Printf(\"Err: %s \", err.Error())\n\n}\n</code></pre>\n\n<p>Error: <strong>no such file error: /root/hi.py > /root/1.log</strong></p>\n\n<pre><code>//hi.py \n\n#! /usr/bin/python\n\nprint('hello world')\n</code></pre>\n"}, {"tags": ["windows", "go", "size", "screen"], "answers": [{"comments": [{"owner": {"reputation": 169, "user_id": 7382052, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0e814c0cdb5b699dbb11e3291e0e46af?s=128&d=identicon&r=PG&f=1", "display_name": "alphayan", "link": "https://stackoverflow.com/users/7382052/alphayan"}, "edited": false, "score": 0, "creation_date": 1510543723, "post_id": 47256475, "comment_id": 81464245, "body": "wonderful~! this is a good way~! I try this command,there return nothing"}, {"owner": {"reputation": 78, "user_id": 8560592, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-qDkh8xXJ3SA/AAAAAAAAAAI/AAAAAAAAABc/7TINy6lMntQ/photo.jpg?sz=128", "display_name": "Ethan", "link": "https://stackoverflow.com/users/8560592/ethan"}, "reply_to_user": {"reputation": 169, "user_id": 7382052, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0e814c0cdb5b699dbb11e3291e0e46af?s=128&d=identicon&r=PG&f=1", "display_name": "alphayan", "link": "https://stackoverflow.com/users/7382052/alphayan"}, "edited": false, "score": 0, "creation_date": 1510550761, "post_id": 47256475, "comment_id": 81465903, "body": "What does it return? Simply nothing?"}, {"owner": {"reputation": 78, "user_id": 8560592, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-qDkh8xXJ3SA/AAAAAAAAAAI/AAAAAAAAABc/7TINy6lMntQ/photo.jpg?sz=128", "display_name": "Ethan", "link": "https://stackoverflow.com/users/8560592/ethan"}, "reply_to_user": {"reputation": 169, "user_id": 7382052, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0e814c0cdb5b699dbb11e3291e0e46af?s=128&d=identicon&r=PG&f=1", "display_name": "alphayan", "link": "https://stackoverflow.com/users/7382052/alphayan"}, "edited": false, "score": 0, "creation_date": 1510587494, "post_id": 47256475, "comment_id": 81486734, "body": "Are you using a laptop or a monitor?"}, {"owner": {"reputation": 169, "user_id": 7382052, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0e814c0cdb5b699dbb11e3291e0e46af?s=128&d=identicon&r=PG&f=1", "display_name": "alphayan", "link": "https://stackoverflow.com/users/7382052/alphayan"}, "edited": false, "score": 0, "creation_date": 1510631609, "post_id": 47256475, "comment_id": 81505728, "body": "It&#39;s a monitor."}], "tags": [], "owner": {"reputation": 78, "user_id": 8560592, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-qDkh8xXJ3SA/AAAAAAAAAAI/AAAAAAAAABc/7TINy6lMntQ/photo.jpg?sz=128", "display_name": "Ethan", "link": "https://stackoverflow.com/users/8560592/ethan"}, "is_accepted": false, "score": 1, "last_activity_date": 1510541852, "creation_date": 1510541852, "answer_id": 47256475, "question_id": 47256354, "link": "https://stackoverflow.com/questions/47256354/windows-how-to-get-screen-resolution-in-golang/47256475#47256475", "title": "windows-how to get screen resolution in golang", "body": "<p>I did some digging for you and found a way to get your screens width and height via command line in windows:</p>\n\n<pre><code>wmic desktopmonitor get screenheight, screenwidth\n</code></pre>\n\n<p>So all you have to do is execute this command in a Go program and print the output!</p>\n\n<pre><code>package main\n\nimport (\n  \"os/exec\"\n  \"fmt\"\n  \"log\"\n  \"os\"\n)\n\nfunc main() {\n  command:= \"wmic\"\n  args := []string{\"desktopmonitor\", \"get\", \"screenheight,\", \"screenwidth\"}\n  cmd := exec.Command(command, args...)\n  cmd.Stdin = os.Stdin\n  out, err := cmd.Output()\n  fmt.Printf(\"out: %#v\\n\", string(out))\n  fmt.Printf(\"err: %#v\\n\", err)\n  if err != nil {\n    log.Fatal(err)\n  }\n}\n</code></pre>\n\n<p>Here is the Go Playground link : <a href=\"https://play.golang.org/p/KdIhrd3H1x\" rel=\"nofollow noreferrer\">https://play.golang.org/p/KdIhrd3H1x</a></p>\n"}, {"tags": [], "owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "is_accepted": false, "score": 2, "last_activity_date": 1510586946, "last_edit_date": 1510586946, "creation_date": 1510586502, "answer_id": 47267717, "question_id": 47256354, "link": "https://stackoverflow.com/questions/47256354/windows-how-to-get-screen-resolution-in-golang/47267717#47267717", "title": "windows-how to get screen resolution in golang", "body": "<p>We can get screen resolution through <code>powershell</code>, and its are arguments are its scripts.\nso, I have included script in <code>args</code> variable.</p>\n\n<p>Output is not straight forward, you will get someother extra information, try using <code>bytes</code> package or <code>strings</code> package to scan required information.</p>\n\n<p>Following <code>powershell</code> command is retrived from <a href=\"https://stackoverflow.com/questions/7967699/get-screen-resolution-using-wmi-powershell-in-windows-7\">here</a>:</p>\n\n<p><code>Add-Type -AssemblyName System.Windows.Forms;[System.Windows.Forms.Screen]::AllScreens</code></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os/exec\"\n)\n\nfunc main() {\n    args := \"Add-Type -AssemblyName System.Windows.Forms;[System.Windows.Forms.Screen]::AllScreens\"\n    out, err := exec.Command(\"powershell\", args).Output()\n    if err != nil {\n        log.Fatalln(err)\n    }\n    fmt.Print(string(out))\n}\n</code></pre>\n\n<p>I have checked it in Windows 7 Virtual box, its working.\nYou can run this from <code>Command Prompt</code> or <code>powershell</code>, as this calls <code>powershell</code> any how.</p>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 8103952, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-aQgymB-S3kg/AAAAAAAAAAI/AAAAAAAAAFI/D1VVzT-wfJs/photo.jpg?sz=128", "display_name": "Marco Dennst&#228;dt", "link": "https://stackoverflow.com/users/8103952/marco-dennst%c3%a4dt"}, "is_accepted": false, "score": 1, "last_activity_date": 1515588058, "creation_date": 1515588058, "answer_id": 48187712, "question_id": 47256354, "link": "https://stackoverflow.com/questions/47256354/windows-how-to-get-screen-resolution-in-golang/48187712#48187712", "title": "windows-how to get screen resolution in golang", "body": "<p>I was encountering the same problem and doing it via exec.Command is not an option for me. </p>\n\n<p>The windows api has a function which allows you to obtain the screen resolution, so you only need to load the proper dll and call the function.</p>\n\n<pre><code>package main \n\nimport (\n    \"fmt\"\n    \"syscall\"\n)\n\nvar (\n    user32           = syscall.NewLazyDLL(\"User32.dll\")\n    getSystemMetrics = user32.NewProc(\"GetSystemMetrics\")\n)\n\nfunc GetSystemMetrics(nIndex int) int {\n    index := uintptr(nIndex)\n    ret, _, _ := getSystemMetrics.Call(index)\n    return int(ret)\n}\n\nconst (\n    SM_CXSCREEN = 0\n    SM_CYSCREEN = 1\n)\n\nfunc main() {\n    fmt.Printf(\"X: %d, Y: %d\\n\", GetSystemMetrics(SM_CXSCREEN),GetSystemMetrics(SM_CYSCREEN))\n}\n</code></pre>\n\n<p>Official Documentation: </p>\n\n<p><a href=\"https://msdn.microsoft.com/en-us/library/ms724385(v=vs.85).aspx\" rel=\"nofollow noreferrer\">https://msdn.microsoft.com/en-us/library/ms724385(v=vs.85).aspx</a></p>\n\n<p><a href=\"https://github.com/golang/go/wiki/WindowsDLLs\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/WindowsDLLs</a> </p>\n\n<p><a href=\"https://golang.org/pkg/syscall/#Syscall\" rel=\"nofollow noreferrer\">https://golang.org/pkg/syscall/#Syscall</a></p>\n"}, {"comments": [{"owner": {"reputation": 173, "user_id": 137427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54c3a69343a951a798a6c436ac66bc7f?s=128&d=identicon&r=PG", "display_name": "Naikrovek", "link": "https://stackoverflow.com/users/137427/naikrovek"}, "edited": false, "score": 0, "creation_date": 1571662445, "post_id": 48610796, "comment_id": 103304135, "body": "This works great for single-monitor setups.  I&#39;m trying to work out how to get all raster display devices enumerated and get their positions relative to each other.  If anyone knows a way to do this, please enlighten me."}], "tags": [], "owner": {"reputation": 4719, "user_id": 2676845, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/TTFOs.jpg?s=128&g=1", "display_name": "fstanis", "link": "https://stackoverflow.com/users/2676845/fstanis"}, "is_accepted": false, "score": 5, "last_activity_date": 1517764131, "creation_date": 1517764131, "answer_id": 48610796, "question_id": 47256354, "link": "https://stackoverflow.com/questions/47256354/windows-how-to-get-screen-resolution-in-golang/48610796#48610796", "title": "windows-how to get screen resolution in golang", "body": "<p>A bit late, but as suggested by Marco, you can use the Windows API <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms724385(v=vs.85).aspx\" rel=\"noreferrer\">GetSystemMetrics</a> for this. The easiest way to do so is through the <a href=\"https://github.com/lxn/win\" rel=\"noreferrer\">github.com/lxn/win</a> package:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/lxn/win\"\n)\n\nfunc main() {\n    width := int(win.GetSystemMetrics(win.SM_CXSCREEN))\n    height := int(win.GetSystemMetrics(win.SM_CYSCREEN))\n    fmt.Printf(\"%dx%d\\n\", width, height)\n}\n</code></pre>\n\n<p>Slightly more elaborate, using <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/dd144877(v=vs.85).aspx\" rel=\"noreferrer\">GetDeviceCaps</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/lxn/win\"\n)\n\nfunc main() {\n    hDC := win.GetDC(0)\n    defer win.ReleaseDC(0, hDC)\n    width := int(win.GetDeviceCaps(hDC, win.HORZRES))\n    height := int(win.GetDeviceCaps(hDC, win.VERTRES))\n    fmt.Printf(\"%dx%d\\n\", width, height)\n}\n</code></pre>\n"}], "owner": {"reputation": 169, "user_id": 7382052, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0e814c0cdb5b699dbb11e3291e0e46af?s=128&d=identicon&r=PG&f=1", "display_name": "alphayan", "link": "https://stackoverflow.com/users/7382052/alphayan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3143, "favorite_count": 1, "answer_count": 4, "score": 4, "last_activity_date": 1517764131, "creation_date": 1510540773, "last_edit_date": 1510563667, "question_id": 47256354, "link": "https://stackoverflow.com/questions/47256354/windows-how-to-get-screen-resolution-in-golang", "title": "windows-how to get screen resolution in golang", "body": "<p>Great guy. </p>\n\n<p>I have a requirement to get the windows system screen resolution,but I can't get any useful thing about this with google.</p>\n\n<p>So I look for help in stackoverflow.</p>\n\n<p>Anyone know how to do it?</p>\n\n<p>Thanks advance.</p>\n\n<p>updates:\nthen I try this command<code>wmic desktopmonitor get screenheight screenwidth</code> and get the answer like this:<br>\nthis is the cmd:\n<a href=\"https://i.stack.imgur.com/SWzZf.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/SWzZf.png\" alt=\"enter image description here\"></a></p>\n\n<p>this is go-program:\n<a href=\"https://i.stack.imgur.com/NdF3h.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/NdF3h.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "edited": false, "score": 2, "creation_date": 1510540187, "post_id": 47256201, "comment_id": 81463466, "body": "create two structs, with two mappings for encode and for decode"}, {"owner": {"reputation": 3315, "user_id": 1664109, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/JAlH9.jpg?s=128&g=1", "display_name": "RockOnGom", "link": "https://stackoverflow.com/users/1664109/rockongom"}, "reply_to_user": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "edited": false, "score": 0, "creation_date": 1510540565, "post_id": 47256201, "comment_id": 81463562, "body": "But first I need to know there is no way to do this using json notation."}], "answers": [{"comments": [{"owner": {"reputation": 7502, "user_id": 45508, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/HsvdQ.jpg?s=128&g=1", "display_name": "Alexei Tenitski", "link": "https://stackoverflow.com/users/45508/alexei-tenitski"}, "edited": false, "score": 0, "creation_date": 1602206729, "post_id": 47256509, "comment_id": 113654355, "body": "I&#39;d also recommend adding <code>String()</code> to make sure all usual serialization of your struct is covered (say, when printing it out in debug logs) ``` func (password) String() string { \treturn &quot;&quot; } ```"}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 17, "last_activity_date": 1510542131, "creation_date": 1510542131, "answer_id": 47256509, "question_id": 47256201, "link": "https://stackoverflow.com/questions/47256201/how-to-ignore-json-fields-when-marshalling-not-unmarshalling/47256509#47256509", "title": "How to ignore JSON fields when marshalling not unmarshalling", "body": "<p>As with any custom marshaling/unmarshaling requirements in Go, your best bet is to look at implementing <code>json.Marshaler</code>/<code>json.Unmarshaler</code> interface on a custom type.</p>\n\n<p>In this case, you can do it for the password field:</p>\n\n<pre><code>// Use an explicit password type.\ntype password string\n\ntype User struct{\n    UserName string   `json:\"username\"`\n    Password password `json:\"password\"`\n}\n\n// Marshaler ignores the field value completely.\nfunc (password) MarshalJSON() ([]byte, error) {\n    return []byte(`\"\"`), nil\n}\n</code></pre>\n\n<p>Note that by not implementing <code>json.Unmarshaler</code>, type <code>password</code> retains the default behavior of its underlying type (<code>string</code>), which allows the struct to be unmarshalled with the <code>Password</code> value.</p>\n\n<p>Working example: <a href=\"https://play.golang.org/p/HZQoCKm0vN\" rel=\"noreferrer\">https://play.golang.org/p/HZQoCKm0vN</a></p>\n"}, {"tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": true, "score": 17, "last_activity_date": 1510561261, "creation_date": 1510561261, "answer_id": 47259784, "question_id": 47256201, "link": "https://stackoverflow.com/questions/47256201/how-to-ignore-json-fields-when-marshalling-not-unmarshalling/47259784#47259784", "title": "How to ignore JSON fields when marshalling not unmarshalling", "body": "<p>One common approach is to use a temporary type or variable, with same structure, but different <code>json</code> tags or even different structure:</p>\n\n<pre><code>type User struct {\n    UserName string `json:\"username\"`\n    Password string `json:\"password\"`\n}\n\nfunc (usr User) MarshalJSON() ([]byte, error) {\n    var tmp struct {\n        UserName string `json:\"username\"`\n    }\n    tmp.UserName = usr.UserName\n    return json.Marshal(&amp;tmp)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 441, "user_id": 907720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e9c2ea0beb44534f883287636cfa6c2?s=128&d=identicon&r=PG", "display_name": "makeroo", "link": "https://stackoverflow.com/users/907720/makeroo"}, "is_accepted": false, "score": 5, "last_activity_date": 1546011361, "creation_date": 1546011361, "answer_id": 53960863, "question_id": 47256201, "link": "https://stackoverflow.com/questions/47256201/how-to-ignore-json-fields-when-marshalling-not-unmarshalling/53960863#53960863", "title": "How to ignore JSON fields when marshalling not unmarshalling", "body": "<p>I prefer type composition. For example:</p>\n\n<pre><code>type User struct {\n    UserName string `json:\"username\"`\n}\n\ntype UserWithPassword struct {\n    *User\n    Password string `json:\"password\"`\n}\n</code></pre>\n\n<p>use UserWithPassword when receiving data (eg. user creation / modification) and User when returning it (authentication).</p>\n"}, {"tags": [], "owner": {"reputation": 5658, "user_id": 1162217, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/7E5sp.jpg?s=128&g=1", "display_name": "Lukas Lukac", "link": "https://stackoverflow.com/users/1162217/lukas-lukac"}, "is_accepted": false, "score": 1, "last_activity_date": 1611750027, "creation_date": 1611750027, "answer_id": 65919058, "question_id": 47256201, "link": "https://stackoverflow.com/questions/47256201/how-to-ignore-json-fields-when-marshalling-not-unmarshalling/65919058#65919058", "title": "How to ignore JSON fields when marshalling not unmarshalling", "body": "<p>IF you want to know how to ignore JSON fields when <strong>BOTH</strong> Marshalling <strong>and</strong> Unmarshalling:</p>\n<pre><code>    Ulimit struct {\n        Soft uint64 `json:&quot;-&quot;`    // this attribute will be ignored\n        Hard uint64 `json:&quot;hard&quot;`\n    } `json:&quot;ulimit&quot;`\n</code></pre>\n<p>PS: I know this doesn't answer this exact question but Google search query takes devs here for &quot;how to ignore JSON fields in Go&quot; so I hope this helps. Landed here myself searching for this answer few minutes ago.</p>\n"}], "owner": {"reputation": 3315, "user_id": 1664109, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/JAlH9.jpg?s=128&g=1", "display_name": "RockOnGom", "link": "https://stackoverflow.com/users/1664109/rockongom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16757, "favorite_count": 5, "accepted_answer_id": 47259784, "answer_count": 4, "score": 14, "last_activity_date": 1611750027, "creation_date": 1510539361, "last_edit_date": 1570223203, "question_id": 47256201, "link": "https://stackoverflow.com/questions/47256201/how-to-ignore-json-fields-when-marshalling-not-unmarshalling", "title": "How to ignore JSON fields when marshalling not unmarshalling", "body": "<p>Assume I have a password field in a User struct.</p>\n\n<pre><code>type User struct{\n   UserName string `json:\"username\"`\n   Password string `json:\"-\"`\n}\n</code></pre>\n\n<p>My clients register their users by posting username and password together. So if I decode JSON to above struct, it ignores password. It's expected. But I wondered is there any way to ignore fields when only marshalling. I checked go official documentation page but couldn't find anything. </p>\n\n<p><a href=\"https://golang.org/pkg/encoding/json/\" rel=\"noreferrer\">https://golang.org/pkg/encoding/json/</a></p>\n\n<p>I can add an extra field into the struct but I need to know first is it possible to do that with JSON lib.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 3, "creation_date": 1510538637, "post_id": 47256103, "comment_id": 81463125, "body": "Read this to understand how slices work: <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">blog.golang.org/go-slices-usage-and-internals</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1618, "user_id": 3450594, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a0796fb7fc7c610d4f01fc6e852382f1?s=128&d=identicon&r=PG&f=1", "display_name": "JChao", "link": "https://stackoverflow.com/users/3450594/jchao"}, "edited": false, "score": 0, "creation_date": 1510540021, "post_id": 47256145, "comment_id": 81463422, "body": "so that being said, if I modify the value (say, <code>s[1] = 10</code>), i should see the change in the array itself? meaning now the array will look like <code>[2, 10, 5, 7, 11, 13]</code>?"}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "reply_to_user": {"reputation": 1618, "user_id": 3450594, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a0796fb7fc7c610d4f01fc6e852382f1?s=128&d=identicon&r=PG&f=1", "display_name": "JChao", "link": "https://stackoverflow.com/users/3450594/jchao"}, "edited": false, "score": 2, "creation_date": 1510540393, "post_id": 47256145, "comment_id": 81463521, "body": "That&#39;s right. Check this little example I made: <a href=\"https://play.golang.org/p/T41T4f6GZf\" rel=\"nofollow noreferrer\">play.golang.org/p/T41T4f6GZf</a>"}], "tags": [], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "is_accepted": true, "score": 6, "last_activity_date": 1510539311, "last_edit_date": 1510539311, "creation_date": 1510538865, "answer_id": 47256145, "question_id": 47256103, "link": "https://stackoverflow.com/questions/47256103/golang-slice-variable-assign-from-tutorial/47256145#47256145", "title": "golang slice variable assign (from tutorial)", "body": "<p>Slices in go are a fancy structure that sits on top of an array. In your example:</p>\n\n<pre><code>s := []int{2, 3, 5, 7, 11, 13}\n</code></pre>\n\n<p>Creates an array with the contents: 2, 3, 5, 7, 11, 13 and the slice <code>s</code> points to that array and it's as long as the array itself. </p>\n\n<p>When slicing <code>s = s[:0]</code> this creates a new slice with length 0 on the same array. Although the new slice is empty, because it shares the same array when you make the slice bigger with <code>s = s[:4]</code> it allows you to see the first 4 values of the array.</p>\n\n<p>Slices are like windows into an underlying array, and modifying the slice don't modify the array. So the first slice lets you see all of the elements in the array, the second one doesn't show you any of the elements and the third one let's you see only the first 4 elements.</p>\n\n<p>Here I use <code>[]</code> to represent what the slice <code>a</code> contents are in each part of your example:</p>\n\n<pre><code>[2 3 5 7 11 13]\n[]2 3 5 7 11 13\n[2 3 5 7] 11 13\n</code></pre>\n\n<p>But the array always remains the same.</p>\n\n<p>As a note, because slicing doesn't create a new array, even if you save each of those slices in a different variable, the underlying array is the same, so if you modify one of the elements in one slice, you would see that same change in all of the slices that share the same array.</p>\n"}], "owner": {"reputation": 1618, "user_id": 3450594, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a0796fb7fc7c610d4f01fc6e852382f1?s=128&d=identicon&r=PG&f=1", "display_name": "JChao", "link": "https://stackoverflow.com/users/3450594/jchao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2340, "favorite_count": 1, "accepted_answer_id": 47256145, "answer_count": 1, "score": 4, "last_activity_date": 1510539311, "creation_date": 1510538415, "question_id": 47256103, "link": "https://stackoverflow.com/questions/47256103/golang-slice-variable-assign-from-tutorial", "title": "golang slice variable assign (from tutorial)", "body": "<p><a href=\"https://tour.golang.org/moretypes/11\" rel=\"nofollow noreferrer\">https://tour.golang.org/moretypes/11</a></p>\n\n<p>in this tutorial, <code>s</code> is first assigned to</p>\n\n<pre><code>s := []int{2, 3, 5, 7, 11, 13}\n</code></pre>\n\n<p>then after that a series of actions are done to <code>s</code></p>\n\n<pre><code>s = s[:0]\nprintSlice(s)  // len=0 cap=6 []\ns = s[:4]\nprintSlice(s) // len=4 cap=6 [2 3 5 7]\n</code></pre>\n\n<p>I code in python normally, so this confuses me a bit. When assigning <code>s=s[:0]</code>, shouldn't <code>s</code> be changed to the slice of original <code>s</code>, meaning the <code>s</code> is no longer an array but a slice? How can this slice again be assigned to a different length that actually has content in it?</p>\n"}, {"tags": ["go", "mocking"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1510535237, "post_id": 47255595, "comment_id": 81462331, "body": "You probably can&#39;t, just generate the default mock, copy it to some other file so that it doesn&#39;t get overwritten the next time <code>mockgen</code> runs, manually modify the <code>Retrieve</code> method but keep the generated logic untouched, just add your lines before the mock does its thing."}], "answers": [{"comments": [{"owner": {"reputation": 485, "user_id": 2671688, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/e0987c2928e703cd91a5ef994a85b739?s=128&d=identicon&r=PG", "display_name": "user2671688", "link": "https://stackoverflow.com/users/2671688/user2671688"}, "edited": false, "score": 0, "creation_date": 1510638282, "post_id": 47276809, "comment_id": 81507625, "body": "Thanks for your answer, though it doesn&#39;t really address the question. I know I can write a fake manually to implement some interface. I&#39;m specifically looking for whether I can accomplish this with generated mocks, in particular, for cases where faking the entire interface to satisfaction is impractically complicated."}, {"owner": {"reputation": 796, "user_id": 1286423, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/69924a17cad0b5bfc37e4d83dd848ee1?s=128&d=identicon&r=PG", "display_name": "Dolanor", "link": "https://stackoverflow.com/users/1286423/dolanor"}, "reply_to_user": {"reputation": 485, "user_id": 2671688, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/e0987c2928e703cd91a5ef994a85b739?s=128&d=identicon&r=PG", "display_name": "user2671688", "link": "https://stackoverflow.com/users/2671688/user2671688"}, "edited": false, "score": 0, "creation_date": 1510657148, "post_id": 47276809, "comment_id": 81517907, "body": "Ok! Got it. I didn&#39;t use mockgen yet, so I don&#39;t know. Did you try with <a href=\"https://github.com/matryer/moq\" rel=\"nofollow noreferrer\">moq</a> as well?"}], "tags": [], "owner": {"reputation": 796, "user_id": 1286423, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/69924a17cad0b5bfc37e4d83dd848ee1?s=128&d=identicon&r=PG", "display_name": "Dolanor", "link": "https://stackoverflow.com/users/1286423/dolanor"}, "is_accepted": false, "score": 0, "last_activity_date": 1510627111, "creation_date": 1510627111, "answer_id": 47276809, "question_id": 47255595, "link": "https://stackoverflow.com/questions/47255595/go-how-do-i-mock-a-dependency-that-takes-a-callback/47276809#47276809", "title": "Go - How do I mock a dependency that takes a callback?", "body": "<p>Here is some code while trying to understand what you wanted to achieve.\nI don't use mockgen, but manually, you can do what you want. I totally changed the behavior between the original and the mocked call. Does it answer your questions?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nvar str = [...]string{\n    \"world\",\n    \"night\",\n}\n\ntype Dependency interface {\n    Get(val string) string\n}\n\ntype dependency struct {\n    i int\n}\n\nfunc (d *dependency) Get(fn func(int) string) string {\n    d.i++\n    d.i = d.i % len(str)\n\n    return \"hello \" + fn(d.i)\n}\n\nfunc main() {\n    d := dependency{}\n    myfn := func(idx int) string { return str[idx] }\n    fmt.Println(d.Get(myfn))\n    fmt.Println(d.Get(myfn))\n    fmt.Println(d.Get(myfn))\n\n    m := mock{}\n    fmt.Println(m.Get(myfn))\n}\n\ntype mock struct {\n}\n\nfunc (m *mock) Get(fn func(int) string) string {\n    i := 0\n    j := (i + 1) % len(str)\n    k := (j + 1) % len(str)\n\n    return \"mocked \" + fn(i) + fn(j) + fn(k)\n}\n</code></pre>\n\n<p>The play link:\n<a href=\"https://play.golang.org/p/bb7WrmlIEN\" rel=\"nofollow noreferrer\">https://play.golang.org/p/bb7WrmlIEN</a></p>\n"}], "owner": {"reputation": 485, "user_id": 2671688, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/e0987c2928e703cd91a5ef994a85b739?s=128&d=identicon&r=PG", "display_name": "user2671688", "link": "https://stackoverflow.com/users/2671688/user2671688"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 289, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1510627111, "creation_date": 1510533185, "question_id": 47255595, "link": "https://stackoverflow.com/questions/47255595/go-how-do-i-mock-a-dependency-that-takes-a-callback", "title": "Go - How do I mock a dependency that takes a callback?", "body": "<p>Suppose I have a dependency that looks like this:</p>\n\n<pre><code>type Dependency interface {\n    Retrieve(transform func(row *Row) string) []string\n}\n</code></pre>\n\n<p>And I'm using it in code that I'd like to unit test</p>\n\n<pre><code>// ...\nresult := dep.Retrieve(func(row *Row) string {\n    // ... do stuff\n})\n// ...\n</code></pre>\n\n<p>This is a contrived example, but consider it for something like gcloud pubsub, which has a Receive method that calls a user-defined function for each message it pulls.</p>\n\n<p>If I use mockgen to get a mock of Dependency, how do I tell the mock how to behave? I'd want it to call its input function some number of times with some sets of input.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510584898, "post_id": 47253852, "comment_id": 81484965, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/10646531/golang-conditional-compilation\">Golang conditional compilation</a>"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510619004, "post_id": 47253852, "comment_id": 81502613, "body": "@Adrian: Different question, different answer. The answer to the <a href=\"https://stackoverflow.com/questions/10646531\">Golang conditional compilation</a> question was to add a blank line following build contraints. That&#39;s not an answer to this question."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510620654, "post_id": 47253852, "comment_id": 81503032, "body": "@Adrian: The official words: &quot;That&#39;s because the proof is in the answers. If the question looks the same, but the answers aren&#39;t solving the asker&#39;s problem, that is not a dupe \u2013 that is a legitimate new question.&quot;"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1510630976, "post_id": 47253852, "comment_id": 81505558, "body": "@peterso It demonstrates how to use build tags, which is the answer to this question. You&#39;re welcome to find a more appropriate duplicate."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 7, "last_activity_date": 1510532753, "last_edit_date": 1510532753, "creation_date": 1510522048, "answer_id": 47254176, "question_id": 47253852, "link": "https://stackoverflow.com/questions/47253852/can-i-have-custom-build-flags-like-os-arch-comment-directives/47254176#47254176", "title": "Can i have custom build flags like os/arch comment directives", "body": "<blockquote>\n  <p><a href=\"https://golang.org/cmd/go/\" rel=\"noreferrer\">Command go</a> </p>\n  \n  <p>Go is a tool for managing Go source code.</p>\n  \n  <p>Usage:</p>\n\n<pre><code>go command [arguments]\n</code></pre>\n  \n  <p><a href=\"https://golang.org/cmd/go/#hdr-Compile_packages_and_dependencies\" rel=\"noreferrer\">Compile packages and dependencies</a></p>\n  \n  <p>Usage:</p>\n\n<pre><code>go build [-o output] [-i] [build flags] [packages]\n</code></pre>\n  \n  <p>Build compiles the packages named by the import paths, along with\n  their dependencies, but it does not install the results. </p>\n  \n  <p>The build flags are shared by the build, clean, get, install, list,\n  run, and test commands: </p>\n\n<pre><code>-tags 'tag list'\n  a space-separated list of build tags to consider satisfied during the\n  build. For more information about build tags, see the description of\n  build constraints in the documentation for the `go/build` package.\n</code></pre>\n</blockquote>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/pkg/go/build/\" rel=\"noreferrer\"><code>go/build</code> package: Build Constraints</a></p>\n</blockquote>\n\n<hr>\n\n<p>For example, in source, </p>\n\n<pre><code>// +build debug\n</code></pre>\n\n<p>At runtime, for <code>build</code>, <code>clean</code>, <code>get</code>, <code>install</code>, <code>list</code>, <code>run</code>, and <code>test</code> <code>go</code> commands,</p>\n\n<pre><code>$ go install -tags='debug'\n</code></pre>\n"}], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3789, "favorite_count": 2, "accepted_answer_id": 47254176, "answer_count": 1, "score": 6, "last_activity_date": 1510600041, "creation_date": 1510520011, "last_edit_date": 1510600041, "question_id": 47253852, "link": "https://stackoverflow.com/questions/47253852/can-i-have-custom-build-flags-like-os-arch-comment-directives", "title": "Can i have custom build flags like os/arch comment directives", "body": "<p>In golang I am able to set compiler directives in the first line comment of a file to determine whether the code on that file is included in the build based on OS or arch, e.g</p>\n\n<p>to target windows:</p>\n\n<pre><code>// +build windows\n</code></pre>\n\n<p>or non-windows:</p>\n\n<pre><code>// +build !windows\n</code></pre>\n\n<p>Is there any way to pass in my own boolean variable at build time to operate in the same way?</p>\n\n<p>The background is that I would like a boolean debug flag which I can pass in to do a debug build, I don't want my debug code included in the normal build.</p>\n\n<p>I currently do something like this:</p>\n\n<pre><code>go build -ldflags \"-X main.Debug=true\"\n</code></pre>\n\n<p>but I would prefer to use 1st line comment method particularly as this approach doesn't omit debug code from the build (I presume).</p>\n\n<p>Ideally I want:</p>\n\n<p><em>debug-on.go</em></p>\n\n<pre><code>// +build debug\n\npackage debug\n\nfunc Debug() bool {\n    return true\n}\n</code></pre>\n\n<p>and <em>debug-off.go</em></p>\n\n<pre><code>// +build !debug\n\npackage debug\n\nfunc Debug() bool {\n    return false\n}\n</code></pre>\n\n<p><strong>Update RE duplicate</strong>\nI accept the related question has the same subject matter but it's really not a duplicate question, that is a question from somebody who already knew about this feature but is struggling with implementation.</p>\n\n<p>My 2 cents is that it seems the equivalent of \"What language to people speak in France?\" vs \"How do you say 'This is not a duplicate' in French?\"</p>\n"}, {"tags": ["go", "concurrency", "akka", "message-passing"], "comments": [{"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 2, "creation_date": 1510512640, "post_id": 47252434, "comment_id": 81455347, "body": "In general, you can typically implement <i>any</i> concurrency abstraction from one concurrency model using the concurrency abstractions of some other general concurrency model. So, the question is: what do you mean by &quot;equivalent&quot;?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1510561954, "post_id": 47252434, "comment_id": 81470612, "body": "Please see my comment to <a href=\"https://stackoverflow.com/q/47201862/720999\">this similar question</a>."}], "answers": [{"tags": [], "owner": {"reputation": 1508, "user_id": 1304519, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e8850b692b1c4e1d6439f002846a2df8?s=128&d=identicon&r=PG", "display_name": "Kajal Sinha", "link": "https://stackoverflow.com/users/1304519/kajal-sinha"}, "is_accepted": true, "score": 1, "last_activity_date": 1510816955, "last_edit_date": 1510816955, "creation_date": 1510546625, "answer_id": 47256984, "question_id": 47252434, "link": "https://stackoverflow.com/questions/47252434/is-akkas-routers-similar-to-gos-select/47256984#47256984", "title": "Is Akka&#39;s routers similar to Go&#39;s select?", "body": "<p>It is similar in abstract terms and general understanding but very different if you compare with Akka router.</p>\n\n<p>As you are trying to compare a language feature with a framework feature here is an explantation.</p>\n\n<p>Go uses select over channels and this feature is a basic building block which you can use to extend routing and add many features which Akka has. Try looking into some fantastic GitHub libraries.</p>\n\n<p><a href=\"https://github.com/avelino/awesome-go#routers\" rel=\"nofollow noreferrer\">https://github.com/avelino/awesome-go#routers</a></p>\n\n<p>Akka itself is huge and very well written. Akka router has many other options which includes routing strategy and remote routing as well.</p>\n\n<p>go-select is a language feature which makes it easier to implement routing feature if you compare with other languages (readers-no language war please!)</p>\n\n<p>Thanks</p>\n"}], "owner": {"reputation": 293, "user_id": 8923564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3811d2c1f39107ad5bae9f10f7551c37?s=128&d=identicon&r=PG&f=1", "display_name": "nadia", "link": "https://stackoverflow.com/users/8923564/nadia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 47256984, "answer_count": 1, "score": 0, "last_activity_date": 1510816955, "creation_date": 1510511694, "last_edit_date": 1510513831, "question_id": 47252434, "link": "https://stackoverflow.com/questions/47252434/is-akkas-routers-similar-to-gos-select", "title": "Is Akka&#39;s routers similar to Go&#39;s select?", "body": "<p>I read that Akka library has something called \"Routers\" which routes messages to their routees (who will receive the messages). Is this similar to selective communication in Go which uses the select statement?</p>\n"}, {"tags": ["variables", "go"], "comments": [{"owner": {"reputation": 2981, "user_id": 6206947, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ef3bb38797a3bd7c6e2b92797e9b80dc?s=128&d=identicon&r=PG", "display_name": "nicovank", "link": "https://stackoverflow.com/users/6206947/nicovank"}, "edited": false, "score": 0, "creation_date": 1510504340, "post_id": 47251170, "comment_id": 81452539, "body": "What is cur? How is the <code>struct</code> like? What data do you want to store in the file?"}, {"owner": {"reputation": 23, "user_id": 8924214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa6b5a24f266057b3e38b540c6bb80ea?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Smith", "link": "https://stackoverflow.com/users/8924214/jack-smith"}, "reply_to_user": {"reputation": 2981, "user_id": 6206947, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ef3bb38797a3bd7c6e2b92797e9b80dc?s=128&d=identicon&r=PG", "display_name": "nicovank", "link": "https://stackoverflow.com/users/6206947/nicovank"}, "edited": false, "score": 0, "creation_date": 1510504704, "post_id": 47251170, "comment_id": 81452664, "body": "@nicovank  need to use cur, err := user.Current() as a string. Save output cur to file"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1510504889, "post_id": 47251170, "comment_id": 81452730, "body": "import package <code>fmt</code> and do <code>f.WriteString(fmt.Sprintf(&quot;%+v\\n&quot;, cur))</code>"}, {"owner": {"reputation": 23, "user_id": 8924214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa6b5a24f266057b3e38b540c6bb80ea?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Smith", "link": "https://stackoverflow.com/users/8924214/jack-smith"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1510506130, "post_id": 47251170, "comment_id": 81453148, "body": "@mkopriva thanks! this is what I needed"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 7, "last_activity_date": 1510506122, "creation_date": 1510506122, "answer_id": 47251465, "question_id": 47251170, "link": "https://stackoverflow.com/questions/47251170/go-err-cannot-use-cur-type-user-user-as-type-string-in-argument-to-f-writest/47251465#47251465", "title": "Go err: cannot use cur (type *user.User) as type string in argument to f.WriteString", "body": "<p><a href=\"https://golang.org/pkg/os/#File.WriteString\" rel=\"noreferrer\"><code>File.WriteString()</code></a> expects a <code>string</code> argument, yet you attempt to pass <code>cur</code> to it which is of type <a href=\"https://golang.org/pkg/os/user/#User\" rel=\"noreferrer\"><code>*user.User</code></a>, a pointer to a struct. This is obviously a compile-time error.</p>\n\n<p><code>user.User</code> is a struct with the following definition:</p>\n\n<pre><code>type User struct {\n        // Uid is the user ID.\n        // On POSIX systems, this is a decimal number representing the uid.\n        // On Windows, this is a security identifier (SID) in a string format.\n        // On Plan 9, this is the contents of /dev/user.\n        Uid string\n        // Gid is the primary group ID.\n        // On POSIX systems, this is a decimal number representing the gid.\n        // On Windows, this is a SID in a string format.\n        // On Plan 9, this is the contents of /dev/user.\n        Gid string\n        // Username is the login name.\n        Username string\n        // Name is the user's real or display name.\n        // It might be blank.\n        // On POSIX systems, this is the first (or only) entry in the GECOS field\n        // list.\n        // On Windows, this is the user's display name.\n        // On Plan 9, this is the contents of /dev/user.\n        Name string\n        // HomeDir is the path to the user's home directory (if they have one).\n        HomeDir string\n}\n</code></pre>\n\n<p>Choose what you want to output to the file, most likely the <code>Username</code> field or maybe the <code>Name</code> field. These are fields of <code>string</code> type, so these you can pass without a problem:</p>\n\n<pre><code>if _, err = f.WriteString(cur.Username); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>If you want to write out the complete <code>User</code> struct, you may use the <a href=\"https://golang.org/pkg/fmt/\" rel=\"noreferrer\"><code>fmt</code></a> package, conveniently the <a href=\"https://golang.org/pkg/fmt/#Fprint\" rel=\"noreferrer\"><code>fmt.Fprint()</code></a> or <a href=\"https://golang.org/pkg/fmt/#Fprintf\" rel=\"noreferrer\"><code>fmt.Fprintf()</code></a> functions:</p>\n\n<pre><code>if _, err = fmt.Fprintf(f, \"%+v\", cur); err != nil {\n    panic(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 8924214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa6b5a24f266057b3e38b540c6bb80ea?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Smith", "link": "https://stackoverflow.com/users/8924214/jack-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 734, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1510506122, "creation_date": 1510504205, "question_id": 47251170, "link": "https://stackoverflow.com/questions/47251170/go-err-cannot-use-cur-type-user-user-as-type-string-in-argument-to-f-writest", "title": "Go err: cannot use cur (type *user.User) as type string in argument to f.WriteString", "body": "<p>How do I convert data to a <code>string</code> type? I need to write down the <code>data</code> I need to the file which is either not a variable, <strong>how do I do it</strong>? </p>\n\n<p>Code: </p>\n\n<pre><code>package main\n\nimport \"os\"\nimport \"os/user\"\nimport \"encoding/json\"\n\nfunc main(){\n    f, err := os.OpenFile(\"test.txt\", os.O_APPEND|os.O_WRONLY, 0600)\n    if err != nil {\n        panic(err)\n    }\n    defer f.Close()\n\n    cur, err := user.Current()\n    if err != nil {\n\n    } else {\n\n\n        if _, err = f.WriteString(cur); err != nil {\n        panic(err)\n        }\n    }\n}\n</code></pre>\n\n<p>I do not need to use the <code>cur.Username</code> field. Only a variable.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1639, "user_id": 7187655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hvz9T.png?s=128&g=1", "display_name": "Motakjuq", "link": "https://stackoverflow.com/users/7187655/motakjuq"}, "is_accepted": false, "score": 10, "last_activity_date": 1510503099, "creation_date": 1510503099, "answer_id": 47250970, "question_id": 47250834, "link": "https://stackoverflow.com/questions/47250834/how-to-modify-return-value-with-panic-and-recover-in-golang/47250970#47250970", "title": "how to modify return value with panic and recover in golang", "body": "<p>one way to do it is naming the return value in the func definition</p>\n\n\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc foo() (r int) {\n    defer func() {\n        if p := recover(); p != nil {\n            fmt.Printf(\"internal error: %v\\n\", p)\n            r = 5 // this modify the return value\n        }\n    }()\n\n    panic(\"test error\")\n    return 3\n}\n\nfunc main() {\n    fmt.Println(foo()) // this print 5\n}\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 8928486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f3c938de6f7cd63a87504f2661eb4d03?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Smith", "link": "https://stackoverflow.com/users/8928486/michael-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1073, "favorite_count": 0, "closed_date": 1510503225, "answer_count": 1, "score": 6, "last_activity_date": 1510509812, "creation_date": 1510502341, "last_edit_date": 1510509812, "question_id": 47250834, "link": "https://stackoverflow.com/questions/47250834/how-to-modify-return-value-with-panic-and-recover-in-golang", "closed_reason": "Duplicate", "title": "how to modify return value with panic and recover in golang", "body": "<p>I have a problem\nhow to modify return value with panic and recover in golang\nplease help me, thank you!</p>\n\n\n\n<pre><code>func foo1() int {\n\n    defer func() {\n        if p := recover(); p != nil {\n            fmt.Printf(\"internal error: %v\\n\", p)\n        }\n        // how can I do?\n    }()\n\n    panic(\"test error\")\n    return 10\n}\n</code></pre>\n"}, {"tags": ["macos", "go"], "comments": [{"owner": {"reputation": 2559, "user_id": 5087125, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6R64Z.jpg?s=128&g=1", "display_name": "pvg", "link": "https://stackoverflow.com/users/5087125/pvg"}, "edited": false, "score": 3, "creation_date": 1510495477, "post_id": 47249674, "comment_id": 81449579, "body": "You can write an installer. <a href=\"http://s.sudre.free.fr/Packaging.html\" rel=\"nofollow noreferrer\">s.sudre.free.fr/Packaging.html</a>"}], "answers": [{"tags": [], "owner": {"reputation": 18176, "user_id": 48660, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/NJ1Lx.jpg?s=128&g=1", "display_name": "pmdj", "link": "https://stackoverflow.com/users/48660/pmdj"}, "is_accepted": true, "score": 1, "last_activity_date": 1510661266, "creation_date": 1510661266, "answer_id": 47285481, "question_id": 47249674, "link": "https://stackoverflow.com/questions/47249674/how-distribute-osx-cli-server-app/47285481#47285481", "title": "How distribute OSX cli / server app", "body": "<p>As was suggested in the comments, installer pkgs are usually the way to go with this type of software. You're probably familiar with them if you've manually installed device drivers, OS updates and other lower-level software on the Mac.</p>\n\n<p>You can also generate them with command-line utilities, and don't necessarily need to use the 3rd party app that <a href=\"https://stackoverflow.com/users/5087125/pvg\">pvg</a> suggested in the comment. <a href=\"https://stackoverflow.com/a/11487658/48660\">This answer</a> is a good starting point. Using the command-line tools also lets you automate package building as part of your standard build process.</p>\n\n<p>Note that Apple's own old \"PackageMaker\" GUI tool no longer works properly with newer versions of macOS/OSX, I strongly advise you not to use that.</p>\n"}], "owner": {"reputation": 1465, "user_id": 5848613, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HTjcL.png?s=128&g=1", "display_name": "21st", "link": "https://stackoverflow.com/users/5848613/21st"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "accepted_answer_id": 47285481, "answer_count": 1, "score": 2, "last_activity_date": 1510661266, "creation_date": 1510495117, "question_id": 47249674, "link": "https://stackoverflow.com/questions/47249674/how-distribute-osx-cli-server-app", "title": "How distribute OSX cli / server app", "body": "<p>Im building a cli app that can run in server mode for osx in golang. I come from the server world and have no idea how properly distribute a consumer cli tool for osx. The cli can run as a service which can be easily achieved with launchd. </p>\n\n<p>Launchd config:</p>\n\n<pre><code>&lt;plist version=\"1.0\"&gt;\n    &lt;dict&gt;\n        &lt;key&gt;KeepAlive&lt;/key&gt;\n        &lt;true/&gt;\n        &lt;key&gt;Label&lt;/key&gt;\n        &lt;string&gt;focus-daemon&lt;/string&gt;\n        &lt;key&gt;RunAtLoad&lt;/key&gt;\n        &lt;true /&gt;\n        &lt;key&gt;Program&lt;/key&gt;\n        &lt;string&gt;/usr/local/bin/focus&lt;/string&gt;\n  &lt;/dict&gt;\n&lt;/plist&gt;\n</code></pre>\n\n<p>Building and running is also quite simple:</p>\n\n<pre><code>go build main.go\nsudo cp main /usr/local/bin/focus\nrm main\nsudo chown root /usr/local/bin/focus\nsudo chmod 4555 /usr/local/bin/focus\ncp focus.plist ~/Library/LaunchAgents/com.21stio.focus.plist\nlaunchctl load ~/Library/LaunchAgents/com.21stio.focus.plist\n</code></pre>\n\n<p>When being build the process requires sudo to set a sbit on the binary.</p>\n\n<p>I don't want the user having to run a .sh script. Maybe I could use brew and/or a DMG for that. But I have no idea how I can put the <code>Launchd config</code> at the right spot then.</p>\n"}, {"tags": ["arrays", "go"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8872508"}, "edited": false, "score": 0, "creation_date": 1510548124, "post_id": 47250063, "comment_id": 81465199, "body": "Thank you @peterSO"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1510497625, "creation_date": 1510497625, "answer_id": 47250063, "question_id": 47248213, "link": "https://stackoverflow.com/questions/47248213/i-am-facing-issue-panic-runtime-error-index-out-of-range-when-create-2d-arra/47250063#47250063", "title": "i am facing issue &quot;panic: runtime error: index out of range&quot; when create 2D array with make method in golang", "body": "<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a> </p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Array_types\" rel=\"nofollow noreferrer\">Array types</a></p>\n  \n  <p>An array is a numbered sequence of elements of a single type, called\n  the element type. The number of elements is called the length and is\n  never negative. </p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"nofollow noreferrer\">Slice types</a></p>\n  \n  <p>A slice is a descriptor for a contiguous segment of an underlying\n  array and provides access to a numbered sequence of elements from that\n  array. A slice type denotes the set of all slices of arrays of its\n  element type. The value of an uninitialized slice is nil.</p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Making_slices_maps_and_channels\" rel=\"nofollow noreferrer\">Making slices, maps and channels</a></p>\n  \n  <p>The built-in function make takes a type T, which must be a slice, map\n  or channel type, optionally followed by a type-specific list of\n  expressions. It returns a value of type T (not *T). The memory is\n  initialized as described in the section on initial values.</p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Appending_and_copying_slices\" rel=\"nofollow noreferrer\">Appending to and copying slices</a> </p>\n  \n  <p>The built-in functions append and copy assist in common slice\n  operations. For both functions, the result is independent of whether\n  the memory referenced by the arguments overlaps. </p>\n  \n  <p>The variadic function append appends zero or more values x to s of\n  type S, which must be a slice type, and returns the resulting slice,\n  also of type S.</p>\n</blockquote>\n\n<hr>\n\n<p>In Go, arrays and slices are not the same thing. Your <code>make([][]string,0,2)</code> statement creates a 2D slice. Here is your 2D slice with initial values,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    letters := make([][]string, 2)\n    letters[0] = append(letters[0], \"a\", \"b\")\n    letters[1] = append(letters[1], \"c\", \"d\")\n    fmt.Println(letters)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/l40xv_7W5h\" rel=\"nofollow noreferrer\">https://play.golang.org/p/l40xv_7W5h</a></p>\n\n<p>Output:</p>\n\n<pre><code>[[a b] [c d]]\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8872508"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 713, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1510497625, "creation_date": 1510485827, "question_id": 47248213, "link": "https://stackoverflow.com/questions/47248213/i-am-facing-issue-panic-runtime-error-index-out-of-range-when-create-2d-arra", "title": "i am facing issue &quot;panic: runtime error: index out of range&quot; when create 2D array with make method in golang", "body": "<blockquote>\n  <p>I am new in golang and try to learn with small examples.</p>\n</blockquote>\n\n<p>So I am trying to create a 2D array and assign a value but I am stuck here can anyone help me. here is my code.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n\n    letters := make([][]string,0,2)\n    letters[0][0] = \"a\"\n    letters[0][1] = \"b\"\n    letters[1][0] = \"c\"\n    letters[1][1] = \"d\"\n\n    fmt.Println(letters)\n}\n</code></pre>\n\n<p>I am getting error when I run this code </p>\n\n<blockquote>\n  <p>panic: runtime error: index out of range</p>\n</blockquote>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1510491212, "post_id": 47247555, "comment_id": 81448200, "body": "Why are you using a 3rd party lib (<code>github.com&#47;kr&#47;fs</code>) for this? What&#39;s wrong  with the standard lib&#39;s <a href=\"https://golang.org/pkg/path/filepath/#Walk\" rel=\"nofollow noreferrer\"><code>filepath.Walk()</code></a>? Using that would be the &quot;go way&quot;."}, {"owner": {"reputation": 1584, "user_id": 6778826, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HOfOO.jpg?s=128&g=1", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/6778826/aleksandar"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1510503032, "post_id": 47247555, "comment_id": 81452094, "body": "Because I just wanted to use a small code. Now it looks like it&#39;s better to use the std lib for this."}, {"owner": {"reputation": 2981, "user_id": 6206947, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ef3bb38797a3bd7c6e2b92797e9b80dc?s=128&d=identicon&r=PG", "display_name": "nicovank", "link": "https://stackoverflow.com/users/6206947/nicovank"}, "edited": false, "score": 2, "creation_date": 1510503940, "post_id": 47247555, "comment_id": 81452393, "body": "Belongs on <a href=\"https://codereview.stackexchange.com\">Code Review</a>."}], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1510492904, "post_id": 47247647, "comment_id": 81448706, "body": "Ranging over a slice of structs is often less efficient than using indices, as the former needs to copy all the elements of the slice one-by-one.. Range still can be used, but it&#39;s faster if used only for indices in case of slice of structs."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1510519962, "post_id": 47247647, "comment_id": 81457996, "body": "@icza You&#39;re technically correct, but that&#39;s the wrong way to think in Go. In Go, the decision to pass by value or pass by pointer (or in this case, thing which can be modified) should depend on whether you intend to alter the original or not. The consideration is safety, not tweaking performance. And <code>range</code> is quite performant, it reuses the same memory for the iterator (something which can catch people out). Use <code>range</code> and then only switch to a traditional <code>for</code> loop if profiling says its necessary for performance."}], "tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": true, "score": 2, "last_activity_date": 1510483627, "last_edit_date": 1510483627, "creation_date": 1510481952, "answer_id": 47247647, "question_id": 47247555, "link": "https://stackoverflow.com/questions/47247555/how-to-sort-a-array-slice-in-a-go-way/47247647#47247647", "title": "How to sort a array/slice in a go way", "body": "<pre><code>for i:=0; i &lt; len(files) ; i++ {\n    fmt.Print(\"File path: \",files[i].Path,\" age: \",files[i].age,\"\\n\")\n}\n</code></pre>\n\n<p><code>for</code> loops over arrays are better written using <code>range</code> iterator. This makes the code easier to read, avoids silly mistakes, and it works with other structures like maps and channels.</p>\n\n<pre><code>for _,file := range files {\n    fmt.Print(\"File path: \",file.Path,\" age: \",file.age,\"\\n\")\n}\n</code></pre>\n\n<p>See <a href=\"https://gobyexample.com/range\" rel=\"nofollow noreferrer\">Go by Example: Range</a> for more.</p>\n\n<hr>\n\n<p>Since you have a newline at the end and a space between each element, <code>fmt.Println</code> might work out better than <code>fmt.Print</code>. It automatically puts spaces between each element and a newline at the end.</p>\n\n<pre><code>fmt.Println(\"File path:\", file.Path, \"age:\", file.age)\n</code></pre>\n"}], "owner": {"reputation": 1584, "user_id": 6778826, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HOfOO.jpg?s=128&g=1", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/6778826/aleksandar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "closed_date": 1513595383, "accepted_answer_id": 47247647, "answer_count": 1, "score": -4, "last_activity_date": 1510483627, "creation_date": 1510481256, "question_id": 47247555, "link": "https://stackoverflow.com/questions/47247555/how-to-sort-a-array-slice-in-a-go-way", "closed_reason": "Opinion-based", "title": "How to sort a array/slice in a go way", "body": "<p>I have the following code and ask my self is this the \"go way\" to solve the following requirement.</p>\n\n<p>I need to print a directory tree sorted by file age.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/kr/fs\"\n    \"os\"\n    \"time\"\n    \"sort\"\n)\n\ntype fileinfo struct {\n    Path string\n    age time.Duration\n}\n\nfunc main() {\n    fmt.Print(\"test range of fs\")\n\n    walker := fs.Walk(\"../\")\n\n    var files []fileinfo\n\n    for walker.Step() {\n        if err := walker.Err(); err != nil {\n            fmt.Fprintln(os.Stderr, err)\n            continue\n        }\n\n        age := time.Now().Sub(walker.Stat().ModTime())\n        files = append(files,fileinfo{walker.Path(),age})\n    }\n\n    sort.Slice(files, func(i, j int) bool {\n        return files[i].age &lt; files[j].age\n    })\n    for i:=0; i &lt; len(files) ; i++ {\n        fmt.Print(\"File path: \",files[i].Path,\" age: \",files[i].age,\"\\n\")\n    }\n}\n</code></pre>\n\n<p>What's your opinion to the code?</p>\n\n<p>Thanks for help</p>\n"}, {"tags": ["c++", "c", "winapi", "go", "wincrypt"], "comments": [{"owner": {"reputation": 3577, "user_id": 2176813, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/Nv7lK.jpg?s=128&g=1", "display_name": "tambre", "link": "https://stackoverflow.com/users/2176813/tambre"}, "edited": false, "score": 0, "creation_date": 1510480007, "post_id": 47247118, "comment_id": 81444972, "body": "C != C++. Tag only with the language that you&#39;re using, unless both are actually relevant. That said, this looks like C."}, {"owner": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "reply_to_user": {"reputation": 3577, "user_id": 2176813, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/Nv7lK.jpg?s=128&g=1", "display_name": "tambre", "link": "https://stackoverflow.com/users/2176813/tambre"}, "edited": false, "score": 1, "creation_date": 1510488918, "post_id": 47247118, "comment_id": 81447377, "body": "@tambre: <code>error.Fatal(...);</code> doesn&#39;t look much like C to me."}, {"owner": {"reputation": 3577, "user_id": 2176813, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/Nv7lK.jpg?s=128&g=1", "display_name": "tambre", "link": "https://stackoverflow.com/users/2176813/tambre"}, "reply_to_user": {"reputation": 35031, "user_id": 1889329, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/57bec3f0b9c5879cdd9d9fa2e8629318?s=128&d=identicon&r=PG&f=1", "display_name": "IInspectable", "link": "https://stackoverflow.com/users/1889329/iinspectable"}, "edited": false, "score": 0, "creation_date": 1510489278, "post_id": 47247118, "comment_id": 81447501, "body": "@IInspectable Ah, didn&#39;t notice that, in that case it might actually be C++. That said, the rest of the code is hardly C++ - using C-style booleans, using C-style null pointers, C-style casts, C strings, manual allocation/freeing, not using functions from the <code>std</code> namespace, what seem to be global enum values and probably more."}, {"owner": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 1, "creation_date": 1510491915, "post_id": 47247118, "comment_id": 81448419, "body": "you must direct set size of rc4 key in call <code>CryptDeriveKey</code> - different ket size - different result. you can use equal key size in both methods for get the same result"}, {"owner": {"reputation": 158803, "user_id": 246342, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8ba0aea3f521082f18dd7c186e7d4c3?s=128&d=identicon&r=PG", "display_name": "Alex K.", "link": "https://stackoverflow.com/users/246342/alex-k"}, "edited": false, "score": 0, "creation_date": 1510491921, "post_id": 47247118, "comment_id": 81448422, "body": "Well the Windows code is calling CryptDeriveKey() to transform your input key into a stronger derived key, where are you doing that in your Go code?"}, {"owner": {"reputation": 263, "user_id": 1825951, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9c30a36ac42be226b0b23c1ad0464356?s=128&d=identicon&r=PG", "display_name": "b00stfr3ak", "link": "https://stackoverflow.com/users/1825951/b00stfr3ak"}, "reply_to_user": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 0, "creation_date": 1510504947, "post_id": 47247118, "comment_id": 81452749, "body": "@RbMm the default windows key length for rc4 looks to be 128 bits. However, changing the windows code and go code to &quot;passwordpassword&quot; still doesn&#39;t make them match."}, {"owner": {"reputation": 25518, "user_id": 6401656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jtwou.jpg?s=128&g=1", "display_name": "RbMm", "link": "https://stackoverflow.com/users/6401656/rbmm"}, "edited": false, "score": 1, "creation_date": 1510509918, "post_id": 47247118, "comment_id": 81454450, "body": "default key length depend from used provider and possible windows version"}, {"owner": {"reputation": 263, "user_id": 1825951, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9c30a36ac42be226b0b23c1ad0464356?s=128&d=identicon&r=PG", "display_name": "b00stfr3ak", "link": "https://stackoverflow.com/users/1825951/b00stfr3ak"}, "edited": false, "score": 0, "creation_date": 1510510248, "post_id": 47247118, "comment_id": 81454555, "body": "Completely understand, but using 0x00800000 for 128 bit key and 0x00500000 for 40 bit key neither return a matching result."}], "owner": {"reputation": 263, "user_id": 1825951, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9c30a36ac42be226b0b23c1ad0464356?s=128&d=identicon&r=PG", "display_name": "b00stfr3ak", "link": "https://stackoverflow.com/users/1825951/b00stfr3ak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 101, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1510479351, "creation_date": 1510477630, "last_edit_date": 1510479351, "question_id": 47247118, "link": "https://stackoverflow.com/questions/47247118/wincrypt-output-not-matching-other-languages", "title": "wincrypt output not matching other languages", "body": "<p>I've been attempting to play around with the wincrypt api, but can't seem to figure out why the output from CryptEncrypt doesn't match the output from a language like Go.</p>\n\n<h3>wincrypt code</h3>\n\n<pre><code>BYTE *inBuffer = (BYTE*)\"Hello World\";\nHCRYPTPROV phProv = NULL;\nHCRYPTKEY key = NULL;\nHCRYPTHASH hHash = NULL;\nDWORD len = bufLen;\n\nBYTE password[] = \"password\";\nDWORD passLen = strlen((char*)password);\n\nif (!CryptAcquireContext(&amp;phProv, NULL, NULL, PROV_RSA_FULL, 0)) {\n    DWORD dwStatus = GetLastError();\n    error.Fatal(\"CryptAcquireContext error %d\", dwStatus);\n}\n\nif (!CryptCreateHash(phProv, CALG_MD5, 0, 0, &amp;hHash)) {\n    DWORD dwStatus = GetLastError();\n    error.Fatal(\"CryptCreateHash error %d\", dwStatus);\n}\n\nif (!hHash)\n    error.Fatal(\"Hash create fail\");\n\nif (!CryptHashData(hHash, password, passLen, 0)) {\n    DWORD dwStatus = GetLastError();\n    error.Fatal(\"CryptHashData error %d\", dwStatus);\n}\n\nif (!CryptDeriveKey(phProv, CALG_RC4, hHash, CRYPT_EXPORTABLE, &amp;key)) {\n    DWORD dwStatus = GetLastError();\n    error.Fatal(\"CryptDeriveKey error %d\", dwStatus);\n}\n\nif (!CryptEncrypt(key, 0, TRUE, 0, NULL, &amp;len, 0)) {\n    DWORD dwStatus = GetLastError();\n    error.Fatal(\"CryptEncrypt error %d\", dwStatus);\n}\n\noutBuffLen = len;\nBYTE *cipherBlock = (BYTE*)calloc(len, sizeof(BYTE));\nmemcpy_s(cipherBlock, len, inBuffer, len);\nif (!CryptEncrypt(key, 0, TRUE, 0, cipherBlock, &amp;len, outBuffLen)) {\n    DWORD dwStatus = GetLastError();\n    error.Fatal(\"CryptEncrypt error %d\", dwStatus);\n}\n\n\nCryptDestroyKey(key);\nCryptReleaseContext(phProv, 0);\nCryptDestroyHash(hHash);\n</code></pre>\n\n<h3>go code</h3>\n\n<pre><code>package main\n\nimport (\n    \"crypto/rc4\"\n    \"fmt\"\n    \"log\"\n)\n\nfunc main() {\n    key := []byte(\"5f4dcc3b5aa765d61d8327deb882cf99\")\n    src := []byte(\"Hello World\")\n    c, err := rc4.NewCipher(key)\n    if err != nil {\n        log.Fatal(err)\n    }\n    dst := make([]byte, len(src))\n    c.XORKeyStream(dst, src)\n    for _, x := range dst {\n        fmt.Printf(\"%02X \", x)\n    }\n}\n</code></pre>\n\n<p>If the key is \"password\" the output should be: B7 90 54 62 23 1E E3 C1 13 3D CF</p>\n\n<p>If the key is md5 hash of \"password\" (\"5f4dcc3b5aa765d61d8327deb882cf99\") the output should be: E4 F9 36 64 83 8A 3F 78 41 82 15 </p>\n\n<p>The output I'm getting from wincrypt: a0 9d 47 51 1a 7b 32 8e 03 54 c3 </p>\n\n<p>Is there something simple I'm missing? </p>\n"}, {"tags": ["testing", "go"], "owner": {"reputation": 1562, "user_id": 4303758, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/nbL0i.jpg?s=128&g=1", "display_name": "Manjeet Thakur", "link": "https://stackoverflow.com/users/4303758/manjeet-thakur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 710, "favorite_count": 0, "closed_date": 1510474748, "answer_count": 0, "score": 4, "last_activity_date": 1510473626, "creation_date": 1510473626, "question_id": 47246697, "link": "https://stackoverflow.com/questions/47246697/how-to-test-the-code-in-go-lang-if-input-read-from-terminal", "closed_reason": "Duplicate", "title": "How to test the code in go-lang if input read from terminal", "body": "<p>I have written a code in golang which read input from the terminal and then reverse that input in an array. I want to write a test for that function. So how I write a test case for this kind of problem.</p>\n\n<blockquote>\n  <p>here is my code which is working</p>\n</blockquote>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"strings\"\n    \"testing\"\n)\n\nfunc main() {\n    s := reverse()\n\n    fmt.Println(s)\n}\nfunc Reverse() []string {\n    var s []string\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Print(\"Enter text the value of array: \")\n    text, _ := reader.ReadString('\\n')\n    newArray := strings.Fields(text)\n    for i := len(newArray) - 1; i &gt;= 0; i-- {\n        s = append(s, newArray[i])\n    }\n    return s\n}\n</code></pre>\n\n<p>here I am trying to write test function like this </p>\n\n<pre><code>func TestReverseToReturnReversedInputString(t *testing.T) {\n   actualResult := Reverse()\n}\n</code></pre>\n\n<p>What here issue is my Reverse function does not take any input. I read input from terminal so any way to provide input so test case is working</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510495104, "post_id": 47246669, "comment_id": 81449448, "body": "One of the best advices here might be: Do not try to write traditional style OOP in Go."}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510495165, "post_id": 47246669, "comment_id": 81449470, "body": "LOL! Yes, quite. I complain enough about OOP, but enough years and you find the behaviour coming back."}], "answers": [{"comments": [{"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "edited": false, "score": 1, "creation_date": 1510474469, "post_id": 47246755, "comment_id": 81443784, "body": "Huh. Really? That was it? Been doing this stuff for a very long time - including in go for quite some time - and the lack of coherence on pointers and dereferencing in go still throws me for a loop."}, {"owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "edited": false, "score": 0, "creation_date": 1510474579, "post_id": 47246755, "comment_id": 81443807, "body": "Almost. Apparently, I would need to implement <code>func (b CarBox) GetToy(j int)</code> and <i>not</i> <code>func (b CarBox) GetToy(j int)</code>. <a href=\"https://play.golang.org/p/p6KQ5hgQmQ\" rel=\"nofollow noreferrer\">play.golang.org/p/p6KQ5hgQmQ</a> vs <a href=\"https://play.golang.org/p/KtJ3NLe4DO\" rel=\"nofollow noreferrer\">play.golang.org/p/KtJ3NLe4DO</a> . If you update the answer, happy to take it."}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "reply_to_user": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "edited": false, "score": 0, "creation_date": 1510474806, "post_id": 47246755, "comment_id": 81443872, "body": "In your question above you are using <code>*CarBox</code> to satisfy the <code>Box</code> interface. In the second (error free link) you have replaced it with <code>CarBox</code>. My answer is according to the question above."}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 6, "last_activity_date": 1510474143, "creation_date": 1510474143, "answer_id": 47246755, "question_id": 47246669, "link": "https://stackoverflow.com/questions/47246669/how-do-i-have-a-golang-interface-implementation-return-implementation-of-another/47246755#47246755", "title": "How do I have a golang interface implementation return implementation of another interface?", "body": "<p>First of all you almost never need a pointer to an interface type. So <code>GetToy</code> method signature should be changed to:</p>\n\n<pre><code>type Box interface {\n    GetToy(int) (Toy, error) // use Toy, not *Toy\n}\n</code></pre>\n\n<p>Now, note that interfaces are satisfied by types implicitly. As a result, by implementing the <code>Play()</code> method, <code>*Matchbox</code> implicitly satisfies the <code>Toy</code> interface (note the <code>*</code>, the type implementing the <code>Toy</code> interface is <em>pointer to <code>Matchbox</code></em> and <em>not <code>Matchbox</code></em>).</p>\n\n<p>This means a value of type <code>*Matchbox</code> can be substituted for type <code>Toy</code>. So what remains is to fix the <code>GetToy</code> method defined on <code>*CarBox</code>:</p>\n\n<pre><code>func (b *CarBox) GetToy(j int) (Toy, error) {\n    return b.toys[j], nil\n}\n</code></pre>\n\n<p>Now <code>GetToy</code> above will return a <code>*Matchbox</code> which does implement the <code>Toy</code> interface.</p>\n"}, {"comments": [{"owner": {"reputation": 91, "user_id": 13092277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10b3dbb38ceed74a167b59f32f1a91ae?s=128&d=identicon&r=PG&f=1", "display_name": "shaktisinghr", "link": "https://stackoverflow.com/users/13092277/shaktisinghr"}, "edited": false, "score": 0, "creation_date": 1610702925, "post_id": 47246913, "comment_id": 116221164, "body": "This is correct and helped with adding a missing ampersand. Can you please provide more details on the relation between return type and receiver type."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 91, "user_id": 13092277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10b3dbb38ceed74a167b59f32f1a91ae?s=128&d=identicon&r=PG&f=1", "display_name": "shaktisinghr", "link": "https://stackoverflow.com/users/13092277/shaktisinghr"}, "edited": false, "score": 0, "creation_date": 1610803144, "post_id": 47246913, "comment_id": 116249806, "body": "@shaktisinghr, general difference is function operating with a a <i>real object</i> via pointer and can change it (pointer receiver) or getting <i>a copy of real object</i> (value receiver). In latter case you can modify only a copy so original object would remain untouched. How to choose what to use? Definitely pointer if you need perform changes. Also you can use pointer if you have a very huge object - so copying will require many resources. If you have small object it&#39;s faster to pass it as a copy. <a href=\"https://tour.golang.org/methods/8\" rel=\"nofollow noreferrer\">tour.golang.org/methods/8</a> or <a href=\"https://dev.to/chen/gos-method-receiver-pointer-vs-value-1kl8\" rel=\"nofollow noreferrer\">dev.to/chen/gos-method-receiver-pointer-vs-value-1kl8</a>"}, {"owner": {"reputation": 91, "user_id": 13092277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10b3dbb38ceed74a167b59f32f1a91ae?s=128&d=identicon&r=PG&f=1", "display_name": "shaktisinghr", "link": "https://stackoverflow.com/users/13092277/shaktisinghr"}, "edited": false, "score": 0, "creation_date": 1611019382, "post_id": 47246913, "comment_id": 116310706, "body": "the explanation seems to be about pointer vs. value receiver in terms of modifying the object. My earlier comment was regarding return type."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 91, "user_id": 13092277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10b3dbb38ceed74a167b59f32f1a91ae?s=128&d=identicon&r=PG&f=1", "display_name": "shaktisinghr", "link": "https://stackoverflow.com/users/13092277/shaktisinghr"}, "edited": false, "score": 0, "creation_date": 1611220638, "post_id": 47246913, "comment_id": 116382072, "body": "I&#39;ve seen in code return of interface type. But it&#39;s not very good as leads to more complex program. Dave Cheney&#39;s article on solid principles in Go <a href=\"https://dave.cheney.net/2016/08/20/solid-go-design\" rel=\"nofollow noreferrer\">dave.cheney.net/2016/08/20/solid-go-design</a>"}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1510481974, "last_edit_date": 1510481974, "creation_date": 1510475599, "answer_id": 47246913, "question_id": 47246669, "link": "https://stackoverflow.com/questions/47246669/how-do-i-have-a-golang-interface-implementation-return-implementation-of-another/47246913#47246913", "title": "How do I have a golang interface implementation return implementation of another interface?", "body": "<p>Some fixes: <a href=\"https://play.golang.org/p/-mDr5SDZvV\" rel=\"nofollow noreferrer\">https://play.golang.org/p/-mDr5SDZvV</a></p>\n\n<p>Pointer to interface is extremely rearly required thing. Use interface - it can contain a concrete type. </p>\n\n<p><strong>UPDATE</strong>:\nIf you wish to have a method with pointer receiver like <code>func (b *CarBox) GetToy(j int)</code> you may return pointer from <code>Tester</code> function (pay attention to <strong>&amp;</strong>):</p>\n\n<pre><code>func Tester() Box {\n    return &amp;CarBox{}\n}\n</code></pre>\n\n<p>This way interface value returned from Tester will conclude a pointer to the <code>CarBox</code> instance. Thus Go runtime will be able to run methods with pointer receiver. Otherwise there would be only a value not a pointer. So only methods with value receivers could be called.</p>\n"}], "owner": {"reputation": 12031, "user_id": 736714, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/70d2c699f89a1f7f76b436bc79b4d5be?s=128&d=identicon&r=PG", "display_name": "deitch", "link": "https://stackoverflow.com/users/736714/deitch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4469, "favorite_count": 0, "accepted_answer_id": 47246755, "answer_count": 2, "score": 3, "last_activity_date": 1510481974, "creation_date": 1510473297, "question_id": 47246669, "link": "https://stackoverflow.com/questions/47246669/how-do-i-have-a-golang-interface-implementation-return-implementation-of-another", "title": "How do I have a golang interface implementation return implementation of another interface?", "body": "<p>Specific example is here: <a href=\"https://play.golang.org/p/ZNmviKWLwe\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ZNmviKWLwe</a></p>\n\n<p>I have an interface A. I expect all implementations of A to have a certain signature (hence the interface). I expect one of those to return something useful that implements another interface.</p>\n\n<pre><code>type Box interface {\n    GetToy(int) (*Toy, error)\n}\ntype Toy interface{\n    Play()\n}\n\n\ntype CarBox struct {\n   Length int\n   Width int\n   Height int\n   toys []*Matchbox\n}\ntype Matchbox struct {}\n\nfunc (b *CarBox) Size () int {\n    return b.Length*b.Width*b.Height\n}\nfunc (b *CarBox) GetToy(j int) (*Matchbox, error) {\n    return b.toys[j], nil\n}\nfunc (m *Matchbox) Play() {\n    fmt.Println(\"Zoom!\")\n}\n</code></pre>\n\n<p>But of course, it doesn't work, because <code>GetToy()</code> returns <code>*Matchbox</code> and not <code>*Toy</code>, even though <code>Matchbox</code> is a perfectly acceptable implementation of <code>Toy</code>. And, no, it isn't because of the pointers; it gives the same result whether I return <code>*Toy</code> in <code>GetToy</code> or just <code>Toy</code>:</p>\n\n<pre><code>tmp/sandbox721971102/main.go:33:15: cannot use CarBox literal (type CarBox) as type Box in return argument:\n    CarBox does not implement Box (wrong type for GetToy method)\n        have GetToy(int) (*Matchbox, error)\n        want GetToy(int) (*Toy, error)\n</code></pre>\n\n<p>Obviously my pattern doesn't match how go works. What is the \"correct\" way to go about doing this? </p>\n"}, {"tags": ["sockets", "go", "tcp"], "comments": [{"owner": {"reputation": 5380, "user_id": 146620, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4ba0c9119010302832e1d129b38228b?s=128&d=identicon&r=PG", "display_name": "Graham King", "link": "https://stackoverflow.com/users/146620/graham-king"}, "edited": false, "score": 1, "creation_date": 1510684293, "post_id": 47246030, "comment_id": 81536383, "body": "Even if you read slowly from the local TCP buffer, the kernel can still fetch up to <code>&#47;proc&#47;sys&#47;net&#47;ipv4&#47;tcp_rmem</code> (third number is max buffer size in bytes) at a time. For a long-lived connection you can average it over time (buffer fills in a burst, consume slowly, buffer re-fills, etc). To really limit bandwidth you need to do it at the OS layer, not in Go. See <a href=\"https://unix.stackexchange.com/a/28203/40168\">unix.stackexchange.com/a/28203/40168</a> ."}], "answers": [{"tags": [], "owner": {"reputation": 326, "user_id": 6192933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e97606b02ea1d36442a43b46fccea9a5?s=128&d=identicon&r=PG&f=1", "display_name": "Joseph Paul", "link": "https://stackoverflow.com/users/6192933/joseph-paul"}, "is_accepted": false, "score": 0, "last_activity_date": 1517059132, "creation_date": 1517059132, "answer_id": 48476209, "question_id": 47246030, "link": "https://stackoverflow.com/questions/47246030/limit-tcp-download-speed-in-golang/48476209#48476209", "title": "Limit tcp download speed in Golang", "body": "<p>As said in the comment, the easiest way is to do it at the OS level with wondershaper tool.\nIf you look at '<a href=\"https://github.com/magnific0/wondershaper\" rel=\"nofollow noreferrer\">wondershaper</a>' script, it uses '/sbin/tc' command from the '<a href=\"https://github.com/shemminger/iproute2\" rel=\"nofollow noreferrer\">iproute2</a>' package.\nI understand that it is not exactly what you would like to do, but you can go at a lower level by executing 'tc' commands in your source code with os.exec().\nImplementing your own \"traffic control\" algorithm is maybe too much work and not necessary for your goal.</p>\n"}], "owner": {"reputation": 123, "user_id": 2806415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10cc5883e17934a5fd4a33ad966fc101?s=128&d=identicon&r=PG&f=1", "display_name": "Aleksey Kanaev", "link": "https://stackoverflow.com/users/2806415/aleksey-kanaev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 830, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1517059132, "creation_date": 1510467061, "question_id": 47246030, "link": "https://stackoverflow.com/questions/47246030/limit-tcp-download-speed-in-golang", "title": "Limit tcp download speed in Golang", "body": "<p>I would like to be able to limit bandwidth of tcp connection in my code. <a href=\"https://stackoverflow.com/questions/27869858/limiting-bandwidth-of-http-get\">This</a> question has some clues, but not exactly what I want. I have tried to hack src code of go standard lib (net/tcp package), using similar approach, but failed. \nMy main idea is to somehow write data from syscall to internal buffer slowly, thus making OS to drop tcp packets.</p>\n"}, {"tags": ["go", "undefined-behavior"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 3, "last_activity_date": 1510464471, "last_edit_date": 1510464471, "creation_date": 1510464058, "answer_id": 47245738, "question_id": 47245660, "link": "https://stackoverflow.com/questions/47245660/why-is-this-code-undefined-behaviour/47245738#47245738", "title": "Why is this code undefined behaviour?", "body": "<p>It's all explained in the <a href=\"https://golang.org/ref/mem\" rel=\"nofollow noreferrer\">Go Memory Model</a>.</p>\n\n<p>In this example, there is not a happens before relationship between incrementing <code>i</code> and and printing <code>i</code>. Because there is not a happens before relationship, the main goroutine may or may not see the changes to <code>i</code>.</p>\n\n<p>The compiler is allowed to optimize away <code>i++</code> because there's no guarantee that the changes to <code>i</code> will be observed.</p>\n"}], "owner": {"reputation": 899, "user_id": 8481532, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/91806192f478f41d284c0edff368480a?s=128&d=identicon&r=PG&f=1", "display_name": "lucky yang", "link": "https://stackoverflow.com/users/8481532/lucky-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "closed_date": 1510468600, "answer_count": 1, "score": 0, "last_activity_date": 1510464471, "creation_date": 1510463321, "question_id": 47245660, "link": "https://stackoverflow.com/questions/47245660/why-is-this-code-undefined-behaviour", "closed_reason": "Duplicate", "title": "Why is this code undefined behaviour?", "body": "<pre><code>package main\n\nimport \"time\"\nimport \"fmt\"\n\nvar i int = 0\n\nfunc loopInc() {\n    for {\n        i++\n    }\n}\n\nfunc main() {\n    go loopInc()\n    &lt;-time.After(1 * time.Millisecond)\n    fmt.Println(i)\n}\n</code></pre>\n\n<p>This code would always print 0.</p>\n\n<p>I dumped the executable file and found that the go my <code>loopInc</code> function was compiled to a do-nothing loop. <code>i++</code> doesn't exist in it.</p>\n\n<p>Why?</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "owner": {"reputation": 358, "user_id": 7296857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fda7320a4b822f1f388b5996f6f4f00c?s=128&d=identicon&r=PG&f=1", "display_name": "user", "link": "https://stackoverflow.com/users/7296857/user"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 118, "favorite_count": 0, "closed_date": 1510469280, "answer_count": 0, "score": 1, "last_activity_date": 1510469313, "creation_date": 1510452492, "question_id": 47244762, "link": "https://stackoverflow.com/questions/47244762/whats-the-difference-between-these-different-import-statements-for-the-cloud-da", "closed_reason": "Duplicate", "title": "What&#39;s the difference between these different import statements for the Cloud Datastore in Go?", "body": "<p>I'm reading about how to use the Datastore and have come across different import statements in Google's own guides:</p>\n\n<p><code>import \u201cgoogle.golang.org/appengine/datastore\u201d</code></p>\n\n<p>^ from \u201cGetting started with the Google Cloud Datastore API\u201d (<a href=\"https://cloud.google.com/datastore/docs/datastore-api-tutorial\" rel=\"nofollow noreferrer\">https://cloud.google.com/datastore/docs/datastore-api-tutorial</a>)</p>\n\n<p><code>import \u201cappengine/datastore\u201d</code></p>\n\n<p>^ from \u201cCreating a Guestbook Application\u201d (<a href=\"https://cloud.google.com/appengine/docs/standard/go/getting-started/creating-guestbook\" rel=\"nofollow noreferrer\">https://cloud.google.com/appengine/docs/standard/go/getting-started/creating-guestbook</a>), older version of code</p>\n\n<p><code>import \u201ccloud.google.com/go/datastore\u201d</code></p>\n\n<p>^ from \u201cCreating a Guestbook Application\u201d, more recent code.</p>\n\n<p>What's the difference between these statements? What's the \"standard\" way to import the datastore package, if any?</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1510462067, "post_id": 47244615, "comment_id": 81441452, "body": "The program does not print the expected value because there&#39;s a data race on variable <code>i</code>."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 12, "last_activity_date": 1510472760, "last_edit_date": 1510472760, "creation_date": 1510464426, "answer_id": 47245780, "question_id": 47244615, "link": "https://stackoverflow.com/questions/47244615/is-this-because-the-go-compiler-optimized-the-code/47245780#47245780", "title": "Is this because the go compiler optimized the code?", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/mem\" rel=\"noreferrer\"><strong>The Go Memory Model</strong></a></p>\n  \n  <p>Version of May 31, 2014</p>\n  \n  <p><strong>Introduction</strong></p>\n  \n  <p>The Go memory model specifies the conditions under which reads of a\n  variable in one goroutine can be guaranteed to observe values produced\n  by writes to the same variable in a different goroutine.</p>\n  \n  <p><strong>Advice</strong></p>\n  \n  <p>Programs that modify data being simultaneously accessed by multiple\n  goroutines must serialize such access.</p>\n  \n  <p>To serialize access, protect the data with channel operations or other\n  synchronization primitives such as those in the sync and sync/atomic\n  packages.</p>\n  \n  <p>If you must read the rest of this document to understand the behavior\n  of your program, you are being too clever.</p>\n  \n  <p>Don't be clever.</p>\n  \n  <p><strong>Synchronization</strong></p>\n\n<pre><code>var a string\n\nfunc hello() {\n  go func() { a = \"hello\" }()\n  print(a)\n}\n</code></pre>\n  \n  <p>the assignment to a is not followed by any synchronization event, so\n  it is not guaranteed to be observed by any other goroutine. In fact,\n  an aggressive compiler might delete the entire go statement.</p>\n</blockquote>\n\n<hr>\n\n<p>The assignment to <code>i</code>, via increment <code>i++</code> (<code>i = i + 1</code>), is not followed by any synchronization event, so it is not guaranteed to be observed by any other goroutine. In fact, an aggressive compiler might delete the entire <code>i++</code> statement.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport \"time\"\n\nfunc main() {\n    i := 1\n    go func() {\n        for {\n            i++\n        }\n    }()\n    &lt;-time.After(1 * time.Millisecond)\n    println(i)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>1\n</code></pre>\n\n<p>The goroutine reduces to:</p>\n\n<pre><code>\"\".main.func1 STEXT nosplit size=2 args=0x8 locals=0x0\n    0x0000 00000 (elide.go:7)   TEXT    \"\".main.func1(SB), NOSPLIT, $0-8\n    0x0000 00000 (elide.go:7)   FUNCDATA    $0, gclocals\u00b72a5305abe05176240e61b8620e19a815(SB)\n    0x0000 00000 (elide.go:7)   FUNCDATA    $1, gclocals\u00b733cdeccccebe80329f1fdbee7f5874cb(SB)\n    0x0000 00000 (elide.go:9)   JMP 0\n</code></pre>\n\n<p>To the compiler,</p>\n\n<pre><code>for {\n    i++\n}\n</code></pre>\n\n<p>can be implemented by incrementing a register forever, essentially a no-op <code>for</code> loop.</p>\n\n<pre><code>for { }\n</code></pre>\n\n<p>After inserting a <code>print</code> statement,</p>\n\n<pre><code>package main\n\nimport \"time\"\n\nfunc main() {\n    i := 1\n    go func() {\n        for {\n            i++\n            println(\"+1\")\n        }\n    }()\n    &lt;-time.After(1 * time.Millisecond)\n    println(i)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>+1\n+1\n&lt;&lt; SNIP &gt;&gt;\n+1\n+1\n432\n</code></pre>\n\n<p>The goroutine expands to,</p>\n\n<pre><code>\"\".main.func1 STEXT size=81 args=0x8 locals=0x18\n    0x0000 00000 (elide.go:7)   TEXT    \"\".main.func1(SB), $24-8\n    0x0000 00000 (elide.go:7)   MOVQ    (TLS), CX\n    0x0009 00009 (elide.go:7)   CMPQ    SP, 16(CX)\n    0x000d 00013 (elide.go:7)   JLS 74\n    0x000f 00015 (elide.go:7)   SUBQ    $24, SP\n    0x0013 00019 (elide.go:7)   MOVQ    BP, 16(SP)\n    0x0018 00024 (elide.go:7)   LEAQ    16(SP), BP\n    0x001d 00029 (elide.go:7)   FUNCDATA    $0, gclocals\u00b7a36216b97439c93dafebe03e7f0808b5(SB)\n    0x001d 00029 (elide.go:7)   FUNCDATA    $1, gclocals\u00b733cdeccccebe80329f1fdbee7f5874cb(SB)\n    0x001d 00029 (elide.go:8)   MOVQ    \"\".&amp;i+32(SP), AX\n    0x0022 00034 (elide.go:9)   INCQ    (AX)\n    0x0025 00037 (elide.go:10)  PCDATA  $0, $0\n    0x0025 00037 (elide.go:10)  CALL    runtime.printlock(SB)\n    0x002a 00042 (elide.go:10)  LEAQ    go.string.\"+1\\n\"(SB), AX\n    0x0031 00049 (elide.go:10)  MOVQ    AX, (SP)\n    0x0035 00053 (elide.go:10)  MOVQ    $3, 8(SP)\n    0x003e 00062 (elide.go:10)  PCDATA  $0, $0\n    0x003e 00062 (elide.go:10)  CALL    runtime.printstring(SB)\n    0x0043 00067 (elide.go:10)  PCDATA  $0, $0\n    0x0043 00067 (elide.go:10)  CALL    runtime.printunlock(SB)\n    0x0048 00072 (elide.go:9)   JMP 29\n    0x004a 00074 (elide.go:9)   NOP\n    0x004a 00074 (elide.go:7)   PCDATA  $0, $-1\n    0x004a 00074 (elide.go:7)   CALL    runtime.morestack_noctxt(SB)\n    0x004f 00079 (elide.go:7)   JMP 0\n</code></pre>\n\n<p>The increased complexity of the goroutine means that the compiler no longer considers dedicating a register to the value of <code>i</code>. The in-memory value of <code>i</code> is incremented, which makes the updates visible, with a data race, to the <code>main</code> goroutine.</p>\n\n<pre><code>==================\nWARNING: DATA RACE\n\nRead at 0x00c420094000 by \nmain goroutine:\n  main.main()\n      /home/peter/gopath/src/lucky.go:14 +0xac\n\nPrevious write at 0x00c420094000 by \ngoroutine 5:\n  main.main.func1()\n      /home/peter/gopath/src/lucky.go:9 +0x4e\n\nGoroutine 5 (running) created at:\n  main.main()\n      /home/peter/gopath/src/lucky.go:7 +0x7a\n==================\n</code></pre>\n\n<hr>\n\n<p>For your expected result, add some synchronization,</p>\n\n<pre><code>package main\n\nimport (\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    mx := new(sync.Mutex)\n    i := 1\n    go func() {\n        for {\n            mx.Lock()\n            i++\n            mx.Unlock()\n        }\n    }()\n    &lt;-time.After(1 * time.Second)\n    mx.Lock()\n    println(i)\n    mx.Unlock()\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>41807838\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1510471681, "post_id": 47246347, "comment_id": 81443268, "body": "The primary virtue of a program is correctness. You don&#39;t say which examples are incorrect. For example, at least examples 0, 1, and 2."}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1510473549, "post_id": 47246347, "comment_id": 81443623, "body": "Dear @peterSO: I think example 2 has no problem, do you see any? (using <code>atomic.AddInt64(&amp;i, 1)</code> )"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1510474543, "post_id": 47246347, "comment_id": 81443803, "body": "The Go memory model contains no explicit mention of atomic variables. Some have argued for, at best, somethiing like this: An implementation should ensure that the last value (in modification order) assigned by an atomic operation will become visible to all other goroutines in a finite period of time. You would see updated values of <code>i</code> sometime between now and something less than infinity. Essentially, the value of <code>i</code> is undefined."}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1510474982, "post_id": 47246347, "comment_id": 81443906, "body": "Yes, <code>LoadInt64 atomically loads *addr.</code> just samples at moment system provided, it is guaranteed  <b>atomic synchronization</b> but time of sampling is unknown.  so using example 2 here is OK, but it depends to use case. thanks again."}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": false, "score": 1, "last_activity_date": 1510476704, "last_edit_date": 1510476704, "creation_date": 1510470186, "answer_id": 47246347, "question_id": 47244615, "link": "https://stackoverflow.com/questions/47244615/is-this-because-the-go-compiler-optimized-the-code/47246347#47246347", "title": "Is this because the go compiler optimized the code?", "body": "<p>Concurrent access to the variable <code>i</code> need to be synchronized:</p>\n\n<blockquote>\n  <p><strong>synchronization</strong> is better done with channels or the facilities of the\n  sync package. Share memory by communicating; don't communicate by\n  sharing memory.</p>\n</blockquote>\n\n<p>ref: <a href=\"https://golang.org/pkg/sync/atomic/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/sync/atomic/</a></p>\n\n<hr>\n\n<p>This is interesting, so I'm sharing my experiments:  </p>\n\n<p>0- Your code using <code>time.Sleep(1 * time.Second)</code> (<strong>not recommended-not synchronized</strong>):</p>\n\n<pre><code>package main\n\nimport \"time\"\n\nfunc main() {\n    i := 1\n    go func() {\n        for {\n            i++\n        }\n    }()\n    time.Sleep(1 * time.Second)\n    println(i)\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>1\n</code></pre>\n\n<hr>\n\n<p>1- Using <code>i := new(int)</code> (<strong>not recommended-not synchronized</strong>):</p>\n\n<pre><code>package main\n\nimport \"time\"\n\nfunc main() {\n    i := new(int)\n    go func() {\n        for {\n            *i++\n        }\n    }()\n    time.Sleep(1 * time.Second)\n    println(*i)\n}\n</code></pre>\n\n<p>output(CPU: i7-7700K @ 4.2GHz):</p>\n\n<pre><code>772252413\n</code></pre>\n\n<hr>\n\n<p>2- Synchronizing using <code>atomic.AddInt64(&amp;i, 1)</code>(<a href=\"https://golang.org/pkg/sync/atomic/\" rel=\"nofollow noreferrer\">Package atomic provides low-level atomic memory primitives useful for implementing synchronization algorithms</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"sync/atomic\"\n    \"time\"\n)\n\nfunc main() {\n    i := int64(1)\n    go func() {\n        for {\n            atomic.AddInt64(&amp;i, 1) // free running counter\n        }\n    }()\n    time.Sleep(1 * time.Second)\n    println(atomic.LoadInt64(&amp;i)) // sampling the counter\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>233008800\n</code></pre>\n\n<hr>\n\n<p>3- Synchronizing using <code>chan int</code>:</p>\n\n<pre><code>package main\n\nimport \"time\"\n\nfunc main() {\n    ch := make(chan int)\n    go func() {\n        timeout := time.NewTimer(1 * time.Second)\n        defer timeout.Stop()\n        i := 1\n        for {\n            select {\n            case &lt;-timeout.C:\n                ch &lt;- i\n                return\n            default:\n                i++\n            }\n        }\n    }()\n    //time.Sleep(1 * time.Second)\n    println(&lt;-ch)\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>272702341\n</code></pre>\n\n<hr>\n\n<p>4- Synchronizing using <code>sync.WaitGroup</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    var done sync.WaitGroup\n    done.Add(1)\n    i := 1\n    go func() {\n        defer done.Done()\n        timeout := time.NewTimer(1 * time.Second)\n        defer timeout.Stop()\n        for {\n            select {\n            case &lt;-timeout.C:\n                return\n            default:\n                i++\n            }\n        }\n    }()\n    done.Wait()\n    fmt.Println(i)\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>261459418\n</code></pre>\n\n<hr>\n\n<p>5- Synchronizing using quit channel:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    quit := make(chan struct{})\n    i := 1\n    go func() {\n        for {\n            i++\n            select {\n            case &lt;-quit:\n                return\n            default:\n            }\n        }\n    }()\n    time.Sleep(1 * time.Second)\n    quit &lt;- struct{}{}\n    fmt.Println(i)\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>277366276\n</code></pre>\n\n<hr>\n\n<p>6- Synchronizing using <code>sync.RWMutex</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    var i rwm\n    go func() {\n        for {\n            i.inc() // free running counter\n        }\n    }()\n    time.Sleep(1 * time.Second)\n    println(i.read()) // sampling the counter\n}\n\ntype rwm struct {\n    sync.RWMutex\n    i int\n}\n\nfunc (l *rwm) inc() {\n    l.Lock()\n    defer l.Unlock()\n    l.i++\n}\nfunc (l *rwm) read() int {\n    l.RLock()\n    defer l.RUnlock()\n    return l.i\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>24271318\n</code></pre>\n\n<hr>\n\n<p>related topics:</p>\n\n<p><a href=\"https://golang.org/ref/mem\" rel=\"nofollow noreferrer\">The Go Memory Model</a><br>\n<a href=\"https://groups.google.com/forum/#!msg/golang-nuts/Uf6GDcUgEQU/1Sw4aP_i0VoJ\" rel=\"nofollow noreferrer\">There is no equivalent to volatile and register in Go</a><br>\n<a href=\"https://stackoverflow.com/questions/18491032/does-go-support-volatile-non-volatile-variables\">Does Go support volatile / non-volatile variables?</a></p>\n"}], "owner": {"reputation": 899, "user_id": 8481532, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/91806192f478f41d284c0edff368480a?s=128&d=identicon&r=PG&f=1", "display_name": "lucky yang", "link": "https://stackoverflow.com/users/8481532/lucky-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 565, "favorite_count": 2, "accepted_answer_id": 47245780, "answer_count": 2, "score": 8, "last_activity_date": 1510476704, "creation_date": 1510450637, "last_edit_date": 1510475739, "question_id": 47244615, "link": "https://stackoverflow.com/questions/47244615/is-this-because-the-go-compiler-optimized-the-code", "title": "Is this because the go compiler optimized the code?", "body": "<pre><code>package main\n\nimport \"time\"\n\nfunc main() {\n    i := 1\n    go func() {\n        for {\n            i++\n        }\n    }()\n    &lt;-time.After(1 * time.Second)\n    println(i)\n}\n</code></pre>\n\n<p>The output is always <code>1</code>. </p>\n\n<p>However it's absolutely that 1s is enough for the <code>for</code> loop to go over many many times.</p>\n\n<p>I think the <code>i</code> in the closure is the <code>i</code> in the <code>main</code> func. </p>\n\n<p>See the code below.</p>\n\n<pre><code>package main\n\nimport \"time\"\n\nfunc main() {\n    i := 1\n    go func() {\n        for {\n            i++\n            println(\"+1\")\n        }\n    }()\n    &lt;-time.After(1 * time.Second)\n    println(i)\n}\n</code></pre>\n\n<p>After many lines of \"+1\", the output is exactly a great number as expected.</p>\n"}, {"tags": ["go", "nonblocking"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1510445659, "creation_date": 1510445659, "answer_id": 47244184, "question_id": 47243961, "link": "https://stackoverflow.com/questions/47243961/how-to-report-stats-with-ticker-without-blocking-using-channel/47244184#47244184", "title": "How to report stats with ticker without blocking using channel?", "body": "<p>Use select with default to avoid blocking on the ticker. Log when a value is received from the ticker:</p>\n\n<pre><code>select {\ncase &lt;-ticker.C:\n    percent := ( float64(sourceReadedBytes) * float64(100) ) / float64(sourceTotalSizeBytes)\n    og.Printf(\"%v / %v %v%%\", sourceReadedBytes, sourceTotalSizeBytes, percent)\ndefault:\n    // do nothing\n}\n</code></pre>\n"}], "owner": {"reputation": 5444, "user_id": 71964, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1f00d9aa3c469deb0e21156954f2be2b?s=128&d=identicon&r=PG", "display_name": "raspi", "link": "https://stackoverflow.com/users/71964/raspi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 47244184, "answer_count": 1, "score": 2, "last_activity_date": 1510445659, "creation_date": 1510443399, "question_id": 47243961, "link": "https://stackoverflow.com/questions/47243961/how-to-report-stats-with-ticker-without-blocking-using-channel", "title": "How to report stats with ticker without blocking using channel?", "body": "<p>I would like to report various stats every N seconds while reading large file.  I found the ticker and channels but can't figure out how to make it non-blocking while continuing reading the file in the background. I also tried to make string channel and use <code>select{ case: &lt;-msg}</code> but the program crashes to deadlock then. What's the proper way? </p>\n\n<p>Later I'll probably add diffs so that speed and time required can be also included in the periodic report.</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"os\"\n    \"fmt\"\n    \"bufio\"\n    \"strings\"\n    \"time\"\n)\n\nfunc main() {\n    filename := \"large-file.dat\"\n\n    log.Printf(\"Opening file: '%v'\", filename)\n    file, err := os.Open(filename)\n    if err != nil {\n        fmt.Fprintf(os.Stderr, \"File error: %v\", err)\n        os.Exit(1)\n    }\n\n    sourceTotalSizeBytes := uint64(0)\n    sourceReadedBytes := uint64(0)\n\n    if finfo, err := file.Stat(); err == nil {\n        sourceTotalSizeBytes = uint64(finfo.Size())\n        log.Printf(\"Size: %v bytes\", sourceTotalSizeBytes)\n    }\n\n    scanner := bufio.NewScanner(file)\n\n    // Output stats every n seconds\n    ticker := time.NewTicker(time.Second * 2)\n    defer ticker.Stop()\n\n    for scanner.Scan() {\n        lineReader := strings.NewReader(scanner.Text())\n        sourceReadedBytes += uint64(lineReader.Size())\n\n        // Report stats every n seconds\n        &lt;-ticker.C\n        go func() {\n            percent := ( float64(sourceReadedBytes) * float64(100) ) / float64(sourceTotalSizeBytes)\n            log.Printf(\"%v / %v %v%%\", sourceReadedBytes, sourceTotalSizeBytes, percent)\n        }()\n\n        // Simulate work being done to line\n        time.Sleep(time.Millisecond * 10)\n\n    }\n\n    file.Close()\n}\n</code></pre>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1510439911, "post_id": 47243350, "comment_id": 81437611, "body": "<a href=\"https://github.com/search?q=language%3Ago+struct_sockaddr&amp;type=Code&amp;utf8=%E2%9C%93\" rel=\"nofollow noreferrer\">github search is your friend</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1510522927, "post_id": 47243350, "comment_id": 81459002, "body": "From the code snippets visible in the link it looks like you should be able to do it like this <code>(*C.struct_sockaddr)(unsafe.Pointer(&amp;sa))</code>, although I haven&#39;t tested it myself so I&#39;m not 100% sure."}], "answers": [{"tags": [], "owner": {"reputation": 3531, "user_id": 58237, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/9da797433f3c0761ec2f785627a2309c?s=128&d=identicon&r=PG", "display_name": "Fredrik Jansson", "link": "https://stackoverflow.com/users/58237/fredrik-jansson"}, "is_accepted": false, "score": 2, "last_activity_date": 1510522927, "creation_date": 1510522927, "answer_id": 47254324, "question_id": 47243350, "link": "https://stackoverflow.com/questions/47243350/calling-c-function-that-requires-sockaddr/47254324#47254324", "title": "Calling C function that requires sockaddr", "body": "<p>Thanks mkopriva!</p>\n\n<p>(*C.struct_sockaddr)(unsafe.Pointer(&amp;sa))</p>\n"}], "owner": {"reputation": 3531, "user_id": 58237, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/9da797433f3c0761ec2f785627a2309c?s=128&d=identicon&r=PG", "display_name": "Fredrik Jansson", "link": "https://stackoverflow.com/users/58237/fredrik-jansson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 2, "answer_count": 1, "score": 2, "last_activity_date": 1510522927, "creation_date": 1510438554, "question_id": 47243350, "link": "https://stackoverflow.com/questions/47243350/calling-c-function-that-requires-sockaddr", "title": "Calling C function that requires sockaddr", "body": "<p>I have a C function that takes a sockaddr pointer. </p>\n\n<p>I've created a syscall.RawSockaddrInet4 object, but I cannot figure out how to cast the address of the object to a C.sockaddr pointer.</p>\n\n<p>I've tried this, (*syscall.RawSockaddr)(unsafe.Pointer(&amp;sa)), but I get an error: </p>\n\n<p>cannot use (*syscall.RawSockaddr)(unsafe.Pointer(&amp;sa)) (type *syscall.RawSockaddr) as type *C.struct_sockaddr in argument to _Cfunc_lib_connect</p>\n\n<p>Any ideas would be much appreciated!</p>\n\n<p>int lib_connect( int sock,\n    enum lib_sock_type type,\n    const struct sockaddr* srv,\n    int srv_sz);</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 978, "user_id": 3212967, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/K14XW.png?s=128&g=1", "display_name": "Omortis", "link": "https://stackoverflow.com/users/3212967/omortis"}, "is_accepted": true, "score": 0, "last_activity_date": 1510529082, "creation_date": 1510529082, "answer_id": 47255157, "question_id": 47242410, "link": "https://stackoverflow.com/questions/47242410/go-install-different-behavior-on-win10-than-osx-or-linux/47255157#47255157", "title": "go install - different behavior on Win10 than osx or linux", "body": "<p>Solved: case error in GOPATH (john vs. John). Never noticed it. Odd that it affected go install but not go build of main()?</p>\n"}], "owner": {"reputation": 978, "user_id": 3212967, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/K14XW.png?s=128&g=1", "display_name": "Omortis", "link": "https://stackoverflow.com/users/3212967/omortis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 47255157, "answer_count": 1, "score": 0, "last_activity_date": 1510529082, "creation_date": 1510431728, "last_edit_date": 1510529008, "question_id": 47242410, "link": "https://stackoverflow.com/questions/47242410/go-install-different-behavior-on-win10-than-osx-or-linux", "title": "go install - different behavior on Win10 than osx or linux", "body": "<p>I have GOPATH set to:</p>\n\n<pre><code>~/Projects/golang\n</code></pre>\n\n<p>On Linux, OSX and Win10. My code is under:</p>\n\n<pre><code>$GOPATH/src/bitbucket.org/user/project/sublib\n</code></pre>\n\n<p>with pkg in the appropriate parallel loacation. On Linux and OSX I can run go install in the sublib directory and the lib builds and gets installed in </p>\n\n<pre><code>$GOPATH/pkg/bitbucket.org/user/project/sublib.a\n</code></pre>\n\n<p>and everything imports fine. On Windows 10 however with the same rig, I need to supply the path when installing:</p>\n\n<pre><code>&gt; go install bitbucket.org\\user\\project\\sublib\n</code></pre>\n\n<p>which works, but the imports in main() (say) do not.</p>\n\n<pre><code>import (\n    \"net/http\"\n\n    \"bitbucket.org/user/project/sublib\"\n    \"github.com/gorilla/handlers\"\n    \"github.com/gorilla/mux\"\n)\n</code></pre>\n\n<p>does not compile. What am I missing on Windows?</p>\n\n<pre><code>John@RATBONE C:\\Users\\John\\Projects\\golang\\src\\bitbucket.org\\user\\project\\sublib&gt; go env\nset GOARCH=amd64\nset GOBIN=C:\\Users\\john\\Projects\\golang\\bin\nset GOEXE=.exe\nset GOHOSTARCH=amd64\nset GOHOSTOS=windows\nset GOOS=windows\nset GOPATH=C:\\Users\\john\\Projects\\golang\nset GORACE=\nset GOROOT=C:\\Go\nset GOTOOLDIR=C:\\Go\\pkg\\tool\\windows_amd64\nset GCCGO=gccgo\nset CC=gcc\nset GOGCCFLAGS=-m64 -mthreads -fmessage-length=0\nset CXX=g++\nset CGO_ENABLED=1\nset CGO_CFLAGS=-g -O2\nset CGO_CPPFLAGS=\nset CGO_CXXFLAGS=-g -O2\nset CGO_FFLAGS=-g -O2\nset CGO_LDFLAGS=-g -O2\nset PKG_CONFIG=pkg-config\n&gt; go version\ngo version go1.9.2 windows/amd64\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1510427357, "post_id": 47241757, "comment_id": 81433974, "body": "You need to export it. You export an identifier by having the first letter be upper case. So changing <code>get_weather</code> to <code>Get_weather</code> will work, even better if you change it to <code>GetWeather</code> to stay consistent."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1510427379, "post_id": 47241757, "comment_id": 81433984, "body": "for reference, this is covered in the <a href=\"https://tour.golang.org/basics/3\" rel=\"nofollow noreferrer\">Tour Of Go: Basics</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1510429972, "post_id": 47241757, "comment_id": 81434849, "body": "The function must be exported as stated in a previous comment.  More than that, there&#39;s no function with the name get_weather in the package github.com/scayetanot/weather_service_go/weather."}], "answers": [{"tags": [], "owner": {"reputation": 5713, "user_id": 639771, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/yLDsC.jpg?s=128&g=1", "display_name": "Clint", "link": "https://stackoverflow.com/users/639771/clint"}, "is_accepted": false, "score": -4, "last_activity_date": 1510427396, "creation_date": 1510427396, "answer_id": 47241791, "question_id": 47241757, "link": "https://stackoverflow.com/questions/47241757/undefined-func-even-when-import-in-golang/47241791#47241791", "title": "undefined func even when import in golang", "body": "<p>I'm not used to go, but it looks like you've namespaced it.</p>\n\n<p>If you look at the <code>pb</code> import, where it's being used it's prefixed with <code>pb.Method</code>; my guess is <code>GetWeather</code> needs the same.</p>\n\n<p>e.g.:</p>\n\n<p><code>Weather.GetWeather</code> or some syntactic variant; you could always try the import without the prefix.</p>\n"}], "owner": {"reputation": 2343, "user_id": 4033050, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/8617552b81048f6c4b67c9ec04f413b1?s=128&d=identicon&r=PG&f=1", "display_name": "Seb", "link": "https://stackoverflow.com/users/4033050/seb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 931, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1510427396, "creation_date": 1510427147, "question_id": 47241757, "link": "https://stackoverflow.com/questions/47241757/undefined-func-even-when-import-in-golang", "title": "undefined func even when import in golang", "body": "<p>I have a project in go under GitHub and I working locally on my machine.\nBelow is the structure of the project</p>\n\n<pre><code>.weather:\n   - weather-service.go\n   - darksky-provider.go\n.grpc-weather:\n   - weather.proto\nserver.go\n</code></pre>\n\n<p>the server.go file is done as below : </p>\n\n<pre><code>import (\n    pb \"github.com/scayetanot/weather_service_go/grpc_weather\"\n    \"net\"\n    \"log\"\n    \"golang.org/x/net/context\"\n    \"google.golang.org/grpc\"\n    \"google.golang.org/grpc/reflection\"\n    weather \"github.com/scayetanot/weather_service_go/weather\"\n)\n\n//Default configuration port\nconst (\n    port = \":50051\"\n)\n\ntype server struct{}\n\n// implementation of the interface with Server\nfunc (s *server) GetWeather(ctx context.Context, in *pb.GetFromPlaceRequest) (*pb.GetFromPlaceReply, error) {\n    log.Print(\"Retrieve data from weather service\")\n    forecast, err := weather.get_weather(ctx, in.Place, in.Date)\n    if err != nil {\n        log.Fatalf(\"failed to retrieve weather: %v\", err)\n    }\n    log.Print(\"Reply weather to client\")\n    return &amp;pb.GetFromPlaceReply{Weather: forecast}, nil\n}\n</code></pre>\n\n<p>the function get_weather is shown as undefined but I have imported the pkg </p>\n\n<pre><code>weather \"github.com/scayetanot/weather_service_go/weather\"\n</code></pre>\n\n<p>but it's still complaining. but it works for the import named \"pb\"</p>\n\n<p>any idea with the func is not seen even if the import is done ? locally I have run the go get github.. to have my project locally</p>\n\n<p>you can check on <a href=\"https://github.com/scayetanot/weather_service_go\" rel=\"nofollow noreferrer\">https://github.com/scayetanot/weather_service_go</a> to see the package weather and the file weather-service.go</p>\n\n<p>Any ideas or help are welcome</p>\n\n<p>Regards</p>\n"}, {"tags": ["go", "syntax"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1510428171, "post_id": 47241747, "comment_id": 81434270, "body": "<code>DeltaFIFO</code> <b>is not also</b> <code>keyLookupFunc</code>, but <b>it also has a method</b> called <code>GetByKey</code> <a href=\"https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/client-go/tools/cache/delta_fifo.go#L392-L402\" rel=\"nofollow noreferrer\">github.com/kubernetes/kubernetes/blob/master/staging/src/k8s&zwnj;&#8203;.io/&hellip;</a>. Two different types can have a method with the same name, no problem there."}, {"owner": {"reputation": 12560, "user_id": 208288, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/eac63f74d0e07c869a537771e24b0e6f?s=128&d=identicon&r=PG", "display_name": "Laird Nelson", "link": "https://stackoverflow.com/users/208288/laird-nelson"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1510429556, "post_id": 47241747, "comment_id": 81434718, "body": "Thank you; I should have seen that; how embarrassing.  That means, however, that this <code>GetByKey</code> function is not used in the rest of <a href=\"https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/client-go/tools/cache/delta_fifo.go\" rel=\"nofollow noreferrer\">this <code>.go</code> file</a>, right?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1510430391, "post_id": 47241747, "comment_id": 81434984, "body": "It seem like not, maybe it&#39;s legacy, maybe it&#39;s something intended for later use, I don&#39;t know. If you do <a href=\"https://github.com/kubernetes/kubernetes/search?utf8=%E2%9C%93&amp;q=keyLookupFunc&amp;type=\" rel=\"nofollow noreferrer\">this search</a> you can see that that identifier is only used in some 1 year old documentation... And if you do <a href=\"https://github.com/kubernetes/kubernetes/search?utf8=%E2%9C%93&amp;q=testFifoObject&amp;type=\" rel=\"nofollow noreferrer\">this search</a> you&#39;ll see that there is no actual function that matches the <code>keyLookupFunc</code> type... By the way if you&#39;re interested in function types with methods, look into <code>net&#47;http.HandlerFunc</code>, it&#39;s famous."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1510439276, "post_id": 47241747, "comment_id": 81437472, "body": "FWIW, a function isn&#39;t &quot;behaving like a type&quot;. It&#39;s behaving like a value (which it is), that has a type (which every value does)."}], "answers": [{"comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1510431788, "post_id": 47242133, "comment_id": 81435427, "body": "The 2nd part of your answer seems incorrect to me, <a href=\"https://github.com/kubernetes/kubernetes/blob/2986b37de06fcd1bf94e68b49b6c8d87c389d3c2/staging/src/k8s.io/client-go/tools/cache/delta_fifo.go#L51\" rel=\"nofollow noreferrer\">NewDeltaFIFO</a> returns an instance of <code>*DeltaFIFO</code> and not of <code>keyLookupFunc</code>. To me it seems that <code>keyLookupFunc</code> and its method <code>GetByKey</code> aren&#39;t used anywhere. Unless, of course, I&#39;m missing something."}, {"owner": {"reputation": 12560, "user_id": 208288, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/eac63f74d0e07c869a537771e24b0e6f?s=128&d=identicon&r=PG", "display_name": "Laird Nelson", "link": "https://stackoverflow.com/users/208288/laird-nelson"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1510432538, "post_id": 47242133, "comment_id": 81435646, "body": "Hi; thanks for your answer.  I tend to agree with @mkopriva; the three invocations you reference are exactly what I&#39;m asking about.  I don&#39;t see how it is possible that the &quot;target&quot; of the <code>GetByKey</code> function invocation here could possibly be a <code>keyLookupFunc</code>, which would seem to be a requirement."}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 1, "creation_date": 1510434583, "post_id": 47242133, "comment_id": 81436222, "body": "A.R&#39;s answer is correct.  The problem you are having is that you found a method called <code>GetByKey</code> on the <code>keyLookupFunc</code> type, but lots of <code>GetByKey</code> methods can exist with various receivers.  In fact, <code>DeltaFIFO</code> has its own <code>GetByKey</code> (which A.R references in the beginning) so nothing in the code originally posted is very calling the <code>GetByKey</code> with the <code>keyLookupFunc</code> receiver."}, {"owner": {"reputation": 12560, "user_id": 208288, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/eac63f74d0e07c869a537771e24b0e6f?s=128&d=identicon&r=PG", "display_name": "Laird Nelson", "link": "https://stackoverflow.com/users/208288/laird-nelson"}, "edited": false, "score": 1, "creation_date": 1510435067, "post_id": 47242133, "comment_id": 81436369, "body": "Ah, I see; yes, OK, I got his/her answer entirely backwards!  Now that I re-read it, I see he/she is saying that the <code>GetByKey</code> function callable on <code>keyLookupFunc</code> receivers is never used.  @A.R, I&#39;ll award you the answer.  Thanks for your help, everyone."}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 12560, "user_id": 208288, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/eac63f74d0e07c869a537771e24b0e6f?s=128&d=identicon&r=PG", "display_name": "Laird Nelson", "link": "https://stackoverflow.com/users/208288/laird-nelson"}, "edited": false, "score": 0, "creation_date": 1510435681, "post_id": 47242133, "comment_id": 81436549, "body": "@LairdNelson: And How does a type become a function in Go? <a href=\"https://play.golang.org/p/-BGlRggOA7\" rel=\"nofollow noreferrer\">try this example</a>"}, {"owner": {"reputation": 12560, "user_id": 208288, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/eac63f74d0e07c869a537771e24b0e6f?s=128&d=identicon&r=PG", "display_name": "Laird Nelson", "link": "https://stackoverflow.com/users/208288/laird-nelson"}, "edited": false, "score": 1, "creation_date": 1510436295, "post_id": 47242133, "comment_id": 81436718, "body": "Thanks, @A.R; a lifetime ago I programmed Perl extensively and Go receivers remind me very much of the way that I recall that OO methods in Perl worked, where the fact that the &quot;target&quot; is effectively just another syntactically-assisted argument to the function. Thanks for the example."}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 4, "last_activity_date": 1510434180, "last_edit_date": 1510434180, "creation_date": 1510429802, "answer_id": 47242133, "question_id": 47241747, "link": "https://stackoverflow.com/questions/47241747/how-does-a-type-become-a-function-in-go/47242133#47242133", "title": "How does a type become a function in Go?", "body": "<p>Note the two<code>GetByKey</code> methods are two separate methods on two different types, (Two different types with a method with the same name):</p>\n\n<p>Note the last <code>f.GetByKey</code> is:</p>\n\n<pre><code>// GetByKey returns the complete list of deltas for the requested item,\n// setting exists=false if that list is empty.\n// You should treat the items returned inside the deltas as immutable.\nfunc (f *DeltaFIFO) GetByKey(key string) (item interface{}, exists bool, err error) {\n    f.lock.RLock()\n    defer f.lock.RUnlock()\n    d, exists := f.items[key]\n    if exists {\n        // Copy item's slice so operations on this slice (delta\n        // compression) won't interfere with the object we return.\n        d = copyDeltas(d)\n    }\n    return d, exists, nil\n}\n</code></pre>\n\n<p>and this called once here (in <code>delta_fifo.go</code> file at <code>return f.GetByKey(key)</code>):</p>\n\n<pre><code>// Get returns the complete list of deltas for the requested item,\n// or sets exists=false.\n// You should treat the items returned inside the deltas as immutable.\nfunc (f *DeltaFIFO) Get(obj interface{}) (item interface{}, exists bool, err error) {\n    key, err := f.KeyOf(obj)\n    if err != nil {\n        return nil, false, KeyError{obj, err}\n    }\n    return f.GetByKey(key)\n}\n</code></pre>\n\n<p>And also called three times here (in <code>delta_fifo_test.go</code> file at <code>f.GetByKey(\"foo\")</code>):</p>\n\n<pre><code>func TestDeltaFIFO_requeueOnPop(t *testing.T) {\n    f := NewDeltaFIFO(testFifoObjectKeyFunc, nil, nil)\n\n    f.Add(mkFifoObj(\"foo\", 10))\n    _, err := f.Pop(func(obj interface{}) error {\n        if obj.(Deltas)[0].Object.(testFifoObject).name != \"foo\" {\n            t.Fatalf(\"unexpected object: %#v\", obj)\n        }\n        return ErrRequeue{Err: nil}\n    })\n    if err != nil {\n        t.Fatalf(\"unexpected error: %v\", err)\n    }\n    if _, ok, err := f.GetByKey(\"foo\"); !ok || err != nil {\n        t.Fatalf(\"object should have been requeued: %t %v\", ok, err)\n    }\n\n    _, err = f.Pop(func(obj interface{}) error {\n        if obj.(Deltas)[0].Object.(testFifoObject).name != \"foo\" {\n            t.Fatalf(\"unexpected object: %#v\", obj)\n        }\n        return ErrRequeue{Err: fmt.Errorf(\"test error\")}\n    })\n    if err == nil || err.Error() != \"test error\" {\n        t.Fatalf(\"unexpected error: %v\", err)\n    }\n    if _, ok, err := f.GetByKey(\"foo\"); !ok || err != nil {\n        t.Fatalf(\"object should have been requeued: %t %v\", ok, err)\n    }\n\n    _, err = f.Pop(func(obj interface{}) error {\n        if obj.(Deltas)[0].Object.(testFifoObject).name != \"foo\" {\n            t.Fatalf(\"unexpected object: %#v\", obj)\n        }\n        return nil\n    })\n    if err != nil {\n        t.Fatalf(\"unexpected error: %v\", err)\n    }\n    if _, ok, err := f.GetByKey(\"foo\"); ok || err != nil {\n        t.Fatalf(\"object should have been removed: %t %v\", ok, err)\n    }\n}\n</code></pre>\n\n<hr>\n\n<p>And the other method is:</p>\n\n<pre><code>// GetByKey returns the key if it exists in the list returned by kl.\nfunc (kl keyLookupFunc) GetByKey(key string) (interface{}, bool, error) {\n    for _, v := range kl() {\n        if v.name == key {\n            return v, true, nil\n        }\n    }\n    return nil, false, nil\n}\n</code></pre>\n\n<p>and this is not used  (not called).  </p>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1510439073, "creation_date": 1510439073, "answer_id": 47243418, "question_id": 47241747, "link": "https://stackoverflow.com/questions/47241747/how-does-a-type-become-a-function-in-go/47243418#47243418", "title": "How does a type become a function in Go?", "body": "<p>Function is a first class citizen in Go: it can have a methods on it and even implement interfaces. </p>\n\n<p><a href=\"https://play.golang.org/p/d-N4OKLirQ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/d-N4OKLirQ</a></p>\n"}], "owner": {"reputation": 12560, "user_id": 208288, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/eac63f74d0e07c869a537771e24b0e6f?s=128&d=identicon&r=PG", "display_name": "Laird Nelson", "link": "https://stackoverflow.com/users/208288/laird-nelson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 47242133, "answer_count": 2, "score": 4, "last_activity_date": 1580330455, "creation_date": 1510427104, "last_edit_date": 1580330455, "question_id": 47241747, "link": "https://stackoverflow.com/questions/47241747/how-does-a-type-become-a-function-in-go", "title": "How does a type become a function in Go?", "body": "<p>I am looking at <a href=\"https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/client-go/tools/cache/delta_fifo_test.go#L31-L101\" rel=\"nofollow noreferrer\">some Kubernetes source code</a>.</p>\n\n<p>I see this:</p>\n\n<pre><code>// GetByKey returns the key if it exists in the list returned by kl.\nfunc (kl keyLookupFunc) GetByKey(key string) (interface{}, bool, error) {\n    for _, v := range kl() {\n        if v.name == key {\n            return v, true, nil\n        }\n    }\n    return nil, false, nil\n}\n</code></pre>\n\n<p>I know hazily how to read this, but I'm sure I'm going to get my terminology wrong: There's a type somewhere called <code>keyLookupFunc</code>, and <code>kl</code> is effectively an instance of it, and this function, named <code>GetByKey</code> can be called on it.  It accepts a <code>key</code> whose type is <code>string</code>, and it returns three values, etc. etc.</p>\n\n<p>(I don't see the BNF for this particular construction at <a href=\"https://golang.org/ref/spec#Function_types\" rel=\"nofollow noreferrer\">my best guess as to where it should live in the language specification</a>, but I've seen this construction several times before so I take it on faith.)</p>\n\n<p>Higher up in the source code, I notice this:</p>\n\n<pre><code>// keyLookupFunc adapts a raw function to be a KeyLookup.\ntype keyLookupFunc func() []testFifoObject\n</code></pre>\n\n<p>OK, so indeed <code>keyLookupFunc</code> is a type, and it is used to describe something that is a function that takes zero parameters and returns a slice of <code>testFifoObject</code>s.</p>\n\n<p>So na\u00efvely, if I have a <code>keyLookupFunc</code>-typed variable in my hand, I should be able to call <code>GetByKey</code> \"on\" it.  I am not entirely sure how a function can behave like a type in this situation, but I'll take it on faith.</p>\n\n<p>Now when I look to see how this is all used, I <a href=\"https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/client-go/tools/cache/delta_fifo_test.go#L88-L103\" rel=\"nofollow noreferrer\">see this partial stuff</a>:</p>\n\n<pre><code>func TestDeltaFIFO_requeueOnPop(t *testing.T) {\n    f := NewDeltaFIFO(testFifoObjectKeyFunc, nil, nil)\n\n    f.Add(mkFifoObj(\"foo\", 10))\n    _, err := f.Pop(func(obj interface{}) error {\n        if obj.(Deltas)[0].Object.(testFifoObject).name != \"foo\" {\n            t.Fatalf(\"unexpected object: %#v\", obj)\n        }\n        return ErrRequeue{Err: nil}\n    })\n    if err != nil {\n        t.Fatalf(\"unexpected error: %v\", err)\n    }\n    if _, ok, err := f.GetByKey(\"foo\"); !ok || err != nil {\n        t.Fatalf(\"object should have been requeued: %t %v\", ok, err)\n    }\n</code></pre>\n\n<p>Note the <code>f.GetByKey(\"foo\")</code> invocation.  <code>f</code> is a pointer to a <code>DeltaFIFO</code>, which <a href=\"https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/client-go/tools/cache/delta_fifo.go#L51-L61\" rel=\"nofollow noreferrer\">I just happen to know is returned by <code>NewDeltaFIFO</code></a>.</p>\n\n<p>Given that <code>f</code> is a pointer to a <code>DeltaFIFO</code>, how can it also be a <code>keyLookupFunc</code> such that this code can call <code>GetByKey</code> \"on\" it?  How do I connect these dots?</p>\n"}, {"tags": ["multithreading", "go", "web-scraping", "gitlab"], "comments": [{"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 2, "creation_date": 1510426092, "post_id": 47241535, "comment_id": 81433573, "body": "Try to limit number of simultaneous connections."}, {"owner": {"reputation": 587, "user_id": 8849858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed553eeb0056926d3af36bf594de34b?s=128&d=identicon&r=PG&f=1", "display_name": "sergkondr", "link": "https://stackoverflow.com/users/8849858/sergkondr"}, "reply_to_user": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1510427427, "post_id": 47241535, "comment_id": 81434001, "body": "I&#39;m trying to do it here: <code>queue := make(chan struct{}, N)</code> (N = number of connection), and it partially helps, but i&#39;m loosing performance. Does it a problem of gitlab, golang or my computer?"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 1, "creation_date": 1510430403, "post_id": 47241535, "comment_id": 81434989, "body": "I guess 50 is too much. There could be some sort of DDoS protection which limits number of connections. Try to make less, say 5 or 10."}, {"owner": {"reputation": 587, "user_id": 8849858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed553eeb0056926d3af36bf594de34b?s=128&d=identicon&r=PG&f=1", "display_name": "sergkondr", "link": "https://stackoverflow.com/users/8849858/sergkondr"}, "reply_to_user": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1510433155, "post_id": 47241535, "comment_id": 81435821, "body": "looks like you were right, this works perfectly(but slowly - 1500+ projects, 42 seconds):  <code>projects_chan := make(chan Project, 2)</code> and <code>queue := make(chan struct{}, 3)</code>"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 1, "creation_date": 1510433286, "post_id": 47241535, "comment_id": 81435866, "body": "You can find optimal number or use some proxies so your requests would look like being from  different sources."}, {"owner": {"reputation": 4976, "user_id": 99189, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e85341a6b300fd04dc33b1baa28b7fd8?s=128&d=identicon&r=PG", "display_name": "Jeremy Huiskamp", "link": "https://stackoverflow.com/users/99189/jeremy-huiskamp"}, "edited": false, "score": 0, "creation_date": 1510500419, "post_id": 47241535, "comment_id": 81451168, "body": "Make sure to inspect the http response code.  Gitlab is probably telling you exactly why your calls are failing, but your code is ignoring it."}], "answers": [{"comments": [{"owner": {"reputation": 587, "user_id": 8849858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed553eeb0056926d3af36bf594de34b?s=128&d=identicon&r=PG&f=1", "display_name": "sergkondr", "link": "https://stackoverflow.com/users/8849858/sergkondr"}, "edited": false, "score": 0, "creation_date": 1512808320, "post_id": 47705246, "comment_id": 82413980, "body": "Thanks for the answer, and especially thanks for link to &quot;go concurrency patterns&quot;. I already solved this problem by limiting the amount of threads and tuning Gitlab according the  Eugene Lisitsky&#39;s answer"}], "tags": [], "owner": {"reputation": 1267, "user_id": 1598790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11ea12f06eefbb34068f4c1090e2e0b?s=128&d=identicon&r=PG", "display_name": "ramrunner", "link": "https://stackoverflow.com/users/1598790/ramrunner"}, "is_accepted": true, "score": 1, "last_activity_date": 1548533421, "last_edit_date": 1548533421, "creation_date": 1512687569, "answer_id": 47705246, "question_id": 47241535, "link": "https://stackoverflow.com/questions/47241535/troubles-with-gitlab-scraping-via-golang/47705246#47705246", "title": "Troubles with gitlab scraping via golang", "body": "<p>i would say this not a very clear way to achieve concurrency.\nwhat seems to be happening here is </p>\n\n<ul>\n<li><p>you create a buffered channel that has a size of 50.</p></li>\n<li><p>then you fire up 1532 goroutines</p></li>\n<li><p>the first 50 of them enqueue themselves and start processing. by the time they &lt;-queue and free up somespace a random one from the next manages to get on the queue. </p></li>\n<li><p>as people say in the comments most certainly you hit some limits around the time it the blast has made it around id 550. Then gitlab's API is angry at you and rate limits.</p></li>\n<li><p>then another goroutine is fired that will close the channel to notify the main goroutine</p></li>\n<li><p>the main goroutine reads messages.</p></li>\n</ul>\n\n<p>the talk <a href=\"https://www.youtube.com/watch?v=f6kdp27TYZs\" rel=\"nofollow noreferrer\">go concurrency patterns</a>\nas well as this blog post <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">concurrency in go</a> might help.\npersonally i rarely use buffered channels. for your problem i would go like:</p>\n\n<ul>\n<li><p>define a number of workers</p></li>\n<li><p>have the main goroutine fire up the workers with a func listening on a channel of ints , doing the api call, writing to a channel of projects</p></li>\n<li><p>have the main goroutine send to a channel of ints the project number to be fetched and read from the channel of projects.</p>\n\n<ul>\n<li>maybe ratelimit by firing a ticker and have main read from it before it sends the next request?</li>\n</ul></li>\n<li><p>main closes the number channel to notify the others to die.</p></li>\n</ul>\n"}], "owner": {"reputation": 587, "user_id": 8849858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed553eeb0056926d3af36bf594de34b?s=128&d=identicon&r=PG&f=1", "display_name": "sergkondr", "link": "https://stackoverflow.com/users/8849858/sergkondr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 47705246, "answer_count": 1, "score": 1, "last_activity_date": 1553089008, "creation_date": 1510425807, "last_edit_date": 1553089008, "question_id": 47241535, "link": "https://stackoverflow.com/questions/47241535/troubles-with-gitlab-scraping-via-golang", "title": "Troubles with gitlab scraping via golang", "body": "<p>I'm newbie in programming and I need help. Trying to write gitlab scraper on golang. \nSomething goes wrong when i'm trying to get information about projects in multithreading mode. </p>\n\n<p>Here is the code:</p>\n\n<pre><code>func (g *Gitlab) getAPIResponce(url string, structure interface{}) error {\n    responce, responce_error := http.Get(url)\n    if responce_error != nil {\n        return responce_error\n    }\n    ret, _ := ioutil.ReadAll(responce.Body)\n    if string(ret) != \"[]\" {\n        err := json.Unmarshal(ret, structure)\n        return err\n    }\n    return errors.New(error_emptypage)\n}\n\n...\n\nfunc (g *Gitlab) GetProjects() {\n    projects_chan := make(chan Project, g.LatestProjectID) \n    var waitGroup sync.WaitGroup                           \n    queue := make(chan struct{}, 50)                                      \n    for i := g.LatestProjectID; i &gt; 0; i-- {               \n        url := g.BaseURL + projects_url + \"/\" + strconv.Itoa(i) + g.Token\n        waitGroup.Add(1)\n        go func(url string, channel chan Project) {\n            queue &lt;- struct{}{}\n            defer waitGroup.Done()\n\n            var oneProject Project\n            err := g.getAPIResponce(url, &amp;oneProject)\n            if err != nil {\n                fmt.Println(err.Error())\n            }\n\n            fmt.Printf(\".\")\n            channel &lt;- oneProject\n            &lt;-queue\n        }(url, projects_chan)\n    }\n\n    go func() {\n        waitGroup.Wait()\n        close(projects_chan)\n    }()\n\n    for project := range projects_chan {\n        if project.ID != 0 {\n            g.Projects = append(g.Projects, project)\n        }\n    }\n}\n</code></pre>\n\n<p>And here is the output:</p>\n\n<pre><code>$ ./gitlab-auditor \nlatest project = 1532\nGathering projects...\n.......................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................Get https://gitlab.example.com/api/v4/projects/563&amp;private_token=SeCrEt_ToKeN: unexpected EOF\nGet https://gitlab.example.com/api/v4/projects/558&amp;private_token=SeCrEt_ToKeN: unexpected EOF\n..Get https://gitlab.example.com/api/v4/projects/531&amp;private_token=SeCrEt_ToKeN: unexpected EOF\nGet https://gitlab.example.com/api/v4/projects/571&amp;private_token=SeCrEt_ToKeN: unexpected EOF\n.Get https://gitlab.example.com/api/v4/projects/570&amp;private_token=SeCrEt_ToKeN: unexpected EOF\n..Get https://gitlab.example.com/api/v4/projects/467&amp;private_token=SeCrEt_ToKeN: unexpected EOF\nGet https://gitlab.example.com/api/v4/projects/573&amp;private_token=SeCrEt_ToKeN: unexpected EOF\n................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................\n</code></pre>\n\n<p>Every time it's different projects, but it's id is around 550.</p>\n\n<p>When I'm trying to curl links from output, i'm getting normal JSON. When I'm trying to run this code with <code>queue := make(chan struct{}, 1)</code> (in single thread) - everything is fine.</p>\n\n<p>What can it be?</p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1510423659, "post_id": 47241042, "comment_id": 81432728, "body": "Related / possible duplicate of <a href=\"https://stackoverflow.com/questions/47179890/too-many-open-files-in-mgo-go-server/47180097#47180097\">too many open files in mgo go server</a>; and <a href=\"https://stackoverflow.com/questions/42492020/concurrency-in-gopkg-in-mgo-v2-mongo-go/42495522#42495522\">Concurrency in gopkg.in/mgo.v2 (Mongo, Go)</a>; and <a href=\"https://stackoverflow.com/questions/40999637/mgo-query-performance-seems-consistently-slow-500-650ms/41000876#41000876\">mgo - query performance seems consistently slow (500-650ms)</a>."}, {"owner": {"reputation": 3294, "user_id": 4848859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Slzu.jpg?s=128&g=1", "display_name": "mayo", "link": "https://stackoverflow.com/users/4848859/mayo"}, "edited": false, "score": 0, "creation_date": 1510423768, "post_id": 47241042, "comment_id": 81432781, "body": "I think that this can help <a href=\"https://stackoverflow.com/questions/18650890/keeping-open-a-mongodb-database-connection\" title=\"keeping open a mongodb database connection\">stackoverflow.com/questions/18650890/&hellip;</a>. In my case I&#39;m using go and bigtable, and I am keeping the connection alive (unless/until the server crashes)."}, {"owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "edited": false, "score": 0, "creation_date": 1510424519, "post_id": 47241042, "comment_id": 81433056, "body": "Ok thank you very much, really appreciated :-)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510607108, "post_id": 47241042, "comment_id": 81498193, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/42492020/concurrency-in-gopkg-in-mgo-v2-mongo-go\">Concurrency in gopkg.in/mgo.v2 (Mongo, Go)</a>"}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1510607241, "creation_date": 1510607241, "answer_id": 47273559, "question_id": 47241042, "link": "https://stackoverflow.com/questions/47241042/mongodb-shall-i-keep-a-global-session-all-the-time/47273559#47273559", "title": "MongoDB: Shall I keep a global session all the time?", "body": "<p>Per the <a href=\"https://godoc.org/gopkg.in/mgo.v2\" rel=\"nofollow noreferrer\">main package docs</a>:</p>\n\n<blockquote>\n  <p>New sessions are typically created by calling session.Copy on the\n  initial session obtained at dial time. These new sessions will share\n  the same cluster information and connection pool, and may be easily\n  handed into other methods and functions for organizing logic. Every\n  session created must have its Close method called at the end of its\n  life time, so its resources may be put back in the pool or collected,\n  depending on the case.</p>\n</blockquote>\n\n<p>Meaning: at startup you should <code>Dial</code> and save that session, and for each call to <code>NewUserDAO</code> you should <code>Clone</code> the initial <code>Session</code> created with <code>Dial</code>.</p>\n"}], "owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 318, "favorite_count": 0, "accepted_answer_id": 47273559, "answer_count": 1, "score": 0, "last_activity_date": 1510607241, "creation_date": 1510422836, "question_id": 47241042, "link": "https://stackoverflow.com/questions/47241042/mongodb-shall-i-keep-a-global-session-all-the-time", "title": "MongoDB: Shall I keep a global session all the time?", "body": "<p>Here is a snippet of my DAO implementation:</p>\n\n<pre><code>type (\n    User struct {\n        Name string `json:\"name\" bson:\"name\"`\n        ...\n    }\n\n    UserDAO struct {\n        *mgo.Database\n    }\n)\n\nfunc NewUserDAO() (*UserDAO, error) {\n    session, err := mgo.Dial(\"mongodb://127.0.0.1:27017/test\")\n    if err != nil {\n        return nil, err\n    }\n\n    return &amp;UserDAO{session.DB(\"\")}, nil\n}\n\nfunc (d *UserDAO) Insert(user User) error {\n    return d.C(\"users\").Insert(user)\n}\n\nfunc (d *CandleDAO) Find(name string) ([]User, error) {\n    var result []User\n    if err := d.C(\"users\").Find(bson.M{\"name\": name)}).Sort(\"time\").All(&amp;result); err != nil {\n        return nil, err\n    }\n    return result, nil\n}\n\n...\n\nfunc (d *CandleDAO) Close() {\n    d.Session.Close()\n}\n</code></pre>\n\n<p>And here is how I invoke it:</p>\n\n<pre><code>dao, err := dao.NewUserDAO()\nif err != nil {\n    Log.Error(err.Error())\n    return\n}\n\n// close session... is this OK?\ndefer dao.Close()\n\nusers, err := dao.Find(&amp;broker.Symbol{\"BTC\", \"USD\"}); if err != nil {\n    Log.Error(err.Error())\n    return\n}\n\nfor i, user := range users {\n    fmt.Printf(\"%d ==&gt; %v\\n\", i, user)\n}\n</code></pre>\n\n<p>The code above works... and my question is simple: shall I keep a global <code>mgo.Database</code> instance or is it correct to always close the session when I'm finished and create a new one whenever I need?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1510422173, "post_id": 47240474, "comment_id": 81432159, "body": "Fix by adding <code>if r.URL.Path != &quot;&#47;&quot; { http.Error(w, &quot;Not Found&quot;, 404); return }</code> to beginning of handler."}], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 2, "last_activity_date": 1510421087, "creation_date": 1510421087, "answer_id": 47240744, "question_id": 47240474, "link": "https://stackoverflow.com/questions/47240474/http-listenandserve-handler-function-executed-twice-on-port-80/47240744#47240744", "title": "http.ListenAndServe handler function executed twice on port 80", "body": "<p>Try to log requests. Possibly browser is calling <code>/favicon.ico</code></p>\n"}, {"tags": [], "owner": {"reputation": 944, "user_id": 1498624, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/4WQ2c.jpg?s=128&g=1", "display_name": "grabthefish", "link": "https://stackoverflow.com/users/1498624/grabthefish"}, "is_accepted": true, "score": 5, "last_activity_date": 1510421148, "creation_date": 1510421148, "answer_id": 47240752, "question_id": 47240474, "link": "https://stackoverflow.com/questions/47240474/http-listenandserve-handler-function-executed-twice-on-port-80/47240752#47240752", "title": "http.ListenAndServe handler function executed twice on port 80", "body": "<p>i just tried it on my pc with Fiddler open</p>\n\n<p>I noticed when navigating to the url using Google Chrome, the browser makes 2 request</p>\n\n<pre><code>GET / HTTP/1.1\nGET /favicon.ico HTTP/1.1\n</code></pre>\n\n<p>the request for the favicon also gets handled by the defaultHandler, which causes the count to increment</p>\n\n<p>I also tried with firefox and it doesn't send another request for the favicon</p>\n"}], "owner": {"reputation": 804, "user_id": 7171834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9r1VB.png?s=128&g=1", "display_name": "Peter Gloor", "link": "https://stackoverflow.com/users/7171834/peter-gloor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 967, "favorite_count": 1, "closed_date": 1510422029, "accepted_answer_id": 47240752, "answer_count": 2, "score": 0, "last_activity_date": 1510421148, "creation_date": 1510419465, "last_edit_date": 1510419817, "question_id": 47240474, "link": "https://stackoverflow.com/questions/47240474/http-listenandserve-handler-function-executed-twice-on-port-80", "closed_reason": "Duplicate", "title": "http.ListenAndServe handler function executed twice on port 80", "body": "<p>If I run the following simple http server code on port 8080 everything works as expected. If I run the same code on port 80, by just changing the port, the handler function is executed twice with each request. Why, and how to fix it?</p>\n\n<pre><code>// httptest project main.go\npackage main\n\nimport (\n    \"net/http\"\n    \"log\"\n    \"fmt\"\n    \"html\"\n)\n\nvar count int\n\nfunc defaultHandler(w http.ResponseWriter, r *http.Request) {\n    count++\n    fmt.Fprintf(w, \"Hello, %q count=%d\", html.EscapeString(r.URL.Path), count)\n    fmt.Println(count,r.RemoteAddr)\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", defaultHandler)\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p>If I enter localhost:8080 in the browser, I get a response with a count starting at 1 and increased by 1 with each new request. </p>\n\n<p>If I change the code to port 80 and enter just localhost or localhost:80 in the browser, I get a first response with a count starting at 1 but increased by two with each following request. At the same time the print statement for the console output is executed twice.</p>\n\n<p>Terminal console when running on port 80 with 3 requests:</p>\n\n<pre><code>&gt;go run main.go\n1 [::1]:51335\n2 [::1]:51335\n3 [::1]:51335\n4 [::1]:51335\n5 [::1]:51335\n6 [::1]:51335\n</code></pre>\n\n<p>The responses in the browser are <code>Hello, \"/\" count=1</code>, <code>Hello, \"/\" count=3</code> and <code>Hello, \"/\" count=5</code>.</p>\n\n<p>I've been running this locally on Windows 10 with Go version go1.9.2 windows/amd64 and the latest Google Chrome Browser. </p>\n\n<p>However, I detected the issue in a simple web application on a remote Linux server where the code has been compiled with go version go1.9.1 linux/amd64.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 167, "user_id": 8924858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ccb4564c1cda9498c154d58967693ed?s=128&d=identicon&r=PG&f=1", "display_name": "Saem", "link": "https://stackoverflow.com/users/8924858/saem"}, "edited": false, "score": 0, "creation_date": 1510420604, "post_id": 47240344, "comment_id": 81431586, "body": "I thought i solved the problem but what i did does not solve it as i need to assign value on the key matching in a loop."}], "answers": [{"tags": [], "owner": {"reputation": 167, "user_id": 8924858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ccb4564c1cda9498c154d58967693ed?s=128&d=identicon&r=PG&f=1", "display_name": "Saem", "link": "https://stackoverflow.com/users/8924858/saem"}, "is_accepted": false, "score": 0, "last_activity_date": 1510420160, "creation_date": 1510420160, "answer_id": 47240600, "question_id": 47240344, "link": "https://stackoverflow.com/questions/47240344/append-values-to-array-inside-of-map-golang/47240600#47240600", "title": "Append values to array inside of map golang", "body": "<p>Okay, i solved it by creating an Example object and then appending values to its array and assigning it  to map.</p>\n\n<p>Like this:</p>\n\n<pre><code>package main\n\n\nimport (\n \"fmt\"\n)\n\n\ntype Example struct {\n  Id []int\n  Name []string\n}\n\nfunc (data *Example) AppendExample(id int,name string) {\n   data.Id = append(data.Id, id)\n   data.Name = append(data.Name, name)\n}\n\nvar MyMap map[string]Example\n\nfunc main() {\n\n  var object Example\n  object.AppendExample(1,\"SomeText\")\n\n  MyMap = make(map[string]Example)\n  MyMap[\"key1\"] = object\n  fmt.Println(MyMap)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 167, "user_id": 8924858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ccb4564c1cda9498c154d58967693ed?s=128&d=identicon&r=PG&f=1", "display_name": "Saem", "link": "https://stackoverflow.com/users/8924858/saem"}, "edited": false, "score": 0, "creation_date": 1510445500, "post_id": 47240789, "comment_id": 81438762, "body": "Yeah, i did exactly the same thing as well as i couldn&#39;t find how to do without creating an object of struct. I will undelete my own answer. Thank  you for input!"}, {"owner": {"reputation": 303, "user_id": 8008395, "user_type": "registered", "profile_image": "https://graph.facebook.com/1019408758194319/picture?type=large", "display_name": "Bohdan Kostko", "link": "https://stackoverflow.com/users/8008395/bohdan-kostko"}, "reply_to_user": {"reputation": 167, "user_id": 8924858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ccb4564c1cda9498c154d58967693ed?s=128&d=identicon&r=PG&f=1", "display_name": "Saem", "link": "https://stackoverflow.com/users/8924858/saem"}, "edited": false, "score": 0, "creation_date": 1510566105, "post_id": 47240789, "comment_id": 81473186, "body": "Not really the same. You&#39;re still using struct literal instead of a pointer in your map. Please read more about structs and pointers here: <a href=\"https://gobyexample.com/pointers\" rel=\"nofollow noreferrer\">gobyexample.com/pointers</a> <a href=\"https://gobyexample.com/structs\" rel=\"nofollow noreferrer\">gobyexample.com/structs</a>"}], "tags": [], "owner": {"reputation": 303, "user_id": 8008395, "user_type": "registered", "profile_image": "https://graph.facebook.com/1019408758194319/picture?type=large", "display_name": "Bohdan Kostko", "link": "https://stackoverflow.com/users/8008395/bohdan-kostko"}, "is_accepted": true, "score": 12, "last_activity_date": 1510590324, "last_edit_date": 1510590324, "creation_date": 1510421315, "answer_id": 47240789, "question_id": 47240344, "link": "https://stackoverflow.com/questions/47240344/append-values-to-array-inside-of-map-golang/47240789#47240789", "title": "Append values to array inside of map golang", "body": "<p>You need to create an instance of your Example struct before putting it into the map.</p>\n\n<p>Also your map keeps copy of your struct, not a struct itself according to MyMap definition. Try to keep the reference to your Example struct within the map instead.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Example struct {\n    Id []int\n    Name []string\n}\n\nfunc (data *Example) AppendOffer(id int, name string) {\n    data.Id = append(data.Id, id)\n    data.Name = append(data.Name, name)\n}\n\nvar MyMap map[string]*Example\n\nfunc main() {\n    obj := &amp;Example{[]int{}, []string{}}\n    obj.AppendOffer(1, \"SomeText\")\n    MyMap = make(map[string]*Example)\n    MyMap[\"key1\"] = obj\n    fmt.Println(MyMap)\n}\n</code></pre>\n\n<p>Pozdrawiam!</p>\n"}], "owner": {"reputation": 167, "user_id": 8924858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ccb4564c1cda9498c154d58967693ed?s=128&d=identicon&r=PG&f=1", "display_name": "Saem", "link": "https://stackoverflow.com/users/8924858/saem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 21224, "favorite_count": 0, "accepted_answer_id": 47240789, "answer_count": 2, "score": 9, "last_activity_date": 1510590324, "creation_date": 1510418789, "last_edit_date": 1510422295, "question_id": 47240344, "link": "https://stackoverflow.com/questions/47240344/append-values-to-array-inside-of-map-golang", "title": "Append values to array inside of map golang", "body": "<p>I am trying to append values to arrays inside of a map: </p>\n\n<pre><code>var MyMap map[string]Example \n\ntype Example struct {\n    Id []int\n    Name []string\n}\n</code></pre>\n\n<p>Here is what i tried but i can not point to an object of Example to append to arrays.</p>\n\n<pre><code>package main\n\n\nimport (\n  \"fmt\"\n)\n\n\ntype Example struct {\n  Id []int\n  Name []string\n}\n\nfunc (data *Example) AppendExample(id int,name string) {\n   data.Id = append(data.Id, id)\n   data.Name = append(data.Name, name)\n}\n\nvar MyMap map[string]Example\n\nfunc main() {\n   MyMap = make(map[string]Example)\n   MyMap[\"key1\"] = Oferty.AppendExample(1,\"SomeText\")\n   fmt.Println(MyMap)\n}\n</code></pre>\n"}, {"tags": ["string", "performance", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1510423917, "last_edit_date": 1510423917, "creation_date": 1510418536, "answer_id": 47240301, "question_id": 47240127, "link": "https://stackoverflow.com/questions/47240127/fastest-way-to-find-number-of-lines-in-go/47240301#47240301", "title": "Fastest way to find number of lines in go?", "body": "<p>That is perfectly fine. But don't forget that if the last character is not a newline character, you have to add 1 to the number of occurrences, as that will be the number of lines (the last line may not end with a newline).</p>\n\n<p>What we might think is that since the substring you're counting is only a single character (a single <code>rune</code>), we could create a custom solution counting only the occurrence of this single character (instead of counting substrings). It may look like this:</p>\n\n<pre><code>func countRune(s string, r rune) int {\n    count := 0\n    for _, c := range s {\n        if c == r {\n            count++\n        }\n    }\n    return count\n}\n</code></pre>\n\n<p>(A <code>for range</code> on a <code>string</code> value iterates over its <code>rune</code>s.)</p>\n\n<p>And testing it (try it on the <a href=\"https://play.golang.org/p/Rcj6-Vn-Aq\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>fmt.Println(countRune(\"asdf\\nasdf\\nasdf\\n\", '\\n')) // Prints 3\n</code></pre>\n\n<p>In practice this won't be faster counting newline characters, as that is a single <code>byte</code> in UTF-8 encoding, and <a href=\"https://golang.org/pkg/strings/#Count\" rel=\"noreferrer\"><code>strings.Count()</code></a> is already optimized for counting substrings where the length of the substring is 1:</p>\n\n<pre><code>// Count counts the number of non-overlapping instances of substr in s.\n// If substr is an empty string, Count returns 1 + the number of Unicode code points in s.\nfunc Count(s, substr string) int {\n    if len(substr) == 1 &amp;&amp; cpu.X86.HasPOPCNT {\n        return countByte(s, byte(substr[0]))\n    }\n    return countGeneric(s, substr)\n}\n\nfunc countByte(s string, c byte) int // ../runtime/asm_amd64.s\n</code></pre>\n\n<p>What could improve the performance of this operation (counting lines) is if you would have access to the \"internal\" byte or rune array of the editor, so you would not have to call its <code>Text()</code> method, which creates and returns a copy of its content.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1510428701, "last_edit_date": 1510428701, "creation_date": 1510426712, "answer_id": 47241684, "question_id": 47240127, "link": "https://stackoverflow.com/questions/47240127/fastest-way-to-find-number-of-lines-in-go/47241684#47241684", "title": "Fastest way to find number of lines in go?", "body": "<p>When you ask questions about the fastest way, you should measure using the Go <a href=\"https://golang.org/pkg/testing/\" rel=\"nofollow noreferrer\"><code>testing</code></a> package benchmark facilities. </p>\n\n<p>For example, count the number of lines in <a href=\"https://simple.wikipedia.org/wiki/Lorem_ipsum\" rel=\"nofollow noreferrer\">lorem ipsum</a> using <code>strings.Count</code> and using a <code>for range</code> loop over a <code>string</code>, and measure any additional cost of converting from a <code>byte</code> slice to <code>string</code>. You may be able to avoid any <code>byte</code> slice to <code>string</code> overhead by counting the number of lines in a <code>byte</code> slice.</p>\n\n<pre><code>$ gotest lines_test.go -bench=.\ndata: /home/peter/shakespeare.pg100.txt 5589889\nBenchmarkStringCount-4     30000000    57.3 ns/op     0 B/op   0 allocs/op\nBenchmarkStringByRune-4     3000000   563 ns/op       0 B/op   0 allocs/op\nBenchmarkBytesToString-4   10000000   173 ns/op     480 B/op   1 allocs/op\nBenchmarkBytesCount-4      20000000    61.2 ns/op     0 B/op   0 allocs/op\n</code></pre>\n\n<p><code>lines_test.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"strconv\"\n    \"strings\"\n    \"testing\"\n)\n\nfunc linesStringCount(s string) string {\n    n := strings.Count(s, \"\\n\")\n    if len(s) &gt; 0 &amp;&amp; !strings.HasSuffix(s, \"\\n\") {\n        n++\n    }\n    return strconv.Itoa(n)\n}\n\nfunc linesStringByRune(s string) string {\n    n := 0\n    for _, r := range s {\n        if r == '\\n' {\n            n++\n        }\n    }\n    if len(s) &gt; 0 &amp;&amp; !strings.HasSuffix(s, \"\\n\") {\n        n++\n    }\n    return strconv.Itoa(n)\n}\n\nfunc linesBytesCount(s []byte) string {\n    nl := []byte{'\\n'}\n    n := bytes.Count(s, nl)\n    if len(s) &gt; 0 &amp;&amp; !bytes.HasSuffix(s, nl) {\n        n++\n    }\n    return strconv.Itoa(n)\n}\n\nvar data = []byte(`Lorem ipsum dolor sit amet, consectetur adipiscing elit, \nsed do eiusmod tempor incididunt ut labore et dolore magna aliqua. \nUt enim ad minim veniam, \nquis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. \nDuis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. \nExcepteur sint occaecat cupidatat non proident, \nsunt in culpa qui officia deserunt mollit anim id est laborum.`)\n\nfunc BenchmarkStringCount(b *testing.B) {\n    text := string(data)\n    b.ReportAllocs()\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        _ = linesStringCount(text)\n    }\n}\n\nfunc BenchmarkStringByRune(b *testing.B) {\n    text := string(data)\n    b.ReportAllocs()\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        _ = linesStringByRune(text)\n    }\n}\n\nfunc BenchmarkBytesToText(b *testing.B) {\n    b.ReportAllocs()\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        _ = string(data)\n    }\n}\n\nfunc BenchmarkBytesCount(b *testing.B) {\n    text := data\n    b.ReportAllocs()\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        _ = linesBytesCount(text)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 367, "user_id": 5623778, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/69e63cb22a93b5779ab522847f51d0d3?s=128&d=identicon&r=PG", "display_name": "Robert", "link": "https://stackoverflow.com/users/5623778/robert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2259, "favorite_count": 2, "accepted_answer_id": 47240301, "answer_count": 2, "score": 7, "last_activity_date": 1510428701, "creation_date": 1510417470, "question_id": 47240127, "link": "https://stackoverflow.com/questions/47240127/fastest-way-to-find-number-of-lines-in-go", "title": "Fastest way to find number of lines in go?", "body": "<p>What I'm using right now:</p>\n\n<pre><code>numlines := strings.Count(editor.Text(), \"\\n\")\nfmt.Print(strconv.Itoa(numlines))\nmessage.SetText(strconv.Itoa(numlines))\n</code></pre>\n\n<p>This is run whenever a text box is updated. What the most go-like way to do this?</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 8924214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa6b5a24f266057b3e38b540c6bb80ea?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Smith", "link": "https://stackoverflow.com/users/8924214/jack-smith"}, "edited": false, "score": 0, "creation_date": 1510425168, "post_id": 47239618, "comment_id": 81433277, "body": "can you please add to the code? I do not really understand how to implement this"}], "tags": [], "owner": {"reputation": 31, "user_id": 2861950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3afba736f2c2ce8c9ff79ac49832ab88?s=128&d=identicon&r=PG&f=1", "display_name": "Zhormos", "link": "https://stackoverflow.com/users/2861950/zhormos"}, "is_accepted": false, "score": 1, "last_activity_date": 1510414478, "creation_date": 1510414478, "answer_id": 47239618, "question_id": 47238560, "link": "https://stackoverflow.com/questions/47238560/how-to-stop-complete-goroutine/47239618#47239618", "title": "How to stop / complete goroutine", "body": "<p>A pattern I can recommend to you is to use <code>time.Ticker</code> as explained in <a href=\"https://stackoverflow.com/a/16466581/2861950\">this answer</a>.</p>\n"}], "owner": {"reputation": 23, "user_id": 8924214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa6b5a24f266057b3e38b540c6bb80ea?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Smith", "link": "https://stackoverflow.com/users/8924214/jack-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1510414478, "creation_date": 1510407847, "question_id": 47238560, "link": "https://stackoverflow.com/questions/47238560/how-to-stop-complete-goroutine", "title": "How to stop / complete goroutine", "body": "<p><em>My program checks up a web-site every 20 seconds on the changes of text of Rebody and ip addresses she is included in a cycle</em>, when she finds changes in text, going out from a cycle is already impossible, because endless goroutine is started that writes away for information on all ip addresses found that, I can not enter verification already. I need somehow to stop goroutine for the moment of verification, to check and again start. <strong>How to do it?</strong> \n<strong>Code:</strong> </p>\n\n<pre><code>func main() { \n\n    url := os.Args[1] \n    for { \n        time.Sleep(time.Second * 20) /* check every 20 seconds */\n        req, err := http.Get(url)\n        if err != nil { \n\n            fmt.Println(\"error 404\") \n\n        } else { \n\n            defer req.Body.Close() \n            simple_match_body, io_err := ioutil.ReadAll(req.Body) \n\n            if io_err != nil { \n                fmt.Println(\"[Info] [IO.Fatal.Method.Read] IO-Error reading body... retry\")\n                continue \n\n            } else { \n                check_rebody := regexp.MustCompile(\"Rebody\") \n\n                match_result := check_rebody.FindAll(simple_match_body, -1) \n                for _, tq := range match_result { \n\n                    query_response := fmt.Sprintf(\"%s\", tq) \n                    fmt.Println(query_response) \n\n                }   \n\n\n                if len(match_result) == 0 { \n                    fmt.Println(\"'Rebody' not found!\")\n                } else { \n                    fmt.Println(\"'Rebody' - found!\", req.Body)\n                }\n\n                check_url := regexp.MustCompile(`((25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(25[0-5]|2[0-4]\\d|[01]?\\d\\d?)`) // \u0442\u0435\u043f\u0435\u0440\u044c \u043f\u043e\u0434\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0440\u0435\u0433\u0443\u043b\u044f\u0440\u043d\u043e\u0435 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430 ip \u0430\u0434\u0440\u0435\u0441\u043e\u0432 \n                match_result_a := check_url.FindAll(simple_match_body, -1) \n                for _, dddd := range match_result_a { \n\n                    def_url := fmt.Sprintf(\"http://\"+\"%s\", dddd) \n                    for i := 0; i &lt; 2; i++ { \n\n                        go HTTPRequests(def_url, 80) \n                    } \n\n                    fmt.Println(def_url) \n\n                } \n\n                if len(match_result_a) == 0 { \n                    fmt.Println(\"Url is found!\", check_url)\n                } else { \n                    fmt.Println(\"Url not found!\", req.Body)\n\n                }\n\n\n                }\n\n\n            }\n\n        }\n\n\n\n}\n\nfunc HTTPRequests(url string, port int) { \n\n    for { \n\n\n        flags_http, s_err := http.Get(url) \n\n        if s_err != nil { \n            fmt.Println(\"error 404\")\n\n        } else { \n            fmt.Println(\"request has been send: \", flags_http.Body, flags_http.Header) \n\n        }\n\n        time.Sleep(time.Second * 5)\n        http_recheck, ss_err := http.Get(url)\n\n        if ss_err != nil {\n            fmt.Println(\"ss err\")\n        } else {\n                defer http_recheck.Body.Close() \n                simple_match_body, io_err := ioutil.ReadAll(http_recheck.Body) \n\n                if io_err != nil {\n                    fmt.Println(\"error\")\n                } else {\n                    check_word := regexp.MustCompile(\"None\") \n\n                    match_result := check_word.FindAll(simple_match_body, -1) \n                    for _, tq := range match_result { \n\n                        query := fmt.Sprintf(\"%s\", tq) \n                        fmt.Println(query) \n\n                    }   \n\n\n                    if len(match_result) == 0 { \n                        fmt.Println(\"ip not found\")\n                    } else { \n                        fmt.Println(\"ip found.\", http_recheck.Body)\n                    }\n                }\n\n        }\n\n    }\n\n}\n</code></pre>\n"}, {"tags": ["go", "idioms"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1510415767, "last_edit_date": 1510415767, "creation_date": 1510404085, "answer_id": 47237995, "question_id": 47237950, "link": "https://stackoverflow.com/questions/47237950/idiomatic-go-name-for-struct-in-package/47237995#47237995", "title": "idiomatic Go name for struct in package?", "body": "<p>It is ok, and it's also idiomatic.</p>\n\n<p>Similar examples from the standard library:</p>\n\n<ul>\n<li><a href=\"https://golang.org/pkg/container/list/#List\" rel=\"nofollow noreferrer\"><code>list.List</code></a>, <a href=\"https://golang.org/pkg/container/ring/#Ring\" rel=\"nofollow noreferrer\"><code>ring.Ring</code></a></li>\n<li><a href=\"https://golang.org/pkg/time/#Time\" rel=\"nofollow noreferrer\"><code>time.Time</code></a></li>\n<li><a href=\"https://golang.org/pkg/hash/#Hash\" rel=\"nofollow noreferrer\"><code>hash.Hash</code></a></li>\n<li><a href=\"https://golang.org/pkg/image/#Image\" rel=\"nofollow noreferrer\"><code>image.Image</code></a></li>\n<li><a href=\"https://golang.org/pkg/image/color/#Color\" rel=\"nofollow noreferrer\"><code>color.Color</code></a></li>\n<li>...</li>\n</ul>\n\n<p>Also, I guess <code>foo.Foo</code> is just an example, but with your actual type names you may also use simplification in the type name, exactly because the package already describes it. For example there is an <a href=\"https://golang.org/pkg/net/http/#CookieJar\" rel=\"nofollow noreferrer\"><code>http.CookieJar</code></a> interface in the standard lib, and there is a <a href=\"https://golang.org/pkg/net/http/cookiejar/\" rel=\"nofollow noreferrer\"><code>net/http/cookiejar</code></a> package which provides a type that implements <code>http.CookieJar</code>, and it is named <a href=\"https://golang.org/pkg/net/http/cookiejar/#Jar\" rel=\"nofollow noreferrer\"><code>cookiejar.Jar</code></a>, and not <code>cookiejar.CookieJar</code>.</p>\n\n<p>So just use common sense and look at it from the perspective of the package's users (from their point of view). <code>foo.Foo</code> is perfectly fine. But the similar examples above are part of packages that contain lots of other types. If this is the only type your package will ever export, depending on the usage, <code>foo.F</code> may also be sensible and acceptable. As an example, there are <a href=\"https://godoc.org/gopkg.in/mgo.v2/bson#M\" rel=\"nofollow noreferrer\"><code>bson.M</code></a> and <a href=\"https://godoc.org/gopkg.in/mgo.v2/bson#D\" rel=\"nofollow noreferrer\"><code>bson.D</code></a> types which are deliberately made short, because they are used often and even multiple times to create MongoDB queries. Given the context it is clear what they are, and does not cause trouble or misunderstanding.</p>\n"}], "owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 1, "accepted_answer_id": 47237995, "answer_count": 1, "score": 4, "last_activity_date": 1551801069, "creation_date": 1510403814, "last_edit_date": 1551801069, "question_id": 47237950, "link": "https://stackoverflow.com/questions/47237950/idiomatic-go-name-for-struct-in-package", "title": "idiomatic Go name for struct in package?", "body": "<p>I have a package named \"foo\" because it defines a Foo struct and related stuff like methods. </p>\n\n<p>The package has a New method that returns a heap allocated Foo struct. </p>\n\n<p>Is it Ok to name the struct type Foo when the package name is \"foo\" ? I'm unsure because it would stutter. </p>\n\n<p><code>var f foo.Foo</code></p>\n\n<p>On the other hand it feels natural to write</p>\n\n<p><code>f := foo.New(...)</code></p>\n"}, {"tags": ["c", "pointers", "go", "garbage-collection", "cgo"], "answers": [{"comments": [{"owner": {"reputation": 16936, "user_id": 7076153, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/erPUC.png?s=128&g=1", "display_name": "Stargateur", "link": "https://stackoverflow.com/users/7076153/stargateur"}, "edited": false, "score": 0, "creation_date": 1510415957, "post_id": 47239235, "comment_id": 81429919, "body": "I have the same bug on my arch with &quot;go version go1.9.2 linux/amd64&quot; with the OP code. Error: &quot;runtime: writebarrierptr *0xc42007a000 = 0x1 fatal error: bad pointer in write barrier&quot;"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1510414425, "last_edit_date": 1510414425, "creation_date": 1510412106, "answer_id": 47239235, "question_id": 47237363, "link": "https://stackoverflow.com/questions/47237363/how-to-solve-bad-pointer-in-write-barrier-panic-in-cgo-when-c-library-uses-opa/47239235#47239235", "title": "How to solve &quot;bad pointer in write barrier&quot; panic in cgo when C library uses opaque struct pointers", "body": "<p>I can reproduce the error for <code>go1.8.5</code> and <code>go1.9.2</code>. I cannot reproduce the error for tip: <code>devel +f01b928 Sat Nov 11 06:17:48 2017 +0000</code> (effectively go1.10alpha).</p>\n\n<hr>\n\n<pre><code>// Create a temporary slice containing invalid pointers.\n// The idea is that the local variable slice can be garbage collected at the end of the function call.\n// When the slice is scanned for linked objects, the GC comes across the invalid pointers.\n</code></pre>\n\n<p>A Go mantra is do not ignore errors. However, you seem to assume that that the GC will gracefully ignore errors. The GC should complain loudly (<code>go1.8.5</code> and <code>go1.9.2</code>). At worst, with undefined behavior that may vary from release to release, the GC may appear to ignore errors (<code>go devel</code>).</p>\n\n<p>The Go compiler sees a pointer and the Go runtime GC expects a valid pointer.</p>\n\n<pre><code>// go tool cgo\n// type _Ctype_Handle *_Ctype_struct_HandlePrivate\n// var handle _Ctype_Handle\nvar handle C.Handle\n// main._Ctype_Handle &lt;nil&gt; 0x0\nfmt.Fprintf(os.Stderr, \"%[1]T %[1]v %[1]p\\n\", handle)\n\nslice := make([]C.Handle, 1000000)\nfor i, _ := range slice {\n    slice[i] = C.getInvalidPointer()\n}\n</code></pre>\n\n<hr>\n\n<p>Use type <code>uintptr</code>. For example,</p>\n\n<pre><code>package main\n\nimport \"unsafe\"\n\n/*\n#include \"stddef.h\"\n// Create an opaque type to hide the details of the underlying data structure.\ntypedef struct HandlePrivate *Handle;\n\n// In reality, the implementation uses a type derived from size_t for the Handle.\nHandle getInvalidPointer() {\n    size_t actualHandle = 1;\n    return (Handle) actualHandle;\n}\n*/\nimport \"C\"\n\n// Create a temporary slice of C pointers as Go integer type uintptr.\nfunc getTempSlice() {\n    slice := make([]uintptr, 1000000)\n    for i, _ := range slice {\n        slice[i] = uintptr(unsafe.Pointer(C.getInvalidPointer()))\n    }\n}\n\nfunc main() {\n    getTempSlice()\n}\n</code></pre>\n"}], "owner": {"reputation": 862, "user_id": 1656636, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/eK9if.jpg?s=128&g=1", "display_name": "Johannes P", "link": "https://stackoverflow.com/users/1656636/johannes-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 226, "favorite_count": 1, "accepted_answer_id": 47239235, "answer_count": 1, "score": 4, "last_activity_date": 1510414425, "creation_date": 1510399496, "last_edit_date": 1510409005, "question_id": 47237363, "link": "https://stackoverflow.com/questions/47237363/how-to-solve-bad-pointer-in-write-barrier-panic-in-cgo-when-c-library-uses-opa", "title": "How to solve &quot;bad pointer in write barrier&quot; panic in cgo when C library uses opaque struct pointers", "body": "<p>I'm currently writing a Go wrapper around a C library. That C library uses opaque struct pointers to hide information across the interface. However, the underlying implementation stores size_t values in there. This leads to runtime errors in the resulting program.\nA minimum working example to reproduce the problem looks like this:</p>\n\n<p><code>main.go</code>:</p>\n\n<pre><code>package main\n\n/*\n#include \"stddef.h\"\n// Create an opaque type to hide the details of the underlying data structure.\ntypedef struct HandlePrivate *Handle;\n\n// In reality, the implementation uses a type derived from size_t for the Handle.\nHandle getInvalidPointer() {\n    size_t actualHandle = 1;\n    return (Handle) actualHandle;\n}\n */\nimport \"C\"\n\n// Create a temporary slice containing invalid pointers.\n// The idea is that the local variable slice can be garbage collected at the end of the function call.\n// When the slice is scanned for linked objects, the GC comes across the invalid pointers.\nfunc getTempSlice() {\n    slice := make([]C.Handle, 1000000)\n    for i, _ := range slice {\n        slice[i] = C.getInvalidPointer()\n    }\n}\n\nfunc main() {\n    getTempSlice()\n}\n</code></pre>\n\n<p>Running this program will lead to the following error</p>\n\n<pre><code>runtime: writebarrierptr *0xc42006c000 = 0x1\nfatal error: bad pointer in write barrier\n[...stack trace omitted...]\n</code></pre>\n\n<p>Note that the errors disappear when the GC is disabled by setting the environment variable <code>GOGC=off</code>.</p>\n\n<p>My question is which is the best way to solve or work around this problem. The library stores integer values in pointers for the sake of information hiding and this seems to confuse the GC. For obvious reasons I don't want to start messing with the library itself but rather absorb this behaviour in my wrapping layer.</p>\n\n<p>My environment is Ubuntu 16.04, with gcc 5.4.0 and Go 1.9.2.</p>\n\n<p><a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">Documentation of cgo</a></p>\n"}, {"tags": ["logging", "go"], "comments": [{"owner": {"reputation": 3294, "user_id": 4848859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Slzu.jpg?s=128&g=1", "display_name": "mayo", "link": "https://stackoverflow.com/users/4848859/mayo"}, "edited": false, "score": 1, "creation_date": 1510424083, "post_id": 47237201, "comment_id": 81432899, "body": "What do you mean with <code>embedded database</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 15, "user_id": 8925429, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EblpP.jpg?s=128&g=1", "display_name": "TryingToBeABetterProgrammer", "link": "https://stackoverflow.com/users/8925429/tryingtobeabetterprogrammer"}, "is_accepted": false, "score": 0, "last_activity_date": 1510429067, "creation_date": 1510429067, "answer_id": 47242034, "question_id": 47237201, "link": "https://stackoverflow.com/questions/47237201/golang-1-8-embedded-database-for-logging/47242034#47242034", "title": "Golang 1.8: Embedded database for logging", "body": "<p>A Embedded NoSql Database is what you want, i think.</p>\n\n<p><a href=\"https://github.com/HouzuoGuo/tiedot\" rel=\"nofollow noreferrer\">tiedot</a> looks interesting</p>\n\n<p>otherwise if you want to try grep for windows -> </p>\n\n<p><a href=\"https://stackoverflow.com/questions/87350/what-are-good-grep-tools-for-windows\">what-are-good-grep-tools-for-windows</a></p>\n"}], "owner": {"reputation": 1302, "user_id": 1931698, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/XMKhh.jpg?s=128&g=1", "display_name": "Prakhar Mishra", "link": "https://stackoverflow.com/users/1931698/prakhar-mishra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 366, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1510429067, "creation_date": 1510398346, "question_id": 47237201, "link": "https://stackoverflow.com/questions/47237201/golang-1-8-embedded-database-for-logging", "title": "Golang 1.8: Embedded database for logging", "body": "<p>I am trying to find an embedded database for logging purposes in <strong>golang</strong>, as text file based logging is not best suited in windows (no cat, grep or xargs to save your day). So, I am looking for a solution, which will let me fire a query against my log file.</p>\n\n<p>Can anyone please suggest me what solution I can deploy to make logging and MORE IMPORTANTLY, log viewing easy?</p>\n"}]