[{"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 4, "creation_date": 1503523734, "post_id": 45849468, "comment_id": 78657287, "body": "Perhaps tell us what code you tried and what went wrong. Are you stuck with regexp syntax?"}, {"owner": {"reputation": 11, "user_id": 6802436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe82071cce59e6a18ab66f19333efdda?s=128&d=identicon&r=PG&f=1", "display_name": "k-r", "link": "https://stackoverflow.com/users/6802436/k-r"}, "reply_to_user": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1503523992, "post_id": 45849468, "comment_id": 78657374, "body": "Yeah sorry, struggling with syntax!"}, {"owner": {"reputation": 5053, "user_id": 2421391, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/980724d5505b7c2ee035c38b8adabd54?s=128&d=identicon&r=PG", "display_name": "scnerd", "link": "https://stackoverflow.com/users/2421391/scnerd"}, "edited": false, "score": 0, "creation_date": 1503524209, "post_id": 45849468, "comment_id": 78657466, "body": "Something like <a href=\"http://regexr.com/3gk05\" rel=\"nofollow noreferrer\">the following</a> should work: <code>(\\w+)\\((\\w+),(\\w+)\\)</code>, and you can swap out the <code>\\w</code> with <code>[\\w\\d+\\-*&#47;]</code> or whatever you want to support for each of the operator name, the field, and the value. The parentheses make the resulting match have a unique group for each value. Note that it&#39;s not possible to make a single regular expression that supports nesting of such operators, or variadic operators."}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1503524366, "post_id": 45849468, "comment_id": 78657538, "body": "Put in what you&#39;ve tried by editing your question, and people can help, include also the data you are testing against. You need to encode \\ as \\\\ for example if making it in a &quot;string&quot;, so that could be your issue, or perhaps just regexp syntax?"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1503525377, "post_id": 45849468, "comment_id": 78657983, "body": "Thanks, since you&#39;ve clarified, answer below. Better would be to give the example of code that was broken though."}], "answers": [{"tags": [], "owner": {"reputation": 5053, "user_id": 2421391, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/980724d5505b7c2ee035c38b8adabd54?s=128&d=identicon&r=PG", "display_name": "scnerd", "link": "https://stackoverflow.com/users/2421391/scnerd"}, "is_accepted": false, "score": 0, "last_activity_date": 1503525133, "last_edit_date": 1503525133, "creation_date": 1503524811, "answer_id": 45849792, "question_id": 45849468, "link": "https://stackoverflow.com/questions/45849468/regex-for-string-representation-of-a-method-call/45849792#45849792", "title": "Regex for string representation of a method call", "body": "<p>I don't know golang, but I do know regex's, so I'll do what I can here.</p>\n\n<p>You probably want a group each for the \"operator\", \"field\", and \"value\". I'm going to assume for now that each of these can be represented as any combination of alphabetic, numeric, or underscore characters, with length of at least one character. In regex, we have a shortcut for that: <code>\\w</code> represents a single alpha-numeric or underscore character, and the <code>+</code> modifier means \"one or more\". So <code>\\w+</code> means one or more such character in a row. If you want a more complex definition of what these fields can be named, I'll let you specify that in your question.</p>\n\n<p>You say that you want to support \"operator(field,value)\". I'll start without whitespace anywhere, because it's simpler and you can easily remove all whitespace yourself before running the regex. We'll later add some whitespace support to the regex if you want it, but it'll make life difficult.</p>\n\n<p>To do this, we want three groups, \"1(2,3)\" where 1 is the operator name, 2 is the field name, and 3 is the value name. Each of these, as given above, will be <code>\\w+</code> in our regex. We'll want to match the open and close parentheses as well as the comma, but we'll throw them away because they're really just delimiters. The parentheses will need to be escaped in the regex, since regex's have a special meaning for parentheses. <a href=\"http://regexr.com/3gk05\" rel=\"nofollow noreferrer\">The result looks like</a>:</p>\n\n<pre><code>(\\w+)\\((\\w+),(\\w+)\\)\n\\ 1 /  \\ 2 / \\ 3 /\n</code></pre>\n\n<p>Where the second line shows you where the groups are each defined.</p>\n\n<p>If you want to support some whitespace, you'll need to add <code>\\s*</code> in all such locations. This gets hairy, <a href=\"http://regexr.com/3gk08\" rel=\"nofollow noreferrer\">but you can do it as such</a>:</p>\n\n<pre><code>(\\w+)\\s*\\(\\s*(\\w+)\\s*,\\s*(\\w+)\\s*\\)\n\\ 1 /        \\ 2 /       \\ 3 /\n</code></pre>\n\n<p>You give an example of wanting to support floating point values, and I presume other kinds of values too. You can accomplish this using the \"or\" pipe, <code>|</code>. For example, group 3, instead of just being <code>\\w+</code>, could be defined as</p>\n\n<pre><code>[a-zA-Z_]\\w*|\\d+\\.?|\\d*\\.\\d+\n</code></pre>\n\n<p>This string will support alphanumeric+underscore strings where the first character must be alphabetic or underscore, OR integers, OR floating point (defined as an integer string with a period at the beginning, middle, or end). Clearly, this can go on and on to support more complex string values, but you get the idea.</p>\n\n<p><a href=\"http://regexr.com/3gk0k\" rel=\"nofollow noreferrer\">So the final regex might look like</a>:</p>\n\n<pre><code>(\\w+)\\s*\\(\\s*(\\w+)\\s*,\\s*([a-zA-Z_]\\w+|\\d+\\.?|\\d*\\.\\d+)\\s*\\)\n</code></pre>\n\n<p>Sorry for not giving any golang help, I hope someone else can edit my answer and fill in that major gap.</p>\n"}, {"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 0, "last_activity_date": 1503525181, "creation_date": 1503525181, "answer_id": 45849851, "question_id": 45849468, "link": "https://stackoverflow.com/questions/45849468/regex-for-string-representation-of-a-method-call/45849851#45849851", "title": "Regex for string representation of a method call", "body": "<p>Use something like this to capture groups, you may want to limit the characters accepted with [], note the use of ` and the use of \\ escaping for () within the regexp:</p>\n\n<pre><code>func main() {\n    re := regexp.MustCompile(`(.+)\\((.+),\\s?(.+)\\)`)\n    for _, t := range tests {\n        fmt.Println(\"result\", re.FindStringSubmatch(t))\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/43YLTafgQt\" rel=\"nofollow noreferrer\">https://play.golang.org/p/43YLTafgQt</a></p>\n\n<p>output: </p>\n\n<pre><code>result [contains(field, value) contains field value]\nresult [contains(name, Joe) contains name Joe]\nresult [lt(quantity, 2.5) lt quantity 2.5]\nresult [plus(no,44) plus no 44]\n</code></pre>\n\n<p>Depending on how strict you want to be you could use [a-z]+ or similar instead of .+ to match only certain characters but if you are not worried about bogus values this would probably be fine. </p>\n"}], "owner": {"reputation": 11, "user_id": 6802436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe82071cce59e6a18ab66f19333efdda?s=128&d=identicon&r=PG&f=1", "display_name": "k-r", "link": "https://stackoverflow.com/users/6802436/k-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 45849851, "answer_count": 2, "score": -1, "last_activity_date": 1503525181, "creation_date": 1503523332, "last_edit_date": 1503524668, "question_id": 45849468, "link": "https://stackoverflow.com/questions/45849468/regex-for-string-representation-of-a-method-call", "title": "Regex for string representation of a method call", "body": "<p>I have a string that follows a specific pattern like so\n<code>operator(field,value)</code></p>\n\n<p>and I'd like to use regex to extract out all three of operator, field and value. I'm struggling to come up with the syntax for how to capture these. In this case value can be alphanumeric as well, for example</p>\n\n<p><code>\"contains(name, Joe)\"</code>\nor <code>\"lt(quantity, 2.5)\"</code></p>\n"}, {"tags": ["elasticsearch", "go"], "comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 1, "creation_date": 1503524647, "post_id": 45849186, "comment_id": 78657666, "body": "Include your code in your question for a better chance of an answer, this is too broad."}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1503596789, "post_id": 45849186, "comment_id": 78694645, "body": "<code>cannot use &quot;ctx._source.Content = newCont&quot; (type string) as type *elastic.Script</code> pretty much sums it up. You can&#39;t pass <code>Script</code> a string. Try <code>.Script(elastic.NewScript(&quot;ctx._source.Content = newCont&quot;))</code>."}, {"owner": {"reputation": 1, "user_id": 8508352, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155744122225774/picture?type=large", "display_name": "Steven", "link": "https://stackoverflow.com/users/8508352/steven"}, "reply_to_user": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1503601535, "post_id": 45849186, "comment_id": 78697200, "body": "@Gavin now I&#39;m getting this:  <code>eclient.Update().Index(ENTRY_INDEX).Type(ENTRY_TYPE).Id(entr&zwnj;&#8203;yID).Script(elastic.&zwnj;&#8203;NewScript(&quot;ctx._sour&zwnj;&#8203;ce.Content = newCont&quot;)).ScriptParams undefined (type *elastic.UpdateService has no field or method ScriptParams)</code>  I was following the website example as closely as possible (seen <a href=\"https://github.com/olivere/elastic/wiki/Update\" rel=\"nofollow noreferrer\">here</a>). Any ideas?"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 8508352, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155744122225774/picture?type=large", "display_name": "Steven", "link": "https://stackoverflow.com/users/8508352/steven"}, "edited": false, "score": 0, "creation_date": 1503603273, "post_id": 45869317, "comment_id": 78698027, "body": "I was still having an issue with <code>.ScriptParams(map[string]interface{}{&quot;newCont&quot;: newContent})</code> but apparently just <code>.Params(map[string]interface{}{&quot;newCont&quot;: newContent})</code> works. Also upon using this func with the aforementioned modification, I get this error: <code>elastic: Error 400 (Bad Request): failed to execute script [type=illegal_argument_exception]</code> Any ideas?"}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "reply_to_user": {"reputation": 1, "user_id": 8508352, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155744122225774/picture?type=large", "display_name": "Steven", "link": "https://stackoverflow.com/users/8508352/steven"}, "edited": false, "score": 0, "creation_date": 1503604571, "post_id": 45869317, "comment_id": 78698648, "body": "You&#39;re passing in a slice of runes as a param. Try converting that to a string and using that as the param instead."}, {"owner": {"reputation": 1, "user_id": 8508352, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155744122225774/picture?type=large", "display_name": "Steven", "link": "https://stackoverflow.com/users/8508352/steven"}, "edited": false, "score": 0, "creation_date": 1503608491, "post_id": 45869317, "comment_id": 78700583, "body": "I tried the following: <code>stringified := string(newContent)</code> and used stringified in Params and I still get the same error"}, {"owner": {"reputation": 1, "user_id": 8508352, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155744122225774/picture?type=large", "display_name": "Steven", "link": "https://stackoverflow.com/users/8508352/steven"}, "edited": false, "score": 0, "creation_date": 1503932455, "post_id": 45869317, "comment_id": 78802671, "body": "Also I&#39;m not sure how to edit the stored array. For instance, if I were to update <code>ctx._source.Content[x]</code> where x is an int representing the location of the target element in the array, how would that look?"}], "tags": [], "owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "is_accepted": false, "score": 0, "last_activity_date": 1503604330, "last_edit_date": 1503604330, "creation_date": 1503602063, "answer_id": 45869317, "question_id": 45849186, "link": "https://stackoverflow.com/questions/45849186/how-do-i-use-oliveres-elastic-client-update-service-to-change-array-fields-g/45869317#45869317", "title": "How do I use olivere&#39;s elastic client.Update() service to change array fields, generic string fields and possibly nested struct fields?", "body": "<p>The <code>Script</code> method accepts a <code>*elastic.Script</code>, not a string. The <code>ScriptParams</code> method is also found on <code>*elastic.Script</code> as <code>Params</code> instead of being on <code>*elastic.UpdateService</code>.</p>\n\n<pre><code>func UpdateEntryContent(eclient *elastic.Client, entryID string, newContent []rune) error{\n    ctx:=context.Background()\n\n    exists, err := eclient.IndexExists(ENTRY_INDEX).Do(ctx)\n    if err != nil {return err}\n    if !exists {return errors.New(\"Index does not exist\")}\n\n    script := elastic.NewScript(\"ctx._source.Content = newCont\").Params(map[string]interface{}{\"newCont\": newContent})\n\n    _, err = eclient.Update().Index(ENTRY_INDEX).Type(ENTRY_TYPE).Id(entryID).\n        Script(script).\n        Do(ctx)\n\n    if err != nil {return err}\n\n    return nil\n}\n</code></pre>\n\n<p>You can see more information about the package with <a href=\"https://godoc.org/gopkg.in/olivere/elastic.v5\" rel=\"nofollow noreferrer\">GoDoc</a> or by looking through the source code.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 8529299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c29c62433cb59764269aeef9e11dab4?s=128&d=identicon&r=PG&f=1", "display_name": "Michael H.", "link": "https://stackoverflow.com/users/8529299/michael-h"}, "is_accepted": false, "score": 0, "last_activity_date": 1503952305, "creation_date": 1503952305, "answer_id": 45926921, "question_id": 45849186, "link": "https://stackoverflow.com/questions/45849186/how-do-i-use-oliveres-elastic-client-update-service-to-change-array-fields-g/45926921#45926921", "title": "How do I use olivere&#39;s elastic client.Update() service to change array fields, generic string fields and possibly nested struct fields?", "body": "<p>The following code should resolve the issue</p>\n\n<p>_, err = eclient.Update().Index(INDEX).\n        Type(TYPE).\n        Id(ID).\n        Doc(map[string]interface{}{field: message}).\n        Do(ctx)</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 8508352, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155744122225774/picture?type=large", "display_name": "Steven", "link": "https://stackoverflow.com/users/8508352/steven"}, "is_accepted": true, "score": 0, "last_activity_date": 1504992813, "creation_date": 1504992813, "answer_id": 46135297, "question_id": 45849186, "link": "https://stackoverflow.com/questions/45849186/how-do-i-use-oliveres-elastic-client-update-service-to-change-array-fields-g/46135297#46135297", "title": "How do I use olivere&#39;s elastic client.Update() service to change array fields, generic string fields and possibly nested struct fields?", "body": "<p>Credit where it's due Gavin's answer put me on the right track. This is for another <code>.Index</code> but the full function that acts as a generic single field update is as follows:</p>\n\n<pre><code>func UpdateUser(eclient *elastic.Client, userID string, field string, newContent interface{})error {\n    //CHANGES A SINGLE FIELD OF ES USER DOCUMENT(requires an elastic client pointer,\n    //  the user DocID, the feild you wish to modify as a string,\n    //  and what you want to change that field to as any type necessary)\n    //RETURN AN error IF SUCESSFUL error = nil\n\n    ctx := context.Background()\n\n    exists, err := eclient.IndexExists(USER_INDEX).Do(ctx)\n    if err != nil {return err}\n    if !exists {return errors.New(\"Index does not exist\")}\n\n    _, err = eclient.Update().\n        Index(USER_INDEX).\n        Type(USER_TYPE).\n        Id(userID).\n        Doc(map[string]interface{}{field: newContent}).\n        Do(ctx)\n\n\n    return nil\n}\n</code></pre>\n\n<p>You can change the <code>.Index</code>, <code>.Type</code>, and <code>.Id</code> and it works with all fields and types as far as I can tell</p>\n"}], "owner": {"reputation": 1, "user_id": 8508352, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155744122225774/picture?type=large", "display_name": "Steven", "link": "https://stackoverflow.com/users/8508352/steven"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1351, "favorite_count": 0, "accepted_answer_id": 46135297, "answer_count": 3, "score": 0, "last_activity_date": 1504992813, "creation_date": 1503522002, "last_edit_date": 1503596456, "question_id": 45849186, "link": "https://stackoverflow.com/questions/45849186/how-do-i-use-oliveres-elastic-client-update-service-to-change-array-fields-g", "title": "How do I use olivere&#39;s elastic client.Update() service to change array fields, generic string fields and possibly nested struct fields?", "body": "<p><a href=\"https://github.com/olivere/elastic\" rel=\"nofollow noreferrer\">https://github.com/olivere/elastic</a>\nVersion 5.x</p>\n\n<p>The wiki documentation isn't really clear on how client.Update() works.  It's needed to completely change a field and to modify arrays. i.e. in the example in the wiki documentation, how would one go about appending and removing tags to a tweet or changing a tweet's content? Also if a tweet was represented in go as a struct and I added a nested struct called \"echo\" which contains a foo of type int, content of type string and another type string array, how would one go about changing any of these fields using client.Update() if it's even possible?</p>\n\n<p>In my personal example I have this function:</p>\n\n<pre><code>func UpdateEntryContent(eclient *elastic.Client, entryID string, newContent []rune) error{\n    ctx:=context.Background()\n\n    exists, err := eclient.IndexExists(ENTRY_INDEX).Do(ctx)\n    if err != nil {return err}\n    if !exists {return errors.New(\"Index does not exist\")}\n\n    _, err = eclient.Update().Index(ENTRY_INDEX).Type(ENTRY_TYPE).Id(entryID).\n        Script(\"ctx._source.Content = newCont\").\n        ScriptParams(map[string]interface{}{\"newCont\": newContent}).\n        Do(ctx)\n\n    if err != nil {return err}\n\n    return nil\n}\n</code></pre>\n\n<p>But I get this following error when I try to compile:</p>\n\n<p>cannot use \"ctx._source.Content = newCont\" (type string) as type *elastic.Script in argument to eclient.Update().Index(ENTRY_INDEX).Type(ENTRY_TYPE).Id(entryID).Script</p>\n\n<p>eclient.Update().Index(ENTRY_INDEX).Type(ENTRY_TYPE).Id(entryID).Script(\"ctx._source.Content = newCont\").ScriptParams undefined (type *elastic.UpdateService has no field or method ScriptParams)</p>\n"}, {"tags": ["go", "dry"], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 1236359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12f8b663ef9122ee0a7f4fac6ae706c6?s=128&d=identicon&r=PG", "display_name": "droneprime", "link": "https://stackoverflow.com/users/1236359/droneprime"}, "edited": false, "score": 0, "creation_date": 1503512280, "post_id": 45845300, "comment_id": 78651712, "body": "That&#39;s awesome. Thank you for the response. I&#39;ll update after implementation."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 6, "last_activity_date": 1503506880, "creation_date": 1503506880, "answer_id": 45845300, "question_id": 45845181, "link": "https://stackoverflow.com/questions/45845181/golang-handlers-handling-different-types/45845300#45845300", "title": "Golang handlers handling different types", "body": "<p>You can do it by passing in an exemplar of the necessary type, the same way that <code>Unmarshal</code> does it:</p>\n\n<pre><code>func GetFlow(a *AppContext, w http.ResponseWriter, r *http.Request) (int, error) {\n    return GetThing(a,w,r,\"flow\",new(Flow))\n}\n\nfunc GetProcess(a *AppContext, w http.ResponseWriter, r *http.Request) (int, error) {\n    return GetThing(a,w,r,\"process\",new(Process))\n}\n\nfunc GetThing(a *AppContext, w http.ResponseWriter, r *http.Request, t string, ob Elastible{}) (int, error) {\n    hit, code, err := a.GetByID(t, mux.Vars(r)[\"id\"], r)\n    if code != 200 {\n        return code, err\n    }\n\n    err = json.Unmarshal(*hit.Source, ob)\n    if err != nil {\n        return 500, err\n    }\n\n    ob.SetESID(hit.Id)\n\n    b := new(bytes.Buffer)\n    json.NewEncoder(b).Encode(ob)\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.Write(b.Bytes())\n    return 200, nil\n}\n\ntype Elastible interface {\n    SetESID(id ESIDType)    // whatever type ESID is, not clear from example\n}\n\nfunc (f *Flow) SetESID(id ESIDType) {\n    f.ESID = id\n}\n</code></pre>\n\n<p>This code is untested (because I don't have your struct defs or other dependent code) but I hope it gets the idea across.</p>\n"}, {"comments": [{"owner": {"reputation": 55, "user_id": 1236359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12f8b663ef9122ee0a7f4fac6ae706c6?s=128&d=identicon&r=PG", "display_name": "droneprime", "link": "https://stackoverflow.com/users/1236359/droneprime"}, "edited": false, "score": 0, "creation_date": 1503512443, "post_id": 45846743, "comment_id": 78651799, "body": "Thank you very much for the detailed response. I&#39;ll take a crack at implementing what you suggested (superset of Adrian&#39;s) and get back to you. I&#39;d omitted the other REST calls for simplicity, there are deletes and by necessity options. Also gets with a large set. I will take some time to try and generalize."}, {"owner": {"reputation": 939, "user_id": 4648046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/932ac0b92feea46110e78577f7047c74?s=128&d=identicon&r=PG&f=1", "display_name": "Eddy R.", "link": "https://stackoverflow.com/users/4648046/eddy-r"}, "edited": false, "score": 1, "creation_date": 1503512654, "post_id": 45846743, "comment_id": 78651907, "body": "Adrian&#39;s solution seems much simpler and easier to understand / maintain. Being more generic here seems to come at the cost of complexity / readability and IMO isn&#39;t worth it unless you really need it. Of course, 99% of the time the YAGNI principle applies :-)"}, {"owner": {"reputation": 55, "user_id": 1236359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12f8b663ef9122ee0a7f4fac6ae706c6?s=128&d=identicon&r=PG", "display_name": "droneprime", "link": "https://stackoverflow.com/users/1236359/droneprime"}, "edited": false, "score": 0, "creation_date": 1503532837, "post_id": 45846743, "comment_id": 78660093, "body": "YAGNI principle would apply if I were getting paid for this project ;)"}], "tags": [], "owner": {"reputation": 789, "user_id": 7641174, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-mT1i-1QabTQ/AAAAAAAAAAI/AAAAAAAAAcU/tMWPD90e4Uw/photo.jpg?sz=128", "display_name": "Mustansir Zia", "link": "https://stackoverflow.com/users/7641174/mustansir-zia"}, "is_accepted": false, "score": 2, "last_activity_date": 1503511955, "creation_date": 1503511955, "answer_id": 45846743, "question_id": 45845181, "link": "https://stackoverflow.com/questions/45845181/golang-handlers-handling-different-types/45846743#45846743", "title": "Golang handlers handling different types", "body": "<p>Alright, I propose a solution that will give you the maximum code reuse and minimum code copying. This, in my opinion, is by far the most generic solution. We will also take into account the answer given by <a href=\"https://stackoverflow.com/users/7426/adrian\">https://stackoverflow.com/users/7426/adrian</a> to complete the solution. You only have to define a single function which will be a higher order function <code>CreateHandler</code> which will return a function of the following signature: \n<br /><code>func(*AppContext, http.ResponseWriter, http.Request) (int, error)</code>.</p>\n\n<p>This signature is the actual signature of the handler that is to be used as a mux end point. The solution involves defining a <code>Handler</code> type which is a struct having three fields:</p>\n\n<p>\u2022 <code>handlerType</code>: Think of it as an enum having either a value of <code>\"CREATE\"</code> or <code>\"GET\"</code>. This will decide which among the two blocks of code that you pasted in your question should we use.</p>\n\n<p>\u2022 <code>handlerActionName</code>: This will tell the <code>\"CREATE\"</code> or <code>\"GET\"</code> which Elastible to use. Value should either be <code>\"flow\"</code> or <code>\"process\"</code>.</p>\n\n<p>\u2022 <code>elastible</code>: This will the Interface type <code>Elastible</code> that will have the <code>SetESID</code> function. We will use this to send our <code>Flow</code> or <code>Process</code> types to our <code>Handler</code>. Thus both <code>Flow</code> and <code>Process</code> should satisfy our interface.\nThis will make the solution even more generic and will only calling <code>handler.elastible.SetESID()</code> and we will have inserted the ESID irrespective of that fact the underlying type in 'elastible' can either be 'Flow' or a 'Process'</p>\n\n<p>I also define a <code>sendResponse(response interface{})</code> function that we will resuse to send the response. It acquires <code>w http.ResponseWriter</code> using closure. <code>response</code> can thus be anything, a </p>\n\n<pre><code>struct {\n    Highest int `json:\"id\"`\n}{highest} \n</code></pre>\n\n<p>or a <code>Flow</code> or a <code>Process</code>. This will make this function generic too.</p>\n\n<p>The complete solution would now be.</p>\n\n<pre><code>// This is the type that will be used to build our handlers.\ntype Handler struct {\n    handlerType       string    // Can be \"CREATE\" or \"GET\"\n    handlerActionName string    // Can be \"flow\" or \"process\"\n    elastible         Elastible // Can be *Flow or *Process\n}\n\n// Your ESID Type.\ntype ESIDType string\n\n// Solution proposed by https://stackoverflow.com/users/7426/adrian.\ntype Elastible interface {\n    SetESID(id ESIDType)\n}\n\n// Make the Flow and Process pointers implement the Elastible interface.\nfunc (flow *Flow) SetESID(id ESIDType) {\n    flow.ESID = id\n}\n\nfunc (process *Process) SetESID(id ESIDType) {\n    process.ESID = id\n}\n\n// Create a Higher Order Function which will return the actual handler.\nfunc CreateHandler(handler Handler) func(*AppContext, http.ResponseWriter, http.Request) (int, error) {\n\n    return func(a *AppContext, w http.ResponseWriter, r http.Request) (int, error) {\n\n        // Define a sendResponse function so that we may not need to copy paste it later.\n        // It captures w using closure and takes an interface argument that we use to call .Encode() with.\n\n        sendResponse := func(response interface{}) (int, error) {\n            b := new(bytes.Buffer)\n            json.NewEncoder(b).Encode(response)\n            w.Header().Set(\"Content-Type\", \"application/json\")\n            w.Write(b.Bytes())\n            return 200, nil\n        }\n\n        // Define these variables beforehand since we'll be using them\n        // in both the if and else block. Not necessary really.\n        var code int\n        var err error\n\n        // Check the handlerType. Is it create or get?\n        if handler.handlerType == \"CREATE\" {\n            var highest int\n\n            // Creates the thing using handler.handlerActionName which may be \"flow\" or \"process\"\n            highest, code, err = a.Create(handler.handlerActionName, r)\n            if code != 200 || err != nil {\n                return code, err\n            }\n\n            // Send the response using the above defined function and return.\n            return sendResponse(struct {\n                Highest int `json:\"id\"`\n            }{highest})\n\n        } else {\n\n            // This is GET handlerType.\n            var hit HitType\n\n            // Get the hit using again the handler.handlerActionName which may be \"flow\" or \"process\"\n            hit, code, err = a.GetByID(handler.handlerActionName, mux.Vars(r)[\"id\"], r)\n            if code != 200 || err != nil {\n                return code, err\n            }\n\n            // Do the un-marshalling.\n            err = json.Unmarshal(*hit.Source, ob)\n            if err != nil {\n                return 500, err\n            }\n\n            // We have set the handler.elastible to be an interface type\n            // which will have the SetESID function that will set the ESID in the\n            // underlying type that will be passed on runtime.\n            // So the ESID will be set for both the Flow and the Process types.\n            // This interface idea was given inside an earlier answer by\n            // https://stackoverflow.com/users/7426/adrian\n\n            handler.elastible.SetESID(hit.id)\n            return sendResponse(handler.elastible)\n        }\n    }\n}\n</code></pre>\n\n<p>And you would setup your mux end points using the following code.</p>\n\n<pre><code>    // This was your first function. \"CreateFlow\"\n    api.Handle(\"/createFlow/{id:[0-9]+}\", handlers.AppHandler{\n        context, CreateHandler(Handler{\n            elastible:         &amp;Flow{},\n            handlerActionName: \"flow\",\n            handlerType:       \"CREATE\",\n        }),\n    }).Methods(\"GET\")\n\n    // This was your second function. \"CreateProcess\"\n    api.Handle(\"/createProcess/{id:[0-9]+}\", handlers.AppHandler{\n        context, CreateHandler(Handler{\n            elastible:         &amp;Process{},\n            handlerActionName: \"process\",\n            handlerType:       \"CREATE\",\n        }),\n    }).Methods(\"GET\")\n\n    // This was your third function. \"GetFlow\"\n    api.Handle(\"/getFlow/{id:[0-9]+}\", handlers.AppHandler{\n        context, CreateHandler(Handler{\n            elastible:         &amp;Flow{},\n            handlerActionName: \"flow\",\n            handlerType:       \"GET\",\n        }),\n    }).Methods(\"GET\")\n\n    // This was your fourth function. \"GetProcess\"\n    api.Handle(\"/getProcess/{id:[0-9]+}\", handlers.AppHandler{\n        context, CreateHandler(Handler{\n            elastible:         &amp;Process{},\n            handlerActionName: \"process\",\n            handlerType:       \"GET\",\n        }),\n    }).Methods(\"GET\")\n</code></pre>\n\n<p><br />\nHope it helps!</p>\n"}], "owner": {"reputation": 55, "user_id": 1236359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12f8b663ef9122ee0a7f4fac6ae706c6?s=128&d=identicon&r=PG", "display_name": "droneprime", "link": "https://stackoverflow.com/users/1236359/droneprime"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1054, "favorite_count": 0, "accepted_answer_id": 45845300, "answer_count": 2, "score": 2, "last_activity_date": 1503511955, "creation_date": 1503506419, "question_id": 45845181, "link": "https://stackoverflow.com/questions/45845181/golang-handlers-handling-different-types", "title": "Golang handlers handling different types", "body": "<p>These are AppHandlers from a pattern I found online while researching gorilla/mux. They part of a struct that satisfies http.Handler. If you notice, the following two blocks are exactly the same. Effectively, they could be passed the 'variant' (\"flow\" or \"process\") as a string.</p>\n\n<pre><code>func CreateFlow(a *AppContext, w http.ResponseWriter, r *http.Request) (int, error) {\n\n    highest, code, err := a.Create(\"flow\", r)\n    if code != 200 || err != nil {\n        return code, err\n    }\n\n    b := new(bytes.Buffer)\n    json.NewEncoder(b).Encode(struct {\n        Highest int `json:\"id\"`\n    }{highest})\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.Write(b.Bytes())\n    return 200, nil\n}\n\nfunc CreateProcess(a *AppContext, w http.ResponseWriter, r *http.Request) (int, error) {\n\n    highest, code, err := a.Create(\"process\", r)\n    if code != 200 || err != nil {\n        return code, err\n    }\n\n    b := new(bytes.Buffer)\n    json.NewEncoder(b).Encode(struct {\n        Highest int `json:\"id\"`\n    }{highest})\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.Write(b.Bytes())\n    return 200, nil\n}\n</code></pre>\n\n<p>However, the following two blocks not only need the string, but they need a variable of the associated type (\"Flow\" and \"Process\") to successfully Unmarshal the hit I get from ElasticSearch. Other than that, they are Identical code.</p>\n\n<pre><code>func GetFlow(a *AppContext, w http.ResponseWriter, r *http.Request) (int, error) {\n\n    hit, code, err := a.GetByID(\"flow\", mux.Vars(r)[\"id\"], r)\n    if code != 200 {\n        return code, err\n    }\n\n    var flow Flow\n\n    err = json.Unmarshal(*hit.Source, &amp;flow)\n    if err != nil {\n        return 500, err\n    }\n\n    flow.ESID = hit.Id\n\n    b := new(bytes.Buffer)\n    json.NewEncoder(b).Encode(flow)\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.Write(b.Bytes())\n    return 200, nil\n}\n\nfunc GetProcess(a *AppContext, w http.ResponseWriter, r *http.Request) (int, error) {\n\n    hit, code, err := a.GetByID(\"process\", mux.Vars(r)[\"id\"], r)\n    if code != 200 {\n        return code, err\n    }\n\n    var process Process\n\n    err = json.Unmarshal(*hit.Source, &amp;process)\n    if err != nil {\n        return 500, err\n    }\n\n    process.ESID = hit.Id\n\n    b := new(bytes.Buffer)\n    json.NewEncoder(b).Encode(process)\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.Write(b.Bytes())\n    return 200, nil\n}\n</code></pre>\n\n<p>I am not sure how to generalize this behavior in golang when there is a declared type involved. These handlers are all in the same package too, as I think that they are all accomplishing a similar task. I am very clearly repeating myself in code but I need advice on how I can improve. I've gone past \"a little copying is better than a little dependency.\" but I am afraid because \"reflection is never clear\". </p>\n\n<p>Here is an example of the declaration in main using one of these functions.</p>\n\n<pre><code>api.Handle(\"/flow/{id:[0-9]+}\", handlers.AppHandler{context, handlers.GetFlow}).Methods(\"GET\")\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "goroutine"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1503505190, "post_id": 45844463, "comment_id": 78647669, "body": "If you can&#39;t use a taskqueue, then probably your only option is the flex environment."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1503505869, "post_id": 45844463, "comment_id": 78648087, "body": "Actually, what you can probably do is use resumeable uploads with gcloud, then have it hit another endpoint with a task queue when it is finished uploading. If worst comes to worst, you could use flex for just the one endpoint that doesn&#39;t work in regular, then handle the rest in the standard environment."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1503515835, "post_id": 45844463, "comment_id": 78653603, "body": "When you say <i>&quot;context&quot;</i>, I take it you mean a <code>context.Context</code> parameter. If so: you probably passed the request context in to the routine, there&#39;s no reason you couldn&#39;t pass in a <code>context.Background()</code> value instead. Because otherwise, the request context would&#39;ve gotten cancelled and halted your routine. If you pass in your own context, it can run for as long as you like."}, {"owner": {"reputation": 81, "user_id": 8422870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ffdac6370e07956df6c74e1fbdab2ea?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/8422870/dan"}, "edited": false, "score": 0, "creation_date": 1503522053, "post_id": 45844463, "comment_id": 78656571, "body": "Elias - I tried that, but I need to grab a external data which means I need to use urlfetch. When I pass urlfetch a context from context.Background() it panics with a &quot;not an app engine context&quot; error."}, {"owner": {"reputation": 81, "user_id": 8422870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ffdac6370e07956df6c74e1fbdab2ea?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/8422870/dan"}, "edited": false, "score": 0, "creation_date": 1503522784, "post_id": 45844463, "comment_id": 78656893, "body": "PS. I tried passing the file to the go routine so I wouldn&#39;t need urlfetch. But I have the same panic problem using a context.Background() for the taskqueue. Not sure why they chose to panic rather than just return an error."}], "answers": [{"tags": [], "owner": {"reputation": 637, "user_id": 1532791, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/5ec90903d94b483528e5f0caa63603d1?s=128&d=identicon&r=PG&f=1", "display_name": "Dewey", "link": "https://stackoverflow.com/users/1532791/dewey"}, "is_accepted": false, "score": 0, "last_activity_date": 1542256742, "creation_date": 1542256742, "answer_id": 53312525, "question_id": 45844463, "link": "https://stackoverflow.com/questions/45844463/whats-the-right-way-to-do-long-running-processes-on-app-engine/53312525#53312525", "title": "What&#39;s the right way to do long-running processes on app engine?", "body": "<p>try using:\nappengine.BackgroundContext()\nit should be long-lived but will only work on GAE Flex</p>\n"}], "owner": {"reputation": 81, "user_id": 8422870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ffdac6370e07956df6c74e1fbdab2ea?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/8422870/dan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 501, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1542256742, "creation_date": 1503503920, "question_id": 45844463, "link": "https://stackoverflow.com/questions/45844463/whats-the-right-way-to-do-long-running-processes-on-app-engine", "title": "What&#39;s the right way to do long-running processes on app engine?", "body": "<p>I'm working with Go on App Engine and I'm trying to build an API that needs to perform a long-running background task - in this case it needs to parse and chunk a big file out to task queues. I'd like it to return a 200 and close the user connection immediately and let the process keep running in the background until it's complete (this could take 5-10 minutes). Task queues alone don't really work for my use case because parsing the initial file can take more than the time limit for an API request.</p>\n\n<p>At first I tried a Go routine as a solution for this problem. This failed because my app engine context expired as soon as the parent function closed the user connection. (I suppose I could try writing a go routine that doesn't require a context, but then I'd lose logging and I'd need to fetch the entire remote file and pass it to the go routine.)</p>\n\n<p>Looking through the docs, it looks like App Engine used to have functionality to support exactly what I want to do: [runtime.RunInBackground], but that functionality is now deprecated and the replacement isn't obvious.  </p>\n\n<p>Is there a \"right\" or recommended way to do background processing now?</p>\n\n<p>I suppose I could put a link to my big file into a task queue, but if I understand correctly, even functions called through task queues have to complete execution within a specified amount of time (is it 90 seconds?) I need to be able to run longer than that.</p>\n\n<p>Thanks for any help.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 1, "creation_date": 1503502745, "post_id": 45844001, "comment_id": 78645987, "body": "What kinds of files are these? Is that info contained in the file format, or somehow stored in some windows specific metadata area?"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1503503414, "post_id": 45844001, "comment_id": 78646464, "body": "If its something like ntfs alternate data streams, it could take some syscall voodoo, and I can&#39;t seem to find any existing usages in go."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1503503702, "post_id": 45844001, "comment_id": 78646664, "body": "See <a href=\"https://stackoverflow.com/a/1556384/121660\">stackoverflow.com/a/1556384/121660</a>"}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 1, "creation_date": 1503503891, "post_id": 45844001, "comment_id": 78646820, "body": "@captncraig: I think what OP is actually looking for is how to call the C function <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms647003(v=vs.85).aspx\" rel=\"nofollow noreferrer\"><code>GetFileVersionInfo</code></a> from Go."}, {"owner": {"reputation": 100, "user_id": 5770479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ba897aee2d691f8e9706269ff15a25c?s=128&d=identicon&r=PG&f=1", "display_name": "Nandhakumar Balasubramaniam", "link": "https://stackoverflow.com/users/5770479/nandhakumar-balasubramaniam"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1503505262, "post_id": 45844001, "comment_id": 78647716, "body": "@captncraig: It&#39;s file meta data. These are executable files."}, {"owner": {"reputation": 100, "user_id": 5770479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ba897aee2d691f8e9706269ff15a25c?s=128&d=identicon&r=PG&f=1", "display_name": "Nandhakumar Balasubramaniam", "link": "https://stackoverflow.com/users/5770479/nandhakumar-balasubramaniam"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1503505333, "post_id": 45844001, "comment_id": 78647770, "body": "@TimCooper: Yes, exactly."}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1503508869, "post_id": 45844001, "comment_id": 78649768, "body": "@NandhakumarBalasubramaniam: Are you looking for a solution with or without cgo?"}, {"owner": {"reputation": 100, "user_id": 5770479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ba897aee2d691f8e9706269ff15a25c?s=128&d=identicon&r=PG&f=1", "display_name": "Nandhakumar Balasubramaniam", "link": "https://stackoverflow.com/users/5770479/nandhakumar-balasubramaniam"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1503552585, "post_id": 45844001, "comment_id": 78664992, "body": "@TimCooper: A solution with cgo."}], "answers": [{"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": true, "score": 6, "last_activity_date": 1616139802, "last_edit_date": 1616139802, "creation_date": 1505400197, "answer_id": 46222037, "question_id": 45844001, "link": "https://stackoverflow.com/questions/45844001/how-to-get-a-file-descriptionproduct-name-original-filname-etc-using-golang/46222037#46222037", "title": "How to get a File description(Product name, Original filname, etc.) using golang in windows?", "body": "<p>You can use the <a href=\"https://github.com/gonutz/w32\" rel=\"nofollow noreferrer\" title=\"w32 library\">w32 library</a> for Win32 API calls from Go. No CGo needed.</p>\n<p>Here is an example of how you can retrieve all file information through GetFileVersionInfo and VerQueryValue:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;github.com/gonutz/w32/v2&quot;\n)\n\nfunc main() {\n    const path = `C:\\some file`\n\n    size := w32.GetFileVersionInfoSize(path)\n    if size &lt;= 0 {\n        panic(&quot;GetFileVersionInfoSize failed&quot;)\n    }\n\n    info := make([]byte, size)\n    ok := w32.GetFileVersionInfo(path, info)\n    if !ok {\n        panic(&quot;GetFileVersionInfo failed&quot;)\n    }\n\n    fixed, ok := w32.VerQueryValueRoot(info)\n    if !ok {\n        panic(&quot;VerQueryValueRoot failed&quot;)\n    }\n    version := fixed.FileVersion()\n    fmt.Printf(\n        &quot;file version: %d.%d.%d.%d\\n&quot;,\n        version&amp;0xFFFF000000000000&gt;&gt;48,\n        version&amp;0x0000FFFF00000000&gt;&gt;32,\n        version&amp;0x00000000FFFF0000&gt;&gt;16,\n        version&amp;0x000000000000FFFF&gt;&gt;0,\n    )\n\n    translations, ok := w32.VerQueryValueTranslations(info)\n    if !ok {\n        panic(&quot;VerQueryValueTranslations failed&quot;)\n    }\n    if len(translations) == 0 {\n        panic(&quot;no translation found&quot;)\n    }\n    fmt.Println(&quot;translations:&quot;, translations)\n\n    t := translations[0]\n    // w32.CompanyName simply translates to &quot;CompanyName&quot;\n    company, ok := w32.VerQueryValueString(info, t, w32.CompanyName)\n    if !ok {\n        panic(&quot;cannot get company name&quot;)\n    }\n    fmt.Println(&quot;company:&quot;, company)\n}\n</code></pre>\n"}], "owner": {"reputation": 100, "user_id": 5770479, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ba897aee2d691f8e9706269ff15a25c?s=128&d=identicon&r=PG&f=1", "display_name": "Nandhakumar Balasubramaniam", "link": "https://stackoverflow.com/users/5770479/nandhakumar-balasubramaniam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1521, "favorite_count": 0, "accepted_answer_id": 46222037, "answer_count": 1, "score": 5, "last_activity_date": 1616139802, "creation_date": 1503502536, "question_id": 45844001, "link": "https://stackoverflow.com/questions/45844001/how-to-get-a-file-descriptionproduct-name-original-filname-etc-using-golang", "title": "How to get a File description(Product name, Original filname, etc.) using golang in windows?", "body": "<p>Fileinfo in golang gives Name, time modified, size, etc. I need to get particular File's description(eg: Product name, Original filname, etc.) using golang in windows. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1503501802, "post_id": 45843678, "comment_id": 78645311, "body": "<code>go env</code> output?"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1503501828, "post_id": 45843678, "comment_id": 78645326, "body": "also try <code>go get -v -u github.com&#47;TheThingsNetwork&#47;packet_forwarder</code>"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 4, "creation_date": 1503502006, "post_id": 45843678, "comment_id": 78645447, "body": "There is no <code>protocol</code> package in <a href=\"https://github.com/TheThingsNetwork/ttn/tree/develop/api\" rel=\"nofollow noreferrer\">github.com/TheThingsNetwork/ttn/tree/develop/api</a>. Referenced in <a href=\"https://github.com/TheThingsNetwork/packet_forwarder/blob/master/pktfwd/uplinks.go\" rel=\"nofollow noreferrer\">github.com/TheThingsNetwork/packet_forwarder/blob/master/pkt&zwnj;&#8203;fwd/&hellip;</a>. Quite a few references to packages that don&#39;t exist."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 1, "creation_date": 1503505654, "post_id": 45843678, "comment_id": 78647946, "body": "@captncraig you found the references in <code>master</code>, but tried to resolve them in <code>develop</code>. They exist in <code>master</code>: <a href=\"https://github.com/TheThingsNetwork/ttn/tree/master/api\" rel=\"nofollow noreferrer\">github.com/TheThingsNetwork/ttn/tree/master/api</a>"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 1, "creation_date": 1503506112, "post_id": 45843678, "comment_id": 78648224, "body": "Hmm, it looks like develop is the default branch in github, and what gets pulled via <code>go get</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1503507234, "post_id": 45843678, "comment_id": 78648879, "body": "Yep, looks like you&#39;re right - package maintainer broke it by setting it to default develop."}], "owner": {"reputation": 1823, "user_id": 4293609, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/23407d775ca63f213179c504ffebd0f9?s=128&d=identicon&r=PG&f=1", "display_name": "sabrina2020", "link": "https://stackoverflow.com/users/4293609/sabrina2020"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 260, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1503509110, "creation_date": 1503501620, "last_edit_date": 1503509110, "question_id": 45843678, "link": "https://stackoverflow.com/questions/45843678/cannot-find-any-package", "title": "Cannot find any package", "body": "<p>I am trying to build <a href=\"https://github.com/TheThingsNetwork/packet_forwarder/blob/master/docs/INSTALL_INSTRUCTIONS/SPI.md\" rel=\"nofollow noreferrer\">this project</a>, I installed and configured go on my ubuntu 16.04</p>\n\n<pre><code>go version\ngo version go1.8.3 linux/amd64\n</code></pre>\n\n<p>go env output:</p>\n\n<pre><code>go env\nGOARCH=\"amd64\"\nGOBIN=\"\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/egmintel/go\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/linux_amd64\"\nGCCGO=\"gccgo\"\nCC=\"gcc\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build216980961=/tmp/go-build -gno-record-gcc-switches\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\nPKG_CONFIG=\"pkg-config\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\n</code></pre>\n\n<p>but I am stuck with the first instraction:</p>\n\n<pre><code> go get -u github.com/TheThingsNetwork/packet_forwarder\n</code></pre>\n\n<p>I got these errors:</p>\n\n<pre><code>$ go get -u github.com/TheThingsNetwork/packet_forwarder\n    package github.com/TheThingsNetwork/ttn/api/gateway: cannot find package \"github.com/TheThingsNetwork/ttn/api/gateway\" in any of:\n            /usr/local/go/src/github.com/TheThingsNetwork/ttn/api/gateway (from $GOROOT)\n            /home/egmintel/go/src/github.com/TheThingsNetwork/ttn/api/gateway (from $GOPATH)\n    package github.com/TheThingsNetwork/ttn/api/discovery: cannot find package \"github.com/TheThingsNetwork/ttn/api/discovery\" in any of:\n            /usr/local/go/src/github.com/TheThingsNetwork/ttn/api/discovery (from $GOROOT)\n            /home/egmintel/go/src/github.com/TheThingsNetwork/ttn/api/discovery (from $GOPATH)\n    package github.com/TheThingsNetwork/ttn/api/fields: cannot find package \"github.com/TheThingsNetwork/ttn/api/fields\" in any of:\n            /usr/local/go/src/github.com/TheThingsNetwork/ttn/api/fields (from $GOROOT)\n            /home/egmintel/go/src/github.com/TheThingsNetwork/ttn/api/fields (from $GOPATH)\n    package github.com/TheThingsNetwork/ttn/api/protocol: cannot find package \"github.com/TheThingsNetwork/ttn/api/protocol\" in any of:\n            /usr/local/go/src/github.com/TheThingsNetwork/ttn/api/protocol (from $GOROOT)\n            /home/egmintel/go/src/github.com/TheThingsNetwork/ttn/api/protocol (from $GOPATH)\n    package github.com/TheThingsNetwork/ttn/api/protocol/lorawan: cannot find package \"github.com/TheThingsNetwork/ttn/api/protocol/lorawan\" in any of:\n            /usr/local/go/src/github.com/TheThingsNetwork/ttn/api/protocol/lorawan (from $GOROOT)\n            /home/egmintel/go/src/github.com/TheThingsNetwork/ttn/api/protocol/lorawan (from $GOPATH)\n    package github.com/TheThingsNetwork/ttn/api/router: cannot find package \"github.com/TheThingsNetwork/ttn/api/router\" in any of:\n            /usr/local/go/src/github.com/TheThingsNetwork/ttn/api/router (from $GOROOT)\n            /home/egmintel/go/src/github.com/TheThingsNetwork/ttn/api/router (from $GOPATH)\n</code></pre>\n\n<p>Any ideas what have I missed? Have I miss configured go environment? \nthanks!</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 808, "user_id": 6532640, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-8Uw3zcKUw5c/AAAAAAAAAAI/AAAAAAAAACE/yaXF1QrLkjM/photo.jpg?sz=128", "display_name": "NatNgs", "link": "https://stackoverflow.com/users/6532640/natngs"}, "edited": false, "score": 2, "creation_date": 1503501085, "post_id": 45843390, "comment_id": 78644815, "body": "I don&#39;t understand what is the problem in fact; why did you want help ?"}, {"owner": {"reputation": 14311, "user_id": 5085211, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eEZjd.png?s=128&g=1", "display_name": "fuglede", "link": "https://stackoverflow.com/users/5085211/fuglede"}, "edited": false, "score": 1, "creation_date": 1503501205, "post_id": 45843390, "comment_id": 78644909, "body": "This is the expected behaviour: If it were any different, <code>json.Unmarshal</code> would not be able to handle 1-length slices, such as the one you are using in your JSON."}, {"owner": {"reputation": 9, "user_id": 5432964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/665a8a6080f88bb7a1dfccb7edcfa921?s=128&d=identicon&r=PG&f=1", "display_name": "S. T. Lam", "link": "https://stackoverflow.com/users/5432964/s-t-lam"}, "reply_to_user": {"reputation": 808, "user_id": 6532640, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-8Uw3zcKUw5c/AAAAAAAAAAI/AAAAAAAAACE/yaXF1QrLkjM/photo.jpg?sz=128", "display_name": "NatNgs", "link": "https://stackoverflow.com/users/6532640/natngs"}, "edited": false, "score": 0, "creation_date": 1503501364, "post_id": 45843390, "comment_id": 78645023, "body": "@NatNgs Basically I just need help &quot;removing the square brackets&quot; from it. When I tried to refer to it as an array (referring to index 0), it didn&#39;t work"}, {"owner": {"reputation": 9, "user_id": 5432964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/665a8a6080f88bb7a1dfccb7edcfa921?s=128&d=identicon&r=PG&f=1", "display_name": "S. T. Lam", "link": "https://stackoverflow.com/users/5432964/s-t-lam"}, "reply_to_user": {"reputation": 808, "user_id": 6532640, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-8Uw3zcKUw5c/AAAAAAAAAAI/AAAAAAAAACE/yaXF1QrLkjM/photo.jpg?sz=128", "display_name": "NatNgs", "link": "https://stackoverflow.com/users/6532640/natngs"}, "edited": false, "score": 0, "creation_date": 1503501411, "post_id": 45843390, "comment_id": 78645058, "body": "@NatNgs It threw an error saying &quot;invalid operation: mainTemp[0] (type interface {} does not support indexing)&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 5432964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/665a8a6080f88bb7a1dfccb7edcfa921?s=128&d=identicon&r=PG&f=1", "display_name": "S. T. Lam", "link": "https://stackoverflow.com/users/5432964/s-t-lam"}, "edited": false, "score": 0, "creation_date": 1503501812, "post_id": 45843669, "comment_id": 78645319, "body": "That worked, thanks. I guess this was too hard a project for my first day programming in Go. Also doesn&#39;t help that golang.org is banned where I currently live (China) and I only have limited resources available"}, {"owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1503502358, "post_id": 45843669, "comment_id": 78645715, "body": "Respectfully, there is no casting in go (only type assertions and type conversions). You&#39;re using a type assertion here: (<a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Type_assertions</a>)"}, {"owner": {"reputation": 1090, "user_id": 905927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/290786897f51fbd76a589169d2170607?s=128&d=identicon&r=PG", "display_name": "rouzier", "link": "https://stackoverflow.com/users/905927/rouzier"}, "edited": false, "score": 0, "creation_date": 1503502421, "post_id": 45843669, "comment_id": 78645769, "body": "You are correct I will update my answer to reflect that"}], "tags": [], "owner": {"reputation": 1090, "user_id": 905927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/290786897f51fbd76a589169d2170607?s=128&d=identicon&r=PG", "display_name": "rouzier", "link": "https://stackoverflow.com/users/905927/rouzier"}, "is_accepted": true, "score": 1, "last_activity_date": 1503502537, "last_edit_date": 1503502537, "creation_date": 1503501604, "answer_id": 45843669, "question_id": 45843390, "link": "https://stackoverflow.com/questions/45843390/parsing-json-files-with-arrays-in-go/45843669#45843669", "title": "Parsing JSON files with arrays in Go", "body": "<p>You should first perform a Type assertions on weather as an array of interface{}.</p>\n\n<p>Then do the same on the first element as a map[string]interface{} </p>\n\n<pre><code>temps := parsedMap[\"weather\"].([]interface{})\nmainTemp := temps[0].(map[string]interface{})\n</code></pre>\n\n<p>You can see a full example here <a href=\"https://play.golang.org/p/JIfCGrsYl9\" rel=\"nofollow noreferrer\">https://play.golang.org/p/JIfCGrsYl9</a></p>\n"}, {"comments": [{"owner": {"reputation": 9, "user_id": 5432964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/665a8a6080f88bb7a1dfccb7edcfa921?s=128&d=identicon&r=PG&f=1", "display_name": "S. T. Lam", "link": "https://stackoverflow.com/users/5432964/s-t-lam"}, "edited": false, "score": 0, "creation_date": 1503502058, "post_id": 45843685, "comment_id": 78645503, "body": "That seems like a very nice tool. Thanks"}], "tags": [], "owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "is_accepted": false, "score": 0, "last_activity_date": 1503501644, "creation_date": 1503501644, "answer_id": 45843685, "question_id": 45843390, "link": "https://stackoverflow.com/questions/45843390/parsing-json-files-with-arrays-in-go/45843685#45843685", "title": "Parsing JSON files with arrays in Go", "body": "<p>The issue is that you need to cast as a <code>[]interface{}</code>.</p>\n\n<p>However, you should have a look at using <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">JSON to Go</a> to easily generate a struct type for the JSON you expect. You can strip out any fields you're not interested in.</p>\n\n<p>Saves a lot of type-casting (and error checking)!</p>\n"}], "owner": {"reputation": 9, "user_id": 5432964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/665a8a6080f88bb7a1dfccb7edcfa921?s=128&d=identicon&r=PG&f=1", "display_name": "S. T. Lam", "link": "https://stackoverflow.com/users/5432964/s-t-lam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 45843669, "answer_count": 2, "score": -2, "last_activity_date": 1503502537, "creation_date": 1503500873, "question_id": 45843390, "link": "https://stackoverflow.com/questions/45843390/parsing-json-files-with-arrays-in-go", "title": "Parsing JSON files with arrays in Go", "body": "<p>The following is the JSON file I'm trying to parse (OpenWeatherMap API if anyone is curious). The builtin <code>encoding/json</code> does a pretty good job of it. When I use <code>json.Unmarshal(testJson, &amp;parsed)</code>, most of the JSON file is parsed correctly. However, with the way that it is formatted, the \"weather\" is giving me a headache.</p>\n\n<p>I parsed the file generated by <code>encoding/json</code> with <code>parsedMap := parsed.(map[string]interface{})</code>, which works when I try to refer to key,value pair with the key \"main\". </p>\n\n<p>With <code>fmt.Println()</code>, the value is <code>map[temp:280.32 pressure:1012 humidity:81 temp_min:279.15 temp_max:281.15]</code>, which I can work with. </p>\n\n<p>With the key \"weather\" however, I get this <code>[map[icon:09d id:300 main:Drizzle description:light intensity drizzle]]</code>. The additional square brackets seem to be causing issues.</p>\n\n<pre><code>{\n  \"coord\": {\n      \"lon\": -0.13,\n      \"lat\": 51.51\n    },\n    \"weather\": [\n      {\n        \"id\": 300,\n        \"main\": \"Drizzle\",\n        \"description\": \"light intensity drizzle\",\n        \"icon\": \"09d\"\n      }\n    ],\n    \"base\": \"stations\",\n    \"main\": {\n      \"temp\": 280.32,\n      \"pressure\": 1012,\n      \"humidity\": 81,\n      \"temp_min\": 279.15,\n      \"temp_max\": 281.15\n    },\n    \"visibility\": 10000,\n    \"wind\": {\n      \"speed\": 4.1,\n      \"deg\": 80\n    },\n    \"clouds\": {\n      \"all\": 90\n    },\n    \"dt\": 1485789600,\n    \"sys\": {\n      \"type\": 1,\n      \"id\": 5091,\n      \"message\": 0.0103,\n      \"country\": \"GB\",\n      \"sunrise\": 1485762037,\n      \"sunset\": 1485794875\n    },\n    \"id\": 2643743,\n    \"name\": \"London\",\n    \"cod\": 200\n  }\n</code></pre>\n\n<p>Code for reference:</p>\n\n<p>var testJSON = //JSON EARLIER IN THE POST\n    var parsed interface{}</p>\n\n<pre><code>json.Unmarshal(testJSON, &amp;parsed)\n\nparsedMap := parsed.(map[string]interface{})\nmainTemp := parsedMap[\"weather\"]\n\n\nfmt.Println(mainTemp)\n</code></pre>\n"}, {"tags": ["go", "versioning", "vendor"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1503499143, "post_id": 45842740, "comment_id": 78643282, "body": "Nothing. v1.1.4 (the latest tag) is from last September. PanicsWithValue was added June 1."}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1503499201, "post_id": 45842740, "comment_id": 78643337, "body": "Is there any way to force <code>dep</code> to use the version that is in <code>$GOPATH&#47;src</code>?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1503499303, "post_id": 45842740, "comment_id": 78643431, "body": "I&#39;m not terribly familiar with <code>dep</code> but it looks like it&#39;s all-or-nothing. You can remove the constraint entirely though (<code>version = &quot;*&quot;</code>) and it should use master@HEAD."}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1503499333, "post_id": 45842740, "comment_id": 78643457, "body": "I&#39;ll try that. Thanks."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1503499429, "post_id": 45842740, "comment_id": 78643540, "body": "Converted to answer."}], "answers": [{"comments": [{"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1503499517, "post_id": 45842892, "comment_id": 78643613, "body": "The version in <code>vendor</code> still does not contain the <code>PanicsWithValue</code> function, after <code>dep ensure -update; dep prune; dep status</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1503499574, "post_id": 45842892, "comment_id": 78643662, "body": "Did you run <code>dep ensure</code> after updating the <code>Gopkg.toml</code> file?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1503499652, "post_id": 45842892, "comment_id": 78643721, "body": "What is your <code>dep status</code> output for <code>testify</code>?"}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1503499690, "post_id": 45842892, "comment_id": 78643745, "body": "<code>github.com&#47;stretchr&#47;testify  *  v1.1.4  69483b4  69483b4  1</code>"}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1503499736, "post_id": 45842892, "comment_id": 78643785, "body": "And my constaint contains: <code>[[constraint]]   name = &quot;github.com&#47;stretchr&#47;testify&quot;   version = &quot;*&quot;</code>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1503499851, "post_id": 45842892, "comment_id": 78643898, "body": "Looks like you can try removing it from <code>vendor</code> and adding it to <a href=\"https://github.com/golang/dep/blob/master/docs/Gopkg.toml.md#ignored\" rel=\"nofollow noreferrer\"><code>ignored</code></a> in your <code>Gopkg.toml</code>."}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1503499915, "post_id": 45842892, "comment_id": 78643950, "body": "Thanks. Unfortunately that defeats vendoring. I&#39;ll keep playing with it."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1503499958, "post_id": 45842892, "comment_id": 78643981, "body": "Then why did you ask &quot;Is there any way to force dep to use the version that is in $GOPATH/src?&quot;? That is the definition of defeating vendoring."}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1503503941, "post_id": 45842892, "comment_id": 78646849, "body": "Sorry. I misspoke. I should have said: &quot;Is there any way to force <code>dep</code> to copy the version that is in <code>$GOPATH&#47;src</code> to <code>vendor</code>?&quot;"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1503505320, "post_id": 45842892, "comment_id": 78647759, "body": "No. <code>dep</code> gets dependencies from the canonical source, not from local disk. If you want it vendored, you&#39;ll have to modify <code>Gopkg.toml</code> to get it to use the canonical version you want. You could try replacing <code>version = &quot;*&quot;</code> with <code>branch = &quot;master&quot;</code>."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 0, "last_activity_date": 1503499421, "creation_date": 1503499421, "answer_id": 45842892, "question_id": 45842740, "link": "https://stackoverflow.com/questions/45842740/gopath-src-and-vendor-versions-are-different/45842892#45842892", "title": "$GOPATH/src/... and vendor/... versions are different", "body": "<p>By pinning the version to v1.1.4, you're specifically telling <code>dep</code> to use a version that does not include the feature you want (check the history of the testify package on GitHub - v1.1.4 is from last September, <code>PanicsWithValue</code> was added this past June). If you unpin the version (<code>version = \"*\"</code>) it should use master@HEAD which includes <code>PanicsWithValue</code>.</p>\n"}], "owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 256, "favorite_count": 0, "accepted_answer_id": 45842892, "answer_count": 1, "score": 2, "last_activity_date": 1503499421, "creation_date": 1503498987, "question_id": 45842740, "link": "https://stackoverflow.com/questions/45842740/gopath-src-and-vendor-versions-are-different", "title": "$GOPATH/src/... and vendor/... versions are different", "body": "<p>My project, using Go 1.8, has a dependency on <code>github.com/stretchr/testify</code>. I retrieved the latest using <code>go get -u github.com/stretchr/testify</code> and the version in <code>$GOPATH/src</code> appears to be correct.</p>\n\n<p>I added the latest version number as a contraint in <code>Gopkg.toml</code>:</p>\n\n<pre><code>[[constraint]]\n  name = \"github.com/stretchr/testify\"\n  version = \"1.1.4\"\n</code></pre>\n\n<p>I then ran <code>dep ensure -update</code> and then <code>dep status</code> to update the <code>vendor</code> directory (output of <code>dep status</code>):</p>\n\n<pre><code>github.com/stretchr/testify  ^1.1.4  v1.1.4  69483b4  69483b4  1   \n</code></pre>\n\n<p>The version in <code>$GOPATH/src</code> contains, in the file <code>github.com/stretchr/testify/assert/assertions.go</code>, the function <code>PanicsWithValue</code>:</p>\n\n<pre><code>func Panics(t TestingT, f PanicTestFunc, msgAndArgs ...interface{}) bool {\n    // ...\n}\n\nfunc PanicsWithValue(t TestingT, expected interface{}, f PanicTestFunc, msgAndArgs ...interface{}) bool {\n    // ...\n}\n\nfunc NotPanics(t TestingT, f PanicTestFunc, msgAndArgs ...interface{}) bool {\n    // ...\n}\n</code></pre>\n\n<p>but in the version in <code>vendor</code>, that function is missing:</p>\n\n<pre><code>func Panics(t TestingT, f PanicTestFunc, msgAndArgs ...interface{}) bool {\n    // ...\n}\n\nfunc NotPanics(t TestingT, f PanicTestFunc, msgAndArgs ...interface{}) bool {\n    // ...\n}\n</code></pre>\n\n<p>What am I doing wrong? I would like to use the function <code>PanicsWithValue</code> in my testing. I even tried deleting the entire <code>vendor</code> directory and rebuilding it.</p>\n"}, {"tags": ["arrays", "go"], "comments": [{"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 2, "creation_date": 1503498611, "post_id": 45842551, "comment_id": 78642792, "body": "Please note: you&#39;re using <i>slices</i>, not arrays."}, {"owner": {"reputation": 919, "user_id": 3239630, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/lO5aN.png?s=128&g=1", "display_name": "Alok G.", "link": "https://stackoverflow.com/users/3239630/alok-g"}, "reply_to_user": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1503499191, "post_id": 45842551, "comment_id": 78643325, "body": "Thanks, Gavin. I was just carrying legacy terms :)"}], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 6, "last_activity_date": 1503498741, "last_edit_date": 1503498741, "creation_date": 1503498576, "answer_id": 45842582, "question_id": 45842551, "link": "https://stackoverflow.com/questions/45842551/copy-in-array-without-size/45842582#45842582", "title": "Copy in array (without size)", "body": "<p>You can get the length of a slice with <code>len(employees)</code>. Generally, if you know the size up front, <code>ids := make([]int64, length)</code> is preferrable to <code>ids := []int64{}</code> because it will result in fewer allocations as the slice grows.</p>\n\n<pre><code>ids := make([]int64, len(employees))\nfor i,e := range employees{\n   ids[i] = e.ID\n}\n</code></pre>\n\n<p>Or a slightly alternate style:</p>\n\n<pre><code>ids := make([]int64, 0, len(employees)) // declare capacity, but not length\nfor _ , e := range employees{\n   ids = append(ids, e.ID)\n}\n</code></pre>\n"}], "owner": {"reputation": 919, "user_id": 3239630, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/lO5aN.png?s=128&g=1", "display_name": "Alok G.", "link": "https://stackoverflow.com/users/3239630/alok-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 3, "accepted_answer_id": 45842582, "answer_count": 1, "score": 2, "last_activity_date": 1503509142, "creation_date": 1503498503, "last_edit_date": 1503509142, "question_id": 45842551, "link": "https://stackoverflow.com/questions/45842551/copy-in-array-without-size", "title": "Copy in array (without size)", "body": "<p>I am new to go and I'm trying to extract a bit of specific data (Employee.ID) from an array and insert it into another (new) array.</p>\n\n<p>So far I've had no luck in doing so, the code I use is as follows:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Employee struct {\n    ID         int64\n    Name       string\n    Department string\n}\n\nfunc main() {\n    employees := []Employee{{1, \"Ram\", \"India\"}, {2, \"Criest\", \"Europe\"}}\n    ids := []int64{}\n    for i, v := range employees {\n        fmt.Println(i, v)\n    }\n}\n</code></pre>\n\n<p>In short, I want to extract ID from the <code>employees</code> array and copy those to the <code>ids</code> array. The size of <code>employees</code> array is not fixed at any point in time.</p>\n\n<p>Thanks for all your help.</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 2, "creation_date": 1503495545, "post_id": 45841332, "comment_id": 78640180, "body": "You&#39;ve shown some go client code, but are not showing any server, or what is executing <code>InteractByKey</code>"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1503495798, "post_id": 45841332, "comment_id": 78640405, "body": "I&#39;m also not so well versed in python semantics. Is the read loop making requests one at a time, or in parallel?"}, {"owner": {"reputation": 1617, "user_id": 1478168, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/2Fok1.jpg?s=128&g=1", "display_name": "thinkerou", "link": "https://stackoverflow.com/users/1478168/thinkerou"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1503495880, "post_id": 45841332, "comment_id": 78640461, "body": "@captncraig one request at a time, not parallel."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1503495975, "post_id": 45841332, "comment_id": 78640543, "body": "Which process are you showing fds for? Go or python?"}, {"owner": {"reputation": 1617, "user_id": 1478168, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/2Fok1.jpg?s=128&g=1", "display_name": "thinkerou", "link": "https://stackoverflow.com/users/1478168/thinkerou"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1503496061, "post_id": 45841332, "comment_id": 78640623, "body": "@captncraig it is Go."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1503496070, "post_id": 45841332, "comment_id": 78640632, "body": "nvm my comment about the body, I misread your code."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1503499473, "post_id": 45841332, "comment_id": 78643582, "body": "It is possible the server on the other end is not allowing keep alive connections. Does it behave differently with a different host?"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1503499694, "post_id": 45841332, "comment_id": 78643749, "body": "Can you give a full, working example baidu url so I can check it?"}, {"owner": {"reputation": 1617, "user_id": 1478168, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/2Fok1.jpg?s=128&g=1", "display_name": "thinkerou", "link": "https://stackoverflow.com/users/1478168/thinkerou"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1503503041, "post_id": 45841332, "comment_id": 78646197, "body": "@captncraig Sorry, the url can only visit on inner-net."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1503535377, "post_id": 45841332, "comment_id": 78660676, "body": "Don&#39;t do anything with the Response if there&#39;s an error. There&#39;s no guarantee the response is valid in the case of an error. Follow the documentation and check the error first."}], "owner": {"reputation": 1617, "user_id": 1478168, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/2Fok1.jpg?s=128&g=1", "display_name": "thinkerou", "link": "https://stackoverflow.com/users/1478168/thinkerou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 80, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1503509178, "creation_date": 1503495403, "last_edit_date": 1503509178, "question_id": 45841332, "link": "https://stackoverflow.com/questions/45841332/fd-leak-how-should-i-refactor-code", "title": "FD Leak, how should I refactor code?", "body": "<p>I have read the <a href=\"https://stackoverflow.com/questions/39813587/go-client-program-generates-a-lot-a-sockets-in-time-wait-state\">post</a></p>\n\n<p>My service code like the following:</p>\n\n<pre><code>type httpResponse struct {\n    StatusCode int\n    Header     http.Header\n    Body       []byte\n}\n\nvar client *http.Client\n\nfunc init() {\n    client = &amp;http.Client{\n        Transport: &amp;http.Transport{\n            Proxy: http.ProxyFromEnvironment,\n            DialContext: (&amp;net.Dialer{\n                Timeout:   30 * time.Second,\n                KeepAlive: 30 * time.Second,\n            }).DialContext,\n            MaxIdleConns:          100,\n            MaxIdleConnsPerHost:   100,\n            IdleConnTimeout:       90 * time.Second,\n            TLSHandshakeTimeout:   10 * time.Second,\n            ExpectContinueTimeout: 3 * time.Second,\n        },\n    }\n}\n\nfunc sendRequest(url string) (httpResponse, error) {\n    var res httpResponse\n    req, err := http.NewRequest(\"GET\", url, nil)\n    if err != nil {\n        return res, err\n    }\n    resp, err := client.Do(req)\n    if resp != nil {\n        res.StatusCode = resp.StatusCode\n        res.Header = resp.Header\n    }\n    if err != nil {\n        return res, err\n    }\n    defer resp.Body.Close()\n    res.Body, err = ioutil.ReadAll(resp.Body)\n    if err != nil {\n        return res, err\n    }\n    return res, nil\n}\n\nfunc InteractByKey(key string) (Info, error) {\n    host := \"http://test.baidu.com\"\n    url := fmt.Sprintf(\"%s/test/2.0/info?method=select&amp;key=%s\", host, key)\n\n    for intRetry := 0; intRetry &lt; 3; intRetry++ {\n        resp, err := sendRequest(url)\n        if err != nil {\n            continue\n        }\n        if resp.StatusCode &gt;= 500 {\n            continue\n        }\n        if resp.StatusCode &gt;= 400 &amp;&amp; resp.StatusCode &lt; 500 {\n            continue\n        }\n        arrRes, err := unpackInfo(resp.Body)\n        return arrRes[0], err\n    }\n    return Info{}, &amp;ErrGetInfoFailed\n}\n</code></pre>\n\n<p>And my client code like the following using Python, the <code>InteractByKey</code> of service is visited by client and one request at a time:</p>\n\n<pre><code>#!/usr/bin python\n#coding=utf-8\n\nimport requests\n\n# address is the ip of machine A\nurl = \"http://10.95.35.14:8099/test/2.0/check?method=InteractByKey&amp;key=\"\n\n\ndef _send_request(url):\n    session = requests.Session()\n    session.keep_alive = False\n\n    resp = None\n    try:\n        resp = session.get(url)\n    except:\n        if resp is not None:\n            resp.connection.close()\n            return (False, url)\n    if resp is None or resp.status_code != 200:\n        if resp is not None:\n            resp.connection.close()\n        return (False, url)\n    try:\n        data = resp.json()\n    except:\n        if resp is not None:\n            resp.connection.close()\n            return (False, url)\n    if resp is not None:\n        resp.connection.close()\n    try:\n        if data['result'][0]['mark_result']['success'] is False:\n            return (False, data)\n    except:\n        return (False, url)\n    return (True, data)\n\nwith open('test.txt') as f:\n    for line in f:\n        key = line.strip()\n        urls = url + key\n        res = _send_request(urls)\n        if res[0] is True:\n            print \"OK \" + key + \" \" + str(res[1])\n        else:\n            print \"Error \" + key + \" \" + str(res[1])\n</code></pre>\n\n<p>Machine A run my service program(Go language), and machine B run my client program(Python language).</p>\n\n<p>When I send request by client program to service, my fd of service(Go) machine will always add, like this:</p>\n\n<pre><code>$ lsof -p 18464 | wc -l\n182\n$ lsof -p 18464 | wc -l\n199\n$ lsof -p 18464 | wc -l\n876\n$ lsof -p 18464 | wc -l\n1580\n$ lsof -p 18464 | wc -l\n2107\n$ lsof -p 18464 | wc -l\n2709\n$ lsof -p 18464 | wc -l\n2910\n</code></pre>\n\n<p>When the number reach about 8000, <code>sendRequest</code> will timeout, it can not run or restart my service program.</p>\n\n<p>So, how should I rewrite my code?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 0, "creation_date": 1503486719, "post_id": 45838110, "comment_id": 78633222, "body": "What code are you using to print ? We can&#39;t fix a code you don&#39;t show."}, {"owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "reply_to_user": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 0, "creation_date": 1503488021, "post_id": 45838110, "comment_id": 78634183, "body": "just updated query . please suggest"}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 3, "creation_date": 1503488378, "post_id": 45838110, "comment_id": 78634451, "body": "what do you mean by storing in different lines ?"}, {"owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "edited": false, "score": 1, "creation_date": 1503489732, "post_id": 45838110, "comment_id": 78635442, "body": "i mean , can we put/index new line character after each element in slice so that if i just print the slice content , then it should show content in vertical manner"}], "answers": [{"comments": [{"owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "edited": false, "score": 0, "creation_date": 1503487536, "post_id": 45838162, "comment_id": 78633819, "body": "thanks. can we restore the slice with new content (with new line ?)"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "edited": false, "score": 0, "creation_date": 1503489915, "post_id": 45838162, "comment_id": 78635595, "body": "See my revised answer."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 3, "last_activity_date": 1503489886, "last_edit_date": 1503489886, "creation_date": 1503486817, "answer_id": 45838162, "question_id": 45838110, "link": "https://stackoverflow.com/questions/45838110/how-to-print-slice-content-on-new-line-on-console/45838162#45838162", "title": "how to print slice content on new line on console?", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype VSlice []int\n\nfunc (s VSlice) String() string {\n    var str string\n    for _, i := range s {\n        str += fmt.Sprintf(\"%d\\n\", i)\n    }\n    return str\n}\n\nfunc main() {\n    slice := []int{1, 2, 3}\n    fmt.Print(VSlice(slice))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>1\n2\n3\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4970, "user_id": 892788, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e233ae4d7776dd50ffc5dd43eab2d8e8?s=128&d=identicon&r=PG", "display_name": "diyoda_", "link": "https://stackoverflow.com/users/892788/diyoda"}, "is_accepted": false, "score": 3, "last_activity_date": 1522427769, "creation_date": 1522427769, "answer_id": 49578017, "question_id": 45838110, "link": "https://stackoverflow.com/questions/45838110/how-to-print-slice-content-on-new-line-on-console/49578017#49578017", "title": "how to print slice content on new line on console?", "body": "<p>You can also use <code>strings.Join</code></p>\n\n<pre><code>stringSlices := strings.Join(slice[:], \"\\n\\n\")\nfmt.Print(stringSlices)\n</code></pre>\n"}], "owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5024, "favorite_count": 1, "accepted_answer_id": 45838162, "answer_count": 2, "score": -3, "last_activity_date": 1522427769, "creation_date": 1503486629, "last_edit_date": 1592644375, "question_id": 45838110, "link": "https://stackoverflow.com/questions/45838110/how-to-print-slice-content-on-new-line-on-console", "title": "how to print slice content on new line on console?", "body": "<p>is there any way to store each element of slice on new line ?\nsomething like this :</p>\n<blockquote>\n<p>1</p>\n<p>2</p>\n<p>3</p>\n</blockquote>\n<p>instead of</p>\n<blockquote>\n<p>1\n2\n3</p>\n</blockquote>\n<p>i just dont want to print these elements on new line but want to store elements each on separate line</p>\n<p>here is the code:</p>\n<pre><code>package main\n\nimport &quot;fmt&quot;\n\nfunc main() {\n \n\nslice := []int{1, 2, 3}\nfmt.Println(slice)\n\n}\n \n</code></pre>\n<p>Thanks</p>\n"}, {"tags": ["performance", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1503483697, "post_id": 45836981, "comment_id": 78631047, "body": "Rules for inlining can be found here: <a href=\"https://stackoverflow.com/questions/41119734/stimulate-code-inlining/41119979#41119979\">Stimulate code-inlining</a>."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1503484717, "post_id": 45836981, "comment_id": 78631760, "body": "There is no manual control over what gets inlined and what not, so: No."}, {"owner": {"reputation": 318, "user_id": 4571878, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VBABu.jpg?s=128&g=1", "display_name": "Grigorii Sokolik", "link": "https://stackoverflow.com/users/4571878/grigorii-sokolik"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1503484792, "post_id": 45836981, "comment_id": 78631810, "body": "@icza there is nothing about loops there isn&#39;t it?"}, {"owner": {"reputation": 104432, "user_id": 53212, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e0fbce15f81d6308656931250db267a1?s=128&d=identicon&r=PG", "display_name": "thomasrutter", "link": "https://stackoverflow.com/users/53212/thomasrutter"}, "edited": false, "score": 0, "creation_date": 1503750679, "post_id": 45836981, "comment_id": 78749590, "body": "I just did a quick test and replacing the for loop with the equivalent labels and goto statements allows inlining, which surprised me as I assumed there was some technical reason for loops couldn&#39;t be inlined."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 19, "last_activity_date": 1503486542, "last_edit_date": 1503486542, "creation_date": 1503486242, "answer_id": 45837940, "question_id": 45836981, "link": "https://stackoverflow.com/questions/45836981/is-it-possible-to-inline-function-containing-loop-in-golang/45837940#45837940", "title": "Is it possible to inline function, containing loop in Golang?", "body": "<blockquote>\n  <p><a href=\"https://github.com/golang/go/wiki\" rel=\"noreferrer\">Go Wiki</a></p>\n  \n  <p><a href=\"https://github.com/golang/go/wiki/CompilerOptimizations\" rel=\"noreferrer\">CompilerOptimizations</a></p>\n  \n  <p>Function Inlining</p>\n  \n  <p>Only short and simple functions are inlined. To be inlined a function\n  must contain less than ~40 expressions and does not contain complex\n  things like function calls, loops, labels, closures, panic's,\n  recover's, select's, switch'es, etc.</p>\n</blockquote>\n\n<p>Currently, functions with loops are not inlined.</p>\n"}, {"tags": [], "owner": {"reputation": 158, "user_id": 11781037, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AKeEa.png?s=128&g=1", "display_name": "NO_GUI", "link": "https://stackoverflow.com/users/11781037/no-gui"}, "is_accepted": false, "score": 1, "last_activity_date": 1616956910, "creation_date": 1616956910, "answer_id": 66844931, "question_id": 45836981, "link": "https://stackoverflow.com/questions/45836981/is-it-possible-to-inline-function-containing-loop-in-golang/66844931#66844931", "title": "Is it possible to inline function, containing loop in Golang?", "body": "<p>As of go version 1.16:\n<a href=\"https://golang.org/doc/go1.16#compiler\" rel=\"nofollow noreferrer\">https://golang.org/doc/go1.16#compiler</a></p>\n<blockquote>\n<p>The compiler can now inline functions with non-labeled for loops, method values, and type switches. The inliner can also detect more indirect calls where inlining is possible.</p>\n</blockquote>\n"}], "owner": {"reputation": 318, "user_id": 4571878, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/VBABu.jpg?s=128&g=1", "display_name": "Grigorii Sokolik", "link": "https://stackoverflow.com/users/4571878/grigorii-sokolik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8397, "favorite_count": 4, "accepted_answer_id": 45837940, "answer_count": 2, "score": 11, "last_activity_date": 1616956910, "creation_date": 1503483487, "question_id": 45836981, "link": "https://stackoverflow.com/questions/45836981/is-it-possible-to-inline-function-containing-loop-in-golang", "title": "Is it possible to inline function, containing loop in Golang?", "body": "<p>For instance, I have the following test in golang:</p>\n\n<pre><code>// inline-tests.go\npackage inlinetests\n\nfunc plus(a, b int) int {\n    return a + b\n}\n\nfunc plus_plus(a, b, c int) int {\n    return plus(plus(a, b), plus(b, c))\n}\n\nfunc plus_iter(l ...int) (res int) {\n    for _, v := range l {\n        res += v\n    }\n    return\n}\n</code></pre>\n\n<p>If I try to build it, I receive the following:</p>\n\n<pre><code>go build -gcflags=-m inline-tests.go\n# command-line-arguments\n./inline-tests.go:4: can inline plus\n./inline-tests.go:8: can inline plus_plus\n./inline-tests.go:9: inlining call to plus\n./inline-tests.go:9: inlining call to plus\n./inline-tests.go:9: inlining call to plus\n./inline-tests.go:12: plus_iter l does not escape\n</code></pre>\n\n<p>Is there any way to let compiler inline <code>plus_iter</code>? If <strong>yes</strong>, is there any way to inline map iteration?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 5183, "user_id": 2534777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f9d1450403b864d6b17f30ba0ce0aee3?s=128&d=identicon&r=PG", "display_name": "orcaman", "link": "https://stackoverflow.com/users/2534777/orcaman"}, "edited": false, "score": 3, "creation_date": 1503577161, "post_id": 45837752, "comment_id": 78680876, "body": "What an awesome answer, thanks. Small comment: on the SeekEnd case, you need to increment the offset, not subtract it. Check out stdlib&#39;s reader.go for reference. Since I&#39;m using this in several projects, I&#39;ve made this into a lib and gave you credit in the license and readme files. Check it out: <a href=\"https://github.com/orcaman/writerseeker\" rel=\"nofollow noreferrer\">github.com/orcaman/writerseeker</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 10, "last_activity_date": 1503580969, "last_edit_date": 1503580969, "creation_date": 1503485779, "answer_id": 45837752, "question_id": 45836767, "link": "https://stackoverflow.com/questions/45836767/using-an-io-writeseeker-without-a-file-in-go/45837752#45837752", "title": "Using an io.WriteSeeker without a File in Go", "body": "<p>Unfortunately there is no ready solution for an in-memory <a href=\"https://golang.org/pkg/io/#WriteSeeker\" rel=\"noreferrer\"><code>io.WriteSeeker</code></a> implementation in the standard lib.</p>\n\n<p>But as always, you can always implement your own. It's not that hard.</p>\n\n<p>An <code>io.WriteSeeker</code> is an <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"noreferrer\"><code>io.Writer</code></a> and an <a href=\"https://golang.org/pkg/io/#Seeker\" rel=\"noreferrer\"><code>io.Seeker</code></a>, so basically you only need to implement 2 methods:</p>\n\n<pre><code>Write(p []byte) (n int, err error)\nSeek(offset int64, whence int) (int64, error)\n</code></pre>\n\n<p>Read the general contract of these methods in their documentation how they should behave.</p>\n\n<p>Here's a simple implementation which uses an in-memory byte slice (<code>[]byte</code>). It's not optimized for speed, this is just a \"demo\" implementation.</p>\n\n<pre><code>type mywriter struct {\n    buf []byte\n    pos int\n}\n\nfunc (m *mywriter) Write(p []byte) (n int, err error) {\n    minCap := m.pos + len(p)\n    if minCap &gt; cap(m.buf) { // Make sure buf has enough capacity:\n        buf2 := make([]byte, len(m.buf), minCap+len(p)) // add some extra\n        copy(buf2, m.buf)\n        m.buf = buf2\n    }\n    if minCap &gt; len(m.buf) {\n        m.buf = m.buf[:minCap]\n    }\n    copy(m.buf[m.pos:], p)\n    m.pos += len(p)\n    return len(p), nil\n}\n\nfunc (m *mywriter) Seek(offset int64, whence int) (int64, error) {\n    newPos, offs := 0, int(offset)\n    switch whence {\n    case io.SeekStart:\n        newPos = offs\n    case io.SeekCurrent:\n        newPos = m.pos + offs\n    case io.SeekEnd:\n        newPos = len(m.buf) + offs\n    }\n    if newPos &lt; 0 {\n        return 0, errors.New(\"negative result pos\")\n    }\n    m.pos = newPos\n    return int64(newPos), nil\n}\n</code></pre>\n\n<p>Yes, and that's it.</p>\n\n<p>Testing it:</p>\n\n<pre><code>my := &amp;mywriter{}\nvar ws io.WriteSeeker = my\n\nws.Write([]byte(\"hello\"))\nfmt.Println(string(my.buf))\n\nws.Write([]byte(\" world\"))\nfmt.Println(string(my.buf))\n\nws.Seek(-2, io.SeekEnd)\nws.Write([]byte(\"k!\"))\nfmt.Println(string(my.buf))\n\nws.Seek(6, io.SeekStart)\nws.Write([]byte(\"gopher\"))\nfmt.Println(string(my.buf))\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/TjXBLd3E5m\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>hello\nhello world\nhello work!\nhello gopher\n</code></pre>\n\n<p><strong>Things that can be improved:</strong></p>\n\n<ul>\n<li><p>Create a <code>mywriter</code> value with an initial empty <code>buf</code> slice, but with a capacity that will most likely cover the size of the result PDF document. E.g. if you estimate the result PDFs are around 1 MB, create a buffer with capacity for 2 MB like this:<br>\n<code>my := &amp;mywriter{buf: make([]byte, 0, 2&lt;&lt;20)}</code></p></li>\n<li><p>Inside <code>mywriter.Write()</code> when capacity needs to be increased (and existing content copied over), it may be profitable to use bigger increment, e.g. double the current capacity to a certain extent, which reserves space for future appends and minimizes the reallocations.</p></li>\n</ul>\n"}], "owner": {"reputation": 5183, "user_id": 2534777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f9d1450403b864d6b17f30ba0ce0aee3?s=128&d=identicon&r=PG", "display_name": "orcaman", "link": "https://stackoverflow.com/users/2534777/orcaman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 836, "favorite_count": 0, "accepted_answer_id": 45837752, "answer_count": 1, "score": 5, "last_activity_date": 1503580969, "creation_date": 1503482948, "question_id": 45836767, "link": "https://stackoverflow.com/questions/45836767/using-an-io-writeseeker-without-a-file-in-go", "title": "Using an io.WriteSeeker without a File in Go", "body": "<p>I am using a third party library to generate PDFs. In order to write the PDF at the end (after all of content has been added using the lib's API), the <code>pdfWriter</code> type has a <code>Write</code> function that expects an <code>io.WriteSeeker</code>. </p>\n\n<p>This is OK if I want to work with files, but I need to work in-memory. Trouble is, I can't find any way to do this - the only native type I found that implements <code>io.WriteSeeker</code> is File. </p>\n\n<p>This is the part that works by using <code>File</code> for the <code>io.Writer</code> in the <code>Write</code> function of the <code>pdfWriter</code>:</p>\n\n<pre><code>fWrite, err := os.Create(outputPath)\nif err != nil {\n    return err\n}\n\ndefer fWrite.Close()\n\nerr = pdfWriter.Write(fWrite)\n</code></pre>\n\n<p>Is there way to do this without an actual File? Like getting a <code>[]byte</code> or something?</p>\n"}, {"tags": ["go", "int"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1503483406, "post_id": 45836683, "comment_id": 78630846, "body": "You gave the answer to your question: You made <code>int</code> something different (which is possible as it is not a keyword) and now it is something different."}, {"owner": {"reputation": 313, "user_id": 3949564, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a7fa94330c3736ca2b9ab5ebbfb395e1?s=128&d=identicon&r=PG&f=1", "display_name": "Bhagyesh Dudhediya", "link": "https://stackoverflow.com/users/3949564/bhagyesh-dudhediya"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1503483870, "post_id": 45836683, "comment_id": 78631184, "body": "Yes! It seems like the behavior of int changed. Here I was overwriting &quot;int object&quot; and in the next lines set int type for another variables, because in <code>int</code> now I have only value 8, not &quot;int object&quot;."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1503494390, "post_id": 45836683, "comment_id": 78639185, "body": "@Adrian: It&#39;s a predeclared numeric type, but AFAIK, you still can do something like <code>int := struct{}</code>. Sad, but true. What the OP should accept is that most languages allow you to do bad things, it&#39;s up to you not to do so. It&#39;s like writing bad C, invoking/relying on undefined behaviour. It&#39;s possible, but it&#39;s not something you should be doing"}], "answers": [{"comments": [{"owner": {"reputation": 313, "user_id": 3949564, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a7fa94330c3736ca2b9ab5ebbfb395e1?s=128&d=identicon&r=PG&f=1", "display_name": "Bhagyesh Dudhediya", "link": "https://stackoverflow.com/users/3949564/bhagyesh-dudhediya"}, "edited": false, "score": 0, "creation_date": 1503483408, "post_id": 45836832, "comment_id": 78630847, "body": "Even if I remove my last 2 lines, still it compiles. So was not getting why does this happen. It accepts int as variable name but changes behavior of data type int."}, {"owner": {"reputation": 1158, "user_id": 6117625, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/cff13813080b5f227531191b1dc96b60?s=128&d=identicon&r=PG&f=1", "display_name": "Dean coakley", "link": "https://stackoverflow.com/users/6117625/dean-coakley"}, "reply_to_user": {"reputation": 313, "user_id": 3949564, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a7fa94330c3736ca2b9ab5ebbfb395e1?s=128&d=identicon&r=PG&f=1", "display_name": "Bhagyesh Dudhediya", "link": "https://stackoverflow.com/users/3949564/bhagyesh-dudhediya"}, "edited": false, "score": 0, "creation_date": 1503483763, "post_id": 45836832, "comment_id": 78631106, "body": "@bhagyeshdudhediya Hmm, that is interesting alright. I assume the compiler sees that there is no other int instantiated so there is no other way to interpret the code? (If there is no other int variable, the only possibility is that you wanted to create an int called int.)"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1503487515, "post_id": 45836832, "comment_id": 78633803, "body": "@Deancoakley: ALERT: &quot;in Go you cannot use the reserve word int as a variable name.&quot; Not true. <code>int</code> is a <a href=\"https://golang.org/ref/spec#Predeclared_identifiers\" rel=\"nofollow noreferrer\">predecared identifier</a>. &#39;int&#39; is not a reserved <a href=\"https://golang.org/ref/spec#Keywords\" rel=\"nofollow noreferrer\">keyword</a>."}, {"owner": {"reputation": 1158, "user_id": 6117625, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/cff13813080b5f227531191b1dc96b60?s=128&d=identicon&r=PG&f=1", "display_name": "Dean coakley", "link": "https://stackoverflow.com/users/6117625/dean-coakley"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1503487889, "post_id": 45836832, "comment_id": 78634088, "body": "@peterSO What&#39;s the difference between predeclared identifier and a keyword. So in Go typing int actually refers to an object or package or something? I am reading <code>Keywords are used to recognize the type&#47;kind of entity and identifier is used to uniquely name that entity.</code> isn&#39;t that exactly what int is doing here?"}], "tags": [], "owner": {"reputation": 1158, "user_id": 6117625, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/cff13813080b5f227531191b1dc96b60?s=128&d=identicon&r=PG&f=1", "display_name": "Dean coakley", "link": "https://stackoverflow.com/users/6117625/dean-coakley"}, "is_accepted": false, "score": 0, "last_activity_date": 1503506869, "last_edit_date": 1503506869, "creation_date": 1503483108, "answer_id": 45836832, "question_id": 45836683, "link": "https://stackoverflow.com/questions/45836683/int-data-type-in-go/45836832#45836832", "title": "int data type in Go", "body": "<p>In Go int is a predefined identifier, therefore it cannot be used as a variable name. So rename the first variable to anything else. Such as num1 and it will compile!</p>\n\n<pre><code>package main\nimport \"fmt\"\n\nfunc main() {\n    var num1 int = 8\n    fmt.Println(num1)\n\n    var number int = 10\n    fmt.Println(number)\n}\n</code></pre>\n\n<p>Hope this helps!</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1503485874, "creation_date": 1503485874, "answer_id": 45837791, "question_id": 45836683, "link": "https://stackoverflow.com/questions/45836683/int-data-type-in-go/45837791#45837791", "title": "int data type in Go", "body": "<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    // int is a predeclared type identifier\n    var int int = 8\n    // int is a variable identifier\n    fmt.Println(int)\n\n    // error: int is not a type\n    var number int = 10\n    fmt.Println(number)\n}\n</code></pre>\n\n<p>You are shadowing the <code>int</code> identifier.</p>\n\n<p>See <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a>.</p>\n\n<p>Go is a block structured programming language: </p>\n\n<p><a href=\"https://golang.org/ref/spec#Blocks\" rel=\"nofollow noreferrer\">Blocks</a></p>\n\n<p><a href=\"https://golang.org/ref/spec#Declarations_and_scope\" rel=\"nofollow noreferrer\">Declarations and scope</a></p>\n\n<p><code>int</code> is a <a href=\"https://golang.org/ref/spec#Predeclared_identifiers\" rel=\"nofollow noreferrer\">predeclared identifier</a> and is implicitly declared in the universe block.</p>\n\n<p>The scope of a variable identifier declared inside a function begins at the end of the declaration and ends at the end of the innermost containing block.</p>\n\n<p>The statement</p>\n\n<pre><code>var int int = 8\n</code></pre>\n\n<p>uses the predeclared <code>int</code> type to declare a variable identifier <code>int</code>, shadowing the predeclared identifier: <a href=\"https://en.wikipedia.org/wiki/Variable_shadowing\" rel=\"nofollow noreferrer\">Variable shadowing</a>.</p>\n"}], "owner": {"reputation": 313, "user_id": 3949564, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a7fa94330c3736ca2b9ab5ebbfb395e1?s=128&d=identicon&r=PG&f=1", "display_name": "Bhagyesh Dudhediya", "link": "https://stackoverflow.com/users/3949564/bhagyesh-dudhediya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 1, "answer_count": 2, "score": -1, "last_activity_date": 1503506869, "creation_date": 1503482715, "question_id": 45836683, "link": "https://stackoverflow.com/questions/45836683/int-data-type-in-go", "title": "int data type in Go", "body": "<p>I am new to Go language and was trying out few examples in GO.<br>\nIn GO int is not a keyword so I declared a variable with name as <code>int</code>.  </p>\n\n<pre><code>package main\nimport \"fmt\"\n\nfunc main() {\n    var int int = 8\n    fmt.Println(int)\n\n    var number int = 10\n    fmt.Println(number)\n}\n</code></pre>\n\n<p>Now when I build this code I get following error:  </p>\n\n<pre><code>[dev@go test]$ go build variables.go\n# command-line-arguments\n./variables.go:8: int is not a type\n</code></pre>\n\n<p>I am trying to understand the reason why this is seen and what did <code>var int int</code> do such that int becomes an unavailable data type.  </p>\n"}, {"tags": ["json", "go", "interface", "marshalling"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 852122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/064a490226ff7da7e23e9609cc59468f?s=128&d=identicon&r=PG", "display_name": "Dino", "link": "https://stackoverflow.com/users/852122/dino"}, "edited": false, "score": 0, "creation_date": 1503558892, "post_id": 45843369, "comment_id": 78668125, "body": "Thank you Martin for your reply! ISBN is only a example for my problem. I do not need a special type in the Book struct i think. Because the unmarshal work with json.Number. But i need a unmarshal function that return everytime the value from my field - which i marked with &quot;mytype&quot; - as string. In this case it is the ISBN field. I began to write a function but i get errors, or emtpy output or get into a loop... Do you know, how i should write that? Example: type mytype string func (e mytype) MarshalJSON() ([]byte, error) {     fmt.Printf(&quot;bla: %v\\n&quot;, e)     return json.Marshal(e) }"}, {"owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "reply_to_user": {"reputation": 1, "user_id": 852122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/064a490226ff7da7e23e9609cc59468f?s=128&d=identicon&r=PG", "display_name": "Dino", "link": "https://stackoverflow.com/users/852122/dino"}, "edited": false, "score": 0, "creation_date": 1503560291, "post_id": 45843369, "comment_id": 78669132, "body": "I see, you were asking about the general case of always outputting a string. I&#39;ve updated my answer."}, {"owner": {"reputation": 1, "user_id": 852122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/064a490226ff7da7e23e9609cc59468f?s=128&d=identicon&r=PG", "display_name": "Dino", "link": "https://stackoverflow.com/users/852122/dino"}, "edited": false, "score": 0, "creation_date": 1503561254, "post_id": 45843369, "comment_id": 78669760, "body": "Thanks! i have a big nested structure with different json.Number fields. I yould only have to define a private and a public structure and would not build up the whole structure in the output again to stringify every field i need. Thats why i am thinking to have a custom type which i only have to define in the public structure. Every field with this type should be a string on the output. Do you know what i mean?"}, {"owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "reply_to_user": {"reputation": 1, "user_id": 852122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/064a490226ff7da7e23e9609cc59468f?s=128&d=identicon&r=PG", "display_name": "Dino", "link": "https://stackoverflow.com/users/852122/dino"}, "edited": false, "score": 0, "creation_date": 1503562090, "post_id": 45843369, "comment_id": 78670329, "body": "But why create a custom type when you can simply use the <code>string</code> type itself? You could still go do the composition approach as per your book MarshalJSON above if you wanted, you already have the ID output as a string."}, {"owner": {"reputation": 1, "user_id": 852122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/064a490226ff7da7e23e9609cc59468f?s=128&d=identicon&r=PG", "display_name": "Dino", "link": "https://stackoverflow.com/users/852122/dino"}, "edited": false, "score": 0, "creation_date": 1503563077, "post_id": 45843369, "comment_id": 78670910, "body": "Because in this case i need to define the public type twice:  &quot;type public struct&quot; and then again in the output to allocate the value. So if it is possible to define only a custom type in the public struct, i do not have to allocate every value in the output because the marshal function should do that for me."}, {"owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "reply_to_user": {"reputation": 1, "user_id": 852122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/064a490226ff7da7e23e9609cc59468f?s=128&d=identicon&r=PG", "display_name": "Dino", "link": "https://stackoverflow.com/users/852122/dino"}, "edited": false, "score": 0, "creation_date": 1503566183, "post_id": 45843369, "comment_id": 78672973, "body": "You&#39;re still going to need to do this twice. You can put a custom type in the public struct but this is in no way connected to the field in your embedded struct. <code>json.Marshal</code> will output the empty field in your public struct and skip the embedded struct due to having the same name. However, this field will always be empty unless you assign it a value. Remember, your public type actually has two fields with the same name! See <a href=\"https://play.golang.org/p/pWd_C3RddU\" rel=\"nofollow noreferrer\">play.golang.org/p/pWd_C3RddU</a> to illustrate this."}, {"owner": {"reputation": 1, "user_id": 852122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/064a490226ff7da7e23e9609cc59468f?s=128&d=identicon&r=PG", "display_name": "Dino", "link": "https://stackoverflow.com/users/852122/dino"}, "edited": false, "score": 0, "creation_date": 1503566751, "post_id": 45843369, "comment_id": 78673402, "body": "Right, but i copy my private data to the public struct with the same field-names but different types. So the public struct should not be empty right? Se in my example the function &quot;MarshalJSON&quot; with the AliasBook"}, {"owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "reply_to_user": {"reputation": 1, "user_id": 852122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/064a490226ff7da7e23e9609cc59468f?s=128&d=identicon&r=PG", "display_name": "Dino", "link": "https://stackoverflow.com/users/852122/dino"}, "edited": false, "score": 0, "creation_date": 1503567328, "post_id": 45843369, "comment_id": 78673814, "body": "Your function doesn&#39;t copy data from one struct to the other, it simply provides the pointer to the embedded struct. Hence why the public struct fields are empty, you never assign these a value. Please re-read the trivial example again, it illustrates how the field in the struct is totally separate from the field in the embedded struct. Remember, if you access a field in an embedded struct that is not redeclared in the outer struct, this is just &quot;syntactical sugar&quot;. For example, <code>outer.Name</code> is equivalent to <code>outer.inner.Name</code>."}, {"owner": {"reputation": 1, "user_id": 852122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/064a490226ff7da7e23e9609cc59468f?s=128&d=identicon&r=PG", "display_name": "Dino", "link": "https://stackoverflow.com/users/852122/dino"}, "edited": false, "score": 0, "creation_date": 1503575227, "post_id": 45843369, "comment_id": 78679424, "body": "You are right...hmmm...i tought about that. The only thing i need is the &quot;string&quot; function on a json.Number field... ISBN json.Number <code>json:&quot;isbn,string&quot;</code>"}, {"owner": {"reputation": 1, "user_id": 852122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/064a490226ff7da7e23e9609cc59468f?s=128&d=identicon&r=PG", "display_name": "Dino", "link": "https://stackoverflow.com/users/852122/dino"}, "edited": false, "score": 0, "creation_date": 1503581389, "post_id": 45843369, "comment_id": 78684126, "body": "I have tested a new version of my program. I take the unmarshal function to convert my input to integer. But if i set &quot;,string&quot; to my isbn i get a &quot;0&quot; value in the second example when the isbn input is a number: <a href=\"https://play.golang.org/p/pqLY7LuLOD\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pqLY7LuLOD</a>"}], "tags": [], "owner": {"reputation": 1543, "user_id": 8356442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b8f892cf10c7afae14ab19ebbe89543?s=128&d=identicon&r=PG", "display_name": "Martin Campbell", "link": "https://stackoverflow.com/users/8356442/martin-campbell"}, "is_accepted": false, "score": 1, "last_activity_date": 1503560251, "last_edit_date": 1503560251, "creation_date": 1503500819, "answer_id": 45843369, "question_id": 45836035, "link": "https://stackoverflow.com/questions/45836035/how-to-convert-a-structure-to-a-public-structure-with-custom-field-types-with-ma/45843369#45843369", "title": "How to convert a structure to a public structure with custom field types with MarshalJSON", "body": "<p>The easiest solution is to have a custom type that represents ISBN numbers. You can then implement custom JSON decoding functionality so that you can parse both string &amp; numeric input. For example</p>\n\n<pre><code>type isbn string\n\nfunc (s *isbn) UnmarshalJSON(buf []byte) error {\n    // Read numeric characters only from raw JSON input. This will handle strings, numbers or null etc and strip any\n    // optional separators.\n    out := make([]byte, 0, len(buf))\n    for _, b := range buf {\n        if b &gt;= '0' &amp;&amp; b &lt;= '9' {\n            out = append(out, b)\n        }\n    }\n\n    // Validate ISBN (assuming not using old 10 digit ISBN)\n    l := len(out)\n    if l != 13 {\n        return errors.New(\"Invalid ISBN length\")\n    }\n    // Calculate check digit and ensure valid.\n\n    // Create formatted output. This assumes 13 characters for simplicity\n    *s = isbn(fmt.Sprintf(\"%s-%s-%s-%s-%s\", out[:3], out[3:4], out[4:9], out[9:12], out[12:]))\n    return nil\n}\n</code></pre>\n\n<p>The above just stores the ISBN in a format suitable for output. However, you could store in any format and have a separate <a href=\"https://golang.org/pkg/encoding/json/#Marshaler\" rel=\"nofollow noreferrer\">json.Marshaler</a> implementation to format the output if this was required.</p>\n\n<p>Then you can simply make this a field in your <code>Book</code> as normal:</p>\n\n<pre><code>type Book struct {\n    Id       json.Number `json:\"id\"`\n    Revision int         `json:\"revision\"`\n    ISBN     isbn        `json:\"isbn\"`\n    Title    string      `json:\"title\"`\n}\n</code></pre>\n\n<p><em>The ISBN decoding example above is for illustration purposes</em>. You should create a full implementation that is unit tested to ensure it handles all expected input correctly and raises the appropriate errors on empty/malformed input. The performance could also be improved if this was an issue.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>You can't call <code>json.Marshal</code> inside your <code>json.Marshaler</code> implementation with the same variable. This will cause an infinite recursive loop, e.g.</p>\n\n<p><code>json.Marshal(e)</code> -> <code>e.MarshalJSON</code> -> <code>json.Marshal(e)</code> -> <code>e.MarshalJSON</code> ...</p>\n\n<p>The <code>json.Number</code> type is a string representation of a number. If you are simply wanting to output all numbers as strings, you don't need any custom types at all. Simply use the relevant string values in your code. For example:</p>\n\n<pre><code>type PublicBook struct {\n    Id          string          `json:\"id\"`\n    // all other fields...\n}\n\n// Creates the public book representation from a book\nfunc Public(b *Book) *PublicBook {\n  return &amp;PublicBook{\n     Id: string(b.Id),\n  }\n}\n</code></pre>\n\n<p>This will always output a string as you are using the <code>string</code> type and not the <code>json.Number</code> type which has custom JSON marshal/unmarshal implementations.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 852122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/064a490226ff7da7e23e9609cc59468f?s=128&d=identicon&r=PG", "display_name": "Dino", "link": "https://stackoverflow.com/users/852122/dino"}, "is_accepted": true, "score": 0, "last_activity_date": 1503584125, "creation_date": 1503584125, "answer_id": 45863979, "question_id": 45836035, "link": "https://stackoverflow.com/questions/45836035/how-to-convert-a-structure-to-a-public-structure-with-custom-field-types-with-ma/45863979#45863979", "title": "How to convert a structure to a public structure with custom field types with MarshalJSON", "body": "<p>I have a solution which works for me. <a href=\"https://play.golang.org/p/Vr4eELsHs1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Vr4eELsHs1</a></p>\n\n<p>The keypoint was, that i have to take <code>fmt.Sprint(*isbn)</code> to return the string in the marshaler. I created a new type, convert the input to int64 with the json.Number function and convert it with the json custom marshaler to string.</p>\n\n<p>Thank you for your help!</p>\n"}], "owner": {"reputation": 1, "user_id": 852122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/064a490226ff7da7e23e9609cc59468f?s=128&d=identicon&r=PG", "display_name": "Dino", "link": "https://stackoverflow.com/users/852122/dino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 45863979, "answer_count": 2, "score": 0, "last_activity_date": 1503584125, "creation_date": 1503481032, "last_edit_date": 1503584001, "question_id": 45836035, "link": "https://stackoverflow.com/questions/45836035/how-to-convert-a-structure-to-a-public-structure-with-custom-field-types-with-ma", "title": "How to convert a structure to a public structure with custom field types with MarshalJSON", "body": "<p>I have a Type \"Book\" that i read from a different interface which returns json. After reading the json and processing data, i have to convert the book to a public book type to hide fields and change output format.</p>\n\n<p>My problem is, that the input type from the same field (ISBN) is sometimes string and sometimes int. I thought that the easiest solution is to use json.Number to unmarshal the data. That works - but i need string on the outgoing json on different fields...</p>\n\n<p>That is the point where i need help. I would have a custom type which i can set in the public structure at the fields, where i want to set the output-json-field to string. I named the custom type \"mytype\" in the example. (The real data are nested and i have more fields that i set to string in the output - the id field in the public structure is only a test)</p>\n\n<p>I mean, it should look something like that - or not?</p>\n\n<pre><code>func (m *mytype) MarshalJSON() ([]byte, error) {\n    ...\n}\n</code></pre>\n\n<p>Here is my example code: <a href=\"https://play.golang.org/p/rS9HddzDMp\" rel=\"nofollow noreferrer\">https://play.golang.org/p/rS9HddzDMp</a></p>\n\n<pre><code>package main \n\nimport (  \n    \"encoding/json\"\n    \"fmt\"\n    \"bytes\"\n)\n\n/* ----------------------------------------------------------------------------------------------------\nDefinition of the internal Book object (read from input)\n-----------------------------------------------------------------------------------------------------*/\ntype Book struct {\n    Id                      json.Number         `json:\"id\"`\n    Revision                int                 `json:\"revision\"`\n    ISBN                    json.Number         `json:\"isbn\"`\n    Title                   string              `json:\"title\"`\n}\n\n/* ----------------------------------------------------------------------------------------------------\nDefinition of the public Book object\n-----------------------------------------------------------------------------------------------------*/\ntype AliasBook Book\ntype omit           *struct{}\ntype mytype         string\n\ntype PublicBook struct {\n    Id          string          `json:\"id\"`\n    Revision    omit            `json:\"revision,omitempty\"`\n    ISBN        mytype          `json:\"isbn\"`\n    *AliasBook\n}\n\n/* ----------------------------------------------------------------------------------------------------\nRendering functions\n-----------------------------------------------------------------------------------------------------*/\nfunc (bb *Book) MarshalJSON() ([]byte, error) {\n    fmt.Println(\"---------------MarschalJSON---------------\")\n    aux := PublicBook{\n        Id:         bb.Id.String(),\n        AliasBook:  (*AliasBook)(bb),\n    }\n\n    return json.Marshal(&amp;aux)\n}\n\nfunc main() {\n    var jsonStreams[2][]byte\n    // Input ISBN as string\n    jsonStreams[0] = []byte(`{\"id\":\"123\",\"revision\":1234,\"isbn\":\"978-3-86680-192-9\",\"title\":\"Go for dummies\"}`)\n    // Input ISBN as int\n    jsonStreams[1] = []byte(`{\"id\":123,\"revision\":1234,\"isbn\":9783866801929,\"title\":\"Go for dummies\"}`)\n\n    // For each stream\n    for i := range jsonStreams {\n        fmt.Print(\"stream: \")\n        fmt.Println(string(jsonStreams[i]))\n\n        // Read Input\n        b := Book{}\n        err := json.Unmarshal(jsonStreams[i], &amp;b)\n        if err == nil {\n            fmt.Printf(\"%+v\\n\", b)\n        } else {\n            fmt.Println(err)\n            fmt.Printf(\"%+v\\n\", b)\n        }\n\n        // Output as JSON\n        response := new(bytes.Buffer)\n        enc := json.NewEncoder(response)\n        enc.SetEscapeHTML(false)\n        enc.SetIndent(\"\", \"    \")\n        err = enc.Encode(&amp;b)\n        if err == nil {\n            fmt.Printf(\"%+v\\n\", response)\n        } else {\n            fmt.Println(err)\n            fmt.Printf(\"%+v\\n\", response)\n        }\n    }\n}\n</code></pre>\n\n<p><strong>Edit</strong>\nI have a solution which works for me. <a href=\"https://play.golang.org/p/Vr4eELsHs1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Vr4eELsHs1</a></p>\n\n<p>The keypoint was, that i have to take \"fmt.Sprint(*isbn) to return the string in the marshaler. I created a new type, convert the input to int64 with the json.Number function and convert it with the json custom marshaler to string. </p>\n"}, {"tags": ["go", "arm"], "comments": [{"owner": {"reputation": 2694, "user_id": 1280320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/922b107850370d90a2a8d7e6a0cfbd07?s=128&d=identicon&r=PG", "display_name": "RaviTezu", "link": "https://stackoverflow.com/users/1280320/ravitezu"}, "edited": false, "score": 0, "creation_date": 1503484681, "post_id": 45835134, "comment_id": 78631734, "body": "How can you say it is not compiled for v7 from EABI5?"}, {"owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "reply_to_user": {"reputation": 2694, "user_id": 1280320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/922b107850370d90a2a8d7e6a0cfbd07?s=128&d=identicon&r=PG", "display_name": "RaviTezu", "link": "https://stackoverflow.com/users/1280320/ravitezu"}, "edited": false, "score": 0, "creation_date": 1503493219, "post_id": 45835134, "comment_id": 78638240, "body": "@RaviTezu\uff0c I am sorry I thought EABI5 means ARMv5?? If not, how can I tell? As a matter of fact, the reason I investigate is that I didn&#39;t get any performance improvement by using GOARM=7.  My program runs on an android machine, calls screencap to do a sceenshot in RGBA8888 raw format then compress it into JPEG.  Can I expect a performance boost by using ARMv7, especially for the JPEG encoding part?"}], "answers": [{"tags": [], "owner": {"reputation": 2694, "user_id": 1280320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/922b107850370d90a2a8d7e6a0cfbd07?s=128&d=identicon&r=PG", "display_name": "RaviTezu", "link": "https://stackoverflow.com/users/1280320/ravitezu"}, "is_accepted": true, "score": 0, "last_activity_date": 1521563186, "last_edit_date": 1521563186, "creation_date": 1503493762, "answer_id": 45840675, "question_id": 45835134, "link": "https://stackoverflow.com/questions/45835134/cross-compile-to-armv7-failed/45840675#45840675", "title": "Cross-compile to ARMv7 failed", "body": "<p>I believe, it is not ARMv5. I was trying to do the same on MAC OS and 'file' command on Mac is saying v7, but the 'file' command on Linux don't. However, I do know that v7 has some good improvements and may boost the performance of your program. </p>\n\n<p>But, that is out of scope of this question and you may need to dig deeper into what you're doing and why a performance improvement is expected.\nAll I can say is, it is compiled for v7. </p>\n"}], "owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 363, "favorite_count": 0, "accepted_answer_id": 45840675, "answer_count": 1, "score": 0, "last_activity_date": 1521563186, "creation_date": 1503478805, "last_edit_date": 1503509202, "question_id": 45835134, "link": "https://stackoverflow.com/questions/45835134/cross-compile-to-armv7-failed", "title": "Cross-compile to ARMv7 failed", "body": "<p>I try to compile a go program on my Linux desktop (Linux desktop 4.10.0-28-generic #32-Ubuntu SMP Fri Jun 30 05:32:18 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux), go version <code>go version go1.8.3 linux/amd64</code> to arm:</p>\n\n<pre><code>$ GOPATH=/home/xrfang/git/hermes/ GOARM=7 GOARCH=arm go build .\n</code></pre>\n\n<p>the executable is generated, but seems NOT ARMv7:</p>\n\n<pre><code>$ file hermes\n\nhermes: ELF 32-bit LSB executable, ARM, EABI5 version 1 (SYSV), statically linked, not stripped\n</code></pre>\n\n<p>It shows EABI5.  How can I cross-compile to ARMv7? Is there anything missing on my Linux Desktop so that the cross-compile fallback to a lower ARM version?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "byte", "buffer", "stdin"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1503477559, "post_id": 45834542, "comment_id": 78626529, "body": "<code>ReadByte reads and returns a single byte. If no byte is available, returns an error.</code> read until there is an error, then break. So <code>if err != nil { ...</code>."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1503478875, "last_edit_date": 1503478875, "creation_date": 1503477565, "answer_id": 45834733, "question_id": 45834542, "link": "https://stackoverflow.com/questions/45834542/how-to-read-bytewise-from-stdin/45834733#45834733", "title": "How to read bytewise from stdin?", "body": "<p>This is not an issue of the <a href=\"https://golang.org/pkg/bufio/#Reader.ReadByte\" rel=\"nofollow noreferrer\"><code>Reader.ReadByte()</code></a> implementation, nor that of <a href=\"https://golang.org/pkg/bufio/#NewReader\" rel=\"nofollow noreferrer\"><code>bufio.NewReader()</code></a>.</p>\n\n<p>See this example to prove it:</p>\n\n<pre><code>buf := bytes.NewBufferString(\"Hello World!\\n\")\nin := bufio.NewReader(buf)\nfor {\n    c, err := in.ReadByte()\n    if err == io.EOF {\n        break\n    }\n    fmt.Print(string(c))\n}\n</code></pre>\n\n<p>When running, the above prints</p>\n\n<pre><code>Hello World!\n</code></pre>\n\n<p>And terminates properly.</p>\n\n<p>Your issue is with <code>os.Stdin</code>. Reading from it is specific to its source. If it is your terminal, reading from it simply blocks and does not report <code>io.EOF</code>. See this example to prove it:</p>\n\n<pre><code>in := bufio.NewReader(os.Stdin)\nfor {\n    fmt.Println(\"Reading.\")\n    c, err := in.ReadByte()\n    if err == io.EOF {\n        break\n    }\n    fmt.Print(string(c))\n}\n</code></pre>\n\n<p>Its output is:</p>\n\n<pre><code>Reading.\n</code></pre>\n\n<p>And nothing happens. There is no new iteration, it is blocked. Now if you enter a line and press <kbd>Enter</kbd>, e.g. you enter <code>Go!</code>, output will be:</p>\n\n<pre><code>Go!\nGReading.\noReading.\n!Reading.\n\nReading.\n</code></pre>\n\n<p>And again, waits for new input. As you can see, data is fed / available per line. This is what your terminal does: while you enter your line, it is not sent to <code>os.Stdin</code>. Once you press <kbd>Enter</kbd>, the whole line is fed and is available from <code>os.Stdin</code>. This is what we see: each letter of the input <code>Go!</code> and a newline character. And we see the <code>Reading.</code> text printed for each iteration. After the input is consumed, <code>in.ReadByte()</code> is blocked again, waiting for new input. It does not report <code>io.EOF</code>.</p>\n\n<p>Now try the following: create a file e.g. <code>a.txt</code> and edit it to have one line: <code>Go!</code> and a newline. Now feed this file as the standard input to your program:</p>\n\n<pre><code>go run play.go &lt; a.txt\n</code></pre>\n\n<p>Running it we'll see:</p>\n\n<pre><code>Reading.\nGReading.\noReading.\n!Reading.\n\nReading.\n\nReading.\n</code></pre>\n\n<p>And it terminates so it works! It works because this time the source of <code>os.Stdin</code> is not your console / terminal, but the contents of a file, and once it's consumed, attempting to read from <code>os.Stdin</code> will properly report <code>io.EOF</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6216224"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1146, "favorite_count": 0, "accepted_answer_id": 45834733, "answer_count": 1, "score": 1, "last_activity_date": 1503478875, "creation_date": 1503476968, "question_id": 45834542, "link": "https://stackoverflow.com/questions/45834542/how-to-read-bytewise-from-stdin", "title": "How to read bytewise from stdin?", "body": "<pre><code>in, out := bufio.NewReader(os.Stdin), bufio.NewWriter(os.Stdout)\nfor {\n    c, err := in.ReadByte()\n    if err == io.EOF {\n        break\n    }\n    out.WriteByte(c)\n}\n</code></pre>\n\n<p>I want to read bytewise from the stdin stream. Unlike the <code>Read</code> method<code>ReadByte</code> doesn't seem to return <code>io.EOF</code>. How can I break if all bytes have been read?</p>\n"}, {"tags": ["php", "go", "stripe-connect"], "comments": [{"owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 0, "creation_date": 1503474453, "post_id": 45833413, "comment_id": 78624453, "body": "<code>plans = it.Plan()</code> overwrites your <code>plans</code> variable. <code>plans</code> should be slice of <code>Plan</code>s or something like that."}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 0, "creation_date": 1503476355, "post_id": 45833413, "comment_id": 78625715, "body": "Yes it should be a slice of plans. Infact I tried making a slice of plans and then did asignment but the api environment did not let me do this. It gave an error about type mismatch."}, {"owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 0, "creation_date": 1503477808, "post_id": 45833413, "comment_id": 78626679, "body": "Please provide your attempt with slice of plans and error text."}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 0, "creation_date": 1503481692, "post_id": 45833413, "comment_id": 78629603, "body": "@u_mulder You were right. There should be a slice of plans. The problem was I was declaring a structure instance but I needed to declare an interface variable to handle slice. However the problem is solved now. Thanks for your help!"}, {"owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 0, "creation_date": 1503482632, "post_id": 45833413, "comment_id": 78630294, "body": "If problem solved - you can write your own answer to help people in future."}], "answers": [{"tags": [], "owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "is_accepted": false, "score": 0, "last_activity_date": 1503483669, "creation_date": 1503483669, "answer_id": 45837049, "question_id": 45833413, "link": "https://stackoverflow.com/questions/45833413/get-array-of-all-plans-of-stripe-in-golang/45837049#45837049", "title": "Get array of all plans of Stripe in Golang", "body": "<p>Hey I found the answer to my question:</p>\n\n<p>I should use a interface instead of structure instance:</p>\n\n<pre><code>func GetAllPlans() (interface{}){\n    var plans []interface{}\n    params := &amp;stripe.PlanListParams{}\n\n    it := plan.List(params)\n    for it.Next() {         \n        plans = append(plans, it.Plan())\n    }\n    return plans\n}\n</code></pre>\n\n<p>Thanks @u_mulder for a useful hint!</p>\n"}], "owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 326, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1503483669, "creation_date": 1503473695, "last_edit_date": 1503476544, "question_id": 45833413, "link": "https://stackoverflow.com/questions/45833413/get-array-of-all-plans-of-stripe-in-golang", "title": "Get array of all plans of Stripe in Golang", "body": "<p>I am trying to get list of all plans that exist in my Stripe account using Stripes's Golang API. As per documentation provided here: <a href=\"https://stripe.com/docs/api/go#list_plans\" rel=\"nofollow noreferrer\">https://stripe.com/docs/api/go#list_plans</a> it should return a list of all plans. But its returning me only a single plan details.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/gin-gonic/gin\"\n    \"github.com/stripe/stripe-go\"\n    \"github.com/stripe/stripe-go/plan\"\n\n)\nfunc main(){\n    router := gin.Default()\n    stripe.Key = \"stripe_api_key\"\n\n    router.GET(\"/plans\", func(c *gin.Context) {\n        plans := GetAllPlans()\n        c.JSON(200, gin.H{  \"plans\": plans, })\n    })\n    router.Run(\":8080\")\n}\n\nfunc GetAllPlans() (plans *stripe.Plan){\n    plans = &amp;stripe.Plan{}\n    params := &amp;stripe.PlanListParams{}\n\n    it := plan.List(params)\n    for it.Next() {         \n        plans = it.Plan()\n    }\n    return \n}\n</code></pre>\n\n<p>What's interesting I have found is the response example provided in the documentation for Golang is somewhat different from other languages like PHP, Ruby etc. For languages other than Go and .NET its returning an array of plans but for Go and .NET its returning a single plan. So I am not sure it is api's default behaviour or some bug.</p>\n\n<p>Any kind of help will be appreciated.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["json", "go", "struct"], "comments": [{"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1503464385, "post_id": 45830855, "comment_id": 78619216, "body": "Use pointers....."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1503465328, "post_id": 45830855, "comment_id": 78619575, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/25382073/defining-golang-struct-function-using-pointer-or-not\">Defining golang struct function using pointer or not</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1503494446, "post_id": 45830855, "comment_id": 78639224, "body": "@BasileStarynkevitch using pointers doesn&#39;t make any difference to the question asked."}], "answers": [{"comments": [{"owner": {"reputation": 983, "user_id": 1623765, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/c0d6d0a84591bfb64bd401f213b8c88b?s=128&d=identicon&r=PG", "display_name": "Kumaran Senapathy", "link": "https://stackoverflow.com/users/1623765/kumaran-senapathy"}, "edited": false, "score": 0, "creation_date": 1503466703, "post_id": 45831260, "comment_id": 78620110, "body": "You have wrapped the different subjects into classes. I cannot use an array of classes. It should just be a struct with multiple class objects."}, {"owner": {"reputation": 939, "user_id": 4648046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/932ac0b92feea46110e78577f7047c74?s=128&d=identicon&r=PG&f=1", "display_name": "Eddy R.", "link": "https://stackoverflow.com/users/4648046/eddy-r"}, "reply_to_user": {"reputation": 983, "user_id": 1623765, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/c0d6d0a84591bfb64bd401f213b8c88b?s=128&d=identicon&r=PG", "display_name": "Kumaran Senapathy", "link": "https://stackoverflow.com/users/1623765/kumaran-senapathy"}, "edited": false, "score": 0, "creation_date": 1503466987, "post_id": 45831260, "comment_id": 78620207, "body": "I edited my answer with a new playground link that uses <code>map[string]interface{}</code>"}, {"owner": {"reputation": 983, "user_id": 1623765, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/c0d6d0a84591bfb64bd401f213b8c88b?s=128&d=identicon&r=PG", "display_name": "Kumaran Senapathy", "link": "https://stackoverflow.com/users/1623765/kumaran-senapathy"}, "edited": false, "score": 0, "creation_date": 1503467619, "post_id": 45831260, "comment_id": 78620443, "body": "Thanks. I can live with a generic type for now."}], "tags": [], "owner": {"reputation": 939, "user_id": 4648046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/932ac0b92feea46110e78577f7047c74?s=128&d=identicon&r=PG&f=1", "display_name": "Eddy R.", "link": "https://stackoverflow.com/users/4648046/eddy-r"}, "is_accepted": true, "score": 2, "last_activity_date": 1503466912, "last_edit_date": 1503466912, "creation_date": 1503466011, "answer_id": 45831260, "question_id": 45830855, "link": "https://stackoverflow.com/questions/45830855/how-to-have-many-structs-inside-a-struct/45831260#45831260", "title": "How to have many structs inside a struct?", "body": "<p>Instead of statically defining each subject, how about simply using a map from subject name => array of class details ?</p>\n\n<p>One way you can get very close to the JSON you want by using a map like I described above, and by embedding the map into a struct as follows:</p>\n\n<pre><code>type ClassDetails struct {\n    ClassNumber int      `json:\"classNumber\"`\n    Names       []string `json:names`\n}\n\ntype Subjects map[string][]ClassDetails\n\ntype Classes struct {\n    School string `json:\"school\"`\n    Subjects\n}\n</code></pre>\n\n<p>An instance of the <code>Classes</code> struct above would fill in the following part of your desired JSON:</p>\n\n<pre><code>{\n  \"classes\": {\n    ... the Classes instance goes here...\n  }\n}\n</code></pre>\n\n<p>The remaining outer object can just be constructed as follows:</p>\n\n<pre><code>c := Classes{...}\nouter := map[string]Classes{\"classes\": c}\n</code></pre>\n\n<p>A JSON marshal of the <code>outer</code> object, with the right data initialized, arrives at almost exactly your JSON above (to match it exactly you'd have to turn the <code>ClassNumber</code> into a string type).</p>\n\n<p>Here is a Go Playground link that initializes these structs with the exact data you want and pretty-prints your JSON: <a href=\"https://play.golang.org/p/HFMbHtY2os\" rel=\"nofollow noreferrer\">https://play.golang.org/p/HFMbHtY2os</a></p>\n\n<p>EDIT: This still doesn't exactly match the JSON in your question, as it will add a new object in there called \"Subjects\". The problem is that the object inside of <code>\"classes\"</code> in your JSON mixes types, and Go can't declare dynamic struct fields.</p>\n\n<p>If you really have to use that JSON structure, you'll need to go with the more generic <code>map[string]interface{}</code> to allow mixed types at the same level in your object hierarchy. Here's another Go Playground link that has the correct implementation: <a href=\"https://play.golang.org/p/rlYTYGofSI\" rel=\"nofollow noreferrer\">https://play.golang.org/p/rlYTYGofSI</a></p>\n"}], "owner": {"reputation": 983, "user_id": 1623765, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/c0d6d0a84591bfb64bd401f213b8c88b?s=128&d=identicon&r=PG", "display_name": "Kumaran Senapathy", "link": "https://stackoverflow.com/users/1623765/kumaran-senapathy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 478, "favorite_count": 0, "accepted_answer_id": 45831260, "answer_count": 1, "score": 0, "last_activity_date": 1503466912, "creation_date": 1503463881, "question_id": 45830855, "link": "https://stackoverflow.com/questions/45830855/how-to-have-many-structs-inside-a-struct", "title": "How to have many structs inside a struct?", "body": "<p>I have a struct of called class like this.</p>\n\n<pre><code>type ClassDetails struct {\nClassNumber int `json:\"classNumber\"`\nNames []string `json:names`}\n</code></pre>\n\n<p>I have manually created something like this.</p>\n\n<pre><code>type Subject struct {\nMath ClassDetails `json:\"math\"`\nScience ClassDetails `json:\"science\"`}\n</code></pre>\n\n<p>I want to do this on the fly. Add more ClassDetails to the Subject as I get information, but I cannot use an array of type class. \n How can this be done? And I also need to add the names of the classes as the json tag.\nMy resultant struct should hold values like this.</p>\n\n<pre><code>{\n    \"classes\": {\n        \"school\": \"MayorWestHigh\",\n        \"math\": [{\n                \"classNumber\": \"1\",\n                \"names\": [\"aaron\", \"baron\", \"cathy\"]\n            },\n            {\n                \"classNumber\": \"2\",\n                \"names\": [\"aaron\", \"baron\", \"cathy\"]\n            }\n        ],\n        \"science\": [{\n            \"classNumber\": \"1\",\n            \"names\": [\"ted\", \"baron\", \"isiah\"]\n        }],\n        \"geography\": [{\n            \"classNumber\": \"1\",\n            \"names\": [\"peter\", \"glen\", \"joe\"]\n        }]\n\n    }\n}\n</code></pre>\n"}, {"tags": ["recursion", "go", "reflection"], "answers": [{"comments": [{"owner": {"reputation": 654, "user_id": 3434541, "user_type": "registered", "accept_rate": 82, "profile_image": "https://graph.facebook.com/1096564134/picture?type=large", "display_name": "Joe", "link": "https://stackoverflow.com/users/3434541/joe"}, "edited": false, "score": 0, "creation_date": 1503508941, "post_id": 45829567, "comment_id": 78649809, "body": "This makes perfect sense. Thanks so much for the assistance!"}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": true, "score": 2, "last_activity_date": 1503454738, "last_edit_date": 1503454738, "creation_date": 1503454244, "answer_id": 45829567, "question_id": 45828996, "link": "https://stackoverflow.com/questions/45828996/recursively-walk-through-nested-structs/45829567#45829567", "title": "Recursively walk through nested structs", "body": "<p>You check if the current field is a struct <strong>value</strong>, but you never account for the case when it is a <code>reflect.Ptr</code> to a struct or something else, so your function never recurses for that case. Here is your function with the missing piece.</p>\n\n<p><a href=\"https://play.golang.org/p/FdLxeee9UU\" rel=\"nofollow noreferrer\">https://play.golang.org/p/FdLxeee9UU</a></p>\n\n<pre><code>// ContainsNil returns true if any fields within the supplied structure are nil.\n//\n// If the supplied object is not a struct, the method will panic.\n// Nested structs are inspected recursively.\n// Maps and slices are not inspected deeply. This may change.\nfunc ContainsNil(obj interface{}) bool {\n    if obj == nil {\n        return true\n    }\n    s := reflect.Indirect(reflect.ValueOf(obj))\n    for i := 0; i &lt; s.NumField(); i++ {\n        f := s.Type().Field(i)\n        field := s.Field(i)\n        if fieldIsExported(f) { // Exported-check must be evaluated first to avoid panic.\n            if field.Kind() == reflect.Ptr { // case when it's a pointer or struct pointer\n                if field.IsNil() {\n                    return true\n                }\n                if ContainsNil(field.Interface()) {\n                    return true\n                }\n            }\n            if field.Kind() == reflect.Struct {\n                if ContainsNil(field.Addr()) {\n                    return true\n                }\n            } else {\n                if field.IsNil() {\n                    return true\n                }\n                if field.Interface() == nil {\n                    return true\n                }\n            }\n        }\n    }\n    return false\n}\n</code></pre>\n"}], "owner": {"reputation": 654, "user_id": 3434541, "user_type": "registered", "accept_rate": 82, "profile_image": "https://graph.facebook.com/1096564134/picture?type=large", "display_name": "Joe", "link": "https://stackoverflow.com/users/3434541/joe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1415, "favorite_count": 0, "accepted_answer_id": 45829567, "answer_count": 1, "score": 3, "last_activity_date": 1503454738, "creation_date": 1503449460, "question_id": 45828996, "link": "https://stackoverflow.com/questions/45828996/recursively-walk-through-nested-structs", "title": "Recursively walk through nested structs", "body": "<p>I want to build a method that takes a struct as an <code>interface{}</code> and returns <code>true</code> if any of the supplied struct's fields are nil.</p>\n\n<p>Here's what I have at the moment:</p>\n\n<pre><code>// ContainsNil returns true if any fields within the supplied structure are nil.\n//\n// If the supplied object is not a struct, the method will panic.\n// Nested structs are inspected recursively.\n// Maps and slices are not inspected deeply. This may change.\nfunc ContainsNil(obj interface{}) bool {\n    if obj == nil {\n        return true\n    }\n    s := reflect.Indirect(reflect.ValueOf(obj))\n    for i := 0; i &lt; s.NumField(); i++ {\n        f := s.Type().Field(i)\n        field := s.Field(i)\n        if fieldIsExported(f) { // Exported-check must be evaluated first to avoid panic.\n            if field.Kind() == reflect.Struct {\n                if ContainsNil(field.Addr()) {\n                    return true\n                }\n            } else {\n                if field.IsNil() {\n                    return true\n                }\n                if field.Interface() == nil {\n                    return true\n                }\n            }\n        }\n    }\n    return false\n}\n\nfunc fieldIsExported(field reflect.StructField) bool {\n    log.Println(field.Name)\n    return field.Name[0] &gt;= 65 == true &amp;&amp; field.Name[0] &lt;= 90 == true\n}\n</code></pre>\n\n<p>And a failing test:</p>\n\n<pre><code>func Test_ContainsNil_NilNestedValue_ReturnsTrue(t *testing.T) {\n    someNestedStruct := &amp;c.SomeNestedStruct{\n        SomeStruct: c.SomeStruct{\n            SomeString: nil,\n        },\n    }\n    result := util.ContainsNil(someNestedStruct)\n    assert.True(t, result)\n}\n</code></pre>\n\n<p>The test code executes without panicking, but fails because the method returns <code>false</code> rather than <code>true</code>.</p>\n\n<p>The issue I'm having is that I can't figure out how to properly pass the nested struct back into the recursive call to <code>ContainsNil</code>.</p>\n\n<p>When recursive call is made for the nested structure, the <code>fieldIsExported</code> method returns <code>false</code> because it's not receiving the value that I would expect it to be receiving.</p>\n\n<p>I expect <code>fieldIsExported</code> to receive \"SomeStruct\" on its first call, and receive \"SomeString\" on the second (recursive) call. The first call goes as expected, but on the second call, <code>fieldIsExported</code> receives \"typ\", when I would expect it to receive \"SomeString\".</p>\n\n<p>I've done a bunch of research about using reflect on structs, but I haven't been able to get my head around this yet. Ideas?</p>\n\n<p>References:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/25047424/pass-by-reference-nested-structures-through-reflection\">Pass by reference nested structures through reflection</a></li>\n<li><a href=\"https://stackoverflow.com/questions/24333494/golang-reflection-on-embedded-structs\">golang - reflection on embedded structs</a></li>\n<li><a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/reflect/</a></li>\n<li>Lot's of googling</li>\n</ul>\n"}, {"tags": ["go", "revel"], "answers": [{"comments": [{"owner": {"reputation": 1612, "user_id": 277332, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/e4c78f2776ad56a7e57cb1e08b388084?s=128&d=identicon&r=PG", "display_name": "Jack", "link": "https://stackoverflow.com/users/277332/jack"}, "edited": false, "score": 0, "creation_date": 1503787277, "post_id": 45828623, "comment_id": 78759442, "body": "Ok, i&#39;ll buy that; no relative imports it is."}], "tags": [], "owner": {"reputation": 3322, "user_id": 966798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b52a10544df0260f8eab84b3bbea4bb?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/966798/matt"}, "is_accepted": true, "score": 1, "last_activity_date": 1503446914, "last_edit_date": 1503446914, "creation_date": 1503446541, "answer_id": 45828623, "question_id": 45828485, "link": "https://stackoverflow.com/questions/45828485/revel-and-golang-import-too-physical/45828623#45828623", "title": "Revel and golang import too physical?", "body": "<p>The import path maps directly to the filesystem path, relative to <code>$GOPATH/src/</code>.</p>\n\n<p><a href=\"https://golang.org/doc/code.html#ImportPaths\" rel=\"nofollow noreferrer\">https://golang.org/doc/code.html#ImportPaths</a></p>\n\n<p>It seems that you can do a relative import like this:</p>\n\n<pre><code>../other-pkg\n</code></pre>\n\n<p>But it's <a href=\"https://stackoverflow.com/questions/10687627/relative-import-from-parent-directory\">not idiomatic or recommended</a>.</p>\n"}], "owner": {"reputation": 1612, "user_id": 277332, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/e4c78f2776ad56a7e57cb1e08b388084?s=128&d=identicon&r=PG", "display_name": "Jack", "link": "https://stackoverflow.com/users/277332/jack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 45828623, "answer_count": 1, "score": 1, "last_activity_date": 1503446914, "creation_date": 1503445195, "question_id": 45828485, "link": "https://stackoverflow.com/questions/45828485/revel-and-golang-import-too-physical", "title": "Revel and golang import too physical?", "body": "<p>just starting with go/revel. I copied the \"examples/booking\" app into  \"examples/booking2\" directory so i could muck with it w/o impacting the original. </p>\n\n<p>When I ran it I got weird results, in particular the initial data in the db seemed to be duplicated.</p>\n\n<p>I tracked this down to the imports:</p>\n\n<pre><code>import \"github.com/revel/examples/booking/app/models\"\n</code></pre>\n\n<p>Once I changed \"booking\" to \"booking2\" in all the relevant imports things were fine. But my first thought is \"why is an import path so physical?\". I'm thinking that within the application there should be a way to relatively reference the app's various packages w/o having to reference the physical path where the app resides.</p>\n\n<p>Is there a way to do that?</p>\n\n<p>Not even sure if this is \"go\" thing, or a \"revel\" thing.</p>\n\n<p>Thx.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1503443372, "post_id": 45828142, "comment_id": 78614459, "body": "Parsed templates don&#39;t &quot;override&quot; each other unless they have the same exact filename (but different path). They are all stored separately and you just exec it with the filename."}, {"owner": {"reputation": 6742, "user_id": 4912329, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/6m1mT.jpg?s=128&g=1", "display_name": "Mathieu Lescaudron", "link": "https://stackoverflow.com/users/4912329/mathieu-lescaudron"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1503469829, "post_id": 45828142, "comment_id": 78621533, "body": "@RayfenWindspear, can you show me an example pls"}], "answers": [{"comments": [{"owner": {"reputation": 6742, "user_id": 4912329, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/6m1mT.jpg?s=128&g=1", "display_name": "Mathieu Lescaudron", "link": "https://stackoverflow.com/users/4912329/mathieu-lescaudron"}, "edited": false, "score": 1, "creation_date": 1503470009, "post_id": 45828424, "comment_id": 78621630, "body": "Thk, its OK, but I don t want to define a new variable or index on array for  each new page. No other way to render dynamically ?"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1503444621, "creation_date": 1503444621, "answer_id": 45828424, "question_id": 45828142, "link": "https://stackoverflow.com/questions/45828142/golang-multi-templates-caching/45828424#45828424", "title": "Golang Multi templates caching", "body": "<p>Package-level maps or variables are both a good way to cache compiled templates.  Code in #2 above is OK.  Here's how to use package-level variables:</p>\n\n<pre><code>var t1 = template.Must(template.ParseFiles(\"layout.html\",\"1.html\"))\nvar t2 = template.Must(template.ParseFiles(\"layout.html\",\"2.html\"))\n</code></pre>\n\n<p>Use the variables like this:</p>\n\n<pre><code>err := t1.Execute(w, data)\n</code></pre>\n\n<p>The code in the question and this code above in this answer load \"layout.html\" twice. This can be avoided:</p>\n\n<pre><code>var layout = template.Must(template.ParseFiles(\"layout.html\"))\nvar t1 = template.Must(layout.Clone().ParseFiles(\"1.html\"))\nvar t2 = template.Must(layout.Clone().ParseFiles(\"2.html\"))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 2, "last_activity_date": 1503490163, "creation_date": 1503490163, "answer_id": 45839325, "question_id": 45828142, "link": "https://stackoverflow.com/questions/45828142/golang-multi-templates-caching/45839325#45839325", "title": "Golang Multi templates caching", "body": "<p>In my projects I use this helper function:</p>\n\n<pre><code>func executeTemplate(tmpls *template.Template, tmplName string, w io.Writer, data interface{}) error {\n    var err error\n    layout := tmpls.Lookup(\"layout.html\")\n    if layout == nil {\n        return errNoLayout\n    }\n\n    layout, err = layout.Clone()\n    if err != nil {\n        return err\n    }\n\n    t := tmpls.Lookup(tmplName)\n    if t == nil {\n        return errNoTemplate\n    }\n\n    _, err = layout.AddParseTree(\"content\", t.Tree)\n    if err != nil {\n        return err\n    }\n\n    return layout.Execute(w, data)\n}\n</code></pre>\n\n<p><code>tmpls</code> is the template which contains all parsed templates as \"sub-templates\", e.g. from <code>ParseFiles</code>. <code>layout.html</code> looks something like this:</p>\n\n<pre><code>&lt;main class=\"container\"&gt;\n{{template \"content\" .}}\n&lt;/main&gt;\n</code></pre>\n\n<p>While other templates are like this:</p>\n\n<pre><code>&lt;h1&gt;Welcome&lt;/h1&gt;\n</code></pre>\n\n<p>Notice, content templates don't need to start with <code>{{define \"content\"}}</code>.</p>\n"}], "owner": {"reputation": 6742, "user_id": 4912329, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/6m1mT.jpg?s=128&g=1", "display_name": "Mathieu Lescaudron", "link": "https://stackoverflow.com/users/4912329/mathieu-lescaudron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2067, "favorite_count": 2, "accepted_answer_id": 45828424, "answer_count": 2, "score": 2, "last_activity_date": 1503490163, "creation_date": 1503442333, "question_id": 45828142, "link": "https://stackoverflow.com/questions/45828142/golang-multi-templates-caching", "title": "Golang Multi templates caching", "body": "<p>I'm new to the world of Golang and I'm trying to set up a web project with templates files and good caching system.  </p>\n\n<p>I have <code>layout.html</code>, <code>1.html</code>, <code>2.html</code>.</p>\n\n<p>So I load <code>layout.html</code> in my render function : </p>\n\n<pre><code>err := templates.ExecuteTemplate(w, \"layout.html\", nil)\n</code></pre>\n\n<p><code>layout.html</code> look like this :</p>\n\n<pre><code>...   \n&lt;body&gt;{{template \"content\" .}}&lt;/body&gt;\n...\n</code></pre>\n\n<p><code>1.html</code></p>\n\n<pre><code>{{define \"content\"}}This is the first page.{{end}}\n</code></pre>\n\n<p><code>2.html</code></p>\n\n<pre><code>{{define \"content\"}}This is the second page.{{end}}\n</code></pre>\n\n<p>I can't use </p>\n\n<pre><code>var templates = template.Must(template.ParseFiles(\n    \"layout.html\",\n    \"1.html\",\n    \"2.html\"))\n</code></pre>\n\n<p>Because <code>2.html</code> override <code>1.html</code>.</p>\n\n<p>So I have two ways :</p>\n\n<ol>\n<li>Define ParseFiles in each handler function. (every time a page is rendered) Very bad perf</li>\n<li>Define an array of template like this in the init function (<a href=\"https://github.com/vitorsvieira/go-gorilla-boilerplate/blob/master/server.go\" rel=\"nofollow noreferrer\">example</a>):\n<code>\ntemplates[\"1\"] = template.Must(template.ParseFiles(\"layout.html\",\"1.html\"))\ntemplates[\"2\"] = template.Must(template.ParseFiles(\"layout.html\",\"2.html\"))\n</code></li>\n</ol>\n\n<p>Is there any new way or better way to do this ?</p>\n"}, {"tags": ["function", "go", "interface", "pass-by-reference", "pass-by-value"], "comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 1, "creation_date": 1503429442, "post_id": 45825182, "comment_id": 78608896, "body": "Perhaps provide the example that doesn&#39;t work so we can see what you want to do and why. There may be an easier way. Go doesn&#39;t have threads but goroutines (none in your example) and you shouldn&#39;t have to overwrite pointers. What&#39;s the problem you are seeing? Tell us the problem, not your proposed solution."}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1503430748, "post_id": 45825182, "comment_id": 78609517, "body": "That&#39;s better but best of all would be an example exhibiting the problem. When you say pass by value you presumably mean to copy the instance? If so why not just make a new instance for each request/goroutine?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1503462230, "post_id": 45825182, "comment_id": 78618641, "body": "Your example on the playground does not show anything which would require to get rid of pointer types. Can you provide a real example?"}, {"owner": {"reputation": 567, "user_id": 834319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gcFkP.png?s=128&g=1", "display_name": "Benji Vesterby", "link": "https://stackoverflow.com/users/834319/benji-vesterby"}, "edited": false, "score": 0, "creation_date": 1503596886, "post_id": 45825182, "comment_id": 78694691, "body": "I&#39;ve included an example of something similar to what I did for my solution in my most recent post on this thread."}], "answers": [{"tags": [], "owner": {"reputation": 567, "user_id": 834319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gcFkP.png?s=128&g=1", "display_name": "Benji Vesterby", "link": "https://stackoverflow.com/users/834319/benji-vesterby"}, "is_accepted": true, "score": 0, "last_activity_date": 1503596745, "creation_date": 1503596745, "answer_id": 45867964, "question_id": 45825182, "link": "https://stackoverflow.com/questions/45825182/trying-to-dereference-an-interface-that-is-a-pointer-to-a-struct-object-on-the-b/45867964#45867964", "title": "Trying to dereference an interface that is a pointer to a struct object on the back end so I can pass by value to a function", "body": "<p>This was solved by utilizing a channel for my integration api connection and passing a new pointer down the channel whenever it was successfully initialized. There were also some other optimizations that I was able to use to ensure that I was only replacing the pointer in the event of a successful connection. Here is an example of what I used that I got from Paul K in the Go slack channel. </p>\n\n<p><a href=\"https://play.golang.org/p/AmbsfQOzol\" rel=\"nofollow noreferrer\">https://play.golang.org/p/AmbsfQOzol</a></p>\n"}], "owner": {"reputation": 567, "user_id": 834319, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gcFkP.png?s=128&g=1", "display_name": "Benji Vesterby", "link": "https://stackoverflow.com/users/834319/benji-vesterby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 614, "favorite_count": 0, "accepted_answer_id": 45867964, "answer_count": 1, "score": 0, "last_activity_date": 1503596745, "creation_date": 1503428784, "last_edit_date": 1503429857, "question_id": 45825182, "link": "https://stackoverflow.com/questions/45825182/trying-to-dereference-an-interface-that-is-a-pointer-to-a-struct-object-on-the-b", "title": "Trying to dereference an interface that is a pointer to a struct object on the back end so I can pass by value to a function", "body": "<p>I have an interface that represents a pointer to a struct object after it has been initialized. I want to get access to the Value of the object that the interface references rather than the pointer so that I can pass it by value to a function as the interface type.</p>\n\n<p>Here is an example of my issue: <a href=\"https://play.golang.org/p/_3vKThlj-V\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_3vKThlj-V</a></p>\n\n<p>I want to be able to pass val by value to the function EvalTest in my main function so that I can overwrite the pointer to the TestStruct object in another thread without causing pointer dereference issues in another thread.</p>\n\n<p>The problem is that I'm running several thousand go routines against my interface object, but every 50 go routine calls I have to re-initialize my pointer due to a constraint of the system I'm integrating with. This seems to be leading to an inconsistent state where the new struct initialization is not completely finished when the go routines attempt to access it again. So the reason I wanted to pass it by value was so that I don't have to worry about the pointer being swapped out.</p>\n\n<p>Any thoughts on this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 1, "creation_date": 1503428085, "post_id": 45824738, "comment_id": 78608235, "body": "A basic example <a href=\"https://play.golang.org/p/vQtRiu9dNl\" rel=\"nofollow noreferrer\">play.golang.org/p/vQtRiu9dNl</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "edited": false, "score": 0, "creation_date": 1503682514, "post_id": 45824776, "comment_id": 78732580, "body": "instead of fixing/hardcoding the numbers with vowels , can they be generated randomly and then replace ?"}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "reply_to_user": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "edited": false, "score": 0, "creation_date": 1503682708, "post_id": 45824776, "comment_id": 78732689, "body": "@user2315104: Yes, modify the 2nd example: randomly generate the <code>vowels</code> map."}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "reply_to_user": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "edited": false, "score": 0, "creation_date": 1503683417, "post_id": 45824776, "comment_id": 78733090, "body": "@user2315104: your string <code>s</code> that you are passing to <code>strings.Replace</code> is empty"}, {"owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "edited": false, "score": 0, "creation_date": 1503683709, "post_id": 45824776, "comment_id": 78733221, "body": "here is my string : s = &quot;adsad&quot; but everytime it prints  : 3ds3d after replacement ... any issue ?"}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "reply_to_user": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "edited": false, "score": 0, "creation_date": 1503684213, "post_id": 45824776, "comment_id": 78733493, "body": "@user2315104: I&#39;m not sure what you&#39;re trying to accomplish. You might want to open up another question with the code you are using."}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 7, "last_activity_date": 1503427314, "creation_date": 1503427314, "answer_id": 45824776, "question_id": 45824738, "link": "https://stackoverflow.com/questions/45824738/how-to-replace-vowels-with-number/45824776#45824776", "title": "How to replace vowels with number", "body": "<p>I would suggest using <a href=\"https://godoc.org/strings#Map\" rel=\"noreferrer\"><code>strings.Map</code></a> for this:</p>\n\n<pre><code>s = strings.Map(func(r rune) rune {\n   switch r {\n     case 'a':\n       return '3'\n     case 'e':\n       return '2'\n     // etc.\n     default:\n       return r\n   }\n}, s)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/D66J5hZsNs\" rel=\"noreferrer\">https://play.golang.org/p/D66J5hZsNs</a></p>\n\n<p>With a slight modification, if you need to dynamically set the replacement values, you could store the vowels in a map. For example:</p>\n\n<pre><code>vowels := map[rune]rune{\n    'a': '3',\n    'e': '2',\n}\n\ns = strings.Map(func(r rune) rune {\n    if u, ok := vowels[r]; ok {\n        return u\n    }\n    return r\n}, s)\n</code></pre>\n"}], "owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 614, "favorite_count": 0, "accepted_answer_id": 45824776, "answer_count": 1, "score": 2, "last_activity_date": 1503684583, "creation_date": 1503427164, "last_edit_date": 1503684583, "question_id": 45824738, "link": "https://stackoverflow.com/questions/45824738/how-to-replace-vowels-with-number", "title": "How to replace vowels with number", "body": "<p>Is there any way in Go to search for vowels and replace it with numbers in a given string? the program should randomly replace the vowels with numbers and display the formatted string </p>\n\n<pre><code>package main\n\nimport (\n\"fmt\"\n\"strings\"\n)\n\nfunc main() {\n\nvowels := map[rune]rune{\n'a': '3',\n'e': '2',\n'i': '1',   \n}\n\nvar s string\ns = strings.Map(func(r rune) rune {\nif u, ok := vowels[r]; ok {\n    return u\n}\nreturn r\n}, s)\nfmt.Println(s)\n}\n</code></pre>\n\n<p>but still it is not printing the random strings .. please suggest </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 1, "creation_date": 1503427503, "post_id": 45824379, "comment_id": 78607929, "body": "First of all, Go does not have the concepts of classes and inheritance like traditional OO languages (although there are features that provide some similar functionality). As for initialization, are you talking about initialization of a particular instance of a type or initialization of a package? The normal pattern in Go for creating an object that requires some initialization is to define a method that returns a pointer to an initialized object. if you need to do some initialization in a package (i.e., only once), you can do that with an <code>init</code> function."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1503428611, "post_id": 45824379, "comment_id": 78608493, "body": "Indeed, there is no inheritance in Go, and there are no abstract classes either. This question doesn&#39;t make any sense as written."}, {"owner": {"reputation": 1, "user_id": 5586405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b06fb1a48b7e4de8be7bbfbe07276fe?s=128&d=identicon&r=PG&f=1", "display_name": "RockyK", "link": "https://stackoverflow.com/users/5586405/rockyk"}, "edited": false, "score": 0, "creation_date": 1503434285, "post_id": 45824379, "comment_id": 78611179, "body": "I understand that the exact translation from java (oop) concepts isn&#39;t possible but I&#39;m looking for a way that can make some implicit method calls like I mentioned, with a preference of not changing the design too much as it&#39;s an existing prod code."}, {"owner": {"reputation": 13866, "user_id": 54200, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6261c8ab215b8069e8290516c80445d8?s=128&d=identicon&r=PG", "display_name": "KevinDTimm", "link": "https://stackoverflow.com/users/54200/kevindtimm"}, "edited": false, "score": 0, "creation_date": 1503495985, "post_id": 45824379, "comment_id": 78640553, "body": "I&#39;m certainly a go neophyte but I can tell you, from 30+ years of experience, that if your goal is to keep the same design while changing paradigms that you&#39;ll suffer greatly.  The point of a language change is to reap the benefits of that (new) language.  If you insist on retaining the old ways you should question &#39;why change at all?&#39;"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 5586405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b06fb1a48b7e4de8be7bbfbe07276fe?s=128&d=identicon&r=PG&f=1", "display_name": "RockyK", "link": "https://stackoverflow.com/users/5586405/rockyk"}, "edited": false, "score": 0, "creation_date": 1503434645, "post_id": 45825672, "comment_id": 78611343, "body": "Not really exact translation. I only stated what should&#39;ve done in the OOP language but I&#39;m trying to figure what&#39;s the approach in Golang,and which do I even begin to get that done. Regarding using init(), my concern is that&#39;s an extra implementation that has to taken care by the main method user. I&#39;ll probably rephrase few things and add bunch of details."}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 1, "user_id": 5586405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b06fb1a48b7e4de8be7bbfbe07276fe?s=128&d=identicon&r=PG&f=1", "display_name": "RockyK", "link": "https://stackoverflow.com/users/5586405/rockyk"}, "edited": false, "score": 0, "creation_date": 1503435784, "post_id": 45825672, "comment_id": 78611905, "body": "Init doesn&#39;t need to be taken care of in main it can be in any file or pkg, read that entire linked page as it may help with other things too if new to go."}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 0, "last_activity_date": 1503430582, "creation_date": 1503430582, "answer_id": 45825672, "question_id": 45824379, "link": "https://stackoverflow.com/questions/45824379/inheritance-in-golang/45825672#45825672", "title": "Inheritance in golang", "body": "<p>Your question is a little unclear, I suspect because you are trying to directly translate ideas and idioms from another language, you should resist doing that. However, if you want an implicit init for a package in Go, you can use the magic function name</p>\n\n<pre><code>func init(){}\n</code></pre>\n\n<p><a href=\"https://golang.org/doc/effective_go.html#init\" rel=\"nofollow noreferrer\">https://golang.org/doc/effective_go.html#init</a></p>\n\n<blockquote>\n  <p>Finally, each source file can define its own niladic init function to\n  set up whatever state is required. (Actually each file can have\n  multiple init functions.) And finally means finally: init is called\n  after all the variable declarations in the package have evaluated\n  their initializers, and those are evaluated only after all the\n  imported packages have been initialized.</p>\n</blockquote>\n\n<p>Be careful with this though, it is implicit behaviour and could cause mysterious bugs if your callers don't know it is happening when they import your package.</p>\n"}], "owner": {"reputation": 1, "user_id": 5586405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b06fb1a48b7e4de8be7bbfbe07276fe?s=128&d=identicon&r=PG&f=1", "display_name": "RockyK", "link": "https://stackoverflow.com/users/5586405/rockyk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 194, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1503474180, "creation_date": 1503425622, "last_edit_date": 1503435421, "question_id": 45824379, "link": "https://stackoverflow.com/questions/45824379/inheritance-in-golang", "title": "Inheritance in golang", "body": "<p>I'm trying to create a template method that should be executed a certain other method is called.\nFor example: </p>\n\n<pre><code>func main(){\n   onInit()\n}\n\nfunc onInit(){\n   var Instance entity.EntityInstance\n   Instance.Init()\n   //do something\n}\n</code></pre>\n\n<p>Another source file, instance.go</p>\n\n<pre><code>type EntityInstance struct{\n   name string\n   version string\n}\nfunc (instance *EntityInstance) Init(){\n// do some initialization\n}\n</code></pre>\n\n<p>The main method is in different code base/app and uses the Instance app to invoke certain initializations.\nCurrently the user writing this above main method needs to explicitly call the Instance.init()</p>\n\n<p>The objective is for the developers (in this case one who implements the main method) only concern themselves with any of their custom initializations and not worry about calling \"Instance.Init()\". The OnInit() invoke should take care of \"Instance.Init()\" implicitly.</p>\n\n<p>Any help to get me started in the right direction ?</p>\n\n<p><strong>EDIT</strong>: I do understand that the exact OOP concepts cannot be translated here in Golang but all I'm looking for is the appropriate approach. Clearly, I need to change the way I think of design in here but just don't know how.</p>\n"}, {"tags": ["go", "godeps"], "answers": [{"tags": [], "owner": {"reputation": 2694, "user_id": 1280320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/922b107850370d90a2a8d7e6a0cfbd07?s=128&d=identicon&r=PG", "display_name": "RaviTezu", "link": "https://stackoverflow.com/users/1280320/ravitezu"}, "is_accepted": false, "score": 5, "last_activity_date": 1503675442, "last_edit_date": 1503675442, "creation_date": 1503469972, "answer_id": 45832208, "question_id": 45824250, "link": "https://stackoverflow.com/questions/45824250/golang-dep-unable-to-read-metadata-go-import-metadata-not-found/45832208#45832208", "title": "Golang Dep unable to read metadata: go-import metadata not found", "body": "<p>[ Update: <code>dep</code> has this feature support in their <a href=\"https://github.com/golang/dep/issues/286\" rel=\"noreferrer\">roadmap</a> ]</p>\n\n<p><code>dep</code>/<code>go get</code> uses the <code>go-import</code> meta tag to get the dependencies. \nSo, you may need to add this meta tag to your <code>git.corp.company.com</code> page. </p>\n\n<p>For Example: When you do <code>go get golang.org/x/crypto</code>, it checks the <code>go-import</code> meta tag to know more information about this library like, where it is hosted and which source control they use. This information is provided to it via the <code>go-import</code> meta tag. See below:</p>\n\n<pre><code>$curl -L -s golang.org/x/crypto | grep -i go-import\n&lt;meta name=\"go-import\" content=\"golang.org/x/crypto git https://go.googlesource.com/crypto\"&gt;\n</code></pre>\n\n<p>OR else, you can setup a proxy for this purpose.<br>\nOR there are some alternatives, where appending <code>.git</code> to import path can also help.</p>\n"}], "owner": {"reputation": 1197, "user_id": 2572703, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/ea9bb5d1f7a8a598ebc867c3b88e7aaa?s=128&d=identicon&r=PG", "display_name": "Sakib", "link": "https://stackoverflow.com/users/2572703/sakib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3919, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1503675442, "creation_date": 1503425085, "question_id": 45824250, "link": "https://stackoverflow.com/questions/45824250/golang-dep-unable-to-read-metadata-go-import-metadata-not-found", "title": "Golang Dep unable to read metadata: go-import metadata not found", "body": "<p>I am transitioning over to use golang Dep <a href=\"https://github.com/golang/dep\" rel=\"nofollow noreferrer\">https://github.com/golang/dep</a></p>\n\n<p>We have repositories for microservices that use a common code base.</p>\n\n<p>Its hosted at git.corp.company.com/Organization/common-base</p>\n\n<p>in vendor base we have a projects structure as follows</p>\n\n<pre><code>vendor\n  git.corp.company.com\n    Organization\n      common-base\n  github.com\n    ... online dependencies like aws, garyburd, etc...\n  golang.org\n    X\n      sys\n      text\n</code></pre>\n\n<p>When I try to do dep init, I get an error message like </p>\n\n<p><code>unable to deduce repository and source type for \"git.corp.company.com/Organization/common-base\": unable to read metadata: go-import metadata not found</code></p>\n\n<p>I'm not sure why that is happening and what to do next. Do I need to add in the metadata file to our common code?</p>\n"}, {"tags": ["go", "yaml"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1503424417, "post_id": 45824062, "comment_id": 78606274, "body": "What library are you using to parse the YAML?"}, {"owner": {"reputation": 1347, "user_id": 671339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/029f4450af6c1053fcf747ce9afc669b?s=128&d=identicon&r=PG", "display_name": "intellion", "link": "https://stackoverflow.com/users/671339/intellion"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1503439740, "post_id": 45824062, "comment_id": 78613523, "body": "@Adrian <a href=\"https://github.com/go-yaml/yaml\" rel=\"nofollow noreferrer\">github.com/go-yaml/yaml</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1347, "user_id": 671339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/029f4450af6c1053fcf747ce9afc669b?s=128&d=identicon&r=PG", "display_name": "intellion", "link": "https://stackoverflow.com/users/671339/intellion"}, "edited": false, "score": 0, "creation_date": 1503478288, "post_id": 45824109, "comment_id": 78627016, "body": "there is no nesting in YAML sample I provided. Unfortunately, your suggested solution of using map[string]string{} directly doesn&#39;t work and produces the same error: <code>line 1: cannot unmarshal !!str &#39;A&#39; into map[string]string</code>"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 1, "last_activity_date": 1503424928, "last_edit_date": 1503424928, "creation_date": 1503424569, "answer_id": 45824109, "question_id": 45824062, "link": "https://stackoverflow.com/questions/45824062/figuring-out-the-right-struct-to-parse-a-simple-yaml-file-in-golang/45824109#45824109", "title": "Figuring out the right struct to parse a simple YAML file in Golang", "body": "<p>The issue is caused by you wrapping the map in an object, the YAML has no such nesting.</p>\n\n<pre><code>map := map[string]string{}\nerr := yaml.Unmarshal([]byte(val), &amp;map)\n</code></pre>\n\n<p>You can actually just unmarshal directly into the map itself</p>\n\n<p>EDIT: hard to tell with your formatting but if those integer keys are nested under <code>A</code> then you will need a different structure as well, it would actually be a <code>map[string]map[string]string</code> -- however that is rather ugly so I would recommend moving to a different paradigm at that point... You could either use a <code>map[string]interface{}</code> which wouldn't care what types go into the map and then you could deal with it later or you could define the object more statically, using actually keys such a <code>A</code> in a struct to denote where each item goes, if that were the case you'd have an object like the following;</p>\n\n<pre><code>type TranslationVal struct {\n    A map[string]string\n    B string\n    C string\n    // and so on\n    F string `yaml:f` // necessary because f would be unexported\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1347, "user_id": 671339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/029f4450af6c1053fcf747ce9afc669b?s=128&d=identicon&r=PG", "display_name": "intellion", "link": "https://stackoverflow.com/users/671339/intellion"}, "is_accepted": false, "score": -1, "last_activity_date": 1503498833, "creation_date": 1503498833, "answer_id": 45842664, "question_id": 45824062, "link": "https://stackoverflow.com/questions/45824062/figuring-out-the-right-struct-to-parse-a-simple-yaml-file-in-golang/45842664#45842664", "title": "Figuring out the right struct to parse a simple YAML file in Golang", "body": "<p>I actually tried to parse a value that wasn't YAML at all, doh!!</p>\n"}], "owner": {"reputation": 1347, "user_id": 671339, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/029f4450af6c1053fcf747ce9afc669b?s=128&d=identicon&r=PG", "display_name": "intellion", "link": "https://stackoverflow.com/users/671339/intellion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 366, "favorite_count": 0, "accepted_answer_id": 45824109, "answer_count": 2, "score": -1, "last_activity_date": 1503498833, "creation_date": 1503424367, "question_id": 45824062, "link": "https://stackoverflow.com/questions/45824062/figuring-out-the-right-struct-to-parse-a-simple-yaml-file-in-golang", "title": "Figuring out the right struct to parse a simple YAML file in Golang", "body": "<p>I have a fairly simple YAML document to parse into a (preferably) map in Go.</p>\n\n<p>YAML doc:</p>\n\n<pre><code>---\nA: Logon\n'0': Heartbeat\n'1': Test Request\n'2': Resend Request\n'3': Reject\n'4': Sequence Reset\n'5': Logout\n'8': Execution Report\nS: Quote\nAE: Trade Capture Report\nB: News\nh: Trading Session Status\nf: Security Status\n</code></pre>\n\n<p>I'm trying to marshal it with</p>\n\n<pre><code>type TranslationVal struct {\n    Map map[string]string\n}\n\ntranslationVal := TranslationVal{}\nerr := yaml.Unmarshal([]byte(val), &amp;translationVal)\n</code></pre>\n\n<p>However I'm getting:</p>\n\n<pre><code>2017/08/22 20:33:23 yaml: unmarshal errors:   line 1: cannot unmarshal !!str `A` into main.TranslationVal\n</code></pre>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1503424259, "post_id": 45823566, "comment_id": 78606190, "body": "SQL injection much? This is very vulnerable to SQL injection attacks. At least as far as what code you&#39;ve posted."}, {"owner": {"reputation": 1246, "user_id": 4516106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37134b731235c61f94701c9e5d6882cf?s=128&d=identicon&r=PG", "display_name": "khue bui", "link": "https://stackoverflow.com/users/4516106/khue-bui"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1503424336, "post_id": 45823566, "comment_id": 78606229, "body": "sorry, what do you mean @RayfenWindspear ?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1503424472, "post_id": 45823566, "comment_id": 78606307, "body": "Assuming this comes from a web form of some type. Manage on the front end a matching list of <code>bool</code>s representing &quot;has this field been updated&quot; using javascript or jQuery. Then you can use that to determine what the user wants to update."}, {"owner": {"reputation": 1246, "user_id": 4516106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37134b731235c61f94701c9e5d6882cf?s=128&d=identicon&r=PG", "display_name": "khue bui", "link": "https://stackoverflow.com/users/4516106/khue-bui"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1503424640, "post_id": 45823566, "comment_id": 78606407, "body": "I also use graphql-go too, so I don&#39;t think SQL injection will effect"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1503424787, "post_id": 45823566, "comment_id": 78606500, "body": "OK, but just be careful when dynamically creating SQL strings like this that you are positive that every piece of the string comes ONLY from inside your own code and you are in complete control. Then only pass the values to the Query function."}, {"owner": {"reputation": 1246, "user_id": 4516106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37134b731235c61f94701c9e5d6882cf?s=128&d=identicon&r=PG", "display_name": "khue bui", "link": "https://stackoverflow.com/users/4516106/khue-bui"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1503425104, "post_id": 45823566, "comment_id": 78606680, "body": "Tks for your advice @RayfenWindspear"}], "answers": [{"comments": [{"owner": {"reputation": 1246, "user_id": 4516106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37134b731235c61f94701c9e5d6882cf?s=128&d=identicon&r=PG", "display_name": "khue bui", "link": "https://stackoverflow.com/users/4516106/khue-bui"}, "edited": false, "score": 0, "creation_date": 1503425371, "post_id": 45824081, "comment_id": 78606836, "body": "Yes, i missed a condition there, btw, you solved my problem and save my day, tks you so much"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1503424459, "creation_date": 1503424459, "answer_id": 45824081, "question_id": 45823566, "link": "https://stackoverflow.com/questions/45823566/golang-update-column-with-postgres/45824081#45824081", "title": "Golang UPDATE column with Postgres", "body": "<p>Just collect the non-nil values in a slice and then use that slice with <code>...</code> when executing the query.</p>\n\n<pre><code>var values []interface{}\nfor i := range m {\n    if v := m[i]; v != \"\" &amp;&amp; v != 0 &amp;&amp; v != 0.0 &amp;&amp; /* you're missing a condition here */{\n        j++\n        query = query + strings.ToLower(i) + \"=$\" + strconv.Itoa(j) + \",\"\n        values = append(values, v)\n    }\n}\n\n// ....\n\ndatabase.DB.QueryRow(query_string, values...)\n</code></pre>\n"}], "owner": {"reputation": 1246, "user_id": 4516106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37134b731235c61f94701c9e5d6882cf?s=128&d=identicon&r=PG", "display_name": "khue bui", "link": "https://stackoverflow.com/users/4516106/khue-bui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2046, "favorite_count": 0, "accepted_answer_id": 45824081, "answer_count": 1, "score": 0, "last_activity_date": 1503440646, "creation_date": 1503422421, "last_edit_date": 1503440646, "question_id": 45823566, "link": "https://stackoverflow.com/questions/45823566/golang-update-column-with-postgres", "title": "Golang UPDATE column with Postgres", "body": "<p>Let's say I have a table <code>employments</code> and a struct <code>Employment</code></p>\n\n<pre><code>type Employment struct {\n    ID              int     `json:\"id\"`\n    Created_at      string  `json:\"created_at\"`\n    Updated_at      string  `json:\"updated_at\"`\n    Education       string  `json:\"education\"`\n    Job             string  `json:\"job\"`\n    Position        string  `json:\"position\"`\n    Business_phone  string  `json:\"business_phone\"`\n    Next_payday     string  `json:\"next_payday\"`\n    Employment_type int     `json:\"employment_type\"`\n    Income          float64 `json:\"income\"`\n    Additional      float64 `json:\"additional\"`\n}\n</code></pre>\n\n<p>User can update their <code>employment</code>, the problem is I don't know which fields user want to update.</p>\n\n<p>So that, I decided to range over input struct to get <code>non nil fields</code> to generate query string, some thing like <code>UPDATE employments SET position=$1, income=$2 WHERE id=$3</code></p>\n\n<p>This is what I got this time</p>\n\n<pre><code>func FlexibleUpdate(table_name string, str interface{}, cond string, ret string) string {\n\n    query := \"UPDATE \" + table_name + \" SET \"\n    j := 0\n    m := structs.Map(str)\n\n    for i := range m {\n        if m[i] != \"\" &amp;&amp; m[i] != 0 &amp;&amp; m[i] != 0.0 &amp;&amp; {\n            j++\n            query = query + strings.ToLower(i) + \"=$\" + strconv.Itoa(j) + \",\"\n        }\n    }\n    j++\n\n    // adding conditions\n    if cond != \"\" {\n        query = query[:len(query)-1] + \" WHERE \" + cond + \"=$\" + strconv.Itoa(j)\n    }\n\n    // return values\n    if ret != \"\" {\n        query = query + \" RETURNING \" + ret\n    }\n\n    return query\n}\n</code></pre>\n\n<p>I don't know how to assign input values to <code>$1, $2, ...</code> to execute query</p>\n\n<pre><code>database.DB.QueryRow(query_string, value_1, value_2, ...)\n</code></pre>\n\n<p>Let me know if you have any idea or another way to resolve it.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 491, "user_id": 7655137, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5203fc333c6443affb37aa2209267d71?s=128&d=identicon&r=PG&f=1", "display_name": "darkwing", "link": "https://stackoverflow.com/users/7655137/darkwing"}, "edited": false, "score": 0, "creation_date": 1503425068, "post_id": 45823718, "comment_id": 78606657, "body": "Ok, I missed the new keyword which I see in <a href=\"https://golang.org/pkg/builtin/#new\" rel=\"nofollow noreferrer\">golang.org/pkg/builtin/#new</a> returns <code>*Type</code>"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 5, "last_activity_date": 1503423014, "creation_date": 1503423014, "answer_id": 45823718, "question_id": 45823531, "link": "https://stackoverflow.com/questions/45823531/can-context-context-variables-be-copied-and-still-function-normally-in-all-ways/45823718#45823718", "title": "Can context.Context variables be copied and still function normally in all ways in golang?", "body": "<p>Yes, you can use them interchangeably.</p>\n\n<p>As you already noticed, the <code>context</code> variables returned by <code>WithCancel</code>, etc, are actually pointers, so both <code>localCtx</code> and <code>ctx</code> will be pointing to the same thing.</p>\n\n<p>About <code>emptyCtx</code> being an <code>int</code>, it should not change things as it is also being used as a pointer.</p>\n\n<p>The <code>background</code> variable you mention is actually a pointer to an <code>emptyCtx</code>, as it is initialized by using the <code>new</code> keyword:</p>\n\n<pre><code>background = new(emptyCtx)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 842, "user_id": 3450122, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/yR1sJ.jpg?s=128&g=1", "display_name": "del bao", "link": "https://stackoverflow.com/users/3450122/del-bao"}, "is_accepted": false, "score": 0, "last_activity_date": 1505339480, "creation_date": 1505339480, "answer_id": 46207362, "question_id": 45823531, "link": "https://stackoverflow.com/questions/45823531/can-context-context-variables-be-copied-and-still-function-normally-in-all-ways/46207362#46207362", "title": "Can context.Context variables be copied and still function normally in all ways in golang?", "body": "<p><code>context.Context</code> is an interface. Its size is two pointers. Copying up to 16 bytes is not scary at all</p>\n"}], "owner": {"reputation": 491, "user_id": 7655137, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5203fc333c6443affb37aa2209267d71?s=128&d=identicon&r=PG&f=1", "display_name": "darkwing", "link": "https://stackoverflow.com/users/7655137/darkwing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2270, "favorite_count": 0, "accepted_answer_id": 45823718, "answer_count": 2, "score": 3, "last_activity_date": 1505339480, "creation_date": 1503422229, "question_id": 45823531, "link": "https://stackoverflow.com/questions/45823531/can-context-context-variables-be-copied-and-still-function-normally-in-all-ways", "title": "Can context.Context variables be copied and still function normally in all ways in golang?", "body": "<p>I'm seeing the following situation:</p>\n\n<pre><code>func foo(ctx context.Context) {\n    localCtx := ctx \n    ... //do stuff\n}\n</code></pre>\n\n<p>Can both of these <code>context.Context</code> variables be used interchangeably in all ways? </p>\n\n<p>Looking at the source I see that the returned <code>context.Context</code> variables from <code>WithCancel</code>, <code>WithDeadline</code>, <code>WithTimeout</code>, and <code>WithValue</code> returned are implemented internally by a pointers to structs, which would make me think that yes, they could be used interchangeably if the parent context came from one of these functions. However, the <code>emptyCtx</code> returned by <code>context.Background()</code> is an int internally, so here I'm thinking perhaps they could not be used internally if the parent context was the background context.</p>\n\n<p>But <code>context.Context</code> is actually an interface and I'm not sure if/how that changes things. </p>\n"}, {"tags": ["go", "transactions", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1503414299, "post_id": 45820737, "comment_id": 78600105, "body": "<a href=\"https://godoc.org/cloud.google.com/go/datastore#Transaction.Get\" rel=\"nofollow noreferrer\">godoc.org/cloud.google.com/go/datastore#Transaction.Get</a> Please note the comment about the isolation level as well."}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "reply_to_user": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1503414412, "post_id": 45820737, "comment_id": 78600184, "body": "&gt; All reads performed during the transaction will come from a single consistent snapshot. It is not clear to me that the isolation applies if the query is not made through <code>t</code>. Maybe I&#39;m overthinking it?"}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1503414598, "post_id": 45820737, "comment_id": 78600352, "body": "I&#39;m not really familiar with datastore. Are you able to use the <code>Get</code> method to get a user by email in your scenario? Or will that only work for the ID field?"}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "reply_to_user": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1503414639, "post_id": 45820737, "comment_id": 78600392, "body": "The <code>Get</code> expects a key, not a query."}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1503414680, "post_id": 45820737, "comment_id": 78600429, "body": "Right, can you make a key <code>emailKey := datastore.NameKey(&quot;Email&quot;, user.Email, nil)</code>?"}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "reply_to_user": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1503414740, "post_id": 45820737, "comment_id": 78600481, "body": "No. I do not have an entity (i.e. &quot;table&quot;) named <code>Email</code>."}], "answers": [{"comments": [{"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1503414881, "post_id": 45821375, "comment_id": 78600586, "body": "Ok. Thanks. I was thinking that the answer would be something along those lines. I guess when a user changes his/her email, I would also delete the &quot;row&quot; from <code>Email</code> that corresponds to the old value."}], "tags": [], "owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "is_accepted": true, "score": 4, "last_activity_date": 1503415438, "last_edit_date": 1503415438, "creation_date": 1503414748, "answer_id": 45821375, "question_id": 45820737, "link": "https://stackoverflow.com/questions/45820737/unique-email-in-google-datastore/45821375#45821375", "title": "Unique email in Google Datastore", "body": "<p>The short answer is no, you cannot use a query as part of a transaction unless you are querying a specific entity group. Global queries are alway eventually consistent. However, to put everything in a single entity group would likely limit write throughput too much.</p>\n\n<p>A workaround is you can have another Kind with entities that map email addresses to users. Then you can, in a transaction, check the email Entity and if it doesn't exist or it points to a bad location, set the email Entity and the user Entity all as a single transaction.</p>\n"}], "owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 447, "favorite_count": 0, "accepted_answer_id": 45821375, "answer_count": 1, "score": 1, "last_activity_date": 1503415438, "creation_date": 1503413001, "question_id": 45820737, "link": "https://stackoverflow.com/questions/45820737/unique-email-in-google-datastore", "title": "Unique email in Google Datastore", "body": "<p>I have a <code>User</code> entity containing an <code>Email</code> field. The <code>User</code> entity id is a <a href=\"https://github.com/oklog/ulid\" rel=\"nofollow noreferrer\">ULID</a>, because I want to allow users to change their email addresses, but I want to ensure that the email address is unique on both a <code>CREATE</code> and an <code>UPDATE</code>.</p>\n\n<p>I am using Datastore transactions. This is a code fragment:</p>\n\n<pre><code>ctx := context.Background()\nk := datastore.NameKey(\"User\", user.ID, nil)\n_, err := client.RunInTransaction(ctx, func(t *datastore.Transaction) error {\n    // other stuff that needs to be in transaction\n    _, err = t.Put(k, user)\n    return err\n})\n\nreturn err\n</code></pre>\n\n<p>The <code>Email</code> field is indexed. Is there any way to search the <code>User</code> entity for the current user's email address as part of the transaction?</p>\n\n<p><code>*datastore.Transaction</code> does not have a <code>GetAll</code> method, so I cannot run a query like this:</p>\n\n<pre><code>datastore.NewQuery(\"User\").Filter(\"Email =\", user.Email)\n</code></pre>\n\n<p>I'm afraid that using</p>\n\n<pre><code>client.GetAll(ctx, q, nil)\n</code></pre>\n\n<p>will not guarantee isolation within the transaction.</p>\n"}, {"tags": ["pointers", "go", "comparison"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 10, "creation_date": 1503408542, "post_id": 45818964, "comment_id": 78595513, "body": "In Go there is no pointer arithmetic. What&#39;s the meaning of pointer <code>a</code> being less than pointer <code>b</code>? What possible information does it have that a memory address is less than another one?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1503409433, "post_id": 45818964, "comment_id": 78596256, "body": "Yes, you can get the address as a number or hex string, that&#39;s not the problem. It&#39;s that there is no sense in comparing the pointer values themselves."}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1503409539, "post_id": 45818964, "comment_id": 78596334, "body": "Why would you care about the ordering of two values when answer you get is pretty much random? The information which particular address a pointer points to is meaningless without pointer arithmetic. In C (and I assume C++) pointers can only be compared when two pointers point to the same array (all other comparisons between pointers are undefined)."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1503409546, "post_id": 45818964, "comment_id": 78596338, "body": "In C++ if <code>a</code> and <code>b</code> are pointers, then <code>if (a-&gt;val &lt; b-&gt;val) { ... }</code> simply translates to <code>if (a.val &lt; b.val) { ... }</code> in Go."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1503409831, "post_id": 45818964, "comment_id": 78596557, "body": "Yes I know, but in Go it works. <code>a.val</code> is a shorthand for <code>(*a).val</code>."}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1503410348, "post_id": 45818964, "comment_id": 78596975, "body": "It&#39;s pretty trivial to convert a pointer to an integer and then compare the integers. But no one (including me) is telling you how to do it because we don&#39;t want to end up working with bad code that does things like that in case your code slips out or someone reads the answer and starts doing it."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1503410857, "post_id": 45818964, "comment_id": 78597405, "body": "Again, whether it&#39;s achievable has nothing to do with whether it makes sense. You still haven&#39;t stated what you&#39;re actually trying to accomplish here, but I&#39;d bet there&#39;s a better way to achieve the end goal than trying to compare memory addresses."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1503421730, "post_id": 45818964, "comment_id": 78604854, "body": "Put another way: Doing a <code>&lt;</code> or <code>&gt;</code> comparison against pointers <i>never solves any problem</i>. So whatever problem you&#39;re trying to solve, must, by logical deduction, be solved some other way. So asking about your larger problem would naturally be a more fruitful way to find an answer."}, {"owner": {"reputation": 21278, "user_id": 168465, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f9a38df7ddf75a46b36c6a6ef5f98381?s=128&d=identicon&r=PG", "display_name": "kriss", "link": "https://stackoverflow.com/users/168465/kriss"}, "edited": false, "score": 0, "creation_date": 1537567186, "post_id": 45818964, "comment_id": 91846376, "body": "Is the intent to use the address as some kind of hash ? In wich case it would indeed make sense. Basically that is what (some implementations of) python is doing to return the hash [ id() ] of objects."}, {"owner": {"reputation": 9620, "user_id": 1783163, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/BfUwH.jpg?s=128&g=1", "display_name": "peterh", "link": "https://stackoverflow.com/users/1783163/peterh"}, "reply_to_user": {"reputation": 21278, "user_id": 168465, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f9a38df7ddf75a46b36c6a6ef5f98381?s=128&d=identicon&r=PG", "display_name": "kriss", "link": "https://stackoverflow.com/users/168465/kriss"}, "edited": false, "score": 2, "creation_date": 1537567531, "post_id": 45818964, "comment_id": 91846477, "body": "@kriss I implemented a generic AVL tree, and I wanted this for a default comparison function. I tought (from C++) that comparing the pointers would be useful. I didn&#39;t know at the moment that allocated memory addresses can change in Go. Later that I learned that, and I used the equivalent of the C++ abstract class to implement it. I disliked the default go library from the first moment, particularly its hash implementation and that it is hard-wired into the language syntax, because I consider it VLQ. On these reasons, later I stopped to use Go any more."}, {"owner": {"reputation": 21278, "user_id": 168465, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f9a38df7ddf75a46b36c6a6ef5f98381?s=128&d=identicon&r=PG", "display_name": "kriss", "link": "https://stackoverflow.com/users/168465/kriss"}, "edited": false, "score": 0, "creation_date": 1537567875, "post_id": 45818964, "comment_id": 91846567, "body": "Too bad, I&#39;m pondering if I should use Go or not these days... I need some rock strong and very fast HTTP stack, and I&#39;m rather worry to use some C++ library (not the common C++ use, henceforth I&#39;m expecting troubles)."}], "answers": [{"comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 3, "creation_date": 1503410680, "post_id": 45819780, "comment_id": 78597241, "body": "I didn&#39;t recommend unsafe :) I think sometimes it&#39;s worth explaining why it is unsafe, as well as how to do it, so that people can make informed decisions... and maybe learn a little about the go memory model too."}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 5, "last_activity_date": 1503410830, "last_edit_date": 1503410830, "creation_date": 1503410430, "answer_id": 45819780, "question_id": 45818964, "link": "https://stackoverflow.com/questions/45818964/how-can-i-compare-pointers-in-go/45819780#45819780", "title": "How can I compare pointers in Go?", "body": "<blockquote>\n  <p>Is it guaranteed that the order of the pointers remains the same? (For\n  example, I can imagine some GC trickery which also reorders the data.)</p>\n</blockquote>\n\n<p>In answer to this part of your question, it doesn't look like it. See pkg unsafe linked below. </p>\n\n<p>If you want the memory address of a pointer, try the unsafe package:</p>\n\n<p><a href=\"https://golang.org/pkg/unsafe/#Pointer\" rel=\"noreferrer\">https://golang.org/pkg/unsafe/#Pointer</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\nfunc main() {\n    var a,b int\n    var pa,pb *int\n    pa = &amp;a\n    pb = &amp;b\n\n    //var c int\n    //pa = &amp;c\n\n    if uintptr(unsafe.Pointer(pa)) &lt; uintptr(unsafe.Pointer(pb)) {\n      fmt.Printf(\"a:%p &gt; b:%p\",pa,pb)   \n    } else {\n      fmt.Printf(\"b:%p &gt; a:%p\",pb,pa)\n    }\n\n}\n</code></pre>\n\n<p>This will let you get an arbitrary Pointer type and then the <em>current</em> memory address of that pointer (as printf would). Note the caveats there though, you cannot rely on this address:</p>\n\n<blockquote>\n  <p>Converting a Pointer to a uintptr produces the memory address of the\n  value pointed at, as an integer. The usual use for such a uintptr is\n  to print it. Conversion of a uintptr back to Pointer is not valid in\n  general. A uintptr is an integer, not a reference. Converting a\n  Pointer to a uintptr creates an integer value with no pointer\n  semantics. Even if a uintptr holds the address of some object, the\n  garbage collector will not update that uintptr's value if the object\n  moves, nor will that uintptr keep the object from being reclaimed.</p>\n</blockquote>\n\n<p><strong>This bypasses the Go type system and memory security so it's unsafe and you probably don't want to do it</strong>, unless you're just experimenting. I can't think of a reason to do it in tests, but if you want to be sure to read that entire document and be very sure you know that what you are doing will work as you expect.  </p>\n"}], "owner": {"reputation": 9620, "user_id": 1783163, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/BfUwH.jpg?s=128&g=1", "display_name": "peterh", "link": "https://stackoverflow.com/users/1783163/peterh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2123, "favorite_count": 0, "accepted_answer_id": 45819780, "answer_count": 1, "score": -9, "last_activity_date": 1511075690, "creation_date": 1503408394, "last_edit_date": 1511075690, "question_id": 45818964, "link": "https://stackoverflow.com/questions/45818964/how-can-i-compare-pointers-in-go", "title": "How can I compare pointers in Go?", "body": "<p>I am building some test code and I try to compare pointers with the <code>&lt;</code>, <code>&gt;</code> operators. My goal is to order elements into a balanced tree structure (implemented by me). For that, I need quick, generic comparation. Following the good old C/C++ customs, my current idea is (<em>...was, at the time of writing this post</em>) to compare them by their pointer addresses.</p>\n\n<p>However, as I've found, it doesn't work. The source</p>\n\n<pre><code>if (&amp;(a.val) &lt; &amp;(b.val)) {\n</code></pre>\n\n<p>gives the compile error</p>\n\n<blockquote>\n  <p>./pointer.go:40: invalid operation: &amp;a.val &lt; &amp;b.val (operator &lt; not defined on pointer)</p>\n</blockquote>\n\n<p><code>a</code> and <code>b</code> are structs with <code>val</code> as (safe) pointer member.</p>\n\n<p>Is it possible to compare safe pointers in go? How?</p>\n\n<p>Is it guaranteed that the order of the pointers remains the same? (For example, I can imagine some GC trickery which also reorders the data.)</p>\n"}, {"tags": ["go", "rpc", "panic"], "comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1503431040, "post_id": 45818691, "comment_id": 78609664, "body": "Run the race detector. Then try to check what data triggered this - perhaps you had unusual data which caused the panic? You&#39;ll probably  need to provide code at the point of error for someone to help. I&#39;d try to reproduce it first."}, {"owner": {"reputation": 1, "user_id": 8500496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60377641d0e61a9926e2780b1365570a?s=128&d=identicon&r=PG&f=1", "display_name": "Prinny", "link": "https://stackoverflow.com/users/8500496/prinny"}, "reply_to_user": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1503459074, "post_id": 45818691, "comment_id": 78617887, "body": "@KennyGrant ,the code in this comment is not right format, so i post it below, thank you~"}], "answers": [{"tags": [], "owner": {"reputation": 123, "user_id": 5487384, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh4.googleusercontent.com/-XnqxrMhWyeo/AAAAAAAAAAI/AAAAAAAAAMk/DygKn5VFJQo/photo.jpg?sz=128", "display_name": "Sarim  Zafar", "link": "https://stackoverflow.com/users/5487384/sarim-zafar"}, "is_accepted": false, "score": 0, "last_activity_date": 1503610850, "creation_date": 1503610850, "answer_id": 45871327, "question_id": 45818691, "link": "https://stackoverflow.com/questions/45818691/rpc-sendresponse-panicreflect-call-of-reflect-value-int-on-ptr/45871327#45871327", "title": "rpc sendResponse panic:reflect: call of reflect.Value.Int on ptr", "body": "<p>I do not think there is an issue with the <code>sendResponse</code> function in the <code>net/rpc</code> package. </p>\n\n<p>The request panics in the Encode function when it comes across a pointer which is <code>nil</code>. You should read the documentation on <code>gob/encodeStruct</code> to see under what situations it fails to encode values.</p>\n"}], "owner": {"reputation": 1, "user_id": 8500496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60377641d0e61a9926e2780b1365570a?s=128&d=identicon&r=PG&f=1", "display_name": "Prinny", "link": "https://stackoverflow.com/users/8500496/prinny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1503610850, "creation_date": 1503407680, "last_edit_date": 1503461354, "question_id": 45818691, "link": "https://stackoverflow.com/questions/45818691/rpc-sendresponse-panicreflect-call-of-reflect-value-int-on-ptr", "title": "rpc sendResponse panic:reflect: call of reflect.Value.Int on ptr", "body": "<p>My server is running well in the production environment when it panic'd the day before yesterday.</p>\n\n<p>I posted an issue in the Go Forum and someone told me to do race detection.</p>\n\n<p>I see net/rpc.(*Server).sendResponse is thread safe.</p>\n\n<p>Is there anything wrong with sendResponse in rpc package\uff1f</p>\n\n<p>In my code, reply is only a *int and doesn't do anything functionally so I have no idea with this panic:</p>\n\n<pre><code>panic: reflect: call of reflect.Value.Int on ptr Value [recovered]  \npanic: reflect: call of reflect.Value.Int on ptr Value  \ngoroutine 52598456 [running]:  \nencoding/gob.catchError(0xc4209e10d0) \n/root/go/src/encoding/gob/error.go:38 +0x95  \n    panic(0xc40860, 0xc42606ad00) \n/root/go/src/runtime/panic.go:489 +0x2cf  \n    reflect.Value.Int(0xbcdec0, 0xc4251fe520, 0x196, 0x196)  \n/root/go/src/reflect/value.go:902 +0xb5  \n    encoding/gob.encInt(0xc423ab4ae0, 0xc422da1e40, 0xbcdec0, 0xc4251fe520, 0x196)  \n/root/go/src/encoding/gob/encode.go:188 +0x43  \n    encoding/gob.(*Encoder).encodeStruct(0xc4209e1040, 0xc4209e1078, 0xc421a28a20, 0xcc1be0, 0xc4251fe510, 0x199)  \n/root/go/src/encoding/gob/encode.go:334 +0x256  \n    encoding/gob.(*Encoder).encode(0xc4209e1040, 0xc4209e1078, 0xcc1be0, 0xc4251fe510, 0x199, 0xc4209c3480)  \n/root/go/src/encoding/gob/encode.go:707 +0x1d3\n    encoding/gob.(*Encoder).EncodeValue(0xc4209e1040, 0xc95bc0, 0xc4251fe510, 0x16, 0x0, 0x0)  \n/root/go/src/encoding/gob/encoder.go:250 +0x3ab  \n    encoding/gob.(*Encoder).Encode(0xc4209e1040, 0xc95bc0, 0xc4251fe510, 0x0, 0x0) \n/root/go/src/encoding/gob/encoder.go:175 +0x61  \n    net/rpc.(*gobServerCodec).WriteResponse(0xc422b51ec0, 0xc422d737d0, 0xc95bc0, 0xc4251fe510, 0xc422b43a40, 0xc422b4a350)  \n/root/go/src/net/rpc/server.go:424 +0x1dd  \n    net/rpc.(*Server).sendResponse(0xc420055680, 0xc422b45aa0, 0xc421c4ff00, 0xc95bc0, 0xc4251fe510, 0x1334ac0, 0xc422b51ec0, 0x0, 0x0)  \n/root/go/src/net/rpc/server.go:366 +0x130  \n    net/rpc.(*service).call(0xc422afe900, 0xc420055680, 0xc422b45aa0, 0xc422b4ec00, 0xc421c4ff00, 0xbc3800, 0xc427ab07e0, 0x16, 0xc95bc0, 0xc4251fe510, ...)  \n/root/go/src/net/rpc/server.go:394 +0x22e  \n    created by net/rpc.(*Server).ServeCodec  \n/root/go/src/net/rpc/server.go:481 +0x404     \n</code></pre>\n\n<hr>\n\n<p><code>type RpcArgs struct{\n    A string\n    B int32\n    C string\n    D int32\n    E String\n    F int32 \n    G int32\n    H int32 \n    I bool\n    J string\n    K int32\n    L String\n    M int32 \n    N int32\n    O int32 \n    P bool\n}</code></p>\n\n<p><code>func RPC1(args *RpcArgs, reply *int) error{\n    //some simple logic with args, do noting with reply\n    //do another async rpc call,may be this is useless\n    var reply2 int\n    rpc.Client.Go(serviceMethod, args, &amp;reply2, make(chan *rpc.Call, 1))\n    return nil\n}</code></p>\n\n<p>The source code just like that.reply *int is return directly which is not modified in RPC1</p>\n"}, {"tags": ["go", "couchbase-lite", "cgo"], "answers": [{"comments": [{"owner": {"reputation": 2368, "user_id": 789655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b7fac771a6c8fccc82fe34f951b7b3fd?s=128&d=identicon&r=PG", "display_name": "Sthe", "link": "https://stackoverflow.com/users/789655/sthe"}, "edited": false, "score": 0, "creation_date": 1505810269, "post_id": 45848903, "comment_id": 79553755, "body": "Actually, the replication stuff is the reason I&#39;m considering it."}, {"owner": {"reputation": 6519, "user_id": 613453, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0c744d4e2bee639d69f3e78f7daeba6d?s=128&d=identicon&r=PG", "display_name": "themihai", "link": "https://stackoverflow.com/users/613453/themihai"}, "edited": false, "score": 0, "creation_date": 1509860795, "post_id": 45848903, "comment_id": 81186985, "body": "I&#39;ve found BoltDB quite unbearable due the transaction locks/deadlocks."}], "tags": [], "owner": {"reputation": 1, "user_id": 1558791, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/509jy.jpg?s=128&g=1", "display_name": "mattparlmer", "link": "https://stackoverflow.com/users/1558791/mattparlmer"}, "is_accepted": false, "score": 0, "last_activity_date": 1503520741, "creation_date": 1503520741, "answer_id": 45848903, "question_id": 45818544, "link": "https://stackoverflow.com/questions/45818544/using-couchbase-lite-not-couchbase-server-in-a-golang-application/45848903#45848903", "title": "Using Couchbase Lite (not Couchbase Server) in a Golang application", "body": "<p>I haven't tried embedding Couchbase Lite, but my team and I make extensive use of embedded datastores like <a href=\"https://github.com/boltdb/bolt\" rel=\"nofollow noreferrer\">BoltDB</a> Assuming you aren't using Couchbase's replication features heavily, BoltDB may meet your requirements.</p>\n"}, {"comments": [{"owner": {"reputation": 2368, "user_id": 789655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b7fac771a6c8fccc82fe34f951b7b3fd?s=128&d=identicon&r=PG", "display_name": "Sthe", "link": "https://stackoverflow.com/users/789655/sthe"}, "edited": false, "score": 1, "creation_date": 1505810342, "post_id": 45902349, "comment_id": 79553809, "body": "It looks like there is no Go implementation yet, so I will mark this as the answer to close the thread."}], "tags": [], "owner": {"reputation": 2157, "user_id": 968231, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SWsf0.jpg?s=128&g=1", "display_name": "Hod", "link": "https://stackoverflow.com/users/968231/hod"}, "is_accepted": true, "score": 1, "last_activity_date": 1503816156, "creation_date": 1503816156, "answer_id": 45902349, "question_id": 45818544, "link": "https://stackoverflow.com/questions/45818544/using-couchbase-lite-not-couchbase-server-in-a-golang-application/45902349#45902349", "title": "Using Couchbase Lite (not Couchbase Server) in a Golang application", "body": "<p>Lite Core is the underlying implementation of the upcoming 2.0 version of Couchbase Lite.  It's still under development.  The intention is to have a common core, with platform and language specific bindings on top.</p>\n\n<p>There is currently no Go implementation I'm aware of.  <code>cgo</code> does look like an option.  Given the goal of Lite Core being the underlying implementation for all platforms, this seems on its face like a reasonable approach.</p>\n\n<p>If you're interested, there's a GitHub account for community projects at <a href=\"https://github.com/couchbaselabs\" rel=\"nofollow noreferrer\">https://github.com/couchbaselabs</a>.  If you work on this, it would be great to have it included there.</p>\n\n<p>To see an example of platform integration, take a look at <a href=\"https://github.com/couchbase/couchbase-lite-ios/tree/feature/2.0\" rel=\"nofollow noreferrer\">https://github.com/couchbase/couchbase-lite-ios/tree/feature/2.0</a></p>\n"}], "owner": {"reputation": 2368, "user_id": 789655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b7fac771a6c8fccc82fe34f951b7b3fd?s=128&d=identicon&r=PG", "display_name": "Sthe", "link": "https://stackoverflow.com/users/789655/sthe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 450, "favorite_count": 0, "accepted_answer_id": 45902349, "answer_count": 2, "score": 2, "last_activity_date": 1503816156, "creation_date": 1503407227, "question_id": 45818544, "link": "https://stackoverflow.com/questions/45818544/using-couchbase-lite-not-couchbase-server-in-a-golang-application", "title": "Using Couchbase Lite (not Couchbase Server) in a Golang application", "body": "<p>I'm wondering if anyone has ever tried to use Couchbase Lite (not Couchbase Server) in a Golang application. In other words building it into a Golang binary?</p>\n\n<p>I came across this library <a href=\"https://github.com/couchbase/couchbase-lite-core\" rel=\"nofollow noreferrer\">Couchbase Lite Core</a> and through a quick read, it looks like the underlying library for Couchbase Lite (I stand corrected)? What I couldn't find though was how to use it.</p>\n\n<p>Has anyone tried to make this work with something like <code>cgo</code> perhaps? I'm looking to build it statically into the application so it doesn't have dependencies when distributed.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1503406675, "post_id": 45818093, "comment_id": 78594008, "body": "Thanks for confirming the imagined solution will remain just that :) - when you say &quot;stop whatever parts of the application your worried about&quot;, what I have running in the last stages is just a gui (using a dll), i kill that so I am running as cmd line app. but still golang methods of delete, e.g os.Remove(os.Args[0]) wont work so it still leaves me with the ping wait delete solution for the final cleanup - does this strike you as reasonable solution or are you thinking of an alternative"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1503407351, "post_id": 45818093, "comment_id": 78594546, "body": "I don&#39;t have enough context to know if that&#39;s reasonable - if it works, it works, if you&#39;re not happy with it, find a better solution."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 3, "last_activity_date": 1503406018, "creation_date": 1503406018, "answer_id": 45818093, "question_id": 45817962, "link": "https://stackoverflow.com/questions/45817962/possibilities-for-deleting-own-binary/45818093#45818093", "title": "Possibilities for deleting own binary", "body": "<blockquote>\n  <p>launch some kind of in-memory goroutine that can persist beyond the application lifetime without locking the file. - Is this possible?</p>\n</blockquote>\n\n<p>No. The application lifetime is completely binary - either it's running or it isn't. It can't exit yet keep running. You can, through engineering, gracefully stop whatever parts of the application you're worried about before deleting the binary, however. The implementation would be completely dependent on your application but it's certainly feasible. For example, if it's a web server, you could gracefully stop the <code>http.Server</code>, then when that finishes, delete the binary.</p>\n"}], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1506623213, "creation_date": 1503405676, "last_edit_date": 1506623213, "question_id": 45817962, "link": "https://stackoverflow.com/questions/45817962/possibilities-for-deleting-own-binary", "title": "Possibilities for deleting own binary", "body": "<p>The background here is that I have created an installer in golang (cross-platform but initially targeting windows)</p>\n\n<p>I have to run an uninstall process. The last step of this process is to delete my apps binary and another runtime file.</p>\n\n<p>My current approach is windows specific and pretty poor- impossible to get confirmation the process has completed- basically im just calling delete from the command line, using ping to create a delay, something like this:</p>\n\n<pre><code>cmd := exec.Command(\"ping 127.0.0.1\", \"-n\", \"5\", \"&gt;\", \"nul\", \"&amp;&amp;\", \"del\", os.Args[0])\ncmd.Start()\nos.Exit(0)\n</code></pre>\n\n<p>As I say this works but I would prefer to be able to confirm the process has completed before exiting. My imagined solution would be to launch some kind of in-memory goroutine that can persist beyond the application lifetime without locking the file. - Is this possible?</p>\n\n<p>Note - I have also considered creating a second golang app (or a copy of this one) which carries out this deletion from a temp directory (that would at least give me cross-platform) and then let the OS remove that copy but from what I've read windows is not particularly prompt at clearing temp directories so I'm not sure this is ideal either. I would prefer that an install/uninstall cycle leave the machine in the same state it found it</p>\n\n<p>Any other suggestions as to how I may achieve this? Cross platform solution would be a bonus.</p>\n\n<p><strong>Update</strong>\nThe ping and delete solution I suggested did not in fact work as I hoped (at least not for files within system folders). I solved this by creating a second golang app to run the deletion, I spawn this into a temp folder and then create a run_once entry in the registry to delete that file when the user reboots.</p>\n\n<p>I am still not happy with this solution, it feels rather hacky. </p>\n\n<p>I have upvoted Adrian for his clarification but would welcome any suggestions for alternative approaches.</p>\n"}, {"tags": ["go", "blockchain", "hyperledger", "hyperledger-fabric"], "answers": [{"comments": [{"owner": {"reputation": 352, "user_id": 1020747, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GPeLI.jpg?s=128&g=1", "display_name": "Girish007", "link": "https://stackoverflow.com/users/1020747/girish007"}, "edited": false, "score": 0, "creation_date": 1503472385, "post_id": 45826181, "comment_id": 78623057, "body": "Awesome !!..Since I am new to this configuration I missed it and after doing this step out everything is working fine. Big thanks :)"}], "tags": [], "owner": {"reputation": 38497, "user_id": 104014, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3d186f3c6ad2de59b356c1cfad9af404?s=128&d=identicon&r=PG", "display_name": "Artem Barger", "link": "https://stackoverflow.com/users/104014/artem-barger"}, "is_accepted": true, "score": 7, "last_activity_date": 1503432595, "creation_date": 1503432595, "answer_id": 45826181, "question_id": 45817797, "link": "https://stackoverflow.com/questions/45817797/unable-to-find-custom-chaincode-path-hyperledger-fabricv1-0-local-network-runnin/45826181#45826181", "title": "Unable to find custom chaincode path Hyperledger Fabricv1.0 local network running on windows7", "body": "<p>It seems that you do not have your chaincode in the $GOPATH, you need to run:</p>\n\n<pre><code>go get github.com/myuserId/fabrcicV1_chaincodes/mychaincode\n</code></pre>\n\n<p>Before trying to install the chaincode on peer, in your case where you are using <strong>build your first network</strong>, you need to make sure your new chaincode inside <code>fabric-samples/chaincode</code> folder. And also note that you need to mount folder with your chaincode into docker cli container, see example of current <code>docker-compose-cli.yaml</code> file:</p>\n\n<pre><code>volumes:\n    - /var/run/:/host/var/run/\n    - ./../chaincode/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go\n    - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/\n    - ./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/\n    - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts\n</code></pre>\n\n<p>In particular, you probably need to replace here with your chaincode or make sure to mount an additional folder within <code>$GOPATH</code> of cli container:</p>\n\n<pre><code>- ./../chaincode/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go\n</code></pre>\n"}], "owner": {"reputation": 352, "user_id": 1020747, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GPeLI.jpg?s=128&g=1", "display_name": "Girish007", "link": "https://stackoverflow.com/users/1020747/girish007"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4449, "favorite_count": 2, "accepted_answer_id": 45826181, "answer_count": 1, "score": 5, "last_activity_date": 1503432595, "creation_date": 1503405240, "last_edit_date": 1503430926, "question_id": 45817797, "link": "https://stackoverflow.com/questions/45817797/unable-to-find-custom-chaincode-path-hyperledger-fabricv1-0-local-network-runnin", "title": "Unable to find custom chaincode path Hyperledger Fabricv1.0 local network running on windows7", "body": "<p>I am trying to install my custom chain code in my local Hyperledger Fabric v1.0 environment. </p>\n\n<p>For this I have followed the documentation <a href=\"http://hyperledger-fabric.readthedocs.io/en/latest/build_network.html\" rel=\"noreferrer\">build your first network</a> and I am using first network sample with in the <a href=\"https://github.com/hyperledger/fabric-samples\" rel=\"noreferrer\">github</a> project. No it is up and running with <code>./byfn.sh -m up</code> and executing all the scripts for channel creating, chain code installation and instantiation and all by running script.sh file.</p>\n\n<p>Now I have changed the following to tryout my custom chaincode </p>\n\n<pre><code>peer chaincode install -n mycc -v 1.0 -p github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02&gt;&amp;log.txt\n</code></pre>\n\n<p>this I have changed to </p>\n\n<pre><code>peer chaincode install -n mycc -v 1.0 -p github.com/myuserId/fabrcicV1_chaincodes/mychaincode &gt;&amp;log.txt\n</code></pre>\n\n<p>Now by running <code>./byfn.sh -m up</code> getting the exception </p>\n\n<pre><code>2017-08-22 11:01:17.048 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 002 Obtaining default signing identity\n2017-08-22 11:01:17.048 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 003 Using default escc\n2017-08-22 11:01:17.048 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 004 Using default vscc\nError: Error getting chaincode code chaincode: path to chaincode does not exist: github.com/myuserId/fabrcicV1_chaincodes/mychaincode\nUsage:\n  peer chaincode install [flags]\n\nFlags:\n  -c, --ctor string      Constructor message for the chaincode in JSON format (default \"{}\")\n  -l, --lang string      Language the chaincode is written in (default \"golang\")\n  -n, --name string      Name of the chaincode\n  -p, --path string      Path to chaincode\n  -v, --version string   Version of the chaincode specified in install/instantiate/upgrade commands\n\nGlobal Flags:\n      --cafile string              Path to file containing PEM-encoded trusted certificate(s) for the ordering endpoi\n      --logging-level string       Default logging level and overrides, see core.yaml for full syntax\n  -o, --orderer string             Ordering service endpoint\n      --test.coverprofile string   Done (default \"coverage.cov\")\n      --tls                        Use TLS when communicating with the orderer endpoint\n\n!!!!!!!!!!!!!!! Chaincode installation on remote peer PEER0 has Failed !!!!!!!!!!!!!!!!\n========= ERROR !!! FAILED to execute End-2-End Scenario ===========\n</code></pre>\n\n<p>I have the repository there in <a href=\"https://github.com/\" rel=\"noreferrer\">github</a>, then why it is not showing <strong>does not exit</strong>? </p>\n\n<p>I have <em>cloned</em> the same to <strong>Windows 7</strong> machine under the path $GOPATH/src/github.com/ and given local path, then also I am getting the same error. I am running all the commands through docker quick start terminal for <strong>windows 7</strong>.</p>\n\n<p>Please suggest where I am doing wrong.</p>\n\n<p>Also in some of the network log I have found a location <code>/opt/gopath/src/github.com/....</code> and where it is pointing to. In my windows path gopath is <code>/c/users/public/fabricv1</code>. </p>\n\n<p>Since I am not much familiar with the tool, please comment on this also.</p>\n\n<blockquote>\n  <p>After doing some analysis from my side, it seems like the chain code\n  is reading from some pre-mounted directories <strong><em>sacc/, fabcar/, /marble02\n  , chaincode_example_02, hyperledger/</em></strong> under the path\n  <strong><em><code>root@7785f8b27559:/opt/gopath/src/chaincodedev/chaincode#</code></em></strong> and\n  chaincode also pre-loaded at the time of making the network up\n  using docker image. There it seems <strong><em>no effect by adding chaincode in\n  windows folder</em></strong> and it is from the above said virtual machine path.</p>\n  \n  <p>So what can I do now to continue my work? is there any way to install\n  my custom chaincode to the local network. I tried with my githhub path\n  and local path but no use. please somebody help :(</p>\n</blockquote>\n"}, {"tags": ["go", "typeof"], "comments": [{"owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "edited": false, "score": 0, "creation_date": 1503405298, "post_id": 45817640, "comment_id": 78592884, "body": "What is the root type? I&#39;ve never heard such term."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1503405389, "post_id": 45817640, "comment_id": 78592967, "body": "Related / Possible duplicate of <a href=\"https://stackoverflow.com/questions/36310538/identify-non-builtin-types-using-reflect/37292523#37292523\">Identify non builtin-types using reflect</a>."}], "answers": [{"tags": [], "owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "is_accepted": true, "score": 3, "last_activity_date": 1503405405, "creation_date": 1503405405, "answer_id": 45817853, "question_id": 45817640, "link": "https://stackoverflow.com/questions/45817640/find-underlying-type-of-custom-type-in-golang/45817853#45817853", "title": "find underlying type of custom type in golang", "body": "<p>Yes, you can fetch the precise structure of the type, if that's what you mean with \"root type\":</p>\n\n<pre><code>var item M\nt := reflect.TypeOf(item)\nfmt.Println(t.Kind()) // map\nfmt.Println(t.Key())  // string\nfmt.Println(t.Elem()) // interface {}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/BEfWYyJ4Ne\" rel=\"nofollow noreferrer\">test it</a></p>\n\n<p>From there you're free to display it as you want.</p>\n"}, {"tags": [], "owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "is_accepted": false, "score": 1, "last_activity_date": 1503405430, "creation_date": 1503405430, "answer_id": 45817862, "question_id": 45817640, "link": "https://stackoverflow.com/questions/45817640/find-underlying-type-of-custom-type-in-golang/45817862#45817862", "title": "find underlying type of custom type in golang", "body": "<p>I don't think there's an out-of-the-box way, but you can construct the underlying type by hand:</p>\n\n<pre><code>type M map[string]interface{}\n...\nvar m M\nt := reflect.TypeOf(m)\nif t.Kind() == reflect.Map {\n    mapT := reflect.MapOf(t.Key(), t.Elem())\n    fmt.Println(mapT)\n}\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 1254810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/079b4c2397c620136ab055d9412f27d2?s=128&d=identicon&r=PG", "display_name": "ugurozgen", "link": "https://stackoverflow.com/users/1254810/ugurozgen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 948, "favorite_count": 1, "accepted_answer_id": 45817853, "answer_count": 2, "score": 1, "last_activity_date": 1503406310, "creation_date": 1503404816, "last_edit_date": 1503406310, "question_id": 45817640, "link": "https://stackoverflow.com/questions/45817640/find-underlying-type-of-custom-type-in-golang", "title": "find underlying type of custom type in golang", "body": "<pre><code>type M map[string]interface{}\nvar item M\nfmt.Println(reflect.TypeOf(item))\n</code></pre>\n\n<p>returns <code>main.M</code>.</p>\n\n<p>How can I find underlying type of item as <code>map[string]interface{}</code>.</p>\n"}, {"tags": ["go", "ansible"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1503400059, "post_id": 45815938, "comment_id": 78589219, "body": "It sounds like the program invoking Go doesn&#39;t have the proper <code>$PATH</code> configured, or perhaps it ignores the <code>$PATH</code> variable."}, {"owner": {"reputation": 1208, "user_id": 4753991, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5aceabb7606a3797004455b13ceb4f90?s=128&d=identicon&r=PG&f=1", "display_name": "Atul Agrawal", "link": "https://stackoverflow.com/users/4753991/atul-agrawal"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1503400111, "post_id": 45815938, "comment_id": 78589246, "body": "@Flimzy then how my <code>which go</code> and <code>go get </code> command working"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1503400152, "post_id": 45815938, "comment_id": 78589267, "body": "Because you&#39;re not executing <code>which go</code> from within the same program, you&#39;re executing it from your shell, and your shell has the proper PATH."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1503401570, "post_id": 45815938, "comment_id": 78590213, "body": "Why not use the whole path to go in the ansible playbook? Too obvious? Also: Totally unrelated to Go."}, {"owner": {"reputation": 1208, "user_id": 4753991, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5aceabb7606a3797004455b13ceb4f90?s=128&d=identicon&r=PG&f=1", "display_name": "Atul Agrawal", "link": "https://stackoverflow.com/users/4753991/atul-agrawal"}, "edited": false, "score": 0, "creation_date": 1503402002, "post_id": 45815938, "comment_id": 78590498, "body": "I have already tried the same and it is asking me for gopath and gobin as well which i have already setup in my bashrc.and why i need to do that because i have already exported the same in /etc/profile.d/path.sh as per your documentation"}, {"owner": {"reputation": 1208, "user_id": 4753991, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5aceabb7606a3797004455b13ceb4f90?s=128&d=identicon&r=PG&f=1", "display_name": "Atul Agrawal", "link": "https://stackoverflow.com/users/4753991/atul-agrawal"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1503402140, "post_id": 45815938, "comment_id": 78590582, "body": "@Flimzy setup all the environment values and but found a new error.Modified the question according to that"}], "answers": [{"comments": [{"owner": {"reputation": 1208, "user_id": 4753991, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5aceabb7606a3797004455b13ceb4f90?s=128&d=identicon&r=PG&f=1", "display_name": "Atul Agrawal", "link": "https://stackoverflow.com/users/4753991/atul-agrawal"}, "edited": false, "score": 0, "creation_date": 1503481151, "post_id": 45826152, "comment_id": 78629188, "body": "Thanks.But by setting up all the environment values i am able to downlad"}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "reply_to_user": {"reputation": 1208, "user_id": 4753991, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5aceabb7606a3797004455b13ceb4f90?s=128&d=identicon&r=PG&f=1", "display_name": "Atul Agrawal", "link": "https://stackoverflow.com/users/4753991/atul-agrawal"}, "edited": false, "score": 0, "creation_date": 1503481284, "post_id": 45826152, "comment_id": 78629278, "body": "did you run it on the server? what is the output?"}, {"owner": {"reputation": 1208, "user_id": 4753991, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5aceabb7606a3797004455b13ceb4f90?s=128&d=identicon&r=PG&f=1", "display_name": "Atul Agrawal", "link": "https://stackoverflow.com/users/4753991/atul-agrawal"}, "edited": false, "score": 0, "creation_date": 1503688738, "post_id": 45826152, "comment_id": 78735676, "body": "Every thing ran fine when i set environment values explicitly"}], "tags": [], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "is_accepted": true, "score": 3, "last_activity_date": 1503432472, "creation_date": 1503432472, "answer_id": 45826152, "question_id": 45815938, "link": "https://stackoverflow.com/questions/45815938/unable-to-download-golang-repository-by-using-ansible/45826152#45826152", "title": "Unable to download golang repository by using ansible", "body": "<p>Hope this can help you as a start point:</p>\n\n<pre><code>---\n- hosts: all\n  connection: local \n\n  tasks:\n  - name: check go version\n    command: go version\n    register: result\n    changed_when: no\n    ignore_errors: true\n\n  - set_fact:\n      go_path: \"{{ lookup('env', 'GOPATH') | default(ansible_env.HOME+'/go', true) }}\"\n    when: not result|failed\n\n  - name: go get gogs\n    shell: go get -u github.com/gogits/gogs\n    environment:\n      GOPATH: \"{{ go_path }}\"\n    register: gogs\n    when: not result|failed\n\n  - debug: var=gogs\n</code></pre>\n\n<p>Try to run this on your remote server by typing:</p>\n\n<pre><code>ansible-playbook gogs.yml -i localhost,\n</code></pre>\n\n<p>If that works then just later try remotely.</p>\n\n<p>Normally you don't want to do this since you want to execute this remotely over ssh, but since you had tried so far and are getting some errors, probably by trying locally <code>connection: local</code> could help to debug more in details this issue.</p>\n"}, {"tags": [], "owner": {"reputation": 3312, "user_id": 4175960, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/QbvYc.png?s=128&g=1", "display_name": "Eddy Hernandez", "link": "https://stackoverflow.com/users/4175960/eddy-hernandez"}, "is_accepted": false, "score": 0, "last_activity_date": 1595425490, "creation_date": 1595425490, "answer_id": 63035656, "question_id": 45815938, "link": "https://stackoverflow.com/questions/45815938/unable-to-download-golang-repository-by-using-ansible/63035656#63035656", "title": "Unable to download golang repository by using ansible", "body": "<p>I know this post is too old, but maybe this may help someone.</p>\n<p>Ths issue <code>/bin/sh: go: command not found</code> it is because you are missing some configuration when Ansible runs, and probably you need to source the bash profile like this:</p>\n<pre><code>- name: Install gogs\n  shell: &quot;source ~/.bash_profile &amp;&amp; github.com/gogits/gogs&quot;\n  args:\n    chdir: /home/{{ owner }}\n  become_user: '{{ owner }}'\n</code></pre>\n<p>That worked for me.</p>\n"}], "owner": {"reputation": 1208, "user_id": 4753991, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5aceabb7606a3797004455b13ceb4f90?s=128&d=identicon&r=PG&f=1", "display_name": "Atul Agrawal", "link": "https://stackoverflow.com/users/4753991/atul-agrawal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1716, "favorite_count": 0, "accepted_answer_id": 45826152, "answer_count": 2, "score": -2, "last_activity_date": 1595425490, "creation_date": 1503399927, "last_edit_date": 1503402227, "question_id": 45815938, "link": "https://stackoverflow.com/questions/45815938/unable-to-download-golang-repository-by-using-ansible", "title": "Unable to download golang repository by using ansible", "body": "<p>I am trying to download a golang package from github. This is how my playbook looks like</p>\n\n<pre><code>- name: Fetch latest gogs repository\n      shell: \"go get -u github.com/gogits/gogs\"\n      become: true\n      become_user: git\n</code></pre>\n\n<p>It is throwing me following error:</p>\n\n<pre><code>{\n    \"changed\": true, \n    \"cmd\": \"go get -u github.com/gogits/gogs\", \n    \"delta\": \"0:00:00.002695\", \n    \"end\": \"2017-08-22 10:50:02.984669\", \n    \"failed\": true, \n    \"invocation\": {\n        \"module_args\": {\n            \"_raw_params\": \"go get -u github.com/gogits/gogs\", \n            \"_uses_shell\": true, \n            \"chdir\": null, \n            \"creates\": null, \n            \"executable\": null, \n            \"removes\": null, \n            \"warn\": true\n        }\n    }, \n    \"rc\": 127, \n    \"start\": \"2017-08-22 10:50:02.981974\", \n    \"stderr\": \"/bin/sh: go: command not found\", \n    \"stderr_lines\": [\n        \"/bin/sh: go: command not found\"\n    ], \n    \"stdout\": \"\", \n    \"stdout_lines\": []\n}\n</code></pre>\n\n<p>When  I am trying this</p>\n\n<pre><code>- name: Fetch latest gogs repository\n      shell: \"go get -u {{ gogs_repo }}\"\n      environment:\n        - PATH: $PATH:/usr/local/go/bin:/usr/bin\n        - GOPATH: \"{{gogs_home}}/{{ gogs_project_directory }}/src\"\n        - GOBIN:  \"{{gogs_home}}/{{ gogs_project_directory }}/bin\"\n      become: true\n      become_user: git\n</code></pre>\n\n<p>I got this error</p>\n\n<pre><code>fatal: [atul-ec2]: FAILED! =&gt; {\n    \"changed\": false, \n    \"failed\": true, \n    \"module_stderr\": \"Shared connection to ec2-13-126-203-235.ap-south-1.compute.amazonaws.com closed.\\r\\n\", \n    \"module_stdout\": \"Traceback (most recent call last):\\r\\n  File \\\"/tmp/ansible_gntmXa/ansible_module_command.py\\\", line 220, in &lt;module&gt;\\r\\n    main()\\r\\n  File \\\"/tmp/ansible_gntmXa/ansible_module_command.py\\\", line 163, in main\\r\\n    os.chdir(chdir)\\r\\nOSError: [Errno 13] Permission denied: '/home/ec2-user/goprojects/src/src/github.com/gogits/gogs'\\r\\n\", \n    \"msg\": \"MODULE FAILURE\", \n    \"rc\": 1\n}\n</code></pre>\n\n<p>Here my variables are</p>\n\n<pre><code>---\n  go_version: go1.7.linux-amd64.tar.gz\n  go_url: https://storage.googleapis.com/golang/{{ go_version }}\n  go_hash: sha256:702ad90f705365227e902b42d91dd1a40e48ca7f67a2f4b2fd052aaa4295cd95\n  go_project_dir: goprojects\n  go_home: \"{{ ansible_env.HOME }}\"\n  gogs_home: \"/home/git\"\n  gogs_project_directory: \"git.varadev.com\"\n  gogs_repo: github.com/gogits/gogs\n</code></pre>\n\n<p>But when i am using following command on my server</p>\n\n<pre><code>which go\n</code></pre>\n\n<p>I got this</p>\n\n<pre><code>/usr/local/go/bin/go\n</code></pre>\n\n<p>and when I try manually <code>go get -u github.com/gogits/gogs</code>, it is working fine. </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1503400241, "creation_date": 1503400241, "answer_id": 45816022, "question_id": 45814915, "link": "https://stackoverflow.com/questions/45814915/how-to-get-the-data-buffered-in-bufio-writer-in-golang/45816022#45816022", "title": "How to get the data buffered in bufio.Writer in golang", "body": "<p>You'll have to use a custom <code>io.Writer</code> that keeps a copy of all data, so that it can be re-used in case of a retry.</p>\n\n<p>This functionality is not part of the standard library, but shouldn't be hard to implement yourself.</p>\n"}, {"comments": [{"owner": {"reputation": 361, "user_id": 7229120, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/5af5b05b1499d40493fb6ed087bf12b6?s=128&d=identicon&r=PG&f=1", "display_name": "Aaron", "link": "https://stackoverflow.com/users/7229120/aaron"}, "edited": false, "score": 0, "creation_date": 1503411298, "post_id": 45816024, "comment_id": 78597754, "body": "It may succeed in all Write() but fail in the internal Flush(), when I can&#39;t get the data to retry then. And if it has failed on Write() or Flush(), we must use Reset() to make it usable again."}], "tags": [], "owner": {"reputation": 750, "user_id": 1045017, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/0n6PZ.jpg?s=128&g=1", "display_name": "Liam Haworth", "link": "https://stackoverflow.com/users/1045017/liam-haworth"}, "is_accepted": false, "score": 1, "last_activity_date": 1503400250, "creation_date": 1503400250, "answer_id": 45816024, "question_id": 45814915, "link": "https://stackoverflow.com/questions/45814915/how-to-get-the-data-buffered-in-bufio-writer-in-golang/45816024#45816024", "title": "How to get the data buffered in bufio.Writer in golang", "body": "<p>When <code>bufio.Writer</code> fails on a <code>Write(..)</code> it will return the amount of bytes written (<code>n</code>) to the buffer the reason why (<code>err</code>).</p>\n\n<p>What you could do is the following. (<strong>Note</strong> I haven't yet tried this so it may be a little wrong and could use some cleaning up)</p>\n\n<pre><code>func writeSomething(data []byte, w *bufio.Writer) (err error) {\n  var pos, written int = 0\n\n  for pos != len(data) {\n    written, err = w.Write(data[pos:])\n    if err != nil {\n      if err == io.ErrShortWrite {\n        pos += written // Write was shot. Update pos and keep going\n        continue \n      } else netErr, ok := err.(net.Error); ok &amp;&amp; netErr.Temporary() {\n        continue // Temporary error, don't update pos so it will try writing again\n      } else {\n        break // Unrecoverable error, bail\n      }\n    } else {\n      pos += written\n    }\n  }\n\n  return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 361, "user_id": 7229120, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/5af5b05b1499d40493fb6ed087bf12b6?s=128&d=identicon&r=PG&f=1", "display_name": "Aaron", "link": "https://stackoverflow.com/users/7229120/aaron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 714, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1503400250, "creation_date": 1503396917, "question_id": 45814915, "link": "https://stackoverflow.com/questions/45814915/how-to-get-the-data-buffered-in-bufio-writer-in-golang", "title": "How to get the data buffered in bufio.Writer in golang", "body": "<p>When the buffered io writer is used, and some error occur, how can I perform the retry?\nFor example, I've written 4096B using Write() and an error occur when the bufwriter automatically flushes the data. Then I want to retry writing the 4096B, how I can do it?\nIt seems I must keep a 4096B buffer myself to perform the retrying. Othersize I'm not able to get the data failed to be flushed.\nAny suggestions?</p>\n"}, {"tags": ["go", "sharepoint", "sharepoint-2013"], "comments": [{"owner": {"reputation": 457, "user_id": 5109691, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vPeyf.jpg?s=128&g=1", "display_name": "Vaibhav", "link": "https://stackoverflow.com/users/5109691/vaibhav"}, "edited": false, "score": 0, "creation_date": 1503409107, "post_id": 45813695, "comment_id": 78595983, "body": "Can you try &quot;_api&quot; endpoint which is standard way for SP2013?"}, {"owner": {"reputation": 73, "user_id": 8499218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c9eb596194db6f333c1e819615b8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "user8499218", "link": "https://stackoverflow.com/users/8499218/user8499218"}, "reply_to_user": {"reputation": 457, "user_id": 5109691, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vPeyf.jpg?s=128&g=1", "display_name": "Vaibhav", "link": "https://stackoverflow.com/users/5109691/vaibhav"}, "edited": false, "score": 0, "creation_date": 1503409592, "post_id": 45813695, "comment_id": 78596373, "body": "@Vaibhav it needs access token to be sent along with request, go does not have any libraries for sharepoint"}, {"owner": {"reputation": 73, "user_id": 8499218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c9eb596194db6f333c1e819615b8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "user8499218", "link": "https://stackoverflow.com/users/8499218/user8499218"}, "reply_to_user": {"reputation": 457, "user_id": 5109691, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vPeyf.jpg?s=128&g=1", "display_name": "Vaibhav", "link": "https://stackoverflow.com/users/5109691/vaibhav"}, "edited": false, "score": 0, "creation_date": 1503409835, "post_id": 45813695, "comment_id": 78596562, "body": "@Vaibhav I tried to get access token using oauth method but was of no use, can you please suggest exact urls for auth and token"}], "owner": {"reputation": 73, "user_id": 8499218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c9eb596194db6f333c1e819615b8ca0?s=128&d=identicon&r=PG&f=1", "display_name": "user8499218", "link": "https://stackoverflow.com/users/8499218/user8499218"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 374, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1503395535, "creation_date": 1503393816, "last_edit_date": 1503395535, "question_id": 45813695, "link": "https://stackoverflow.com/questions/45813695/403-forbidden-error-for-sharepoint-2013-getlist-api", "title": "403 forbidden error for sharepoint 2013 getlist api", "body": "<p>I am using following post request to get values from sharepoint 2013\n<strong>url: <a href=\"http://abc.xxxxxx.com/_vti_bin/lists.asmx\" rel=\"nofollow noreferrer\">http://abc.xxxxxx.com/_vti_bin/lists.asmx</a></strong></p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>Headers: Content-Type:[text/xml; charset=utf-8]\r\n         SOAPAction: [http://schemas.microsoft.com/sharepoint/soap/GetList]\r\n         Host:     abc.xxxxxx.com</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>now if try using postman api I get success response, but if I use golang API to send same request gives me \"403 Forbidden\": \"403 FORBIDDEN\".\nNot sure why this is happening  </p>\n"}, {"tags": ["go", "deadlock"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 8498815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gSO1Z.jpg?s=128&g=1", "display_name": "Long Pham", "link": "https://stackoverflow.com/users/8498815/long-pham"}, "edited": false, "score": 0, "creation_date": 1503389806, "post_id": 45812276, "comment_id": 78582121, "body": "It makes sense. Thank you so much."}], "tags": [], "owner": {"reputation": 1054, "user_id": 6444852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78e304c11f81effb074bc80f7a5597e3?s=128&d=identicon&r=PG", "display_name": "Constantin S. Pan", "link": "https://stackoverflow.com/users/6444852/constantin-s-pan"}, "is_accepted": true, "score": 6, "last_activity_date": 1503389482, "creation_date": 1503389482, "answer_id": 45812276, "question_id": 45811933, "link": "https://stackoverflow.com/questions/45811933/why-do-i-run-into-a-deadlock-with-this-golang-code/45812276#45812276", "title": "Why do I run into a deadlock with this Golang code?", "body": "<p>As you can see <a href=\"https://golang.org/ref/spec#Logical_operators\" rel=\"noreferrer\">here</a>, the right operand of <code>&amp;&amp;</code> is evaluated conditionally.</p>\n\n<p>This means that <code>result =  result &amp;&amp; &lt;-in</code> will only evaluate <code>&lt;-in</code> if <code>result</code> is true. So, the coodrinator reads only one <code>false</code> from that channel, and skips reading messages from the other workers. If you switch the operands of <code>&amp;&amp;</code> places, then the <code>&lt;-in</code> will evaluate every time and the deadlock goes away.</p>\n"}], "owner": {"reputation": 43, "user_id": 8498815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gSO1Z.jpg?s=128&g=1", "display_name": "Long Pham", "link": "https://stackoverflow.com/users/8498815/long-pham"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 45812276, "answer_count": 1, "score": 4, "last_activity_date": 1503389482, "creation_date": 1503388484, "question_id": 45811933, "link": "https://stackoverflow.com/questions/45811933/why-do-i-run-into-a-deadlock-with-this-golang-code", "title": "Why do I run into a deadlock with this Golang code?", "body": "<p>I am quite new to Golang. I wrote the following code for practice and ran into a run-time error message of a deadlock:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc system(WORKERS int) {\n    fromW := make(chan bool)\n    toW := make(chan bool)\n    for i := 0; i != WORKERS; i++ {\n        go worker(toW, fromW)\n    }\n    coordinator(WORKERS, fromW, toW)\n}\n\nfunc coordinator(WORKERS int, in, out chan bool) {\n    result := true\n    for i := 0; i != WORKERS; i++ {\n        result =  result &amp;&amp; &lt;-in\n    }\n    for i := 0; i != WORKERS; i++ {\n        out &lt;- result\n    }\n    fmt.Println(\"%t\", result)\n}\n\nfunc worker(in, out chan bool) {\n    out &lt;- false\n    &lt;-in\n}\n\nfunc main() {\n    system(2)\n}\n</code></pre>\n\n<p>However, if I swap the operands of &amp;&amp; in line 19 to have </p>\n\n<pre><code>result =  &lt;-in &amp;&amp; result,\n</code></pre>\n\n<p>the code works properly without returning any error messages. How can I explain this behaviour? Am I missing anything here? The OS I use is Windows 10, and the Golang version is 1.8.3. </p>\n\n<p>Thank you very much in advance.</p>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 1452, "user_id": 1502378, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5194b3f8ade37c7ff8ef968db456b8e7?s=128&d=identicon&r=PG", "display_name": "meh", "link": "https://stackoverflow.com/users/1502378/meh"}, "edited": false, "score": 1, "creation_date": 1559168792, "post_id": 45809746, "comment_id": 99341170, "body": "This is more generic thatn <code>go-gorm</code>. <code>go-yaml</code>&#39;s <code>Unmarshal</code> suffers the same issue when you pass it something that&#39;s not properly ampersanded. (Not the technical term, but it is what it is)"}], "answers": [{"comments": [{"owner": {"reputation": 375, "user_id": 1421891, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/a718dd0db1d5aee7fe226027f8e731e8?s=128&d=identicon&r=PG", "display_name": "Krishna Satya", "link": "https://stackoverflow.com/users/1421891/krishna-satya"}, "edited": false, "score": 0, "creation_date": 1503386506, "post_id": 45811129, "comment_id": 78579960, "body": "then i got a nil reference error i solved it by including driver"}, {"owner": {"reputation": 2590, "user_id": 1209451, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/1700220388/picture?type=large", "display_name": "Oleg", "link": "https://stackoverflow.com/users/1209451/oleg"}, "edited": false, "score": 0, "creation_date": 1503389748, "post_id": 45811129, "comment_id": 78582088, "body": "and create users slice before:  users = make([]models.User,0)"}], "tags": [], "owner": {"reputation": 446, "user_id": 8471521, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17220bc1e04ba055af7a275c80e6d31f?s=128&d=identicon&r=PG&f=1", "display_name": "S. Diego", "link": "https://stackoverflow.com/users/8471521/s-diego"}, "is_accepted": false, "score": 31, "last_activity_date": 1503385920, "creation_date": 1503385920, "answer_id": 45811129, "question_id": 45809746, "link": "https://stackoverflow.com/questions/45809746/reflect-value-set-using-unaddressable-value/45811129#45811129", "title": "reflect.Value.Set using unaddressable value", "body": "<p>You have to call Find with a pointer to the slice.</p>\n\n<pre><code>err := db.Find(&amp;users).Error\n</code></pre>\n\n<p>relevant Gorm documentation: <a href=\"http://jinzhu.me/gorm/crud.html#query\" rel=\"noreferrer\">http://jinzhu.me/gorm/crud.html#query</a></p>\n"}, {"tags": [], "owner": {"reputation": 1693, "user_id": 5731861, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iKaMT.png?s=128&g=1", "display_name": "Felipe Valdes", "link": "https://stackoverflow.com/users/5731861/felipe-valdes"}, "is_accepted": false, "score": 15, "last_activity_date": 1525710913, "creation_date": 1525710913, "answer_id": 50218771, "question_id": 45809746, "link": "https://stackoverflow.com/questions/45809746/reflect-value-set-using-unaddressable-value/50218771#50218771", "title": "reflect.Value.Set using unaddressable value", "body": "<p>Just to add clarification to S.Diego answers, changing this:</p>\n\n<pre><code>err := db.Find(users).Error\n</code></pre>\n\n<p>to this:</p>\n\n<pre><code>err := db.Find(&amp;users).Error\n</code></pre>\n\n<p>the error says, the variable users is not addressable, because it is not a pointer.</p>\n"}, {"tags": [], "owner": {"reputation": 3629, "user_id": 1744107, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/91748b7203b0ef849403e8099da4528f?s=128&d=identicon&r=PG", "display_name": "Rambatino", "link": "https://stackoverflow.com/users/1744107/rambatino"}, "is_accepted": false, "score": 5, "last_activity_date": 1533372933, "creation_date": 1533372933, "answer_id": 51684029, "question_id": 45809746, "link": "https://stackoverflow.com/questions/45809746/reflect-value-set-using-unaddressable-value/51684029#51684029", "title": "reflect.Value.Set using unaddressable value", "body": "<p>In a very similar fashion to the accepted answer (but in a slightly different context), and an error that I keep making in different projects:</p>\n\n<pre><code>func migrate(db *gorm.DB) {\n    db.AutoMigrate(User{}, Activity{})\n}\n</code></pre>\n\n<p>becomes</p>\n\n<pre><code>func migrate(db *gorm.DB) {\n    db.AutoMigrate(&amp;User{}, &amp;Activity{})\n}\n</code></pre>\n\n<p>Notice the ampersands.</p>\n"}], "owner": {"reputation": 375, "user_id": 1421891, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/a718dd0db1d5aee7fe226027f8e731e8?s=128&d=identicon&r=PG", "display_name": "Krishna Satya", "link": "https://stackoverflow.com/users/1421891/krishna-satya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 18861, "favorite_count": 4, "answer_count": 3, "score": 17, "last_activity_date": 1533372933, "creation_date": 1503380912, "last_edit_date": 1527757231, "question_id": 45809746, "link": "https://stackoverflow.com/questions/45809746/reflect-value-set-using-unaddressable-value", "title": "reflect.Value.Set using unaddressable value", "body": "<pre><code>g.GET(\"/\", func(c echo.Context) error {\n    var users []models.User\n    err := db.Find(users).Error\n    if err != nil {\n        fmt.Println(err)\n    }\n    return c.JSON(http.StatusOK, users)\n})\n</code></pre>\n\n<p>this is the code for getting and displaying users from table using slice is resulting following error from gorm  </p>\n\n<blockquote>\n  <p>reflect.Value.Set using unaddressable value</p>\n</blockquote>\n"}, {"tags": ["go", "time", "sage-erp"], "answers": [{"comments": [{"owner": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "edited": false, "score": 0, "creation_date": 1503387390, "post_id": 45809232, "comment_id": 78580589, "body": "This looks like a much more elegant solution. <code>fmt.Sprintf(&quot;%s %08s&quot;, date, timeString)</code> would you mind explaining this a little more - I&#39;m just trying to understand this a little more <code>&quot;%s %08s&quot;</code>. I am assuming the <code>%s</code> outputs the date as it is passed in and the <code>%08s</code> outputs the time as it is passed in with leading zeros upto 8 characters in length. Is that correct?"}, {"owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "reply_to_user": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "edited": false, "score": 2, "creation_date": 1503390297, "post_id": 45809232, "comment_id": 78582419, "body": "That is correct. I&#39;ve updated the answer to include more of an explanation. As mentioned, this is useful here because it will result in the correct time length, even if more than one <code>0</code> is needed. The <code>%s</code> and <code>%08s</code> both indicate the values are strings, with <code>%08s</code> indicating to prepend a string with up to 8 zeroes. In this particular instance, <code>&quot;%v %08v&quot;</code> can also be used because <code>%v</code> indicates to use a default value of the argument. <code>%v</code> can be used for any struct but it&#39;s nice to be more specific when you can, <code>%s</code> here."}, {"owner": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "edited": false, "score": 0, "creation_date": 1503393926, "post_id": 45809232, "comment_id": 78584957, "body": "Thanks for the detailed explanation! Very useful. I&#39;m quite new to Go and this is very helpful."}], "tags": [], "owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "is_accepted": true, "score": 4, "last_activity_date": 1503392022, "last_edit_date": 1503392022, "creation_date": 1503378183, "answer_id": 45809232, "question_id": 45808852, "link": "https://stackoverflow.com/questions/45808852/parsing-a-time-with-the-format-hhmmss00/45809232#45809232", "title": "Parsing a time with the format HHMMSS00", "body": "<p>Assuming that you're pulling back 2 separate values from the DB, you can use <code>fmt.Sprintf</code> to <code>0</code> pad <code>timeString</code>. Combining it with the <code>date</code> string, you can use the following:</p>\n\n<pre><code>value := fmt.Sprintf(\"%s %08s\", date, timeString)[:15]\n</code></pre>\n\n<p>In your code:</p>\n\n<pre><code>func main() {\n    date := \"20170228\"\n    timeString := \"5013756\"\n    value := fmt.Sprintf(\"%s %08s\", date, timeString)[:15]\n    layout := \"20060102 150405\"\n\n    t, _ := time.Parse(layout, value)\n    fmt.Println(t)\n}\n</code></pre>\n\n<p>Results:</p>\n\n<pre><code>2017-02-28 05:01:37 +0000 UTC\n</code></pre>\n\n<p>This approach is useful because it will also correctly pad any shorter value of time, e.g. <code>13756</code> will be converted to <code>00013756</code>.</p>\n\n<p>The <code>fmt.Sprintf</code> function is useful to format arguments into a string using the formatting you desire as specified by a format string and a list of arguments (<code>...interface{}</code>). The format string tells the function how to render the arguments.</p>\n\n<p>This format string uses two items of note:</p>\n\n<ul>\n<li>String verb (<code>%s</code>): The format string uses a variety of <code>verbs</code> that are used for string substitutions. <code>%s</code> is specifically to render a string or a slice. Other popular verbs include <code>%d</code> for base 10 integer and <code>%f</code> for float with a complete list in the docs. The <code>%v</code> verb is very useful can also be used here as it will render an argument's default value.</li>\n<li><code>0</code> left padding: To <code>0</code> left pad an argument, use <code>0</code> followed by a length number in the verb after the <code>%</code>. This will prepended the argument with a maximum number of <code>0</code>s specified in the length number. For example, <code>%08s</code> will render a string with up to 8 prepended zeros. This means a string <code>\"\"</code> will be <code>\"00000000\"</code> while a string <code>\"1234567\"</code> will result in <code>\"01234567\"</code>. If the string is longer than the length, nothing will be prepended.</li>\n</ul>\n\n<p>From the documentation:</p>\n\n<pre><code>%s  the uninterpreted bytes of the string or slice\n\n0   pad with leading zeros rather than spaces;\n    for numbers, this moves the padding after the sign\n</code></pre>\n\n<p>More detailed is available in the documentation: <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/fmt/</a></p>\n"}], "owner": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 0, "accepted_answer_id": 45809232, "answer_count": 1, "score": 3, "last_activity_date": 1503423425, "creation_date": 1503375637, "last_edit_date": 1503423425, "question_id": 45808852, "link": "https://stackoverflow.com/questions/45808852/parsing-a-time-with-the-format-hhmmss00", "title": "Parsing a time with the format HHMMSS00", "body": "<p>I'm working with some data from multiple sources and one of these sources is a Sage ERP system.</p>\n\n<p>I am trying to reference two files in Sage in particular, an audit date and audit time (<code>AUDTDATE</code> and <code>AUDTTIME</code>).</p>\n\n<p>I need to parse this and store it as a DATETIME in a Microsoft SQL Server database.</p>\n\n<p>Currently, I am just trying to figure out the best way to parse this.</p>\n\n<p>An example of what the data might look like is below:</p>\n\n<pre><code>+----------+----------+\n| AUDTDATE | AUDTTIME |\n+----------+----------+\n| 20170228 |  5013756 |\n+----------+----------+\n</code></pre>\n\n<p><code>AUDTDATE</code> is a yyyymmdd format and the <code>AUDTTIME</code> is HHMMSS00.</p>\n\n<p>So I tried the below as a test:</p>\n\n<pre><code>func main() {\n    value := \"20170228 5013756\"\n    layout := \"20060102 15040500\"\n\n    t, _ := time.Parse(layout, value)\n    fmt.Println(t)\n}\n</code></pre>\n\n<p>This doesn't work, it just returns <code>0001-01-01 00:00:00 +0000 UTC</code> when run.</p>\n\n<p>If I change the time to this <code>050137</code> and the layout to <code>150405</code> then this works fine:</p>\n\n<pre><code>func main() {\n    value := \"20170228 050137\"\n    layout := \"20060102 150405\"\n\n    t, _ := time.Parse(layout, value)\n    fmt.Println(t)\n}\n</code></pre>\n\n<p>One way that I can think of to deal with this is to strip the milliseconds off from the end and then check the length and add a zero to the beginning if it needs one.</p>\n\n<p>This seems like a pretty ugly solution and would involve doing something like this:</p>\n\n<pre><code>func main() {\n    date := \"20170228\"\n    timeString := \"5013756\"\n    value := date + prepareTime(timeString)\n    layout := \"20060102150405\"\n\n    t, _ := time.Parse(layout, value)\n    fmt.Println(t)\n}\n\nfunc prepareTime(time string) string {\n    if len(time) == 7 {\n        time = \"0\" + time\n    }\n    return time[:6]\n}\n</code></pre>\n\n<p><strong>Is there a way to do this without going through the above? Perhaps natively with the time package?</strong></p>\n"}, {"tags": ["google-chrome", "http", "go", "browser-automation", "chromedp"], "comments": [{"owner": {"reputation": 372, "user_id": 4766268, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/797f841bd5523526aacb8bc7c9c74970?s=128&d=identicon&r=PG&f=1", "display_name": "divyanshch", "link": "https://stackoverflow.com/users/4766268/divyanshch"}, "edited": false, "score": 0, "creation_date": 1520712061, "post_id": 45808799, "comment_id": 85431348, "body": "Hi we&#39;re you able to find a solution for this issue?"}], "answers": [{"comments": [{"owner": {"reputation": 119, "user_id": 4516210, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-d1FS4LKdL5U/AAAAAAAAAAI/AAAAAAAAAA4/WCeKCZgYavM/photo.jpg?sz=128", "display_name": "Francisco Rangel", "link": "https://stackoverflow.com/users/4516210/francisco-rangel"}, "edited": false, "score": 0, "creation_date": 1609367755, "post_id": 56602780, "comment_id": 115827438, "body": "Is there a way to read the response body from listenForNeworkEvent function? like the actual content of the server response, I have a scripts that make a request to an endpoint that returns javascript code but I can&#39;t see the response"}, {"owner": {"reputation": 119, "user_id": 4516210, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-d1FS4LKdL5U/AAAAAAAAAAI/AAAAAAAAAA4/WCeKCZgYavM/photo.jpg?sz=128", "display_name": "Francisco Rangel", "link": "https://stackoverflow.com/users/4516210/francisco-rangel"}, "edited": false, "score": 0, "creation_date": 1609368413, "post_id": 56602780, "comment_id": 115827602, "body": "Nevermind, found it here: <a href=\"https://github.com/chromedp/chromedp/issues/543\" rel=\"nofollow noreferrer\">github.com/chromedp/chromedp/issues/543</a>"}], "tags": [], "owner": {"reputation": 101, "user_id": 3933665, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66f3225696b8c4430b9579793434a7e4?s=128&d=identicon&r=PG&f=1", "display_name": "morpheus0010", "link": "https://stackoverflow.com/users/3933665/morpheus0010"}, "is_accepted": false, "score": 4, "last_activity_date": 1607449565, "last_edit_date": 1607449565, "creation_date": 1560533284, "answer_id": 56602780, "question_id": 45808799, "link": "https://stackoverflow.com/questions/45808799/how-to-get-the-http-response-body-using-chromedp/56602780#56602780", "title": "How to get the HTTP response body using chromedp?", "body": "<p>If you want to get request response, that's how I managed to do it.</p>\n<p>This sample call <a href=\"http://www.google.com\" rel=\"nofollow noreferrer\">http://www.google.com</a> and listen <code>EventResponseReceived</code> to keep Response that contains Headers for example.</p>\n<pre><code>package main\n\nimport (\n    &quot;context&quot;\n    &quot;io/ioutil&quot;\n    &quot;log&quot;\n    &quot;os&quot;\n    &quot;time&quot;\n\n    &quot;github.com/chromedp/cdproto/network&quot;\n    &quot;github.com/chromedp/chromedp&quot;\n)\n\nfunc main() {\n    dir, err := ioutil.TempDir(&quot;&quot;, &quot;chromedp-example&quot;)\n    if err != nil {\n        panic(err)\n    }\n    defer os.RemoveAll(dir)\n\n    opts := append(chromedp.DefaultExecAllocatorOptions[:],\n        chromedp.DisableGPU,\n        chromedp.NoDefaultBrowserCheck,\n        chromedp.Flag(&quot;headless&quot;, false),\n        chromedp.Flag(&quot;ignore-certificate-errors&quot;, true),\n        chromedp.Flag(&quot;window-size&quot;, &quot;50,400&quot;),\n        chromedp.UserDataDir(dir),\n    )\n\n    allocCtx, cancel := chromedp.NewExecAllocator(context.Background(), opts...)\n    defer cancel()\n\n    // also set up a custom logger\n    taskCtx, cancel := chromedp.NewContext(allocCtx, chromedp.WithLogf(log.Printf))\n    defer cancel()\n\n    // create a timeout\n    taskCtx, cancel = context.WithTimeout(taskCtx, 10*time.Second)\n    defer cancel()\n\n    // ensure that the browser process is started\n    if err := chromedp.Run(taskCtx); err != nil {\n        panic(err)\n    }\n\n    // listen network event\n    listenForNetworkEvent(taskCtx)\n\n    chromedp.Run(taskCtx,\n        network.Enable(),\n        chromedp.Navigate(`http://www.google.com`),\n        chromedp.WaitVisible(`body`, chromedp.BySearch),\n    )\n\n}\n\nfunc listenForNetworkEvent(ctx context.Context) {\n    chromedp.ListenTarget(ctx, func(ev interface{}) {\n        switch ev := ev.(type) {\n\n        case *network.EventResponseReceived:\n            resp := ev.Response\n            if len(resp.Headers) != 0 {\n                log.Printf(&quot;received headers: %s&quot;, resp.Headers)\n\n            }\n\n        }\n        // other needed network Event\n    })\n}\n</code></pre>\n"}], "owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3231, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1607449565, "creation_date": 1503375183, "last_edit_date": 1587060063, "question_id": 45808799, "link": "https://stackoverflow.com/questions/45808799/how-to-get-the-http-response-body-using-chromedp", "title": "How to get the HTTP response body using chromedp?", "body": "<p>Using <a href=\"https://github.com/knq/chromedp\" rel=\"nofollow noreferrer\">github.com/knq/chromedp</a>, a <code>go</code> package to drive web browsers using Chrome Debugging Protocol, I can navigate to webpages, update forms and submit forms, but I need to retrieve a HTTP response body and haven't figured out how to yet. I'd like to be able to retrieve the HTTP response body for a JSON response (not HTML).</p>\n\n<p>From looking in the code, it seems the HTTP response body is in the <code>CachedResponse.Body</code> property:</p>\n\n<p><a href=\"https://github.com/knq/chromedp/blob/b9e4c14157325be092c1c1137edbd584648d8c72/cdp/cachestorage/types.go#L30\" rel=\"nofollow noreferrer\">https://github.com/knq/chromedp/blob/b9e4c14157325be092c1c1137edbd584648d8c72/cdp/cachestorage/types.go#L30</a></p>\n\n<p>And that it should be accessible using:</p>\n\n<pre><code>func (p *RequestCachedResponseParams) Do(ctxt context.Context, h cdp.Handler) (response *CachedResponse, err error)\n</code></pre>\n\n<p><a href=\"https://github.com/knq/chromedp/blob/b9e4c14157325be092c1c1137edbd584648d8c72/cdp/cachestorage/cachestorage.go#L168\" rel=\"nofollow noreferrer\">https://github.com/knq/chromedp/blob/b9e4c14157325be092c1c1137edbd584648d8c72/cdp/cachestorage/cachestorage.go#L168</a></p>\n\n<p>The examples use <code>cdp.Tasks</code> such as the following from the simple example.</p>\n\n<pre><code>func googleSearch(q, text string, site, res *string) cdp.Tasks {\n    var buf []byte\n    sel := fmt.Sprintf(`//a[text()[contains(., '%s')]]`, text)\n    return cdp.Tasks{\n        cdp.Navigate(`https://www.google.com`),\n        cdp.Sleep(2 * time.Second),\n        cdp.WaitVisible(`#hplogo`, cdp.ByID),\n        cdp.SendKeys(`#lst-ib`, q+\"\\n\", cdp.ByID),\n        cdp.WaitVisible(`#res`, cdp.ByID),\n        cdp.Text(sel, res),\n        cdp.Click(sel),\n        cdp.Sleep(2 * time.Second),\n        cdp.WaitVisible(`#footer`, cdp.ByQuery),\n        cdp.WaitNotVisible(`div.v-middle &gt; div.la-ball-clip-rotate`, cdp.ByQuery),\n        cdp.Location(site),\n        cdp.Screenshot(`#testimonials`, &amp;buf, cdp.ByID),\n        cdp.ActionFunc(func(context.Context, cdptypes.Handler) error {\n            return ioutil.WriteFile(\"testimonials.png\", buf, 0644)\n        }),\n    }\n}\n</code></pre>\n\n<p><a href=\"https://github.com/knq/chromedp/blob/b9e4c14157325be092c1c1137edbd584648d8c72/examples/simple/main.go\" rel=\"nofollow noreferrer\">https://github.com/knq/chromedp/blob/b9e4c14157325be092c1c1137edbd584648d8c72/examples/simple/main.go</a></p>\n\n<p>It seems like the <code>CachedResponse.Body</code> can be accessed by calling <code>RequestCachedResponseParams.Do()</code> by referencing <code>RequestCachedResponseParams.CacheID</code>, but the following is still needed::</p>\n\n<ol>\n<li>how to call <code>RequestCachedResponseParams.Do()</code> in <code>cdp.Tasks</code> - seems possible using <code>cdp.ActionFunc()</code></li>\n<li>how to get access to <code>RequestCachedResponseParams.CacheID</code></li>\n</ol>\n"}, {"tags": ["go", "cover"], "comments": [{"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 1, "creation_date": 1503374377, "post_id": 45808576, "comment_id": 78575003, "body": "If your objective is to read a file and just get an integer id and increment it, write it back - you should consider writing simpler code (may not need any slice etc.)."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 1, "creation_date": 1503374695, "post_id": 45808576, "comment_id": 78575051, "body": "You can possibly truncate the file and seek to the starting position before writing the new contents."}, {"owner": {"reputation": 75, "user_id": 5737105, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/548030ecabedbc1b6905bdcbb9a1b6b8?s=128&d=identicon&r=PG&f=1", "display_name": "jian.wu", "link": "https://stackoverflow.com/users/5737105/jian-wu"}, "reply_to_user": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1503381371, "post_id": 45808576, "comment_id": 78577168, "body": "@Rave thanks very much, Problem resolved."}], "answers": [{"tags": [], "owner": {"reputation": 789, "user_id": 7641174, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-mT1i-1QabTQ/AAAAAAAAAAI/AAAAAAAAAcU/tMWPD90e4Uw/photo.jpg?sz=128", "display_name": "Mustansir Zia", "link": "https://stackoverflow.com/users/7641174/mustansir-zia"}, "is_accepted": false, "score": 1, "last_activity_date": 1503381425, "creation_date": 1503381425, "answer_id": 45809859, "question_id": 45808576, "link": "https://stackoverflow.com/questions/45808576/golang-file-writestring-cover/45809859#45809859", "title": "golang File WriteString cover", "body": "<p>Without changing much of your code, here is the solution that will work and do what you want to do. No <code>loops</code> or more than a single byte slice.  </p>\n\n<pre><code>func GetID() uint64 {\n\n    appIdLock.Lock()\n    defer appIdLock.Unlock()\n\n    // Added  + os.O_CREATE to create the file if it doesn't exist.\n    f, err := os.OpenFile(idPath, os.O_RDWR + os.O_CREATE, 0666)\n    if err != nil {\n        fmt.Println(err)\n        return 0\n    }\n    defer f.Close()\n\n    // Know file content beforehand so I allocate a suitable bytes slice.\n    fileStat, err := f.Stat()\n    if err != nil {\n        fmt.Println(err)\n        return 0\n    }\n\n\n    buffer := make([]byte, fileStat.Size())\n\n    _, err = f.Read(buffer)\n    if err != nil {\n        fmt.Println(err)\n        return 0\n    }\n\n    s, _ := strconv.ParseUint(string(buffer), 10, 64)\n    s += 1\n\n    // The Magic is here ~ Writes bytes at 0 index of the file.\n    _, err = f.WriteAt([]byte(strconv.FormatUint(s, 10)), 0)\n    if err != nil {\n        fmt.Println(err)\n        return 0\n    }\n\n    return s\n}\n</code></pre>\n\n<p><br />\nHope it helps!</p>\n"}], "owner": {"reputation": 75, "user_id": 5737105, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/548030ecabedbc1b6905bdcbb9a1b6b8?s=128&d=identicon&r=PG&f=1", "display_name": "jian.wu", "link": "https://stackoverflow.com/users/5737105/jian-wu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 621, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1503381425, "creation_date": 1503373422, "question_id": 45808576, "link": "https://stackoverflow.com/questions/45808576/golang-file-writestring-cover", "title": "golang File WriteString cover", "body": "<p>I want get increment id with file, code as below:</p>\n\n<pre><code>// get increment id\nfunc GetID() uint64 {\n\n    appIdLock.Lock()\n    defer appIdLock.Unlock()\n\n    f, err := os.OpenFile(idPath, os.O_RDWR, 0666)\n    if err != nil {\n        return 0\n    }\n    defer f.Close()\n\n    // Read\n    bufferTemp := make([]byte, 16)\n    bufferResult := make([]byte, 0)\n    for {\n        n, _ := f.Read(bufferTemp)\n        if n &gt; 0 {\n            bufferResult = append(bufferResult, bufferTemp[:n]...)\n        } else {\n            break\n        }\n    }\n\n    if len(bufferResult) == 0 {\n        return 0\n    }\n\n    s := common.StringToUint64(string(bufferResult))\n    s += 1\n\n    // Write (how to cover?)\n    f.WriteString(strconv.FormatUint(s, 10))\n\n    return s\n}\n</code></pre>\n\n<p>f.WriteString function was append, example, my file content: 123, run GetID() I hope my file content is: 124, But result was: 123124</p>\n"}, {"tags": ["go", "aws-sdk", "aws-sdk-go"], "answers": [{"comments": [{"owner": {"reputation": 323, "user_id": 6039371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf93ffed843f66eeb081062f5f10de04?s=128&d=identicon&r=PG&f=1", "display_name": "FrontMage", "link": "https://stackoverflow.com/users/6039371/frontmage"}, "edited": false, "score": 0, "creation_date": 1503378525, "post_id": 45808753, "comment_id": 78576091, "body": "This works! But shouldn&#39;t be some warning or errors posted here? I mean docs did not say anything about this...."}, {"owner": {"reputation": 323, "user_id": 6039371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf93ffed843f66eeb081062f5f10de04?s=128&d=identicon&r=PG&f=1", "display_name": "FrontMage", "link": "https://stackoverflow.com/users/6039371/frontmage"}, "edited": false, "score": 0, "creation_date": 1503379418, "post_id": 45808753, "comment_id": 78576389, "body": "I wonder if there is any convenient way to pick values of a struct to another."}, {"owner": {"reputation": 453, "user_id": 280548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/704a932e80905fab4aef95920f20e85e?s=128&d=identicon&r=PG", "display_name": "Jason D.", "link": "https://stackoverflow.com/users/280548/jason-d"}, "reply_to_user": {"reputation": 323, "user_id": 6039371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf93ffed843f66eeb081062f5f10de04?s=128&d=identicon&r=PG&f=1", "display_name": "FrontMage", "link": "https://stackoverflow.com/users/6039371/frontmage"}, "edited": false, "score": 0, "creation_date": 1503960724, "post_id": 45808753, "comment_id": 78815394, "body": "@FrontMage The reason members need to to have their first character uppercased is that no Go library of a different package can access a member, method, type, or value of another package if the first character is not uppercased. You&#39;ll see see the same behavior in all Go marshaling libraries."}, {"owner": {"reputation": 453, "user_id": 280548, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/704a932e80905fab4aef95920f20e85e?s=128&d=identicon&r=PG", "display_name": "Jason D.", "link": "https://stackoverflow.com/users/280548/jason-d"}, "edited": false, "score": 1, "creation_date": 1503960840, "post_id": 45808753, "comment_id": 78815424, "body": "In addition to the uppercase fix, the struct tag should be dynamodbav, not dynamo. I don&#39;t think values will be marshaled like you expect them to be unless dynamodbav is used at the struct tag. <a href=\"http://docs.aws.amazon.com/sdk-for-go/api/service/dynamodb/dynamodbattribute/#Marshal\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/sdk-for-go/api/service/dynamodb/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1847, "user_id": 391464, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1XdRz.png?s=128&g=1", "display_name": "yee", "link": "https://stackoverflow.com/users/391464/yee"}, "is_accepted": true, "score": 3, "last_activity_date": 1503374903, "creation_date": 1503374903, "answer_id": 45808753, "question_id": 45808394, "link": "https://stackoverflow.com/questions/45808394/unmarshalmap-using-aws-go-sdk/45808753#45808753", "title": "UnmarshalMap using aws-go-sdk", "body": "<p>In Go, a name is exported if it begins with a capital letter. You should make first letters of fields UPPERCASED to make sure they're exported, like:</p>\n\n<pre><code>type UserInfo struct {\n    Gender     string            `dynamo:\"gender\"`\n    Product    string            `dynamo:\"product\"`\n    Id         string            `dynamo:\"id\"`\n    CreateTime int               `dynamo:\"create_time\"`\n    Name       string            `dynamo:\"name\"`\n}\n</code></pre>\n\n<p>more info: <a href=\"https://www.goinggo.net/2014/03/exportedunexported-identifiers-in-go.html\" rel=\"nofollow noreferrer\">https://www.goinggo.net/2014/03/exportedunexported-identifiers-in-go.html</a></p>\n"}], "owner": {"reputation": 323, "user_id": 6039371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf93ffed843f66eeb081062f5f10de04?s=128&d=identicon&r=PG&f=1", "display_name": "FrontMage", "link": "https://stackoverflow.com/users/6039371/frontmage"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 495, "favorite_count": 1, "accepted_answer_id": 45808753, "answer_count": 1, "score": 0, "last_activity_date": 1503374903, "creation_date": 1503372072, "last_edit_date": 1503373230, "question_id": 45808394, "link": "https://stackoverflow.com/questions/45808394/unmarshalmap-using-aws-go-sdk", "title": "UnmarshalMap using aws-go-sdk", "body": "<pre><code>// UserInfo \u7528\u6765\u89e3\u6784\u8fd4\u56de\u7684\u6570\u636e\ntype UserInfo struct {\n    gender     string            `dynamo:\"gender\"`\n    product    string            `dynamo:\"product\"`\n    id         string            `dynamo:\"id\"`\n    createTime int               `dynamo:\"create_time\"`\n    name       string            `dynamo:\"name\"`\n}\n\n// GetUserInfoByID \u6839\u636euserId\u5728supe_user\u8868\u53d6\u56de\u7528\u6237\u4fe1\u606f\nfunc GetUserInfoByID(userId string) (UserInfo, error) {\n    queryInput := dynamodb.GetItemInput{\n        Key: map[string]*dynamodb.AttributeValue{\n            \"userId\": {\n                S: aws.String(userId),\n            },\n        },\n        TableName: aws.String(\"user\"),\n    }\n    result, err := dbsession.DynamoDB.GetItem(&amp;queryInput)\n    userInfo := UserInfo{}\n    if err != nil {\n        fmt.Println(err.Error())\n        return userInfo, err\n    }\n    unmarshalMapErr := dynamodbattribute.UnmarshalMap(result.Item, &amp;userInfo)\n    if unmarshalMapErr != nil {\n        return userInfo, err\n    }\n    fmt.Println(result.Item)\n    fmt.Println(userInfo.name)\n    return userInfo, nil\n}\n</code></pre>\n\n<p>Why is this not working? It did not throw any error, just not working...\nMy guess is something wrong with my <code>UserInfo</code> type, but can't figure the right way to do this, help, please.</p>\n"}, {"tags": ["arrays", "go", "struct"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1503363635, "post_id": 45807298, "comment_id": 78572686, "body": "Assigning to an item in an array changes the value; it&#39;s like assigning to a struct field, discussed here: <a href=\"https://stackoverflow.com/questions/32751537/why-do-i-get-a-cannot-assign-error-when-setting-value-to-a-struct-as-a-value-i/32751792#32751792\" title=\"why do i get a cannot assign error when setting value to a struct as a value i\">stackoverflow.com/questions/32751537/&hellip;</a>"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1503363742, "post_id": 45807298, "comment_id": 78572707, "body": "To avoid the error, you either need to change the map value type (to []float64 or *[3]float64, for example) or construct a whole new <code>[3]float</code> to put back in the map (e.g. by explicitly copying the current value to a temp variable, modifying that, and assigning it back)."}, {"owner": {"reputation": 1633, "user_id": 1757417, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1aa37323f7419cdca7d483ff77ae2357?s=128&d=identicon&r=PG", "display_name": "Junchen", "link": "https://stackoverflow.com/users/1757417/junchen"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1503364692, "post_id": 45807298, "comment_id": 78572900, "body": "thank you for pointing me to the right direction!"}], "owner": {"reputation": 1633, "user_id": 1757417, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1aa37323f7419cdca7d483ff77ae2357?s=128&d=identicon&r=PG", "display_name": "Junchen", "link": "https://stackoverflow.com/users/1757417/junchen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 738, "favorite_count": 0, "closed_date": 1503366266, "answer_count": 0, "score": 0, "last_activity_date": 1503363427, "creation_date": 1503362170, "last_edit_date": 1503363427, "question_id": 45807298, "link": "https://stackoverflow.com/questions/45807298/cannot-assign-value-to-an-array-in-a-structure-in-golang", "closed_reason": "Duplicate", "title": "Cannot assign value to an array in a structure in Golang", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    a := make(map[string][3]float64)\n    a[\"test\"] = [3]float64{0.0}\n    a[\"test\"][0] = 1.0\n    fmt.Printf(\"%v\", a[\"test\"])\n}\n</code></pre>\n\n<p>Here is the playground <a href=\"https://play.golang.org/p/UKJj-ggsqG\" rel=\"nofollow noreferrer\">demo</a>, which returns error </p>\n\n<pre><code>tmp/sandbox665292783/main.go:9: cannot assign to a[\"test\"][1]\n</code></pre>\n\n<p>If I print the grammar of a[\"test\"], it returns an array of len 3.</p>\n"}, {"tags": ["postgresql", "go", "beego"], "answers": [{"tags": [], "owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "is_accepted": true, "score": 1, "last_activity_date": 1503383965, "creation_date": 1503383965, "answer_id": 45810521, "question_id": 45807184, "link": "https://stackoverflow.com/questions/45807184/how-to-work-around-no-lastinsertid-available-using-beego-orm/45810521#45810521", "title": "How to work around &#39;no LastInsertId available&#39; using beego/orm", "body": "<p>If the crash is being caused by your <code>log.Fatal(err)</code>, you can avoid this by checking and avoiding it:</p>\n\n<pre><code>_, err := orm.NewOrm().Insert(product)\n\nif err != nil {\n    if err.Error() == \"no LastInsertId available\" {\n        log.Println(err)\n    } else {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1412, "user_id": 5948415, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-EJUvZ5C3BM0/AAAAAAAAAAI/AAAAAAAAF5Q/9lowlgI7x0M/photo.jpg?sz=128", "display_name": "Elvis Chweya", "link": "https://stackoverflow.com/users/5948415/elvis-chweya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 700, "favorite_count": 0, "accepted_answer_id": 45810521, "answer_count": 1, "score": 1, "last_activity_date": 1503383965, "creation_date": 1503361039, "last_edit_date": 1503367339, "question_id": 45807184, "link": "https://stackoverflow.com/questions/45807184/how-to-work-around-no-lastinsertid-available-using-beego-orm", "title": "How to work around &#39;no LastInsertId available&#39; using beego/orm", "body": "<p>I am trying to use <a href=\"https://github.com/astaxie/beego/tree/master/orm\" rel=\"nofollow noreferrer\">https://github.com/astaxie/beego/tree/master/orm</a> to insert a <code>struct</code> into a postgres database. The operation should be simple</p>\n\n<pre><code>import \"github.com/astaxie/beego/orm\"\n\ntype Product struct {\n    ID string `orm:\"pk\"`\n    ...\n}\n\nproduct := &amp;Product{ID: productID}\n_, err := orm.NewOrm().Insert(product)\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>I keep getting this; <code>no LastInsertId available</code> whenever the code runs (the insert is otherwise successful) but I get a crash. \nI understand is it due to postgresql limitations because I use <a href=\"https://www.github.com/lib/pq\" rel=\"nofollow noreferrer\">https://www.github.com/lib/pq</a> driver.</p>\n\n<p>Is there I way to work around this using beego/orm?</p>\n"}, {"tags": ["python", "linux", "azure", "go"], "comments": [{"owner": {"reputation": 1343, "user_id": 3185502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c65699a0d998330d47145a96b2b54b2?s=128&d=identicon&r=PG&f=1", "display_name": "Vasif", "link": "https://stackoverflow.com/users/3185502/vasif"}, "edited": false, "score": 0, "creation_date": 1503354560, "post_id": 45806377, "comment_id": 78570627, "body": "Please format your exception traceback with a coding style wrapping."}], "answers": [{"tags": [], "owner": {"reputation": 20467, "user_id": 4989676, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jP8H6.jpg?s=128&g=1", "display_name": "Peter Pan", "link": "https://stackoverflow.com/users/4989676/peter-pan"}, "is_accepted": true, "score": 0, "last_activity_date": 1503390538, "creation_date": 1503390538, "answer_id": 45812612, "question_id": 45806377, "link": "https://stackoverflow.com/questions/45806377/azure-get-credentials-errors-running-in-golang-program/45812612#45812612", "title": "Azure get-credentials errors running in golang program", "body": "<p>According to your description and the error information <code>SSHException: No existing session</code>, it sounds like you were using <code>os/exec</code> for calling your shell script file,  but failed because command <code>az</code> needs to use something like <code>azureProfile.json</code> at the path <code>.azure</code> within a ssh session.</p>\n\n<p>So I suggested you can try to use the code below with <code>golang.org/x/crypto/ssh</code> package to do it.</p>\n\n<p>Here is my sample code for Linux which I think the same as on MacOS.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"bytes\"\n    \"errors\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"path/filepath\"\n    \"strings\"\n\n    \"golang.org/x/crypto/ssh\"\n)\n\nfunc getHostKey(host string) (ssh.PublicKey, error) {\n    file, err := os.Open(filepath.Join(os.Getenv(\"HOME\"), \".ssh\", \"known_hosts\"))\n    if err != nil {\n        return nil, err\n    }\n    defer file.Close()\n\n    scanner := bufio.NewScanner(file)\n    var hostKey ssh.PublicKey\n    for scanner.Scan() {\n        fields := strings.Split(scanner.Text(), \" \")\n        if len(fields) != 3 {\n            continue\n        }\n        if strings.Contains(fields[0], host) {\n            var err error\n            hostKey, _, _, _, err = ssh.ParseAuthorizedKey(scanner.Bytes())\n            if err != nil {\n                return nil, errors.New(fmt.Sprintf(\"error parsing %q: %v\", fields[2], err))\n            }\n            break\n        }\n    }\n\n    if hostKey == nil {\n        return nil, errors.New(fmt.Sprintf(\"no hostkey for %s\", host))\n    }\n    return hostKey, nil\n}\n\nfunc main() {\n    hostKey, err := getHostKey(\"localhost\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    config := &amp;ssh.ClientConfig{\n        User: \"peter\",\n        Auth: []ssh.AuthMethod{\n            ssh.Password(\"peter ssh password\"),\n        },\n        HostKeyCallback: ssh.FixedHostKey(hostKey),\n    }\n    // Dial your ssh server.\n    conn, err := ssh.Dial(\"tcp\", \"localhost:22\", config)\n    if err != nil {\n        log.Fatal(\"unable to connect: \", err)\n    }\n    defer conn.Close()\n    session, err := conn.NewSession()\n    if err != nil {\n        log.Fatal(\"Failed to create session: \", err)\n    }\n    defer session.Close()\n\n    // Once a Session is created, you can execute a single command on\n    // the remote side using the Run method.\n    var b bytes.Buffer\n    session.Stdout = &amp;b\n    if err := session.Run(\"./test.sh\"); err != nil {\n        log.Fatal(\"Failed to run: \" + err.Error())\n    }\n    fmt.Println(b.String())\n}\n</code></pre>\n\n<p><strong>Notes</strong>: There must be a record like the content below for <code>localhost</code> in your <code>.ssh/known_hosts</code> file. If not, you can first login via ssh to generate it and change the host with <code>localhost</code>.</p>\n\n<blockquote>\n  <p>|localhost|qx8q1geNHGyRFp8Ttu+m2xY4OpU=|noyfrjpDRvtIzP2gzWEV77VZULo= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBKXlyt/EFLnqwlNDimn73+wZVgCh3dhXi2YMWN6tHUj5LMirrUt0AtmQQVHex2b2ur79L5P6/L2J28NID569qAA=</p>\n</blockquote>\n\n<p>Hope it helps.</p>\n"}], "owner": {"reputation": 3, "user_id": 4192119, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-BShHxehWino/AAAAAAAAAAI/AAAAAAAAAFQ/9hmDWNcazwE/photo.jpg?sz=128", "display_name": "Aaron Torgerson", "link": "https://stackoverflow.com/users/4192119/aaron-torgerson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "accepted_answer_id": 45812612, "answer_count": 1, "score": 0, "last_activity_date": 1503390538, "creation_date": 1503354360, "last_edit_date": 1503365439, "question_id": 45806377, "link": "https://stackoverflow.com/questions/45806377/azure-get-credentials-errors-running-in-golang-program", "title": "Azure get-credentials errors running in golang program", "body": "<p>I am trying to azure acs kubernetes credentials with the following script:</p>\n\n<pre><code>#! /bin/sh\naz login --service-principal --username=user -password=password --tenant=tenant\naz acs kubernetes get-credentials --resource-group=rg --name=acs1 --file=/tmp/kubeconfig.json --ssh-key-file=private.key --output=json --debug --verbose\n</code></pre>\n\n<p>Running the script from command line on the mac works ok.  When I try to run a golang program \"cmd := exec.Command(\"/bin/sh\", \"-c\", scriptName)\" that calls the same script on the same computer I get the following error:</p>\n\n<pre><code>No existing session\nTraceback (most recent call last):\n  File \"/Users/aarontorgerson/lib/azure-cli/lib/python2.7/site-packages/azure/cli/main.py\", line 36, in main\n    cmd_result = APPLICATION.execute(args)\n  File \"/Users/aarontorgerson/lib/azure-cli/lib/python2.7/site-packages/azure/cli/core/application.py\", line 211, in execute\n    result = expanded_arg.func(params)\n  File \"/Users/aarontorgerson/lib/azure-cli/lib/python2.7/site-packages/azure/cli/core/commands/__init__.py\", line 351, in __call__\n    return self.handler(*args, **kwargs)\n  File \"/Users/aarontorgerson/lib/azure-cli/lib/python2.7/site-packages/azure/cli/core/commands/__init__.py\", line 555, in _execute_command\n    reraise(*sys.exc_info())\n  File \"/Users/aarontorgerson/lib/azure-cli/lib/python2.7/site-packages/azure/cli/core/commands/__init__.py\", line 532, in _execute_command\n    result = op(client, **kwargs) if client else op(**kwargs)\n  File \"/Users/aarontorgerson/lib/azure-cli/lib/python2.7/site-packages/azure/cli/command_modules/acs/custom.py\", line 785, in k8s_get_credentials\n    _k8s_get_credentials_internal(name, acs_info, path, ssh_key_file)\n  File \"/Users/aarontorgerson/lib/azure-cli/lib/python2.7/site-packages/azure/cli/command_modules/acs/custom.py\", line 806, in _k8s_get_credentials_internal\n    '.kube/config', path_candidate, key_filename=ssh_key_file)\n  File \"/Users/aarontorgerson/lib/azure-cli/lib/python2.7/site-packages/azure/cli/command_modules/acs/acs_client.py\", line 62, in secure_copy\n    ssh.connect(host, username=user, pkey=pkey)\n  File \"/Users/aarontorgerson/lib/azure-cli/lib/python2.7/site-packages/paramiko/client.py\", line 394, in connect\n    look_for_keys, gss_auth, gss_kex, gss_deleg_creds, gss_host)\n  File \"/Users/aarontorgerson/lib/azure-cli/lib/python2.7/site-packages/paramiko/client.py\", line 649, in _auth\n    raise saved_exception\nSSHException: No existing session\n</code></pre>\n\n<p>Any ideas?</p>\n"}, {"tags": ["docker", "go"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 8497144, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-E6HGy1I9t0w/AAAAAAAAAAI/AAAAAAAAAAA/NzqvU2QozzY/photo.jpg?sz=128", "display_name": "Johnsiilver", "link": "https://stackoverflow.com/users/8497144/johnsiilver"}, "edited": false, "score": 0, "creation_date": 1503359862, "post_id": 45806700, "comment_id": 78571777, "body": "Thanks for the help Ricardo.  I think some of the API is easy to follow, some of it isn&#39;t.  For example, the documentation lacks examples (even though they have a guide, it doesn&#39;t go very deep).  Their guide also assumes that I will use environmental variables (NewEnvClient), but I don&#39;t get the luxury.  Your example certainly helps me and now I&#39;ve just got to figure out how to pull images correctly (apparently I&#39;m doing something wrong with ref strings and connecting to the docker hub, but I&#39;ll figure it out).  Thanks!"}, {"owner": {"reputation": 4611, "user_id": 7511971, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Byz18.jpg?s=128&g=1", "display_name": "Ricardo Branco", "link": "https://stackoverflow.com/users/7511971/ricardo-branco"}, "reply_to_user": {"reputation": 21, "user_id": 8497144, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-E6HGy1I9t0w/AAAAAAAAAAI/AAAAAAAAAAA/NzqvU2QozzY/photo.jpg?sz=128", "display_name": "Johnsiilver", "link": "https://stackoverflow.com/users/8497144/johnsiilver"}, "edited": false, "score": 1, "creation_date": 1503360509, "post_id": 45806700, "comment_id": 78571930, "body": "You don&#39;t need environment variables to use the <code>NewEnvClient()</code> method.  This method just checks whether DOCKER_HOST and the TLS variables are set to get the Docker server URL, otherwise it uses the default (in the case of Linux, the Unix domain socket)."}, {"owner": {"reputation": 21, "user_id": 8497144, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-E6HGy1I9t0w/AAAAAAAAAAI/AAAAAAAAAAA/NzqvU2QozzY/photo.jpg?sz=128", "display_name": "Johnsiilver", "link": "https://stackoverflow.com/users/8497144/johnsiilver"}, "edited": false, "score": 0, "creation_date": 1503369085, "post_id": 45806700, "comment_id": 78573859, "body": "Funny enough, I realized after this comment that the host isn&#39;t the registry but the local instance (which makes sense).  Also found a bug, because if I created a NewClient() pointed at the registry and pulled an image, I get no errors either with the client or the image pull, but the image is 0B in size.  Fixed this, but now it doesn&#39;t appear as if it is is pulling the image down (though it makes my mac version of docker eat cpu like mad)."}, {"owner": {"reputation": 4611, "user_id": 7511971, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Byz18.jpg?s=128&g=1", "display_name": "Ricardo Branco", "link": "https://stackoverflow.com/users/7511971/ricardo-branco"}, "reply_to_user": {"reputation": 21, "user_id": 8497144, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-E6HGy1I9t0w/AAAAAAAAAAI/AAAAAAAAAAA/NzqvU2QozzY/photo.jpg?sz=128", "display_name": "Johnsiilver", "link": "https://stackoverflow.com/users/8497144/johnsiilver"}, "edited": false, "score": 0, "creation_date": 1503369392, "post_id": 45806700, "comment_id": 78573920, "body": "Please paste the code you used.  Maybe you&#39;ve found a bug and it would be worthwhile to open an issue in Github."}, {"owner": {"reputation": 21, "user_id": 8497144, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-E6HGy1I9t0w/AAAAAAAAAAI/AAAAAAAAAAA/NzqvU2QozzY/photo.jpg?sz=128", "display_name": "Johnsiilver", "link": "https://stackoverflow.com/users/8497144/johnsiilver"}, "edited": false, "score": 0, "creation_date": 1503370065, "post_id": 45806700, "comment_id": 78574070, "body": "I&#39;ve iterated past that, but I&#39;ll go back and create a regression and paste it here.  Again, thanks for the help Ricardo, you saved me some time."}, {"owner": {"reputation": 4611, "user_id": 7511971, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Byz18.jpg?s=128&g=1", "display_name": "Ricardo Branco", "link": "https://stackoverflow.com/users/7511971/ricardo-branco"}, "reply_to_user": {"reputation": 21, "user_id": 8497144, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-E6HGy1I9t0w/AAAAAAAAAAI/AAAAAAAAAAA/NzqvU2QozzY/photo.jpg?sz=128", "display_name": "Johnsiilver", "link": "https://stackoverflow.com/users/8497144/johnsiilver"}, "edited": false, "score": 0, "creation_date": 1503370864, "post_id": 45806700, "comment_id": 78574257, "body": "I found a bug in my own code in the pulling part.  Check again."}, {"owner": {"reputation": 523, "user_id": 2720351, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b04ca45dfcb035541981c8433a8bf511?s=128&d=identicon&r=PG&f=1", "display_name": "Himanshu97", "link": "https://stackoverflow.com/users/2720351/himanshu97"}, "edited": false, "score": 0, "creation_date": 1554994222, "post_id": 45806700, "comment_id": 97961983, "body": "@RicardoBranco why do you need this line : if _, err := ioutil.ReadAll(out); err != nil {                 panic(err)         }  what is it achieving ?"}], "tags": [], "owner": {"reputation": 4611, "user_id": 7511971, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Byz18.jpg?s=128&g=1", "display_name": "Ricardo Branco", "link": "https://stackoverflow.com/users/7511971/ricardo-branco"}, "is_accepted": false, "score": 3, "last_activity_date": 1503371032, "last_edit_date": 1503371032, "creation_date": 1503356877, "answer_id": 45806700, "question_id": 45805563, "link": "https://stackoverflow.com/questions/45805563/pull-a-file-from-a-docker-image-in-golang-to-local-file-system/45806700#45806700", "title": "Pull a file from a docker image in Golang to local file system", "body": "<p>You must start the container, copy the file and then remove the container... It's not really an expensive operation since the container isn't started anyway.</p>\n\n<p>Here's a working example that copies a file from the specified image to standard output.  The API is straightforward to follow:</p>\n\n<ul>\n<li><a href=\"https://docs.docker.com/engine/api/get-started/\" rel=\"nofollow noreferrer\">https://docs.docker.com/engine/api/get-started/</a></li>\n<li><a href=\"https://godoc.org/github.com/moby/moby/client\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/moby/moby/client</a></li>\n</ul>\n\n<p><a href=\"https://gist.github.com/ricardobranco777/a3be772935dfb1a183e0831496925585\" rel=\"nofollow noreferrer\">https://gist.github.com/ricardobranco777/a3be772935dfb1a183e0831496925585</a></p>\n\n<pre><code>package main\n\nimport (\n        \"archive/tar\"\n        \"fmt\"\n        \"io\"\n        \"io/ioutil\"\n        \"os\"\n\n        \"github.com/docker/docker/api/types\"\n        \"github.com/docker/docker/api/types/container\"\n        \"github.com/docker/docker/client\"\n        \"golang.org/x/net/context\"\n)\n\nfunc main() {\n        if len(os.Args) != 3 {\n                fmt.Fprintf(os.Stderr, \"Usage: %s IMAGE FILE\\n\", os.Args[0])\n                os.Exit(1)\n        }\n        imageName := os.Args[1]\n        filePath := os.Args[2]\n\n        ctx := context.Background()\n        cli, err := client.NewEnvClient()\n        if err != nil {\n                panic(err)\n        }\n\n        out, err := cli.ImagePull(ctx, imageName, types.ImagePullOptions{})\n        if err != nil {\n                panic(err)\n        }\n        defer out.Close()\n        if _, err := ioutil.ReadAll(out); err != nil {\n                panic(err)\n        }\n\n        info, err := cli.ContainerCreate(ctx, &amp;container.Config{\n                Image: imageName,\n        }, nil, nil, \"\")\n        if err != nil {\n                panic(err)\n        }\n\n        tarStream, _, err := cli.CopyFromContainer(ctx, info.ID, filePath)\n        if err != nil {\n                panic(err)\n        }\n        tr := tar.NewReader(tarStream)\n        if _, err := tr.Next(); err != nil {\n                panic(err)\n        }\n\n        io.Copy(os.Stdout, tr)\n\n        if err := cli.ContainerRemove(ctx, info.ID, types.ContainerRemoveOptions{}); err != nil {\n                panic(err)\n        }\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 8497144, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-E6HGy1I9t0w/AAAAAAAAAAI/AAAAAAAAAAA/NzqvU2QozzY/photo.jpg?sz=128", "display_name": "Johnsiilver", "link": "https://stackoverflow.com/users/8497144/johnsiilver"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2232, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1503371032, "creation_date": 1503349830, "question_id": 45805563, "link": "https://stackoverflow.com/questions/45805563/pull-a-file-from-a-docker-image-in-golang-to-local-file-system", "title": "Pull a file from a docker image in Golang to local file system", "body": "<p>I\u2019m trying to figure out how I can use the Go client (<a href=\"http://godoc.org/github.com/moby/moby/client\" rel=\"nofollow noreferrer\">http://godoc.org/github.com/moby/moby/client</a>) to pull a file from a docker image at a specific version (tag)</p>\n\n<p>I want to download the image and then copy a file from the image onto the local file system. I see a lot of commands for dealing with an image, but not how to access its contents. I do see ways to access a container\u2019s contents.</p>\n\n<p>I\u2019m suspecting I would need to download the image, create a container with the image and finally copy the contents out of the container. Though if I could avoid creating a container, that would be preferred.</p>\n\n<p>Does anyone know exactly how to do this? Code snippet would be appreciated.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1503348579, "post_id": 45805279, "comment_id": 78568460, "body": "Because Go code does not support generics, you cannot write a function that is both generic and type-safe. This is why <code>append</code> is implemented as a built-in function not as part of the stdlib."}], "answers": [{"comments": [{"owner": {"reputation": 1088, "user_id": 5078847, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh5.googleusercontent.com/-BCFDhw0E3v4/AAAAAAAAAAI/AAAAAAAADU0/PLEA7C5ay0Y/photo.jpg?sz=128", "display_name": "Ali Khosro", "link": "https://stackoverflow.com/users/5078847/ali-khosro"}, "edited": false, "score": 0, "creation_date": 1503350155, "post_id": 45805420, "comment_id": 78569098, "body": "Thanks. I got it. After years of coding in generic languages (Python, R, JS,..) it is hard to get used to Go. But I like most of its ideas and simplicity."}], "tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": true, "score": 2, "last_activity_date": 1503349125, "creation_date": 1503349125, "answer_id": 45805420, "question_id": 45805279, "link": "https://stackoverflow.com/questions/45805279/how-to-write-append-method-in-go/45805420#45805420", "title": "How to write append &quot;method&quot; in go", "body": "<p>The right way to do this is to call <code>append()</code> as the built-in function it is. It's not an accident that it's a built-in function; you can't write <code>append</code> itself in Go, and anything that approximates it would be unsafe (and over-complicated).</p>\n\n<p>Don't fight Go. Just write the line of code. In the time you spend trying to create tricky generics, you could have solved three more issues and shipped the product. That's how Go works.</p>\n\n<p>This isn't to say Go will never have generics, but as we move towards <a href=\"https://blog.golang.org/toward-go2\" rel=\"nofollow noreferrer\">Go 2</a> consider the following from Russ Cox:</p>\n\n<blockquote>\n  <p>For example, I've been examining generics recently, but I don't have in my mind a clear picture of the detailed, concrete problems that Go users need generics to solve. As a result, I can't answer a design question like whether to support generic methods, which is to say methods that are parameterized separately from the receiver. If we had a large set of real-world use cases, we could begin to answer a question like this by examining the significant ones.</p>\n</blockquote>\n\n<p>(On the other hand, Generics is the most responded-to topic in <a href=\"https://github.com/golang/go/wiki/ExperienceReports#generics\" rel=\"nofollow noreferrer\">ExperienceReports</a>, so it's not that no one is aware of the interest. But don't fight Go. It's a fantastic language for shipping great software. It is not, however, a generic language.)</p>\n"}], "owner": {"reputation": 1088, "user_id": 5078847, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh5.googleusercontent.com/-BCFDhw0E3v4/AAAAAAAAAAI/AAAAAAAADU0/PLEA7C5ay0Y/photo.jpg?sz=128", "display_name": "Ali Khosro", "link": "https://stackoverflow.com/users/5078847/ali-khosro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 45805420, "answer_count": 1, "score": -3, "last_activity_date": 1503349125, "creation_date": 1503348435, "question_id": 45805279, "link": "https://stackoverflow.com/questions/45805279/how-to-write-append-method-in-go", "title": "How to write append &quot;method&quot; in go", "body": "<p>I would like to explore Go possibilities. How would you turn \"append\" to method? simply: \"st.app(t) == append(st, t)\"\nThis is what I got:</p>\n\n<pre><code>type T interface{}\ntype ST []interface{}\nfunc (st []T) app (t T) []T {\n    return(append(st, t))\n}\n</code></pre>\n\n<p>but this code does not check for type compatibility:</p>\n\n<pre><code>append([]int{1,2},\"a\") // correctly gives error \nST{1,2}.app(\"a\") // dumbly gives [1 2 a] !!!\n</code></pre>\n\n<p>I know why the code does not check for type compatibility but What is the right way to do it? Is it possible?\nI appreciate your help to understand how Go works. </p>\n"}, {"tags": ["xml", "go", "xml-parsing"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 4, "last_activity_date": 1503347000, "creation_date": 1503347000, "answer_id": 45804997, "question_id": 45804868, "link": "https://stackoverflow.com/questions/45804868/how-to-get-the-text-from-an-xml-element-in-go-structs-tags/45804997#45804997", "title": "How to get the text from an XML element in go (structs tags)?", "body": "<p>Per the <a href=\"https://golang.org/pkg/encoding/xml/#Unmarshal\" rel=\"nofollow noreferrer\">documentation</a>:</p>\n\n<blockquote>\n  <p>If the XML element contains character data, that data is\n     accumulated in the first struct field that has tag \",chardata\".\n     The struct field may have type []byte or string.\n     If there is no such field, the character data is discarded.</p>\n</blockquote>\n\n<p>So, you can decode it with a struct as such:</p>\n\n<pre><code>type Book struct {\n    Title   string   `xml:\"title\"`\n    Price   string   `xml:\"price\"`\n    Year    string   `xml:\"year\"`\n    Author  string   `xml:\"author\"`\n    Body    string   `xml:\",chardata\"`\n}\n</code></pre>\n\n<p>(Note that fields you're unmarshaling into <strong>must be exported</strong>, i.e., must start with an uppercase letter, or they cannot be unmarshaled into.)</p>\n\n<p>You can see an example here: <a href=\"https://play.golang.org/p/OlwSqnHsT7\" rel=\"nofollow noreferrer\">https://play.golang.org/p/OlwSqnHsT7</a></p>\n"}], "owner": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 752, "favorite_count": 0, "accepted_answer_id": 45804997, "answer_count": 1, "score": 1, "last_activity_date": 1503347000, "creation_date": 1503346423, "question_id": 45804868, "link": "https://stackoverflow.com/questions/45804868/how-to-get-the-text-from-an-xml-element-in-go-structs-tags", "title": "How to get the text from an XML element in go (structs tags)?", "body": "<p>The following XML has an exemple of an element that has nested fields (title, author etc) and a text (Blah Blah...):</p>\n\n<pre><code>    &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n    &lt;book category=\"cooking\"&gt;\n      &lt;title lang=\"en\"&gt;Everyday Italian&lt;/title&gt;\n      &lt;author&gt;Giada De Laurentiis&lt;/author&gt;\n      &lt;year&gt;2005&lt;/year&gt;\n      &lt;price&gt;30.00&lt;/price&gt;\n      Blah Blah Blah Bleh Blah\n    &lt;/book&gt;\n</code></pre>\n\n<p>I've coded this structure to decode this XML but I don't know which structure tag I should use in this case. I search in the docs but i have found nothing.</p>\n\n<pre><code>    type Book struct{\n       t string `xml:\"book&gt;title\"`\n       p string `xml:\"book&gt;price\"`\n       y string `xml:\"book&gt;year\"`\n       a string `xml:\"book&gt;author\"`\n       blah string ???????\n    }\n</code></pre>\n"}, {"tags": ["xml", "go", "xml-parsing"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1503344504, "creation_date": 1503344504, "answer_id": 45804467, "question_id": 45803618, "link": "https://stackoverflow.com/questions/45803618/how-to-decode-flexible-xml-in-go/45804467#45804467", "title": "How to decode flexible xml in GO?", "body": "<p>With unpredictable structures, deserializing into a struct is not going to work. Instead, you'll be better off using the streaming mode of the XML parser using <a href=\"https://golang.org/pkg/encoding/xml/#Decoder.Token\" rel=\"nofollow noreferrer\"><code>xml.Decoder.Token</code></a> to parse elements in order and handle them as necessary.</p>\n\n<pre><code>decoder := xml.NewDecoder(xmlFile) \nsolutions := make([]string,0,0)\n\nfor { \n    t, _ := decoder.Token() \n    if t == nil { \n        break \n    }\n    switch se := t.(type) { \n    case xml.StartElement: \n        if se.Name.Local == \"Paragraph\" {\n            // Get the next token after the Paragraph start element, which will be the tag contents\n            innerText,ok := decoder.Token().(xml.CharData)\n            if !ok {\n                continue\n            }\n            solutions = append(solutions, string(innerText))\n        }\n    }\n}\n</code></pre>\n\n<p>This code is untested but should provide a decent starting point.</p>\n"}], "owner": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 996, "favorite_count": 0, "accepted_answer_id": 45804467, "answer_count": 1, "score": 3, "last_activity_date": 1503344504, "creation_date": 1503340475, "last_edit_date": 1503341434, "question_id": 45803618, "link": "https://stackoverflow.com/questions/45803618/how-to-decode-flexible-xml-in-go", "title": "How to decode flexible xml in GO?", "body": "<p>I have the following xml:</p>\n\n<pre><code>    ...\n    &lt;solution&gt;\n      &lt;ContainerBlockElement&gt;\n        &lt;Paragraph&gt;\n           &lt;Paragraph&gt;\n              Foo\n           &lt;/Paragraph&gt;\n           &lt;Paragraph&gt;\n              bar\n           &lt;/Paragraph&gt;\n       &lt;/Paragraph&gt;\n     &lt;/ContainerBlockElement&gt;\n   &lt;/solution&gt;\n   ...\n</code></pre>\n\n<p>I want to extract the  content but the problem is: The server can send me the second structure:</p>\n\n<pre><code>    ...\n    &lt;solution&gt;\n      &lt;ContainerBlockElement&gt;\n        &lt;Paragraph&gt;\n          baz\n        &lt;/Paragraph&gt;\n      &lt;/ContainerBlockElement&gt;\n    &lt;/solution&gt;\n    ...\n</code></pre>\n\n<p>I've tried to use this struct in go to decode but it doesn't work:</p>\n\n<pre><code>       type Blah struct {\n           ...\n    Solutions           []string     `xml:\"solution&gt;ContainerBlockElement&gt;Paragraph\"`\n    Solutions2Paragraph []string         `xml:\"solution&gt;ContainerBlockElement&gt;Paragraph&gt;Paragraph\"`\n\n}\n</code></pre>\n\n<p>How can I decode this?</p>\n"}, {"tags": ["multithreading", "go", "concurrency"], "comments": [{"owner": {"reputation": 6058, "user_id": 1952500, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/cd15d38fd1e508e6c2bcad9e153e789d?s=128&d=identicon&r=PG", "display_name": "user1952500", "link": "https://stackoverflow.com/users/1952500/user1952500"}, "edited": false, "score": 0, "creation_date": 1503340357, "post_id": 45803373, "comment_id": 78564898, "body": "Why the -1 please?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1503343586, "post_id": 45803373, "comment_id": 78566382, "body": "It&#39;s like asking &quot;Can a <code>if</code> statement fail? E.g. <code>if true { }</code>?&quot; Nothing guarantees that the go routine will run but the go statement itself cannot &quot;fail&quot;."}, {"owner": {"reputation": 6058, "user_id": 1952500, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/cd15d38fd1e508e6c2bcad9e153e789d?s=128&d=identicon&r=PG", "display_name": "user1952500", "link": "https://stackoverflow.com/users/1952500/user1952500"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1503343705, "post_id": 45803373, "comment_id": 78566446, "body": "Thanks @Volker but you see it is subtly different from other languages. Can you tell me if we can figure out that the go routine won&#39;t run? I am worried about the WaitGroup leak in case it doesn&#39;t run."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1503347745, "post_id": 45803373, "comment_id": 78568139, "body": "No you cannot &quot;find out&quot;. If your goroutine does something which blocks endlessly you won&#39;t hit wg.Done. But you won&#39;t &quot;leak&quot;. All you have is a buggy program. But I&#39;m not sure if I understand your problem. If you want your main goroutine to pass wg.Wait you must make sure that your myThread returns in one way or the other."}, {"owner": {"reputation": 6058, "user_id": 1952500, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/cd15d38fd1e508e6c2bcad9e153e789d?s=128&d=identicon&r=PG", "display_name": "user1952500", "link": "https://stackoverflow.com/users/1952500/user1952500"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1503350442, "post_id": 45803373, "comment_id": 78569228, "body": "@Volker the issue is that I do a wg.Add(1) in the main thread after creating the go-routine, and then in the main thread I do a wg.Wait() for all threads to exit. If the routine is not scheduled at all, there will be no decrement (wg.Done()) and hence the main thread will wait indefinitely."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1503379900, "post_id": 45803373, "comment_id": 78576574, "body": "I read your code and I do understand it. But the problem you are constructing is an artificial one, it has nothing to do with goroutines or the go keyword. With <code>go myThread(wg)</code> you start a new goroutine which is something which <i>cannot</i> fail. Of course you can power down your computer during execution of this statement or the process kan be killed or dozens of other things can prevent <i>the</i> <i>whole</i> <i>process</i> to stop but the goroutine start in it self <i>will</i> execute and <i>will</i> <i>not</i> fail. Just like an <code>i++</code> does not &quot;fail&quot;."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1503380178, "post_id": 45803373, "comment_id": 78576681, "body": "Whether the goroutine executes code which actually makes progress and reaches the final wg.Done depends only on your code. E.g. <code>for {}</code> or <code>select{}</code> might block. Again, this is totally unrelated to the goroutine. There are no hard guarantees how much CPU a goroutine might get and of course you can crash/kill the whole program before the goroutine is finished but again: It is not helpful to think about this as a failure to start a goroutine."}], "answers": [{"comments": [{"owner": {"reputation": 6058, "user_id": 1952500, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/cd15d38fd1e508e6c2bcad9e153e789d?s=128&d=identicon&r=PG", "display_name": "user1952500", "link": "https://stackoverflow.com/users/1952500/user1952500"}, "edited": false, "score": 0, "creation_date": 1503340300, "post_id": 45803440, "comment_id": 78564876, "body": "Thanks @Adrian for the info. Is there any documentation to that effect? I find it tough to get to a standard documentation for GoLang."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 6058, "user_id": 1952500, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/cd15d38fd1e508e6c2bcad9e153e789d?s=128&d=identicon&r=PG", "display_name": "user1952500", "link": "https://stackoverflow.com/users/1952500/user1952500"}, "edited": false, "score": 0, "creation_date": 1503340760, "post_id": 45803440, "comment_id": 78565072, "body": "Not sure what you&#39;re looking for exactly for &quot;standard documentation&quot;, the language spec and documentation for all stdlib packages is available on golang.org. A simple web search for &quot;goroutines&quot; turns up a ton of information."}, {"owner": {"reputation": 6058, "user_id": 1952500, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/cd15d38fd1e508e6c2bcad9e153e789d?s=128&d=identicon&r=PG", "display_name": "user1952500", "link": "https://stackoverflow.com/users/1952500/user1952500"}, "edited": false, "score": 0, "creation_date": 1503341587, "post_id": 45803440, "comment_id": 78565474, "body": "Thanks, I could get the spec but it does not mention failure modes as it is equivalent to a function call I suppose. There is a lot of information but no mention of any failure, so I will assume that there is no failure."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 6058, "user_id": 1952500, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/cd15d38fd1e508e6c2bcad9e153e789d?s=128&d=identicon&r=PG", "display_name": "user1952500", "link": "https://stackoverflow.com/users/1952500/user1952500"}, "edited": false, "score": 1, "creation_date": 1503341636, "post_id": 45803440, "comment_id": 78565502, "body": "Correct. There is no failure mode for starting a goroutine."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1503339742, "creation_date": 1503339742, "answer_id": 45803440, "question_id": 45803373, "link": "https://stackoverflow.com/questions/45803373/golang-can-waitgroup-leak-with-go-routines/45803440#45803440", "title": "Golang: can WaitGroup leak with go-routines", "body": "<p>I don't know of any possible way for this to fail, and if it is possible, it would result in a panic (and therefor application crash). I have never seen it happen, and I'm aware of examples of applications running <em>millions</em> of goroutines. The only limiting factor is available memory to allocate the goroutine stack.</p>\n\n<p><code>go foo()</code> is not like <code>pthread_create</code>. Goroutines are lightweight green threads handled by the Go runtime, and scheduled to run on OS threads. Starting a goroutine does not start a new OS thread.</p>\n"}, {"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 0, "last_activity_date": 1503380833, "creation_date": 1503380833, "answer_id": 45809736, "question_id": 45803373, "link": "https://stackoverflow.com/questions/45803373/golang-can-waitgroup-leak-with-go-routines/45809736#45809736", "title": "Golang: can WaitGroup leak with go-routines", "body": "<p>The problem with your code is not in starting a goroutine (which cannot \"fail\" per se) or that like but in the use of <code>sync.WaitGroup</code>. Your code has two <strong>major</strong> <strong>bugs</strong>:</p>\n\n<ol>\n<li><p>You must do <code>wg.Add(1)</code> <em>before</em> launching the goroutine as otherwise the <code>Done()</code> could be executed before the <code>Add(1)</code>.</p></li>\n<li><p>You <em>must</em> <em>not</em> copy a sync.WaitGroup. Your code makes a copy while calling myThread().</p></li>\n</ol>\n\n<p>Both issues are explained in the official documentation to sync.WaitGroup and the given example in <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">https://golang.org/pkg/sync/#WaitGroup</a></p>\n"}], "owner": {"reputation": 6058, "user_id": 1952500, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/cd15d38fd1e508e6c2bcad9e153e789d?s=128&d=identicon&r=PG", "display_name": "user1952500", "link": "https://stackoverflow.com/users/1952500/user1952500"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 521, "favorite_count": 0, "accepted_answer_id": 45803440, "answer_count": 2, "score": -4, "last_activity_date": 1530743192, "creation_date": 1503339442, "last_edit_date": 1530743192, "question_id": 45803373, "link": "https://stackoverflow.com/questions/45803373/golang-can-waitgroup-leak-with-go-routines", "title": "Golang: can WaitGroup leak with go-routines", "body": "<p>I am planning to implement a go-routine and have a <code>sync.WaitGroup</code> to synchronize end of a created go-routine. I create a thread essentially using <code>go &lt;function&gt;</code>. So it is something like:</p>\n\n<pre><code>main() {\n    var wg sync.WaitGroup\n    for &lt;some condition&gt; {\n        go myThread(wg)\n        wg.Add(1)\n    }\n    wg.wait()\n}\n\nmyThread(wg sync.WaitGroup) {\n    defer wg.Done()\n}\n</code></pre>\n\n<p>I have earlier worked with <code>pthread_create</code> which does fail to create a thread under some circumstances. With that context, is it possibly for the above <code>go myThread(wg)</code> to fail to start, and/or run <code>wg.Done()</code> <em>if the rest of the routine behaves correctly</em>? If so, what would be reported and how would the error be caught? My concern is a possible leak in <code>wg</code> due to <code>wg.Add(1)</code> following the thread creation. (Of course it may be possible to use <code>wg.Add(1)</code> within the function, but that leads to other races between the increment and the main program waiting).</p>\n\n<p>I have read through numerous documentation of go-routines and there is no mention of a failure in scheduling or thread creation anywhere. What would be the case if I create billions of threads and exhaust bookkeeping space? Would the go-routine still work and threads still be created?</p>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "edited": false, "score": 0, "creation_date": 1513872164, "post_id": 45802577, "comment_id": 82825661, "body": "Hi, did you find an answer ? I&#39;m facing the same issue here..."}, {"owner": {"reputation": 685, "user_id": 7047363, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3a4cda8321abd1a553445a95258babb?s=128&d=identicon&r=PG&f=1", "display_name": "muthukumar selvaraj", "link": "https://stackoverflow.com/users/7047363/muthukumar-selvaraj"}, "edited": false, "score": 0, "creation_date": 1524074413, "post_id": 45802577, "comment_id": 86828147, "body": "yes it&#39;s possible to remove the child using its maping key value"}, {"owner": {"reputation": 1151, "user_id": 4214922, "user_type": "registered", "accept_rate": 57, "profile_image": "https://graph.facebook.com/100003077452923/picture?type=large", "display_name": "Mike Ottink", "link": "https://stackoverflow.com/users/4214922/mike-ottink"}, "reply_to_user": {"reputation": 685, "user_id": 7047363, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3a4cda8321abd1a553445a95258babb?s=128&d=identicon&r=PG&f=1", "display_name": "muthukumar selvaraj", "link": "https://stackoverflow.com/users/7047363/muthukumar-selvaraj"}, "edited": false, "score": 0, "creation_date": 1610625006, "post_id": 45802577, "comment_id": 116194351, "body": "@muthukumarselvaraj how would you do that? Could you post it as an answer. The current answer only hard deletes instead of soft delete."}], "answers": [{"comments": [{"owner": {"reputation": 1151, "user_id": 4214922, "user_type": "registered", "accept_rate": 57, "profile_image": "https://graph.facebook.com/100003077452923/picture?type=large", "display_name": "Mike Ottink", "link": "https://stackoverflow.com/users/4214922/mike-ottink"}, "edited": false, "score": 0, "creation_date": 1610625234, "post_id": 50785218, "comment_id": 116194469, "body": "This will hard delete the records"}], "tags": [], "owner": {"reputation": 6316, "user_id": 226145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b713823a49df6d9c2f9a24d0728add5?s=128&d=identicon&r=PG", "display_name": "ThanhHH", "link": "https://stackoverflow.com/users/226145/thanhhh"}, "is_accepted": false, "score": 1, "last_activity_date": 1528644483, "creation_date": 1528644483, "answer_id": 50785218, "question_id": 45802577, "link": "https://stackoverflow.com/questions/45802577/golang-gorm-update-associations-on-save/50785218#50785218", "title": "golang gorm update associations on save", "body": "<p>I think you just simply use the physical batch delete like following code:</p>\n\n<pre><code>db.Unscoped().Where(\"parent_id = ?\", p.ID).Delete(Child{})\n</code></pre>\n\n<p>Hope this help.</p>\n"}], "owner": {"reputation": 996, "user_id": 1478734, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e7e6165d9ee3338be3582313ec6648ba?s=128&d=identicon&r=PG", "display_name": "ehrt1974", "link": "https://stackoverflow.com/users/1478734/ehrt1974"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2106, "favorite_count": 2, "answer_count": 1, "score": 7, "last_activity_date": 1528644483, "creation_date": 1503335964, "question_id": 45802577, "link": "https://stackoverflow.com/questions/45802577/golang-gorm-update-associations-on-save", "title": "golang gorm update associations on save", "body": "<p>is there a way to automatically remove associations when an object is saved?</p>\n\n<p>something like this:</p>\n\n<pre><code>type Parent struct {\n    gorm.Model\n    Name string\n    Children []*Child\n}\n\ntype Child struct {\n    gorm.Model\n    Name string\n    ParentID uint\n}\n\nfunc myFunc(db *gorm.DB) {\n    p := &amp;Parent{Name: \"foo\", Children:[]*Child{ {Name:\"Bar\"}, {Name:\"Foobar\"}}}\n    db.Save(&amp;p)\n\n    p.Children = p.Children[1:]\n    db.Save(&amp;p)  // both children still exist in the database. i'd like the first child to be deleted here\n}\n</code></pre>\n\n<p>`</p>\n\n<p>I've found some tricks with db.Model(&amp;Parent).Association(\"Children\").Clear(), but that just sets the ParentID value to NULL, rather than deleting the record. Is there a simple way of doing this?</p>\n\n<p>Many thanks in advance :)</p>\n"}, {"tags": ["http", "go", "error-handling", "bad-request", "media-type"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1503336411, "post_id": 45802492, "comment_id": 78563241, "body": "Are you using a framework of some kind? I&#39;ve never seen this behavior with the stdlib http handler."}, {"owner": {"reputation": 8200, "user_id": 79202, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/397f829eea921e02e35c37c22f9e6d3b?s=128&d=identicon&r=PG", "display_name": "theory", "link": "https://stackoverflow.com/users/79202/theory"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1503345740, "post_id": 45802492, "comment_id": 78567304, "body": "Nope. here&#39;s a <a href=\"https://play.golang.org/p/5iOUCklUeH\" rel=\"nofollow noreferrer\">stupid simple example</a>."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1503337692, "post_id": 45802941, "comment_id": 78563791, "body": "400 and 404 are not the same thing. Please read the question."}], "tags": [], "owner": {"reputation": 1317, "user_id": 7565450, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/qgWFA.jpg?s=128&g=1", "display_name": "Varcorb", "link": "https://stackoverflow.com/users/7565450/varcorb"}, "is_accepted": false, "score": -2, "last_activity_date": 1503337840, "last_edit_date": 1503337840, "creation_date": 1503337605, "answer_id": 45802941, "question_id": 45802492, "link": "https://stackoverflow.com/questions/45802492/how-can-i-customize-http-400-responses-for-parse-errors/45802941#45802941", "title": "How can I customize HTTP 400 responses for parse errors?", "body": "<p>If you are using the standard net/http library you can use the following code. Take a look at this answer <a href=\"https://stackoverflow.com/questions/9996767/showing-custom-404-error-page-with-standard-http-package\">Showing custom 404 error page with standard http package @Mostafa</a> to which I got this example from </p>\n\n<pre><code>func homeHandler(w http.ResponseWriter, r *http.Request) {\n    if r.URL.Path != \"/\" {\n        errorHandler(w, r, http.StatusNotFound)\n        return\n    }\n    fmt.Fprint(w, \"welcome home\")\n}\n\nfunc errorHandler(w http.ResponseWriter, r *http.Request, status int) {\n    w.WriteHeader(status)\n    if status == http.StatusNotFound {\n        // JSON Out here\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 8200, "user_id": 79202, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/397f829eea921e02e35c37c22f9e6d3b?s=128&d=identicon&r=PG", "display_name": "theory", "link": "https://stackoverflow.com/users/79202/theory"}, "edited": false, "score": 0, "creation_date": 1503346067, "post_id": 45802962, "comment_id": 78567413, "body": "I was afraid this would be the answer. Yes, the newline is the error. No, it&#39;s not a huge problem, except that I&#39;ll have to document the API as &quot;always returns JSON unless Go https returns an error before my code ever sees the request&quot;. I appreciate wanting to include a body in the response (though this one is short on details; it took me a while to find the error), but ideally I could control, somehow, the content type and content of all responses. Will comment on the issue, thanks!"}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 6, "last_activity_date": 1503343699, "last_edit_date": 1503343699, "creation_date": 1503337687, "answer_id": 45802962, "question_id": 45802492, "link": "https://stackoverflow.com/questions/45802492/how-can-i-customize-http-400-responses-for-parse-errors/45802962#45802962", "title": "How can I customize HTTP 400 responses for parse errors?", "body": "<p>You can't. You can find this in net/http source, it only happens if the request was malformed:</p>\n\n<p><a href=\"https://github.com/golang/go/blob/master/src/net/http/server.go#L1744\" rel=\"noreferrer\">https://github.com/golang/go/blob/master/src/net/http/server.go#L1744</a></p>\n\n<p>I think your problem might be a new line in the header you're adding in curl?</p>\n\n<p>401, 403, 404, 500 errors you'll be able to respond with json, but bad requests or bad headers (too long, malformed) are handled within server.go. </p>\n\n<p>There is at present no way to intercept such errors though it is under <a href=\"https://github.com/golang/go/issues/18997\" rel=\"noreferrer\">consideration</a>, so your only solution in go would be to patch the stdlib source (I don't recommend this). However, since this error only presents if the client has made a mistake and the request is malformed, it's probably not a huge problem.  The reason for the text response is so that a browser or similar client (like curl without -v) doesn't just see an empty response. You could put a proxy like nginx in front of your app but then you'd never see the request either as it is a bad request, your proxy would handle it. </p>\n\n<p>Possibly you'd be able to do it with a proxy like nginx in front though if you set a specific static error page for it to serve for 400 errors and serve a 400.json file that you specify? That's the only solution I can think of. A directive something like this might work for nginx:</p>\n\n<pre><code>error_page 400 /400.json;\n</code></pre>\n\n<p>If you'd like to be able to customise these errors, perhaps add a comment to the issue linked to let them know you had this specific problem. </p>\n"}], "owner": {"reputation": 8200, "user_id": 79202, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/397f829eea921e02e35c37c22f9e6d3b?s=128&d=identicon&r=PG", "display_name": "theory", "link": "https://stackoverflow.com/users/79202/theory"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4266, "favorite_count": 2, "accepted_answer_id": 45802962, "answer_count": 2, "score": 5, "last_activity_date": 1565191463, "creation_date": 1503335471, "last_edit_date": 1565191463, "question_id": 45802492, "link": "https://stackoverflow.com/questions/45802492/how-can-i-customize-http-400-responses-for-parse-errors", "title": "How can I customize HTTP 400 responses for parse errors?", "body": "<p>I've written a REST API service that requires that all responses be JSON. However, when the Go HTTP request parser encounters an error, it returns 400 as a plain text response without ever calling my handlers. Example:</p>\n\n<pre><code>&gt; curl -i -H 'Authorization: Basic hi    \nthere' 'http://localhost:8080/test' -v\n*   Trying ::1...\n* TCP_NODELAY set\n* Connected to localhost (::1) port 8080 (#0)\n&gt; GET /test HTTP/1.1\n&gt; Host: localhost:8080\n&gt; User-Agent: curl/7.54.0\n&gt; Accept: */*\n&gt; Authorization: Basic hi\n&gt; there\n&gt; \n&lt; HTTP/1.1 400 Bad Request\nHTTP/1.1 400 Bad Request\n&lt; Content-Type: text/plain; charset=utf-8\nContent-Type: text/plain; charset=utf-8\n&lt; Connection: close\nConnection: close\n\n&lt; \n* Closing connection 0\n</code></pre>\n\n<p>Note the invalid Authorization header. Of course 400 is the proper response, but it's text/plain, of course. Is there some way to configure the Go http parser to use custom error response media types and bodies?</p>\n"}, {"tags": ["go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 1509, "user_id": 1093694, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/4hdHu.jpg?s=128&g=1", "display_name": "Lupus", "link": "https://stackoverflow.com/users/1093694/lupus"}, "edited": false, "score": 0, "creation_date": 1503334115, "post_id": 45802094, "comment_id": 78562216, "body": "It&#39;s golang&#39;s build in utf-8 string normalization lib.  <a href=\"https://godoc.org/golang.org/x/text/unicode/norm#Iter\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/text/unicode/norm#Iter</a> TL:DR; it returns <code>[]byte</code>"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 3, "last_activity_date": 1503355244, "last_edit_date": 1503355244, "creation_date": 1503333946, "answer_id": 45802094, "question_id": 45801809, "link": "https://stackoverflow.com/questions/45801809/appending-to-a-slice-in-for-loop-with-unexpected-results/45802094#45802094", "title": "appending to a slice in for loop with unexpected results", "body": "<p>A slice is a struct with a pointer to an underlying array, a length, and a capacity.</p>\n\n<pre><code>type slice struct {\n    array unsafe.Pointer\n    len   int\n    cap   int\n}\n</code></pre>\n\n<p>You are changing the underlying array after you have appended the slice struct. <code>ia.Next()</code> reuses its return buffer.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"golang.org/x/text/unicode/norm\"\n)\n\nfunc Normalizer(s string) (ss [][]byte) {\n    ss = make([][]byte, 0)\n    var ia norm.Iter\n    ia.InitString(norm.NFC, s)\n    for !ia.Done() {\n        next := ia.Next()\n        fmt.Println(string(next), &amp;next[0])\n        ss = append(ss, next)\n    }\n    fmt.Println()\n    for i := range ss {\n        fmt.Println(string(ss[i]), &amp;ss[i][0])\n    }\n    fmt.Println()\n    return\n}\n\nfunc main() {\n    ss := Normalizer(\"abc\")\n    fmt.Printf(\"%s\\n\", ss)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>a 0xc420092228\nb 0xc420092228\nc 0xc420092228\n\nc 0xc420092228\nc 0xc420092228\nc 0xc420092228\n\n[c c c]\n</code></pre>\n\n<p>Replace a copy of a slice struct</p>\n\n<pre><code>next := ia.Next()\n</code></pre>\n\n<p>with a new slice struct with a new underlying array</p>\n\n<pre><code>next := append([]byte(nil), ia.Next()...)\n</code></pre>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"golang.org/x/text/unicode/norm\"\n)\n\nfunc Normalizer(s string) (ss [][]byte) {\n    ss = make([][]byte, 0)\n    var ia norm.Iter\n    ia.InitString(norm.NFC, s)\n    for !ia.Done() {\n        next := append([]byte(nil), ia.Next()...)\n        fmt.Println(string(next), &amp;next[0])\n        ss = append(ss, next)\n    }\n    fmt.Println()\n    for i := range ss {\n        fmt.Println(string(ss[i]), &amp;ss[i][0])\n    }\n    fmt.Println()\n    return\n}\n\nfunc main() {\n    ss := Normalizer(\"abc\")\n    fmt.Printf(\"%s\\n\", ss)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>a 0xc4200120d0\nb 0xc4200120e8\nc 0xc420012108\n\na 0xc4200120d0\nb 0xc4200120e8\nc 0xc420012108\n\n[a b c]\n</code></pre>\n\n<p>References:</p>\n\n<p><a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"nofollow noreferrer\">Slice types</a></p>\n\n<p><a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">Go Slices: usage and internals</a></p>\n\n<p><a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">Arrays, slices (and strings): The mechanics of 'append'</a></p>\n"}], "owner": {"reputation": 1509, "user_id": 1093694, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/4hdHu.jpg?s=128&g=1", "display_name": "Lupus", "link": "https://stackoverflow.com/users/1093694/lupus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3208, "favorite_count": 3, "accepted_answer_id": 45802094, "answer_count": 1, "score": 2, "last_activity_date": 1503355244, "creation_date": 1503332826, "question_id": 45801809, "link": "https://stackoverflow.com/questions/45801809/appending-to-a-slice-in-for-loop-with-unexpected-results", "title": "appending to a slice in for loop with unexpected results", "body": "<p>It could be a silly question but when I try to append a []byte slice to a <code>[][]byte</code> slice I get weird results.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>func Normalizer(s string) (ss [][]byte) {\n\n    ss = make([][]byte, 0)\n    // norm\n    var ia norm.Iter\n\n    ia.InitString(norm.NFC, s)\n\n    for !ia.Done() {\n\n        next := ia.Next()\n\n        fmt.Println(next)\n        // [226 128 139]\n        // [227 128 129]\n        // [39]\n        // [226 128 153]\n        // [46]\n        // [44]\n        // [63]\n        // [33]\n        // [92]\n        // [10]\n        // [226 128 153]\n        // ...\n        ss = append(ss, next)\n\n    }\n    ia.Done()\n\n\n    fmt.Println(ss)\n    return\n}\n</code></pre>\n\n<p>I'm expecting somethin like this:</p>\n\n<pre><code>// [[226 128 139] [227 128 129] [39] [226 128 153] [46] [44] [63] [33] [92] [10] [226 128 153]...] \n</code></pre>\n\n<p>but instead i get this: </p>\n\n<pre><code>// [[226 129 128] [226 129 128] [226] [226 129 128] [226] [226] [226] [226] [226] [226] [226 129 128]...]\n</code></pre>\n\n<p>and I have no idea why. Help and explanation would be appreciated.</p>\n"}, {"tags": ["go", "beego"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1503332646, "post_id": 45801697, "comment_id": 78561477, "body": "The go path in your bash profile is not taking effect as you can see. <code>go env</code> reports a different <code>GOPATH</code> than what is exported in your bash_profile. Given that it&#39;s possible the <code>PATH</code> changes (some of which are duplicated - you add <code>$GOPATH&#47;bin</code> twice) are also not taking effect."}], "answers": [{"comments": [{"owner": {"reputation": 161, "user_id": 8456679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vIl5s.jpg?s=128&g=1", "display_name": "safaer", "link": "https://stackoverflow.com/users/8456679/safaer"}, "edited": false, "score": 0, "creation_date": 1503334954, "post_id": 45801781, "comment_id": 78562618, "body": "I did it at first:)"}], "tags": [], "owner": {"reputation": 21378, "user_id": 3118209, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/3tgaf.jpg?s=128&g=1", "display_name": "Arpit Aggarwal", "link": "https://stackoverflow.com/users/3118209/arpit-aggarwal"}, "is_accepted": false, "score": 3, "last_activity_date": 1503332679, "creation_date": 1503332679, "answer_id": 45801781, "question_id": 45801697, "link": "https://stackoverflow.com/questions/45801697/no-command-bee-found/45801781#45801781", "title": "No command &#39;bee&#39; found", "body": "<p>As <a href=\"https://beego.me/docs/install/bee.md\" rel=\"nofollow noreferrer\"><strong>bee</strong></a> is not available by default in Go, you have to install it first using <code>go get</code> command or copying it manually to <code>$GOPATH/src</code> or <code>$GOPATH</code>, as follows:</p>\n\n<pre><code> go get github.com/beego/bee\n</code></pre>\n"}], "owner": {"reputation": 161, "user_id": 8456679, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vIl5s.jpg?s=128&g=1", "display_name": "safaer", "link": "https://stackoverflow.com/users/8456679/safaer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 821, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1503332679, "creation_date": 1503332319, "question_id": 45801697, "link": "https://stackoverflow.com/questions/45801697/no-command-bee-found", "title": "No command &#39;bee&#39; found", "body": "<p>I am trying to run a project that uses beego framework. When I try to run the project I encounter the following problem every time.</p>\n\n<pre><code>No command 'bee' found, did you mean:\n Command 'bel' from package 'belier' (universe)\n Command 'bbe' from package 'bbe' (universe)\n Command 'pee' from package 'moreutils' (universe)\n Command 'beep' from package 'beep' (universe)\n Command 'ree' from package 'ree' (universe)\n Command 'beet' from package 'beets' (universe)\n Command 'ben' from package 'ben' (universe)\n Command 'beer' from package 'gerstensaft' (universe)\n Command 'be' from package 'bugs-everywhere' (universe)\n Command 'see' from package 'mime-support' (main)\n Command 'tee' from package 'coreutils' (main)\n Command 'btee' from package 'ruby-bcat' (universe)\n Command 'beef' from package 'beef' (universe)\nbee: command not found\n</code></pre>\n\n<p>My Go Environment : ($ go env)</p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/MYNAME/go\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/linux_amd64\"\nGCCGO=\"gccgo\"\nCC=\"gcc\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build235821315=/tmp/go-build -gno-record-gcc-switches\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\nPKG_CONFIG=\"pkg-config\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\n</code></pre>\n\n<p>My Environment declerations in bash_profile : </p>\n\n<pre><code>PATH=\"$HOME/bin:$HOME/.local/bin:$PATH\"\nexport GOPATH=$HOME/work\nexport PATH=$PATH:/usr/local/go/bin:$GOPATH/bin\nexport PATH=\"$GOPATH/bin:$PATH\"'\n</code></pre>\n\n<p>Where am i doing wrong? What should i do?</p>\n"}, {"tags": ["go", "admin", "dashboard"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1503330768, "post_id": 45800136, "comment_id": 78560423, "body": "If you need an admin dashboard, write one."}, {"owner": {"reputation": 4240, "user_id": 2886575, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/mZtIe.jpg?s=128&g=1", "display_name": "Him", "link": "https://stackoverflow.com/users/2886575/him"}, "edited": false, "score": 1, "creation_date": 1503335315, "post_id": 45800136, "comment_id": 78562788, "body": "I think the goal is that Rails&#39; ActiveAdmin is an admin dashboard scaffolding tool that reduces several developer work days to 0 developer work days.  The OP is wondering if such an admin dashboard scaffolding tool exists in golang."}], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 2, "last_activity_date": 1503412190, "last_edit_date": 1503412190, "creation_date": 1503344039, "answer_id": 45804366, "question_id": 45800136, "link": "https://stackoverflow.com/questions/45800136/suggestions-for-admin-dashboard-in-golang/45804366#45804366", "title": "Suggestions for admin dashboard in golang", "body": "<p>I use templates for this and it works well. You can generate the views and potentially the handlers and model with basic admin views for CRUD actions very quickly, which is nice. Obviously for each admin view you're going to want to customise it to some extent but as a starting point it works very well. </p>\n\n<p><a href=\"https://github.com/fragmenta\" rel=\"nofollow noreferrer\">This</a> is the tool I'm using (if you've used rails it should be familiar), you should also be able to knock something together with go generate (for code), a tool like <a href=\"https://github.com/cheekybits/genny\" rel=\"nofollow noreferrer\">genny</a>, or just your own solution using <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\">text/template</a> to output what you need. I've used this approach on a few projects now, I recommend if you find yourself creating dashboards which then need to be customised later. Most apps have a certain amount of boilerplate for each resource (create, update, delete, index).</p>\n"}, {"tags": [], "owner": {"reputation": 790, "user_id": 6061721, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-McuUUypxZX8/AAAAAAAAAAI/AAAAAAAAABk/GgDkjrgVm0k/photo.jpg?sz=128", "display_name": "Libby", "link": "https://stackoverflow.com/users/6061721/libby"}, "is_accepted": false, "score": 3, "last_activity_date": 1503681528, "creation_date": 1503681528, "answer_id": 45886557, "question_id": 45800136, "link": "https://stackoverflow.com/questions/45800136/suggestions-for-admin-dashboard-in-golang/45886557#45886557", "title": "Suggestions for admin dashboard in golang", "body": "<p>I ended up using <a href=\"https://github.com/qor/admin\" rel=\"nofollow noreferrer\">qor/admin</a> to generate the dashboard. It came with views that were already setup. The only code I needed was to tell <code>qor</code> which models I wanted to show. For anyone else trying to implement this in gobuffalo.io, here is how you can <a href=\"https://github.com/gobuffalo/buffalo/issues/602\" rel=\"nofollow noreferrer\">generate the routes</a></p>\n\n<pre><code>func App() *buffalo.App {\n    if app == nil {\n        app = buffalo.Automatic(buffalo.Options{\n            Env:         ENV,\n            SessionName: \"_liam_session\",\n        })\n\n        app.GET(\"/\", HomeHandler)\n        app.ANY(\"/admin/{path:.+}\", buffalo.WrapHandler(http.StripPrefix(\"/admin\", Other())))\n        app.ServeFiles(\"/assets\", packr.NewBox(\"../public/assets\"))\n    }\n    return app\n}\n\nfunc Other() http.Handler {\n    f := func(res http.ResponseWriter, req *http.Request) {\n        fmt.Fprintln(res, req.URL.String())\n        fmt.Fprintln(res, req.Method)\n    }\n    mux := mux.NewRouter()\n    mux.HandleFunc(\"/foo\", f).Methods(\"GET\")\n    mux.HandleFunc(\"/bar\", f).Methods(\"DELETE\")\n    return mux\n}\n</code></pre>\n"}], "owner": {"reputation": 790, "user_id": 6061721, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-McuUUypxZX8/AAAAAAAAAAI/AAAAAAAAABk/GgDkjrgVm0k/photo.jpg?sz=128", "display_name": "Libby", "link": "https://stackoverflow.com/users/6061721/libby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5139, "favorite_count": 2, "closed_date": 1504255994, "accepted_answer_id": 45804366, "answer_count": 2, "score": 4, "last_activity_date": 1503681528, "creation_date": 1503327051, "question_id": 45800136, "link": "https://stackoverflow.com/questions/45800136/suggestions-for-admin-dashboard-in-golang", "closed_reason": "Not suitable for this site", "title": "Suggestions for admin dashboard in golang", "body": "<p>I am using a <a href=\"https://github.com/gobuffalo/buffalo\" rel=\"nofollow noreferrer\">gobuffalo</a> framework to create a website with a postgres database, and I am trying to find a good admin dashboard to accompany it. Something like Rail's <a href=\"https://activeadmin.info/\" rel=\"nofollow noreferrer\">ActiveAdmin</a> would be awesome. Does anyone have any suggestions?</p>\n"}, {"tags": ["go", "blockchain", "hyperledger", "hyperledger-fabric"], "comments": [{"owner": {"reputation": 1451, "user_id": 7935726, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0e9e807f6bbe7c490660440eabb285c?s=128&d=identicon&r=PG", "display_name": "Urko", "link": "https://stackoverflow.com/users/7935726/urko"}, "edited": false, "score": 0, "creation_date": 1503501822, "post_id": 45798668, "comment_id": 78645325, "body": "I don&#39;t know how it works, but I achived it without numbers. Also, could you try to put &quot;Owner1&quot; instead of &quot;owner1&quot;, i.e. with the O in capital letters"}, {"owner": {"reputation": 352, "user_id": 1020747, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GPeLI.jpg?s=128&g=1", "display_name": "Girish007", "link": "https://stackoverflow.com/users/1020747/girish007"}, "reply_to_user": {"reputation": 1451, "user_id": 7935726, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0e9e807f6bbe7c490660440eabb285c?s=128&d=identicon&r=PG", "display_name": "Urko", "link": "https://stackoverflow.com/users/7935726/urko"}, "edited": false, "score": 0, "creation_date": 1503512086, "post_id": 45798668, "comment_id": 78651585, "body": "Sorry, I didn&#39;t get you. What you have achieved without numbers? Any why to make &#39;O&#39; capital?"}, {"owner": {"reputation": 1451, "user_id": 7935726, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0e9e807f6bbe7c490660440eabb285c?s=128&d=identicon&r=PG", "display_name": "Urko", "link": "https://stackoverflow.com/users/7935726/urko"}, "edited": false, "score": 0, "creation_date": 1503644618, "post_id": 45798668, "comment_id": 78710307, "body": "Hi! The method stub.GetStateByRange(startKey,endKey) functioned great for me. The keys for me where numbers combined with letters, like c999, o111. On the other hand, I asked you if you could try to pass the values of owner with the O in capital letters. In the example that you give, you pass the owner is in lowercase. Also, could you try if it works passing two literals (for example: stub.GetStateByPartialCompositeKey(&#39;Owner1~2017_05_11&#39;, &#39;Owner1~2017_05_30&#39;))? What do you get like response?"}, {"owner": {"reputation": 352, "user_id": 1020747, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GPeLI.jpg?s=128&g=1", "display_name": "Girish007", "link": "https://stackoverflow.com/users/1020747/girish007"}, "reply_to_user": {"reputation": 1451, "user_id": 7935726, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0e9e807f6bbe7c490660440eabb285c?s=128&d=identicon&r=PG", "display_name": "Urko", "link": "https://stackoverflow.com/users/7935726/urko"}, "edited": false, "score": 0, "creation_date": 1503645134, "post_id": 45798668, "comment_id": 78710552, "body": "Ya that small &#39;o&#39; was a typo. Corrected now. And for stub.GetStateByPartialCompositeKey in API documentations it is mentioned that the first param should be a key_index not the value. So can&#39;t try this way I think. And regarding  stub.GetStateByRange, yes that is possible if it is in lexical order. But my data fetch is timestamp based so I cant give a perfect start and end key. Only number I am getting in this is timestamp, if I use it as key like Owner_longTimestamp, then stub.GetStateByRange will be a huge performance hit right?"}, {"owner": {"reputation": 1451, "user_id": 7935726, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0e9e807f6bbe7c490660440eabb285c?s=128&d=identicon&r=PG", "display_name": "Urko", "link": "https://stackoverflow.com/users/7935726/urko"}, "edited": false, "score": 0, "creation_date": 1503645415, "post_id": 45798668, "comment_id": 78710697, "body": "I think that the key_index and a value are the same. You have to define two different key_index, and it gets the result that there are among them. I&#39;m sorry if I&#39;m not understanding you. Could you explain again wich is your issue?"}, {"owner": {"reputation": 352, "user_id": 1020747, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GPeLI.jpg?s=128&g=1", "display_name": "Girish007", "link": "https://stackoverflow.com/users/1020747/girish007"}, "reply_to_user": {"reputation": 1451, "user_id": 7935726, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0e9e807f6bbe7c490660440eabb285c?s=128&d=identicon&r=PG", "display_name": "Urko", "link": "https://stackoverflow.com/users/7935726/urko"}, "edited": false, "score": 0, "creation_date": 1503645763, "post_id": 45798668, "comment_id": 78710840, "body": "no problems :) appreciating your suggestions and it is helpful to me since I am new to this. My requirement is like as shown in the example, I am creating assets everyday, and if I want to list the all assets created with in a date range how I will query it from ledger? For this I am really confused to design a perfect key. Thats my issue."}], "answers": [{"comments": [{"owner": {"reputation": 352, "user_id": 1020747, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GPeLI.jpg?s=128&g=1", "display_name": "Girish007", "link": "https://stackoverflow.com/users/1020747/girish007"}, "edited": false, "score": 0, "creation_date": 1503647874, "post_id": 45876557, "comment_id": 78711977, "body": "Yes. This is a good approach. So in my case to use stub.GetStateByRange(&quot;c0&quot;, &quot;c9999999999999999999&quot;), i need to create key like Owner1_&lt;long_timstamp&gt; right? Example to fetch data for 11-05-2017 00:00:00 to 10-06-2017 23:59:59 I need to use like stub.GetStateByRange(&quot;Owner1_&lt;long timestamp of (first_date)&gt;&quot;, &quot;Owner1_&lt;long timestamp of (second_date)&gt;&quot;). Am I right?"}, {"owner": {"reputation": 1451, "user_id": 7935726, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0e9e807f6bbe7c490660440eabb285c?s=128&d=identicon&r=PG", "display_name": "Urko", "link": "https://stackoverflow.com/users/7935726/urko"}, "reply_to_user": {"reputation": 352, "user_id": 1020747, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GPeLI.jpg?s=128&g=1", "display_name": "Girish007", "link": "https://stackoverflow.com/users/1020747/girish007"}, "edited": false, "score": 0, "creation_date": 1503648112, "post_id": 45876557, "comment_id": 78712102, "body": "Yeah. Probably, it will work only passing the date but not the time, but I don&#39;t know. You would try it. Good luck."}, {"owner": {"reputation": 352, "user_id": 1020747, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GPeLI.jpg?s=128&g=1", "display_name": "Girish007", "link": "https://stackoverflow.com/users/1020747/girish007"}, "edited": false, "score": 0, "creation_date": 1503648203, "post_id": 45876557, "comment_id": 78712162, "body": "One more doubt is stub.GetStateByRange(&quot;c0&quot;, &quot;c9999999999999999999&quot;) how it is working internally. There will be any performance hit if range or number of data increases?"}], "tags": [], "owner": {"reputation": 1451, "user_id": 7935726, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0e9e807f6bbe7c490660440eabb285c?s=128&d=identicon&r=PG", "display_name": "Urko", "link": "https://stackoverflow.com/users/7935726/urko"}, "is_accepted": false, "score": 1, "last_activity_date": 1503646918, "creation_date": 1503646918, "answer_id": 45876557, "question_id": 45798668, "link": "https://stackoverflow.com/questions/45798668/composite-key-formation-for-a-date-range-in-hyperledger-fabric-v1-0/45876557#45876557", "title": "Composite Key formation for a date range in Hyperledger Fabric V1.0", "body": "<p>After rereading your question and the comments, I think that you have your own solution for you. What about using the function GetStateByRange? This function doesn't return keys, it returns an iterator with the values.</p>\n\n<p>As you said in your last comment, I want to list the all assets created with in a date range how I will query it from ledger. So, if I were you, I'd use the GetStateByRange function, passing to it the date range.</p>\n\n<p>Here I paste you an example of a function that I used.</p>\n\n<pre><code>func get_all_components(stub shim.ChaincodeStubInterface, args []string) pb.Response {\n    var err error\n    fmt.Println(\"starting get_all_components\")\n\n    // input sanitation\n    err = sanitize_arguments_len(args, 1)\n    if err != nil {\n        return shim.Error(err.Error())\n    }\n\n    // ---- Get All Components ---- //\n    resultsIterator, err := stub.GetStateByRange(\"c0\", \"c9999999999999999999\")\n    if err != nil {\n        return shim.Error(err.Error())\n    }\n    defer resultsIterator.Close()\n\n    // buffer is a JSON array containing QueryRecords\n    var buffer bytes.Buffer\n    buffer.WriteString(\"[\")\n\n    bArrayMemberAlreadyWritten := false\n    for resultsIterator.HasNext() {\n        //queryKeyAsStr, queryValAsBytes, err := resultsIterator.Next()\n        queryResponse, err := resultsIterator.Next()\n        if err != nil {\n            return shim.Error(err.Error())\n        }\n\n        // Add a comma before array members, suppress it for the first array member\n        if bArrayMemberAlreadyWritten == true {\n            buffer.WriteString(\",\")\n        }\n        buffer.WriteString(\"{\\\"Key\\\":\")\n        buffer.WriteString(\"\\\"\")\n        buffer.WriteString(queryResponse.Key)\n        buffer.WriteString(\"\\\"\")\n\n        buffer.WriteString(\", \\\"Record\\\":\")\n        // Record is a JSON object, so we write as-is\n        buffer.WriteString(string(queryResponse.Value))\n        buffer.WriteString(\"}\")\n        bArrayMemberAlreadyWritten = true\n    }\n    buffer.WriteString(\"]\")\n\n    fmt.Printf(\"get_all_components:\\n%s\\n\", buffer.String())\n\n    return shim.Success(buffer.Bytes())\n}\n</code></pre>\n\n<p>You should pass your <strong><code>date range</code></strong> values in the function call, in the args.</p>\n"}, {"tags": [], "owner": {"reputation": 352, "user_id": 1020747, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GPeLI.jpg?s=128&g=1", "display_name": "Girish007", "link": "https://stackoverflow.com/users/1020747/girish007"}, "is_accepted": true, "score": 0, "last_activity_date": 1508139605, "last_edit_date": 1508139605, "creation_date": 1507537808, "answer_id": 46641942, "question_id": 45798668, "link": "https://stackoverflow.com/questions/45798668/composite-key-formation-for-a-date-range-in-hyperledger-fabric-v1-0/46641942#46641942", "title": "Composite Key formation for a date range in Hyperledger Fabric V1.0", "body": "<p>As with the existing comments, adopted solutions and API specification, it is concluded that <code>stub.GetStateByPartialCompositeKey</code> is best suited API for this requirement. \n<br/>To fetch data only for a day, it can use <strong><em>rich query</em></strong> with json <code>date_field:value</code> also if it is using <strong>CouchDB</strong> as its state db. Since it is not a committing transcation no issue to use <strong><em>rich query</em></strong> here.</p>\n"}], "owner": {"reputation": 352, "user_id": 1020747, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GPeLI.jpg?s=128&g=1", "display_name": "Girish007", "link": "https://stackoverflow.com/users/1020747/girish007"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1231, "favorite_count": 2, "accepted_answer_id": 46641942, "answer_count": 2, "score": 0, "last_activity_date": 1508139605, "creation_date": 1503322941, "last_edit_date": 1503644787, "question_id": 45798668, "link": "https://stackoverflow.com/questions/45798668/composite-key-formation-for-a-date-range-in-hyperledger-fabric-v1-0", "title": "Composite Key formation for a date range in Hyperledger Fabric V1.0", "body": "<p>With reference to <a href=\"https://stackoverflow.com/questions/44918611/composite-key-functions-in-hyperledger\">this</a> question, I also have a doubt.\n<br/> Suppose my composite key is formed with the fields <code>Owner_id~dateOfcreation</code>\nand my keys are like:</p>\n\n<blockquote>\n  <ul>\n  <li>Owner1~11-05-2017</li>\n  <li>Owner1~12-05-2017</li>\n  <li>Owner1~13-05-2017</li>\n  <li>...</li>\n  <li>...</li>\n  <li>Owner1~30-05-2017</li>\n  </ul>\n</blockquote>\n\n<p>Will it be possible for me to get states for a <strong><code>date range</code></strong> for example <code>Owner1~12-05-2017 to Owner~27-05-2017</code>?</p>\n\n<p>In my understanding <code>stub.GetStateByRange(startKey,endKey)</code> will return the keys which are in lexical order, so it will not return the expected range.\nCorrect me if I am wrong.</p>\n\n<p>I tried to re-arrange the keys like:</p>\n\n<blockquote>\n  <ul>\n  <li>Owner1~2017_05_11</li>\n  <li>Owner1~2017_05_12</li>\n  <li>Owner1~2017_05_13</li>\n  <li>...</li>\n  <li>...</li>\n  <li>Owner1~2017_05_30</li>\n  </ul>\n</blockquote>\n\n<p>In this case if i use\n <br/><code>stub.GetStateByPartialCompositeKey('owner~year~month~day',[]string{\"owner1\",\"2017\",\"05\"})</code> it will return all the keys starting with these range. is it correct?</p>\n\n<p>But here also I am not getting my exact output for a <strong><code>date range</code></strong>.</p>\n\n<p>Can anyone suggest me the proper way to implement this. I think it is a common business scenario in the context of asset sharing, so please help.</p>\n\n<p>Thanks in advance :)</p>\n"}, {"tags": ["testing", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1503320782, "post_id": 45797858, "comment_id": 78553413, "body": "There is no answer to this question (it&#39;s highly opinion-based). Personally I see zero value in 100% line coverage (100% test coverage is impossible because it would require every line be tested <i>in every possible program state and with every possible set of inputs</i>). I&#39;d also say there are very few places that should call log.Fatalf; most functions, <i>especially</i> utility functions like <code>checkIfReadable</code>, should return an error, not crash the program."}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1503321819, "post_id": 45797858, "comment_id": 78554215, "body": "I recommend reading <a href=\"https://dave.cheney.net/2015/11/05/lets-talk-about-logging\" rel=\"nofollow noreferrer\">dave.cheney.net/2015/11/05/lets-talk-about-logging</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1503330118, "post_id": 45797858, "comment_id": 78560051, "body": "If you are forced by an idiotic policy: Cheat it not: Stay sensible. 100% line coverage is not any better than 97% line coverage."}, {"owner": {"reputation": 93, "user_id": 2312654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e88940e0fe1efbb23af2620864f0a7c?s=128&d=identicon&r=PG", "display_name": "Maciej Waku\u0142a", "link": "https://stackoverflow.com/users/2312654/maciej-waku%c5%82a"}, "edited": false, "score": 0, "creation_date": 1587991967, "post_id": 45797858, "comment_id": 108718829, "body": "The question is quite popular (although downvoted) showing an issue. I&#39;m not saying we should always aim towards 100% code coverage but that there is an issue that some parts of the code cannot be covered by tests at all..."}], "answers": [{"comments": [{"owner": {"reputation": 93, "user_id": 2312654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e88940e0fe1efbb23af2620864f0a7c?s=128&d=identicon&r=PG", "display_name": "Maciej Waku\u0142a", "link": "https://stackoverflow.com/users/2312654/maciej-waku%c5%82a"}, "edited": false, "score": 0, "creation_date": 1503321489, "post_id": 45798099, "comment_id": 78553961, "body": "So &quot;program&#39;s&quot; means &quot;program&#39;s, test&#39;s and anything that might come with it&quot;."}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "reply_to_user": {"reputation": 93, "user_id": 2312654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e88940e0fe1efbb23af2620864f0a7c?s=128&d=identicon&r=PG", "display_name": "Maciej Waku\u0142a", "link": "https://stackoverflow.com/users/2312654/maciej-waku%c5%82a"}, "edited": false, "score": 0, "creation_date": 1503321756, "post_id": 45798099, "comment_id": 78554177, "body": "Yes, it means the running process."}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 6, "last_activity_date": 1503322264, "last_edit_date": 1503322264, "creation_date": 1503321253, "answer_id": 45798099, "question_id": 45797858, "link": "https://stackoverflow.com/questions/45797858/testing-log-fatalf-in-go/45798099#45798099", "title": "Testing log.Fatalf in go?", "body": "<p>Use <code>log.Print</code> instead of <code>log.Fatal</code> and return the error value that you declared in signature of function <code>checkIfReadable</code>. Or don't the error it and return it to some place that knows better how to handle it.</p>\n\n<p>The function <code>log.Fatal</code> is strictly for reporting your program's <em>final breath</em>.</p>\n\n<p>Calling <code>log.Fatal</code> is a bit worse than calling panic (there is also <code>log.panic</code>), because it does not execute deferred calls. Remember, that overusing <code>panic</code> in Go is considered a bad style. </p>\n"}, {"comments": [{"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 1, "creation_date": 1503387300, "post_id": 45811329, "comment_id": 78580524, "body": "<code>log.Fatalf</code> calls <code>os.Exit</code>, so <code>recover</code> will not help."}, {"owner": {"reputation": 266, "user_id": 4628795, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45b01fe7dab4588128ec2495c4becea2?s=128&d=identicon&r=PG", "display_name": "adrian", "link": "https://stackoverflow.com/users/4628795/adrian"}, "reply_to_user": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1503399835, "post_id": 45811329, "comment_id": 78589094, "body": "Indeed, I just double checked the docs.  The above does not help."}], "tags": [], "owner": {"reputation": 266, "user_id": 4628795, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45b01fe7dab4588128ec2495c4becea2?s=128&d=identicon&r=PG", "display_name": "adrian", "link": "https://stackoverflow.com/users/4628795/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1503386543, "creation_date": 1503386543, "answer_id": 45811329, "question_id": 45797858, "link": "https://stackoverflow.com/questions/45797858/testing-log-fatalf-in-go/45811329#45811329", "title": "Testing log.Fatalf in go?", "body": "<p>A good way to get 100% test coverage and not fail at the same time is to use <code>recover()</code> to catch the panic that is thrown by <code>log.Fatalf()</code>.</p>\n\n<p>Here are the docs for <a href=\"https://golang.org/doc/effective_go.html#recover\" rel=\"nofollow noreferrer\">recover</a>. I think it fits your use case nicely.</p>\n"}], "owner": {"reputation": 93, "user_id": 2312654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e88940e0fe1efbb23af2620864f0a7c?s=128&d=identicon&r=PG", "display_name": "Maciej Waku\u0142a", "link": "https://stackoverflow.com/users/2312654/maciej-waku%c5%82a"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2690, "favorite_count": 0, "accepted_answer_id": 45798099, "answer_count": 2, "score": 0, "last_activity_date": 1503386543, "creation_date": 1503320581, "question_id": 45797858, "link": "https://stackoverflow.com/questions/45797858/testing-log-fatalf-in-go", "title": "Testing log.Fatalf in go?", "body": "<p>I'd like to achieve 100% test coverage in go code. I am not able to cover the following example - can anyone help me with that?</p>\n\n<pre><code>package example\n\nimport (\n    \"io/ioutil\"\n    \"log\"\n)\n\nfunc checkIfReadable(filename string) (string, error) {\n    _, err := ioutil.ReadFile(filename)\n    if err != nil {\n        log.Fatalf(\"Cannot read the file... how to add coverage test for this line ?!?\")\n    }\n    return \"\", nil\n}\n\nfunc main() {\n    checkIfReadable(\"dummy.txt\")\n}\n</code></pre>\n\n<p>Some dumy test for that:</p>\n\n<pre><code>package example\n\nimport (\n    \"fmt\"\n    \"testing\"\n)\n\nfunc TestCheckIfReadable(t *testing.T) {\n    someResult, err := checkIfReadable(\"dummy.txt\")\n    if len(someResult) &gt; 0 {\n        fmt.Println(\"this will not print\")\n        t.Fail()\n    }\n    if err != nil {\n        fmt.Println(\"this will not print\")\n        t.Fail()\n    }\n}\n\nfunc TestMain(t *testing.T) {\n...\n}\n</code></pre>\n\n<p>The issue is that log.Fatalf calls os.Exit and go engine dies.</p>\n\n<ul>\n<li>I could modify the code and replace built-in library with my own - what makes the tests less reliable.</li>\n<li>I could modify the code and create a proxy and a wrapper and a .... in other words very complex mechanism to change all calls to \"log.Fatalf\"</li>\n<li>I could stop using built-in log package... what is equal to asking \"how much is go built-in worth?\"</li>\n<li>I could live with not having 100% coverage</li>\n<li>I could replace \"log.Fataf\" with something else - but then what is the point for built-in log.Fatalf?</li>\n<li>I can try to mangle with system memory and depending on my OS replace memory address for the function (...) so do something obscure and dirty</li>\n<li>Any other ideas?</li>\n</ul>\n"}, {"tags": ["xml", "parsing", "xpath", "go"], "answers": [{"tags": [], "owner": {"reputation": 1143, "user_id": 370213, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/PH4vL.jpg?s=128&g=1", "display_name": "zhengchun", "link": "https://stackoverflow.com/users/370213/zhengchun"}, "is_accepted": false, "score": 0, "last_activity_date": 1544322684, "last_edit_date": 1544322684, "creation_date": 1503536935, "answer_id": 45851445, "question_id": 45797219, "link": "https://stackoverflow.com/questions/45797219/get-value-of-node-using-xmlpath-v2-golang/45851445#45851445", "title": "Get value of node using xmlpath.v2 golang", "body": "<p><a href=\"https://github.com/antchfx/xmlquery\" rel=\"nofollow noreferrer\">xmlquery</a> package supports extract data from XML by XPath expression.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n\n    \"github.com/antchfx/xmlquery\"\n)\n\nfunc main() {\n    xmlStr := `&lt;?xml version=\"1.0\"?&gt;&lt;Warnings&gt;&lt;Warning Type=\"309\" ShortText=\"Unfulfilled Paid Service 1\"&gt;Unable to book seat 1&lt;/Warning&gt;&lt;/Warnings&gt;`\n    doc, _ := xmlquery.Parse(strings.NewReader(xmlStr))\n    nodes := xmlquery.Find(doc, \"//Warning\")\n    for _, node := range nodes {\n        fmt.Println(node.SelectAttr(\"ShortText\"))\n        fmt.Println(node.InnerText)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1254, "user_id": 2870438, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/3c587da2b868b56e3afb188bff722e8f?s=128&d=identicon&r=PG&f=1", "display_name": "Eloy Fern&#225;ndez Franco", "link": "https://stackoverflow.com/users/2870438/eloy-fern%c3%a1ndez-franco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 789, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1544322684, "creation_date": 1503318695, "question_id": 45797219, "link": "https://stackoverflow.com/questions/45797219/get-value-of-node-using-xmlpath-v2-golang", "title": "Get value of node using xmlpath.v2 golang", "body": "<p>I am parsing a xml document using <a href=\"http://gopkg.in/xmlpath.v2\" rel=\"nofollow noreferrer\">gopkg.in/xmlpath.v2</a>, and I am finding a trouble... I have no problem to get info from a single node, or get a iterator and loop over its items getting their info. But, the case where I am blocked is when I try to get the info from the same node on which I am iterating. I think that an example will be illuminating.<br>\nThis is the XML:</p>\n\n<pre><code>&lt;Warnings&gt;\n    &lt;Warning Type=\"309\" ShortText=\"Unfulfilled Paid Service 1\"&gt;Unable to book seat 1&lt;/Warning&gt;\n    &lt;Warning Type=\"309\" ShortText=\"Unfulfilled Paid Service 2\"&gt;Unable to book seat 2&lt;/Warning&gt;\n    &lt;Warning Type=\"309\" ShortText=\"Unfulfilled Paid Service 3\"&gt;Unable to book seat 3&lt;/Warning&gt;\n&lt;/Warnings&gt;\n</code></pre>\n\n<p>These are the xpath that I am usin:</p>\n\n<pre><code>xpath := xPathWarning{\n    WarningsBase:       \"Warnings/Warning\",\n    Warning:            \"\",\n    WarningAttr:        \"@ShortText\",\n}\n</code></pre>\n\n<p>And this is the way that I am trying to get the value and attribute:</p>\n\n<pre><code>func getWarnings(root *xmlpath.Node, xpath xpath_OC) []Warning {\n    warnings := []Warning{}\n    v, _ := xmlpath.Compile(xpath.WarningsBase)\n    WarningsBaseIter := v.Iter(root)\n    for WarningsBaseIter.Next() {\n        rawOffer := WarningsBaseIter.Node()\n        warning := Warning{\n            Value: GetString(\"\", xpath.Warning, rawOffer),\n            Attr:  GetString(\"\", xpath.WarningAttr, rawOffer),\n        }\n        warnings = append(warnings, warning)\n    }\n    return warnings\n}\nfunc GetString(ExpressionPrefix string, XPathExpression string, Node *xmlpath.Node) string {\n    Expr := []string{ExpressionPrefix, XPathExpression}\n    pathString := strings.Join(Expr, \"\")\n    if pathString != \"BLANK\" {\n        Path, err := xmlpath.Compile(pathString)\n        if err == nil {\n            Value, _ := Path.String(Node)\n            return Value\n        }\n    }\n    return \"\"\n}\n</code></pre>\n\n<p>I am able to get the ShortText, but not the value. I had been checking the error, showing on terminal the result of <code>Path, err := xmlpath.Compile(pathString)</code>, and the err shown is <code>compiling xml path \"\":0: empty path</code>.  </p>\n\n<p>Any solution for this??<br>\nThanks.</p>\n"}, {"tags": ["amazon-web-services", "go"], "answers": [{"tags": [], "owner": {"reputation": 4068, "user_id": 224732, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/14e1fb975cbce8ae37b509446e660e27?s=128&d=identicon&r=PG", "display_name": "Erik Rothoff", "link": "https://stackoverflow.com/users/224732/erik-rothoff"}, "is_accepted": true, "score": 2, "last_activity_date": 1503388652, "creation_date": 1503388652, "answer_id": 45812004, "question_id": 45794200, "link": "https://stackoverflow.com/questions/45794200/custom-e-mail-headers-in-aws-ses-using-go/45812004#45812004", "title": "Custom e-mail headers in AWS SES using Go", "body": "<p>This is what I ended up doing using the gomail/gomail package and <code>SendRawMessage</code>: </p>\n\n<pre><code>svc := ses.New(awsSession)\n\nmsg := gomail.NewMessage()\nmsg.SetHeader(\"From\", config.FromEmail)\nmsg.SetHeader(\"To\", email)\nmsg.SetHeader(\"Subject\", subject)\nmsg.SetHeader(\"References\", referencesID)\nmsg.SetHeader(\"In-Reply-To\", referencesID)\nmsg.SetBody(\"text/html\", body)\n\nvar emailRaw bytes.Buffer\nmsg.WriteTo(&amp;emailRaw)\n\nmessage := &amp;ses.RawMessage{Data: emailRaw.Bytes()}\n\nparams := &amp;ses.SendRawEmailInput{\n    RawMessage: message,\n}\n\n_, err := svc.SendRawEmail(params)\n</code></pre>\n"}], "owner": {"reputation": 4068, "user_id": 224732, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/14e1fb975cbce8ae37b509446e660e27?s=128&d=identicon&r=PG", "display_name": "Erik Rothoff", "link": "https://stackoverflow.com/users/224732/erik-rothoff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "accepted_answer_id": 45812004, "answer_count": 1, "score": 1, "last_activity_date": 1503388652, "creation_date": 1503309327, "question_id": 45794200, "link": "https://stackoverflow.com/questions/45794200/custom-e-mail-headers-in-aws-ses-using-go", "title": "Custom e-mail headers in AWS SES using Go", "body": "<p>I want to add a <a href=\"https://www.quora.com/How-does-Gmail-decide-which-emails-go-into-which-threads\" rel=\"nofollow noreferrer\"><code>References</code>-header</a> to the outgoing e-mails I send via AWS SES. I can't find anything referencing this in the <a href=\"https://github.com/aws/aws-sdk-go\" rel=\"nofollow noreferrer\">go repo</a>, nor the documentation. </p>\n\n<p>I found this:</p>\n\n<pre><code>_, err := svc.SendEmailWithContext(aws.BackgroundContext(), params, func(req *request.Request) {\n  req.HTTPRequest.Header.Add(\"References\", referencesID)\n})\n</code></pre>\n\n<p>But AFAIK this just tweaks the outgoing request to SES, not the message itself.</p>\n"}, {"tags": ["http", "go"], "answers": [{"comments": [{"owner": {"reputation": 3354, "user_id": 4261613, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/d8f052f9d8434d59270feefcf6cc65d5?s=128&d=identicon&r=PG&f=1", "display_name": "Mikhail", "link": "https://stackoverflow.com/users/4261613/mikhail"}, "edited": false, "score": 0, "creation_date": 1503311931, "post_id": 45794023, "comment_id": 78547599, "body": "This is some really dumb design choice by Go authors. Does not surprise me though, given other similar quirks."}, {"owner": {"reputation": 3354, "user_id": 4261613, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/d8f052f9d8434d59270feefcf6cc65d5?s=128&d=identicon&r=PG&f=1", "display_name": "Mikhail", "link": "https://stackoverflow.com/users/4261613/mikhail"}, "edited": false, "score": 1, "creation_date": 1503390148, "post_id": 45794023, "comment_id": 78582328, "body": "Actually this is not entirely correct, as I need to include the method and url in the string to compare, so the answer should be: <code>if err.Error() == &quot;Head &quot;+&quot; net&#47;http: TLS handshake tmieout&quot; { &#47;&#47; handle the error }&quot;</code>."}, {"owner": {"reputation": 2590, "user_id": 1209451, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/1700220388/picture?type=large", "display_name": "Oleg", "link": "https://stackoverflow.com/users/1209451/oleg"}, "reply_to_user": {"reputation": 3354, "user_id": 4261613, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/d8f052f9d8434d59270feefcf6cc65d5?s=128&d=identicon&r=PG&f=1", "display_name": "Mikhail", "link": "https://stackoverflow.com/users/4261613/mikhail"}, "edited": false, "score": 1, "creation_date": 1503395519, "post_id": 45794023, "comment_id": 78586177, "body": "You are right this error is wrapped by Do method I have updated my answer . But anyway the idea is the same - just string checking"}], "tags": [], "owner": {"reputation": 2590, "user_id": 1209451, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/1700220388/picture?type=large", "display_name": "Oleg", "link": "https://stackoverflow.com/users/1209451/oleg"}, "is_accepted": true, "score": 2, "last_activity_date": 1503395573, "last_edit_date": 1503395573, "creation_date": 1503308783, "answer_id": 45794023, "question_id": 45793299, "link": "https://stackoverflow.com/questions/45793299/how-to-check-if-error-is-tls-handshake-timeout-in-go/45794023#45794023", "title": "How to check if error is tls handshake timeout in Go", "body": "<p>Yes <code>tlsHandshakeTimeoutError</code> - is not exported and the only one \npossibility to check on this error is:</p>\n\n<pre><code>import \"net/url\"\n\n// ....\n\nif urlError,ok :=  err.(*url.Error)  ; ok {\n    if urlError.Error() == \"net/http: TLS handshake timeout\" {\n        // handle the error\n    }\n}\n</code></pre>\n\n<p>Here is open ticket with discussion about it:</p>\n\n<p><a href=\"https://github.com/golang/go/issues/15935\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/15935</a></p>\n\n<p>By the way <code>http</code> errors (and <code>tlsHandshakeTimeoutError</code> also) provide also:</p>\n\n<pre><code>type WithTimeout interface {\n   Timeout() bool\n}\n</code></pre>\n\n<p>You can use it for you check if you don't like string comparsion. <a href=\"https://github.com/grpc/grpc-go/blob/25b4a426b40c26c07c80af674b03db90b5bd4a60/transport/http2_client.go#L125\" rel=\"nofollow noreferrer\">Here</a> is example of isTemporary implementation from http2 package.</p>\n"}], "owner": {"reputation": 3354, "user_id": 4261613, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/d8f052f9d8434d59270feefcf6cc65d5?s=128&d=identicon&r=PG&f=1", "display_name": "Mikhail", "link": "https://stackoverflow.com/users/4261613/mikhail"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1167, "favorite_count": 0, "accepted_answer_id": 45794023, "answer_count": 1, "score": 0, "last_activity_date": 1503395573, "creation_date": 1503306680, "question_id": 45793299, "link": "https://stackoverflow.com/questions/45793299/how-to-check-if-error-is-tls-handshake-timeout-in-go", "title": "How to check if error is tls handshake timeout in Go", "body": "<p>I have the following code making a request to URL and checking for errors. </p>\n\n<pre><code>import \"net/http\"\n\nresponse, err := http.Head(\"url\")\n</code></pre>\n\n<p>How do check if the error is due to tls handshake timeout? I tried the following:</p>\n\n<pre><code>if err != nil {\n    tlsError, ok := err.(http.tlsHandshakeTimeoutError)\n    if ok {\n        // handle the error\n    }\n}\n</code></pre>\n\n<p>But I cannot access the <code>http.tlsHandshakeTimeoutError</code> type because it is unexported. How else can I check for the error type in go?</p>\n"}, {"tags": ["arrays", "go"], "comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 3, "creation_date": 1503302115, "post_id": 45791820, "comment_id": 78541503, "body": "What did you try? What was the problem?"}, {"owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "reply_to_user": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1503302651, "post_id": 45791820, "comment_id": 78541754, "body": "Thanks. just updated the query .. please suggest"}, {"owner": {"user_type": "does_not_exist", "display_name": "user801154"}, "edited": false, "score": 0, "creation_date": 1503303985, "post_id": 45791820, "comment_id": 78542467, "body": "Another thing to note is in Go we can have UTF-8 characters and one single byte is not enough to hold those characters."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1503304489, "post_id": 45791820, "comment_id": 78542769, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/22892120/how-to-generate-a-random-string-of-a-fixed-length-in-golang/31832326#31832326\">How to generate a random string of a fixed length in golang?</a>"}, {"owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "edited": false, "score": 0, "creation_date": 1503305109, "post_id": 45791820, "comment_id": 78543114, "body": "no. it always gives the same output. plz see code here: <a href=\"https://gist.github.com/anonymous/a90bdbd0ec0770b373890286322d9063\" rel=\"nofollow noreferrer\">gist.github.com/anonymous/a90bdbd0ec0770b373890286322d9063</a>"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1503306886, "post_id": 45791820, "comment_id": 78544268, "body": "see my comment below, it won&#39;t work on play.golang.org"}], "answers": [{"comments": [{"owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "edited": false, "score": 0, "creation_date": 1503314356, "post_id": 45792183, "comment_id": 78549051, "body": "can this logic be applicable to special characters as well ?"}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 0, "last_activity_date": 1503309830, "last_edit_date": 1503309830, "creation_date": 1503303103, "answer_id": 45792183, "question_id": 45791820, "link": "https://stackoverflow.com/questions/45791820/how-to-extract-character-from-array-in-golang/45792183#45792183", "title": "How to extract character from array in golang?", "body": "<p>You probably don't need cryto/rand. Just set the seed to something different each time. The math/rand package is deterministic with the same seed, so you just need to change the seed each time. Assuming this is not super secure, just add this line. </p>\n\n<pre><code>rand.Seed(time.Now().Unix())\n</code></pre>\n\n<p>Also note if you're using play.golang.org to test it that's not going to work because the time pkg doesn't work there. It'll work fine anywhere else. </p>\n\n<p>If you actually want a random selection of characters though, use crypto/rand.Read NOT a homemade version - you can encode it if you need it within a given character range. Finally, don't roll your own crypto, just in case that's what you're doing here. </p>\n"}, {"comments": [{"owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "edited": false, "score": 0, "creation_date": 1503304571, "post_id": 45792195, "comment_id": 78542820, "body": "thanks. i added the code as you mentioned . but it always outputs &quot;Bb&quot;"}, {"owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "edited": false, "score": 0, "creation_date": 1503304583, "post_id": 45792195, "comment_id": 78542830, "body": "here is the updated code: <a href=\"https://gist.github.com/anonymous/a90bdbd0ec0770b373890286322d9063\" rel=\"nofollow noreferrer\">gist.github.com/anonymous/a90bdbd0ec0770b373890286322d9063</a>"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "edited": false, "score": 0, "creation_date": 1503308811, "post_id": 45792195, "comment_id": 78545611, "body": "@user2315104: See the comment about the Go plaground in my revised answer."}, {"owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "edited": false, "score": 0, "creation_date": 1503314302, "post_id": 45792195, "comment_id": 78549016, "body": "can this logic be applicable to special characters as well ?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "edited": false, "score": 0, "creation_date": 1503321799, "post_id": 45792195, "comment_id": 78554201, "body": "@user2315104: Use <code>rune</code> instead of <code>byte</code>. See my revised answer."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1503321715, "last_edit_date": 1503321715, "creation_date": 1503303144, "answer_id": 45792195, "question_id": 45791820, "link": "https://stackoverflow.com/questions/45791820/how-to-extract-character-from-array-in-golang/45792195#45792195", "title": "How to extract character from array in golang?", "body": "<p>Start by seeding the pseudorandom number generator. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\nfunc main() {\n    rand.Seed(time.Now().UnixNano())\n    const letterBytes = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n    b := make([]byte, 7)\n    for i := range b {\n        b[i] = letterBytes[rand.Intn(len(letterBytes))]\n    }\n    fmt.Println(string(b))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>jfXtySC\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://play.golang.org\" rel=\"nofollow noreferrer\">The Go Playground</a></p>\n  \n  <p>About the Playground</p>\n  \n  <p>In the playground the time begins at 2009-11-10 23:00:00 UTC\n  (determining the significance of this date is an exercise for the\n  reader). This makes it easier to cache programs by giving them\n  deterministic output.</p>\n</blockquote>\n\n<p>Therefore, in the Go playground, <code>time.Now().UnixNano()</code> always returns the same value. For a random seed value, run the code on your computer.</p>\n\n<hr>\n\n<p>For any Unicode code point (Go rune),</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\npackage main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\nfunc main() {\n    rand.Seed(time.Now().UnixNano())\n    chars := []rune(\"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\u4e16\u754c!@=\")\n    r := make([]rune, 50)\n    for i := range r {\n        r[i] = chars[rand.Intn(len(chars))]\n    }\n    fmt.Println(string(r))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>\u4e16QRYSp=@giJMIKly=tXRefjtVkeE!yHhTSQHvLyUYdRNIBbILW\n</code></pre>\n"}], "owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 810, "favorite_count": 1, "accepted_answer_id": 45792195, "answer_count": 2, "score": 1, "last_activity_date": 1503321715, "creation_date": 1503301795, "last_edit_date": 1503302618, "question_id": 45791820, "link": "https://stackoverflow.com/questions/45791820/how-to-extract-character-from-array-in-golang", "title": "How to extract character from array in golang?", "body": "<p>need to extract the random characters from string  </p>\n\n<p>here is what i got:</p>\n\n<pre><code>const letterBytes = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n  b := make([]byte, 1)\nfor i := range b {\n    b[i] = letterBytes[rand.Intn(len(letterBytes))]\n}\nfmt.Println(string(b))\n</code></pre>\n\n<p>but it always returns \"X\"\nbut, i need to return every time new character using rand function.\nany help would be really appreciated. \nThanks.</p>\n"}, {"tags": ["go", "time"], "comments": [{"owner": {"reputation": 29876, "user_id": 476716, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4e325890903afc8269eb2c1aa57587b3?s=128&d=identicon&r=PG", "display_name": "OrangeDog", "link": "https://stackoverflow.com/users/476716/orangedog"}, "edited": false, "score": 0, "creation_date": 1503332133, "post_id": 45791241, "comment_id": 78561198, "body": "Technically <code>performance.now()</code> is a DOM feature, not JavaScript. If you&#39;re running JS e.g. on a server you&#39;ll have some other API."}, {"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 1, "creation_date": 1503334367, "post_id": 45791241, "comment_id": 78562350, "body": "If you&#39;re trying to profile the performance of some code, it&#39;s often useful to use CPU performance counters to measure time in core clock cycles, rather than wall-clock time, so CPU frequency-scaling makes less difference.  (This makes sense if it&#39;s CPU-bound, not memory-bound (since memory frequency usually stays constant), and definitely not I/O bound.)  Perf counters can also help you find <i>why</i> it takes the time it does, e.g. cache misses vs. branch mispredicts vs. high latency long dependency chains vs. actually maxing out CPU front-end or execution-unit throughput."}, {"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1503334415, "post_id": 45791241, "comment_id": 78562374, "body": "e.g. on Linux <code>perf record .&#47;a.out</code>, then <code>perf report</code>."}], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 7, "last_activity_date": 1504191822, "last_edit_date": 1504191822, "creation_date": 1503300024, "answer_id": 45791349, "question_id": 45791241, "link": "https://stackoverflow.com/questions/45791241/correctly-measure-time-duration-in-go/45791349#45791349", "title": "Correctly measure time duration in Go", "body": "<p>This is available in Go 1.9 (August 2017) with monotonic clocks, you won't have to do anything special to benefit from it:</p>\n\n<p><a href=\"https://tip.golang.org/pkg/time/#hdr-Monotonic_Clocks\" rel=\"nofollow noreferrer\">https://tip.golang.org/pkg/time/#hdr-Monotonic_Clocks</a></p>\n\n<blockquote>\n  <p>Operating systems provide both a \u201cwall clock,\u201d which is subject to\n  changes for clock synchronization, and a \u201cmonotonic clock,\u201d which is\n  not. The general rule is that the wall clock is for telling time and\n  the monotonic clock is for measuring time. Rather than split the API,\n  in this package the Time returned by time.Now contains both a wall\n  clock reading and a monotonic clock reading; later time-telling\n  operations use the wall clock reading, but later time-measuring\n  operations, specifically comparisons and subtractions, use the\n  monotonic clock reading.</p>\n  \n  <p>For example, this code always computes a positive elapsed time of\n  approximately 20 milliseconds, even if the wall clock is changed\n  during the operation being timed:</p>\n</blockquote>\n\n<pre><code>start := time.Now()\n... operation that takes 20 milliseconds ...\nt := time.Now()\nelapsed := t.Sub(start)\n</code></pre>\n\n<blockquote>\n  <p>Other idioms, such as time.Since(start), time.Until(deadline), and\n  time.Now().Before(deadline), are similarly robust against wall clock\n  resets.</p>\n</blockquote>\n\n<p>This change to the <a href=\"https://golang.org/pkg/time\" rel=\"nofollow noreferrer\">time</a> pkg was triggered by this <a href=\"https://github.com/golang/go/issues/12914\" rel=\"nofollow noreferrer\">issue</a>, which prompted this <a href=\"https://github.com/golang/proposal/blob/master/design/12914-monotonic.md\" rel=\"nofollow noreferrer\">proposal</a> for change from Russ Cox:</p>\n\n<blockquote>\n  <p>Comparison and subtraction of times observed by time.Now can return\n  incorrect results if the system wall clock is reset between the two\n  observations. We propose to extend the time.Time representation to\n  hold an additional monotonic clock reading for use in those\n  calculations. Among other benefits, this should make it impossible for\n  a basic elapsed time measurement using time.Now and time.Since to\n  report a negative duration or other result not grounded in reality.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 539, "user_id": 2352611, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/0fY8c.jpg?s=128&g=1", "display_name": "Larytet", "link": "https://stackoverflow.com/users/2352611/larytet"}, "edited": false, "score": 1, "creation_date": 1536962261, "post_id": 45791360, "comment_id": 91626533, "body": "runtime.nanotime() is not exported An example is here <a href=\"https://github.com/gavv/monotime/blob/master/monotime.go\" rel=\"nofollow noreferrer\">github.com/gavv/monotime/blob/master/monotime.go</a> Pay attention to //go:linkname"}], "tags": [], "owner": {"reputation": 14131, "user_id": 2224996, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/EDCvE.jpg?s=128&g=1", "display_name": "maja", "link": "https://stackoverflow.com/users/2224996/maja"}, "is_accepted": false, "score": 5, "last_activity_date": 1503300062, "creation_date": 1503300062, "answer_id": 45791360, "question_id": 45791241, "link": "https://stackoverflow.com/questions/45791241/correctly-measure-time-duration-in-go/45791360#45791360", "title": "Correctly measure time duration in Go", "body": "<p>For Go 1.8 and before, the correct timing function is not inside the time package, but instead in the <a href=\"https://golang.org/pkg/runtime/?m=all#nanotime\" rel=\"noreferrer\">runtime package</a>:    </p>\n\n<pre><code>func nanotime() int64\n</code></pre>\n\n<p>In order to correctly measure execution time, the following procedure should be used:</p>\n\n<pre><code>var startTime = runtime.nanotime()\ndoSomeHardWork()\nvar duration = runtime.nanotime() - startTime\n</code></pre>\n\n<p>Unfortunately, the method itself is not documented very well. It emerged in <a href=\"https://github.com/Katzenpost/core/issues/6\" rel=\"noreferrer\">this issue</a> after a <a href=\"https://github.com/golang/go/issues/12914\" rel=\"noreferrer\">long discussion if it was really neccessary</a>.\nFor Go 1.9 and newer, refer to Kenny Grant's answer.</p>\n"}, {"comments": [{"owner": {"reputation": 14131, "user_id": 2224996, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/EDCvE.jpg?s=128&g=1", "display_name": "maja", "link": "https://stackoverflow.com/users/2224996/maja"}, "edited": false, "score": 2, "creation_date": 1503300498, "post_id": 45791377, "comment_id": 78540648, "body": "That is a pretty genious API design. Much better than providing a separate function and relying on the programmer to chose the right one (which many don&#39;t)."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 14131, "user_id": 2224996, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/EDCvE.jpg?s=128&g=1", "display_name": "maja", "link": "https://stackoverflow.com/users/2224996/maja"}, "edited": false, "score": 0, "creation_date": 1503300974, "post_id": 45791377, "comment_id": 78540947, "body": "@maja: I have added a link to the design document (proposal)."}, {"owner": {"reputation": 10492, "user_id": 603688, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/1058344e1b119c4d9dd3aedc5456277b?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/603688/dan"}, "edited": false, "score": 3, "creation_date": 1503577537, "post_id": 45791377, "comment_id": 78681201, "body": "Doesn&#39;t this mean that if <code>a</code> and <code>b</code> are times, it&#39;s possible for <code>b - a + a != b</code>?"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 37, "last_activity_date": 1503619450, "last_edit_date": 1503619450, "creation_date": 1503300116, "answer_id": 45791377, "question_id": 45791241, "link": "https://stackoverflow.com/questions/45791241/correctly-measure-time-duration-in-go/45791377#45791377", "title": "Correctly measure time duration in Go", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/time/\" rel=\"noreferrer\">Package time</a></p>\n  \n  <p>Monotonic Clocks</p>\n  \n  <p>Operating systems provide both a \u201cwall clock,\u201d which is subject to\n  changes for clock synchronization, and a \u201cmonotonic clock,\u201d which is\n  not. The general rule is that the wall clock is for telling time and\n  the monotonic clock is for measuring time. Rather than split the API,\n  in this package the Time returned by time.Now contains both a wall\n  clock reading and a monotonic clock reading; later time-telling\n  operations use the wall clock reading, but later time-measuring\n  operations, specifically comparisons and subtractions, use the\n  monotonic clock reading.</p>\n  \n  <p>For example, this code always computes a positive elapsed time of\n  approximately 20 milliseconds, even if the wall clock is changed\n  during the operation being timed:</p>\n\n<pre><code>start := time.Now()\n... operation that takes 20 milliseconds ...\nt := time.Now()\nelapsed := t.Sub(start)\n</code></pre>\n  \n  <p>Other idioms, such as time.Since(start), time.Until(deadline), and\n  time.Now().Before(deadline), are similarly robust against wall clock\n  resets.</p>\n</blockquote>\n\n<p>Starting with Go 1.9 (released August 24, 2017), Go uses a monotonic clock for durations.</p>\n\n<p>See <a href=\"https://golang.org/design/12914-monotonic\" rel=\"noreferrer\">Proposal: Monotonic Elapsed Time Measurements in Go</a>.</p>\n"}], "owner": {"reputation": 14131, "user_id": 2224996, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/EDCvE.jpg?s=128&g=1", "display_name": "maja", "link": "https://stackoverflow.com/users/2224996/maja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9150, "favorite_count": 3, "accepted_answer_id": 45791377, "answer_count": 3, "score": 29, "last_activity_date": 1504352441, "creation_date": 1503299617, "last_edit_date": 1504352441, "question_id": 45791241, "link": "https://stackoverflow.com/questions/45791241/correctly-measure-time-duration-in-go", "title": "Correctly measure time duration in Go", "body": "<p>What is the correct way to precisely measure a time duration in Go?\nMost application just use the standard time package and the following approach:</p>\n\n<pre><code>var startTime = time.Now()\ndoSomeHardWork()\nvar duration = time.Since(startTime) // or: time.Now() - startTime\n</code></pre>\n\n<p>However, <code>time.Now()</code> returns the current system time, which leads to two flaws:</p>\n\n<ol>\n<li>If the system time is changed during the measurement (for example due to a <strong>time zone change</strong> (DST) or a <strong>leap second</strong>), the resulting duration is also wrong.</li>\n<li><p>The system time can tick deliberately faster or slower than the real time. This always happens when the operating system synchronizes the internal clock with NTP time servers (which might happen several times an hour!)</p>\n\n<p>From <a href=\"https://technet.microsoft.com/en-us/library/cc773013(v=ws.10).aspx\" rel=\"noreferrer\">MSDN</a>: </p>\n\n<blockquote>\n  <p>[The time service] adjusts the local clock rate to allow it to\n  converge toward the correct time. If the time difference between the\n  local clock and the [accurate time sample] is too large to correct by\n  adjusting the local clock rate, the time service sets the local clock\n  to the correct time.</p>\n</blockquote></li>\n</ol>\n\n<p>If the system time changes (either manually or due to DST), it might be possible to detect the invalid duration and discard it. But if the system clock ticks e.g. 10% faster to synchronize with world-time, it is practically impossible to detect. That's intended behaviour and how the system clock is designed.</p>\n\n<p>For that reason, most other languages offer a dedicated API for measuring durations:</p>\n\n<ul>\n<li>Java has <a href=\"http://docs.oracle.com/javase/6/docs/api/java/lang/System.html#nanoTime%28%29\" rel=\"noreferrer\"><code>System.nanoTime()</code></a>, <code>System.currentTimeMillis()</code> would be equivalent to <code>time.Now()</code> and is wrong</li>\n<li>C# has <a href=\"https://msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.aspx\" rel=\"noreferrer\"><code>System.Diagnostics.Stopwatch</code></a></li>\n<li>C/C++ on Windows has <a href=\"https://msdn.microsoft.com/en-us/library/ms644904(VS.85).aspx\" rel=\"noreferrer\"><code>QueryPerformanceCounter</code></a> and <a href=\"https://msdn.microsoft.com/en-us/library/ms644905(VS.85).aspx\" rel=\"noreferrer\"><code>QueryPerformanceFrequency</code></a></li>\n<li>C++11 and up have <a href=\"http://en.cppreference.com/w/cpp/chrono/steady_clock\" rel=\"noreferrer\"><code>std::chrono::steady_clock</code></a>, or <a href=\"http://en.cppreference.com/w/cpp/chrono/high_resolution_clock\" rel=\"noreferrer\"><code>std::chrono::high_resolution_clock</code></a> when its <code>is_steady</code> member constant is <code>true</code></li>\n<li>JavaScript has <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Performance/now\" rel=\"noreferrer\"><code>performance.now()</code></a>, while the use of <code>new Date()</code> is wrong</li>\n</ul>\n\n<p>What is the correct way to precisely measure execution time in Go?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 351, "user_id": 6581076, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b3386335102b76ca027284de77ba27c?s=128&d=identicon&r=PG&f=1", "display_name": "Robbie Jones", "link": "https://stackoverflow.com/users/6581076/robbie-jones"}, "edited": false, "score": 1, "creation_date": 1503299949, "post_id": 45791233, "comment_id": 78540285, "body": "I don&#39;t know go at all, but can&#39;t you use <code>len(array)</code> and <code>len(array[0])</code>?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1503320376, "post_id": 45791233, "comment_id": 78553136, "body": "Bear in mind that there is no guarantee that each &quot;row&quot; will be the same width - this is just a slice of slices."}], "answers": [{"tags": [], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "is_accepted": true, "score": 7, "last_activity_date": 1503303408, "last_edit_date": 1503303408, "creation_date": 1503299995, "answer_id": 45791340, "question_id": 45791233, "link": "https://stackoverflow.com/questions/45791233/get-dimensions-of-2d-slice/45791340#45791340", "title": "Get dimensions of 2d slice", "body": "<p>Just get the <code>len</code> of <code>array</code> and the <code>len</code> of any element of <code>array</code>.</p>\n\n<pre><code>len(array) // 4\nlen(array[0]) // 5\n</code></pre>\n\n<p>As a note, you are using a 2d slice, not array. Read more about Go slices <a href=\"https://blog.golang.org/slices\" rel=\"noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 2623, "user_id": 5241780, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/8542490e5ecda0cf556cb0e7403f0812?s=128&d=identicon&r=PG&f=1", "display_name": "chefcurry7", "link": "https://stackoverflow.com/users/5241780/chefcurry7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 824, "favorite_count": 0, "accepted_answer_id": 45791340, "answer_count": 1, "score": 2, "last_activity_date": 1580544776, "creation_date": 1503299590, "question_id": 45791233, "link": "https://stackoverflow.com/questions/45791233/get-dimensions-of-2d-slice", "title": "Get dimensions of 2d slice", "body": "<p>Lets say I have a <code>4 by 5</code> 2d array</p>\n\n<pre><code>array := [][]byte{\n    {1, 0, 1, 0, 0},\n    {1, 0, 1, 1, 1},\n    {1, 1, 1, 1, 1},\n    {1, 0, 0, 1, 0},\n}\n</code></pre>\n\n<p>How do I get the columns and widths of this array? I want to do a nested loop over this array but the array passed in the function may vary in dimensions.</p>\n"}, {"tags": ["unit-testing", "go"], "answers": [{"comments": [{"owner": {"reputation": 148, "user_id": 3141044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SclZ0.jpg?s=128&g=1", "display_name": "abhijithda", "link": "https://stackoverflow.com/users/3141044/abhijithda"}, "edited": false, "score": 0, "creation_date": 1503679313, "post_id": 45799322, "comment_id": 78730889, "body": "I was trying to call some script actually, and that script could sometimes be not present... For asking here, I just used date as an example... Thanks. By the way. I later realized that I can do it by making use of ENV variables."}], "tags": [], "owner": {"reputation": 11, "user_id": 7551946, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zk1CG.jpg?s=128&g=1", "display_name": "Forest Hoffman", "link": "https://stackoverflow.com/users/7551946/forest-hoffman"}, "is_accepted": false, "score": 0, "last_activity_date": 1503324840, "creation_date": 1503324840, "answer_id": 45799322, "question_id": 45789101, "link": "https://stackoverflow.com/questions/45789101/how-to-mock-exec-command-for-multiple-unit-tests-in-go-lang/45799322#45799322", "title": "How to mock exec.Command for multiple unit tests in Go lang?", "body": "<p>Based on the code you've posted, the <code>mockedDate</code> variable doesn't do anything. Neither the test, nor the call to <code>printDate()</code> are utilizing it, so the <code>TestPrintDateUnableToRunError()</code> test performs just like the tests before it.</p>\n\n<p>If you were to add functionality to the <code>printDate()</code> function to return string of \"Unable to run date command\" (when that is the case), then your condition on line 62 would pass. That said, such checks should be unnecessary, when you have an error in the return values from <code>printDate()</code>. If the returned error is non-nil, the returned output string should be expected to be invalid (or empty, <code>\"\"</code>).</p>\n\n<p>I can't tell how you really want <code>printDate()</code> to fail, but as it stands, there's no way for it to return the values you're expecting in <code>TestPrintDateUnableToRunError()</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 148, "user_id": 3141044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SclZ0.jpg?s=128&g=1", "display_name": "abhijithda", "link": "https://stackoverflow.com/users/3141044/abhijithda"}, "is_accepted": true, "score": 3, "last_activity_date": 1503340210, "creation_date": 1503340210, "answer_id": 45803548, "question_id": 45789101, "link": "https://stackoverflow.com/questions/45789101/how-to-mock-exec-command-for-multiple-unit-tests-in-go-lang/45803548#45803548", "title": "How to mock exec.Command for multiple unit tests in Go lang?", "body": "<p>I got the solution for this...</p>\n\n<blockquote>\n  <p>Is the global value not getting set? Or the changes to that global var is not getting updated in TestHelperProcess?</p>\n</blockquote>\n\n<p>Since in <code>TestPrintDate()</code>, <code>fakeExecCommand</code> is called instead of exec.Command, and calling <code>fakeExecCommand</code> runs <code>go test</code> to run only <code>TestHelperProcess()</code>, it's altogether a new invocation where only <code>TestHelperProcess()</code> will be executed. Since only <code>TestHelperProcess()</code> is called, the global variables aren't being set.</p>\n\n<p>The solution would be to set the Env in the <code>fakeExecCommand</code>, and retrieve that in <code>TestHelperProcess()</code> and return those values.</p>\n\n<p><em>PS> <code>TestHelperProcess</code> is renamed to <code>TestExecCommandHelper</code></em>, And few variables are renamed.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"os/exec\"\n    \"strconv\"\n    \"testing\"\n)\n\nvar mockedExitStatus = 0\nvar mockedStdout string\n\nfunc fakeExecCommand(command string, args ...string) *exec.Cmd {\n    cs := []string{\"-test.run=TestExecCommandHelper\", \"--\", command}\n    cs = append(cs, args...)\n    cmd := exec.Command(os.Args[0], cs...)\n    es := strconv.Itoa(mockedExitStatus)\n    cmd.Env = []string{\"GO_WANT_HELPER_PROCESS=1\",\n        \"STDOUT=\" + mockedStdout,\n        \"EXIT_STATUS=\" + es}\n    return cmd\n}\n\nfunc TestExecCommandHelper(t *testing.T) {\n    if os.Getenv(\"GO_WANT_HELPER_PROCESS\") != \"1\" {\n        return\n    }\n\n    // println(\"Mocked stdout:\", os.Getenv(\"STDOUT\"))\n    fmt.Fprintf(os.Stdout, os.Getenv(\"STDOUT\"))\n    i, _ := strconv.Atoi(os.Getenv(\"EXIT_STATUS\"))\n    os.Exit(i)\n}\n\nfunc TestPrintDate(t *testing.T) {\n    mockedExitStatus = 1\n    mockedStdout = \"Sun Aug 201\"\n    execCommand = fakeExecCommand\n    defer func() { execCommand = exec.Command }()\n    expDate := \"Sun Aug 20\"\n\n    out, _ := printDate()\n    if string(out) != expDate {\n        t.Errorf(\"Expected %q, got %q\", expDate, string(out))\n    }\n}\n\nfunc TestPrintDateUnableToRunError(t *testing.T) {\n    mockedExitStatus = 1\n    mockedStdout = \"Unable to run date command\"\n    execCommand = fakeExecCommand\n    defer func() { execCommand = exec.Command }()\n\n    expDate := \"Unable to run date command\"\n\n    out, _ := printDate()\n    // println(\"Stdout: \", string(out))\n    if string(out) != expDate {\n        t.Errorf(\"Expected %q, got %q\", expDate, string(out))\n    }\n}\n</code></pre>\n\n<p><strong><code>go test</code> results as below...</strong> \n<em>(Purposely failing one test to show that the mock is working properly).</em></p>\n\n<pre><code> go test hello\n--- FAIL: TestPrintDate (0.01s)\n        hello_test.go:45: Expected \"Sun Aug 20\", got \"Sun Aug 201\"\nFAIL\nFAIL    hello   0.018s\n</code></pre>\n"}], "owner": {"reputation": 148, "user_id": 3141044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SclZ0.jpg?s=128&g=1", "display_name": "abhijithda", "link": "https://stackoverflow.com/users/3141044/abhijithda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4501, "favorite_count": 0, "accepted_answer_id": 45803548, "answer_count": 2, "score": 4, "last_activity_date": 1503340210, "creation_date": 1503287931, "question_id": 45789101, "link": "https://stackoverflow.com/questions/45789101/how-to-mock-exec-command-for-multiple-unit-tests-in-go-lang", "title": "How to mock exec.Command for multiple unit tests in Go lang?", "body": "<p>I just learnt unit testing functions that uses <code>exec.Command()</code> i.e., mocking <code>exec.Command()</code>. I went ahead to added more unit cases, but running into issues of not able to mock the output for different scenarios.</p>\n\n<p><strong>Here is a sample code <code>hello.go</code> I'm trying to test...</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os/exec\"\n)\n\nvar execCommand = exec.Command\n\nfunc printDate() ([]byte, error) {\n    cmd := execCommand(\"date\")\n    out, err := cmd.CombinedOutput()\n    return out, err\n}\n\nfunc main() {\n    fmt.Printf(\"hello, world\\n\")\n    fmt.Println(printDate())\n}\n</code></pre>\n\n<p><strong>Below is the test code <code>hello_test.go</code>...</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"os/exec\"\n    \"testing\"\n)\n\nvar mockedExitStatus = 1\nvar mockedDate = \"Sun Aug 20\"\nvar expDate = \"Sun Aug 20\"\n\nfunc fakeExecCommand(command string, args ...string) *exec.Cmd {\n    cs := []string{\"-test.run=TestHelperProcess\", \"--\", command}\n    cs = append(cs, args...)\n    cmd := exec.Command(os.Args[0], cs...)\n    cmd.Env = []string{\"GO_WANT_HELPER_PROCESS=1\"}\n    return cmd\n}\n\nfunc TestHelperProcess(t *testing.T) {\n    if os.Getenv(\"GO_WANT_HELPER_PROCESS\") != \"1\" {\n        return\n    }\n\n    // println(\"Mocked Data:\", mockedDate)\n    fmt.Fprintf(os.Stdout, mockedDate)\n    os.Exit(mockedExitStatus)\n}\n\nfunc TestPrintDate(t *testing.T) {\n    execCommand = fakeExecCommand\n    defer func() { execCommand = exec.Command }()\n\n    out, err := printDate()\n    print(\"Std out: \", string(out))\n    if err != nil {\n        t.Errorf(\"Expected nil error, got %#v\", err)\n    }\n    if string(out) != expDate {\n        t.Errorf(\"Expected %q, got %q\", expDate, string(out))\n    }\n}\n\nfunc TestPrintDateUnableToRunError(t *testing.T) {\n    execCommand = fakeExecCommand\n    defer func() { execCommand = exec.Command }()\n\n    mockedExitStatus = 1\n    mockedDate = \"Unable to run date command\"\n    expDate = \"Unable to run date command\"\n\n    out, err := printDate()\n    print(\"Std out: \", string(out))\n    if err != nil {\n        t.Errorf(\"Expected nil error, got %#v\", err)\n    }\n    if string(out) != expDate {\n        t.Errorf(\"Expected %q, got %q\", expDate, string(out))\n    }\n}\n</code></pre>\n\n<p><strong><code>go test</code> fails for the second test <code>TestPrintDateUnableToRunError</code>...</strong></p>\n\n<pre><code>$ go test hello\nStd out: Sun Aug 20Std out: Sun Aug 20--- FAIL: TestPrintDateTomorrow (0.01s)\n    hello_test.go:62: Expected \"Unable to run date command\", got \"Sun Aug 20\"\nFAIL\nFAIL    hello   0.017s\n</code></pre>\n\n<p>Even though I'm trying to set the global <code>mockedDate</code> value inside the test case, it's still getting the global value that it was initialized with. <strong>Is the global value not getting set? Or the changes to that global var is not getting updated in <code>TestHelperProcess</code>?</strong></p>\n"}, {"tags": ["templates", "go"], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 2, "last_activity_date": 1503298392, "creation_date": 1503298392, "answer_id": 45790918, "question_id": 45788395, "link": "https://stackoverflow.com/questions/45788395/go-html-template-how-to-get-user-ip-in-function-from-funcmap/45790918#45790918", "title": "Go html template how to get user IP in function from funcMap", "body": "<p>The func map is intended for helper functions, rather than data, and should be defined once before parsing templates, so this isn't a good place for it. You should instead pass in the data to the view when executing the template. </p>\n\n<p>This would fit better in your data/context for the view. For example if you use a map[string]interface{} for that (one of the few places I'd use interface{}), you can simply assign it there:</p>\n\n<pre><code>userIP := strings.Split(r.RemoteAddr, \":\")[0]\ndata := map[string]interface{}{\"userIP\":userIP}\nerr := tmpl.Execute(w,data)\n</code></pre>\n\n<p>Template:</p>\n\n<pre><code>&lt;p&gt;User IP:{{.userIP}}&lt;/p&gt;\n</code></pre>\n"}], "owner": {"reputation": 988, "user_id": 6149170, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bc071a84d9b5d4ec115745e1d0922b29?s=128&d=identicon&r=PG", "display_name": "hermancain", "link": "https://stackoverflow.com/users/6149170/hermancain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1503298392, "creation_date": 1503280088, "question_id": 45788395, "link": "https://stackoverflow.com/questions/45788395/go-html-template-how-to-get-user-ip-in-function-from-funcmap", "title": "Go html template how to get user IP in function from funcMap", "body": "<p>I know how to get the user IP from the <code>*http.Request</code>struct:</p>\n\n<pre><code>strings.Split(r.RemoteAddr, \":\")[0]\n</code></pre>\n\n<p>And I know how to define a <code>template.FuncMap</code>:</p>\n\n<pre><code>funcMap = template.FuncMap{                                                           \n        // gets the time since the post was posted                                    \n        \"since\": func(t time.Time) string {                                           \n                s := time.Since(t).String()                                           \n                return strings.Replace(s[:strings.LastIndex(s, \"m\")+1], \"h\", \"h \", 1) \n        },                                                                            \n}                                                                                     \n</code></pre>\n\n<p>How would I get the users IP from a template function defined in the <code>template.FuncMap</code>?</p>\n"}, {"tags": ["angular", "go", "web", "service", "ports"], "comments": [{"owner": {"reputation": 3658, "user_id": 1137796, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/q4LJn.jpg?s=128&g=1", "display_name": "Judson Terrell", "link": "https://stackoverflow.com/users/1137796/judson-terrell"}, "edited": false, "score": 0, "creation_date": 1503277299, "post_id": 45788128, "comment_id": 78534089, "body": "I would have goServer listen on a different port and create a rule that will route the domain you are showing to that port."}, {"owner": {"reputation": 151, "user_id": 6190999, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/fcbeb809f99538b1a195867a6658b126?s=128&d=identicon&r=PG&f=1", "display_name": "Nicster15", "link": "https://stackoverflow.com/users/6190999/nicster15"}, "reply_to_user": {"reputation": 3658, "user_id": 1137796, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/q4LJn.jpg?s=128&g=1", "display_name": "Judson Terrell", "link": "https://stackoverflow.com/users/1137796/judson-terrell"}, "edited": false, "score": 0, "creation_date": 1503278052, "post_id": 45788128, "comment_id": 78534217, "body": "@JudsonTerrell Issue is cookies won&#39;t be shared. Else I would just make the go server on a domain like backend.example.com."}, {"owner": {"reputation": 3658, "user_id": 1137796, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/q4LJn.jpg?s=128&g=1", "display_name": "Judson Terrell", "link": "https://stackoverflow.com/users/1137796/judson-terrell"}, "edited": false, "score": 0, "creation_date": 1503278866, "post_id": 45788128, "comment_id": 78534345, "body": "Man that&#39;s tricky then. Every application action I&#39;ve ever built had to run the web services on a different port. However if your go server is serving the static files for the angular app, you should be able to share the same port."}, {"owner": {"reputation": 151, "user_id": 6190999, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/fcbeb809f99538b1a195867a6658b126?s=128&d=identicon&r=PG&f=1", "display_name": "Nicster15", "link": "https://stackoverflow.com/users/6190999/nicster15"}, "reply_to_user": {"reputation": 3658, "user_id": 1137796, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/q4LJn.jpg?s=128&g=1", "display_name": "Judson Terrell", "link": "https://stackoverflow.com/users/1137796/judson-terrell"}, "edited": false, "score": 0, "creation_date": 1503279621, "post_id": 45788128, "comment_id": 78534485, "body": "@JudsonTerrell Would you mind showing me an example? I tried that and it seemed to just give me a blank white page."}, {"owner": {"reputation": 3658, "user_id": 1137796, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/q4LJn.jpg?s=128&g=1", "display_name": "Judson Terrell", "link": "https://stackoverflow.com/users/1137796/judson-terrell"}, "edited": false, "score": 0, "creation_date": 1503279727, "post_id": 45788128, "comment_id": 78534505, "body": "Why are using cookies as opposed to headers etc"}, {"owner": {"reputation": 3658, "user_id": 1137796, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/q4LJn.jpg?s=128&g=1", "display_name": "Judson Terrell", "link": "https://stackoverflow.com/users/1137796/judson-terrell"}, "edited": false, "score": 0, "creation_date": 1503279765, "post_id": 45788128, "comment_id": 78534518, "body": "I&#39;m mobile right now but I can try tomorrow"}, {"owner": {"reputation": 151, "user_id": 6190999, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/fcbeb809f99538b1a195867a6658b126?s=128&d=identicon&r=PG&f=1", "display_name": "Nicster15", "link": "https://stackoverflow.com/users/6190999/nicster15"}, "reply_to_user": {"reputation": 3658, "user_id": 1137796, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/q4LJn.jpg?s=128&g=1", "display_name": "Judson Terrell", "link": "https://stackoverflow.com/users/1137796/judson-terrell"}, "edited": false, "score": 0, "creation_date": 1503279909, "post_id": 45788128, "comment_id": 78534554, "body": "@JudsonTerrell Well what I&#39;m doing (and it may be unorthodox because I&#39;ve never done this whole frontend communicating to backend over different web servers -- so if it is please tell me so and what I should do instead) is pretty much when the angular page is loaded it sends a get request to the backend auth page, returning values including if the user is logged in, their username, etc. It gets all this information by reading the cookie on the website, grabbing the token key (randomly generated) along with some other stuff and grabbing the needed information from the database."}, {"owner": {"reputation": 3658, "user_id": 1137796, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/q4LJn.jpg?s=128&g=1", "display_name": "Judson Terrell", "link": "https://stackoverflow.com/users/1137796/judson-terrell"}, "edited": false, "score": 0, "creation_date": 1503280528, "post_id": 45788128, "comment_id": 78534683, "body": "You definitely need to look into using headers and session storage. I will explain more in the morning :-) also it wouldn&#39;t be a bad idea to use node server"}, {"owner": {"reputation": 151, "user_id": 6190999, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/fcbeb809f99538b1a195867a6658b126?s=128&d=identicon&r=PG&f=1", "display_name": "Nicster15", "link": "https://stackoverflow.com/users/6190999/nicster15"}, "reply_to_user": {"reputation": 3658, "user_id": 1137796, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/q4LJn.jpg?s=128&g=1", "display_name": "Judson Terrell", "link": "https://stackoverflow.com/users/1137796/judson-terrell"}, "edited": false, "score": 0, "creation_date": 1503280531, "post_id": 45788128, "comment_id": 78534684, "body": "@JudsonTerrell Just tried out static files, it seems I just receive a empty white page though rather than seeing the actual html/css/typescript content."}, {"owner": {"reputation": 3658, "user_id": 1137796, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/q4LJn.jpg?s=128&g=1", "display_name": "Judson Terrell", "link": "https://stackoverflow.com/users/1137796/judson-terrell"}, "edited": false, "score": 0, "creation_date": 1503280588, "post_id": 45788128, "comment_id": 78534700, "body": "You need a URL rewriter to send all static requests to index.html"}, {"owner": {"reputation": 3658, "user_id": 1137796, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/q4LJn.jpg?s=128&g=1", "display_name": "Judson Terrell", "link": "https://stackoverflow.com/users/1137796/judson-terrell"}, "edited": false, "score": 0, "creation_date": 1503280766, "post_id": 45788128, "comment_id": 78534741, "body": "What is &quot;Go&quot; exactly?  Can you send me a link to docs?"}, {"owner": {"reputation": 151, "user_id": 6190999, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/fcbeb809f99538b1a195867a6658b126?s=128&d=identicon&r=PG&f=1", "display_name": "Nicster15", "link": "https://stackoverflow.com/users/6190999/nicster15"}, "reply_to_user": {"reputation": 3658, "user_id": 1137796, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/q4LJn.jpg?s=128&g=1", "display_name": "Judson Terrell", "link": "https://stackoverflow.com/users/1137796/judson-terrell"}, "edited": false, "score": 0, "creation_date": 1503280777, "post_id": 45788128, "comment_id": 78534743, "body": "@JudsonTerrell I did the following: \trouter.Use(static.Serve(&quot;/&quot;, static.LocalFile(&quot;./../frontend/src&quot;, true)))  Inside of the src directory is where the index.html is (and I&#39;ve confirmed this path is correct)."}, {"owner": {"reputation": 3658, "user_id": 1137796, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/q4LJn.jpg?s=128&g=1", "display_name": "Judson Terrell", "link": "https://stackoverflow.com/users/1137796/judson-terrell"}, "edited": false, "score": 0, "creation_date": 1503280820, "post_id": 45788128, "comment_id": 78534755, "body": "Don&#39;t you need app.use? Router is for API requests"}, {"owner": {"reputation": 151, "user_id": 6190999, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/fcbeb809f99538b1a195867a6658b126?s=128&d=identicon&r=PG&f=1", "display_name": "Nicster15", "link": "https://stackoverflow.com/users/6190999/nicster15"}, "reply_to_user": {"reputation": 3658, "user_id": 1137796, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/q4LJn.jpg?s=128&g=1", "display_name": "Judson Terrell", "link": "https://stackoverflow.com/users/1137796/judson-terrell"}, "edited": false, "score": 0, "creation_date": 1503281086, "post_id": 45788128, "comment_id": 78534803, "body": "@JudsonTerrell I&#39;m not using Node which you may think, I&#39;m using Golang"}, {"owner": {"reputation": 3658, "user_id": 1137796, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/q4LJn.jpg?s=128&g=1", "display_name": "Judson Terrell", "link": "https://stackoverflow.com/users/1137796/judson-terrell"}, "edited": false, "score": 0, "creation_date": 1503281119, "post_id": 45788128, "comment_id": 78534810, "body": "I see. I can only help you conceptually then :-("}, {"owner": {"reputation": 3658, "user_id": 1137796, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/q4LJn.jpg?s=128&g=1", "display_name": "Judson Terrell", "link": "https://stackoverflow.com/users/1137796/judson-terrell"}, "edited": false, "score": 0, "creation_date": 1503281668, "post_id": 45788128, "comment_id": 78534907, "body": "I know that in node if I serve static file from the same server instance that the APis live in, I can do what your asking, and generally for port 80  all web assets are static so even if you have theoretically a server that can run the project locally once it gets deployed the server would have to run on a different port. You could look into using Cors or something maybe and run the server under a sub domain."}, {"owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "edited": false, "score": 0, "creation_date": 1503300988, "post_id": 45788128, "comment_id": 78540956, "body": "<a href=\"https://medium.com/@thanhngvpt/golang-and-angular-2-why-not-38a398b182c\" rel=\"nofollow noreferrer\">medium.com/@thanhngvpt/golang-and-angular-2-why-not-38a398b1&zwnj;&#8203;82c</a>, use the router to serve static files which should load your angular app."}], "answers": [{"tags": [], "owner": {"reputation": 6124, "user_id": 1834562, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/f098307cc4c05d11ab971f5d3a95d905?s=128&d=identicon&r=PG", "display_name": "Rash", "link": "https://stackoverflow.com/users/1834562/rash"}, "is_accepted": false, "score": 0, "last_activity_date": 1511719408, "last_edit_date": 1511719408, "creation_date": 1511714559, "answer_id": 47498529, "question_id": 45788128, "link": "https://stackoverflow.com/questions/45788128/angular-and-go-server-on-same-port/47498529#47498529", "title": "Angular and Go Server on Same Port", "body": "<ol>\n<li><strong>If both frontend and backend are on same server (but different ports), will they share cookies?</strong>\n<br>Yes, they will, <a href=\"https://stackoverflow.com/a/16328399/1834562\">check this SO answer</a>. As per latest RFC, cookies for a given host are shared across all the ports on that host.\n<br><br></li>\n<li><strong>How to verify the user account from frontend to backend?</strong>\n<br> a) <strong>If using social authentication</strong>, check this <a href=\"https://stackoverflow.com/questions/11894506/ios-node-js-how-to-verify-passed-access-token\">SO question</a>, and this <a href=\"https://www.raymondcamden.com/2015/07/10/combining-client-side-social-login-and-server-side-authorization-with-cordova-and-node\" rel=\"nofollow noreferrer\">great article</a>. In short, your frontend gets the access token from OAuth and passes it to backend which can call the OAuth provider (e.g. Graph API) to verify the access token. Create a new session and pass to frontend.\n<br><br> b) <strong>If NOT using social authentication</strong>, your users will enter their username/password which the frontend will receive. It can pass those credentials to backend, which will then generate a session and pass  to frontend.\n<br><br> c) In both a) and b), the frontend is creating cookie with session information given by backend. On every user request frontend would receive the cookie, hence the frontend would have to validate session with backend on every user request.\n<br><br> d) A better way is to replace <code>cookies</code> with <code>JWT Tokens</code> but the flow would remain the same.</li>\n</ol>\n"}], "owner": {"reputation": 151, "user_id": 6190999, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/fcbeb809f99538b1a195867a6658b126?s=128&d=identicon&r=PG&f=1", "display_name": "Nicster15", "link": "https://stackoverflow.com/users/6190999/nicster15"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 473, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1511719408, "creation_date": 1503277021, "question_id": 45788128, "link": "https://stackoverflow.com/questions/45788128/angular-and-go-server-on-same-port", "title": "Angular and Go Server on Same Port", "body": "<p>I'm creating a web project where I am intergrating both Angular, for the frontend, and Go for the backend. With the backend I need to use the HTTP web server in order to display data using a RESTAPI, however, my issue is that I cannot run both servers on port 80 (which is basic knowledge). But I was wondering if there was a work around to this. I prefix all my backend pages with the prefix /backend/ (so for example <a href=\"https://example.com/backend/auth\" rel=\"nofollow noreferrer\">https://example.com/backend/auth</a>), therefore there shouldn't be any file/page collisions taking place. </p>\n\n<p>One of the main reasons I am trying to accomplish this is because I want to set the cookies for the site in the backend as it'd be far easier and less complex for my situation, but I'm not sure how to because unless they are on the same port they would not share the same cookies.</p>\n\n<p>Any help would be greatly appreciated, thank you.</p>\n"}, {"tags": ["templates", "recursion", "go"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1503285628, "post_id": 45788051, "comment_id": 78535580, "body": "How do you define <code>Replies</code>? Is it a slice of slice or what? Please add minimum working <code>go</code> example."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1503320558, "post_id": 45788051, "comment_id": 78553270, "body": "<code>$</code> references whatever was passed to the template, which is what the template has access to. If the template needs access to something else, it must be reachable from <code>$</code> as a field. Objects do not have &quot;parents&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 988, "user_id": 6149170, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bc071a84d9b5d4ec115745e1d0922b29?s=128&d=identicon&r=PG", "display_name": "hermancain", "link": "https://stackoverflow.com/users/6149170/hermancain"}, "edited": false, "score": 0, "creation_date": 1503323700, "post_id": 45789781, "comment_id": 78555684, "body": "I didn&#39;t ask for &quot;magic&quot;, I asked for logic. Is there a way to set the field of the child of the parent recursively based on the parents data? This shouldn&#39;t require &quot;magic&quot; . We&#39;re talking about scope."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 988, "user_id": 6149170, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bc071a84d9b5d4ec115745e1d0922b29?s=128&d=identicon&r=PG", "display_name": "hermancain", "link": "https://stackoverflow.com/users/6149170/hermancain"}, "edited": false, "score": 0, "creation_date": 1503329992, "post_id": 45789781, "comment_id": 78559980, "body": "@hermancain The question in your comment is totally different from the original one. Any just because you do not like the answer it still holds. No, absolutely impossible."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 0, "last_activity_date": 1503292873, "creation_date": 1503292873, "answer_id": 45789781, "question_id": 45788051, "link": "https://stackoverflow.com/questions/45788051/accessing-variable-from-parent-object-in-go-html-template/45789781#45789781", "title": "Accessing variable from parent object in go html template", "body": "<p>Whatever you want to access in a template must be passed to it. There is no such thing as \"this struct originally was a field of some other struct and I want to magically access this other struct\". </p>\n"}], "owner": {"reputation": 988, "user_id": 6149170, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bc071a84d9b5d4ec115745e1d0922b29?s=128&d=identicon&r=PG", "display_name": "hermancain", "link": "https://stackoverflow.com/users/6149170/hermancain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1503324177, "creation_date": 1503275931, "last_edit_date": 1503324177, "question_id": 45788051, "link": "https://stackoverflow.com/questions/45788051/accessing-variable-from-parent-object-in-go-html-template", "title": "Accessing variable from parent object in go html template", "body": "<p>I have recursive go html templates for showing replies to a post, the top parent object contains a field called <code>Random</code> and a field called <code>Replies</code>, I recurse over the replies, which don't have the <code>Random</code> field, but I want to use that same <code>Random</code> field in each reply. </p>\n\n<p>When I try this it only goes two replies deep (I assume because <code>$</code> only references the parent object and not the \"top\" parent object.</p>\n\n<p>EDIT: More code. <code>thread</code> is the original object passed to the template, <code>thread.Replies</code> are looped over recursively, but don't contain the <code>thread.Random</code> string. I want to make the <code>thread.Random</code> string available globally to all the children without restructuring the structs.</p>\n\n<pre><code>type thread struct {\n    Random string\n    Body string\n    Title string\n    Replies []*reply\n}\n\ntype reply struct {\n    Body string\n    Title string\n    Replies []*reply\n}\n</code></pre>\n\n<p>Template:</p>\n\n<pre><code>&lt;html&gt;                                                    \n  &lt;body&gt;                                                  \n  &lt;div id=\"posts\"&gt;\n    &lt;p&gt;.Title&lt;/p&gt;\n    &lt;p&gt;.Body&lt;/p&gt;                                        \n    {{define \"replies\"}}                                  \n    &lt;ul&gt;                                                  \n      {{ range $key, $value := .Replies }}               \n        &lt;p&gt;$value.Title&lt;/p&gt;                               \n        &lt;p&gt;$value.Body&lt;/p&gt;                                \n        &lt;p&gt;$.Random&lt;/p&gt;                                   \n        {{template \"replies\" . }}                         \n        &lt;/li&gt;                                             \n      {{end}}                                             \n    &lt;/ul&gt;                                                 \n    {{end}}                                               \n\n  &lt;div id=\"posts\"&gt;                                        \n    &lt;div class=\"replyPost\"&gt;{{ template \"replies\" .}}&lt;/div&gt;\n  &lt;/div&gt;                                                  \n  &lt;/body&gt;                                                 \n&lt;/html&gt;                                                   \n</code></pre>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1503300923, "post_id": 45787965, "comment_id": 78540913, "body": "Have you considered testing with your db? This is more like an integration test than a unit test."}], "answers": [{"tags": [], "owner": {"reputation": 493, "user_id": 5532956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/147ed2cc994f32b17fe76739de0d09c9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Brocklehurst", "link": "https://stackoverflow.com/users/5532956/adam-brocklehurst"}, "is_accepted": false, "score": 0, "last_activity_date": 1503326450, "creation_date": 1503326450, "answer_id": 45799921, "question_id": 45787965, "link": "https://stackoverflow.com/questions/45787965/how-to-properly-test-a-handler-that-calls-another-function-inside-of-it/45799921#45799921", "title": "How to properly test a handler that calls another function inside of it", "body": "<p>To use mocks for testing you need to create an interface that your mock can implement. Naturally, the struct you're replacing the mock with also needs to implement all the methods of the interface so that they are freely interchangeable. </p>\n\n<p>For example, you could have an interface:</p>\n\n<pre><code>type DBInterface interface {\n    InsertUser(string, string, string)\n    //all other methods on the DB struct here  \n}\n</code></pre>\n\n<p>Then your DB struct already implements all the methods of the interface. From there you can create a mock struct that also implements the interface.</p>\n\n<pre><code>type DBMock struct {}\n\nfunc (dbm *DBMock) InsertUser(username, password, email string) {\n    //whatever mock functionality you want here\n    return\n} \n\n//all other methods also implemented.\n</code></pre>\n\n<p>Then you can alter env to have a pointer to a DBInterface instead of a DB. When you setup the env to be passed into the handler, in the production version use the DB struct and in testing use the DBMock struct.</p>\n"}], "owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 77, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1503326450, "creation_date": 1503274760, "question_id": 45787965, "link": "https://stackoverflow.com/questions/45787965/how-to-properly-test-a-handler-that-calls-another-function-inside-of-it", "title": "How to properly test a handler that calls another function inside of it", "body": "<p>I am looking to test the PostUser function that looks something like this (error handling omitted for simplicity):</p>\n\n<pre><code>func PostUser(env *Env, w http.ResponseWriter, req *http.Request) error {\n\n    decoder := json.NewDecoder(req.Body) \n    decoder.Decode(&amp;user)\n\n    if len(user.Username) &lt; 2 || len(user.Username) &gt; 30 {\n        return StatusError{400, errors.New(\"usernames need to be more than 2 characters and less than 30 characters\")}\n    }\n    emailRe := regexp.MustCompile(`^[a-z0-9._%+\\-]+@[a-z0-9.\\-]+\\.[a-z]{2,4}$`)\n    if !emailRe.MatchString(user.Email) {\n        return StatusError{400, errors.New(\"invalid email address\")}\n    }\n    if len(user.Password) &lt; 8 {\n        return StatusError{400, errors.New(\"passwords need to be more at least 8 characters\")}\n    }\n\n    hashedPassword,_ := bcrypt.GenerateFromPassword([]byte(user.Password), 12)\n\n\n    env.DB.InsertUser(user.Username, hashedPassword, user.Email) // need to mock this out\n\n\n    userData,_ := json.Marshal(user)\n\n\n    defer req.Body.Close()\n\n    w.Write(userData)\n\n    return nil\n}\n</code></pre>\n\n<p>My <code>env.go</code> file looks like this:</p>\n\n<pre><code>type Env struct {\n    DB *db.DB\n}\n</code></pre>\n\n<p>My <code>db.go</code> file looks like this:</p>\n\n<pre><code>type DB struct {\n    Session *mgo.Session\n}\n</code></pre>\n\n<p>How do I mock the InsertUser call by my DB struct, so that I can unit test the PostUser?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1503270747, "post_id": 45787405, "comment_id": 78532923, "body": "Go&#39;s value semantics might be what&#39;s surprising you here; the <code>append</code> and variable assignment actually make copies of your struct. I&#39;ll explain in an answer."}], "answers": [{"tags": [], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "is_accepted": false, "score": 1, "last_activity_date": 1503271515, "last_edit_date": 1503271515, "creation_date": 1503271212, "answer_id": 45787606, "question_id": 45787405, "link": "https://stackoverflow.com/questions/45787405/discrepancy-of-pointer-content-in-golang/45787606#45787606", "title": "Discrepancy of pointer content in golang", "body": "<p>It's because <code>mut</code> in <code>myStruct</code> is already a pointer <code>*sync.RWMutex</code>, so when you do:</p>\n\n<pre><code>&amp;mystructinstance2.mut\n</code></pre>\n\n<p>You are actually getting a new pointer to <code>mut</code> which is a pointer to the mutex something like <code>**sync.RWMutex</code>. Just remove the <code>&amp;</code> on the print statements. When you use <code>k := &amp;sync.RWMutex{}</code> to create the mutex it's already a pointer, so you shouldn't use <code>&amp;</code> anywhere after that on that variable or it will create a new pointer to that pointer. You can also use <code>k := new(sync.RWMutex)</code> to create a pointer to a new mutex.</p>\n\n<p>You can use <code>%p</code> on Printf to print the pointer address:</p>\n\n<pre><code>fmt.Printf(\"%p\\n\", mystructinstance2.mut)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1503271628, "post_id": 45787634, "comment_id": 78533078, "body": "It doesn&#39;t matter if he copies the object containing the mutex because it&#39;s a pointer to a mutex and not the mutex itself what is contained in the object."}], "tags": [], "owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "is_accepted": false, "score": 1, "last_activity_date": 1503271640, "last_edit_date": 1503271640, "creation_date": 1503271500, "answer_id": 45787634, "question_id": 45787405, "link": "https://stackoverflow.com/questions/45787405/discrepancy-of-pointer-content-in-golang/45787634#45787634", "title": "Discrepancy of pointer content in golang", "body": "<p>Address 1 is the address of the pointer to your mutex. Address 2 is the address of your mutex. That is, 2 points to where the mutex bits live, 1 points to where the pointer in 2 lives. Printing with <code>%T</code> instead of <code>%p</code> will show you the types of the values are different.</p>\n\n<p>The <code>append</code> actually copies your struct. The struct instance is a value just like an <code>int</code> is; when you append a struct to the list, you are actually copying the values of each field inside it.</p>\n\n<p>Value semantics for structs are widely used in C and Go (and also present in e.g. C# ValueTypes), but less common in, for example, Java, JavaScript, or Python. They mean you sometimes have to think about whether things are pointers or not, but they can save you some mistakes from accidentally making a change in one place that has an effect somewhere else (aliasing), and reduce the number of pointers the garbage collector has to follow.</p>\n\n<p>Address 3 is the address of the mutex pointer in the copy of your struct created by <code>append</code>.</p>\n\n<p>The assignment to <code>mystructinstance2</code> also copies the value, so now there are three copies of it floating around. Address 4 is the address of the mutex pointer in this new instance.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1503273211, "last_edit_date": 1503273211, "creation_date": 1503272355, "answer_id": 45787724, "question_id": 45787405, "link": "https://stackoverflow.com/questions/45787405/discrepancy-of-pointer-content-in-golang/45787724#45787724", "title": "Discrepancy of pointer content in golang", "body": "<p>You want</p>\n\n<pre><code>k := elem.structList[0].mut\np1 := &amp;*k\n</code></pre>\n\n<p>or, simply,</p>\n\n<pre><code>p2 := &amp;*elem.structList[0].mut\n</code></pre>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype myStruct struct {\n    mut *sync.RWMutex\n}\n\ntype arrayOfMyStruct struct {\n    structList []myStruct\n}\n\nfunc main() {\n    k := &amp;sync.RWMutex{}\n    myStructInstance := myStruct{k}\n    fmt.Printf(\"%p\\n\", &amp;*k)\n\n    var listStruct []myStruct\n    listStruct = append(listStruct, myStructInstance)\n\n    test := &amp;arrayOfMyStruct{listStruct}\n    test.access()\n}\n\nfunc (elem *arrayOfMyStruct) access() {\n    k := elem.structList[0].mut\n    p1 := &amp;*k\n    fmt.Printf(\"%p\\n\", p1)\n    p2 := &amp;*elem.structList[0].mut\n    fmt.Printf(\"%p\\n\", p2)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>0xc4200142c0\n0xc4200142c0\n0xc4200142c0\n</code></pre>\n"}], "owner": {"reputation": 1674, "user_id": 5420686, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/2c318e16c4b5f17dd1375df8cb1425e5?s=128&d=identicon&r=PG&f=1", "display_name": "Jal", "link": "https://stackoverflow.com/users/5420686/jal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 1, "answer_count": 3, "score": -1, "last_activity_date": 1503273211, "creation_date": 1503268770, "last_edit_date": 1503270201, "question_id": 45787405, "link": "https://stackoverflow.com/questions/45787405/discrepancy-of-pointer-content-in-golang", "title": "Discrepancy of pointer content in golang", "body": "<p>Consider the following code for structs and pointer reference example.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype myStruct struct {\n    mut *sync.RWMutex\n}\n\ntype arrayOfMyStruct struct {\n   structList []myStruct\n}\n\n\nfunc main() {\n    k := &amp;sync.RWMutex{}    \n    myStructInstance := myStruct{k}\n    fmt.Printf(\"%p\", &amp;k) // address 1 -&gt; address of k\n    fmt.Println(\"\")\n    fmt.Printf(\"%p\", &amp;*k) // address 2 -&gt; address of what k points to\n    fmt.Println(\"\")\n\n    var listStruct []myStruct\n\n    listStruct = append(listStruct, myStructInstance)\n\n    test := &amp;arrayOfMyStruct{listStruct}\n\n    test.access()\n}\n\nfunc (elem *arrayOfMyStruct) access() {\n    mystructinstance := &amp;elem.structList[0]\n    mystructinstance2 := elem.structList[0]\n    fmt.Println(&amp;mystructinstance.mut) // address 3\n    fmt.Println(&amp;mystructinstance2.mut) // address 4\n}\n</code></pre>\n\n<p>Why are addresses 2 3 and 4 different? Shouldn't they be the same?</p>\n"}, {"tags": ["regex", "go"], "answers": [{"comments": [{"owner": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "edited": false, "score": 0, "creation_date": 1503266485, "post_id": 45786786, "comment_id": 78532071, "body": "This worked like a charm, thank you!. Reading up on the doc provided now."}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 5, "last_activity_date": 1503262984, "creation_date": 1503262984, "answer_id": 45786786, "question_id": 45786756, "link": "https://stackoverflow.com/questions/45786756/regex-replace-within-sub-match/45786786#45786786", "title": "Regex Replace within Sub Match", "body": "<p>You'll want to use <a href=\"https://godoc.org/regexp#Regexp.ReplaceAllStringFunc\" rel=\"noreferrer\"><code>Regexp.ReplaceAllStringFunc</code></a>, which allows you to use a function result as the replacement of a substring:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"regexp\"\n    \"strings\"\n)\n\nfunc main() {\n    logLine := `Date=2017-06-29 03:10:01.140 -700 PDT,clientDataRate=\"12.0,18.0,24.0,36.0,48.0,54.0\",host=superawesomehost.foo,foo=bar`\n    fmt.Println(\"logLine:        \", logLine)\n\n    reg, err := regexp.Compile(`\"([^\"]*)\"`)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    repairedLogLine := reg.ReplaceAllStringFunc(logLine, func(entry string) string {\n        return strings.Replace(entry, \",\", \" \", -1)\n    })\n    fmt.Println(\"repairedLogLine:\", repairedLogLine)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/BsZxcrrvaR\" rel=\"noreferrer\">https://play.golang.org/p/BsZxcrrvaR</a></p>\n"}], "owner": {"reputation": 585, "user_id": 4109882, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/05080c148683d5bcb04238ea41a7056f?s=128&d=identicon&r=PG&f=1", "display_name": "gpanda", "link": "https://stackoverflow.com/users/4109882/gpanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 632, "favorite_count": 0, "accepted_answer_id": 45786786, "answer_count": 1, "score": 2, "last_activity_date": 1503263142, "creation_date": 1503262795, "last_edit_date": 1503263142, "question_id": 45786756, "link": "https://stackoverflow.com/questions/45786756/regex-replace-within-sub-match", "title": "Regex Replace within Sub Match", "body": "<p>Given a string (a line in a log file):</p>\n\n<pre><code>Date=2017-06-29 03:10:01.140 -700 PDT,clientDataRate=\"12.0,18.0,24.0,36.0,48.0,54.0\",host=superawesomehost.foo,foo=bar\n</code></pre>\n\n<p>I'd like to replace the commas with a single space, but only within double quotes.</p>\n\n<p>Desired result:</p>\n\n<pre><code>Date=2017-06-29 03:10:01.140 -700 PDT,clientDataRate=\"12.0 18.0 24.0 36.0 48.0 54.0\",host=superawesomehost.foo,foo=bar\n</code></pre>\n\n<p>I've begun with a basic combination of regex and ReplaceAllString but am rapidly realizing I don't understand how to implement the match group (?) needed to accomplish this.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"regexp\"\n)\n\nfunc main() {\n    logLine := \"Date=2017-06-29 03:10:01.140 -700 PDT,clientDataRate=\\\"12.0,18.0,24.0,36.0,48.0,54.0\\\",host=superawesomehost.foo,foo=bar\"\n    fmt.Println(\"logLine:        \", logLine)\n\n    reg, err := regexp.Compile(\"[^A-Za-z0-9=\\\"-:]+\")\n        if err != nil {\n                log.Fatal(err)\n        }\n\n    repairedLogLine := reg.ReplaceAllString(logLine, \",\")\n    fmt.Println(\"repairedLogLine:\", repairedLogLine )   \n}\n</code></pre>\n\n<p>All help is much appreciated.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1503263763, "post_id": 45786687, "comment_id": 78531363, "body": "You must provide <b>much</b> more information. Your question is unanswerable. Look at the functions calling duffcopy and get rid of copying values is the best advice possible without more information."}], "answers": [{"tags": [], "owner": {"reputation": 113, "user_id": 6727023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aab8e3012e81630f68aeebfe9de168ba?s=128&d=identicon&r=PG&f=1", "display_name": "erken", "link": "https://stackoverflow.com/users/6727023/erken"}, "is_accepted": false, "score": 4, "last_activity_date": 1503264204, "creation_date": 1503264204, "answer_id": 45786922, "question_id": 45786687, "link": "https://stackoverflow.com/questions/45786687/runtime-duffcopy-is-called-a-lot/45786922#45786922", "title": "runtime.duffcopy is called a lot", "body": "<p>Think I just solved it. I had a look at the assembly output and saw that I had a </p>\n\n<pre><code>for _, v := range c.Items\n</code></pre>\n\n<p>an Item is a relatively big object, so I replaced above loop with</p>\n\n<pre><code>for index := 0; index &lt; len(c.Items); index++\n</code></pre>\n\n<p>and used direct access of the objects like c.Items[index]. Top now shows:</p>\n\n<pre><code>350ms  4.85% 60.47%      350ms  4.85%  runtime.duffcopy\n</code></pre>\n\n<p>The overall execution time was cut from 12s to 4s. Quite nice :)</p>\n"}], "owner": {"reputation": 113, "user_id": 6727023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aab8e3012e81630f68aeebfe9de168ba?s=128&d=identicon&r=PG&f=1", "display_name": "erken", "link": "https://stackoverflow.com/users/6727023/erken"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1421, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1503264204, "creation_date": 1503262326, "question_id": 45786687, "link": "https://stackoverflow.com/questions/45786687/runtime-duffcopy-is-called-a-lot", "title": "runtime.duffcopy is called a lot", "body": "<p>When profiling my app, and run top, I see </p>\n\n<pre><code>Showing top 10 nodes out of 31 (cum &gt;= 0.12s)\n      flat  flat%   sum%        cum   cum%\n    13.93s 63.00% 63.00%     13.93s 63.00%  runtime.duffcopy\n</code></pre>\n\n<p>I am struggling to know when and why it is called and if there is something I can do to improve this? Would you need to see the function from where these calls are made from or is there any general rule-of-thumb that I should think about?</p>\n\n<p>I have read that named return values can improve this, but its quite a big function testing a lot of conditions (returning true or false), so don't know if its a good idea to implement that.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["ssl", "docker", "go"], "comments": [{"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 0, "creation_date": 1503297345, "post_id": 45786562, "comment_id": 78538911, "body": "Are you able to curl <code>account.sloppy.zone</code> inside the container? Check that if it has access to your site inside the container or not?"}], "answers": [{"tags": [], "owner": {"reputation": 29, "user_id": 3170954, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a757b7a1c57184a128034d58180fdc0?s=128&d=identicon&r=PG&f=1", "display_name": "mikem", "link": "https://stackoverflow.com/users/3170954/mikem"}, "is_accepted": false, "score": -1, "last_activity_date": 1504687334, "creation_date": 1504687334, "answer_id": 46070574, "question_id": 45786562, "link": "https://stackoverflow.com/questions/45786562/get-net-http-tls-handshake-timeout-when-run-golang-app-on-docker-container-host/46070574#46070574", "title": "Get net/http: TLS handshake timeout when run golang app on docker container host", "body": "<p>are both services running on sloppy.io?</p>\n"}, {"tags": [], "owner": {"reputation": 329, "user_id": 5069530, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O8rSV.jpg?s=128&g=1", "display_name": "Ingo Steinke", "link": "https://stackoverflow.com/users/5069530/ingo-steinke"}, "is_accepted": false, "score": 1, "last_activity_date": 1505042559, "creation_date": 1505042559, "answer_id": 46140162, "question_id": 45786562, "link": "https://stackoverflow.com/questions/45786562/get-net-http-tls-handshake-timeout-when-run-golang-app-on-docker-container-host/46140162#46140162", "title": "Get net/http: TLS handshake timeout when run golang app on docker container host", "body": "<p>As your golang application depends on the account service, you should define this dependency in your setup and use docker\u2019s networking features to connect both services. Doing so will also give you the ability to run an arbitrary number of instances as a docker swarm or inside another scalable cluster infrastructure like sloppy.io.</p>\n\n<p>This also has the advantage that you do not need to expose your backend (account service) to the public.</p>\n\n<p>You can either use docker-compose or sloppy.io's command line interface to build and run your application. Sloppy configuration files are quite similar to <code>docker-compose.yml</code> files. See <a href=\"http://kb.sloppy.io/features/connecting-containers\" rel=\"nofollow noreferrer\">http://kb.sloppy.io/features/connecting-containers</a></p>\n\n<p>Here is an example configuration as <code>sloppy.yml</code></p>\n\n<pre><code>version: \"v1\"\nproject: \"myproject\"\nservices:\n  frontend:\n    golang_service:\n      dependencies:\n        - \"../backend/account_service\"\n      domain: \"//my_golang_service.sloppy.zone\"\n      env:\n        - ACCOUNT_HOST: \"account_service.backend.myproject\"\n      image: \"dockerhub_username/golang_service:1.0.0\"\n      port: 80\n  backend:\n    account_service:\n      image: \"dockerhub_username/account_service:1.0.0\"\n</code></pre>\n\n<p>This just covers the basic configuration. You will probably want to add volumes and environment variables. If you already have an existing docker-compose.yml, you can convert it to sloppy.yml using sloppose (<a href=\"https://github.com/sloppyio/sloppose\" rel=\"nofollow noreferrer\">github.com/sloppyio/sloppose</a>).</p>\n"}], "owner": {"reputation": 35, "user_id": 4955219, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/688645827947501/picture?type=large", "display_name": "JamesCornel", "link": "https://stackoverflow.com/users/4955219/jamescornel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1224, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1505042559, "creation_date": 1503261262, "last_edit_date": 1503271801, "question_id": 45786562, "link": "https://stackoverflow.com/questions/45786562/get-net-http-tls-handshake-timeout-when-run-golang-app-on-docker-container-host", "title": "Get net/http: TLS handshake timeout when run golang app on docker container host", "body": "<p>This is my code:</p>\n\n<pre><code>func Login(w http.ResponseWriter, r *http.Request) {\n    fmt.Println(\"Login prccessing\")\n    email := r.FormValue(\"email\")\n    password := r.FormValue(\"password\")\n    fmt.Println(email + password)\n    var netTransport = &amp;http.Transport{\n        Dial: (&amp;net.Dialer{\n            Timeout: 50 * time.Second,\n        }).Dial,\n        TLSHandshakeTimeout: 50 * time.Second,\n    }\n    var netClient = &amp;http.Client{\n        Timeout:   time.Second * 50,\n        Transport: netTransport,\n    }\n    res, err := netClient.Get(\"https://account.sloppy.zone/accounts/\" + email)\n    if err != nil {\n        fmt.Println(err.Error())\n        http.Redirect(w, r, \"/\", http.StatusSeeOther)\n    }\n\n    responeData, errs := ioutil.ReadAll(res.Body)\n    fmt.Println(string(responeData))\n    if errs != nil {\n        log.Fatal(errs)\n    }\n    var info LoginInfo\n    json.Unmarshal(responeData, &amp;info)\n    if email == info.Id &amp;&amp; password == info.Password {\n        http.Redirect(w, r, \"/manager\", http.StatusSeeOther)\n    } else {\n        http.Redirect(w, r, \"/\", http.StatusSeeOther)\n    }\n}\n</code></pre>\n\n<p>I'm trying to run service containerized with docker and deploy it on a docker container host (sloppy.io) and this service call  another service (account service) to get account and password from that service and verify them with user input  at the same host.The problem is when I login to my page then 502 Bad Gateway show up.Track to log I see error:TLS handshake timeout.</p>\n\n<p>How can I solve this?</p>\n"}, {"tags": ["go", "channel"], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": true, "score": 4, "last_activity_date": 1503259605, "last_edit_date": 1503259605, "creation_date": 1503258455, "answer_id": 45786193, "question_id": 45786042, "link": "https://stackoverflow.com/questions/45786042/go-channel-infinite-loop/45786193#45786193", "title": "Go channel infinite loop", "body": "<p><strong>1. For the first point, the infinite loop:</strong></p>\n\n<p>Citing from <a href=\"https://golang.org/ref/spec#Receive_operator\" rel=\"nofollow noreferrer\">golang language spec</a>:</p>\n\n<blockquote>\n  <p>A receive operation on a closed channel can always proceed\n  immediately, yielding the element type's zero value after any\n  previously sent values have been received.</p>\n</blockquote>\n\n<p>So in this function</p>\n\n<pre><code>func errorChannelWatch(ch chan error, list []error) {\n    for {\n        select {\n        case err := &lt;- ch:\n\n            list = append(list, err)\n        }\n    }\n}\n</code></pre>\n\n<p>after ch gets closed this turns into an infinite loop adding <code>nil</code> values to <code>list</code>.</p>\n\n<p>Try this instead:</p>\n\n<pre><code>func errorChannelWatch(ch chan error, list []error) {\n    for err := range ch {\n            list = append(list, err)\n    }\n}\n</code></pre>\n\n<p><strong>2. For the second point, why you don't see anything in your error list:</strong></p>\n\n<p>The problem is this call:</p>\n\n<pre><code>errorChannel := make(chan error)\nerrorList := []error{}\n\ngo errorChannelWatch(errorChannel, errorList)\n</code></pre>\n\n<p>Here you hand <code>errorChannelWatch</code> the <code>errorList</code> as a value. So the slice <code>errorList</code> will not be changed by the function. What is changed, is the underlying array, as long as the <code>append</code> calls don't need to allocate a new one.</p>\n\n<p>To remedy the situation, either hand a slice pointer to <code>errorChannelWatch</code> or rewrite it as a call to a closure, capturing\n<code>errorList</code>.</p>\n\n<p>For the first proposed solution, change <code>errorChannelWatch</code> to</p>\n\n<pre><code>func errorChannelWatch(ch chan error, list *[]error) {\n    for err := range ch {\n            *list = append(*list, err)\n    }\n}    \n</code></pre>\n\n<p>and the call to</p>\n\n<pre><code>errorChannel := make(chan error)\nerrorList := []error{}\n\ngo errorChannelWatch(errorChannel, &amp;errorList)\n</code></pre>\n\n<p>For the second proposed solution, just change the call to</p>\n\n<pre><code>   errorChannel := make(chan error)\n   errorList := []error{}\n\n   go func() {\n      for err := range errorChannel {\n          errorList = append(errorList, err)\n      }\n   } () \n</code></pre>\n\n<p><strong>3. A minor remark:</strong></p>\n\n<p>One could think, that there is a synchronisation problem here:</p>\n\n<pre><code>fileWaitGroup.Wait()\n\nclose(errorChannel)\n\nlog.Println(errorList)\n</code></pre>\n\n<p>How can you be sure, that errorList isn't modified, after the call to close? One could reason, that you can't know, how many values the goroutine <code>errorChannelWatch</code> still has to process.</p>\n\n<p>Your synchronisation seems correct to me, as you do the <code>wg.Done()</code>\nafter the send to the error channel and so all error values will\nbe sent, when <code>fileWaitGroup.Wait()</code> returns.</p>\n\n<p>But that can change, if someone later adds a buffering to the error\nchannel or alters the code.</p>\n\n<p>So I would advise to at least explain the synchronisation in a comment.</p>\n"}], "owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7464, "favorite_count": 0, "accepted_answer_id": 45786193, "answer_count": 1, "score": 0, "last_activity_date": 1503259605, "creation_date": 1503257350, "question_id": 45786042, "link": "https://stackoverflow.com/questions/45786042/go-channel-infinite-loop", "title": "Go channel infinite loop", "body": "<p>I am trying to catch errors from a group of goroutines using a channel, but the channel enters an infinite loop, starts consuming CPU.</p>\n\n<pre><code>func UnzipFile(f *bytes.Buffer, location string) error {\n    zipReader, err := zip.NewReader(bytes.NewReader(f.Bytes()), int64(f.Len()))\n\n    if err != nil {\n        return err\n    }\n\n    if err := os.MkdirAll(location, os.ModePerm); err != nil {\n        return err\n    }\n\n    errorChannel := make(chan error)\n    errorList := []error{}\n\n    go errorChannelWatch(errorChannel, errorList)\n\n    fileWaitGroup := &amp;sync.WaitGroup{}\n\n    for _, file := range zipReader.File {\n        fileWaitGroup.Add(1)\n        go writeZipFileToLocal(file, location, errorChannel, fileWaitGroup)\n    }\n\n    fileWaitGroup.Wait()\n\n    close(errorChannel)\n\n    log.Println(errorList)\n\n    return nil\n}\n\nfunc errorChannelWatch(ch chan error, list []error) {\n    for {\n        select {\n        case err := &lt;- ch:\n\n            list = append(list, err)\n        }\n    }\n}\n\nfunc writeZipFileToLocal(file *zip.File, location string, ch chan error, wg *sync.WaitGroup) {\n    defer wg.Done()\n\n    zipFilehandle, err := file.Open()\n\n    if err != nil {\n        ch &lt;- err\n        return\n    }\n\n    defer zipFilehandle.Close()\n\n    if file.FileInfo().IsDir() {\n        if err := os.MkdirAll(filepath.Join(location, file.Name), os.ModePerm); err != nil {\n            ch &lt;- err\n        }\n        return\n    }\n\n    localFileHandle, err := os.OpenFile(filepath.Join(location, file.Name), os.O_WRONLY|os.O_CREATE|os.O_TRUNC, file.Mode())\n\n    if err != nil {\n        ch &lt;- err\n        return\n    }\n\n    defer localFileHandle.Close()\n\n    if _, err := io.Copy(localFileHandle, zipFilehandle); err != nil {\n        ch &lt;- err\n        return\n    }\n\n    ch &lt;- fmt.Errorf(\"Test error\")\n}\n</code></pre>\n\n<p>So I am looping a slice of files and writing them to my disk, when there is an error I report back to the <code>errorChannel</code> to save that error into a slice.</p>\n\n<p>I use a <code>sync.WaitGroup</code> to wait for all goroutines and when they are done I want to print <code>errorList</code> and check if there was any error during the execution.</p>\n\n<p>The list is always empty, even if I add <code>ch &lt;- fmt.Errorf(\"test\")</code> at the end of <code>writeZipFileToLocal</code> and the channel always hangs up.</p>\n\n<p>I am not sure what I am missing here.</p>\n"}, {"tags": ["matrix", "go"], "comments": [{"owner": {"reputation": 700, "user_id": 5668464, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/caaa9a33119f603eebf2ace9844c61c2?s=128&d=identicon&r=PG&f=1", "display_name": "ArafatK", "link": "https://stackoverflow.com/users/5668464/arafatk"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1503255103, "post_id": 45785639, "comment_id": 78529069, "body": "I am guessing you are referring to the semantics in a different way. I am new to golang but in every other language the dimension [2,4] seems okay"}], "answers": [{"comments": [{"owner": {"reputation": 700, "user_id": 5668464, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/caaa9a33119f603eebf2ace9844c61c2?s=128&d=identicon&r=PG&f=1", "display_name": "ArafatK", "link": "https://stackoverflow.com/users/5668464/arafatk"}, "edited": false, "score": 0, "creation_date": 1503254975, "post_id": 45785661, "comment_id": 78529028, "body": "I know. I am more concerned about an n-dimensional case."}, {"owner": {"reputation": 6023, "user_id": 4236078, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/9959d878feda9f2bab4b43b554e09847?s=128&d=identicon&r=PG&f=1", "display_name": "ale64bit", "link": "https://stackoverflow.com/users/4236078/ale64bit"}, "reply_to_user": {"reputation": 700, "user_id": 5668464, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/caaa9a33119f603eebf2ace9844c61c2?s=128&d=identicon&r=PG&f=1", "display_name": "ArafatK", "link": "https://stackoverflow.com/users/5668464/arafatk"}, "edited": false, "score": 2, "creation_date": 1503255070, "post_id": 45785661, "comment_id": 78529060, "body": "@ArafatK the same reasoning applies for  any number of dimensions. A slice of slices (of slices...) is not a matrix, in mathematical sense. The lengths of inners slices can be different; they can even change."}], "tags": [], "owner": {"reputation": 6023, "user_id": 4236078, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/9959d878feda9f2bab4b43b554e09847?s=128&d=identicon&r=PG&f=1", "display_name": "ale64bit", "link": "https://stackoverflow.com/users/4236078/ale64bit"}, "is_accepted": true, "score": 2, "last_activity_date": 1503254608, "creation_date": 1503254608, "answer_id": 45785661, "question_id": 45785639, "link": "https://stackoverflow.com/questions/45785639/how-to-find-the-dimensions-of-a-2-3-or-if-possible-an-ndimensional-slice-in-go/45785661#45785661", "title": "How to find the dimensions of a (2,3 or if possible an n)dimensional slice in golang and verify if its a matrix?", "body": "<p>The outer dimension is just <code>len(x)</code> where <code>x</code> is the slice of slices you pass to the function (your example <code>[][]float64{{11, 5, 14, 1}, {11, 5, 14, 1}}</code>).\nHowever, the inner dimensions are not guaranteed to be equal so you will have to go through each element and check what <code>len</code> they have.</p>\n\n<p>If you have the guarantee than each element of <code>x</code> has the same number of elements, just find <code>len(x[0])</code> if <code>len(x) &gt; 0</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1503265956, "creation_date": 1503265956, "answer_id": 45787105, "question_id": 45785639, "link": "https://stackoverflow.com/questions/45785639/how-to-find-the-dimensions-of-a-2-3-or-if-possible-an-ndimensional-slice-in-go/45787105#45787105", "title": "How to find the dimensions of a (2,3 or if possible an n)dimensional slice in golang and verify if its a matrix?", "body": "<p>Go only provides 1-dimensional arrays and slices.  N-dimensional arrays can be emulated by using arrays of arrays, which is close to what what you're doing--you have a 1-dimensional slice, which contains 2 1-dimensional slices.</p>\n\n<p>This is problematic, because slices are not of a defined length.  So you could end up with slices of wildly different lengths:</p>\n\n<pre><code>[][]float64{\n    {1, 2, 3, 4},\n    {5, 6, 7, 8, 9, 10},\n}\n</code></pre>\n\n<p>If you use actual arrays, this is simpler, because arrays have a fixed length:</p>\n\n<p><code>[2][4]float64</code></p>\n\n<p>You can extend this to as many dimensions as you want:</p>\n\n<p><code>[2][4][8]float64</code> provides three dimensions, with respective depths of 2, 4, and 8.</p>\n\n<p>Then you can tell the capacity of each dimension by using the built-in <code>len()</code> function on any of the elements:</p>\n\n<pre><code>foo := [2][4][7]float64{}\nx := len(foo)       // x == 2\ny := len(foo[0])    // y == 4\nz := len(foo[0][0]) // z == 8\n</code></pre>\n"}], "owner": {"reputation": 700, "user_id": 5668464, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/caaa9a33119f603eebf2ace9844c61c2?s=128&d=identicon&r=PG&f=1", "display_name": "ArafatK", "link": "https://stackoverflow.com/users/5668464/arafatk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 642, "favorite_count": 0, "accepted_answer_id": 45785661, "answer_count": 2, "score": -2, "last_activity_date": 1503265956, "creation_date": 1503254436, "last_edit_date": 1503255004, "question_id": 45785639, "link": "https://stackoverflow.com/questions/45785639/how-to-find-the-dimensions-of-a-2-3-or-if-possible-an-ndimensional-slice-in-go", "title": "How to find the dimensions of a (2,3 or if possible an n)dimensional slice in golang and verify if its a matrix?", "body": "<p>For example : <code>[][]float64{{11, 5, 14, 1}, {11, 5, 14, 1}}</code> has dimensions <code>[2,4]</code>. </p>\n\n<p>If this is passed to a function then what is the most efficient way to find the dimension here?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3"], "answers": [{"comments": [{"owner": {"reputation": 67, "user_id": 6938216, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/EIunb.png?s=128&g=1", "display_name": "Francis Sunday", "link": "https://stackoverflow.com/users/6938216/francis-sunday"}, "edited": false, "score": 0, "creation_date": 1503256615, "post_id": 45785202, "comment_id": 78529489, "body": "Thanks for the input, does this work for private objects?"}], "tags": [], "owner": {"reputation": 31539, "user_id": 367985, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/761edb9c3cf7a0a643e73ef40666a1f7?s=128&d=identicon&r=PG", "display_name": "CuriousMind", "link": "https://stackoverflow.com/users/367985/curiousmind"}, "is_accepted": false, "score": 1, "last_activity_date": 1503251709, "creation_date": 1503251709, "answer_id": 45785202, "question_id": 45785038, "link": "https://stackoverflow.com/questions/45785038/generate-torrent-from-bucket-via-go-sdk-amazon-s3/45785202#45785202", "title": "Generate Torrent from Bucket via Go SDK (Amazon S3)", "body": "<p>Try <code>GetOBjectTorrent</code> method on the AWS Go SDK. It will return you <code>.torrent</code> file in response, here is example code:</p>\n\n<pre><code>svc := s3.New(session.New())\ninput := &amp;s3.GetObjectTorrentInput{\n    Bucket: aws.String(\"bucketName\"),\n    Key:    aws.String(\"key\"),\n}\n\nresult, _ := svc.GetObjectTorrent(input)\nfmt.Println(result)\n</code></pre>\n\n<p>Please see <a href=\"http://docs.aws.amazon.com/sdk-for-go/api/service/s3/#S3.GetObjectTorrent\" rel=\"nofollow noreferrer\">http://docs.aws.amazon.com/sdk-for-go/api/service/s3/#S3.GetObjectTorrent</a> for more details. Hope it helps.</p>\n"}], "owner": {"reputation": 67, "user_id": 6938216, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/EIunb.png?s=128&g=1", "display_name": "Francis Sunday", "link": "https://stackoverflow.com/users/6938216/francis-sunday"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1503251709, "creation_date": 1503250628, "question_id": 45785038, "link": "https://stackoverflow.com/questions/45785038/generate-torrent-from-bucket-via-go-sdk-amazon-s3", "title": "Generate Torrent from Bucket via Go SDK (Amazon S3)", "body": "<p>I'm trying to figure out a way to generate torrent files from a bucket, using the AWS SDK for Go.</p>\n\n<p>I'm using a pre-signed url (since its a private bucket):</p>\n\n<pre><code>svc := s3.New(session.New(config))\n    req, _ := svc.GetObjectRequest(&amp;s3.GetObjectInput{\n        Bucket: aws.String(\"bucketName\"),\n        Key:    \"key\",\n    })\n    // sign the url\n    url, err := req.Presign(120 * time.Minute)\n</code></pre>\n\n<p>From the docs, to generate a torrent, the syntax:</p>\n\n<pre><code>GET /ObjectName?torrent HTTP/1.1\nHost: BucketName.s3.amazonaws.com\nDate: date\nAuthorization: authorization string\n</code></pre>\n\n<p>How do I add the <code>?torrent</code> parameter to a presigned url in GO?</p>\n"}, {"tags": ["go", "concurrency", "benchmarking", "goroutine"], "comments": [{"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "edited": false, "score": 0, "creation_date": 1503249088, "post_id": 45784722, "comment_id": 78527073, "body": "I don&#39;t know what the race is, but as an aside, you should really use <code>defer</code> to unlock your mutex (in case there&#39;s a panic)."}, {"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "edited": false, "score": 0, "creation_date": 1503249385, "post_id": 45784722, "comment_id": 78527167, "body": "Also not the race, but <code>i &lt;= int(bucketSize)</code> should be <code>i &lt; int(bucketSize)</code>."}, {"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "edited": false, "score": 0, "creation_date": 1503250509, "post_id": 45784722, "comment_id": 78527498, "body": "I think line 88 of the file you linked to explains why <code>readerCount</code> is a low negative number."}, {"owner": {"reputation": 169, "user_id": 6513915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04fcbd92e7c84194bdb9b93197e64337?s=128&d=identicon&r=PG&f=1", "display_name": "J L", "link": "https://stackoverflow.com/users/6513915/j-l"}, "reply_to_user": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "edited": false, "score": 0, "creation_date": 1503251642, "post_id": 45784722, "comment_id": 78527927, "body": "@smarx oh readerCount now make sense, thanks for pointing that out, and thanks for pointing out the boundary logic error I had earlier"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1503252212, "post_id": 45784722, "comment_id": 78528102, "body": "Run <code>go vet</code> on your code. You&#39;re copying the Mutexes and WaitGroups, and you can&#39;t add to the wait group after the goroutine is already dispatched."}, {"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "edited": false, "score": 0, "creation_date": 1503252219, "post_id": 45784722, "comment_id": 78528105, "body": "The <code>print</code> output seems fine to me... there are multiple <code>maps</code>, so multiple goroutines can simultaneously be making modifications (as long as they&#39;re not modifying the same map). Similarly, there should be <i>n</i> different locks for the <i>n</i> different <code>maps</code>, so the different addresses seem fine."}, {"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1503252360, "post_id": 45784722, "comment_id": 78528149, "body": "Oh, I think @JimB nails it with the comment about copying... I believe you could also fix this by putting pointers to <code>ThreadSafeMap</code>s in your <code>ConcurrentMap</code> instead."}, {"owner": {"reputation": 169, "user_id": 6513915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04fcbd92e7c84194bdb9b93197e64337?s=128&d=identicon&r=PG&f=1", "display_name": "J L", "link": "https://stackoverflow.com/users/6513915/j-l"}, "reply_to_user": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "edited": false, "score": 0, "creation_date": 1503252541, "post_id": 45784722, "comment_id": 78528205, "body": "@smarx sorry I should clarify that I fixed the bucket index by inserting the same element for all goroutines, that is why it is weird."}, {"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1503252748, "post_id": 45784722, "comment_id": 78528269, "body": "Ah, sorry. Then I think @JimB&#39;s comment explains what you saw (different locks because they were copied)."}, {"owner": {"reputation": 169, "user_id": 6513915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04fcbd92e7c84194bdb9b93197e64337?s=128&d=identicon&r=PG&f=1", "display_name": "J L", "link": "https://stackoverflow.com/users/6513915/j-l"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1503252937, "post_id": 45784722, "comment_id": 78528335, "body": "@JimB @smarx Sorry, I think I am not getting it, why is passing <code>waitgroup</code> to a function influencing the <code>mutex</code> in the struct?"}, {"owner": {"reputation": 169, "user_id": 6513915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04fcbd92e7c84194bdb9b93197e64337?s=128&d=identicon&r=PG&f=1", "display_name": "J L", "link": "https://stackoverflow.com/users/6513915/j-l"}, "reply_to_user": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "edited": false, "score": 0, "creation_date": 1503253323, "post_id": 45784722, "comment_id": 78528456, "body": "@smarx I think this line <code>ThreadSafeMap{sync.RWMutex{}, make(map[string]interface{})}</code> should ensure I get a new mutex for every bucket"}], "answers": [{"tags": [], "owner": {"reputation": 440, "user_id": 4336585, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-PIrUxm4BD-4/AAAAAAAAAAI/AAAAAAAAALc/affxVlztquE/photo.jpg?sz=128", "display_name": "rabhis", "link": "https://stackoverflow.com/users/4336585/rabhis"}, "is_accepted": false, "score": 1, "last_activity_date": 1503602191, "creation_date": 1503602191, "answer_id": 45869357, "question_id": 45784722, "link": "https://stackoverflow.com/questions/45784722/golang-data-race-even-with-mutex-for-custom-concurrent-maps/45869357#45869357", "title": "Golang data race even with mutex for custom concurrent maps", "body": "<p>The problem is with the statement</p>\n\n<pre><code>bucket := cMap.buckets[bucketIndex]\n</code></pre>\n\n<p><code>bucket</code> now contains copy of the <code>ThreadSafeMap</code> at that index. As <code>sync.RWMutex</code> is stored as value, a copy of it is made while assigning. But map  maps hold references to an underlying data structure, so the copy of the pointer or the same map is passed. The code locks a copy of the lock while writing to a single map, which cause the problem.</p>\n\n<p>Thats why you don't face any problem when you change <code>sync.RWMutex</code> to <code>*sync.RWMutex</code>. It's better to store reference to structure in map as shown.</p>\n\n<pre><code>package concurrent_hashmap\n\nimport (\n    \"hash/fnv\"\n    \"sync\"\n)\n\ntype ConcurrentMap struct {\n    buckets     []*ThreadSafeMap\n    bucketCount uint32\n}\n\ntype ThreadSafeMap struct {\n    mapLock sync.RWMutex\n    hashMap map[string]interface{}\n}\n\nfunc NewConcurrentMap(bucketSize uint32) *ConcurrentMap {\n    var threadSafeMapInstance *ThreadSafeMap\n    var bucketOfThreadSafeMap []*ThreadSafeMap\n\n    for i := 0; i &lt;= int(bucketSize); i++ {\n        threadSafeMapInstance = &amp;ThreadSafeMap{sync.RWMutex{}, make(map[string]interface{})}\n        bucketOfThreadSafeMap = append(bucketOfThreadSafeMap, threadSafeMapInstance)\n    }\n\n    return &amp;ConcurrentMap{bucketOfThreadSafeMap, bucketSize}\n}\n\nfunc (cMap *ConcurrentMap) Put(key string, val interface{}) {\n    bucketIndex := hash(key) % cMap.bucketCount\n    bucket := cMap.buckets[bucketIndex]\n    bucket.mapLock.Lock()\n    bucket.hashMap[key] = val\n    bucket.mapLock.Unlock()\n}\n\n// Helper\nfunc hash(s string) uint32 {\n    h := fnv.New32a()\n    h.Write([]byte(s))\n    return h.Sum32()\n}\n</code></pre>\n\n<p>It's possible to validate the scenario by modifying the function <code>Put</code> as follows</p>\n\n<pre><code>func (cMap *ConcurrentMap) Put(key string, val interface{}) {\n    //fmt.Println(\"index\", key)\n    bucketIndex := 1\n    bucket := cMap.buckets[bucketIndex]\n    fmt.Printf(\"%p %p\\n\", &amp;(bucket.mapLock), bucket.hashMap)\n}\n</code></pre>\n"}], "owner": {"reputation": 169, "user_id": 6513915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04fcbd92e7c84194bdb9b93197e64337?s=128&d=identicon&r=PG&f=1", "display_name": "J L", "link": "https://stackoverflow.com/users/6513915/j-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1060, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1503602191, "creation_date": 1503248615, "last_edit_date": 1503251469, "question_id": 45784722, "link": "https://stackoverflow.com/questions/45784722/golang-data-race-even-with-mutex-for-custom-concurrent-maps", "title": "Golang data race even with mutex for custom concurrent maps", "body": "<p>Here is a simple concurrent map that I wrote for learning purpose</p>\n\n<pre><code>    package concurrent_hashmap\n\n    import (\n        \"hash/fnv\"\n        \"sync\"\n    )\n\n    type ConcurrentMap struct {\n        buckets []ThreadSafeMap\n        bucketCount uint32\n    }\n\n    type ThreadSafeMap struct {\n        mapLock sync.RWMutex\n        hashMap map[string]interface{}\n    }\n\n    func NewConcurrentMap(bucketSize uint32) *ConcurrentMap {\n        var threadSafeMapInstance ThreadSafeMap\n        var bucketOfThreadSafeMap []ThreadSafeMap\n\n        for i := 0; i &lt;= int(bucketSize); i++ {\n            threadSafeMapInstance = ThreadSafeMap{sync.RWMutex{}, make(map[string]interface{})}\n            bucketOfThreadSafeMap = append(bucketOfThreadSafeMap, threadSafeMapInstance)\n        }\n\n        return &amp;ConcurrentMap{bucketOfThreadSafeMap, bucketSize}\n    }\n\n    func (cMap *ConcurrentMap) Put(key string, val interface{}) {\n        bucketIndex := hash(key) % cMap.bucketCount\n        bucket := cMap.buckets[bucketIndex]\n        bucket.mapLock.Lock()\n        bucket.hashMap[key] = val\n        bucket.mapLock.Unlock()\n    }\n\n    // Helper\n    func hash(s string) uint32 {\n        h := fnv.New32a()\n        h.Write([]byte(s))\n        return h.Sum32()\n    }\n</code></pre>\n\n<p>I am trying to write a simple benchmark and I find that synchronize access will work correctly but concurrent access will get </p>\n\n<pre><code>fatal error: concurrent map writes\n</code></pre>\n\n<p>Here is my benchmark run with <code>go test -bench=. -race</code></p>\n\n<pre><code>package concurrent_hashmap\n\nimport (\n    \"testing\"\n    \"runtime\"\n    \"math/rand\"\n    \"strconv\"\n    \"sync\"\n)\n// Concurrent does not work\nfunc BenchmarkMyFunc(b *testing.B) {\n    var wg sync.WaitGroup\n\n    runtime.GOMAXPROCS(runtime.NumCPU())\n\n    my_map := NewConcurrentMap(uint32(4))\n    for n := 0; n &lt; b.N; n++ {\n        go insert(my_map, wg)\n    }\n    wg.Wait()\n}\n\nfunc insert(my_map *ConcurrentMap, wg sync.WaitGroup) {\n    wg.Add(1)\n    var rand_int int\n    for element_num := 0; element_num &lt; 1000; element_num++ {\n        rand_int = rand.Intn(100)\n        my_map.Put(strconv.Itoa(rand_int), rand_int)\n    }\n    defer wg.Done()\n}\n\n// This works\nfunc BenchmarkMyFuncSynchronize(b *testing.B) {\n    my_map := NewConcurrentMap(uint32(4))\n    for n := 0; n &lt; b.N; n++ {\n        my_map.Put(strconv.Itoa(123), 123)\n    }\n}\n</code></pre>\n\n<p>The <code>WARNING: DATA RACE</code> is saying that <code>bucket.hashMap[key] = val</code> is causing the problem, but I am confused on why that is possible, since I lock that logic whenever write is happening.</p>\n\n<p>I think I am missing something basic, can someone point out my mistake?</p>\n\n<p>Thanks</p>\n\n<p>Edit1:</p>\n\n<p>Not sure if this helps but here is what my mutex looks like if I don't lock anything</p>\n\n<pre><code>{{0 0} 0 0 0 0}\n</code></pre>\n\n<p>Here is what it looks like if I lock the write</p>\n\n<pre><code>{{1 0} 0 0 -1073741824 0}\n</code></pre>\n\n<p>Not sure why my <a href=\"https://golang.org/src/sync/rwmutex.go\" rel=\"nofollow noreferrer\">readerCount</a> is a low negative number </p>\n\n<p>Edit:2</p>\n\n<p>I think I find where the issue is at, but not sure why I have to code that way</p>\n\n<p>The issue is </p>\n\n<pre><code>type ThreadSafeMap struct {\n    mapLock sync.RWMutex // This is causing problem\n    hashMap map[string]interface{}\n}\n</code></pre>\n\n<p>it should be</p>\n\n<pre><code>type ThreadSafeMap struct {\n    mapLock *sync.RWMutex\n    hashMap map[string]interface{}\n}\n</code></pre>\n\n<p>Another weird thing is that in <code>Put</code> if I put print statement inside lock</p>\n\n<pre><code>bucket.mapLock.Lock()\nfmt.Println(\"start\")\nfmt.Println(bucket)\nfmt.Println(bucketIndex)\nfmt.Println(bucket.mapLock)\nfmt.Println(&amp;bucket.mapLock)\nbucket.hashMap[key] = val\ndefer bucket.mapLock.Unlock()\n</code></pre>\n\n<p>The following prints is possible</p>\n\n<pre><code>start\nstart\n{0x4212861c0 map[123:123]}\n{0x4212241c0 map[123:123]}\n</code></pre>\n\n<p>Its weird because each <code>start</code> printout should be follow with 4 lines of bucket info since you cannot have <code>start</code> back to back because that would indicate that multiple thread is access the line inside lock</p>\n\n<p>Also for some reason each <code>bucket.mapLock</code> have different address even if I make the bucketIndex static, that indicate that I am not even accessing the same lock.</p>\n\n<p>But despite the above weirdness changing mutex to pointer solves my problem</p>\n\n<p>I would love to find out why I need pointers for mutex and why the prints seem to indicate multiple thread is accessing the lock and why each lock has different address.</p>\n"}, {"tags": ["go", "parallel-processing", "goroutine"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 1, "creation_date": 1503249124, "post_id": 45784588, "comment_id": 78527083, "body": "<a href=\"https://blog.golang.org/concurrency-is-not-parallelism\" rel=\"nofollow noreferrer\">blog.golang.org/concurrency-is-not-parallelism</a>"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1505422412, "post_id": 45784588, "comment_id": 79419940, "body": "In go version 1.8.2 you don&#39;t need to set the GOMAXPROCS it will default to the max number of cores on your machine. Secondly, why do you expect the results you do?  Go routines run in an async manner, those that complete first will print first. That order is going to change with each run. Thirdly, if you examine your CPU usage across all your cores, you&#39;ll see that all of them are doing work. I suggest <code>top</code> or <code>htop</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1633, "user_id": 3714465, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/fc142144b15d88d346db76eede5d8498?s=128&d=identicon&r=PG&f=1", "display_name": "Gnana", "link": "https://stackoverflow.com/users/3714465/gnana"}, "edited": false, "score": 0, "creation_date": 1503270176, "post_id": 45784766, "comment_id": 78532816, "body": "I know that if we add Sleep then i can see parallel output, as per Concurrency concept . But Parallelism says if system has more than one CPU, then each thread will run in one CPU and it becomes Parallel process. My question here is Why I am not getting parallel output though my system has 4 core and added runtime.GOMAXPROCS(4), ."}, {"owner": {"reputation": 11, "user_id": 8454522, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NwNld.jpg?s=128&g=1", "display_name": "Sergey Krestov", "link": "https://stackoverflow.com/users/8454522/sergey-krestov"}, "reply_to_user": {"reputation": 1633, "user_id": 3714465, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/fc142144b15d88d346db76eede5d8498?s=128&d=identicon&r=PG&f=1", "display_name": "Gnana", "link": "https://stackoverflow.com/users/3714465/gnana"}, "edited": false, "score": 0, "creation_date": 1503300339, "post_id": 45784766, "comment_id": 78540552, "body": "First Go Routine finished before second Go Routine starts. To avoid concurrency in output you can use sleep before for statement. (Or use heavy non blocking task)"}, {"owner": {"reputation": 11, "user_id": 8454522, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NwNld.jpg?s=128&g=1", "display_name": "Sergey Krestov", "link": "https://stackoverflow.com/users/8454522/sergey-krestov"}, "reply_to_user": {"reputation": 1633, "user_id": 3714465, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/fc142144b15d88d346db76eede5d8498?s=128&d=identicon&r=PG&f=1", "display_name": "Gnana", "link": "https://stackoverflow.com/users/3714465/gnana"}, "edited": false, "score": 0, "creation_date": 1503301108, "post_id": 45784766, "comment_id": 78541022, "body": "Or you can make your output longer. (use 260 and 270 symbols instead 26 and 27)."}], "tags": [], "owner": {"reputation": 11, "user_id": 8454522, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NwNld.jpg?s=128&g=1", "display_name": "Sergey Krestov", "link": "https://stackoverflow.com/users/8454522/sergey-krestov"}, "is_accepted": false, "score": 0, "last_activity_date": 1503249487, "last_edit_date": 1503249487, "creation_date": 1503248930, "answer_id": 45784766, "question_id": 45784588, "link": "https://stackoverflow.com/questions/45784588/golang-parallel/45784766#45784766", "title": "Golang Parallel", "body": "<p>In my opinion there are two troubles can be in this code. \nFirst idea: </p>\n\n<pre><code> runtime.GOMAXPROCS(2)\n</code></pre>\n\n<p>Using this row you allow only two workers, but you starting three  Go Routines (Main takes one).</p>\n\n<p>But the main problem that Go Routines finished too fast. Adding </p>\n\n<pre><code>time.Sleep(100000)\n</code></pre>\n\n<p>will solve this problem.\npackage main</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"runtime\"\n    \"sync\"\n)\n\nfunc main() {\n    runtime.GOMAXPROCS(3)\n\n    var wg sync.WaitGroup\n    wg.Add(2)\n\n    fmt.Println(\"Starting Go Routines\")\n    go func() {\n        defer wg.Done()\n        for char := 'a'; char &lt; 'a'+26; char++ {\n            for i := 0; i &lt; 10000; i++ {\n                _ = i * 2\n            }\n            fmt.Printf(\"%c \", char)\n        }\n    }()\n\n    go func() {\n        defer wg.Done()\n        for number := 1; number &lt; 27; number++ {\n            for i := 0; i &lt; 10000; i++ {\n                _ = i * 2\n            }\n            fmt.Printf(\"%d \", number)\n        }\n    }()\n\n    fmt.Println(\"Waiting To Finish\")\n    wg.Wait()\n\n    fmt.Println(\"\\nTerminating Program\")\n}\n</code></pre>\n\n<p>In this case I've tried not to use sleep function, because they change thread status in scheduler. And I have this as a result.</p>\n\n<pre><code>Starting Go Routines\nWaiting To Finish\n1 2 3 4 a 5 b 6 c d 7 8 e f 9 g h 10 i j 11 k 12 l m 13 n 14 o p q 15 r 16    s 17 t u 18 v 19 w 20 x y 21 z 22 23 24 25 26 \nTerminating Program\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1633, "user_id": 3714465, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/fc142144b15d88d346db76eede5d8498?s=128&d=identicon&r=PG&f=1", "display_name": "Gnana", "link": "https://stackoverflow.com/users/3714465/gnana"}, "is_accepted": true, "score": 0, "last_activity_date": 1503273317, "creation_date": 1503273317, "answer_id": 45787816, "question_id": 45784588, "link": "https://stackoverflow.com/questions/45784588/golang-parallel/45787816#45787816", "title": "Golang Parallel", "body": "<p>Since for loop has condition 27 in my above example, program execution was fast and not able to see parallelism.  I have written different example and increased the condition then I could see the Parallel output.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"sync\"\n)\n\nvar wg sync.WaitGroup\n\nfunc init() {\n    fmt.Println(\"!!!!!!!!!!!!!!!!!!!!!!!!!!!!\", runtime.NumCPU())\n\n}\nfunc main() {\n    fmt.Println(\" Welcome to concurrency\")\n    wg.Add(2)\n    go one()\n    go two()\n    fmt.Println(\"Waiting To Finish\")\n    wg.Wait()\n    fmt.Println(\"\\nTerminating Program\")\n\n}\n\nfunc one() {\n    for i := 0; i &lt; 200; i++ {\n        fmt.Println(\"one\", i)\n    }\n    defer wg.Done()\n}\n\nfunc two() {\n    for i := 0; i &lt; 200; i++ {\n        fmt.Println(\"Two:\", i)\n    }\n    defer wg.Done()\n}\n</code></pre>\n\n<p><strong>UPDATE 8/28/2015: Go 1.5 is set to make the default value of GOMAXPROCS the same as the number of CPUs on your machine. I have removed the runtime.GOMAXPROCS(4)</strong></p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 7980729, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a433a747b06e58763d6dfc1f388e6fac?s=128&d=identicon&r=PG&f=1", "display_name": "Wanderson Silva", "link": "https://stackoverflow.com/users/7980729/wanderson-silva"}, "is_accepted": false, "score": -1, "last_activity_date": 1505421197, "creation_date": 1505421197, "answer_id": 46227812, "question_id": 45784588, "link": "https://stackoverflow.com/questions/45784588/golang-parallel/46227812#46227812", "title": "Golang Parallel", "body": "<p>That's because your algorithm doesn't do operations enough to allow to see parallelism. Try to raise the number of loops for the for statements, for example.</p>\n"}], "owner": {"reputation": 1633, "user_id": 3714465, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/fc142144b15d88d346db76eede5d8498?s=128&d=identicon&r=PG&f=1", "display_name": "Gnana", "link": "https://stackoverflow.com/users/3714465/gnana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1239, "favorite_count": 0, "accepted_answer_id": 45787816, "answer_count": 3, "score": 0, "last_activity_date": 1505421197, "creation_date": 1503247766, "last_edit_date": 1503270294, "question_id": 45784588, "link": "https://stackoverflow.com/questions/45784588/golang-parallel", "title": "Golang Parallel", "body": "<p>I am new to Golang and trying to understand Concurrency and Parallel. I read below mentioned article about Concurrency and Parallel. I have executed same program. But not getting the same ( mixed letter &amp; character  ) output. Getting first all letters then characters. it seems like concurrency is working not Parallel is not.</p>\n\n<p>Article says add <strong>runtime.GOMAXPROCS(4)</strong> to make parallel. </p>\n\n<p>Why I am <strong>not getting parallel out</strong> ?</p>\n\n<p>I am using <strong>4 core CPU</strong> system and GO <strong>version 1.8.2</strong></p>\n\n<p><a href=\"https://www.goinggo.net/2014/01/concurrency-goroutines-and-gomaxprocs.html\" rel=\"nofollow noreferrer\">https://www.goinggo.net/2014/01/concurrency-goroutines-and-gomaxprocs.html</a></p>\n\n<p><strong>I know that if we add Sleep then i can see parallel output, as per Concurrency concept . But Parallelism says if system has more than one CPU, then each thread will run in one CPU and it becomes Parallel process. \nMy question here is  Why I am not getting parallel output though my system has 4 core and added runtime.GOMAXPROCS(4), .</strong></p>\n\n<p><strong>Go Program</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"sync\"\n)\n\nfunc main() {\n    runtime.GOMAXPROCS(2)\n\n    var wg sync.WaitGroup\n    wg.Add(2)\n\n    fmt.Println(\"Starting Go Routines\")\n    go func() {\n        defer wg.Done()\n\n        for char := \u2018a\u2019; char &lt; \u2018a\u2019+26; char++ {\n            fmt.Printf(\"%c \", char)\n        }\n    }()\n\n    go func() {\n        defer wg.Done()\n\n        for number := 1; number &lt; 27; number++ {\n            fmt.Printf(\"%d \", number)\n        }\n    }()\n\n    fmt.Println(\"Waiting To Finish\")\n    wg.Wait()\n\n    fmt.Println(\"\\nTerminating Program\")\n}\n</code></pre>\n\n<p><strong>My Output</strong></p>\n\n<pre><code>Starting Go Routines\nWaiting To Finish\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 a\nb c d e f g h i j k l m n o p q r s t u v w x y z\nTerminating Program\n</code></pre>\n\n<p><strong>Expected Output</strong> ( not the same , But Parallel output )</p>\n\n<pre><code>Starting Go Routines\nWaiting To Finish\na b 1 2 3 4 c d e f 5 g h 6 i 7 j 8 k 9 10 11 12 l m n o p q 13 r s 14\nt 15 u v 16 w 17 x y 18 z 19 20 21 22 23 24 25 26\nTerminating Program\n</code></pre>\n"}, {"tags": ["go", "kubernetes", "protocol-buffers"], "comments": [{"owner": {"reputation": 1317, "user_id": 7565450, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/qgWFA.jpg?s=128&g=1", "display_name": "Varcorb", "link": "https://stackoverflow.com/users/7565450/varcorb"}, "edited": false, "score": 0, "creation_date": 1503282539, "post_id": 45783904, "comment_id": 78535034, "body": "Have you tried to compile in proto3 instead of proto2?"}, {"owner": {"reputation": 1156, "user_id": 2518716, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ed076bff996a50d9839d6046164959c3?s=128&d=identicon&r=PG", "display_name": "frankgreco", "link": "https://stackoverflow.com/users/2518716/frankgreco"}, "reply_to_user": {"reputation": 1317, "user_id": 7565450, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/qgWFA.jpg?s=128&g=1", "display_name": "Varcorb", "link": "https://stackoverflow.com/users/7565450/varcorb"}, "edited": false, "score": 0, "creation_date": 1503283296, "post_id": 45783904, "comment_id": 78535166, "body": "@TrevorVarwig yes and received the same result. The errors seem to be occurring when type assertion is performed on the type."}], "owner": {"reputation": 1156, "user_id": 2518716, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ed076bff996a50d9839d6046164959c3?s=128&d=identicon&r=PG", "display_name": "frankgreco", "link": "https://stackoverflow.com/users/2518716/frankgreco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 189, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1503247249, "creation_date": 1503243548, "last_edit_date": 1503247249, "question_id": 45783904, "link": "https://stackoverflow.com/questions/45783904/go-protobuf-coder-encoder-errors", "title": "Go Protobuf Coder/Encoder Errors", "body": "<p>I am trying to create a <code>.proto</code> file for a Kubernetes custom resource and hence I need to include the <code>ObjectMeta</code> in my file. I am doing it like this:</p>\n\n<pre><code>syntax = \"proto2\";\npackage spec;\n\nimport \"k8s.io/kubernetes/pkg/api/unversioned/generated.proto\";\nimport \"k8s.io/kubernetes/pkg/api/v1/generated.proto\";\n\nmessage APIKeyList {\n  optional string kind = 1;\n  optional string apiVersion = 2;\n  optional k8s.io.kubernetes.pkg.api.unversioned.ListMeta metadata = 3;\n  repeated APIKey items = 4;\n}\n</code></pre>\n\n<p>Using <code>protoc</code>, it successfully creates my <code>*.pb.go</code> file however when I run my test suite, I receive the following error:</p>\n\n<pre><code>proto: no coders for unversioned.Time\nproto: no encoder for CreationTimestamp unversioned.Time [GetProperties]\nproto: tag has too few fields: \"-\"\nproto: no coders for time.Time\nproto: no encoder for Time time.Time [GetProperties]\nproto: no slice oenc for *reflect.rtype = []*reflect.rtype\nproto: no encoder for OwnerReferences []v1.OwnerReference [GetProperties]\n</code></pre>\n\n<p>Now I am not using any time fields and so I assume is has something to do with the imported proto files.</p>\n"}, {"tags": ["go", "named-pipes", "tmux", "mkfifo"], "answers": [{"tags": [], "owner": {"reputation": 310, "user_id": 5799860, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e74794c62ffb86fb84242f10574d79bd?s=128&d=identicon&r=PG&f=1", "display_name": "Hendrik Evert", "link": "https://stackoverflow.com/users/5799860/hendrik-evert"}, "is_accepted": true, "score": 1, "last_activity_date": 1503235293, "creation_date": 1503235293, "answer_id": 45782606, "question_id": 45781644, "link": "https://stackoverflow.com/questions/45781644/how-to-handle-process-output-in-go-using-named-pipe/45782606#45782606", "title": "how to handle process output in go using named pipe", "body": "<p>Here is the solution which I found <a href=\"https://stackoverflow.com/a/12206584/5799860\">here</a> (thank you <a href=\"https://stackoverflow.com/users/362021/malcolm\">Malcolm</a>)</p>\n\n<pre><code>func Readln(r *bufio.Reader) (string, error) {\n    var (\n        isPrefix = true\n        err      error\n        line, ln []byte\n    )\n    for isPrefix &amp;&amp; err == nil {\n        line, isPrefix, err = r.ReadLine()\n        ln = append(ln, line...)\n    }\n    return string(ln), err\n}\n\nfunc handle(s string) {\n    //Do something with your string\n}\n\nfunc main() {\n    c := exec.Command(\"sh\", \"./tmuxpipe.sh\")\n    err := c.Run()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    f, err := os.Open(\"/tmp/tmuxpipe\")\n    if err != nil {\n        fmt.Printf(\"error opening file: %v\\n\", err)\n        os.Exit(1)\n    }\n    r := bufio.NewReader(f)\n    s, e := Readln(r)\n    for e == nil {\n        handle(s)\n        log.Println(s)\n        s, e = Readln(r)\n    }\n}\n</code></pre>\n\n<p>here is the tmuxpipe.sh:</p>\n\n<pre><code>mkfifo /tmp/tmuxpipe\ntmux pipe-pane -o -t tmuxSession 'cat &gt;&gt; /tmp/tmuxpipe'\n</code></pre>\n\n<p>The reason I did not just use <code>exec.Command()</code> there, is because for some reason beyond my comprehension this:</p>\n\n<pre><code>c := exec.Command(\"tmux\", \"pipe-pane\", \"-o\", \"-t\", \"tmuxSession\", 'cat &gt;&gt; /tmp/tmuxpipe'\") \nerr := c.Run()\nhandleError(err)\n</code></pre>\n\n<p>did not work (for me).\nThere was no error occuring, but the output of the tmux session wasn't displayd either.</p>\n\n<p>I hope this helps anybody</p>\n"}], "owner": {"reputation": 310, "user_id": 5799860, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e74794c62ffb86fb84242f10574d79bd?s=128&d=identicon&r=PG&f=1", "display_name": "Hendrik Evert", "link": "https://stackoverflow.com/users/5799860/hendrik-evert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 613, "favorite_count": 0, "accepted_answer_id": 45782606, "answer_count": 1, "score": 0, "last_activity_date": 1503235293, "creation_date": 1503228517, "question_id": 45781644, "link": "https://stackoverflow.com/questions/45781644/how-to-handle-process-output-in-go-using-named-pipe", "title": "how to handle process output in go using named pipe", "body": "<p>I am trying to set up a pipe from a running process in tmux,<br>\nin order to handle its output line by line.</p>\n\n<p>I have had a look at <a href=\"https://www.reddit.com/r/commandline/comments/263afq/bashtmux_pipe_the_output_of_a_detached_tmux/\" rel=\"nofollow noreferrer\">this guide to pipe the output of a tmux session to stdout</a><br>\nand <a href=\"http://www.albertoleal.me/posts/golang-pipes.html\" rel=\"nofollow noreferrer\">this article about (named) pipes in go</a>.</p>\n\n<p>I have been trying around with that for quite a while now,<br>\nbut still didn't get any noteworthy results.</p>\n\n<p>I would really appreciate any thoughts on how to set that pipe up,<br>\nIdeally in a way so I can range over it linewise.</p>\n\n<p>Thanks a lot</p>\n"}, {"tags": ["go", "telnet"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1503210829, "post_id": 45778804, "comment_id": 78515830, "body": "According to <a href=\"http://cvsweb.netbsd.org/bsdweb.cgi/src/lib/libcurses/curses.h?rev=1.86&amp;content-type=text/x-cvsweb-markup\" rel=\"nofollow noreferrer\">curses.h</a>, try <code>0x103</code> for <code>KEY_UP</code>, e.g. try both <code>[]byte{0x01, 0x03}</code> for big-endian or <code>[]byte{0x03, 0x01}</code> for little-endian."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1503218410, "post_id": 45778804, "comment_id": 78517604, "body": "You need to make yourself familiar with curses."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1503219237, "post_id": 45778804, "comment_id": 78517847, "body": "The answer depends solely on the terminal (emulator) used and is totally unrelated to Go."}], "answers": [{"tags": [], "owner": {"reputation": 7554, "user_id": 700471, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ebb4cc58c1fce4f22abc59a1226ee8e2?s=128&d=identicon&r=PG", "display_name": "Matt Mc", "link": "https://stackoverflow.com/users/700471/matt-mc"}, "is_accepted": false, "score": 0, "last_activity_date": 1503785137, "creation_date": 1503785137, "answer_id": 45900037, "question_id": 45778804, "link": "https://stackoverflow.com/questions/45778804/what-is-the-literal-up-key-escape-sequence-in-golang/45900037#45900037", "title": "What is the Literal &quot;Up&quot; Key Escape Sequence in Golang", "body": "<p><code>\\x1b</code> is the escape sequence.  CSI codes per <a href=\"https://en.wikipedia.org/wiki/ANSI_escape_code#CSI_codes\" rel=\"nofollow noreferrer\">this</a> worked, so it was <code>\\x1ba</code> to move the cursor up one row.</p>\n"}], "owner": {"reputation": 7554, "user_id": 700471, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ebb4cc58c1fce4f22abc59a1226ee8e2?s=128&d=identicon&r=PG", "display_name": "Matt Mc", "link": "https://stackoverflow.com/users/700471/matt-mc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 195, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1503785137, "creation_date": 1503207257, "question_id": 45778804, "link": "https://stackoverflow.com/questions/45778804/what-is-the-literal-up-key-escape-sequence-in-golang", "title": "What is the Literal &quot;Up&quot; Key Escape Sequence in Golang", "body": "<p>I'm writing a Go program to communicate with a server over Telnet.  It has an interactive little program (which I have heard can be made with something called \"curses\"--no familiarity there).</p>\n\n<p>While I can send \"enter\" with the likes of <code>\"\\r\\n\"</code> I find myself needing to send an \"up\" key.  How do I write a literal \"up\" key in my Go code, with any and all appropriate escape sequences, in a way that will send properly to the server?</p>\n"}, {"tags": ["go", "sqlite"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 7, "last_activity_date": 1503187910, "creation_date": 1503187910, "answer_id": 45777356, "question_id": 45777113, "link": "https://stackoverflow.com/questions/45777113/how-do-i-get-sqlite-to-error-instead-of-creating-a-missing-database-file-in-gola/45777356#45777356", "title": "How do I get sqlite to error instead of creating a missing database file in golang?", "body": "<p>This is not currently possible with the go-sqlite3 library. <a href=\"https://github.com/mattn/go-sqlite3/blob/1828334c4a7937cf4d957e36e995b9d6ba4fc535/sqlite3.go#L689-L693\" rel=\"noreferrer\">Looking at the source</a>, you can see <code>SQLITE_OPEN_CREATE</code> is always passed to the open function:</p>\n\n<pre><code>rv := C._sqlite3_open_v2(name, &amp;db,\n    C.SQLITE_OPEN_FULLMUTEX|\n        C.SQLITE_OPEN_READWRITE|\n        C.SQLITE_OPEN_CREATE,\n    nil)\n</code></pre>\n\n<p>I would suggest you <a href=\"https://github.com/mattn/go-sqlite3/issues/new\" rel=\"noreferrer\">open a ticket</a> on the package to add such functionality.</p>\n\n<p>In the mean time, you could add the following code before your DB is created (keep in mind that a race condition exists, which is why you should still request this feature in the library itself):</p>\n\n<pre><code>_, err := os.Stat(\"db.sqlite3\")\nif os.IsNotExist(err) {\n    panic(\"database doesn't exist\")\n}\n// TODO: create db\n</code></pre>\n"}], "owner": {"reputation": 8826, "user_id": 10245, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/a2909c1103b9ceba6c8933c85dc4f803?s=128&d=identicon&r=PG", "display_name": "Tim Abell", "link": "https://stackoverflow.com/users/10245/tim-abell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 901, "favorite_count": 1, "accepted_answer_id": 45777356, "answer_count": 1, "score": 4, "last_activity_date": 1503187910, "creation_date": 1503184830, "question_id": 45777113, "link": "https://stackoverflow.com/questions/45777113/how-do-i-get-sqlite-to-error-instead-of-creating-a-missing-database-file-in-gola", "title": "How do I get sqlite to error instead of creating a missing database file in golang?", "body": "<p>I'm opening a connection to a sqlite database of the user's choosing in my golang program. If they supply a path to a non-existent file then I want to throw an error instead of creating the file.</p>\n\n<p>I'm using the <a href=\"https://github.com/mattn/go-sqlite3\" rel=\"nofollow noreferrer\">mattn/gp-sqlite3</a> driver. The documentation doesn't mention this capability as far as I can see.</p>\n\n<ul>\n<li>The <a href=\"https://sqlite.org/c3ref/open.html\" rel=\"nofollow noreferrer\">sqlite C documentation</a> mentions the querystring format but not the existence of the target file.</li>\n<li>The <a href=\"https://www.connectionstrings.com/sqlite/\" rel=\"nofollow noreferrer\">C# connection strings</a> have a <code>FailIfMissing</code> option but are in a different format.</li>\n</ul>\n\n<p>This is the same as <a href=\"https://stackoverflow.com/q/807208/10245\">Make SQLite connection fail if database is missing? (deleted/moved)</a> but for golang instead of C#. The golang driver seems to use a different format for describing connections to the C# driver so I don't know if the answers there translate to golang or not.</p>\n"}, {"tags": ["go", "packages"], "answers": [{"comments": [{"owner": {"reputation": 377, "user_id": 6723763, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/1r3OV.gif?s=128&g=1", "display_name": "Rtsne42", "link": "https://stackoverflow.com/users/6723763/rtsne42"}, "edited": false, "score": 0, "creation_date": 1503221316, "post_id": 45777951, "comment_id": 78518385, "body": "So when I import the <code>fmt</code> package four times, how does the compiler make sure that it&#39;s not linking the package four times in the same build? I would assume that since the import statement has only &#39;file scope&#39; the compiler has to somehow combine all the imported libraries to avoid linking the same one twice."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1503236077, "post_id": 45777951, "comment_id": 78522737, "body": "The compiler only builds any package once. If you want to know <i>how</i> it does so, read the compile source code, it&#39;s <a href=\"https://github.com/golang/go\" rel=\"nofollow noreferrer\">open source and available on GitHub</a>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 377, "user_id": 6723763, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/1r3OV.gif?s=128&g=1", "display_name": "Rtsne42", "link": "https://stackoverflow.com/users/6723763/rtsne42"}, "edited": false, "score": 0, "creation_date": 1503240966, "post_id": 45777951, "comment_id": 78524250, "body": "@Rtsne42 The scope of identifiers is unrelated to how the compiler and linker load packages.  These tools are smart enough to load any given package once."}, {"owner": {"reputation": 377, "user_id": 6723763, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/1r3OV.gif?s=128&g=1", "display_name": "Rtsne42", "link": "https://stackoverflow.com/users/6723763/rtsne42"}, "edited": false, "score": 0, "creation_date": 1503251966, "post_id": 45777951, "comment_id": 78528034, "body": "@CeriseLim&#243;n Thanks, I&#39;m sure they load the package only once. I was just wondering how it does that when there are duplicate import statements across multiple files. That said, your answer did clarify things for me."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1503240884, "last_edit_date": 1503240884, "creation_date": 1503196588, "answer_id": 45777951, "question_id": 45777038, "link": "https://stackoverflow.com/questions/45777038/how-do-import-statements-get-resolved-in-multiple-source-files/45777951#45777951", "title": "How do import statements get resolved in multiple source files?", "body": "<p>The <a href=\"https://golang.org/ref/spec#Declarations_and_scope\" rel=\"nofollow noreferrer\">specification says</a>:</p>\n\n<blockquote>\n  <p>The scope of the package name of an imported package is the file block of the file containing the import declaration.</p>\n</blockquote>\n\n<p>Because imports do not have package scope, imports are not merged together and are required in each file that uses the import.</p>\n\n<p>The scoping for imports is unrelated to how the compiler and linker load imported packages. These tools are smart enough to load any given package once.</p>\n"}], "owner": {"reputation": 377, "user_id": 6723763, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/1r3OV.gif?s=128&g=1", "display_name": "Rtsne42", "link": "https://stackoverflow.com/users/6723763/rtsne42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 45777951, "answer_count": 1, "score": 0, "last_activity_date": 1503240884, "creation_date": 1503184100, "question_id": 45777038, "link": "https://stackoverflow.com/questions/45777038/how-do-import-statements-get-resolved-in-multiple-source-files", "title": "How do import statements get resolved in multiple source files?", "body": "<p>I've been trying to find an answer to this question without success.</p>\n\n<p>The question is about import statements in Go when a package consists of multiple source files.</p>\n\n<p>Let's say I have a package called <code>math</code> which consists of multiple files:</p>\n\n<pre><code>|-- math\n   |-- add.go\n   |-- subtract.go\n   |-- divide.go\n   |-- multiply.go\n</code></pre>\n\n<p>Let's assume that the <code>math</code> package makes use of the <code>fmt</code> package therefore it needs the appropriate import statement. But since we have four separate files, we have to import the <code>fmt</code> package multiple times (at least to my understanding):</p>\n\n<pre><code>// add.go\nimport \"fmt\"\n\n// subtract.go\nimport \"fmt\"\n\n// divide.go\nimport \"fmt\"\n\n// multiply.go\nimport \"fmt\"\n</code></pre>\n\n<p>Now the question is, what happens when the package is compiled? Are the statements simply merged together?</p>\n\n<p>If so, why do we have to import the package multiple times (once per each file) and not just have a single file with all the import statements so as to not repeat ourselves?</p>\n"}, {"tags": ["security", "go", "cryptography"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1503229847, "post_id": 45776463, "comment_id": 78520845, "body": "Any reason not to use <a href=\"https://golang.org/pkg/syscall/#Mlockall\" rel=\"nofollow noreferrer\"><code>syscall.Mlockall</code></a> to lock the whole process&#39;s memory in RAM?"}, {"owner": {"reputation": 103, "user_id": 2883940, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/edb5f6ac5a83aee6204eb20060f8bbe1?s=128&d=identicon&r=PG&f=1", "display_name": "Cshark", "link": "https://stackoverflow.com/users/2883940/cshark"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1503253861, "post_id": 45776463, "comment_id": 78528675, "body": "The program is to large to fit within &quot;ulimit -l&quot; pages on most systems (64 x 4096 bytes on my system atm)"}], "owner": {"reputation": 103, "user_id": 2883940, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/edb5f6ac5a83aee6204eb20060f8bbe1?s=128&d=identicon&r=PG&f=1", "display_name": "Cshark", "link": "https://stackoverflow.com/users/2883940/cshark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 222, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1503178154, "creation_date": 1503178154, "question_id": 45776463, "link": "https://stackoverflow.com/questions/45776463/golang-crypto-interfaces-and-volatile-memory", "title": "Golang crypto interfaces and volatile memory", "body": "<p>How do I securely manage cryptographic secrets stored in/behind interfaces?</p>\n\n<p>My problem is as follows:</p>\n\n<p>I have a long running application which does encryption using an implementation of the cipher.AEAD interface.\nThe only way to get an instance of the interface (chacha20poly1305) is though the method:</p>\n\n<p>func New([]byte) (cipher.AEAD, error)</p>\n\n<p>I create and use the instance for some time, then \"delete\" the instance and wishes to make sure that the key cannot be recovered hereafter.\nFor this reason I want to avoid the key material being swapped to disk.</p>\n\n<p>Using reflection and unsafe, I can:</p>\n\n<ol>\n<li>Obtain the size and a pointer to the underlying memory</li>\n<li>Do mlock (to avoid the content being swapped to disk)</li>\n<li>Use the instance</li>\n<li>Do a \"memset\" (to remove the key material)</li>\n<li>Use munlock</li>\n</ol>\n\n<p>There is one problem though, the instances may be allocated all over the heap.\nAssuming I need more than \"ulimit -l\" of these, I will likely run out, even though the instances are only 32 bytes each.</p>\n\n<p>Is there some way around this? Ideally a way to have a smaller \"secure mlocked heap\" where only these structs are allocated.\nAlternatively some way to cast memory (say allocated using <a href=\"https://github.com/awnumar/memguard\" rel=\"nofollow noreferrer\">https://github.com/awnumar/memguard</a>) to a specific implementation (not exposed) of the interface, then setup the struct manually (rather than with New([]byte) -> cipher.AEAD)</p>\n"}, {"tags": ["go", "microservices", "directory-structure"], "answers": [{"comments": [{"owner": {"reputation": 377, "user_id": 6723763, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/1r3OV.gif?s=128&g=1", "display_name": "Rtsne42", "link": "https://stackoverflow.com/users/6723763/rtsne42"}, "edited": false, "score": 1, "creation_date": 1503179447, "post_id": 45776534, "comment_id": 78510996, "body": "Thanks for the response, so do you keep each service in a separate repository?"}, {"owner": {"reputation": 233, "user_id": 551932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Os9to.jpg?s=128&g=1", "display_name": "avelino", "link": "https://stackoverflow.com/users/551932/avelino"}, "reply_to_user": {"reputation": 377, "user_id": 6723763, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/1r3OV.gif?s=128&g=1", "display_name": "Rtsne42", "link": "https://stackoverflow.com/users/6723763/rtsne42"}, "edited": false, "score": 0, "creation_date": 1503183853, "post_id": 45776534, "comment_id": 78511737, "body": "Yep, isolating each service in your repository"}, {"owner": {"reputation": 1496, "user_id": 4374970, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/mVn41.jpg?s=128&g=1", "display_name": "mfathirirhas", "link": "https://stackoverflow.com/users/4374970/mfathirirhas"}, "edited": false, "score": 1, "creation_date": 1520396066, "post_id": 45776534, "comment_id": 85293254, "body": "yup, this is how microservice should be structured. Because each service should be independent to eachother which mean they should be separated their repo."}], "tags": [], "owner": {"reputation": 233, "user_id": 551932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Os9to.jpg?s=128&g=1", "display_name": "avelino", "link": "https://stackoverflow.com/users/551932/avelino"}, "is_accepted": false, "score": 3, "last_activity_date": 1503178869, "creation_date": 1503178869, "answer_id": 45776534, "question_id": 45776238, "link": "https://stackoverflow.com/questions/45776238/golang-microservice-project-structure/45776534#45776534", "title": "Golang microservice project structure", "body": "<p>How do I organize my projects?</p>\n\n<pre><code>|-- github.com/avelino/service1\n   |-- Dockerfile\n   |-- main.go\n|-- github.com/avelino/service2\n   |-- Dockerfile\n   |-- main.go\n|-- github.com/avelino/service3\n   |-- Dockerfile\n   |-- main.go\n</code></pre>\n\n<h3>Packages</h3>\n\n<p>All Go code is organized into packages. A package in Go is simply a directory/folder with one or more .go files inside of it. Go packages provide isolation and organization of code similar to how directories/folders organize files on a computer.</p>\n\n<p>All Go code lives in a package and a package is the entry point to access Go code. Understanding and establishing good practices around packages is important to write effective Go code.</p>\n"}, {"comments": [{"owner": {"reputation": 377, "user_id": 6723763, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/1r3OV.gif?s=128&g=1", "display_name": "Rtsne42", "link": "https://stackoverflow.com/users/6723763/rtsne42"}, "edited": false, "score": 0, "creation_date": 1503191856, "post_id": 45777570, "comment_id": 78512863, "body": "Thanks, I&#39;m not able to separate the repository into multiple separate repositories so I was thinking along the same lines. I came across a nice article which clarified some things: <a href=\"http://peter.bourgon.org/go-in-production/\" rel=\"nofollow noreferrer\">peter.bourgon.org/go-in-production</a> but your answer also made things clearer."}], "tags": [], "owner": {"reputation": 939, "user_id": 4648046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/932ac0b92feea46110e78577f7047c74?s=128&d=identicon&r=PG&f=1", "display_name": "Eddy R.", "link": "https://stackoverflow.com/users/4648046/eddy-r"}, "is_accepted": true, "score": 12, "last_activity_date": 1503190711, "creation_date": 1503190711, "answer_id": 45777570, "question_id": 45776238, "link": "https://stackoverflow.com/questions/45776238/golang-microservice-project-structure/45777570#45777570", "title": "Golang microservice project structure", "body": "<p>The other answer here advocates putting each microservice into its own repository. There may be valid reasons for splitting things up that way, but there may be equally valid reasons from wanting to keep everything in one repository as well (it really depends on your project / circumstances)</p>\n\n<p>If you want all the code in one repository, you can- you just need to follow Go's package rules. (this is a good read: <a href=\"https://golang.org/doc/code.html#Workspaces\" rel=\"noreferrer\">https://golang.org/doc/code.html#Workspaces</a>)</p>\n\n<p>If you have a mix of commands and libraries, the directory structure you proposed in your question comes close, but you probably don't need the <code>src</code> directories in there. Here's an example of how a directory structure within a repo with libraries and commands might look:</p>\n\n<pre><code>lib1/\n-- some.go\n-- source.go\nlib2/\n-- more.go\n-- source.go\ncmd/\n-- microservice1/\n   -- main.go\n-- microservice2/\n   -- anothermain.go\n</code></pre>\n\n<p>To use this repository, you would clone it inside a Go workspace on your system (see the link I shared above). Assuming your repository lives in github.com/mybiz/project, and your <code>GOPATH</code> was <code>~/go</code>, the workspace would look as follows:</p>\n\n<pre><code>~/go/src/github.com/mybiz/\n  -- project/\n     &lt;clone repo in here&gt;\n</code></pre>\n\n<p>The file <code>cmd/microservice1/main.go</code> would include the library <code>lib1</code> via a path it expects it in relative to <code>$GOPATH/src</code> as follows:</p>\n\n<pre><code>import \"github.com/mybiz/project/lib1\"\n</code></pre>\n\n<p>Now, your code has access to the exported symbols in that package using the package name declared in the files under <code>lib1</code>... usually just:</p>\n\n<pre><code>package lib1\n</code></pre>\n\n<p>In <code>cmd/microservice1/main.go</code>, with the import above, you could use <code>lib1</code> symbols as follows:</p>\n\n<pre><code>lib1.CallMe()\n</code></pre>\n\n<p>I hope that helps clear up how Go's directory structure works.</p>\n"}, {"tags": [], "owner": {"reputation": 403, "user_id": 3902270, "user_type": "registered", "profile_image": "https://graph.facebook.com/100006418927672/picture?type=large", "display_name": "Karl Andresen", "link": "https://stackoverflow.com/users/3902270/karl-andresen"}, "is_accepted": false, "score": 13, "last_activity_date": 1557503218, "last_edit_date": 1557503218, "creation_date": 1519065320, "answer_id": 48872252, "question_id": 45776238, "link": "https://stackoverflow.com/questions/45776238/golang-microservice-project-structure/48872252#48872252", "title": "Golang microservice project structure", "body": "<p>I'm structuring it like this; mono-repo per. project approach. Taking into account that these services are closely related:</p>\n\n<pre><code>github.com/user/some_project/\n\u251c\u2500\u2500 pkg/ (common own-created packages for all services)\n|   \u251c\u2500\u2500 errors/\n|   \u251c\u2500\u2500 log/\n|   \u251c\u2500\u2500 metrics/\n|   \u251c\u2500\u2500 sd/\n|   |   \u251c\u2500\u2500 consul/\n|   |   \u2514\u2500\u2500 kubernetes/\n|   \u2514\u2500\u2500 tracing/\n\u251c\u2500\u2500 services/\n|   \u251c\u2500\u2500 account/\n|   |   \u251c\u2500\u2500 pb/\n|   |   |   \u251c\u2500\u2500 account.proto\n|   |   |   \u2514\u2500\u2500 account.pb.go\n|   |   \u251c\u2500\u2500 handler.go\n|   |   \u251c\u2500\u2500 main.go\n|   |   \u251c\u2500\u2500 main_test.go\n|   |   \u251c\u2500\u2500 Dockerfile\n|   |   \u2514\u2500\u2500 README.md\n|   \u251c\u2500\u2500 auth/\n|   \u251c\u2500\u2500 frontend/\n|   \u2514\u2500\u2500 user/\n\u251c\u2500\u2500 vendor/ (common vendor-packages for all services)\n\u251c\u2500\u2500 docker-compose.yml\n\u251c\u2500\u2500 go.mod\n\u251c\u2500\u2500 go.sum\n\u251c\u2500\u2500 Makefile\n\u2514\u2500\u2500 README.md\n</code></pre>\n\n<p>Alternative 2:</p>\n\n<pre><code>github.com/user/some_project/\n\u251c\u2500\u2500 pkg/\n\u251c\u2500\u2500 service.account/\n|   \u251c\u2500 cmd/\n|   |  \u2514\u2500 main.go\n|   \u251c\u2500 pb/\n|   \u251c\u2500 Dockerfile\n|   \u251c\u2500 go.mod\n|   \u2514\u2500 go.sum\n\u251c\u2500\u2500 service.auth/\n\u251c\u2500\u2500 service.frontend/\n\u251c\u2500\u2500 service.user/\n\u251c\u2500\u2500 docker-compose.yml\n\u251c\u2500\u2500 go.mod (used primarly for packages in the /pkg dir.)\n\u251c\u2500\u2500 go.sum\n\u251c\u2500\u2500 Makefile\n\u2514\u2500\u2500 README.md\n</code></pre>\n\n<p>With the introduction of go-modules, I'm leaning more to the second alternative.</p>\n\n<p>At some later time, when you start on your second macro/micro/nano-services project, many of the these packages in the /pkg folder would be required there too. What to do? Copy/paste? No! Instead, extract these packages from the project, i.e. log, metric and make your own kit.</p>\n\n<p>Remember that if you use some kind of CI/CD (you really should), you have the option to write a script placed in the project root that will only detect the changes you make in the repository, thus only the affected services will be built and delivered. There are several examples out there how to do this.</p>\n"}, {"comments": [{"owner": {"reputation": 884, "user_id": 6651080, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-EY45JeKlPi8/AAAAAAAAAAI/AAAAAAAAG8I/5bwaHIx2IoQ/photo.jpg?sz=128", "display_name": "Dzintars", "link": "https://stackoverflow.com/users/6651080/dzintars"}, "edited": false, "score": 0, "creation_date": 1560437426, "post_id": 53968683, "comment_id": 99744335, "body": "Does this mean that <code>account.pb.go</code> and <code>booking.pb.go</code> belongs to <code>package v1</code>? What if you have like 50+ services with own messages and rpc methods? Isn&#39;t that hard to work with in IDE? Just trying to research/learn this thing. I kinda like this Go Standard Project Layout. As well, i probably would move <code>*.pb.go</code> into <code>&#47;pkg&#47;api&#47;v1</code> or mby even <code>&#47;internal&#47;api&#47;v1</code>. Not sure."}], "tags": [], "owner": {"reputation": 641, "user_id": 2148088, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/hDNJv.jpg?s=128&g=1", "display_name": "rajeshk", "link": "https://stackoverflow.com/users/2148088/rajeshk"}, "is_accepted": false, "score": 8, "last_activity_date": 1546079025, "creation_date": 1546079025, "answer_id": 53968683, "question_id": 45776238, "link": "https://stackoverflow.com/questions/45776238/golang-microservice-project-structure/53968683#53968683", "title": "Golang microservice project structure", "body": "<p>Thanks to @karl-andresen. I was doing research on the same topic and came up with the below structure hope this helps someone</p>\n\n<pre><code>github.com/username/container/\n\u251c\u2500\u2500 pkg/ ('username' created packages - common for all services &amp; reusable in other projects)\n|   \u251c\u2500\u2500 errors/\n|   \u251c\u2500\u2500 log/\n|   \u251c\u2500\u2500 metrics/\n|   \u251c\u2500\u2500 infra/     (sub category in packages)\n|   |   \u251c\u2500\u2500 consul/\n|   |   \u2514\u2500\u2500 kubernetes/\n|   \u2514\u2500\u2500 tracing/\n\u251c\u2500\u2500 services/ (where all microservices will be imported as submodules - may or may not be reused)\n|   \u251c\u2500\u2500 account/\n|   |   \u251c\u2500\u2500 handler.go\n|   |   \u251c\u2500\u2500 handler_test.go (unit testing, note filename with '_test')\n|   |   \u251c\u2500\u2500 main.go\n|   |   \u251c\u2500\u2500 main_test.go    (another unit testing)\n|   |   \u251c\u2500\u2500 account.cfg     (configuration file for account microservice)\n|   |   \u251c\u2500\u2500 submodule/      (sub directory)\n|   |   |   \u251c\u2500\u2500 submodule.go\n|   |   |   \u2514\u2500\u2500 submodule_test.go   (submodule unit test)\n|   |   \u251c\u2500\u2500 Dockerfile\n|   |   \u2514\u2500\u2500 README.md\n|   \u251c\u2500\u2500 auth/\n|   \u251c\u2500\u2500 booking/\n|   \u2514\u2500\u2500 user/\n\u251c\u2500\u2500 api/ (OpenAPI/Swagger specs, JSON schema files, protocol definition files.)\n|   \u251c\u2500\u2500 proto/  (protocol buffer files)\n|   |   \u251c\u2500\u2500 v1/\n|   |   |   \u251c\u2500\u2500 account.proto\n|   |   |   \u251c\u2500\u2500 account.pb.go\n|   |   |   \u251c\u2500\u2500 booking.proto\n|   |   |   \u2514\u2500\u2500 booking.pb.go\n|   |   \u2514\u2500\u2500 v2/\n|   \u2514\u2500\u2500 rest/   (json files)\n|       \u251c\u2500\u2500 v1/\n|       |   \u251c\u2500\u2500 booking.json\n|       |   \u2514\u2500\u2500 account.json\n|       \u2514\u2500\u2500 v2/\n\u251c\u2500\u2500 configs/ (project config settings, default configs, file templates)\n\u251c\u2500\u2500 scripts/ (Scripts to perform various build, install, analysis, etc operations.)\n\u251c\u2500\u2500 build/ (Packaging and Continuous Integration.)\n\u251c\u2500\u2500 test / (system and module level tests)\n\u251c\u2500\u2500 docs/ (project documents folder)\n\u251c\u2500\u2500 examples/ (project examples for service interactions)\n\u251c\u2500\u2500 third_party/ (all open source, third party codes, where applicable fork and add as submodule)\n\u251c\u2500\u2500 githooks/ (project git hooks)\n\u251c\u2500\u2500 assets/ (common assests for all services)\n\u251c\u2500\u2500 Makefile\n\u251c\u2500\u2500 README.md\n\u2514\u2500\u2500 docker-compose.yml\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 47, "user_id": 9122077, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c4a349c1f476414fea4904cb3392299?s=128&d=identicon&r=PG&f=1", "display_name": "iman tung", "link": "https://stackoverflow.com/users/9122077/iman-tung"}, "is_accepted": false, "score": -1, "last_activity_date": 1550527576, "creation_date": 1550527576, "answer_id": 54756075, "question_id": 45776238, "link": "https://stackoverflow.com/questions/45776238/golang-microservice-project-structure/54756075#54756075", "title": "Golang microservice project structure", "body": "<p>Each microservice should be an independent service and communicate with each other through network either using RESTful, RPC or messaging. Follow <a href=\"https://12factor.net/\" rel=\"nofollow noreferrer\">12 Factor of App</a> is a virtue when designing a microservice to make sure it easy to ship. Check <a href=\"https://github.com/imantung/typical-go-server\" rel=\"nofollow noreferrer\">typical-go-server</a> for an example of how to make microservice friendly project. </p>\n"}], "owner": {"reputation": 377, "user_id": 6723763, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/1r3OV.gif?s=128&g=1", "display_name": "Rtsne42", "link": "https://stackoverflow.com/users/6723763/rtsne42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12020, "favorite_count": 8, "closed_date": 1550541222, "accepted_answer_id": 45777570, "answer_count": 5, "score": 11, "last_activity_date": 1557503218, "creation_date": 1503176410, "question_id": 45776238, "link": "https://stackoverflow.com/questions/45776238/golang-microservice-project-structure", "closed_reason": "Opinion-based", "title": "Golang microservice project structure", "body": "<p>I'm at an initial stage of creating a microservice application in Go, but due to the way that the import paths and directories are handled I'm not quite sure what's best way to structure the project files.</p>\n\n<p>Normally, the project would look something like this in Java:</p>\n\n<pre><code>|-- gateway_microservice\n   |-- src\n   |-- docker\n|-- config_microservice\n   |-- src\n   |-- docker\n|-- recommendation_microservice\n   |-- src\n   |-- docker\n|-- users_microservice\n   |-- src\n   |-- docker\n</code></pre>\n\n<p>Now if I do it the same way in Go, the import paths become somewhat cumbersome:</p>\n\n<pre><code>import (\n       \"fmt\" \n       \"github.com/user/myproject/gateway_microservice/src/package1\"\n       \"github.com/user/myproject/gateway_microservice/src/package2\"\n)\n</code></pre>\n\n<p>Additionally, I hear that the idiomatic way is to put all <code>main.go</code> files in a separate <code>cmd</code> directory, which adds to the confusion. Would it look something like this:</p>\n\n<pre><code>|-- cmd\n   |-- gateway_microservice\n      |-- main.go\n   |-- config_microservice\n      |-- main.go\n   |-- recommendation_microservice\n      |-- main.go\n   |-- users_microservice\n      |-- main.go\n|-- gateway_microservice\n   |-- src\n   |-- docker\n|-- config_microservice\n   |-- src\n   |-- docker\n|-- recommendation_microservice\n   |-- src\n   |-- docker\n|-- users_microservice\n   |-- src\n   |-- docker\n</code></pre>\n\n<p>What is the 'correct' or idiomatic way of structuring a project like this in Go?</p>\n"}, {"tags": ["go", "continuous-integration", "code-coverage", "code-climate"], "answers": [{"comments": [{"owner": {"reputation": 24361, "user_id": 629685, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cadce7a59af35a66f18b9aaddebfd50f?s=128&d=identicon&r=PG", "display_name": "I159", "link": "https://stackoverflow.com/users/629685/i159"}, "edited": false, "score": 0, "creation_date": 1503220860, "post_id": 45776499, "comment_id": 78518268, "body": "Your solution works perfectly. Explain please this magic <code>c.out</code> file. Does <code>cc-test-reporter after-build</code> expect a file with <code>c.out</code> name and concrete syntax?"}], "tags": [], "owner": {"reputation": 233, "user_id": 551932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Os9to.jpg?s=128&g=1", "display_name": "avelino", "link": "https://stackoverflow.com/users/551932/avelino"}, "is_accepted": true, "score": 3, "last_activity_date": 1503178539, "creation_date": 1503178539, "answer_id": 45776499, "question_id": 45776043, "link": "https://stackoverflow.com/questions/45776043/codeclimate-test-coverage-formatter-for-golang/45776499#45776499", "title": "Codeclimate test coverage formatter for Golang", "body": "<p>Export var:</p>\n\n<pre><code>CC_TEST_REPORTER_ID=...\n</code></pre>\n\n<p>Run:</p>\n\n<pre><code>for pkg in $(go list ./... | grep -v vendor); do\n    go test -coverprofile=$(echo $pkg | tr / -).cover $pkg\ndone\necho \"mode: set\" &gt; c.out\ngrep -h -v \"^mode:\" ./*.cover &gt;&gt; c.out\nrm -f *.cover\n\n./cc-test-reporter after-build\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 8651412, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mZ3d3UF3BF8/AAAAAAAAAAI/AAAAAAAAAAs/2SuEwUA7t3c/photo.jpg?sz=128", "display_name": "Abby Armada", "link": "https://stackoverflow.com/users/8651412/abby-armada"}, "is_accepted": false, "score": 2, "last_activity_date": 1506024636, "creation_date": 1506024636, "answer_id": 46352431, "question_id": 45776043, "link": "https://stackoverflow.com/questions/45776043/codeclimate-test-coverage-formatter-for-golang/46352431#46352431", "title": "Codeclimate test coverage formatter for Golang", "body": "<p>Abby from Code Climate Support here. Currently, the <code>test-reporter</code> tries to infer where the coverage data could be from a set of default paths.  This is usually enough for users following the default setup of the coverage tool. </p>\n\n<p>But, in the case where the output is not located on one of those paths, you can use the <code>test-reporter</code> low-level commands to indicate the \ntype of coverage data and where it is. In this particular case you would do something like:</p>\n\n<pre><code>export CC_TEST_REPORTER_ID=&lt;repo-test-reporter-id&gt;\n./cc-test-reporter before-build\ngocov test -coverprofile=out \n./cc-test-reporter format-coverage --input-type gocov out \n./cc-test-reporter upload-coverage\n</code></pre>\n\n<p>You can check more on how to use a <code>test-reporter</code> command by using the flag <code>--help</code>. For example, <code>./cc-test-reporter format-coverage --help</code>. </p>\n\n<p>That should get you in a good place. If not, let us know at hello@codeclimate.com or here, and I can get more insight. :) </p>\n"}], "owner": {"reputation": 24361, "user_id": 629685, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cadce7a59af35a66f18b9aaddebfd50f?s=128&d=identicon&r=PG", "display_name": "I159", "link": "https://stackoverflow.com/users/629685/i159"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1256, "favorite_count": 1, "accepted_answer_id": 45776499, "answer_count": 2, "score": 4, "last_activity_date": 1506024636, "creation_date": 1503174873, "question_id": 45776043, "link": "https://stackoverflow.com/questions/45776043/codeclimate-test-coverage-formatter-for-golang", "title": "Codeclimate test coverage formatter for Golang", "body": "<p>Nowhere in <a href=\"https://docs.codeclimate.com/v1.0/docs/setting-up-test-coverage#section-supported-languages-and-formats\" rel=\"nofollow noreferrer\">Codeclimate docs</a> written how to specify coverage formatter. But when I'm trying to send coverage to Codeclimate:</p>\n\n<pre><code>./cc-test-reporter before-build\n./cc-test-reporter after-build\n</code></pre>\n\n<p>It is failing:</p>\n\n<blockquote>\n  <p>Error: could not find any viable formatter. available formatters: simplecov, lcov, coverage.py, clover, gocov, gcov, cobertura, jacoco</p>\n</blockquote>\n\n<p>I have <code>gocov</code> installed. Also I generated a report with <code>goconv</code>:</p>\n\n<pre><code>gocov test -coverprofile=out\n</code></pre>\n\n<p>And I tried to specify the report file to Codeclimate in various ways:</p>\n\n<pre><code>./cc-test-reporter after-build out\n./cc-test-reporter after-build &lt; out\n</code></pre>\n\n<p>But had no luck...</p>\n\n<p>I haven't found any formatter related directives for <code>.codeclimate.yml</code> file. The doc is written in super \"you know\" style so it didn't help. How to enable/send test coverage with Codeclimate?</p>\n"}, {"tags": ["go", "switch-statement", "channel", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "is_accepted": true, "score": 1, "last_activity_date": 1503236488, "last_edit_date": 1503236488, "creation_date": 1503172877, "answer_id": 45775812, "question_id": 45775183, "link": "https://stackoverflow.com/questions/45775183/does-not-recognize-string-variable-coming-from-a-channel-in-a-switch-statement-g/45775812#45775812", "title": "Does not recognize string variable coming from a channel in a Switch statement golang", "body": "<p>It's not clear what your code is trying to do, the code provided is invalid. \nYou haven't shown any attempt to read from the channel in either example provided, both examples switch on a string then assign a new value to msg_out (which is not declared) and send that value down a channel. </p>\n\n<p>Without the full code it's impossible to tell where you are going wrong, here is a simple example of sending text down a channel and reading it off again. Hopefully this will clarify the process and confirm that strings are sent over channels just fine.</p>\n\n<p>If you still cant get it working, I think you will need to post full code example to get help.</p>\n\n<p><a href=\"https://play.golang.org/p/UXKDWI1wJM\" rel=\"nofollow noreferrer\">Go playground</a> </p>\n\n<pre><code>    package main\n\n    import (\n        \"log\"\n        \"time\"\n    )\n\n    func main() {\n\n        //make the channel\n        strChan := make(chan string)\n\n        //launch a goroutine to listen on the channel\n        go func(strChan chan string) {\n\n            //loop waiting for input on channel\n            for {\n                select {\n                case myString := &lt;-strChan:\n                    // code to be run when a string is recieved here\n\n                    // switch on actual contents of the string\n                    switch myString {\n                    case \"I'm the expected string\":\n                        log.Println(\"got expected string\")\n                    default:\n                        log.Println(\"not the string I'm looking for\")\n                    }\n                }\n            }\n        }(strChan)\n\n        //sleep for a bit then send a string on the channel\n        time.Sleep(time.Second * 2)\n        strChan &lt;- \"I'm the expected string\"\n\n        //wait again, gives channel response a chance to happen  \n        time.Sleep(time.Second * 2)\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 8379039, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5585DI5xOo8/AAAAAAAAAAI/AAAAAAAACXY/1n50_01F2kY/photo.jpg?sz=128", "display_name": "Pablo Romero", "link": "https://stackoverflow.com/users/8379039/pablo-romero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "accepted_answer_id": 45775812, "answer_count": 1, "score": 0, "last_activity_date": 1503236488, "creation_date": 1503168387, "question_id": 45775183, "link": "https://stackoverflow.com/questions/45775183/does-not-recognize-string-variable-coming-from-a-channel-in-a-switch-statement-g", "title": "Does not recognize string variable coming from a channel in a Switch statement golang", "body": "<p>This function is called from a goroutine by passing as parameter m.</p>\n\n<p>The value sent in m is the string: \"01a\" and the statement Switch does not recognize</p>\n\n<pre><code>func myfunc(m string, c chan string) {\n    defer close(c)\n\n    switch m {\n    case \"01a\":\n       msg_out = \"NO PASS\"\n    }\n    c &lt;- msg_out\n}\n</code></pre>\n\n<p>when set m the Switch works fine</p>\n\n<pre><code>func myfunc(m string, c chan string) {\n    defer close(c)\n\n    m = \"01a\"\n    switch m {\n    case \"01a\":\n        msg_out = \"PASS\"\n    }\n    c &lt;- msg_out\n}\n</code></pre>\n\n<p>I suspect the channel will introduce other hidden characters</p>\n"}, {"tags": ["go", "revel"], "comments": [{"owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "edited": false, "score": 0, "creation_date": 1503207573, "post_id": 45775009, "comment_id": 78515215, "body": "Can someone please suggest ..."}, {"owner": {"reputation": 11828, "user_id": 4420967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/J6pYX.png?s=128&g=1", "display_name": "James Z", "link": "https://stackoverflow.com/users/4420967/james-z"}, "edited": false, "score": 0, "creation_date": 1503213536, "post_id": 45775009, "comment_id": 78516459, "body": "I suggest you to at least include the error you get. Nobody is going to know how to fix &quot;The error&quot;."}, {"owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "reply_to_user": {"reputation": 11828, "user_id": 4420967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/J6pYX.png?s=128&g=1", "display_name": "James Z", "link": "https://stackoverflow.com/users/4420967/james-z"}, "edited": false, "score": 0, "creation_date": 1503838535, "post_id": 45775009, "comment_id": 78768760, "body": "resolved .. thanks"}], "answers": [{"tags": [], "owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "is_accepted": true, "score": 0, "last_activity_date": 1503838618, "creation_date": 1503838618, "answer_id": 45905178, "question_id": 45775009, "link": "https://stackoverflow.com/questions/45775009/how-to-add-new-field-in-revel-controller/45905178#45905178", "title": "How to add new field in revel controller", "body": "<p>i added the specific structure in the controller and its resolved... </p>\n"}], "owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 45905178, "answer_count": 1, "score": -1, "last_activity_date": 1503838618, "creation_date": 1503167182, "last_edit_date": 1503213497, "question_id": 45775009, "link": "https://stackoverflow.com/questions/45775009/how-to-add-new-field-in-revel-controller", "title": "How to add new field in revel controller", "body": "<p>i am using the validation example from the \"revel\" golang framework.\nin the existing code, i have added new field. however, it is not recognizing the the contents of field and always throws the error.</p>\n\n<p>here is the url: <a href=\"https://github.com/revel/examples/tree/master/validation\" rel=\"nofollow noreferrer\">https://github.com/revel/examples/tree/master/validation</a></p>\n\n<p>i have updated the entries in the model, controller and views. it is still throwing error.</p>\n"}, {"tags": ["json", "go", "unmarshalling", "yahoo-api"], "comments": [{"owner": {"reputation": 7537, "user_id": 4263818, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AzSa2.jpg?s=128&g=1", "display_name": "R Menke", "link": "https://stackoverflow.com/users/4263818/r-menke"}, "edited": false, "score": 0, "creation_date": 1503219098, "post_id": 45774425, "comment_id": 78517810, "body": "use a generator if you need to unmarshal 3rd party json <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">example generator</a>"}, {"owner": {"reputation": 125, "user_id": 4271016, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5e3b5704701ae3811e75bb7d6ff4b83b?s=128&d=identicon&r=PG&f=1", "display_name": "Ceej", "link": "https://stackoverflow.com/users/4271016/ceej"}, "reply_to_user": {"reputation": 7537, "user_id": 4263818, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AzSa2.jpg?s=128&g=1", "display_name": "R Menke", "link": "https://stackoverflow.com/users/4263818/r-menke"}, "edited": false, "score": 0, "creation_date": 1503235526, "post_id": 45774425, "comment_id": 78522579, "body": "That&#39;s useful but doesn&#39;t fully help.  I still end up with the TeamsApi struct, where each element is named struct (Zero, One, Two).  I need to somehow programmatically iterate over the TeamsApi struct to get each of these elements as their own variable."}], "answers": [{"tags": [], "owner": {"reputation": 26, "user_id": 3045090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3edd5792f3a3d27327c4d18c7b2e886?s=128&d=identicon&r=PG&f=1", "display_name": "toringej", "link": "https://stackoverflow.com/users/3045090/toringej"}, "is_accepted": true, "score": 1, "last_activity_date": 1503241033, "creation_date": 1503241033, "answer_id": 45783487, "question_id": 45774425, "link": "https://stackoverflow.com/questions/45774425/unmarshal-deeply-nested-json-in-golang/45783487#45783487", "title": "Unmarshal deeply nested json in golang", "body": "<p>You probably want to use a custom JSON unmarshaller for this. You can see an example of how to use one here: <a href=\"http://choly.ca/post/go-json-marshalling/\" rel=\"nofollow noreferrer\">http://choly.ca/post/go-json-marshalling/</a></p>\n\n<p>Since the data is structured the way it is, with the <code>teams</code> section both containing teams and the <code>count</code> field, you'll likely need a fair bit of manual logic in there. </p>\n\n<p>First, you can start by defining the <code>League</code>:</p>\n\n<pre><code>type League struct {\n    AllowAddToDlExtraPos  int                    `json:\"allow_add_to_dl_extra_pos,omitempty\"`\n    CurrentWeek           string                 `json:\"current_week,omitempty\"`\n    DraftStatus           string                 `json:\"draft_status,omitempty\"`\n    EditKey               string                 `json:\"edit_key,omitempty\"`\n    EndDate               string                 `json:\"end_date,omitempty\"`\n    EndWeek               string                 `json:\"end_week,omitempty\"`\n    GameCode              string                 `json:\"game_code,omitempty\"`\n    IsCashLeague          string                 `json:\"is_cash_league,omitempty\"`\n    IsProLeague           string                 `json:\"is_pro_league,omitempty\"`\n    LeagueID              string                 `json:\"league_id,omitempty\"`\n    LeagueKey             string                 `json:\"league_key,omitempty\"`\n    LeagueType            string                 `json:\"league_type,omitempty\"`\n    LeagueUpdateTimestamp interface{}            `json:\"league_update_timestamp,omitempty\"`\n    Name                  string                 `json:\"name,omitempty\"`\n    NumTeams              int                    `json:\"num_teams,omitempty\"`\n    Renew                 string                 `json:\"renew,omitempty\"`\n    Renewed               string                 `json:\"renewed,omitempty\"`\n    ScoringType           string                 `json:\"scoring_type,omitempty\"`\n    Season                string                 `json:\"season,omitempty\"`\n    ShortInvitationURL    string                 `json:\"short_invitation_url,omitempty\"`\n    StartDate             string                 `json:\"start_date,omitempty\"`\n    StartWeek             string                 `json:\"start_week,omitempty\"`\n    URL                   string                 `json:\"url,omitempty\"`\n    WeeklyDeadline        string                 `json:\"weekly_deadline,omitempty\"`\n    Teams                 []Team                 `json:\"-\"`\n}\n</code></pre>\n\n<p>Next, we can define the <code>Team</code> structure the way we want it to look.</p>\n\n<pre><code>type Team struct {\n    // Declare the fields of a Team\n}\n</code></pre>\n\n<p>And finally, we declare a custom unmarshal function for the <code>League</code>.</p>\n\n<pre><code>func (l *League) UnmarshalJSON(data []byte) error {\n    type Alias League\n    aux := &amp;struct {\n        *Alias\n        Teams map[string]interface{} `json:\"teams\"`\n    }{\n        Alias: (*Alias)(l),\n    }\n\n    if err := json.Unmarshal(data, aux); err != nil {\n        return err\n    }\n\n    var teams []Team\n    for num, team := range aux.Teams {\n        // Add your code to parse each of the teams from the \n        // map you declared above.\n    }\n    l.Teams = teams\n\n    return nil\n}\n</code></pre>\n\n<p>The unmarshal function will be called by Golangs json library automatically when it hits the League structure inside the <code>LeagueApiResult</code>. </p>\n"}], "owner": {"reputation": 125, "user_id": 4271016, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5e3b5704701ae3811e75bb7d6ff4b83b?s=128&d=identicon&r=PG&f=1", "display_name": "Ceej", "link": "https://stackoverflow.com/users/4271016/ceej"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1438, "favorite_count": 1, "accepted_answer_id": 45783487, "answer_count": 1, "score": 3, "last_activity_date": 1503241033, "creation_date": 1503163697, "last_edit_date": 1503177731, "question_id": 45774425, "link": "https://stackoverflow.com/questions/45774425/unmarshal-deeply-nested-json-in-golang", "title": "Unmarshal deeply nested json in golang", "body": "<p>I have an ugly way of unmarshalling the following json, but it requires much manual work.  I am looking for a more programmatic way to obtain the various team names, if I didn't know how many teams exactly there were originally.  It's truly one of the most poorly structured api's I've come across. </p>\n\n<pre><code>data := []byte(`{\n    \"fantasy_content\": {\n        \"copyright\": \"Data provided by Yahoo! and STATS, LLC\",\n        \"league\": [\n            {\n                \"allow_add_to_dl_extra_pos\": 0,\n                \"current_week\": \"1\",\n                \"draft_status\": \"predraft\",\n                \"edit_key\": \"1\",\n                \"end_date\": \"2017-12-25\",\n                \"end_week\": \"16\",\n                \"game_code\": \"nfl\",\n                \"is_cash_league\": \"0\",\n                \"is_pro_league\": \"0\",\n                \"league_id\": \"XXXXX\",\n                \"league_key\": \"XXXX\",\n                \"league_type\": \"private\",\n                \"league_update_timestamp\": null,\n                \"name\": \"XXXXXX\",\n                \"num_teams\": 14,\n                \"renew\": \"XXXX\",\n                \"renewed\": \"\",\n                \"scoring_type\": \"head\",\n                \"season\": \"2017\",\n                \"short_invitation_url\": \"XXXXX\",\n                \"start_date\": \"2017-09-07\",\n                \"start_week\": \"1\",\n                \"url\": \"XXXXXX\",\n                \"weekly_deadline\": \"\"\n            },\n            {\n                \"teams\": {\n                    \"0\": {\n                        \"team\": [\n                            [\n                                {\n                                    \"team_key\": \"XXXX\"\n                                },\n                                {\n                                    \"team_id\": \"1\"\n                                },\n                                {\n                                    \"name\": \"XXXXX\"\n                                },\n                                [],\n                                {\n                                    \"url\": \"XXXXX\"\n                                },\n                                {\n                                    \"team_logos\": [\n                                        {\n                                            \"team_logo\": {\n                                                \"size\": \"large\",\n                                                \"XXX\"\n                                            }\n                                        }\n                                    ]\n                                },\n                                [],\n                                {\n                                    \"waiver_priority\": \"\"\n                                },\n                                {\n                                    \"faab_balance\": \"100\"\n                                },\n                                {\n                                    \"number_of_moves\": 0\n                                },\n                                {\n                                    \"number_of_trades\": 0\n                                },\n                                {\n                                    \"roster_adds\": {\n                                        \"coverage_type\": \"week\",\n                                        \"coverage_value\": \"1\",\n                                        \"value\": \"0\"\n                                    }\n                                },\n                                [],\n                                {\n                                    \"league_scoring_type\": \"head\"\n                                },\n                                [],\n                                [],\n                                {\n                                    \"has_draft_grade\": 0\n                                },\n                                [],\n                                [],\n                                {\n                                    \"managers\": [\n                                        {\n                                            \"manager\": {\n                                                \"email\": \"XXXXX\",\n                                                \"guid\": \"XX\",\n                                                \"image_url\": \"https://s.yimg.com/wm/modern/images/default_user_profile_pic_64.png\",\n                                                \"is_commissioner\": \"1\",\n                                                \"manager_id\": \"1\",\n                                                \"nickname\": \"Andrew\"\n                                            }\n                                        }\n                                    ]\n                                }\n                            ]\n                        ]\n                    },\n                    \"1\": {\n                        \"team\": [\n                            [\n                                {\n                                    \"team_key\": \"XXXXX\"\n                                },\n                                {\n                                    \"team_id\": \"2\"\n                                },\n                                {\n                                    \"name\": \"XXXXX\"\n                                },\n                                [],\n                                {\n                                    \"url\": \"XXXXX\"\n                                },\n                                {\n                                    \"team_logos\": [\n                                        {\n                                            \"team_logo\": {\n                                                \"size\": \"large\",\n                                                \"url\": \"XXXX\"\n                                            }\n                                        }\n                                    ]\n                                },\n                                [],\n                                {\n                                    \"waiver_priority\": \"\"\n                                },\n                                {\n                                    \"faab_balance\": \"100\"\n                                },\n                                {\n                                    \"number_of_moves\": 0\n                                },\n                                {\n                                    \"number_of_trades\": 0\n                                },\n                                {\n                                    \"roster_adds\": {\n                                        \"coverage_type\": \"week\",\n                                        \"coverage_value\": \"1\",\n                                        \"value\": \"0\"\n                                    }\n                                },\n                                [],\n                                {\n                                    \"league_scoring_type\": \"head\"\n                                },\n                                [],\n                                [],\n                                {\n                                    \"has_draft_grade\": 0\n                                },\n                                [],\n                                [],\n                                {\n                                    \"managers\": [\n                                        {\n                                            \"manager\": {\n                                                \"email\": \"XXXX@yahoo.com\",\n                                                \"guid\": \"XXXX\",\n                                                \"image_url\": \"https://s.yimg.com/wm/modern/images/default_user_profile_pic_64.png\",\n                                                \"manager_id\": \"2\",\n                                                \"nickname\": \"Andrew\"\n                                            }\n                                        },\n                                        {\n                                            \"manager\": {\n                                                \"email\": \"XXX@yahoo.com\",\n                                                \"guid\": \"XX\",\n                                                \"image_url\": \"https://s.yimg.com/wm/modern/images/default_user_profile_pic_64.png\",\n                                                \"is_comanager\": \"1\",\n                                                \"manager_id\": \"15\",\n                                                \"nickname\": \"XX\"\n                                            }\n                                        }\n                                    ]\n                                }\n                            ]\n                        ]\n                    },\n                    \"10\": {\n                        \"team\": [\n                            [\n                                {\n                                    \"team_key\": \"XXX\"\n                                },\n                                {\n                                    \"team_id\": \"11\"\n                                },\n                                {\n                                    \"name\": \"XXX\"\n                                },\n                                [],\n                                {\n                                    \"url\": \"https://football.fantasysports.yahoo.com/f1/XXX\"\n                                },\n                                {\n                                    \"team_logos\": [\n                                        {\n                                            \"team_logo\": {\n                                                \"size\": \"large\",\n                                                \"url\": \"https://s.yimg.com/dh/ap/fantasy/nfl/img/icon_01_100.png\"\n                                            }\n                                        }\n                                    ]\n                                },\n                                [],\n                                {\n                                    \"waiver_priority\": \"\"\n                                },\n                                {\n                                    \"faab_balance\": \"100\"\n                                },\n                                {\n                                    \"number_of_moves\": 0\n                                },\n                                {\n                                    \"number_of_trades\": 0\n                                },\n                                {\n                                    \"roster_adds\": {\n                                        \"coverage_type\": \"week\",\n                                        \"coverage_value\": \"1\",\n                                        \"value\": \"0\"\n                                    }\n                                },\n                                [],\n                                {\n                                    \"league_scoring_type\": \"head\"\n                                },\n                                [],\n                                [],\n                                {\n                                    \"has_draft_grade\": 0\n                                },\n                                [],\n                                [],\n                                {\n                                    \"managers\": [\n                                        {\n                                            \"manager\": {\n                                                \"email\": \"XXX@gmail.com\",\n                                                \"guid\": \"XX\",\n                                                \"image_url\": \"https://s.yimg.com/wm/modern/images/default_user_profile_pic_64.png\",\n                                                \"manager_id\": \"11\",\n                                                \"nickname\": \"XX\"\n                                            }\n                                        }\n                                    ]\n                                }\n                            ]\n                        ]\n                    },\n                    \"2\": {\n                        \"team\": [\n                            [\n                                {\n                                    \"team_key\": \"371.l.102542.t.3\"\n                                },\n                                {\n                                    \"team_id\": \"3\"\n                                },\n                                {\n                                    \"name\": \"XXX\"\n                                },\n                                [],\n                                {\n                                    \"url\": \"https://football.fantasysports.yahoo.com/f1/XX/3\"\n                                },\n                                {\n                                    \"team_logos\": [\n                                        {\n                                            \"team_logo\": {\n                                                \"size\": \"large\",\n                                                \"url\": \"https://ct.yimg.com/cy/5603/30147468023_1c705edb29_192sq.jpg?ct=fantasy\"\n                                            }\n                                        }\n                                    ]\n                                },\n                                [],\n                                {\n                                    \"waiver_priority\": \"\"\n                                },\n                                {\n                                    \"faab_balance\": \"100\"\n                                },\n                                {\n                                    \"number_of_moves\": 0\n                                },\n                                {\n                                    \"number_of_trades\": 0\n                                },\n                                {\n                                    \"roster_adds\": {\n                                        \"coverage_type\": \"week\",\n                                        \"coverage_value\": \"1\",\n                                        \"value\": \"0\"\n                                    }\n                                },\n                                [],\n                                {\n                                    \"league_scoring_type\": \"head\"\n                                },\n                                [],\n                                [],\n                                {\n                                    \"has_draft_grade\": 0\n                                },\n                                [],\n                                [],\n                                {\n                                    \"managers\": [\n                                        {\n                                            \"manager\": {\n                                                \"email\": \"XXXgmail.com\",\n                                                \"guid\": \"XXXX\",\n                                                \"image_url\": \"https://s.yimg.com/wv/images/6c93ed606f742d4c075bc091633cc072_64.jpg\",\n                                                \"manager_id\": \"3\",\n                                                \"nickname\": \"XX\"\n                                            }\n                                        }\n                                    ]\n                                }\n                            ]\n                        ]\n                    },\n                    \"3\": {\n                        \"team\": [\n                            [\n                                {\n                                    \"team_key\": \"371.l.102542.t.4\"\n                                },\n                                {\n                                    \"team_id\": \"4\"\n                                },\n                                {\n                                    \"name\": \"XX\"\n                                },\n                                [],\n                                {\n                                    \"url\": \"https://football.fantasysports.yahoo.com/f1/XX/4\"\n                                },\n                                {\n                                    \"team_logos\": [\n                                        {\n                                            \"team_logo\": {\n                                                \"size\": \"large\",\n                                                \"url\": \"https://s.yimg.com/dh/ap/fantasy/nfl/img/icon_10_100.png\"\n                                            }\n                                        }\n                                    ]\n                                },\n                                [],\n                                {\n                                    \"waiver_priority\": \"\"\n                                },\n                                {\n                                    \"faab_balance\": \"100\"\n                                },\n                                {\n                                    \"number_of_moves\": 0\n                                },\n                                {\n                                    \"number_of_trades\": 0\n                                },\n                                {\n                                    \"roster_adds\": {\n                                        \"coverage_type\": \"week\",\n                                        \"coverage_value\": \"1\",\n                                        \"value\": \"0\"\n                                    }\n                                },\n                                [],\n                                {\n                                    \"league_scoring_type\": \"head\"\n                                },\n                                [],\n                                [],\n                                {\n                                    \"has_draft_grade\": 0\n                                },\n                                [],\n                                [],\n                                {\n                                    \"managers\": [\n                                        {\n                                            \"manager\": {\n                                                \"email\": \"XXX@yahoo.com\",\n                                                \"guid\": \"XX\",\n                                                \"image_url\": \"https://s.yimg.com/wm/modern/images/default_user_profile_pic_64.png\",\n                                                \"manager_id\": \"4\",\n                                                \"nickname\": \"XX\"\n                                            }\n                                        }\n                                    ]\n                                }\n                            ]\n                        ]\n                    },\n                    \"8\": {\n                        \"team\": [\n                            [\n                                {\n                                    \"team_key\": \"XXX\"\n                                },\n                                {\n                                    \"team_id\": \"9\"\n                                },\n                                {\n                                    \"name\": \"XxX\"\n                                },\n                                [],\n                                {\n                                    \"url\": \"https://football.fantasysports.yahoo.com/f1/XX/9\"\n                                },\n                                {\n                                    \"team_logos\": [\n                                        {\n                                            \"team_logo\": {\n                                                \"size\": \"large\",\n                                                \"url\": \"https://ct.yimg.com/cy/8393/28682944304_33bda49603_192sq.jpg?ct=fantasy\"\n                                            }\n                                        }\n                                    ]\n                                },\n                                [],\n                                {\n                                    \"waiver_priority\": \"\"\n                                },\n                                {\n                                    \"faab_balance\": \"100\"\n                                },\n                                {\n                                    \"number_of_moves\": 0\n                                },\n                                {\n                                    \"number_of_trades\": 0\n                                },\n                                {\n                                    \"roster_adds\": {\n                                        \"coverage_type\": \"week\",\n                                        \"coverage_value\": \"1\",\n                                        \"value\": \"0\"\n                                    }\n                                },\n                                [],\n                                {\n                                    \"league_scoring_type\": \"head\"\n                                },\n                                [],\n                                [],\n                                {\n                                    \"has_draft_grade\": 0\n                                },\n                                [],\n                                [],\n                                {\n                                    \"managers\": [\n                                        {\n                                            \"manager\": {\n                                                \"email\": \"XXX\",\n                                                \"guid\": \"XXX\",\n                                                \"image_url\": \"https://s.yimg.com/wm/modern/images/default_user_profile_pic_64.png\",\n                                                \"manager_id\": \"9\",\n                                                \"nickname\": \"XXX\"\n                                            }\n                                        }\n                                    ]\n                                }\n                            ]\n                        ]\n                    },\n                    \"count\": 14\n                }\n            }\n        ],\n        \"refresh_rate\": \"60\",\n        \"time\": \"110.55207252502ms\",\n        \"xml:lang\": \"en-US\",\n        \"yahoo:uri\": \"/fantasy/v2/league/XXXX/teams\"\n    }\n}`)\n</code></pre>\n\n<p>The following works, but it's a hassle and I have to hard code the different struct values per team, to get data for that team.  </p>\n\n<pre><code>type TeamApi_ struct {\n    TeamKey string `json:\"team_key\"`\n    TeamId string `json:\"team_id\"`\n    Name string `json:\"name\"`\n}\n\ntype LeaguesApi struct {\n    NumTeams int `json:\"num_teams\"`\n    TeamsApi struct {\n        Zero struct {\n            TeamsApi_ [][]TeamApi_ `json:\"team\"`\n        } `json:\"0\"`\n        One struct {\n            TeamsApi_ [][]TeamApi_ `json:\"team\"`\n        } `json:\"1\"`\n        Two struct {\n            TeamsApi_ [][]TeamApi_ `json:\"team\"`\n        } `json:\"2\"`\n        Three struct {\n            TeamsApi_ [][]TeamApi_ `json:\"team\"`\n        } `json:\"3\"`\n    } `json:\"teams\"`\n} \n\ntype LeagueApiResult struct {\nFantasyContent struct {\n            LeagueApi []LeaguesApi `json:\"league\"`\n\n    } `json:\"fantasy_content\"`\n}\n\nvar Result LeagueApiResult\nerr := json.Unmarshal(data, &amp;Result)\nif err != nil {\n    fmt.Println(err)\n}\n\n\nfmt.Println(Result.FantasyContent.LeagueApi[1].TeamsApi.One.TeamsApi_[0][2].Name)\n</code></pre>\n"}, {"tags": ["macos", "go", "build"], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 0, "last_activity_date": 1503148233, "creation_date": 1503148233, "answer_id": 45771931, "question_id": 45771734, "link": "https://stackoverflow.com/questions/45771734/cannot-build-open-source-project/45771931#45771931", "title": "Cannot build open-source project", "body": "<p>Your go source should in your gopath - here it is Users/gmile/src. Use go get to fetch the pkg you want to work on instead and it should work.</p>\n"}, {"tags": [], "owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "is_accepted": true, "score": 5, "last_activity_date": 1503149183, "creation_date": 1503149183, "answer_id": 45772091, "question_id": 45771734, "link": "https://stackoverflow.com/questions/45771734/cannot-build-open-source-project/45772091#45772091", "title": "Cannot build open-source project", "body": "<p>Your path when cloning the source must be on the golang PATH like : \n<code>/home/gujarat/golang/src/github.com/lucapette/fakedata</code></p>\n\n<p>as you can see my Path to golang path is : <code>/home/gujarat/golang/</code>.\nYou can also print your golang path in your terminal by entering : <code>$GOPATH</code>.</p>\n\n<p>And the <code>git clone</code> should be in the following the exact as above path : <code>src/github.com/lucapette/</code>.</p>\n\n<pre><code>cd $GOPATH/src/github.com/\nmkdir lucaptte\ncd lucapette\ngit clone https://github.com/lucapette/fakedata.git\n</code></pre>\n\n<p>When you are running the <code>make</code> command which trigger <code>go build</code> this command will look the <code>$GOPATH</code> and your <code>$GOROOT</code> folder.</p>\n"}], "owner": {"reputation": 13009, "user_id": 80851, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5c11b2e624af2cb13797e47442067ea6?s=128&d=identicon&r=PG", "display_name": "gmile", "link": "https://stackoverflow.com/users/80851/gmile"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 45772091, "answer_count": 2, "score": 1, "last_activity_date": 1503149183, "creation_date": 1503146959, "question_id": 45771734, "link": "https://stackoverflow.com/questions/45771734/cannot-build-open-source-project", "title": "Cannot build open-source project", "body": "<p>I'd like to contribute to an OSS project built with <code>go</code>, but I'm having hard time compiling it. It looks as if I'm missing something obvious.</p>\n\n<p>I think the problem is related to how <code>go</code> is installed on my computer, and not to the project itself, thus I'm posting it here on StackOverflow, instead of project's \"Issues\" section.</p>\n\n<p>Below is what I'm doing.</p>\n\n<ol>\n<li><p>I've installed <a href=\"https://github.com/Homebrew/homebrew-core/blob/master/Formula/go.rb\" rel=\"nofollow noreferrer\"><code>go</code></a> using <code>homebrew</code>:</p>\n\n<pre><code>$ brew install go\nUpdating Homebrew...\n==&gt; Auto-updated Homebrew!\nUpdated 1 tap (homebrew/core).\n==&gt; Updated Formulae\nlibebml\n\n==&gt; Downloading https://homebrew.bintray.com/bottles/go-1.8.3.sierra.bottle.tar.gz\nAlready downloaded: /Users/gmile/Library/Caches/Homebrew/go-1.8.3.sierra.bottle.tar.gz\n==&gt; Pouring go-1.8.3.sierra.bottle.tar.gz\n==&gt; Caveats\nA valid GOPATH is required to use the `go get` command.\nIf $GOPATH is not specified, $HOME/go will be used by default:\n  https://golang.org/doc/code.html#GOPATH\n\nYou may wish to add the GOROOT-based install location to your PATH:\n  export PATH=$PATH:/usr/local/opt/go/libexec/bin\n==&gt; Summary\n\ud83c\udf7a  /usr/local/Cellar/go/1.8.3: 7,035 files, 282.0MB\n$\n</code></pre></li>\n<li><p>Then I cloned the repo:</p>\n\n<pre><code>$ hub clone lucapette/fakedata\n</code></pre></li>\n<li><p>I ran <code>make setup</code> (per instruction), which at first did not complete successfully:</p>\n\n<pre><code>$ make setup\ngo get -u github.com/alecthomas/gometalinter\ngometalinter --install\nmake: gometalinter: No such file or directory\nmake: *** [setup] Error 1\n$\n</code></pre>\n\n<p>I figured that is because <code>gometalinter</code> is nowhere in my <code>$PATH</code>, so have added it (I'm using <a href=\"http://fishshell.com\" rel=\"nofollow noreferrer\">fish-shell</a>):</p>\n\n<pre><code>$ set fish_user_paths /Users/gmile/go/bin\n</code></pre></li>\n<li><p>running <code>make setup</code> seem to have succeeded now. This is the output:</p>\n\n<pre><code>$ make setup\ngo get -u github.com/alecthomas/gometalinter\ngometalinter --install\nInstalling:\n  aligncheck\n  deadcode\n  dupl\n  errcheck\n  gas\n  goconst\n  gocyclo\n  goimports\n  golint\n  gosimple\n  gotype\n  ineffassign\n  interfacer\n  lll\n  megacheck\n  misspell\n  safesql\n  staticcheck\n  structcheck\n  unconvert\n  unparam\n  unused\n  varcheck\n$\n</code></pre></li>\n<li><p><strong>Running <code>make build</code> fails</strong>:</p>\n\n<pre><code>$ make build\ngo build\nmain.go:11:2: cannot find package\"github.com/lucapette/fakedata/pkg/fakedata\" in any of:\n        /usr/local/Cellar/go/1.8.3/libexec/src/github.com/lucapette/fakedata/pkg/fakedata (from $GOROOT)\n        /Users/gmile/go/src/github.com/lucapette/fakedata/pkg/fakedata (from $GOPATH)\nmain.go:12:2: cannot find package \"github.com/spf13/pflag\" in any of:\n        /usr/local/Cellar/go/1.8.3/libexec/src/github.com/spf13/pflag (from $GOROOT)\n        /Users/gmile/go/src/github.com/spf13/pflag (from $GOPATH)\nmake: *** [build] Error 1\n$\n</code></pre></li>\n</ol>\n\n<p>So either <a href=\"https://github.com/lucapette/fakedata/blob/master/CONTRIBUTING.md\" rel=\"nofollow noreferrer\">Contributing</a> guideline is incomplete, or I'm missing something obvious about installing and managing go packages.</p>\n"}, {"tags": ["go", "time-wait", "redigo"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1503158916, "post_id": 45771111, "comment_id": 78505295, "body": "Redigo does not have a function named <code>NewRedisClient </code>.  Show your code.  Does the application close pooled connections when it is done using them?"}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 2, "last_activity_date": 1503236886, "creation_date": 1503236886, "answer_id": 45782826, "question_id": 45771111, "link": "https://stackoverflow.com/questions/45771111/too-many-time-wait-after-concurrent-when-using-redigo-pool/45782826#45782826", "title": "Too many TIME_WAIT after concurrent when using redigo pool", "body": "<p>Are you returning connections to the pool when you're done with them, <a href=\"http://godoc.org/github.com/garyburd/redigo/redis#Pool\" rel=\"nofollow noreferrer\">per the documentation</a>?</p>\n\n<blockquote>\n  <p>A request handler gets a connection from the pool and closes the connection when the handler is done:</p>\n</blockquote>\n\n<pre><code>func serveHome(w http.ResponseWriter, r *http.Request) {\n    conn := pool.Get()\n    defer conn.Close()\n    ...\n}\n</code></pre>\n\n<p>Not returning connections to the pool as shown above would result in the connection leak you're seeing.</p>\n"}], "owner": {"reputation": 3, "user_id": 7949737, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20e84393c30d8bec6ec92b1e6370509f?s=128&d=identicon&r=PG&f=1", "display_name": "maxwell92", "link": "https://stackoverflow.com/users/7949737/maxwell92"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 693, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1503236886, "creation_date": 1503142943, "last_edit_date": 1503162535, "question_id": 45771111, "link": "https://stackoverflow.com/questions/45771111/too-many-time-wait-after-concurrent-when-using-redigo-pool", "title": "Too many TIME_WAIT after concurrent when using redigo pool", "body": "<p>I used github.com/garyburd/redigo for my application go routines concurrently reading and writing Redis. I used redigo NewRedisClient() in Singleton Pattern, and set MAXACTIVE=100, MAXIDLE=100, IDLETIMEOUT=60.</p>\n\n<p>The application started and I found there are many TIME_WAIT to Redis Server growing. like:</p>\n\n<pre><code>root@goofy-27253489-lax5m:/# netstat -anltp | grep TIME_WAIT | wc -l\n10466\nroot@goofy-27253489-lax5m:/# netstat -anltp | grep TIME_WAIT | wc -l\n11776\nroot@goofy-27253489-lax5m:/# netstat -anltp | grep TIME_WAIT | wc -l\n12554\nroot@goofy-27253489-lax5m:/# netstat -anltp | grep TIME_WAIT | wc -l\n16017\n</code></pre>\n\n<p>And I also print the active count and idle count every time when I pool.Get(), it showed:</p>\n\n<pre><code>ActiveCount: 1, MaxActive: 100, MaxIdle: 100, Pool: 0xc420288580, Conn: 0xc420220000, IdleSize: 0\nActiveCount: 3, MaxActive: 100, MaxIdle: 100, Pool: 0xc420288580, Conn: 0xc42064e0a0, IdleSize: 0\nActiveCount: 3, MaxActive: 100, MaxIdle: 100, Pool: 0xc420288580, Conn: 0xc4202960a0, IdleSize: 0\nActiveCount: 3, MaxActive: 100, MaxIdle: 100, Pool: 0xc420288580, Conn: 0xc4206765a0, IdleSize: 0\nActiveCount: 3, MaxActive: 100, MaxIdle: 100, Pool: 0xc420288580, Conn: 0xc420296140, IdleSize: 0\nActiveCount: 3, MaxActive: 100, MaxIdle: 100, Pool: 0xc420288580, Conn: 0xc42034c0a0, IdleSize: 0\nActiveCount: 3, MaxActive: 100, MaxIdle: 100, Pool: 0xc420288580, Conn: 0xc42034c320, IdleSize: 0\nActiveCount: 3, MaxActive: 100, MaxIdle: 100, Pool: 0xc420288580, Conn: 0xc42064e280, IdleSize: 0\nActiveCount: 3, MaxActive: 100, MaxIdle: 100, Pool: 0xc420288580, Conn: 0xc42034c3c0, IdleSize: 0\n</code></pre>\n\n<p>Why there were so many TIME_WAIT ? Did I leak some connections ?</p>\n"}, {"tags": ["xml", "go"], "answers": [{"tags": [], "owner": {"reputation": 1119, "user_id": 6222397, "user_type": "registered", "profile_image": "https://graph.facebook.com/1027495110613102/picture?type=large", "display_name": "Hisham Karam", "link": "https://stackoverflow.com/users/6222397/hisham-karam"}, "is_accepted": true, "score": 1, "last_activity_date": 1537169386, "creation_date": 1537169386, "answer_id": 52362768, "question_id": 45770413, "link": "https://stackoverflow.com/questions/45770413/attribute-with-xml-namespace/52362768#52362768", "title": "Attribute with XML namespace", "body": "<p>if you want to generate something like this:</p>\n\n<pre><code>&lt;OrganizationName xml:lang=\"en\"&gt;name&lt;/OrganizationName&gt;\n</code></pre>\n\n<p>you can use the following:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n)\n\n//OrganizationName Name\ntype OrganizationName struct {\n    XMLName xml.Name `xml:\"OrganizationName\"`\n    Lang    string   `xml:\"http://www.w3.org/XML/1998/namespace lang,attr,omitempty\"`\n    Value   string   `xml:\",chardata\"`\n}\n\n//Organization Organization Entity\ntype Organization struct {\n    XMLName          xml.Name         `xml:\"Organization\"`\n    OrganizationName OrganizationName `xml:\"OrganizationName\"`\n}\n\nfunc main() {\n    v := Organization{\n        OrganizationName: OrganizationName{\n            Lang:  \"en\",\n            Value: \"Hisham Karam\",\n        },\n    }\n    output, err := xml.MarshalIndent(v, \"  \", \"    \")\n    if err != nil {\n        fmt.Printf(\"error: %v\\n\", err)\n    }\n    fmt.Printf(\"\\n%s\", string(output))\n\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>  &lt;Organization&gt;\n      &lt;OrganizationName xml:lang=\"en\"&gt;Hisham Karam&lt;/OrganizationName&gt;\n  &lt;/Organization&gt;\n</code></pre>\n\n<p>go version:</p>\n\n<pre><code>go version go1.10.3 darwin/amd64\n</code></pre>\n"}], "owner": {"reputation": 660, "user_id": 580382, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/eUpm4.jpg?s=128&g=1", "display_name": "smokedice", "link": "https://stackoverflow.com/users/580382/smokedice"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 562, "favorite_count": 2, "accepted_answer_id": 52362768, "answer_count": 1, "score": 1, "last_activity_date": 1537169386, "creation_date": 1503138404, "last_edit_date": 1503161270, "question_id": 45770413, "link": "https://stackoverflow.com/questions/45770413/attribute-with-xml-namespace", "title": "Attribute with XML namespace", "body": "<p>The following struct is used to marshall SAML XML elements such as <code>OrganizationName</code>, <code>OrganizationDisplayName</code> &amp; <code>OrganizationURL</code>.</p>\n\n<pre><code>type LocalizedName struct {\n    Lang  string `xml:\"xml lang,attr\"`\n    Value string `xml:\",chardata\"`\n}\n</code></pre>\n\n<p>The <code>Lang</code> attribute is within the <code>xml</code> namespace. The generated XML from the encoding/xml package includes relative namespaces:</p>\n\n<pre><code>&lt;Organization&gt;\n  &lt;OrganizationName xmlns:_xml=\"xml\" _xml:lang=\"en\"&gt;name&lt;/OrganizationName&gt;\n  &lt;OrganizationDisplayName xmlns:_xml=\"xml\" _xml:lang=\"en\"&gt;name&lt;/OrganizationDisplayName&gt;\n  &lt;OrganizationURL xmlns:_xml=\"xml\" _xml:lang=\"en\"&gt;http://www.example.com/&lt;/OrganizationURL&gt;\n&lt;/Organization&gt;\n</code></pre>\n\n<p>I was expecting the elements to not use relative namespaces as they seem to be considered to be insecure, <a href=\"https://stackoverflow.com/questions/45769529/xml-why-are-relative-namespaces-bad\">although I do not understand why</a>:</p>\n\n<pre><code>&lt;OrganizationName xml:lang=\"en\"&gt;name&lt;/OrganizationName&gt;\n</code></pre>\n\n<p>What causes the relative namespaces to be created?</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 6761, "user_id": 4698242, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6757cccdf8e414d1ee8f833242334cda?s=128&d=identicon&r=PG&f=1", "display_name": "kojow7", "link": "https://stackoverflow.com/users/4698242/kojow7"}, "edited": false, "score": 0, "creation_date": 1503123507, "post_id": 45768347, "comment_id": 78494896, "body": "Where are you trying to connect to the mysql server from?"}, {"owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "reply_to_user": {"reputation": 6761, "user_id": 4698242, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6757cccdf8e414d1ee8f833242334cda?s=128&d=identicon&r=PG&f=1", "display_name": "kojow7", "link": "https://stackoverflow.com/users/4698242/kojow7"}, "edited": false, "score": 0, "creation_date": 1503123992, "post_id": 45768347, "comment_id": 78495004, "body": "i just updated my query ... plz suggest"}, {"owner": {"reputation": 6761, "user_id": 4698242, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6757cccdf8e414d1ee8f833242334cda?s=128&d=identicon&r=PG&f=1", "display_name": "kojow7", "link": "https://stackoverflow.com/users/4698242/kojow7"}, "edited": false, "score": 0, "creation_date": 1503124376, "post_id": 45768347, "comment_id": 78495112, "body": "Have you tried mysql://root:root@172.31.43.60/metro"}, {"owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "reply_to_user": {"reputation": 6761, "user_id": 4698242, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/6757cccdf8e414d1ee8f833242334cda?s=128&d=identicon&r=PG&f=1", "display_name": "kojow7", "link": "https://stackoverflow.com/users/4698242/kojow7"}, "edited": false, "score": 0, "creation_date": 1503124640, "post_id": 45768347, "comment_id": 78495180, "body": "yes tried that. still same error"}], "answers": [{"tags": [], "owner": {"reputation": 173079, "user_id": 893780, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3j1db.jpg?s=128&g=1", "display_name": "robertklep", "link": "https://stackoverflow.com/users/893780/robertklep"}, "is_accepted": true, "score": 2, "last_activity_date": 1503124678, "creation_date": 1503124678, "answer_id": 45768512, "question_id": 45768347, "link": "https://stackoverflow.com/questions/45768347/what-is-proper-mysql-database-connection-string/45768512#45768512", "title": "what is proper mysql database connection string", "body": "<p>I have no clue about Go, but I can <a href=\"https://github.com/go-sql-driver/mysql#dsn-data-source-name\" rel=\"nofollow noreferrer\">read the documentation</a>, which suggests that you need to use this:</p>\n\n<pre><code>root:root@tcp(newserver)/metro\n</code></pre>\n\n<p>Or possibly:</p>\n\n<pre><code>mysql://root:root@tcp(newserver)/metro\n</code></pre>\n"}], "owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 0, "accepted_answer_id": 45768512, "answer_count": 1, "score": 0, "last_activity_date": 1503124736, "creation_date": 1503123374, "last_edit_date": 1503124736, "question_id": 45768347, "link": "https://stackoverflow.com/questions/45768347/what-is-proper-mysql-database-connection-string", "title": "what is proper mysql database connection string", "body": "<p>i am using following connection string :</p>\n\n<blockquote>\n  <p>mysql://root:root@newserver/metro</p>\n</blockquote>\n\n<p>where </p>\n\n<blockquote>\n  <p>username: root</p>\n  \n  <p>password: root</p>\n  \n  <p>server : newserver</p>\n  \n  <p>database: metro</p>\n</blockquote>\n\n<p>getting following error :</p>\n\n<blockquote>\n  <p>2017/08/19 06:10:02 default addr for network 'newserver' unknown</p>\n</blockquote>\n\n<p>here are mysql server logs :</p>\n\n<blockquote>\n  <p>Redirecting to /bin/systemctl status mysqld.service\n  \u25cf mysqld.service - MySQL Community Server\n     Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled)\n     Active: active (running) since Fri 2017-08-18 17:14:59 UTC; 12h ago\n    Process: 23510 ExecStartPost=/usr/bin/mysql-systemd-start post (code=exited, status=0/SUCCESS)\n    Process: 23447 ExecStartPre=/usr/bin/mysql-systemd-start pre (code=exited, status=0/SUCCESS)\n   Main PID: 23509 (mysqld_safe)\n     CGroup: /system.slice/mysqld.service\n             \u251c\u250023509 /bin/sh /usr/bin/mysqld_safe --basedir=/usr\n             \u2514\u250023676 /usr/sbin/mysqld --basedir=/usr --datadir=/var/lib/mysql --plugin-dir=/usr/lib64/mysql/plugin --log-error=/var/log/mysqld.log --pid-file=/var/run/...</p>\n  \n  <p>Aug 18 17:14:58 newserver mysql-systemd-start[23447]: Support MySQL by buying support/licenses at <a href=\"http://shop.mysql.com\" rel=\"nofollow noreferrer\">http://shop.mysql.com</a>\n  Aug 18 17:14:58 newserver mysql-systemd-start[23447]: Note: new default config file not created.\n  Aug 18 17:14:58 newserver mysql-systemd-start[23447]: Please make sure your config file is current\n  Aug 18 17:14:58 newserver mysql-systemd-start[23447]: WARNING: Default config file /etc/my.cnf exists on the system\n  Aug 18 17:14:58 newserver mysql-systemd-start[23447]: This file will be read by default by the MySQL server\n  Aug 18 17:14:58 newserver mysql-systemd-start[23447]: If you do not want to use this, either remove it, or use the\n  Aug 18 17:14:58 newserver mysql-systemd-start[23447]: --defaults-file argument to mysqld_safe when starting the server\n  Aug 18 17:14:58 newserver mysqld_safe[23509]: 170818 17:14:58 mysqld_safe Logging to '/var/log/mysqld.log'.\n  Aug 18 17:14:58 newserver mysqld_safe[23509]: 170818 17:14:58 mysqld_safe Starting mysqld daemon with databases from /var/lib/mysql\n  Aug 18 17:14:59 newserver systemd[1]: Started MySQL Community Server.</p>\n</blockquote>\n\n<p>following are the contents of /etc/hosts</p>\n\n<blockquote>\n  <p>172.31.43.60 newserver</p>\n</blockquote>\n\n<p>this configuration is there on single machine and i am trying to access using golang program.</p>\n\n<p>here is the url for the same : </p>\n\n<p><a href=\"https://github.com/utronframework/tutorials/blob/master/create_todo_list_application_with_utron.md\" rel=\"nofollow noreferrer\">https://github.com/utronframework/tutorials/blob/master/create_todo_list_application_with_utron.md</a></p>\n\n<p>the filename is config/app.json</p>\n\n<p>here is my app.json file</p>\n\n<pre><code>{\n    \"app_name\": \"utron web app\",\n    \"base_url\": \"http://localhost:8090\",\n    \"port\": 8090,\n    \"verbose\": false,\n    \"static_dir\": \"static\",\n    \"view_dir\": \"views\",\n    \"database\": \"mysql\",\n    \"database_conn\": \"mysql://root:root@newserver/metro\",\n    \"automigrate\": true\n</code></pre>\n\n<p>}</p>\n\n<p>please suggest </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 8, "last_activity_date": 1503113630, "last_edit_date": 1503113630, "creation_date": 1503112268, "answer_id": 45767259, "question_id": 45767208, "link": "https://stackoverflow.com/questions/45767208/go-unpacking-array-as-arguments-to-path-join/45767259#45767259", "title": "Go unpacking array as arguments to path.Join", "body": "<p>You're not misunderstanding anything really, you just can't do that. The <a href=\"https://golang.org/ref/spec#Passing_arguments_to_..._parameters\" rel=\"noreferrer\">spec</a> says:</p>\n\n<blockquote>\n  <p>If the final argument is assignable to a slice type <code>[]T</code>, it may be passed unchanged as the value for a <code>...T</code> parameter if the argument is followed by <code>...</code>. In this case no new slice is created.</p>\n</blockquote>\n\n<p>In short, <code>p...</code> can only be used as the <em>entire</em> variadic part of the arguments, because when you do that, it simply re-uses <code>p</code> as the parameter slice within the function, instead of making a new one.</p>\n\n<p>If you want to add some arguments at the beginning, you would have to construct your own slice with all of the arguments first, something like:</p>\n\n<pre><code>p := []string{\"a\", \"b\", \"c\"}\np2 := append([]string{\"d\"}, p...)\nfmt.Println(path.Join(p2...))\n</code></pre>\n\n<p>which works alright and prints \"d/a/b/c\".</p>\n"}], "owner": {"reputation": 35, "user_id": 8427092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbf3e3792c572f33d3d3ad6a9f81611f?s=128&d=identicon&r=PG&f=1", "display_name": "onebone", "link": "https://stackoverflow.com/users/8427092/onebone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1718, "favorite_count": 0, "accepted_answer_id": 45767259, "answer_count": 1, "score": 3, "last_activity_date": 1503113630, "creation_date": 1503111620, "question_id": 45767208, "link": "https://stackoverflow.com/questions/45767208/go-unpacking-array-as-arguments-to-path-join", "title": "Go unpacking array as arguments to path.Join", "body": "<p>I want to unpack string array and pass to path.Join</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"path\"\n)\n\nfunc main() {\n    p := []string{\"a\", \"b\", \"c\"}\n    fmt.Println(path.Join(p...))\n}\n</code></pre>\n\n<p>Output of this code is:</p>\n\n<pre><code>a/b/c\n</code></pre>\n\n<p>But if I pass arguments like:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"path\"\n)\n\nfunc main() {\n    p := []string{\"a\", \"b\", \"c\"}\n    fmt.Println(path.Join(\"d\", p...))\n}\n</code></pre>\n\n<p>It doesn't work.</p>\n\n<pre><code>tmp/sandbox299218161/main.go:10: too many arguments in call to path.Join\n    have (string, []string...)\n    want (...string)\n</code></pre>\n\n<p>I think I have misunderstanding on unpacking, any suggestions?</p>\n"}, {"tags": ["go", "execution-time"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1503126056, "post_id": 45766572, "comment_id": 78495545, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/41608578/order-of-the-code-and-performance/41608707#41608707\">Order of the code and performance</a>."}, {"owner": {"reputation": 1132, "user_id": 2049796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DMl0O.jpg?s=128&g=1", "display_name": "Muzafar Ali", "link": "https://stackoverflow.com/users/2049796/muzafar-ali"}, "edited": false, "score": 0, "creation_date": 1616766226, "post_id": 45766572, "comment_id": 118113007, "body": "Golang&#39;s testing package supports <a href=\"https://golang.org/pkg/testing/#hdr-Benchmarks\" rel=\"nofollow noreferrer\">golang.org/pkg/testing/#hdr-Benchmarks</a> that can help in better examining code.."}], "answers": [{"comments": [{"owner": {"reputation": 1413, "user_id": 7474529, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10154971830248249/picture?type=large", "display_name": "&#214;zg&#252;r Yal&#231;\u0131n", "link": "https://stackoverflow.com/users/7474529/%c3%96zg%c3%bcr-yal%c3%a7%c4%b1n"}, "edited": false, "score": 0, "creation_date": 1503104916, "post_id": 45766707, "comment_id": 78491974, "body": "Good trick. I feel that I need to focus more on &quot;defer&quot; statement."}, {"owner": {"reputation": 353, "user_id": 4224534, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DpO4Y.jpg?s=128&g=1", "display_name": "BrianT.", "link": "https://stackoverflow.com/users/4224534/briant"}, "edited": false, "score": 1, "creation_date": 1559595274, "post_id": 45766707, "comment_id": 99463157, "body": "Note: don&#39;t forget the extra () on the defer !"}, {"owner": {"reputation": 62, "user_id": 8119453, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3z1XL.jpg?s=128&g=1", "display_name": "axiqia", "link": "https://stackoverflow.com/users/8119453/axiqia"}, "edited": false, "score": 0, "creation_date": 1606545244, "post_id": 45766707, "comment_id": 114997150, "body": "The deferred call&#39;s <i>arguments are evaluated immediately</i>, but the function call is not executed until the surrounding function returns. For example, <code>defer outcall(incall())</code>, the <code>incall()</code> is evaluated immediately, while the <code>outcall()</code> is not executed until the surrounding function returns."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 71, "last_activity_date": 1569711011, "last_edit_date": 1569711011, "creation_date": 1503104528, "answer_id": 45766707, "question_id": 45766572, "link": "https://stackoverflow.com/questions/45766572/is-there-an-efficient-way-to-calculate-execution-time-in-golang/45766707#45766707", "title": "Is there an efficient way to calculate execution time in golang?", "body": "<p>If you are timing an entire function, then you can use <code>defer</code> to eliminate some of the repetitive code.</p>\n\n<pre><code>func elapsed(what string) func() {\n    start := time.Now()\n    return func() {\n        fmt.Printf(\"%s took %v\\n\", what, time.Since(start))\n    }\n}\n\nfunc main() {\n    defer elapsed(\"page\")()  // &lt;-- The trailing () is the deferred call\n    time.Sleep(time.Second * 2)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/8sKNmOdoEM\" rel=\"noreferrer\">playground example</a></p>\n"}, {"tags": [], "owner": {"reputation": 1917, "user_id": 4039768, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EWQUf.jpg?s=128&g=1", "display_name": "Mohsin", "link": "https://stackoverflow.com/users/4039768/mohsin"}, "is_accepted": false, "score": 16, "last_activity_date": 1503158738, "creation_date": 1503158738, "answer_id": 45773638, "question_id": 45766572, "link": "https://stackoverflow.com/questions/45766572/is-there-an-efficient-way-to-calculate-execution-time-in-golang/45773638#45773638", "title": "Is there an efficient way to calculate execution time in golang?", "body": "<p>The solution provided by <a href=\"https://stackoverflow.com/users/5728991/cerise-lim%C3%B3n\">Cerise</a> is perfect. </p>\n\n<hr>\n\n<p>In addition, if you don't want to pass function name explicitly, you could  accomplish it like this:</p>\n\n<pre><code>func SomeFunction(list *[]string) {\n    defer TimeTrack(time.Now())\n    // Do whatever you want.\n}\n\nfunc TimeTrack(start time.Time) {\n    elapsed := time.Since(start)\n\n    // Skip this function, and fetch the PC and file for its parent.\n    pc, _, _, _ := runtime.Caller(1)\n\n    // Retrieve a function object this functions parent.\n    funcObj := runtime.FuncForPC(pc)\n\n    // Regex to extract just the function name (and not the module path).\n    runtimeFunc := regexp.MustCompile(`^.*\\.(.*)$`)\n    name := runtimeFunc.ReplaceAllString(funcObj.Name(), \"$1\")\n\n    log.Println(fmt.Sprintf(\"%s took %s\", name, elapsed))\n}\n</code></pre>\n\n<p><strong>As a result, you would get:</strong>  </p>\n\n<blockquote>\n  <p><code>SomeFunction took 15.483\u00b5s</code></p>\n</blockquote>\n\n<hr>\n\n<p>For more information, Refer this article: <a href=\"http://sabhiram.com/go/2015/01/21/golang_trace_fns_part_1.html\" rel=\"noreferrer\">Go Function Tracing</a></p>\n\n<p>Share the knowledge. :)</p>\n"}, {"tags": [], "owner": {"reputation": 3343, "user_id": 2790983, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/TCp89.jpg?s=128&g=1", "display_name": "Uday Hiwarale", "link": "https://stackoverflow.com/users/2790983/uday-hiwarale"}, "is_accepted": false, "score": 4, "last_activity_date": 1521129462, "creation_date": 1521129462, "answer_id": 49304003, "question_id": 45766572, "link": "https://stackoverflow.com/questions/45766572/is-there-an-efficient-way-to-calculate-execution-time-in-golang/49304003#49304003", "title": "Is there an efficient way to calculate execution time in golang?", "body": "<p>Use init function</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nvar start time.Time\n\nfunc init() {\n    start = time.Now()\n}\n\nfunc getChars(s string) {\n    for _, c := range s {\n        fmt.Printf(\"%c at time %v\\n\", c, time.Since(start))\n        time.Sleep(10 * time.Millisecond)\n    }\n}\n\nfunc main() {\n    fmt.Println(\"main execution started at time\", time.Since(start))\n\n    getChars(\"Hello\")\n\n    fmt.Println(\"\\nmain execution stopped at time\", time.Since(start))\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3757, "user_id": 794539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b694f0dd066ad600b16e4440cf0e9a91?s=128&d=identicon&r=PG", "display_name": "blubberdiblub", "link": "https://stackoverflow.com/users/794539/blubberdiblub"}, "edited": false, "score": 0, "creation_date": 1540306500, "post_id": 52421463, "comment_id": 92811996, "body": "Deferring after the fact (i.e. after your code you want to time) right before the end of the enclosing function is not really useful, as then you can just as well execute the second timing and printing directly without <code>defer</code> and have exactly the same functionality.  <code>defer</code> exists to schedule some call before the code in question (to be executed thereafter) and to be called regardless of panics or early bail-outs occurring during the code in question."}, {"owner": {"reputation": 1187, "user_id": 10390273, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZnPo-zLAkpE/AAAAAAAAAAI/AAAAAAAAAQ0/eDv2tBJWBWM/photo.jpg?sz=128", "display_name": "ASHWIN RAJEEV", "link": "https://stackoverflow.com/users/10390273/ashwin-rajeev"}, "reply_to_user": {"reputation": 3757, "user_id": 794539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b694f0dd066ad600b16e4440cf0e9a91?s=128&d=identicon&r=PG", "display_name": "blubberdiblub", "link": "https://stackoverflow.com/users/794539/blubberdiblub"}, "edited": false, "score": 0, "creation_date": 1540365775, "post_id": 52421463, "comment_id": 92832899, "body": "based on the question defer is useful. It will work even if there is a panic."}, {"owner": {"reputation": 3757, "user_id": 794539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b694f0dd066ad600b16e4440cf0e9a91?s=128&d=identicon&r=PG", "display_name": "blubberdiblub", "link": "https://stackoverflow.com/users/794539/blubberdiblub"}, "edited": false, "score": 0, "creation_date": 1540385781, "post_id": 52421463, "comment_id": 92845385, "body": "I did not dispute that <code>defer</code> is useful for timing in general (the other answers show a good way to use it). Just the way it&#39;s used in <b>this</b> answer is not very productive. In particular placing <code>defer</code> at the end of the function makes no sense."}, {"owner": {"reputation": 1187, "user_id": 10390273, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZnPo-zLAkpE/AAAAAAAAAAI/AAAAAAAAAQ0/eDv2tBJWBWM/photo.jpg?sz=128", "display_name": "ASHWIN RAJEEV", "link": "https://stackoverflow.com/users/10390273/ashwin-rajeev"}, "reply_to_user": {"reputation": 3757, "user_id": 794539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b694f0dd066ad600b16e4440cf0e9a91?s=128&d=identicon&r=PG", "display_name": "blubberdiblub", "link": "https://stackoverflow.com/users/794539/blubberdiblub"}, "edited": false, "score": 0, "creation_date": 1540442673, "post_id": 52421463, "comment_id": 92869080, "body": "@blubberdiblub yeah but defer can placed in any position of the code you want. It will be added to defer stack and will execute whatever the position of the defer function. So I think it is more useful because we can code lazy..."}, {"owner": {"reputation": 3757, "user_id": 794539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b694f0dd066ad600b16e4440cf0e9a91?s=128&d=identicon&r=PG", "display_name": "blubberdiblub", "link": "https://stackoverflow.com/users/794539/blubberdiblub"}, "edited": false, "score": 0, "creation_date": 1540445092, "post_id": 52421463, "comment_id": 92869742, "body": "<code>defer</code> will put stuff onto the <code>defer</code> stack at the point it occurs in the code, not any sooner. Try putting a <code>panic()</code> (or some function that causes a panic) at the position of your comment and observe that your deferred time printing will <b>not</b> happen, because it hadn&#39;t been deferred before the panic. You code is effectively no different from the same code without <code>defer</code>."}, {"owner": {"reputation": 1187, "user_id": 10390273, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZnPo-zLAkpE/AAAAAAAAAAI/AAAAAAAAAQ0/eDv2tBJWBWM/photo.jpg?sz=128", "display_name": "ASHWIN RAJEEV", "link": "https://stackoverflow.com/users/10390273/ashwin-rajeev"}, "reply_to_user": {"reputation": 3757, "user_id": 794539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b694f0dd066ad600b16e4440cf0e9a91?s=128&d=identicon&r=PG", "display_name": "blubberdiblub", "link": "https://stackoverflow.com/users/794539/blubberdiblub"}, "edited": false, "score": 0, "creation_date": 1540446015, "post_id": 52421463, "comment_id": 92870044, "body": "@blubberdiblub yes, In case of a panic you are right"}, {"owner": {"reputation": 1187, "user_id": 10390273, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZnPo-zLAkpE/AAAAAAAAAAI/AAAAAAAAAQ0/eDv2tBJWBWM/photo.jpg?sz=128", "display_name": "ASHWIN RAJEEV", "link": "https://stackoverflow.com/users/10390273/ashwin-rajeev"}, "reply_to_user": {"reputation": 3757, "user_id": 794539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b694f0dd066ad600b16e4440cf0e9a91?s=128&d=identicon&r=PG", "display_name": "blubberdiblub", "link": "https://stackoverflow.com/users/794539/blubberdiblub"}, "edited": false, "score": 0, "creation_date": 1540447490, "post_id": 52421463, "comment_id": 92870581, "body": "@blubberdiblub now check the code it will work even if a panic occur"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 3, "creation_date": 1545766159, "post_id": 52421463, "comment_id": 94691707, "body": "This answer is no different from the <a href=\"https://stackoverflow.com/a/45766707/125816\">accepted one</a>, which was posted two years ago. What&#39;s the point?"}], "tags": [], "owner": {"reputation": 1187, "user_id": 10390273, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZnPo-zLAkpE/AAAAAAAAAAI/AAAAAAAAAQ0/eDv2tBJWBWM/photo.jpg?sz=128", "display_name": "ASHWIN RAJEEV", "link": "https://stackoverflow.com/users/10390273/ashwin-rajeev"}, "is_accepted": false, "score": 1, "last_activity_date": 1540538823, "last_edit_date": 1592644375, "creation_date": 1537434584, "answer_id": 52421463, "question_id": 45766572, "link": "https://stackoverflow.com/questions/45766572/is-there-an-efficient-way-to-calculate-execution-time-in-golang/52421463#52421463", "title": "Is there an efficient way to calculate execution time in golang?", "body": "<h2>Efficient way to calculate execution time in golang</h2>\n<p>You can easily get the <strong>execution time</strong> on your console using a defer function</p>\n<blockquote>\n<p>defer functions execute even if the code get an error so you always get the execution time.</p>\n<p>time package is used to get the time difference.</p>\n</blockquote>\n<pre><code>func main() {\n    now := time.Now()\n    defer func() {\n        fmt.Println(time.Now().Sub(now))\n    }()\n        \n    // Here you can do whatever you want\n}\n</code></pre>\n<p>Or you can use this code</p>\n<pre><code>func main() {\n        now := time.Now()\n        defer func() {\n            fmt.Println(time.Since(now))\n        }()\n            \n        // Here you can do whatever you want\n    }\n</code></pre>\n<p>check the code in <a href=\"https://play.golang.org/p/2kRfPJzIEfW\" rel=\"nofollow noreferrer\">Playground</a> for more. I added some functionality to recover from an error at the same time print the execution time, even if in the case of a panic error.</p>\n"}], "owner": {"reputation": 1413, "user_id": 7474529, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10154971830248249/picture?type=large", "display_name": "&#214;zg&#252;r Yal&#231;\u0131n", "link": "https://stackoverflow.com/users/7474529/%c3%96zg%c3%bcr-yal%c3%a7%c4%b1n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 25709, "favorite_count": 9, "accepted_answer_id": 45766707, "answer_count": 4, "score": 33, "last_activity_date": 1616505862, "creation_date": 1503102852, "last_edit_date": 1616505862, "question_id": 45766572, "link": "https://stackoverflow.com/questions/45766572/is-there-an-efficient-way-to-calculate-execution-time-in-golang", "title": "Is there an efficient way to calculate execution time in golang?", "body": "<p>I'm looking for the best way to calculate execution time in go.</p>\n<pre><code>func main() {\n    start := time.Now()\n\n    time.Sleep(time.Second * 2)\n\n    //something doing here\n\n    elapsed := time.Since(start)\n    fmt.Printf(&quot;page took %s&quot;, elapsed)\n}\n</code></pre>\n<p>The code above works fine.</p>\n<p>But when I use templates, I have to write it again for each template function.</p>\n<p>Is there an <strong>efficient</strong> way of calculating execution time, including templates?</p>\n"}, {"tags": ["session", "go", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 851, "user_id": 4855552, "user_type": "registered", "accept_rate": 73, "profile_image": "https://lh5.googleusercontent.com/-8tyeegra_mY/AAAAAAAAAAI/AAAAAAAAABs/bshL5-wka2U/photo.jpg?sz=128", "display_name": "jeff00seattle", "link": "https://stackoverflow.com/users/4855552/jeff00seattle"}, "edited": false, "score": 0, "creation_date": 1503448675, "post_id": 45788462, "comment_id": 78615588, "body": "Thank you for your response. Are you stating that a session can be persisted between handlers? And I was just requesting the values incorrectly?"}, {"owner": {"reputation": 11, "user_id": 7551946, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zk1CG.jpg?s=128&g=1", "display_name": "Forest Hoffman", "link": "https://stackoverflow.com/users/7551946/forest-hoffman"}, "reply_to_user": {"reputation": 851, "user_id": 4855552, "user_type": "registered", "accept_rate": 73, "profile_image": "https://lh5.googleusercontent.com/-8tyeegra_mY/AAAAAAAAAAI/AAAAAAAAABs/bshL5-wka2U/photo.jpg?sz=128", "display_name": "jeff00seattle", "link": "https://stackoverflow.com/users/4855552/jeff00seattle"}, "edited": false, "score": 0, "creation_date": 1503537645, "post_id": 45788462, "comment_id": 78661217, "body": "@jeff00seattle Sure thing. Yes, I was stating that the session can persist, and it was just a matter of how the values were being accessed."}, {"owner": {"reputation": 851, "user_id": 4855552, "user_type": "registered", "accept_rate": 73, "profile_image": "https://lh5.googleusercontent.com/-8tyeegra_mY/AAAAAAAAAAI/AAAAAAAAABs/bshL5-wka2U/photo.jpg?sz=128", "display_name": "jeff00seattle", "link": "https://stackoverflow.com/users/4855552/jeff00seattle"}, "edited": false, "score": 0, "creation_date": 1503603188, "post_id": 45788462, "comment_id": 78697990, "body": "@[Forest Hoffman] I think I found my problem and it has to deal with <code>cookieStore = sessions.NewCookieStore([]byte(storeGUID))</code>, it is not creating a cookie when viewing the session in the Chrome browser. Not sure where to go from here. More research involved."}, {"owner": {"reputation": 851, "user_id": 4855552, "user_type": "registered", "accept_rate": 73, "profile_image": "https://lh5.googleusercontent.com/-8tyeegra_mY/AAAAAAAAAAI/AAAAAAAAABs/bshL5-wka2U/photo.jpg?sz=128", "display_name": "jeff00seattle", "link": "https://stackoverflow.com/users/4855552/jeff00seattle"}, "edited": false, "score": 0, "creation_date": 1503607498, "post_id": 45788462, "comment_id": 78700130, "body": "Okay, I think my problem is cookies are not getting created."}, {"owner": {"reputation": 851, "user_id": 4855552, "user_type": "registered", "accept_rate": 73, "profile_image": "https://lh5.googleusercontent.com/-8tyeegra_mY/AAAAAAAAAAI/AAAAAAAAABs/bshL5-wka2U/photo.jpg?sz=128", "display_name": "jeff00seattle", "link": "https://stackoverflow.com/users/4855552/jeff00seattle"}, "edited": false, "score": 0, "creation_date": 1503607805, "post_id": 45788462, "comment_id": 78700305, "body": "I am running this code on my localhost, and I allowed default <code>sessions.Options()</code> settings within <code>sessions.NewCookieStore()</code>, but no cookie saved.  Then, I thought it was a <code>sessions.Options()</code> and that key <code>Secure</code> needed to be set to <code>True</code>, however that failed with an error: &gt; &quot;securecookie: error - caused by: securecookie: error - caused by: &gt; gob: type not registered for interface: osin.Response&quot;"}, {"owner": {"reputation": 11, "user_id": 7551946, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zk1CG.jpg?s=128&g=1", "display_name": "Forest Hoffman", "link": "https://stackoverflow.com/users/7551946/forest-hoffman"}, "reply_to_user": {"reputation": 851, "user_id": 4855552, "user_type": "registered", "accept_rate": 73, "profile_image": "https://lh5.googleusercontent.com/-8tyeegra_mY/AAAAAAAAAAI/AAAAAAAAABs/bshL5-wka2U/photo.jpg?sz=128", "display_name": "jeff00seattle", "link": "https://stackoverflow.com/users/4855552/jeff00seattle"}, "edited": false, "score": 0, "creation_date": 1503702279, "post_id": 45788462, "comment_id": 78740406, "body": "Interesting, did you test it in Firefox with the same results? Could this be a caching issue on Chrome&#39;s part?"}, {"owner": {"reputation": 11, "user_id": 7551946, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zk1CG.jpg?s=128&g=1", "display_name": "Forest Hoffman", "link": "https://stackoverflow.com/users/7551946/forest-hoffman"}, "reply_to_user": {"reputation": 851, "user_id": 4855552, "user_type": "registered", "accept_rate": 73, "profile_image": "https://lh5.googleusercontent.com/-8tyeegra_mY/AAAAAAAAAAI/AAAAAAAAABs/bshL5-wka2U/photo.jpg?sz=128", "display_name": "jeff00seattle", "link": "https://stackoverflow.com/users/4855552/jeff00seattle"}, "edited": false, "score": 1, "creation_date": 1503702732, "post_id": 45788462, "comment_id": 78740502, "body": "I googled your &quot;gob type not registered&quot; error and found a <a href=\"https://github.com/gorilla/sessions/issues/57#issuecomment-145178239\" rel=\"nofollow noreferrer\">github issue</a> in the gorilla/sessions repo. I don&#39;t know if the original code contains any other session setters, but perhaps registering whatever types you have is worth a try."}], "tags": [], "owner": {"reputation": 11, "user_id": 7551946, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Zk1CG.jpg?s=128&g=1", "display_name": "Forest Hoffman", "link": "https://stackoverflow.com/users/7551946/forest-hoffman"}, "is_accepted": false, "score": 0, "last_activity_date": 1503280934, "creation_date": 1503280934, "answer_id": 45788462, "question_id": 45765891, "link": "https://stackoverflow.com/questions/45765891/gorilla-sessions-session-be-managed-persist-changes-between-handlers/45788462#45788462", "title": "gorilla/sessions: Session be managed (persist changes) between handlers?", "body": "<p>I ran into the same thing with my webserver. I was doing exactly what you're doing here:</p>\n\n<pre><code>sval = sess.Values[\"authMode\"]\nif authMode, ok := sval.(string); !ok {\n    err := errors.New(\"Missing \\\"authSess\\\" in session.\")\n    http.Error(w, err.Error(), http.StatusInternalServerError)\n    return\n}\n</code></pre>\n\n<p>I created a local variable in order to store the retrieved session value and then type asserted the value to ensure it's integrity. I discovered that the type assertion was silently failing, because the Values field of the gorilla/sessions.Session struct is of the type <code>map[interface{}]interface{}</code> (<a href=\"https://github.com/gorilla/sessions/blob/master/sessions.go#L52\" rel=\"nofollow noreferrer\">source</a>). When retrieving the session value from the Values field, as you do here...</p>\n\n<pre><code>sval = sess.Values[\"authMode\"]\n</code></pre>\n\n<p>...the compiler thinks that sval is now of the <code>interface{}</code> type. So, when you attempt to type assert sval, it fails to convert the interface to a string.</p>\n\n<p>What I did was create a variable declaration above the if-block where i'm handling the type assertion, so that I can use it later on. Then, I type assert using the map element itself. This is what it would look like for you:</p>\n\n<pre><code>var authMode string // a var declaration with the type you want\nvar ok bool         // in my case, I also created a bool var to avoid a pointer error\n\n// directly type assert the session value\nif authMode, ok = sess.Values[\"authMode\"].(string); !ok {\n    err := errors.New(\"Missing \\\"authSess\\\" in session.\")\n    http.Error(w, err.Error(), http.StatusInternalServerError)\n    return\n}\n</code></pre>\n\n<p>I hope that helps!</p>\n"}], "owner": {"reputation": 851, "user_id": 4855552, "user_type": "registered", "accept_rate": 73, "profile_image": "https://lh5.googleusercontent.com/-8tyeegra_mY/AAAAAAAAAAI/AAAAAAAAABs/bshL5-wka2U/photo.jpg?sz=128", "display_name": "jeff00seattle", "link": "https://stackoverflow.com/users/4855552/jeff00seattle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 244, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1503280934, "creation_date": 1503095928, "last_edit_date": 1503097408, "question_id": 45765891, "link": "https://stackoverflow.com/questions/45765891/gorilla-sessions-session-be-managed-persist-changes-between-handlers", "title": "gorilla/sessions: Session be managed (persist changes) between handlers?", "body": "<p>I am using for Go session management:</p>\n\n<pre><code>\"github.com/gorilla/sessions\"\n</code></pre>\n\n<p>The problem with the following code is that the session associated with a CookieStore is not getting shared between handlers, and I need it to do such.</p>\n\n<p>Handler <code>\"/authorize\"</code> saves a value to the session and then redirects to another handler <code>\"/thankyou\"</code>, but that handler does not see the value within the session.</p>\n\n<p>I have validated that the session does have the new value within the originating handler <code>\"/authorize\"</code>.</p>\n\n<pre><code>import (\n    \"github.com/gorilla/sessions\"\n)\n\nvar (\n    cookieStore *sessions.CookieStore\n    storeGUID   string\n    sessionGUID string\n)\n\nfunc init() {\n    storeGUID = \"{random-string}\"\n    sessionGUID = \"{random-string}\"\n    cookieStore = sessions.NewCookieStore([]byte(storeGUID))\n}\n\nmux.HandleFunc(\"/authorize\", func(w http.ResponseWriter, r *http.Request) {\n    var sess *sessions.Session\n    sess, err := cookieStore.Get(r, sessionGUID)\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    sess.Values[\"authMode\"] = \"Authorized\"\n\n    if err := sess.Save(r, w); err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    // Redirect to \"/thankyou\"\n    authorizeURL := r.URL.String()\n    thankyouRedirectURL := strings.Replace(authorizeURL, \"authorize\", \"thankyou\", 1)\n    defer http.Redirect(w, r, thankyouRedirectURL, http.StatusFound)\n}\n\nmux.HandleFunc(\"/thankyou\", func(w http.ResponseWriter, r *http.Request) {\n    var sess *sessions.Session\n    sess, err := cookieStore.Get(r, sessionGUID)\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    var sval interface{}\n    var authMode string\n\n    sval = sess.Values[\"authMode\"]\n    if authMode, ok := sval.(string); !ok {\n        err := errors.New(\"Missing \\\"authSess\\\" in session.\")\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "slice", "moving-average"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1503090428, "post_id": 45765046, "comment_id": 78488635, "body": "<code>ma</code> has a length of 0, so you can&#39;t index anything. Is <code>ma</code> supposed to have a fixed number of values?"}, {"owner": {"reputation": 117, "user_id": 5559718, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/1068554619822559/picture?type=large", "display_name": "jgulacsy", "link": "https://stackoverflow.com/users/5559718/jgulacsy"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1503090595, "post_id": 45765046, "comment_id": 78488713, "body": "yes, I know the length of ma"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1503091259, "post_id": 45765166, "comment_id": 78488972, "body": "You don&#39;t seed to set capacity of 5 with a length of 5, it&#39;s implied."}, {"owner": {"reputation": 117, "user_id": 5559718, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/1068554619822559/picture?type=large", "display_name": "jgulacsy", "link": "https://stackoverflow.com/users/5559718/jgulacsy"}, "edited": false, "score": 0, "creation_date": 1503091856, "post_id": 45765166, "comment_id": 78489170, "body": "Thank you, I have overlooked it."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1503124622, "post_id": 45765166, "comment_id": 78495177, "body": "Using <code>append</code> causes unnecessary allocations and copy operations. If the necessary size is known beforehand, it is better to initialize the slice with the necessary capacity and set the individual slice index to the respective value."}, {"owner": {"reputation": 1822, "user_id": 176300, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ooflm.jpg?s=128&g=1", "display_name": "Nick", "link": "https://stackoverflow.com/users/176300/nick"}, "edited": false, "score": 0, "creation_date": 1503141328, "post_id": 45765166, "comment_id": 78499808, "body": "Marcus and Jim, You&#39;re both right - I&#39;ll expand the answer to capture your comments"}], "tags": [], "owner": {"reputation": 1822, "user_id": 176300, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ooflm.jpg?s=128&g=1", "display_name": "Nick", "link": "https://stackoverflow.com/users/176300/nick"}, "is_accepted": true, "score": 2, "last_activity_date": 1503141601, "last_edit_date": 1503141601, "creation_date": 1503090998, "answer_id": 45765166, "question_id": 45765046, "link": "https://stackoverflow.com/questions/45765046/trying-to-create-slice-of-type-movingavarage/45765166#45765166", "title": "Trying to create slice of type MovingAvarage", "body": "<p>You need to either pre-size the slice with</p>\n\n<pre><code>ma := make(movingaverage.MovingAverage, 5)\n</code></pre>\n\n<p>Which gives a slice of capacity 5 and length 5 with each entry set to the zero value </p>\n\n<p>Better though to initialise it as you did but then to add new entries with</p>\n\n<pre><code>ma = append(ma, movingaverage.New(15)) \n</code></pre>\n\n<p>If you know how big your eventual slice will be you can pre-allocate the underlying array with </p>\n\n<pre><code>ma := make(movingaverage.MovingAverage, 0, 5)\n</code></pre>\n\n<p>which will give you a slice of length 0 but capacity 5 so you don't have to do repeated memory allocations and moves</p>\n"}], "owner": {"reputation": 117, "user_id": 5559718, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/1068554619822559/picture?type=large", "display_name": "jgulacsy", "link": "https://stackoverflow.com/users/5559718/jgulacsy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 45765166, "answer_count": 1, "score": 1, "last_activity_date": 1503141601, "creation_date": 1503090334, "question_id": 45765046, "link": "https://stackoverflow.com/questions/45765046/trying-to-create-slice-of-type-movingavarage", "title": "Trying to create slice of type MovingAvarage", "body": "<p>I am using the RobinUS2/golang-moving-average library to compute moving avarages, but I am unable to assembe a slice of these avarages to compute MA for multiple variables.</p>\n\n<pre><code>ma := []movingaverage.MovingAverage{}\n    ma[0] = movingaverage.New(15)\n    ma[0].Add(3.14)\n</code></pre>\n\n<p>What could be wrong? I get an index out of range error. Thanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1503087462, "post_id": 45764428, "comment_id": 78487268, "body": "For the regex, I would put the compile outside the benchmark function (compile to a global var) as you only ever need to compile it once so that cost is irrelevant to the test. As to fairness... if that one value you&#39;re testing with is representative of all values you&#39;re likely to pass to the function, then yes, it seems fair."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1503087566, "post_id": 45764428, "comment_id": 78487326, "body": "Also <code>CheckNumber</code> can just operate on the byte slice instead of converting to a string unless you&#39;re expecting arbitrary multibyte text."}, {"owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1503088071, "post_id": 45764428, "comment_id": 78487577, "body": "@Adrian cool. I tried looking at the <code>UTF-8</code> code points/runes, and I couldn&#39;t conclusively figure out whether I can say for sure that e.g. <code>48</code> ==&gt; <code>0</code> and not part of some other multibyte text"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1503088212, "post_id": 45764428, "comment_id": 78487640, "body": "You can&#39;t, <i>if you&#39;re expecting arbitrary multibyte text</i>. You know more about your data than I do, so I don&#39;t know if that&#39;s a concern for you or not."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1503088353, "post_id": 45764428, "comment_id": 78487698, "body": "You don&#39;t have to worry about multi-byte chars. If your input contains those, other methods would deem it a non-number anyway (just as looking at single bytes will too, properly)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1503089515, "post_id": 45764428, "comment_id": 78488236, "body": "Though actually since you only care if it&#39;s a number or not, you could check if the raw byte value is &gt; 127 and if it is, return false (if it uses anything outside standard ASCII it&#39;s definitely non numeric)."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1503092657, "post_id": 45764428, "comment_id": 78489410, "body": "Depending on your data, perhaps in <code>CheckNumber</code> you need to check for <i>digit group separator</i> (e.g. comma), the letter of <i>E</i> or <i>e</i> for exponential notation, and sign (plus/minus after E/e)."}, {"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 1, "creation_date": 1503094148, "post_id": 45764428, "comment_id": 78489830, "body": "A suggestion: Write &#39;0&#39;, &#39;9&#39; and &#39;.&#39; instead of 48, 57 and 46. It doesn&#39;t matter for the speed, but it makes the code more readable."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1503096846, "post_id": 45764428, "comment_id": 78490514, "body": "@salient: Negative numbers? See my answer."}], "answers": [{"comments": [{"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1503094857, "post_id": 45765641, "comment_id": 78490000, "body": "Does it make a difference if instead of <code>if &#39;0&#39; &lt;= c &amp;&amp; c &lt;= &#39;9&#39; { continue;      }</code> you write <code>if c &lt; &#39;0&#39; || c &gt; &#39;9&#39; { return false; }</code>?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1503095451, "post_id": 45765641, "comment_id": 78490163, "body": "@md2perpe: Yes, <code>if c &lt; &#39;0&#39; || c &gt; &#39;9&#39; { return false; }</code> makes a big difference. It will introduce a bug. It doesn&#39;t handle a decimal point. However, <code>if &#39;0&#39; &lt;= c &amp;&amp; c &lt;= &#39;9&#39; { continue; }</code> makes no difference. It&#39;s just a difference in style."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1503139338, "last_edit_date": 1503139338, "creation_date": 1503094231, "answer_id": 45765641, "question_id": 45764428, "link": "https://stackoverflow.com/questions/45764428/most-efficient-way-to-check-if-a-byte-slice-is-a-number/45765641#45765641", "title": "Most efficient way to check if a byte slice is a number", "body": "<p>For a simple real (floating-point) number (no scientific or engineering floating-point format, no group separators),</p>\n\n<pre><code>func IsReal(n []byte) bool {\n    if len(n) &gt; 0 &amp;&amp; n[0] == '-' {\n        n = n[1:]\n    }\n    if len(n) == 0 {\n        return false\n    }\n    var point bool\n    for _, c := range n {\n        if '0' &lt;= c &amp;&amp; c &lt;= '9' {\n            continue\n        }\n        if c == '.' &amp;&amp; len(n) &gt; 1 &amp;&amp; !point {\n            point = true\n            continue\n        }\n        return false\n    }\n    return true\n}\n</code></pre>\n\n<p>Benchmark:</p>\n\n<pre><code>$ go test -run=! -bench=. -benchmem -cpu=1 real_test.go\ngoos: linux\ngoarch: amd64\nBenchmarkIsReal         100000000       20.8 ns/op         0 B/op          0 allocs/op\nBenchmarkFloatStrconv   20000000       101 ns/op          16 B/op          1 allocs/op\nBenchmarkFloatRegex      5000000       284 ns/op           0 B/op          0 allocs/op\nBenchmarkCheckNumber    20000000        73.0 ns/op         0 B/op          0 allocs/op\nPASS\nok      command-line-arguments  7.380s\n</code></pre>\n\n<p><code>real_test.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"regexp\"\n    \"strconv\"\n    \"testing\"\n    \"unicode\"\n)\n\nfunc IsReal(n []byte) bool {\n    if len(n) &gt; 0 &amp;&amp; n[0] == '-' {\n        n = n[1:]\n    }\n    if len(n) == 0 {\n        return false\n    }\n    var point bool\n    for _, c := range n {\n        if '0' &lt;= c &amp;&amp; c &lt;= '9' {\n            continue\n        }\n        if c == '.' &amp;&amp; len(n) &gt; 1 &amp;&amp; !point {\n            point = true\n            continue\n        }\n        return false\n    }\n    return true\n}\n\nfunc BenchmarkIsReal(b *testing.B) {\n    p := []byte(\"15.34234234234\")\n    for i := 0; i &lt; b.N; i++ {\n        ok := IsReal(p)\n        if !ok {\n            log.Fatalf(\"NaN\")\n        }\n    }\n}\n\nfunc CheckNumber(p []byte) bool {\n    r := string(p)\n\n    sep := 0\n\n    for _, b := range r {\n        if unicode.IsNumber(b) {\n            continue\n        }\n        if b == rune('.') {\n            if sep &gt; 0 {\n                return false\n            }\n            sep++\n            continue\n        }\n        return false\n    }\n\n    return true\n\n}\n\nfunc BenchmarkFloatStrconv(b *testing.B) {\n    p := []byte(\"15.34234234234\")\n\n    for i := 0; i &lt; b.N; i++ {\n        _, err := strconv.ParseFloat(string(p), 64)\n        if err != nil {\n            log.Fatalf(\"NaN\")\n        }\n    }\n}\n\nfunc BenchmarkFloatRegex(b *testing.B) {\n    p := []byte(\"15.34234234234\")\n    r := `[-+]?[0-9]*\\.?[0-9]`\n    c, _ := regexp.Compile(r)\n\n    for i := 0; i &lt; b.N; i++ {\n        ok := c.Match(p)\n        if !ok {\n            log.Fatalf(\"NaN\")\n        }\n    }\n}\n\nfunc BenchmarkCheckNumber(b *testing.B) {\n    p := []byte(\"15.34234234234\")\n\n    for i := 0; i &lt; b.N; i++ {\n        ok := CheckNumber(p)\n        if !ok {\n            log.Fatalf(\"NaN\")\n        }\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "is_accepted": false, "score": 1, "last_activity_date": 1503097772, "creation_date": 1503097772, "answer_id": 45766117, "question_id": 45764428, "link": "https://stackoverflow.com/questions/45764428/most-efficient-way-to-check-if-a-byte-slice-is-a-number/45766117#45766117", "title": "Most efficient way to check if a byte slice is a number", "body": "<p>I took upon it as a challenge for myself to rewrite this as some kind of state machine synthesizing the collective input from everyone here :) </p>\n\n<pre><code>func Validate(b []byte) bool {\n    for i := range b {\n        switch {\n        case b[i] &gt;= '0' &amp;&amp; b[i] &lt;= '9':\n            continue\n        case b[i] == '.':\n            if len(b) == 1 {\n                return false\n            }\n            if len(b) &gt; i {\n                return fractional(b[i+1:])\n            }\n            return true\n        case i == 0 &amp;&amp; b[i] == '-':\n            if len(b) == 1 {\n                return false\n            }\n            continue\n        default:\n            return false\n        }\n    }\n\n    return true\n}\n\nfunc fractional(b []byte) bool {\n    for i := range b {\n        switch {\n        case b[i] &gt;= '0' &amp;&amp; b[i] &lt;= '9':\n            continue\n        case b[i] == 'e' || b[i] == 'E':\n            if len(b[:i]) == 0 {\n                return false\n            }\n            if len(b) &gt; i+1 {\n                return scientific(b[i+1:])\n            }\n            return false\n        default:\n            return false\n        }\n    }\n\n    return true\n}\n\nfunc scientific(b []byte) bool {\n    for i := range b {\n        switch {\n        case b[i] &gt;= '0' &amp;&amp; b[i] &lt;= '9':\n            continue\n        case i == 0 &amp;&amp; b[i] == '-':\n            if len(b) == 1 {\n                return false\n            }\n            continue\n        default:\n            return false\n        }\n    }\n\n    return true\n}\n</code></pre>\n\n<p>It seems to work on a few different number formats:</p>\n\n<pre><code>type v struct {\n    Input    []byte\n    Expected bool\n}\n\nfunc TestPermutations(t *testing.T) {\n    b := []v{\n        v{[]byte(\"123.456\"), true},\n        v{[]byte(\"123\"), true},\n        v{[]byte(\"123.\"), true},\n        v{[]byte(\".123\"), true},\n        v{[]byte(\"12.1e12\"), true},\n        v{[]byte(\"12.1e-12\"), true},\n        v{[]byte(\"-123.456\"), true},\n        v{[]byte(\"-123\"), true},\n        v{[]byte(\"-123.\"), true},\n        v{[]byte(\"-.123\"), true},\n        v{[]byte(\"-12.1e12\"), true},\n        v{[]byte(\"-12.1e-12\"), true},\n        v{[]byte(\".1e-12\"), true},\n        v{[]byte(\".e-12\"), false},\n        v{[]byte(\".e\"), false},\n        v{[]byte(\"e\"), false},\n        v{[]byte(\"abcdef\"), false},\n        v{[]byte(\"-\"), false},\n        v{[]byte(\".\"), false},\n    }\n\n    for _, test := range b {\n        ok := Validate(test.Input)\n        if ok != test.Expected {\n            t.Errorf(\"could not handle case %s\", test.Input)\n        }\n    }\n\n}\n</code></pre>\n\n<p>and perform quite well on the original benchmark:</p>\n\n<pre><code>BenchmarkValidate-8     100000000           13.0 ns/op         0 B/op          0 allocs/op\n</code></pre>\n\n<p>Benchmark code:</p>\n\n<pre><code>func BenchmarkValidate(b *testing.B) {\n    p := []byte(\"15.1234567890\")\n\n    for i := 0; i &lt; b.N; i++ {\n        ok := Validate(p)\n        if !ok {\n            log.Fatalf(\"problem\")\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1385, "favorite_count": 2, "answer_count": 2, "score": 5, "last_activity_date": 1503140457, "creation_date": 1503087248, "last_edit_date": 1503140457, "question_id": 45764428, "link": "https://stackoverflow.com/questions/45764428/most-efficient-way-to-check-if-a-byte-slice-is-a-number", "title": "Most efficient way to check if a byte slice is a number", "body": "<p>I'm looking for the most efficient way to tell whether a byte slice is a float. </p>\n\n<p>This is to be done on huge datasets, so performance is key.</p>\n\n<p>Tried approaches:</p>\n\n<ul>\n<li><code>strconv.ParseFloat</code></li>\n<li><code>regexp.Match</code></li>\n<li><p><code>CheckNumber</code> - home rolled function using <code>IsNumber</code> + looking at whether the byte slice contains a <code>.</code>.</p>\n\n<pre><code>func CheckNumber(p []byte) bool {\n    r := string(p)\n    sep := 0\n    for _, b := range r {\n        if unicode.IsNumber(b) {\n            continue\n        }\n        if b == rune('.') {\n            if sep &gt; 0 {\n                return false\n            }\n            sep++\n            continue\n        }\n        return false\n    }\n    return true\n}\n</code></pre></li>\n</ul>\n\n<p>The benchmark code:</p>\n\n<pre><code>func BenchmarkFloatStrconv(b *testing.B) {\n    p := []byte(\"15.34234234234\")\n\n    for i := 0; i &lt; b.N; i++ {\n        _, err := strconv.ParseFloat(string(p), 64)\n        if err != nil {\n            log.Fatalf(\"NaN\")\n        }\n    }\n}\n\nfunc BenchmarkFloatRegex(b *testing.B) {\n    p := []byte(\"15.34234234234\")\n    r := `[-+]?[0-9]*\\.?[0-9]`\n    c, _ := regexp.Compile(r)\n\n    for i := 0; i &lt; b.N; i++ {\n        ok := c.Match(p)\n        if !ok {\n            log.Fatalf(\"NaN\")\n        }\n    }\n}\n\nfunc BenchmarkCheckNumber(b *testing.B) {\n    p := []byte(\"15.34234234234\")\n\n    for i := 0; i &lt; b.N; i++ {\n        ok := CheckNumber(p)\n        if !ok {\n            log.Fatalf(\"NaN\")\n        }\n    }\n}\n</code></pre>\n\n<p>Benchmark results:</p>\n\n<pre><code>BenchmarkFloatStrconv-8     20000000            85.8 ns/op        16 B/op          1 allocs/op\nBenchmarkFloatRegex-8        5000000           252 ns/op           0 B/op          0 allocs/op\nBenchmarkCheckNumber-8      20000000            64.3 ns/op         0 B/op          0 allocs/op\n</code></pre>\n\n<ul>\n<li>Am I doing the different solutions fairness?</li>\n<li>Are there better solutions?</li>\n</ul>\n\n<p><strong>Edit:</strong> thanks to pointers from Adrian and icza, this avoids converting to <code>strings</code>/<code>rune</code>s</p>\n\n<pre><code>func CheckNumberNoStringConvert(r []byte) bool {\n    sep := 0\n\n    for i := range r {\n        if r[i] &gt;= 48 &amp;&amp; r[i] &lt;= 57 {\n            continue\n        }\n        if r[i] == 46 {\n            if sep &gt; 0 {\n                return false\n            }\n            sep++\n            continue\n        }\n        return false\n    }\n\n    return true\n}\n</code></pre>\n\n<p>and performs quite well ;-)</p>\n\n<pre><code>BenchmarkCheckNumberNoStringConvert-8       200000000            8.55 ns/op        0 B/op          0 allocs/op\n</code></pre>\n"}]